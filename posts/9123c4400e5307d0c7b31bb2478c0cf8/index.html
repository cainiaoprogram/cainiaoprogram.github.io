<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spring Boot ç³»åˆ—: é›†æˆ Redis æ•°æ®åº“ åˆ†å¸ƒå¼å·¥å…· Redisson ç¼“å­˜ Spring Cache - èœé¸Ÿç¨‹åºå‘˜åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Spring Boot ç³»åˆ—: é›†æˆ Redis æ•°æ®åº“ åˆ†å¸ƒå¼å·¥å…· Redisson ç¼“å­˜ Spring Cache" />
<meta property="og:description" content="ğŸŒˆ é›†æˆ Redis æ•°æ®åº“ åˆ†å¸ƒå¼å·¥å…· Redisson ç¼“å­˜ Spring Cache ğŸŒˆ Redis å®¢æˆ·ç«¯ ğŸŒ® Jedis Jedis æ˜¯ Java å®ç°çš„è¾ƒè½»é‡çº§çš„ Redis å®¢æˆ·ç«¯ï¼Œç®€æ´ä¸”åŸºäº Socket çš„æ“ä½œæ–¹å¼ï¼Œå¾ˆé«˜çš„æ€§èƒ½ã€‚
Jedis çš„ API æä¾›çš„æ¯”è¾ƒå…¨é¢ Redis å‘½ä»¤çš„æ”¯æŒã€‚
ä½¿ç”¨é˜»å¡çš„ I/O æ“ä½œï¼Œæ–¹æ³•è°ƒç”¨éƒ½æ˜¯åŒæ­¥çš„ï¼Œç¨‹åºæµéœ€ç­‰åˆ° socket å¤„ç†å®Œ I/O æ‰èƒ½æ‰§è¡Œï¼Œä¸æ”¯æŒå¼‚æ­¥çš„æ“ä½œã€‚
æ˜¯ç›´æ¥è¿æ¥ Redis Server çš„ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œéœ€è¦é€šè¿‡è¿æ¥æ± æ¥æ“ä½œ Jedisã€‚
ğŸŒ® â€‹Lettuce Lettuce å¯ä¼¸ç¼©çº¿ç¨‹å®‰å…¨çš„ Redis å®¢æˆ·ç«¯ã€‚å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«åŒä¸€ä¸ª RedisConnectionï¼Œåˆ©ç”¨ Netty NIO æ¡†æ¶é«˜æ•ˆåœ°ç®¡ç†å¤šä¸ªè¿æ¥ã€‚
æ”¯æŒåŒæ­¥ã€å¼‚æ­¥ã€å“åº”å¼ç¼–ç¨‹ï¼Œè‡ªåŠ¨é‡æ–°è¿æ¥ï¼Œä¸»ä»ï¼Œé›†ç¾¤ï¼Œå“¨å…µï¼Œç®¡é“å’Œç¼–ç å™¨ã€‚
Spring Boot 2.x å¼€å§‹ï¼Œ Lettuce å·²å–ä»£ Jedis æˆä¸º Spring Boot é»˜è®¤çš„ Redis å®¢æˆ·ç«¯ã€‚
ğŸŒ® â€‹Redisson Redisson æ˜¯ä¸€ä¸ªåœ¨ Redis çš„åŸºç¡€ä¸Šå®ç°çš„ Java é©»å†…å­˜æ•°æ®ç½‘æ ¼ï¼ˆIn-Memory Data Gridï¼‰ã€‚å®ƒä¸ä»…æä¾›äº†ä¸€ç³»åˆ—çš„åˆ†å¸ƒå¼çš„ Java å¸¸ç”¨å¯¹è±¡ï¼Œè¿˜æä¾›äº†è®¸å¤šåˆ†å¸ƒå¼æœåŠ¡ã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9123c4400e5307d0c7b31bb2478c0cf8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-25T15:19:47+08:00" />
<meta property="article:modified_time" content="2023-05-25T15:19:47+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="èœé¸Ÿç¨‹åºå‘˜åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">èœé¸Ÿç¨‹åºå‘˜åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spring Boot ç³»åˆ—: é›†æˆ Redis æ•°æ®åº“ åˆ†å¸ƒå¼å·¥å…· Redisson ç¼“å­˜ Spring Cache</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="rainbow__Redis___Redisson__Spring_Cache_0"></a>ğŸŒˆ é›†æˆ Redis æ•°æ®åº“ åˆ†å¸ƒå¼å·¥å…· Redisson ç¼“å­˜ Spring Cache</h2> 
<h2><a id="rainbow_Redis__2"></a>ğŸŒˆ Redis å®¢æˆ·ç«¯</h2> 
<h3><a id="taco_Jedis_4"></a>ğŸŒ® Jedis</h3> 
<p>Jedis æ˜¯ Java å®ç°çš„è¾ƒè½»é‡çº§çš„ Redis å®¢æˆ·ç«¯ï¼Œç®€æ´ä¸”åŸºäº Socket çš„æ“ä½œæ–¹å¼ï¼Œå¾ˆé«˜çš„æ€§èƒ½ã€‚</p> 
<p>Jedis çš„ API æä¾›çš„æ¯”è¾ƒå…¨é¢ Redis å‘½ä»¤çš„æ”¯æŒã€‚</p> 
<p>ä½¿ç”¨é˜»å¡çš„ I/O æ“ä½œï¼Œæ–¹æ³•è°ƒç”¨éƒ½æ˜¯åŒæ­¥çš„ï¼Œç¨‹åºæµéœ€ç­‰åˆ° socket å¤„ç†å®Œ I/O æ‰èƒ½æ‰§è¡Œï¼Œä¸æ”¯æŒå¼‚æ­¥çš„æ“ä½œã€‚</p> 
<p>æ˜¯ç›´æ¥è¿æ¥ Redis Server çš„ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œéœ€è¦é€šè¿‡è¿æ¥æ± æ¥æ“ä½œ Jedisã€‚</p> 
<h3><a id="taco_Lettuce_14"></a>ğŸŒ® â€‹Lettuce</h3> 
<p>Lettuce å¯ä¼¸ç¼©çº¿ç¨‹å®‰å…¨çš„ Redis å®¢æˆ·ç«¯ã€‚å¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«åŒä¸€ä¸ª RedisConnectionï¼Œåˆ©ç”¨ Netty NIO æ¡†æ¶é«˜æ•ˆåœ°ç®¡ç†å¤šä¸ªè¿æ¥ã€‚</p> 
<p>æ”¯æŒåŒæ­¥ã€å¼‚æ­¥ã€å“åº”å¼ç¼–ç¨‹ï¼Œè‡ªåŠ¨é‡æ–°è¿æ¥ï¼Œä¸»ä»ï¼Œé›†ç¾¤ï¼Œå“¨å…µï¼Œç®¡é“å’Œç¼–ç å™¨ã€‚</p> 
<p>Spring Boot 2.x å¼€å§‹ï¼Œ Lettuce å·²å–ä»£ Jedis æˆä¸º Spring Boot é»˜è®¤çš„ Redis å®¢æˆ·ç«¯ã€‚</p> 
<h3><a id="taco_Redisson_22"></a>ğŸŒ® â€‹Redisson</h3> 
<p>Redisson æ˜¯ä¸€ä¸ªåœ¨ Redis çš„åŸºç¡€ä¸Šå®ç°çš„ Java é©»å†…å­˜æ•°æ®ç½‘æ ¼ï¼ˆIn-Memory Data Gridï¼‰ã€‚å®ƒä¸ä»…æä¾›äº†ä¸€ç³»åˆ—çš„åˆ†å¸ƒå¼çš„ Java å¸¸ç”¨å¯¹è±¡ï¼Œè¿˜æä¾›äº†è®¸å¤šåˆ†å¸ƒå¼æœåŠ¡ã€‚</p> 
<p>Redisson æä¾›äº†ä½¿ç”¨ Redis çš„æœ€ç®€å•å’Œæœ€ä¾¿æ·çš„æ–¹æ³•ã€‚</p> 
<p>é€‚ç”¨äºåˆ†å¸ƒå¼åº”ç”¨ï¼Œåˆ†å¸ƒå¼ç¼“å­˜ï¼Œåˆ†å¸ƒå¼å›è¯ç®¡ç†ï¼Œåˆ†å¸ƒå¼æœåŠ¡ï¼ˆä»»åŠ¡ï¼Œå»¶è¿Ÿä»»åŠ¡ï¼Œæ‰§è¡Œå™¨ï¼‰ã€‚</p> 
<p>ğŸŒŠ å½“æ²¡æœ‰åˆ†å¸ƒå¼åœºæ™¯ï¼Œä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ Lettuce æ€§èƒ½æ›´é«˜ï¼›éœ€è¦ç”¨åˆ°åˆ†å¸ƒå¼é”ï¼Œåˆ†å¸ƒå¼å¯¹è±¡ï¼Œåˆ†å¸ƒå¼é›†åˆç­‰ï¼Œå¯ä»¥é‡‡ç”¨ Lettuce + Redisson ç»„åˆä½¿ç”¨ã€‚</p> 
<h2><a id="rainbow_Spring_Boot__Redis_32"></a>ğŸŒˆ â€‹Spring Boot é›†æˆ Redis</h2> 
<h3><a id="taco_Spring_Data_Redis__34"></a>ğŸŒ® â€‹Spring Data Redis çš„ä¾èµ–</h3> 
<p>Maven å¼•å…¥ä¾èµ–ï¼Œç›´æ¥ä½¿ç”¨ Spring Boot é»˜è®¤çš„ç‰ˆæœ¬ï¼ˆä½¿ç”¨é»˜è®¤ Lettuce å®¢æˆ·ç«¯ï¼‰</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>å¼•å…¥ commons-pool2 ä¾èµ–ï¼Œä½œä¸º Lettuce çš„è¿æ¥æ± </p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.commons<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>commons-pool2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="taco_Spring_Data_Redis__54"></a>ğŸŒ® Spring Data Redis çš„é…ç½®</h3> 
<p>æ·»åŠ é…ç½®ï¼Œå‚è€ƒ <code>org.springframework.boot.autoconfigure.data.redis.RedisProperties</code></p> 
<pre><code class="prism language-properties">## Redisæ•°æ®åº“ç´¢å¼•ï¼ˆé»˜è®¤ä¸º0ï¼‰
spring.redis.database=0
## RedisæœåŠ¡å™¨åœ°å€ï¼ˆé»˜è®¤ä¸ºlocalhostï¼‰
spring.redis.host=127.0.0.1
## RedisæœåŠ¡å™¨è¿æ¥ç«¯å£ï¼ˆé»˜è®¤ä¸º6379ï¼‰
spring.redis.port=6379
## RedisæœåŠ¡å™¨è¿æ¥å¯†ç ï¼ˆé»˜è®¤ä¸ºç©ºï¼‰
spring.redis.password=
## è¿æ¥è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
spring.redis.timeout=1000
## è¿æ¥æ± æœ€å¤§è¿æ¥æ•°ï¼ˆé»˜è®¤ä¸º8ã€‚ä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰
spring.redis.lettuce.pool.max-active=8
## è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆé»˜è®¤ä¸º-1ã€‚ä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰
spring.redis.lettuce.pool.max-wait=-1
## è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥ï¼ˆé»˜è®¤ä¸º8ï¼‰
spring.redis.lettuce.pool.max-idle=8
## è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥ï¼ˆé»˜è®¤ä¸º0ï¼‰
spring.redis.lettuce.pool.min-idle=0
</code></pre> 
<h3><a id="taco_Spring_Data_Redis__79"></a>ğŸŒ® Spring Data Redis çš„ä½¿ç”¨</h3> 
<p>Spring Data Redis é»˜è®¤å‘å®¹å™¨ä¸­æ³¨å…¥ <code>RedisTemplate&lt;Object, Object&gt; redisTemplate</code> ã€<code>StringRedisTemplate stringRedisTemplate</code> ä¸¤ä¸ªæ¨¡æ¿ç±»ï¼Œæ˜¯ Spring å¯¹ Redis æ“ä½œçš„å°è£…ï¼Œé€šè¿‡å°è£…çš„ API æ¥æ“ä½œ Redisã€‚</p> 
<p>ğŸ… å‚è€ƒ <code>org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration</code></p> 
<p>ä½¿ç”¨ç¤ºä¾‹</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span>
<span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> redisTemplate<span class="token punctuation">;</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/stringRedis/add"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">stringRedisAdd</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"stringRedis"</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"stringRedis"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/redis/add"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">SysAccount</span> <span class="token function">redisAdd</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"redis"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SysAccount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAccount</span><span class="token punctuation">(</span><span class="token string">"don"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">JSONUtil</span><span class="token punctuation">.</span><span class="token function">toBean</span><span class="token punctuation">(</span>stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"redis"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">SysAccount</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code>opsForValue --&gt; string æ“ä½œ
opsForHash --&gt; hash æ“ä½œ
opsForList --&gt; list æ“ä½œ
opsForSet --&gt; set æ“ä½œ
opsForZSet --&gt; Zset æ“ä½œ
</code></pre> 
<p>æµ‹è¯•å®Œæˆï¼ŒæŸ¥çœ‹ Redis æ•°æ®åº“çš„æ•°æ®</p> 
<p><img src="https://images2.imgbox.com/e2/fb/FbyaWTcu_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>RedisTemplate é»˜è®¤ä½¿ç”¨çš„æ˜¯ JdkSerializationRedisSerializer åºåˆ—åŒ–</p> 
<h3><a id="taco_Spring_Data_Redis__121"></a>ğŸŒ® Spring Data Redis è‡ªå®šä¹‰åºåˆ—åŒ–</h3> 
<p>ç¼–å†™ Redis é…ç½®ç±» RedisConfig è‡ªå®šä¹‰ RedisTemplate ç¼“å­˜åºåˆ—åŒ–é…ç½®</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// åˆ›å»º RedisTemplate å¯¹è±¡</span>
    <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> redisTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// è®¾ç½® RedisConnection å·¥å‚ï¼ˆå®ç°å¤šç§ Java Redis å®¢æˆ·ç«¯æ¥å…¥çš„å·¥å‚ï¼‰</span>
    redisTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ä½¿ç”¨ Jackson2JsonRedisSerialize æ›¿æ¢é»˜è®¤åºåˆ—åŒ–</span>
    <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">ObjectMapper</span> mapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mapper<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">PropertyAccessor</span><span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> <span class="token class-name">JsonAutoDetect<span class="token punctuation">.</span>Visibility</span><span class="token punctuation">.</span>ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mapper<span class="token punctuation">.</span><span class="token function">activateDefaultTyping</span><span class="token punctuation">(</span>mapper<span class="token punctuation">.</span><span class="token function">getPolymorphicTypeValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span>NON_FINAL<span class="token punctuation">,</span> <span class="token class-name">JsonTypeInfo<span class="token punctuation">.</span>As</span><span class="token punctuation">.</span>PROPERTY<span class="token punctuation">)</span><span class="token punctuation">;</span>

    jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>mapper<span class="token punctuation">)</span><span class="token punctuation">;</span>

    redisTemplate<span class="token punctuation">.</span><span class="token function">setDefaultSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token class-name">StringRedisSerializer</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>æµ‹è¯•ï¼ŒæŸ¥çœ‹ Redis æ•°æ®åº“çš„æ•°æ®ï¼ŒJSON æ ¼å¼æ•°æ®</p> 
<p><img src="https://images2.imgbox.com/28/75/pkx2dxLo_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>ğŸ… StringRedisTemplate é»˜è®¤ä½¿ç”¨çš„ StringRedisSerializer åºåˆ—åŒ–æœºåˆ¶ï¼Œç®€å•çš„å­—ç¬¦ä¸²åºåˆ—åŒ– ï¼Œkeyã€value éƒ½æ˜¯ String å­—ç¬¦ä¸²ï¼Œä¸ç”¨ä¿®æ”¹ã€‚å‚è€ƒ <code>org.springframework.data.redis.core.StringRedisTemplate</code></p> 
<p>ğŸ… RedisSerializer æ¥å£æ˜¯ Redis åºåˆ—åŒ–æ¥å£ï¼Œç”¨äº Redis KEY å’Œ VALUE çš„åºåˆ—åŒ–</p> 
<p><code>org.springframework.data.redis.serializer.RedisSerializer</code></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Nullable</span>
    <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">T</span> t<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SerializationException</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Nullable</span>
    <span class="token class-name">T</span> <span class="token function">deserialize</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SerializationException</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token class-name">RedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">java</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">java</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span><span class="token punctuation">)</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token class-name">RedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">java</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JdkSerializationRedisSerializer</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token class-name">RedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token class-name">RedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">string</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token class-name">RedisSerializer</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token function">byteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">ByteArrayRedisSerializer</span><span class="token punctuation">.</span>INSTANCE<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">default</span> <span class="token keyword">boolean</span> <span class="token function">canSerialize</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> type<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">ClassUtils</span><span class="token punctuation">.</span><span class="token function">isAssignable</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getTargetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">default</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">getTargetType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>å®ç°ç±»æœ‰ï¼š</p> 
<p><img src="https://images2.imgbox.com/91/33/wYMbYolo_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>JdkSerializationRedisSerializerï¼šåºåˆ—åŒ–å¯¹è±¡ï¼Œå¯¹è±¡å¿…é¡»å®ç° Serializable æ¥å£ï¼Œè¢«åºåˆ—åŒ–é™¤å±æ€§å†…å®¹è¿˜æœ‰å…¶ä»–å†…å®¹ï¼Œé•¿åº¦é•¿ä¸”ä¸æ˜“é˜…è¯»ï¼Œé»˜è®¤å°±æ˜¯é‡‡ç”¨è¿™ç§åºåˆ—åŒ–æ–¹å¼ã€‚</p> 
<p>Jackson2JsonRedisSerializerï¼šåºåˆ—åŒ–å¯¹è±¡ä¸º JSON å­—ç¬¦ä¸²ï¼Œè¢«åºåˆ—åŒ–å¯¹è±¡ä¸éœ€è¦å®ç° Serializable æ¥å£ï¼Œåºåˆ—åŒ–åç»“æœå®¹æ˜“é˜…è¯»ï¼Œå­˜å‚¨å­—èŠ‚å°‘ï¼Œé€Ÿåº¦å¿«ã€‚</p> 
<h2><a id="rainbow_Spring_Boot__Redisson_209"></a>ğŸŒˆ Spring Boot é›†æˆ Redisson</h2> 
<h3><a id="taco_Redisson__211"></a>ğŸŒ® Redisson çš„ä¾èµ–</h3> 
<p>Maven å¼•å…¥ä¾èµ–ï¼Œç‰ˆæœ¬æ ¹æ® Spring Boot ç‰ˆæœ¬é€‰æ‹©</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.redisson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>redisson-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${redisson.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>å‚è€ƒ https://github.com/redisson/redisson/tree/master/redisson-spring-boot-starter</p> 
<h3><a id="taco_Redisson__225"></a>ğŸŒ® Redisson çš„é…ç½®</h3> 
<p>æ·»åŠ é…ç½®æ–‡ä»¶ <code>redisson-config.yml</code></p> 
<pre><code class="prism language-yaml"><span class="token key atrule">singleServerConfig</span><span class="token punctuation">:</span>
  <span class="token key atrule">address</span><span class="token punctuation">:</span> <span class="token string">"redis://127.0.0.1:6379"</span>
  <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">clientName</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>
  <span class="token key atrule">idleConnectionTimeout</span><span class="token punctuation">:</span> <span class="token number">10000</span>
  <span class="token key atrule">pingTimeout</span><span class="token punctuation">:</span> <span class="token number">1000</span>
  <span class="token key atrule">connectTimeout</span><span class="token punctuation">:</span> <span class="token number">10000</span>
  <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">3000</span>
  <span class="token key atrule">retryAttempts</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">retryInterval</span><span class="token punctuation">:</span> <span class="token number">1500</span>
  <span class="token key atrule">reconnectionTimeout</span><span class="token punctuation">:</span> <span class="token number">3000</span>
  <span class="token key atrule">failedAttempts</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">subscriptionsPerConnection</span><span class="token punctuation">:</span> <span class="token number">5</span>
  <span class="token key atrule">subscriptionConnectionMinimumIdleSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">subscriptionConnectionPoolSize</span><span class="token punctuation">:</span> <span class="token number">50</span>
  <span class="token key atrule">connectionMinimumIdleSize</span><span class="token punctuation">:</span> <span class="token number">32</span>
  <span class="token key atrule">connectionPoolSize</span><span class="token punctuation">:</span> <span class="token number">64</span>
  <span class="token key atrule">dnsMonitoringInterval</span><span class="token punctuation">:</span> <span class="token number">5000</span>
<span class="token key atrule">threads</span><span class="token punctuation">:</span> <span class="token number">0</span>
<span class="token key atrule">nettyThreads</span><span class="token punctuation">:</span> <span class="token number">0</span>
<span class="token key atrule">codec</span><span class="token punctuation">:</span>
  <span class="token key atrule">class</span><span class="token punctuation">:</span> <span class="token string">"org.redisson.codec.JsonJacksonCodec"</span>
<span class="token key atrule">transportMode</span><span class="token punctuation">:</span> <span class="token string">"NIO"</span>
</code></pre> 
<p>åœ¨ application.yml ä¸­é…ç½®</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">redisson</span><span class="token punctuation">:</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>redisson<span class="token punctuation">-</span>config.yml
</code></pre> 
<p>é…ç½®å®Œåå³å¯ä½¿ç”¨ RedissonClient æ“ä½œ Redis</p> 
<p>ğŸ… è¯¦ç»†å‚è€ƒ <code>org.redisson.spring.starter.RedissonAutoConfiguration</code></p> 
<h3><a id="taco_RedissonClient__269"></a>ğŸŒ® RedissonClient çš„ä½¿ç”¨</h3> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Autowired</span>
<span class="token keyword">private</span> <span class="token class-name">RedissonClient</span> redissonClient<span class="token punctuation">;</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/set/{key}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">RBucket</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keyObj <span class="token operator">=</span> redissonClient<span class="token punctuation">.</span><span class="token function">getBucket</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    keyObj<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>key <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> key<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/get/{key}"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">RBucket</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> keyObj <span class="token operator">=</span> redissonClient<span class="token punctuation">.</span><span class="token function">getBucket</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> keyObj<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>é”çš„ä½¿ç”¨</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/lock"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">redissonLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">RLock</span> lock <span class="token operator">=</span> redissonClient<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token string">"lock"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 1.è·å– redis é”</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 2.è·å–åº“å­˜</span>
                <span class="token class-name">RBucket</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> keyObj <span class="token operator">=</span> redissonClient<span class="token punctuation">.</span><span class="token function">getBucket</span><span class="token punctuation">(</span><span class="token string">"xiaomi"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Integer</span> stock <span class="token operator">=</span> keyObj<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>stock <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 3.æ¯”è¾ƒå¹¶ä¸”æ‰£å‡åº“å­˜</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>stock <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// 4.è®¾ç½®åº“å­˜</span>
                        keyObj<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">--</span>stock<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è´­ä¹°æˆåŠŸ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>æ›´å¤šé”çš„ä½¿ç”¨å‚è€ƒ https://github.com/redisson/redisson/wiki/8.-distributed-locks-and-synchronizers</p> 
<h3><a id="taco__RedissonAutoConfigurationCustomizer__323"></a>ğŸŒ® ä½¿ç”¨ RedissonAutoConfigurationCustomizer é…ç½®</h3> 
<p>æ–°å»º Redisson é…ç½®é¡¹ç±»</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"redisson"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedissonProperties</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * Redis ç¼“å­˜ Key å‰ç¼€
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> keyPrefix<span class="token punctuation">;</span>
    <span class="token comment">/**
     * çº¿ç¨‹æ± æ•°é‡, é»˜è®¤å€¼ = å½“å‰å¤„ç†æ ¸æ•°é‡ * 2
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> threads<span class="token punctuation">;</span>
    <span class="token comment">/**
     * Netty çº¿ç¨‹æ± æ•°é‡, é»˜è®¤å€¼ = å½“å‰å¤„ç†æ ¸æ•°é‡ * 2
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> nettyThreads<span class="token punctuation">;</span>
    <span class="token comment">/**
     * ä¼ è¾“æ¨¡å¼
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">TransportMode</span> transportMode<span class="token punctuation">;</span>
    <span class="token comment">/**
     * å•æœºæœåŠ¡é…ç½®
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">SingleServerConfig</span> singleServerConfig<span class="token punctuation">;</span>
    <span class="token comment">/**
     * é›†ç¾¤æœåŠ¡é…ç½®
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">ClusterServersConfig</span> clusterServersConfig<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Data</span>
    <span class="token annotation punctuation">@NoArgsConstructor</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">SingleServerConfig</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/**
         * å®¢æˆ·ç«¯åç§°
         */</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> clientName<span class="token punctuation">;</span>
        <span class="token comment">/**
         * æœ€å°ç©ºé—²è¿æ¥æ•°
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> connectionMinimumIdleSize<span class="token punctuation">;</span>
        <span class="token comment">/**
         * è¿æ¥æ± å¤§å°
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> connectionPoolSize<span class="token punctuation">;</span>
        <span class="token comment">/**
         * è¿æ¥ç©ºé—²è¶…æ—¶ï¼Œå•ä½ï¼šæ¯«ç§’
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> idleConnectionTimeout<span class="token punctuation">;</span>
        <span class="token comment">/**
         * å‘½ä»¤ç­‰å¾…è¶…æ—¶ï¼Œå•ä½ï¼šæ¯«ç§’
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> timeout<span class="token punctuation">;</span>
        <span class="token comment">/**
         * å‘½ä»¤å¤±è´¥é‡è¯•æ¬¡æ•°
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> retryAttempts<span class="token punctuation">;</span>
        <span class="token comment">/**
         * å‘½ä»¤å¤±è´¥é‡è¯•æ¬¡æ•°
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> retryInterval<span class="token punctuation">;</span>
        <span class="token comment">/**
         * å‘å¸ƒå’Œè®¢é˜…è¿æ¥çš„æœ€å°ç©ºé—²è¿æ¥æ•°
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> subscriptionConnectionMinimumIdleSize<span class="token punctuation">;</span>
        <span class="token comment">/**
         * å‘å¸ƒå’Œè®¢é˜…è¿æ¥æ± å¤§å°
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> subscriptionConnectionPoolSize<span class="token punctuation">;</span>
        <span class="token comment">/**
         * å•ä¸ªè¿æ¥æœ€å¤§è®¢é˜…æ•°é‡
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> subscriptionsPerConnection<span class="token punctuation">;</span>
        <span class="token comment">/**
         * DNSç›‘æµ‹æ—¶é—´é—´éš”ï¼Œå•ä½ï¼šæ¯«ç§’
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> dnsMonitoringInterval<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Data</span>
    <span class="token annotation punctuation">@NoArgsConstructor</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ClusterServersConfig</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/**
         * å®¢æˆ·ç«¯åç§°
         */</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> clientName<span class="token punctuation">;</span>
        <span class="token comment">/**
         * masteræœ€å°ç©ºé—²è¿æ¥æ•°
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> masterConnectionMinimumIdleSize<span class="token punctuation">;</span>
        <span class="token comment">/**
         * masterè¿æ¥æ± å¤§å°
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> masterConnectionPoolSize<span class="token punctuation">;</span>
        <span class="token comment">/**
         * slaveæœ€å°ç©ºé—²è¿æ¥æ•°
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> slaveConnectionMinimumIdleSize<span class="token punctuation">;</span>
        <span class="token comment">/**
         * slaveè¿æ¥æ± å¤§å°
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> slaveConnectionPoolSize<span class="token punctuation">;</span>
        <span class="token comment">/**
         * è¿æ¥ç©ºé—²è¶…æ—¶ï¼Œå•ä½ï¼šæ¯«ç§’
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> idleConnectionTimeout<span class="token punctuation">;</span>
        <span class="token comment">/**
         * å‘½ä»¤ç­‰å¾…è¶…æ—¶ï¼Œå•ä½ï¼šæ¯«ç§’
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> timeout<span class="token punctuation">;</span>
        <span class="token comment">/**
         * å‘½ä»¤å¤±è´¥é‡è¯•æ¬¡æ•°
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> retryAttempts<span class="token punctuation">;</span>
        <span class="token comment">/**
         * å‘½ä»¤å¤±è´¥é‡è¯•æ¬¡æ•°
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> retryInterval<span class="token punctuation">;</span>
        <span class="token comment">/**
         * å¤±è´¥ä»èŠ‚ç‚¹é‡è¿é—´éš”æ—¶é—´
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> failedSlaveReconnectionInterval<span class="token punctuation">;</span>
        <span class="token comment">/**
         * å¤±è´¥ä»èŠ‚ç‚¹æ ¡éªŒé—´éš”æ—¶é—´
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> failedSlaveCheckInterval<span class="token punctuation">;</span>
        <span class="token comment">/**
         * å•ä¸ªè¿æ¥æœ€å¤§è®¢é˜…æ•°é‡
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> subscriptionsPerConnection<span class="token punctuation">;</span>
        <span class="token comment">/**
         * å‘å¸ƒå’Œè®¢é˜…è¿æ¥çš„æœ€å°ç©ºé—²è¿æ¥æ•°
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> subscriptionConnectionMinimumIdleSize<span class="token punctuation">;</span>
        <span class="token comment">/**
         * å‘å¸ƒå’Œè®¢é˜…è¿æ¥æ± å¤§å°
         */</span>
        <span class="token keyword">private</span> <span class="token keyword">int</span> subscriptionConnectionPoolSize<span class="token punctuation">;</span>
        <span class="token comment">/**
         * è¯»å–æ¨¡å¼
         */</span>
        <span class="token keyword">private</span> <span class="token class-name">ReadMode</span> readMode<span class="token punctuation">;</span>
        <span class="token comment">/**
         * è®¢é˜…æ¨¡å¼
         */</span>
        <span class="token keyword">private</span> <span class="token class-name">SubscriptionMode</span> subscriptionMode<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>æ·»åŠ  yml é…ç½® Redisson</p> 
<pre><code class="prism language-yaml"><span class="token punctuation">---</span> <span class="token comment">##### redis é…ç½® #####</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 127.0.0.1
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>
<span class="token comment">#    password:</span>
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">5000</span>
    <span class="token comment"># æ˜¯å¦å¼€å¯ssl</span>
    <span class="token key atrule">ssl</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token comment"># è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥ é»˜è®¤8</span>
        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">8</span>
        <span class="token comment"># è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥ é»˜è®¤0</span>
        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0</span>
        <span class="token comment"># è¿æ¥æ± æœ€å¤§è¿æ¥æ•° é»˜è®¤8 ï¼Œè´Ÿæ•°è¡¨ç¤ºæ²¡æœ‰é™åˆ¶</span>
        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">8</span>
        <span class="token comment"># è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ é»˜è®¤-1</span>
        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token number">-1</span>
<span class="token punctuation">---</span> <span class="token comment"># redisson å®¢æˆ·ç«¯é…ç½®</span>
<span class="token key atrule">redisson</span><span class="token punctuation">:</span>
  <span class="token key atrule">key-prefix</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>spring.application.name<span class="token punctuation">}</span>
  <span class="token comment"># çº¿ç¨‹æ± æ•°é‡</span>
  <span class="token key atrule">threads</span><span class="token punctuation">:</span> <span class="token number">16</span>
  <span class="token comment"># Nettyçº¿ç¨‹æ± æ•°é‡</span>
  <span class="token key atrule">netty-threads</span><span class="token punctuation">:</span> <span class="token number">32</span>
  <span class="token comment"># ä¼ è¾“æ¨¡å¼</span>
  <span class="token key atrule">transport-mode</span><span class="token punctuation">:</span> <span class="token string">"NIO"</span>
  <span class="token comment"># å•èŠ‚ç‚¹é…ç½®</span>
  <span class="token key atrule">single-server-config</span><span class="token punctuation">:</span>
    <span class="token comment"># å®¢æˆ·ç«¯åç§°</span>
    <span class="token key atrule">client-name</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>spring.application.name<span class="token punctuation">}</span>
    <span class="token comment"># æœ€å°ç©ºé—²è¿æ¥æ•°</span>
    <span class="token key atrule">connection-minimum-idle-size</span><span class="token punctuation">:</span> <span class="token number">32</span>
    <span class="token comment"># è¿æ¥æ± å¤§å°</span>
    <span class="token key atrule">connection-pool-size</span><span class="token punctuation">:</span> <span class="token number">64</span>
    <span class="token comment"># è¿æ¥ç©ºé—²è¶…æ—¶ï¼Œå•ä½ï¼šæ¯«ç§’</span>
    <span class="token key atrule">idle-connection-timeout</span><span class="token punctuation">:</span> <span class="token number">10000</span>
    <span class="token comment"># å‘½ä»¤ç­‰å¾…è¶…æ—¶ï¼Œå•ä½ï¼šæ¯«ç§’</span>
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">3000</span>
    <span class="token comment"># å¦‚æœå°è¯•åœ¨æ­¤é™åˆ¶ä¹‹å†…å‘é€æˆåŠŸï¼Œåˆ™å¼€å§‹å¯ç”¨ timeout è®¡æ—¶ã€‚</span>
    <span class="token key atrule">retry-attempts</span><span class="token punctuation">:</span> <span class="token number">3</span>
    <span class="token comment"># å‘½ä»¤é‡è¯•å‘é€æ—¶é—´é—´éš”ï¼Œå•ä½ï¼šæ¯«ç§’</span>
    <span class="token key atrule">retry-interval</span><span class="token punctuation">:</span> <span class="token number">1500</span>
    <span class="token comment"># å‘å¸ƒå’Œè®¢é˜…è¿æ¥çš„æœ€å°ç©ºé—²è¿æ¥æ•°</span>
    <span class="token key atrule">subscription-connection-minimum-idle-size</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token comment"># å‘å¸ƒå’Œè®¢é˜…è¿æ¥æ± å¤§å°</span>
    <span class="token key atrule">subscription-connection-pool-size</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token comment"># å•ä¸ªè¿æ¥æœ€å¤§è®¢é˜…æ•°é‡</span>
    <span class="token key atrule">subscriptions-per-connection</span><span class="token punctuation">:</span> <span class="token number">5</span>
    <span class="token comment"># dnsç›‘æµ‹æ—¶é—´é—´éš”ï¼Œå•ä½ï¼šæ¯«ç§’</span>
    <span class="token key atrule">dns-monitoring-interval</span><span class="token punctuation">:</span> <span class="token number">5000</span>
</code></pre> 
<p>é…ç½® Redisson</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@EnableConfigurationProperties</span><span class="token punctuation">(</span><span class="token class-name">RedissonProperties</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DonRedissonAutoConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedissonAutoConfigurationCustomizer</span> <span class="token function">redissonCustomizer</span><span class="token punctuation">(</span><span class="token class-name">RedissonProperties</span> redissonProperties<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"DonRedissonAutoConfiguration redissonCustomizer init ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> config <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            config<span class="token punctuation">.</span><span class="token function">setThreads</span><span class="token punctuation">(</span>redissonProperties<span class="token punctuation">.</span><span class="token function">getThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setNettyThreads</span><span class="token punctuation">(</span>redissonProperties<span class="token punctuation">.</span><span class="token function">getNettyThreads</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setCodec</span><span class="token punctuation">(</span><span class="token class-name">JsonJacksonCodec</span><span class="token punctuation">.</span>INSTANCE<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">setTransportMode</span><span class="token punctuation">(</span>redissonProperties<span class="token punctuation">.</span><span class="token function">getTransportMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">RedissonProperties<span class="token punctuation">.</span>SingleServerConfig</span> singleServerConfig <span class="token operator">=</span> redissonProperties<span class="token punctuation">.</span><span class="token function">getSingleServerConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">RedissonProperties<span class="token punctuation">.</span>ClusterServersConfig</span> clusterServersConfig <span class="token operator">=</span> redissonProperties<span class="token punctuation">.</span><span class="token function">getClusterServersConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// å•æœºæ¨¡å¼</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>singleServerConfig<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                config<span class="token punctuation">.</span><span class="token function">useSingleServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setClientName</span><span class="token punctuation">(</span>singleServerConfig<span class="token punctuation">.</span><span class="token function">getClientName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token comment">// è®¾ç½® Redis key å‰ç¼€</span>
                        <span class="token punctuation">.</span><span class="token function">setNameMapper</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">KeyPrefixHandler</span><span class="token punctuation">(</span>redissonProperties<span class="token punctuation">.</span><span class="token function">getKeyPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setConnectTimeout</span><span class="token punctuation">(</span>singleServerConfig<span class="token punctuation">.</span><span class="token function">getTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span>singleServerConfig<span class="token punctuation">.</span><span class="token function">getTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setRetryAttempts</span><span class="token punctuation">(</span>singleServerConfig<span class="token punctuation">.</span><span class="token function">getRetryAttempts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setRetryInterval</span><span class="token punctuation">(</span>singleServerConfig<span class="token punctuation">.</span><span class="token function">getRetryInterval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setSubscriptionConnectionMinimumIdleSize</span><span class="token punctuation">(</span>singleServerConfig<span class="token punctuation">.</span><span class="token function">getSubscriptionConnectionMinimumIdleSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setSubscriptionConnectionPoolSize</span><span class="token punctuation">(</span>singleServerConfig<span class="token punctuation">.</span><span class="token function">getSubscriptionConnectionPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setSubscriptionsPerConnection</span><span class="token punctuation">(</span>singleServerConfig<span class="token punctuation">.</span><span class="token function">getSubscriptionsPerConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setConnectionMinimumIdleSize</span><span class="token punctuation">(</span>singleServerConfig<span class="token punctuation">.</span><span class="token function">getConnectionMinimumIdleSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setConnectionPoolSize</span><span class="token punctuation">(</span>singleServerConfig<span class="token punctuation">.</span><span class="token function">getConnectionPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setIdleConnectionTimeout</span><span class="token punctuation">(</span>singleServerConfig<span class="token punctuation">.</span><span class="token function">getIdleConnectionTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setDnsMonitoringInterval</span><span class="token punctuation">(</span>singleServerConfig<span class="token punctuation">.</span><span class="token function">getDnsMonitoringInterval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// é›†ç¾¤æ¨¡å¼</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">nonNull</span><span class="token punctuation">(</span>clusterServersConfig<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                config<span class="token punctuation">.</span><span class="token function">useClusterServers</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setClientName</span><span class="token punctuation">(</span>clusterServersConfig<span class="token punctuation">.</span><span class="token function">getClientName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token comment">// è®¾ç½® Redis key å‰ç¼€</span>
                        <span class="token punctuation">.</span><span class="token function">setNameMapper</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">KeyPrefixHandler</span><span class="token punctuation">(</span>redissonProperties<span class="token punctuation">.</span><span class="token function">getKeyPrefix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setConnectTimeout</span><span class="token punctuation">(</span>clusterServersConfig<span class="token punctuation">.</span><span class="token function">getTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setTimeout</span><span class="token punctuation">(</span>clusterServersConfig<span class="token punctuation">.</span><span class="token function">getTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setMasterConnectionMinimumIdleSize</span><span class="token punctuation">(</span>clusterServersConfig<span class="token punctuation">.</span><span class="token function">getMasterConnectionMinimumIdleSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setMasterConnectionPoolSize</span><span class="token punctuation">(</span>clusterServersConfig<span class="token punctuation">.</span><span class="token function">getMasterConnectionPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setSlaveConnectionMinimumIdleSize</span><span class="token punctuation">(</span>clusterServersConfig<span class="token punctuation">.</span><span class="token function">getSlaveConnectionMinimumIdleSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setSlaveConnectionPoolSize</span><span class="token punctuation">(</span>clusterServersConfig<span class="token punctuation">.</span><span class="token function">getSlaveConnectionPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setIdleConnectionTimeout</span><span class="token punctuation">(</span>clusterServersConfig<span class="token punctuation">.</span><span class="token function">getIdleConnectionTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setRetryAttempts</span><span class="token punctuation">(</span>clusterServersConfig<span class="token punctuation">.</span><span class="token function">getRetryAttempts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setRetryInterval</span><span class="token punctuation">(</span>clusterServersConfig<span class="token punctuation">.</span><span class="token function">getRetryInterval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setFailedSlaveReconnectionInterval</span><span class="token punctuation">(</span>clusterServersConfig<span class="token punctuation">.</span><span class="token function">getFailedSlaveReconnectionInterval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setFailedSlaveCheckInterval</span><span class="token punctuation">(</span>clusterServersConfig<span class="token punctuation">.</span><span class="token function">getFailedSlaveCheckInterval</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setSubscriptionsPerConnection</span><span class="token punctuation">(</span>clusterServersConfig<span class="token punctuation">.</span><span class="token function">getSubscriptionsPerConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setSubscriptionConnectionMinimumIdleSize</span><span class="token punctuation">(</span>clusterServersConfig<span class="token punctuation">.</span><span class="token function">getSubscriptionConnectionMinimumIdleSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setSubscriptionConnectionPoolSize</span><span class="token punctuation">(</span>clusterServersConfig<span class="token punctuation">.</span><span class="token function">getSubscriptionConnectionPoolSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setReadMode</span><span class="token punctuation">(</span>clusterServersConfig<span class="token punctuation">.</span><span class="token function">getReadMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setSubscriptionMode</span><span class="token punctuation">(</span>clusterServersConfig<span class="token punctuation">.</span><span class="token function">getSubscriptionMode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>æµ‹è¯•åˆ†å¸ƒå¼é”</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/lock"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">RLock</span> lock <span class="token operator">=</span> redissonClient<span class="token punctuation">.</span><span class="token function">getLock</span><span class="token punctuation">(</span><span class="token string">"lock"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>lock<span class="token punctuation">.</span><span class="token function">tryLock</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"å½“å‰çº¿ç¨‹åï¼š{}"</span><span class="token punctuation">,</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
                lock<span class="token punctuation">.</span><span class="token function">unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="taco__624"></a>ğŸŒ® é›†ç¾¤é…ç½®</h3> 
<pre><code class="prism language-yaml"><span class="token punctuation">---</span> <span class="token comment">##### redis é…ç½® #####</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">cluster</span><span class="token punctuation">:</span>
      <span class="token key atrule">nodes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">6380</span>
        <span class="token punctuation">-</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">6381</span>
        <span class="token punctuation">-</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">6382</span>
        <span class="token punctuation">-</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">6383</span>
        <span class="token punctuation">-</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">6384</span>
        <span class="token punctuation">-</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">6385</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token comment"># è¿æ¥è¶…æ—¶æ—¶é—´</span>
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">5000</span>
    <span class="token comment"># æ˜¯å¦å¼€å¯ssl</span>
    <span class="token key atrule">ssl</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token comment"># è¿æ¥æ± ä¸­çš„æœ€å¤§ç©ºé—²è¿æ¥ é»˜è®¤8</span>
        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">8</span>
        <span class="token comment"># è¿æ¥æ± ä¸­çš„æœ€å°ç©ºé—²è¿æ¥ é»˜è®¤0</span>
        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0</span>
        <span class="token comment"># è¿æ¥æ± æœ€å¤§è¿æ¥æ•° é»˜è®¤8 ï¼Œè´Ÿæ•°è¡¨ç¤ºæ²¡æœ‰é™åˆ¶</span>
        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">8</span>
        <span class="token comment"># è¿æ¥æ± æœ€å¤§é˜»å¡ç­‰å¾…æ—¶é—´ï¼ˆä½¿ç”¨è´Ÿå€¼è¡¨ç¤ºæ²¡æœ‰é™åˆ¶ï¼‰ é»˜è®¤-1</span>
        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token number">-1</span>
<span class="token punctuation">---</span> <span class="token comment"># redisson å®¢æˆ·ç«¯é…ç½®</span>
<span class="token key atrule">redisson</span><span class="token punctuation">:</span>
  <span class="token key atrule">key-prefix</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>spring.application.name<span class="token punctuation">}</span>
  <span class="token comment"># çº¿ç¨‹æ± æ•°é‡</span>
  <span class="token key atrule">threads</span><span class="token punctuation">:</span> <span class="token number">16</span>
  <span class="token comment"># Nettyçº¿ç¨‹æ± æ•°é‡</span>
  <span class="token key atrule">netty-threads</span><span class="token punctuation">:</span> <span class="token number">32</span>
  <span class="token comment"># ä¼ è¾“æ¨¡å¼</span>
  <span class="token key atrule">transport-mode</span><span class="token punctuation">:</span> <span class="token string">"NIO"</span>
  <span class="token key atrule">cluster-servers-config</span><span class="token punctuation">:</span>
    <span class="token comment"># å®¢æˆ·ç«¯åç§°</span>
    <span class="token key atrule">client-name</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>spring.application.name<span class="token punctuation">}</span>
    <span class="token comment"># ä¸»èŠ‚ç‚¹æœ€å°ç©ºé—²è¿æ¥æ•°</span>
    <span class="token key atrule">master-connection-minimum-idle-size</span><span class="token punctuation">:</span> <span class="token number">24</span>
    <span class="token comment"># ä¸»èŠ‚ç‚¹è¿æ¥æ± å¤§å°</span>
    <span class="token key atrule">master-connection-pool-size</span><span class="token punctuation">:</span> <span class="token number">64</span>
    <span class="token comment"># ä»èŠ‚ç‚¹æœ€å°ç©ºé—²è¿æ¥æ•°</span>
    <span class="token key atrule">slave-connection-minimum-idle-size</span><span class="token punctuation">:</span> <span class="token number">24</span>
    <span class="token comment"># ä»èŠ‚ç‚¹è¿æ¥æ± å¤§å°</span>
    <span class="token key atrule">slave-connection-pool-size</span><span class="token punctuation">:</span> <span class="token number">64</span>
    <span class="token comment"># è¿æ¥ç©ºé—²è¶…æ—¶ï¼Œå•ä½ï¼šæ¯«ç§’</span>
    <span class="token key atrule">idle-connection-timeout</span><span class="token punctuation">:</span> <span class="token number">10000</span>
    <span class="token comment"># å‘½ä»¤ç­‰å¾…è¶…æ—¶ï¼Œå•ä½ï¼šæ¯«ç§’</span>
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">3000</span>
    <span class="token comment"># å‘½ä»¤å¤±è´¥é‡è¯•æ¬¡æ•°</span>
    <span class="token key atrule">retry-attempts</span><span class="token punctuation">:</span> <span class="token number">3</span>
    <span class="token comment"># å‘½ä»¤é‡è¯•å‘é€æ—¶é—´é—´éš”ï¼Œå•ä½ï¼šæ¯«ç§’</span>
    <span class="token key atrule">retry-interval</span><span class="token punctuation">:</span> <span class="token number">1500</span>
    <span class="token comment"># å¤±è´¥ä»èŠ‚ç‚¹é‡è¿é—´éš”æ—¶é—´</span>
    <span class="token key atrule">failed-slave-reconnection-interval</span><span class="token punctuation">:</span> <span class="token number">3000</span>
    <span class="token comment"># å¤±è´¥ä»èŠ‚ç‚¹æ ¡éªŒé—´éš”æ—¶é—´</span>
    <span class="token key atrule">failed-slave-check-interval</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token comment"># å•ä¸ªè¿æ¥æœ€å¤§è®¢é˜…æ•°é‡</span>
    <span class="token key atrule">subscriptions-per-connection</span><span class="token punctuation">:</span> <span class="token number">5</span>
    <span class="token comment"># å‘å¸ƒå’Œè®¢é˜…è¿æ¥çš„æœ€å°ç©ºé—²è¿æ¥æ•°</span>
    <span class="token key atrule">subscription-connection-minimum-idle-size</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token comment"># å‘å¸ƒå’Œè®¢é˜…è¿æ¥æ± å¤§å°</span>
    <span class="token key atrule">subscription-connection-pool-size</span><span class="token punctuation">:</span> <span class="token number">50</span>
    <span class="token comment"># è¯»å–æ¨¡å¼</span>
    <span class="token key atrule">read-mode</span><span class="token punctuation">:</span> <span class="token string">"slave"</span>
    <span class="token comment"># è®¢é˜…æ¨¡å¼</span>
    <span class="token key atrule">subscription-mode</span><span class="token punctuation">:</span> <span class="token string">"master"</span>
</code></pre> 
<p>ğŸ” æ›´å¤š API æ“ä½œå‚è€ƒ Redisson å®˜ç½‘ https://github.com/redisson/redisson</p> 
<h2><a id="rainbow__Spring_Cache__Redis__699"></a>ğŸŒˆ åŸºäº Spring Cache å®ç° Redis ç¼“å­˜</h2> 
<h3><a id="taco_Spring_Cache__701"></a>ğŸŒ® Spring Cache çš„ä¾èµ–</h3> 
<p>Maven å¼•å…¥ä¾èµ–</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-cache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="taco_Spring_Cache__712"></a>ğŸŒ® Spring Cache çš„é…ç½®</h3> 
<p>åœ¨ yml æ–‡ä»¶æ·»åŠ é…ç½®</p> 
<pre><code class="prism language-yaml"><span class="token punctuation">---</span> <span class="token comment">##### spring cache é…ç½® #####</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> redis
    <span class="token key atrule">cache-names</span><span class="token punctuation">:</span> don
</code></pre> 
<p>åœ¨ä¸»å¯åŠ¨ç±»å¼€å¯æ”¯æŒ</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@EnableCaching</span>
</code></pre> 
<p>å®Œæˆé…ç½®åï¼ŒSpring Boot ä¼šè‡ªåŠ¨é…ç½®ä¸€ä¸ª RedisCacheManager çš„ç±»</p> 
<p>å‚è€ƒ <code>org.springframework.boot.autoconfigure.cache.RedisCacheConfiguration</code></p> 
<h3><a id="taco_Spring_Cache__734"></a>ğŸŒ® Spring Cache ç¼“å­˜ä½¿ç”¨</h3> 
<p>ğŸ… æ³¨è§£ <code>@Cacheable</code> ç¼“å­˜å€¼</p> 
<p>æ·»åŠ åœ¨æŸ¥è¯¢æ–¹æ³•ä¸Šï¼Œå°†æ–¹æ³•çš„è¿”å›å€¼è¿›è¡Œç¼“å­˜ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œç¼“å­˜çš„ key å°±æ˜¯æ–¹æ³•çš„å‚æ•°ï¼Œç¼“å­˜çš„ value å°±æ˜¯æ–¹æ³•çš„è¿”å›å€¼ã€‚key å¯ä»¥æ‰‹åŠ¨æŒ‡å®šï¼Œä½¿ç”¨ <code>SpEL</code> è¡¨è¾¾å¼ã€‚</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/cache/get"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>key <span class="token operator">=</span> <span class="token string">"#str"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"key {}"</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>è¯·æ±‚æ–¹æ³•ï¼ŒæŸ¥è¯¢ç¼“å­˜ä¸­æ˜¯å¦æœ‰å€¼ï¼Œæœ‰åˆ™ç›´æ¥è¿”å›ï¼Œæ— åˆ™æ‰§è¡Œæ–¹æ³•å¹¶å°†å€¼æ”¾å…¥ç¼“å­˜ã€‚</p> 
<p>ğŸ… æ³¨è§£ <code>@CachePut</code> æ›´æ–°ç¼“å­˜å€¼</p> 
<p>æ³¨è§£æ·»åŠ åœ¨æ›´æ–°æ–¹æ³•ä¸Šï¼Œå¯ä»¥å°†æ–¹æ³•çš„è¿”å›å€¼è‡ªåŠ¨æ›´æ–°åˆ°å·²ç»å­˜åœ¨çš„ key ä¸­ã€‚</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@CachePut</span><span class="token punctuation">(</span>key <span class="token operator">=</span> <span class="token string">"#str"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/cache/put"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"key {}"</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>ğŸ… æ³¨è§£ <code>@CacheEvict</code> åˆ é™¤ç¼“å­˜å€¼</p> 
<p>æ³¨è§£æ·»åŠ åœ¨åˆ é™¤æ–¹æ³•ä¸Šï¼Œä¼šå°†ç¼“å­˜ä¸­çš„å€¼åˆ é™¤ã€‚</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@CacheEvict</span><span class="token punctuation">(</span>key <span class="token operator">=</span> <span class="token string">"#str"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/cache/clear"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"key {}"</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>æ›´å¤šä½¿ç”¨ https://docs.spring.io/spring-framework/docs/5.3.27/reference/html/integration.html#cache-annotations</p> 
<h3><a id="taco__RedisCacheManager_779"></a>ğŸŒ® è‡ªå®šä¹‰é…ç½® RedisCacheManager</h3> 
<p>å¯ä»¥æ‰‹åŠ¨é…ç½® RedisCacheManagerï¼ŒæŒ‡å®šåºåˆ—åŒ–æœºåˆ¶ï¼Œç¼“å­˜æ—¶é•¿ç­‰ã€‚</p> 
<p>ç¤ºä¾‹</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">CacheManager</span> <span class="token function">redisCacheManager</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> redisConnectionFactory<span class="token punctuation">,</span> <span class="token class-name">CacheProperties</span> cacheProperties<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"DonCacheAutoConfiguration redisCacheManager init ..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> jackson2JsonRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jackson2JsonRedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">RedisSerializer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stringRedisSerializer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">ObjectMapper</span> mapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    mapper<span class="token punctuation">.</span><span class="token function">setVisibility</span><span class="token punctuation">(</span><span class="token class-name">PropertyAccessor</span><span class="token punctuation">.</span>ALL<span class="token punctuation">,</span> <span class="token class-name">JsonAutoDetect<span class="token punctuation">.</span>Visibility</span><span class="token punctuation">.</span>ANY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mapper<span class="token punctuation">.</span><span class="token function">activateDefaultTyping</span><span class="token punctuation">(</span>mapper<span class="token punctuation">.</span><span class="token function">getPolymorphicTypeValidator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ObjectMapper<span class="token punctuation">.</span>DefaultTyping</span><span class="token punctuation">.</span>NON_FINAL<span class="token punctuation">,</span> <span class="token class-name">JsonTypeInfo<span class="token punctuation">.</span>As</span><span class="token punctuation">.</span>PROPERTY<span class="token punctuation">)</span><span class="token punctuation">;</span>

    jackson2JsonRedisSerializer<span class="token punctuation">.</span><span class="token function">setObjectMapper</span><span class="token punctuation">(</span>mapper<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// é…ç½®åºåˆ—åŒ–, é»˜è®¤è¿‡æœŸæ—¶é—´10åˆ†é’Ÿ</span>
    <span class="token class-name">Duration</span> timeToLive <span class="token operator">=</span> cacheProperties<span class="token punctuation">.</span><span class="token function">getRedis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTimeToLive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">RedisCacheConfiguration</span> config <span class="token operator">=</span> <span class="token class-name">RedisCacheConfiguration</span><span class="token punctuation">.</span><span class="token function">defaultCacheConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">entryTtl</span><span class="token punctuation">(</span><span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">isNull</span><span class="token punctuation">(</span>timeToLive<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofMinutes</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">:</span> timeToLive<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">computePrefixWith</span><span class="token punctuation">(</span>name <span class="token operator">-&gt;</span> name <span class="token operator">+</span> <span class="token string">"::"</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">serializeKeysWith</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span><span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span>stringRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">serializeValuesWith</span><span class="token punctuation">(</span><span class="token class-name">RedisSerializationContext<span class="token punctuation">.</span>SerializationPair</span><span class="token punctuation">.</span><span class="token function">fromSerializer</span><span class="token punctuation">(</span>jackson2JsonRedisSerializer<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">disableCachingNullValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token class-name">RedisCacheManager</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>redisConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cacheDefaults</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">transactionAware</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>Endâ€¦</p> 
<p>https://github.com/redisson/redisson</p> 
<p>https://spring.io/projects/spring-boot</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dc45dad27a4a74a67edcbc3b35b17514/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">Java 8 List æ’åº</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c9a297d1d98d247f7f121bc8c88b0bca/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">Ansible å‚æ•°Â·å‘½ä»¤è¯´æ˜</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 èœé¸Ÿç¨‹åºå‘˜åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>