<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>《PCL点云库学习&amp;VS2010(X64)》Part 15 PCL1.72（VTK6.2.0）三角网格化（2）之泊松重构 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="《PCL点云库学习&amp;VS2010(X64)》Part 15 PCL1.72（VTK6.2.0）三角网格化（2）之泊松重构" />
<meta property="og:description" content="《PCL点云库学习&amp;VS2010(X64)》Part 15 PCL1.72（VTK6.2.0）三角网格化（2）之泊松重构
1、cpp
//点的类型的头文件 #include &lt;pcl/point_types.h&gt; //点云文件IO（pcd文件和ply文件） #include &lt;pcl/io/pcd_io.h&gt; #include &lt;pcl/io/ply_io.h&gt; //kd树 #include &lt;pcl/kdtree/kdtree_flann.h&gt; //特征提取 #include &lt;pcl/features/normal_3d_omp.h&gt; #include &lt;pcl/features/normal_3d.h&gt; //重构 #include &lt;pcl/surface/gp3.h&gt; #include &lt;pcl/surface/poisson.h&gt; //可视化 #include &lt;pcl/visualization/pcl_visualizer.h&gt; //多线程 #include &lt;boost/thread/thread.hpp&gt; #include &lt;fstream&gt; #include &lt;iostream&gt; #include &lt;stdio.h&gt; #include &lt;string.h&gt; #include &lt;string&gt; //计时 #include &lt;time.h&gt; int main(int argc, char** argv) { // 确定文件格式 char tmpStr[100]; strcpy(tmpStr, argv[1]); char* pext = strrchr(tmpStr, &#39;.&#39;); std::string extply(&#34;ply&#34;); std::string extpcd(&#34;pcd&#34;); if (pext){ *pext = &#39;\0&#39;; pext&#43;&#43;; } std::string ext(pext); //如果不支持文件格式，退出程序 if (!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/8f458850a66a59c52ba974e4518bfe91/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-07-14T20:57:39+08:00" />
<meta property="article:modified_time" content="2016-07-14T20:57:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">《PCL点云库学习&amp;VS2010(X64)》Part 15 PCL1.72（VTK6.2.0）三角网格化（2）之泊松重构</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="font-size:18px"><u>《PCL点云库学习&amp;VS2010(X64)》Part 15 PCL1.72（VTK6.2.0）三角网格化（2）之泊松重构</u></span></p> 
<p><span style="font-size:18px">1、cpp</span></p> 
<p><span style="font-size:18px"></span></p> 
<pre><code class="language-html">//点的类型的头文件
#include &lt;pcl/point_types.h&gt;
//点云文件IO（pcd文件和ply文件）
#include &lt;pcl/io/pcd_io.h&gt;
#include &lt;pcl/io/ply_io.h&gt;
//kd树
#include &lt;pcl/kdtree/kdtree_flann.h&gt;
//特征提取
#include &lt;pcl/features/normal_3d_omp.h&gt;
#include &lt;pcl/features/normal_3d.h&gt;
//重构
#include &lt;pcl/surface/gp3.h&gt;
#include &lt;pcl/surface/poisson.h&gt;
//可视化
#include &lt;pcl/visualization/pcl_visualizer.h&gt;
//多线程
#include &lt;boost/thread/thread.hpp&gt;
#include &lt;fstream&gt;
#include &lt;iostream&gt;
#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
#include &lt;string&gt;
//计时
#include &lt;time.h&gt;

int main(int argc, char** argv)
{
	// 确定文件格式
	char tmpStr[100];
	strcpy(tmpStr, argv[1]);
	char* pext = strrchr(tmpStr, '.');
	std::string extply("ply");
	std::string extpcd("pcd");
	if (pext){
		*pext = '\0';
		pext++;
	}
	std::string ext(pext);
	//如果不支持文件格式，退出程序
	if (!((ext == extply) || (ext == extpcd))){
		std::cout &lt;&lt; "文件格式不支持!" &lt;&lt; std::endl;
		std::cout &lt;&lt; "支持文件格式：*.pcd和*.ply！" &lt;&lt; std::endl;
		return(-1);
	}

	//根据文件格式选择输入方式
	pcl::PointCloud&lt;pcl::PointXYZ&gt;::Ptr cloud(new pcl::PointCloud&lt;pcl::PointXYZ&gt;); //创建点云对象指针，用于存储输入
	if (ext == extply){
		if (pcl::io::loadPLYFile(argv[1], *cloud) == -1){
			PCL_ERROR("Could not read ply file!\n");
			return -1;
		}
	}
	else{
		if (pcl::io::loadPCDFile(argv[1], *cloud) == -1){
			PCL_ERROR("Could not read pcd file!\n");
			return -1;
		}
	}
	//create a timer
	clock_t start, end;
	// 计算法向量
	pcl::PointCloud&lt;pcl::PointNormal&gt;::Ptr cloud_with_normals(new pcl::PointCloud&lt;pcl::PointNormal&gt;); //法向量点云对象指针
	pcl::NormalEstimation&lt;pcl::PointXYZ, pcl::Normal&gt; n;//法线估计对象
	pcl::PointCloud&lt;pcl::Normal&gt;::Ptr normals(new pcl::PointCloud&lt;pcl::Normal&gt;);//存储估计的法线的指针
	pcl::search::KdTree&lt;pcl::PointXYZ&gt;::Ptr tree(new pcl::search::KdTree&lt;pcl::PointXYZ&gt;);
	tree-&gt;setInputCloud(cloud);
	n.setInputCloud(cloud);
	n.setSearchMethod(tree);
	n.setKSearch(20);
	n.compute(*normals); //计算法线，结果存储在normals中

	//将点云和法线放到一起
	pcl::concatenateFields(*cloud, *normals, *cloud_with_normals);

	//创建搜索树
	pcl::search::KdTree&lt;pcl::PointNormal&gt;::Ptr tree2(new pcl::search::KdTree&lt;pcl::PointNormal&gt;);
	tree2-&gt;setInputCloud(cloud_with_normals);
	//创建Poisson对象，并设置参数
	pcl::Poisson&lt;pcl::PointNormal&gt; pn;
	pn.setConfidence(false); //是否使用法向量的大小作为置信信息。如果false，所有法向量均归一化。
	pn.setDegree(2); //设置参数degree[1,5],值越大越精细，耗时越久。
	pn.setDepth(8); //树的最大深度，求解2^d x 2^d x 2^d立方体元。由于八叉树自适应采样密度，指定值仅为最大深度。
	pn.setIsoDivide(8); //用于提取ISO等值面的算法的深度
	pn.setManifold(false); //是否添加多边形的重心，当多边形三角化时。 设置流行标志，如果设置为true，则对多边形进行细分三角话时添加重心，设置false则不添加
	pn.setOutputPolygons(false); //是否输出多边形网格（而不是三角化移动立方体的结果）
	pn.setSamplesPerNode(3.0); //设置落入一个八叉树结点中的样本点的最小数量。无噪声，[1.0-5.0],有噪声[15.-20.]平滑
	pn.setScale(1.25); //设置用于重构的立方体直径和样本边界立方体直径的比率。
	pn.setSolverDivide(8); //设置求解线性方程组的Gauss-Seidel迭代方法的深度
	//pn.setIndices();

	//设置搜索方法和输入点云
	pn.setSearchMethod(tree2);
	pn.setInputCloud(cloud_with_normals);
	//创建多变形网格，用于存储结果
	pcl::PolygonMesh mesh;
	//执行重构

	start = clock();
	pn.performReconstruction(mesh);
	end = clock();
	//print time of reconstruction 
	std::cerr &lt;&lt; (end-start)/CLOCKS_PER_SEC&lt;&lt;"s used!"&lt;&lt; std::endl;
	//保存网格图
	pcl::io::savePLYFile("result.ply", mesh);

	// 显示结果图
	boost::shared_ptr&lt;pcl::visualization::PCLVisualizer&gt; viewer(new pcl::visualization::PCLVisualizer("3D viewer"));
	viewer-&gt;setBackgroundColor(0, 0, 0);
	viewer-&gt;addPolygonMesh(mesh, "my");
	//viewer-&gt;addCoordinateSystem(1.0);//set coordinateSystem 
	viewer-&gt;initCameraParameters();

	//viewer-&gt;spin();
	while (!viewer-&gt;wasStopped()){
		viewer-&gt;spinOnce(100);
		boost::this_thread::sleep(boost::posix_time::microseconds(100000));
	}

	return 0;
}</code></pre> 
<br> 运行效果： 
<p></p> 
<p><span style="font-size:18px"><img src="https://images2.imgbox.com/f7/b6/dFZWokz1_o.png" alt=""><br> </span></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9ac61a1ee3f2e2a0eea48f041c6ea830/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">FASText(上) : Fast 角点</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0816d711292eb0a45d13ee7b85374b51/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">史上最强的Vim 配置文件（修正版）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>