<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>视觉学习笔记12——百度飞浆框架的PaddleOCR 安装、标注、训练、测试以及onnx转换 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="视觉学习笔记12——百度飞浆框架的PaddleOCR 安装、标注、训练、测试以及onnx转换" />
<meta property="og:description" content="系列文章目录 虚拟环境部署
参考博客1
参考博客2
参考博客3
参考博客4
参考博客5
参考博客6
文章目录 系列文章目录一、简单介绍1.OCR介绍2.PaddleOCR介绍 二、安装1.anaconda基础环境1）anaconda的基本操作2）搭建飞浆的基础环境 2.安装paddlepaddle-gpu版本1）安装2）验证 3.pip安装paddleocr whl包1）2.6版本的paddleocr安装2）验证 4.安装PPOCRLabel1）2.6版本paddleocr和PPOCRLabel的版本对应2）2.7版本paddleocr和PPOCRLabel的版本对应 三、PPOCRLabel标注四、PaddleOCR训练与测试1.文本检测模型训练与测试1）下载预训练模型2）修改参数配置文件3）可视化训练过程4）模型评估测试 2.文本识别模型训练1）下载预训练模型2）修改参数配置文件3）可视化训练过程4）模型评估测试 五、Paddle转换onnx1.依赖1.paddle模型转inference模型1）方法一：2）方法二： 2.inference模型转onnx模型1）转文本检测模型2）转文本识别模型3）修改ir_version版本4）测试onnx模型 六、补充 一、简单介绍 1.OCR介绍 OCR（光学字符识别）是一种将图像中的文字自动转换为可编辑文本的技术。现在，各大厂商均有提供各种场景的OCR识别的API。但是，也有一些开源的OCR框架和工具，可以支持自我定制和训练，使得开发人员能够更加灵活地应对不同场景下的OCR需求。
OCR（光学字符识别）的简单实现流程通常包括以下步骤：
1、图像预处理：首先，对输入的图像进行预处理，包括灰度化、二值化、去噪等操作。这些操作有助于提高字符识别的准确性和稳定性。
2、文本区域检测：使用图像处理技术（如边缘检测、轮廓分析等），找到图像中可能包含文本的区域。这些区域通常是字符或文本行的边界。
3、字符分割：对于文本行，需要将其分割为单个字符。这可以通过字符之间的间距、连通性等特征进行分割。
4、特征提取：对于每个字符，提取其特征表示。常见的特征包括形状、角度、纹理等。特征提取有助于将字符转化为可供分类器处理的数值表示。
5、字符分类：使用分类器（如机器学习算法或深度学习模型）对提取的字符特征进行分类，将其识别为相应的字符类别。分类器可以是预训练模型，也可以是自定义训练的模型。
6、后处理：对识别的字符进行后处理，如纠正错误、校正倾斜、去除冗余等。这可以提高最终结果的准确性和可读性。
7、输出结果：将识别的字符组合成最终的文本输出，可以是单个字符、单词或完整的文本。
2.PaddleOCR介绍 飞桨首次开源文字识别模型套件PaddleOCR，目标是打造丰富、领先、实用的文本识别模型/工具库。 PaddleOCR是一个基于飞桨开发的OCR（Optical Character Recognition，光学字符识别）系统。其技术体系包括文字检测、文字识别、文本方向检测和图像处理等模块。以下是其优点：
高精度：PaddleOCR采用深度学习算法进行训练，可以在不同场景下实现高精度的文字检测和文字识别。
多语种支持：PaddleOCR支持多种语言的文字识别，包括中文、英文、日语、韩语等。同时，它还支持多种不同文字类型的识别，如手写字、印刷体、表格等。
高效性：PaddleOCR的训练和推理过程都采用了高效的并行计算方法，可大幅提高处理速度。同时，其轻量化设计也使得PaddleOCR能够在移动设备上进行部署，适用于各种场景的应用。
易用性：PaddleOCR提供了丰富的API接口和文档说明，用户可以快速进行模型集成和部署，实现自定义的OCR功能。同时，其开源代码也为用户提供了更好的灵活性和可扩展性。
鲁棒性：PaddleOCR采用了多种数据增强技术和模型融合策略，能够有效地应对图像噪声、光照变化等干扰因素，并提高模型的鲁棒性和稳定性。
总之，PaddleOCR具有高精度、高效性、易用性和鲁棒性等优点，为用户提供了一个强大的OCR解决方案。
对比其他开源的OCR项目：
优点：
轻量模型，执行速度快
支持pip直接安装
ocr识别效果好，效果基本可以比肩大厂收费ocr（非高精版）
支持表格和方向识别
支持补充训练且很方便
缺点：
部分符号识别效果一般，如 &#39;|‘识别为’1’
对于部分加粗字体可能出现误识别，需要自己补充训练
偶尔会出现部分内容丢失的情况
二、安装 1.anaconda基础环境 1）anaconda的基本操作 查看conda环境： conda info --envs 创建虚拟环境 conda create -n your_env_name python=x.x 激活或者切换虚拟环境 source activate your_env_nam 查看虚拟环境中的库 conda list 关闭虚拟环境 source deactivate 删除虚拟环境 conda remove -n your_env_name --all 2）搭建飞浆的基础环境 因为是新项目，所以专门使用anaconda搭建该项目的基本环境" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0716033dd76d074c0c9d22869086d91c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-29T14:57:36+08:00" />
<meta property="article:modified_time" content="2023-12-29T14:57:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">视觉学习笔记12——百度飞浆框架的PaddleOCR 安装、标注、训练、测试以及onnx转换</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>系列文章目录</h2> 
<p><a href="https://blog.csdn.net/qq_45848817/article/details/117987514?spm=1001.2014.3001.5501">虚拟环境部署</a><br> <a href="https://blog.csdn.net/wy8grw08/article/details/131157373?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170148728416800211553768%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=170148728416800211553768&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~times_rank-3-131157373-null-null.142%5Ev96%5Epc_search_result_base7&amp;utm_term=paddleocr%E8%AE%AD%E7%BB%83%E8%87%AA%E5%B7%B1%E7%9A%84%E6%95%B0%E6%8D%AE&amp;spm=1018.2226.3001.4187">参考博客1</a><br> <a href="https://blog.csdn.net/bugang4663/article/details/131720149?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170182853016800182145377%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=170182853016800182145377&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~times_rank-7-131720149-null-null.142%5Ev96%5Epc_search_result_base7&amp;utm_term=OCR&amp;spm=1018.2226.3001.4187">参考博客2</a><br> <a href="https://blog.csdn.net/mtl1994/article/details/124010682?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170148665616800211581017%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=170148665616800211581017&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~times_rank-10-124010682-null-null.142%5Ev96%5Epc_search_result_base7&amp;utm_term=paddleocr%20%E8%AE%AD%E7%BB%83&amp;spm=1018.2226.3001.4187">参考博客3</a><br> <a href="https://blog.csdn.net/m0_49710816/article/details/134260170?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170191393716777224499982%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=170191393716777224499982&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~times_rank-1-134260170-null-null.142%5Ev96%5Epc_search_result_base7&amp;utm_term=PaddleOCR%20%E8%AE%AD%E7%BB%83&amp;spm=1018.2226.3001.4187">参考博客4</a><br> <a href="https://blog.csdn.net/weixin_44898889/article/details/119566020">参考博客5</a><br> <a href="https://blog.csdn.net/weixin_42108183/article/details/128884666">参考博客6</a></p> 
<hr> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_0" rel="nofollow">系列文章目录</a></li><li><a href="#_16" rel="nofollow">一、简单介绍</a></li><li><ul><li><a href="#1OCR_17" rel="nofollow">1.OCR介绍</a></li><li><a href="#2PaddleOCR_34" rel="nofollow">2.PaddleOCR介绍</a></li></ul> 
  </li><li><a href="#_64" rel="nofollow">二、安装</a></li><li><ul><li><a href="#1anaconda_65" rel="nofollow">1.anaconda基础环境</a></li><li><ul><li><a href="#1anaconda_66" rel="nofollow">1）anaconda的基本操作</a></li><li><a href="#2_87" rel="nofollow">2）搭建飞浆的基础环境</a></li></ul> 
   </li><li><a href="#2paddlepaddlegpu_102" rel="nofollow">2.安装paddlepaddle-gpu版本</a></li><li><ul><li><a href="#1_103" rel="nofollow">1）安装</a></li><li><a href="#2_117" rel="nofollow">2）验证</a></li></ul> 
   </li><li><a href="#3pippaddleocr_whl_130" rel="nofollow">3.pip安装paddleocr whl包</a></li><li><ul><li><a href="#126paddleocr_132" rel="nofollow">1）2.6版本的paddleocr安装</a></li><li><a href="#2_157" rel="nofollow">2）验证</a></li></ul> 
   </li><li><a href="#4PPOCRLabel_235" rel="nofollow">4.安装PPOCRLabel</a></li><li><ul><li><a href="#126paddleocrPPOCRLabel_236" rel="nofollow">1）2.6版本paddleocr和PPOCRLabel的版本对应</a></li><li><a href="#227paddleocrPPOCRLabel_341" rel="nofollow">2）2.7版本paddleocr和PPOCRLabel的版本对应</a></li></ul> 
  </li></ul> 
  </li><li><a href="#PPOCRLabel_428" rel="nofollow">三、PPOCRLabel标注</a></li><li><a href="#PaddleOCR_502" rel="nofollow">四、PaddleOCR训练与测试</a></li><li><ul><li><a href="#1_506" rel="nofollow">1.文本检测模型训练与测试</a></li><li><ul><li><a href="#1_510" rel="nofollow">1）下载预训练模型</a></li><li><a href="#2_528" rel="nofollow">2）修改参数配置文件</a></li><li><a href="#3_550" rel="nofollow">3）可视化训练过程</a></li><li><a href="#4_564" rel="nofollow">4）模型评估测试</a></li></ul> 
   </li><li><a href="#2_619" rel="nofollow">2.文本识别模型训练</a></li><li><ul><li><a href="#1_625" rel="nofollow">1）下载预训练模型</a></li><li><a href="#2_646" rel="nofollow">2）修改参数配置文件</a></li><li><a href="#3_670" rel="nofollow">3）可视化训练过程</a></li><li><a href="#4_685" rel="nofollow">4）模型评估测试</a></li></ul> 
  </li></ul> 
  </li><li><a href="#Paddleonnx_739" rel="nofollow">五、Paddle转换onnx</a></li><li><ul><li><a href="#1_741" rel="nofollow">1.依赖</a></li><li><a href="#1paddleinference_755" rel="nofollow">1.paddle模型转inference模型</a></li><li><ul><li><a href="#1_759" rel="nofollow">1）方法一：</a></li><li><a href="#2_777" rel="nofollow">2）方法二：</a></li></ul> 
   </li><li><a href="#2inferenceonnx_786" rel="nofollow">2.inference模型转onnx模型</a></li><li><ul><li><a href="#1_790" rel="nofollow">1）转文本检测模型</a></li><li><a href="#2_813" rel="nofollow">2）转文本识别模型</a></li><li><a href="#3ir_version_834" rel="nofollow">3）修改ir_version版本</a></li><li><a href="#4onnx_856" rel="nofollow">4）测试onnx模型</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_902" rel="nofollow">六、补充</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_16"></a>一、简单介绍</h2> 
<h3><a id="1OCR_17"></a>1.OCR介绍</h3> 
<p>OCR（光学字符识别）是一种将图像中的文字自动转换为可编辑文本的技术。现在，各大厂商均有提供各种场景的OCR识别的API。但是，也有一些开源的OCR框架和工具，可以支持自我定制和训练，使得开发人员能够更加灵活地应对不同场景下的OCR需求。</p> 
<p>OCR（光学字符识别）的简单实现流程通常包括以下步骤：</p> 
<blockquote> 
 <p>1、图像预处理：首先，对输入的图像进行预处理，包括灰度化、二值化、去噪等操作。这些操作有助于提高字符识别的准确性和稳定性。<br> 2、文本区域检测：使用图像处理技术（如边缘检测、轮廓分析等），找到图像中可能包含文本的区域。这些区域通常是字符或文本行的边界。<br> 3、字符分割：对于文本行，需要将其分割为单个字符。这可以通过字符之间的间距、连通性等特征进行分割。<br> 4、特征提取：对于每个字符，提取其特征表示。常见的特征包括形状、角度、纹理等。特征提取有助于将字符转化为可供分类器处理的数值表示。<br> 5、字符分类：使用分类器（如机器学习算法或深度学习模型）对提取的字符特征进行分类，将其识别为相应的字符类别。分类器可以是预训练模型，也可以是自定义训练的模型。<br> 6、后处理：对识别的字符进行后处理，如纠正错误、校正倾斜、去除冗余等。这可以提高最终结果的准确性和可读性。<br> 7、输出结果：将识别的字符组合成最终的文本输出，可以是单个字符、单词或完整的文本。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/5d/e0/bA8dwkVP_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2PaddleOCR_34"></a>2.PaddleOCR介绍</h3> 
<p>飞桨首次开源文字识别模型套件PaddleOCR，目标是打造丰富、领先、实用的文本识别模型/工具库。 PaddleOCR是一个基于飞桨开发的OCR（Optical Character Recognition，光学字符识别）系统。其技术体系包括文字检测、文字识别、文本方向检测和图像处理等模块。以下是其优点：</p> 
<p>高精度：PaddleOCR采用深度学习算法进行训练，可以在不同场景下实现高精度的文字检测和文字识别。</p> 
<p>多语种支持：PaddleOCR支持多种语言的文字识别，包括中文、英文、日语、韩语等。同时，它还支持多种不同文字类型的识别，如手写字、印刷体、表格等。</p> 
<p>高效性：PaddleOCR的训练和推理过程都采用了高效的并行计算方法，可大幅提高处理速度。同时，其轻量化设计也使得PaddleOCR能够在移动设备上进行部署，适用于各种场景的应用。</p> 
<p>易用性：PaddleOCR提供了丰富的API接口和文档说明，用户可以快速进行模型集成和部署，实现自定义的OCR功能。同时，其开源代码也为用户提供了更好的灵活性和可扩展性。</p> 
<p>鲁棒性：PaddleOCR采用了多种数据增强技术和模型融合策略，能够有效地应对图像噪声、光照变化等干扰因素，并提高模型的鲁棒性和稳定性。</p> 
<p>总之，PaddleOCR具有高精度、高效性、易用性和鲁棒性等优点，为用户提供了一个强大的OCR解决方案。</p> 
<p><a href="https://blog.csdn.net/bugang4663/article/details/131720149?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522170182853016800182145377%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=170182853016800182145377&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~times_rank-7-131720149-null-null.142%5Ev96%5Epc_search_result_base7&amp;utm_term=OCR&amp;spm=1018.2226.3001.4187">对比其他开源的OCR项目：</a></p> 
<p>优点：<br> 轻量模型，执行速度快<br> 支持pip直接安装<br> ocr识别效果好，效果基本可以比肩大厂收费ocr（非高精版）<br> 支持表格和方向识别<br> 支持补充训练且很方便</p> 
<p>缺点：<br> 部分符号识别效果一般，如 '|‘识别为’1’<br> 对于部分加粗字体可能出现误识别，需要自己补充训练<br> 偶尔会出现部分内容丢失的情况</p> 
<h2><a id="_64"></a>二、安装</h2> 
<h3><a id="1anaconda_65"></a>1.anaconda基础环境</h3> 
<h4><a id="1anaconda_66"></a>1）anaconda的基本操作</h4> 
<pre><code class="prism language-bash">查看conda环境：
conda info <span class="token parameter variable">--envs</span>

创建虚拟环境
conda create <span class="token parameter variable">-n</span> your_env_name <span class="token assign-left variable">python</span><span class="token operator">=</span>x.x

激活或者切换虚拟环境
 <span class="token builtin class-name">source</span> activate your_env_nam

 查看虚拟环境中的库
 conda list

关闭虚拟环境
<span class="token builtin class-name">source</span> deactivate 

删除虚拟环境
conda remove <span class="token parameter variable">-n</span> your_env_name <span class="token parameter variable">--all</span>
</code></pre> 
<h4><a id="2_87"></a>2）搭建飞浆的基础环境</h4> 
<p>因为是新项目，所以专门使用anaconda搭建该项目的基本环境<br> 使用anaconda的环境复制命令，复制一个已经安装好常用库的虚拟环境，这样就可以省下重新安装大部分库的工作了，可以参考<a href="https://blog.csdn.net/qq_45848817/article/details/117987514?spm=1001.2014.3001.5501">虚拟环境部署</a></p> 
<pre><code class="prism language-bash">假设已有环境名为A，需要生成的环境名为B：（我自己用过，在同一台机器上克隆原始环境到另一个环境，挺好用的）
conda create <span class="token parameter variable">-n</span> B <span class="token parameter variable">--clone</span> A

比如：
conda create <span class="token parameter variable">-n</span> ocr <span class="token parameter variable">--clone</span> py36
</code></pre> 
<h3><a id="2paddlepaddlegpu_102"></a>2.安装paddlepaddle-gpu版本</h3> 
<h4><a id="1_103"></a>1）安装</h4> 
<p>进入准备好的anaconda环境<br> 根据对应的cuda和cudnn版本，安装对应的paddlepaddle版本<br> 建议不要安装最新的paddlepaddle版本，我安装最新的一直失败<br> <a href="https://www.paddlepaddle.org.cn/install/old?docurl=/documentation/docs/zh/install/pip/windows-pip.html" rel="nofollow">飞浆官网提供的旧版本安装命令</a></p> 
<p>一定要根据自己的环境，选择正确的命令，比如：</p> 
<pre><code class="prism language-bash"><span class="token comment"># CUDA 10.2</span>
python3 <span class="token parameter variable">-m</span> pip <span class="token function">install</span> paddlepaddle-gpu<span class="token operator">==</span><span class="token number">2.4</span>.2 <span class="token parameter variable">-i</span> https://pypi.tuna.tsinghua.edu.cn/simple
</code></pre> 
<h4><a id="2_117"></a>2）验证</h4> 
<p>验证安装是否成功，终端输入python，然后分别输入以下两行代码</p> 
<pre><code class="prism language-bash"><span class="token function">import</span> paddle
 
paddle.utils.run_check<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f2/7c/5axuVlyX_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3pippaddleocr_whl_130"></a>3.pip安装paddleocr whl包</h3> 
<h4><a id="126paddleocr_132"></a>1）2.6版本的paddleocr安装</h4> 
<p>推荐使用2.0.1+版本，最新版本为2.7，我选择2.6版本，但是2.6版本的paddleocr和PPOCRLabel之间出现一些未解决环境bug，所以关于2.6版本的paddleocr安装仅供参考，安装命令如下：</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> <span class="token string">"paddleocr&gt;=2.6"</span>
</code></pre> 
<p>使用了以上命令安装却出现PyMuPDF错误，如下：</p> 
<pre><code class="prism language-bash"> Building wheel <span class="token keyword">for</span> PyMuPDF <span class="token punctuation">(</span>setup.py<span class="token punctuation">)</span> <span class="token punctuation">..</span>. error
 <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
 <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
 <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>
 ERROR: Failed building wheel <span class="token keyword">for</span> PyMuPDF
</code></pre> 
<p><a href="https://github.com/PaddlePaddle/PaddleOCR/issues/7934">github查到具体解决方案</a></p> 
<p>使用如下命令重新安装：</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> <span class="token string">"paddleocr&gt;=2.6"</span> <span class="token parameter variable">--upgrade</span> <span class="token assign-left variable">PyMuPDF</span><span class="token operator">==</span><span class="token number">1.18</span>.0
</code></pre> 
<h4><a id="2_157"></a>2）验证</h4> 
<p>首先使用以下命令查看虚拟环境中的paddleocr是不是2.6版本：</p> 
<pre><code class="prism language-bash">conda list
</code></pre> 
<p>其次下载以下官方提供的推理测试模型进行测试：</p> 
<p><a href="https://paddleocr.bj.bcebos.com/PP-OCRv4/chinese/ch_PP-OCRv4_det_infer.tar" rel="nofollow">det_model_dir是文本检测的位置，</a></p> 
<p><a href="https://paddleocr.bj.bcebos.com/PP-OCRv4/chinese/ch_PP-OCRv4_rec_infer.tar" rel="nofollow">rec_model_dir是文本识别的位置，</a></p> 
<p><a href="https://paddleocr.bj.bcebos.com/dygraph_v2.0/ch/ch_ppocr_mobile_v2.0_cls_infer.tar" rel="nofollow">cls_model_dir是方向分类的位置，</a></p> 
<p>最后使用以下代码，更新模型与图片路径进行测试：</p> 
<pre><code class="prism language-bash"><span class="token function">import</span> os
<span class="token function">import</span> <span class="token function">time</span>

from paddleocr <span class="token function">import</span> PaddleOCR
<span class="token function">import</span> pandas as pd
<span class="token function">import</span> numpy as np
<span class="token function">import</span> cv2


def ocr_predict<span class="token punctuation">(</span>img<span class="token punctuation">)</span>:
    <span class="token string">''</span>'
    det_model_dir:文本检测
    rec_model_dir:文本识别
    cls_model_dir:方向分类
    <span class="token string">''</span>'
    ocr <span class="token operator">=</span> PaddleOCR<span class="token punctuation">(</span>det_model_dir<span class="token operator">=</span><span class="token string">"路径/det/ch/ch_PP-OCRv4_det_infer/"</span>,
                    <span class="token assign-left variable">rec_model_dir</span><span class="token operator">=</span><span class="token string">"路径/rec/ch/ch_PP-OCRv4_rec_infer/"</span>,
                    <span class="token assign-left variable">cls_model_dir</span><span class="token operator">=</span><span class="token string">"路径/cls/ch_ppocr_mobile_v2.0_cls_infer/"</span>,
                    <span class="token assign-left variable">lang</span><span class="token operator">=</span><span class="token string">'ch'</span>, <span class="token assign-left variable">use_angle_cls</span><span class="token operator">=</span>True,
                    <span class="token assign-left variable">use_gpu</span><span class="token operator">=</span>False<span class="token punctuation">)</span>
    result <span class="token operator">=</span> ocr.ocr<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    print<span class="token punctuation">(</span>result<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token builtin class-name">:</span>
    img_path <span class="token operator">=</span> <span class="token string">"路径/ys.jpeg"</span>
    ocr_predict<span class="token punctuation">(</span>img_path<span class="token punctuation">)</span>
</code></pre> 
<p>测试图片：</p> 
<p><img src="https://images2.imgbox.com/c5/60/CsI4Y6Qf_o.jpg" alt="在这里插入图片描述" width="600"></p> 
<p>测试结果：</p> 
<blockquote> 
 <p>[[[[[57.0, 31.0], [977.0, 32.0], [977.0, 75.0], [57.0, 74.0]],<br> (‘椰树集团直接从椰子农户收购海南自种老椰子’, 0.98974609375)], [[[54.0, 93.0], [976.0,<br> 95.0], [976.0, 138.0], [54.0, 136.0]], (‘每个致富价五元，比原来收购价提高两倍’, 0.994292140007019)], [[[172.0, 163.0], [855.0, 163.0], [855.0, 205.0], [172.0, 205.0]], (‘转手收购的椰子不享受致富价’, 0.9931609630584717)], [[[61.0,<br> 230.0], [961.0, 230.0], [961.0, 309.0], [61.0, 309.0]], (‘致富价保证30年不降’, 0.9948785901069641)], [[[128.0, 341.0], [985.0, 341.0], [985.0, 380.0], [128.0, 380.0]], (‘为助力乡村经济振兴，响应省政府大力发展’, 0.9951123595237732)], [[[35.0, 394.0], [745.0, 394.0], [745.0, 437.0], [35.0, 437.0]],<br> (‘三棵树（椰子树、橡胶树、槟榔树）’, 0.9626081585884094)], [[[757.0, 396.0], [983.0,<br> 396.0], [983.0, 436.0], [757.0, 436.0]], (‘的号召，让’, 0.9951451420783997)], [[[37.0, 451.0], [982.0, 451.0], [982.0, 490.0], [37.0, 490.0]], (‘农民致富，实现椰树集团年产值百亿元，打造’, 0.9915739893913269)],<br> [[[80.0, 507.0], [980.0, 507.0], [980.0, 546.0], [80.0, 546.0]],<br> (‘百年椰树”，决定从2021年7月10日开始按’, 0.981215238571167)], [[[33.0, 558.0],<br> [692.0, 562.0], [692.0, 604.0], [33.0, 601.0]], (‘致富价收购海南农民自种老椰子。’,<br> 0.992202877998352)], [[[35.0, 629.0], [526.0, 629.0], [526.0, 654.0], [35.0, 654.0]], (‘四组收购地址：文昌市东郊镇码头村码头路113号’, 0.9902203679084778)],<br> [[[754.0, 630.0], [983.0, 630.0], [983.0, 652.0], [754.0, 652.0]],<br> (‘收购电话：13322039539’, 0.9966092109680176)], [[[35.0, 667.0], [327.0,<br> 667.0], [327.0, 692.0], [35.0, 692.0]], (‘六组收购地址：琼海市合石村’, 0.99151611328125)], [[[754.0, 666.0], [985.0, 666.0], [985.0, 691.0], [754.0, 691.0]], (‘收购电话：13627592295’, 0.9962812662124634)], [[[35.0,<br> 705.0], [562.0, 705.0], [562.0, 730.0], [35.0, 730.0]], (‘八组收购地址：文昌市东郊镇、万宁市长丰镇牛漏村’, 0.980197548866272)], [[[753.0, 704.0],<br> [983.0, 704.0], [983.0, 729.0], [753.0, 729.0]], (‘收购电话：13876033357’,<br> 0.9965571165084839)], [[[34.0, 742.0], [398.0, 742.0], [398.0, 767.0], [34.0, 767.0]], (‘九组收购地址：文昌市东郊镇白石村’, 0.993116557598114)], [[[754.0,<br> 743.0], [983.0, 743.0], [983.0, 765.0], [754.0, 765.0]], (‘收购电话：13976682778’, 0.9968530535697937)], [[[187.0, 780.0], [396.0,<br> 780.0], [396.0, 805.0], [187.0, 805.0]], (‘文昌市会文镇冠南村’, 0.9976257681846619)], [[[753.0, 780.0], [986.0, 780.0], [986.0, 805.0], [753.0, 805.0]], (‘收购电话：18789985540’, 0.9975140690803528)], [[[35.0, 817.0], [727.0, 818.0], [727.0, 843.0], [35.0, 842.0]],<br> (‘十组收购地址：文昌市蓬莱镇绿涛收购点、琼海市塔洋镇里文收购点’, 0.9777908325195312)], [[[754.0,<br> 819.0], [983.0, 819.0], [983.0, 841.0], [754.0, 841.0]], (‘收购电话：13907682168’, 0.9975283741950989)], [[[37.0, 856.0], [444.0,<br> 856.0], [444.0, 881.0], [37.0, 881.0]], (‘十一组收购地址：文昌市铺前镇、万宁市’, 0.9792234897613525)], [[[753.0, 855.0], [982.0, 855.0], [982.0, 880.0], [753.0, 880.0]], (‘收购电话：13707557555’, 0.9971356987953186)]]]</p> 
</blockquote> 
<h3><a id="4PPOCRLabel_235"></a>4.安装PPOCRLabel</h3> 
<h4><a id="126paddleocrPPOCRLabel_236"></a>1）2.6版本paddleocr和PPOCRLabel的版本对应</h4> 
<p>以上完成了paddlepaddle和paddleocr的安装，并成功通过测试</p> 
<p>接下来应该完成PPOCRLabel标注工具的安装与使用</p> 
<p>打开<a href="https://github.com/PaddlePaddle/PaddleOCR">paddleocr库</a>选择2.6版本下载并解压<br> https://github.com/PaddlePaddle/PaddleOCR/archive/refs/heads/release/2.6.zip</p> 
<p>接着直接进入PPOCRLabel文件夹：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> PaddleOCR-release-2.6/PPOCRLabel
</code></pre> 
<p>安装PPOCRLabel，为标注数据作准备，运行以下代码：</p> 
<pre><code class="prism language-bash">python setup.py bdist_wheel
</code></pre> 
<p>该目录下dist文件夹中会生成一个whl文件<br> 接着运行：</p> 
<pre><code class="prism language-bash">pip3 <span class="token function">install</span> dist/PPOCRLabel-2.1.3-py2.py3-none-any.whl
</code></pre> 
<p>可能会提示缺少polygon 库，可以使用<code>pip install Polygon3 -i https://pypi.tuna.tsinghua.edu.cn/simple</code>命令安装。</p> 
<p>如果还提示缺少其他包，同样是用<code>pip install “packname” -i https://pypi.tuna.tsinghua.edu.cn/simple</code>命令安装即可。</p> 
<p>安装过程可能会出现的报错：</p> 
<pre><code class="prism language-bash"><span class="token comment">#无法导入str2int_tuple</span>
ImportError: cannot <span class="token function">import</span> name <span class="token string">'str2int_tuple'</span>
</code></pre> 
<p>/anaconda3/envs/ocr/lib/python3.6/site-packages/paddleocr/tools/infer<br> 目录下的utility.py文件内部缺少str2int_tuple函数，是因为源码安装与命令行安装的paddleocr所导致的，根据源码的utility.py文件去修改虚拟环境下的utility.py文件即可，主要进行以下修改：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 查找str2bool函数</span>
def str2bool<span class="token punctuation">(</span>v<span class="token punctuation">)</span>:
    <span class="token builtin class-name">return</span> v.lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">"true"</span>, <span class="token string">"yes"</span>, <span class="token string">"t"</span>, <span class="token string">"y"</span>, <span class="token string">"1"</span><span class="token punctuation">)</span>

<span class="token comment">#在str2bool函数后面添加str2int_tuple函数</span>
def str2int_tuple<span class="token punctuation">(</span>v<span class="token punctuation">)</span>:
    <span class="token builtin class-name">return</span> tuple<span class="token punctuation">(</span><span class="token punctuation">[</span>int<span class="token punctuation">(</span>i.strip<span class="token punctuation">(</span><span class="token punctuation">))</span> <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> v.split<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>PPOCRLabel安装成功后，运行以下命令打开：</p> 
<pre><code class="prism language-bash">python PPOCRLabel <span class="token parameter variable">--lang</span> ch
或
PPOCRLabel <span class="token parameter variable">--lang</span> ch
</code></pre> 
<p>在尝试打开PPOCRLabel时，出现了一个bug：</p> 
<pre><code class="prism language-bash">Got keys from plugin meta data <span class="token punctuation">(</span><span class="token string">"xcb"</span><span class="token punctuation">)</span>
QFactoryLoader::QFactoryLoader<span class="token punctuation">(</span><span class="token punctuation">)</span> checking directory path <span class="token string">"/anaconda3/envs/ocr/bin/platforms"</span> <span class="token punctuation">..</span>.
loaded library <span class="token string">"/anaconda3/envs/ocr/lib/python3.8/site-packages/cv2/qt/plugins/platforms/libqxcb.so"</span>
QObject::moveToThread: Current thread <span class="token punctuation">(</span>0xeb24e0<span class="token punctuation">)</span> is not the object's thread <span class="token punctuation">(</span>0x5bcd480<span class="token punctuation">)</span>.
Cannot move to target thread <span class="token punctuation">(</span>0xeb24e0<span class="token punctuation">)</span>

qt.qpa.plugin: Could not load the Qt platform plugin <span class="token string">"xcb"</span> <span class="token keyword">in</span> <span class="token string">"/anaconda3/envs/ocr/lib/python3.8/site-packages/cv2/qt/plugins"</span> even though it was found.
This application failed to start because no Qt platform plugin could be initialized. Reinstalling the application may fix this problem.

Available platform plugins are: xcb, eglfs, linuxfb, minimal, minimalegl, offscreen, vnc, wayland-egl, wayland, wayland-xcomposite-egl, wayland-xcomposite-glx, webgl.
</code></pre> 
<p>这是一个QT问题，很多人都遇见这个问题，常见的解决方法如下：</p> 
<pre><code class="prism language-bash"><span class="token number">1</span>、添加bashrc环境export <span class="token assign-left variable">QT_DEBUG_PLUGINS</span><span class="token operator">=</span><span class="token number">1</span>，查看是否缺少某些库文件，sudo <span class="token function">apt-get</span> <span class="token function">install</span> 安装补充
<span class="token number">2</span>、降低opencv-contrib-python和opencv-python的版本
<span class="token number">3</span>、调整pyqt5的版本或者使用conda安装不使用pip安装pyqt5
<span class="token number">4</span>、安装opencv-python-headless库
。。。。。。
</code></pre> 
<p>我遇到的这个这个问题其实是pyqt5与cv2之间的冲突问题，pyqt5与anaconda3/envs/ocr/lib/python3.8/site-packages/cv2/qt/plugins/platforms发生了冲突，，以上的方法大多数也是倾向于解决掉cv2中的platforms。</p> 
<p>官方提供的思路如下：</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> opencv-python<span class="token operator">==</span><span class="token number">4.2</span>.0.32 <span class="token parameter variable">-i</span> https://pypi.tuna.tsinghua.edu.cn/simple
</code></pre> 
<p>如果不想修改cv版本，那么就去把anaconda3/envs/ocr/lib/python3.8/site-packages/cv2/qt/plugins/platforms中的platforms重命名即可。</p> 
<p>按理来说到这里就没有问题了，但是我在启动PPOCRLabel时又出现以下报错而且打不开PPOCRLabel，至今没有解决：</p> 
<pre><code class="prism language-bash">Got keys from plugin meta data <span class="token punctuation">(</span><span class="token string">"xcb_glx"</span><span class="token punctuation">)</span>
QFactoryLoader::QFactoryLoader<span class="token punctuation">(</span><span class="token punctuation">)</span> checking directory path <span class="token string">"/anaconda3/envs/ocr/bin/xcbglintegrations"</span> <span class="token punctuation">..</span>.
loaded library <span class="token string">"/anaconda3/envs/ocr/lib/python3.8/site-packages/PyQt5/Qt5/plugins/xcbglintegrations/libqxcb-glx-integration.so"</span>
<span class="token punctuation">[</span><span class="token number">2023</span>/12/06 09:42:12<span class="token punctuation">]</span> ppocr WARNING: When args.layout is false, args.ocr is automatically <span class="token builtin class-name">set</span> to <span class="token boolean">false</span>
</code></pre> 
<p>折腾了几天后，觉得是2.6版本paddleocr和PPOCRLabel之间的bug导致的，因为使用2.7版本就能够打开PPOCRLabel。</p> 
<h4><a id="227paddleocrPPOCRLabel_341"></a>2）2.7版本paddleocr和PPOCRLabel的版本对应</h4> 
<p>最新版本2.7，安装命令如下：</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> <span class="token string">"paddleocr==2.7"</span>
</code></pre> 
<p>与2.6版本的PPOCRLabel源码安装类似</p> 
<p>打开<a href="https://github.com/PaddlePaddle/PaddleOCR">paddleocr库</a>选择2.7版本下载并解压</p> 
<p>接着直接进入PPOCRLabel文件夹：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> PaddleOCR-release-2.7/PPOCRLabel
</code></pre> 
<p>安装PPOCRLabel，为标注数据作准备，运行以下代码：</p> 
<pre><code class="prism language-bash">python setup.py bdist_wheel
</code></pre> 
<p>该目录下dist文件夹中会生成一个whl文件<br> 接着运行：</p> 
<pre><code class="prism language-bash"><span class="token comment">#这里就有一些不同</span>
pip3 <span class="token function">install</span> dist/paddleocr-2.7.0.1-py3-none-any.whl
</code></pre> 
<p>可能会提示缺少polygon 库，可以使用<code>pip install Polygon3 -i https://pypi.tuna.tsinghua.edu.cn/simple</code>命令安装。</p> 
<p>如果还提示缺少其他包，同样是用<code>pip install “packname” -i https://pypi.tuna.tsinghua.edu.cn/simple</code>命令安装即可。</p> 
<p>PPOCRLabel安装成功后，运行以下命令打开：</p> 
<pre><code class="prism language-bash">python PPOCRLabel <span class="token parameter variable">--lang</span> ch
或
PPOCRLabel <span class="token parameter variable">--lang</span> ch
</code></pre> 
<p>在尝试打开PPOCRLabel时，同样出现bug：</p> 
<pre><code class="prism language-bash">Got keys from plugin meta data <span class="token punctuation">(</span><span class="token string">"xcb"</span><span class="token punctuation">)</span>
QFactoryLoader::QFactoryLoader<span class="token punctuation">(</span><span class="token punctuation">)</span> checking directory path <span class="token string">"/anaconda3/envs/ocr/bin/platforms"</span> <span class="token punctuation">..</span>.
loaded library <span class="token string">"/anaconda3/envs/ocr/lib/python3.8/site-packages/cv2/qt/plugins/platforms/libqxcb.so"</span>
QObject::moveToThread: Current thread <span class="token punctuation">(</span>0xeb24e0<span class="token punctuation">)</span> is not the object's thread <span class="token punctuation">(</span>0x5bcd480<span class="token punctuation">)</span>.
Cannot move to target thread <span class="token punctuation">(</span>0xeb24e0<span class="token punctuation">)</span>

qt.qpa.plugin: Could not load the Qt platform plugin <span class="token string">"xcb"</span> <span class="token keyword">in</span> <span class="token string">"/anaconda3/envs/ocr/lib/python3.8/site-packages/cv2/qt/plugins"</span> even though it was found.
This application failed to start because no Qt platform plugin could be initialized. Reinstalling the application may fix this problem.

Available platform plugins are: xcb, eglfs, linuxfb, minimal, minimalegl, offscreen, vnc, wayland-egl, wayland, wayland-xcomposite-egl, wayland-xcomposite-glx, webgl.
</code></pre> 
<p>官方提供的思路如下：</p> 
<pre><code class="prism language-bash">pip <span class="token function">install</span> opencv-python<span class="token operator">==</span><span class="token number">4.2</span>.0.32 <span class="token parameter variable">-i</span> https://pypi.tuna.tsinghua.edu.cn/simple
</code></pre> 
<p>如果不想修改cv版本，那么就去把anaconda3/envs/ocr/lib/python3.8/site-packages/cv2/qt/plugins/platforms中的platforms重命名即可。</p> 
<p>启动PPOCRLabel<code>PPOCRLabel --lang ch</code>又出现以下报错：</p> 
<pre><code class="prism language-bash">Got keys from plugin meta data <span class="token punctuation">(</span><span class="token string">"xcb_glx"</span><span class="token punctuation">)</span>
QFactoryLoader::QFactoryLoader<span class="token punctuation">(</span><span class="token punctuation">)</span> checking directory path <span class="token string">"/anaconda3/envs/ocr/bin/xcbglintegrations"</span> <span class="token punctuation">..</span>.
loaded library <span class="token string">"/anaconda3/envs/ocr/lib/python3.8/site-packages/PyQt5/Qt5/plugins/xcbglintegrations/libqxcb-glx-integration.so"</span>
<span class="token punctuation">[</span><span class="token number">2023</span>/12/06 09:42:12<span class="token punctuation">]</span> ppocr WARNING: When args.layout is false, args.ocr is automatically <span class="token builtin class-name">set</span> to <span class="token boolean">false</span>
</code></pre> 
<p>但是PPOCRLabel却能够成功开启。<br> <img src="https://images2.imgbox.com/45/63/TFTS45h1_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="PPOCRLabel_428"></a>三、PPOCRLabel标注</h2> 
<p>1）先命令行打开<strong>PPOCRLabel图形化界面</strong></p> 
<p>2）打开左上角的<strong>PaddleOCR</strong>选项列表，点击<strong>选择模型</strong>选项，然后选择<strong>中文&amp;英文</strong>，确认<br> <img src="https://images2.imgbox.com/c1/87/c3OqvG3J_o.png" alt="在这里插入图片描述"></p> 
<p>3）打开左上角的<strong>文件</strong>选项列表，点击<strong>打开目录</strong>选项，打开需要标注的图片所在文件夹</p> 
<p>4）点击左下角的<strong>自动标注</strong>选项，PPOCRLabel会自动调用模型对每张图片进行标注，等待进度条100%，然后OK</p> 
<p><img src="https://images2.imgbox.com/5d/9c/479RunQ7_o.png" alt="在这里插入图片描述"></p> 
<p>5）自动标注结束以后，打开左上角的<strong>文件</strong>选项列表，点击<strong>导出标记结果</strong>和<strong>导出识别结果</strong>选项</p> 
<p>6）开始对每张图片进行检查，点击<strong>矩形标注</strong>和<strong>多点标注</strong>选项，手动修改不好的检测框和标签，没问题的点击<strong>确认</strong>，不喜欢的点击<strong>删除图片</strong>选项，PPOCRLabel工具操作<strong>快捷键</strong>如下</p> 
<p><img src="https://images2.imgbox.com/a5/d8/hRpeCNOF_o.png" alt="在这里插入图片描述"></p> 
<p>7）标注结束以后，再次点击<strong>导出标记结果</strong>和<strong>导出识别结果</strong>选项，然后检查图片文件夹中是否生成以下文件</p> 
<table><thead><tr><th>文件名</th><th>说明</th></tr></thead><tbody><tr><td>Label.txt</td><td>检测标签，可直接用于PPOCR检测模型训练。用户每确认5张检测结果后，程序会进行自动写入。当用户关闭应用程序或切换文件路径后同样会进行写入。</td></tr><tr><td>fileState.txt</td><td>图片状态标记文件，保存当前文件夹下已经被用户手动确认过的图片名称。</td></tr><tr><td>Cache.cach</td><td>缓存文件，保存模型自动识别的结果。</td></tr><tr><td>rec_gt.txt</td><td>识别标签。可直接用于PPOCR识别模型训练。需用户手动点击菜单栏“文件” - "导出识别结果"后产生。</td></tr><tr><td>crop_img</td><td>识别数据。按照检测框切割后的图片。与rec_gt.txt同时产生。</td></tr></tbody></table> 
<p>8）输入以下命令执行数据集划分脚本：</p> 
<p>trainValTestRatio 是训练集、验证集、测试集的图像数量划分比例，根据实际情况设定，默认是6:2:2</p> 
<p>datasetRootPath 是PPOCRLabel标注的完整数据集存放路径。默认路径是 PaddleOCR/train_data 分割数据集前</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> ./PPOCRLabel <span class="token comment"># 将目录切换到PPOCRLabel文件夹下</span>
python gen_ocr_train_val_test.py <span class="token parameter variable">--trainValTestRatio</span> <span class="token number">6</span>:2:2 <span class="token parameter variable">--datasetRootPath</span> /home/完整数据集存放路径/train_data
</code></pre> 
<p>train_data格式如下：</p> 
<pre><code class="prism language-bash"><span class="token operator">|</span>-train_data
 	  <span class="token operator">|</span>-crop_img
		    <span class="token operator">|</span>- 001_crop_0.png
		    <span class="token operator">|</span>- 002_crop_0.jpg
		    <span class="token operator">|</span>- 003_crop_0.jpg
		    <span class="token operator">|</span> <span class="token punctuation">..</span>.
	  <span class="token operator">|</span> Label.txt
	  <span class="token operator">|</span> rec_gt.txt
	  <span class="token operator">|</span>- 001.png
	  <span class="token operator">|</span>- 002.jpg
	  <span class="token operator">|</span>- 003.jpg
	  <span class="token operator">|</span> <span class="token punctuation">..</span>.
</code></pre> 
<p>划分好的数据集会保存在PaddleOCR/train_data下面</p> 
<p>此时文字检测和文字识别的数据集就都制作好了。</p> 
<h2><a id="PaddleOCR_502"></a>四、PaddleOCR训练与测试</h2> 
<p>为了加强垂直领域或者说特殊环境下的检测能力，所以会专门使用对应环境的数据集进行训练，得到我们理想中的的模型。</p> 
<h3><a id="1_506"></a>1.文本检测模型训练与测试</h3> 
<p>根据<a href="https://github.com/PaddlePaddle/PaddleOCR/blob/release/2.7/doc/doc_ch/detection.md">官方文本检测教程</a>中最简单直接的思路进行训练，至于其他训练方法可以深入参考官方教程。</p> 
<h4><a id="1_510"></a>1）下载预训练模型</h4> 
<p>准备好数据集后，可以下载模型预训练文件：</p> 
<p><a href="https://paddleocr.bj.bcebos.com/pretrained/MobileNetV3_large_x0_5_pretrained.pdparams" rel="nofollow">MobileNetV3_large_x0_5_pretrained模型下载</a></p> 
<p>还可以选择以下模型：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 下载MobileNetV3的预训练模型</span>
<span class="token function">wget</span> <span class="token parameter variable">-P</span> ./pretrain_models/ https://paddleocr.bj.bcebos.com/pretrained/MobileNetV3_large_x0_5_pretrained.pdparams
<span class="token comment"># 或，下载ResNet18_vd的预训练模型</span>
<span class="token function">wget</span> <span class="token parameter variable">-P</span> ./pretrain_models/ https://paddleocr.bj.bcebos.com/pretrained/ResNet18_vd_pretrained.pdparams
<span class="token comment"># 或，下载ResNet50_vd的预训练模型</span>
<span class="token function">wget</span> <span class="token parameter variable">-P</span> ./pretrain_models/ https://paddleocr.bj.bcebos.com/pretrained/ResNet50_vd_ssld_pretrained.pdparams
</code></pre> 
<p>下载之后在paddleocr根目录下建立<strong>pretrain_models文件夹</strong>，并将训练模型放在该文件夹下并解压。</p> 
<h4><a id="2_528"></a>2）修改参数配置文件</h4> 
<p>修改/PaddleOCR/configs/det目录下的det_mv3_db.yml，或者复制一份重命名。</p> 
<p>有关配置文件各项参数的详细解释，请参考<a href="https://github.com/PaddlePaddle/PaddleOCR/blob/release/2.7/doc/doc_ch/config.md">官方文档</a></p> 
<p>部分常见配置的修改，建议根据各自训练环境自定义配置文件</p> 
<p><img src="https://images2.imgbox.com/ee/a4/82qfIJiG_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/dc/9f/PXBqTrYy_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/6d/4d/SYdW6qdS_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash">python tools/train.py <span class="token parameter variable">-c</span> configs/llw/det_mv3_db.yml <span class="token parameter variable">-o</span> <span class="token assign-left variable">Global.pretrained_model</span><span class="token operator">=</span>./pretrain_models/MNV3_x0_5/MobileNetV3_large_x0_5_pretrained
</code></pre> 
<p>如果提示<code>RuntimeError: CUDA out of memory.</code>就需要降低batch，或者清理GPU缓存，总会有奇奇怪怪的进程占着资源不放。</p> 
<h4><a id="3_550"></a>3）可视化训练过程</h4> 
<p>训练过程中，PaddleOCR文件夹下再开一个终端，输入以下命令+模型输出地址可视化训练过程：</p> 
<pre><code class="prism language-bash">visualdl <span class="token parameter variable">--logdir</span> <span class="token string">"./output/db_mv3"</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/cd/43/6JdIF4lO_o.png" alt="在这里插入图片描述"></p> 
<p>打开http://localhost:8040/，点击标量数据，即可看见实时信息</p> 
<p><img src="https://images2.imgbox.com/a5/72/qTJVqm9m_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="4_564"></a>4）模型评估测试</h4> 
<p>评估模型，输入以下命令：</p> 
<pre><code class="prism language-bash">python tools/eval.py <span class="token parameter variable">-c</span> configs/det/det_mv3_db.yml  <span class="token parameter variable">-o</span> <span class="token assign-left variable">Global.checkpoints</span><span class="token operator">=</span>./output/db_mv3/best_accuracy
</code></pre> 
<p><img src="https://images2.imgbox.com/78/cf/2ANcjhli_o.png" alt="在这里插入图片描述"></p> 
<p>对训练好的模型导出导出到/inference/det_db文件夹下，输入以下命令</p> 
<pre><code class="prism language-bash">python tools/export_model.py <span class="token parameter variable">-c</span> configs/det/det_mv3_db_ocr.yml <span class="token parameter variable">-o</span> <span class="token assign-left variable">Global.pretrained_model</span><span class="token operator">=</span>./output/db_mv3/best_accuracy  <span class="token assign-left variable">Global.save_inference_dir</span><span class="token operator">=</span>./inference/det_db
</code></pre> 
<p>最后使用以下代码，把自己训练的模型更新到det_model_dir，进行测试：</p> 
<pre><code class="prism language-bash"><span class="token function">import</span> os
<span class="token function">import</span> <span class="token function">time</span>

from paddleocr <span class="token function">import</span> PaddleOCR
<span class="token function">import</span> pandas as pd
<span class="token function">import</span> numpy as np
<span class="token function">import</span> cv2


def ocr_predict<span class="token punctuation">(</span>img<span class="token punctuation">)</span>:
    <span class="token string">''</span>'
    det_model_dir:文本检测
    rec_model_dir:文本识别
    cls_model_dir:方向分类
    <span class="token string">''</span>'
    ocr <span class="token operator">=</span> PaddleOCR<span class="token punctuation">(</span>det_model_dir<span class="token operator">=</span><span class="token string">"路径/inference/det_db/"</span>,
                    <span class="token assign-left variable">rec_model_dir</span><span class="token operator">=</span><span class="token string">"路径/rec/ch/ch_PP-OCRv4_rec_infer/"</span>,
                    <span class="token assign-left variable">cls_model_dir</span><span class="token operator">=</span><span class="token string">"路径/cls/ch_ppocr_mobile_v2.0_cls_infer/"</span>,
                    <span class="token assign-left variable">lang</span><span class="token operator">=</span><span class="token string">'ch'</span>, <span class="token assign-left variable">use_angle_cls</span><span class="token operator">=</span>True,
                    <span class="token assign-left variable">use_gpu</span><span class="token operator">=</span>False<span class="token punctuation">)</span>
    result <span class="token operator">=</span> ocr.ocr<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    print<span class="token punctuation">(</span>result<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token builtin class-name">:</span>
    img_path <span class="token operator">=</span> <span class="token string">"路径/ys.jpeg"</span>
    ocr_predict<span class="token punctuation">(</span>img_path<span class="token punctuation">)</span>
</code></pre> 
<p>同样成功获取到文本坐标，再根据坐标信息使用ch_PP-OCRv4_rec_infer模型进行识别，具体结果与上文一样，不在此复诉。</p> 
<h3><a id="2_619"></a>2.文本识别模型训练</h3> 
<p>根据<a href="https://hub.nuaa.cf/PaddlePaddle/PaddleOCR/blob/release/2.7/doc/doc_ch/recognition.md" rel="nofollow">官方文本识别教程</a>中最简单直接的思路进行训练，至于其他训练方法可以深入参考官方教程。</p> 
<h4><a id="1_625"></a>1）下载预训练模型</h4> 
<p>准备好数据集后，可以下载模型预训练文件：</p> 
<p><a href="https://paddleocr.bj.bcebos.com/PP-OCRv3/chinese/ch_PP-OCRv3_rec_train.tar" rel="nofollow">中英文超轻量ch_PP-OCRv3_rec_train模型下载</a></p> 
<p>还可以选择以下模型：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 下载中英文超轻量PP-OCRv4模型</span>
<span class="token function">wget</span> <span class="token parameter variable">-P</span> ./pretrain_models/ https://paddleocr.bj.bcebos.com/PP-OCRv4/chinese/ch_PP-OCRv4_rec_train.tar
<span class="token comment"># 或，下载中英文超轻量PP-OCRv3模型</span>
<span class="token function">wget</span> <span class="token parameter variable">-P</span> ./pretrain_models/ https://paddleocr.bj.bcebos.com/PP-OCRv3/chinese/ch_PP-OCRv3_rec_train.tar
<span class="token comment"># 或，下载英文超轻量PP-OCRv3模型</span>
<span class="token function">wget</span> <span class="token parameter variable">-P</span> ./pretrain_models/ https://paddleocr.bj.bcebos.com/PP-OCRv3/english/en_PP-OCRv3_rec_train.tar
</code></pre> 
<p>下载之后将训练模型放在pretrain_models文件夹下并解压。</p> 
<p>ch_PP-OCRv4_rec_train模型训练涉及到模型蒸馏，所以退而求其次使用ch_PP-OCRv3_rec_train模型。</p> 
<h4><a id="2_646"></a>2）修改参数配置文件</h4> 
<p>修改/PaddleOCR/configs/rec/PP-OCRv3/目录下的cn_PP-OCRv3_rec.yml，或者复制一份重命名。</p> 
<p>有关配置文件各项参数的详细解释，请参考<a href="https://github.com/PaddlePaddle/PaddleOCR/blob/release/2.7/doc/doc_ch/config.md">官方文档</a></p> 
<p>部分常见配置的修改，建议根据各自训练环境自定义配置文件</p> 
<p><img src="https://images2.imgbox.com/37/88/YzdgWoXV_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/19/6d/pYsx1NMR_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/0e/b8/yLgaG8oX_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash">python tools/train.py <span class="token parameter variable">-c</span> configs/llw/ch_PP-OCRv3_rec.yml <span class="token parameter variable">-o</span> <span class="token assign-left variable">Global.pretrained_model</span><span class="token operator">=</span>./pretrain_models/ch_PP-OCRv3_rec_train/best_accuracy
</code></pre> 
<p>如果提示<code>RuntimeError: CUDA out of memory.</code>就需要降低batch，或者清理GPU缓存，总会有奇奇怪怪的进程占着资源不放。</p> 
<h4><a id="3_670"></a>3）可视化训练过程</h4> 
<p>训练过程中，PaddleOCR文件夹下再开一个终端，输入以下命令+模型输出地址可视化训练过程：</p> 
<pre><code class="prism language-bash">visualdl <span class="token parameter variable">--logdir</span> <span class="token string">"./output/rec_ppocr_v3"</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/dd/5b/yj4uHoRR_o.png" alt="在这里插入图片描述"></p> 
<p>打开http://localhost:8040/，点击标量数据，即可看见实时信息</p> 
<p><img src="https://images2.imgbox.com/85/0a/nZxGA6zY_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="4_685"></a>4）模型评估测试</h4> 
<p>评估模型，输入以下命令：</p> 
<pre><code class="prism language-bash">python tools/eval.py <span class="token parameter variable">-c</span> configs/rec/ch_PP-OCRv3_rec.yml <span class="token parameter variable">-o</span> <span class="token assign-left variable">Global.checkpoints</span><span class="token operator">=</span>./output/rec_ppocr_v3/latest
</code></pre> 
<p><img src="https://images2.imgbox.com/29/e8/LkMA11AA_o.png" alt="在这里插入图片描述"></p> 
<p>对训练好的模型导出导出到/inference/rec_v3文件夹下，输入以下命令</p> 
<pre><code class="prism language-bash">python tools/export_model.py <span class="token parameter variable">-c</span> configs/rec/ch_PP-OCRv3_rec.yml <span class="token parameter variable">-o</span> <span class="token assign-left variable">Global.pretrained_model</span><span class="token operator">=</span>./output/rec_ppocr_v3/best_accuracy  <span class="token assign-left variable">Global.save_inference_dir</span><span class="token operator">=</span>./inference/rec_v3
</code></pre> 
<p>最后使用以下代码，把自己训练的模型更新到rec_model_dir，进行测试：</p> 
<pre><code class="prism language-bash"><span class="token function">import</span> os
<span class="token function">import</span> <span class="token function">time</span>

from paddleocr <span class="token function">import</span> PaddleOCR
<span class="token function">import</span> pandas as pd
<span class="token function">import</span> numpy as np
<span class="token function">import</span> cv2


def ocr_predict<span class="token punctuation">(</span>img<span class="token punctuation">)</span>:
    <span class="token string">''</span>'
    det_model_dir:文本检测
    rec_model_dir:文本识别
    cls_model_dir:方向分类
    <span class="token string">''</span>'
    ocr <span class="token operator">=</span> PaddleOCR<span class="token punctuation">(</span>det_model_dir<span class="token operator">=</span><span class="token string">"路径/inference/det_db/"</span>,
                    <span class="token assign-left variable">rec_model_dir</span><span class="token operator">=</span><span class="token string">"路径inference/rec_v3/"</span>,
                    <span class="token assign-left variable">cls_model_dir</span><span class="token operator">=</span><span class="token string">"路径/cls/ch_ppocr_mobile_v2.0_cls_infer/"</span>,
                    <span class="token assign-left variable">lang</span><span class="token operator">=</span><span class="token string">'ch'</span>, <span class="token assign-left variable">use_angle_cls</span><span class="token operator">=</span>True,
                    <span class="token assign-left variable">use_gpu</span><span class="token operator">=</span>False<span class="token punctuation">)</span>
    result <span class="token operator">=</span> ocr.ocr<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    print<span class="token punctuation">(</span>result<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token builtin class-name">:</span>
    img_path <span class="token operator">=</span> <span class="token string">"路径/ys.jpeg"</span>
    ocr_predict<span class="token punctuation">(</span>img_path<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="Paddleonnx_739"></a>五、Paddle转换onnx</h2> 
<h3><a id="1_741"></a>1.依赖</h3> 
<p>安装相应的第三方依赖：</p> 
<pre><code>	1.paddlepaddle-gpu
	2.paddle2onnx
	3.onnx
	4.onnxruntime-gpu
	5.cuda
	6.cudnn
</code></pre> 
<p>不懂安装依赖的参考以下博客：<br> <a href="https://blog.csdn.net/qq_45848817/article/details/117987514?spm=1001.2014.3001.5501">虚拟环境部署</a><br> <a href="https://blog.csdn.net/qq_45848817/article/details/135236647">onnx</a></p> 
<h3><a id="1paddleinference_755"></a>1.paddle模型转inference模型</h3> 
<p>因为自己训练的模型没有.pdmodel文件，所以需要paddle模型转化inference模型。</p> 
<h4><a id="1_759"></a>1）方法一：</h4> 
<p>首先，找到训练好的后缀为.pdopt/.pdparams/.states的三个Paddle模型文件以及.yml文件，一般都放在./output/文件夹中，随后修改tools/program.py文件中的参数，将-c后面添加对应的default，设为yml文件的相对路径或绝对路径。</p> 
<pre><code class="prism language-bash">self.add_argument<span class="token punctuation">(</span><span class="token string">"-c"</span>, <span class="token string">"--config"</span>, <span class="token assign-left variable">default</span><span class="token operator">=</span><span class="token string">'/config.yml'</span>, <span class="token assign-left variable">help</span><span class="token operator">=</span><span class="token string">"configuration file to use"</span><span class="token punctuation">)</span>
</code></pre> 
<p>其次，打开yml文件，将文件中的Global：checkpoints设置为三个训练文件保存的位置（注意，此处位置应当是保存文件夹+去后缀的文件名，例如：./output/…/best_accuracy）；修改save_inference_dir，即推理模型的保存位置(例如：./output/…/onnx）。</p> 
<pre><code class="prism language-bash">   checkpoints: ./output/<span class="token punctuation">..</span>./best_accuracy
  save_inference_dir: ./output/<span class="token punctuation">..</span>./onnx/
</code></pre> 
<p>最后，运行tools/export_model.py文件，生成三个推理模型。</p> 
<p><img src="https://images2.imgbox.com/b0/0d/PbPV8RPa_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2_777"></a>2）方法二：</h4> 
<p>直接使用命令行运行修改</p> 
<pre><code class="prism language-bash">python tools/export_model.py <span class="token parameter variable">-c</span> configs/rec/PP-OCRv3/en_PP-OCRv3_rec_my2.yml <span class="token parameter variable">-o</span> <span class="token assign-left variable">Global.pretrained_model</span><span class="token operator">=</span>./output/myOCR_model/best_accuracy  <span class="token assign-left variable">Global.save_inference_dir</span><span class="token operator">=</span>./inference/myOCR_model/
</code></pre> 
<h3><a id="2inferenceonnx_786"></a>2.inference模型转onnx模型</h3> 
<p><a href="https://blog.csdn.net/weixin_42108183/article/details/128884666">参考博客6</a>，但是不太理解_sim.onnx的作用，好像没意义</p> 
<h4><a id="1_790"></a>1）转文本检测模型</h4> 
<pre><code class="prism language-bash">paddle2onnx <span class="token parameter variable">--model_dir</span> /output/<span class="token punctuation">..</span>./onnx/ <span class="token punctuation">\</span>
            <span class="token parameter variable">--model_filename</span> inference.pdmodel <span class="token punctuation">\</span>
            <span class="token parameter variable">--params_filename</span> inference.pdiparams <span class="token punctuation">\</span>
            <span class="token parameter variable">--save_file</span> /output/<span class="token punctuation">..</span>./onnx/det.onnx <span class="token punctuation">\</span>
            <span class="token parameter variable">--enable_dev_version</span> True <span class="token punctuation">\</span>
            <span class="token parameter variable">--opset_version</span> <span class="token number">11</span>
</code></pre> 
<pre><code class="prism language-bash">python <span class="token parameter variable">-m</span> paddle2onnx.optimize <span class="token parameter variable">--input_model</span> /output/<span class="token punctuation">..</span>./onnx/det.onnx <span class="token punctuation">\</span>
							   <span class="token parameter variable">--output_model</span> /output/<span class="token punctuation">..</span>./onnx/det_sim.onnx
</code></pre> 
<pre><code class="prism language-bash">python <span class="token parameter variable">-m</span> paddle2onnx.optimize <span class="token parameter variable">--input_model</span> /output/<span class="token punctuation">..</span>./onnx/det_sim.onnx <span class="token punctuation">\</span>
                               <span class="token parameter variable">--output_model</span> /output/<span class="token punctuation">..</span>./onnx/det_static.onnx <span class="token punctuation">\</span>
                               <span class="token parameter variable">--input_shape_dict</span> <span class="token string">"{'x':[1,3,640,640]}"</span>
</code></pre> 
<h4><a id="2_813"></a>2）转文本识别模型</h4> 
<pre><code class="prism language-bash">paddle2onnx <span class="token parameter variable">--model_dir</span> /output/<span class="token punctuation">..</span>./onnx/ <span class="token punctuation">\</span>
			<span class="token parameter variable">--model_filename</span> inference.pdmodel <span class="token punctuation">\</span>
			<span class="token parameter variable">--params_filename</span> inference.pdiparams <span class="token punctuation">\</span>
			<span class="token parameter variable">--save_file</span> /output/<span class="token punctuation">..</span>./onnx/rec.onnx <span class="token parameter variable">--enable_dev_version</span> True 
			<span class="token parameter variable">--opset_version</span> <span class="token number">11</span>
</code></pre> 
<pre><code class="prism language-bash">python <span class="token parameter variable">-m</span> paddle2onnx.optimize <span class="token parameter variable">--input_model</span> /output/<span class="token punctuation">..</span>./onnx/rec.onnx <span class="token punctuation">\</span>
							   <span class="token parameter variable">--output_model</span> /output/<span class="token punctuation">..</span>./onnx/rec_sim.onnx <span class="token punctuation">\</span>
</code></pre> 
<pre><code class="prism language-bash">python <span class="token parameter variable">-m</span> paddle2onnx.optimize <span class="token parameter variable">--input_model</span> /output/<span class="token punctuation">..</span>./onnx/rec_sim.onnx  <span class="token punctuation">\</span>
							   <span class="token parameter variable">--output_model</span> /output/<span class="token punctuation">..</span>./onnx/rec_static.onnx <span class="token punctuation">\</span>
							   <span class="token parameter variable">--input_shape_dict</span> <span class="token string">"{'x':[1,3,48,320]}"</span>
</code></pre> 
<h4><a id="3ir_version_834"></a>3）修改ir_version版本</h4> 
<p>导出onnx后，直接使用AI工具链进行量化会报错，需要将onnx模型的ir_version设置为7<br> 不然会报错</p> 
<blockquote> 
 <p>onnxruntime.capi.onnxruntime_pybind11_state.Fail: [ONNXRuntimeError] :<br> 1 : FAIL : Load model from /home/…/.onnx<br> failed:/onnxruntime_src/onnxruntime/core/graph/model.cc:110<br> onnxruntime::Model…</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token function">import</span> onnx
<span class="token assign-left variable">path</span><span class="token operator">=</span><span class="token string">'/output/.../onnx/det_static.onnx'</span>
model <span class="token operator">=</span> onnx.load<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
model.ir_version <span class="token operator">=</span> <span class="token number">7</span>
onnx.save<span class="token punctuation">(</span>model, path<span class="token punctuation">)</span>

<span class="token assign-left variable">path</span><span class="token operator">=</span><span class="token string">'/output/.../onnx/rec_static.onnx'</span>
model <span class="token operator">=</span> onnx.load<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
model.ir_version <span class="token operator">=</span> <span class="token number">7</span>
onnx.save<span class="token punctuation">(</span>model, path<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="4onnx_856"></a>4）测试onnx模型</h4> 
<p>简单测试det模型：</p> 
<pre><code class="prism language-bash"><span class="token function">import</span> onnx,time
<span class="token function">import</span> numpy as np
<span class="token function">import</span> onnxruntime
 
onnx_file <span class="token operator">=</span> <span class="token string">'/det_static.onnx'</span> 
onnx_model <span class="token operator">=</span> onnx.load<span class="token punctuation">(</span>onnx_file<span class="token punctuation">)</span>
onnx.checker.check_model<span class="token punctuation">(</span>onnx_model<span class="token punctuation">)</span>
print<span class="token punctuation">(</span><span class="token string">'The model is checked!'</span><span class="token punctuation">)</span>
 
x <span class="token operator">=</span> np.random.random<span class="token variable"><span class="token punctuation">((</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">640</span><span class="token punctuation">,</span><span class="token number">640</span><span class="token punctuation">))</span></span>.astype<span class="token punctuation">(</span><span class="token string">'float32'</span><span class="token punctuation">)</span> <span class="token comment"># 此处也可用cv读取某张图片作为输入</span>
print<span class="token punctuation">(</span><span class="token string">"x:"</span>,x<span class="token punctuation">)</span>
 
ort_sess <span class="token operator">=</span> onnxruntime.InferenceSession<span class="token punctuation">(</span>onnx_file<span class="token punctuation">)</span>
ort_inputs <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>ort_sess.get_inputs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.name: x<span class="token punctuation">}</span>
start <span class="token operator">=</span> time.time<span class="token punctuation">(</span><span class="token punctuation">)</span>
ort_outs <span class="token operator">=</span> ort_sess.run<span class="token punctuation">(</span>None, ort_inputs<span class="token punctuation">)</span>
end <span class="token operator">=</span> time.time<span class="token punctuation">(</span><span class="token punctuation">)</span>
print<span class="token punctuation">(</span><span class="token string">"Runtime:{}"</span>.format<span class="token punctuation">(</span>end-start<span class="token punctuation">))</span>
</code></pre> 
<p>如果想对3个onnx模型都进行测试可以试试以下项目<br> <a href="https://github.com/hpc203/PaddleOCR-v3-onnxrun-cpp-py">PaddleOCR-v3-onnxrun-cpp-py</a></p> 
<p>由此，我们可以验证onnx是否转出成功，并测试onnx的部分性能，也可以使用netron去可视化模型结构。</p> 
<p>模型的输入输出尺寸也需要特别关注，下附修改代码：</p> 
<pre><code class="prism language-bash"><span class="token function">import</span> onnx

model <span class="token operator">=</span> onnx.load<span class="token punctuation">(</span>r<span class="token string">'det_server.onnx'</span><span class="token punctuation">)</span>
model.graph.input<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.type.tensor_type.shape.dim<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>.dim_param <span class="token operator">=</span> <span class="token string">'?'</span>
model.graph.input<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.type.tensor_type.shape.dim<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>.dim_param <span class="token operator">=</span> <span class="token string">'?'</span>
model.graph.output<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.type.tensor_type.shape.dim<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>.dim_param <span class="token operator">=</span> <span class="token string">'?'</span>
model.graph.output<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>.type.tensor_type.shape.dim<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>.dim_param <span class="token operator">=</span> <span class="token string">'?'</span>
<span class="token comment"># print(model.graph.input[0].type.tensor_type.shape)</span>
onnx.save<span class="token punctuation">(</span>model, <span class="token string">'det.onnx'</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="_902"></a>六、补充</h2> 
<p><a href="https://hub.nuaa.cf/PaddlePaddle/PaddleOCR/blob/release/2.7/doc/doc_ch/models_list.md" rel="nofollow"><strong>更多官方模型链接</strong></a></p> 
<p><strong>yml部分参数说明</strong><br> <img src="https://images2.imgbox.com/8a/c6/64q8x1u5_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ae/ef/61O2L4Ij_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/719ad85529ea150e58fc3cf8d2fb0ce5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于AIxBoard打造Rosmart AI质检一体机</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e42f500461ae8481c4739bd487e278c5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">QT 中的元对象系统</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>