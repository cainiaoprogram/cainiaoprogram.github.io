<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>网页信息上传服务器,Unity 连接网页服务器 获取数据上传数据 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="网页信息上传服务器,Unity 连接网页服务器 获取数据上传数据" />
<meta property="og:description" content="usingLitJson;usingSystem;usingSystem.Collections;usingSystem.Collections.Generic;usingSystem.IO;usingSystem.Net;usingSystem.Net.Http;usingSystem.Text;usingUnityEngine;usingUnityEngine.Networking;usingUnityEngine.UI;//请求连接//数据类型
public classConserver
{public int recordType; //类型
public string studentIdx; //学号
public string courseName; //课程名称
public string taskName; //任务名称
public int loginTimes; //登录次数
public int onlineDur; //在线时长
public byte finishRate; //学习完成率
public byte score; //分数
public Conserver(int recordType, string studentIdx,string courseName,string taskName,int loginTimes, intonlineDur,byte finishRate, bytescore)
{this.recordType =recordType;this.studentIdx =studentIdx;this.courseName =courseName;this.taskName =taskName;this.loginTimes =loginTimes;this.onlineDur =onlineDur;this.finishRate =finishRate;this.score =score;
}
}//解析json类//定义的类型一定要跟接收到的数据类型保持一致,否则会一直出不来
public classmodelTest
{public intresult;publicData data;
}public classData
{publicExamsk[]exams;public int total; //个数
}public classExamsk" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b4ca87a14ca1924f1c75243f051484f1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-11T20:02:32+08:00" />
<meta property="article:modified_time" content="2021-08-11T20:02:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">网页信息上传服务器,Unity 连接网页服务器 获取数据上传数据</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>usingLitJson;usingSystem;usingSystem.Collections;usingSystem.Collections.Generic;usingSystem.IO;usingSystem.Net;usingSystem.Net.Http;usingSystem.Text;usingUnityEngine;usingUnityEngine.Networking;usingUnityEngine.UI;//请求连接//数据类型</p> 
 <p>public classConserver</p> 
 <p>{public int recordType; //类型</p> 
 <p>public string studentIdx; //学号</p> 
 <p>public string courseName; //课程名称</p> 
 <p>public string taskName; //任务名称</p> 
 <p>public int loginTimes; //登录次数</p> 
 <p>public int onlineDur; //在线时长</p> 
 <p>public byte finishRate; //学习完成率</p> 
 <p>public byte score; //分数</p> 
 <p>public Conserver(int recordType, string studentIdx,string courseName,string taskName,int loginTimes, intonlineDur,byte finishRate, bytescore)</p> 
 <p>{this.recordType =recordType;this.studentIdx =studentIdx;this.courseName =courseName;this.taskName =taskName;this.loginTimes =loginTimes;this.onlineDur =onlineDur;this.finishRate =finishRate;this.score =score;</p> 
 <p>}</p> 
 <p>}//解析json类//定义的类型一定要跟接收到的数据类型保持一致,否则会一直出不来</p> 
 <p>public classmodelTest</p> 
 <p>{public intresult;publicData data;</p> 
 <p>}public classData</p> 
 <p>{publicExamsk[]exams;public int total; //个数</p> 
 <p>}public classExamsk</p> 
 <p>{public string className; //班级</p> 
 <p>public string courseName; //课程</p> 
 <p>public string endTime; //结束时间</p> 
 <p>public int id; //id</p> 
 <p>public string name; //考试名称</p> 
 <p>public string startTime; //开始时间</p> 
 <p>public int taskIndex; //任务id</p> 
 <p>}public classConnect_Server : MonoBehaviour</p> 
 <p>{public string idd; //保存的token值</p> 
 <p>publicInputField field_xuehao;publicInputField field_mima;publicInputField field_kecheng;publicButton btn_login;</p> 
 <p>[NonSerialized]public int type; //什么类型 0学习 1 训练 2 考试</p> 
 <p>[NonSerialized]public string ipp; //IP地址</p> 
 <p>public GameObject ipObject; //IP地址界面</p> 
 <p>publicInputField field_ip;publicButton btn_jinru;public staticConnect_Server instance;publicGameObject tanchaungObj;public List listkeceng = new List(); //课程</p> 
 <p>public List listname = new List(); //考核名称</p> 
 <p>public List listTaskIndex = new List(); //任务几</p> 
 <p>public static int numberTask; //任务个数</p> 
 <p>public intRW;public stringkechengmingcheng;//清空列表</p> 
 <p>public voidClear_List()</p> 
 <p>{<!-- --></p> 
 <p>listkeceng.Clear();</p> 
 <p>listname.Clear();</p> 
 <p>listTaskIndex.Clear();</p> 
 <p>}public voidBaoCunIpp()</p> 
 <p>{<!-- --></p> 
 <p>PlayerPrefs.SetString("IPIP", field_ip.text);</p> 
 <p>}private voidAwake()</p> 
 <p>{<!-- --></p> 
 <p>instance= this;if (PlayerPrefs.GetString("IPIP")!=null)</p> 
 <p>{<!-- --></p> 
 <p>field_ip.text= PlayerPrefs.GetString("IPIP");</p> 
 <p>}else{<!-- --></p> 
 <p>}</p> 
 <p>}private voidStart()</p> 
 <p>{//登录按钮</p> 
 <p>btn_login.onClick.AddListener(delegate{if (field_xuehao.text !=""&amp;&amp; field_mima.text !="")</p> 
 <p>{<!-- --></p> 
 <p>StartCoroutine(GetAccessToken(field_xuehao.text, field_mima.text));</p> 
 <p>}</p> 
 <p>});</p> 
 <p>btn_jinru.onClick.AddListener(delegate{if (field_ip.text !="")</p> 
 <p>{<!-- --></p> 
 <p>ipp=field_ip.text;</p> 
 <p>ipObject.SetActive(false);</p> 
 <p>BaoCunIpp();</p> 
 <p>}</p> 
 <p>});</p> 
 <p>}//上传数据</p> 
 <p>public void Upload_Data(int type,string xuehao,string kecheng,string renwu,int cishu,byte wancenglv,bytesoce)</p> 
 <p>{<!-- --></p> 
 <p>sendMessage(new Conserver(type, xuehao, kecheng, renwu, cishu, (int)Time.realtimeSinceStartup, wancenglv, soce));</p> 
 <p>}//上传学习完成率数据//调用 Connect_Server.instance.UpLoad_Dataxuexi();</p> 
 <p>public voidUpLoad_Dataxuexi()</p> 
 <p>{<!-- --></p> 
 <p>Connect_Server.instance.Upload_Data(Connect_Server.instance.type, Connect_Server.instance.field_xuehao.text,</p> 
 <p>Connect_Server.instance.listkeceng[0], "考试", 1, 100, 0);</p> 
 <p>Connect_Server.instance.Clear_List();</p> 
 <p>}public voidUpdate()</p> 
 <p>{if(Input.GetKeyDown (KeyCode.Space ))</p> 
 <p>{//Connect_Server.instance.Get_BicAuth();//GetPage();</p> 
 <p>}</p> 
 <p>}//post 请求账号密码 获取token值 ,保存使用</p> 
 <p>IEnumerator GetAccessToken(string xuehao,stringmima)</p> 
 <p>{string url = "http://"+ipp+":8080/auth/login/student";//Debug.Log(url);</p> 
 <p>WWWForm form = newWWWForm();</p> 
 <p>form.AddField("studentIdx", xuehao);</p> 
 <p>form.AddField("password", mima);//string form = Convert.ToBase64String(Encoding.Default.GetBytes("20210101:123456"));</p> 
 <p>UnityWebRequest www =UnityWebRequest.Post(url, form);yield returnwww.SendWebRequest();if (www.isNetworkError ||www.isHttpError)</p> 
 <p>{<!-- --></p> 
 <p>Debug.Log(www.error);</p> 
 <p>}else{//Debug.Log("Form upload complete!");</p> 
 <p>JsonData json =JsonMapper.ToObject(www.downloadHandler.text);</p> 
 <p>Debug.Log(www.downloadHandler.text);//获取服务器返回的数据 解析判断</p> 
 <p>if (json["result"].ToString()!="0")</p> 
 <p>{<!-- --></p> 
 <p>field_xuehao.text= "";</p> 
 <p>field_mima.text= "";</p> 
 <p>field_kecheng.text= "";</p> 
 <p>tanchaungObj.SetActive(true);</p> 
 <p>}else{//Debug.Log(www.downloadHandler.text);//idd就是解析出来的token值</p> 
 <p>idd = json["data"]["token"].ToString();//Debug.Log(idd);</p> 
 <p>GameManager.instance.login_obj.SetActive(false);</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}public voidGuanBITanChuang()</p> 
 <p>{<!-- --></p> 
 <p>tanchaungObj.SetActive(false);</p> 
 <p>}//直接get请求</p> 
 <p>public voidGet_BicAuth()</p> 
 <p>{string url = "http://"+ipp+":8080/exam?page=1&amp;limit=10";using (var httpClient = newHttpClient())</p> 
 <p>{var response =httpClient.GetAsync(url).Result;var data =response.Content.ReadAsStringAsync().Result;</p> 
 <p>Debug.Log(data);</p> 
 <p>}</p> 
 <p>}//GET请求服务器 带Bearer认证 还有token令牌</p> 
 <p>public voidGetPage()</p> 
 <p>{<!-- --></p> 
 <p>HttpWebRequest request= null;string requestUrl = "http://" + ipp + ":8080/exam?page=1&amp;limit=10";//准备请求...</p> 
 <p>try{//设置参数</p> 
 <p>CookieContainer objCookieContainer = null;</p> 
 <p>request=(HttpWebRequest)WebRequest.Create(requestUrl);</p> 
 <p>CookieContainer cookieContainer= newCookieContainer();</p> 
 <p>request.CookieContainer=cookieContainer;</p> 
 <p>request.AllowAutoRedirect= true;</p> 
 <p>request.Method= "GET"; //请求方式GET或POST//数据格式是JSON</p> 
 <p>request.ContentType = "application/json";//认证方式 bearer idd 是令牌 token值</p> 
 <p>request.Headers.Add("Authorization", "Bearer" +idd);string strResponse = "";using (HttpWebResponse res =(HttpWebResponse)request.GetResponse())</p> 
 <p>{<!-- --></p> 
 <p>objCookieContainer=request.CookieContainer;using (Stream resStream =res.GetResponseStream())</p> 
 <p>{using (StreamReader srs = new StreamReader(resStream, Encoding.UTF8))//.UTF8))</p> 
 <p>{<!-- --></p> 
 <p>strResponse=srs.ReadToEnd();</p> 
 <p>Debug.Log(strResponse);</p> 
 <p>modelTest obj= JsonMapper.ToObject(strResponse);</p> 
 <p>numberTask=obj.data.total;for (int i = 0; i &lt; obj.data.total; i++)</p> 
 <p>{//保存从服务器获取的数据,等会显现出来</p> 
 <p>listname.Add(obj.data.exams[i].name.ToString());</p> 
 <p>listkeceng.Add(obj.data.exams[i].courseName.ToString());</p> 
 <p>listTaskIndex.Add(obj.data.exams[i].taskIndex);</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}catch(Exception e)</p> 
 <p>{<!-- --></p> 
 <p>Debug.Log(e);</p> 
 <p>}</p> 
 <p>}//带HTTP安全协议 Bearer验证的post请求方法 上传数据</p> 
 <p>public stringsendMessage( Conserver student)</p> 
 <p>{string strUrl = "http://"+ipp+":8080/record";try{<!-- --></p> 
 <p>CookieContainer objCookieContainer= null;</p> 
 <p>HttpWebRequest request=(HttpWebRequest)WebRequest.Create(strUrl);</p> 
 <p>request.Method= "Post";</p> 
 <p>request.ContentType= "application/json";//设置Http Bearer认证的请求头</p> 
 <p>request.Headers.Add("Authorization", "Bearer" +idd);</p> 
 <p>request.Referer=strUrl;</p> 
 <p>Debug.Log(strUrl);if (objCookieContainer == null)</p> 
 <p>objCookieContainer= newCookieContainer();</p> 
 <p>request.CookieContainer=objCookieContainer;</p> 
 <p>Debug.Log(objCookieContainer.ToString());//传输参数格式转换</p> 
 <p>var data =JsonUtility.ToJson(student);//request.ContentLength = Encoding.UTF8.GetByteCount(data);</p> 
 <p>byte[] byteData =Encoding.UTF8.GetBytes(data);</p> 
 <p>request.ContentLength=byteData.Length;using (Stream reqStream =request.GetRequestStream())</p> 
 <p>{<!-- --></p> 
 <p>reqStream.Write(byteData,0, byteData.Length);//reqStream.Close();</p> 
 <p>}string strResponse = "";using (HttpWebResponse res =(HttpWebResponse)request.GetResponse())</p> 
 <p>{<!-- --></p> 
 <p>objCookieContainer=request.CookieContainer;using (Stream resStream =res.GetResponseStream())</p> 
 <p>{using (StreamReader sr = new StreamReader(resStream, Encoding.UTF8))//.UTF8))</p> 
 <p>{<!-- --></p> 
 <p>strResponse=sr.ReadToEnd();</p> 
 <p>Debug.Log(strResponse);</p> 
 <p>}</p> 
 <p>}//res.Close();</p> 
 <p>}returnstrResponse;</p> 
 <p>}catch(Exception e)</p> 
 <p>{<!-- --></p> 
 <p>Debug.Log(e);</p> 
 <p>}return null;</p> 
 <p>}</p> 
 <p>}</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6c612e9b91a7f31aa15bd4c754a8d3ca/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">建网站应该买什么云服务器,建网站应该买什么云服务器</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1e29c1b389088a041ddcd9501cc7a852/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">有杀气童话服务器维护9月,《有杀气童话》9月24日例行维护通告</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>