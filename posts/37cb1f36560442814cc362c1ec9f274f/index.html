<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>springboot spring security 接口403 自定义处理 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="springboot spring security 接口403 自定义处理" />
<meta property="og:description" content="springboot spring security 接口403 自定义处理 需要解决的问题需要实现的样式查找过程最后得到的处理方案---针对修改弹窗提示参考的文章链接 需要解决的问题 在弹出页面中有调用接口，当当前登录用户没有该权限时，就会小弹窗报错，不过报错的提示是FORBIDDEN对用户不友好，考虑将FORBIDDEN改成：无权限，请联系管理员这个问题
需要实现的样式 查找过程 我先设想 弹窗报错应该是是前端框架EASYUI的事，所以就是后端调用接口时检查登录人员无接口权限触发报错。前端收到错误信息 弹出显示错误信息
除此之外看本地代码没啥思绪，嘿嘿百度大法好，搜索 spring boot 自定义处理403（实际用这个搜索的结果收获很小）然后找到类似再疯狂查看推荐的博客最后得到理清了处理这个问题的思绪。---------》
111在idp的resources-&gt;static-&gt;error文件夹下添加 403.html(这个文件是框架默认的自定义显示错误页面的。例如，该文件夹下没有自定义的403.html页面，出现403错误的页面会显示上图所示，如果该文件夹下有403.html，403.html就会替代掉上图。如下图)
222 上面111是说页面出现403时自定义处理，222来讲调用接口出现403（即弹出显示403权限不足提示）。需要实现403权限不足处理类AccessDeniedHandler
最后得到的处理方案—针对修改弹窗提示 1先写实现处理类【最开始使用的是msg方式，不会显示FORBIDDEN，可是也不显示权限不足，错误弹窗页面一片空白//然后改成message弹窗提示就对了】
下面这个是第2种写法亲测都可以成功
2修改配置【方框框起的是实现自动注入，圆框是配置】
3到此就运行成功，以下是代码【其实代码也是照抄别人的博客的，参考链接放在最后，可以看看】
/** * &lt;p&gt; * 自定义权限不足处理程序 * &lt;/p&gt; * * @author：lll * @date：Created in 2021/4/28 9:17 */ //@Component //public class MyAccessDeniedHandler implements AccessDeniedHandler { // // @Override // public void handle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, AccessDeniedException e) throws IOException, ServletException { // httpServletResponse.setStatus(HttpServletResponse.SC_FORBIDDEN); httpServletResponse.setHeader(&#34;Content-Type&#34;,&#34;application/json;charset=utf-8&#34;) ; // PrintWriter out = httpServletResponse." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/37cb1f36560442814cc362c1ec9f274f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-28T16:55:47+08:00" />
<meta property="article:modified_time" content="2021-04-28T16:55:47+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">springboot spring security 接口403 自定义处理</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>springboot spring security 接口403 自定义处理</h4> 
 <ul><li><a href="#_2" rel="nofollow">需要解决的问题</a></li><li><ul><li><a href="#_6" rel="nofollow">需要实现的样式</a></li><li><a href="#_11" rel="nofollow">查找过程</a></li><li><a href="#_20" rel="nofollow">最后得到的处理方案---针对修改弹窗提示</a></li><li><a href="#_102" rel="nofollow">参考的文章链接</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>需要解决的问题</h2> 
<p>在弹出页面中有调用接口，当当前登录用户没有该权限时，就会小弹窗报错，不过报错的提示是FORBIDDEN对用户不友好，考虑将FORBIDDEN改成：无权限，请联系管理员这个问题<br> <img src="https://images2.imgbox.com/d8/e9/txVKGiL5_o.png" alt=""></p> 
<h3><a id="_6"></a>需要实现的样式</h3> 
<p><img src="https://images2.imgbox.com/93/0b/3LPw8EWW_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_11"></a>查找过程</h3> 
<p>我先设想 弹窗报错应该是是前端框架EASYUI的事，所以就是后端调用接口时检查登录人员无接口权限触发报错。前端收到错误信息 弹出显示错误信息<br> <img src="https://images2.imgbox.com/2e/7d/dkPLq2mu_o.png" alt="在这里插入图片描述"><br> 除此之外看本地代码没啥思绪，嘿嘿百度大法好，搜索 spring boot 自定义处理403（实际用这个搜索的结果收获很小）然后找到类似再疯狂查看推荐的博客最后得到理清了处理这个问题的思绪。---------》<br> 111在idp的resources-&gt;static-&gt;error文件夹下添加 403.html(这个文件是框架默认的自定义显示错误页面的。例如，该文件夹下没有自定义的403.html页面，出现403错误的页面会显示上图所示，如果该文件夹下有403.html，403.html就会替代掉上图。如下图)<br> <img src="https://images2.imgbox.com/07/51/GFmyDdpX_o.png" alt="在这里插入图片描述"><br> 222 上面111是说页面出现403时自定义处理，222来讲调用接口出现403（即弹出显示403权限不足提示）。需要实现403权限不足处理类AccessDeniedHandler</p> 
<h3><a id="_20"></a>最后得到的处理方案—针对修改弹窗提示</h3> 
<p>1先写实现处理类【最开始使用的是msg方式，不会显示FORBIDDEN，可是也不显示权限不足，错误弹窗页面一片空白//然后改成message弹窗提示就对了】<img src="https://images2.imgbox.com/88/1f/2tf6rxNi_o.png" alt=""><br> 下面这个是第2种写法亲测都可以成功<br> <img src="https://images2.imgbox.com/de/6d/ZesDBm8W_o.png" alt="在这里插入图片描述"></p> 
<p>2修改配置【方框框起的是实现自动注入，圆框是配置】<br> <img src="https://images2.imgbox.com/e9/1b/8fHFwRT8_o.png" alt="在这里插入图片描述"><br> 3到此就运行成功，以下是代码【其实代码也是照抄别人的博客的，参考链接放在最后，可以看看】</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * &lt;p&gt;
 * 自定义权限不足处理程序
 * &lt;/p&gt;
 *
 * @author：lll
 * @date：Created in 2021/4/28 9:17
 */</span>
<span class="token comment">//@Component</span>
<span class="token comment">//public class MyAccessDeniedHandler implements AccessDeniedHandler {<!-- --></span>
<span class="token comment">//</span>
<span class="token comment">//    @Override</span>
<span class="token comment">//    public void handle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, AccessDeniedException e) throws IOException, ServletException {<!-- --></span>
<span class="token comment">//        httpServletResponse.setStatus(HttpServletResponse.SC_FORBIDDEN); httpServletResponse.setHeader("Content-Type","application/json;charset=utf-8") ;</span>
<span class="token comment">//        PrintWriter out = httpServletResponse.getWriter();</span>
<span class="token comment">//        out.write("{\"status\":\"error\",\"msg\":\"权限不足\"}");</span>
<span class="token comment">        out.write("{\"status\":\"error\",\"message\":\"权限不足，请联系管理 员!\"}");</span>
<span class="token comment">//        out.flush();</span>
<span class="token comment">//        out.close();</span>
<span class="token comment">//    }</span>
<span class="token comment">//}</span>

<span class="token comment">/**
 * @Auther: lixiupeng
 * @Date: 2018/11/21 15:54
 * @Description: 自定义权限不足处理
 */</span>
<span class="token comment">//@Service</span>
<span class="token comment">//public class MyAccessDeniedHandler implements AccessDeniedHandler {<!-- --></span>
<span class="token comment">//    private String errorPage;</span>
<span class="token comment">//    @Override</span>
<span class="token comment">//    public void handle(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, AccessDeniedException e) throws IOException, ServletException {<!-- --></span>
<span class="token comment">//        //判断是否为ajax请求</span>
<span class="token comment">//        if (httpServletRequest.getHeader("accept").indexOf("application/json") &gt; -1</span>
<span class="token comment">//                || (httpServletRequest.getHeader("X-Requested-With") != null &amp;&amp; httpServletRequest.getHeader("X-Requested-With").equals(</span>
<span class="token comment">//                "XMLHttpRequest"))) {<!-- --></span>
<span class="token comment">//            //设置状态为403，无权限状态</span>
<span class="token comment">//            httpServletResponse.setStatus(HttpServletResponse.SC_FORBIDDEN);</span>
<span class="token comment">//            //设置格式以及返回json数据 方便前台使用reponseJSON接取</span>
<span class="token comment">//            httpServletResponse.setCharacterEncoding("UTF-8");</span>
<span class="token comment">//            httpServletResponse.setContentType("application/json; charset=utf-8");</span>
<span class="token comment">//            PrintWriter out = httpServletResponse.getWriter();</span>
<span class="token comment">//            JSONObject json = new JSONObject();</span>
<span class="token comment">//            json.put("message","权限不足，请联系管理员");</span>
<span class="token comment">//            out.append(json.toString());</span>
<span class="token comment">//        }else if(!httpServletResponse.isCommitted()){//非ajax请求</span>
<span class="token comment">//            if(errorPage!=null){<!-- --></span>
<span class="token comment">//                // Put exception into request scope (perhaps of use to a view)</span>
<span class="token comment">//                httpServletRequest.setAttribute(WebAttributes.ACCESS_DENIED_403, e);</span>
<span class="token comment">//</span>
<span class="token comment">//                // Set the 403 status code.</span>
<span class="token comment">//                httpServletResponse.setStatus(HttpServletResponse.SC_FORBIDDEN);</span>
<span class="token comment">//</span>
<span class="token comment">//                // forward to error page.</span>
<span class="token comment">//                RequestDispatcher dispatcher = httpServletRequest.getRequestDispatcher(errorPage);</span>
<span class="token comment">//                dispatcher.forward(httpServletRequest, httpServletResponse);</span>
<span class="token comment">//            }else{<!-- --></span>
<span class="token comment">//                httpServletResponse.sendError(HttpServletResponse.SC_FORBIDDEN,e.getMessage());</span>
<span class="token comment">//            }</span>
<span class="token comment">//        }</span>
<span class="token comment">//    }</span>
<span class="token comment">    public void setErrorPage(String errorPage) {<!-- --></span>
<span class="token comment">        if ((errorPage != null) &amp;&amp; !errorPage.startsWith("/")) {<!-- --></span>
<span class="token comment">            throw new IllegalArgumentException("errorPage must begin with '/'");</span>
<span class="token comment">        }</span>
<span class="token comment">        this.errorPage = errorPage;</span>
<span class="token comment">    }</span>
<span class="token comment">//}</span>
</code></pre> 
<h3><a id="_102"></a>参考的文章链接</h3> 
<p>https://blog.csdn.net/weixin_38373006/article/details/84339843</p> 
<p>https://blog.csdn.net/qq_45017999/article/details/109023378</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c8a6a82250e99f2f1531e740c48f3294/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux查看目录谁修改的,linux怎么查看谁修改文件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f6c0cd1029825bc611608dbe9302c4f4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">理解物联网（定义）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>