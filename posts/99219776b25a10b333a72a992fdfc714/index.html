<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Hali硬件安全工具-串口通讯RS232/485/422/CAN抓包 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Hali硬件安全工具-串口通讯RS232/485/422/CAN抓包" />
<meta property="og:description" content="1.场景需求 我发现我的CSDN的优点之一就是，每篇文章都有讲清楚起因，平白无故的技术学习是没有根的，没有落地的场景，没有技术的应用，技术本身就是昙花一现。
这次的分享，是Hali硬件安全工具的第一次分享。关于Hali是什么，Hali能做什么，请参考：
​​​​​​极客“Hali”硬件信息安全检测工具集（硬件Kali）简介_千夫长-向往生的博客-CSDN博客_kali查看硬件
通过以下的分享，我将为你揭开，如何通过这些软硬件工具，对串口通讯进行抓包分析，首先确保你的抓包是在实验室中进行，或在安全的工厂环境下进行。
2.工具列表 工欲善其事必先利其器，我们先来看下，你需要的工具：
2.1【硬件】通用总线分析-逻辑分析仪
型号为：LA2016(或LA1010)，可淘宝搜索型号购买。
2.2【硬件】串口工具
从左到右分别是：USB转RS232，USB转RS482/RS422，USB转TTL串口的工具，品牌型号都有，可以淘宝自己搜。
【硬件】CAN抓包分析仪
【软件】逻辑分析仪软件下载地址
通过这个分析工具，可以监听41种工业通讯总线数据，包括常见的232/TTL/485/422/IIC/SPI等，还可以自动探测串口波特率。
CAN分析仪软件：采购后会有店家发送软件下载地址。
通过这个软件，可以探测CAN总线的波特率，并直接把抓到的CAN数据包保存到Excel中，还可以主动，周期性的发CAN包。
串口抓包软件
这个是最常用的串口抓包工具，可以在各种视图中才查看到串口接收的时间，间隔，数据，数据的ASCII码，注册了会员，还可以把数据导出成txt做后续的python数据流分析。
3.基本使用方法 3.1.总线识别 一般在工厂的总线连接处，会明确的标识RS23/RS485，或者CAN_H，CAN_L，但如果出于保护或是标识看不到，那么可以先用逻辑分析仪接上去，看一下波形，或是用CAN分析仪怼上去，探测一下波特率。
3.2 总线抓包 这类软件基本上是比较傻瓜化的，插上硬件，把驱动装好，选择串口，点击开始抓包就可以，然后保存为默认的文件格式，再回到办公室，打开抓包文件就可以分析了。
3.3 数据清洗和分析 针对串口抓取回来的数据，导出成11.txt（以UTF-8存储），通过以下的脚本，实现数据的清理。
numindex=0 countW=0 countR=0 PID=&#39;Data&#39; global fileHandname fileHandname=&#39;11&#39; try: f = open(fileHandname&#43;&#39;.txt&#39;, &#39;r&#39;, encoding=&#39;UTF-8&#39;) #f = open(&#39;1.txt&#39;, &#39;r&#39;) #print(&#39;读取成功&#39;) except: print(&#39;读取文件错误，请确认文件正常存放&#39;) ResultData=&#39;&#39; data_lines = f.readlines() f.close() num = len(data_lines) # 得到存储的行数 for i in range(num): # 读取最新的ChannelNum行数据， line = data_lines[i] # 从第0行开始 dataread=&#39;&#39; numindex=line." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/99219776b25a10b333a72a992fdfc714/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-17T20:23:42+08:00" />
<meta property="article:modified_time" content="2022-04-17T20:23:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Hali硬件安全工具-串口通讯RS232/485/422/CAN抓包</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>1.场景需求</h2> 
<p>        我发现我的CSDN的优点之一就是，每篇文章都有讲清楚起因，平白无故的技术学习是没有根的，没有落地的场景，没有技术的应用，技术本身就是昙花一现。</p> 
<p>        这次的分享，是Hali硬件安全工具的第一次分享。关于Hali是什么，Hali能做什么，请参考：</p> 
<p><a href="https://blog.csdn.net/qq_20031585/article/details/123932186" title="​​​​​​极客“Hali”硬件信息安全检测工具集（硬件Kali）简介_千夫长-向往生的博客-CSDN博客_kali查看硬件">​​​​​​极客“Hali”硬件信息安全检测工具集（硬件Kali）简介_千夫长-向往生的博客-CSDN博客_kali查看硬件</a></p> 
<p>        通过以下的分享，我将为你揭开，如何通过这些软硬件工具，对串口通讯进行抓包分析，首先确保你的抓包是在实验室中进行，或在安全的工厂环境下进行。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/d3/f6/W9YYuLNX_o.png"></p> 
<p></p> 
<h2>2.工具列表</h2> 
<p>        工欲善其事必先利其器，我们先来看下，你需要的工具：</p> 
<p>2.1【硬件】通用总线分析-逻辑分析仪</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/e1/fe/uLvc4Gfo_o.jpg"></p> 
<p>        型号为：LA2016(或LA1010)，可淘宝搜索型号购买。</p> 
<p>2.2【硬件】串口工具</p> 
<p>        从左到右分别是：USB转RS232，USB转RS482/RS422，USB转TTL串口的工具，品牌型号都有，可以淘宝自己搜。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/f5/01/yO0mDgBk_o.png"></p> 
<p></p> 
<p>【硬件】CAN抓包分析仪</p> 
<p style="text-align:center;"><img alt="" height="294" src="https://images2.imgbox.com/17/ed/AaLORhVW_o.png" width="297"></p> 
<p></p> 
<p>【软件】<a href="http://www.qdkingst.com/cn" rel="nofollow" title="逻辑分析仪软件下载地址">逻辑分析仪软件下载地址</a></p> 
<p>        通过这个分析工具，可以监听41种工业通讯总线数据，包括常见的232/TTL/485/422/IIC/SPI等，还可以自动探测串口波特率。</p> 
<p style="text-align:center;"><img alt="" height="335" src="https://images2.imgbox.com/87/ca/upkrluXD_o.jpg" width="569"></p> 
<p>CAN分析仪软件：采购后会有店家发送软件下载地址。</p> 
<p>        通过这个软件，可以探测CAN总线的波特率，并直接把抓到的CAN数据包保存到Excel中，还可以主动，周期性的发CAN包。</p> 
<p style="text-align:center;"><img alt="" height="258" src="https://images2.imgbox.com/59/90/6uPifAr7_o.png" width="564"></p> 
<p><a href="http://www.ceiwei.com/mt/news/shownews.php?id=1" rel="nofollow" title="串口抓包软件">串口抓包软件</a></p> 
<p>        这个是最常用的串口抓包工具，可以在各种视图中才查看到串口接收的时间，间隔，数据，数据的ASCII码，注册了会员，还可以把数据导出成txt做后续的python数据流分析。</p> 
<p style="text-align:center;"><img alt="" height="463" src="https://images2.imgbox.com/a2/f1/ERYbZpOR_o.png" width="564"></p> 
<p></p> 
<h2>3.基本使用方法</h2> 
<h3>3.1.总线识别</h3> 
<p>        一般在工厂的总线连接处，会明确的标识RS23/RS485，或者CAN_H，CAN_L，但如果出于保护或是标识看不到，那么可以先用逻辑分析仪接上去，看一下波形，或是用CAN分析仪怼上去，探测一下波特率。</p> 
<h3>3.2 总线抓包</h3> 
<p>        这类软件基本上是比较傻瓜化的，插上硬件，把驱动装好，选择串口，点击开始抓包就可以，然后保存为默认的文件格式，再回到办公室，打开抓包文件就可以分析了。</p> 
<h3>3.3 数据清洗和分析</h3> 
<p>针对串口抓取回来的数据，导出成11.txt（以UTF-8存储），通过以下的脚本，实现数据的清理。</p> 
<pre><code>numindex=0
countW=0
countR=0

PID='Data'
global fileHandname
fileHandname='11'
try:
    f = open(fileHandname+'.txt', 'r', encoding='UTF-8')
    #f = open('1.txt', 'r')
    #print('读取成功')
except:
    print('读取文件错误，请确认文件正常存放')
ResultData=''
data_lines = f.readlines()
f.close()
num = len(data_lines)  # 得到存储的行数
for i in range(num):  # 读取最新的ChannelNum行数据，
    line = data_lines[i]  # 从第0行开始
    dataread=''
    numindex=line.find(PID)
    numindex2=line.find('WRITE')
    numindex3=line.find('READ')
    numdouhao=line.find(',')
    if (numindex&gt;1):
        if((numindex2&gt;0) or (numindex3&gt;0)):
            if(line[numindex3+3]=='D'):
                dataread =line[0:numdouhao]+" "+PID+" 返回--&gt;"+line[numindex3+5:-1]+"\n"
            else:
                dataread ="\r"+line[0:numdouhao]+" "+PID+" 发出--&gt;"+line[numindex2+6:-1]+"\n"
    else:
        dataread=""
            
    ResultData=ResultData+dataread
    
file_handle = open(fileHandname+'-PID-'+PID+'.txt', 'w', encoding='UTF-8')  # 打开文件，以覆盖形式写入数据
file_handle.writelines(ResultData)
file_handle.close()
print("1梳理完毕")</code></pre> 
<h2>4.案例</h2> 
<p style="text-align:center;"><img alt="" height="383" src="https://images2.imgbox.com/ee/55/cQVo2IGk_o.png" width="598"></p> 
<p>协议较为简单时，可以通过串口网络抓包捕获，逐个核对功能、数据流和界面数据来定位协议，例如：选择1号机，点击启动，看到发出：</p> 
<pre><code>01 02 03</code></pre> 
<p>选择2号机，点击启动，发出：</p> 
<pre><code>02 02 04</code></pre> 
<p>则可识别出协议：</p> 
<p>启动命令为：</p> 
<table><tbody><tr><td> <p>地址</p> </td><td> <p>长度</p> </td><td> <p>含义</p> </td></tr><tr><td> <p>0</p> </td><td> <p>1</p> </td><td> <p>机器号</p> </td></tr><tr><td> <p>1</p> </td><td> <p>1</p> </td><td> <p>启动命令码：02</p> </td></tr><tr><td> <p>2</p> </td><td> <p>1</p> </td><td> <p>校验字节，校验方式：累加和</p> </td></tr></tbody></table> 
<p>然后用测试工具，发送同样的命令，测试是否可以正常的启动设备，完成协议验证。</p> 
<p>  通过以上的工具和方法，我分析出了3 款工控电脑的通讯控制协议，可以提供串口对机器进行，启动，停止，工艺下载，实时状态的读取和解析。</p> 
<h2>5.总结与重审</h2> 
<p>  之所以选择串口作为通讯接口，是因为设备本身的处理能力不强，无法上系统用网口进行通讯，所以它的处理能力也不会很强，不足以进行复杂的通讯加密，所以一般都是明文收发，很容易被捕获和分析。</p> 
<p>  未知攻焉知防，各位嵌入式系统程序员，你们设计的系统会存在这样的漏洞吗？</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bc1507d1cfbe30d082bf549f5803f22e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【HTML5】1.语法入门总结（第一部分）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/752a8b997a4a8733d629c58596e3ba7c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">docker搭建vulhub</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>