<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>LCD驱动理论与实例分析 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="LCD驱动理论与实例分析" />
<meta property="og:description" content="文章目录 前言一、基础篇1、LCD 基础知识分辨率像素格式LCD屏幕接口LCD 时间参数LCD屏幕时序* 时钟像素显存 2、eLCDIF 接口LCDIF_CTRL 寄存器LCDIF_CTRL1 寄存器寄存器 LCDIF_TRANSFER_COUNTLCDIF_VDCTRL0 寄存器LCDIF_VDCTRL1 寄存器LCDIF_VDCTRL2 寄存器LCDIF_VDCTRL4 寄存器LCDIF_CUR_BUF 和 LCDIF_NEXT_BUF 寄存器 3、LCD 裸机开发流程硬件原理分析程序编写lcd.hlcd.clcdAPI.hlcdAPI.c 二、驱动篇* FramebufferLCD 驱动简析proc 函数如何驱动一块 LCD？LCD 屏幕 IO 配置LCD 屏幕参数节点信息修改LCD 背光节点信息 LCD 屏幕基本测试 三、实例篇：驱动 RK3568 mipi 接口LCDCSI 和 DSI 的区别* 设备树配置panel-init-sequencedisplay-timingsportspwmft5x06 配置 CONFIG检查电压 前言 基础篇和驱动篇使用 I.MX6U-ALPHA 开发板。
实例篇使用 RK3568 开发板和 mipi LCD 模块。
一、基础篇 1、LCD 基础知识 分辨率 1080P：LCD 屏幕上的像素数量是
19201080 个，屏幕一列 1080 个像素点，一共 1920 列。
而像素点就是一个 RGB 灯，也就是由 R(红色)、G(绿色)和 B(蓝色)这三
种颜色组成的。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b9f329d130ad5dae96079705595ce68c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-07T17:51:53+08:00" />
<meta property="article:modified_time" content="2023-09-07T17:51:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">LCD驱动理论与实例分析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_4" rel="nofollow">前言</a></li><li><a href="#_8" rel="nofollow">一、基础篇</a></li><li><ul><li><a href="#1LCD__10" rel="nofollow">1、LCD 基础知识</a></li><li><ul><li><a href="#_11" rel="nofollow">分辨率</a></li><li><a href="#_19" rel="nofollow">像素格式</a></li><li><a href="#LCD_33" rel="nofollow">LCD屏幕接口</a></li><li><a href="#LCD__64" rel="nofollow">LCD 时间参数</a></li><li><a href="#LCD_85" rel="nofollow">LCD屏幕时序</a></li><li><a href="#__115" rel="nofollow">* 时钟像素</a></li><li><a href="#_131" rel="nofollow">显存</a></li></ul> 
   </li><li><a href="#2eLCDIF__135" rel="nofollow">2、eLCDIF 接口</a></li><li><ul><li><a href="#LCDIF_CTRL__148" rel="nofollow">LCDIF_CTRL 寄存器</a></li><li><a href="#LCDIF_CTRL1__179" rel="nofollow">LCDIF_CTRL1 寄存器</a></li><li><a href="#_LCDIF_TRANSFER_COUNT_182" rel="nofollow">寄存器 LCDIF_TRANSFER_COUNT</a></li><li><a href="#LCDIF_VDCTRL0__188" rel="nofollow">LCDIF_VDCTRL0 寄存器</a></li><li><a href="#LCDIF_VDCTRL1__210" rel="nofollow">LCDIF_VDCTRL1 寄存器</a></li><li><a href="#LCDIF_VDCTRL2__212" rel="nofollow">LCDIF_VDCTRL2 寄存器</a></li><li><a href="#LCDIF_VDCTRL4__222" rel="nofollow">LCDIF_VDCTRL4 寄存器</a></li><li><a href="#LCDIF_CUR_BUF__LCDIF_NEXT_BUF__228" rel="nofollow">LCDIF_CUR_BUF 和 LCDIF_NEXT_BUF 寄存器</a></li></ul> 
   </li><li><a href="#3LCD__231" rel="nofollow">3、LCD 裸机开发流程</a></li><li><ul><li><a href="#_243" rel="nofollow">硬件原理分析</a></li><li><a href="#_253" rel="nofollow">程序编写</a></li><li><ul><li><a href="#lcdh_254" rel="nofollow">lcd.h</a></li><li><a href="#lcdc_323" rel="nofollow">lcd.c</a></li><li><a href="#lcdAPIh_722" rel="nofollow">lcdAPI.h</a></li><li><a href="#lcdAPIc_738" rel="nofollow">lcdAPI.c</a></li></ul> 
   </li></ul> 
  </li></ul> 
  </li><li><a href="#_1004" rel="nofollow">二、驱动篇</a></li><li><ul><li><a href="#_Framebuffer_1015" rel="nofollow">* Framebuffer</a></li><li><a href="#LCD__1041" rel="nofollow">LCD 驱动简析</a></li><li><a href="#proc__1146" rel="nofollow">proc 函数</a></li><li><a href="#_LCD_1255" rel="nofollow">如何驱动一块 LCD？</a></li><li><ul><li><a href="#LCD__IO__1262" rel="nofollow">LCD 屏幕 IO 配置</a></li><li><a href="#LCD__1311" rel="nofollow">LCD 屏幕参数节点信息修改</a></li><li><a href="#LCD__1374" rel="nofollow">LCD 背光节点信息</a></li></ul> 
   </li><li><a href="#LCD__1428" rel="nofollow">LCD 屏幕基本测试</a></li></ul> 
  </li><li><a href="#_RK3568_mipi_LCD_1506" rel="nofollow">三、实例篇：驱动 RK3568 mipi 接口LCD</a></li><li><ul><li><a href="#CSI__DSI__1511" rel="nofollow">CSI 和 DSI 的区别</a></li><li><a href="#__1524" rel="nofollow">* 设备树配置</a></li><li><ul><li><a href="#panelinitsequence_1752" rel="nofollow">panel-init-sequence</a></li><li><a href="#displaytimings_1855" rel="nofollow">display-timings</a></li><li><a href="#ports_1858" rel="nofollow">ports</a></li><li><a href="#pwm_1865" rel="nofollow">pwm</a></li><li><a href="#ft5x06_1877" rel="nofollow">ft5x06</a></li></ul> 
   </li><li><a href="#_CONFIG_1879" rel="nofollow">配置 CONFIG</a></li><li><a href="#_1887" rel="nofollow">检查电压</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_4"></a>前言</h2> 
<p>基础篇和驱动篇使用 I.MX6U-ALPHA 开发板。<br> 实例篇使用 RK3568 开发板和 mipi LCD 模块。</p> 
<h2><a id="_8"></a>一、基础篇</h2> 
<h3><a id="1LCD__10"></a>1、LCD 基础知识</h3> 
<h4><a id="_11"></a>分辨率</h4> 
<p>1080P：LCD 屏幕上的像素数量是<br> 1920<em>1080 个，屏幕一列 1080 个像素点，一共 1920 列。<br> 而像素点就是一个 RGB 灯，也就是由 R(红色)、G(绿色)和 B(蓝色)这三<br> 种颜色组成的。<br> <img src="https://images2.imgbox.com/57/9c/RiMnlGjh_o.png" alt="在这里插入图片描述"><br> 2K：2560</em>1440 个像素点<br> 4K：3840*2160 个像素点</p> 
<h4><a id="_19"></a>像素格式</h4> 
<p>一般一个 R、<br> G、B 分别使用 8bit 的数据，一个像素点就是 8bit*3=24bit，如果再加入 8bit 的 Alpha(透明)通道的话一个像素点就是 32bit，也就是 4 个字节，这种像素格式称为 ARGB8888。<br> ARGB8888 格式的四个字节每个位的分配如图：<br> <img src="https://images2.imgbox.com/0e/0a/nT9ovhPh_o.png" alt="在这里插入图片描述"><br> bit31~bit24 是 Alpha 通道，bit23~bit16 是<br> RED 通道，bit15~bit14 是 GREEN 通道，bit7~bit0 是 BLUE 通道。<br> 红色对应的值为<br> 0X00FF0000<br> 蓝色对应的值为 0X000000FF<br> 绿色对应的值为 0X0000FF00<br> 黑色对应的值为 0X00000000<br> 白色对应的值为 0X00FFFFFF<br> <img src="https://images2.imgbox.com/e3/83/ofVV8KZa_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="LCD_33"></a>LCD屏幕接口</h4> 
<p>显示器上常见的 VGA、HDMI、DP 等等。<br> 一般比较低级的处理器只支持 RGB 接口，RGB 接口的信号线如表所示：</p> 
<table><thead><tr><th>信号线</th><th>描述</th></tr></thead><tbody><tr><td>R[7:0]</td><td>8 根红色数据线</td></tr><tr><td>G[7:0]</td><td>8 根绿色数据线</td></tr><tr><td>B[7:0]</td><td>8 根蓝色数据线</td></tr><tr><td>DE</td><td>数据使能线</td></tr><tr><td>VSYNC</td><td>垂直同步信号线</td></tr><tr><td>HSYNC</td><td>水平同步信号线</td></tr><tr><td>PCLK</td><td>像素时钟信号线</td></tr></tbody></table> 
<p>RGB 接口一般有两种驱动模式：<strong>DE</strong> 模式和 <strong>HV</strong> 模式。</p> 
<ul><li>DE 模式需要用到 DE 信号线</li><li>HV 模式不需要用到 DE 信号线</li><li>DE模式下是可以不需要 HSYNC 信号线</li></ul> 
<p>LCD 原理图的例子：<br> <img src="https://images2.imgbox.com/b4/64/5MpKJBPk_o.png" alt="在这里插入图片描述"><br> J1 是一个 40 pin 的 FPC 插座，采用 RGB888<br> 格式，还支持触摸屏和背光控制。<br> 注：触屏接口至少需要4根 I2C 管脚，背光控制需要几个 LED灯，并且用定时器开启 PWM 功能。<br> 这里需要再补充一个概念：LCD ID。<br> 通过 LCD 的 RGB 接口的阴角线来设定 LCD ID，可以在驱动程序中根据 ID 值来判断使用哪些程序（不同的初始化程序，例如分辨率），这样程序的兼容性就提高了。<br> 举个例子：<br> <img src="https://images2.imgbox.com/b3/c0/KVF6tspk_o.png" alt="在这里插入图片描述"><br> 分别通过R、G、B 的第8根数据线来区分 ID。<br> 实际上后来的方法是：设备树上写明分辨率。这个方法更好。</p> 
<h4><a id="LCD__64"></a>LCD 时间参数</h4> 
<p>LCD 的显示过程就是逐个像素控制颜色的过程，只是速度足够快，人看的时候就是一张张图片的显示，甚至和视频一样流畅。<br> 假如一个 LCD 的分<br> 辨率为 1024*600，那么其扫描如图：<br> <img src="https://images2.imgbox.com/2f/1e/Zb9DfQTa_o.png" alt="在这里插入图片描述"><br> 一帧图像也是由一行一行<br> 组成的。<br> HSYNC 是水平同步信号，也叫做行同步信号，当产生此信号，就表示开始显示新的<br> 一行了。<br> VSYNC 是垂直同步信号，也叫做帧<br> 同步信号，当产生此信号，就表示开始显示新的一帧图像了。<br> 显示器的“祖先”CRT 显示器，就是90年代的老电视机，通过电子枪发射像素数据信号到 LCD 控制器。当显示完一行以后会发出 HSYNC 信号，此时电子枪就会关闭，然后迅速的移动到屏幕的<br> 左边，当 HSYNC 信号结束以后就可以显示新的一行数据了，电子枪就会重新打开。<br> 在 HSYNC 信号结束到电子枪重新打开之间就会一段延时，这段延时就是 <strong>HBP</strong>。<br> 显示完一行后会关闭电子枪等待 HSYNC 信号，关闭电子枪到 HSYNC 信号产生之间就有一段延时，这段延时就是 <strong>HFP</strong>。<br> 显示完一帧图像后电子枪也会关闭，然后等待 VSYNC 信号，等待就有一段延时，这段延时就是 <strong>VFP</strong>。<br> VSYNC 信号产生，电子枪移动到左上角，VSYNC 信号结束到电子枪重新打开也有一段延时，这段延时就是 <strong>VBP</strong>。</p> 
<p>HBP、HFP、VFP、VBP 的具体数值要去查 LCD 数据手册。</p> 
<h4><a id="LCD_85"></a>LCD屏幕时序</h4> 
<p><img src="https://images2.imgbox.com/1e/85/iQVOviBB_o.png" alt="在这里插入图片描述"><br> HSYNC：行同步信号，高电平还是低电平有效需要看数据手册，这里是低电平有效。<br> HSPW：也叫 thp，表示 HSYNC 信号的持续时间。<br> HBP：也叫 thb，表示 HSYNC 的后肩（HSPW信号结束到 DE 信号开始的间隔时间）。<br> HOZVAL：也叫 thd，显示一行数据所需的时间，如果屏幕分辨率是 1024*600，那么 HOZVAL 就是1024.单位是 CLK。<br> HFP：也叫thf，表示 HSYNC 前肩，DE 信号结束到 HSYNC 重新开始的间隔时间。<br> （注意：以上时间单位全是 CLK）<br> <strong>HSYNC 信号发出后，需要等待 HSPW+HBP 个 CLK 时间才会接收到有效的像素数据</strong>。<br> 显示完一行数据后需要等待 HFP 个 CLK 时间才能发出下一个 HSYNC 信号，所以<br> <strong>显示一行需要的时间是：HSPW + HBP + HOZVAL + HFP</strong>。</p> 
<p>一帧图像就是由很多个行组成的，RGB LCD 的帧显示时序如图所示：<br> <img src="https://images2.imgbox.com/7b/97/vYDOkeVU_o.png" alt="在这里插入图片描述"><br> VSYNC：帧同步信号，表示开始显示新的一帧数据，需要查数据手册看是低电平有效还是高电平有效，这里是低电平有效。<br> VSPW：也叫 tvp，是 VSYNC 信号持续时间。<br> VBP：也叫 tvb，帧同步信号后肩。<br> LINE：也叫 tvd，显示一帧有效数据所需的时间，假如屏幕分辨率为 1024*600，<br> LINE 就是 600 行的时间。<br> VFP：也叫 tvf，帧同步信号前肩。<br> （注意：以上时间单位为行）</p> 
<p>显示一帧所需要的时间就是：<strong>VSPW+VBP+LINE+VFP</strong> 个<strong>行</strong>时间，最终的计算公式：<br> T = (VSPW+VBP+LINE+VFP) * (HSPW + HBP + HOZVAL + HFP)</p> 
<p>所以！配置 LCD 屏幕参数时，需要知道：<br> <strong>HOZVAL(屏幕有效宽度)、LINE(屏幕有效高度)、HBP、HSPW、HFP、VSPW、VBP 和 VFP</strong><br> 裸机开发时采用层层包装的方式，让显示调用的时间变得很直观。<br> 驱动开发时，只需要在设备树上填充好时序参数，然后交给内核就行了。</p> 
<h4><a id="__115"></a>* 时钟像素</h4> 
<p>像素时钟就是 LCD 的时钟信号。举一个例子，一款 LCD 的时序参数如下：<br> <img src="https://images2.imgbox.com/83/34/RzaEqPLM_o.png" alt="在这里插入图片描述"><br> 那么显示一帧图像所需要的<br> 时钟数就是：<br> = (VSPW+VBP+LINE+VFP) * (HSPW + HBP + HOZVAL + HFP)<br> = (3 + 20 + 600 + 12) * (20 + 140 + 1024 + 160)<br> = 635 * 1344<br> = 853440。<br> 显示一帧图像需要853440个时钟数，那么显示60帧就是：853440 * 60 = 51206400≈51.2M。<br> 所以像素时钟就是 51.2MHz。</p> 
<p>然后就是具体给 LCD 模块的时钟了，本例中的 LCD 是采用 eLCDIF 接口的，这个接口在其处理器上有几个时钟源可以选择：<br> <img src="https://images2.imgbox.com/d4/87/2aV45qaN_o.png" alt="在这里插入图片描述"><br> 时钟这部分，每个处理器都不一样，主要分配到最后，所用的时钟源给接口刚好是像素时钟的频率，也就是51.2MHZ。</p> 
<h4><a id="_131"></a>显存</h4> 
<p>若采用 ARGB8888 格式，一个像素需要 4 个字节的内存。1024<em>600 分辨率就需要 1024</em>600*4=2457600B≈2.4MB 内存。但是 RGB LCD 内部是没有内存的，所以需要在 DDR3 中分出一段内存作为 RGB LCD 屏幕的显存，我们如果要在屏幕上显示什么图像的话直接操作这部分显存即可。</p> 
<h3><a id="2eLCDIF__135"></a>2、eLCDIF 接口</h3> 
<p>eLCDIF 是大部分低级处理自带的液晶屏幕接口。主要支持三种接口：MPU 接口、VSYNC 接口和 DOTCLK 接口。</p> 
<ul><li>MPU 接口<br> MPU 接口用于在处理器和 LCD 屏幕直接传输数据和命令，这个接口用于 6080/8080 接<br> 口的 LCD 屏幕。</li><li>VSYNC 接口<br> VSYNC 接口时序和 MPU 接口时序基本一样，只是多了 VSYNC 信号来作为帧同步。</li><li>DOTCLK 接口<br> DOTCLK 接口就是用来连接 RGB LCD 接口屏幕的， 它包括 VSYNC、HSYNC、DOTCLK<br> 和 ENABLE(可选的)这四个信号，这样的接口通常被称为 RGB 接口。DOTCLK 接口时序如图所示：<br> <img src="https://images2.imgbox.com/7e/1d/AwfQhiuI_o.png" alt="在这里插入图片描述"><br> DOTCLK 接口就是直接连接 RGB 屏幕的，本例使用 DOTCLK 接口。<br> eLCDIF 要驱动起来 RGB LCD 屏幕，<strong>重点是配置好时间参数</strong>，这个通过配置相应的寄存器就可以了，所以我们接下来看一下 eLCDIF 接口的几个重要的寄存器。</li></ul> 
<h4><a id="LCDIF_CTRL__148"></a>LCDIF_CTRL 寄存器</h4> 
<p>此寄存器结构如图所示：<br> <img src="https://images2.imgbox.com/29/39/j0AT3kh9_o.png" alt="在这里插入图片描述"><br> 寄存器 LCDIF_CTRL 用到的重要位如下：<br> SFTRST(bit31)：eLCDIF 软复位控制位，当此位为 1 的话就会强制复位 LCD。<br> CLKGATE(bit30)：正常运行模式下，此位必须为 0！如果此位为 1 的话时钟就不会进入到<br> LCDIF。<br> BYPASS_COUNT(bit19)：如果要工作在 DOTCLK 模式的话就此位必须为 1。<br> VSYNC_MODE(bit18)：此位为 1 的话 LCDIF 工作在 VSYNC 接口模式。<br> DOTCLK_MODE(bit17)：此位为 1 的话 LCDIF 工作在 DOTCLK 接口模式。<br> INPUT_DATA_SWIZZLE(bit15:14)：输入数据字节交换设置，此位为 0 的话不交换字节也<br> 就是小端模式；为 1 的话交换所有字节，也就是大端模式；为 2 的话半字交换；为 3 的话在每<br> 个半字内进行字节交换。本章我们设置为 0，也就是不使用字节交换。<br> CSC_DATA_SWIZZLE(bit13:12) ： CSC 数 据 字 节 交 换 设 置 ， 交 换 方 式 和<br> INPUT_DATA_SWIZZLE 一样，本章设置为 0，不使用字节交换。<br> LCD_DATABUS_WIDTH(bit11:10)：LCD 数据总线宽度，为 0 的话总线宽度为 16 位；为<br> 1 的话总线宽度为 8 位；为 2 的话总线宽度为 18 位；为 3 的话总线宽度为 24 位。本章我们使用 24 位总线宽度。<br> WORD_LENGTH(bit9:8)：输入的数据格式，也就是像素数据宽度，为 0 的话每个像素 16<br> 位；为 1 的话每个像素 8 位；为 2 的话每个像素 18 位；为 3 的话每个像素 24 位。<br> MASTER(bit5)：为 1 的话设置 eLCDIF 工作在主模式。<br> DATA_FORMAT_16_BIT(bit3)：当此位为 1 并且 WORD_LENGTH 为 0 的时候像素格式<br> 为 ARGB555，当此位为 0 并且 WORD_LENGTH 为 0 的时候像素格式为 RGB565。<br> DATA_FORMAT_18_BIT(bit2)：只有当 WORD_LENGTH 为 2 的时候此位才有效，此位<br> 为 0 的话低 18 位有效，像素格为 RGB666，高 14 位数据无效。当此位为 1 的话高 18 位有效，<br> 像素格式依旧是 RGB666，但是低 14 位数据无效。<br> DATA_FORMAT_24_BIT(bit1)：只有当 WORD_LENGTH 为 3 的时候此位才有效，为 0 的<br> 时候表示全部的 24 位数据都有效。为 1 的话实际输入的数据有效位只有 18 位，虽然输入的是<br> 24 位数据，但是每个颜色通道的高 2 位数据会被丢弃掉。<br> RUN(bit0)：eLCDIF 接口运行控制位，当此位为 1 的话 eLCDIF 接口就开始传输数据，也<br> 就是 eLCDIF 的使能位。</p> 
<h4><a id="LCDIF_CTRL1__179"></a>LCDIF_CTRL1 寄存器</h4> 
<p>此寄存器我们只用到位 BYTE_PACKING_FORMAT(bit19:16)，此位用来决定在 32 位的数据中哪些字节的数据有效，默认值为 0XF，也就是所有的字节有效，当为 0 的话表示所有的字节都无效。如果显示的数据是 24 位(ARGB 格式，但是 A 通道不传输)的话就设置此位为 0X7。</p> 
<h4><a id="_LCDIF_TRANSFER_COUNT_182"></a>寄存器 LCDIF_TRANSFER_COUNT</h4> 
<p>这个寄存器用来设置所连接的 RGB LCD 屏幕分辨率大小，此寄存器结构如图所示：<br> <img src="https://images2.imgbox.com/30/ba/OIeOzWYp_o.png" alt="在这里插入图片描述"><br> LCDIF_TRANSFER_COUNT分为两部分，高16位和低16位，高16位是V_COUNT，是 LCD 的垂直分辨率。低 16 位是 H_COUNT，是 LCD 的水平分辨率。如果 LCD 分辨率为 1024*600 的话，那么 V_COUNT 就是 600，H_COUNT 就是 1024。</p> 
<h4><a id="LCDIF_VDCTRL0__188"></a>LCDIF_VDCTRL0 寄存器</h4> 
<p>这个寄存器是 VSYNC 和 DOTCLK 模式控制寄存器 0，寄存器结构如图所示：<br> <img src="https://images2.imgbox.com/17/f1/DQopvn0n_o.png" alt="在这里插入图片描述"><br> LCDIF_VDCTRL0 用到的重要位如下：<br> VSYNC_OEB(bit29)：VSYNC 信号方向控制位，为 0 的话 VSYNC 是输出，为 1 的话<br> VSYNC 是输入。<br> ENABLE_PRESENT(bit28)：EBABLE 数据线使能位，也就是 DE 数据线。为 1 的话使能<br> ENABLE 数据线，为 0 的话关闭 ENABLE 数据线。<br> VSYNC_POL(bit27)：VSYNC 数据线极性设置位，为 0 的话 VSYNC 低电平有效，为 1 的<br> 话 VSYNC 高电平有效，要根据所使用的 LCD 数据手册来设置。<br> HSYNC_POL(bit26)：HSYNC 数据线极性设置位，为 0 的话 HSYNC 低电平有效，为 1 的<br> 话 HSYNC 高电平有效，要根据所使用的 LCD 数据手册来设置。<br> DOTCLK_POL(bit25)：DOTCLK 数据线(像素时钟线 CLK) 极性设置位，为 0 的话下降沿<br> 锁存数据，上升沿捕获数据，为 1 的话相反，要根据所使用的 LCD 数据手册来设置。<br> ENABLE_POL(bit24)：EANBLE 数据线极性设置位，为 0 的话低电平有效，为 1 的话高<br> 电平有效。<br> VSYNC_PERIOD_UNIT(bit21)：VSYNC 信号周期单位，为 0 的话 VSYNC 周期单位为像<br> 素时钟。为 1 的话 VSYNC 周期单位是水平行，如果使用 DOTCLK 模式话就要设置为 1。<br> VSYNC_PULSE_WIDTH_UNIT(bit20) ： VSYNC 信 号 脉 冲 宽 度 单 位 ， 和<br> VSYNC_PERIOD_UNUT 一样，如果使用 DOTCLK 模式的话要设置为 1。<br> VSYNC_PULSE_WIDTH(bit17:0)：VSPW 参数设置位。</p> 
<h4><a id="LCDIF_VDCTRL1__210"></a>LCDIF_VDCTRL1 寄存器</h4> 
<p>这个寄存器是 VSYNC 和 DOTCLK 模式控制寄存器 1，此寄存器只有一个功能，用来设置 VSYNC 总周期，就是：屏幕高度+VSPW+VBP+VFP。</p> 
<h4><a id="LCDIF_VDCTRL2__212"></a>LCDIF_VDCTRL2 寄存器</h4> 
<p>这个寄存器分为高 16 位和低 16 位两部分，高 16 位是 HSYNC_PULSE_WIDTH，用来设置 HSYNC 信号宽度，也就是 HSPW。低 16 位是 HSYNC_PERIOD，设置 HSYNC 总周期，就是：屏幕宽度+HSPW+HBP+HFP。<br> 此寄存器结构如图所示：<br> <img src="https://images2.imgbox.com/56/29/wjVHOrnb_o.png" alt="在这里插入图片描述"><br> LCDIF_VDCTRL3 用到的重要位如下：<br> HORIZONTAL_WAIT_CNT(bit27:16)：此位用于 DOTCLK 模式，用于设置 HSYNC 信号<br> 产生到有效数据产生之间的时间，也就是 HSPW+HBP。<br> VERTICAL_WAIR_CNT(bit15:0)：和 HORIZONTAL_WAIT_CNT 一样，只是此位用于<br> VSYNC 信号，也就是 VSPW+VBP。</p> 
<h4><a id="LCDIF_VDCTRL4__222"></a>LCDIF_VDCTRL4 寄存器</h4> 
<p>寄存器结构如图所示：<br> <img src="https://images2.imgbox.com/1e/35/1WmzzejK_o.png" alt="在这里插入图片描述"><br> LCDIF_VDCTRL4 用到的重要位如下：<br> SYNC_SIGNALS_ON(bit18)：同步信号使能位，设置为 1 的话使能 VSYNC、HSYNC、DOTCLK 这些信号。<br> DOTCLK_H_VALID_DATA_CNT(bit15:0)：设置 LCD 的宽度，也就是水平像素数量。</p> 
<h4><a id="LCDIF_CUR_BUF__LCDIF_NEXT_BUF__228"></a>LCDIF_CUR_BUF 和 LCDIF_NEXT_BUF 寄存器</h4> 
<p>这两个寄存器分别为当前帧和下一帧缓冲区，也就是 LCD 显存。一般这两个寄存器保存同一个地址，也就是划分给 LCD 的显存首地址。</p> 
<h3><a id="3LCD__231"></a>3、LCD 裸机开发流程</h3> 
<ol><li>初始化 LCD 所使用的 IO<br> 首先肯定是初始化 LCD 所示使用的 IO，将其复用为 eLCDIF 接口 IO。</li><li>设置 LCD 的像素时钟<br> 查阅所使用的 LCD 屏幕数据手册，或者自己计算出的时钟像素，然后设置 CCM 相应的寄存器。</li><li>配置 eLCDIF 接口<br> 设置 LCDIF 的寄存器 CTRL、CTRL1、TRANSFER_COUNT、VDCTRL0~4、CUR_BUF 和 NEXT_BUF。根据 LCD 的数据手册设置相应的参数。</li><li>编写 API 函数<br> 驱动 LCD 屏幕的目的就是显示内容，所以需要编写一些基本的 API 函数，比如画点、画<br> 线、画圆函数，字符串显示函数等。</li></ol> 
<h4><a id="_243"></a>硬件原理分析</h4> 
<p>本试验用到的资源如下：<br> ①、指示灯 LED0。<br> ②、RGB LCD 接口。<br> ③、DDR3<br> ④、eLCDIF<br> RGB LCD 接口在 I.MX6U-ALPHA 开发板底板上，原理图如图所示：<br> <img src="https://images2.imgbox.com/ff/11/vmEPkuFb_o.png" alt="在这里插入图片描述"><br> 三个 SGM3157 的目的是在未使用 RGBLCD 的时候将 LCD_DATA7、LCD_DATA15 和 LCD_DATA23 这三个线隔离开来，因为屏幕的 LCD_R7/G7/B7 这几个线用来设置 LCD 的 ID，所以这几根线上有上拉/下拉电阻。<br> 实际不需要这么麻烦。到了驱动，ID 都是写进设备树的。</p> 
<h4><a id="_253"></a>程序编写</h4> 
<h5><a id="lcdh_254"></a>lcd.h</h5> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"fsl_common.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"fsl_iomuxc.h"</span></span>

<span class="token comment">/* 颜色 */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_BLUE</span>          <span class="token expression"><span class="token number">0x000000FF</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_GREEN</span>          <span class="token expression"><span class="token number">0x0000FF00</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_RED</span>           <span class="token expression"><span class="token number">0x00FF0000</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_CYAN</span>          <span class="token expression"><span class="token number">0x0000FFFF</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_MAGENTA</span>       <span class="token expression"><span class="token number">0x00FF00FF</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_YELLOW</span>          <span class="token expression"><span class="token number">0x00FFFF00</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_LIGHTBLUE</span>      <span class="token expression"><span class="token number">0x008080FF</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_LIGHTGREEN</span>      <span class="token expression"><span class="token number">0x0080FF80</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_LIGHTRED</span>      <span class="token expression"><span class="token number">0x00FF8080</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_LIGHTCYAN</span>      <span class="token expression"><span class="token number">0x0080FFFF</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_LIGHTMAGENTA</span>  <span class="token expression"><span class="token number">0x00FF80FF</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_LIGHTYELLOW</span>   <span class="token expression"><span class="token number">0x00FFFF80</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_DARKBLUE</span>      <span class="token expression"><span class="token number">0x00000080</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_DARKGREEN</span>      <span class="token expression"><span class="token number">0x00008000</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_DARKRED</span>       <span class="token expression"><span class="token number">0x00800000</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_DARKCYAN</span>      <span class="token expression"><span class="token number">0x00008080</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_DARKMAGENTA</span>   <span class="token expression"><span class="token number">0x00800080</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_DARKYELLOW</span>      <span class="token expression"><span class="token number">0x00808000</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_WHITE</span>          <span class="token expression"><span class="token number">0x00FFFFFF</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_LIGHTGRAY</span>      <span class="token expression"><span class="token number">0x00D3D3D3</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_GRAY</span>          <span class="token expression"><span class="token number">0x00808080</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_DARKGRAY</span>      <span class="token expression"><span class="token number">0x00404040</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_BLACK</span>          <span class="token expression"><span class="token number">0x00000000</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_BROWN</span>          <span class="token expression"><span class="token number">0x00A52A2A</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_ORANGE</span>          <span class="token expression"><span class="token number">0x00FFA500</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_TRANSPARENT</span>   <span class="token expression"><span class="token number">0x00000000</span></span></span>

<span class="token comment">/* LCD显存地址 */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCD_FRAMEBUF_ADDR</span>    <span class="token expression"><span class="token punctuation">(</span><span class="token number">0x89000000</span><span class="token punctuation">)</span></span></span>

<span class="token comment">/* LCD控制参数结构体 */</span>
<span class="token keyword">struct</span> <span class="token class-name">tftlcd_typedef</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">unsigned</span> <span class="token keyword">short</span> height<span class="token punctuation">;</span>        <span class="token comment">/* LCD屏幕高度 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">short</span> width<span class="token punctuation">;</span>        <span class="token comment">/* LCD屏幕宽度 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> pixsize<span class="token punctuation">;</span>        <span class="token comment">/* LCD每个像素所占字节大小 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">short</span> vspw<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">short</span> vbpd<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">short</span> vfpd<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">short</span> hspw<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">short</span> hbpd<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">short</span> hfpd<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> framebuffer<span class="token punctuation">;</span>     <span class="token comment">/* LCD显存首地址         */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> forecolor<span class="token punctuation">;</span>        <span class="token comment">/* 前景色 */</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> backcolor<span class="token punctuation">;</span>        <span class="token comment">/* 背景色 */</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">extern</span> <span class="token keyword">struct</span> <span class="token class-name">tftlcd_typedef</span> tftlcd_dev<span class="token punctuation">;</span>

<span class="token comment">/* 函数声明 */</span>
<span class="token keyword">void</span> <span class="token function">lcd_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">lcdgpio_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">lcdclk_init</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> loopDiv<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> prediv<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> div<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">lcd_reset</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">lcd_noreset</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">lcd_enable</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">video_pllinit</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> loopdivi<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> postdivi<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">lcd_drawpoint</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> x<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> y<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">inline</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">lcd_readpoint</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> x<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">lcd_clear</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">lcd_fill</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span>    <span class="token keyword">short</span> x0<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> y0<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> x1<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> y1<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="lcdc_323"></a>lcd.c</h5> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_lcd.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_gpio.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_delay.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stdio.h"</span></span>

<span class="token comment">/* 液晶屏参数结构体 */</span>
<span class="token keyword">struct</span> <span class="token class-name">tftlcd_typedef</span> tftlcd_dev<span class="token punctuation">;</span>

<span class="token comment">/*
 * @description    : 始化LCD
 * @param         : 无
 * @return         : 无
 */</span>
<span class="token keyword">void</span> <span class="token function">lcd_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">lcdgpio_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">/* 初始化IO         */</span>
    <span class="token function">lcdclk_init</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/* 初始化LCD时钟 */</span>
    <span class="token function">lcd_reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">/* 复位LCD      */</span>
    <span class="token function">delayms</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">/* 延时10ms     */</span>
    <span class="token function">lcd_noreset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">/* 结束复位         */</span>

    <span class="token comment">/* TFTLCD参数结构体初始化 */</span>
    tftlcd_dev<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">600</span><span class="token punctuation">;</span>    
    tftlcd_dev<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>
    tftlcd_dev<span class="token punctuation">.</span>pixsize <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>                <span class="token comment">/* ARGB8888模式，每个像素4字节 */</span>
    tftlcd_dev<span class="token punctuation">.</span>vspw <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    tftlcd_dev<span class="token punctuation">.</span>vbpd <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    tftlcd_dev<span class="token punctuation">.</span>vfpd <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
    tftlcd_dev<span class="token punctuation">.</span>hspw <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span>
    tftlcd_dev<span class="token punctuation">.</span>hbpd <span class="token operator">=</span> <span class="token number">140</span><span class="token punctuation">;</span>
    tftlcd_dev<span class="token punctuation">.</span>hfpd <span class="token operator">=</span> <span class="token number">160</span><span class="token punctuation">;</span>
    tftlcd_dev<span class="token punctuation">.</span>framebuffer <span class="token operator">=</span> LCD_FRAMEBUF_ADDR<span class="token punctuation">;</span>    
    tftlcd_dev<span class="token punctuation">.</span>backcolor <span class="token operator">=</span> LCD_WHITE<span class="token punctuation">;</span>    <span class="token comment">/* 背景色为白色 */</span>
    tftlcd_dev<span class="token punctuation">.</span>forecolor <span class="token operator">=</span> LCD_BLACK<span class="token punctuation">;</span>    <span class="token comment">/* 前景色为黑色 */</span>
    
    <span class="token comment">/* 初始化ELCDIF的CTRL寄存器
     * bit [31] 0 : 停止复位
     * bit [19] 1 : 旁路计数器模式
     * bit [17] 1 : LCD工作在dotclk模式
     * bit [15:14] 00 : 输入数据不交换
     * bit [13:12] 00 : CSC不交换
     * bit [11:10] 11 : 24位总线宽度
     * bit [9:8]   11 : 24位数据宽度,也就是RGB888
     * bit [5]     1  : elcdif工作在主模式
     * bit [1]     0  : 所有的24位均有效
     */</span>
     LCDIF<span class="token operator">-&gt;</span>CTRL <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">19</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">17</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;&lt;</span> <span class="token number">14</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;&lt;</span> <span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">|</span>
                     <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">&lt;&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/*
     * 初始化ELCDIF的寄存器CTRL1
     * bit [19:16]  : 0X7 ARGB模式下，传输24位数据，A通道不用传输
     */</span>    
     LCDIF<span class="token operator">-&gt;</span>CTRL1 <span class="token operator">=</span> <span class="token number">0X7</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> 

     <span class="token comment">/*
      * 初始化ELCDIF的寄存器TRANSFER_COUNT寄存器
      * bit [31:16]  : 高度
      * bit [15:0]   : 宽度
      */</span>
    LCDIF<span class="token operator">-&gt;</span>TRANSFER_COUNT  <span class="token operator">=</span> <span class="token punctuation">(</span>tftlcd_dev<span class="token punctuation">.</span>height <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>tftlcd_dev<span class="token punctuation">.</span>width <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/*
     * 初始化ELCDIF的VDCTRL0寄存器
     * bit [29] 0 : VSYNC输出
     * bit [28] 1 : 使能ENABLE输出
     * bit [27] 0 : VSYNC低电平有效
     * bit [26] 0 : HSYNC低电平有效
     * bit [25] 0 : DOTCLK上升沿有效
     * bit [24] 1 : ENABLE信号高电平有效
     * bit [21] 1 : DOTCLK模式下设置为1
     * bit [20] 1 : DOTCLK模式下设置为1
     * bit [17:0] : vsw参数
     */</span>
    LCDIF<span class="token operator">-&gt;</span>VDCTRL0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">//先清零</span>
    LCDIF<span class="token operator">-&gt;</span>VDCTRL0 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;&lt;</span> <span class="token number">29</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">28</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;&lt;</span> <span class="token number">27</span><span class="token punctuation">)</span> <span class="token operator">|</span>
                     <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;&lt;</span> <span class="token number">26</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;&lt;</span> <span class="token number">25</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">|</span>
                     <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">21</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>tftlcd_dev<span class="token punctuation">.</span>vspw <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/*
     * 初始化ELCDIF的VDCTRL1寄存器
     * 设置VSYNC总周期
     */</span>  
    LCDIF<span class="token operator">-&gt;</span>VDCTRL1 <span class="token operator">=</span> tftlcd_dev<span class="token punctuation">.</span>height <span class="token operator">+</span> tftlcd_dev<span class="token punctuation">.</span>vspw <span class="token operator">+</span> tftlcd_dev<span class="token punctuation">.</span>vfpd <span class="token operator">+</span> tftlcd_dev<span class="token punctuation">.</span>vbpd<span class="token punctuation">;</span>  <span class="token comment">//VSYNC周期</span>

     <span class="token comment">/*
      * 初始化ELCDIF的VDCTRL2寄存器
      * 设置HSYNC周期
      * bit[31:18] ：hsw
      * bit[17:0]  : HSYNC总周期
      */</span> 
    LCDIF<span class="token operator">-&gt;</span>VDCTRL2 <span class="token operator">=</span> <span class="token punctuation">(</span>tftlcd_dev<span class="token punctuation">.</span>hspw <span class="token operator">&lt;&lt;</span> <span class="token number">18</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>tftlcd_dev<span class="token punctuation">.</span>width <span class="token operator">+</span> tftlcd_dev<span class="token punctuation">.</span>hspw <span class="token operator">+</span> tftlcd_dev<span class="token punctuation">.</span>hfpd <span class="token operator">+</span> tftlcd_dev<span class="token punctuation">.</span>hbpd<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/*
     * 初始化ELCDIF的VDCTRL3寄存器
     * 设置HSYNC周期
     * bit[27:16] ：水平等待时钟数
     * bit[15:0]  : 垂直等待时钟数
     */</span> 
    LCDIF<span class="token operator">-&gt;</span>VDCTRL3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>tftlcd_dev<span class="token punctuation">.</span>hbpd <span class="token operator">+</span> tftlcd_dev<span class="token punctuation">.</span>hspw<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>tftlcd_dev<span class="token punctuation">.</span>vbpd <span class="token operator">+</span> tftlcd_dev<span class="token punctuation">.</span>vspw<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/*
     * 初始化ELCDIF的VDCTRL4寄存器
     * 设置HSYNC周期
     * bit[18] 1 : 当使用VSHYNC、HSYNC、DOTCLK的话此为置1
     * bit[17:0]  : 宽度
     */</span> 
    
    LCDIF<span class="token operator">-&gt;</span>VDCTRL4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">18</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>tftlcd_dev<span class="token punctuation">.</span>width<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/*
     * 初始化ELCDIF的CUR_BUF和NEXT_BUF寄存器
     * 设置当前显存地址和下一帧的显存地址
     */</span>
    LCDIF<span class="token operator">-&gt;</span>CUR_BUF <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>tftlcd_dev<span class="token punctuation">.</span>framebuffer<span class="token punctuation">;</span>
    LCDIF<span class="token operator">-&gt;</span>NEXT_BUF <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>tftlcd_dev<span class="token punctuation">.</span>framebuffer<span class="token punctuation">;</span>
    <span class="token function">lcd_enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">/* 使能LCD */</span>
    <span class="token function">delayms</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">lcd_clear</span><span class="token punctuation">(</span>LCD_WHITE<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/* 清屏 */</span>
    
<span class="token punctuation">}</span>

<span class="token comment">/*
 * IO引脚:     LCD_DATA00 -&gt; LCD_B0
 *            LCD_DATA01 -&gt; LCD_B1
 *            LCD_DATA02 -&gt; LCD_B2
 *            LCD_DATA03 -&gt; LCD_B3
 *            LCD_DATA04 -&gt; LCD_B4
 *            LCD_DATA05 -&gt; LCD_B5
 *            LCD_DATA06 -&gt; LCD_B6
 *            LCD_DATA07 -&gt; LCD_B7
 *
 *            LCD_DATA08 -&gt; LCD_G0
 *            LCD_DATA09 -&gt; LCD_G1
 *            LCD_DATA010 -&gt; LCD_G2
 *            LCD_DATA011 -&gt; LCD_G3
 *            LCD_DATA012 -&gt; LCD_G4
 *            LCD_DATA012 -&gt; LCD_G4
 *            LCD_DATA013 -&gt; LCD_G5
 *            LCD_DATA014 -&gt; LCD_G6
 *            LCD_DATA015 -&gt; LCD_G7
 *
 *            LCD_DATA016 -&gt; LCD_R0
 *            LCD_DATA017 -&gt; LCD_R1
 *            LCD_DATA018 -&gt; LCD_R2 
 *            LCD_DATA019 -&gt; LCD_R3
 *            LCD_DATA020 -&gt; LCD_R4
 *            LCD_DATA021 -&gt; LCD_R5
 *            LCD_DATA022 -&gt; LCD_R6
 *            LCD_DATA023 -&gt; LCD_R7
 *
 *            LCD_CLK -&gt; LCD_CLK
 *            LCD_VSYNC -&gt; LCD_VSYNC
 *            LCD_HSYNC -&gt; LCD_HSYNC
 *            LCD_DE -&gt; LCD_DE
 *            LCD_BL -&gt; GPIO1_IO08 
 */</span>
 
<span class="token comment">/*
 * @description    : LCD GPIO初始化
 * @param         : 无
 * @return         : 无
 */</span>
<span class="token keyword">void</span> <span class="token function">lcdgpio_init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token class-name">gpio_pin_config_t</span> gpio_config<span class="token punctuation">;</span>
    

    <span class="token comment">/* 1、IO初始化复用功能 */</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA00_LCDIF_DATA00<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA01_LCDIF_DATA01<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA02_LCDIF_DATA02<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA03_LCDIF_DATA03<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA04_LCDIF_DATA04<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA05_LCDIF_DATA05<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA06_LCDIF_DATA06<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA07_LCDIF_DATA07<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA08_LCDIF_DATA08<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA09_LCDIF_DATA09<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA10_LCDIF_DATA10<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA11_LCDIF_DATA11<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA12_LCDIF_DATA12<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA13_LCDIF_DATA13<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA14_LCDIF_DATA14<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA15_LCDIF_DATA15<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA16_LCDIF_DATA16<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA17_LCDIF_DATA17<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA18_LCDIF_DATA18<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA19_LCDIF_DATA19<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA20_LCDIF_DATA20<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA21_LCDIF_DATA21<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA22_LCDIF_DATA22<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA23_LCDIF_DATA23<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_CLK_LCDIF_CLK<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_ENABLE_LCDIF_ENABLE<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_HSYNC_LCDIF_HSYNC<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_LCD_VSYNC_LCDIF_VSYNC<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">IOMUXC_SetPinMux</span><span class="token punctuation">(</span>IOMUXC_GPIO1_IO08_GPIO1_IO08<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">/* 背光BL引脚 */</span>

    <span class="token comment">/* 2、配置LCD IO属性    
     *bit 16:0 HYS关闭
     *bit [15:14]: 0 默认22K上拉
     *bit [13]: 0 pull功能
     *bit [12]: 0 pull/keeper使能 
     *bit [11]: 0 关闭开路输出
     *bit [7:6]: 10 速度100Mhz
     *bit [5:3]: 111 驱动能力为R0/7
     *bit [0]: 1 高转换率
     */</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA00_LCDIF_DATA00<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA01_LCDIF_DATA01<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA02_LCDIF_DATA02<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA03_LCDIF_DATA03<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA04_LCDIF_DATA04<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA05_LCDIF_DATA05<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA06_LCDIF_DATA06<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA07_LCDIF_DATA07<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA08_LCDIF_DATA08<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA09_LCDIF_DATA09<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA10_LCDIF_DATA10<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA11_LCDIF_DATA11<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA12_LCDIF_DATA12<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA13_LCDIF_DATA13<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA14_LCDIF_DATA14<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA15_LCDIF_DATA15<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA16_LCDIF_DATA16<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA17_LCDIF_DATA17<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA18_LCDIF_DATA18<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA19_LCDIF_DATA19<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA20_LCDIF_DATA20<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA21_LCDIF_DATA21<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA22_LCDIF_DATA22<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_DATA23_LCDIF_DATA23<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_CLK_LCDIF_CLK<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_ENABLE_LCDIF_ENABLE<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_HSYNC_LCDIF_HSYNC<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_LCD_VSYNC_LCDIF_VSYNC<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">IOMUXC_SetPinConfig</span><span class="token punctuation">(</span>IOMUXC_GPIO1_IO08_GPIO1_IO08<span class="token punctuation">,</span><span class="token number">0xB9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/* 背光BL引脚         */</span>

    <span class="token comment">/* GPIO初始化 */</span>
    gpio_config<span class="token punctuation">.</span>direction <span class="token operator">=</span> kGPIO_DigitalOutput<span class="token punctuation">;</span>            <span class="token comment">/* 输出             */</span>
    gpio_config<span class="token punctuation">.</span>outputLogic <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>                             <span class="token comment">/* 默认关闭背光 */</span>
    <span class="token function">gpio_init</span><span class="token punctuation">(</span>GPIO1<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>gpio_config<span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">/* 背光默认打开 */</span>
    <span class="token function">gpio_pinwrite</span><span class="token punctuation">(</span>GPIO1<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                <span class="token comment">/* 打开背光     */</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
 * @description        : LCD时钟初始化, LCD时钟计算公式如下：
 *                      LCD CLK = 24 * loopDiv / prediv / div
 * @param -    loopDiv    : loopDivider值
 * @param -    loopDiv : lcdifprediv值
 * @param -    div        : lcdifdiv值
 * @return             : 无
 */</span>
<span class="token keyword">void</span> <span class="token function">lcdclk_init</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> loopDiv<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> prediv<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> div<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">/* 先初始化video pll 
     * VIDEO PLL = OSC24M * (loopDivider + (denominator / numerator)) / postDivider
      *不使用小数分频器，因此denominator和numerator设置为0
      */</span>
    CCM_ANALOG<span class="token operator">-&gt;</span>PLL_VIDEO_NUM <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment">/* 不使用小数分频器 */</span>
    CCM_ANALOG<span class="token operator">-&gt;</span>PLL_VIDEO_DENOM <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    

    <span class="token comment">/*
     * PLL_VIDEO寄存器设置
     * bit[13]:    1   使能VIDEO PLL时钟
     * bit[20:19]  2  设置postDivider为1分频
     * bit[6:0] : 32  设置loopDivider寄存器
     */</span>
    CCM_ANALOG<span class="token operator">-&gt;</span>PLL_VIDEO <span class="token operator">=</span>  <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">&lt;&lt;</span> <span class="token number">19</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">13</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span>loopDiv <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token comment">/*
     * MISC2寄存器设置
     * bit[31:30]: 0  VIDEO的post-div设置，时钟源来源于postDivider，1分频
     */</span>
    CCM_ANALOG<span class="token operator">-&gt;</span>MISC2 <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">&lt;&lt;</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    CCM_ANALOG<span class="token operator">-&gt;</span>MISC2 <span class="token operator">=</span> <span class="token number">0</span> <span class="token operator">&lt;&lt;</span> <span class="token number">30</span><span class="token punctuation">;</span>

    <span class="token comment">/* LCD时钟源来源与PLL5，也就是VIDEO           PLL  */</span>
    CCM<span class="token operator">-&gt;</span>CSCDR2 <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">7</span> <span class="token operator">&lt;&lt;</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      
    CCM<span class="token operator">-&gt;</span>CSCDR2 <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">&lt;&lt;</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">/* 设置LCDIF_PRE_CLK使用PLL5 */</span>

    <span class="token comment">/* 设置LCDIF_PRE分频 */</span>
    CCM<span class="token operator">-&gt;</span>CSCDR2 <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">7</span> <span class="token operator">&lt;&lt;</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
    CCM<span class="token operator">-&gt;</span>CSCDR2 <span class="token operator">|=</span> <span class="token punctuation">(</span>prediv <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">12</span><span class="token punctuation">;</span>    <span class="token comment">/* 设置分频  */</span>

    <span class="token comment">/* 设置LCDIF分频 */</span>
    CCM<span class="token operator">-&gt;</span>CBCMR <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">7</span> <span class="token operator">&lt;&lt;</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    
    CCM<span class="token operator">-&gt;</span>CBCMR <span class="token operator">|=</span> <span class="token punctuation">(</span>div <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">23</span><span class="token punctuation">;</span>                

    <span class="token comment">/* 设置LCD时钟源为LCDIF_PRE时钟 */</span>
    CCM<span class="token operator">-&gt;</span>CSCDR2 <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">7</span> <span class="token operator">&lt;&lt;</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">/* 清除原来的设置             */</span>
    CCM<span class="token operator">-&gt;</span>CSCDR2 <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&lt;&lt;</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">/* LCDIF_PRE时钟源选择LCDIF_PRE时钟 */</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
 * @description    : 复位ELCDIF接口
 * @param         : 无
 * @return         : 无
 */</span>
<span class="token keyword">void</span> <span class="token function">lcd_reset</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    LCDIF<span class="token operator">-&gt;</span>CTRL  <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">31</span><span class="token punctuation">;</span> <span class="token comment">/* 强制复位 */</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
 * @description    : 结束复位ELCDIF接口
 * @param         : 无
 * @return         : 无
 */</span>
<span class="token keyword">void</span> <span class="token function">lcd_noreset</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    LCDIF<span class="token operator">-&gt;</span>CTRL  <span class="token operator">=</span> <span class="token number">0</span><span class="token operator">&lt;&lt;</span><span class="token number">31</span><span class="token punctuation">;</span> <span class="token comment">/* 取消强制复位 */</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
 * @description    : 使能ELCDIF接口
 * @param         : 无
 * @return         : 无
 */</span>
<span class="token keyword">void</span> <span class="token function">lcd_enable</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    LCDIF<span class="token operator">-&gt;</span>CTRL <span class="token operator">|=</span> <span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">/* 使能ELCDIF */</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
 * @description        : 画点函数 
 * @param - x        : x轴坐标
 * @param - y        : y轴坐标
 * @param - color    : 颜色值
 * @return             : 无
 */</span>
<span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">lcd_drawpoint</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> x<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> y<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> color<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> 
      <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>tftlcd_dev<span class="token punctuation">.</span>framebuffer <span class="token operator">+</span> 
                     tftlcd_dev<span class="token punctuation">.</span>pixsize <span class="token operator">*</span> <span class="token punctuation">(</span>tftlcd_dev<span class="token punctuation">.</span>width <span class="token operator">*</span> y<span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=</span>color<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
 * @description        : 读取指定点的颜色值
 * @param - x        : x轴坐标
 * @param - y        : y轴坐标
 * @return             : 读取到的指定点的颜色值
 */</span>
<span class="token keyword">inline</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">lcd_readpoint</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> x<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> y<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> 
    <span class="token keyword">return</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>tftlcd_dev<span class="token punctuation">.</span>framebuffer <span class="token operator">+</span> 
           tftlcd_dev<span class="token punctuation">.</span>pixsize <span class="token operator">*</span> <span class="token punctuation">(</span>tftlcd_dev<span class="token punctuation">.</span>width <span class="token operator">*</span> y <span class="token operator">+</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
 * @description        : 清屏
 * @param - color    : 颜色值
 * @return             : 读取到的指定点的颜色值
 */</span>
<span class="token keyword">void</span> <span class="token function">lcd_clear</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> color<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> num<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> 

    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token operator">*</span>startaddr<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span>tftlcd_dev<span class="token punctuation">.</span>framebuffer<span class="token punctuation">;</span>    <span class="token comment">//指向帧缓存首地址</span>
    num<span class="token operator">=</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span>tftlcd_dev<span class="token punctuation">.</span>width <span class="token operator">*</span> tftlcd_dev<span class="token punctuation">.</span>height<span class="token punctuation">;</span>            <span class="token comment">//缓冲区总长度</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> num<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        startaddr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> color<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>        
<span class="token punctuation">}</span>

<span class="token comment">/*
 * @description        : 以指定的颜色填充一块矩形
 * @param - x0        : 矩形起始点坐标X轴
 * @param - y0        : 矩形起始点坐标Y轴
 * @param - x1        : 矩形终止点坐标X轴
 * @param - y1        : 矩形终止点坐标Y轴
 * @param - color    : 要填充的颜色
 * @return             : 读取到的指定点的颜色值
 */</span>
<span class="token keyword">void</span> <span class="token function">lcd_fill</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> x0<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> y0<span class="token punctuation">,</span> 
              <span class="token keyword">unsigned</span> <span class="token keyword">short</span> x1<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> y1<span class="token punctuation">,</span> 
              <span class="token keyword">unsigned</span> <span class="token keyword">int</span> color<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">unsigned</span> <span class="token keyword">short</span> x<span class="token punctuation">,</span> y<span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>x0 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> x0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>y0 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> y0 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>x1 <span class="token operator">&gt;=</span> tftlcd_dev<span class="token punctuation">.</span>width<span class="token punctuation">)</span> x1 <span class="token operator">=</span> tftlcd_dev<span class="token punctuation">.</span>width <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>y1 <span class="token operator">&gt;=</span> tftlcd_dev<span class="token punctuation">.</span>height<span class="token punctuation">)</span> y1 <span class="token operator">=</span> tftlcd_dev<span class="token punctuation">.</span>height <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>y <span class="token operator">=</span> y0<span class="token punctuation">;</span> y <span class="token operator">&lt;=</span> y1<span class="token punctuation">;</span> y<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>x <span class="token operator">=</span> x0<span class="token punctuation">;</span> x <span class="token operator">&lt;=</span> x1<span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token function">lcd_drawpoint</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> color<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="lcdAPIh_722"></a>lcdAPI.h</h5> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_lcd.h"</span></span>

<span class="token comment">/* 函数声明 */</span>
<span class="token keyword">void</span> <span class="token function">lcd_drawline</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> x1<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> y1<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> x2<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> y2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">lcd_draw_rectangle</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> x1<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> y1<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> x2<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> y2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">lcd_draw_Circle</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> x0<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> y0<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">lcd_showchar</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span>     <span class="token keyword">short</span> x<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> y<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> num<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> size<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">lcd_pow</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> m<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">lcd_shownum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> x<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> y<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> num<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> len<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">lcd_showxnum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> x<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> y<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> num<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> len<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> size<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">lcd_show_string</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> x<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> y<span class="token punctuation">,</span>
<span class="token keyword">unsigned</span> <span class="token keyword">short</span> width<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> height<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> size<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="lcdAPIc_738"></a>lcdAPI.c</h5> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"bsp_lcdapi.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"font.h"</span>        <span class="token comment">//ASCII字符编码格式，内核中会有</span></span>

<span class="token comment">/*
 * @description        : 画线函数
 * @param - x1        : 线起始点坐标X轴
 * @param - y1        : 线起始点坐标Y轴
 * @param - x2        : 线终止点坐标X轴
 * @param - y2        : 线终止点坐标Y轴
 * @return             : 无
 */</span> 
<span class="token keyword">void</span> <span class="token function">lcd_drawline</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> x1<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> y1<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> x2<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> y2<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    u16 t<span class="token punctuation">;</span> 
    <span class="token keyword">int</span> xerr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> yerr <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> delta_x<span class="token punctuation">,</span> delta_y<span class="token punctuation">,</span> distance<span class="token punctuation">;</span> 
    <span class="token keyword">int</span> incx<span class="token punctuation">,</span> incy<span class="token punctuation">,</span> uRow<span class="token punctuation">,</span> uCol<span class="token punctuation">;</span> 
    delta_x <span class="token operator">=</span> x2 <span class="token operator">-</span> x1<span class="token punctuation">;</span>                     <span class="token comment">/* 计算坐标增量 */</span>
    delta_y <span class="token operator">=</span> y2 <span class="token operator">-</span> y1<span class="token punctuation">;</span> 
    uRow <span class="token operator">=</span> x1<span class="token punctuation">;</span> 
    uCol <span class="token operator">=</span> y1<span class="token punctuation">;</span> 
    <span class="token keyword">if</span><span class="token punctuation">(</span>delta_x <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>                     <span class="token comment">/* 设置单步方向 */</span> 
        incx <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>delta_x<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>                    <span class="token comment">/* 垂直线 */</span>
        incx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        
    <span class="token keyword">else</span> 
    <span class="token punctuation">{<!-- --></span>
        incx <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        delta_x <span class="token operator">=</span> <span class="token operator">-</span>delta_x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
    <span class="token keyword">if</span><span class="token punctuation">(</span>delta_y<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span>
        incy<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> 
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>delta_y <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>                <span class="token comment">/* 水平线 */</span>
        incy<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        incy <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        delta_y <span class="token operator">=</span> <span class="token operator">-</span>delta_y<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
    <span class="token keyword">if</span><span class="token punctuation">(</span> delta_x <span class="token operator">&gt;</span> delta_y<span class="token punctuation">)</span>                <span class="token comment">/*选取基本增量坐标轴  */</span>
        distance <span class="token operator">=</span> delta_x<span class="token punctuation">;</span> 
    <span class="token keyword">else</span> 
        distance <span class="token operator">=</span> delta_y<span class="token punctuation">;</span> 
    <span class="token keyword">for</span><span class="token punctuation">(</span>t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> t <span class="token operator">&lt;=</span> distance<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span> t<span class="token operator">++</span> <span class="token punctuation">)</span>    <span class="token comment">/* 画线输出 */</span>
    <span class="token punctuation">{<!-- --></span>  

        <span class="token function">lcd_drawpoint</span><span class="token punctuation">(</span>uRow<span class="token punctuation">,</span> uCol<span class="token punctuation">,</span> tftlcd_dev<span class="token punctuation">.</span>forecolor<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* 画点 */</span>
        xerr <span class="token operator">+=</span> delta_x <span class="token punctuation">;</span> 
        yerr <span class="token operator">+=</span> delta_y <span class="token punctuation">;</span> 
        <span class="token keyword">if</span><span class="token punctuation">(</span>xerr <span class="token operator">&gt;</span> distance<span class="token punctuation">)</span> 
        <span class="token punctuation">{<!-- --></span> 
            xerr <span class="token operator">-=</span> distance<span class="token punctuation">;</span> 
            uRow <span class="token operator">+=</span> incx<span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
        <span class="token keyword">if</span><span class="token punctuation">(</span>yerr <span class="token operator">&gt;</span> distance<span class="token punctuation">)</span> 
        <span class="token punctuation">{<!-- --></span> 
            yerr <span class="token operator">-=</span> distance<span class="token punctuation">;</span> 
            uCol <span class="token operator">+=</span> incy<span class="token punctuation">;</span> 
        <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>   

<span class="token comment">/*
 * @description    : 画矩形函数
 * @param - x1    : 矩形坐上角坐标X轴
 * @param - y1    : 矩形坐上角坐标Y轴
 * @param - x2    : 矩形右下角坐标X轴
 * @param - y2    : 矩形右下角坐标Y轴
 * @return         : 无
 */</span>
<span class="token keyword">void</span> <span class="token function">lcd_draw_rectangle</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> x1<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> y1<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> x2<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> y2<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">lcd_drawline</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">lcd_drawline</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x1<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">lcd_drawline</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">lcd_drawline</span><span class="token punctuation">(</span>x2<span class="token punctuation">,</span> y1<span class="token punctuation">,</span> x2<span class="token punctuation">,</span> y2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
 * @description    : 在指定位置画一个指定大小的圆
 * @param - x0    : 圆心坐标X轴
 * @param - y0    : 圆心坐标Y轴
 * @param - y2    : 圆形半径
 * @return         : 无
 */</span>
<span class="token keyword">void</span> <span class="token function">lcd_draw_Circle</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> x0<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> y0<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> r<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> mx <span class="token operator">=</span> x0<span class="token punctuation">,</span> my <span class="token operator">=</span> y0<span class="token punctuation">;</span>
    <span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> y <span class="token operator">=</span> r<span class="token punctuation">;</span>

    <span class="token keyword">int</span> d <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> r<span class="token punctuation">;</span>   
    <span class="token keyword">while</span><span class="token punctuation">(</span>y <span class="token operator">&gt;</span> x<span class="token punctuation">)</span>        <span class="token comment">/* y&gt;x即第一象限的第1区八分圆 */</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">lcd_drawpoint</span><span class="token punctuation">(</span>x  <span class="token operator">+</span> mx<span class="token punctuation">,</span> y  <span class="token operator">+</span> my<span class="token punctuation">,</span> tftlcd_dev<span class="token punctuation">.</span>forecolor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">lcd_drawpoint</span><span class="token punctuation">(</span>y  <span class="token operator">+</span> mx<span class="token punctuation">,</span> x  <span class="token operator">+</span> my<span class="token punctuation">,</span> tftlcd_dev<span class="token punctuation">.</span>forecolor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">lcd_drawpoint</span><span class="token punctuation">(</span><span class="token operator">-</span>x <span class="token operator">+</span> mx<span class="token punctuation">,</span> y  <span class="token operator">+</span> my<span class="token punctuation">,</span> tftlcd_dev<span class="token punctuation">.</span>forecolor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">lcd_drawpoint</span><span class="token punctuation">(</span><span class="token operator">-</span>y <span class="token operator">+</span> mx<span class="token punctuation">,</span> x  <span class="token operator">+</span> my<span class="token punctuation">,</span> tftlcd_dev<span class="token punctuation">.</span>forecolor<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">lcd_drawpoint</span><span class="token punctuation">(</span><span class="token operator">-</span>x <span class="token operator">+</span> mx<span class="token punctuation">,</span> <span class="token operator">-</span>y <span class="token operator">+</span> my<span class="token punctuation">,</span> tftlcd_dev<span class="token punctuation">.</span>forecolor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">lcd_drawpoint</span><span class="token punctuation">(</span><span class="token operator">-</span>y <span class="token operator">+</span> mx<span class="token punctuation">,</span> <span class="token operator">-</span>x <span class="token operator">+</span> my<span class="token punctuation">,</span> tftlcd_dev<span class="token punctuation">.</span>forecolor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">lcd_drawpoint</span><span class="token punctuation">(</span>x  <span class="token operator">+</span> mx<span class="token punctuation">,</span> <span class="token operator">-</span>y <span class="token operator">+</span> my<span class="token punctuation">,</span> tftlcd_dev<span class="token punctuation">.</span>forecolor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">lcd_drawpoint</span><span class="token punctuation">(</span>y  <span class="token operator">+</span> mx<span class="token punctuation">,</span> <span class="token operator">-</span>x <span class="token operator">+</span> my<span class="token punctuation">,</span> tftlcd_dev<span class="token punctuation">.</span>forecolor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span> d <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            d <span class="token operator">=</span> d <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> x <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{<!-- --></span>
            d<span class="token operator">=</span> d <span class="token operator">+</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> y<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">;</span>
            y<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        x<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
 * @description    : 在指定位置显示一个字符
 * @param - x    : 起始坐标X轴
 * @param - y    : 起始坐标Y轴
 * @param - num    : 显示字符
 * @param - size: 字体大小, 可选12/16/24/32
 * @param - mode: 叠加方式(1)还是非叠加方式(0)
 * @return         : 无
 */</span>
<span class="token keyword">void</span> <span class="token function">lcd_showchar</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span>     <span class="token keyword">short</span> x<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> y<span class="token punctuation">,</span>
                      <span class="token keyword">unsigned</span> <span class="token keyword">char</span> num<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> size<span class="token punctuation">,</span> 
                      <span class="token keyword">unsigned</span> <span class="token keyword">char</span> mode<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>                                
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span>  temp<span class="token punctuation">,</span> t1<span class="token punctuation">,</span> t<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">short</span> y0 <span class="token operator">=</span> y<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> csize <span class="token operator">=</span> <span class="token punctuation">(</span>size <span class="token operator">/</span> <span class="token number">8</span><span class="token operator">+</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>size <span class="token operator">%</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">/* 得到字体一个字符对应点阵集所占的字节数     */</span>    
     num <span class="token operator">=</span> num <span class="token operator">-</span> <span class="token char">' '</span><span class="token punctuation">;</span>      <span class="token comment">/*得到偏移后的值（ASCII字库是从空格开始取模，所以-' '就是对应字符的字库）  */</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> t <span class="token operator">&lt;</span> csize<span class="token punctuation">;</span> t<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>   
        <span class="token keyword">if</span><span class="token punctuation">(</span>size <span class="token operator">==</span> <span class="token number">12</span><span class="token punctuation">)</span> temp <span class="token operator">=</span> asc2_1206<span class="token punctuation">[</span>num<span class="token punctuation">]</span><span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">;</span>         <span class="token comment">/* 调用1206字体 */</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>size <span class="token operator">==</span> <span class="token number">16</span><span class="token punctuation">)</span>temp <span class="token operator">=</span> asc2_1608<span class="token punctuation">[</span>num<span class="token punctuation">]</span><span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">/* 调用1608字体 */</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>size <span class="token operator">==</span> <span class="token number">24</span><span class="token punctuation">)</span>temp <span class="token operator">=</span> asc2_2412<span class="token punctuation">[</span>num<span class="token punctuation">]</span><span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">/* 调用2412字体 */</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>size <span class="token operator">==</span> <span class="token number">32</span><span class="token punctuation">)</span>temp <span class="token operator">=</span> asc2_3216<span class="token punctuation">[</span>num<span class="token punctuation">]</span><span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token comment">/* 调用3216字体 */</span>
        <span class="token keyword">else</span> <span class="token keyword">return</span><span class="token punctuation">;</span>                                    <span class="token comment">/* 没有的字库         */</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>t1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> t1 <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> t1<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>                
            <span class="token keyword">if</span><span class="token punctuation">(</span>temp <span class="token operator">&amp;</span> <span class="token number">0x80</span><span class="token punctuation">)</span><span class="token function">lcd_drawpoint</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> tftlcd_dev<span class="token punctuation">.</span>forecolor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>mode<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token function">lcd_drawpoint</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> tftlcd_dev<span class="token punctuation">.</span>backcolor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            temp <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            y<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>y <span class="token operator">&gt;=</span> tftlcd_dev<span class="token punctuation">.</span>height<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>            <span class="token comment">/* 超区域了 */</span>    
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y <span class="token operator">-</span> y0<span class="token punctuation">)</span> <span class="token operator">==</span> size<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                y <span class="token operator">=</span> y0<span class="token punctuation">;</span>
                x<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">&gt;=</span> tftlcd_dev<span class="token punctuation">.</span>width<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token comment">/* 超区域了 */</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>       
    <span class="token punctuation">}</span>                                
<span class="token punctuation">}</span> 

<span class="token comment">/*
 * @description    : 计算m的n次方
 * @param - m    : 要计算的值
 * @param - n    : n次方
 * @return         : m^n次方.
 */</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token function">lcd_pow</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> m<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>     
    <span class="token keyword">while</span><span class="token punctuation">(</span>n<span class="token operator">--</span><span class="token punctuation">)</span> result <span class="token operator">*=</span> m<span class="token punctuation">;</span>    
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/*
 * @description    : 显示指定的数字，高位为0的话不显示
 * @param - x    : 起始坐标点X轴。
 * @param - y    : 起始坐标点Y轴。
 * @param - num    : 数值(0~999999999)。
 * @param - len : 数字位数。
 * @param - size: 字体大小
 * @return         : 无
 */</span>
<span class="token keyword">void</span> <span class="token function">lcd_shownum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span>     <span class="token keyword">short</span> x<span class="token punctuation">,</span> 
                     <span class="token keyword">unsigned</span> <span class="token keyword">short</span> y<span class="token punctuation">,</span> 
                     <span class="token keyword">unsigned</span> <span class="token keyword">int</span> num<span class="token punctuation">,</span> 
                     <span class="token keyword">unsigned</span> <span class="token keyword">char</span> len<span class="token punctuation">,</span>
                     <span class="token keyword">unsigned</span> <span class="token keyword">char</span> size<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>             
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span>  t<span class="token punctuation">,</span> temp<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span>  enshow <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                           
    <span class="token keyword">for</span><span class="token punctuation">(</span>t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> t <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> t<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        temp <span class="token operator">=</span> <span class="token punctuation">(</span>num <span class="token operator">/</span> <span class="token function">lcd_pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> len <span class="token operator">-</span> t <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>enshow <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> t <span class="token operator">&lt;</span> <span class="token punctuation">(</span>len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>temp <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token function">lcd_showchar</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token punctuation">(</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> t<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token char">' '</span><span class="token punctuation">,</span> size<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> enshow <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>      
        <span class="token punctuation">}</span>
         <span class="token function">lcd_showchar</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token punctuation">(</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> t<span class="token punctuation">,</span> y<span class="token punctuation">,</span> temp <span class="token operator">+</span> <span class="token char">'0'</span><span class="token punctuation">,</span> size<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 

<span class="token comment">/*
 * @description        : 显示指定的数字，高位为0,还是显示
 * @param - x         : 起始坐标点X轴。
 * @param - y         : 起始坐标点Y轴。
 * @param - num        : 数值(0~999999999)。
 * @param - len     : 数字位数。
 * @param - size    : 字体大小
 * @param - mode    : [7]:0,不填充;1,填充0.
 *                       [6:1]:保留
 *                      [0]:0,非叠加显示;1,叠加显示.
 * @return              : 无
 */</span>
<span class="token keyword">void</span> <span class="token function">lcd_showxnum</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span>     <span class="token keyword">short</span> x<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">short</span> y<span class="token punctuation">,</span> 
                      <span class="token keyword">unsigned</span> <span class="token keyword">int</span> num<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> len<span class="token punctuation">,</span> 
                      <span class="token keyword">unsigned</span> <span class="token keyword">char</span> size<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> mode<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>  
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> t<span class="token punctuation">,</span> temp<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> enshow <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                           
    <span class="token keyword">for</span><span class="token punctuation">(</span>t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> t <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> t<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        temp <span class="token operator">=</span> <span class="token punctuation">(</span>num <span class="token operator">/</span> <span class="token function">lcd_pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> len <span class="token operator">-</span> t<span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>enshow <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> t <span class="token operator">&lt;</span> <span class="token punctuation">(</span>len <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>temp <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>mode <span class="token operator">&amp;</span> <span class="token number">0X80</span><span class="token punctuation">)</span> <span class="token function">lcd_showchar</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token punctuation">(</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> t<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token char">'0'</span><span class="token punctuation">,</span> size<span class="token punctuation">,</span> mode <span class="token operator">&amp;</span> <span class="token number">0X01</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                <span class="token keyword">else</span>  <span class="token function">lcd_showchar</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token punctuation">(</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> t<span class="token punctuation">,</span> y <span class="token punctuation">,</span> <span class="token char">' '</span><span class="token punctuation">,</span> size<span class="token punctuation">,</span> mode <span class="token operator">&amp;</span> <span class="token number">0X01</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
                 <span class="token keyword">continue</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> enshow<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> 
              
        <span class="token punctuation">}</span>
         <span class="token function">lcd_showchar</span><span class="token punctuation">(</span> x <span class="token operator">+</span> <span class="token punctuation">(</span>size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> t<span class="token punctuation">,</span> y<span class="token punctuation">,</span> temp <span class="token operator">+</span> <span class="token char">'0'</span> <span class="token punctuation">,</span> size <span class="token punctuation">,</span> mode <span class="token operator">&amp;</span> <span class="token number">0X01</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> 

<span class="token comment">/*
 * @description        : 显示一串字符串
 * @param - x        : 起始坐标点X轴。
 * @param - y        : 起始坐标点Y轴。
 * @param - width     : 字符串显示区域长度
 * @param - height    : 字符串显示区域高度
 * @param - size    : 字体大小
 * @param - p        : 要显示的字符串首地址
 * @return             : 无
 */</span>
<span class="token keyword">void</span> <span class="token function">lcd_show_string</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> x<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> y<span class="token punctuation">,</span>
                          <span class="token keyword">unsigned</span> <span class="token keyword">short</span> width<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> height<span class="token punctuation">,</span>
                          <span class="token keyword">unsigned</span> <span class="token keyword">char</span> size<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>         
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> x0 <span class="token operator">=</span> x<span class="token punctuation">;</span>
    width <span class="token operator">+=</span> x<span class="token punctuation">;</span>
    height <span class="token operator">+=</span> y<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>p <span class="token operator">&lt;=</span> <span class="token char">'~'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span><span class="token operator">*</span>p <span class="token operator">&gt;=</span> <span class="token char">' '</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token comment">/* 判断是不是非法字符! */</span> 
    <span class="token punctuation">{<!-- --></span>       
        <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">&gt;=</span> width<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>x <span class="token operator">=</span> x0<span class="token punctuation">;</span> y <span class="token operator">+=</span> size<span class="token punctuation">;</span><span class="token punctuation">}</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>y <span class="token operator">&gt;=</span> height<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>                <span class="token comment">/* 退出 */</span>
        <span class="token function">lcd_showchar</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">*</span>p <span class="token punctuation">,</span> size<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        x <span class="token operator">+=</span> size <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        p<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_1004"></a>二、驱动篇</h2> 
<p>之前裸机开发 LCD 的步骤：<br> ①、初始化 I.MX6U 的 eLCDIF 控制器，重点是 LCD 屏幕宽(width)、高(height)、hspw、<br> hbp、hfp、vspw、vbp 和 vfp 等信息。<br> ②、初始化 LCD 像素时钟。<br> ③、设置 RGBLCD 显存。<br> ④、应用程序直接通过操作显存来操作 LCD，实现在 LCD 上显示字符、图片等信息。<br> 在 Linux 中应用程序最终也是通过操作 RGB LCD 的显存来实现在 LCD 上显示字符、图片<br> 等信息。在裸机中我们可以随意的分配显存，但是在 Linux 系统中内存的管理很严格，显存需要申请。而且有虚拟内存的存在，驱动程序设置的显存和应用程<br> 序访问的显存必须是同一片物理内存。<br> 所以先来看一个很重要的概念：Framebuffer</p> 
<h3><a id="_Framebuffer_1015"></a>* Framebuffer</h3> 
<p>帧缓冲，简称 fb，这玩意竟然被设计成设备，在 Linux 虚拟机中可以看到/dev/fbX(X=0~n)的设备，这些设备其实都是显存。<br> 我们要操作/读取屏幕，直接对显存下手就可以了。<br> 帧缓冲设备操作集</p> 
<pre><code class="prism language-c"><span class="token comment">/* drivers/video/fbdev/core/fbmem.c */</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">file_operations</span> fb_fops <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token punctuation">.</span>owner <span class="token operator">=</span> THIS_MODULE<span class="token punctuation">,</span>
  <span class="token punctuation">.</span>read <span class="token operator">=</span> fb_read<span class="token punctuation">,</span>
  <span class="token punctuation">.</span>write <span class="token operator">=</span> fb_write<span class="token punctuation">,</span>
  <span class="token punctuation">.</span>unlocked_ioctl <span class="token operator">=</span> fb_ioctl<span class="token punctuation">,</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">CONFIG_COMPAT</span></span>
  <span class="token punctuation">.</span>compat_ioctl <span class="token operator">=</span> fb_compat_ioctl<span class="token punctuation">,</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
  <span class="token punctuation">.</span>mmap <span class="token operator">=</span> fb_mmap<span class="token punctuation">,</span>
  <span class="token punctuation">.</span>open <span class="token operator">=</span> fb_open<span class="token punctuation">,</span>
  <span class="token punctuation">.</span>release <span class="token operator">=</span> fb_release<span class="token punctuation">,</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">HAVE_ARCH_FB_UNMAPPED_AREA</span></span>
  <span class="token punctuation">.</span>get_unmapped_area <span class="token operator">=</span> get_fb_unmapped_area<span class="token punctuation">,</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">CONFIG_FB_DEFERRED_IO</span></span>
  <span class="token punctuation">.</span>fsync <span class="token operator">=</span> fb_deferred_io_fsync<span class="token punctuation">,</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
  <span class="token punctuation">.</span>llseek <span class="token operator">=</span> default_llseek<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="LCD__1041"></a>LCD 驱动简析</h3> 
<pre><code class="prism language-c"><span class="token comment">/* drivers/video/fbdev/mxsfb.c，mxsfb.c */</span>
<span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">of_device_id</span> mxsfb_dt_ids<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
 <span class="token punctuation">{<!-- --></span> <span class="token punctuation">.</span>compatible <span class="token operator">=</span> <span class="token string">"fsl,imx23-lcdif"</span><span class="token punctuation">,</span> <span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token operator">&amp;</span>mxsfb_devtype<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{<!-- --></span> <span class="token punctuation">.</span>compatible <span class="token operator">=</span> <span class="token string">"fsl,imx28-lcdif"</span><span class="token punctuation">,</span> <span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token operator">&amp;</span>mxsfb_devtype<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">{<!-- --></span> <span class="token comment">/* sentinel */</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">struct</span> <span class="token class-name">platform_driver</span> mxsfb_driver <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
 <span class="token punctuation">.</span>probe <span class="token operator">=</span> mxsfb_probe<span class="token punctuation">,</span>
 <span class="token punctuation">.</span>remove <span class="token operator">=</span> mxsfb_remove<span class="token punctuation">,</span>
 <span class="token punctuation">.</span>shutdown <span class="token operator">=</span> mxsfb_shutdown<span class="token punctuation">,</span>
 <span class="token punctuation">.</span>id_table <span class="token operator">=</span> mxsfb_devtype<span class="token punctuation">,</span>
 <span class="token punctuation">.</span>driver <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
 <span class="token punctuation">.</span>name <span class="token operator">=</span> DRIVER_NAME<span class="token punctuation">,</span>
 <span class="token punctuation">.</span>of_match_table <span class="token operator">=</span> mxsfb_dt_ids<span class="token punctuation">,</span>
 <span class="token punctuation">.</span>pm <span class="token operator">=</span> <span class="token operator">&amp;</span>mxsfb_pm_ops<span class="token punctuation">,</span>
 <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">module_platform_driver</span><span class="token punctuation">(</span>mxsfb_driver<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>Linux 内核将所有的 Framebuffer 抽象为一个叫做 fb_info 的结构体，fb_info 结构体包含了 Framebuffer 设备的完整属性和操作集合，因此每一个 Framebuffer 设备都必须有一个 fb_info。<br> <strong>LCD 的驱动就是构建 fb_info，并且向系统注册 fb_info的过程！！！</strong></p> 
<pre><code class="prism language-c"><span class="token comment">/* include/linux/fb.h */</span>
<span class="token keyword">struct</span> <span class="token class-name">fb_info</span> <span class="token punctuation">{<!-- --></span>
 <span class="token class-name">atomic_t</span> count<span class="token punctuation">;</span>
 <span class="token keyword">int</span> node<span class="token punctuation">;</span>
 <span class="token keyword">int</span> flags<span class="token punctuation">;</span>
 <span class="token keyword">struct</span> <span class="token class-name">mutex</span> lock<span class="token punctuation">;</span>               <span class="token comment">/* 互斥锁 */</span>
 <span class="token keyword">struct</span> <span class="token class-name">mutex</span> mm_lock<span class="token punctuation">;</span>            <span class="token comment">/* 互斥锁，用于 fb_mmap 和 smem_*域*/</span>
 <span class="token keyword">struct</span> <span class="token class-name">fb_var_screeninfo</span> var<span class="token punctuation">;</span>    <span class="token comment">/* 当前可变参数 */</span>
 <span class="token keyword">struct</span> <span class="token class-name">fb_fix_screeninfo</span> fix<span class="token punctuation">;</span>    <span class="token comment">/* 当前固定参数 */</span>
 <span class="token keyword">struct</span> <span class="token class-name">fb_monspecs</span> monspecs<span class="token punctuation">;</span>     <span class="token comment">/* 当前显示器特性 */</span>
 <span class="token keyword">struct</span> <span class="token class-name">work_struct</span> queue<span class="token punctuation">;</span>        <span class="token comment">/* 帧缓冲事件队列 */</span>
 <span class="token keyword">struct</span> <span class="token class-name">fb_pixmap</span> pixmap<span class="token punctuation">;</span>         <span class="token comment">/* 图像硬件映射 */</span>
 <span class="token keyword">struct</span> <span class="token class-name">fb_pixmap</span> sprite<span class="token punctuation">;</span>         <span class="token comment">/* 光标硬件映射 */</span>
 <span class="token keyword">struct</span> <span class="token class-name">fb_cmap</span> cmap<span class="token punctuation">;</span>             <span class="token comment">/* 当前调色板 */</span>
 <span class="token keyword">struct</span> <span class="token class-name">list_head</span> modelist<span class="token punctuation">;</span>       <span class="token comment">/* 当前模式列表 */</span>
 <span class="token keyword">struct</span> <span class="token class-name">fb_videomode</span> <span class="token operator">*</span>mode<span class="token punctuation">;</span>       <span class="token comment">/* 当前视频模式 */</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">CONFIG_FB_BACKLIGHT        </span><span class="token comment">/* 如果 LCD 支持背光的话 */</span></span>
 <span class="token comment">/* assigned backlight device */</span>
 <span class="token comment">/* set before framebuffer registration, 
 remove after unregister */</span>
 <span class="token keyword">struct</span> <span class="token class-name">backlight_device</span> <span class="token operator">*</span>bl_dev<span class="token punctuation">;</span> <span class="token comment">/* 背光设备 */</span>

 <span class="token comment">/* Backlight level curve */</span>
 <span class="token keyword">struct</span> <span class="token class-name">mutex</span> bl_curve_mutex<span class="token punctuation">;</span> 
 u8 bl_curve<span class="token punctuation">[</span>FB_BACKLIGHT_LEVELS<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token keyword">struct</span> <span class="token class-name">fb_ops</span> <span class="token operator">*</span>fbops<span class="token punctuation">;</span>          <span class="token comment">/* 帧缓冲操作函数集 */</span> 
 <span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>device<span class="token punctuation">;</span>         <span class="token comment">/* 父设备 */</span>
 <span class="token keyword">struct</span> <span class="token class-name">device</span> <span class="token operator">*</span>dev<span class="token punctuation">;</span>            <span class="token comment">/* 当前 fb 设备 */</span>
 <span class="token keyword">int</span> class_flag<span class="token punctuation">;</span>                <span class="token comment">/* 私有 sysfs 标志 */</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token keyword">char</span> __iomem <span class="token operator">*</span>screen_base<span class="token punctuation">;</span>     <span class="token comment">/* 虚拟内存基地址(屏幕显存) */</span>
 <span class="token keyword">unsigned</span> <span class="token keyword">long</span> screen_size<span class="token punctuation">;</span>     <span class="token comment">/* 虚拟内存大小(屏幕显存大小) */</span>
 <span class="token keyword">void</span> <span class="token operator">*</span>pseudo_palette<span class="token punctuation">;</span>          <span class="token comment">/* 伪 16 位调色板 */</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>fb_info 结构体的成员变量很多，我们重点关注 var、fix、fbops、screen_base、screen_size<br> 和 pseudo_palette。mxsfb_probe 函数的主要工作内容为：<br> ①、申请 fb_info。<br> ②、初始化 fb_info 结构体中的各个成员变量。<br> ③、初始化 eLCDIF 控制器。<br> ④、使用 register_framebuffer 函数向 Linux 内核注册初始化好的 fb_info。register_framebuffer<br> 函数原型如下：</p> 
<pre><code class="prism language-c"><span class="token keyword">int</span> <span class="token function">register_framebuffer</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">fb_info</span> <span class="token operator">*</span>fb_info<span class="token punctuation">)</span>
</code></pre> 
<p>fb_info：需要上报的 fb_info。</p> 
<p>裸机开发步骤中第一步就是配置时钟和屏幕时序，这部分之前就一直强调驱动中是放到设备树中实现的。</p> 
<pre><code class="prism language-c">lcdif<span class="token operator">:</span> lcdif@<span class="token number">021</span>c8000 <span class="token punctuation">{<!-- --></span>
 compatible <span class="token operator">=</span> <span class="token string">"fsl,imx6ul-lcdif"</span><span class="token punctuation">,</span> <span class="token string">"fsl,imx28-lcdif"</span><span class="token punctuation">;</span>
 reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x021c8000</span> <span class="token number">0x4000</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
 interrupts <span class="token operator">=</span> <span class="token operator">&lt;</span>GIC_SPI <span class="token number">5</span> IRQ_TYPE_LEVEL_HIGH<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 clocks <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>clks IMX6UL_CLK_LCDIF_PIX<span class="token operator">&gt;</span><span class="token punctuation">,</span>
 <span class="token operator">&lt;</span><span class="token operator">&amp;</span>clks IMX6UL_CLK_LCDIF_APB<span class="token operator">&gt;</span><span class="token punctuation">,</span>
 <span class="token operator">&lt;</span><span class="token operator">&amp;</span>clks IMX6UL_CLK_DUMMY<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 clock<span class="token operator">-</span>names <span class="token operator">=</span> <span class="token string">"pix"</span><span class="token punctuation">,</span> <span class="token string">"axi"</span><span class="token punctuation">,</span> <span class="token string">"disp_axi"</span><span class="token punctuation">;</span>
 status <span class="token operator">=</span> <span class="token string">"disabled"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>LCD 相关寄存器相对 lcdif 基址的偏移量</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCDC_CTRL</span> <span class="token expression"><span class="token number">0x00</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCDC_CTRL1</span> <span class="token expression"><span class="token number">0x10</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCDC_V4_CTRL2</span> <span class="token expression"><span class="token number">0x20</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCDC_V3_TRANSFER_COUNT</span> <span class="token expression"><span class="token number">0x20</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCDC_V4_TRANSFER_COUNT</span> <span class="token expression"><span class="token number">0x30</span></span></span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCDC_V4_DEBUG0</span> <span class="token expression"><span class="token number">0x1d0</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LCDC_V3_DEBUG0</span> <span class="token expression"><span class="token number">0x1f0</span></span></span>
</code></pre> 
<h3><a id="proc__1146"></a>proc 函数</h3> 
<pre><code class="prism language-c"><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">mxsfb_probe</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">platform_device</span> <span class="token operator">*</span>pdev<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
 <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">of_device_id</span> <span class="token operator">*</span>of_id <span class="token operator">=</span>
 <span class="token function">of_match_device</span><span class="token punctuation">(</span>mxsfb_dt_ids<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pdev<span class="token operator">-&gt;</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">struct</span> <span class="token class-name">resource</span> <span class="token operator">*</span>res<span class="token punctuation">;</span>
 <span class="token keyword">struct</span> <span class="token class-name">mxsfb_info</span> <span class="token operator">*</span>host<span class="token punctuation">;</span>        <span class="token comment">//指向处理器的 LCD 主控接口</span>
 <span class="token keyword">struct</span> <span class="token class-name">fb_info</span> <span class="token operator">*</span>fb_info<span class="token punctuation">;</span>
 <span class="token keyword">struct</span> <span class="token class-name">pinctrl</span> <span class="token operator">*</span>pinctrl<span class="token punctuation">;</span>
 <span class="token keyword">int</span> irq <span class="token operator">=</span> <span class="token function">platform_get_irq</span><span class="token punctuation">(</span>pdev<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">int</span> gpio<span class="token punctuation">,</span> ret<span class="token punctuation">;</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token comment">/* 从设备树中获取 eLCDIF 接口控制器的寄存器首地址，设备树中 lcdif 节点已经
    设置了 eLCDIF 寄存器首地址为 0X021C8000，因此 res=0X021C8000 */</span>
 res <span class="token operator">=</span> <span class="token function">platform_get_resource</span><span class="token punctuation">(</span>pdev<span class="token punctuation">,</span> IORESOURCE_MEM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
     <span class="token function">dev_err</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pdev<span class="token operator">-&gt;</span>dev<span class="token punctuation">,</span> <span class="token string">"Cannot get memory IO resource\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">return</span> <span class="token operator">-</span>ENODEV<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 host <span class="token operator">=</span> <span class="token function">devm_kzalloc</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pdev<span class="token operator">-&gt;</span>dev<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">mxsfb_info</span><span class="token punctuation">)</span><span class="token punctuation">,</span> GFP_KERNEL<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>host<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
     <span class="token function">dev_err</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pdev<span class="token operator">-&gt;</span>dev<span class="token punctuation">,</span> <span class="token string">"Failed to allocate IO resource\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">return</span> <span class="token operator">-</span>ENOMEM<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 fb_info <span class="token operator">=</span> <span class="token function">framebuffer_alloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">fb_info</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>pdev<span class="token operator">-&gt;</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//申请 fb_info</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fb_info<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
     <span class="token function">dev_err</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pdev<span class="token operator">-&gt;</span>dev<span class="token punctuation">,</span> <span class="token string">"Failed to allocate fbdev\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">devm_kfree</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pdev<span class="token operator">-&gt;</span>dev<span class="token punctuation">,</span> host<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">return</span> <span class="token operator">-</span>ENOMEM<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token comment">/* 设置 host 的 fb_info 成员变量为 fb_info，设置 fb_info 的 par 成员变量为 host。
 通过这一步就将前面申请的 host 和 fb_info 联系在了一起 */</span>
 host<span class="token operator">-&gt;</span>fb_info <span class="token operator">=</span> fb_info<span class="token punctuation">;</span>
 fb_info<span class="token operator">-&gt;</span>par <span class="token operator">=</span> host<span class="token punctuation">;</span>

 <span class="token comment">/* 申请中断，中断服务函数为 mxsfb_irq_handler */</span>
 ret <span class="token operator">=</span> <span class="token function">devm_request_irq</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pdev<span class="token operator">-&gt;</span>dev<span class="token punctuation">,</span> irq<span class="token punctuation">,</span> mxsfb_irq_handler<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">dev_name</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pdev<span class="token operator">-&gt;</span>dev<span class="token punctuation">)</span><span class="token punctuation">,</span> host<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
     <span class="token function">dev_err</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pdev<span class="token operator">-&gt;</span>dev<span class="token punctuation">,</span> <span class="token string">"request_irq (%d) failed with error %d\n"</span><span class="token punctuation">,</span> irq<span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
     ret <span class="token operator">=</span> <span class="token operator">-</span>ENODEV<span class="token punctuation">;</span>
     <span class="token keyword">goto</span> fb_release<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token comment">/* 从设备树中获取到的寄存器首地址(res)进行内存映射，得到虚拟地址，并保存到 host 的 base 成员变量
    通过访问 host 的 base 成员即可访问 I.MX6ULL 的整个 eLCDIF 寄存器(base地址+偏移值的方法) */</span>
 host<span class="token operator">-&gt;</span>base <span class="token operator">=</span> <span class="token function">devm_ioremap_resource</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pdev<span class="token operator">-&gt;</span>dev<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IS_ERR</span><span class="token punctuation">(</span>host<span class="token operator">-&gt;</span>base<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
     <span class="token function">dev_err</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pdev<span class="token operator">-&gt;</span>dev<span class="token punctuation">,</span> <span class="token string">"ioremap failed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     ret <span class="token operator">=</span> <span class="token function">PTR_ERR</span><span class="token punctuation">(</span>host<span class="token operator">-&gt;</span>base<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">goto</span> fb_release<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 fb_info<span class="token operator">-&gt;</span>pseudo_palette <span class="token operator">=</span> <span class="token function">devm_kzalloc</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pdev<span class="token operator">-&gt;</span>dev<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>u32<span class="token punctuation">)</span> <span class="token operator">*</span><span class="token number">16</span><span class="token punctuation">,</span> GFP_KERNEL<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fb_info<span class="token operator">-&gt;</span>pseudo_palette<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
     ret <span class="token operator">=</span> <span class="token operator">-</span>ENOMEM<span class="token punctuation">;</span>
     <span class="token keyword">goto</span> fb_release<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

 <span class="token function">INIT_LIST_HEAD</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>fb_info<span class="token operator">-&gt;</span>modelist<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token function">pm_runtime_enable</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>host<span class="token operator">-&gt;</span>pdev<span class="token operator">-&gt;</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">/* 调用 mxsfb_init_fbinfo 函数初始化 fb_info，重点是 fb_info 的 var、fix、fbops，screen_base 和
    screen_size。其中 fbops 是 Framebuffer 设备的操作集，NXP 提供的 fbops 为 mxsfb_ops */</span>
 ret <span class="token operator">=</span> <span class="token function">mxsfb_init_fbinfo</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
     <span class="token keyword">goto</span> fb_pm_runtime_disable<span class="token punctuation">;</span>

 <span class="token function">mxsfb_dispdrv_init</span><span class="token punctuation">(</span>pdev<span class="token punctuation">,</span> fb_info<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//NXP封装过的dispdrv_init</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>host<span class="token operator">-&gt;</span>dispdrv<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
     pinctrl <span class="token operator">=</span> <span class="token function">devm_pinctrl_get_select_default</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pdev<span class="token operator">-&gt;</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//设备所用引脚设备为 default 功能</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IS_ERR</span><span class="token punctuation">(</span>pinctrl<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
         ret <span class="token operator">=</span> <span class="token function">PTR_ERR</span><span class="token punctuation">(</span>pinctrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
         <span class="token keyword">goto</span> fb_pm_runtime_disable<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>host<span class="token operator">-&gt;</span>enabled<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
     <span class="token function">writel</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> host<span class="token operator">-&gt;</span>base <span class="token operator">+</span> LCDC_CTRL<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">mxsfb_set_par</span><span class="token punctuation">(</span>fb_info<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">mxsfb_enable_controller</span><span class="token punctuation">(</span>fb_info<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">pm_runtime_get_sync</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>host<span class="token operator">-&gt;</span>pdev<span class="token operator">-&gt;</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

 ret <span class="token operator">=</span> <span class="token function">register_framebuffer</span><span class="token punctuation">(</span>fb_info<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// probe 最终的目的，注册 framebuffer ！！！</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
     <span class="token function">dev_err</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>pdev<span class="token operator">-&gt;</span>dev<span class="token punctuation">,</span> <span class="token string">"Failed to register framebuffer\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">goto</span> fb_destroy<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
 <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>NXP 提供的 fbops</p> 
<pre><code class="prism language-c"><span class="token keyword">static</span> <span class="token keyword">struct</span> <span class="token class-name">fb_ops</span> mxsfb_ops <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
 <span class="token punctuation">.</span>owner <span class="token operator">=</span> THIS_MODULE<span class="token punctuation">,</span>
 <span class="token punctuation">.</span>fb_check_var <span class="token operator">=</span> mxsfb_check_var<span class="token punctuation">,</span>
 <span class="token punctuation">.</span>fb_set_par <span class="token operator">=</span> mxsfb_set_par<span class="token punctuation">,</span>
 <span class="token punctuation">.</span>fb_setcolreg <span class="token operator">=</span> mxsfb_setcolreg<span class="token punctuation">,</span>
 <span class="token punctuation">.</span>fb_ioctl <span class="token operator">=</span> mxsfb_ioctl<span class="token punctuation">,</span>
 <span class="token punctuation">.</span>fb_blank <span class="token operator">=</span> mxsfb_blank<span class="token punctuation">,</span>
 <span class="token punctuation">.</span>fb_pan_display <span class="token operator">=</span> mxsfb_pan_display<span class="token punctuation">,</span>
 <span class="token punctuation">.</span>fb_mmap <span class="token operator">=</span> mxsfb_mmap<span class="token punctuation">,</span>
 <span class="token punctuation">.</span>fb_fillrect <span class="token operator">=</span> cfb_fillrect<span class="token punctuation">,</span>
 <span class="token punctuation">.</span>fb_copyarea <span class="token operator">=</span> cfb_copyarea<span class="token punctuation">,</span>
 <span class="token punctuation">.</span>fb_imageblit <span class="token operator">=</span> cfb_imageblit<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_LCD_1255"></a>如何驱动一块 LCD？</h3> 
<p>对于Linux系统来说，厂商已经写好了 BSP 和驱动了，我们需要按照驱动的要求去修改设备树，这部分可以直接参考厂商的设备树。只有在需要额外加业务功能的时候，才需要去驱动代码，例如：睡眠、亮度。不过这些一般都有接口给我们写参数。<br> 修改设备树需要注意三个地方：<br> ①、LCD 所使用的 IO 配置。<br> ②、LCD 屏幕节点修改，修改相应的属性值，换成我们所使用的 LCD 屏幕参数。<br> ③、LCD 背光节点信息修改，要根据实际所使用的背光 IO 来修改相应的设备节点信息。</p> 
<h4><a id="LCD__IO__1262"></a>LCD 屏幕 IO 配置</h4> 
<p>这部分是固定的，所以厂商设备中已经写好了。</p> 
<pre><code class="prism language-c"><span class="token comment">/* 24 根数据线的引脚复用 */</span>
pinctrl_lcdif_dat<span class="token operator">:</span> lcdifdatgrp <span class="token punctuation">{<!-- --></span>
 fsl<span class="token punctuation">,</span>pins <span class="token operator">=</span> <span class="token operator">&lt;</span>
     MX6UL_PAD_LCD_DATA00__LCDIF_DATA00 <span class="token number">0x79</span>
     MX6UL_PAD_LCD_DATA01__LCDIF_DATA01 <span class="token number">0x79</span>
     MX6UL_PAD_LCD_DATA02__LCDIF_DATA02 <span class="token number">0x79</span>
     MX6UL_PAD_LCD_DATA03__LCDIF_DATA03 <span class="token number">0x79</span>
     MX6UL_PAD_LCD_DATA04__LCDIF_DATA04 <span class="token number">0x79</span>
     MX6UL_PAD_LCD_DATA05__LCDIF_DATA05 <span class="token number">0x79</span>
     MX6UL_PAD_LCD_DATA06__LCDIF_DATA06 <span class="token number">0x79</span>
     MX6UL_PAD_LCD_DATA07__LCDIF_DATA07 <span class="token number">0x79</span>
     MX6UL_PAD_LCD_DATA08__LCDIF_DATA08 <span class="token number">0x79</span>
     MX6UL_PAD_LCD_DATA09__LCDIF_DATA09 <span class="token number">0x79</span>
     MX6UL_PAD_LCD_DATA10__LCDIF_DATA10 <span class="token number">0x79</span>
     MX6UL_PAD_LCD_DATA11__LCDIF_DATA11 <span class="token number">0x79</span>
     MX6UL_PAD_LCD_DATA12__LCDIF_DATA12 <span class="token number">0x79</span>
     MX6UL_PAD_LCD_DATA13__LCDIF_DATA13 <span class="token number">0x79</span>
     MX6UL_PAD_LCD_DATA14__LCDIF_DATA14 <span class="token number">0x79</span>
     MX6UL_PAD_LCD_DATA15__LCDIF_DATA15 <span class="token number">0x79</span>
     MX6UL_PAD_LCD_DATA16__LCDIF_DATA16 <span class="token number">0x79</span>
     MX6UL_PAD_LCD_DATA17__LCDIF_DATA17 <span class="token number">0x79</span>
     MX6UL_PAD_LCD_DATA18__LCDIF_DATA18 <span class="token number">0x79</span>
     MX6UL_PAD_LCD_DATA19__LCDIF_DATA19 <span class="token number">0x79</span>
     MX6UL_PAD_LCD_DATA20__LCDIF_DATA20 <span class="token number">0x79</span>
     MX6UL_PAD_LCD_DATA21__LCDIF_DATA21 <span class="token number">0x79</span>
     MX6UL_PAD_LCD_DATA22__LCDIF_DATA22 <span class="token number">0x79</span>
     MX6UL_PAD_LCD_DATA23__LCDIF_DATA23 <span class="token number">0x79</span>
 <span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/* 4 根控制线的引脚复用 */</span>
pinctrl_lcdif_ctrl<span class="token operator">:</span> lcdifctrlgrp <span class="token punctuation">{<!-- --></span>
 fsl<span class="token punctuation">,</span>pins <span class="token operator">=</span> <span class="token operator">&lt;</span>
     MX6UL_PAD_LCD_CLK__LCDIF_CLK <span class="token number">0x79</span>          <span class="token comment">//时钟线</span>
     MX6UL_PAD_LCD_ENABLE__LCDIF_ENABLE <span class="token number">0x79</span>    <span class="token comment">//LCD使能信号线</span>
     MX6UL_PAD_LCD_HSYNC__LCDIF_HSYNC <span class="token number">0x79</span>      <span class="token comment">//行同步信号线</span>
     MX6UL_PAD_LCD_VSYNC__LCDIF_VSYNC <span class="token number">0x79</span>      <span class="token comment">//帧同步信号线</span>
 <span class="token operator">&gt;</span><span class="token punctuation">;</span>
 <span class="token comment">/* LCD 背光灯 PWM 引脚配置项 */</span>
 pinctrl_pwm1<span class="token operator">:</span> pwm1grp <span class="token punctuation">{<!-- --></span>
 fsl<span class="token punctuation">,</span>pins <span class="token operator">=</span> <span class="token operator">&lt;</span>
     MX6UL_PAD_GPIO1_IO08__PWM1_OUT <span class="token number">0x110b0</span>
 <span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="LCD__1311"></a>LCD 屏幕参数节点信息修改</h4> 
<p>厂商设备树 lcdif 节点：</p> 
<pre><code class="prism language-c"><span class="token operator">&amp;</span>lcdif <span class="token punctuation">{<!-- --></span>
 pinctrl<span class="token operator">-</span>names <span class="token operator">=</span> <span class="token string">"default"</span><span class="token punctuation">;</span>
 pinctrl<span class="token operator">-</span><span class="token number">0</span> <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>pinctrl_lcdif_dat    <span class="token comment">/* 使用到的 IO */</span>
              <span class="token operator">&amp;</span>pinctrl_lcdif_ctrl
              <span class="token operator">&amp;</span>pinctrl_lcdif_reset<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 display <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>display0<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 status <span class="token operator">=</span> <span class="token string">"okay"</span><span class="token punctuation">;</span>
 
 display0<span class="token operator">:</span> display <span class="token punctuation">{<!-- --></span>             <span class="token comment">/* display 属性，指定 LCD 属性信息所在的子节点 */</span>
     bits<span class="token operator">-</span>per<span class="token operator">-</span>pixel <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">16</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>      <span class="token comment">/* 一个像素占用几个 bit */</span>
     bus<span class="token operator">-</span>width <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">24</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>           <span class="token comment">/* 总线宽度 */</span>

     display<span class="token operator">-</span>timings <span class="token punctuation">{<!-- --></span>
         native<span class="token operator">-</span>mode <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>timing0<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">/* 时序信息 */</span>
             timing0<span class="token operator">:</span> timing0 <span class="token punctuation">{<!-- --></span> 
             clock<span class="token operator">-</span>frequency <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">9200000</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>     <span class="token comment">/* LCD 像素时钟，单位 Hz */</span>
             hactive <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">480</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>                 <span class="token comment">/* LCD X 轴像素个数 */</span>
             vactive <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">272</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>                 <span class="token comment">/* LCD Y 轴像素个数 */</span>
             hfront<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">8</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>              <span class="token comment">/* LCD hfp 参数 */</span>
             hback<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">4</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>               <span class="token comment">/* LCD hbp 参数 */</span>
             hsync<span class="token operator">-</span>len <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">41</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>                <span class="token comment">/* LCD hspw 参数 */</span>
             vback<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>               <span class="token comment">/* LCD vbp 参数 */</span>
             vfront<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">4</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>              <span class="token comment">/* LCD vfp 参数 */</span>
             vsync<span class="token operator">-</span>len <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">10</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>                <span class="token comment">/* LCD vspw 参数 */</span>

             hsync<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>     <span class="token comment">/* hsync 数据线极性 */</span>
             vsync<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>     <span class="token comment">/* vsync 数据线极性 */</span>
             de<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>        <span class="token comment">/* de 数据线极性 */</span>
             pixelclk<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>  <span class="token comment">/* clk 数据线先极性 */</span>
         <span class="token punctuation">}</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>修改点：<br> ① pinctrl_lcdif_reset 引脚用于复位，不接也可以，没有用到复位引脚的可以直接删除。<br> ② bits-per-pixel 需要把 16 改成 24，因为这里用的是 RGB888 格式。<br> ③ bus-width 是总线宽度，也要设置成 24。<br> ④ 时序是重点！！！LCD 商家没有直接给出的需要自己去数据手册中找，根据之前的裸机开发中的时序截图：<br> <img src="https://images2.imgbox.com/b7/4b/HzIA0rSI_o.png" alt="在这里插入图片描述"><br> timings 节点我们应该这么改：</p> 
<pre><code class="prism language-c">timing0<span class="token operator">:</span> timing0 <span class="token punctuation">{<!-- --></span> 
 clock<span class="token operator">-</span>frequency <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">51200000</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>     <span class="token comment">/* LCD 像素时钟，单位 Hz */</span>
 hactive <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1024</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>                 <span class="token comment">/* LCD X 轴像素个数 */</span>
 vactive <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">600</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>                  <span class="token comment">/* LCD Y 轴像素个数 */</span>
 hfront<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">160</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>             <span class="token comment">/* LCD hfp 参数 */</span>
 hback<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">140</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>              <span class="token comment">/* LCD hbp 参数 */</span>
 hsync<span class="token operator">-</span>len <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">20</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>                 <span class="token comment">/* LCD hspw 参数 */</span>
 vback<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">20</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>               <span class="token comment">/* LCD vbp 参数 */</span>
 vfront<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">12</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>              <span class="token comment">/* LCD vfp 参数 */</span>
 vsync<span class="token operator">-</span>len <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">3</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>                  <span class="token comment">/* LCD vspw 参数 */</span>

 hsync<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>               <span class="token comment">/* hsync 数据线极性 */</span>
 vsync<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>               <span class="token comment">/* vsync 数据线极性 */</span>
 de<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>                  <span class="token comment">/* de 数据线极性 */</span>
 pixelclk<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>            <span class="token comment">/* clk 数据线先极性 */</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="LCD__1374"></a>LCD 背光节点信息</h4> 
<p>LCD 接口背光控制 IO 连接到了 I.MX6U 的 GPIO1_IO08 引脚上，GPIO1_IO08 复用为 PWM1_OUT，通过 PWM 信号来控制 LCD 屏幕背光的亮度。</p> 
<pre><code class="prism language-c">pinctrl_pwm1<span class="token operator">:</span> pwm1grp <span class="token punctuation">{<!-- --></span>
 fsl<span class="token punctuation">,</span>pins <span class="token operator">=</span> <span class="token operator">&lt;</span>MX6UL_PAD_GPIO1_IO08__PWM1_OUT <span class="token number">0x110b0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">//IO 复用为 PWM1_OUT，并设置电气属性为 0x110b0</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>pinctrl_pwm1 节点就已经指定了 GPIO1_IO08 引脚。<br> LCD 背光要用到 PWM1，因此也要设置 PWM1 节点，在厂商设备树中可以看到：</p> 
<pre><code class="prism language-c">pwm1<span class="token operator">:</span> pwm@<span class="token number">02080000</span> <span class="token punctuation">{<!-- --></span>
 compatible <span class="token operator">=</span> <span class="token string">"fsl,imx6ul-pwm"</span><span class="token punctuation">,</span> <span class="token string">"fsl,imx27-pwm"</span><span class="token punctuation">;</span>
 reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x02080000</span> <span class="token number">0x4000</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
 interrupts <span class="token operator">=</span> <span class="token operator">&lt;</span>GIC_SPI <span class="token number">83</span> IRQ_TYPE_LEVEL_HIGH<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 clocks <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>clks IMX6UL_CLK_PWM1<span class="token operator">&gt;</span><span class="token punctuation">,</span><span class="token operator">&lt;</span><span class="token operator">&amp;</span>clks IMX6UL_CLK_PWM1<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 clock<span class="token operator">-</span>names <span class="token operator">=</span> <span class="token string">"ipg"</span><span class="token punctuation">,</span> <span class="token string">"per"</span><span class="token punctuation">;</span>
 <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pwm</span><span class="token expression"><span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span></span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>我们要使用这个设备，所以需要对其引用：</p> 
<pre><code class="prism language-c"><span class="token operator">&amp;</span>pwm1 <span class="token punctuation">{<!-- --></span>
 pinctrl<span class="token operator">-</span>names <span class="token operator">=</span> <span class="token string">"default"</span><span class="token punctuation">;</span>
 pinctrl<span class="token operator">-</span><span class="token number">0</span> <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>pinctrl_pwm1<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 status <span class="token operator">=</span> <span class="token string">"okay"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>对于 pwm1 是有专门的设备树节点和驱动的，这里属于是直接拿来用了。<br> 然后对于背光控制又是一个驱动，只不过这个驱动针对的硬件就是上面的 pwm1，我们直接使用即可。<br> 我们还需要一个节点来将 LCD 背光和 PWM1_OUT 连接起来。这个节点就是 backlight ， backlight 节点描述可以参考<br> Documentation/devicetree/indings/video/backlight/pwm-backlight.txt 这个文档，此文档详细讲解了 backlight 节点该如何去创建，这里大概总结一下：<br> ①、节点名称要为“backlight”。<br> ②、节点的 compatible 属性值要为“pwm-backlight”，因此可以通过在 Linux 内核中搜索 pwm-backlight 来查找 PWM 背 光 控 制 驱 动 程 序 ， 这个驱动程序文件为 drivers/video/backlight/pwm_bl.c，感兴趣的可以去看一下这个驱动程序。<br> ③、pwms属性用于描述背光所使用的PWM以及PWM频率，比如本章我们要使用的pwm1，pwm 频率设置为 5KHz(NXP 官方推荐设置)。<br> ④、<strong>brightness-levels 属性描述亮度级别，范围为 0~255，0 表示 PWM 占空比为 0%，也就是亮度最低，255 表示 100%占空比，也就是亮度最高。至于设置几级亮度，大家可以自行填写此属性</strong>。一般需要驱动工程师编写接口给上层应用控制。<br> ⑤、default-brightness-level 属性为默认亮度级别。</p> 
<pre><code class="prism language-c">backlight <span class="token punctuation">{<!-- --></span>
 compatible <span class="token operator">=</span> <span class="token string">"pwm-backlight"</span><span class="token punctuation">;</span>
 pwms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>pwm1 <span class="token number">0</span> <span class="token number">5000000</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
 brightness<span class="token operator">-</span>levels <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span> <span class="token number">4</span> <span class="token number">8</span> <span class="token number">16</span> <span class="token number">32</span> <span class="token number">64</span> <span class="token number">128</span> <span class="token number">255</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>    <span class="token comment">//8级亮度分布</span>
 <span class="token keyword">default</span><span class="token operator">-</span>brightness<span class="token operator">-</span>level <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">6</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>    <span class="token comment">//默认使用第 6 个亮度，也就是 128</span>
 status <span class="token operator">=</span> <span class="token string">"okay"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>brightness-levels = &lt;0 4 8 16 32 64 128 255&gt; 表示使用 8 级亮度分布，对应占空比为 0%、1.57%、3.13%、6.27%、12.55%、25.1%、50.19%、100%，如果嫌少可以自行添加。</p> 
<p>至此设备树就修改完成了。<br> 设备配置这部分参考一下就行了，不同的处理器设备树不一样，主要是要根据厂商提供的设备树原型去改动。</p> 
<h3><a id="LCD__1428"></a>LCD 屏幕基本测试</h3> 
<ol><li>编译新的设备树</li></ol> 
<pre><code class="prism language-c">make dtbs
</code></pre> 
<ol start="2"><li>使能 Linux logo 显示<br> Linux 内核启动时可以选择显示小企鹅 logo，只要 logo 显示没问题就基本正常了。</li></ol> 
<pre><code class="prism language-c"><span class="token operator">-&gt;</span> Device Drivers
    <span class="token operator">-&gt;</span> Graphics support 
         <span class="token operator">-&gt;</span> Bootup <span class="token function">logo</span> <span class="token punctuation">(</span>LOGO <span class="token punctuation">[</span><span class="token operator">=</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span> 
            <span class="token operator">-&gt;</span> Standard black and white Linux logo
            <span class="token operator">-&gt;</span> Standard <span class="token number">16</span><span class="token operator">-</span>color Linux logo 
            <span class="token operator">-&gt;</span> Standard <span class="token number">224</span><span class="token operator">-</span>color Linux logo
</code></pre> 
<p><img src="https://images2.imgbox.com/c0/1f/jcv54qSC_o.png" alt="在这里插入图片描述"><br> 三个选项分别对应黑白、16 位、24 位色彩格式的 logo，把这三个都选中编译进内核。重新编译内核，编译完成以后使用新的设备树文件和镜像启动系统，如果 LCD 驱动工作正常的<br> 话就会在 LCD 屏幕左上角出现一个彩色的小企鹅 logo，屏幕背景色为黑色。<br> <img src="https://images2.imgbox.com/f5/40/s2dKPuXt_o.png" alt="在这里插入图片描述"><br> 3. 设置 LCD 作为终端控制台<br> a. 设置 uboot 中的 bootargs<br> 在设备树里面的chosen 节点添加，或者重启开发板，进入 Linux 命令行，重新设置 bootargs 参数的 console 内容，命令如下所示：</p> 
<pre><code class="prism language-powershell">setenv bootargs <span class="token string">'console=tty1 console=ttymxc0,115200 root=/dev/nfs rw nfsroot=192.168.1.250:/home/user/linux/nfs/rootfs ip=192.168.1.251:192.168.1.250:192.168.1.1:255.255.255.0::eth0:off'</span>
</code></pre> 
<p>第一次设置 console=tty1，也就是设置 LCD 屏幕为控制台；<br> 第二次又设置 console=ttymxc0,115200，也就是设置串口也作为控制台。<br> 相当于我们打开了两个 console，一个是 LCD，一个是串口。<br> 但是目前，LCD 也只是输出终端信息而已，并没有交互能力。<br> b. 修改/etc/inittab 文件<br> 打开开发板根文件系统中的/etc/inittab 文件，在里面加入下面这一行：</p> 
<pre><code class="prism language-powershell">tty1::askfirst:<span class="token operator">-</span><span class="token operator">/</span>bin/sh
</code></pre> 
<p><img src="https://images2.imgbox.com/e2/4c/RyWuBDT6_o.png" alt="在这里插入图片描述"><br> 重启开发板，重启以后开发板 LCD 屏幕最后一<br> 行会显示下面一行语句：<br> Please press Enter to activate this console.<br> 上述提示语句说的是：按下回车键使能当前终端。<br> 可以接上一个 USB 键盘，Linux 内核默认已经使能了 USB 键盘驱动了，因此可以直接使用 USB 键盘。<br> 或者注册一个 KEY 按键为回车键。<br> 向 LCD 终端打印信息可以这么做：</p> 
<pre><code class="prism language-powershell"><span class="token function">echo</span> 语句 &gt; <span class="token operator">/</span>dev/tty1
</code></pre> 
<pre><code>c. LCD 背光调节
</code></pre> 
<p>背光设备树节点设置了 8 个等级的背光调节，可以设置为 0~7。<br> 可以通过设置背光等级来实现 LCD 背光亮度的调节，进入如下目录：</p> 
<pre><code class="prism language-powershell"><span class="token operator">/</span>sys/devices/platform/backlight/backlight/backlight
</code></pre> 
<p><img src="https://images2.imgbox.com/96/61/3ISClSWv_o.png" alt="在这里插入图片描述"><br> brightness 表示当前亮度等级，max_bgigntness 表示最大亮度等级。<br> 当前这两个文件内容如图所示：<br> <img src="https://images2.imgbox.com/8e/a8/8BQfa9dM_o.png" alt="在这里插入图片描述"><br> 从图可以看出，当前屏幕亮度等级为 6，根据前面的分析可以，这个是 50%亮度。<br> 屏幕最大亮度等级为 7。如果要修改屏幕亮度，只需要向 brightness 写入屏幕亮度等级。<br> 例如设置屏幕亮度等级为 7：</p> 
<pre><code class="prism language-powershell"><span class="token function">echo</span> 7 &gt; brightness
</code></pre> 
<p>如果设置 brightness 为 0 的话就会关闭 LCD背光，屏幕就会熄灭。<br> d. LCD 自动关闭解决方法<br> 默认情况下 10 分钟以后 LCD 就会熄屏，需要再使用回车唤醒，这是 Linux 内核设置的。<br> 如果要关闭 10 分钟熄屏功能，可以将 \033[9;0] 写进 blankinterval 属性。<br> blankinterval 属性可以在 Linux 源码中找到 drivers/tty/vt/vt.c，在此文件中找到 blankinterval 变量，如下所示：</p> 
<pre><code class="prism language-c"><span class="token keyword">static</span> <span class="token keyword">int</span> vesa_blank_mode<span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> vesa_off_interval<span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">int</span> blankinterval <span class="token operator">=</span> <span class="token number">10</span><span class="token operator">*</span><span class="token number">60</span><span class="token punctuation">;</span>    <span class="token comment">//默认是 10*60秒，也就是 10 分钟</span>
</code></pre> 
<h2><a id="_RK3568_mipi_LCD_1506"></a>三、实例篇：驱动 RK3568 mipi 接口LCD</h2> 
<p>先上原理图<br> <img src="https://images2.imgbox.com/38/12/UcLG2cMk_o.png" alt="在这里插入图片描述"><br> 这里使用的是 RK3568 处理原理图上的单路 DSI，在30个引脚的 FPC 插座上还集成 PWM、触摸屏、电源等管脚，但这些通通都不讲，只是驱动 LCD 的时候需要配置这些引脚。<br> 相对于前面的 LCDIF 接口，mipi 算是节约了 RGB 三原色的大量引脚了。</p> 
<h3><a id="CSI__DSI__1511"></a>CSI 和 DSI 的区别</h3> 
<p>CSI：串行摄像接口（用于摄像头）<br> DSI：串行显示接口（用于显示屏）<br> MIPI-DSI是一种应用于显示技术的串行接口，兼容DPI(显示像素接口，Display Pixel Interface)、DBI(显示总线接口，Display Bus Interface)和DCS(显示命令集，Display Command Set)，以串行的方式发送像素信息或指令给外围，而且从外围中读取状态信息或像素信息，而且在传输的过程中享有自己独立的通信协议，包括数据包格式和纠错检错机制。</p> 
<p>MIPI-DSI具备高速模式和低速模式两种工作模式，全部数据通道都可以用于单向的高速传输，但只有第一个数据通道才可用于低速双向传输，从属端的状态信息、像素等式通过该数据通道返回。时钟通道专用于在高速传输数据的过程中传输同步时钟信号。此外，一个主机端可允许同时与多个从属端进行通信。</p> 
<p>MIPI DSI 接口分为 HOST 和 PHY，HOST 是 DSI 的主控制器，这部分明显是原厂 BSP 工程师配置的。我们配置的部分就是 PHY 部分。<br> 在数据手册中就要查阅 PHY 部分，更重要的是阅读内核设备树资料中的 DSI 配置部分，这个非常重要，每一个配置选项都有详细的说明。<br> 可以参考下面这份 firefly 的文档，基于瑞芯微原厂指导书修改的。<br> https://www.t-firefly.com/ueditor/php/upload/file/20171213/1513128959299913.pdf<br> 文档截图：<br> <img src="https://images2.imgbox.com/8a/49/e3IakmX9_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="__1524"></a>* 设备树配置</h3> 
<p>再来看这部分的引脚的设备配置：</p> 
<pre><code class="prism language-powershell"><span class="token operator">/</span><span class="token operator">*</span> MIPI 7 <span class="token operator">*</span><span class="token operator">/</span>
&amp;dsi1 <span class="token punctuation">{<!-- --></span>
        status = <span class="token string">"disabled"</span><span class="token punctuation">;</span>
        <span class="token operator">/</span><span class="token operator">/</span>rockchip<span class="token punctuation">,</span>lane-rate = &lt;1000&gt;<span class="token punctuation">;</span>
        dsi1_panel: panel@0 <span class="token punctuation">{<!-- --></span>
                status = <span class="token string">"disabled"</span><span class="token punctuation">;</span>
                compatible = <span class="token string">"simple-panel-dsi"</span><span class="token punctuation">;</span>    <span class="token operator">/</span><span class="token operator">/</span>匹配驱动名为 simple-panel-dsi
                reg = &lt;0&gt;<span class="token punctuation">;</span>
                backlight = &lt;&amp;backlight&gt;<span class="token punctuation">;</span>
                <span class="token function">reset-delay</span><span class="token operator">-</span>ms = &lt;60&gt;<span class="token punctuation">;</span>
                <span class="token function">enable-delay</span><span class="token operator">-</span>ms = &lt;60&gt;<span class="token punctuation">;</span>
                prepare-delay-ms = &lt;60&gt;<span class="token punctuation">;</span>
                unprepare-delay-ms = &lt;60&gt;<span class="token punctuation">;</span>
                <span class="token function">disable-delay</span><span class="token operator">-</span>ms = &lt;60&gt;<span class="token punctuation">;</span>
                dsi<span class="token punctuation">,</span>flags = &lt;<span class="token punctuation">(</span>MIPI_DSI_MODE_VIDEO <span class="token punctuation">|</span> MIPI_DSI_MODE_VIDEO_BURST <span class="token punctuation">|</span>
                              MIPI_DSI_MODE_LPM <span class="token punctuation">|</span> MIPI_DSI_MODE_EOT_PACKET<span class="token punctuation">)</span>&gt;<span class="token punctuation">;</span>
                dsi<span class="token punctuation">,</span>format = &lt;MIPI_DSI_FMT_RGB888&gt;<span class="token punctuation">;</span>
                dsi<span class="token punctuation">,</span>lanes  = &lt;4&gt;<span class="token punctuation">;</span>
                panel-init-<span class="token keyword">sequence</span> = <span class="token punctuation">[</span>
                        29 00 03 E0 AB BA
                        29 00 03 E1 BA AB
                        15 00 02 B0 00
                        29 00 05 B1 10 01 47 FF
                        29 00 07 B2 0C 0E 04 14 14 14
                        29 00 04 B3 56 D3 00
                        29 00 04 B4 22 30 04
                        15 00 02 B5 00
                        29 00 08 B6 B0 00 00 10 00 10 00
                        29 00 09 B7 0E 00 FF 08 08 FF FF 00
                        29 00 08 B8 05 12 29 49 48 00 00
                        29 00 27 B9 4D 42 38 31 33 27 2F 1B 36 35 35 53 41 49 3D 3D 33 29 26 4C 42 39 31 33 27 2F 1B 36 35 35 53 41 49 3D 3D 33 29 26
                        29 00 09 BA 00 00 00 44 24 00 00 00
                        29 00 04 BB 76 00 00
                        29 00 03 BC 00 00
                        29 00 06 BD FF 00 00 00 00
                        15 00 02 BE 00
                        29 00 11 C0 98 76 12 34 33 33 44 44 06 04 8A 04 0F 00 00 00
                        29 00 0B C1 53 94 02 85 06 04 8A 04 54 00
                        29 00 0D C2 37 09 08 89 08 10 22 21 44 BB 18 00
                        29 00 17 C3 9C 1D 1E 1F 10 12 0C 0E 05 24 24 24 24 24 24 07 24 24 24 24 24 24
                        29 00 17 C4 1C 1D 1E 1F 11 13 0D 0F 04 24 24 24 24 24 24 06 24 24 24 24 24 24
                        29 00 04 C5 E8 85 76
                        29 00 03 C6 20 20
                        29 00 17 C7 41 01 0D 11 09 15 19 4F 10 D7 CF 19 1B 1D 03 02 25 30 00 03 FF 00
                        29 00 07 C8 61 00 31 42 54 16
                        29 00 06 C9 A1 22 FF Cd 23
                        29 00 03 CA 4B 43
                        29 00 05 CC 2E 02 04 08
                        29 00 09 CD 0E 64 64 20 1E 6B 06 83
                        29 00 04 D0 27 10 80
                        29 00 05 D1 00 0D FF 0F
                        29 00 05 D2 E3 2B 38 00
                        29 00 0C D4 00 01 00 0E 04 44 08 10 00 07 00
                        15 00 02 D5 00
                        29 00 03 D6 00 00
                        29 00 05 D7 00 00 00 00
                        29 00 04 E4 08 55 03
                        29 00 09 E6 00 01 FF FF FF FF FF FF
                        29 00 04 E7 00 00 00
                        29 00 08 E8 D5 FF FF FF 00 00 00
                        15 00 02 E9 FF
                        29 00 06 F0 12 03 20 00 FF
                        29 00 1B F1 A6 C8 EA E6 E4 CC E4 BE F0 B2 AA C7 FF 66 98 E3 87 C8 99 C8 8C BE 96 91 8F FF
                        15 00 02 F3 03
                        29 00 1B F4 FF FE <span class="token function">FC</span> FA F8 F4 F0 E8 E0 D0 C0 A0 80 7F 5F 3F 2F 1F 17 0F 0B 07 05 03 01 00
                        29 00 1B F5 FF FE <span class="token function">FC</span> FA F8 F4 F0 E8 E0 D0 C0 A0 80 7F 5F 3F 2F 1F 17 0F 0B 07 05 03 01 00
                        29 00 1B F6 FF FE <span class="token function">FC</span> FA F8 F4 F0 E8 E0 D0 C0 A0 80 7F 5F 3F 2F 1F 17 0F 0B 07 05 03 01 00
                        29 00 08 F7 00 00 00 00 00 00 00
                        29 00 08 F8 00 00 00 00 00 00 00
                        29 00 08 F9 00 00 00 00 00 00 00
                        29 00 1A FA 00 84 12 21 48 48 21 12 84 69 69 5A A5 96 96 A5 5A B7 DE ED 7B 7B ED DE B7
                        29 00 18 FB 00 12 0F FF FF FF 00 38 40 08 70 0B 40 19 50 21 C0 27 60 2D 00 00 0F
                        29 00 03 E3 20 21
                        05 C8 01 11
                        05 14 01 29
                <span class="token punctuation">]</span><span class="token punctuation">;</span>

                panel-<span class="token function">exit-sequence</span> = <span class="token punctuation">[</span>
                        05 05 01 28
                        05 78 01 10
                <span class="token punctuation">]</span><span class="token punctuation">;</span>
                disp_timings1: display-timings <span class="token punctuation">{<!-- --></span>
                        native-mode = &lt;&amp;dsi1_timing0&gt;<span class="token punctuation">;</span>
                        dsi1_timing0: timing0 <span class="token punctuation">{<!-- --></span>
                                screen-<span class="token function">type</span> = &lt;SCREEN_MIPI&gt;<span class="token punctuation">;</span>     <span class="token operator">/</span><span class="token operator">/</span>单mipi SCREEN_MIPI 双mipi SCREEN_DUAL_MIPI
                                clock-frequency = &lt;60000000&gt;<span class="token punctuation">;</span>    <span class="token operator">/</span><span class="token operator">/</span>像素时钟大小
                                hactive = &lt;800&gt;<span class="token punctuation">;</span>                 <span class="token operator">/</span><span class="token operator">/</span> Y 轴像素个数
                                vactive = &lt;1280&gt;<span class="token punctuation">;</span>                <span class="token operator">/</span><span class="token operator">/</span> X 轴像素个数
                                hfront-porch = &lt;80&gt;<span class="token punctuation">;</span>             <span class="token operator">/</span><span class="token operator">/</span> hfp 参数
                                hsync-len = &lt;20&gt;<span class="token punctuation">;</span>                <span class="token operator">/</span><span class="token operator">/</span> hspw 参数
                                hback-porch = &lt;80&gt;<span class="token punctuation">;</span>              <span class="token operator">/</span><span class="token operator">/</span> hbp 参数
                                vfront-porch = &lt;20&gt;<span class="token punctuation">;</span>             <span class="token operator">/</span><span class="token operator">/</span> vfp 参数
                                vsync-len = &lt;4&gt;<span class="token punctuation">;</span>                 <span class="token operator">/</span><span class="token operator">/</span> vspw 参数
                                vback-porch = &lt;12&gt;<span class="token punctuation">;</span>              <span class="token operator">/</span><span class="token operator">/</span> vbp 参数
                                hsync-active = &lt;0&gt;<span class="token punctuation">;</span>              <span class="token operator">/</span><span class="token operator">/</span> hsync 数据线极性
                                vsync-active = &lt;0&gt;<span class="token punctuation">;</span>              <span class="token operator">/</span><span class="token operator">/</span> vsync 数据线极性
                                de-active = &lt;0&gt;<span class="token punctuation">;</span>                 <span class="token operator">/</span><span class="token operator">/</span> de 数据线极性
                                pixelclk-active = &lt;0&gt;<span class="token punctuation">;</span>           <span class="token operator">/</span><span class="token operator">/</span> clk 数据线先极性
                        <span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>
                ports <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">#address-cells = &lt;1&gt;;</span>
                        <span class="token comment">#size-cells = &lt;0&gt;;</span>
                        port@0 <span class="token punctuation">{<!-- --></span>
                                reg = &lt;0&gt;<span class="token punctuation">;</span>
                                panel_in_dsi1: endpoint <span class="token punctuation">{<!-- --></span>
                                        remote-endpoint = &lt;&amp;dsi1_out_panel&gt;<span class="token punctuation">;</span>
                                <span class="token punctuation">}</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        ports <span class="token punctuation">{<!-- --></span>
                <span class="token comment">#address-cells = &lt;1&gt;;</span>
                <span class="token comment">#size-cells = &lt;0&gt;;</span>
                port@1 <span class="token punctuation">{<!-- --></span>
                        reg = &lt;1&gt;<span class="token punctuation">;</span>
                        dsi1_out_panel: endpoint <span class="token punctuation">{<!-- --></span>
                                remote-endpoint = &lt;&amp;panel_in_dsi1&gt;<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token operator">/</span><span class="token operator">*</span> 触摸屏 <span class="token operator">*</span><span class="token operator">/</span>
&amp;i2c1 <span class="token punctuation">{<!-- --></span>
    status = <span class="token string">"okay"</span><span class="token punctuation">;</span>
    ft5x061:ft5x06@38 <span class="token punctuation">{<!-- --></span>
        status = <span class="token string">"disabled"</span><span class="token punctuation">;</span>
        compatible = <span class="token string">"edt,edt-ft5306"</span><span class="token punctuation">;</span>
        reg = &lt;0x38&gt;<span class="token punctuation">;</span>
        touch-gpio = &lt;&amp;gpio3 RK_PA5 IRQ_TYPE_EDGE_RISING&gt;<span class="token punctuation">;</span>
        interrupt-parent = &lt;&amp;gpio3&gt;<span class="token punctuation">;</span>
        interrupts = &lt;RK_PA5 IRQ_TYPE_LEVEL_LOW&gt;<span class="token punctuation">;</span>
        <span class="token function">reset-gpio</span> = &lt;&amp;gpio0 RK_PB6 GPIO_ACTIVE_LOW&gt;<span class="token punctuation">;</span>
        touchscreen-size-x = &lt;800&gt;<span class="token punctuation">;</span>
        touchscreen-size-y = &lt;1280&gt;<span class="token punctuation">;</span>
        touch_type = &lt;1&gt;<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">#if defined(LCD_TYPE_MIPI)    //如果使用的是屏幕是 mipi 屏幕</span>
&amp;backlight<span class="token punctuation">{<!-- --></span>
    pwms = &lt;&amp;pwm5 0 25000 0&gt;<span class="token punctuation">;</span>
    status = <span class="token string">"okay"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
&amp;dsi1<span class="token punctuation">{<!-- --></span>
    status = <span class="token string">"okay"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
&amp;dsi1_panel
<span class="token punctuation">{<!-- --></span>
    status = <span class="token string">"okay"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
&amp;dsi1_in_vp0 <span class="token punctuation">{<!-- --></span>
    status = <span class="token string">"disabled"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
&amp;dsi1_in_vp1 <span class="token punctuation">{<!-- --></span>
    status = <span class="token string">"okay"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
&amp;ft5x061                <span class="token operator">/</span><span class="token operator">/</span>使能触摸屏芯片
<span class="token punctuation">{<!-- --></span>
    status = <span class="token string">"okay"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
&amp;route_dsi1<span class="token punctuation">{<!-- --></span>            <span class="token operator">/</span><span class="token operator">/</span>指定uboot 阶段的logo配置，connect属性指定的vop需与ports的一致
    status = <span class="token string">"okay"</span><span class="token punctuation">;</span>
    connect = &lt;&amp;vp1_out_dsi1&gt;<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
&amp;video_phy1<span class="token punctuation">{<!-- --></span>            <span class="token operator">/</span><span class="token operator">/</span>使能控制LCD的视频芯片
    status = <span class="token string">"okay"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">#endif</span>

<span class="token operator">/</span><span class="token operator">*</span> 下面都是移植无关的，但是需要了解 <span class="token operator">*</span><span class="token operator">/</span>

<span class="token operator">/</span><span class="token operator">*</span> 背光 <span class="token operator">*</span><span class="token operator">/</span>
backlight: backlight <span class="token punctuation">{<!-- --></span>
        compatible = <span class="token string">"pwm-backlight"</span><span class="token punctuation">;</span>        <span class="token operator">/</span><span class="token operator">/</span>匹配驱动名为 pwm-backlight
        pwms = &lt;&amp;pwm4 0 25000 0&gt;<span class="token punctuation">;</span>            <span class="token operator">/</span><span class="token operator">/</span>使用 pwm4
        brightness-levels = &lt;                <span class="token operator">/</span><span class="token operator">/</span>它这里是默认支持所有亮度范围的
              0  20  20  21  21  22  22  23
             23  24  24  25  25  26  26  27
             27  28  28  29  29  30  30  31
             31  32  32  33  33  34  34  35
             35  36  36  37  37  38  38  39
             40  41  42  43  44  45  46  47
             48  49  50  51  52  53  54  55
             56  57  58  59  60  61  62  63
             64  65  66  67  68  69  70  71
             72  73  74  75  76  77  78  79
             80  81  82  83  84  85  86  87
             88  89  90  91  92  93  94  95
             96  97  98  99 100 101 102 103
            104 105 106 107 108 109 110 111
            112 113 114 115 116 117 118 119
            120 121 122 123 124 125 126 127
            128 129 130 131 132 133 134 135
            136 137 138 139 140 141 142 143
            144 145 146 147 148 149 150 151
            152 153 154 155 156 157 158 159
            160 161 162 163 164 165 166 167
            168 169 170 171 172 173 174 175
            176 177 178 179 180 181 182 183
            184 185 186 187 188 189 190 191
            192 193 194 195 196 197 198 199
            200 201 202 203 204 205 206 207
            208 209 210 211 212 213 214 215
            216 217 218 219 220 221 222 223
            224 225 226 227 228 229 230 231
            232 233 234 235 236 237 238 239
            240 241 242 243 244 245 246 247
            248 249 250 251 252 253 254 255
        &gt;<span class="token punctuation">;</span>
        default-brightness-level = &lt;220&gt;<span class="token punctuation">;</span>    <span class="token operator">/</span><span class="token operator">/</span>默认使用第 220 个亮度
<span class="token punctuation">}</span><span class="token punctuation">;</span>

pwm4 <span class="token punctuation">{<!-- --></span>
    <span class="token operator">/</span>omit-<span class="token keyword">if</span><span class="token operator">-</span>no-ref/
    pwm4_pins: pwm4-pins <span class="token punctuation">{<!-- --></span>
        rockchip<span class="token punctuation">,</span>pins =
            <span class="token operator">/</span><span class="token operator">*</span> pwm4 <span class="token operator">*</span><span class="token operator">/</span>
            &lt;0 RK_PC3 1 &amp;pcfg_pull_none&gt;<span class="token punctuation">;</span>    <span class="token operator">/</span><span class="token operator">/</span>引脚、复用、电器属性
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="panelinitsequence_1752"></a>panel-init-sequence</h4> 
<pre><code class="prism language-powershell">panel-init-<span class="token keyword">sequence</span> = <span class="token punctuation">[</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<p>这部分用于初始化 LCD，可以在 kernel/Documentation/devicetree/bindings/display/panel/simple-panel.txt 文档中查看详细解释。初始化的部分数据是要找LCD厂商要的，然后我们再转化成处理器厂商的命令。<br> 这部分 LCD 商家直接给了我现成的数据，但是我们可以来看怎么转化这部分数据。<br> 参考瑞芯微官方指导文档《RockChip_LCD开发文档v1.6》<br> 例：LCD 厂商给的数据：</p> 
<pre><code class="prism language-c">U16 B0<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">0xB0</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x0B</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">,</span><span class="token number">0x0D</span><span class="token punctuation">,</span><span class="token number">0x11</span><span class="token punctuation">,</span><span class="token number">0x06</span><span class="token punctuation">,</span><span class="token number">0x01</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x1D</span><span class="token punctuation">,</span><span class="token number">0x04</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">,</span><span class="token number">0x27</span><span class="token punctuation">,</span><span class="token number">0x30</span><span class="token punctuation">,</span><span class="token number">0x19</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
U16 B1<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">0xB1</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x0B</span><span class="token punctuation">,</span><span class="token number">0x14</span><span class="token punctuation">,</span><span class="token number">0x0C</span><span class="token punctuation">,</span><span class="token number">0x11</span><span class="token punctuation">,</span><span class="token number">0x05</span><span class="token punctuation">,</span><span class="token number">0x03</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token number">0x04</span><span class="token punctuation">,</span><span class="token number">0x13</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">,</span><span class="token number">0x28</span><span class="token punctuation">,</span><span class="token number">0x30</span><span class="token punctuation">,</span><span class="token number">0x19</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
U16 E1<span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">0xE1</span><span class="token punctuation">,</span><span class="token number">0x05</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x04</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
U16 E2<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">0xE2</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
U16 E5<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">0xE5</span><span class="token punctuation">,</span><span class="token number">0x07</span><span class="token punctuation">,</span><span class="token number">0x34</span><span class="token punctuation">,</span><span class="token number">0xA0</span><span class="token punctuation">,</span><span class="token number">0xA0</span><span class="token punctuation">,</span><span class="token number">0x05</span><span class="token punctuation">,</span><span class="token number">0x34</span><span class="token punctuation">,</span><span class="token number">0xA0</span><span class="token punctuation">,</span><span class="token number">0xA0</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
U16 E8<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">0xE8</span><span class="token punctuation">,</span><span class="token number">0x06</span><span class="token punctuation">,</span><span class="token number">0x34</span><span class="token punctuation">,</span><span class="token number">0xA0</span><span class="token punctuation">,</span><span class="token number">0xA0</span><span class="token punctuation">,</span><span class="token number">0x04</span><span class="token punctuation">,</span><span class="token number">0x34</span><span class="token punctuation">,</span><span class="token number">0xA0</span><span class="token punctuation">,</span><span class="token number">0xA0</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
U16 ED<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">0xED</span><span class="token punctuation">,</span><span class="token number">0xAA</span><span class="token punctuation">,</span><span class="token number">0x54</span><span class="token punctuation">,</span><span class="token number">0x0B</span><span class="token punctuation">,</span><span class="token number">0xBF</span><span class="token punctuation">,</span><span class="token number">0xFF</span><span class="token punctuation">,</span><span class="token number">0xFF</span><span class="token punctuation">,</span><span class="token number">0xFF</span><span class="token punctuation">,</span><span class="token number">0xFF</span><span class="token punctuation">,</span><span class="token number">0xFF</span><span class="token punctuation">,</span><span class="token number">0xFF</span><span class="token punctuation">,</span><span class="token number">0xFF</span><span class="token punctuation">,</span><span class="token number">0xFF</span><span class="token punctuation">,</span><span class="token number">0xFB</span><span class="token punctuation">,</span><span class="token number">0xB0</span><span class="token punctuation">,</span><span class="token number">0x45</span><span class="token punctuation">,</span><span class="token number">0xAA</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token function">Generic_Long_Write_5P</span><span class="token punctuation">(</span><span class="token number">0xFF</span><span class="token punctuation">,</span><span class="token number">0x77</span><span class="token punctuation">,</span><span class="token number">0x01</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Generic_Long_Write_2P</span><span class="token punctuation">(</span><span class="token number">0xC0</span><span class="token punctuation">,</span><span class="token number">0xE9</span><span class="token punctuation">,</span><span class="token number">0x03</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//display line setting //800</span>
<span class="token function">Generic_Long_Write_2P</span><span class="token punctuation">(</span><span class="token number">0xC1</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">,</span><span class="token number">0x02</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//Porch control </span>
<span class="token function">Generic_Long_Write_2P</span><span class="token punctuation">(</span><span class="token number">0xC2</span><span class="token punctuation">,</span><span class="token number">0x31</span><span class="token punctuation">,</span><span class="token number">0x08</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Generic_Short_Write_1P</span><span class="token punctuation">(</span><span class="token number">0xCC</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Generic_Long_Write_FIFO</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span>B0<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Generic_Long_Write_FIFO</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span>B1<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token function">Generic_Long_Write_5P</span><span class="token punctuation">(</span><span class="token number">0xFF</span><span class="token punctuation">,</span><span class="token number">0x77</span><span class="token punctuation">,</span><span class="token number">0x01</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Generic_Short_Write_1P</span><span class="token punctuation">(</span><span class="token number">0xB0</span><span class="token punctuation">,</span><span class="token number">0x35</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//4D</span>
<span class="token function">Generic_Short_Write_1P</span><span class="token punctuation">(</span><span class="token number">0xB1</span><span class="token punctuation">,</span><span class="token number">0x38</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//21 71 VCOM </span>
<span class="token function">Generic_Short_Write_1P</span><span class="token punctuation">(</span><span class="token number">0xB2</span><span class="token punctuation">,</span><span class="token number">0x02</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//VGH VOLTAGE SETTING</span>
<span class="token function">Generic_Short_Write_1P</span><span class="token punctuation">(</span><span class="token number">0xB3</span><span class="token punctuation">,</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Generic_Short_Write_1P</span><span class="token punctuation">(</span><span class="token number">0xB5</span><span class="token punctuation">,</span><span class="token number">0x4E</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//VGL VOLTAGE SETTING</span>
<span class="token function">Generic_Short_Write_1P</span><span class="token punctuation">(</span><span class="token number">0xB7</span><span class="token punctuation">,</span><span class="token number">0x85</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Generic_Short_Write_1P</span><span class="token punctuation">(</span><span class="token number">0xB8</span><span class="token punctuation">,</span><span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Generic_Short_Write_1P</span><span class="token punctuation">(</span><span class="token number">0xB9</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
<span class="token comment">//Generic_Short_Write_1P(0xC0,0x90);</span>
<span class="token function">Generic_Short_Write_1P</span><span class="token punctuation">(</span><span class="token number">0xC1</span><span class="token punctuation">,</span><span class="token number">0x78</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Generic_Short_Write_1P</span><span class="token punctuation">(</span><span class="token number">0xC2</span><span class="token punctuation">,</span><span class="token number">0x78</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Generic_Short_Write_1P</span><span class="token punctuation">(</span><span class="token number">0xD0</span><span class="token punctuation">,</span><span class="token number">0x88</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">Delay</span> <span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 

<span class="token function">Generic_Long_Write_3P</span><span class="token punctuation">(</span><span class="token number">0xE0</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x02</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Generic_Long_Write_FIFO</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span>E1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Generic_Long_Write_FIFO</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span>E2<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token function">Generic_Long_Write_4P</span><span class="token punctuation">(</span><span class="token number">0xE3</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x33</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Generic_Long_Write_2P</span><span class="token punctuation">(</span><span class="token number">0xE4</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Generic_Long_Write_FIFO</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span>E5<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token function">Generic_Long_Write_4P</span><span class="token punctuation">(</span><span class="token number">0xE6</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x33</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Generic_Long_Write_2P</span><span class="token punctuation">(</span><span class="token number">0xE7</span><span class="token punctuation">,</span><span class="token number">0x22</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Generic_Long_Write_FIFO</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span>E8<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token function">Generic_Long_Write_7P</span><span class="token punctuation">(</span><span class="token number">0xEB</span><span class="token punctuation">,</span><span class="token number">0x02</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">,</span><span class="token number">0x10</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Generic_Long_Write_2P</span><span class="token punctuation">(</span><span class="token number">0xEC</span><span class="token punctuation">,</span><span class="token number">0x02</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Generic_Long_Write_FIFO</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span>ED<span class="token punctuation">)</span><span class="token punctuation">;</span>

 

<span class="token function">Generic_Long_Write_5P</span><span class="token punctuation">(</span><span class="token number">0xFF</span><span class="token punctuation">,</span><span class="token number">0x77</span><span class="token punctuation">,</span><span class="token number">0x01</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token function">Generic_Short_Write_1P</span><span class="token punctuation">(</span><span class="token number">0x36</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token function">DCS_Short_Write_NP</span><span class="token punctuation">(</span><span class="token number">0x11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 
<span class="token function">DCS_Short_Write_NP</span><span class="token punctuation">(</span><span class="token number">0x29</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* 命令类型1： Generic_xxx_Write_xP
   xxx 是 Long 或者 Short，Long ; Long 是 39，short 是 15
   x 是 一个数字，代表写入 x+1 个字节
   命令类型2： Generic_Long_Write_FIFO(n,n[]);
   n 是一个数据
   n[] 是一个数组
   命令类型3： DCS_Short_Write_NP(n);
   n 是数据
   转化格式在下面
*/</span>
</code></pre> 
<p>例：瑞芯微 dts 里面 panel-init-sequence 命令格式介绍：<br> <img src="https://images2.imgbox.com/10/db/peKyT0Mt_o.png" alt="在这里插入图片描述"><br> 格式说明：头部3个字节（16进制），分别代表 Data Type，Delay，Payload Length。<br> 从第四个字节开始的数据代表长度为 Length 的 Payload。<br> 第一条命令的解释如下：<br> 39 00 04 b9 ff 83 94<br> data type : 0x39 (DCS Long Write)<br> Delay : 0x00 (0ns)<br> Payload Length : 0x04(4Bytes)<br> payload : 0xb9 0xff 0x83 0x94<br> 最后一条命令的注释：<br> 05 14 01 29<br> data type : 0x05 (DCS Short Write : no parameters)<br> Delay : 0x14 (20ns)<br> Payload Length : 0x01(4Bytes)<br> payload : 0x29</p> 
<h4><a id="displaytimings_1855"></a>display-timings</h4> 
<p>时序参数设置是最重要的一部分！！！<br> LCD 厂商直接给了这部分数据，直接搬进设备树即可。</p> 
<h4><a id="ports_1858"></a>ports</h4> 
<p>以 ports -&gt; port -&gt; endpoint -&gt; remote-endpoint 的顺序，通过remote-endpoint 属性来指定远端的设备端点。<br> vop 是视频对象平面，同样也有它自己的设备树。<br> ① dsi -&gt; ports -&gt; port dsi0_in_vp0(endpoint) 下的remote-endpoint 为dsi与vop间建立关系的属性配置，其中dsi作为输入端，另一端接的是vop out端。<br> ② dsi -&gt; ports -&gt; port -&gt; dsi_out_panel1/dsi_out_panel2/dsi_out_panel3(endpoint)下的remote-endpoint 为dsi 与 panel 间建立关系的属性配置。此处代表有三个panel。因此 若想多屏可以在此处增加节点达到和新panel建立联系。<br> ③ dsi-&gt;panel 为panel的配置。正常是单独创建个屏dtsi文件后，在文件中引用（&amp;dsi0) 来进行新增屏。此处只是为了更好的分析而集成在一起（本身设备树在编译的时候也是覆盖的操作）。<br> ④ dsi -&gt; panel -&gt; ports -&gt; port -&gt; panel1_in_dsi(endpoint) 下的remote-endpoint 为panel与dsi间的关系，即此处是连到dsi_out_panel1上。</p> 
<h4><a id="pwm_1865"></a>pwm</h4> 
<p>1 秒=1000000000 纳秒</p> 
<pre><code class="prism language-powershell">pwms = &lt;&amp;pwm4 0 25000&gt;    <span class="token operator">/</span><span class="token operator">/</span>&amp;pwm4 0两项代表pwmOUT0同道，25000代表初始化频率，0代表正常极性
</code></pre> 
<p>#25000 是指的25000ns 1000000000/25000=40Khz<br> 50000 20khz<br> 100000 10Khz<br> 1000000 1Khz<br> 10000000 100Hz<br> 50000000 200Hz</p> 
<h4><a id="ft5x06_1877"></a>ft5x06</h4> 
<p>触摸屏节点在触摸屏驱动篇章已经讲过了，需要了解的同学可以回去看《TSP驱动理论与实例分析》。</p> 
<h3><a id="_CONFIG_1879"></a>配置 CONFIG</h3> 
<p>按照 RK 的手册，打开三个宏：</p> 
<pre><code class="prism language-powershell">CONFIG_LCD_MIPI=y
CONFIG_MIPI_DSI=y
CONFIG_RK35_MIPI_DSI=y
</code></pre> 
<h3><a id="_1887"></a>检查电压</h3> 
<p>先不要接上屏，编译完代码烧录后开机。<br> 检查原理图上各个供电管脚的电压（DVDD、IOVDD 是否为 3.3V，VDD_LCDA 是否为 5-10V，VDD_LCDK 是否为 0V），确认电压正常后，关机，上屏，结合 开机log 看能否正常开机。</p> 
<p>参考资料<br> LINUX驱动-LCD驱动：https://www.freesion.com/article/1180923012/<br> LCD之MIPI DSI接口驱动调试流程：https://www.freesion.com/article/540743428/<br> LCD MIPI 调试方法及问题汇总：https://www.freesion.com/article/2421433882/<br> MIPI LCD 通用移植调试流程：https://www.freesion.com/article/1080767762/<br> RK3399 LINUX-SDK MIPI屏幕驱动及调试：https://www.freesion.com/article/3102348159/<br> RK3399 MIPI LCD 通用移植调试流程：https://www.freesion.com/article/9731532001/<br> MIPI屏 调试记录，panel-init-sequence 命令格式介绍：https://blog.csdn.net/qq_37858386/article/details/123705548<br> Linux MIPI DSI LCD设备驱动开发调试细节学习笔记(一)：https://mp.weixin.qq.com/s?__biz=MzA3MjMzNTc4NA%3D%3D&amp;chksm=870fe8c6b07861d0cae1f9ec03df43e9d4872f56034770592720914ef399aab7edafe6e71a1c&amp;idx=1&amp;mid=2649006081&amp;scene=21&amp;sn=584c1b8c2d93e457936685c23c415613#wechat_redirect<br> mipi LCD 设备树中的初始化：https://blog.csdn.net/qq_38312843/article/details/107534743<br> RK3568 LCD 设备树分析：https://blog.csdn.net/qq_33782617/article/details/126203159</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/052ca45ba9a8b39f3141f09184047548/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Stable Diffusion — ControlNet 超详细讲解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/60c6d207686b177b4efe32ae2a63c4d5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Gitlab常用命令总结汇总</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>