<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>（视频教程）单细胞marker基因展示值等高线密度图 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="（视频教程）单细胞marker基因展示值等高线密度图" />
<meta property="og:description" content="之前微信VIP群小伙伴问道一个图的做法，是一篇《cell reports》上的文章，展示marker基因的表达的时候，添加上了等高线密度图，之前我们提到过单细胞作图在上面添加等高线（参考：单细胞marker基因可视化的补充---密度图与等高线图）。但是小伙伴发现这个图只有表达的细胞上面添加了等高线密度。所以这里我们修改一下，其实很简单，只需要调整密度的表达量阈值即可。
（reference：Dissecting Cell Lineage Specification and Sex Fate Determination in Gonadal Somatic Cells Using Single-Cell Transcriptomics）
原文作者有很多的函数上传到github，自行下载原文查看，还是有很多好代码的，但是它的代码并不能满足我们复杂的作图。而且数据完全不一样。不过它图的修饰和颜色可以参考。所以这里我们重新写了一个作图函数，可以展示UMAP、TSNE降维的单细胞seurat对象单个或者多个marker基因的展示。完整版注释函数和示例数据已上传群文件，自行下载！
接下来我们看看具体的效果。
演示视频参见B站：
https://www.bilibili.com/video/BV1YF41117Py/?spm_id_from=333.999.0.0&amp;vd_source=05b5479545ba945a8f5d7b2e7160ea34
首先做一下TSNE降维的单个marker展示：
#TSNE降维单个基因KS_plot_density(obj=uterus, marker= &#34;CCL5&#34;, dim = &#34;TSNE&#34;, size =1) 然后是多个marker的展示：增加ncol参数。设置组图的列数。
#TSNE降维单多个基因KS_plot_density(obj=uterus, marker=c(&#34;ACTA2&#34;, &#34;RGS5&#34;,&#34;CCL5&#34;, &#34;STK17B&#34;), dim = &#34;TSNE&#34;, size =1, ncol = 2) 最后看一下UMAP降维的数据：​​​​​​​
#UMAP降维marker基因展示KS_plot_density(obj=human_data, marker=c(&#34;CD3E&#34;, &#34;S100A2&#34;), dim = &#34;UMAP&#34;, size =1, ncol =2) 具体函数如下：
​​​​​​​​​​​​​​
KS_plot_density &lt;- function(obj,#单细胞seurat对象 marker,#需要展示的marker基因 dim=c(&#34;TSNE&#34;,&#34;UMAP&#34;), size,#点的大小 ncol=NULL#多个marker基因表达图排序 ){ require(ggplot2) require(ggrastr) require(Seurat) cold &lt;- colorRampPalette(c(&#39;#f7fcf0&#39;,&#39;#41b6c4&#39;,&#39;#253494&#39;)) warm &lt;- colorRampPalette(c(&#39;#ffffb2&#39;,&#39;#fecc5c&#39;,&#39;#e31a1c&#39;)) mypalette &lt;- c(rev(cold(11)), warm(10)) if(dim==&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/7372ccc89c29cdea6936d6a9dc897580/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-28T14:09:13+08:00" />
<meta property="article:modified_time" content="2023-08-28T14:09:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">（视频教程）单细胞marker基因展示值等高线密度图</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>之前微信VIP群小伙伴问道一个图的做法，是一篇《cell reports》上的文章，展示marker基因的表达的时候，添加上了等高线密度图，之前我们提到过单细胞作图在上面添加等高线（参考：<a href="http://mp.weixin.qq.com/s?__biz=Mzg5OTYzMzY5Ng==&amp;mid=2247484470&amp;idx=1&amp;sn=fa2dcb96fff3b0c2b439129873e9543f&amp;chksm=c0510379f7268a6f44cd223c8d221d90373f7953af7482b3b8ae2f6731822f773650f918efc4&amp;scene=21#wechat_redirect" rel="nofollow" title="单细胞marker基因可视化的补充---密度图与等高线图">单细胞marker基因可视化的补充---密度图与等高线图</a>）。但是小伙伴发现这个图只有表达的细胞上面添加了等高线密度。所以这里我们修改一下，其实很简单，只需要调整密度的表达量阈值即可。</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="845" src="https://images2.imgbox.com/f7/1a/HYm55Y6E_o.png" width="954"></p> 
<p><strong>（reference：Dissecting Cell Lineage Specification and Sex Fate Determination in Gonadal Somatic Cells Using Single-Cell Transcriptomics）</strong></p> 
<p>原文作者有很多的函数上传到github，自行下载原文查看，还是有很多好代码的，但是它的代码并不能满足我们复杂的作图。而且数据完全不一样。不过它图的修饰和颜色可以参考。<strong>所以这里我们重新写了一个作图函数，可以展示UMAP、TSNE降维的单细胞seurat对象单个或者多个marker基因的展示。完整版注释函数和示例数据已上传群文件，自行下载！</strong><br>  </p> 
<p>接下来我们看看具体的效果。</p> 
<p>演示视频参见B站：</p> 
<p>https://www.bilibili.com/video/BV1YF41117Py/?spm_id_from=333.999.0.0&amp;vd_source=05b5479545ba945a8f5d7b2e7160ea34</p> 
<p>首先做一下TSNE降维的单个marker展示：</p> 
<pre><code>#TSNE降维单个基因</code><code>KS_plot_density(obj=uterus, </code><code>                marker= "CCL5",</code><code>                dim = "TSNE", size =1)</code></pre> 
<p></p> 
<p class="img-center"><img alt="图片" height="890" src="https://images2.imgbox.com/09/43/HytdWocn_o.png" width="1080"></p> 
<p>然后是多个marker的展示：增加ncol参数。设置组图的列数。</p> 
<pre><code>#TSNE降维单多个基因</code><code>KS_plot_density(obj=uterus, </code><code>                marker=c("ACTA2", "RGS5","CCL5", "STK17B"), </code><code>                dim = "TSNE", size =1, ncol = 2)</code></pre> 
<p></p> 
<p class="img-center"><img alt="图片" height="975" src="https://images2.imgbox.com/09/f1/roxPuHu8_o.png" width="1080"></p> 
<p>最后看一下UMAP降维的数据：​​​​​​​</p> 
<pre><code>#UMAP降维marker基因展示</code><code>KS_plot_density(obj=human_data, </code><code>                marker=c("CD3E", "S100A2"), </code><code>                dim = "UMAP", size =1, ncol =2)</code></pre> 
<p></p> 
<p class="img-center"><img alt="图片" height="494" src="https://images2.imgbox.com/62/46/p1E0z4Z2_o.png" width="1080"></p> 
<p>具体函数如下：</p> 
<p>​​​​​​​​​​​​​​</p> 
<pre><code>KS_plot_density &lt;- function(obj,#单细胞seurat对象</code><code>                            marker,#需要展示的marker基因</code><code>                            dim=c("TSNE","UMAP"),</code><code>                            size,#点的大小</code><code>                            ncol=NULL#多个marker基因表达图排序</code><code>                            ){<!-- --></code><code>  require(ggplot2)</code><code>  require(ggrastr)</code><code>  require(Seurat)</code><code>  </code><code>  cold &lt;- colorRampPalette(c('#f7fcf0','#41b6c4','#253494'))</code><code>  warm &lt;- colorRampPalette(c('#ffffb2','#fecc5c','#e31a1c'))</code><code>  mypalette &lt;- c(rev(cold(11)), warm(10))</code><code>  </code><code>  if(dim=="TSNE"){<!-- --></code><code>    </code><code>    xtitle = "tSNE1"</code><code>    ytitle = "tSNE2"</code><code>    </code><code>  }</code><code>  </code><code>  if(dim=="UMAP"){<!-- --></code><code>    </code><code>    xtitle = "UMAP1"</code><code>    ytitle = "UMAP2"</code><code>  }</code><code>  </code><code>  </code><code>  if(length(marker)==1){<!-- --></code><code>    </code><code>    plot &lt;- FeaturePlot(obj, features = marker)</code><code>    data &lt;- plot$data</code><code>    </code><code>    </code><code>    if(dim=="TSNE"){<!-- --></code><code>      </code><code>      colnames(data)&lt;- c("x","y","ident","gene")</code><code>      </code><code>    }</code><code>    </code><code>    if(dim=="UMAP"){<!-- --></code><code>      </code><code>      colnames(data)&lt;- c("x","y","ident","gene")</code><code>    }</code><code>    </code><code>    </code><code>    </code><code>    p &lt;- ggplot(data, aes(x, y)) +</code><code>      geom_point_rast(shape = 21, stroke=0.25,</code><code>                 aes(colour=gene, </code><code>                     fill=gene), size = size) +</code><code>      geom_density_2d(data=data[data$gene&gt;0,], </code><code>                      aes(x=x, y=y), </code><code>                      bins = 5, colour="black") +</code><code>      scale_fill_gradientn(colours = mypalette)+</code><code>      scale_colour_gradientn(colours = mypalette)+</code><code>      theme_bw()+ggtitle(marker)+</code><code>      labs(x=xtitle, y=ytitle)+</code><code>      theme(</code><code>        plot.title = element_text(size=12, face="bold.italic", hjust = 0),</code><code>        axis.text=element_text(size=8, colour = "black"),</code><code>        axis.title=element_text(size=12),</code><code>        legend.text = element_text(size =10),</code><code>        legend.title=element_blank(),</code><code>        aspect.ratio=1,</code><code>        panel.grid.major = element_blank(),</code><code>        panel.grid.minor = element_blank()</code><code>      )</code><code>    </code><code>    return(p)</code>
<code>  }else{<!-- --></code><code>    </code><code>    gene_list &lt;- list()</code><code>    </code>
<code>    </code><code>    for (i in 1:length(marker)) {<!-- --></code><code>      plot &lt;- FeaturePlot(obj, features = marker[i])</code><code>      data &lt;- plot$data</code><code>      </code><code>      </code><code>      if(dim=="TSNE"){<!-- --></code><code>        </code><code>        colnames(data)&lt;- c("x","y","ident","gene")</code><code>      }</code><code>      </code><code>      if(dim=="UMAP"){<!-- --></code><code>        </code><code>        colnames(data)&lt;- c("x","y","ident","gene")</code><code>      }</code><code>      </code><code>      gene_list[[i]] &lt;- data</code><code>      names(gene_list) &lt;- marker[i]</code><code>    }</code><code>    </code><code>    plot_list &lt;- list()</code><code>    </code>
<code>    for (i in 1:length(marker)) {<!-- --></code><code>      </code><code>      p &lt;- ggplot(gene_list[[i]], aes(x, y)) +</code><code>        geom_point_rast(shape = 21, stroke=0.25,</code><code>                   aes(colour=gene, </code><code>                       fill=gene), size = size) +</code><code>        geom_density_2d(data=gene_list[[i]][gene_list[[i]]$gene&gt;0,], </code><code>                        aes(x=x, y=y), </code><code>                        bins = 5, colour="black") +</code><code>        scale_fill_gradientn(colours = mypalette)+</code><code>        scale_colour_gradientn(colours = mypalette)+</code><code>        theme_bw()+ggtitle(marker[i])+</code><code>        labs(x=xtitle, y=ytitle)+</code><code>        theme(</code><code>          plot.title = element_text(size=12, face="bold.italic", hjust = 0),</code><code>          axis.text=element_text(size=8, colour = "black"),</code><code>          axis.title=element_text(size=12),</code><code>          legend.text = element_text(size =10),</code><code>          legend.title=element_blank(),</code><code>          aspect.ratio=1,</code><code>          panel.grid.major = element_blank(),</code><code>          panel.grid.minor = element_blank()</code><code>        )</code><code>      </code><code>      plot_list[[i]] &lt;- p</code><code>    }</code><code>    </code><code>    </code><code>    Seurat::CombinePlots(plot_list, ncol = ncol)</code><code>    </code><code>    </code><code>  }</code><code>  </code>
<code>}</code>
</pre> 
<p>这个展示非常完美，觉得分享有用的，点个赞再走呗！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e25952ea1f7c9fa8752c3274cdb9426b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">fmod从指定的时间开始播放声音</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/98a3665add1f5663c612ec9e479985a2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">（视频教程）单细胞转录组多组差异基因分析及可视化函数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>