<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Java运行过程 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Java运行过程" />
<meta property="og:description" content="图 本文思维导图
一、概述 java从源码到程序运行过程是java源程序到字节码文件，最后到运行结果的过程。
图 Java运行过程
Java编译器将java源文件（.java）转换成字节码文件（.class）,类加载器(ClassLoader)将字节码文件加载进内存，然后进行字节码校验，最后Java 解释器翻译成机器码。
图 Java编译过程
二、JVM 2.1 jdk、jre与 jvm JDK（Java Development Kit）: 是Java的开发工具包，是整个java开发的核心;
JRE（Java Runtime Environment）: 是java程序的运行环境，所有的Java程序必须依赖jre才能运行；
JVM（Java Virtual Machine）: java虚拟机，是一个虚拟的中间平台，只负责将编译后的字节码文件转换成当前计算机能理解并执行的指令；
图 jdk、jre与jvm的关系
JDK主要包含JRE、Java基础类库(Java API)和Java的一些工具包。
图 jdk1.8安装目录
bin: 可执行文件，包含javac文件(编译器)和java文件(源码编译器)；
include: 包含一些头文件，用于java 和 JVM进行交互；
lib: 类库；
jre: java 运行环境；
(legal 法律文件)
图 jre目录
jre/bin: 与bin目录可执行文件相同，但是不包含javac文件；
lib: 运行环境用到的核心类库，属性设置和资源文件；
2.2 jvm 中java程序的执行情况 在jvm中，通过类加载器将字节码文件(.class)加载进内存，java解释器翻译成对应的机器码，最后在操作系统解释运行。
图 jvm中java程序的执行情况
方法区：虚拟机规范中将方法区看作是堆的逻辑部分，但在HotSpot实现上，将堆和方法区分开。堆中主要存放的是实例化的对象，方法区存放的是类的信息。
类型信息
1）完整有效名(包名.类名)。2）直接父类完整有效名。3）访问修饰符。4）直接接口的一个有序列表。
域信息
1）域（属性）名称。2）域类型。3）域修饰符。4）域的声明顺序。
方法信息
1）方法名称。2）返回类型。3）参数数量、类型及顺序。4）方法修饰符。5）方法的字节码。6）异常表。
表 方法区存储的类的信息
jdk1.6及之前
习惯把方法区称为永久代。静态变量存放在永久代上。
jdk1.7" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9209f57c4d613b0f2fc7bdd092f9d971/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-15T15:45:19+08:00" />
<meta property="article:modified_time" content="2023-07-15T15:45:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Java运行过程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2><img alt="" height="946" src="https://images2.imgbox.com/29/ac/COFCjLB1_o.png" width="832"></h2> 
<p style="text-align:center;"> 图 本文思维导图</p> 
<h2> 一、概述</h2> 
<p style="margin-left:0;text-align:justify;">java从源码到程序运行过程是java源程序到字节码文件，最后到运行结果的过程。</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="106" src="https://images2.imgbox.com/bc/9d/CSsJeXDv_o.png" width="832"></p> 
<p style="margin-left:0;text-align:center;">图 Java运行过程</p> 
<p style="margin-left:0;text-align:justify;">Java编译器将java源文件（.java）转换成字节码文件（.class）,类加载器(ClassLoader)将字节码文件加载进内存，然后进行字节码校验，最后Java 解释器翻译成机器码。</p> 
<p style="margin-left:0;text-align:center;"><img alt="" height="74" src="https://images2.imgbox.com/76/32/DujR3Yvl_o.png" width="838"></p> 
<p style="margin-left:0;text-align:center;">图 Java编译过程</p> 
<h2 style="margin-left:0;">二、JVM</h2> 
<h3 style="margin-left:0;">2.1 jdk、jre与 jvm</h3> 
<p style="margin-left:0;text-align:justify;">JDK（Java Development Kit）: 是Java的开发工具包，是整个java开发的核心;</p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#4d4d4d;">JRE</span><span style="color:#4d4d4d;">（</span><span style="color:#4d4d4d;">Java Runtime Environment</span><span style="color:#4d4d4d;">）</span><span style="color:#4d4d4d;">: </span>是java程序的运行环境，所有的Java程序必须依赖jre才能运行；</p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#4d4d4d;">JVM</span><span style="color:#4d4d4d;">（</span><span style="color:#4d4d4d;">Java Virtual Machine</span><span style="color:#4d4d4d;">）</span><span style="color:#4d4d4d;">: java</span><span style="color:#4d4d4d;">虚拟机，</span>是一个虚拟的中间平台，只负责将编译后的字节码文件转换成当前计算机能理解并执行的指令；</p> 
<p style="margin-left:0;text-align:center;"><img alt="" height="220" src="https://images2.imgbox.com/e8/08/Tycbsain_o.png" width="416"></p> 
<p style="margin-left:0;text-align:center;">图 jdk、jre与jvm的关系</p> 
<p style="margin-left:0;text-align:justify;">JDK主要包含JRE、Java基础类库(Java API)和Java的一些工具包。</p> 
<p style="margin-left:0;text-align:center;"><img alt="" height="304" src="https://images2.imgbox.com/ca/1a/N5Skkmn6_o.png" width="536"></p> 
<p style="margin-left:0;text-align:center;">图 jdk1.8安装目录</p> 
<p style="margin-left:0;text-align:justify;">bin: 可执行文件，包含javac文件(编译器)和java文件(源码编译器)；</p> 
<p style="margin-left:0;text-align:justify;">include: 包含一些头文件，用于java 和 JVM进行交互；</p> 
<p style="margin-left:0;text-align:justify;">lib: 类库；</p> 
<p style="margin-left:0;text-align:justify;">jre: java 运行环境；</p> 
<p style="margin-left:0;text-align:justify;">(legal 法律文件)</p> 
<p style="margin-left:0;text-align:center;"><img alt="" height="220" src="https://images2.imgbox.com/4d/1e/LBdHEbFU_o.png" width="600"></p> 
<p style="margin-left:0;text-align:center;">图 jre目录</p> 
<p style="margin-left:0;text-align:justify;">jre/bin: 与bin目录可执行文件相同，但是不包含javac文件；</p> 
<p style="margin-left:0;text-align:justify;">lib: 运行环境用到的核心类库，属性设置和资源文件；</p> 
<h3 style="margin-left:0;">2.2 jvm 中java程序的执行情况</h3> 
<p style="margin-left:0;text-align:justify;">在jvm中，通过类加载器将字节码文件(.class)加载进内存，java解释器翻译成对应的机器码，最后在操作系统解释运行。</p> 
<p style="margin-left:0;text-align:center;"><img alt="" height="382" src="https://images2.imgbox.com/95/0f/lBQUuvR5_o.png" width="470"></p> 
<p style="margin-left:0;text-align:center;">图 jvm中java程序的执行情况</p> 
<p style="margin-left:0;text-align:justify;"><strong>方法区</strong>：虚拟机规范中将方法区看作是堆的逻辑部分，但在HotSpot实现上，将堆和方法区分开。堆中主要存放的是实例化的对象，方法区存放的是类的信息。</p> 
<table border="1" cellspacing="0"><tbody><tr><td style="border-color:#000000;width:70.65pt;"> <p style="margin-left:0;text-align:center;">类型信息</p> </td><td style="border-color:#000000;vertical-align:top;width:344.15pt;"> <p style="margin-left:0;text-align:justify;">1）完整有效名(包名.类名)。2）直接父类完整有效名。3）访问修饰符。4）直接接口的一个有序列表。</p> </td></tr><tr><td style="border-color:#000000;width:70.65pt;"> <p style="margin-left:0;text-align:center;">域信息</p> </td><td style="vertical-align:top;width:344.15pt;"> <p style="margin-left:0;text-align:justify;">1）域（属性）名称。2）域类型。3）域修饰符。4）域的声明顺序。</p> </td></tr><tr><td style="border-color:#000000;width:70.65pt;"> <p style="margin-left:0;text-align:center;">方法信息</p> </td><td style="vertical-align:top;width:344.15pt;"> <p style="margin-left:0;text-align:justify;">1）方法名称。2）返回类型。3）参数数量、类型及顺序。4）方法修饰符。5）方法的字节码。6）异常表。</p> </td></tr></tbody></table> 
<p style="margin-left:0;text-align:center;">表 方法区存储的类的信息</p> 
<table border="1" cellspacing="0"><tbody><tr><td style="border-color:#000000;vertical-align:top;width:84.8pt;"> <p style="margin-left:0;text-align:justify;">jdk1.6及之前</p> </td><td style="border-color:#000000;vertical-align:top;width:330pt;"> <p style="margin-left:0;text-align:justify;">习惯把方法区称为永久代。静态变量存放在永久代上。</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:84.8pt;"> <p style="margin-left:0;text-align:justify;">jdk1.7</p> </td><td style="vertical-align:top;width:330pt;"> <p style="margin-left:0;text-align:justify;">永久代还存在，字符串常量池、静态变量从永久代移除，保存在堆中。</p> </td></tr><tr><td style="border-color:#000000;vertical-align:top;width:84.8pt;"> <p style="margin-left:0;text-align:justify;">jdk1.8及之后</p> </td><td style="vertical-align:top;width:330pt;"> <p style="margin-left:0;text-align:justify;">无永久代，由元空间取代。类的类型信息、字段、方法、常量保存在元空间，单字符常量池、静态变量仍在堆中。</p> </td></tr></tbody></table> 
<p style="margin-left:0;text-align:center;">表 HotSpot 方法区演进过程</p> 
<p style="margin-left:0;text-align:justify;">元空间本质和永久代类似，都是对JVM规范中方法区的实现。不过元空间不在虚拟机设置的内存中，而是使用本地内存。</p> 
<p style="margin-left:0;text-align:justify;"><strong>元空间取代永久代的原因：</strong></p> 
<p style="margin-left:0;text-align:justify;">1、元空间的最大可分配空间就是系统可用内存，因为元空间并不在虚拟机中。</p> 
<p style="margin-left:0;text-align:justify;">2、对永久代进行调优是很困难的。</p> 
<p style="margin-left:0;text-align:justify;"><strong>堆区：</strong>存储该程序在运行时所有创建的对象及数组。一个JVM实例只存在一个堆内存，所有线程共享，包含新生区、养老区、永久区；</p> 
<p style="margin-left:0;text-align:justify;"><strong>栈区：</strong>存储值类型，在线程创建时被创建，基本单位是栈帧；</p> 
<p style="margin-left:0;text-align:center;"><img alt="" height="280" src="https://images2.imgbox.com/e2/ae/wv9R7aod_o.png" width="394"></p> 
<p style="margin-left:0;text-align:center;">图 栈区</p> 
<p style="margin-left:0;text-align:justify;"><strong>PC</strong><strong>寄存器：</strong>指令计数器，存储指向下一条指令的地址；</p> 
<p style="margin-left:0;text-align:justify;"><strong>本地方法栈：</strong>和栈区功能类似，不同点在于栈区执行的是java方法,本地方法栈执行的是本地的方法；</p> 
<h4 style="margin-left:0;text-align:justify;">2.2.1 常量池</h4> 
<p style="margin-left:0;text-align:justify;">在Java源文件编译后的字节码文件中，一个Java源文件，包含了许多变量、方法及字面量信息，这些信息在编译后不会直接存储在字节码文件中，而是在直接码文件中把这些信息的引用保存起来。这就是常量池塘。</p> 
<p style="margin-left:0;text-align:justify;">而运行时常量池，是指在运行时会将字节码文件中的常量池加载到方法区中。</p> 
<h3 style="margin-left:0;">2.3 java类的初始化</h3> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#000000;">当程序要使用某个类时</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">, </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">如果该类还未被加载到内存中</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">, </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">则系统会通过加载</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">, </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">连接</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">, </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">初始化三步来实现对这个类进行初始化。</span></span></p> 
<p style="margin-left:0;text-align:center;"><img alt="" height="134" src="https://images2.imgbox.com/ef/4c/lRxNz4gC_o.png" width="580"></p> 
<p style="margin-left:0;text-align:center;">图 类的初始化</p> 
<h4 style="margin-left:0;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#000000;">2.3.1 </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">加载</span></span></h4> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#000000;">加载就是将</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">class</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">文件读入内存</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">, </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">并为之创建一个</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">Class</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">对象</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">(</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">任何类被使用时系统都会创建且只创建一个</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">Class</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">对象</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">)</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">。</span></span></p> 
<p style="margin-left:0;text-align:justify;">JVM进行类加载阶段需要完成以下三件事情:</p> 
<p style="margin-left:0;text-align:justify;">1. 通过一个类的全限定名称来获取定义此类的二进制字节流；</p> 
<p style="margin-left:0;text-align:justify;">2. 将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构；</p> 
<p style="margin-left:0;text-align:justify;">3. 在java堆中生成一个代表这个类的java.lang.Class对象, 作为方法区这些数据的访问入口；</p> 
<p style="margin-left:0;text-align:justify;">类的加载时机：</p> 
<p style="margin-left:0;text-align:justify;">1. 创建类的实例；</p> 
<p style="margin-left:0;text-align:justify;">2. 使用类的静态变量或者为静态变量赋值；</p> 
<p style="margin-left:0;text-align:justify;">3. 调用类的静态方法；</p> 
<p style="margin-left:0;text-align:justify;">4. 使用反射方式来强制创建某个类或接口对应的java.lang.Class对象；</p> 
<p style="margin-left:0;text-align:justify;">5. 初始化某个类的子类；</p> 
<p style="margin-left:0;text-align:justify;">6. 直接使用java命令来运行某个主类；</p> 
<p style="margin-left:0;text-align:center;"><img alt="" height="132" src="https://images2.imgbox.com/b4/02/sXosg8GU_o.png" width="514"></p> 
<p style="margin-left:0;text-align:center;">图 加载阶段</p> 
<h4 style="margin-left:0;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#000000;">2.3.2 </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">连接</span></span></h4> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#000000;">连接就是将类的二进制数据合并到</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">JRE</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">中。</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#000000;">连接分为以下三步：</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#000000;">1</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">）检验，验证检查</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">class</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">文件数据的正确性。文本格式检验、元数据检验、字节码检验、符号引用检验、是否有正确的内部结构（构造器、方法、变量、代码块），并和其他类协调一致。</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#000000;">2</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">）准备，正式为类变量分配内存空间并设置初始值。</span></span></p> 
<p style="margin-left:0;text-align:justify;">3）解析，虚拟机常量池的符号引用替换为直接引用。</p> 
<p style="margin-left:0;text-align:center;"><img alt="" height="98" src="https://images2.imgbox.com/5c/30/7ijjrSrv_o.png" width="468"></p> 
<p style="margin-left:0;text-align:center;">图 连接阶段</p> 
<h4 style="margin-left:0;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#000000;">2.3.3 </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">初始化</span></span></h4> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#000000;">执行类的类构造器</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">&lt;clinit&gt;</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">方法（为变量完成赋值）。</span></span></p> 
<p style="margin-left:0;text-align:justify;">初始化步骤:</p> 
<p style="margin-left:0;text-align:justify;">1. 假如这个类还没有被加载和连接, 则程序先加载并连接该类；</p> 
<p style="margin-left:0;text-align:justify;">2. 假如该类的直接父类还没有被初始化, 则先初始化其直接父类；</p> 
<p style="margin-left:0;text-align:justify;">3. 假如类中有初始化语句, 则系统依次执行这些初始化语句；</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d68ed3924d4d46830a4d6d255dad6a01/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">sop是什么意思</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/810c8b1ec961f0851da8ea8c7c04a96c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">4.GIT中的diff命令</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>