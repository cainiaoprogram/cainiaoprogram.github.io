<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Zabbix监控平台（二）深入理解zabbix - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Zabbix监控平台（二）深入理解zabbix" />
<meta property="og:description" content="一，Zabbix Web操作深入 1.1 Zabbix Web下的主机和模版以及监控项的添加方式 （1）创建一个模版 我们所有的功能几乎都是在模版中定义的
我们再点进新创建的模版查看
模版里几乎可以设定我们需要的所有功能
（2）在模版里创建应用集 应用集的作用就是将众多的监控项进行一个分类，方便我们的管理
（3）在模版里创建一个zabbix自带的监控项 cpu模板监控项
mem模板监控项
disk模板监控项（随便找了一个键值）
（4）监控项里的键值我们到底要如何写？我们需要学会照葫芦画瓢 我们选择一个系统模版Template OS Linux查看
5）当然我们也可以自定义监控项的键值，但是并不推荐这样。因为，都是自己写太慢了。系统自带了很多键值我们要学会利用 自定义系统监控项的键值创建，请参考前一节的知识
6）把新添加的模板链接到主机里面并检测 1.2 Zabbix Web下触发器与表达式的编写方法 （1）avg 参数：秒或#num 支持类型：float,int 作用：返回一段时间的平均值
举例： avg(5)：最后5秒的平均值 avg(#5)：表示最近5次得到值的平均值 avg（3600,86400）：表示一天前的一个小时的平均值 如果仅有一个参数，表示指定时间的平均值，从现在开始算起，如果有第二个参数，表示漂移，从第二个参数前开始算时间，#n表示最近n次的值
（2）last 参数：秒或#num 支持值类型：float，int，str，text，log 作用：最近的值，如果为秒，则忽略，#num表示最近第N个值，请注意当前的#num和其他一些函数的#num的意思是不同的。
last(0)等价于last（#1） last（#3）表示最近第3个值（并不是最近的三个值） 本函数也支持第二个参数time_shift,例如last（0,86400）返回一天前的最近的值。 如果在history中同一秒中有多个值存在看，Zabbix不保证值的精确顺序#num从Zabbix1.6.2起开始支持，timeshift从1.8.2起开始支持，可以查询avg（）函数获取它的使用方法
（3）max 参数：秒或#num 支持值类型：float，int 描述：返回指定时间间隔的最大值。时间间隔作为第一个参数可以是秒或收集值的数目（前缀为#）。从Zabbix1.8.2开始，函数支持第二个可选参数time_shift,可以查看avg（）函数获取它的使用方法。 例如：max(#3)=0 返回3次值如果都是0则触发告警
（4）min 参数：秒或#num 支持值类型：float，int 描述：返回指定时间间隔的最小值。时间间隔作为第一个参数可以是秒或收集值的数目（前缀为#）。从Zabbix1.8.2开始，函数支持第二个可选参数time_shift，可以查看avg（）函数获取它的使用方法。
（5）nodata 参数：秒 支持值类型：any 描述：当返回值为1表示指定的间隔（间隔不应小于30秒）没有接收到数据，0表示获取到了。 例：nodata(5m)=1 ===&gt;5分钟之内获取不到数据就告警
（6）prev 参数：忽略 支持值类型：float，int，str，text，log 描述：返回之前的值，类似于last（#2）
（7）sum 参数：秒或#num 支持值类型：float，int 描述：返回指定时间间隔中收集到的值的总和，时间间隔作为第一个参数支持秒或收集值的数目（以#开始）.从Zabbix1.8.2开始，本函数支持time_shift作为第二个参数。可以查看avg函数获取它的用法。
（8）change 参数：忽略 支持类型：float,int,str,text,log 作用：返回最近获得值与之前获得值的差值，对于字符串0表示相等，1表示不同 change（0）&gt;n:忽略参数一般输入0，表示最近得到的值与上一个值的差值大于n" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/084fe7949786bf021bf3ec5be9a4c317/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-12-13T13:01:00+08:00" />
<meta property="article:modified_time" content="2018-12-13T13:01:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Zabbix监控平台（二）深入理解zabbix</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body"> 
 <h2 id="一zabbix-web操作深入">一，Zabbix Web操作深入</h2> 
 <div class="md-section-divider">
     
 </div> 
 <h3 id="11-zabbix-web下的主机和模版以及监控项的添加方式">1.1 Zabbix Web下的主机和模版以及监控项的添加方式</h3> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="1创建一个模版">（1）创建一个模版</h4> 
 <blockquote class="white-blockquote"> 
  <p>我们所有的功能几乎都是在模版中定义的</p> 
 </blockquote> 
 <p><img src="https://images2.imgbox.com/37/82/DBNZUTTd_o.png" alt="image_1csimopsa13gjil61p6nuao1e9j16.png-34kB"></p> 
 <hr> 
 <p><img src="https://images2.imgbox.com/ec/91/3voCEd9e_o.png" alt="image_1csimpfe9tn3gt1df3j141p5o23.png-38.6kB"></p> 
 <p>我们再点进新创建的模版查看</p> 
 <blockquote class="white-blockquote"> 
  <p>模版里几乎可以设定我们需要的所有功能</p> 
 </blockquote> 
 <p><img src="https://images2.imgbox.com/ca/11/Q4bW73fb_o.png" alt="image_1csimr4v820iua31dbf1drr1s9h2g.png-75.5kB"></p> 
 <hr> 
 <p><img src="https://images2.imgbox.com/1c/f3/gYDYEvSo_o.png" alt="image_1csims7bl1pbs1uh41m871di1kd32t.png-68.4kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="2在模版里创建应用集">（2）在模版里创建应用集</h4> 
 <blockquote class="white-blockquote"> 
  <p>应用集的作用就是将众多的监控项进行一个分类，方便我们的管理</p> 
 </blockquote> 
 <p><img src="https://images2.imgbox.com/b1/40/StPAG660_o.png" alt="image_1csimugj8jmf1909jfq2kdb0a3a.png-30.6kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/9f/12/Dh0Z2GUF_o.png" alt="image_1csimuuj321r1bqr10ubkrn1keh3n.png-26.1kB"></p> 
 <hr> 
 <p><img src="https://images2.imgbox.com/4b/0d/TsId3Swx_o.png" alt="image_1csimvbhod9kc9i1ngu1u6p1hm644.png-30kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="3在模版里创建一个zabbix自带的监控项">（3）在模版里创建一个zabbix自带的监控项</h4> 
 <blockquote class="white-blockquote"> 
  <p>cpu模板监控项</p> 
 </blockquote> 
 <p><img src="https://images2.imgbox.com/28/7c/mqAKg1A5_o.png" alt="image_1cu77rhg51nvglodcpi1greoe79.png-213.7kB"></p> 
 <blockquote class="white-blockquote"> 
  <p>mem模板监控项</p> 
 </blockquote> 
 <p><img src="https://images2.imgbox.com/62/af/1Rz0lZR8_o.png" alt="image_1cu78284qnpq3n41m1a1a4h15hjm.png-204kB"></p> 
 <blockquote class="white-blockquote"> 
  <p>disk模板监控项（随便找了一个键值）</p> 
 </blockquote> 
 <p><img src="https://images2.imgbox.com/78/d9/QQRckzo9_o.png" alt="image_1cu78j2fe1nvsvbfvag8agkmq13.png-225.1kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="4监控项里的键值我们到底要如何写我们需要学会照葫芦画瓢">（4）监控项里的键值我们到底要如何写？我们需要学会照葫芦画瓢</h4> 
 <blockquote class="white-blockquote"> 
  <p>我们选择一个系统模版Template OS Linux查看</p> 
 </blockquote> 
 <p><img title="" src="https://images2.imgbox.com/f6/a7/xfXuisAS_o.png" alt="image_1csin1o9d1d2g1eaqsi71drv1u3f5r.png-8.3kB"></p> 
 <hr> 
 <p><img src="https://images2.imgbox.com/0c/2a/hzmgX20k_o.png" alt="image_1csin23db1lm2nid1jhasjb195h68.png-35.8kB"></p> 
 <hr> 
 <p><img src="https://images2.imgbox.com/9e/01/VRaIkva7_o.png" alt="image_1csin2d8733hvkbp961v931eab6l.png-58.3kB"></p> 
 <hr> 
 <p><img src="https://images2.imgbox.com/3c/55/Q6qW2S4B_o.png" alt="image_1csin2pplhmbshf1vdb9qhk4o72.png-75.8kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="5当然我们也可以自定义监控项的键值但是并不推荐这样因为都是自己写太慢了系统自带了很多键值我们要学会利用">5）当然我们也可以自定义监控项的键值，但是并不推荐这样。因为，都是自己写太慢了。系统自带了很多键值我们要学会利用</h4> 
 <blockquote class="white-blockquote"> 
  <p>自定义系统监控项的键值创建，请参考前一节的知识</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="6把新添加的模板链接到主机里面并检测">6）把新添加的模板链接到主机里面并检测</h4> 
 <p><img src="https://images2.imgbox.com/dc/6f/4A3zPKiY_o.png" alt="image_1cu78q7pooa9901d4l19l9ilp1g.png-98.4kB"></p> 
 <hr> 
 <p><img src="https://images2.imgbox.com/0c/37/L6Sjfczb_o.png" alt="image_1cu78tiuu146nat9pn51o38frb1t.png-85.1kB"></p> 
 <hr> 
 <p><img src="https://images2.imgbox.com/d6/02/OFF0UG3S_o.png" alt="image_1cu7aaiks1kbi19d91p5ac8d1o3um.png-151.3kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/57/9f/8bVoOZoI_o.png" alt="image_1cu79rpaoambk5q1ngvhvl9j29.png-119.6kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h3 id="12-zabbix-web下触发器与表达式的编写方法">1.2 Zabbix Web下触发器与表达式的编写方法</h3> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="1avg">（1）avg</h4> 
 <blockquote class="white-blockquote"> 
  <p>参数：秒或#num<span class="Apple-converted-space"> <br>支持类型：float,int<span class="Apple-converted-space"> <br>作用：返回一段时间的平均值</span></span></p> 
  <p>举例：<span class="Apple-converted-space"> <br>avg(5)：最后5秒的平均值<span class="Apple-converted-space"> <br>avg(#5)：表示最近5次得到值的平均值<span class="Apple-converted-space"> <br>avg（3600,86400）：表示一天前的一个小时的平均值<span class="Apple-converted-space"> <br>如果仅有一个参数，表示指定时间的平均值，从现在开始算起，如果有第二个参数，表示漂移，从第二个参数前开始算时间，#n表示最近n次的值</span></span></span></span></p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="2last">（2）last</h4> 
 <blockquote class="white-blockquote"> 
  <p>参数：秒或#num<span class="Apple-converted-space"> <br>支持值类型：float，int，str，text，log<span class="Apple-converted-space"> <br>作用：最近的值，如果为秒，则忽略，#num表示最近第N个值，请注意当前的#num和其他一些函数的#num的意思是不同的。</span></span></p> 
  <p>last(0)等价于last（#1）<span class="Apple-converted-space"> <br>last（#3）表示最近第3个值（并不是最近的三个值）<span class="Apple-converted-space"> <br>本函数也支持第二个参数time_shift,例如last（0,86400）返回一天前的最近的值。<span class="Apple-converted-space"> <br>如果在history中同一秒中有多个值存在看，Zabbix不保证值的精确顺序#num从Zabbix1.6.2起开始支持，timeshift从1.8.2起开始支持，可以查询avg（）函数获取它的使用方法</span></span></span></p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="3max">（3）max</h4> 
 <blockquote class="white-blockquote"> 
  <p>参数：秒或#num<span class="Apple-converted-space"> <br>支持值类型：float，int<span class="Apple-converted-space"> <br>描述：返回指定时间间隔的最大值。时间间隔作为第一个参数可以是秒或收集值的数目（前缀为#）。从Zabbix1.8.2开始，函数支持第二个可选参数time_shift,可以查看avg（）函数获取它的使用方法。<span class="Apple-converted-space"> <br>例如：max(#3)=0 返回3次值如果都是0则触发告警</span></span></span></p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="4min">（4）min</h4> 
 <blockquote class="white-blockquote"> 
  <p>参数：秒或#num<span class="Apple-converted-space"> <br>支持值类型：float，int<span class="Apple-converted-space"> <br>描述：返回指定时间间隔的最小值。时间间隔作为第一个参数可以是秒或收集值的数目（前缀为#）。从Zabbix1.8.2开始，函数支持第二个可选参数time_shift，可以查看avg（）函数获取它的使用方法。</span></span></p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="5nodata">（5）nodata</h4> 
 <blockquote class="white-blockquote"> 
  <p>参数：秒<span class="Apple-converted-space"> <br>支持值类型：any<span class="Apple-converted-space"> <br>描述：当返回值为1表示指定的间隔（间隔不应小于30秒）没有接收到数据，0表示获取到了。<span class="Apple-converted-space"> <br>例：nodata(5m)=1 ===&gt;5分钟之内获取不到数据就告警</span></span></span></p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="6prev">（6）prev</h4> 
 <blockquote class="white-blockquote"> 
  <p>参数：忽略<span class="Apple-converted-space"> <br>支持值类型：float，int，str，text，log<span class="Apple-converted-space"> <br>描述：返回之前的值，类似于last（#2）</span></span></p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="7sum">（7）sum</h4> 
 <blockquote class="white-blockquote"> 
  <p>参数：秒或#num<span class="Apple-converted-space"> <br>支持值类型：float，int<span class="Apple-converted-space"> <br>描述：返回指定时间间隔中收集到的值的总和，时间间隔作为第一个参数支持秒或收集值的数目（以#开始）.从Zabbix1.8.2开始，本函数支持time_shift作为第二个参数。可以查看avg函数获取它的用法。</span></span></p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="8change">（8）change</h4> 
 <blockquote class="white-blockquote"> 
  <p>参数：忽略<span class="Apple-converted-space"> <br>支持类型：float,int,str,text,log<span class="Apple-converted-space"> <br>作用：返回最近获得值与之前获得值的差值，对于字符串0表示相等，1表示不同<span class="Apple-converted-space"> <br>change（0）&gt;n:忽略参数一般输入0，表示最近得到的值与上一个值的差值大于n</span></span></span></p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="9diff">（9）diff</h4> 
 <blockquote class="white-blockquote"> 
  <p>参数：忽略<span class="Apple-converted-space"> <br>支持值类型：float，init，str，text，log 作用：返回值为1,表示最近的值与之前的值不同，0为相同。<span class="Apple-converted-space"> <br>例如：diff（0）&gt;0 ===&gt;表示现在获取的值如果和之前的不同就告警</span></span></p> 
 </blockquote> 
 <p>例如：</p> 
 <p><img src="https://images2.imgbox.com/44/f7/sZpOBjBL_o.png" alt="image_1csinfmj8d0413hj6hpct19ld7f.png-153.9kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h3 id="13-zabbix-web创建触发器过程以及触发器与监控项对应关系">1.3 Zabbix Web创建触发器过程以及触发器与监控项对应关系</h3> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="1创建一个触发器">（1）创建一个触发器</h4> 
 <blockquote class="white-blockquote"> 
  <p>我们之前已经创建了一个检测内存剩余大小的监控项，现在我们给这个监控项加一个触发器。当内存小于20M时，触发报警</p> 
 </blockquote> 
 <p><img src="https://images2.imgbox.com/47/81/o5zfGwj4_o.png" alt="image_1csinh9aq1iga5hg1o1l8ad1o9j7s.png-42.4kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/ff/d3/oKxOEWlS_o.png" alt="image_1csini536fjs1nb718uv1pp81dli99.png-76.5kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/b6/69/WRkOQKCa_o.png" alt="image_1csinjecuoma1f4d1t1g11nc2o4am.png-39.4kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/6c/60/4EEocpOG_o.png" alt="image_1csink9c6ojm1ach17b39sup9gcj.png-26.7kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="2进行表达器测试">（2）进行表达器测试</h4> 
 <p><img title="" src="https://images2.imgbox.com/c7/a1/OiAUMo5M_o.png" alt="image_1csinlaad1op55jg10ktmggdmfd0.png-69.3kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/90/b1/22QDWhi8_o.png" alt="image_1csinlrm0k7j1b0d1m2855j4jbdd.png-37.8kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/02/af/A1a6uY0t_o.png" alt="image_1csinmk50sjkl4c1et41lh7a6fdq.png-59.5kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/2d/5b/BADe0jGC_o.png" alt="image_1csinmvqrd6i19md1i4u15e61v5ie7.png-42.8kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/47/a6/34B4eHtU_o.png" alt="image_1csinna3n4bh14on10ld1opq1qacek.png-19kB"></p> 
 <blockquote class="white-blockquote"> 
  <p>表达式测试成功后，我们添加即可</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="3在服务端进行监控项数据获取测试">（3）在服务端进行监控项数据获取测试</h4> 
 <p><img title="" src="https://images2.imgbox.com/1c/05/D2H4Dzgq_o.png" alt="image_1csino7i8104625lnp1bo114kqf1.png-47.9kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/eb/c2/QqriCLs8_o.png" alt="image_1cu7bknrf85e1ahuqgf1mq81gt13.png-144.5kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="监控项表达式说明">监控项表达式说明</h4> 
 <p><code>{aaaa:vm.memory.size[available].last()}&lt;20M</code></p> 
 <div class="md-section-divider">
     
 </div> 
 <ol class="linenums"><li class="L0"><code><span class="pln">aaaa<span class="pun">:模版名</span></span></code></li><li class="L1"><code><span class="pln">vm<span class="pun">.<span class="pln">memory<span class="pun">.<span class="pln">size<span class="pun">:<span class="pln">zabbix<span class="pun">监控端向被监控端发送的代号</span></span></span></span></span></span></span></span></code></li><li class="L2"><code><span class="pun">.<span class="kwd">last<span class="pun">()&lt;<span class="lit">20<span class="pln"> <span class="pun">:<span class="kwd">last<span class="pun">()&lt;===&gt;<span class="kwd">last<span class="pun">(<span class="lit">0<span class="pun">)&lt;===&gt;<span class="kwd">last<span class="pun">(#<span class="lit">1<span class="pun">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li></ol> 
 <blockquote class="white-blockquote"> 
  <p>zabbix_get -s 192.168.200.69 -k "vm.memory.size"<span class="Apple-converted-space"> <br>获取对应IP的全部内存总量</span></p> 
  <p>zabbix_get -s 192.168.200.69 -k "vm.memory.size[available]"<span class="Apple-converted-space"> <br>获取对应IP的剩余内存总量</span></p> 
 </blockquote> 
 <p><img title="" src="https://images2.imgbox.com/0f/69/SpZtNGRp_o.png" alt="image_1cu7bpcll1ushhp51t8r3cqdsr1g.png-21.4kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h3 id="14-为了体会深刻我们再创建一个监控项同时创建它的触发器">1.4 为了体会深刻，我们再创建一个监控项同时创建它的触发器</h3> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="1快速创建一个agentping监控项">（1）快速创建一个Agent_ping监控项</h4> 
 <p><img title="" src="https://images2.imgbox.com/7f/20/gf31nzbs_o.png" alt="image_1csinthmflu3to91ujg18qcvfsfu.png-83kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/a2/01/XALUDzcG_o.png" alt="image_1csintt16klf147ncaf1sej1rl7gb.png-17.2kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="2在监控端测试监控项的键值">（2）在监控端测试监控项的键值</h4> 
 <pre><code>[root@localhost ~]# zabbix_get -s 192.168.0.220 -k "agent.ping"
1
[root@localhost ~]# zabbix_get -s 192.168.0.221 -k "agent.ping"
1
[root@localhost ~]# zabbix_get -s 192.168.0.222 -k "agent.ping"
zabbix_get [11715]: Get value error: cannot connect to [[192.168.0.222]:10050]: [113] No route to host
</code></pre> 
 <blockquote class="white-blockquote"> 
  <p>我们发现如果对方服务器IP能ping通，则返回值是1。反之不是1就有问题</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="3创建监控项的告警触发器">（3）创建监控项的告警触发器</h4> 
 <p><img title="" src="https://images2.imgbox.com/76/87/FpZdPaVb_o.png" alt="image_1csio0a6n1lut1alhfuv16m8gs1ho.png-18.4kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/bc/5e/DnjtD9hL_o.png" alt="image_1csio0m06u92ooi17oe13di5ci5.png-52.4kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/d1/c0/cMrp4u8d_o.png" alt="image_1csio12f21joimunuaq1mffpk2ii.png-18.8kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/41/f1/FXkV3qXB_o.png" alt="image_1csio1d8i1as4hbb12so17j91rc4iv.png-18.5kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/e7/27/GlbTKeo4_o.png" alt="image_1csio1pn71dn61mc2ukrj3h1o28jc.png-13.3kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/91/55/wRRK6isR_o.png" alt="image_1csio26pfth11sl3enn8n37u3jp.png-13.5kB"></p> 
 <blockquote class="white-blockquote"> 
  <p>到这里就创建完毕了，请仔细体会这个过程。</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h2 id="二zabbix常用模版与触发器功能详解">二，Zabbix常用模版与触发器功能详解</h2> 
 <div class="md-section-divider">
     
 </div> 
 <h3 id="1template-app-zabbix-agentagentversiondiff00">（1）{Template App Zabbix Agent:agent.version.diff(0)}&gt;0</h3> 
 <blockquote class="white-blockquote"> 
  <p>解释： 如果当前获取的agent客户端的版本号大于前一次的不同，那么触发告警</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h3 id="2template-app-zabbix-agentagentpingnodata5m1">（2）{Template App Zabbix Agent:agent.ping.nodata(5m)}=1</h3> 
 <blockquote class="white-blockquote"> 
  <p>解释： 如果ping客户端在5分钟内都没有数据，那么触发告警</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h3 id="3template-os-aixvmmemorysizeavailablelast020m">（3）{Template OS AIX:vm.memory.size[available].last(0)}&lt;20M</h3> 
 <blockquote class="white-blockquote"> 
  <p>解释： 如果最后一次获取的空闲内存大小得值小于20M，那么触发告警</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h3 id="4template-app-ssh-servicenettcpservicesshmax30">（4）{Template App SSH Service:net.tcp.service[ssh].max(#3)}=0</h3> 
 <blockquote class="white-blockquote"> 
  <p>解释： 如果ssh远程连接连续获取的3次值的最大值都是0，那么触发告警</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h3 id="5template-icmp-pingicmppinglossmin5m20">（5）{Template ICMP Ping:icmppingloss.min(5m)}&gt;20</h3> 
 <blockquote class="white-blockquote"> 
  <p>解释： 如果连续5分钟里获取的最小值都大于20，那么触发告警</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h3 id="6template-icmp-pingicmppingsecavg5m015">（6）{Template ICMP Ping:icmppingsec.avg(5m)}&gt;0.15</h3> 
 <blockquote class="white-blockquote"> 
  <p>解释： 如果连续5分钟内的平均值大于0.15，那么触发告警</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h2 id="三zabbix报警媒介类型设置和告警动作频率设置">三，Zabbix报警媒介类型设置和告警动作、频率设置</h2> 
 <div class="md-section-divider">
     
 </div> 
 <h3 id="31-qq邮件告警平台">3.1 QQ邮件告警平台</h3> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="311-安装sendmail上文有所有包">3.1.1 安装sendmail(上文有所有包)</h4> 
 <blockquote class="white-blockquote"> 
  <p>wget<span class="Apple-converted-space"> <a href="http://caspian.dotconf.net/menu/Software/SendEmail/sendEmail-v1.56.tar.gz" rel="nofollow">http://caspian.dotconf.net/menu/Software/SendEmail/sendEmail-v1.56.tar.gz</a></span></p> 
  <p>yum -y install perl-Net-SSLeay perl-IO-Socket-SSL</p> 
  <p>tar xf sendEmail-v1.56.tar.gz -C /usr/local/</p> 
  <p>cd /usr/local/sendEmail-v1.56/</p> 
  <p>/bin/cp -ra sendEmail /usr/local/bin/</p> 
  <p>chmod +x /usr/local/bin/sendEmail</p> 
  <p>which sendmail</p> 
 </blockquote> 
 <p><img title="" src="https://images2.imgbox.com/35/df/AovzbKtR_o.png" alt="image_1cu82m5su17na1460956ip61vmm13.png-154.3kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="312-sendmail命令使用说明">3.1.2 sendmail命令使用说明</h4> 
 <p><img title="" src="https://images2.imgbox.com/e9/11/FnYqJzBf_o.png" alt="image_1csiojg831q73vcbuhp10rm1oijk6.png-60.8kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="313-调整qq邮箱设置">3.1.3 调整QQ邮箱设置</h4> 
 <p><img title="" src="https://images2.imgbox.com/c5/c6/knLKEG7O_o.png" alt="image_1cu81sf1dvlo17lgh21vj6133i9.png-103.4kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/a6/85/ClYXdYQy_o.png" alt="image_1cu827u7p1rja1tis12sc1i2s1b2pm.png-51.9kB"></p> 
 <hr> 
 <blockquote class="white-blockquote"> 
  <p>开启后生成的码保存一下，测试邮件的时候需要用到</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="测试邮件发送">测试邮件发送</h4> 
 <blockquote class="white-blockquote"> 
  <p>sendEmail -f 1123400300@qq.com -t 1123400300@qq.com -u "zabbix_server" -s smtp.qq.com -o message-content-type=html -o message-charset=utf8 -xu 1123400300@qq.com -xp lrvtvcgwvsmtijic -m "邮件发送成功"</p> 
 </blockquote> 
 <p><img title="" src="https://images2.imgbox.com/84/9f/E937awj3_o.png" alt="image_1cu82p95j20n1rl11lukf9b132820.png-27.7kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/c2/ff/fWWcMeqS_o.png" alt="image_1cu82pshc1jfh1hu01ksl9b71f752d.png-101.1kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="314-编写qq邮件平台报警脚本">3.1.4 编写QQ邮件平台报警脚本</h4> 
 <blockquote class="white-blockquote"> 
  <p>cd /usr/local/zabbix/share/zabbix/alertscripts</p> 
  <p>pwd</p> 
  <p>vim sendmail.sh</p> 
  <p>chmod +x sendmail.sh</p> 
  <p>chown zabbix.zabbix sendmail.sh</p> 
  <p>cat sendmail.sh</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <ol class="linenums"><li class="L0"><code><span class="com">#!/bin/bash</span></code></li><li class="L1"><code><span class="com">#author:Mr.sun</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">to<span class="pun">=<span class="pln">$1</span></span></span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="pln">subject<span class="pun">=<span class="pln">$2</span></span></span></code></li><li class="L6"><code></code></li><li class="L7"><code><span class="pln">body<span class="pun">=<span class="pln">$3</span></span></span></code></li><li class="L8"><code></code></li><li class="L9"><code><span class="kwd">from<span class="pun">=<span class="lit">1123400300@qq<span class="pun">.<span class="pln">com</span></span></span></span></span></code></li><li class="L0"><code></code></li><li class="L1"><code><span class="pln">smtp<span class="pun">=<span class="pln">smtp<span class="pun">.<span class="pln">qq<span class="pun">.<span class="pln">com</span></span></span></span></span></span></span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="pln">passwd<span class="pun">=<span class="pln">lrvtvcgwvsmtijic</span></span></span></code></li><li class="L4"><code></code></li><li class="L5"><code><span class="pun">/<span class="pln">usr<span class="pun">/<span class="kwd">local<span class="pun">/<span class="pln">bin<span class="pun">/<span class="pln">sendEmail <span class="pun">-<span class="pln">f <span class="str">"$from"<span class="pln"> <span class="pun">-<span class="pln">t <span class="str">"$to"<span class="pln"> <span class="pun">-<span class="pln">s <span class="str">"$smtp"<span class="pln"> <span class="pun">-<span class="pln">u <span class="str">"$subject"<span class="pln"> <span class="pun">-<span class="pln">o message<span class="pun">-<span class="pln">content<span class="pun">-<span class="pln">type<span class="pun">=<span class="pln">html <span class="pun">-<span class="pln">o message<span class="pun">-<span class="pln">charset<span class="pun">=<span class="pln">utf8 <span class="pun">-<span class="pln">xu <span class="str">"$from"<span class="pln"> <span class="pun">-<span class="pln">xp <span class="str">"$passwd"<span class="pln"> <span class="pun">-<span class="pln">m <span class="str">"$body"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li></ol> 
 <p><img title="" src="https://images2.imgbox.com/3e/58/pmU6sg3B_o.png" alt="image_1cu83lrhi142mcm1mhaejq1vmu2q.png-80.2kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="315-脚本测试">3.1.5 脚本测试</h4> 
 <blockquote class="white-blockquote"> 
  <p>sh sendmail.sh 1123400300@qq.com "hello world" "新的一天"</p> 
 </blockquote> 
 <p><img title="" src="https://images2.imgbox.com/d3/76/AkAyEpJL_o.png" alt="image_1cu83ndne1tj8r6b1184nd61hfc37.png-19.2kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/10/d9/tttSCOPA_o.png" alt="image_1cu83o54m1nffgpi1i4ag1m14j03k.png-101.7kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h3 id="316-修改zabbixserverconf配置文件">3.1.6 修改zabbix_server.conf配置文件</h3> 
 <blockquote class="white-blockquote"> 
  <p>cat -n /usr/local/zabbix/etc/zabbix_server.conf | grep "447"</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <ol class="linenums"><li class="L0"><code><span class="lit">447<span class="pln"> <span class="typ">AlertScriptsPath<span class="pun">=<span class="pln">$<span class="pun">{<!-- --><span class="pln">datadir<span class="pun">}/<span class="pln">zabbix<span class="pun">/<span class="pln">alertscripts</span></span></span></span></span></span></span></span></span></span></span></code></li></ol> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="将上述内容修改成如下所示">将上述内容修改成如下所示</h4> 
 <blockquote class="white-blockquote"> 
  <p>cat -n /usr/local/zabbix/etc/zabbix_server.conf | grep "447"</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <ol class="linenums"><li class="L0"><code><span class="lit">447<span class="pln"> <span class="typ">AlertScriptsPath<span class="pun">=<span class="str">/usr/<span class="kwd">local<span class="pun">/<span class="pln">zabbix<span class="pun">/<span class="pln">share<span class="pun">/<span class="pln">zabbix<span class="pun">/<span class="pln">alertscripts</span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li></ol> 
 <p><img title="" src="https://images2.imgbox.com/82/69/3H0PEdAV_o.png" alt="image_1cu83rpev1ka9fmq7depge1v4r41.png-17.4kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="重启zabbixserver服务">重启zabbix_server服务</h4> 
 <blockquote class="white-blockquote"> 
  <p>/etc/init.d/zabbix_server restart</p> 
  <p>netstat -antup | grep zabbix_serve</p> 
 </blockquote> 
 <p><img title="" src="https://images2.imgbox.com/e9/8f/WGaC4KqU_o.png" alt="image_1cu83so44nd810j51co6pg1k194e.png-27.9kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="317-创建报警媒介">3.1.7 创建报警媒介</h4> 
 <p><img title="" src="https://images2.imgbox.com/a7/38/5XM8S0fI_o.png" alt="image_1csip15ti1c3j1grb1c7i1c1ccg3mk.png-42.9kB"></p> 
 <hr> 
 <div class="md-section-divider">
     
 </div> 
 <ol class="linenums"><li class="L0"><code><span class="pun">{<!-- --><span class="pln">ALERT<span class="pun">.<span class="pln">SENDTO<span class="pun">}</span></span></span></span></span></code></li><li class="L1"><code><span class="pun">{<!-- --><span class="pln">ALERT<span class="pun">.<span class="pln">SUBJECT<span class="pun">}</span></span></span></span></span></code></li><li class="L2"><code><span class="pun">{<!-- --><span class="pln">ALERT<span class="pun">.<span class="pln">MESSAGE<span class="pun">}</span></span></span></span></span></code></li></ol> 
 <p><img title="" src="https://images2.imgbox.com/30/99/5PQXCdhH_o.png" alt="image_1csip1o0m5j0mm417j0phopt2nh.png-52.4kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/d5/49/DCtCNprJ_o.png" alt="image_1csip28c01mas1j4km5s371krknu.png-43.5kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/14/61/wbfI8Aju_o.png" alt="image_1csip31dmvou1mfqa341rnflhsob.png-45.3kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/36/46/JBY5aqlT_o.png" alt="image_1cu85jhje1i561bf0bbjaa0hg14r.png-40.9kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/e0/66/R7uT3Yk8_o.png" alt="image_1cu85kmrj1nipp812s71uj21jnb58.png-48.8kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="318-创建报警动作">3.1.8 创建报警动作</h4> 
 <p><img title="" src="https://images2.imgbox.com/2a/3a/BpQdpVPO_o.png" alt="image_1csip43ms1u5h16ua1dt4ce217v1p5.png-32.1kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/c8/5d/iWML8jBa_o.png" alt="image_1cu85opqt65tlht1go31urg9hk5l.png-65.7kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/ab/3e/W1UupiDl_o.png" alt="image_1csip4uks1kuvqkk1h2glti143tpv.png-58.9kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/b4/e5/QTiF8xeu_o.png" alt="image_1cu862q9q1c2kh4c1r5a11ikdt262.png-101.1kB"></p> 
 <blockquote class="white-blockquote"> 
  <p>步骤1-3也就是从1开始到3结束。一旦发生故障，就是执行sendmail.sh脚本发生报警邮件给zabbix用户。<span class="Apple-converted-space"> <br>假如故障持续了1个小时，它也只发送3次，第1-3次（即前3次）邮箱发送给zabbix用户，时间间隔为0秒。<span class="Apple-converted-space"> <br>如果改成1-0,0是表示不限制，无限发送。</span></span></p> 
 </blockquote> 
 <p><img title="" src="https://images2.imgbox.com/9e/3e/r6hhsz63_o.png" alt="image_1cu863vhjhlqsa110r319dhl16f.png-81.9kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/59/33/APoDB2i2_o.png" alt="image_1cu864ls6vbk1dia1u5s1gar10fm6s.png-29.1kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="319-qq邮件报警测试">3.1.9 QQ邮件报警测试</h4> 
 <blockquote class="white-blockquote"> 
  <p>给自定义监控项num_users创建一个触发器，如下</p> 
 </blockquote> 
 <p><img title="" src="https://images2.imgbox.com/eb/a7/LSgCs3m0_o.png" alt="image_1cu86beuj14i317u41b7211rt1mtj79.png-110.2kB"></p> 
 <blockquote class="white-blockquote"> 
  <p>利用Xshell，增加连接数，触发报警并检查邮件</p> 
 </blockquote> 
 <p><img title="" src="https://images2.imgbox.com/01/bc/F8hM6Blb_o.png" alt="image_1cu86g3es1isgbtpjrv1rti1m87m.png-145kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <div class="md-section-divider">
     
 </div> 
 <h3 id="33-自定义自动报警的内容">3.3 自定义自动报警的内容</h3> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="1自定义内容样例">（1）自定义内容样例</h4> 
 <blockquote class="white-blockquote"> 
  <p>如果不修改报警的内容格式，看起来太乱了。我们可以按照如下方式修改</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <ol class="linenums"><li class="L0"><code><span class="com">#告警通知格式样例</span></code></li><li class="L1"><code></code></li><li class="L2"><code><span class="com">#题目</span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="pln">A<span class="pun">故障：{<!-- --><span class="pln">TRIGGER<span class="pun">.<span class="pln">STATUS<span class="pun">}，服务器：{<!-- --><span class="pln">HOSTNAME1<span class="pun">}发生：{<!-- --><span class="pln">TRIGGER<span class="pun">.<span class="pln">NAME<span class="pun">}故障！</span></span></span></span></span></span></span></span></span></span></span></span></code></li><li class="L5"><code></code></li><li class="L6"><code><span class="com">#内容</span></code></li><li class="L7"><code></code></li><li class="L8"><code><span class="pun">告警主机：&amp;<span class="pln">nbsp<span class="pun">；{<!-- --><span class="pln">HOSTNAME1<span class="pun">}&lt;<span class="pln">br<span class="pun">/&gt;</span></span></span></span></span></span></span></code></li><li class="L9"><code><span class="pun">告警时间：&amp;<span class="pln">nbsp<span class="pun">；{<!-- --><span class="pln">EVENT<span class="pun">.<span class="pln">DATE<span class="pun">}<span class="pln"> <span class="pun">{<!-- --><span class="pln">EVENT<span class="pun">.<span class="pln">TIME<span class="pun">}&lt;<span class="pln">br<span class="pun">/&gt;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li><li class="L0"><code><span class="pun">告警等级：&amp;<span class="pln">nbsp<span class="pun">；{<!-- --><span class="pln">TRIGGER<span class="pun">.<span class="pln">SEVERITY<span class="pun">}&lt;<span class="pln">br<span class="pun">/&gt;</span></span></span></span></span></span></span></span></span></code></li><li class="L1"><code><span class="pun">告警信息：&amp;<span class="pln">nbsp<span class="pun">；{<!-- --><span class="pln">TRIGGER<span class="pun">.<span class="pln">NAME<span class="pun">}&lt;<span class="pln">br<span class="pun">/&gt;</span></span></span></span></span></span></span></span></span></code></li><li class="L2"><code><span class="pun">告警项目：&amp;<span class="pln">nbsp<span class="pun">；{<!-- --><span class="pln">TRIGGER<span class="pun">.<span class="pln">KEY1<span class="pun">}&lt;<span class="pln">br<span class="pun">/&gt;</span></span></span></span></span></span></span></span></span></code></li><li class="L3"><code><span class="pun">问题详情：&amp;<span class="pln">nbsp<span class="pun">；{<!-- --><span class="pln">ITEM<span class="pun">.<span class="pln">NAME<span class="pun">}&amp;<span class="pln">nbsp<span class="pun">{<!-- --><span class="pln">ITEM<span class="pun">.<span class="pln">VALUE<span class="pun">}&lt;<span class="pln">br<span class="pun">/&gt;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li><li class="L4"><code><span class="pun">当前状态：&amp;<span class="pln">nbsp<span class="pun">；{<!-- --><span class="pln">TRIGGER<span class="pun">.<span class="pln">STATUS<span class="pun">}&amp;<span class="pln">nbsp<span class="pun">{<!-- --><span class="pln">ITEM<span class="pun">.<span class="pln">VALUE1<span class="pun">}&lt;<span class="pln">br<span class="pun">/&gt;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li><li class="L5"><code><span class="pun">事件<span class="pln">ID<span class="pun">：&amp;<span class="pln">nbsp<span class="pun">；{<!-- --><span class="pln">EVENT<span class="pun">.<span class="pln">ID<span class="pun">}</span></span></span></span></span></span></span></span></span></code></li></ol> 
 <p><img title="" src="https://images2.imgbox.com/33/a2/V3cNpAf9_o.png" alt="image_1csiptgmbb4qoe2o0fuqn1oue18n.png-52.8kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="2样例测试">（2）样例测试</h4> 
 <p><img title="" src="https://images2.imgbox.com/71/89/yDY4axar_o.png" alt="image_1cu86gv1djli1k8o1h341t3t1e1a83.png-145kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h2 id="四用户参数user-parameters">四，用户参数User parameters</h2> 
 <div class="md-section-divider">
     
 </div> 
 <h3 id="41-概述">4.1 概述</h3> 
 <blockquote class="white-blockquote"> 
  <p>有时候当我们监控的项目在Zabbix预定义的key中没有定义时，这时候我们可以通过编写Zabbix的用户参数的方法来监控我们要求的项目item。形象一点说Zabbix代理端配置文件中的User</p> 
  <p>parameters就相当于通过脚本获取要监控的值，然后把相关的脚本或者命令写入到配置文件中的User</p> 
  <p>parameter中，然后Zabbix server读取配置文件中的返回值通过处理前端的方式返回给用户。</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="用户参数的语法">用户参数的语法</h4> 
 <blockquote class="white-blockquote"> 
  <p>UserParameter=,</p> 
  <p>其中，Userparameter为关键字，key为用户自定义key名字可以随便起，为我们要运行的命令或者脚本。</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="一个简单的例子">一个简单的例子</h4> 
 <blockquote class="white-blockquote"> 
  <p>UserParameter=ping，echo 1</p> 
  <p>代理程序将会永远的返回1，当我们在服务器端添加item的key为ping的时候。</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="稍微复杂的例子">稍微复杂的例子</h4> 
 <blockquote class="white-blockquote"> 
  <p>UserParameter=mysql.ping,/usr/local/mysql/bin/mysqladmin ping | grep -c alive</p> 
  <p>当我们执行mysqladmin -uroot ping命令的时候如果mysql存活要返回mysqld is alive，我们通过grep -c来计算mysqld is alive的个数，如果mysql存活着，则个数为1，如果不存活很明显mysqld is alive的个数为0，通过这种方法我们可以来判断mysql的存活状态。</p> 
  <p>当我们在服务器端添加item的key为mysql.ping时候，对于Zabbix代理程序，如果mysql存活，则状态将返回1，否则，状态将返回0。</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h3 id="42-让key接受参数">4.2 让key接受参数</h3> 
 <blockquote class="white-blockquote"> 
  <p>让key也接受参数的方法使item添加时更具备了灵活性，例如系统预定义key：vm.memory.size[],其中的mode模式就是用户要接受的参数，当我们填写为free时则返回的为内存的剩余大小，如果我们填入的为userd时这返回的是内存已经使用的大小。</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="相关语法">相关语法</h4> 
 <blockquote class="white-blockquote"> 
  <p>UserParameter=key[*],command</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <ol class="linenums"><li class="L0"><code><span class="com">#描述：</span></code></li><li class="L1"><code><span class="pln">key<span class="pun">：<span class="pln">key<span class="pun">的值在主机系统中必须是唯一的，其中*代表命令中接受的参数</span></span></span></span></code></li><li class="L2"><code><span class="pln">command<span class="pun">：客户端系统中可执行的命令</span></span></code></li><li class="L3"><code></code></li><li class="L4"><code><span class="com">#举例：</span></code></li><li class="L5"><code><span class="typ">UserParameter<span class="pun">=<span class="pln">ping<span class="pun">[*],<span class="pln">echo $1</span></span></span></span></span></code></li><li class="L6"><code><span class="pln">ping<span class="pun">[<span class="lit">0<span class="pun">]:此时<span class="lit">0<span class="pun">就是*，也就是传入参数是<span class="lit">0<span class="pun">，<span class="pln">$1<span class="pun">也就是<span class="lit">0<span class="pun">，因此表达式将一直返回‘<span class="lit">0<span class="pun">’</span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li><li class="L7"><code><span class="pln">ping<span class="pun">[<span class="pln">aaa<span class="pun">]:此时<span class="pln">aaa<span class="pun">就是*，也就是传入参数是<span class="pln">aaa<span class="pun">，<span class="pln">$1<span class="pun">也就是<span class="pln">aaa<span class="pun">,因此表达式将一直返回‘<span class="pln">aaa<span class="pun">’</span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li></ol> 
 <div class="md-section-divider">
     
 </div> 
 <h3 id="43-让我们自定义一个可以传递参数的监控项">4.3 让我们自定义一个可以传递参数的监控项</h3> 
 <blockquote class="white-blockquote"> 
  <p>我们做一个可以根据条件获取内存数值大小的监控项mem_check</p> 
  <p>当我们键值为mem_check[free]时，获取剩余可用内存大小</p> 
  <p>当我们键值为mem_check[used]时，获取实际占用内存大小</p> 
  <p>当我们键值为mem_check时，获取总内存大小</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="431-我们先制作一个获取数据的脚本">4.3.1 我们先制作一个获取数据的脚本</h4> 
 <blockquote class="white-blockquote"> 
  <p>mkdir -p /server/scripts</p> 
  <p>cd /server/scripts/</p> 
  <p>vim mem_check</p> 
  <p>cat mem_check</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <ol class="linenums"><li class="L0"><code><span class="com">#!/bin/bash</span></code></li><li class="L1"><code><span class="com"># author:Mr.sun</span></code></li><li class="L2"><code></code></li><li class="L3"><code><span class="kwd">case<span class="pln"> $1 <span class="kwd">in</span></span></span></code></li><li class="L4"><code><span class="pln"> free<span class="pun">)</span></span></code></li><li class="L5"><code><span class="pln"> echo <span class="str">"`free | awk 'NR==3{print $4}'`"</span></span></code></li><li class="L6"><code><span class="pln"> <span class="pun">;;</span></span></code></li><li class="L7"><code><span class="pln"> used<span class="pun">)</span></span></code></li><li class="L8"><code><span class="pln"> echo <span class="str">"`free | awk 'NR==3{print $3}'`"</span></span></code></li><li class="L9"><code><span class="pln"> <span class="pun">;;</span></span></code></li><li class="L0"><code><span class="pln"> <span class="pun">*)</span></span></code></li><li class="L1"><code><span class="pln"> echo <span class="str">"`free | awk 'NR==2{print $2}'`"</span></span></code></li><li class="L2"><code><span class="pln"> <span class="pun">;;</span></span></code></li><li class="L3"><code><span class="kwd">esac</span></code></li></ol> 
 <p><img title="" src="https://images2.imgbox.com/5a/67/MuxxJYuX_o.png" alt="image_1cu87ub1hjtno60rmr1p951u6i8g.png-41.3kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="432-测试脚本">4.3.2 测试脚本</h4> 
 <blockquote class="white-blockquote"> 
  <p>chmod +x mem_check</p> 
  <p>chown zabbix.zabbix mem_check</p> 
  <p>sh mem_check</p> 
  <p>sh mem_check free</p> 
  <p>sh mem_check used</p> 
 </blockquote> 
 <p><img title="" src="https://images2.imgbox.com/45/90/KEq66Of1_o.png" alt="image_1cu87vt6m1tlp1m7ol68l13cj8t.png-38.1kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="433-后台自定义一个监控项的键值">4.3.3 后台自定义一个监控项的键值</h4> 
 <blockquote class="white-blockquote"> 
  <p>cd /etc/zabbix/zabbix_agentd.d/</p> 
  <p>vim mem_check.conf</p> 
  <p>cat mem_check.conf</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <ol class="linenums"><li class="L0"><code><span class="typ">UserParameter<span class="pun">=<span class="pln">mem<span class="pun">.<span class="pln">check<span class="pun">[*],<span class="str">/server/<span class="pln">scripts<span class="pun">/<span class="pln">mem_check $1</span></span></span></span></span></span></span></span></span></span></code></li></ol> 
 <p><img title="" src="https://images2.imgbox.com/87/a1/VCIBTNvT_o.png" alt="image_1cu8811kpoen1uprtlh1scp36j9a.png-24.8kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="434-重启并在server端测试自定义的键值">4.3.4 重启并在server端测试自定义的键值</h4> 
 <blockquote class="white-blockquote"> 
  <p>/etc/init.d/zabbix-agent restart</p> 
  <p>zabbix_get -s 192.168.200.78 -p 10050 -k "mem.check"</p> 
  <p>zabbix_get -s 192.168.200.78 -p 10050 -k "mem.check[*]"</p> 
  <p>zabbix_get -s 192.168.200.78 -p 10050 -k "mem.check[free]"</p> 
  <p>zabbix_get -s 192.168.200.78 -p 10050 -k "mem.check[used]"</p> 
 </blockquote> 
 <p><img title="" src="https://images2.imgbox.com/ce/5c/LRWm0T2Z_o.png" alt="image_1cu8836i3fe916db877ts81mva9n.png-17.7kB"></p> 
 <hr> 
 <p><img title="" src="https://images2.imgbox.com/cd/76/cLfM5APr_o.png" alt="image_1cu884loija9cnv1vq23mg1ig8a4.png-37.6kB"></p> 
 <div class="md-section-divider">
     
 </div> 
 <h4 id="435-前台自定义一个监控项及触发器">4.3.5 前台自定义一个监控项及触发器</h4> 
 <blockquote class="white-blockquote"> 
  <p>过程略，此时我相信都已经会了。请自己尝试创建完整。</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h2 id="五agentd主动模式与被动模式">五，Agentd主动模式与被动模式</h2> 
 <blockquote class="white-blockquote"> 
  <p>默认情况下，zabbix server会直接去每个agent上抓取数据，这对于agent来说，是被动模式，也是默认的一种获取数据的方式，但是，当zabbix server监控主机数量过多的时候，由server端去抓取agent上的数据，zabbix server会出现严重的性能问题，主要表现如下：</p> 
  <ol><li> <p>Web操作很卡，容易出现502</p> </li><li> <p>图层断裂</p> </li><li> <p>开启的进程（Pollar）太多，即使减少item数量，以后加入一定量的机器也会有问题</p> </li></ol> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h3 id="所以下面主要往两个优化方向考虑">所以，下面主要往两个优化方向考虑</h3> 
 <blockquote class="white-blockquote"> 
  <ol><li> <p>用Proxy或者Node模式做分布式监控</p> </li><li> <p>调整Agentd为主动模式</p> </li></ol> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h2 id="51-agentd的配置调整">5.1 Agentd的配置调整</h2> 
 <blockquote class="white-blockquote"> 
  <p>修改zabbix_agentd.conf配置文件，注意是打开如下参数：</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <ol class="linenums"><li class="L0"><code><span class="pln"> <span class="typ">ServerActive<span class="pun">=<span class="lit">192.168<span class="pun">.<span class="lit">0.220</span></span></span></span></span></span></code></li><li class="L1"><code><span class="pln"> <span class="typ">Hostname<span class="pun">=<span class="lit">192.168<span class="pun">.<span class="lit">0.220</span></span></span></span></span></span></code></li><li class="L2"><code><span class="pln"> <span class="typ">StartAgents<span class="pun">=<span class="lit">1</span></span></span></span></code></li></ol> 
 <blockquote class="white-blockquote"> 
  <p>ServerActive是指定Agentd收集的数据往哪里发送，Hostname是必须要和zabbix web端添加主机时的主机名对应起来，这样zabbix server端接收到数据才能找到对应关系，这里为了兼容被动模式，没有把StartAgents设为0，如果一开始就是使用主动模式的话建议把StartAgents设为0，关闭被动模式。</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <h3 id="52-zabbix-server端配置调整">5.2 zabbix Server端配置调整</h3> 
 <blockquote class="white-blockquote"> 
  <p>如果开启了agent端的主动发送数据模式，需要在zabbix Server端修改如下两个参数，保证性能。</p> 
 </blockquote> 
 <div class="md-section-divider">
     
 </div> 
 <ol class="linenums"><li class="L0"><code><span class="pln"> <span class="typ">StartPollers<span class="pun">=<span class="lit">10<span class="pln"> <span class="com">#把这个zabbix Server主动收集数据进程减少一些。 StartTrappers=200 </span></span></span></span></span></span></code></li><li class="L1"><code><span class="pln"> <span class="com">#把这个负责处理Agentd推送过来的数据的进程开大一些。</span></span></code></li></ol> 
 <div class="md-section-divider">
     
 </div> 
 <h3 id="53-调整模版">5.3 调整模版</h3> 
 <blockquote class="white-blockquote"> 
  <p>因此收集数据的模式发生了变化，因此需要把所有的监控项的类型由原来的“zabbix客户端”改成“zabbix客户端（主动式）”。</p> 
  <p>这样，只需要简单的几步，就完成了主动模式的切换，调整之后服务器不卡了，图层不裂了，进程也少了。</p> 
 </blockquote> 
 <p><img src="https://images2.imgbox.com/b5/38/p4NW9izp_o.png" alt="image_1csiqlggu1esn79j1cc51ssr11eu19h.png-61.5kB"></p> 
</div> 
<p>转载于:https://www.cnblogs.com/linyaonie/p/10113376.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/666c2a0712285a04a0cd9d236b277938/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">在Idea里面用SSM注解写一个项目遇到的种种坑</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f0b586ca27e59685c38ec379c557e675/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">input标签multiple属性用法简介</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>