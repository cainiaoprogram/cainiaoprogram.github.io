<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C&#43;&#43;设计模式 --1.工厂模式和单例模式 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="C&#43;&#43;设计模式 --1.工厂模式和单例模式" />
<meta property="og:description" content="文章目录 1.工厂模式简单工厂模式工厂方法模式抽象工厂模式 2.单例模式懒汉式饿汉式 1.工厂模式 简单工厂模式 抽象产品类
//定义一个抽象水果类 --抽象产品角色 class AbstractFruit { public: virtual void showFruitName()=0;//抽取出产品的公共行为， 纯虚函数 virtual ~AbstractFruit(){};//虚析构函数 -- 做为顶层基类，一定要显示定义虚析构函数，防止内存溢出 }; 具体产品类
//苹果类 -- 具体产品角色 class Apple : public AbstractFruit { public: virtual void showFruitName() override { cout &lt;&lt; &#34;this is an apple&#34; &lt;&lt;endl; } }; //鸭梨类 -- 具体产品角色 class Pear : public AbstractFruit { public: virtual void showFruitName() override { cout &lt;&lt; &#34;this is a pear&#34; &lt;&lt;endl; } }; //香蕉类 -- 具体产品角色 class Banana : public AbstractFruit { public: virtual void showFruitName() override { cout &lt;&lt; &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/f54b13b8b6bb07845be752f696ac6c22/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-08T16:09:21+08:00" />
<meta property="article:modified_time" content="2024-01-08T16:09:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C&#43;&#43;设计模式 --1.工厂模式和单例模式</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1_1" rel="nofollow">1.工厂模式</a></li><li><ul><li><a href="#_2" rel="nofollow">简单工厂模式</a></li><li><a href="#_104" rel="nofollow">工厂方法模式</a></li><li><a href="#_253" rel="nofollow">抽象工厂模式</a></li></ul> 
  </li><li><a href="#2_529" rel="nofollow">2.单例模式</a></li><li><ul><li><a href="#_530" rel="nofollow">懒汉式</a></li><li><a href="#_590" rel="nofollow">饿汉式</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="1_1"></a>1.工厂模式</h2> 
<h3><a id="_2"></a>简单工厂模式</h3> 
<p><code>抽象产品类</code></p> 
<pre><code class="prism language-cpp"><span class="token comment">//定义一个抽象水果类 --抽象产品角色</span>
<span class="token keyword">class</span> <span class="token class-name">AbstractFruit</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showFruitName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//抽取出产品的公共行为， 纯虚函数</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">AbstractFruit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//虚析构函数  -- 做为顶层基类，一定要显示定义虚析构函数，防止内存溢出</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>具体产品类</code></p> 
<pre><code class="prism language-cpp"><span class="token comment">//苹果类 -- 具体产品角色</span>
<span class="token keyword">class</span> <span class="token class-name">Apple</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractFruit</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showFruitName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"this is an apple"</span> <span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//鸭梨类 -- 具体产品角色</span>
<span class="token keyword">class</span> <span class="token class-name">Pear</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractFruit</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showFruitName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"this is a pear"</span> <span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//香蕉类 -- 具体产品角色</span>
<span class="token keyword">class</span> <span class="token class-name">Banana</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractFruit</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showFruitName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"create bananas"</span> <span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>工厂</code></p> 
<pre><code class="prism language-cpp"><span class="token comment">//工厂类 --工厂角色</span>
<span class="token comment">/*
	1.内含一个生成具体产品对象的静态方法，根据传入的参数判断要生成的哪种产品，并返回对象指针
	2.通过抽象产品类类型指针来接收具体产品的堆内存地址，达到多态目的。
*/</span>
<span class="token keyword">class</span> <span class="token class-name">FruitFactory</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">static</span> AbstractFruit<span class="token operator">*</span> <span class="token function">makeFruit</span><span class="token punctuation">(</span>string fruitType<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>fruitType <span class="token operator">==</span> <span class="token string">"apple"</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> Apple<span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>fruitType <span class="token operator">==</span> <span class="token string">"pear"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> Pear<span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>fruitType <span class="token operator">==</span> <span class="token string">"banana"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token keyword">new</span> Banana<span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>客户端</code></p> 
<pre><code class="prism language-cpp"><span class="token comment">//客户端</span>
<span class="token comment">/*
  1.通过工厂类调用其创建产品的静态方法，并根据传入的参数 生成具体的产品对象
*/</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	AbstractFruit<span class="token operator">*</span> fruit <span class="token operator">=</span> <span class="token class-name">FruitFactory</span><span class="token double-colon punctuation">::</span><span class="token function">makeFruit</span><span class="token punctuation">(</span><span class="token string">"apple"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>fruit <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		fruit<span class="token operator">-&gt;</span><span class="token function">showFruitName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">delete</span> fruit<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"=============="</span> <span class="token operator">&lt;&lt;</span>endl<span class="token punctuation">;</span>
	fruit <span class="token operator">=</span> <span class="token class-name">FruitFactory</span><span class="token double-colon punctuation">::</span><span class="token function">makeFruit</span><span class="token punctuation">(</span><span class="token string">"banana"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>fruit <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		fruit<span class="token operator">-&gt;</span><span class="token function">showFruitName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">delete</span> fruit<span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b1/b8/hqimtaKT_o.png" alt="在这里插入图片描述"><br> 简单工厂模式<code>不属于</code> GoF的23种设计模式。<br> 简单工厂模式 有以下三种角色：<br> <code>抽象产品角色</code>：简单工厂模式所创建的所有对象的父类，它负责描述所有实例所共有的公共接口。<br> <code>具体产品角色</code>：简单工厂模式所创建的具体实例对象。<br> <code>工厂角色</code>：简单工厂模式的核心，它负责创建所有实例的内部逻辑，工厂类可以被外界直接调用，创建所需的产品对象。</p> 
<p><code>优点</code>：<br> 1.实现客户端和具体实现类解耦；不需要关注对象的创建细节；<br> 2.通过客户端 传入参数 让工厂知道应该创建什么类型对象。<br> <code>缺点</code>：<br> 1.当每增加新类型的具体产品时，需要修改工厂类的中if…else 源代码，不符合开闭原则。<br> 2.这个类过重（很多if…else,及负责生成所有产品），将各种产品对象的初始化集中在一个类中实现，违反了 单一职责原则；<br> 3.并且这个类发生问题，会影响很多使用这个工厂的模块。</p> 
<p>简单工厂模式 UML类图：<br> <img src="https://images2.imgbox.com/e8/92/eytgHERi_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_104"></a>工厂方法模式</h3> 
<p>工厂方法模式的意义是定义一个创建产品对象的工厂接口，将实际创建工作推迟到子类当中。核心工厂类不再负责产品的创建，这样核心类成为一个抽象工厂角色，仅负责具体工厂子类必须实现的接口，这样进一步抽象化的好处是使得工厂方法模式可以使系统不修改具体工厂角色的情况下引进新的产品。</p> 
<p>工厂方法模式是 简单工厂模式 + 开闭原则 +单一职责原则。<br> 工厂方法模式有以下四个角色：<br> <code>1.抽象工厂角色</code>：工厂方法模式的核心，负责定义公共接口，任何具体工厂类都必须实现这个接口。<br> <code> 2.具体工厂角色</code>：具体工厂是抽象工厂的一个实现，负责实例化产品对象。<br> <code>3.抽象产品角色</code>：工厂方法模式所创建的所有对象的父类，它负责描述所有实例所共有的公共接口。<br> <code>4.具体产品角色</code>：工厂方法模式所创建的具体实例对象。<br> 工厂方法模式的优点：</p> 
<ol><li>符合开闭原则，即抽象工厂中的公共接口是闭的，针对新种类产品，可以通过增加具体工厂来生产，这个是开的，实现可扩展。</li><li>符合单一职责原则，即每个具体工厂只负责生产某一种类的产品。而不像简单工厂模式中在 工厂类中负责生成所有种类产品。<br> 工厂方法模式的缺点：</li><li>类的成本个数增加，导致类越来越多，增加维护成本。</li></ol> 
<p>代码案例:<br> <code>抽象工厂</code>：</p> 
<pre><code class="prism language-cpp"><span class="token comment">//抽象水果工厂</span>
<span class="token keyword">class</span> <span class="token class-name">AbstractFruitFactory</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">virtual</span> AbstractFruit<span class="token operator">*</span> <span class="token function">makeFruit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//生产水果的纯虚函数(也叫接口)</span>
	<span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">AbstractFruitFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>具体工厂</code>：</p> 
<pre><code class="prism language-cpp"><span class="token comment">//负责具体生产苹果的苹果工厂</span>
<span class="token keyword">class</span> <span class="token class-name">AppleFactory</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractFruitFactory</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	AbstractFruit<span class="token operator">*</span> <span class="token function">makeFruit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//实现接口</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> Apple<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//负责具体生产鸭梨的鸭梨工厂</span>
<span class="token keyword">class</span> <span class="token class-name">PearFactory</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractFruitFactory</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	AbstractFruit<span class="token operator">*</span> <span class="token function">makeFruit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//实现接口</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> Pear<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//负责具体生产香蕉的香蕉工厂</span>
<span class="token keyword">class</span> <span class="token class-name">BananaFactory</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractFruitFactory</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	AbstractFruit<span class="token operator">*</span> <span class="token function">makeFruit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//实现接口</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> Banana<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>抽象产品</code>：</p> 
<pre><code class="prism language-cpp"><span class="token comment">//抽象产品</span>
<span class="token keyword">class</span> <span class="token class-name">AbstractFruit</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showFruitName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">AbstractFruit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>具体产品</code>：</p> 
<pre><code class="prism language-cpp"><span class="token comment">//苹果类</span>
<span class="token keyword">class</span> <span class="token class-name">Apple</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractFruit</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">showFruitName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"this is an apple"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//鸭梨类</span>
<span class="token keyword">class</span> <span class="token class-name">Pear</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractFruit</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">showFruitName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"this is a pear"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//香蕉类</span>
<span class="token keyword">class</span> <span class="token class-name">Banana</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractFruit</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">showFruitName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"this is a banana"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>客户端调用：</code></p> 
<pre><code class="prism language-cpp"><span class="token comment">//客户端 --调用</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>	
	<span class="token comment">//创建一个抽象工厂类型指针变量</span>
	AbstractFruitFactory<span class="token operator">*</span> abstractFruitFactory <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	<span class="token comment">//创建一个抽象产品类型指针变量</span>
	AbstractFruit<span class="token operator">*</span> abstractFruit <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	
	<span class="token comment">//创建生产具体某种产品的工厂类(苹果类)，让抽象工厂类型指针指向具体工厂类的对象，从而实现多态</span>
	abstractFruitFactory <span class="token operator">=</span> <span class="token keyword">new</span> AppleFactory<span class="token punctuation">;</span>
	abstractFruit <span class="token operator">=</span> abstractFruitFactory<span class="token operator">-&gt;</span><span class="token function">makeFruit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	abstractFruit<span class="token operator">-&gt;</span><span class="token function">showFruitName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">delete</span> abstractFruitFactory<span class="token punctuation">;</span>
	<span class="token keyword">delete</span> abstractFruit<span class="token punctuation">;</span>

	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"====================="</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	
	<span class="token comment">//创建生产具体某种产品的工厂类(鸭梨类)，让抽象工厂类型指针指向具体工厂类的对象，从而实现多态</span>
	abstractFruitFactory <span class="token operator">=</span> <span class="token keyword">new</span> PearFactory<span class="token punctuation">;</span>
	abstractFruit <span class="token operator">=</span> abstractFruitFactory<span class="token operator">-&gt;</span><span class="token function">makeFruit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	abstractFruit<span class="token operator">-&gt;</span><span class="token function">showFruitName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">delete</span> abstractFruitFactory<span class="token punctuation">;</span>
	<span class="token keyword">delete</span> abstractFruit<span class="token punctuation">;</span>

	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"====================="</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	<span class="token comment">//创建生产具体某种产品的工厂类(香蕉类)，让抽象工厂类型指针指向具体工厂类的对象，从而实现多态</span>
	abstractFruitFactory <span class="token operator">=</span> <span class="token keyword">new</span> BananaFactory<span class="token punctuation">;</span>
	abstractFruit <span class="token operator">=</span> abstractFruitFactory<span class="token operator">-&gt;</span><span class="token function">makeFruit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	abstractFruit<span class="token operator">-&gt;</span><span class="token function">showFruitName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">delete</span> abstractFruitFactory<span class="token punctuation">;</span>
	<span class="token keyword">delete</span> abstractFruit<span class="token punctuation">;</span>
	
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/75/f9/N9ghgPPA_o.png" alt="在这里插入图片描述"><br> 工厂方法模式UML类图：<br> <img src="https://images2.imgbox.com/f1/b5/nGNACH1o_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_253"></a>抽象工厂模式</h3> 
<p>抽象工厂针对的是产品族，而不是产品等级结构。<br> <img src="https://images2.imgbox.com/57/ef/XUZxdOhB_o.png" alt="在这里插入图片描述"><br> 抽象工厂模式和工厂方法模式一样也有以下四个角色：<br> <code>1.抽象工厂角色</code>：抽象工厂模式的核心，负责定义公共接口，任何具体工厂类都必须实现这个接口。<br> <code> 2.具体工厂角色</code>：具体工厂是抽象工厂的一个实现，负责实例化同一产品族的对象。<br> <code>3.抽象产品角色</code>：抽象工厂模式所创建的相同产品等级对象的父类，它负责描述所有相同产品等级实例所共有的公共接口。<br> <code>4.具体产品角色</code>：抽象工厂模式所创建的具体实例对象。</p> 
<p>可以说 抽象工厂模式是工厂方法模式的升级版。抽象工厂模式指针的是产品族符合开闭原则，而工厂方法模式针对的是多个系列产品符合开闭原则。</p> 
<p>代码演示实例：<br> <code>抽象产品</code>：</p> 
<pre><code class="prism language-cpp"><span class="token comment">//抽象苹果类</span>
<span class="token keyword">class</span> <span class="token class-name">AbstractApple</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">AbstractApple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//抽象鸭梨类</span>
<span class="token keyword">class</span> <span class="token class-name">AbstractPear</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">AbstractPear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//抽象香蕉类</span>
<span class="token keyword">class</span> <span class="token class-name">AbstractBanana</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">AbstractBanana</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>具体产品`：</p> 
<pre><code class="prism language-cpp"><span class="token comment">//中国苹果</span>
<span class="token keyword">class</span> <span class="token class-name">ChinaApple</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractApple</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"this is a ChinaApple"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//中国鸭梨</span>
<span class="token keyword">class</span> <span class="token class-name">ChinaPear</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractPear</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"this is a ChinaPear"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//中国香蕉</span>
<span class="token keyword">class</span> <span class="token class-name">ChinaBanana</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractBanana</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"this is a ChinaBanana"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">//美国苹果</span>
<span class="token keyword">class</span> <span class="token class-name">AmericaApple</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractApple</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"this is an AmericaApple"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token comment">//美国鸭梨</span>
<span class="token keyword">class</span> <span class="token class-name">AmericaPear</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractPear</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"this is an AmericaPear"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>	
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//美国香蕉</span>
<span class="token keyword">class</span> <span class="token class-name">AmericaBanana</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractBanana</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"this is an AmericaBanana"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//日本苹果</span>
<span class="token keyword">class</span> <span class="token class-name">JapanApple</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractApple</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"this is a JapanApple"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//日本鸭梨</span>
<span class="token keyword">class</span> <span class="token class-name">JapanPear</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractPear</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"this is a JapanPear"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//日本香蕉</span>
<span class="token keyword">class</span> <span class="token class-name">JapanBanana</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractBanana</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"this is a JapanBanana"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>抽象工厂</code>:</p> 
<pre><code class="prism language-cpp"><span class="token comment">//抽象工厂类</span>
<span class="token keyword">class</span> <span class="token class-name">AbstractFruitFactory</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">virtual</span> AbstractApple <span class="token operator">*</span> <span class="token function">createApple</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">virtual</span> AbstractPear <span class="token operator">*</span> <span class="token function">createPear</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">virtual</span> AbstractBanana <span class="token operator">*</span> <span class="token function">createBanana</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">AbstractFruitFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>具体工厂</code>:</p> 
<pre><code class="prism language-cpp"><span class="token comment">//中国工厂</span>
<span class="token keyword">class</span> <span class="token class-name">ChinaFruitFactory</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractFruitFactory</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	AbstractApple <span class="token operator">*</span> <span class="token function">createApple</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> ChinaApple<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	AbstractPear <span class="token operator">*</span> <span class="token function">createPear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> ChinaPear<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	AbstractBanana<span class="token operator">*</span> <span class="token function">createBanana</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> ChinaBanana<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//美国工厂</span>
<span class="token keyword">class</span> <span class="token class-name">AmericaFruitFactory</span>  <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractFruitFactory</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	AbstractApple <span class="token operator">*</span> <span class="token function">createApple</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> AmericaApple<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	AbstractPear <span class="token operator">*</span> <span class="token function">createPear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> AmericaPear<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	AbstractBanana<span class="token operator">*</span> <span class="token function">createBanana</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> AmericaBanana<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//日本工厂</span>
<span class="token keyword">class</span> <span class="token class-name">JapanFruitFactory</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">AbstractFruitFactory</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	AbstractApple<span class="token operator">*</span> <span class="token function">createApple</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> JapanApple<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	AbstractPear<span class="token operator">*</span> <span class="token function">createPear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> JapanPear<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	AbstractBanana<span class="token operator">*</span> <span class="token function">createBanana</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> JapanBanana<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>封装的测试函数：</code></p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">testAbstractFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	AbstractFruitFactory<span class="token operator">*</span> abstractFruitFactory <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	AbstractApple<span class="token operator">*</span> apple <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	AbstractPear<span class="token operator">*</span> pear <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	AbstractBanana<span class="token operator">*</span> banana <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>

	abstractFruitFactory <span class="token operator">=</span> <span class="token keyword">new</span> ChinaFruitFactory<span class="token punctuation">;</span>
	apple <span class="token operator">=</span> abstractFruitFactory<span class="token operator">-&gt;</span><span class="token function">createApple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	apple<span class="token operator">-&gt;</span><span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pear <span class="token operator">=</span> abstractFruitFactory<span class="token operator">-&gt;</span><span class="token function">createPear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pear<span class="token operator">-&gt;</span><span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	banana <span class="token operator">=</span> abstractFruitFactory<span class="token operator">-&gt;</span><span class="token function">createBanana</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	banana<span class="token operator">-&gt;</span><span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">delete</span> abstractFruitFactory<span class="token punctuation">;</span>
	<span class="token keyword">delete</span> apple<span class="token punctuation">;</span>
	<span class="token keyword">delete</span> pear<span class="token punctuation">;</span>

	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"======================="</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	abstractFruitFactory <span class="token operator">=</span> <span class="token keyword">new</span> AmericaFruitFactory<span class="token punctuation">;</span>
	apple <span class="token operator">=</span> abstractFruitFactory<span class="token operator">-&gt;</span><span class="token function">createApple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	apple<span class="token operator">-&gt;</span><span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pear <span class="token operator">=</span> abstractFruitFactory<span class="token operator">-&gt;</span><span class="token function">createPear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pear<span class="token operator">-&gt;</span><span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	banana <span class="token operator">=</span> abstractFruitFactory<span class="token operator">-&gt;</span><span class="token function">createBanana</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	banana<span class="token operator">-&gt;</span><span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">delete</span> abstractFruitFactory<span class="token punctuation">;</span>
	<span class="token keyword">delete</span> apple<span class="token punctuation">;</span>
	<span class="token keyword">delete</span> pear<span class="token punctuation">;</span>

	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"======================="</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	abstractFruitFactory <span class="token operator">=</span> <span class="token keyword">new</span> JapanFruitFactory<span class="token punctuation">;</span>
	apple <span class="token operator">=</span> abstractFruitFactory<span class="token operator">-&gt;</span><span class="token function">createApple</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	apple<span class="token operator">-&gt;</span><span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pear <span class="token operator">=</span> abstractFruitFactory<span class="token operator">-&gt;</span><span class="token function">createPear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	pear<span class="token operator">-&gt;</span><span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	banana <span class="token operator">=</span> abstractFruitFactory<span class="token operator">-&gt;</span><span class="token function">createBanana</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	banana<span class="token operator">-&gt;</span><span class="token function">showName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">delete</span> abstractFruitFactory<span class="token punctuation">;</span>
	<span class="token keyword">delete</span> apple<span class="token punctuation">;</span>
	<span class="token keyword">delete</span> pear<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><code>客户端--调用</code>：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">testAbstractFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/15/58/coaDsZ9G_o.png" alt="在这里插入图片描述"><br> 抽象工厂模式UML类图：<br> <img src="https://images2.imgbox.com/69/17/s4MLjzEu_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="2_529"></a>2.单例模式</h2> 
<h3><a id="_530"></a>懒汉式</h3> 
<p>代码示例如下：</p> 
<p><code>LazySingleton类</code>：</p> 
<pre><code class="prism language-cpp"><span class="token comment">//懒汉式</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">LazySingleton</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token function">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"LazySingleton constructor"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//私有化构造函数</span>
	<span class="token operator">~</span><span class="token function">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//私有化析构函数</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">static</span> LazySingleton<span class="token operator">*</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>singleton <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cout <span class="token operator">&lt;&lt;</span> <span class="token string">"生成单例对象"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
			singleton <span class="token operator">=</span> <span class="token keyword">new</span> LazySingleton<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> singleton<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">static</span> LazySingleton<span class="token operator">*</span> singleton<span class="token punctuation">;</span><span class="token comment">//声明</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//定义静态成员变量</span>
LazySingleton<span class="token operator">*</span>  LazySingleton<span class="token double-colon punctuation">::</span>singleton <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span> <span class="token comment">//在main函数执行前会进行静态成员的初始化</span>
</code></pre> 
<p><code>测试调用</code>：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">testLazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//LazySingleton lazySingleton;			//编译不过，构造函数私有化不能在类定义的外部创建类的实例</span>
	<span class="token comment">//LazySingleton* p1 = new LazySingleton;//编译不过，因为右值要触发在堆上创建类的实例对象，并调用构造函数初始化</span>
	<span class="token comment">//LazySingleton* p2;//可以，因为它并不会创建类的对象，只是定义了一个类类型的指针变量</span>

	LazySingleton<span class="token operator">*</span> f1 <span class="token operator">=</span> <span class="token class-name">LazySingleton</span><span class="token double-colon punctuation">::</span><span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	LazySingleton<span class="token operator">*</span> f2 <span class="token operator">=</span> <span class="token class-name">LazySingleton</span><span class="token double-colon punctuation">::</span><span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>f1 <span class="token operator">==</span> f2<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"f1 和 f2 指向的内存地址相同"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"f1 和 f2 指向的内存地址不相同"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"main function ...."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token function">testLazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><code>编译命令</code>：g++ -std=c++11 singleton.cpp -o singleton<br> <code>打印输出</code>：<br> <img src="https://images2.imgbox.com/e1/bb/Lxms2HR8_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_590"></a>饿汉式</h3> 
<p>代码示例如下：</p> 
<p><code>HungrySingleton类</code>：</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">HungrySingleton</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token function">HungrySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> cout <span class="token operator">&lt;&lt;</span> <span class="token string">"HungrySingleton constructor"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//保证构造函数私有</span>
	<span class="token operator">~</span><span class="token function">HungrySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//析构函数私有</span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">static</span> HungrySingleton<span class="token operator">*</span> <span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> singleton<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">static</span> HungrySingleton<span class="token operator">*</span> singleton<span class="token punctuation">;</span><span class="token comment">//声明</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//定义静态成员变量</span>
HungrySingleton<span class="token operator">*</span>  HungrySingleton<span class="token double-colon punctuation">::</span>singleton <span class="token operator">=</span> <span class="token keyword">new</span> HungrySingleton<span class="token punctuation">;</span><span class="token comment">//在main函数执行前会进行静态成员的初始化,会调用HungryFactory类的私有构造函数初始化对象</span>
<span class="token comment">//上面这一句，右值为啥可以写new HungryFactory，因为这句静态成员变量的定义，相当于它仍然在类的作用域范围内。可以访问到私有构造函数。</span>
</code></pre> 
<p><code>测试调用</code>：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">testHungrySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//HungrySingleton hungrySingleton;//编译不过，构造函数私有化不能在类定义的外部创建类的实例</span>
	<span class="token comment">//HungrySingleton* p3 = new HungrySingleton;//编译不过，同上</span>
	<span class="token comment">//HungrySingleton* p4;//可以，因为它并不会创建类的对象，只是定义了一个类类型的指针变量</span>

	HungrySingleton<span class="token operator">*</span> f3 <span class="token operator">=</span> <span class="token class-name">HungrySingleton</span><span class="token double-colon punctuation">::</span><span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	HungrySingleton<span class="token operator">*</span> f4 <span class="token operator">=</span> <span class="token class-name">HungrySingleton</span><span class="token double-colon punctuation">::</span><span class="token function">getSingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>f3 <span class="token operator">==</span> f4<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"f3 和 f4 指向的内存地址相同"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"f3 和 f4 指向的内存地址不相同"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"main function ...."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token function">testHungrySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><code>编译命令</code>：g++ -std=c++11 singleton.cpp -o singleton<br> <code>打印输出</code>：<br> <img src="https://images2.imgbox.com/14/ba/XkeQsgCo_o.png" alt="在这里插入图片描述"><br> 懒汉式的特点：<br> 1.私有化构造函数和析构函数。<br> 2.定义一个单例对象的类类型指针的静态成员变量，并指向空地址。<br> 3.提供静态获取单例对象的函数<br> 饿汉式的特点：<br> 1.私有化构造函数和析构函数。<br> 2.定义一个单例对象的类类型指针的静态成员变量，并初始化为单例对象。<br> 3.提供静态获取单例对象的函数。</p> 
<p>两者的不同点：<br> 懒汉式 是在程序中首次需要时才进行单例对象的生成，生成的时期是在main函数执行后。<br> 饿汉式 是在程序加载时进行的静态成员变量的初始化生成的，生成的时期是在main函数执行前。<br> 懒汉式 是线性不安全的，而饿汉式是线程安全的。</p> 
<p>关于单例对象的内存释放问题：<br> 由于整个程序运行期间 都是公用这个类的一个实例对象。私有化析构函数的目的就是防止人为手动删除单例对象，以至于<br> 别人获取时出现失败。故而不提供公用的析构函数，那么堆内的这个单例对象，只有在程序结束时，由操作系统进行单例<br> 对象内存回收，不用担心会发生内存泄漏，因为这个类的实例对象 自始至终只有一份，占不了多大内存。因为内存泄漏的<br> 发生原因是指的堆中非单例对象，不断地创建新对象，程序不再使用时，也没有手动干预进行堆内存释放。导致日积月<br> 累，堆内存被占用完毕，进而发生堆内存泄漏。<br> 内存泄漏 只发生于 堆内存。这里所说的内存泄漏 都是指的堆内存泄漏。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3e19d40d1469693c584c3fa297066508/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python基础教程八（循环1）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6bff49cf1e234f2e6141fcd1be24b5c8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">编程笔记 html5&amp;css&amp;js 030 HTML音频</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>