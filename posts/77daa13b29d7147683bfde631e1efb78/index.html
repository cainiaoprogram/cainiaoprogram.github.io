<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Cesium学习笔记（2） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Cesium学习笔记（2）" />
<meta property="og:description" content="修改于2017.1.9
（1）坐标系转换
cesium中常用的坐标有两种WGS84地理坐标系和笛卡尔空间坐标系(世界坐标)。我们平时常用的以经纬度来指明一个地点就是用的WGS84坐标，笛卡尔空间坐标系常用来做一些空间位置变换如平移旋转缩放等等。二者的联系如下图, 笛卡尔空间坐标的原点就是椭球的中心.
Pick----屏幕坐标 Cartesian----世界坐标 cartographic-----地理坐标（弧度） Point----经纬度坐标 1.屏幕坐标转世界坐标 var pick= new Cesium.Cartesian2(window.innerWidth,window.innerHeight); var cartesian = scene.globe.pick(viewer.camera.getPickRay(pick), scene); 注：一共是两步
(在2D下上述方法不适用，改成：
var pick= new Cesium.Cartesian2(0,0); var cartesian = viewer.camera.pickEllipsoid(pick, viewer.scene.globe.ellipsoid); )
2.世界坐标转地理坐标（弧度） var cartographic = scene.globe.ellipsoid.cartesianToCartographic(cartesian); 或 var cartographic = Cesium.Cartographic.fromCartesian(cartesian); 3.世界坐标转屏幕坐标 var pick = Cesium.SceneTransforms.wgs84ToWindowCoordinates(viewer.scene, cartesian); 4.地理坐标（弧度）转经纬度坐标 var point=[ cartographic.longitude / Math.PI * 180, cartographic.latitude / Math.PI * 180]; 5.地理坐标（弧度）转世界坐标 var cartesian = scene.globe.ellipsoid. cartographicTo Cartesian (cartographic); 6.经纬度坐标转地理坐标（弧度） var cartographic = Cesium." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/77daa13b29d7147683bfde631e1efb78/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-09-11T12:12:40+08:00" />
<meta property="article:modified_time" content="2016-09-11T12:12:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Cesium学习笔记（2）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <pre><code class="language-html">
</code></pre> 
<p><span style="color:#ff0000">修改于2017.1.9</span></p> 
<p>（1）坐标系转换</p> 
<p>cesium中常用的坐标有两种WGS84地理坐标系和笛卡尔空间坐标系(世界坐标)。我们平时常用的以经纬度来指明一个地点就是用的WGS84坐标，笛卡尔空间坐标系常用来做一些空间位置变换如平移旋转缩放等等。二者的联系如下图, 笛卡尔空间坐标的原点就是椭球的中心.</p>   
<img src="https://images2.imgbox.com/8e/02/gRq0vI4Z_o.jpg" alt=""> 
<br> Pick----屏幕坐标   Cartesian----世界坐标  cartographic-----地理坐标（弧度） 
<br> Point----经纬度坐标 
<br> 1.屏幕坐标转世界坐标 
<br> var pick= new Cesium.Cartesian2(window.innerWidth,window.innerHeight); 
<br> var cartesian = scene.globe.pick(viewer.camera.getPickRay(pick), scene); 
<br> 
<p>注：一共是两步</p> 
<p>(在2D下上述方法不适用，改成：</p> 
<p></p> 
<pre style="background-color:#2b2b2b; color:#a9b7c6; font-family:'宋体'; font-size:10.5pt"><span style="color:#cc7832"><strong>var </strong></span>pick= <span style="color:#cc7832"><strong>new </strong></span>Cesium.<span style="color:#9876aa">Cartesian2</span>(<span style="color:#6897bb">0</span><span style="color:#cc7832">,</span><span style="color:#6897bb">0</span>)<span style="color:#cc7832">;
</span><span style="color:#cc7832"><strong>var </strong></span>cartesian = viewer.<span style="color:#9876aa">camera</span>.<span style="color:#ffc66d">pickEllipsoid</span>(pick<span style="color:#cc7832">, </span>viewer.<span style="color:#9876aa">scene</span>.<span style="color:#9876aa">globe</span>.<span style="color:#9876aa">ellipsoid</span>)<span style="color:#cc7832">;</span></pre> 
<br> 
<p></p> 
<p>)</p> 2.世界坐标转地理坐标（弧度） 
<br> var cartographic = scene.globe.ellipsoid.cartesianToCartographic(cartesian); 
<br> 或 
<br> var cartographic = Cesium.Cartographic.fromCartesian(cartesian); 
<br> 3.世界坐标转屏幕坐标 
<br> var pick = Cesium.SceneTransforms.wgs84ToWindowCoordinates(viewer.scene, cartesian); 
<br> 4.地理坐标（弧度）转经纬度坐标 
<br> var point=[ cartographic.longitude / Math.PI * 180, cartographic.latitude / Math.PI * 180]; 
<br> 5.地理坐标（弧度）转世界坐标 
<br> var  cartesian = scene.globe.ellipsoid. cartographicTo Cartesian (cartographic); 
<br> 6.经纬度坐标转地理坐标（弧度） 
<br> var cartographic = Cesium.Cartographic.fromDegree(point); 
<br> 7.经纬度坐标转世界坐标 
<br> var  cartesian  =  Cesium. Cartesian 3.fromDegree(point); 
<br> 
<br> 
<br> 
<br> 
<br> 
<br> 
<br> 
<br> 
<br> （2）事件 
<br> 1.相机事件（移动开始、移动结束等等） 
<br> viewer.scene.camera.moveEnd.addEventListener(function(){ 
<br> 
<span style="white-space:pre"></span> 
<br> })； 
<br> 2.鼠标事件（单击、移动、右键等） 
<br> var handler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas); 
<br> handler.setInputAction(function (movement) { 
<br> 
<span style="white-space:pre"></span> 
<br> }, Cesium.ScreenSpaceEventType.MOUSE_MOVE); 
<br> 3.渲染事件(实时渲染，很关键的一个事件) 
<br> var renderEnd = viewer.scene.postRender.addEventListener(function(){ 
<br> 
<br> 
<br> }); 
<br> 
<br> 
<br> 
<br> 
<br> 
<br> 
<br> (4)鼠标移到标牌上，提示信息(div)。 
<br> 首先根据上面提到的鼠标事件，new一个ScreenSpaceEventHandler，然后监听它的move。 
<br> 当鼠标移到标牌上时，利用pick方法获取鼠标下的entity， 
<br> var pick = viewer.scene.pick(movement.position); 
<br>   
<img src="https://images2.imgbox.com/f7/3a/7KHa4PrX_o.jpg" alt=""> 
<br> 作用：返回带有“primitive”属性的一个对象，这个primitive是在特定窗口坐标的第一个或是最上面的primitive；如果在这个位置上没有东西，就返回undefined。 
<br> 
<p>利用这个方法就可以判断鼠标下面是否有标牌，如果有，有create一个div或者令一个隐藏的div显示，移除时候再移除div或者设置div的display为none</p> 
<p></p> 
<pre><code class="language-html">var handler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);
        handler.setInputAction(function (movement) {
            var pick = viewer.scene.pick(movement.endPosition);
            if(!temp &amp;&amp; Cesium.defined(pick)){
                if(pick.mesh){
                    document.getElementById("modelName").textContent=pick.mesh._name;
                }else{
                    document.getElementById("modelName").textContent="Name";
                }
                var pos = getPos(event);
                document.getElementById("modelInfo").style.left = pos.x +"px";
                document.getElementById("modelInfo").style.top = pos.y +"px";
                document.getElementById("modelInfo").style.display = "block";
            }else{
                document.getElementById("modelInfo").style.display = "none";
            }
        }, Cesium.ScreenSpaceEventType.MOUSE_MOVE);</code></pre> 
<br> 
<p></p> 
<br> (5)鼠标点击标牌，提示信息(div)，并且信息能够一直随着物体移动。 
<br> 跟上一个差不许多，关键是解决如何能够随着物体一起移动。此时就需要postRender事件了。在这里需要提示一下，如果你的是22版本以上的，相机事件里面应该有个changed事件，利用这个也可以实现随物体一直移动的功能。    现在我就讲一下如果是低版本，相机里没有changed事件的话，就需要postRender事件了。 
<br> 用pick获取标牌实体后，里面会找他的一个世界坐标位置的属性，将此位置实时的定位到窗口坐标，即可实现div一直跟随标牌移动了。 
<br> 
<br> 
<br> 
<br>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/eaac15500ba24fdf2a5da05d78ad6307/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">白话空间统计番外四：轨迹特征分析实例  2016年9月9日 12:44</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7b5b44d4334e7cdcfe102f4414b31cae/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MongoDB分组</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>