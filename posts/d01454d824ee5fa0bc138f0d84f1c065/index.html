<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Part5-1-1 Nodejs 基础 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Part5-1-1 Nodejs 基础" />
<meta property="og:description" content="Nodejs 架构 Natives modules 当前层内容由 JS 实现。
提供应用程序可直接调用库，例如 fs、path、http等。
JS 语言无法直接操作底层硬件设置。需要通过桥梁：Builtin modules &#34;胶水层&#34; （由C&#43;&#43;编写）。
底层 V8：执行 JS 代码，提供桥梁接口。
Libuv: 事件循环、事件队列、异步IO
第三方模块：zlib、http、c-ares等。
Reactor模式 单线程完成多线程工作
实现异步IO、事件驱动
可以实现高并发处理
Nodejs 更适用于 IO 密集型高并发请求
Nodejs异步IO nodejs异步 IO 是 异步非阻塞 IO
立即返回的并不是业务层期望得到的数据，而仅仅是当前调用的状态，操作系统为了获取数据，就会让程序重复调用IO操作，判断 IO 是否结束，这种技术称为轮询。
常见轮询技术：read、select、poll、kqueue、event ports
期望实现无需主动判断的非阻塞 IO
1
异步 IO 总结 IO 是异步程序的瓶颈所在
异步 IO 提高性能无须采用原地等待结果返回
IO 操作属于操作系统级别，平台都有对应实现
Nodejs 单线程配合事件驱动架构及libuv实现了异步 IO
Nodejs 事件驱动架构 事件驱动架构是软件开发中的通用模式
事件驱动、发布订阅、观察者
主体发布消息，其他实例接收消息
const EventEmitter = require(&#39;events&#39;) const myEvent = new EventEmitter() myEvent." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/d01454d824ee5fa0bc138f0d84f1c065/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-30T15:33:56+08:00" />
<meta property="article:modified_time" content="2022-03-30T15:33:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Part5-1-1 Nodejs 基础</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>Nodejs 架构</h2> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/66/86/Up80Odle_o.png" width="1200"></p> 
<p></p> 
<h2>Natives modules</h2> 
<p>当前层内容由 JS 实现。</p> 
<p>提供应用程序可直接调用库，例如 fs、path、http等。</p> 
<p>JS 语言无法直接操作底层硬件设置。需要通过桥梁：Builtin modules "胶水层" （由C++编写）。</p> 
<p></p> 
<h2>底层</h2> 
<p>V8：执行 JS 代码，提供桥梁接口。</p> 
<p>Libuv: 事件循环、事件队列、异步IO</p> 
<p>第三方模块：zlib、http、c-ares等。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/29/f6/p4HHJNtt_o.png" width="1200"></p> 
<p></p> 
<h2>Reactor模式</h2> 
<p>单线程完成多线程工作</p> 
<p>实现异步IO、事件驱动</p> 
<p>可以实现高并发处理</p> 
<p>Nodejs 更适用于 IO 密集型高并发请求</p> 
<p></p> 
<h2>Nodejs异步IO</h2> 
<p>nodejs异步 IO 是 异步非阻塞 IO</p> 
<p>立即返回的并不是业务层期望得到的数据，而仅仅是当前调用的状态，操作系统为了获取数据，就会让程序重复调用IO操作，判断 IO 是否结束，这种技术称为轮询。</p> 
<p>常见轮询技术：read、select、poll、kqueue、event ports</p> 
<p>期望实现无需主动判断的非阻塞 IO</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/e5/23/12hGqK0l_o.png" width="1200"></p> 
<p> 1</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/39/ba/R0ZyNQ44_o.png" width="1200"></p> 
<p></p> 
<h2>异步 IO 总结</h2> 
<p>IO 是异步程序的瓶颈所在</p> 
<p>异步 IO 提高性能无须采用原地等待结果返回</p> 
<p>IO 操作属于操作系统级别，平台都有对应实现</p> 
<p>Nodejs 单线程配合事件驱动架构及libuv实现了异步 IO</p> 
<p></p> 
<h2>Nodejs 事件驱动架构</h2> 
<p>事件驱动架构是软件开发中的通用模式</p> 
<p>事件驱动、发布订阅、观察者</p> 
<p>主体发布消息，其他实例接收消息</p> 
<p></p> 
<pre><code>const EventEmitter = require('events')

const myEvent = new EventEmitter()

myEvent.on('事件1', () =&gt; {
  console.log('事件1执行了')
})

myEvent.on('事件1', () =&gt; {
  console.log('事件1-2执行了')
})

myEvent.emit('事件1')</code></pre> 
<p>输出：</p> 
<p><img alt="" height="91" src="https://images2.imgbox.com/c5/ef/IbSj88sq_o.png" width="806"></p> 
<p></p> 
<h2>Nodejs单线程</h2> 
<p>使用 JS 实现高效可伸缩的高性能 Web 服务</p> 
<p></p> 
<p><strong>单线程如何实现高并发？</strong></p> 
<p>异步非阻塞 IO 配合事件回调通知</p> 
<p>Nodejs 主线程是单线程</p> 
<p>libuv 库会维护一个线程池</p> 
<p><img alt="" height="1198" src="https://images2.imgbox.com/ba/b7/eQt2DTxj_o.png" width="1200"></p> 
<p> 1</p> 
<pre><code>const http = require('http')

function sleepTime (time) {
  const sleep = Date.now() + time * 1000
  while(Date.now() &lt; sleep) {}
  return 
}
sleepTime(4)
const server = http.createServer((req, res) =&gt; {
  res.end('server starting......')
})

server.listen(8080, () =&gt; {
  console.log('服务启动了')
})</code></pre> 
<p>4秒后服务启动</p> 
<p></p> 
<h2>Nodejs应用场景</h2> 
<p>IO 密集型高并发请求</p> 
<p>Nodejs作为中间层</p> 
<p><img alt="" height="876" src="https://images2.imgbox.com/43/0b/xvRtiVSA_o.png" width="1200"></p> 
<p>操作数据库提供 API 服务</p> 
<p>实时聊天应用程序</p> 
<p>Nodejs 更加适合 IO 密集型任务</p> 
<p></p> 
<h2>Nodejs实现API服务</h2> 
<pre><code>// 需求：希望有一个服务，可以依据请求的接口内容返回相应的数据
import express from 'express'
import { DataStore } from './data'

const app = express()

app.get('/', (req, res) =&gt; {
  // res.end('1122')
  res.json(DataStore.list)
})

app.listen(8081, () =&gt; {
  console.log('服务已经开启了')
})</code></pre> 
<p></p> 
<h2>Nodejs全局对象</h2> 
<p>与浏览器平台的 window 不完全相同</p> 
<p>Nodejs 全局对象上挂载许多属性</p> 
<p>全局对象是 JavaScript 中的特殊对象</p> 
<p>Node.js 中全局对象是 global</p> 
<p>Global 的根本作用就是作为宿主</p> 
<p>全局对象可以看做是全局变量的宿主</p> 
<p>默认情况 this 是空对象，和 global 并不是一样的</p> 
<p></p> 
<h2>Nodejs 常见全局变量</h2> 
<p>__filename：返回正在执行脚本文件的绝对路径</p> 
<p>__dirname：返回正在执行脚本所在目录</p> 
<p>timer类函数：执行顺序与事件循环间的关系</p> 
<p>process：提供与当前进程互动的接口</p> 
<p>require：实现模块的加载</p> 
<p>module、exports：处理模块的导出</p> 
<p></p> 
<h2>Nodejs 常见全局变量-process</h2> 
<p>获取进程信息</p> 
<p>执行进程操作</p> 
<pre><code>// 1 资源： cpu 内存
console.log(process.memoryUsage())  // 内存信息
/*
{
  rss: 24449024,        // 常驻内存
  heapTotal: 4481024,   // 脚本执行申请的内存总大小
  heapUsed: 2822984,    // 脚本执行过程中实际使用的内存大小
  external: 938610,     // 底层c++模块所占用的内存大小
  arrayBuffers: 9898    // Buffer 独立占用的缓冲区内存大小
}
*/


console.log(process.cpuUsage())  // cpu 信息
/*
{ 
  user: 31000,        // 用户执行过程中所占用的cpu时间片段
  system: 46000       // 操作系统所占用的cpu时间片段
}
*/


// 2 运行环境：运行目录、node环境、cpu架构、用户环境、系统平台
console.log(process.cwd())            // 当前工作目录
// D:\s\lagou\5\1\5-1-课程资料\Code\01Base


console.log(process.version)          // 当前node版本
//v14.18.1


console.log(process.versions)         // node 其他相关版本信息
/*
{
  node: '14.18.1',
  v8: '8.4.371.23-node.84',
  uv: '1.42.0',
  zlib: '1.2.11',
  brotli: '1.0.9',
  ares: '1.17.2',
  modules: '83',
  nghttp2: '1.42.0',
  napi: '8',
  llhttp: '2.1.4',
  openssl: '1.1.1l',
  cldr: '39.0',
  icu: '69.1',
  tz: '2021a',
  unicode: '13.0'
}
*/


console.log(process.arch)             // 本机操作系统信息
// x64


console.log(process.env.NODE_ENV)    // 获取当前环境，例如：dev、prod


console.log(process.env.PATH)        // 获取本机所配置的系统环境变量
/*
C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem;C:\Windows\System32\WindowsPowerShell\v1.0\;C:\Windows\System32\OpenSSH\;C:\Program Files (x86)\NVIDIA Corporation\PhysX\Common;C:\Program Files\NVIDIA Corporation\NVIDIA NvDLISR;C:\WINDOWS\system32;C:\WINDOWS;C:\WINDOWS\System32\Wbem;C:\WINDOWS\System32\WindowsPowerShell\v1.0\;C:\WINDOWS\System32\OpenSSH\;C:\Program Files\Git\cmd;C:\Program Files\nodejs\;D:\微信web开
发者工具\dll;C:\Users\zxy\AppData\Local\Microsoft\WindowsApps;C:\Users\zxy\AppData\Roaming\npm;C:\Users\zxy\AppData\Local\Programs\Microsoft VS Code\bin
*/


console.log(process.env.USERPROFILE)  // 获取本机的管理员目录 mac系统使用 process.env.HOME
// C:\Users\zxy


console.log(process.platform)         // 获取本机操作系统
// win32




// 3 运行状态： 启动参数、PID、运行时间
console.log(process.argv)  // 获取启动参数
/*
PS D:\s\lagou\5\1\5-1-课程资料\Code\01Base&gt; node .\05-process.js 1 2

[
  'C:\\Program Files\\nodejs\\node.exe',      // 当前Node启动程序的完整路径
  'D:\\s\\lagou\\5\\1\\5-1-课程资料\\Code\\01Base\\05-process.js',  // 当前进程文件的路径
  '1',
  '2'
]
*/


console.log(process.argv0)  // 获取启动参数 第一个参数，只提供了 argv0
// C:\\Program Files\\nodejs\\node.exe


console.log(process.pid)  // 获取当前进程的 pid
// 30024


setTimeout(() =&gt; {
  console.log(process.uptime())   // 记录从运行开始到运行结束所消耗的时间
  // 3.0328957
}, 3000)
</code></pre> 
<p></p> 
<h2>process 事件</h2> 
<pre><code>

// 事件
process.on('exit', code =&gt; {  // code: 退出的状态码
  console.log('exit', code)
  setTimeout(() =&gt; {
    console.log(123)  // 未打印，只支持同步代码
  }, 1000)
})

process.on('beforeExit', code =&gt; {  // code: 退出的状态码
  console.log('beforeExit', code)
})

console.log('代码执行完了')

/*
代码执行完了
beforeExit 0
exit 0
*/


process.exit()  // 直接退出，不会调用 beforeExit</code></pre> 
<p></p> 
<h2>process 标准输出，输入，错误</h2> 
<pre><code>// 标准输出，输入，错误
console.log = function(data) {
  process.stdout.write('---' + data + '\n')
}

console.log(11)
console.log(22)

/*
---11
---22
*/</code></pre> 
<p><strong>读取文件经过管道输出</strong></p> 
<pre><code>const fs = require('fs')
fs.createReadStream('text.txt')
  .pipe(process.stdout)

// 控制台输出文件里的内容</code></pre> 
<p><strong>控制台里输入内容 stdin</strong></p> 
<pre><code>process.stdin.pipe(process.stdout)</code></pre> 
<p></p> 
<p><strong>获取控制台输入内容事件 stdin</strong></p> 
<pre><code>process.stdin.setEncoding('utf-8')
process.stdin.on('readable', () =&gt; {
  let chunk = process.stdin.read()
  console.log(chunk)
})</code></pre> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p>1</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8587664f43994c6eb6050fb011be4b4f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何删除git config中的某一个配置项</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9c655271449f6cf061c30ca039f83fd5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">tensorflow2.4复现parnet网络模型实现猫狗分类</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>