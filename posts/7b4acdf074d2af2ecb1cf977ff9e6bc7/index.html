<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>关于mysql的mycat中间件安装配置与python使用mycat例子 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="关于mysql的mycat中间件安装配置与python使用mycat例子" />
<meta property="og:description" content="关于mysql的mycat中间件安装配置与python使用mycat例子 MyCAT是mysql中间件，Mycat数据库分库分表中间件国内最活跃的、性能最好的开源数据库中间件! 它是一款开源的Mysql企业级集群应用，前身是阿里大名鼎鼎的Cobar，Cobar在开源了一段时间后，不了了之。于是MyCAT扛起了这面大旗，在大数据时代，其重要性愈发彰显。
MyCAT提供了类似Mysql的接口，可以平滑的将单机Mysql迁移到Mysql集群上，解决数据存储和业务规模迅速增长情况下的数据瓶颈问题。
这篇文章主要是MyCAT的入门部署和python使用。
一，什么是mycat
一个彻底开源的，面向企业应用开发的大数据库集群
支持事务、ACID、可以替代MySQL的加强版数据库
一个可以视为MySQL集群的企业级数据库，用来替代昂贵的Oracle集群
一个融合内存缓存技术、NoSQL技术、HDFS大数据的新型SQL Server
结合传统数据库和新型分布式数据仓库的新一代企业级数据库产品
一个新颖的数据库中间件产品
以上是官方说明。其实就是数据库的连接池。mysql proxy也是一种连接池，但是效率很低。
二，mycat 安装
1，下载地址mycat
2，安装mycat
# tar zxvf Mycat-server-1.6-RELEASE-20161028204710-linux.tar.gz -C /usr/local/
我下载的是Mycat-server-1.5.1-RELEASE-20161130213509-linux.tar.gz
三，进行mycat配置的前提是已经配置好了，MySQL数据库主从架构，如下：
1、前提是已经配置了MySQL的主从关系，如下：
在192.168.1.120上MySQL命令行窗口，查看如下：
mysql&gt; show slave hosts;
&#43;-----------&#43;------&#43;------&#43;-----------&#43;--------------------------------------&#43;
| Server_id | Host | Port | Master_id | Slave_UUID |
&#43;-----------&#43;------&#43;------&#43;-----------&#43;--------------------------------------&#43;
| 121 | | 3306 | 120 | b8f1101c-9131-11e8-a9bd-000c294283ad |
| 122 | | 3306 | 120 | deb94f66-8cfa-11e8-a1f4-000c29accb8e |
| 130 | | 3306 | 120 | bab165c8-a093-11e8-93ba-000c29e026cb |" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/7b4acdf074d2af2ecb1cf977ff9e6bc7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-08-17T08:34:00+08:00" />
<meta property="article:modified_time" content="2018-08-17T08:34:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">关于mysql的mycat中间件安装配置与python使用mycat例子</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>关于mysql的mycat中间件安装配置与python使用mycat例子</h4> 
<p>MyCAT是mysql中间件，Mycat数据库分库分表中间件国内最活跃的、性能最好的开源数据库中间件! 它是一款开源的Mysql企业级集群应用，前身是阿里大名鼎鼎的Cobar，Cobar在开源了一段时间后，不了了之。于是MyCAT扛起了这面大旗，在大数据时代，其重要性愈发彰显。</p> 
<p>MyCAT提供了类似Mysql的接口，可以平滑的将单机Mysql迁移到Mysql集群上，解决数据存储和业务规模迅速增长情况下的数据瓶颈问题。<br> 这篇文章主要是MyCAT的入门部署和python使用。<br><strong>一，什么是mycat</strong></p> 
<p>一个彻底开源的，面向企业应用开发的大数据库集群</p> 
<p>支持事务、ACID、可以替代MySQL的加强版数据库</p> 
<p>一个可以视为MySQL集群的企业级数据库，用来替代昂贵的Oracle集群</p> 
<p>一个融合内存缓存技术、NoSQL技术、HDFS大数据的新型SQL Server</p> 
<p>结合传统数据库和新型分布式数据仓库的新一代企业级数据库产品</p> 
<p>一个新颖的数据库中间件产品</p> 
<p>以上是官方说明。其实就是数据库的连接池。mysql proxy也是一种连接池，但是效率很低。</p> 
<p><strong>二，mycat 安装</strong></p> 
<p>1，下载地址mycat</p> 
<p>2，安装mycat</p> 
<p># tar zxvf Mycat-server-1.6-RELEASE-20161028204710-linux.tar.gz -C /usr/local/</p> 
<p>我下载的是Mycat-server-1.5.1-RELEASE-20161130213509-linux.tar.gz</p> 
<p><strong>三，进行mycat配置的前提是已经配置好了，MySQL数据库主从架构，如下：</strong></p> 
<p>1、前提是已经配置了MySQL的主从关系，如下：</p> 
<p>在192.168.1.120上MySQL命令行窗口，查看如下：</p> 
<blockquote> 
 <p>mysql&gt; show slave hosts;<br> +-----------+------+------+-----------+--------------------------------------+<br> | Server_id | Host | Port | Master_id | Slave_UUID                           |<br> +-----------+------+------+-----------+--------------------------------------+<br> |       121 |      | 3306 |       120 | b8f1101c-9131-11e8-a9bd-000c294283ad |<br> |       122 |      | 3306 |       120 | deb94f66-8cfa-11e8-a1f4-000c29accb8e |<br> |       130 |      | 3306 |       120 | bab165c8-a093-11e8-93ba-000c29e026cb |<br> +-----------+------+------+-----------+--------------------------------------+<br> 3 rows in set (0.00 sec)</p> 
</blockquote> 
<blockquote> 
 <p>在192.168.1.130上MySQL命令行窗口，查看如下：<br> mysql&gt; show slave hosts;<br> +-----------+------+------+-----------+--------------------------------------+<br> | Server_id | Host | Port | Master_id | Slave_UUID                           |<br> +-----------+------+------+-----------+--------------------------------------+<br> |       120 |      | 3306 |       130 | c6e0ee48-90e9-11e8-8adb-000c29ba5130 |<br> |       131 |      | 3306 |       130 | ad97775c-a093-11e8-8ba8-000c295e5725 |<br> +-----------+------+------+-----------+--------------------------------------+<br> 2 rows in set (0.00 sec)</p> 
</blockquote> 
<p>最终架构为（以IP后一段称呼该主机）：</p> 
<p>120和130是互为主从<br> 120的从节点为121和122<br> 130的从节点是131</p> 
<p><strong>四，配置mycat</strong></p> 
<p>1，配置server.xml</p> 
<p># vim    /home/hadoop/software/mycat/conf/server.xml //添加以下内容</p> 
<blockquote> 
 <p>&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br> &lt;!-- - - Licensed under the Apache License, Version 2.0 (the "License"); <br>         - you may not use this file except in compliance with the License. - You <br>         may obtain a copy of the License at - - http://www.apache.org/licenses/LICENSE-2.0 <br>         - - Unless required by applicable law or agreed to in writing, software - <br>         distributed under the License is distributed on an "AS IS" BASIS, - WITHOUT <br>         WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. - See the <br>         License for the specific language governing permissions and - limitations <br>         under the License. --&gt;<br> &lt;!DOCTYPE mycat:server SYSTEM "server.dtd"&gt;<br> &lt;mycat:server xmlns:mycat="http://org.opencloudb/"&gt;<br>         &lt;system&gt;<br>         &lt;property name="defaultSqlParser"&gt;druidparser&lt;/property&gt;<br>       &lt;!--  &lt;property name="useCompression"&gt;1&lt;/property&gt;--&gt; &lt;!--1为开启mysql压缩协议--&gt;<br>         &lt;!-- &lt;property name="processorBufferChunk"&gt;40960&lt;/property&gt; --&gt;<br>         &lt;!-- <br>         &lt;property name="processors"&gt;1&lt;/property&gt; <br>         &lt;property name="processorExecutor"&gt;32&lt;/property&gt; <br>          --&gt;<br>                 &lt;!--默认是65535 64K 用于sql解析时最大文本长度 --&gt;<br>                 &lt;!--&lt;property name="maxStringLiteralLength"&gt;65535&lt;/property&gt;--&gt;<br>                 &lt;!--&lt;property name="sequnceHandlerType"&gt;0&lt;/property&gt;--&gt;<br>                 &lt;!--&lt;property name="backSocketNoDelay"&gt;1&lt;/property&gt;--&gt;<br>                 &lt;!--&lt;property name="frontSocketNoDelay"&gt;1&lt;/property&gt;--&gt;<br>                 &lt;!--&lt;property name="processorExecutor"&gt;16&lt;/property&gt;--&gt;<br>                 &lt;!-- <br>                         &lt;property name="mutiNodeLimitType"&gt;1&lt;/property&gt; 0：开启小数量级（默认） ；1：开启亿级数据排序<br>                 &lt;property name="mutiNodePatchSize"&gt;100&lt;/property&gt; 亿级数量排序批量<br>                         &lt;property name="processors"&gt;32&lt;/property&gt; &lt;property name="processorExecutor"&gt;32&lt;/property&gt; <br>                         &lt;property name="serverPort"&gt;8066&lt;/property&gt; &lt;property name="managerPort"&gt;9066&lt;/property&gt; <br>                         &lt;property name="idleTimeout"&gt;300000&lt;/property&gt; &lt;property name="bindIp"&gt;0.0.0.0&lt;/property&gt; <br>                         &lt;property name="frontWriteQueueSize"&gt;4096&lt;/property&gt; &lt;property name="processors"&gt;32&lt;/property&gt; --&gt;<br>         &lt;/system&gt;<br>         <br>         &lt;user name="root"&gt;  #//mycat用户名<br>                 &lt;property name="password"&gt;root&lt;/property&gt;   //mycat密码<br>                 &lt;property name="schemas"&gt;mstest&lt;/property&gt;   //mycat虚拟数据库名<br>                 &lt;property name="benchmark"&gt;10000&lt;/property&gt;   //benchmark:限制前端的整体连接数量，如果值是0表示不限制<br>         &lt;/user&gt;</p> 
 <p>        &lt;user name="user"&gt;<br>                 &lt;property name="password"&gt;user&lt;/property&gt;<br>                 &lt;property name="schemas"&gt;mstest&lt;/property&gt;<br>                 &lt;property name="readOnly"&gt;true&lt;/property&gt;  //只读<br>         &lt;/user&gt;<br>         &lt;!-- <br>         &lt;quarantine&gt; <br>            &lt;whitehost&gt;<br>               &lt;host host="127.0.0.1" user="mycat"/&gt;<br>               &lt;host host="127.0.0.2" user="mycat"/&gt;<br>            &lt;/whitehost&gt;<br>        &lt;blacklist check="false"&gt;&lt;/blacklist&gt;<br>         &lt;/quarantine&gt;<br>         --&gt;</p> 
 <p>&lt;/mycat:server&gt;<br>                       <br>                       <br> 在这里要注意，默认的虚拟数据名是TESTDB，如果schema.xml里面没有配置TESTDB，那就要把TESTDB改成schema.xml里面有的虚拟数据名。<br> 这里定义的用户名和密码，虚拟数据库名，并不是在mysql中真实存在的。</p> 
</blockquote> 
<p>2，配置schema.xml</p> 
<p># vim    /home/hadoop/software/mycat/conf/schema.xml //添加以下内容</p> 
<blockquote> 
 <p>&lt;?xml version="1.0"?&gt;<br> &lt;!DOCTYPE mycat:schema SYSTEM "schema.dtd"&gt;<br> &lt;mycat:schema xmlns:mycat="http://org.opencloudb/" &gt;</p> 
 <p>     &lt;schema name="mstest" checkSQLschema="false" sqlMaxLimit="100" dataNode="dn1"&gt;  &lt;/schema&gt;   //定义虚拟数据库名mytest</p> 
 <p>        &lt;dataNode name="dn1" dataHost="localhost1" database="test" /&gt;  //真实数据库名test</p> 
 <p>            &lt;dataHost name="localhost1" maxCon="1000" minCon="10" balance="0" writeType="0" dbType="mysql" dbDriver="native" switchType="1"  slaveThreshold="100"&gt;<br>                 &lt;heartbeat&gt;select user()&lt;/heartbeat&gt;<br>                 &lt;!-- can have multi write hosts --&gt;<br>                 &lt;writeHost host="hostM1" url="localhost:3306" user="root" password="xx@123456"&gt;    //真实数据库的连接方式<br>                         &lt;!-- can have multi read hosts --&gt;<br>                         &lt;readHost host="hostS2" url="192.168.1.121:3306" user="root" password="xx@123456" /&gt;   //同上<br>                         &lt;readHost host="hostS2" url="192.168.1.122:3306" user="root" password="xx@123456" /&gt;   //同上<br>                 &lt;/writeHost&gt;</p> 
 <p>                &lt;writeHost host="hostM2" url="192.168.1.130:3306" user="root" password="xx@123456"&gt;<br>                          &lt;!-- can have multi read hosts --&gt;<br>                         &lt;readHost host="hostM2S1" url="192.168.1.131:3306" user="root" password="xx@123456" /&gt;<br>                &lt;/writeHost&gt;   <br> &lt;/mycat:schema&gt;</p> 
</blockquote> 
<p>mycat的配置参数，相当的多。重点说一下 balance="1"与writeType="0"</p> 
<p>a. balance 属性负载均衡类型，目前的取值有 4 种：</p> 
<p>1. balance="0", 不开启读写分离机制，所有读操作都发送到当前可用的 writeHost 上。</p> 
<p>2. balance="1"，全部的 readHost 与 stand by writeHost 参与 select 语句的负载均衡，简单的说，当双主双从模式(M1 -&gt;S1 ， M2-&gt;S2，并且 M1 与 M2 互为主备)，正常情况下， M2,S1,S2 都参与 select 语句的负载均衡。</p> 
<p>3. balance="2"，所有读操作都随机的在 writeHost、 readhost 上分发。</p> 
<p>4. balance="3"， 所有读请求随机的分发到 wiriterHost 对应的 readhost 执行,writerHost 不负担读压力，注意 balance=3 只在 1.4 及其以后版本有， 1.3 没有。</p> 
<p>b. writeType 属性</p> 
<p>负载均衡类型，目前的取值有 3 种：</p> 
<p>1. writeType="0", 所有写操作发送到配置的第一个 writeHost，第一个挂了切到还生存的第二个</p> 
<p>writeHost，重新启动后已切换后的为准，切换记录在配置文件中:dnindex.properties .</p> 
<p>2. writeType="1"，所有写操作都随机的发送到配置的 writeHost。</p> 
<p>3. writeType="2"，没实现。</p> 
<p>具体参数：http://mycat.io/document/Mycat_V1.6.0.pdf</p> 
<p>3，配置主从服务器，就不在这儿说了，博客中有</p> 
<p>4，添加真实用户</p> 
<p>grant all privileges on test.* to root@"192.168.%" identified by 'xx@123456';<br> flush privileges</p> 
<p><br> 在120，130二台机器上添加用户。</p> 
<p>5，测试真实用户连接，确保schema.xml中配置的真实用户，能连上真实的数据库。注意防火墙。</p> 
<p><strong>五，启动mycat</strong></p> 
<p>1，常用参数<br> ./mycat start 启动<br> ./mycat stop 停止<br> ./mycat console 前台运行<br> ./mycat restart 重启服务<br> ./mycat pause 暂停<br> ./mycat status 查看启动状态</p> 
<p>2，启动，并查看mycat</p> 
<p># ./mycat start<br> Starting Mycat-server...<br>  <br> # netstat -tpnl |grep 8066<br> tcp 0 0 :::8066 :::* LISTEN 31728/java<br>  <br> # ./mycat status<br> Mycat-server is running (31726).<br><strong>六，测试读写分离</strong></p> 
<p># mysql -u root -p -P 8066 -h 127.0.0.1 //一定要带上127.0.0.1</p> 
<p><strong>七，小结</strong></p> 
<p>mycat支持 mysql的分表，分片等等，但是不建议使用。mycat支持的集群不多，如果能配合MHA使用就比较牛B了。</p> 
<p><br><strong>八、python通过中间件mycat操作mysql代码</strong></p> 
<blockquote> 
 <p>#!/usr/bin/python<br> # -*- coding: UTF-8 -*-<br> import MySQLdb</p> 
 <p><br> class MyCatClass(object):<br>     def __init__(self):<br>         # 打开数据库连接<br>         #用户名和密码失败塑造出无法访问<br>         # self.__conn_db = MySQLdb.connect("192.168.1.120", "work", "xx@123456", charset='utf8', port=3306, db='test')<br>         # 以下是成功写法<br>         # 方法一<br>         # self.__conn_db = MySQLdb.connect(user='root', passwd='root', host='192.168.1.120', port=8066,db='mstest',charset='utf8')<br>         # 方法二<br>         # self.__conn_db = MySQLdb.connect(user='user', passwd='user', host='192.168.1.120', port=8066, db='mstest', charset='utf8')<br>         # 方法三<br>         config = {<!-- --><br>             'host': '192.168.1.120',<br>             'port': 8066,<br>             'user': 'root',<br>             'passwd': 'root',<br>             'db': 'mstest',<br>             'charset': 'utf8'<br>         }<br>         self.__conn_db = MySQLdb.connect(**config)</p> 
 <p>        # 使用cursor()方法获取操作游标<br>         self.__cursor = self.__conn_db.cursor()</p> 
 <p>    # 使用execute方法执行SQL语句<br>     def excute_db(self,in_sql="SELECT VERSION()"):<br>         num=self.__cursor.execute(in_sql)<br>         if num&gt;0:<br>             data_list = self.__cursor.fetchall()<br>         return data_list</p> 
 <p>    def show_dataset(self):<br>         sql="select * from stu_info"<br>         data_list=self.excute_db(in_sql=sql)<br>         print data_list<br>         for each in data_list:<br>             print each<br>             for e in each:<br>                 print e<br>     def insert_data(self):<br>         sql_insert='''insert stu_info(name,age) values('0813',520)'''<br>         self.__cursor.execute(sql_insert)<br>         self.__conn_db.autocommit(True)<br>         # self.__conn_db.commit()</p> 
 <p>    def __del__(self):<br>         self.__cursor.close()</p> 
 <p><br> if __name__ == '__main__':<br>     obj_handle_mycat = MyCatClass()<br>     print obj_handle_mycat.excute_db()<br>     obj_handle_mycat.show_dataset()<br>     obj_handle_mycat.insert_data()<br>     obj_handle_mycat.show_dataset()</p> 
</blockquote> 
<p> 参考：http://www.php.cn/mysql-tutorials-363510.html<br>             https://www.jianshu.com/p/f15d64fcb2f3</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ed0dc701d87f2ac7e69f6807bf5ba82c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">IDEA创建类模板和方法模板（超详细）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7222cebaa4018059fa467ff640237b33/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">进程间通信---共享内存&amp;shmget</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>