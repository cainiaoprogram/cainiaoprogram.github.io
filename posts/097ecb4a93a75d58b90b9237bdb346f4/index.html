<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>LVM管理，扩容和挂载 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="LVM管理，扩容和挂载" />
<meta property="og:description" content="LVM管理 文章目录 LVM管理1. 基本概念2. LVM基本组成块2.1 物理卷Physical Volume(PV)：2.2 卷组Volume Group(VG)：2.3 逻辑卷Logical Volume(LV)：2.4 物理区域Physical Extent(PE)：2.5 逻辑区域Logical Extent(LE)： 3. 磁盘挂载3.1 查看磁盘信息3.2 磁盘初始化3.3 创建PV（物理卷）：3.4 创建 VG3.5 创建LV（逻辑卷）3.6 格式化LV3.7 挂载3.7.1 自动挂载 4. 磁盘扩容4.1 初始化磁盘创建PV4.2 PV加入VG4.3 扩容LV4.4 格式化 LV 1. 基本概念 LVM: Logical Volume Manager（逻辑卷管理），Linux环境下对磁盘分区进行管理的一种机制。Linux用户安装Linux操作系统时遇到的一个常见的难以决定的问题就是如何正确地评估各分区大小，以分配合适的硬盘空间。普通的磁盘分区管理方式在逻辑分区划分好之后就无法改变其大小，当一个逻辑分区存放不下某个文件时，这个文件因为受上层文件系统的限制，也不能跨越多个分区来存放，所以也不能同时放到别的磁盘上。而遇到出现某个分区空间耗尽时，解决的方法通常是使用符号链接，或者使用调整分区大小的工具，但这只是暂时解决办法，没有从根本上解决问题。随着Linux的逻辑卷管理功能的出现，这些问题都迎刃而解，用户在无需停机的情况下可以方便地调整各个分区大小。
2. LVM基本组成块 2.1 物理卷Physical Volume(PV)： 可以在上面建立卷组的媒介，可以是硬盘分区，也可以是硬盘本身或者回环文件 (loopback file)。物理卷包括一个特殊的header，其余部分被切割为一块块物理区域(physical extents)
2.2 卷组Volume Group(VG)： 由一个或多个物理卷PV组成。可以在卷组上创建一个或多个LV（逻辑卷）
2.3 逻辑卷Logical Volume(LV)： 虚拟分区，由物理区域（physical extents）组成
2.4 物理区域Physical Extent(PE)： 硬盘可供指派给逻辑卷的最小单位（通常为4MB）
2.5 逻辑区域Logical Extent(LE)： 跟PE一样，只不过站在LV的视角上是叫LE，而在VG的视角上则是叫PE，其本质是一样的
3. 磁盘挂载 使用vcenter给虚拟机增加磁盘，这里以添加200G举例
3.1 查看磁盘信息 # 查看文件系统情况 df -h fdisk -l 图中Disk /dev/sdb 为从Vcenter中添加的磁盘" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/097ecb4a93a75d58b90b9237bdb346f4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-01T21:42:26+08:00" />
<meta property="article:modified_time" content="2023-02-01T21:42:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">LVM管理，扩容和挂载</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="LVM_0"></a>LVM管理</h3> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#LVM_0" rel="nofollow">LVM管理</a></li><li><ul><li><a href="#1__2" rel="nofollow">1. 基本概念</a></li><li><a href="#2_LVM_7" rel="nofollow">2. LVM基本组成块</a></li><li><ul><li><a href="#21_Physical_VolumePV_8" rel="nofollow">2.1 物理卷Physical Volume(PV)：</a></li><li><a href="#22_Volume_GroupVG_11" rel="nofollow">2.2 卷组Volume Group(VG)：</a></li><li><a href="#23_Logical_VolumeLV_14" rel="nofollow">2.3 逻辑卷Logical Volume(LV)：</a></li><li><a href="#24_Physical_ExtentPE_17" rel="nofollow">2.4 物理区域Physical Extent(PE)：</a></li><li><a href="#25_Logical_ExtentLE_20" rel="nofollow">2.5 逻辑区域Logical Extent(LE)：</a></li></ul> 
    </li><li><a href="#3__23" rel="nofollow">3. 磁盘挂载</a></li><li><ul><li><a href="#31__26" rel="nofollow">3.1 查看磁盘信息</a></li><li><a href="#32__36" rel="nofollow">3.2 磁盘初始化</a></li><li><a href="#33_PV_84" rel="nofollow">3.3 创建PV（物理卷）：</a></li><li><a href="#34__VG_97" rel="nofollow">3.4 创建 VG</a></li><li><a href="#35_LV_113" rel="nofollow">3.5 创建LV（逻辑卷）</a></li><li><a href="#36_LV_127" rel="nofollow">3.6 格式化LV</a></li><li><a href="#37__136" rel="nofollow">3.7 挂载</a></li><li><ul><li><a href="#371__146" rel="nofollow">3.7.1 自动挂载</a></li></ul> 
    </li></ul> 
    </li><li><a href="#4__166" rel="nofollow">4. 磁盘扩容</a></li><li><ul><li><a href="#41_PV_168" rel="nofollow">4.1 初始化磁盘创建PV</a></li><li><a href="#42_PVVG_177" rel="nofollow">4.2 PV加入VG</a></li><li><a href="#43_LV_193" rel="nofollow">4.3 扩容LV</a></li><li><a href="#44__LV_210" rel="nofollow">4.4 格式化 LV</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h4><a id="1__2"></a>1. 基本概念</h4> 
<blockquote> 
 <p>LVM: Logical Volume Manager（逻辑卷管理），Linux环境下对磁盘分区进行管理的一种机制。Linux用户安装Linux操作系统时遇到的一个常见的难以决定的问题就是如何正确地评估各分区大小，以分配合适的硬盘空间。普通的磁盘分区管理方式在逻辑分区划分好之后就无法改变其大小，当一个逻辑分区存放不下某个文件时，这个文件因为受上层文件系统的限制，也不能跨越多个分区来存放，所以也不能同时放到别的磁盘上。而遇到出现某个分区空间耗尽时，解决的方法通常是使用符号链接，或者使用调整分区大小的工具，但这只是暂时解决办法，没有从根本上解决问题。随着Linux的逻辑卷管理功能的出现，这些问题都迎刃而解，用户在无需停机的情况下可以方便地调整各个分区大小。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/62/e8/UAeloDEL_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2_LVM_7"></a>2. LVM基本组成块</h4> 
<h5><a id="21_Physical_VolumePV_8"></a>2.1 物理卷Physical Volume(PV)：</h5> 
<blockquote> 
 <p>可以在上面建立卷组的媒介，可以是硬盘分区，也可以是硬盘本身或者回环文件 (loopback file)。物理卷包括一个特殊的header，其余部分被切割为一块块物理区域(physical extents)</p> 
</blockquote> 
<h5><a id="22_Volume_GroupVG_11"></a>2.2 卷组Volume Group(VG)：</h5> 
<blockquote> 
 <p>由一个或多个物理卷PV组成。可以在卷组上创建一个或多个LV（逻辑卷）</p> 
</blockquote> 
<h5><a id="23_Logical_VolumeLV_14"></a>2.3 逻辑卷Logical Volume(LV)：</h5> 
<blockquote> 
 <p>虚拟分区，由物理区域（physical extents）组成</p> 
</blockquote> 
<h5><a id="24_Physical_ExtentPE_17"></a>2.4 物理区域Physical Extent(PE)：</h5> 
<blockquote> 
 <p>硬盘可供指派给逻辑卷的最小单位（通常为4MB）</p> 
</blockquote> 
<h5><a id="25_Logical_ExtentLE_20"></a>2.5 逻辑区域Logical Extent(LE)：</h5> 
<blockquote> 
 <p>跟PE一样，只不过站在LV的视角上是叫LE，而在VG的视角上则是叫PE，其本质是一样的</p> 
</blockquote> 
<h4><a id="3__23"></a>3. 磁盘挂载</h4> 
<blockquote> 
 <p>使用vcenter给虚拟机增加磁盘，这里以添加200G举例</p> 
</blockquote> 
<h5><a id="31__26"></a>3.1 查看磁盘信息</h5> 
<pre><code># 查看文件系统情况
df -h
fdisk -l
</code></pre> 
<p><img src="https://images2.imgbox.com/d5/f6/bmCRDu74_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/5e/f9/Esr4NTzt_o.png" alt="在这里插入图片描述"><br> 图中Disk /dev/sdb 为从Vcenter中添加的磁盘</p> 
<h5><a id="32__36"></a>3.2 磁盘初始化</h5> 
<pre><code># 对指定磁盘进行初始化操作
fdisk /dev/sdb 
</code></pre> 
<p><img src="https://images2.imgbox.com/5d/46/SDrKhbsK_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/c6/5b/T7UjZi4j_o.png" alt="在这里插入图片描述"></p> 
<table><thead><tr><th align="left">参数</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">m</td><td align="left">显示菜单和帮助信息</td></tr><tr><td align="left">a</td><td align="left">活动分区标记/引导分区</td></tr><tr><td align="left">d</td><td align="left">删除分区</td></tr><tr><td align="left">l</td><td align="left">显示分区类型</td></tr><tr><td align="left">n</td><td align="left">新建分区</td></tr><tr><td align="left">p</td><td align="left">显示分区信息</td></tr><tr><td align="left">q</td><td align="left">退出不保存</td></tr><tr><td align="left">t</td><td align="left">设置分区号</td></tr><tr><td align="left">v</td><td align="left">进行分区检查</td></tr><tr><td align="left">w</td><td align="left">保存修改</td></tr><tr><td align="left">x</td><td align="left">扩展应用，高级功能</td></tr></tbody></table> 
<blockquote> 
 <ul><li>n，添加新分区</li><li>p创建为主分区，回车使用默认分区号，回车两次使用默认的起始扇区和最后扇区</li><li>这里可以看见设置的类型是Linux类型，大小实际上不足1GB。但是我的根分区是Linux LVM类型的，所以还需要一次转换。</li></ul> 
</blockquote> 
<p><img src="https://images2.imgbox.com/9a/7c/astGy4PO_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>继续输入t修改类型，如果不知道类型的16进制码，可以输入L查看，图中可看到Linux LVM的16进制编码为8e</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/5c/a0/znS7nMEd_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>输入16进制编码 8e,将类型修改为LinuxLVM，Linux与LinuxLVM区别在于LVM可以动态调整分区大小</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/19/37/G86WAwfu_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>此时输入w保存退出</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/43/db/4UHrKG8F_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>这个时候再输入fdisk -l，就可以看见创建的分区了。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/98/73/SGrlv2kw_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="33_PV_84"></a>3.3 创建PV（物理卷）：</h5> 
<pre><code>pvcreate /dev/sdb1
</code></pre> 
<p><img src="https://images2.imgbox.com/86/66/nOcfGqOb_o.png" alt="在这里插入图片描述"></p> 
<pre><code># 查看当前物理卷情况
pvdisplay
pvs
</code></pre> 
<p><img src="https://images2.imgbox.com/f5/9f/N3DGTZPY_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="34__VG_97"></a>3.4 创建 VG</h5> 
<blockquote> 
 <p>图中 PV Name /dev/sda2 为系统物理卷并且在VG centos里，现在创建的新物理卷名字为/dev/sdb1但还没有分配VG所以接下来创建VG（卷组）。<br> 创建VG（卷组）</p> 
</blockquote> 
<pre><code class="prism language-shell">vgcreate vg_data /dev/sdb1

输入vgcreate vg_data /dev/sdb1,意思是vgcreate vg名称 需要加入的PV
vg名称这里使用的是vg_你要挂载的目录，例如，我需要挂载/data目录下则为vg_data
</code></pre> 
<p><img src="https://images2.imgbox.com/dd/13/U7hkP6M3_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>可以输入vgdisplay或者vgs查看卷组情况：</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/d6/55/TBnWHzXR_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>可以看到有两个VG，vg_data是自己创建，并且包含一个PV，说明操作成功，但是如果需要挂在到目录上使用还需要使用LV（逻辑卷）</p> 
</blockquote> 
<h5><a id="35_LV_113"></a>3.5 创建LV（逻辑卷）</h5> 
<pre><code># 先查看已经创建的VG
vgdisplay /dev/vg_data
# 意思是 vgcreate 要显示的VG
# 其中的PE代表物理块，Total PE为所有物理块
</code></pre> 
<p><img src="https://images2.imgbox.com/8b/d1/o4QtC7Cx_o.png" alt="在这里插入图片描述"></p> 
<pre><code>lvcreate –n lv_data –l 51199 vg_data
# lvcreate –n lv_名称 –l 表示需要使用的物理块数值为上面的Total PE数值 ，后面加上所在的VG名称，便创建成功了。
</code></pre> 
<p><img src="https://images2.imgbox.com/95/d7/KD59FZEj_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="36_LV_127"></a>3.6 格式化LV</h5> 
<pre><code># 接下来对LV进行格式化，格式化成需要的格式 这里以ext4演示
mkfs.ext4 /dev/vg_data/lv_data 
# mkfs.需要的格式 需要格式化的LV位置
</code></pre> 
<p><img src="https://images2.imgbox.com/b4/e9/biAgWht1_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="37__136"></a>3.7 挂载</h5> 
<blockquote> 
 <p>在格式化成功后需要挂载到指定目录，先创建目录 /data并挂载LV到/data目录，语法为 mount 指定的LV 需要挂载的目录</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/b6/bd/KZatqMgf_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>在挂载继续查看文件系统情况输入：df –h 下图显示vg_data中的lv_data已经成功挂载到 /data 目录下</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/e9/13/zvy9Rkpd_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="371__146"></a>3.7.1 自动挂载</h6> 
<blockquote> 
 <p>将挂载信息写入系统文件这样可以在系统启动时自动挂载<br> 编辑/etc/fstab文件<br> vi /etc/fstab<br> 先输入lv的路径 挂载的目录 lv的格式 加载时的特定参数选项默认defaults 0 0</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/9e/1e/95kwC5p1_o.png" alt="在这里插入图片描述"></p> 
<p><strong>注意事项：</strong><br> <strong>1. 格式化命令写错。</strong><br> <code>例：dev/mapper/vg_data/lv_data /data etx4(这个单词是错的，应该是ext4)则会在登录时报错，同时xshell无法连接</code><br> <strong>2. 如路径写错。</strong><br> <code>例：如果在自动挂载文件 /etc/fstab 中将路径写成 /dev/mapper/vg_data/lv_data 则重启之后就会报错，会无法进入系统。应该将路径格式写为 /dev/mapper/vg_data-lv_data</code></p> 
<p><img src="https://images2.imgbox.com/d2/8f/atcqO1W6_o.png" alt="在这里插入图片描述"></p> 
<p><strong>重启后查看文件系统，已自动挂载</strong><br> <img src="https://images2.imgbox.com/62/7a/UeObDsIL_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="4__166"></a>4. 磁盘扩容</h4> 
<h5><a id="41_PV_168"></a>4.1 初始化磁盘创建PV</h5> 
<blockquote> 
 <p>以扩容VG centos下的/opt目录扩容20G为例（详见挂载部分）</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/96/61/AtegTv63_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>初始化，创建PV</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/42/ac/acS1v96m_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="42_PVVG_177"></a>4.2 PV加入VG</h5> 
<blockquote> 
 <p>将创建好的PV加入已有的VG即实现扩容<br> 查看当前已有VG：vgs或vgdisplay</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/d3/43/uN58Sy7Z_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>目前centos下有一个PV，使用vgextend命令进行扩容<br> vgextend centos /dev/sdc1<br> vgextend 扩容的VG名称 需要加入PV路径</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/12/d6/Pa1tLghh_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>再次使用查看已有VG：vgs</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/4d/70/lZ5xJ3bL_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>已经成功将PV加入VG centos</p> 
</blockquote> 
<h5><a id="43_LV_193"></a>4.3 扩容LV</h5> 
<blockquote> 
 <p>将加入的 PV 在 centos 中创建LV并格式化挂载对应目录即可（详见挂载部分）。<br> 注意在创建 LV 时 –l 的值需要查看 VG 里的 FreePE 的数值，因为 Free PE 才是后来加入进来的 PV。</p> 
</blockquote> 
<pre><code class="prism language-shell"><span class="token comment"># 这里是将 FREE 中所有的剩余空间全部使用扩容到 /dev/mapper/centos-root 根目录下</span>
<span class="token comment"># 可以通过命令 df -h 查看挂载路径，或者在 /etc/fstab 目录下查看</span>
lvextend <span class="token parameter variable">-l</span> +100%FREE /dev/mapper/centos-root

<span class="token comment"># 或者可以使用如下命令扩容大小</span>
lvextend <span class="token parameter variable">-L</span> +1G /dev/mapper/centos-root
</code></pre> 
<p><img src="https://images2.imgbox.com/90/47/fBhzAcrN_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="44__LV_210"></a>4.4 格式化 LV</h5> 
<pre><code class="prism language-shell">xfs_growfs /dev/mapper/centos-root 
注：
resize2fs命令            针对的是ext2、ext3、ext4文件系统
xfs_growfs命令         针对的是xfs文件系统
查看系统分区
<span class="token function">df</span> –T –h
</code></pre> 
<p><img src="https://images2.imgbox.com/cb/20/s3U65SBb_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6306563ea0387d191ba4893de107c22d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">shell 循环学习练习</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2deb8c2c2930ad06dfcc4b490db08c92/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">RabbitMq 消息确认机制详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>