<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>简单的京东爬虫 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="简单的京东爬虫" />
<meta property="og:description" content="京东爬虫 更新**爬虫代码****数据分析代码** 参考: Python爬虫：爬取京东商品简介. #!/usr/bin/env python # -*- coding:utf-8 -*- # @Time : 2021/8/6 import requests from bs4 import BeautifulSoup import xlwt import time class Config(): &#39;&#39;&#39; PARAMETER_LABEL：需要根据爬取的商品详情界面的信息key进行修改，其中&#39;评论数&#39;是另一种方式获取的 TITLE_LABEL：PARAMETER_LABEL修改后excel的表头也做相应的修改 GOOD_LABEL：无需修改，默认该四个信息都爬取 need_list：能直接从html解析后的标签文件中获取的 &#39;&#39;&#39; # excel表头 TITLE_LABEL = [&#39;商品名称&#39;, &#39;价格&#39;, &#39;商家&#39;, &#39;商品详情地址&#39;, &#39;工艺&#39;, &#39;图案&#39;, &#39;风格&#39;, &#39;材质&#39;, &#39;形状&#39;, &#39;直径&#39;, &#39;评论数&#39;] # html中对应TITLE_LABEL的key GOOD_LABEL = [&#39;name&#39;, &#39;price&#39;, &#39;shop&#39;, &#39;detail_addr&#39;] # TITLE_LABEL中商品详情页（即点进单个商品界面）想爬取的数据在html中key，&#39;评论数&#39;一定要放在最后 PARAMETER_LABEL = [&#39;工艺&#39;, &#39;图案&#39;, &#39;风格&#39;, &#39;材质&#39;, &#39;形状&#39;, &#39;直径&#39;, &#39;评论数&#39;] # 将PARAMETER_LABEL去掉&#39;评论数&#39;即为need_list need_list = PARAMETER_LABEL[:-1] # 将搜索页的key和单个商品详情页的key组合起来 TOTAL_LABEL = GOOD_LABEL &#43; PARAMETER_LABEL # excel文件的保存路径 SAVE_PATH = &#39;." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/385416c6c423d7b3f5f313671e615b62/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-08T10:09:22+08:00" />
<meta property="article:modified_time" content="2023-11-08T10:09:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">简单的京东爬虫</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>京东爬虫</h4> 
 <ul><li><ul><li><ul><li><a href="#_254" rel="nofollow">更新</a></li><li><ul><li><a href="#_255" rel="nofollow">**爬虫代码**</a></li><li><a href="#_576" rel="nofollow">**数据分析代码**</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<br> 参考: 
<a href="https://blog.csdn.net/qq_41799219/article/details/106203637">Python爬虫：爬取京东商品简介</a>. 
<p></p> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token comment"># @Time   : 2021/8/6</span>

<span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">import</span> xlwt
<span class="token keyword">import</span> time


<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    PARAMETER_LABEL：需要根据爬取的商品详情界面的信息key进行修改，其中'评论数'是另一种方式获取的
    TITLE_LABEL：PARAMETER_LABEL修改后excel的表头也做相应的修改
    GOOD_LABEL：无需修改，默认该四个信息都爬取
    need_list：能直接从html解析后的标签文件中获取的
    '''</span>
    <span class="token comment"># excel表头</span>
    TITLE_LABEL <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'商品名称'</span><span class="token punctuation">,</span> <span class="token string">'价格'</span><span class="token punctuation">,</span> <span class="token string">'商家'</span><span class="token punctuation">,</span> <span class="token string">'商品详情地址'</span><span class="token punctuation">,</span> <span class="token string">'工艺'</span><span class="token punctuation">,</span> <span class="token string">'图案'</span><span class="token punctuation">,</span> <span class="token string">'风格'</span><span class="token punctuation">,</span> <span class="token string">'材质'</span><span class="token punctuation">,</span> <span class="token string">'形状'</span><span class="token punctuation">,</span> <span class="token string">'直径'</span><span class="token punctuation">,</span> <span class="token string">'评论数'</span><span class="token punctuation">]</span>
    <span class="token comment"># html中对应TITLE_LABEL的key</span>
    GOOD_LABEL <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">,</span> <span class="token string">'shop'</span><span class="token punctuation">,</span> <span class="token string">'detail_addr'</span><span class="token punctuation">]</span>
    <span class="token comment"># TITLE_LABEL中商品详情页（即点进单个商品界面）想爬取的数据在html中key，'评论数'一定要放在最后</span>
    PARAMETER_LABEL <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'工艺'</span><span class="token punctuation">,</span> <span class="token string">'图案'</span><span class="token punctuation">,</span> <span class="token string">'风格'</span><span class="token punctuation">,</span> <span class="token string">'材质'</span><span class="token punctuation">,</span> <span class="token string">'形状'</span><span class="token punctuation">,</span> <span class="token string">'直径'</span><span class="token punctuation">,</span> <span class="token string">'评论数'</span><span class="token punctuation">]</span>
    <span class="token comment"># 将PARAMETER_LABEL去掉'评论数'即为need_list</span>
    need_list <span class="token operator">=</span> PARAMETER_LABEL<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token comment"># 将搜索页的key和单个商品详情页的key组合起来</span>
    TOTAL_LABEL <span class="token operator">=</span> GOOD_LABEL <span class="token operator">+</span> PARAMETER_LABEL
    <span class="token comment"># excel文件的保存路径</span>
    SAVE_PATH <span class="token operator">=</span> <span class="token string">'./test.xls'</span>

    <span class="token comment"># 发送访问请问的head文件</span>
    <span class="token comment"># 每个电脑每个京东账号对应的head文件不同，获取方式参考帖子https://blog.csdn.net/weixin_41998772/article/details/106476166</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'user-agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'</span><span class="token punctuation">,</span>
        <span class="token string">'accept-language'</span><span class="token punctuation">:</span> <span class="token string">'zh-CN,zh;q=0.9'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token comment"># 搜索关键字</span>
    keyword <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请输入需要爬取的信息关键字：'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    total <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请输入需要爬取页数: '</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Excel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 表格列数</span>
    TABLE_COL <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>Config<span class="token punctuation">.</span>TITLE_LABEL<span class="token punctuation">)</span>
    <span class="token comment"># 当前行数</span>
    _current_row <span class="token operator">=</span> <span class="token number">1</span>

    <span class="token comment"># 初始化，创建文件及写入title</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> sheet_name<span class="token operator">=</span><span class="token string">'sheet1'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>write_work <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Workbook<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">'ascii'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>write_sheet <span class="token operator">=</span> self<span class="token punctuation">.</span>write_work<span class="token punctuation">.</span>add_sheet<span class="token punctuation">(</span>sheet_name<span class="token punctuation">)</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>Config<span class="token punctuation">.</span>TITLE_LABEL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 第一行写入excel表头</span>
            self<span class="token punctuation">.</span>write_sheet<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> item<span class="token punctuation">,</span> label<span class="token operator">=</span>Config<span class="token punctuation">.</span>TITLE_LABEL<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># 写入内容</span>
    <span class="token keyword">def</span> <span class="token function">write_content</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
        <span class="token keyword">if</span> content<span class="token punctuation">[</span><span class="token string">'detail_addr'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'无'</span><span class="token punctuation">:</span>  <span class="token comment"># 有时候没能获取的该商品的详情地址就跳过该商品</span>
            <span class="token keyword">for</span> item <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>TABLE_COL<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>item <span class="token operator">==</span> self<span class="token punctuation">.</span>TABLE_COL <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span>Config<span class="token punctuation">.</span>TOTAL_LABEL<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'标题材质关键字'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>write_sheet<span class="token punctuation">.</span>write<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_current_row<span class="token punctuation">,</span> item<span class="token punctuation">,</span> label<span class="token operator">=</span>self<span class="token punctuation">.</span>title_extract<span class="token punctuation">(</span>content<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>write_sheet<span class="token punctuation">.</span>write<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_current_row<span class="token punctuation">,</span> item<span class="token punctuation">,</span> label<span class="token operator">=</span>content<span class="token punctuation">[</span>Config<span class="token punctuation">.</span>TOTAL_LABEL<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token comment"># 插入完一条记录后，换行</span>
            self<span class="token punctuation">.</span>_current_row <span class="token operator">+=</span> <span class="token number">1</span>

    <span class="token comment"># 保存文件</span>
    <span class="token keyword">def</span> <span class="token function">save_file</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> file_url<span class="token operator">=</span>Config<span class="token punctuation">.</span>SAVE_PATH<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>write_work<span class="token punctuation">.</span>save<span class="token punctuation">(</span>file_url<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"文件保存成功！文件路径为："</span> <span class="token operator">+</span> file_url<span class="token punctuation">)</span>
        <span class="token keyword">except</span> IOError<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"文件保存失败！"</span><span class="token punctuation">)</span>

    <span class="token comment"># 提取商品标题中的材质关键词</span>
    <span class="token keyword">def</span> <span class="token function">title_extract</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> title<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 想要提取的关键词列表</span>
        materials <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'陶瓷'</span><span class="token punctuation">,</span> <span class="token string">'骨瓷'</span><span class="token punctuation">,</span> <span class="token string">'玻璃'</span><span class="token punctuation">,</span> <span class="token string">'搪瓷'</span><span class="token punctuation">,</span> <span class="token string">'木制'</span><span class="token punctuation">,</span> <span class="token string">'木质'</span><span class="token punctuation">,</span> <span class="token string">'不锈钢'</span><span class="token punctuation">,</span> <span class="token string">'塑料'</span><span class="token punctuation">]</span>
        contain <span class="token operator">=</span> <span class="token string">''</span>
        count <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> material <span class="token keyword">in</span> materials<span class="token punctuation">:</span>
            <span class="token keyword">if</span> material <span class="token keyword">in</span> title<span class="token punctuation">:</span>
                <span class="token comment"># 将最后的输入形式为 “陶瓷、木质、不锈钢”</span>
                <span class="token keyword">if</span> count <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    contain <span class="token operator">=</span> contain <span class="token operator">+</span> material
                    count <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    contain <span class="token operator">=</span> contain <span class="token operator">+</span> <span class="token string">'、'</span> <span class="token operator">+</span> material
                    count <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">return</span> contain


<span class="token keyword">class</span> <span class="token class-name">Goods</span><span class="token punctuation">:</span>
    <span class="token comment"># 初始化方法</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> li_info<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>li_info <span class="token operator">=</span> li_info
        self<span class="token punctuation">.</span>good_info_dic <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">acquire_comment</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        input:
            url：商品详情地址(detail_addr)，形式如//item.jd.com/100007046969.html
        rerurn:
            comment_count：该商品的评论数,现在能爬取到的都是大约数，比如“2万+”,详细的评论总数京东暂时没显示在html信息中（2021.08.03）
        '''</span>
        <span class="token comment"># 提取商品详情地址中的商品号</span>
        no <span class="token operator">=</span> url<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'com/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.html'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        comment_url <span class="token operator">=</span> <span class="token string">"https://club.jd.com/comment/productPageComments.action?callback=fetchJSON_comment98&amp;productId="</span> <span class="token operator">+</span> no <span class="token operator">+</span> <span class="token string">"&amp;score=0&amp;sortType=5&amp;page=0&amp;pageSize=10&amp;isShadowSku=0&amp;fold=1"</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"评论数获取链接："</span><span class="token punctuation">,</span> comment_url<span class="token punctuation">)</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>comment_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>Config<span class="token punctuation">.</span>headers<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        page <span class="token operator">=</span> response<span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>
            <span class="token string">'gbk'</span><span class="token punctuation">)</span>  <span class="token comment"># type(page)为str，fetchJSON_comment98(dic),dic['productCommentSummary']['commentCountStr']为评论数</span>
        <span class="token comment"># "commentCountStr":"2万+", 获取其中的2万+，暂时想到的办法是用split和replace对字符串进行切分后再替换不需要的字符</span>
        comment_count <span class="token operator">=</span> page<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"commentCountStr"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'"'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> comment_count

    <span class="token keyword">def</span> <span class="token function">add_product_parameter</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> need_list<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span>
        html <span class="token operator">=</span> get_html<span class="token punctuation">(</span><span class="token string">'https:'</span> <span class="token operator">+</span> url<span class="token punctuation">)</span>
        soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">'lxml'</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token comment"># 获取商品参数</span>
        parameters <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> class_<span class="token operator">=</span><span class="token string">'parameter2 p-parameter-list'</span><span class="token punctuation">)</span>
        para_lists <span class="token operator">=</span> parameters<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span>
        name_lists <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        para_text_lists <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> para <span class="token keyword">in</span> para_lists<span class="token punctuation">:</span>
            para_text <span class="token operator">=</span> para<span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment">#print(para_text)</span>
            <span class="token comment"># para_text的形式：“商品名称：浩雅HY160”</span>
            name_lists<span class="token punctuation">.</span>append<span class="token punctuation">(</span>para_text<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"："</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># name_lists保存单个商品详情页参数名称，如“商品名称”</span>
            para_text_lists<span class="token punctuation">.</span>append<span class="token punctuation">(</span>para_text<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"："</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># para_text_lists保存参数名称对应的参数，如”浩雅HY160“</span>
        return_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment"># 按need_list中参数名称的顺序保存单个商品详情页中的爬虫数据</span>
        <span class="token keyword">for</span> need <span class="token keyword">in</span> need_list<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  <span class="token comment"># 评论数单独拎出来，need_list[-1]为“评论数”</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                index <span class="token operator">=</span> name_lists<span class="token punctuation">.</span>index<span class="token punctuation">(</span>need<span class="token punctuation">)</span>
                return_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>para_text_lists<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>
                <span class="token comment"># 如果该商品商家并没有显示该参数名称的参数，那么excel中填充空值</span>
                return_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>
        <span class="token comment"># 最后一列填充评论数</span>
        return_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>acquire_comment<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> return_list

    <span class="token keyword">def</span> <span class="token function">find_attr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attr<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> attr <span class="token operator">==</span> Config<span class="token punctuation">.</span>GOOD_LABEL<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token comment"># 商品名称</span>
                result <span class="token operator">=</span> self<span class="token punctuation">.</span>li_info<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'p-name p-name-type-2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'em'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> attr <span class="token operator">==</span> Config<span class="token punctuation">.</span>GOOD_LABEL<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token comment"># 价格</span>
                result <span class="token operator">=</span> self<span class="token punctuation">.</span>li_info<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'p-price'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'i'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> attr <span class="token operator">==</span> Config<span class="token punctuation">.</span>GOOD_LABEL<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token comment"># 商家</span>
                result <span class="token operator">=</span> self<span class="token punctuation">.</span>li_info<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'p-shop'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> attr <span class="token operator">==</span> Config<span class="token punctuation">.</span>GOOD_LABEL<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token comment"># 商品详情地址</span>
                result <span class="token operator">=</span> self<span class="token punctuation">.</span>li_info<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'p-name p-name-type-2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'href'</span><span class="token punctuation">]</span>

                <span class="token comment"># 进入单个商品详情网页进行数据爬取，本代码所说的单个商品详情网页意思为从搜索页点进某一个商品页，比如https://item.jd.com/100007046969.html</span>
                paras <span class="token operator">=</span> self<span class="token punctuation">.</span>add_product_parameter<span class="token punctuation">(</span>Config<span class="token punctuation">.</span>PARAMETER_LABEL<span class="token punctuation">,</span> result<span class="token punctuation">)</span>
                <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>paras<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    para <span class="token operator">=</span> paras<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                    self<span class="token punctuation">.</span>good_info_dic<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>Config<span class="token punctuation">.</span>PARAMETER_LABEL<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> para<span class="token punctuation">)</span>

        <span class="token keyword">except</span> AttributeError<span class="token punctuation">:</span>
            result <span class="token operator">=</span> <span class="token string">'无'</span>
        self<span class="token punctuation">.</span>good_info_dic<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>attr<span class="token punctuation">,</span> result<span class="token punctuation">)</span>  <span class="token comment"># 集合setdefault</span>

    <span class="token comment"># 添加商品信息</span>
    <span class="token keyword">def</span> <span class="token function">add_good_info</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> Config<span class="token punctuation">.</span>GOOD_LABEL<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>find_attr<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

    <span class="token comment"># 获取产品列表</span>
    <span class="token keyword">def</span> <span class="token function">get_good</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>good_info_dic


<span class="token keyword">def</span> <span class="token function">get_html</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> currentPage<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> pageSize<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> pageSize<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"--&gt; 正在获取网站第 "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>currentPage<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"页信息"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> currentPage <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
            url <span class="token operator">=</span> url <span class="token operator">+</span> <span class="token string">'&amp;page='</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>currentPage<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'&amp;s='</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'&amp;click=0'</span>

    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>Config<span class="token punctuation">.</span>headers<span class="token punctuation">)</span>  <span class="token comment"># 请求访问网站</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
        html <span class="token operator">=</span> response<span class="token punctuation">.</span>text  <span class="token comment"># 获取网页源码</span>
        <span class="token keyword">return</span> html  <span class="token comment"># 返回网页源码</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"获取网站信息失败！"</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    一定需要修改的是Config中的headers文件，每个电脑每个京东账号对应的文件不同
    修改完headers后可以输入关键词为“餐具碗”，页数“2”，查看下爬虫结果
    可根据自己的需求修改Config中的参数
    '''</span>
    <span class="token comment"># 创建文件</span>
    excel <span class="token operator">=</span> Excel<span class="token punctuation">(</span><span class="token punctuation">)</span>

    config <span class="token operator">=</span> Config<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 搜索地址</span>
    search_url <span class="token operator">=</span> <span class="token string">'https://search.jd.com/Search?keyword='</span> <span class="token operator">+</span> config<span class="token punctuation">.</span>keyword <span class="token operator">+</span> <span class="token string">'&amp;enc=utf-8&amp;psort=3'</span>
    page <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'total'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment"># 总页数</span>
        <span class="token string">'currentPage'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment"># 当前页数</span>
        <span class="token string">'pageSize'</span><span class="token punctuation">:</span> <span class="token number">0</span>  <span class="token comment"># 每页显示多少条</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token keyword">not</span> config<span class="token punctuation">.</span>total<span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"非法字符，程序退出！"</span><span class="token punctuation">)</span>
        exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

    page<span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">eval</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>total<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>page<span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 初始化BeautifulSoup库,并设置解析器</span>
        soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>get_html<span class="token punctuation">(</span>search_url<span class="token punctuation">,</span> page<span class="token punctuation">[</span><span class="token string">'currentPage'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> page<span class="token punctuation">[</span><span class="token string">'currentPage'</span><span class="token punctuation">]</span> <span class="token operator">*</span> page<span class="token punctuation">[</span><span class="token string">'pageSize'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'lxml'</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># 为了防止爬取太快被京东服务器拦截，在每次解析网页操作后强制休息2秒</span>

        <span class="token comment"># 商品列表</span>
        goods_list <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> class_<span class="token operator">=</span><span class="token string">'gl-item'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"分析到第"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>page<span class="token punctuation">[</span><span class="token string">'currentPage'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'页共有'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>goods_list<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'条商品信息'</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> li <span class="token keyword">in</span> goods_list<span class="token punctuation">:</span>  <span class="token comment"># 遍历父节点</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                goods <span class="token operator">=</span> Goods<span class="token punctuation">(</span>li<span class="token punctuation">)</span>
                <span class="token comment"># 添加信息</span>
                goods<span class="token punctuation">.</span>add_good_info<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment"># 获取信息</span>
                good_info <span class="token operator">=</span> goods<span class="token punctuation">.</span>get_good<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment"># 写入excel</span>
                excel<span class="token punctuation">.</span>write_content<span class="token punctuation">(</span>good_info<span class="token punctuation">)</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"商品信息获取失败"</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>

        page<span class="token punctuation">[</span><span class="token string">'currentPage'</span><span class="token punctuation">]</span> <span class="token operator">=</span> page<span class="token punctuation">[</span><span class="token string">'currentPage'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span>
        page<span class="token punctuation">[</span><span class="token string">'pageSize'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>goods_list<span class="token punctuation">)</span> <span class="token operator">*</span> page<span class="token punctuation">[</span><span class="token string">'currentPage'</span><span class="token punctuation">]</span>

    <span class="token comment"># 保存excel文件</span>
    excel<span class="token punctuation">.</span>save_file<span class="token punctuation">(</span>config<span class="token punctuation">.</span>SAVE_PATH<span class="token punctuation">)</span>

</code></pre> 
<p><strong>爬虫结果</strong><br> <img src="https://images2.imgbox.com/8a/7a/4PqCDHkc_o.jpg" alt="爬虫结果"></p> 
<h4><a id="_254"></a>更新</h4> 
<h5><a id="_255"></a><strong>爬虫代码</strong></h5> 
<p>下方例子可直接爬取“水杯”，并将每个商品的图片保存至本地。</p> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token comment"># @Time   : 2023/7/14</span>

<span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">import</span> xlwt
<span class="token keyword">import</span> time
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token keyword">from</span> tqdm <span class="token keyword">import</span> tqdm
<span class="token keyword">from</span> xlrd <span class="token keyword">import</span> open_workbook
<span class="token keyword">import</span> os


<span class="token keyword">class</span> <span class="token class-name">Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    PARAMETER_LABEL：需要根据爬取的商品详情界面的信息key进行修改，其中'评论数'是另一种方式获取的
    TITLE_LABEL：PARAMETER_LABEL修改后excel的表头也做相应的修改
    GOOD_LABEL：无需修改，默认该四个信息都爬取
    need_list：能直接从html解析后的标签文件中获取的
    '''</span>
    <span class="token comment"># excel表头</span>
    TITLE_LABEL <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'商品名称'</span><span class="token punctuation">,</span> <span class="token string">'价格'</span><span class="token punctuation">,</span> <span class="token string">'商家'</span><span class="token punctuation">,</span> <span class="token string">'商品详情地址'</span><span class="token punctuation">,</span> <span class="token string">'图片'</span><span class="token punctuation">,</span> <span class="token string">'商品毛重'</span><span class="token punctuation">,</span> <span class="token string">'商品产地'</span><span class="token punctuation">,</span> <span class="token string">'类别'</span><span class="token punctuation">,</span> <span class="token string">'容量'</span><span class="token punctuation">,</span> 
                   <span class="token string">'适用场景'</span><span class="token punctuation">,</span> <span class="token string">'附加组件'</span><span class="token punctuation">,</span> <span class="token string">'使用人群'</span><span class="token punctuation">,</span> <span class="token string">'国产/进口'</span><span class="token punctuation">,</span> <span class="token string">'是否带杯盖'</span><span class="token punctuation">,</span> <span class="token string">'材质'</span><span class="token punctuation">,</span> <span class="token string">'杯身材质'</span><span class="token punctuation">,</span> <span class="token string">'功能'</span><span class="token punctuation">,</span> <span class="token string">'评论数'</span><span class="token punctuation">]</span>
    <span class="token comment"># html中对应TITLE_LABEL的key</span>
    GOOD_LABEL <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">,</span> <span class="token string">'shop'</span><span class="token punctuation">,</span> <span class="token string">'detail_addr'</span><span class="token punctuation">,</span> <span class="token string">'image'</span><span class="token punctuation">]</span>
    <span class="token comment"># TITLE_LABEL中商品详情页（即点进单个商品界面）想爬取的数据在html中key，'评论数'一定要放在最后</span>
    PARAMETER_LABEL <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'商品毛重'</span><span class="token punctuation">,</span> <span class="token string">'商品产地'</span><span class="token punctuation">,</span> <span class="token string">'类别'</span><span class="token punctuation">,</span> <span class="token string">'容量'</span><span class="token punctuation">,</span> <span class="token string">'适用场景'</span><span class="token punctuation">,</span> <span class="token string">'附加组件'</span><span class="token punctuation">,</span> <span class="token string">'使用人群'</span><span class="token punctuation">,</span>
                        <span class="token string">'国产/进口'</span><span class="token punctuation">,</span> <span class="token string">'是否带杯盖'</span><span class="token punctuation">,</span> <span class="token string">'材质'</span><span class="token punctuation">,</span> <span class="token string">'杯身材质'</span><span class="token punctuation">,</span> <span class="token string">'功能'</span><span class="token punctuation">,</span><span class="token string">'评论数'</span><span class="token punctuation">]</span>
    <span class="token comment"># 将PARAMETER_LABEL去掉'评论数'即为need_list</span>
    need_list <span class="token operator">=</span> PARAMETER_LABEL<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token comment"># 将搜索页的key和单个商品详情页的key组合起来</span>
    TOTAL_LABEL <span class="token operator">=</span> GOOD_LABEL <span class="token operator">+</span> PARAMETER_LABEL
    <span class="token comment"># excel文件的保存路径</span>
    SAVE_PATH <span class="token operator">=</span> <span class="token string">'./cup.xls'</span>

    <span class="token comment"># 发送访问请问的head文件</span>
    <span class="token comment"># 每个电脑每个京东账号对应的head文件不同，获取方式参考帖子https://blog.csdn.net/weixin_41998772/article/details/106476166</span>
    <span class="token comment"># headers = {<!-- --></span>
    <span class="token comment">#     'user-agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.0.0 Safari/537.36',</span>
    <span class="token comment">#     'accept-language': 'zh-CN,zh;q=0.9',</span>
    <span class="token comment"># }</span>
    cookies <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'__jdv'</span><span class="token punctuation">:</span> <span class="token string">'76161171|direct|-|none|-|1689218894689'</span><span class="token punctuation">,</span>
    <span class="token string">'__jdu'</span><span class="token punctuation">:</span> <span class="token string">'16892188946541371543436'</span><span class="token punctuation">,</span>
    <span class="token string">'o2State'</span><span class="token punctuation">:</span> <span class="token string">'{%22webp%22:true%2C%22avif%22:true}'</span><span class="token punctuation">,</span>
    <span class="token string">'3AB9D23F7A4B3CSS'</span><span class="token punctuation">:</span> <span class="token string">'jdd03472A3YFKNZQJ6EHDPSBPDQPS5ROVPXBSHXUY7X2OWRYO46RKKBYNYOHUAY3CR2MOXIBWGG2JIS5IBWFFP4JD2MEX5AAAAAMJJVFN57QAAAAADBMKDMUMGW45EQX'</span><span class="token punctuation">,</span>
    <span class="token string">'_gia_d'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
    <span class="token string">'areaId'</span><span class="token punctuation">:</span> <span class="token string">'19'</span><span class="token punctuation">,</span>
    <span class="token string">'ipLoc-djd'</span><span class="token punctuation">:</span> <span class="token string">'19-1666-0-0'</span><span class="token punctuation">,</span>
    <span class="token string">'TrackID'</span><span class="token punctuation">:</span> <span class="token string">'1LzIjWPkPMVUu06CSqqrNzPmwcFyddXy6t1ne4YXMJCVo8dQEjnAlHhfjw1pha3W8qnq4StU3s2-zPrwHUFn5QggsGxXzckjoy4pLHt7nZOw'</span><span class="token punctuation">,</span>
    <span class="token string">'thor'</span><span class="token punctuation">:</span> <span class="token string">'C43F1D5C02A3907E5E5BCDF6D3F20655C53E49D06043DDDE00FE95C8EB5A1BBF18C322D774EDD238443476EDD046A1E62CE1321134F26021F7DD20D989169FA06631F27E73703C5BCE70FF4E2D50BDB35188EAB241F55688682F4F510C3ECDA92ACD564910586C2015691A9EFA9A8244E1565E4DB31E5597273AEE0BAD333A3C3A64CE7F64E1F871296382FD0DE1E105E8C6DC1BFC8807CD814151C769C0C03E'</span><span class="token punctuation">,</span>
    <span class="token string">'flash'</span><span class="token punctuation">:</span> <span class="token string">'2_OyX7GX17g3lKoYziO9BoOOllWmt4HoX-3_QG9cEOUSddVIQo5m0RrwLqu43vgb26KX1bLNKM5hJxKWrmF7bhbhZd7HBpjTqSG2gRfqhBYHj*'</span><span class="token punctuation">,</span>
    <span class="token string">'pinId'</span><span class="token punctuation">:</span> <span class="token string">'JiISwXIgw2P1QvVgGj2fKLV9-x-f3wj7'</span><span class="token punctuation">,</span>
    <span class="token string">'pin'</span><span class="token punctuation">:</span> <span class="token string">'jd_5800f4d8105f8'</span><span class="token punctuation">,</span>
    <span class="token string">'unick'</span><span class="token punctuation">:</span> <span class="token string">'%E5%93%92%E5%93%92%E7%9A%84%E5%B0%8F%E4%B8%80'</span><span class="token punctuation">,</span>
    <span class="token string">'ceshi3.com'</span><span class="token punctuation">:</span> <span class="token string">'000'</span><span class="token punctuation">,</span>
    <span class="token string">'_tp'</span><span class="token punctuation">:</span> <span class="token string">'qmQEay9GtiDAvdnmiflu2C2j1LKDR4y0lT1aSjFQodk%3D'</span><span class="token punctuation">,</span>
    <span class="token string">'_pst'</span><span class="token punctuation">:</span> <span class="token string">'jd_5800f4d8105f8'</span><span class="token punctuation">,</span>
    <span class="token string">'__jda'</span><span class="token punctuation">:</span> <span class="token string">'76161171.16892188946541371543436.1689218895.1689218895.1689218895.1'</span><span class="token punctuation">,</span>
    <span class="token string">'__jdb'</span><span class="token punctuation">:</span> <span class="token string">'76161171.4.16892188946541371543436|1.1689218895'</span><span class="token punctuation">,</span>
    <span class="token string">'__jdc'</span><span class="token punctuation">:</span> <span class="token string">'76161171'</span><span class="token punctuation">,</span>
    <span class="token string">'PCSYCityID'</span><span class="token punctuation">:</span> <span class="token string">'CN_440000_440600_0'</span><span class="token punctuation">,</span>
    <span class="token string">'shshshfpa'</span><span class="token punctuation">:</span> <span class="token string">'b4c2aab0-3952-f8c5-0e18-3ea14805d939-1689218920'</span><span class="token punctuation">,</span>
    <span class="token string">'shshshfpx'</span><span class="token punctuation">:</span> <span class="token string">'b4c2aab0-3952-f8c5-0e18-3ea14805d939-1689218920'</span><span class="token punctuation">,</span>
    <span class="token string">'shshshfpb'</span><span class="token punctuation">:</span> <span class="token string">'eiIZx9CpqJDcIP1YSZpIrOQ'</span><span class="token punctuation">,</span>
    <span class="token string">'3AB9D23F7A4B3C9B'</span><span class="token punctuation">:</span> <span class="token string">'472A3YFKNZQJ6EHDPSBPDQPS5ROVPXBSHXUY7X2OWRYO46RKKBYNYOHUAY3CR2MOXIBWGG2JIS5IBWFFP4JD2MEX5A'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'Accept'</span><span class="token punctuation">:</span> <span class="token string">'text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7'</span><span class="token punctuation">,</span>
        <span class="token string">'Accept-Language'</span><span class="token punctuation">:</span> <span class="token string">'zh-CN,zh;q=0.9'</span><span class="token punctuation">,</span>
        <span class="token string">'Cache-Control'</span><span class="token punctuation">:</span> <span class="token string">'max-age=0'</span><span class="token punctuation">,</span>
        <span class="token string">'Connection'</span><span class="token punctuation">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span>
        <span class="token comment"># 'Cookie': '__jdv=76161171|direct|-|none|-|1689218894689; __jdu=16892188946541371543436; o2State={%22webp%22:true%2C%22avif%22:true}; 3AB9D23F7A4B3CSS=jdd03472A3YFKNZQJ6EHDPSBPDQPS5ROVPXBSHXUY7X2OWRYO46RKKBYNYOHUAY3CR2MOXIBWGG2JIS5IBWFFP4JD2MEX5AAAAAMJJVFN57QAAAAADBMKDMUMGW45EQX; _gia_d=1; areaId=19; ipLoc-djd=19-1666-0-0; TrackID=1LzIjWPkPMVUu06CSqqrNzPmwcFyddXy6t1ne4YXMJCVo8dQEjnAlHhfjw1pha3W8qnq4StU3s2-zPrwHUFn5QggsGxXzckjoy4pLHt7nZOw; thor=C43F1D5C02A3907E5E5BCDF6D3F20655C53E49D06043DDDE00FE95C8EB5A1BBF18C322D774EDD238443476EDD046A1E62CE1321134F26021F7DD20D989169FA06631F27E73703C5BCE70FF4E2D50BDB35188EAB241F55688682F4F510C3ECDA92ACD564910586C2015691A9EFA9A8244E1565E4DB31E5597273AEE0BAD333A3C3A64CE7F64E1F871296382FD0DE1E105E8C6DC1BFC8807CD814151C769C0C03E; flash=2_OyX7GX17g3lKoYziO9BoOOllWmt4HoX-3_QG9cEOUSddVIQo5m0RrwLqu43vgb26KX1bLNKM5hJxKWrmF7bhbhZd7HBpjTqSG2gRfqhBYHj*; pinId=JiISwXIgw2P1QvVgGj2fKLV9-x-f3wj7; pin=jd_5800f4d8105f8; unick=%E5%93%92%E5%93%92%E7%9A%84%E5%B0%8F%E4%B8%80; ceshi3.com=000; _tp=qmQEay9GtiDAvdnmiflu2C2j1LKDR4y0lT1aSjFQodk%3D; _pst=jd_5800f4d8105f8; __jda=76161171.16892188946541371543436.1689218895.1689218895.1689218895.1; __jdb=76161171.4.16892188946541371543436|1.1689218895; __jdc=76161171; PCSYCityID=CN_440000_440600_0; shshshfpa=b4c2aab0-3952-f8c5-0e18-3ea14805d939-1689218920; shshshfpx=b4c2aab0-3952-f8c5-0e18-3ea14805d939-1689218920; shshshfpb=eiIZx9CpqJDcIP1YSZpIrOQ; 3AB9D23F7A4B3C9B=472A3YFKNZQJ6EHDPSBPDQPS5ROVPXBSHXUY7X2OWRYO46RKKBYNYOHUAY3CR2MOXIBWGG2JIS5IBWFFP4JD2MEX5A',</span>
        <span class="token string">'Referer'</span><span class="token punctuation">:</span> <span class="token string">'https://passport.jd.com/'</span><span class="token punctuation">,</span>
        <span class="token string">'Sec-Fetch-Dest'</span><span class="token punctuation">:</span> <span class="token string">'document'</span><span class="token punctuation">,</span>
        <span class="token string">'Sec-Fetch-Mode'</span><span class="token punctuation">:</span> <span class="token string">'navigate'</span><span class="token punctuation">,</span>
        <span class="token string">'Sec-Fetch-Site'</span><span class="token punctuation">:</span> <span class="token string">'same-site'</span><span class="token punctuation">,</span>
        <span class="token string">'Sec-Fetch-User'</span><span class="token punctuation">:</span> <span class="token string">'?1'</span><span class="token punctuation">,</span>
        <span class="token string">'Upgrade-Insecure-Requests'</span><span class="token punctuation">:</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
        <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36'</span><span class="token punctuation">,</span>
        <span class="token string">'sec-ch-ua'</span><span class="token punctuation">:</span> <span class="token string">'"Not.A/Brand";v="8", "Chromium";v="114", "Google Chrome";v="114"'</span><span class="token punctuation">,</span>
        <span class="token string">'sec-ch-ua-mobile'</span><span class="token punctuation">:</span> <span class="token string">'?0'</span><span class="token punctuation">,</span>
        <span class="token string">'sec-ch-ua-platform'</span><span class="token punctuation">:</span> <span class="token string">'"Windows"'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token comment"># 搜索关键字</span>
    keyword <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请输入需要爬取的信息关键字：'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    total <span class="token operator">=</span> <span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请输入需要爬取页数: '</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Excel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 表格列数</span>
    TABLE_COL <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>Config<span class="token punctuation">.</span>TITLE_LABEL<span class="token punctuation">)</span>
    <span class="token comment"># 当前行数</span>
    _current_row <span class="token operator">=</span> <span class="token number">1</span>

    <span class="token comment"># 初始化，创建文件及写入title</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> sheet_name<span class="token operator">=</span><span class="token string">'sheet1'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>Config<span class="token punctuation">.</span>SAVE_PATH<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 如果xls文件存在，则接着在表格后增加数据</span>
            book <span class="token operator">=</span> open_workbook<span class="token punctuation">(</span>Config<span class="token punctuation">.</span>SAVE_PATH<span class="token punctuation">,</span> formatting_info<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>write_work <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Workbook<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">'ascii'</span><span class="token punctuation">)</span>
            sheet <span class="token operator">=</span> book<span class="token punctuation">.</span>sheet_by_index<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>write_sheet <span class="token operator">=</span> self<span class="token punctuation">.</span>write_work<span class="token punctuation">.</span>add_sheet<span class="token punctuation">(</span>sheet_name<span class="token punctuation">)</span>
            <span class="token keyword">for</span> row <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>sheet<span class="token punctuation">.</span>nrows<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> col <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>sheet<span class="token punctuation">.</span>ncols<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>write_sheet<span class="token punctuation">.</span>write<span class="token punctuation">(</span>row<span class="token punctuation">,</span> col<span class="token punctuation">,</span> sheet<span class="token punctuation">.</span>cell<span class="token punctuation">(</span>row<span class="token punctuation">,</span> col<span class="token punctuation">)</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>_current_row <span class="token operator">=</span> sheet<span class="token punctuation">.</span>nrows
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>write_work <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Workbook<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">'ascii'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>write_sheet <span class="token operator">=</span> self<span class="token punctuation">.</span>write_work<span class="token punctuation">.</span>add_sheet<span class="token punctuation">(</span>sheet_name<span class="token punctuation">)</span>
            <span class="token keyword">for</span> item <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>Config<span class="token punctuation">.</span>TITLE_LABEL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># 第一行写入excel表头</span>
                self<span class="token punctuation">.</span>write_sheet<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> item<span class="token punctuation">,</span> label<span class="token operator">=</span>Config<span class="token punctuation">.</span>TITLE_LABEL<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># 写入内容</span>
    <span class="token keyword">def</span> <span class="token function">write_content</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
        <span class="token keyword">if</span> content<span class="token punctuation">[</span><span class="token string">'detail_addr'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'无'</span><span class="token punctuation">:</span>  <span class="token comment"># 有时候没能获取的该商品的详情地址就跳过该商品</span>
            <span class="token keyword">for</span> item <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>TABLE_COL<span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>write_sheet<span class="token punctuation">.</span>write<span class="token punctuation">(</span>self<span class="token punctuation">.</span>_current_row<span class="token punctuation">,</span> item<span class="token punctuation">,</span> label<span class="token operator">=</span>content<span class="token punctuation">[</span>Config<span class="token punctuation">.</span>TOTAL_LABEL<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token comment"># 插入完一条记录后，换行</span>
            self<span class="token punctuation">.</span>_current_row <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token comment"># 每新增一条信息后进行保存，以备中途出问题文件未及时保存</span>
            excel<span class="token punctuation">.</span>save_file<span class="token punctuation">(</span>config<span class="token punctuation">.</span>SAVE_PATH<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"商品详细地址未获取！"</span><span class="token punctuation">)</span>

    <span class="token comment"># 保存文件</span>
    <span class="token keyword">def</span> <span class="token function">save_file</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> file_url<span class="token operator">=</span>Config<span class="token punctuation">.</span>SAVE_PATH<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>write_work<span class="token punctuation">.</span>save<span class="token punctuation">(</span>file_url<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"文件保存成功！文件路径为："</span> <span class="token operator">+</span> file_url<span class="token punctuation">)</span>
        <span class="token keyword">except</span> IOError<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"文件保存失败！"</span><span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Goods</span><span class="token punctuation">:</span>
    <span class="token comment"># 初始化方法</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> li_info<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>li_info <span class="token operator">=</span> li_info
        self<span class="token punctuation">.</span>good_info_dic <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">acquire_comment</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        input:
            url：商品详情地址(detail_addr)，形式如//item.jd.com/100007046969.html
        rerurn:
            comment_count：该商品的评论数,现在能爬取到的都是大约数，比如“2万+”,详细的评论总数京东暂时没显示在html信息中（2021.08.03）
        '''</span>
        <span class="token comment"># 提取商品详情地址中的商品号</span>
        no <span class="token operator">=</span> url<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'com/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.html'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        comment_url <span class="token operator">=</span> <span class="token string">"https://club.jd.com/comment/productPageComments.action?callback=fetchJSON_comment98&amp;productId="</span> <span class="token operator">+</span> no <span class="token operator">+</span> <span class="token string">"&amp;score=0&amp;sortType=5&amp;page=0&amp;pageSize=10&amp;isShadowSku=0&amp;fold=1"</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>comment_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>Config<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> cookies<span class="token operator">=</span>Config<span class="token punctuation">.</span>cookies<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
        response<span class="token punctuation">.</span>encoding <span class="token operator">=</span> response<span class="token punctuation">.</span>apparent_encoding
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"获取评论页格式："</span><span class="token punctuation">,</span>response<span class="token punctuation">.</span>encoding<span class="token punctuation">)</span>
        response<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> response<span class="token punctuation">.</span>encoding <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">"获取失败"</span>
        page <span class="token operator">=</span> response<span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span>response<span class="token punctuation">.</span>encoding<span class="token punctuation">)</span>  <span class="token comment"># type(page)为str，fetchJSON_comment98(dic),dic['productCommentSummary']['commentCountStr']为评论数</span>
        <span class="token comment"># "commentCountStr":"2万+", 获取其中的2万+，暂时想到的办法是用split和replace对字符串进行切分后再替换不需要的字符</span>
        comment_count <span class="token operator">=</span> page<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"commentCountStr"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'"'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
        response<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 如果不及时关闭，会报错</span>
        <span class="token keyword">return</span> comment_count

    <span class="token keyword">def</span> <span class="token function">add_product_parameter</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> need_list<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span>
        html <span class="token operator">=</span> get_html<span class="token punctuation">(</span><span class="token string">'https:'</span> <span class="token operator">+</span> url<span class="token punctuation">)</span>
        <span class="token comment"># print("商品详情信息：", html)</span>
        soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token comment"># 获取商品参数</span>
        parameters <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">,</span> class_<span class="token operator">=</span><span class="token string">'parameter2 p-parameter-list'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> parameters <span class="token operator">==</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            <span class="token comment"># 如果这里报错，并显示解析得到的网页信息为&lt;title&gt;京东安全&lt;/title&gt;</span>
            <span class="token comment"># 那就是京东检测到爬虫启动了安全机制，把代码中time.sleep数再增大</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"------------------"</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"------------------"</span><span class="token punctuation">)</span>
        para_lists <span class="token operator">=</span> parameters<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span>
        name_lists <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        para_text_lists <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> para <span class="token keyword">in</span> para_lists<span class="token punctuation">:</span>
            para_text <span class="token operator">=</span> para<span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># print(para_text)</span>
            <span class="token comment"># para_text的形式：“商品名称：浩雅HY160”</span>
            name_lists<span class="token punctuation">.</span>append<span class="token punctuation">(</span>para_text<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"："</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># name_lists保存单个商品详情页参数名称，如“商品名称”</span>
            para_text_lists<span class="token punctuation">.</span>append<span class="token punctuation">(</span>para_text<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"："</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># para_text_lists保存参数名称对应的参数，如”浩雅HY160“</span>
        return_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment"># 按need_list中参数名称的顺序保存单个商品详情页中的爬虫数据</span>
        <span class="token keyword">for</span> need <span class="token keyword">in</span> need_list<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>  <span class="token comment"># 评论数单独拎出来，need_list[-1]为“评论数”</span>
            <span class="token keyword">if</span> need <span class="token keyword">in</span> name_lists<span class="token punctuation">:</span>
                index <span class="token operator">=</span> name_lists<span class="token punctuation">.</span>index<span class="token punctuation">(</span>need<span class="token punctuation">)</span>
                return_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>para_text_lists<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                return_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>
        <span class="token comment"># 最后一列填充评论数</span>
        return_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>self<span class="token punctuation">.</span>acquire_comment<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> return_list

    <span class="token keyword">def</span> <span class="token function">find_attr</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> attr<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> attr <span class="token operator">==</span> Config<span class="token punctuation">.</span>GOOD_LABEL<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token comment"># 商品名称</span>
                result <span class="token operator">=</span> self<span class="token punctuation">.</span>li_info<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'p-name p-name-type-2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'em'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> attr <span class="token operator">==</span> Config<span class="token punctuation">.</span>GOOD_LABEL<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token comment"># 价格</span>
                result <span class="token operator">=</span> self<span class="token punctuation">.</span>li_info<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'p-price'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'i'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> attr <span class="token operator">==</span> Config<span class="token punctuation">.</span>GOOD_LABEL<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token comment"># 商家</span>
                result <span class="token operator">=</span> self<span class="token punctuation">.</span>li_info<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'p-shop'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">elif</span> attr <span class="token operator">==</span> Config<span class="token punctuation">.</span>GOOD_LABEL<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token comment"># 图片</span>
                temp <span class="token operator">=</span> self<span class="token punctuation">.</span>li_info<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'p-img'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'data-lazy-img'</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"图片原地址："</span><span class="token punctuation">,</span>temp<span class="token punctuation">)</span>
                result <span class="token operator">=</span> <span class="token string">"./cups/"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>excel<span class="token punctuation">.</span>_current_row<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".jpg"</span>
                imageurl <span class="token operator">=</span> <span class="token string">"http:"</span> <span class="token operator">+</span> temp
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlretrieve<span class="token punctuation">(</span>imageurl<span class="token punctuation">,</span>filename<span class="token operator">=</span>result<span class="token punctuation">)</span>
                <span class="token keyword">except</span><span class="token punctuation">:</span>
                    result <span class="token operator">=</span> <span class="token string">"保存失败"</span>
            <span class="token keyword">elif</span> attr <span class="token operator">==</span> Config<span class="token punctuation">.</span>GOOD_LABEL<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    <span class="token comment"># 商品详情地址</span>
                    result <span class="token operator">=</span> self<span class="token punctuation">.</span>li_info<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'p-name p-name-type-2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'href'</span><span class="token punctuation">]</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"商品详情信息："</span><span class="token punctuation">,</span>result<span class="token punctuation">)</span>
                    <span class="token comment"># 进入单个商品详情网页进行数据爬取，本代码所说的单个商品详情网页意思为从搜索页点进某一个商品页，比如https://item.jd.com/100007046969.html</span>
                    paras <span class="token operator">=</span> self<span class="token punctuation">.</span>add_product_parameter<span class="token punctuation">(</span>Config<span class="token punctuation">.</span>PARAMETER_LABEL<span class="token punctuation">,</span> result<span class="token punctuation">)</span>
                    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>paras<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        para <span class="token operator">=</span> paras<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                        self<span class="token punctuation">.</span>good_info_dic<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>Config<span class="token punctuation">.</span>PARAMETER_LABEL<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> para<span class="token punctuation">)</span>
                <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\033[42m Error:{} \033[0m"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
            
        <span class="token keyword">except</span> AttributeError<span class="token punctuation">:</span>
            result <span class="token operator">=</span> <span class="token string">'无'</span>
        self<span class="token punctuation">.</span>good_info_dic<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>attr<span class="token punctuation">,</span> result<span class="token punctuation">)</span>  <span class="token comment"># 集合setdefault</span>

    <span class="token comment"># 添加商品信息</span>
    <span class="token keyword">def</span> <span class="token function">add_good_info</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> Config<span class="token punctuation">.</span>GOOD_LABEL<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>find_attr<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

    <span class="token comment"># 获取产品列表</span>
    <span class="token keyword">def</span> <span class="token function">get_good</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>good_info_dic


<span class="token keyword">def</span> <span class="token function">get_html</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> currentPage<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> pageSize<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> pageSize<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"--&gt; 正在获取网站第 "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>currentPage<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"页信息"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> currentPage <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">:</span>
            url <span class="token operator">=</span> url <span class="token operator">+</span> <span class="token string">'&amp;page='</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>currentPage<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'&amp;s='</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'&amp;click=0'</span>

    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>Config<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> cookies<span class="token operator">=</span>Config<span class="token punctuation">.</span>cookies<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span>  <span class="token comment"># 请求访问网站</span>
    response<span class="token punctuation">.</span>encoding <span class="token operator">=</span> response<span class="token punctuation">.</span>apparent_encoding
    response<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span>
        html <span class="token operator">=</span> response<span class="token punctuation">.</span>text  <span class="token comment"># 获取网页源码</span>
        response<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> html  <span class="token comment"># 返回网页源码</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        response<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"获取网站信息失败！"</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    一定需要修改的是Config中的headers文件，每个电脑每个京东账号对应的文件不同
    修改完headers后可以输入关键词为“家用水杯办公”，页数“2”，查看下爬虫结果
    可根据自己的需求修改Config中的参数
    '''</span>
    <span class="token comment"># 创建文件</span>
    excel <span class="token operator">=</span> Excel<span class="token punctuation">(</span><span class="token punctuation">)</span>

    config <span class="token operator">=</span> Config<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 搜索地址</span>
    search_url <span class="token operator">=</span> <span class="token string">'https://search.jd.com/Search?keyword='</span> <span class="token operator">+</span> config<span class="token punctuation">.</span>keyword <span class="token operator">+</span> <span class="token string">'&amp;enc=utf-8&amp;psort=3'</span>
    page <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'total'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>  <span class="token comment"># 总页数</span>
        <span class="token string">'currentPage'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment"># 当前页数</span>
        <span class="token string">'pageSize'</span><span class="token punctuation">:</span> <span class="token number">0</span>  <span class="token comment"># 每页显示多少条</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token keyword">not</span> config<span class="token punctuation">.</span>total<span class="token punctuation">.</span>isdigit<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"非法字符，程序退出！"</span><span class="token punctuation">)</span>
        exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

    page<span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">eval</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>total<span class="token punctuation">)</span> <span class="token operator">-</span> page<span class="token punctuation">[</span><span class="token string">'currentPage'</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> tqdm<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span>page<span class="token punctuation">[</span><span class="token string">'total'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 初始化BeautifulSoup库,并设置解析器</span>
        soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>get_html<span class="token punctuation">(</span>search_url<span class="token punctuation">,</span> page<span class="token punctuation">[</span><span class="token string">'currentPage'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> page<span class="token punctuation">[</span><span class="token string">'currentPage'</span><span class="token punctuation">]</span> <span class="token operator">*</span> page<span class="token punctuation">[</span><span class="token string">'pageSize'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'lxml'</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment"># 为了防止爬取太快被京东服务器拦截，在每次解析网页操作后强制休息2秒</span>

        <span class="token comment"># 商品列表</span>
        goods_list <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">,</span> class_<span class="token operator">=</span><span class="token string">'gl-item'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"分析到第"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>page<span class="token punctuation">[</span><span class="token string">'currentPage'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'页共有'</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>goods_list<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'条商品信息'</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> li <span class="token keyword">in</span> goods_list<span class="token punctuation">:</span>  <span class="token comment"># 遍历父节点</span>
            <span class="token comment"># 有问题的时候把这里的try给注释掉</span>
            <span class="token keyword">try</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"----------------------------------------------------------------------"</span><span class="token punctuation">)</span>
                goods <span class="token operator">=</span> Goods<span class="token punctuation">(</span>li<span class="token punctuation">)</span>
                <span class="token comment"># 添加信息</span>
                goods<span class="token punctuation">.</span>add_good_info<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment"># 获取信息</span>
                good_info <span class="token operator">=</span> goods<span class="token punctuation">.</span>get_good<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment"># 写入excel</span>
                excel<span class="token punctuation">.</span>write_content<span class="token punctuation">(</span>good_info<span class="token punctuation">)</span>
            <span class="token keyword">except</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"商品信息获取失败"</span><span class="token punctuation">)</span>
                <span class="token keyword">break</span>

        page<span class="token punctuation">[</span><span class="token string">'currentPage'</span><span class="token punctuation">]</span> <span class="token operator">=</span> page<span class="token punctuation">[</span><span class="token string">'currentPage'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span>
        page<span class="token punctuation">[</span><span class="token string">'pageSize'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>goods_list<span class="token punctuation">)</span> <span class="token operator">*</span> page<span class="token punctuation">[</span><span class="token string">'currentPage'</span><span class="token punctuation">]</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/0a/96/OAbtDHlZ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/65/08/pLoAfWV4_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_576"></a><strong>数据分析代码</strong></h5> 
<p>使用jupyter编写，可视化库使用pyecharts，官方网址：<a href="https://pyecharts.org/#/zh-cn/intro" rel="nofollow">https://pyecharts.org/#/zh-cn/intro</a></p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> pyecharts<span class="token punctuation">.</span>charts <span class="token keyword">import</span> Bar<span class="token punctuation">,</span> Pie
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> pyecharts<span class="token punctuation">.</span>options <span class="token keyword">as</span> opts
<span class="token keyword">from</span> pyecharts<span class="token punctuation">.</span><span class="token builtin">globals</span> <span class="token keyword">import</span> ThemeType
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
</code></pre> 
<ul><li>对水杯材质可视化</li></ul> 
<pre><code class="prism language-python">df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_excel<span class="token punctuation">(</span><span class="token string">"./cup.xls"</span><span class="token punctuation">)</span>
<span class="token comment"># 有些商品挂了多个链接，先筛掉重复地址的商品</span>
df<span class="token punctuation">.</span>drop_duplicates<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'商品详情地址'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> keep<span class="token operator">=</span><span class="token string">'first'</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># 筛掉销售量为0、获取失败以及未注明材质的商品</span>
filtered_df <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'评论数'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">"0"</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'评论数'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">"获取失败"</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'材质'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token comment"># 得到材质所有类别名称</span>
mat_classes <span class="token operator">=</span> filtered_df<span class="token punctuation">[</span><span class="token string">'材质'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
mat_counts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>mat_classes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token comment"># 计算每种材质总的销售额</span>
num_rows <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>filtered_df<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_rows<span class="token punctuation">)</span><span class="token punctuation">:</span>
    row <span class="token operator">=</span> filtered_df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    index <span class="token operator">=</span> mat_classes<span class="token punctuation">.</span>index<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'材质'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    count <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token string">'评论数'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'万'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
        mat_counts<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>count<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10000</span>
    <span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        mat_counts<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>count<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 按从大到小排序</span>
sorted_tuples <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>mat_classes<span class="token punctuation">,</span> mat_counts<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
sorted_mat_classes <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> sorted_tuples<span class="token punctuation">]</span>
sorted_mat_counts <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> sorted_tuples<span class="token punctuation">]</span>

<span class="token comment"># 绘制直方图</span>
bar <span class="token operator">=</span> <span class="token punctuation">(</span>
    Bar<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>add_xaxis<span class="token punctuation">(</span>sorted_mat_classes<span class="token punctuation">)</span>
    <span class="token punctuation">.</span>add_yaxis<span class="token punctuation">(</span><span class="token string">"销售额"</span><span class="token punctuation">,</span> sorted_mat_counts<span class="token punctuation">)</span>
    <span class="token punctuation">.</span>set_global_opts<span class="token punctuation">(</span>title_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>TitleOpts<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">"材质"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#, subtitle="副标题"</span>
<span class="token punctuation">)</span>
bar<span class="token punctuation">.</span>set_global_opts<span class="token punctuation">(</span>
    xaxis_opts<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">'axisLabel'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'rotate'</span><span class="token punctuation">:</span> <span class="token number">45</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token comment"># jupyter notebook直接调用render_notebook随时随地渲染图表</span>
bar<span class="token punctuation">.</span>render_notebook<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># bar.render('F:/vsCode/everyThing/material.html')</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a4/d8/EzkeGsIn_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token comment"># 绘制饼图</span>
pie_chart <span class="token operator">=</span> <span class="token punctuation">(</span>
    Pie<span class="token punctuation">(</span>init_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>InitOpts<span class="token punctuation">(</span>theme<span class="token operator">=</span>ThemeType<span class="token punctuation">.</span>SHINE<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token builtin">list</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span> <span class="token keyword">for</span> z <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>sorted_mat_classes<span class="token punctuation">,</span> sorted_mat_counts<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#     .set_global_opts(title_opts=opts.TitleOpts(title="材质"))</span>
    <span class="token punctuation">.</span>set_series_opts<span class="token punctuation">(</span>
        label_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LabelOpts<span class="token punctuation">(</span>
            formatter<span class="token operator">=</span><span class="token string">"{b}: {d}%"</span><span class="token punctuation">,</span>
            font_size<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span>
            position<span class="token operator">=</span><span class="token string">"outside"</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment"># 调整饼图大小</span>
        radius<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"0%"</span><span class="token punctuation">,</span> <span class="token string">"80%"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span>
pie_chart<span class="token punctuation">.</span>render_notebook<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/91/49/xgbTD2CB_o.png" alt="在这里插入图片描述"></p> 
<ul><li>对容量可视化</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 筛掉销售量为0和获取失败、未注明容量、容量不明确的商品</span>
filtered_df <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'评论数'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">"0"</span><span class="token punctuation">)</span>
                 <span class="token operator">&amp;</span> <span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'评论数'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">"获取失败"</span><span class="token punctuation">)</span>
                 <span class="token operator">&amp;</span> <span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'容量'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">' '</span><span class="token punctuation">)</span>
                 <span class="token operator">&amp;</span> <span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'容量'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'≤50mL，51-100mL，101-200mL，201-300mL，301-400mL，401-500mL，501-600mL，601-700mL，701-800mL，801-900mL，901-1000mL，1L以上'</span><span class="token punctuation">)</span>
                 <span class="token operator">&amp;</span> <span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'容量'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'其他'</span><span class="token punctuation">)</span>
                 <span class="token operator">&amp;</span> <span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'容量'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'其它'</span><span class="token punctuation">)</span>
                 <span class="token operator">&amp;</span> <span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'容量'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'201-300mL，301-400mL'</span><span class="token punctuation">)</span>
                 <span class="token operator">&amp;</span> <span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'容量'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'201-300mL，301-400mL，401-500mL'</span><span class="token punctuation">)</span>
                 <span class="token operator">&amp;</span> <span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'容量'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'201-300mL，801-900mL'</span><span class="token punctuation">)</span>
                 <span class="token operator">&amp;</span> <span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'容量'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'301-400mL，401-500mL，501-600mL'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
                 
vol_classes <span class="token operator">=</span> filtered_df<span class="token punctuation">[</span><span class="token string">'容量'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span>
vol_counts <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>vol_classes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

num_rows <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>filtered_df<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_rows<span class="token punctuation">)</span><span class="token punctuation">:</span>
    row <span class="token operator">=</span> filtered_df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    index <span class="token operator">=</span> vol_classes<span class="token punctuation">.</span>index<span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'容量'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    count <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token string">'评论数'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'万'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
        vol_counts<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>count<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10000</span>
    <span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        vol_counts<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>count<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 合并重复的</span>
index1 <span class="token operator">=</span> vol_classes<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">'101-200mL'</span><span class="token punctuation">)</span>
index2 <span class="token operator">=</span> vol_classes<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">'101-200ml'</span><span class="token punctuation">)</span>
temp <span class="token operator">=</span> vol_counts<span class="token punctuation">[</span>index1<span class="token punctuation">]</span> <span class="token operator">+</span> vol_counts<span class="token punctuation">[</span>index2<span class="token punctuation">]</span>
vol_counts<span class="token punctuation">[</span>index1<span class="token punctuation">]</span> <span class="token operator">=</span> temp
<span class="token keyword">del</span> vol_classes<span class="token punctuation">[</span>index2<span class="token punctuation">]</span>
<span class="token keyword">del</span> vol_counts<span class="token punctuation">[</span>index2<span class="token punctuation">]</span>

index1 <span class="token operator">=</span> vol_classes<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">'401-500mL'</span><span class="token punctuation">)</span>
index2 <span class="token operator">=</span> vol_classes<span class="token punctuation">.</span>index<span class="token punctuation">(</span><span class="token string">'401-500ml'</span><span class="token punctuation">)</span>
temp <span class="token operator">=</span> vol_counts<span class="token punctuation">[</span>index1<span class="token punctuation">]</span> <span class="token operator">+</span> vol_counts<span class="token punctuation">[</span>index2<span class="token punctuation">]</span>
vol_counts<span class="token punctuation">[</span>index1<span class="token punctuation">]</span> <span class="token operator">=</span> temp
<span class="token keyword">del</span> vol_classes<span class="token punctuation">[</span>index2<span class="token punctuation">]</span>
<span class="token keyword">del</span> vol_counts<span class="token punctuation">[</span>index2<span class="token punctuation">]</span>

sorted_tuples <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>vol_classes<span class="token punctuation">,</span> vol_counts<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
sorted_vol_classes <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> sorted_tuples<span class="token punctuation">]</span>
sorted_vol_counts <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> sorted_tuples<span class="token punctuation">]</span>

bar <span class="token operator">=</span> <span class="token punctuation">(</span>
    Bar<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>add_xaxis<span class="token punctuation">(</span>sorted_vol_classes<span class="token punctuation">)</span>
    <span class="token punctuation">.</span>add_yaxis<span class="token punctuation">(</span><span class="token string">"销售额"</span><span class="token punctuation">,</span> sorted_vol_counts<span class="token punctuation">)</span>
    <span class="token punctuation">.</span>set_global_opts<span class="token punctuation">(</span>title_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>TitleOpts<span class="token punctuation">(</span>title<span class="token operator">=</span><span class="token string">"容量"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#, subtitle="副标题"</span>
<span class="token punctuation">)</span>
bar<span class="token punctuation">.</span>set_global_opts<span class="token punctuation">(</span>
    xaxis_opts<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
        <span class="token string">'axisLabel'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">'rotate'</span><span class="token punctuation">:</span> <span class="token number">45</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">)</span>

bar<span class="token punctuation">.</span>render_notebook<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># bar.render('F:/vsCode/everyThing/volume.html')</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/41/f8/QSqHbCc3_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python">pie_chart <span class="token operator">=</span> <span class="token punctuation">(</span>
    Pie<span class="token punctuation">(</span>init_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>InitOpts<span class="token punctuation">(</span>theme<span class="token operator">=</span>ThemeType<span class="token punctuation">.</span>SHINE<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token builtin">list</span><span class="token punctuation">(</span>z<span class="token punctuation">)</span> <span class="token keyword">for</span> z <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>sorted_vol_classes<span class="token punctuation">,</span> sorted_vol_counts<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#     .set_global_opts(title_opts=opts.TitleOpts(title="容量"))</span>
    <span class="token punctuation">.</span>set_series_opts<span class="token punctuation">(</span>
        label_opts<span class="token operator">=</span>opts<span class="token punctuation">.</span>LabelOpts<span class="token punctuation">(</span>
            formatter<span class="token operator">=</span><span class="token string">"{b}: {d}%"</span><span class="token punctuation">,</span>
            font_size<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span>
            position<span class="token operator">=</span><span class="token string">"outside"</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment"># 调整饼图大小</span>
        radius<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"0%"</span><span class="token punctuation">,</span> <span class="token string">"60%"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span>
pie_chart<span class="token punctuation">.</span>render_notebook<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/4a/26/frUAJ4bk_o.png" alt="在这里插入图片描述"></p> 
<ul><li>销售额前60的杯子</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># 筛掉销售量为0和获取失败</span>
filtered_df <span class="token operator">=</span> df<span class="token punctuation">[</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'评论数'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">"0"</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'评论数'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">"获取失败"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

sales <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
indexs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
num_rows <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>filtered_df<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num_rows<span class="token punctuation">)</span><span class="token punctuation">:</span>
    row <span class="token operator">=</span> filtered_df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    count <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token string">'评论数'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'+'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'万'</span><span class="token punctuation">)</span>
    indexs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">:</span>
        sales<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>count<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">10000</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        sales<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>count<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 使用sorted函数对列表进行排序，并取最后销售额前几的元素</span>
sorted_tuples <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span>indexs<span class="token punctuation">,</span> sales<span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
sorted_indexs <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> sorted_tuples<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">60</span><span class="token punctuation">]</span> <span class="token comment"># 0:20为前20,20:40为前20~40</span>
sorted_sales <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> sorted_tuples<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">:</span><span class="token number">60</span><span class="token punctuation">]</span>

plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'SimHei'</span><span class="token punctuation">]</span>  <span class="token comment"># 设置中文显示</span>

plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>sorted_indexs<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    index <span class="token operator">=</span> sorted_indexs<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    row <span class="token operator">=</span> filtered_df<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    imgPath <span class="token operator">=</span> <span class="token string">"."</span> <span class="token operator">+</span> row<span class="token punctuation">[</span><span class="token string">'图片'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    imgNum <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token string">'图片'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    img <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>imgPath<span class="token punctuation">)</span>
    count <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token string">'评论数'</span><span class="token punctuation">]</span>
    sale <span class="token operator">=</span> sorted_sales<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>imgNum <span class="token operator">+</span> <span class="token string">" 销售额："</span><span class="token operator">+</span>count<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">"./03.jpg"</span><span class="token punctuation">,</span> bbox_inches<span class="token operator">=</span><span class="token string">'tight'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ce/96/efvzd7cz_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p><img src="https://images2.imgbox.com/b4/1e/Ad31ckrS_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<p><img src="https://images2.imgbox.com/d4/a2/sz5iuGk1_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e5e1280f1552b80f215262a25e79f27b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">安克创新音频算法工程师(应届生)招聘</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1eec3aaffa0f945bf55b84ac6b81cbb8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java jdk 版本切换工具 jEnv</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>