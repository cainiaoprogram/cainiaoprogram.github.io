<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>如何在小米4A刷OpenWRT系统并通过cpolar实现公网访问本地路由器 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="如何在小米4A刷OpenWRT系统并通过cpolar实现公网访问本地路由器" />
<meta property="og:description" content="文章目录 前言1. 安装Python和需要的库2. 使用 OpenWRTInvasion 破解路由器3. 备份当前分区并刷入新的Breed4. 安装cpolar内网穿透4.1 注册账号4.2 下载cpolar客户端4.3 登录cpolar web ui管理界面4.4 创建公网地址 5. 固定公网地址访问 前言 OpenWRT是一个高度模块化、高度自动化的嵌入式Linux系统，可以让路由器变得更智能，简单的说，路由器刷了OpenWrt就相当于一个Linux系统带无线带多网卡的电脑。
举个栗子：有usb功能的路由器刷后可以实现多端文件共享 ，挂站，远程监控甚至智能家居 ；无线可桥接，可以无线连接一般的chinanet热点并拨号；组建局域网无线网络传输数据等。
今天就分享一下如何在小米路由器4A千兆版刷入OpenWRT并通过内网穿透工具实现公网远程访问。
1. 安装Python和需要的库 首先打开 www.python.org 下载一个 Python3 的安装包并安装。
安装完成后执行以下命令升级pip与安装需要的库：
python -m pip install --upgrade pip pip install pycryptodome pip install requests 2. 使用 OpenWRTInvasion 破解路由器 打开 OpenWRTInvasion 的 releases 页面，下载一个可用的版本，我这里选择的是支持Windows的版本的是0.0.7。
下载后得到的压缩包名为：OpenWRTInvasion-0.0.7，将改文件解压缩到一个无中文的路径即可。
小米路由器联网，登录路由器，在地址栏中找到参数stok并复制等号后的字符，保持网页不要关闭。
在解压OpenWRTInvasion的目录打开cmd（本教程中使用的是Windows PowerShell）
输入python remote_command_execution_vulnerability.py指令运行破解脚本
根据提示输入路由器IP（192.168.31.1），粘贴之前复制的stok等号后的字符，开始破解
破解成功后会有提示，可以复制提示的指令连接Telent或者SSH，用户名、密码都是root
3. 备份当前分区并刷入新的Breed 首先执行以下指令查看与备份分区
cat /proc/mtd #显示路由分区 dd if=/dev/mtd0 of=/tmp/all.bin #备份所有分区到/tmp/all.bin dd if=/dev/mtd1 of=/tmp/Bootloader." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/33719fc19306b2a89cba8dc18f4b5f81/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-08T15:03:50+08:00" />
<meta property="article:modified_time" content="2024-01-08T15:03:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">如何在小米4A刷OpenWRT系统并通过cpolar实现公网访问本地路由器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_1" rel="nofollow">前言</a></li><li><a href="#1_Python_9" rel="nofollow">1. 安装Python和需要的库</a></li><li><a href="#2__OpenWRTInvasion__21" rel="nofollow">2. 使用 OpenWRTInvasion 破解路由器</a></li><li><a href="#3_Breed_43" rel="nofollow">3. 备份当前分区并刷入新的Breed</a></li><li><a href="#4_cpolar_73" rel="nofollow">4. 安装cpolar内网穿透</a></li><li><ul><li><a href="#41__77" rel="nofollow">4.1 注册账号</a></li><li><a href="#42_cpolar_85" rel="nofollow">4.2 下载cpolar客户端</a></li><li><a href="#43_cpolar_web_ui_91" rel="nofollow">4.3 登录cpolar web ui管理界面</a></li><li><a href="#44__97" rel="nofollow">4.4 创建公网地址</a></li></ul> 
   </li><li><a href="#5__121" rel="nofollow">5. 固定公网地址访问</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_1"></a>前言</h3> 
<p>OpenWRT是一个高度模块化、高度自动化的嵌入式Linux系统，可以让路由器变得更智能，简单的说，路由器刷了OpenWrt就相当于一个Linux系统带无线带多网卡的电脑。</p> 
<p>举个栗子：有usb功能的路由器刷后可以实现多端文件共享 ，挂站，远程监控甚至智能家居 ；无线可桥接，可以无线连接一般的chinanet热点并拨号；组建局域网无线网络传输数据等。</p> 
<p>今天就分享一下如何在小米路由器4A千兆版刷入OpenWRT并通过内网穿透工具实现公网远程访问。</p> 
<h3><a id="1_Python_9"></a>1. 安装Python和需要的库</h3> 
<p>首先打开 <a href="https://www.python.org/" rel="nofollow">www.python.org</a> 下载一个 Python3 的安装包并安装。</p> 
<p>安装完成后执行以下命令升级pip与安装需要的库：</p> 
<pre><code>python -m pip install --upgrade pip
pip install pycryptodome
pip install requests
</code></pre> 
<h3><a id="2__OpenWRTInvasion__21"></a>2. 使用 OpenWRTInvasion 破解路由器</h3> 
<p>打开 <a href="https://github.com/acecilia/OpenWRTInvasion/releases">OpenWRTInvasion 的 releases 页面</a>，下载一个可用的版本，我这里选择的是支持Windows的版本的是0.0.7。</p> 
<p>下载后得到的压缩包名为：OpenWRTInvasion-0.0.7，将改文件解压缩到一个无中文的路径即可。</p> 
<p><img src="https://images2.imgbox.com/ed/7b/PjwAQ7H9_o.png" alt="image-20231110132110564"></p> 
<p>小米路由器联网，登录路由器，在地址栏中找到参数stok并复制等号后的字符，保持网页不要关闭。</p> 
<p><img src="https://images2.imgbox.com/08/9c/RIz9EPjv_o.png" alt="image-20231110132322135"></p> 
<p>在解压OpenWRTInvasion的目录打开cmd（本教程中使用的是Windows PowerShell）</p> 
<p>输入<code>python remote_command_execution_vulnerability.py</code>指令运行破解脚本</p> 
<p>根据提示输入路由器IP（192.168.31.1），粘贴之前复制的stok等号后的字符，开始破解</p> 
<p>破解成功后会有提示，可以复制提示的指令连接Telent或者SSH，用户名、密码都是root</p> 
<p><img src="https://images2.imgbox.com/27/07/8PrFn7lq_o.png" alt="1699594102179"></p> 
<h3><a id="3_Breed_43"></a>3. 备份当前分区并刷入新的Breed</h3> 
<p>首先执行以下指令查看与备份分区</p> 
<pre><code>cat /proc/mtd   #显示路由分区
dd if=/dev/mtd0 of=/tmp/all.bin   #备份所有分区到/tmp/all.bin
dd if=/dev/mtd1 of=/tmp/Bootloader.bin   #备份引导分区到/tmp/Bootloader.bin
</code></pre> 
<p><img src="https://images2.imgbox.com/3f/c7/jPK7UN4p_o.png" alt="2.png"></p> 
<p>然后使用WinSCP或者其他FTP工具创建FTP连接，地址是路由器IP，用户名root，没有密码，连接后将刚才备份的两个文件<code>all.bin</code>,<code>Bootloader.bin</code>传输出来，并且将 <a href="https://breed.hackpascal.net/breed-mt7621-pbr-m1.bin" rel="nofollow">breed-mt7621-pbr-m1.bin</a> 上传到tmp目录下。</p> 
<p><img src="https://images2.imgbox.com/17/94/3cm31Q1o_o.png" alt="image-20231110133106317"></p> 
<p>上传完成后执行<code>mtd -r write /tmp/breed-mt7621-pbr-m1.bin Bootloader</code>刷入Breed，刷入完成后重启路由器</p> 
<p><img src="https://images2.imgbox.com/69/19/KJ4Bc8Ya_o.png" alt="image-20231110133436834"></p> 
<p>使用浏览器打开192.168.1.1打开Breed控制台，刷入<a href="https://downloads.openwrt.org/releases/21.02.3/targets/ramips/mt7621/" rel="nofollow">openwrt-ramips-mt7621-xiaomi_r4a-squashfs-sysupgrade.bin</a>。点击确定后，会进行更新读条。</p> 
<p><img src="https://images2.imgbox.com/93/99/KtrcRc0U_o.png" alt="image-20231110133222053"></p> 
<p>等待读条结束后，浏览器输入192.168.31.1即可看到OpenWrt登录界面</p> 
<p>默认账号为root，密码是 coolxiaomi，登录后显示下方界面即刷入成功。</p> 
<p><img src="https://images2.imgbox.com/48/af/W1swh4YW_o.png" alt="image-20231110133305818"></p> 
<h3><a id="4_cpolar_73"></a>4. 安装cpolar内网穿透</h3> 
<p>此时已经可以成功登录OpenWrt并运行，不过只能在本地访问，如果打算在公网环境随时随时访问内网的OpenWrt进行文件传输等操作，我们需要安装cpolar内网穿透工具来实现。</p> 
<h4><a id="41__77"></a>4.1 注册账号</h4> 
<p>进入cpolar官网：https://www.cpolar.com/</p> 
<p>点击右上角的<code>免费注册</code>，使用邮箱免费注册一个cpolar账号并登录</p> 
<p><img src="https://images2.imgbox.com/4b/22/RSZWzkFQ_o.png" alt="20221117173301"></p> 
<h4><a id="42_cpolar_85"></a>4.2 下载cpolar客户端</h4> 
<p>登录成功后，点击下载cpolar到本地并安装（一路默认安装即可）本教程选择下载Windows版本。</p> 
<p><img src="https://images2.imgbox.com/0d/73/U801XsvJ_o.png" alt="20221117173307"></p> 
<h4><a id="43_cpolar_web_ui_91"></a>4.3 登录cpolar web ui管理界面</h4> 
<p>在浏览器上访问<a href="http://127.0.0.1:9200/#/dashboard" rel="nofollow">127.0.0.1:9200</a>，使用所注册的cpolar邮箱账号登录cpolar web ui管理界面（默认为本地9200端口）</p> 
<p><img src="https://images2.imgbox.com/2d/b5/UyUQPq6X_o.png" alt="20221117173316"></p> 
<h4><a id="44__97"></a>4.4 创建公网地址</h4> 
<p>登录成功进入主界面后，我们点击左侧仪表盘的<code>隧道管理</code>——<code>隧道列表</code>，再点击<code>创建隧道</code>.</p> 
<p><img src="https://images2.imgbox.com/ca/f1/7cS5n7hb_o.png" alt="image-20231110162208198"></p> 
<ul><li> <p>隧道名称：可自定义命名，不能与已有的隧道名重复，这里我填写了<code>website</code></p> </li><li> <p>协议：选择<code>http</code></p> </li><li> <p>本地地址：<code>192.168.31.1:80</code></p> </li><li> <p>域名类型：免费套餐选择<code>随机域名</code></p> </li><li> <p>地区：<code>China Top</code></p> </li></ul> 
<p>点击<code>创建</code></p> 
<p><img src="https://images2.imgbox.com/21/7f/c6JARQ0z_o.png" alt="image-20231110162518951"></p> 
<p>此时，点击左侧<code>状态</code>中的<code>在线隧道列表</code>，可以看到刚才创建的wamp隧道，生成了两个公网地址，有两种访问方式，分别是http 和https，随意复制一个地址，在公网电脑浏览器打开即可，如下图所示即代表成功实现公网访问本地内网路由器的OpenWrt。</p> 
<p><img src="https://images2.imgbox.com/2b/fa/Mbq8zVcf_o.png" alt="image-20231110162548764"></p> 
<h3><a id="5__121"></a>5. 固定公网地址访问</h3> 
<p>需要注意的是，本次教程中使用的是免费cpolar所生成的公网随机临时地址，该地址24小时内会发生变化，对于需要长期在外使用OpenWrt的用户来讲，配置一个固定地址就很有必要。</p> 
<p>我一般会使用固定二级子域名，原因是这样一个固定、易记的公网地址（例如：open.cpolar.cn），这样远程路由器时更方便也更快捷。</p> 
<p>登录cpolar官网，点击左侧的预留，选择保留二级子域名，设置一个二级子域名名称，点击<code>保留</code>，保留成功后复制保留的二级子域名名称。</p> 
<p><img src="https://images2.imgbox.com/8b/59/w7b3UpOb_o.png" alt="image-20231110163339847"></p> 
<p>以本次教程为例，地区选择<code>China VIP</code>，二级域名填写<code>open</code>，描述填写1，点击<code>保留</code>。</p> 
<p><img src="https://images2.imgbox.com/e8/dd/IT1WiHfU_o.png" alt="image-20231110163454502"></p> 
<p>保留成功后复制保留的二级子域名地址，登录cpolar web UI管理界面，点击左侧仪表盘的<code>隧道管理</code>——<code>隧道列表</code>，找到所要配置的隧道：website，点击右侧的<code>编辑</code></p> 
<p><img src="https://images2.imgbox.com/cd/87/yP7HgmFe_o.png" alt="image-20231110163710840"></p> 
<p>修改隧道信息，将保留成功的二级子域名配置到隧道中</p> 
<ul><li>域名类型：选择<code>二级子域名</code></li><li>Sub Domain：填写保留成功的二级子域名<code>open</code></li><li>地区：选择<code>China VIP</code></li></ul> 
<p>点击<code>更新</code></p> 
<p><img src="https://images2.imgbox.com/54/37/drCXBex8_o.png" alt="image-20231110163829552"></p> 
<p>更新完成后,打开<code>在线隧道列表</code>,此时可以看到公网地址已经发生变化,地址名称也变成了保留和固定的二级子域名名称。</p> 
<p><img src="https://images2.imgbox.com/35/00/ndgSwltr_o.png" alt="image-20231110163857679"></p> 
<p>最后，我们使用固定的公网地址进行连接访问，复制二级子域名：http://open.vip.cpolar.cn/到另一台公网电脑浏览器打开，无报错和连接异常，可以看到连接成功，这样一个固定不变的地址访问就设置好了，您可以随时随地使用该域名来公网访问内网路由器OpenWrt进行操作了。</p> 
<p><img src="https://images2.imgbox.com/34/a4/y0XdxvOl_o.png" alt="image-20231110163939222"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3396369e06cf3340b70292a4f6dc4521/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">并发List源码剖析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/92e9c9508bdb654461ac21822777020e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">蓝牙网关在物联网领域三大应用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>