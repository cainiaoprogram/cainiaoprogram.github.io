<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>scp覆盖原有文件_CentOS7 系统崩溃数据文件备份方案 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="scp覆盖原有文件_CentOS7 系统崩溃数据文件备份方案" />
<meta property="og:description" content="CentOS操作系统的使用过程中，往往会因为人为失误或者客观原因导致系统崩溃。例如我们常见的2种场景：
误操作执行rm -rf /*但及时Ctrl&#43;C中断；
服务器断电后系统故障无法启动；
大多数的工程师应该使用过Windows PE(下文简称PE)系统，在Windows系统无法正常启动时可能会想到尝试PE模式下进行系统修复或者修复失败的情况下拷贝原有的数据。对于CentOS系统，也有类似PE系统的救援安装模式可进行尝试修复系统或者拷贝数据。
救援安装模式我们要先准备一个安装引导介质，这里以安装镜像iso文件举例。
准备工作：
安装镜像iso文件
笔记本一台
Oracle JDK
U盘或者移动硬盘(可选)
实施步骤：
笔记本安装JDK并接入服务器BMC管理口网络或者直连服务器BMC管理口(具体步骤省略)
浏览器登录BMC管理口，海康新服务器默认10.10.10.10(具体步骤省略)
打开虚拟Java控制台加载iso安装文件
打开虚拟光驱 加载iso镜像文件
重启服务器进入救援安装模式
F11进入引导菜单
选择虚拟光驱
选择Troubleshooting
选择救援安装模式
进入命令行
查看磁盘识别情况
查看磁盘
如果看不到centos_hikvisionos卷组信息，代表root和opt未能自动挂载，执行第6步进行挂载。
激活卷组挂载文件系统
vgchange -ay //激活卷组
mkdir /oldroot //创建临时挂载点
mkdir /oldopt //创建临时挂载点
mount /dev/centos_hikvisionos/root /oldroot //挂载根文件系统
mount /dev/centos_hikvisionos/opt /oldopt //挂载/opt文件系统
文件系统配置
确认网卡链路
ip a //查看网卡名称
ethtool enp65s0f1 //查看网络链路
Speed：1000Mb/s //代表网卡已连接千兆网络
链路确认
配置原网卡IP地址
ip addr add 60.1.0.3/28 dev enp65s0f1 //配置IP掩码 ip route add default via 60." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/065b19f05c4b832e7a054aca34d923d8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-11-28T15:53:29+08:00" />
<meta property="article:modified_time" content="2020-11-28T15:53:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">scp覆盖原有文件_CentOS7 系统崩溃数据文件备份方案</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="._5ce-wx-style" style="font-size:16px;"> 
 <div class="rich_media_content" id="js_content"> 
  <p>CentOS操作系统的使用过程中，往往会因为人为失误或者客观原因导致系统崩溃。例如我们常见的2种场景：</p> 
  <ol><li><p>误操作执行rm -rf /*但及时Ctrl+C中断；</p></li><li><p>服务器断电后系统故障无法启动；</p></li></ol> 
  <p><img src="https://images2.imgbox.com/77/0d/Z7CqSybg_o.png" alt="f46de3c89c593dafd54b9f4debb8194c.png"></p> 
  <p>大多数的工程师应该使用过Windows PE(下文简称PE)系统，在Windows系统无法正常启动时可能会想到尝试PE模式下进行系统修复或者修复失败的情况下拷贝原有的数据。对于CentOS系统，也有类似PE系统的救援安装模式可进行尝试修复系统或者拷贝数据。</p> 
  <p>救援安装模式我们要先准备一个安装引导介质，这里以安装镜像iso文件举例。</p> 
  <p>准备工作：</p> 
  <ol><li><p>安装镜像iso文件</p></li><li><p>笔记本一台</p></li><li><p>Oracle JDK</p></li><li><p>U盘或者移动硬盘(可选)</p></li></ol> 
  <p>实施步骤：</p> 
  <ol><li><p>笔记本安装JDK并接入服务器BMC管理口网络或者直连服务器BMC管理口(具体步骤省略)</p></li><li><p>浏览器登录BMC管理口，海康新服务器默认10.10.10.10(具体步骤省略)</p></li><li><p>打开虚拟Java控制台加载iso安装文件</p><p><img src="https://images2.imgbox.com/2e/87/MdV68PRT_o.png" alt="39872c12f8af2422d720ce55ee3a83f8.png"></p><p>打开虚拟光驱 <img src="https://images2.imgbox.com/6b/1e/JpfN1Iow_o.png" alt="469ffde68c59959156b3c025f016838f.png"></p><p>加载iso镜像文件</p></li><li><p>重启服务器进入救援安装模式</p><p><img src="https://images2.imgbox.com/d0/91/6Fx1uQE6_o.png" alt="b6376e437dca789296710c3c4c4ec91b.png"></p><p>F11进入引导菜单</p><p><img src="https://images2.imgbox.com/e2/1d/BGCW7MPa_o.png" alt="0a7c198358affcfe2a2005346c4bd3c1.png"></p><p>选择虚拟光驱</p><p><img src="https://images2.imgbox.com/a4/ad/Gy12sBjy_o.png" alt="e5278800be0a79b280dbe4c494ba0f9b.png"></p><p>选择Troubleshooting</p><p><img src="https://images2.imgbox.com/a4/1c/7GfKHOEG_o.png" alt="b61120e845fc3b2cf835df6091bda9a8.png"></p><p>选择救援安装模式</p><p><img src="https://images2.imgbox.com/b7/3f/fWn0m2Zl_o.png" alt="aa2b20d70ee4d695f5643438e60343bd.png"></p><p>进入命令行</p></li><li><p>查看磁盘识别情况</p><p><img src="https://images2.imgbox.com/9c/b3/klrIDRL1_o.png" alt="975cabbdbfc6a8f26e7a9d26525cc8a0.png"></p><p>查看磁盘</p><p>如果看不到centos_hikvisionos卷组信息，代表root和opt未能自动挂载，执行第6步进行挂载。</p></li><li><p>激活卷组挂载文件系统</p><p>vgchange -ay    //激活卷组</p><p>mkdir /oldroot    //创建临时挂载点</p><p>mkdir /oldopt      //创建临时挂载点</p><p>mount /dev/centos_hikvisionos/root   /oldroot  //挂载根文件系统</p><p>mount /dev/centos_hikvisionos/opt   /oldopt    //挂载/opt文件系统</p><p><img src="https://images2.imgbox.com/27/60/HW5l3J9D_o.png" alt="c8631ba9dd16f2ad71e40cf576b05c92.png"></p><p>文件系统配置</p></li><li><p>确认网卡链路</p><p>ip a  //查看网卡名称</p><p>ethtool enp65s0f1  //查看网络链路</p><p>Speed：1000Mb/s //代表网卡已连接千兆网络</p><p><img src="https://images2.imgbox.com/bb/45/URPYpkny_o.png" alt="c5051f0fcbbe3e6d2927df4d55285c3a.png"></p><p>链路确认</p></li><li><p>配置原网卡IP地址</p><p>ip addr add 60.1.0.3/28 dev enp65s0f1   //配置IP掩码            </p><p>ip route add default via 60.1.0.2 dev enp65s0f1 //配置默认路由</p><p><img src="https://images2.imgbox.com/ae/54/kpljhtSk_o.png" alt="a54e8a3eeed59e19cbc4ff5176c21a4b.png"></p><p>配置并确认网络</p></li><li><p>xshell登录另一台linux服务器并确认root远程登录权限</p><p>vi /etc/ssh/sshd_config    //编辑配置sshd文件，确保</p><p>PermitRootLogin yes      //确保PermitRootLogin 值为yes</p><p>systemctl restart sshd     //重启sshd服务立即生效</p></li><li><p>远程拷贝数据</p><p>以scp方式拷贝原目录/opt/hik至对方/tmp为例</p><p>scp -P xxx  -r /oldopt/hik  root@60.x.x.x:/tmp/</p><p>-P xxx   对端ssh登录端口</p><p>-r  拷贝文件不加参数，拷贝目录加-r参数</p><p>user@ip  对端用户和ip</p><p>/tmp 对端存放路径</p></li><li><p>插入U盘拷贝数据(可选)</p><p>lsblk 查看U盘是否识别，假如U盘识别为sdb，一般情况U盘的会存在分区sdb4，挂载的时候要挂载sdb4。Linux默认不支持ntfs文件系统，所以可使用parted -l确认U盘是ntfs还是fat。fat格式可执行以下命令挂载：</p><p>mkdir  /upan</p><p>mount -t vfat  /dev/sdb4 /upan</p><p>cp -r /oldopt/hik  /upan</p></li><li><p>插入ntfs移动硬盘拷贝数据(可选)</p><p>如果数据量大且网络情况不好的时候可考虑使用移动硬盘进行备份，把ntfs-3g-2017.3.23-6.el7.x86_64.rpm拷贝到U盘，按照第11步挂载U盘安装ntfs安装包。</p><p>rpm -ivh ntfs-3g-2017.3.23-6.el7.x86_64.rpm</p><p>mkdir /ydpan</p><p>mount -t nfts /dev/sdb4 /ydpan</p><p>cp -r /oldopt/hik /ydpan</p></li></ol> 
  <p>救援模式下备份数据在原系统无法恢复的情况下抢救数据的一种方式，并非唯一的方式。在日常工作中请一定做好异地数据备份，尽量避免备份数据和原始数据在同一个主机下。</p> 
  <p>再次提醒如果误执行了删库跑路命令“rm -rf /*”,以我们现有的常规手段数据几乎不能恢复，希望大家尽量避免这种悲剧。当然人外有人，山外有山，绝世高手也大有人在，如有成熟的恢复方案请大侠赐教。</p> 
  <p>更多文章请关注</p> 
  <p><img src="https://images2.imgbox.com/77/bc/9nSGJcJk_o.png" alt="c2c04f18524061e2de9aa8529f8d5491.png"></p> 
 </div> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/721e52744e82f75c02a19975a5eeb36f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">计算机中丢失OpenNI2.dll</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a7fbd23b71c34888d60b7f3239cb1ab4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SyntaxError: invalid syntax都可能是是什么错！！！（持续更新）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>