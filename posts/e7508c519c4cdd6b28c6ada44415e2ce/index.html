<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>文件服务器同步解决方案rsync - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="文件服务器同步解决方案rsync" />
<meta property="og:description" content="rsync实现文件同步
工作模型 一台作为server端一台最为client端，client把数据差异同步到server上。从而实现数据的同步。
1.在server端和client上分别安装
yum install rsync -y
2.为server端提供配置文件 vim /etc/rsyncd.conf
uid = root//如果是nobody的话后期再同步的时候会有一些文件无法同步会有权限的问题
gid = root//同上
use chroot = no
max connections = 200
#strict modes = yes
timeout = 100
lock file = /var/run/rsync.lock
pid file = /var/run/rsyncd.pid
log file = /var/log/rsyncd.log
[my]
path = /wcf/ //指定要同步的目录接收地址
ignore errors
read only = no
#write noly = no
hosts allow = 172.1.0.0/16
hosts deny = 0.0.0.0/32
list = false" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/e7508c519c4cdd6b28c6ada44415e2ce/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-11-13T17:28:14+08:00" />
<meta property="article:modified_time" content="2014-11-13T17:28:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">文件服务器同步解决方案rsync</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="artical-content-bak main-content editor-side-new"> 
 <div class="con editor-preview-side" id="result"> 
  <p>                                                     rsync实现文件同步</p> 
  <p><br></p> 
  <p>工作模型  一台作为server端一台最为client端，client把数据差异同步到server上。从而实现数据的同步。</p> 
  <p><br></p> 
  <p>1.在server端和client上分别安装</p> 
  <p><br></p> 
  <p>yum install rsync -y</p> 
  <p><br></p> 
  <p>2.为server端提供配置文件   </p> 
  <p><br></p> 
  <p>vim /etc/rsyncd.conf</p> 
  <p><br></p> 
  <p>uid = root<span class="Apple-tab-span"></span>//如果是nobody的话后期再同步的时候会有一些文件无法同步会有权限的问题</p> 
  <p>gid = root<span class="Apple-tab-span"></span>//同上</p> 
  <p>use chroot = no</p> 
  <p>max connections = 200</p> 
  <p>#strict modes = yes</p> 
  <p>timeout = 100</p> 
  <p>lock file = /var/run/rsync.lock</p> 
  <p>pid file = /var/run/rsyncd.pid</p> 
  <p>log file = /var/log/rsyncd.log</p> 
  <p>[my]</p> 
  <p>path = /wcf/     //指定要同步的目录接收地址</p> 
  <p>ignore errors</p> 
  <p>read only = no</p> 
  <p>#write noly = no</p> 
  <p>hosts allow = 172.1.0.0/16</p> 
  <p>hosts deny = 0.0.0.0/32</p> 
  <p>list = false</p> 
  <p>auth users = myusers</p> 
  <p>secrets file = /etc/rsync.passwd </p> 
  <p><br></p> 
  <p>3.创建密码文件</p> 
  <p><br></p> 
  <p>vim /etc/rsync.passwd</p> 
  <p><br></p> 
  <p>myusers:mypassword</p> 
  <p><br></p> 
  <p>4.修改密码文件的权限必须为600</p> 
  <p><br></p> 
  <p>chmod 600 /etc/rsync.passwd</p> 
  <p><br></p> 
  <p><br></p> 
  <p>5.启动服务</p> 
  <p><br></p> 
  <p>rsync --daemon</p> 
  <p><br></p> 
  <p>6.检查服务是否运行</p> 
  <p><br></p> 
  <p>netstat -tnlp | grep rsync</p> 
  <p>如果出现端口为873的表示服务已经启动</p> 
  <p><br></p> 
  <p>7.查看防火墙是否放行873的服务</p> 
  <p><br></p> 
  <p>iptables -L</p> 
  <p><br></p> 
  <p>如果不放行可以加规则放行rsync服务的请求和响应</p> 
  <p><br></p> 
  <p>8.写脚本实现检测服务是否正常运行如果没有这自动启动服务</p> 
  <p><br></p> 
  <p>vim /root/monitoringrsync.sh</p> 
  <p><br></p> 
  <p>#!/bin/bash</p> 
  <p>stat=`/usr/bin/netstat -tnlp | /usr/bin/grep 873 | /usr/bin/wc -l`</p> 
  <p>if [ $stat -eq 0 ]; then</p> 
  <p>        /usr/bin/rsync --daemon</p> 
  <p>fi</p> 
  <p><br></p> 
  <p>9.把脚本加到定时器中</p> 
  <p><br></p> 
  <p>crontab -e</p> 
  <p>*/10 * * * * /root/monitoringrsync.sh</p> 
  <p><br></p> 
  <p>配置client端</p> 
  <p><br></p> 
  <p>10.创建密码文件这里边的密码一定要和服务器端的一样</p> 
  <p><br></p> 
  <p>vim /etc/rsync.pass</p> 
  <p><br></p> 
  <p>mypassword</p> 
  <p><br></p> 
  <p>11.修改权限必须为600</p> 
  <p><br></p> 
  <p>chmod 600 /etc/rsync.pass</p> 
  <p><br></p> 
  <p>12.在客户端写脚本就可以实现自动同步了</p> 
  <p><br></p> 
  <p>vim /root/rsync.sh</p> 
  <p>#!/bin/bash</p> 
  <p>rsync -avz /users/ rsync://myusers@172.1.44.33/my --password-file=/etc/rsync.passwd &amp;&amp; echo "Complete synchronization at `date`" &gt;&gt; /tmp/rsync.txt</p> 
  <p>if [ $? -ne 0 ]; then</p> 
  <p>        echo "Synchronization failure at `date`" &gt;&gt; /tmp/rsync.txt</p> 
  <p>        /sbin/sendmail 749629065@qq.com &lt; /tmp/rsync.txt</p> 
  <p>fi</p> 
  <p><br></p> 
  <p>此脚本也可以检测是否完成同步可以查看脚本指定的文件/tmp/rsync.txt如何同步失败会给指定的用户发送电子邮件通知</p> 
  <p><br></p> 
  <p>13.把脚本加到crontab中</p> 
  <p><br></p> 
  <p>crontab -e</p> 
  <p>01 01 * * * /root/rsync.sh</p> 
  <p>实现每天的晚上凌晨1：01开始同步</p> 
  <p><br></p> 
 </div> 
</div> 
<p>转载于:https://blog.51cto.com/wcfoffice/1576175</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7a7dbb2eba8d1771e75046ceaaef7c40/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数学软件Maple使用教程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/74383bf85d384e784838077e7c98480b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">HTML5&#43;Canvas&#43;jQuery调用手机拍照功能实现图片上传（二）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>