<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于STM32单片机的智能药盒定时提示吃药喂水蓝牙APP方案原理图设计 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="基于STM32单片机的智能药盒定时提示吃药喂水蓝牙APP方案原理图设计" />
<meta property="og:description" content="方案框图： 原理图： JDY-30蓝牙模块电路设计
蓝牙模块是指集成蓝牙功能的芯片基本电路集合，用于无线网络通讯。本蓝牙模块就是为了只能无线数据传输而专门打造的，本模块支持串行接口，支持SP蓝牙串口协议，具有成本低、体积小、收发灵敏性高等特点，只需配备少许的外围元件就能实现大功能。
一、模块特点
（1）支持蓝牙 SPP 串口协议
（2）内置 PCB 天线
（3）支持 UART 接口
（4）蓝牙 Class 2
（5）数据传输比 BLE 蓝牙快、可达到 8K 每秒以上的速率
（6）支持与 SPP 主蓝牙模块连接通信（JDY-30 为从 SPP 蓝牙模块）
（7）支持与电脑 SPP 蓝牙通信
（8）支持 Android 手机 SPP 通信
二、产品应用范围
（1） POS 机
（2）蓝牙打印机
（3）蓝牙玩具
（4）蓝牙高速数据传输产品应用
（5）小家电
（6）汽车电子
三、模块技术参数
（1）工作电压：3.3V-6V
（2）工作温度：-40℃-85℃
（3）天线：PCB板载天线
（4）功耗：19mA
四、模块接口说明
（1）RXD 串口输入，电平为TTL电平
（2）TXD 串口输出，电平为TTL电平
（3）GND 接GND
（4）VCC 接3.3V-6V
蓝牙模块接口电路图如下图所示。
LED信号指示灯电路设计
LED灯即发光二极管，它是半导体二极管的一种，可以把电能转化成光能。发光二极管与普通二极管一样是由一个PN结组成，也具有单向导电性。在电路中，电阻的作用是限流，保护LED灯。只要单片机的控制引脚拉低，则LED灯亮，否则，LED灯不亮。其具体电路原理图如下图所示。
二挡拨动开关检测电路设计
拨动开关是通过拨动开关柄使电路接通或断开，从而达到切换电路的目的的。拨动开关常用的品种有单极双位、单极三位、双极双位以及双极三位等，它一般用于低压电路，具有滑块动作灵活、性能稳定可靠的特点，拨动开关主要广泛用于:各种仪器/仪表设备，各种电动玩具，传真机，音响设备，医疗设备，美容设备，等其它电子产品领域。
简单的说，拨动开关就是通过拨动其执行机构（开关柄），来接通或断开电路。
通过拨动开关实现对信号的切换，电阻为上拉电阻。当二档拨动开关拨下去时，单片机控制引脚为低电平。当二档拨动开关拨上去时，单片机控制引脚为高电平。进而实现对信号的完美切换。其电路图如下图所示。
程序流程图
#include &#34;pbdata.h&#34; _record_obj record[NUM_RECORD];	//记录结构体 vu8 box_open=0;//记录药盒打开的状态，每一个二进制位代表一个药盒 u8 length_record = 0;//记录的个数 u8 count_save_record = 0;//记录保存的次数，需要保存时加1，完成一次保存则减1 void RecordInit(void)//记录初始化 { u8 i; //读写flash数据均为2个字节，所以数据长度为结构体数据长度除以2 STMFLASH_Read(ADDR_RECORD, (uint16_t *)&amp;record[0]." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b405c453e95d1d5c70198673dbedc9c5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-30T15:08:10+08:00" />
<meta property="article:modified_time" content="2023-09-30T15:08:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于STM32单片机的智能药盒定时提示吃药喂水蓝牙APP方案原理图设计</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>方案框图：</h3> 
<p><img src="https://images2.imgbox.com/da/f0/hXGCb2oC_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_3"></a><strong>原理图：</strong></h3> 
<p><img src="https://images2.imgbox.com/64/b6/WI13slmF_o.png" alt="在这里插入图片描述"></p> 
<p><strong>JDY-30蓝牙模块电路设计</strong></p> 
<p>蓝牙模块是指集成蓝牙功能的芯片基本电路集合，用于无线网络通讯。本蓝牙模块就是为了只能无线数据传输而专门打造的，本模块支持串行接口，支持SP蓝牙串口协议，具有成本低、体积小、收发灵敏性高等特点，只需配备少许的外围元件就能实现大功能。<br> 一、模块特点<br> （1）支持蓝牙 SPP 串口协议<br> （2）内置 PCB 天线<br> （3）支持 UART 接口<br> （4）蓝牙 Class 2<br> （5）数据传输比 BLE 蓝牙快、可达到 8K 每秒以上的速率<br> （6）支持与 SPP 主蓝牙模块连接通信（JDY-30 为从 SPP 蓝牙模块）<br> （7）支持与电脑 SPP 蓝牙通信<br> （8）支持 Android 手机 SPP 通信<br> 二、产品应用范围<br> （1） POS 机<br> （2）蓝牙打印机<br> （3）蓝牙玩具<br> （4）蓝牙高速数据传输产品应用<br> （5）小家电<br> （6）汽车电子<br> 三、模块技术参数<br> （1）工作电压：3.3V-6V<br> （2）工作温度：-40℃-85℃<br> （3）天线：PCB板载天线<br> （4）功耗：19mA<br> 四、模块接口说明<br> （1）RXD 串口输入，电平为TTL电平<br> （2）TXD 串口输出，电平为TTL电平<br> （3）GND 接GND<br> （4）VCC 接3.3V-6V<br> 蓝牙模块接口电路图如下图所示。<br> <img src="https://images2.imgbox.com/17/88/5TJIzxzZ_o.png" alt="在这里插入图片描述"><br> <strong>LED信号指示灯电路设计</strong></p> 
<p>LED灯即发光二极管，它是半导体二极管的一种，可以把电能转化成光能。发光二极管与普通二极管一样是由一个PN结组成，也具有单向导电性。在电路中，电阻的作用是限流，保护LED灯。只要单片机的控制引脚拉低，则LED灯亮，否则，LED灯不亮。其具体电路原理图如下图所示。<br> <img src="https://images2.imgbox.com/12/82/ByxDdyJT_o.png" alt="在这里插入图片描述"><br> <strong>二挡拨动开关检测电路设计</strong></p> 
<p>拨动开关是通过拨动开关柄使电路接通或断开，从而达到切换电路的目的的。拨动开关常用的品种有单极双位、单极三位、双极双位以及双极三位等，它一般用于低压电路，具有滑块动作灵活、性能稳定可靠的特点，拨动开关主要广泛用于:各种仪器/仪表设备，各种电动玩具，传真机，音响设备，医疗设备，美容设备，等其它电子产品领域。<br> 简单的说，拨动开关就是通过拨动其执行机构（开关柄），来接通或断开电路。<br> 通过拨动开关实现对信号的切换，电阻为上拉电阻。当二档拨动开关拨下去时，单片机控制引脚为低电平。当二档拨动开关拨上去时，单片机控制引脚为高电平。进而实现对信号的完美切换。其电路图如下图所示。<br> <img src="https://images2.imgbox.com/09/53/CdJqgpk2_o.png" alt="在这里插入图片描述"><br> <strong>程序流程图</strong></p> 
<p><img src="https://images2.imgbox.com/eb/90/aEZ4mLd9_o.png" alt="在这里插入图片描述"></p> 
<pre><code>
#include "pbdata.h"
_record_obj record[NUM_RECORD];	//记录结构体
vu8 box_open=0;//记录药盒打开的状态，每一个二进制位代表一个药盒
u8 length_record = 0;//记录的个数
u8 count_save_record = 0;//记录保存的次数，需要保存时加1，完成一次保存则减1

void RecordInit(void)//记录初始化
{
	u8 i;
//读写flash数据均为2个字节，所以数据长度为结构体数据长度除以2
	STMFLASH_Read(ADDR_RECORD, (uint16_t *)&amp;record[0].month,NUM_RECORD*sizeof(_record_obj)/2);
		for(i=0;i&lt;NUM_RECORD;i++){
			if(record[i].alive==MSG_TRUE){
				length_record++;
//				break;
			}
		}
}
//读写flash数据均为2个字节，所以数据长度为结构体数据长度除以2
void RecordRead(u8 recordNum)
{
	//从flash读取数据内容到内存
	STMFLASH_Read(ADDR_RECORD+sizeof(_record_obj)*recordNum, (uint16_t *)&amp;record[0].month,sizeof(_record_obj)/2);
}
//保存记录到flash
void RecordSaveAll()
{
	count_save_record++;
//	if(count_save_record&amp;0x80){//任务4被挂起
//		//当要保存的数据比较大时，保存数据的操作比较浪费时间，所以在一个单独的任务中执行
//		OSTaskResume(TASK_4_PRIO);	//恢复任务4,保存所有记录
//	}
}
//删除记录
void RecordDelete(u8 recordNum)
{
		record[recordNum].alive = MSG_FALSE;
		MoveRecord();
		RecordSaveAll();
		length_record--;
}
//删除记录，如删除第二条，则将第三条移动到第二条
void MoveRecord(void){
	u8 i=0,j=1;
		for(i=0;i&lt;NUM_RECORD-1;i++){
			if(record[i].alive!=MSG_TRUE){
				for(j=i+1;j&lt;NUM_RECORD;j++){
					if(record[j].alive==MSG_TRUE){
						record[i]=record[j]; 
						record[j].alive = MSG_FALSE;
						break;
					}
				}
			}
		}
}
//添加一条记录
void AddRecord(_calendar_obj time_now,u8 num){
	//记录总数有限制，保存满以后从头循环保存
	if(length_record==NUM_RECORD){
		record[0].alive=MSG_FALSE;
		MoveRecord();
	}
	else{
		length_record++;
	}
	//下面使用length_record-1，不是length_record，否则记录顺序不正确，甚至可能会数组越界而导致死机
		record[length_record-1].month 		= time_now.w_month;
		record[length_record-1].day 			= time_now.w_date;
		record[length_record-1].hour 			= time_now.hour;
		record[length_record-1].min 			= time_now.min;
		record[length_record-1].num_box 	= num;
		record[length_record-1].alive 		= MSG_TRUE;
		RecordSaveAll();
}
//查询并保存药盒打开记录
void RecordNow(void){
	u8 i=0;
	u16 gpio_key=KEY_PIN_1,gpio_led=LED_PIN_1;
	if(rtc_ok == MSG_FALSE){
		return;
	}
		for(i=0;i&lt;NUM_BOX;i++){
			switch(i){
				case 0:gpio_key=KEY_PIN_1;gpio_led=LED_PIN_1;break;
				case 1:gpio_key=KEY_PIN_2;gpio_led=LED_PIN_2;break;
				case 2:gpio_key=KEY_PIN_3;gpio_led=LED_PIN_3;break;
				default:break;
			}
			if(GPIO_ReadInputDataBit(KEY_PORT,gpio_key)){//1号药盒打开
				OSTimeDly(5);	
				if(GPIO_ReadInputDataBit(KEY_PORT,gpio_key) &amp;&amp; !(box_open&amp;(0x01&lt;&lt;i))){
					box_open |= 0x01&lt;&lt;i;
					alert_cancel |= 0x01&lt;&lt;i;//取消本次报警
					LED_OFF(LED_PORT,gpio_led);
					AddRecord(calendar,i+1);//记录药盒打开时间和编号
				}
			}
			else {
				box_open &amp;= ~(0x01&lt;&lt;i);
			}
		}
		if(alert_en&amp;(~alert_cancel)){
			Beep_ON();
		}
		else if(!alert_flash){
			Beep_OFF();
		}
}

</code></pre> 
<p>.</p> 
<p>链接：<a href="https://pan.baidu.com/s/1-pUy38R02RykPI3T6CKUhA" rel="nofollow">https://pan.baidu.com/s/1-pUy38R02RykPI3T6CKUhA </a><br> 提取码：5sev</p> 
<p>.</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/24607345d85015f63aa429a0158da892/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">《YOLO小目标检测》专栏介绍 &amp; CSDN独家改进创新实战&amp;专栏目录</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4848feb08ecfdf3f8a5b4abb79d84838/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于STM32单片机的大棚温湿度环境参数监测无线蓝牙APP控制方案原理图程序设计</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>