<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Kinect V2.0得到RGB图像各个像素点对应的三维坐标（相机坐标系） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Kinect V2.0得到RGB图像各个像素点对应的三维坐标（相机坐标系）" />
<meta property="og:description" content="Kinect2.0 SDK中有函数原型如下的映射机制，可得到1920*1080的RGB图像中各个像素点对应的相机坐标系下的三维坐标
public: HRESULT MapColorFrameToCameraSpace( UINT depthPointCount, const UINT16 *depthFrameData, UINT cameraPointCount, CameraSpacePoint *cameraSpacePoints ) 简单Demo如下
#include &lt;iostream&gt; #include &lt;opencv2/opencv.hpp&gt; #include &lt;Kinect.h&gt; using namespace std; using namespace cv; UINT16 *depthData = new UINT16[424 * 512];//深度图输出为512*424 CameraSpacePoint* m_pColorCoordinates = new CameraSpacePoint[1920 * 1080];//RGB图输出为1920*1080 int main(void) { HANDLE DetectorServiceThreadHandle = CreateThread(NULL, 0, DetectorServiceThread, NULL, 0, NULL); IKinectSensor * mySensor = nullptr; GetDefaultKinectSensor(&amp;mySensor); mySensor-&gt;Open(); IColorFrameSource * myColorSource = nullptr; mySensor-&gt;get_ColorFrameSource(&amp;myColorSource); IColorFrameReader * myColorReader = nullptr; myColorSource-&gt;OpenReader(&amp;myColorReader); int colorHeight = 0, colorWidth = 0; IFrameDescription * myDescription = nullptr; myColorSource-&gt;get_FrameDescription(&amp;myDescription); myDescription-&gt;get_Height(&amp;colorHeight); myDescription-&gt;get_Width(&amp;colorWidth); IColorFrame * myColorFrame = nullptr; Mat original(colorHeight, colorWidth, CV_8UC4);; //**********************ColorFrame************************** IDepthFrameSource * myDepthSource = nullptr; mySensor-&gt;get_DepthFrameSource(&amp;myDepthSource); int depthheight = 0, depthwidth = 0; IFrameDescription * myDepthDescription = nullptr; myDepthSource-&gt;get_FrameDescription(&amp;myDepthDescription); myDepthDescription-&gt;get_Height(&amp;depthheight); myDepthDescription-&gt;get_Width(&amp;depthwidth); myDepthDescription-&gt;Release(); IDepthFrameReader * myDepthReader = nullptr; myDepthSource-&gt;OpenReader(&amp;myDepthReader); IDepthFrame * myDepthFrame = nullptr; while（1）{ while (myDepthReader-&gt;AcquireLatestFrame(&amp;myDepthFrame) !" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/60252e86e50d4b16848f91a423a07287/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-12-29T13:41:37+08:00" />
<meta property="article:modified_time" content="2017-12-29T13:41:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Kinect V2.0得到RGB图像各个像素点对应的三维坐标（相机坐标系）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>Kinect2.0 SDK中有函数原型如下的映射机制，可得到1920*1080的RGB图像中各个像素点对应的相机坐标系下的三维坐标</p> 
<pre class="prettyprint"><code class=" hljs cs"><span class="hljs-keyword">public</span>:
HRESULT <span class="hljs-title">MapColorFrameToCameraSpace</span>(
         UINT depthPointCount,
         <span class="hljs-keyword">const</span> UINT16 *depthFrameData,
         UINT cameraPointCount,
         CameraSpacePoint *cameraSpacePoints
)</code></pre> 
<p>简单Demo如下</p> 
<pre class="prettyprint"><code class=" hljs cpp"><span class="hljs-preprocessor">#include &lt;iostream&gt;</span>
<span class="hljs-preprocessor">#include &lt;opencv2/opencv.hpp&gt;</span>
<span class="hljs-preprocessor">#include &lt;Kinect.h&gt; </span>
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;
<span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> cv;
UINT16 *depthData = <span class="hljs-keyword">new</span> UINT16[<span class="hljs-number">424</span> * <span class="hljs-number">512</span>];<span class="hljs-comment">//深度图输出为512*424</span>
CameraSpacePoint* m_pColorCoordinates = <span class="hljs-keyword">new</span> CameraSpacePoint[<span class="hljs-number">1920</span> * <span class="hljs-number">1080</span>];<span class="hljs-comment">//RGB图输出为1920*1080</span>
<span class="hljs-keyword">int</span> main(<span class="hljs-keyword">void</span>)
{
    HANDLE DetectorServiceThreadHandle = CreateThread(NULL, <span class="hljs-number">0</span>, DetectorServiceThread, NULL, <span class="hljs-number">0</span>, NULL);
    IKinectSensor   * mySensor = <span class="hljs-keyword">nullptr</span>;
    GetDefaultKinectSensor(&amp;mySensor);
    mySensor-&gt;Open();

    IColorFrameSource   * myColorSource = <span class="hljs-keyword">nullptr</span>;
    mySensor-&gt;get_ColorFrameSource(&amp;myColorSource);

    IColorFrameReader   * myColorReader = <span class="hljs-keyword">nullptr</span>;
    myColorSource-&gt;OpenReader(&amp;myColorReader);

    <span class="hljs-keyword">int</span> colorHeight = <span class="hljs-number">0</span>, colorWidth = <span class="hljs-number">0</span>;
    IFrameDescription   * myDescription = <span class="hljs-keyword">nullptr</span>;
    myColorSource-&gt;get_FrameDescription(&amp;myDescription);
    myDescription-&gt;get_Height(&amp;colorHeight);
    myDescription-&gt;get_Width(&amp;colorWidth);

    IColorFrame * myColorFrame = <span class="hljs-keyword">nullptr</span>;
    Mat original(colorHeight, colorWidth, CV_8UC4);;
    <span class="hljs-comment">//**********************ColorFrame**************************</span>

    IDepthFrameSource   * myDepthSource = <span class="hljs-keyword">nullptr</span>;   
    mySensor-&gt;get_DepthFrameSource(&amp;myDepthSource);
    <span class="hljs-keyword">int</span> depthheight = <span class="hljs-number">0</span>, depthwidth = <span class="hljs-number">0</span>;
    IFrameDescription   * myDepthDescription = <span class="hljs-keyword">nullptr</span>;  
    myDepthSource-&gt;get_FrameDescription(&amp;myDepthDescription);
    myDepthDescription-&gt;get_Height(&amp;depthheight);
    myDepthDescription-&gt;get_Width(&amp;depthwidth);
    myDepthDescription-&gt;Release();

    IDepthFrameReader   * myDepthReader = <span class="hljs-keyword">nullptr</span>;
    myDepthSource-&gt;OpenReader(&amp;myDepthReader);    

    IDepthFrame * myDepthFrame = <span class="hljs-keyword">nullptr</span>;
    <span class="hljs-keyword">while</span>（<span class="hljs-number">1</span>）{
    <span class="hljs-keyword">while</span> (myDepthReader-&gt;AcquireLatestFrame(&amp;myDepthFrame) != S_OK);
        myDepthFrame-&gt;CopyFrameDataToArray(depthheight * depthwidth, depthData);
        Mat depth_show_img = ConvertMat(depthData, <span class="hljs-number">512</span>, <span class="hljs-number">424</span>);
        <span class="hljs-comment">//用于展示</span>
        equalizeHist(depth_show_img, depth_show_img);
        imshow(<span class="hljs-string">"Show_Depth"</span>, depth_show_img);
        waitKey(<span class="hljs-number">50</span>);
        <span class="hljs-comment">//MAP_OPERATATION</span>
        HRESULT hr = myMapper-&gt;MapColorFrameToCameraSpace(<span class="hljs-number">512</span> * <span class="hljs-number">424</span>, depthData, <span class="hljs-number">1920</span> * <span class="hljs-number">1080</span>, m_pColorCoordinates);
        <span class="hljs-comment">//设置定点（100，100）</span>
        Point static_p1;
        static_p1.x=<span class="hljs-number">100</span>;
        static_p1.y=<span class="hljs-number">100</span>;
        <span class="hljs-keyword">float</span> static_p1_X = m_pColorCoordinates[static_p1.y * <span class="hljs-number">1920</span> + static_p1.x].X;
        <span class="hljs-keyword">float</span> static_p1_Y = m_pColorCoordinates[static_p1.y * <span class="hljs-number">1920</span> + static_p1.x].Y;
        <span class="hljs-keyword">float</span> static_p1_Z = m_pColorCoordinates[static_p1.y * <span class="hljs-number">1920</span> + static_p1.x].Z;
        <span class="hljs-comment">//输出RGB图像中定点（100，100）对应相机坐标系下的三维点（X,Y,Z）</span>
        <span class="hljs-built_in">cout</span>&lt;&lt;<span class="hljs-string">"X:"</span>&lt;&lt;static_p1_X&lt;&lt;endl;
        <span class="hljs-built_in">cout</span>&lt;&lt;<span class="hljs-string">"Y:"</span>&lt;&lt;static_p1_Y&lt;&lt;endl;
        <span class="hljs-built_in">cout</span>&lt;&lt;<span class="hljs-string">"Z:"</span>&lt;&lt;static_p1_Z&lt;&lt;endl;
        myDepthFrame-&gt;Release();
        myColorFrame-&gt;Release();
    }
    myMapper-&gt;Release();
    myDescription-&gt;Release();
    myColorReader-&gt;Release();
    myColorSource-&gt;Release();
    mySensor-&gt;Close();
    mySensor-&gt;Release();

    <span class="hljs-keyword">return</span>  <span class="hljs-number">0</span>;
}
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bc845703e60a7e12aed0600c1feb6d7b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C3P0连接池参数详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ceac4379865ec3382c17b032b8997962/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">spring data jpa 学习整理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>