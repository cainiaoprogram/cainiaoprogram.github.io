<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>STM32的时钟系统RCC详细整理 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="STM32的时钟系统RCC详细整理" />
<meta property="og:description" content="一、综述： 1、时钟源
在 STM32 中，一共有 5 个时钟源，分别是 HSI 、 HSE 、 LSI 、 LSE 、 PLL 。
①HSI 是高速内部时钟， RC 振荡器，频率为 8MHz ； ②HSE 是高速外部时钟，可接石英 / 陶瓷谐振器，或者接外部时钟源，频率范围是 4MHz – 16MHz ； ③LSI 是低速内部时钟， RC 振荡器，频率为 40KHz ； ④LSE 是低速外部时钟，接频率为 32.768KHz 的石英晶体； ⑤PLL 为锁相环倍频输出，严格的来说并不算一个独立的时钟源， PLL 的输入可以接 HSI/2 、 HSE 或者 HSE/2 。PLL倍频可选择为 2 – 16 倍，但是其输出频率最大不得超过 72MHz 。 其中， 40kHz 的 LSI 供独立看门狗 IWDG 使用，另外它还可以被选择为实时时钟 RTC 的时钟源。另外，实时时钟 RTC 的时钟源还可以选择 LSE ，或者是 HSE 的 128 分频。 STM32 中有一个全速功能的 USB 模块，其串行接口引擎需要一个频率为 48MHz 的时钟源。该时钟源只能从 PLL 端获取，可以选择为 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b09b80c83c96464f7f7839b20bfc8e7f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-12-26T10:53:35+08:00" />
<meta property="article:modified_time" content="2017-12-26T10:53:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">STM32的时钟系统RCC详细整理</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    一、综述： 
<strong></strong> 
<p><strong>1</strong><span style="font-family:宋体"><strong>、时钟源</strong></span></p> 
<p><span style="font-family:宋体">在</span> STM32 <span style="font-family:宋体">中，一共有</span> 5 <span style="font-family:宋体">个时钟源，分别是</span> HSI <span style="font-family:宋体">、</span> HSE <span style="font-family:宋体">、</span> LSI <span style="font-family:宋体">、</span> LSE <span style="font-family:宋体">、</span> PLL <span style="font-family:宋体">。</span></p> 
<p> <span style="font-family:宋体">①</span>HSI <span style="font-family:宋体">是高速内部时钟，</span> RC <span style="font-family:宋体">振荡器，频率为</span> 8MHz <span style="font-family:宋体">；</span> </p> 
<p> <span style="font-family:宋体">②</span>HSE <span style="font-family:宋体">是高速外部时钟，可接石英</span> / <span style="font-family:宋体">陶瓷谐振器，或者接外部时钟源，频率范围是</span> 4MHz – 16MHz <span style="font-family:宋体"> ；</span> </p> 
<p> <span style="font-family:宋体">③</span>LSI <span style="font-family:宋体">是低速内部时钟，</span> RC <span style="font-family:宋体">振荡器，频率为</span> 40KHz <span style="font-family:宋体">；</span> </p> 
<p> <span style="font-family:宋体">④</span>LSE <span style="font-family:宋体">是低速外部时钟，接频率为</span> 32.768KHz <span style="font-family:宋体">的石英晶体；</span> </p> 
<p> <span style="font-family:宋体">⑤</span>PLL <span style="font-family:宋体">为锁相环倍频输出，严格的来说并不算一个独立的时钟源，</span> PLL <span style="font-family:宋体">的输入可以接</span> HSI/2 <span style="font-family:宋体">、</span> HSE <span style="font-family:宋体">或者</span> HSE/2 <span style="font-family:宋体">。</span><span style="color:red">PLL</span><span style="color:red"><span style="font-family:宋体">倍频可选择为</span></span><span style="color:red"> 2 – 16 </span><span style="font-family:宋体"><span style="color:red">倍</span>，但是其输出频率最大不得超过</span> 72MHz <span style="font-family:宋体">。</span> </p> 
<p><span style="font-family:宋体">其中， </span>40kHz<span style="font-family:宋体"> 的 </span> LSI<span style="font-family:宋体"> 供独立看门狗 </span>IWDG<span style="font-family:宋体"> 使用，另外它还可以被选择为实时时钟 </span>RTC<span style="font-family:宋体"> 的时钟源。另外，实时时钟 </span>RTC<span style="font-family:宋体"> 的时钟源还可以选择 </span>LSE<span style="font-family:宋体"> ，或者是 </span>HSE<span style="font-family:宋体"> 的 </span>128<span style="font-family:宋体"> 分频。 </span></p> 
<p>STM32<span style="font-family:宋体"> 中有一个全速功能的 </span>USB<span style="font-family:宋体"> 模块，其串行接口引擎需要一个频率为 </span>48MHz<span style="font-family:宋体"> 的时钟源。该时钟源只能从 </span>PLL<span style="font-family:宋体"> 端获取，可以选择为 </span>1.5<span style="font-family:宋体"> 分频或者 </span>1<span style="font-family:宋体"> 分频，也就是，当需使用到 </span>USB<span style="font-family:宋体"> 模块时， </span>PLL<span style="font-family:宋体"> 必须使能，并且时钟配置为 </span>48MHz<span style="font-family:宋体"> 或 </span>72MHz<span style="font-family:宋体"> 。 </span></p> 
<p><span style="font-family:宋体">另外 </span>STM32<span style="font-family:宋体"> 还可以选择一个时钟信号输出到 </span>MCO<span style="font-family:宋体"> 脚 </span>(PA.8)<span style="font-family:宋体"> 上，可以选择为 </span>PLL<span style="font-family:宋体"> 输出的 </span>2<span style="font-family:宋体"> 分频、 </span>HSI<span style="font-family:宋体"> 、 </span>HSE<span style="font-family:宋体"> 或者系统时钟。 </span></p> 
<p><span style="font-family:宋体">系统时钟 </span>SYSCLK<span style="font-family:宋体"> ，它是提供 </span>STM32<span style="font-family:宋体"> 中绝大部分部件工作的时钟源。系统时钟可以选择为 </span>PLL<span style="font-family:宋体"> 输出、 </span>HSI<span style="font-family:宋体"> 、 </span>HSE<span style="font-family:宋体"> 。系系统时钟最大频率为 </span>72MHz<span style="font-family:宋体"> ，它通过 </span>AHB<span style="font-family:宋体"> 分频器分频后送给各个模块使用， </span><span style="color:red">AHB</span><span style="font-family:宋体"><span style="color:red">分频器可以选择</span></span><span style="color:red">1</span><span style="font-family:宋体"><span style="color:red">、</span></span><span style="color:red">2</span><span style="font-family:宋体"><span style="color:red">、</span></span><span style="color:red">4</span><span style="font-family:宋体"><span style="color:red">、</span></span><span style="color:red">8</span><span style="font-family:宋体"><span style="color:red">、</span></span><span style="color:red">16</span><span style="font-family:宋体"><span style="color:red">、</span></span><span style="color:red">64</span><span style="font-family:宋体"><span style="color:red">、</span></span><span style="color:red">128</span><span style="font-family:宋体"><span style="color:red">、</span></span><span style="color:red">256</span><span style="font-family:宋体"><span style="color:red">、</span></span><span style="color:red">512</span><span style="font-family:宋体"><span style="color:red">分频</span>，</span>AHB<span style="font-family:宋体">分频器输出的时钟送给 </span>5<span style="font-family:宋体"> 大模块使用： </span></p> 
<p>       <span style="font-family:宋体">①送给 </span>AHB<span style="font-family:宋体"> 总线、内核、内存和 </span>DMA<span style="font-family:宋体"> 使用的 </span>HCLK<span style="font-family:宋体"> 时钟； </span></p> 
<p>       <span style="font-family:宋体">②通过 </span>8<span style="font-family:宋体"> 分频后送给 </span>Cortex<span style="font-family:宋体"> 的系统定时器时钟</span>STCLK<span style="font-family:宋体">； </span></p> 
<p>       <span style="font-family:宋体">③直接送给 </span>Cortex<span style="font-family:宋体"> 的空闲运行时钟 </span>FCLK<span style="font-family:宋体"> ； </span></p> 
<p>       <span style="font-family:宋体">④送给 </span>APB1<span style="font-family:宋体"> 分频器。 </span><span style="color:red">APB1</span><span style="font-family:宋体"><span style="color:red">分频器可以选择</span></span><span style="color:red">1</span><span style="font-family:宋体"><span style="color:red">、</span></span><span style="color:red">2</span><span style="font-family:宋体"><span style="color:red">、</span></span><span style="color:red">4</span><span style="font-family:宋体"><span style="color:red">、</span></span><span style="color:red">8</span><span style="font-family:宋体"><span style="color:red">、</span></span><span style="color:red">16</span><span style="font-family:宋体"><span style="color:red">分频</span>，其输出一路供 </span>APB1<span style="font-family:宋体"> 外设使用（ </span>PCLK1<span style="font-family:宋体"> ，<span style="color:fuchsia">最大频率</span></span><span style="color:fuchsia">36MHz</span><span style="font-family:宋体">），另一路送给定时器 </span>(Timer)2<span style="font-family:宋体"> 、 </span>3<span style="font-family:宋体"> 、 </span>4<span style="font-family:宋体"> 倍频器使用。该倍频器根据</span>PCLK1<span style="font-family:宋体">的分频值自动选择 </span>1<span style="font-family:宋体"> 或者 </span>2<span style="font-family:宋体"> 倍频，时钟输出供定时器 </span>2<span style="font-family:宋体"> 、 </span>3<span style="font-family:宋体"> 、 </span> 4<span style="font-family:宋体"> 使用。 </span></p> 
<p>       <span style="font-family:宋体">⑤送给 </span>APB2<span style="font-family:宋体"> 分频器。 </span><span style="color:red">APB2</span><span style="font-family:宋体"><span style="color:red">分频器可以选择</span></span><span style="color:red">1</span><span style="font-family:宋体"><span style="color:red">、</span></span><span style="color:red">2</span><span style="font-family:宋体"><span style="color:red">、</span></span><span style="color:red">4</span><span style="font-family:宋体"><span style="color:red">、</span></span><span style="color:red">8</span><span style="font-family:宋体"><span style="color:red">、</span></span><span style="color:red">16</span><span style="font-family:宋体"><span style="color:red">分频</span>，其输出一路供 </span>APB2<span style="font-family:宋体"> 外设使用（ </span>PCLK2<span style="font-family:宋体"> ，最大频率 </span>72MHz<span style="font-family:宋体"> ），另外一路送给定时器 </span>(Timer)1<span style="font-family:宋体"> 倍频使用。该倍频器根据</span>PCLK2<span style="font-family:宋体">的分频值自动选择</span>1<span style="font-family:宋体"> 或 </span>2<span style="font-family:宋体"> 倍频，时钟输出供定时器 </span>1<span style="font-family:宋体"> 使用。另外 </span>APB2<span style="font-family:宋体"> 分频器还有一路输出供 </span>ADC<span style="font-family:宋体"> 分频器使用，分频后送给 </span>ADC<span style="font-family:宋体"> 模块使用。 </span><span style="color:red">ADC</span><span style="font-family:宋体"><span style="color:red">分频器可选择为</span></span><span style="color:red">2</span><span style="font-family:宋体"><span style="color:red">、</span></span><span style="color:red">4</span><span style="font-family:宋体"><span style="color:red">、</span></span><span style="color:red">6</span><span style="font-family:宋体"><span style="color:red">、</span></span><span style="color:red">8</span><span style="font-family:宋体"><span style="color:red">分频</span>。 </span></p> 
<p><span style="font-family:宋体"><span style="color:fuchsia">需要注意的是定时器的倍频器，当</span></span><span style="color:fuchsia">APB</span><span style="font-family:宋体"><span style="color:fuchsia">的分频为</span></span><span style="color:fuchsia">1</span><span style="font-family:宋体"><span style="color:fuchsia">时，它的倍频值为</span></span><span style="color:fuchsia">1</span><span style="font-family:宋体"><span style="color:fuchsia">，否则它的倍频值就为</span></span><span style="color:fuchsia">2</span><span style="font-family:宋体"><span style="color:fuchsia">。</span></span></p> 
<p><span style="color:fuchsia"><span style="font-family:宋体"> <img src="https://images2.imgbox.com/b5/93/3hoDrk6V_o.jpg" alt=""></span></span></p> 
<p><strong>2<span style="font-family:宋体">、</span>APB1<span style="font-family:宋体">和</span>APB2</strong><span style="font-family:宋体"><strong>连接的模块</strong></span></p> 
<p><span style="font-family:宋体">①连接在 </span>APB1(<span style="font-family:宋体"> 低速外设 </span>)<span style="font-family:宋体"> 上的设备有：电源接口、备份接口、 </span>CAN<span style="font-family:宋体"> 、 </span>USB<span style="font-family:宋体"> 、 </span>I2C1<span style="font-family:宋体"> 、 </span>I2C2<span style="font-family:宋体"> 、 </span>UART2<span style="font-family:宋体"> 、 </span>UART3<span style="font-family:宋体"> 、 </span>SPI2<span style="font-family:宋体"> 、窗口看门狗、 </span>Timer2<span style="font-family:宋体"> 、 </span>Timer3<span style="font-family:宋体"> 、 </span>Timer4<span style="font-family:宋体"> 。</span><strong> <span style="color:fuchsia"> <span style="font-family:宋体">注意</span></span><span style="color:fuchsia"> USB</span></strong><span style="font-family:宋体"><strong><span style="color:fuchsia">模块虽然需要一个单独的</span></strong></span><strong><span style="color:fuchsia">48MHz</span></strong><span style="font-family:宋体"><strong><span style="color:fuchsia">的时钟信号，但是它应该不是供</span></strong></span><strong><span style="color:fuchsia">USB</span></strong><span style="font-family:宋体"><strong><span style="color:fuchsia">模块工作的时钟，而只是提供给串行接口引擎</span></strong></span><strong><span style="color:fuchsia">(SIE)</span></strong><span style="font-family:宋体"><strong><span style="color:fuchsia">使用的时钟。</span></strong></span><strong><span style="color:fuchsia">USB</span></strong><span style="font-family:宋体"><strong><span style="color:fuchsia">模块的工作时钟应该是由</span></strong></span><strong><span style="color:fuchsia">APB1</span></strong><span style="font-family:宋体"><strong><span style="color:fuchsia">提供的。</span> </strong></span></p> 
<p><span style="font-family:宋体">②连接在 </span>APB2<span style="font-family:宋体"> （高速外设）上的设备有： </span>UART1<span style="font-family:宋体"> 、 </span>SPI1<span style="font-family:宋体"> 、 </span>Timer1<span style="font-family:宋体"> 、 </span>ADC1<span style="font-family:宋体"> 、 </span>ADC2<span style="font-family:宋体"> 、 </span>GPIOx(PA~PE)<span style="font-family:宋体"> 、第二功能</span> IO <span style="font-family:宋体">口。</span></p> 
<p><span style="font-family:宋体"> <img src="https://images2.imgbox.com/d6/5b/EACN5SXz_o.jpg" alt=""></span></p> 
<p></p> 
<p><strong>二、寄存器介绍：</strong></p> 
<p>typedef struct</p> 
<p>{<!-- --></p> 
<p>  __IO uint32_t CR;</p> 
<p>  __IO uint32_t CFGR;</p> 
<p>  __IO uint32_t CIR;</p> 
<p>  __IO uint32_t APB2RSTR;</p> 
<p>  __IO uint32_t APB1RSTR;</p> 
<p>  __IO uint32_t AHBENR;</p> 
<p>  __IO uint32_t APB2ENR;</p> 
<p>  __IO uint32_t APB1ENR;</p> 
<p>  __IO uint32_t BDCR;</p> 
<p>  __IO uint32_t CSR;</p> 
<p>#ifdef STM32F10X_CL  </p> 
<p>  __IO uint32_t AHBRSTR;</p> 
<p>  __IO uint32_t CFGR2;</p> 
<p>#endif /* STM32F10X_CL */ </p> 
<p>#if defined (STM32F10X_LD_VL) || defined (STM32F10X_MD_VL) || defined (STM32F10X_HD_VL)   </p> 
<p>  uint32_t RESERVED0;</p> 
<p>  __IO uint32_t CFGR2;</p> 
<p>#endif /* STM32F10X_LD_VL || STM32F10X_MD_VL || STM32F10X_HD_VL */ </p> 
<p>} RCC_TypeDef;</p> 
<p>1<span style="font-family:宋体">、时钟控制寄存器</span>(RCC_CR)<span style="font-family:宋体">：（复位值为</span>0x0000 xx83<span style="font-family:宋体">，内部低速时钟使能和就绪，内部时钟校准）</span></p> 
<p><span style="font-family:宋体">主要功能：<span style="color:red">内外部高速时钟的使能和就绪标志</span>（含内部高速时钟校准调整），外部高速时钟旁路，时钟安全系统CSS使能，<span style="color:red">PLL</span><span style="color:red">使能和PLL</span>就绪标志。</span></p> 
<p>2<span style="font-family:宋体">、时钟配置寄存器</span>(RCC_CFGR)<span style="font-family:宋体">：（复位值为</span>0x0000 0000<span style="font-family:宋体">）</span></p> 
<p><span style="font-family:宋体">主要功能：<span style="color:red">系统时钟源切换</span>及状态，<span style="color:red">AHB</span><span style="color:red">、APB1</span>、APB2、ADC、USB预分频，<span style="color:red">PLL</span><span style="color:red">输入时钟源选择及HSE</span>输入PLL分频选择，<span style="color:red">PLL</span><span style="color:red">倍频系数</span>，MCO（PA8）引脚微控制器时钟输出。</span></p> 
<p><span style="font-family:宋体">3、时钟中断寄存器 (RCC_CIR)：（复位值: 0x0000 0000）</span></p> 
<p><span style="font-family:宋体">主要功能：<span style="color:red">LSI</span><span style="color:red">、LSE</span>、HIS、HSE、PLL就绪中断标志，HSE时钟失效导致时钟安全系统中断标志，<span style="color:red">LSI</span><span style="color:red">、LSE</span>、HIS、HSE、PLL就绪中断使能，清除LSI、LSE、HIS、HSE、PLL就绪中断，清除时钟安全系统中断。</span></p> 
<p><span style="font-family:宋体">4、APB2外设复位寄存器 (RCC_APB2RSTR)：（复位值: 0x0000 0000）</span></p> 
<p><span style="font-family:宋体">主要功能：AFIO、IOPA、IOPB、IOPC、IOPD、IOPE、IOPF、IOPG、ADC1、ADC2、TIM1、SPI1、TIM8、USART1、ADC3复位。</span></p> 
<p><span style="font-family:宋体">5、APB1外设复位寄存器 (RCC_APB1RSTR) ：（复位值: 0x0000 0000）</span></p> 
<p><span style="font-family:宋体">主要功能：TIM2、TIM3、TIM4、TIM5、TIM6、TIM7、WWDG、SPI2、SPI3、USART2、USART3、USART4、USART5、I2C1、I2C2、USB、CAN、BKP、PWR、DAC复位。</span></p> 
<p><span style="font-family:宋体">6、AHB外设时钟使能寄存器 (RCC_AHBENR) ：（复位值: 0x0000 0014睡眠模式时SRAM、闪存接口电路时钟开启）</span></p> 
<p><span style="font-family:宋体">主要功能：<span style="color:red">DMA1</span><span style="color:red">、DMA2</span>、SRAM、FLITF、CRC、FSMC、SDIO时钟使能。</span></p> 
<p><span style="font-family:宋体">7、APB2外设时钟使能寄存器(RCC_APB2ENR) ：（复位值: 0x0000 0000）</span></p> 
<p><span style="font-family:宋体">主要功能：<span style="color:red">AFIO</span><span style="color:red">、IOPA</span>、IOPB、IOPC、IOPD、IOPE、IOPF、IOPG、ADC1、ADC2、TIM1、SPI1、TIM8、USART1、ADC3时钟使能。</span></p> 
<p><span style="font-family:宋体">8、APB1外设时钟使能寄存器(RCC_APB1ENR) ：（复位值: 0x0000 0000）</span></p> 
<p><span style="font-family:宋体">主要功能：<span style="color:red">TIM2</span><span style="color:red">、TIM3</span>、TIM4、TIM5、TIM6、TIM7、WWDG、SPI2、SPI3、USART2、USART3、USART4、USART5、I2C1、I2C2、USB、CAN、BKP、PWR、DAC时钟使能。</span></p> 
<p><span style="font-family:宋体">9、备份域控制寄存器 (RCC_BDCR) ：（复位值: 0x0000 0000）</span></p> 
<p><span style="font-family:宋体">主要功能：外部低速振荡器使能和就绪标志及旁路、<span style="color:red">RTC</span><span style="color:red">时钟源选择和时钟使能</span>、备份域软件复位。</span></p> 
<p><span style="font-family:宋体">10、控制/状态寄存器 (RCC_CSR) ：（复位值: 0x0C00 0000 NRST引脚复位标志、上电/掉电复位标志）</span></p> 
<p><span style="font-family:宋体">主要功能：内部低速振荡器就绪、清除复位标志、NRST引脚复位标志、上电/掉电复位标志、软件复位标志、独立看门狗复位标志、窗口看门狗复位标志、低功耗复位标志。</span></p> 
<p><strong>三、初始化设置</strong></p> 
<p><span style="font-family:宋体">采用</span>8MHz <span style="font-family:宋体">外部</span>HSE <span style="font-family:宋体">时钟，在</span> MDK <span style="font-family:宋体">编译平台中，程序的时钟设置参数流程如下：</span> </p> 
<p>    <span style="font-family:宋体">将</span> RCC <span style="font-family:宋体">寄存器重新设置为默认值：</span>RCC_DeInit(); </p> 
<p>    <span style="font-family:宋体">打开外部高速时钟晶振</span> HSE <span style="font-family:宋体"> ：</span>    RCC_HSEConfig(RCC_HSE_ON); </p> 
<p>    <span style="font-family:宋体">等待外部高速时钟晶振工作：</span>       HSEStartUpStatus = RCC_WaitForHSEStartUp(); </p> 
<p>    <span style="font-family:宋体">设置</span> AHB <span style="font-family:宋体">时钟</span> (HCLK) <span style="font-family:宋体">：</span>          RCC_HCLKConfig(RCC_SYSCLK_Div1);</p> 
<p>        <span style="font-family:宋体">设置</span>APB 2<span style="font-family:宋体">时钟</span> (APB2) <span style="font-family:宋体">：</span>    RCC_PCLK2Config(RCC_HCLK_Div1);</p> 
<p>        <span style="font-family:宋体">设置</span>APB1 <span style="font-family:宋体"> 时钟</span> (APB1) <span style="font-family:宋体">：</span>    RCC_PCLK1Config(RCC_HCLK_Div2);</p> 
<p>        <span style="font-family:宋体">设置</span> PLL <span style="font-family:宋体"> ：</span>       RCC_PLLConfig(RCC_PLLSource_HSE_Div1, RCC_PLLMul_9);</p> 
<p>    <span style="font-family:宋体">打开</span> PLL <span style="font-family:宋体">：</span>                                  RCC_PLLCmd(ENABLE); </p> 
<p>    <span style="font-family:宋体">等待</span> PLL <span style="font-family:宋体">工作：</span>    while(RCC_GetFlagStatus(RCC_FLAG_PLLRDY) == RESET); </p> 
<p><span style="font-family:宋体">设置系统时钟：</span>    RCC_SYSCLKConfig(RCC_SYSCLKSource_PLLCLK);</p> 
<p><span style="font-family:宋体">判断</span> PLL <span style="font-family:宋体">是否是系统时钟：</span>        while(RCC_GetSYSCLKSource() != 0x08); </p> 
<p><strong>1</strong><span style="font-family:宋体"><strong>、使用库函数进行时钟系统初始化配置</strong></span></p> 
<p>void RCC_config()//<span style="font-family:宋体">如果外部晶振为</span>8M<span style="font-family:宋体">，</span>PLLCLK=SYSCLK=72M<span style="font-family:宋体">，</span>HCLK=72M<span style="font-family:宋体">，</span>//P2CLK=72M<span style="font-family:宋体">，</span>P1CLK=36M<span style="font-family:宋体">，</span>ADCCLK=36M<span style="font-family:宋体">，</span>USBCLK=48M<span style="font-family:宋体">，</span>TIMCLK=72M</p> 
<p>{<!-- --></p> 
<p>       ErrorStatus HSEStartUpStatus;//<span style="font-family:宋体"> 定义错误状态变量</span></p> 
<p>       RCC_DeInit();//<span style="font-family:宋体">将</span>RCC<span style="font-family:宋体">寄存器重新设置为默认值</span></p> 
<p>       RCC_HSEConfig(RCC_HSE_ON);//<span style="font-family:宋体">打开外部高速时钟晶振</span></p> 
<p>       HSEStartUpStatus = RCC_WaitForHSEStartUp();//<span style="font-family:宋体"> 等待外部高速时钟晶振工作</span></p> 
<p>       if(HSEStartUpStatus == SUCCESS)</p> 
<p>       {<!-- --></p> 
<p>       RCC_HCLKConfig(RCC_SYSCLK_Div1);//<span style="font-family:宋体">设置</span>AHB<span style="font-family:宋体">不分频，</span>HCLK=SYSCLK</p> 
<p>       RCC_PCLK2Config(RCC_HCLK_Div1);//<span style="font-family:宋体">设置</span>APB2<span style="font-family:宋体">不分频，</span>P2CLK=HCLK</p> 
<p>       RCC_PCLK1Config(RCC_HCLK_Div2);//<span style="font-family:宋体">设置</span>APB1 <span style="font-family:宋体">为</span>2<span style="font-family:宋体">分频，</span>P1CLK=HCLK/2</p> 
<p>       FLASH_SetLatency(FLASH_Latency_2);//<span style="font-family:宋体">设置</span>FLASH<span style="font-family:宋体">代码延时</span></p> 
<p>       FLASH_PrefetchBufferCmd(FLASH_PrefetchBuffer_Enable);//<span style="font-family:宋体">使能预取指缓存</span></p> 
<p>       RCC_PLLConfig(RCC_PLLSource_HSE_Div1, <span style="color:red">RCC_PLLMul_9</span>);//<span style="font-family:宋体">设置</span>PLL<span style="font-family:宋体">时钟源，</span></p> 
<p>//<span style="font-family:宋体">外部时钟不分频，为</span>HSE<span style="font-family:宋体">的</span>9<span style="font-family:宋体">倍频</span>8MHz * 9 = 72MHz</p> 
<p>       RCC_PLLCmd(ENABLE);//<span style="font-family:宋体">使能</span>PLL</p> 
<p>       while(RCC_GetFlagStatus(RCC_FLAG_PLLRDY) == RESET);//<span style="font-family:宋体">等待</span>PLL<span style="font-family:宋体">准备就绪</span></p> 
<p>       RCC_SYSCLKConfig(RCC_SYSCLKSource_PLLCLK);//<span style="font-family:宋体">设置</span>PLL<span style="font-family:宋体">为系统时钟源</span></p> 
<p>       while(RCC_GetSYSCLKSource() != 0x08);//<span style="font-family:宋体">判断</span>PLL<span style="font-family:宋体">是否是系统时钟</span></p> 
<p>       }</p> 
<p>            /*RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOB | RCC_APB2Periph_GPIOD, ENABLE);//<span style="font-family:宋体"> 打开 </span>PB<span style="font-family:宋体"> 和 </span>PD<span style="font-family:宋体"> 用于点亮 </span>LED<span style="font-family:宋体"> 灯</span>*/</p> 
<p>}</p> 
<p><strong>2<span style="font-family:宋体">、使用寄存器进行</span>RCC</strong><span style="font-family:宋体"><strong>时钟初始化配置</strong></span></p> 
<p>void RCC_init(u8 PLL)//<span style="font-family:宋体">输入</span>PLL<span style="font-family:宋体">的倍频值</span>2<span style="font-family:宋体">—</span>16<span style="font-family:宋体">倍频</span></p> 
<p>//HCLK=PLLCLK=SYSCLK=P2CLK=P1CLK*2=ADCCLK*2=TIMCLK=USBCLK*2/3</p> 
<p>{<!-- --></p> 
<p>       unsigned char temp=0;   </p> 
<p>       //RCC_DeInit();              //<span style="font-family:宋体">将</span>RCC<span style="font-family:宋体">寄存器重新设置为默认值</span></p> 
<p>       RCC-&gt;CR|=0x00010000;  //<span style="font-family:宋体">外部高速时钟使能</span>HSEON</p> 
<p>       while(!(RCC-&gt;CR&gt;&gt;17));//<span style="font-family:宋体">等待外部时钟就绪</span></p> 
<p>       RCC-&gt;CFGR=0X00000400; //APB1=DIV2;APB2=DIV1;AHB=DIV1;</p> 
<p>       PLL-=2;//<span style="font-family:宋体">抵消</span>2<span style="font-family:宋体">个单位</span></p> 
<p>       RCC-&gt;CFGR|=<span style="color:red">PLL</span>&lt;&lt;18;   //<span style="font-family:宋体">设置</span>PLL<span style="font-family:宋体">倍频值</span> 2~16</p> 
<p>       RCC-&gt;CFGR|=1&lt;&lt;16;     //PLL<span style="font-family:宋体">时钟源选择</span> </p> 
<p>       FLASH-&gt;ACR|=0x32;     //FLASH 2<span style="font-family:宋体">个延时周期</span></p> 
<p>       RCC-&gt;CR|=0x01000000;  //PLLON</p> 
<p>       while(!(RCC-&gt;CR&gt;&gt;25));//<span style="font-family:宋体">等待</span>PLL<span style="font-family:宋体">锁定</span></p> 
<p>       RCC-&gt;CFGR|=0x00000002;//PLL<span style="font-family:宋体">作为系统时钟</span>       </p> 
<p>       while(temp!=0x02)     //<span style="font-family:宋体">等待</span>PLL<span style="font-family:宋体">作为系统时钟设置成功</span></p> 
<p>       {   </p> 
<p>              temp=RCC-&gt;CFGR&gt;&gt;2;</p> 
<p>              temp&amp;=0x03;</p> 
<p>       }    </p> 
<p>}</p> 
<p><strong>四、相关库函数解析</strong></p> 
<p>1<span style="font-family:宋体">、库中所涉及到的结构体</span></p> 
<p>typedef struct</p> 
<p>{<!-- --></p> 
<p>  uint32_t SYSCLK_Frequency;  /*!&lt; returns SYSCLK clock frequency expressed in Hz */</p> 
<p>  uint32_t HCLK_Frequency;    /*!&lt; returns HCLK clock frequency expressed in Hz */</p> 
<p>  uint32_t PCLK1_Frequency;   /*!&lt; returns PCLK1 clock frequency expressed in Hz */</p> 
<p>  uint32_t PCLK2_Frequency;   /*!&lt; returns PCLK2 clock frequency expressed in Hz */</p> 
<p>  uint32_t ADCCLK_Frequency; /*!&lt; returns ADCCLK clock frequency expressed in Hz */</p> 
<p>}RCC_ClocksTypeDef;</p> 
<p>2<span style="font-family:宋体">、库函数解析</span></p> 
<p>void RCC_DeInit(void);//<span style="font-family:宋体">将外设</span>RCC<span style="font-family:宋体">寄存器设为缺省值；（除</span>RCC_BDCR<span style="font-family:宋体">和</span>RCC_CSR<span style="font-family:宋体">）</span></p> 
<p>void RCC_HSEConfig(uint32_t RCC_HSE);//<span style="font-family:宋体">设置外部高速晶振（</span>HSE<span style="font-family:宋体">）；</span></p> 
<p>//<span style="font-family:宋体">输入：</span>RCC_HSE_OFF<span style="font-family:宋体">，</span>RCC_HSE_ON<span style="font-family:宋体">，</span>RCC_HSE_Bypass(HSE<span style="font-family:宋体">旁路</span>)</p> 
<p>ErrorStatus RCC_WaitForHSEStartUp(void);//<span style="font-family:宋体">等待</span>HSE<span style="font-family:宋体">起振；</span></p> 
<p><span style="font-family:宋体">//返回值：SUCCESS,HSE晶振稳定且就绪；ERROR，HSE晶振未就绪</span></p> 
<p>void RCC_AdjustHSICalibrationValue(uint8_t HSICalibrationValue);//<span style="font-family:宋体">调整内部高速晶振（</span>HSI<span style="font-family:宋体">）校准值</span></p> 
<p>//<span style="font-family:宋体">输入：校准补偿值（该参数取值必须在</span>0<span style="font-family:宋体">到</span>0x1F<span style="font-family:宋体">之间）</span></p> 
<p>void RCC_HSICmd(FunctionalState NewState);//<span style="font-family:宋体">使能或者失能内部高速晶振（</span>HSI<span style="font-family:宋体">）</span></p> 
<p>//<span style="font-family:宋体; font-size:14px">输入：</span>ENABLE<span style="font-family:宋体">或者</span>DISABLE<span style="font-family:宋体">（如果</span>HSI<span style="font-family:宋体">被用于系统时钟，或者</span>FLASH<span style="font-family:宋体">编写操作进行中，那么它不能被停振）</span></p> 
<p>void RCC_PLLConfig(uint32_t RCC_PLLSource, uint32_t RCC_PLLMul);//<span style="font-family:宋体">设置</span>PLL<span style="font-family:宋体">时钟源及倍频系数</span></p> 
<p>//<span style="font-family:宋体">输入：RCC_PLLSource_HSI_Div2，RCC_PLLSource_HSE_Div1，RCC_PLLSource_HSE_Div2</span></p> 
<p><span style="font-family:宋体">//输入：RCC_PLLMul_2到RCC_PLLMul_16</span></p> 
<p><span style="color:red">void RCC_PLLCmd(FunctionalState NewState);</span>//<span style="font-family:宋体">使能或者失能</span>PLL</p> 
<p>//<span style="font-family:宋体">输入：</span>ENABLE<span style="font-family:宋体">或者</span>DISABLE</p> 
<p>#if defined (STM32F10X_LD_VL) || defined (STM32F10X_MD_VL) || defined (STM32F10X_HD_VL) || defined (STM32F10X_CL)</p> 
<p> void RCC_PREDIV1Config(uint32_t RCC_PREDIV1_Source, uint32_t RCC_PREDIV1_Div);//</p> 
<p>#endif</p> 
<p>#ifdef  STM32F10X_CL</p> 
<p> void RCC_PREDIV2Config(uint32_t RCC_PREDIV2_Div);//</p> 
<p> void RCC_PLL2Config(uint32_t RCC_PLL2Mul);//</p> 
<p> void RCC_PLL2Cmd(FunctionalState NewState);//</p> 
<p> void RCC_PLL3Config(uint32_t RCC_PLL3Mul);//</p> 
<p> void RCC_PLL3Cmd(FunctionalState NewState);//</p> 
<p>#endif /* STM32F10X_CL */ </p> 
<p><span style="color:red">void RCC_SYSCLKConfig(uint32_t RCC_SYSCLKSource);</span>//<span style="font-family:宋体">设置系统时钟</span>(SYSCLK)<span style="font-family:宋体">源</span></p> 
<p>//<span style="font-family:宋体"> RCC_SYSCLKSource_HSI，RCC_SYSCLKSource_HSE，RCC_SYSCLKSource_PLLCLK</span></p> 
<p>uint8_t RCC_GetSYSCLKSource(void);//<span style="font-family:宋体">返回用作系统时钟的时钟源</span></p> 
<p>//<span style="font-family:宋体">返回值：</span>0x00 HSI<span style="font-family:宋体">作为系统时钟，</span>0x04 HSE<span style="font-family:宋体">作为系统时钟，</span>0x08 PLL<span style="font-family:宋体">作为系统时钟</span></p> 
<p><span style="color:red">void RCC_HCLKConfig(uint32_t RCC_SYSCLK);//</span><span style="color:red"><span style="font-family:宋体">设置</span></span><span style="color:red">AHB</span><span style="color:red"><span style="font-family:宋体">时钟（</span></span><span style="color:red">HCLK</span><span style="font-family:宋体"><span style="color:red">）</span></span></p> 
<p>//<span style="font-family:宋体">输入：</span>RCC_SYSCLK_Div1<span style="font-family:宋体">，</span>RCC_SYSCLK_Div2<span style="font-family:宋体">，</span>RCC_SYSCLK_Div4<span style="font-family:宋体">，</span>RCC_SYSCLK_Div8<span style="font-family:宋体">，</span>RCC_SYSCLK_Div16<span style="font-family:宋体">，</span></p> 
<p>//RCC_SYSCLK_Div32<span style="font-family:宋体">，</span>RCC_SYSCLK_Div64<span style="font-family:宋体">，</span>RCC_SYSCLK_Div128<span style="font-family:宋体; font-size:14px">，</span>RCC_SYSCLK_Div256<span style="font-family:宋体">，</span>RCC_SYSCLK_Div512</p> 
<p><span style="color:red">void RCC_PCLK1Config(uint32_t RCC_HCLK);//</span><span style="font-family:宋体"><span style="color:red">设置低速</span></span><span style="color:red">AHB</span><span style="color:red"><span style="font-family:宋体">时钟（</span></span><span style="color:red">PCLK1</span><span style="color:red"><span style="font-family:宋体">）</span></span></p> 
<p><span style="font-family:宋体">//输入：RCC_HCLK_Div1,RCC_HCLK_Div2,RCC_HCLK_Div4,RCC_HCLK_Div8,RCC_HCLK_Div16</span></p> 
<p><span style="color:red">void RCC_PCLK2Config(uint32_t RCC_HCLK);//</span><span style="font-family:宋体"><span style="color:red">设置高速</span></span><span style="color:red">AHB</span><span style="color:red"><span style="font-family:宋体">时钟（</span></span><span style="color:red">PCLK2</span><span style="font-family:宋体"><span style="color:red">）</span></span></p> 
<p>//<span style="font-family:宋体; font-size:14px">输入：</span>RCC_HCLK_Div1,RCC_HCLK_Div2,RCC_HCLK_Div4,RCC_HCLK_Div8,RCC_HCLK_Div16</p> 
<p>void RCC_ITConfig(uint8_t RCC_IT, FunctionalState NewState);//<span style="font-family:宋体">使能或者失能指定的</span>RCC<span style="font-family:宋体">中断</span></p> 
<p>//<span style="font-family:宋体">输入：</span>RCC_IT_LSIRDY  LSI<span style="font-family:宋体">就绪中断</span>-&gt;ENABLE<span style="font-family:宋体">或者</span>DISABLE</p> 
<p>//RCC_IT_LSERDY  LSE<span style="font-family:宋体">就绪中断，</span>RCC_IT_HSIRDY  HSI<span style="font-family:宋体">就绪中断</span></p> 
<p>//RCC_IT_HSERDY  HSE<span style="font-family:宋体">就绪中断，</span>RCC_IT_PLLRDY  PLL<span style="font-family:宋体">就绪中断</span></p> 
<p>#ifndef STM32F10X_CL</p> 
<p> void RCC_USBCLKConfig(uint32_t RCC_USBCLKSource);//<span style="font-family:宋体">设置</span>USB<span style="font-family:宋体">时钟（</span>USBCLK<span style="font-family:宋体">）</span></p> 
<p>//<span style="font-family:宋体">输入：</span>RCC_USBCLKSource_PLLCLK_1Div5<span style="font-family:宋体">，</span>USB<span style="font-family:宋体">时钟</span> = PLL<span style="font-family:宋体">时钟除以</span>1.5</p> 
<p>RCC_USBCLKSource_PLLCLK_Div1<span style="font-family:宋体">，</span>USB<span style="font-family:宋体">时钟</span> = PLL<span style="font-family:宋体">时钟</span></p> 
<p>#else</p> 
<p> void RCC_OTGFSCLKConfig(uint32_t RCC_OTGFSCLKSource);//</p> 
<p>#endif /* STM32F10X_CL */ </p> 
<p><span style="color:red">void RCC_ADCCLKConfig(uint32_t RCC_PCLK2);//</span><span style="font-family:宋体"><span style="color:red">设置</span></span><span style="color:red">ADC</span><span style="color:red"><span style="font-family:宋体">时钟（</span></span><span style="color:red">ADCCLK</span><span style="color:red"><span style="font-family:宋体">）</span></span></p> 
<p><span style="font-family:宋体">//RCC_PCLK2_Div2,ADC时钟 = PCLK / 2;RCC_PCLK2_Div4,ADC时钟 = PCLK / 4;</span></p> 
<p><span style="font-family:宋体">//RCC_PCLK2_Div6,ADC时钟 = PCLK / 6;RCC_PCLK2_Div8,ADC时钟 = PCLK / 8</span></p> 
<p>#ifdef STM32F10X_CL</p> 
<p> void RCC_I2S2CLKConfig(uint32_t RCC_I2S2CLKSource); //                                 </p> 
<p> void RCC_I2S3CLKConfig(uint32_t RCC_I2S3CLKSource);//</p> 
<p>#endif /* STM32F10X_CL */ </p> 
<p>void RCC_LSEConfig(uint8_t RCC_LSE);//<span style="font-family:宋体">设置外部低速晶振（</span>LSE<span style="font-family:宋体">）</span></p> 
<p>//<span style="font-family:宋体">输入：</span>RCC_LSE_OFF,LSE<span style="font-family:宋体">晶振</span>OFF;RCC_LSE_ON,LSE<span style="font-family:宋体">晶振</span>ON;</p> 
<p>//RCC_LSE_Bypass,LSE<span style="font-family:宋体">晶振被外部时钟旁路</span></p> 
<p>void RCC_LSICmd(FunctionalState NewState);//<span style="font-family:宋体">使能或者失能内部低速晶振（</span>LSI<span style="font-family:宋体">）</span></p> 
<p>//<span style="font-family:宋体">输入：</span>ENABLE<span style="font-family:宋体">或者</span>DISABLE   (IWDG<span style="font-family:宋体">运行的话，</span>LSI<span style="font-family:宋体">不能被失能</span>)</p> 
<p>void RCC_RTCCLKConfig(uint32_t RCC_RTCCLKSource);//<span style="font-family:宋体">设置</span>RTC<span style="font-family:宋体">时钟(</span>RTCCLK<span style="font-family:宋体">)源(RTC时钟一经选定即不能更改，除非复位后备域)</span></p> 
<p><span style="font-family:宋体">//输入：RCC_RTCCLKSource_LSE,选择LSE作为RTC时钟;RCC_RTCCLKSource_LSI,选择LSI作为RTC时钟;RCC_RTCCLKSource_HSE_Div128,选择HSE时钟频率除以128作为RTC时钟</span></p> 
<p>void RCC_RTCCLKCmd(FunctionalState NewState);//<span style="font-family:宋体">使能或者失能</span>RTC<span style="font-family:宋体">时钟</span></p> 
<p>//<span style="font-family:宋体">输入：ENABLE或者DISABLE</span></p> 
<p>void RCC_GetClocksFreq(RCC_ClocksTypeDef* RCC_Clocks);//<span style="font-family:宋体">返回时钟的频率</span></p> 
<p>//<span style="font-family:宋体">输入：指向结构</span>RCC_ClocksTypeDef<span style="font-family:宋体">的指针，包含了各个时钟的频率（单位为</span>Hz<span style="font-family:宋体">）</span></p> 
<p><span style="color:red">void RCC_AHBPeriphClockCmd(uint32_t RCC_AHBPeriph, FunctionalState NewState);</span>//<span style="font-family:宋体">使能或者失能</span>AHB<span style="font-family:宋体">外设时钟</span></p> 
<p>//<span style="font-family:宋体">输入：</span>RCC_AHBPeriph_DMA<span style="font-family:宋体">，</span>DMA<span style="font-family:宋体">时钟</span>-&gt;ENABLE<span style="font-family:宋体">或者</span>DISABLE<span style="font-family:宋体">；</span></p> 
<p>//RCC_AHBPeriph_SRAM<span style="font-family:宋体">，</span>SRAM<span style="font-family:宋体">时钟；</span>RCC_AHBPeriph_FLITF<span style="font-family:宋体">，</span>FLITF<span style="font-family:宋体">时钟</span></p> 
<p>//RCC_AHBPeriph_DMA1<span style="font-family:宋体">，</span>DMA1<span style="font-family:宋体">时钟；</span>RCC_AHBPeriph_DMA2<span style="font-family:宋体">，</span>DMA2<span style="font-family:宋体">时钟</span></p> 
<p>//RCC_AHBPeriph_CRC<span style="font-family:宋体">，</span>CRC<span style="font-family:宋体">时钟；</span>RCC_AHBPeriph_FSMC<span style="font-family:宋体">，</span>FSMC<span style="font-family:宋体">时钟</span></p> 
<p>//RCC_AHBPeriph_SDIO<span style="font-family:宋体">，</span>SDIO<span style="font-family:宋体">时钟</span></p> 
<p><span style="color:red">void RCC_APB2PeriphClockCmd(uint32_t RCC_APB2Periph, FunctionalState NewState);</span>//<span style="font-family:宋体">使能或者失能</span>APB2<span style="font-family:宋体">外设时钟</span></p> 
<p>//<span style="font-family:宋体">输入：</span>RCC_APB2Periph_AFIO<span style="font-family:宋体">，功能复用</span>IO<span style="font-family:宋体">时钟</span>-&gt;ENABLE<span style="font-family:宋体">或者</span>DISABLE<span style="font-family:宋体">；</span></p> 
<p>//RCC_APB2Periph_GPIOA<span style="font-family:宋体">，</span>GPIOA<span style="font-family:宋体">时钟；</span>RCC_APB2Periph_GPIOB,GPIOB<span style="font-family:宋体">时钟</span>;</p> 
<p>//RCC_APB2Periph_GPIOC,GPIOC<span style="font-family:宋体">时钟</span>;RCC_APB2Periph_GPIOD,GPIOD<span style="font-family:宋体">时钟</span>;</p> 
<p>//RCC_APB2Periph_GPIOE,GPIOE<span style="font-family:宋体">时钟</span>;RCC_APB2Periph_ADC1,ADC1<span style="font-family:宋体">时钟</span>;</p> 
<p>//RCC_APB2Periph_ADC2,ADC2<span style="font-family:宋体">时钟</span>;RCC_APB2Periph_TIM1,TIM1<span style="font-family:宋体">时钟</span>;</p> 
<p>//RCC_APB2Periph_SPI1,SPI1<span style="font-family:宋体">时钟</span>;RCC_APB2Periph_USART1,USART1<span style="font-family:宋体">时钟</span>;</p> 
<p>//RCC_APB2Periph_ALL,<span style="font-family:宋体">全部</span>APB2<span style="font-family:宋体">外设时钟</span></p> 
<p><span style="color:red">void RCC_APB1PeriphClockCmd(uint32_t RCC_APB1Periph, FunctionalState NewState);</span>//<span style="font-family:宋体">使能或者失能</span>APB1<span style="font-family:宋体">外设时钟</span></p> 
<p>//<span style="font-family:宋体">输入：</span>RCC_APB1Periph_TIM2<span style="font-family:宋体">，</span>TIM2<span style="font-family:宋体">时钟</span>-&gt;ENABLE<span style="font-family:宋体">或者</span>DISABLE;</p> 
<p>//RCC_APB1Periph_TIM3,TIM3<span style="font-family:宋体">时钟</span>;RCC_APB1Periph_TIM4,TIM4<span style="font-family:宋体">时钟</span></p> 
<p>//RCC_APB1Periph_WWDG,WWDG<span style="font-family:宋体">时钟</span>;RCC_APB1Periph_SPI2,SPI2<span style="font-family:宋体">时钟</span></p> 
<p>//RCC_APB1Periph_USART2,USART2<span style="font-family:宋体">时钟</span>;RCC_APB1Periph_USART3,USART3<span style="font-family:宋体">时钟</span></p> 
<p>//RCC_APB1Periph_I2C1,I2C1<span style="font-family:宋体">时钟</span>;RCC_APB1Periph_I2C2,I2C2<span style="font-family:宋体">时钟</span></p> 
<p>//RCC_APB1Periph_USB,USB<span style="font-family:宋体">时钟</span>;RCC_APB1Periph_CAN,CAN<span style="font-family:宋体">时钟</span></p> 
<p>//RCC_APB1Periph_BKP,BKP<span style="font-family:宋体">时钟</span>;RCC_APB1Periph_PWR,PWR<span style="font-family:宋体">时钟</span></p> 
<p>//RCC_APB1Periph_ALL,<span style="font-family:宋体">全部</span>APB1<span style="font-family:宋体">外设时钟</span></p> 
<p>#ifdef STM32F10X_CL</p> 
<p>void RCC_AHBPeriphResetCmd(uint32_t RCC_AHBPeriph, FunctionalState NewState);//</p> 
<p>#endif /* STM32F10X_CL */ </p> 
<p>void RCC_APB2PeriphResetCmd(uint32_t RCC_APB2Periph, FunctionalState NewState);//<span style="font-family:宋体">强制或者释放高速</span>APB<span style="font-family:宋体">（</span>APB2<span style="font-family:宋体">）外设复位</span></p> 
<p>//<span style="font-family:宋体">输入：同</span>void RCC_APB2PeriphClockCmd(uint32_t RCC_APB2Periph, FunctionalState NewState);<span style="font-family:宋体">函数的值</span></p> 
<p>void RCC_APB1PeriphResetCmd(uint32_t RCC_APB1Periph, FunctionalState NewState);//<span style="font-family:宋体">强制或者释放低速</span>APB<span style="font-family:宋体">（</span>APB1<span style="font-family:宋体">）外设复位</span></p> 
<p>//<span style="font-family:宋体">输入：同</span>void RCC_APB1PeriphClockCmd(uint32_t RCC_APB1Periph, FunctionalState NewState);<span style="font-family:宋体">函数的值</span></p> 
<p>//<span style="font-family:宋体">例：</span>/* Enter the SPI1 peripheral to reset */ </p> 
<p>//RCC_APB2PeriphResetCmd(RCC_APB2Periph_SPI1, ENABLE); </p> 
<p>/* Exit the SPI1 peripheral from reset */ </p> 
<p>//RCC_APB2PeriphResetCmd(RCC_APB2Periph_SPI1, DISABLE);</p> 
<p>void RCC_BackupResetCmd(FunctionalState NewState);//<span style="font-family:宋体">强制或者释放后备域复位</span></p> 
<p>void RCC_ClockSecuritySystemCmd(FunctionalState NewState);//<span style="font-family:宋体">使能或者失能时钟安全系统</span></p> 
<p>//<span style="font-family:宋体">输入：</span>ENABLE<span style="font-family:宋体">或者</span>DISABLE</p> 
<p>void RCC_MCOConfig(uint8_t RCC_MCO);//<span style="font-family:宋体">选择在</span>MCO<span style="font-family:宋体">管脚上输出的时钟源</span></p> 
<p>//<span style="font-family:宋体">输入：<span style="font-size:14px">RCC_MCO_NoClock 无时钟被选中 ；RCC_MCO_SYSCLK 选中系统时钟；</span></span></p> 
<p align="left"><span style="font-family:Times New Roman">//RCC_MCO_HSI </span>选中<span style="font-family:Times New Roman">HSI </span>；<span style="font-family:Times New Roman">RCC_MCO_HSE </span>选中<span style="font-family:Times New Roman">HSE </span>；</p> 
<p align="left"><span style="font-family:Times New Roman">//RCC_MCO_PLLCLK_Div2 </span> 选中<span style="font-family:Times New Roman">PLL</span>时钟除以<span style="font-family:Times New Roman">2</span></p> 
<p align="left"><span style="font-family:Times New Roman">//</span>警告：当选中系统时钟作为<span style="font-family:Times New Roman">MCO</span>管脚的输出时，注意它的时钟频率不超过<span style="font-family:Times New Roman">50MHz(</span>最大<span style="font-family:Times New Roman">I/O</span>速率<span style="font-family:Times New Roman">)</span>。</p> 
<p>FlagStatus RCC_GetFlagStatus(uint8_t RCC_FLAG);//<span style="font-family:宋体">检查指定的</span>RCC<span style="font-family:宋体">标志位设置与否</span></p> 
<p>//<span style="font-family:宋体">输入：待检查的</span>RCC<span style="font-family:宋体">标志位</span></p> 
<br> 
<p align="left"><span style="font-family:Times New Roman">//RCC_FLAG_HSIRDY </span> ，<span style="font-family:Times New Roman">HSI</span>晶振就绪；<span style="font-family:Times New Roman">RCC_FLAG_HSERDY </span>，<span style="font-family:Times New Roman">HSE</span>晶振就绪；</p> 
<p align="left"><span style="font-family:Times New Roman">//RCC_FLAG_PLLRDY </span> ，<span style="font-family:Times New Roman">PLL</span>就绪；<span style="font-family:Times New Roman">RCC_FLAG_LSERDY </span>，<span style="font-family:Times New Roman">LSI</span>晶振就绪；</p> 
<p align="left"><span style="font-family:Times New Roman">//RCC_FLAG_LSIRDY </span> ，<span style="font-family:Times New Roman">LSE</span>晶振就绪；<span style="font-family:Times New Roman">RCC_FLAG_PINRST </span>，管脚复位 ；</p> 
<p align="left"><span style="font-family:Times New Roman">//RCC_FLAG_PORRST </span> ，<span style="font-family:Times New Roman">POR/PDR</span>复位；<span style="font-family:Times New Roman">RCC_FLAG_SFTRST </span>，软件复位 ；</p> 
<p align="left"><span style="font-family:Times New Roman">//RCC_FLAG_IWDGRST </span> ，<span style="font-family:Times New Roman">IWDG</span>复位；<span style="font-family:Times New Roman">RCC_FLAG_WWDGRST </span>，<span style="font-family:Times New Roman">WWDG</span>复位；</p> 
<p align="left"><span style="font-family:Times New Roman">//RCC_FLAG_LPWRRST </span> ，低功耗复位</p> 
<p><span style="font-size:14px">//<span style="font-family:宋体">返回值：</span>RCC_FLAG<span style="font-family:宋体">的新状态（</span>SET<span style="font-family:宋体">或者</span>RESET<span style="font-family:宋体">）</span></span></p> 
<p align="left">//例：/* Test if the PLL clock is ready or not */ </p> 
<p align="left">//FlagStatus Status; </p> 
<p align="left">//Status = RCC_GetFlagStatus(RCC_FLAG_PLLRDY); </p> 
<p align="left">//if(Status == RESET) </p> 
<p align="left">//{ </p> 
<p align="left">//... </p> 
<p align="left">//} </p> 
<p align="left">//else</p> 
<p>void RCC_ClearFlag(void);//<span style="font-family:宋体">清除</span>RCC<span style="font-family:宋体">的复位标志位</span></p> 
<p>//(<span style="font-family:宋体">可以清除的复位标志位有：</span>RCC_FLAG_PINRST, RCC_FLAG_PORRST, //RCC_FLAG_SFTRST, RCC_FLAG_IWDGRST, RCC_FLAG_WWDGRST, RCC_FLAG_LPWRRST)</p> 
<p>ITStatus RCC_GetITStatus(uint8_t RCC_IT);//<span style="font-family:宋体">检查指定的</span>RCC<span style="font-family:宋体">中断发生与否</span></p> 
<p>//<span style="font-family:宋体">输入：</span>RCC_IT_LSIRDY<span style="font-family:宋体">，</span>LSI<span style="font-family:宋体">晶振就绪中断；</span>RCC_IT_LSERDY<span style="font-family:宋体">，</span>LSE<span style="font-family:宋体">晶振就绪中断</span></p> 
<p>//RCC_IT_HSIRDY<span style="font-family:宋体">，</span>HSI<span style="font-family:宋体">晶振就绪中断；</span>RCC_IT_HSERDY<span style="font-family:宋体">，</span>HSE<span style="font-family:宋体">晶振就绪中断</span></p> 
<p>//RCC_IT_PLLRDY<span style="font-family:宋体">，</span>PLL<span style="font-family:宋体">就绪中断；</span>RCC_IT_CSS<span style="font-family:宋体">，时钟安全系统中断</span></p> 
<p>//<span style="font-family:宋体">返回值：</span>RCC_IT<span style="font-family:宋体">的新状态</span></p> 
<p>//<span style="font-family:宋体">例：</span></p> 
<p>/* Test if the PLL Ready interrupt has occurred or not */</p> 
<p>//ITStatus Status;</p> 
<p>//Status = RCC_GetITStatus(RCC_IT_PLLRDY);</p> 
<p>//if(Status == RESET)</p> 
<p>//{<!-- --></p> 
<p>//...</p> 
<p>//}</p> 
<p>//else</p> 
<p>//{<!-- --></p> 
<p>//...</p> 
<p>//}</p> 
<p>void RCC_ClearITPendingBit(uint8_t RCC_IT);//<span style="font-family:宋体">清除</span>RCC<span style="font-family:宋体">的中断待处理位</span></p> 
<p>//RCC_IT_LSIRDY,LSI<span style="font-family:宋体">晶振就绪中断</span>;RCC_IT_LSERDY,LSE<span style="font-family:宋体">晶振就绪中断</span></p> 
<p>//RCC_IT_HSIRDY,HSI<span style="font-family:宋体">晶振就绪中断</span>;RCC_IT_HSERDY,HSE<span style="font-family:宋体">晶振就绪中断</span></p> 
<p>//RCC_IT_PLLRDY,PLL<span style="font-family:宋体">就绪中断</span>;RCC_IT_CSS,<span style="font-family:宋体">时钟安全系统中断</span></p> 
<p><strong>五、实例详解</strong></p> 
<p align="left">#if defined (STM32F10X_LD_VL) || (defined STM32F10X_MD_VL) || (defined STM32F10X_HD_VL)//如果定义了这些系统时钟将设为24M，如果没有定义则为72M<br> /* #define SYSCLK_FREQ_HSE    HSE_VALUE */<br>  #define SYSCLK_FREQ_24MHz  24000000<br> #else<br> /* #define SYSCLK_FREQ_HSE    HSE_VALUE */<br> /* #define SYSCLK_FREQ_24MHz  24000000 */ <br> /* #define SYSCLK_FREQ_36MHz  36000000 */<br> /* #define SYSCLK_FREQ_48MHz  48000000 */<br> /* #define SYSCLK_FREQ_56MHz  56000000 */<br> <span style="color:red">#define SYSCLK_FREQ_72MHz  72000000      //</span><span style="color:red">系统时钟默认值的定义 </span>，如果没有定义外部高速时钟则用内部高速时钟，为8000000</p> 
<p align="left"><span style="color:red">/*</span><span style="color:red">只需修改以上几句就可以自动设置使用外部倍频作为系统时钟，如果以上宏都未定义则在下边把内部高速时钟作为系统时钟*/<br> </span>#endif</p> 
<p align="left">/*!&lt; Uncomment the following line if you need to use external SRAM mounted<br>      on STM3210E-EVAL board (STM32 High density and XL-density devices) or on <br>      STM32100E-EVAL board (STM32 High-density value line devices) as data memory */ <br> #if defined (STM32F10X_HD) || (defined STM32F10X_XL) || (defined STM32F10X_HD_VL)//内外部SRAM选择<br> /* #define DATA_IN_ExtSRAM */<br> #endif</p> 
<p align="left">/*!&lt; Uncomment the following line if you need to relocate your vector Table in<br>      Internal SRAM. */ <br> /* #define VECT_TAB_SRAM */<br> #define VECT_TAB_OFFSET  0x0 /*!&lt; Vector Table base offset field. //向量表的基址偏移量<br>                                   This value must be a multiple of 0x100. */</p> 
<p align="left"><br> </p> 
<p align="left">/*******************************************************************************<br> *  Clock Definitions;<span style="color:red">以下为把系统时钟的定义值传给系统内核时钟变量,</span>如果没有定义外部高速时钟则用内部高速时钟，为8M<br> *******************************************************************************/<br> #ifdef SYSCLK_FREQ_HSE<br>   uint32_t SystemCoreClock         = SYSCLK_FREQ_HSE;        /*!&lt; System Clock Frequency (Core Clock) */<br> #elif defined SYSCLK_FREQ_24MHz<br>   uint32_t SystemCoreClock         = SYSCLK_FREQ_24MHz;        /*!&lt; System Clock Frequency (Core Clock) */<br> #elif defined SYSCLK_FREQ_36MHz<br>   uint32_t SystemCoreClock         = SYSCLK_FREQ_36MHz;        /*!&lt; System Clock Frequency (Core Clock) */<br> #elif defined SYSCLK_FREQ_48MHz<br>   uint32_t SystemCoreClock         = SYSCLK_FREQ_48MHz;        /*!&lt; System Clock Frequency (Core Clock) */<br> #elif defined SYSCLK_FREQ_56MHz<br>   uint32_t SystemCoreClock         = SYSCLK_FREQ_56MHz;        /*!&lt; System Clock Frequency (Core Clock) */<br> <span style="color:red">#elif defined SYSCLK_FREQ_72MHz<br>   uint32_t SystemCoreClock         = SYSCLK_FREQ_72MHz;        /*!&lt; System Clock Frequency (Core Clock) */<br> </span>#else <span style="color:fuchsia">/*!&lt; HSI Selected as System Clock source */<br>   uint32_t SystemCoreClock         = HSI_VALUE;        /*!&lt; System Clock Frequency (Core Clock) </span><span style="color:fuchsia">如果没有定义外部高速时钟则用内部高速时钟，为8000000*/<br> </span>#endif</p> 
<p align="left">__I uint8_t AHBPrescTable[16] = {0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 3, 4, 6, 7, 8, 9};//AHB配方表<br> /**<br>   * @}<br>   */</p> 
<p align="left">/** @addtogroup STM32F10x_System_Private_FunctionPrototypes<br>   * @{<!-- --><br>   */<br> /*********************************************************************************<br>                以下为函数声明<br> *********************************************************************************/<br> static void SetSysClock(void); //设置系统时钟的函数声明<br> //以下为根据不同的系统时钟的定义来声明用到的相应的函数，为后面的函数调用做好准备<br> #ifdef SYSCLK_FREQ_HSE<br>   static void SetSysClockToHSE(void);<br> #elif defined SYSCLK_FREQ_24MHz<br>   static void SetSysClockTo24(void);<br> #elif defined SYSCLK_FREQ_36MHz<br>   static void SetSysClockTo36(void);<br> #elif defined SYSCLK_FREQ_48MHz<br>   static void SetSysClockTo48(void);<br> #elif defined SYSCLK_FREQ_56MHz<br>   static void SetSysClockTo56(void);  <br> #elif defined SYSCLK_FREQ_72MHz<br>   static void SetSysClockTo72(void);<br> #endif</p> 
<p align="left">#ifdef DATA_IN_ExtSRAM //外部SRAM选择后的初始化函数声明<br>   static void SystemInit_ExtMemCtl(void); <br> #endif /* DATA_IN_ExtSRAM */</p> 
<p align="left">/**<br>   * @}<br>   */</p> 
<p align="left">/** @addtogroup STM32F10x_System_Private_Functions<br>   * @{<!-- --><br>   */</p> 
<p align="left">/**<br>   * @brief  Setup the microcontroller system<br>   *         Initialize the Embedded Flash Interface, the PLL and update the <br>   *         SystemCoreClock variable.<br>   * @note   This function should be used only after reset.<br>   * @param  None<br>   * @retval None<br>   */<br> <span style="color:red">void SystemInit (void)//</span><span style="color:red">系统初始化函数，设置系统的时钟及时钟中断（在startup_stm32f10x_md.s</span>中调用）(复位RCC时钟配置为默认状态，直到设置时钟函数)<br> {<!-- --><br>   /* Reset the RCC clock configuration to the default reset state(for debug purpose) */<br>   /* Set HSION bit */<br>   RCC-&gt;CR |= (uint32_t)0x00000001; //内部高速时钟使能,内部8MHz时钟开启</p> 
<p align="left">  /* Reset SW, HPRE, PPRE1, PPRE2, ADCPRE and MCO bits */<br> #ifndef STM32F10X_CL<br>   RCC-&gt;CFGR &amp;= (uint32_t)0xF8FF0000;//MCO微控制器没有时钟输出(对外部引脚),ADC预分频PCLK2 2分频后作为ADC时钟,APB预分频HCLK不分频,AHB预分频SYSCLK不分频,HSI作为系统时钟<br>                                     //HSI作为系统时钟输出（已输出），SYSCLK=PCLK=PCLK1=PCLK2=8M，ADCCLK=1/2(PCLK2)=4M<br> #else<br>   RCC-&gt;CFGR &amp;= (uint32_t)0xF0FF0000;//同上；RCC-&gt;CFGR的27位为保留位始终为0 ，HSI作为系统时钟输出（未输出原因为未编译）<br> #endif /* STM32F10X_CL */   <br>   <br>   /* Reset HSEON, CSSON and PLLON bits */<br>   RCC-&gt;CR &amp;= (uint32_t)0xFEF6FFFF;//时钟监测器关闭,HSE振荡器关闭</p> 
<p align="left">  /* Reset HSEBYP bit */<br>   RCC-&gt;CR &amp;= (uint32_t)0xFFFBFFFF;//外部4-25MHz振荡器没有旁路</p> 
<p align="left">  /* Reset PLLSRC, PLLXTPRE, PLLMUL and USBPRE/OTGFSPRE bits */<br>   RCC-&gt;CFGR &amp;= (uint32_t)0xFF80FFFF; //PLL时钟1.5倍分频作为USB时钟,PLL 2倍频输出,HSE不分频,HSI时钟2分频后作为PLL输入时钟<br>                                      //PLLCLK=HSICLK=8M（还未输出）,HSECLK=HSEOSC,USBCLK=PLLCLK/1.5 ，除PLL外其他分频系数都为0<br> #ifdef STM32F10X_CL<br>   /* Reset PLL2ON and PLL3ON bits */<br>   RCC-&gt;CR &amp;= (uint32_t)0xEBFFFFFF;//CR中的26和28位置0</p> 
<p align="left">  /* Disable all interrupts and clear pending bits  */<br>   RCC-&gt;CIR = 0x00FF0000;//清除中断标志，关闭一些中断</p> 
<p align="left">  /* Reset CFGR2 register */<br>   RCC-&gt;CFGR2 = 0x00000000; //没有此寄存器<br> #elif defined (STM32F10X_LD_VL) || defined (STM32F10X_MD_VL) || (defined STM32F10X_HD_VL)<br>   /* Disable all interrupts and clear pending bits  */<br>   RCC-&gt;CIR = 0x009F0000;//清除中断标志，关闭一些中断</p> 
<p align="left">  /* Reset CFGR2 register */<br>   RCC-&gt;CFGR2 = 0x00000000; //没有此寄存器     <br> #else<br>   /* Disable all interrupts and clear pending bits  */<br>   RCC-&gt;CIR = 0x009F0000; //清除中断标志，关闭一些中断<br> #endif /* STM32F10X_CL */<br>     <br> #if defined (STM32F10X_HD) || (defined STM32F10X_XL) || (defined STM32F10X_HD_VL)<br>   #ifdef DATA_IN_ExtSRAM<br>     SystemInit_ExtMemCtl();//如果宏定义了外部SRAM则对其初始化控制<br>   #endif /* DATA_IN_ExtSRAM */<br> #endif </p> 
<p align="left">  /* Configure the System clock frequency, HCLK, PCLK2 and PCLK1 prescalers */<br>   /* Configure the Flash Latency cycles and enable prefetch buffer */<br> <span style="color:red">  SetSysClock();//</span><span style="color:red">设置系统时钟</span></p> 
<p align="left">#ifdef VECT_TAB_SRAM<br>   SCB-&gt;VTOR = SRAM_BASE | VECT_TAB_OFFSET; /* Vector Table Relocation in Internal SRAM. 向量表放在内部SRAM中*/<br> #else<br>   SCB-&gt;VTOR = FLASH_BASE | VECT_TAB_OFFSET; /* Vector Table Relocation in Internal FLASH. 向量表放在内部flash中*/<br> #endif <br> }</p> 
<p align="left">/**<br>   * @brief  Update SystemCoreClock according to Clock Register Values<br>   * @note   None<br>   * @param  None<br>   * @retval None<br>   */<br> void SystemCoreClockUpdate (void)<br> {<!-- --><br>   uint32_t tmp = 0, pllmull = 0, pllsource = 0;</p> 
<p align="left">#ifdef  STM32F10X_CL<br>   uint32_t prediv1source = 0, prediv1factor = 0, prediv2factor = 0, pll2mull = 0;<br> #endif /* STM32F10X_CL */</p> 
<p align="left">#if defined (STM32F10X_LD_VL) || defined (STM32F10X_MD_VL) || (defined STM32F10X_HD_VL)<br>   uint32_t prediv1factor = 0;<br> #endif /* STM32F10X_LD_VL or STM32F10X_MD_VL or STM32F10X_HD_VL */<br>     <br>   /* Get SYSCLK source -------------------------------------------------------*/<br>   tmp = RCC-&gt;CFGR &amp; RCC_CFGR_SWS;<br>   <br>   switch (tmp)<br>   {<!-- --><br>     case 0x00:  /* HSI used as system clock */<br>       SystemCoreClock = HSI_VALUE;<br>       break;<br>     case 0x04:  /* HSE used as system clock */<br>       SystemCoreClock = HSE_VALUE;<br>       break;<br>     case 0x08:  /* PLL used as system clock */</p> 
<p align="left">      /* Get PLL clock source and multiplication factor ----------------------*/<br>       pllmull = RCC-&gt;CFGR &amp; RCC_CFGR_PLLMULL;<br>       pllsource = RCC-&gt;CFGR &amp; RCC_CFGR_PLLSRC;<br>       <br> #ifndef STM32F10X_CL      <br>       pllmull = ( pllmull &gt;&gt; 18) + 2;<br>       <br>       if (pllsource == 0x00)<br>       {<!-- --><br>         /* HSI oscillator clock divided by 2 selected as PLL clock entry */<br>         SystemCoreClock = (HSI_VALUE &gt;&gt; 1) * pllmull;<br>       }<br>       else<br>       {<!-- --><br>  #if defined (STM32F10X_LD_VL) || defined (STM32F10X_MD_VL) || (defined STM32F10X_HD_VL)<br>        prediv1factor = (RCC-&gt;CFGR2 &amp; RCC_CFGR2_PREDIV1) + 1;<br>        /* HSE oscillator clock selected as PREDIV1 clock entry */<br>        SystemCoreClock = (HSE_VALUE / prediv1factor) * pllmull; <br>  #else<br>         /* HSE selected as PLL clock entry */<br>         if ((RCC-&gt;CFGR &amp; RCC_CFGR_PLLXTPRE) != (uint32_t)RESET)<br>         {/* HSE oscillator clock divided by 2 */<br>           SystemCoreClock = (HSE_VALUE &gt;&gt; 1) * pllmull;<br>         }<br>         else<br>         {<!-- --><br>           SystemCoreClock = HSE_VALUE * pllmull;<br>         }<br>  #endif<br>       }<br> #else<br>       pllmull = pllmull &gt;&gt; 18;<br>       <br>       if (pllmull != 0x0D)<br>       {<!-- --><br>          pllmull += 2;<br>       }<br>       else<br>       { /* PLL multiplication factor = PLL input clock * 6.5 */<br>         pllmull = 13 / 2; <br>       }<br>             <br>       if (pllsource == 0x00)<br>       {<!-- --><br>         /* HSI oscillator clock divided by 2 selected as PLL clock entry */<br>         SystemCoreClock = (HSI_VALUE &gt;&gt; 1) * pllmull;<br>       }<br>       else<br>       {/* PREDIV1 selected as PLL clock entry */<br>         <br>         /* Get PREDIV1 clock source and division factor */<br>         prediv1source = RCC-&gt;CFGR2 &amp; RCC_CFGR2_PREDIV1SRC;<br>         prediv1factor = (RCC-&gt;CFGR2 &amp; RCC_CFGR2_PREDIV1) + 1;<br>         <br>         if (prediv1source == 0)<br>         { <br>           /* HSE oscillator clock selected as PREDIV1 clock entry */<br>           SystemCoreClock = (HSE_VALUE / prediv1factor) * pllmull;          <br>         }<br>         else<br>         {/* PLL2 clock selected as PREDIV1 clock entry */<br>           <br>           /* Get PREDIV2 division factor and PLL2 multiplication factor */<br>           prediv2factor = ((RCC-&gt;CFGR2 &amp; RCC_CFGR2_PREDIV2) &gt;&gt; 4) + 1;<br>           pll2mull = ((RCC-&gt;CFGR2 &amp; RCC_CFGR2_PLL2MUL) &gt;&gt; 8 ) + 2; <br>           SystemCoreClock = (((HSE_VALUE / prediv2factor) * pll2mull) / prediv1factor) * pllmull;                         <br>         }<br>       }<br> #endif /* STM32F10X_CL */ <br>       break;</p> 
<p align="left">    default:<br>       SystemCoreClock = HSI_VALUE;<br>       break;<br>   }<br>   <br>   /* Compute HCLK clock frequency ----------------*/<br>   /* Get HCLK prescaler */<br>   tmp = AHBPrescTable[((RCC-&gt;CFGR &amp; RCC_CFGR_HPRE) &gt;&gt; 4)];<br>   /* HCLK clock frequency */<br>   SystemCoreClock &gt;&gt;= tmp;  <br> }</p> 
<p align="left">/**<br>   * @brief  Configures the System clock frequency, HCLK, PCLK2 and PCLK1 prescalers.<br>   * @param  None<br>   * @retval None<br>   */<br> <span style="color:red">static void SetSysClock(void)//</span><span style="color:red">根据不同的宏定义，设置不同的系统时钟</span><br> {  <br> #ifdef SYSCLK_FREQ_HSE<br>   SetSysClockToHSE();<br> #elif defined SYSCLK_FREQ_24MHz<br>   SetSysClockTo24();<br> #elif defined SYSCLK_FREQ_36MHz<br>   SetSysClockTo36();<br> #elif defined SYSCLK_FREQ_48MHz<br>   SetSysClockTo48();<br> #elif defined SYSCLK_FREQ_56MHz<br>   SetSysClockTo56();  <br> #elif defined SYSCLK_FREQ_72MHz<br>   SetSysClockTo72(); <br> #endif<br>  <br>  /* If none of the define above is enabled, the HSI is used as System clock<br>     source (default after reset) */ <br> }</p> 
<p align="left">/**<br>   * @brief  Setup the external memory controller. Called in startup_stm32f10x.s <br>   *          before jump to __main<br>   * @param  None<br>   * @retval None<br>   */ <br> #ifdef DATA_IN_ExtSRAM<br> /**<br>   * @brief  Setup the external memory controller. <br>   *         Called in startup_stm32f10x_xx.s/.c before jump to main.<br>   *        This function configures the external SRAM mounted on STM3210E-EVAL<br>   *         board (STM32 High density devices). This SRAM will be used as program<br>   *         data memory (including heap and stack).<br>   * @param  None<br>   * @retval None<br>   */ <br> void SystemInit_ExtMemCtl(void) <br> {<!-- --><br> /*!&lt; FSMC Bank1 NOR/SRAM3 is used for the STM3210E-EVAL, if another Bank is <br>   required, then adjust the Register Addresses */</p> 
<p align="left">  /* Enable FSMC clock */<br>   RCC-&gt;AHBENR = 0x00000114;<br>   <br>   /* Enable GPIOD, GPIOE, GPIOF and GPIOG clocks */  <br>   RCC-&gt;APB2ENR = 0x000001E0;<br>   <br> /* ---------------  SRAM Data lines, NOE and NWE configuration ---------------*/<br> /*----------------  SRAM Address lines configuration -------------------------*/<br> /*----------------  NOE and NWE configuration --------------------------------*/  <br> /*----------------  NE3 configuration ----------------------------------------*/<br> /*----------------  NBL0, NBL1 configuration ---------------------------------*/<br>   <br>   GPIOD-&gt;CRL = 0x44BB44BB;  <br>   GPIOD-&gt;CRH = 0xBBBBBBBB;</p> 
<p align="left">  GPIOE-&gt;CRL = 0xB44444BB;  <br>   GPIOE-&gt;CRH = 0xBBBBBBBB;</p> 
<p align="left">  GPIOF-&gt;CRL = 0x44BBBBBB;  <br>   GPIOF-&gt;CRH = 0xBBBB4444;</p> 
<p align="left">  GPIOG-&gt;CRL = 0x44BBBBBB;  <br>   GPIOG-&gt;CRH = 0x44444B44;<br>    <br> /*----------------  FSMC Configuration ---------------------------------------*/  <br> /*----------------  Enable FSMC Bank1_SRAM Bank ------------------------------*/<br>   <br>   FSMC_Bank1-&gt;BTCR[4] = 0x00001011;<br>   FSMC_Bank1-&gt;BTCR[5] = 0x00000200;<br> }<br> #endif /* DATA_IN_ExtSRAM */</p> 
<p align="left">#ifdef SYSCLK_FREQ_HSE<br> /**<br>   * @brief  Selects HSE as System clock source and configure HCLK, PCLK2<br>   *          and PCLK1 prescalers.<br>   * @note   This function should be used only after reset.<br>   * @param  None<br>   * @retval None<br>   */<br> static void SetSysClockToHSE(void)<br> {<!-- --><br>   __IO uint32_t StartUpCounter = 0, HSEStatus = 0;<br>   <br>   /* SYSCLK, HCLK, PCLK2 and PCLK1 configuration ---------------------------*/    <br>   /* Enable HSE */    <br>   RCC-&gt;CR |= ((uint32_t)RCC_CR_HSEON);<br>  <br>   /* Wait till HSE is ready and if Time out is reached exit */<br>   do<br>   {<!-- --><br>     HSEStatus = RCC-&gt;CR &amp; RCC_CR_HSERDY;<br>     StartUpCounter++;  <br>   } while((HSEStatus == 0) &amp;&amp; (StartUpCounter != HSE_STARTUP_TIMEOUT));</p> 
<p align="left">  if ((RCC-&gt;CR &amp; RCC_CR_HSERDY) != RESET)<br>   {<!-- --><br>     HSEStatus = (uint32_t)0x01;<br>   }<br>   else<br>   {<!-- --><br>     HSEStatus = (uint32_t)0x00;<br>   }  </p> 
<p align="left">  if (HSEStatus == (uint32_t)0x01)<br>   {<!-- --></p> 
<p align="left">#if !defined STM32F10X_LD_VL &amp;&amp; !defined STM32F10X_MD_VL &amp;&amp; !defined STM32F10X_HD_VL<br>     /* Enable Prefetch Buffer */<br>     FLASH-&gt;ACR |= FLASH_ACR_PRFTBE;</p> 
<p align="left">    /* Flash 0 wait state */<br>     FLASH-&gt;ACR &amp;= (uint32_t)((uint32_t)~FLASH_ACR_LATENCY);</p> 
<p align="left">#ifndef STM32F10X_CL<br>     FLASH-&gt;ACR |= (uint32_t)FLASH_ACR_LATENCY_0;<br> #else<br>     if (HSE_VALUE &lt;= 24000000)<br>  {<!-- --><br>       FLASH-&gt;ACR |= (uint32_t)FLASH_ACR_LATENCY_0;<br>  }<br>  else<br>  {<!-- --><br>       FLASH-&gt;ACR |= (uint32_t)FLASH_ACR_LATENCY_1;<br>  }<br> #endif /* STM32F10X_CL */<br> #endif<br>  <br>     /* HCLK = SYSCLK */<br>     RCC-&gt;CFGR |= (uint32_t)RCC_CFGR_HPRE_DIV1;<br>       <br>     /* PCLK2 = HCLK */<br>     RCC-&gt;CFGR |= (uint32_t)RCC_CFGR_PPRE2_DIV1;<br>     <br>     /* PCLK1 = HCLK */<br>     RCC-&gt;CFGR |= (uint32_t)RCC_CFGR_PPRE1_DIV1;<br>     <br>     /* Select HSE as system clock source */<br>     RCC-&gt;CFGR &amp;= (uint32_t)((uint32_t)~(RCC_CFGR_SW));<br>     RCC-&gt;CFGR |= (uint32_t)RCC_CFGR_SW_HSE;    </p> 
<p align="left">    /* Wait till HSE is used as system clock source */<br>     while ((RCC-&gt;CFGR &amp; (uint32_t)RCC_CFGR_SWS) != (uint32_t)0x04)<br>     {<!-- --><br>     }<br>   }<br>   else<br>   { /* If HSE fails to start-up, the application will have wrong clock <br>          configuration. User can add here some code to deal with this error */<br>   }  <br> }<br> #elif defined SYSCLK_FREQ_24MHz<br> </p> 
<p align="left"><span style="color:red">static void SetSysClockTo72(void)//</span><span style="color:red">系统时钟设置为72M</span>：SYSCLK=72M，HCLK=72M，PCLK1=36M（最高36M），PCLK2=72M，ADCCLK=36M,<br> {<!-- --><br>   __IO uint32_t StartUpCounter = 0, HSEStatus = 0;//启动计数，HSE状态<br>   <br>   /* SYSCLK, HCLK, PCLK2 and PCLK1 configuration ---------------------------*/    <br>   /* Enable HSE */    <br>   RCC-&gt;CR |= ((uint32_t)RCC_CR_HSEON);//HSE使能<br>  <br>   /* Wait till HSE is ready and if Time out is reached exit */<br>   do //循环，直到HSE使能成功或者超时<br>   {<!-- --><br>     HSEStatus = RCC-&gt;CR &amp; RCC_CR_HSERDY;<br>     StartUpCounter++;  <br>   } while((HSEStatus == 0) &amp;&amp; (StartUpCounter != HSE_STARTUP_TIMEOUT));</p> 
<p align="left">  if ((RCC-&gt;CR &amp; RCC_CR_HSERDY) != RESET)<br>   {<!-- --><br>     HSEStatus = (uint32_t)0x01;//HSE使能成功<br>   }<br>   else<br>   {<!-- --><br>     HSEStatus = (uint32_t)0x00;//HSE使能不成功<br>   }  </p> 
<p align="left">  if (HSEStatus == (uint32_t)0x01)//HSE使能成功<br>   {<!-- --><br>     /* Enable Prefetch Buffer */<br>     FLASH-&gt;ACR |= FLASH_ACR_PRFTBE;//flash缓存使能</p> 
<p align="left">    /* Flash 2 wait state */<br>     FLASH-&gt;ACR &amp;= (uint32_t)((uint32_t)~FLASH_ACR_LATENCY);//<br>     FLASH-&gt;ACR |= (uint32_t)FLASH_ACR_LATENCY_2;//    </p> 
<p align="left"> <br>     /* HCLK = SYSCLK */<br>     RCC-&gt;CFGR |= (uint32_t)RCC_CFGR_HPRE_DIV1;//RCC_CFGR_HPRE_DIV1=0，CFGR中的值不变<br>       <br>     /* PCLK2 = HCLK */<br>     RCC-&gt;CFGR |= (uint32_t)RCC_CFGR_PPRE2_DIV1;//RCC_CFGR_PPRE2_DIV1=0，CFGR中的值不变<br>     <br>     /* PCLK1 = HCLK/2 */<br>     RCC-&gt;CFGR |= (uint32_t)RCC_CFGR_PPRE1_DIV2;//低速APB预分频把HCLK 2分频,APB1CLK=HCLK/2</p> 
<p align="left">#ifdef STM32F10X_CL<br>     /* Configure PLLs ------------------------------------------------------*/<br>     /* PLL2 configuration: PLL2CLK = (HSE / 5) * 8 = 40 MHz */<br>     /* PREDIV1 configuration: PREDIV1CLK = PLL2 / 5 = 8 MHz */<br>         <br>     RCC-&gt;CFGR2 &amp;= (uint32_t)~(RCC_CFGR2_PREDIV2 | RCC_CFGR2_PLL2MUL |<br>                               RCC_CFGR2_PREDIV1 | RCC_CFGR2_PREDIV1SRC);<br>     RCC-&gt;CFGR2 |= (uint32_t)(RCC_CFGR2_PREDIV2_DIV5 | RCC_CFGR2_PLL2MUL8 |<br>                              RCC_CFGR2_PREDIV1SRC_PLL2 | RCC_CFGR2_PREDIV1_DIV5);<br>   <br>     /* Enable PLL2 */<br>     RCC-&gt;CR |= RCC_CR_PLL2ON;<br>     /* Wait till PLL2 is ready */<br>     while((RCC-&gt;CR &amp; RCC_CR_PLL2RDY) == 0)<br>     {<!-- --><br>     }<br>     <br>    <br>     /* PLL configuration: PLLCLK = PREDIV1 * 9 = 72 MHz */ <br>     RCC-&gt;CFGR &amp;= (uint32_t)~(RCC_CFGR_PLLXTPRE | RCC_CFGR_PLLSRC | RCC_CFGR_PLLMULL);<br>     RCC-&gt;CFGR |= (uint32_t)(RCC_CFGR_PLLXTPRE_PREDIV1 | RCC_CFGR_PLLSRC_PREDIV1 | <br>                             RCC_CFGR_PLLMULL9); <br> #else    <br>     /*  PLL configuration: PLLCLK = HSE * 9 = 72 MHz */<br>     RCC-&gt;CFGR &amp;= (uint32_t)((uint32_t)~(RCC_CFGR_PLLSRC | RCC_CFGR_PLLXTPRE |  //PLL输入时钟源HSI时钟2分频后作为PLL输入时钟,HSE分频器作为PLL输入HSE不分频 <br>                                         RCC_CFGR_PLLMULL)); //PLL倍频系数PLL 2倍频输出（为了清零其他位）<br>     RCC-&gt;CFGR |= (uint32_t)(RCC_CFGR_PLLSRC_HSE | RCC_CFGR_PLLMULL9);//PLL输入时钟源HSE时钟作为PLL输入时钟,PLL倍频系数PLL 9倍频输出 <br> #endif /* STM32F10X_CL */</p> 
<p align="left">    /* Enable PLL */<br>     RCC-&gt;CR |= RCC_CR_PLLON; //PLL使能</p> 
<p align="left">    /* Wait till PLL is ready */<br>     while((RCC-&gt;CR &amp; RCC_CR_PLLRDY) == 0)//等待PLL使能成功<br>     {<!-- --><br>     }<br>     <br>     /* Select PLL as system clock source */<br>     RCC-&gt;CFGR &amp;= (uint32_t)((uint32_t)~(RCC_CFGR_SW));//HSI作为系统时钟(为了清零其他位)<br>     RCC-&gt;CFGR |= (uint32_t)RCC_CFGR_SW_PLL; //PLL输出作为系统时钟   </p> 
<p align="left">    /* Wait till PLL is used as system clock source */<br>     while ((RCC-&gt;CFGR &amp; (uint32_t)RCC_CFGR_SWS) != (uint32_t)0x08)//等待直到PLL成功用作系统时钟源<br>     {<!-- --><br>     }<br>   }<br>   else<br>   { /* If HSE fails to start-up, the application will have wrong clock <br>          configuration. User can add here some code to deal with this error */<br>   }<br> }<br> #endif</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/83ed8bc720e96fa31eb41994469d58de/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">智能运维挑战</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e944885cee1af241294c674f379abfc5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">windows之打开文件夹、控制面板显示服务器运行失败</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>