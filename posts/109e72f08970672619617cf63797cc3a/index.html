<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>大创项目推荐 深度学习图像修复算法 - opencv python 机器视觉 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="大创项目推荐 深度学习图像修复算法 - opencv python 机器视觉" />
<meta property="og:description" content="文章目录 0 前言2 什么是图像内容填充修复3 原理分析3.1 第一步：将图像理解为一个概率分布的样本3.2 补全图像 3.3 快速生成假图像3.4 生成对抗网络(Generative Adversarial Net, GAN) 的架构3.5 使用G(z)生成伪图像 4 在Tensorflow上构建DCGANs最后 0 前言 🔥 优质竞赛项目系列，今天要分享的是
🚩 深度学图像修复算法
该项目较为新颖，适合作为竞赛课题方向，学长非常推荐！
🥇学长这里给一个题目综合评分(每项满分5分)
难度系数：3分工作量：3分创新点：4分 🧿 更多资料, 项目分享：
https://gitee.com/dancheng-senior/postgraduate
2 什么是图像内容填充修复 内容识别填充(译注: Content-aware fill ,是 photoshop
的一个功能)是一个强大的工具，设计师和摄影师可以用它来填充图片中不想要的部分或者缺失的部分。在填充图片的缺失或损坏的部分时，图像补全和修复是两种密切相关的技术。有很多方法可以实现内容识别填充，图像补全和修复。
首先我们将图像理解为一个概率分布的样本。基于这种理解，学*如何生成伪图片。然后我们找到最适合填充回去的伪图片。 自动删除不需要的部分（海滩上的人）
最经典的人脸补充
补充前：
补充后：
3 原理分析 3.1 第一步：将图像理解为一个概率分布的样本 你是怎样补全缺失信息的呢？
在上面的例子中，想象你正在构造一个可以填充缺失部分的系统。你会怎么做呢？你觉得人类大脑是怎么做的呢？你使用了什么样的信息呢？
在博文中，我们会关注两种信息：
语境信息：你可以通过周围的像素来推测缺失像素的信息。
感知信息：你会用“正常”的部分来填充，比如你在现实生活中或其它图片上看到的样子。
两者都很重要。没有语境信息，你怎么知道填充哪一个进去？没有感知信息，通过同样的上下文可以生成无数种可能。有些机器学*系统看起来“正常”的图片，人类看起来可能不太正常。
如果有一种确切的、直观的算法，可以捕获前文图像补全步骤介绍中提到的两种属性，那就再好不过了。对于特定的情况，构造这样的算法是可行的。但是没有一般的方法。目前最好的解决方案是通过统计和机器学习来得到一个类似的技术。
从这个分布中采样，就可以得到一些数据。需要搞清楚的是PDF和样本之间的联系。
从正态分布中的采样
2维图像的PDF和采样。 PDF 用等高线图表示，样本点画在上面。
3.2 补全图像 首先考虑多变量正态分布， 以求得到一些启发。给定 x=1 , 那么 y 最可能的值是什么？我们可以固定x的值，然后找到使PDF最大的 y。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/109e72f08970672619617cf63797cc3a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-05T16:22:18+08:00" />
<meta property="article:modified_time" content="2024-01-05T16:22:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">大创项目推荐 深度学习图像修复算法 - opencv python 机器视觉</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#0__2" rel="nofollow">0 前言</a></li><li><a href="#2__20" rel="nofollow">2 什么是图像内容填充修复</a></li><li><a href="#3__43" rel="nofollow">3 原理分析</a></li><li><ul><li><a href="#31__45" rel="nofollow">3.1 第一步：将图像理解为一个概率分布的样本</a></li><li><a href="#32__70" rel="nofollow">3.2 补全图像</a></li></ul> 
  </li><li><a href="#33__80" rel="nofollow">3.3 快速生成假图像</a></li><li><ul><li><a href="#34_Generative_Adversarial_Net_GAN__88" rel="nofollow">3.4 生成对抗网络(Generative Adversarial Net, GAN) 的架构</a></li><li><a href="#35_Gz_97" rel="nofollow">3.5 使用G(z)生成伪图像</a></li></ul> 
  </li><li><a href="#4_TensorflowDCGANs_103" rel="nofollow">4 在Tensorflow上构建DCGANs</a></li><li><a href="#_218" rel="nofollow">最后</a></li></ul> 
</div> 
<p></p> 
<h2><a id="0__2"></a>0 前言</h2> 
<p>🔥 优质竞赛项目系列，今天要分享的是</p> 
<p>🚩 <strong>深度学图像修复算法</strong></p> 
<p>该项目较为新颖，适合作为竞赛课题方向，学长非常推荐！</p> 
<p>🥇学长这里给一个题目综合评分(每项满分5分)</p> 
<ul><li>难度系数：3分</li><li>工作量：3分</li><li>创新点：4分</li></ul> 
<p>🧿 <strong>更多资料, 项目分享：</strong></p> 
<p><a href="https://gitee.com/dancheng-senior/postgraduate" rel="nofollow">https://gitee.com/dancheng-senior/postgraduate</a></p> 
<h2><a id="2__20"></a>2 什么是图像内容填充修复</h2> 
<p>内容识别填充(译注: Content-aware fill ,是 photoshop<br> 的一个功能)是一个强大的工具，设计师和摄影师可以用它来填充图片中不想要的部分或者缺失的部分。在填充图片的缺失或损坏的部分时，图像补全和修复是两种密切相关的技术。有很多方法可以实现内容识别填充，图像补全和修复。</p> 
<ul><li>首先我们将图像理解为一个概率分布的样本。</li><li>基于这种理解，学*如何生成伪图片。</li><li>然后我们找到最适合填充回去的伪图片。</li></ul> 
<p><img src="https://images2.imgbox.com/c1/e9/JQAL0Vc2_o.png" alt="在这里插入图片描述"></p> 
<p>自动删除不需要的部分（海滩上的人）<br> <img src="https://images2.imgbox.com/6d/37/Kxb9ryyi_o.png" alt="在这里插入图片描述"></p> 
<p>最经典的人脸补充</p> 
<p>补充前：</p> 
<p><img src="https://images2.imgbox.com/33/6c/ZtlHbJzX_o.png" alt="在这里插入图片描述"></p> 
<p>补充后：<br> <img src="https://images2.imgbox.com/97/68/gbouqRCy_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="3__43"></a>3 原理分析</h2> 
<h3><a id="31__45"></a>3.1 第一步：将图像理解为一个概率分布的样本</h3> 
<p>你是怎样补全缺失信息的呢？</p> 
<p>在上面的例子中，想象你正在构造一个可以填充缺失部分的系统。你会怎么做呢？你觉得人类大脑是怎么做的呢？你使用了什么样的信息呢？</p> 
<p>在博文中，我们会关注两种信息：</p> 
<p>语境信息：你可以通过周围的像素来推测缺失像素的信息。</p> 
<p>感知信息：你会用“正常”的部分来填充，比如你在现实生活中或其它图片上看到的样子。<br> 两者都很重要。没有语境信息，你怎么知道填充哪一个进去？没有感知信息，通过同样的上下文可以生成无数种可能。有些机器学*系统看起来“正常”的图片，人类看起来可能不太正常。<br> 如果有一种确切的、直观的算法，可以捕获前文图像补全步骤介绍中提到的两种属性，那就再好不过了。对于特定的情况，构造这样的算法是可行的。但是没有一般的方法。目前最好的解决方案是通过统计和机器学习来得到一个类似的技术。</p> 
<p><img src="https://images2.imgbox.com/c6/02/hJ3FMuNs_o.png" alt="在这里插入图片描述"></p> 
<p>从这个分布中采样，就可以得到一些数据。需要搞清楚的是PDF和样本之间的联系。</p> 
<p><img src="https://images2.imgbox.com/a1/80/paIRLsP2_o.png" alt="在这里插入图片描述"></p> 
<p>从正态分布中的采样</p> 
<p><img src="https://images2.imgbox.com/8e/8f/lSBgyZPj_o.png" alt="在这里插入图片描述"><br> 2维图像的PDF和采样。 PDF 用等高线图表示，样本点画在上面。</p> 
<h3><a id="32__70"></a>3.2 补全图像</h3> 
<p>首先考虑多变量正态分布， 以求得到一些启发。给定 x=1 , 那么 y 最可能的值是什么？我们可以固定x的值，然后找到使PDF最大的 y。<br> <img src="https://images2.imgbox.com/47/61/VUReDNh9_o.png" alt="在这里插入图片描述"><br> 在多维正态分布中，给定x，得到最大可能的y</p> 
<p>这个概念可以很自然地推广到图像概率分布。我们已知一些值，希望补全缺失值。这可以简单理解成一个最大化问题。我们搜索所有可能的缺失值，用于补全的图像就是可能性最大的值。<br> 从正态分布的样本来看，只通过样本，我们就可以得出PDF。只需挑选你喜欢的 统计模型， 然后拟合数据即可。<br> 然而，我们实际上并没有使用这种方法。对于简单分布来说，PDF很容易得出来。但是对于更复杂的图像分布来说，就十分困难，难以处理。之所以复杂，一部分原因是复杂的条件依赖：一个像素的值依赖于图像中其它像素的值。另外，最大化一个一般的PDF是一个非常困难和棘手的非凸优化问题。</p> 
<h2><a id="33__80"></a>3.3 快速生成假图像</h2> 
<p>在未知概率分布情况下，学习生成新样本</p> 
<p>除了学 <em>如何计算PDF之外，统计学中另一个成熟的想法是学</em> 怎样用 生成模型<br> 生成新的（随机）样本。生成模型一般很难训练和处理，但是后来深度学*社区在这个领域有了一个惊人的突破。Yann LeCun 在这篇 Quora<br> 回答中对如何进行生成模型的训练进行了一番精彩的论述，并将它称为机器学习领域10年来最有意思的想法。</p> 
<h3><a id="34_Generative_Adversarial_Net_GAN__88"></a>3.4 生成对抗网络(Generative Adversarial Net, GAN) 的架构</h3> 
<p>使用微步长卷积，对图像进行上采样</p> 
<p><img src="https://images2.imgbox.com/16/28/Mjr4xM9E_o.png" alt="在这里插入图片描述"><br> 现在我们有了微步长卷积结构，可以得到G(z)的表达，以一个向量z∼pz 作为输入，输出一张 64x64x3 的RGB图像。</p> 
<p><img src="https://images2.imgbox.com/6a/12/P64tFsfz_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="35_Gz_97"></a>3.5 使用G(z)生成伪图像</h3> 
<p>基于DCGAN的人脸代数运算 DCGAN论文 。</p> 
<p><img src="https://images2.imgbox.com/16/b1/diPxlDaz_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="4_TensorflowDCGANs_103"></a>4 在Tensorflow上构建DCGANs</h2> 
<p>部分代码：</p> 
<p>​</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">generator</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> z<span class="token punctuation">)</span><span class="token punctuation">:</span>
    self<span class="token punctuation">.</span>z_<span class="token punctuation">,</span> self<span class="token punctuation">.</span>h0_w<span class="token punctuation">,</span> self<span class="token punctuation">.</span>h0_b <span class="token operator">=</span> linear<span class="token punctuation">(</span>z<span class="token punctuation">,</span> self<span class="token punctuation">.</span>gf_dim<span class="token operator">*</span><span class="token number">8</span><span class="token operator">*</span><span class="token number">4</span><span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'g_h0_lin'</span><span class="token punctuation">,</span> with_w<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    self<span class="token punctuation">.</span>h0 <span class="token operator">=</span> tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>self<span class="token punctuation">.</span>z_<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>gf_dim <span class="token operator">*</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    h0 <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>g_bn0<span class="token punctuation">(</span>self<span class="token punctuation">.</span>h0<span class="token punctuation">)</span><span class="token punctuation">)</span>

    self<span class="token punctuation">.</span>h1<span class="token punctuation">,</span> self<span class="token punctuation">.</span>h1_w<span class="token punctuation">,</span> self<span class="token punctuation">.</span>h1_b <span class="token operator">=</span> conv2d_transpose<span class="token punctuation">(</span>h0<span class="token punctuation">,</span>
        <span class="token punctuation">[</span>self<span class="token punctuation">.</span>batch_size<span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>gf_dim<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'g_h1'</span><span class="token punctuation">,</span> with_w<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    h1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>g_bn1<span class="token punctuation">(</span>self<span class="token punctuation">.</span>h1<span class="token punctuation">)</span><span class="token punctuation">)</span>

    h2<span class="token punctuation">,</span> self<span class="token punctuation">.</span>h2_w<span class="token punctuation">,</span> self<span class="token punctuation">.</span>h2_b <span class="token operator">=</span> conv2d_transpose<span class="token punctuation">(</span>h1<span class="token punctuation">,</span>
        <span class="token punctuation">[</span>self<span class="token punctuation">.</span>batch_size<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>gf_dim<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'g_h2'</span><span class="token punctuation">,</span> with_w<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    h2 <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>g_bn2<span class="token punctuation">(</span>h2<span class="token punctuation">)</span><span class="token punctuation">)</span>

    h3<span class="token punctuation">,</span> self<span class="token punctuation">.</span>h3_w<span class="token punctuation">,</span> self<span class="token punctuation">.</span>h3_b <span class="token operator">=</span> conv2d_transpose<span class="token punctuation">(</span>h2<span class="token punctuation">,</span>
        <span class="token punctuation">[</span>self<span class="token punctuation">.</span>batch_size<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>gf_dim<span class="token operator">*</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'g_h3'</span><span class="token punctuation">,</span> with_w<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    h3 <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>g_bn3<span class="token punctuation">(</span>h3<span class="token punctuation">)</span><span class="token punctuation">)</span>

    h4<span class="token punctuation">,</span> self<span class="token punctuation">.</span>h4_w<span class="token punctuation">,</span> self<span class="token punctuation">.</span>h4_b <span class="token operator">=</span> conv2d_transpose<span class="token punctuation">(</span>h3<span class="token punctuation">,</span>
        <span class="token punctuation">[</span>self<span class="token punctuation">.</span>batch_size<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'g_h4'</span><span class="token punctuation">,</span> with_w<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>tanh<span class="token punctuation">(</span>h4<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">discriminator</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> image<span class="token punctuation">,</span> reuse<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> reuse<span class="token punctuation">:</span>
        tf<span class="token punctuation">.</span>get_variable_scope<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reuse_variables<span class="token punctuation">(</span><span class="token punctuation">)</span>

    h0 <span class="token operator">=</span> lrelu<span class="token punctuation">(</span>conv2d<span class="token punctuation">(</span>image<span class="token punctuation">,</span> self<span class="token punctuation">.</span>df_dim<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'d_h0_conv'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    h1 <span class="token operator">=</span> lrelu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>d_bn1<span class="token punctuation">(</span>conv2d<span class="token punctuation">(</span>h0<span class="token punctuation">,</span> self<span class="token punctuation">.</span>df_dim<span class="token operator">*</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'d_h1_conv'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    h2 <span class="token operator">=</span> lrelu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>d_bn2<span class="token punctuation">(</span>conv2d<span class="token punctuation">(</span>h1<span class="token punctuation">,</span> self<span class="token punctuation">.</span>df_dim<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'d_h2_conv'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    h3 <span class="token operator">=</span> lrelu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>d_bn3<span class="token punctuation">(</span>conv2d<span class="token punctuation">(</span>h2<span class="token punctuation">,</span> self<span class="token punctuation">.</span>df_dim<span class="token operator">*</span><span class="token number">8</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'d_h3_conv'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    h4 <span class="token operator">=</span> linear<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>h3<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8192</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'d_h3_lin'</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>h4<span class="token punctuation">)</span><span class="token punctuation">,</span> h4
</code></pre> 
<p>当我们初始化这个类的时候，将要用到这两个函数来构建模型。我们需要两个判别器，它们共享（复用）参数。一个用于来自数据分布的小批图像，另一个用于生成器生成的小批图像。</p> 
<p>​</p> 
<pre><code class="prism language-python">self<span class="token punctuation">.</span>G <span class="token operator">=</span> self<span class="token punctuation">.</span>generator<span class="token punctuation">(</span>self<span class="token punctuation">.</span>z<span class="token punctuation">)</span>
self<span class="token punctuation">.</span>D<span class="token punctuation">,</span> self<span class="token punctuation">.</span>D_logits <span class="token operator">=</span> self<span class="token punctuation">.</span>discriminator<span class="token punctuation">(</span>self<span class="token punctuation">.</span>images<span class="token punctuation">)</span>
self<span class="token punctuation">.</span>D_<span class="token punctuation">,</span> self<span class="token punctuation">.</span>D_logits_ <span class="token operator">=</span> self<span class="token punctuation">.</span>discriminator<span class="token punctuation">(</span>self<span class="token punctuation">.</span>G<span class="token punctuation">,</span> reuse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p>接下来，我们定义损失函数。这里我们不用求和，而是用D的预测值和真实值之间的交叉熵（cross<br> entropy），因为它更好用。判别器希望对所有“真”数据的预测都是1，对所有生成器生成的“伪”数据的预测都是0。生成器希望判别器对两者的预测都是1 。</p> 
<p>​</p> 
<pre><code class="prism language-python">self<span class="token punctuation">.</span>d_loss_real <span class="token operator">=</span> tf<span class="token punctuation">.</span>reduce_mean<span class="token punctuation">(</span>
    tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>sigmoid_cross_entropy_with_logits<span class="token punctuation">(</span>self<span class="token punctuation">.</span>D_logits<span class="token punctuation">,</span>
                                            tf<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>self<span class="token punctuation">.</span>D<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
self<span class="token punctuation">.</span>d_loss_fake <span class="token operator">=</span> tf<span class="token punctuation">.</span>reduce_mean<span class="token punctuation">(</span>
    tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>sigmoid_cross_entropy_with_logits<span class="token punctuation">(</span>self<span class="token punctuation">.</span>D_logits_<span class="token punctuation">,</span>
                                            tf<span class="token punctuation">.</span>zeros_like<span class="token punctuation">(</span>self<span class="token punctuation">.</span>D_<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
self<span class="token punctuation">.</span>g_loss <span class="token operator">=</span> tf<span class="token punctuation">.</span>reduce_mean<span class="token punctuation">(</span>
    tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>sigmoid_cross_entropy_with_logits<span class="token punctuation">(</span>self<span class="token punctuation">.</span>D_logits_<span class="token punctuation">,</span>
                                            tf<span class="token punctuation">.</span>ones_like<span class="token punctuation">(</span>self<span class="token punctuation">.</span>D_<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
self<span class="token punctuation">.</span>d_loss <span class="token operator">=</span> self<span class="token punctuation">.</span>d_loss_real <span class="token operator">+</span> self<span class="token punctuation">.</span>d_loss_fake
</code></pre> 
<p>下面我们遍历数据。每一次迭代，我们采样一个小批数据，然后使用优化器来更新网络。有趣的是，如果G只更新一次，鉴别器的损失不会变成0。另外，我认为最后调用<br> d_loss_fake 和 d_loss_real 进行了一些不必要的计算， 因为这些值在 d_optim 和 g_optim 中已经计算过了。<br> 作为Tensorflow 的一个联系，你可以试着优化这一部分，并发送PR到原始的repo。</p> 
<p>​</p> 
<pre><code class="prism language-python">

    <span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">xrange</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>epoch<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token keyword">for</span> idx <span class="token keyword">in</span> <span class="token builtin">xrange</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> batch_idxs<span class="token punctuation">)</span><span class="token punctuation">:</span>
            batch_images <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    
            batch_z <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>uniform<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>config<span class="token punctuation">.</span>batch_size<span class="token punctuation">,</span> self<span class="token punctuation">.</span>z_dim<span class="token punctuation">]</span><span class="token punctuation">)</span> \
                        <span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
    
            <span class="token comment"># Update D network</span>
            _<span class="token punctuation">,</span> summary_str <span class="token operator">=</span> self<span class="token punctuation">.</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span>d_optim<span class="token punctuation">,</span> self<span class="token punctuation">.</span>d_sum<span class="token punctuation">]</span><span class="token punctuation">,</span>
                feed_dict<span class="token operator">=</span><span class="token punctuation">{<!-- --></span> self<span class="token punctuation">.</span>images<span class="token punctuation">:</span> batch_images<span class="token punctuation">,</span> self<span class="token punctuation">.</span>z<span class="token punctuation">:</span> batch_z <span class="token punctuation">}</span><span class="token punctuation">)</span>


            <span class="token comment"># Update G network</span>
            _<span class="token punctuation">,</span> summary_str <span class="token operator">=</span> self<span class="token punctuation">.</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span>g_optim<span class="token punctuation">,</span> self<span class="token punctuation">.</span>g_sum<span class="token punctuation">]</span><span class="token punctuation">,</span>
                feed_dict<span class="token operator">=</span><span class="token punctuation">{<!-- --></span> self<span class="token punctuation">.</span>z<span class="token punctuation">:</span> batch_z <span class="token punctuation">}</span><span class="token punctuation">)</span>


            <span class="token comment"># Run g_optim twice to make sure that d_loss does not go to zero (different from paper)</span>
            _<span class="token punctuation">,</span> summary_str <span class="token operator">=</span> self<span class="token punctuation">.</span>sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span>g_optim<span class="token punctuation">,</span> self<span class="token punctuation">.</span>g_sum<span class="token punctuation">]</span><span class="token punctuation">,</span>
                feed_dict<span class="token operator">=</span><span class="token punctuation">{<!-- --></span> self<span class="token punctuation">.</span>z<span class="token punctuation">:</span> batch_z <span class="token punctuation">}</span><span class="token punctuation">)</span>


            errD_fake <span class="token operator">=</span> self<span class="token punctuation">.</span>d_loss_fake<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>z<span class="token punctuation">:</span> batch_z<span class="token punctuation">}</span><span class="token punctuation">)</span>
            errD_real <span class="token operator">=</span> self<span class="token punctuation">.</span>d_loss_real<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>images<span class="token punctuation">:</span> batch_images<span class="token punctuation">}</span><span class="token punctuation">)</span>
            errG <span class="token operator">=</span> self<span class="token punctuation">.</span>g_loss<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>z<span class="token punctuation">:</span> batch_z<span class="token punctuation">}</span><span class="token punctuation">)</span>


</code></pre> 
<h2><a id="_218"></a>最后</h2> 
<p>🧿 <strong>更多资料, 项目分享：</strong></p> 
<p><a href="https://gitee.com/dancheng-senior/postgraduate" rel="nofollow">https://gitee.com/dancheng-senior/postgraduate</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9683f9a252a01093f8aa4f552bae1aea/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ReactNative 常见问题及处理办法（加固混淆）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2febd97d8ed0d4fcfddb9bf808a4c169/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何使用 NFTScan NFT API 在 PlatON 网络上开发 Web3 应用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>