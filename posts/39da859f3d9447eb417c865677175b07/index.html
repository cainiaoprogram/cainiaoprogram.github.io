<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>面试宝典之ElasticSearch面试题 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="面试宝典之ElasticSearch面试题" />
<meta property="og:description" content="E01、什么是倒排索引？ ES分词器通过扫描文章中的每一个词，对每一个词建立一个索引，指明该词在文章中出现的次数和位置，当用户查询时，检索程序就根据事先建立的索引进行查找，并将查找的结果反馈给用户的检索方式。这种建立索引的方式叫倒排索引。
当数据写入 ES 时，数据将会通过 分词 被切分为不同的term，ES 将term 与其对应的文档列表建立一种映射关系，这种结构就是 倒排索引。如下图所示：
参考文章 E02、ES脑裂是怎么回事？（扩展） 脑裂问题，就是同一个集群中的不同节点，对于集群的状态，有了不一样的理解。
由于并发访问量的提高，导致了我们两个节点的集群（分片数默认为5，副本为1，没有固定的master，都是集群中的节点又做data又做master）状态变成了red，出现了大量的坏片，并且坏掉的都是主分片及其副本。分析发现，是ES集群出现了脑裂问题（俗称精神分裂），即**集群中不同的节点对于master的选择出现了分歧，出现了多个master竞争，导致主分片和副本的识别也发生了分歧，对一些分歧中的分片标识为了坏片。**
理解思路 原因1：网络问题，导致由多个主原因2：主节点负载过大 E03、“脑裂”问题是怎么形成的？（扩展） 1.网络问题：集群间的网络延迟导致一些节点访问不到master，认为master挂掉了从而选举出新的master，并对master上的分片和副本标红，分配新的主分片
2.节点负载：主节点的角色既为master又为data，访问量较大时可能会导致ES停止响应造成大面积延迟，此时其他节点得不到主节点的响应认为主节点挂掉了，会重新选取主节点。
3.内存回收：data节点上的ES进程占用的内存较大，引发JVM的大规模内存回收，造成ES进程失去响应。
E04、脑裂问题如何解决？（扩展） 1、减少误判。discovery.zen.ping_timeout节点状态的响应时间，默认为3s，可以适当调大，减少误判。
2、选举触发。discovery.zen.minimum_master_nodes:1，该参数是用于控制选举行为发生的最小集群主节点数量。增大该参数，这样参与选举的节点增多，减少选举。
3、角色分离：即master节点与data节点分离，限制角色。
主节点配置为：
node.master: true node.data: false
从节点配置为：
node.master: false node.data: true
E05、ES如何添加自定义词库、热更新词库？（扩展） 我们项目中使用中文分词器IK分词器。
1、在ik插件对应的配置文件目录下创建一个自定义词库文件 my.dic。直接在文件中添加词语即可，每一个词语一行。
2、修改ik的IKAnalyzer.cfg.xml配置文件。
3、将修改好的IK配置文件复制到集群中的所有节点中。
4、重启ES验证一下自定义词库的分词效果。
E06、ES如何分页？ 默认情况下，不加from，size的话，ES会返回前10条记录。加上from，size就会查询指定的条数。其中from代表起始行号，size代表查询行数。
1、深度分页（from&#43;size）
2、快照查询（scroll）
3、Search After" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/39da859f3d9447eb417c865677175b07/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-09T19:38:32+08:00" />
<meta property="article:modified_time" content="2024-01-09T19:38:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">面试宝典之ElasticSearch面试题</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>E01、什么是倒排索引？</h3> 
<p>ES分词器通过扫描文章中的每一个词，对每一个词建立一个索引，指明该词在文章中出现的次数和位置，当用户查询时，检索程序就根据事先建立的索引进行查找，并将查找的结果反馈给用户的检索方式。这种建立索引的方式叫倒排索引。<br> 当数据写入 ES 时，数据将会通过 <strong>分词</strong> 被切分为不同的term，ES 将term 与其对应的文档列表建立一种映射关系，这种结构就是 倒排索引。如下图所示：</p> 
<p></p> 
<p class="img-center"><img alt="图片alt" height="452" src="https://images2.imgbox.com/fb/98/TMgF3KTh_o.png" width="1200"></p> 
<ul><li><a href="https://blog.csdn.net/weixin_42128977/article/details/127705236" title="参考文章">参考文章</a></li></ul> 
<h3>E02、ES脑裂是怎么回事？（扩展）</h3> 
<p>脑裂问题，就是同一个集群中的不同节点，对于集群的状态，有了不一样的理解。</p> 
<p>由于并发访问量的提高，导致了我们两个节点的集群（分片数默认为5，副本为1，没有固定的master，都是集群中的节点又做data又做master）状态变成了red，出现了大量的坏片，并且坏掉的都是主分片及其副本。分析发现，是ES集群出现了脑裂问题（俗称精神分裂），即**集群中不同的节点对于master的选择出现了分歧，出现了多个master竞争，导致主分片和副本的识别也发生了分歧，对一些分歧中的分片标识为了坏片。**</p> 
<h5>理解思路</h5> 
<ul><li>原因1：网络问题，导致由多个主</li><li>原因2：主节点负载过大</li></ul> 
<h3>E03、“脑裂”问题是怎么形成的？（扩展）</h3> 
<p>1.网络问题：集群间的网络延迟导致一些节点访问不到master，认为master挂掉了从而选举出新的master，并对master上的分片和副本标红，分配新的主分片</p> 
<p>2.节点负载：主节点的角色既为master又为data，访问量较大时可能会导致ES停止响应造成大面积延迟，此时其他节点得不到主节点的响应认为主节点挂掉了，会重新选取主节点。</p> 
<p>3.内存回收：data节点上的ES进程占用的内存较大，引发JVM的大规模内存回收，造成ES进程失去响应。</p> 
<h3>E04、脑裂问题如何解决？（扩展）</h3> 
<p>1、减少误判。discovery.zen.ping_timeout节点状态的响应时间，默认为3s，可以适当调大，减少误判。<br> 2、选举触发。discovery.zen.minimum_master_nodes:1，该参数是用于控制选举行为发生的最小集群主节点数量。增大该参数，这样参与选举的节点增多，减少选举。<br> 3、角色分离：即master节点与data节点分离，限制角色。<br> 主节点配置为：<br> node.master: true node.data: false<br> 从节点配置为：<br> node.master: false node.data: true</p> 
<h3>E05、ES如何添加自定义词库、热更新词库？（扩展）</h3> 
<p>我们项目中使用中文分词器IK分词器。<br> 1、在ik插件对应的配置文件目录下创建一个自定义词库文件 my.dic。直接在文件中添加词语即可，每一个词语一行。<br> 2、修改ik的IKAnalyzer.cfg.xml配置文件。<br> 3、将修改好的IK配置文件复制到集群中的所有节点中。<br> 4、重启ES验证一下自定义词库的分词效果。</p> 
<h3>E06、ES如何分页？</h3> 
<p>默认情况下，不加from，size的话，ES会返回前10条记录。加上from，size就会查询指定的条数。其中from代表起始行号，size代表查询行数。</p> 
<p>1、深度分页（from+size）<br> 2、快照查询（scroll）<br> 3、Search After</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2414e9c65dc0560c42e556e027d9d8ed/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">面试宝典之消息中间件面试题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ddf5f461b995b96059b91fae8ea22849/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C&#43;&#43;其他语法总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>