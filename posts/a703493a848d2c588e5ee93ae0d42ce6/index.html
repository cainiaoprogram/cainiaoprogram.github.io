<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>用 JavaScript 实现手势库 — 手势动画应用【前端组件化】 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="用 JavaScript 实现手势库 — 手势动画应用【前端组件化】" />
<meta property="og:description" content="前端《组件化系列》目录 「一」用 JSX 建立组件 Parser（解析器）「二」使用 JSX 建立 Markup 组件风格「三」用 JSX 实现 Carousel 轮播组件「四」用 JavaScript 实现时间轴与动画「五」用 JavaScript 实现三次贝塞尔动画库 - 前端组件化「六」用 JavaScript 实现手势库 - 实现监听逻辑「七」用 JavaScript 实现手势库 — 手势逻辑「八」用 JavaScript 实现手势库 — 支持多键触发「九」用 JavaScript 实现手势库 — 事件派发与 Flick 事件「十」用 JavaScript 实现手势库 — 封装手势库「十一」用 JavaScript 实现手势库 — 手势动画应用 《 本期 》… 待续 … 通过上几篇文章，我们对动画已经有了更深入的了解。这里我们就回到我们之前写好的 Carousel 组件。
如果我们回头去看看我们之前写的 Carousel 代码，我们会发现这里的代码我们真的是写的太粗躁了。
我们的拖拽功能中的点击和拖动都是分不清楚的。然后我们也是没有做 flick 的这种判断。动画的时间也是用 CSS 动画来完成的。
更不用说，这个拖拽动画是否可以暂停、继续这样的逻辑。
那么这里我们就把我们上几篇在文章中实现的 Animation（动画库）和 Gesture（手势库）应用进来，从而实现一个完善的 Carousel（轮播组件）。
同学们注意： 只看这篇文章是无法看懂的，因为这篇文章的内容，都是基于之前的《轮播组件》、《实现动画库》、《实现手势库》三篇文章的内容。还没有学习这三篇文章的，请先前往学习再回来看这里哦～
Gesture 库应用 我们之前写的 Gesture, 是一个单独可用的手势库。但是如果它是作为一个正式的一个 Library，我们还是需要对它进行一些单元测试，或者一些代码 lint 风格的检查等等。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a703493a848d2c588e5ee93ae0d42ce6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-24T12:16:46+08:00" />
<meta property="article:modified_time" content="2021-10-24T12:16:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">用 JavaScript 实现手势库 — 手势动画应用【前端组件化】</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/c6/b7/VfD3WJZA_o.jpg" alt=""></p> 
<h3><a id="_1"></a>前端《组件化系列》目录</h3> 
<ul><li>「一」<a href="https://tridiamond.blog.csdn.net/article/details/112352745" rel="nofollow">用 JSX 建立组件 Parser（解析器）</a></li><li>「二」<a href="https://tridiamond.blog.csdn.net/article/details/112655866" rel="nofollow">使用 JSX 建立 Markup 组件风格</a></li><li>「三」<a href="https://tridiamond.blog.csdn.net/article/details/112656150" rel="nofollow">用 JSX 实现 Carousel 轮播组件</a></li><li>「四」<a href="https://tridiamond.blog.csdn.net/article/details/115437875" rel="nofollow">用 JavaScript 实现时间轴与动画</a></li><li>「五」<a href="https://tridiamond.blog.csdn.net/article/details/115438950" rel="nofollow">用 JavaScript 实现三次贝塞尔动画库 - 前端组件化</a></li><li>「六」<a href="https://tridiamond.blog.csdn.net/article/details/116136518" rel="nofollow">用 JavaScript 实现手势库 - 实现监听逻辑</a></li><li>「七」<a href="https://tridiamond.blog.csdn.net/article/details/116399017" rel="nofollow">用 JavaScript 实现手势库 — 手势逻辑</a></li><li>「八」<a href="https://tridiamond.blog.csdn.net/article/details/116633780" rel="nofollow">用 JavaScript 实现手势库 — 支持多键触发</a></li><li>「九」<a href="https://tridiamond.blog.csdn.net/article/details/117129384" rel="nofollow">用 JavaScript 实现手势库 — 事件派发与 Flick 事件</a></li><li>「十」<a href="https://tridiamond.blog.csdn.net/article/details/118083272" rel="nofollow">用 JavaScript 实现手势库 — 封装手势库</a></li><li>「十一」<a href="https://tridiamond.blog.csdn.net/article/details/120931805" rel="nofollow">用 JavaScript 实现手势库 — 手势动画应用</a> 《 本期 》</li><li>… 待续 …</li></ul> 
<p>通过上几篇文章，我们对动画已经有了更深入的了解。这里我们就回到我们之前写好的 Carousel 组件。</p> 
<p>如果我们回头去看看我们之前写的 Carousel 代码，我们会发现这里的代码我们真的是写的太粗躁了。</p> 
<p>我们的拖拽功能中的点击和拖动都是分不清楚的。然后我们也是没有做 <code>flick</code> 的这种判断。动画的时间也是用 CSS 动画来完成的。</p> 
<p>更不用说，这个拖拽动画是否可以暂停、继续这样的逻辑。</p> 
<p>那么这里我们就把我们上几篇在文章中实现的 Animation（动画库）和 Gesture（手势库）应用进来，从而实现一个完善的 Carousel（轮播组件）。</p> 
<blockquote> 
 <p><strong>同学们注意：</strong> 只看这篇文章是无法看懂的，因为这篇文章的内容，都是基于之前的《轮播组件》、《实现动画库》、《实现手势库》三篇文章的内容。还没有学习这三篇文章的，请先前往学习再回来看这里哦～</p> 
</blockquote> 
<hr> 
<h3><a id="Gesture__29"></a>Gesture 库应用</h3> 
<p>我们之前写的 Gesture, 是一个单独可用的手势库。但是如果它是作为一个正式的一个 Library，我们还是需要对它进行一些单元测试，或者一些代码 lint 风格的检查等等。</p> 
<p>最后，它是可以单独作为一个 npm 模块去安装使用。不过我们目前的 Gesture 库还没有这些基础设施。所以我们就直接拿过来用了。</p> 
<blockquote> 
 <p>不过很多公司确实也是这样用的，写一个库，然后靠着业务去提升它的稳定性。这个也不能说是错误。在工作中也有很多库是通过 end to end 的测试来覆盖它的功能的。</p> 
</blockquote> 
<p>从复杂性来讲，animation、gesture 和 carousel 都有一定的复杂性。当我们做了架构拆分之后，我们分别独立管理了这三部分的复杂性。否则如果这三部分融在一起的话，绝对会要了我们的命的。</p> 
<p>讲那么多，我们一起正式进入改装我们原来的 carousel 组件吧。</p> 
<h4><a id="_render_41"></a>重构 render()</h4> 
<p>首先我们需要注释掉原来 <code>render()</code> 里面的逻辑：</p> 
<pre><code class="prism language-javascript"><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'carousel'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> picture <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>src<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">let</span> child <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      child<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundImage <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">url('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>picture<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">')</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
    <span class="token keyword">let</span> position <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">;</span>
    
    <span class="token comment">/* ... 保留到这里 ... */</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>然后我们需要重新使用我们 gesture 库中的 <code>enableGesture()</code> 来启动所有手势操作的事件监听。</p> 
<p>要使用这个函数，我们首先需要引入我们的 gesture 库：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> enableGesture <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./gesture.js'</span><span class="token punctuation">;</span>
</code></pre> 
<p>接着我们就可以在 <code>this.root</code> 上去 enableGesture，在 <code>let position = 0</code>，后面加入一下代码：</p> 
<pre><code class="prism language-javascript"><span class="token function">enableGesture</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* 我们加入这个监听来看看我们的手势事件是否启动了 */</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"pan"</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>clientX<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行起来之后，我们就发现在网页端和移动端的 <code>pan</code> 事件都是被正常监控了。</p> 
<p><img src="https://images2.imgbox.com/9c/e0/r9Jw2Hg7_o.png" alt=""></p> 
<p>上图中，整数的就是网页端的输出，而的有较多小数点的就是移动端的输出。</p> 
<p>虽然事件是正常监听了，但是我们拖拽的时候，图片并没有任何移动的。所以我们还重新加入图片移动的逻辑。这段逻辑就在我们之前 <code>mousemove</code> 的事件之中。</p> 
<h4><a id="_pan__92"></a>实现 pan 事件</h4> 
<p>那么我们就来重新实现一下这部分代码。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"pan"</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 之前的 startX 我们可以直接在 event 中取得</span>
    <span class="token comment">// 因为我们在实现 gesture 的时候就都挂载到 event 中了</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> event<span class="token punctuation">.</span>clientX <span class="token operator">-</span> event<span class="token punctuation">.</span>startX<span class="token punctuation">;</span>
    <span class="token keyword">let</span> current <span class="token operator">=</span> position <span class="token operator">-</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token punctuation">(</span>x <span class="token operator">%</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">500</span><span class="token punctuation">;</span>
    
    <span class="token comment">/* 剩余这些代码都可以直接拿过来用就好了 */</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> offset <span class="token keyword">of</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">let</span> pos <span class="token operator">=</span> current <span class="token operator">+</span> offset<span class="token punctuation">;</span>
      <span class="token comment">// 计算图片所在 index</span>
      pos <span class="token operator">=</span> <span class="token punctuation">(</span>pos <span class="token operator">+</span> children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">%</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

      children<span class="token punctuation">[</span>pos<span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
      children<span class="token punctuation">[</span>pos<span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateX(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token operator">-</span>pos <span class="token operator">*</span> <span class="token number">500</span> <span class="token operator">+</span> offset <span class="token operator">*</span> <span class="token number">500</span> <span class="token operator">+</span> <span class="token punctuation">(</span>x <span class="token operator">%</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>这样我们就实现了 move（拖拽鼠标移动）这部分的逻辑了。我们先来看看是不是已经可以拖动了。</p> 
<p><img src="https://images2.imgbox.com/9e/72/dZYbzsoC_o.gif" alt=""></p> 
<p>Wonderful，我们非常方便就实现了拖拽移动图片了。但是如果我们拖动到超出三张以上的图片的时候，console 中就会抛出一下错误：</p> 
<p><img src="https://images2.imgbox.com/38/6e/nEQGa6vB_o.png" alt=""></p> 
<p>这又是为什么呢？我们先来看看报错的位置。</p> 
<p><img src="https://images2.imgbox.com/41/30/PngqRgPY_o.png" alt=""></p> 
<p>首先是 “超出 3 张图片时”，第二是 children 中没有当前 <code>pos</code> 的元素。根据这两个线索，我们就知道是计算出来的 pos 是有问题的。噢噢！我们的 <code>pos</code> + <code>children.length</code> 其实是有可能会出现负数的，所以这里才会有问题。</p> 
<p>所以我们要做的就是确保这个 pos 不会变成负数值，这里我们就可以运用数论里面的一个方法：</p> 
<pre><code class="prism language-javascript">pos <span class="token operator">=</span> <span class="token punctuation">(</span>pos <span class="token operator">%</span> children<span class="token punctuation">.</span>length <span class="token operator">+</span> children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">%</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
</code></pre> 
<p>让我们的 <code>pos</code> 先用 <code>children.length</code> 取余数，这样不管 <code>pos</code> 这个负数有多大，都会是一个小于 <code>children.length</code> 的一个值。</p> 
<h4><a id="_panend__137"></a>实现 panend 事件</h4> 
<p>这样我们就不会再报错了，接下来我们就可以继续取追加 “鼠标停下” 时的逻辑。鼠标停顿之前我们是用 “mouseup” 这个事件的。其实就是对应我们的 gesture 库中的 “panned” 事件。</p> 
<p>除了这个事件名不同之外，其实其中的处理逻辑是一样的。只不过我们的 <code>startX</code> 就可以直接在我们的 event 中取就可以了。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"panned"</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 之前的 startX 我们可以直接在 event 中取得</span>
    <span class="token comment">// 因为我们在实现 gesture 的时候就都挂载到 event 中了</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> event<span class="token punctuation">.</span>clientX <span class="token operator">-</span> event<span class="token punctuation">.</span>startX<span class="token punctuation">;</span>
    position <span class="token operator">=</span> position <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>x <span class="token operator">/</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> offset <span class="token keyword">of</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>x <span class="token operator">/</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token operator">-</span> x <span class="token operator">+</span> <span class="token number">250</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">let</span> pos <span class="token operator">=</span> position <span class="token operator">+</span> offset<span class="token punctuation">;</span>
      <span class="token comment">// 计算图片所在 index</span>
      pos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pos <span class="token operator">%</span> children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">+</span> children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">%</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

      children<span class="token punctuation">[</span>pos<span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
      children<span class="token punctuation">[</span>pos<span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateX(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token operator">-</span>pos <span class="token operator">*</span> <span class="token number">500</span> <span class="token operator">+</span> offset <span class="token operator">*</span> <span class="token number">500</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/51/f2/MpebvfMv_o.gif" alt=""></p> 
<p>到这里我们完全使用 Gesture 库来替代了我们原来的手势事件逻辑了。显然我们这里的代码相比之前是要清晰的多。更加遵循架构设计中的 “单一应用” 原则。我们 Carousel 中只有关于轮播图相关的逻辑，而所有手势事件的逻辑都是内聚到单独的 Gesture 库中。</p> 
<hr> 
<h3><a id="Timeline__167"></a>Timeline 库应用</h3> 
<p>接下来我们来把 Timeline 的时间线也应用到我们的 Carousel 组件当中，并且使用我们的 Animation 来替换原来的 CSS 动画。</p> 
<p>在这之前，我们先要在 carousel.js 中先引入我们的 Timeline, Animation 库和 Ease 动画。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Timeline<span class="token punctuation">,</span> Animation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./animation.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Ease <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./ease.js'</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_178"></a>重构自动轮播动画</h4> 
<p>首先我们来看看怎么用 Timeline 和 Animation 来重构我们的自动轮播代码。</p> 
<p>这里我们需要注意的是，在 main.html 中的 CSS 部分，我们之前给 <code>.carousel &gt; div</code> 这写元素赋予了 <code>transition</code> 属性。这个属性会与我们 Animation 的动画产生冲突，所以我们要先把这个属性给注释掉。</p> 
<pre><code class="prism language-css"><span class="token selector">.carousel &gt; div</span> <span class="token punctuation">{<!-- --></span>
  <span class="token property">width</span><span class="token punctuation">:</span> 500px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 281px<span class="token punctuation">;</span>
  <span class="token property">background-size</span><span class="token punctuation">:</span> contain<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>
  <span class="token comment">/* transition: ease 0.5s; */</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>接下来我们看看原来的自动轮播代码，之前是用 <code>currentIndex</code>（当前图片的 index）来寻找目标图片的。其实可以用我们手势事件部分用到的 position 替代这个值的。所以我们可以把这部分替换过来。</p> 
<p>setInterval 前面计算图片节点部分的代码是没有任何问题的，所以我们可以保留，不需要做任何修改：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
<span class="token comment">// 下一张图片的 index</span>
<span class="token keyword">let</span> nextIndex <span class="token operator">=</span> <span class="token punctuation">(</span>position <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

<span class="token comment">// 当前图片的节点</span>
<span class="token keyword">let</span> current <span class="token operator">=</span> children<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 下一张图片的节点</span>
<span class="token keyword">let</span> next <span class="token operator">=</span> children<span class="token punctuation">[</span>nextIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre> 
<p>接下来的那一部分代码，我们之前是使用一个 16 毫秒的 <code>setTimeout</code> 来执行我们的动画逻辑的。这部分就可以使用我们的 Timeline 来代替。</p> 
<p>首先我们在 <code>enableGesture</code> 之前实例化，并且启动一个 Timeline。</p> 
<pre><code class="prism language-javascript"><span class="token comment">/* ...代码 */</span>

<span class="token keyword">let</span> timeline <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Timeline</span><span class="token punctuation">;</span>
timeline<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">enableGesture</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/* ...代码 */</span>
</code></pre> 
<blockquote> 
 <p>我们注意到之前在移动图片的时候都是用百分比作为单位的。但是为了更加精确的操纵我们的动画，我们需要把单位都换成像素（px）。</p> 
</blockquote> 
<p>在 <code>let next</code> 之后，加入我们的轮播动画。首先是移动当前窗口内的图片：</p> 
<ul><li><strong>元素：</strong> current.style</li><li><strong>动画属性：</strong> ‘transform’</li><li><strong>开始属性值：</strong> <code>-position * 500</code></li><li><strong>结束属性值：</strong> <code>-500 * (position + 1)</code></li><li><strong>动画时长：</strong> 500</li><li><strong>延迟值：</strong> 0</li><li><strong>动画函数：</strong> <code>ease</code></li><li><strong>动画模版：</strong> v =&gt; `translate(${v}px)`</li></ul> 
<pre><code class="prism language-javascript"><span class="token comment">// 先移动当前图片离开当前位置</span>
timeline<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Animation</span><span class="token punctuation">(</span>
    current<span class="token punctuation">.</span>style<span class="token punctuation">,</span>
    <span class="token string">'transform'</span><span class="token punctuation">,</span>
    <span class="token operator">-</span>position <span class="token operator">*</span> <span class="token number">500</span><span class="token punctuation">,</span> 
    <span class="token operator">-</span><span class="token number">500</span> <span class="token operator">*</span> <span class="token punctuation">(</span>position <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span>
    ease<span class="token punctuation">,</span>
    <span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateX(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>v<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>同时我们要移动下一张图的位置：</p> 
<ul><li><strong>元素：</strong> next.style</li><li><strong>动画属性：</strong> ‘transform’</li><li><strong>开始属性值：</strong> <code>500 - nextIndex * 500</code></li><li><strong>结束属性值：</strong> <code>-500 * nextIndex</code></li><li><strong>动画时长：</strong> 500</li><li><strong>延迟值：</strong> 0</li><li><strong>动画函数：</strong> <code>ease</code></li><li><strong>动画模版：</strong> v =&gt; `translate(${v}px)`</li></ul> 
<pre><code class="prism language-javascript"><span class="token comment">// 移动下一张图片到当前显示的位置</span>
timeline<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Animation</span><span class="token punctuation">(</span>
    next<span class="token punctuation">.</span>style<span class="token punctuation">,</span>
    <span class="token string">'transform'</span><span class="token punctuation">,</span>
    <span class="token number">500</span> <span class="token operator">-</span> nextIndex <span class="token operator">*</span> <span class="token number">500</span><span class="token punctuation">,</span> 
    <span class="token operator">-</span><span class="token number">500</span> <span class="token operator">*</span> nextIndex<span class="token punctuation">,</span>
    <span class="token number">0</span><span class="token punctuation">,</span>
    ease<span class="token punctuation">,</span>
    <span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateX(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>v<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span>
<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>最后，我们更新当前位置的 index：</p> 
<pre><code class="prism language-javascript"><span class="token comment">// 最后更新当前位置的 index</span>
position <span class="token operator">=</span> nextIndex<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/7a/76/Q65zghdE_o.gif" alt=""></p> 
<p>就这样，我们的自动轮播这部分重构完成了。</p> 
<p>自动轮播和拖拽我们都重构完毕了，但是我们发现当我们在拖拽的时候，自动轮播会影响我们的拖拽。所以接下来我们就在解决轮播组件里最复杂的部分。</p> 
<hr> 
<h3><a id="___288"></a>实现手势 + 轮播</h3> 
<p>首先，一旦我们鼠标或者手指点击我们轮播图的图片，我们就需要把图片自动轮播给停下。</p> 
<p>这个就需要在我们 <code>start</code> 事件触发的时候去处理。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  timeline<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这里我们直接调用 <code>timeline.pause()</code> 来停止我们的时间线。</p> 
<p>等一下，好像不对呀，我们的手势库里面并没有 dispatch 一个 start 事件哦。是的，所以这里我们就回去 <code>gesture.js</code> 中添加这个 start 事件的触发。</p> 
<p>在 gesture 库的 Recognizer（识别器）中找到 start 方法。在这个方法的靠前的位置添加我们的 start 事件触发。</p> 
<pre><code class="prism language-javascript"><span class="token function">start</span><span class="token punctuation">(</span><span class="token parameter">point<span class="token punctuation">,</span> context</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">(</span>context<span class="token punctuation">.</span>startX <span class="token operator">=</span> point<span class="token punctuation">.</span>clientX<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>startY <span class="token operator">=</span> point<span class="token punctuation">.</span>clientY<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>dispatcher<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">/* 其余的代码... */</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>但是停止之后，我们再去拖拽的时候，就会发现我们图片位置就开始发生异常。</p> 
<p><img src="https://images2.imgbox.com/2a/74/IXwc6lPi_o.gif" alt=""></p> 
<p>这个问题的是因为，我们的动画造成的图片位移的距离，并没有同步给我们手势计算。所以手势在计算位移的时候，认为当前图片还是第一张图片。</p> 
<h4><a id="_322"></a>动画偏移距离</h4> 
<p>那么接下来我们要去算动画产生的位移距离，并且包含在我们手势计算中。</p> 
<p>首先我们需要用一个变量，记录动画开始的时间：</p> 
<pre><code class="prism language-javascript"><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 在 render 函数的这个位置</span>
    <span class="token comment">// 加入一个 t 变量的声明</span>

    <span class="token comment">/* ... 省略了上面的代码 ... */</span> 
    <span class="token function">enableGesture</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
    <span class="token keyword">let</span> position <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">/* ... 省略了下面的代码 ... */</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>然后在 setInterval 执行动画的地方记录动画开始时间：</p> 
<pre><code class="prism language-javascript"><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/* ... 省略了上面的代码 ... */</span> 
    
    <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
        <span class="token comment">// 下一张图片的 index</span>
        <span class="token keyword">let</span> nextIndex <span class="token operator">=</span> <span class="token punctuation">(</span>position <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

        <span class="token comment">// 当前图片的节点</span>
        <span class="token keyword">let</span> current <span class="token operator">=</span> children<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 下一张图片的节点</span>
        <span class="token keyword">let</span> next <span class="token operator">=</span> children<span class="token punctuation">[</span>nextIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 记录动画开始时间</span>
        <span class="token keyword">let</span> t <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">/* ... */</span> 
    <span class="token punctuation">}</span>
    
    <span class="token comment">/* ... 省略了下面的代码 ... */</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在 start 时间触发的时候，也就是我们鼠标或者手指点击轮播图的时候，我们就计算当前动画播放的时间进度。这个进度我们可以根据当前动画已经播放了的时长来计算。</p> 
<p>使用我们获得的时间进度，我们就可以通过 <code>ease(progress) * 500 - 500</code> 方法来获得当前动画进度所在的偏移距离。</p> 
<p>这里的 <code>ease(progress)</code> 会返回一个 0 到 1 的值，根据二次贝塞尔曲线的概念，ease 会返回一个动画的进度（也就是动画执行了百分之多少）。使用这个进度乘于每个图片的 500 宽度。我们就可以得到一个当前图片的偏移距离。</p> 
<p>这里因为我们已经播放到下一帧了，所以我们还需要再减到 500（一个图片的位置）。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">let</span> ax <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 动画产生的 x 偏移距离</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  timeline<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 当前时间 - 动画开始时间 = 动画已经播放的时长</span>
  <span class="token comment">// 播放时长 / 1500 = 时间进度</span>
  <span class="token keyword">let</span> progress <span class="token operator">=</span> <span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> t<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1500</span><span class="token punctuation">;</span>
  ax <span class="token operator">=</span> <span class="token function">ease</span><span class="token punctuation">(</span>progress<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">500</span> <span class="token operator">-</span> <span class="token number">500</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p><strong>注意：</strong> 我们这里为什么用 1500？因为我们要调试，所以我们把所有动画的时间都改为 1500 毫秒，这样更加缓慢的动画会更利于我们调试。所以所有的图片轮播的效果也一样，改为使用 1500 毫秒。最后，等我们所有的功能都完善之后，都改回 500 毫秒即可。</p> 
</blockquote> 
<p>最后在计算图片所在的 x 位置的时候，减掉自动轮播动画产生的 x 偏移距离 <code>ax</code>，我们需要在 pan 和 panend 两个事件监听中修改这个逻辑：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">let</span> x <span class="token operator">=</span> event<span class="token punctuation">.</span>clientX <span class="token operator">-</span> event<span class="token punctuation">.</span>startX <span class="token operator">-</span> ax<span class="token punctuation">;</span>
</code></pre> 
<p>这样我们在拖拽在时候，就不会再出现图片错位的现象的。但是如果我们拖拽的时候如果停下来不动的话，我们会发现图片还是在轮播。</p> 
<p>这个问题是因为我们的自动播放动画的 setInterval 并没有停止，所以自动播放还是在跑的。所以我们还需要把这个 setInterval 给管理起来。</p> 
<h4><a id="_Interval_402"></a>独立管理动画 Interval</h4> 
<p>要管理这个 setInterval 也很简单，只要把它赋予给一个变量，然后在 start 实现触发的时候 clear 掉这个 interval 即可。</p> 
<p>首先我们把 setInterval 中的处理逻辑抽取出来单独储存：</p> 
<pre><code class="prism language-javascript"><span class="token comment">// 动画处理逻辑</span>
<span class="token keyword">let</span> <span class="token function-variable function">nextAnimation</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
  <span class="token comment">// 下一张图片的 index</span>
  <span class="token keyword">let</span> nextIndex <span class="token operator">=</span> <span class="token punctuation">(</span>position <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

  <span class="token comment">// 当前图片的节点</span>
  <span class="token keyword">let</span> current <span class="token operator">=</span> children<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// 下一张图片的节点</span>
  <span class="token keyword">let</span> next <span class="token operator">=</span> children<span class="token punctuation">[</span>nextIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>

  t <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 先移动当前图片离开当前位置</span>
  timeline<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">Animation</span><span class="token punctuation">(</span>
      current<span class="token punctuation">.</span>style<span class="token punctuation">,</span>
      <span class="token string">'transform'</span><span class="token punctuation">,</span>
      <span class="token operator">-</span>position <span class="token operator">*</span> <span class="token number">500</span><span class="token punctuation">,</span>
      <span class="token operator">-</span><span class="token number">500</span> <span class="token operator">*</span> <span class="token punctuation">(</span>position <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token number">1500</span><span class="token punctuation">,</span> <span class="token comment">// 动画改用了 1500 毫秒</span>
      <span class="token number">0</span><span class="token punctuation">,</span>
      ease<span class="token punctuation">,</span>
      <span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateX(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>v<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 移动下一张图片到当前显示的位置</span>
  timeline<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
    <span class="token keyword">new</span> <span class="token class-name">Animation</span><span class="token punctuation">(</span>
      next<span class="token punctuation">.</span>style<span class="token punctuation">,</span>
      <span class="token string">'transform'</span><span class="token punctuation">,</span>
      <span class="token number">500</span> <span class="token operator">-</span> nextIndex <span class="token operator">*</span> <span class="token number">500</span><span class="token punctuation">,</span>
      <span class="token operator">-</span><span class="token number">500</span> <span class="token operator">*</span> nextIndex<span class="token punctuation">,</span>
      <span class="token number">1500</span><span class="token punctuation">,</span> <span class="token comment">// 动画改用了 1500 毫秒</span>
      <span class="token number">0</span><span class="token punctuation">,</span>
      ease<span class="token punctuation">,</span>
      <span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateX(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>v<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 最后更新当前位置的 index</span>
  position <span class="token operator">=</span> nextIndex<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>在 <code>let ax</code> 的声明下方加入 <code>handler</code> 变量声明，这个是用来储存我们的动画 interval 的：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">let</span> handler <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 动画 interval</span>
</code></pre> 
<p>把之前的 setInterval 赋予给 handler：</p> 
<pre><code class="prism language-javascript"><span class="token comment">// 当前图片的 index</span>
handler <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span>nextAnimation<span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>最后我们就可以在 start 触发时间里面 clear 掉这个 interval 了：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  timeline<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">clearInterval</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 获取动画的进度</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> t <span class="token operator">&lt;</span> <span class="token number">1500</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> progress <span class="token operator">=</span> <span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> t<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1500</span><span class="token punctuation">;</span>
    ax <span class="token operator">=</span> <span class="token function">ease</span><span class="token punctuation">(</span>progress<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">500</span> <span class="token operator">-</span> <span class="token number">500</span><span class="token punctuation">;</span> <span class="token comment">// 获取图片偏移的距离</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 如果没有完成一个 1500 毫秒的动画</span>
    <span class="token comment">// x 的偏移就可以忽略了</span>
    ax <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这样，我们把图片捡起来之后就不会再出现任何问题了。但是，对 “但是”，还有问题。当我们放开之后，图片又错位了。</p> 
<p>这个是因为我们还没有处理鼠标松开事件的逻辑。接下来我们一起补充这一块逻辑漏洞。</p> 
<p>这一块逻辑我们需要在 panend 中去实现，其实之前 panend 中的逻辑是不健全的（如果还记得的同学，我们之前是偷懒了的。我们直接把自动播放动画注释掉，然后分开来实现我们的手势拖拽轮播逻辑的。）</p> 
<p>所以这里我们需要基于 pan 事件中的逻辑，重新来编写我们 panend 的逻辑。</p> 
<h4><a id="_panend__494"></a>重写 panend 事件</h4> 
<p>因为我们在鼠标或者手指点击图片的时候，就停止的 timeline 时间线。自然在我们鼠标或者手指松开的时候就要重启 timeline，这样才能让动画继续播放。</p> 
<p>所以第一个逻辑就是重启 Timeline：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'panend'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  timeline<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  timeline<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>第二步，就是要处理 panend 触发时，图片的动画。其实 panend 的动画的起点时和 pan 的动画是一致的，但是动画结束的点就不一致了。</p> 
<p>Panend 结束的时候我们是需要获得一个 500 的倍数的。因为最终我们必须是看到一张完整的图片，而不能有其他的图片在两边的边缘。</p> 
<p>所以，我们需要根据当前 x 的偏移值，计算我们当前的图片应该是往左边，还是往右边移动，从而完成这个图片的轮播效果。如果这个图片没有往左或者右边移动超过 50% 自身的长度，那么我们就应该让这个图片回到中间的位置。</p> 
<p>而这个移动方向我们就叫它作 <code>direction</code>，它的值只会是 <code>-1</code>（左移）、<code>0</code>（回中）、 <code>1</code>（右移） 这三个值。</p> 
<p>首先我们复用 pan 中的 x 和 current 值的计算：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">let</span> x <span class="token operator">=</span> event<span class="token punctuation">.</span>clientX <span class="token operator">-</span> event<span class="token punctuation">.</span>startX <span class="token operator">-</span> ax<span class="token punctuation">;</span>
<span class="token keyword">let</span> current <span class="token operator">=</span> position <span class="token operator">-</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token punctuation">(</span>x <span class="token operator">%</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">500</span><span class="token punctuation">;</span>
</code></pre> 
<p>然后我们加入 <code>direction</code> 的计算：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">let</span> direction <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">%</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>这个 direction 的计算，无非就是把 x 除以 500 的余数，这个数值必然是小于 500 的。然后再除以 500 获得这个数值占比 500 的百分之多少。这个数字必然是 -1 到 1 之间。最后我们再用四舍五入获得一个 -1、0、1 三种结果。</p> 
</blockquote> 
<p>有了 direction 值，我们就可以给当前这个图片加上一个动画了。</p> 
<ul><li><strong>元素：</strong> children[pos].style</li><li><strong>动画属性：</strong> ‘transform’</li><li><strong>开始属性值：</strong> <code>-pos * 500 + offset * 500 + (x % 500)</code></li><li><strong>结束属性值：</strong> <code>-pos * 500 + offset * 500 + direction * 500</code></li><li><strong>动画时长：</strong> 1500</li><li><strong>延迟值：</strong> 0</li><li><strong>动画函数：</strong> <code>ease</code></li><li><strong>动画模版：</strong> v =&gt; `translate(${v}px)`</li></ul> 
<p>加上了这个 Animation 之后，其实我们之前的问题是已经解决了。但是我们最后没有更新 <code>position</code> 的值。这样拖拽的时候回出现有图片跳动的现象。</p> 
<p>最后我们来一起看一下怎么去更新 <code>position</code> 的值。</p> 
<p>我们上面动画中，无非就是三种情况：</p> 
<ul><li>当前 position（位置）往左移动了一个图片的位置（direction = -1）</li><li>当前 position 往有移动了一个图片的位置（direction = 1）</li><li>当前 position 没有移动（direction = 0）</li></ul> 
<p>那么如果要计算下一个 position，无非就是 current 的位置 - direction 即可。</p> 
<blockquote> 
 <p>这里还有注意的一个点，如果我们拖动超过 3 个图片的位置时，position 就有可能会变成负数，所以我们在此使用之前用我们之前用过的手法，把 position 强制转为正数。</p> 
</blockquote> 
<p>最后我们再补充一个逻辑，在 timeline start 的时候，我们再次启动一次我们动画的 setInterval，这样当我们停止拖拽的时候，自动轮播就会再次启动。</p> 
<p>最后我们的 panend 的代码如下：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'panend'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  timeline<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  timeline<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  handler <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span>nextAnimation<span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> x <span class="token operator">=</span> event<span class="token punctuation">.</span>clientX <span class="token operator">-</span> event<span class="token punctuation">.</span>startX <span class="token operator">-</span> ax<span class="token punctuation">;</span>
  <span class="token keyword">let</span> current <span class="token operator">=</span> position <span class="token operator">-</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token punctuation">(</span>x <span class="token operator">%</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">500</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> direction <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">%</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> offset <span class="token keyword">of</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> pos <span class="token operator">=</span> current <span class="token operator">+</span> offset<span class="token punctuation">;</span>
    <span class="token comment">// 计算图片所在 index</span>
    pos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pos <span class="token operator">%</span> children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">+</span> children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">%</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

    children<span class="token punctuation">[</span>pos<span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
    timeline<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
      <span class="token keyword">new</span> <span class="token class-name">Animation</span><span class="token punctuation">(</span>
        children<span class="token punctuation">[</span>pos<span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">,</span>
        <span class="token string">'transform'</span><span class="token punctuation">,</span>
        <span class="token operator">-</span>pos <span class="token operator">*</span> <span class="token number">500</span> <span class="token operator">+</span> offset <span class="token operator">*</span> <span class="token number">500</span> <span class="token operator">+</span> <span class="token punctuation">(</span>x <span class="token operator">%</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token operator">-</span>pos <span class="token operator">*</span> <span class="token number">500</span> <span class="token operator">+</span> offset <span class="token operator">*</span> <span class="token number">500</span> <span class="token operator">+</span> direction <span class="token operator">*</span> <span class="token number">500</span><span class="token punctuation">,</span>
        <span class="token number">1500</span><span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">,</span>
        ease<span class="token punctuation">,</span>
        <span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateX(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>v<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span>
      <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  position <span class="token operator">=</span> current <span class="token operator">-</span> direction<span class="token punctuation">;</span>
  position <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>position <span class="token operator">%</span> children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">+</span> children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">%</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<hr> 
<h3><a id="_Flick__595"></a>实现 Flick 手势轮播</h3> 
<p>到此为止，我们的轮播组件算是比较完善的了。基本所有功能都是可以使用了。接下来我们给这个轮播组件加上最后一个功能，也就是我们之前手势库中单独实现的 Flick 事件。</p> 
<p>如果在我们拖拽的时候快速往左或者右滑动的时候，就会触发 Flick 事件，同时也可以让我们图片往对应的方向换图片。所以如果 Flick 的事情触发了之后，我们是需要去改变我们图片移动的方向，也就是覆盖我们之前定义的 <code>direction</code> 的值。</p> 
<p>根据我们之前设计的手势库，flick 事件是会在 panend 的事件中触发的。</p> 
<p>在 panend 事件监听中的 direction 计算之后，我们加入 flick 事件触发的判断：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>isFlick<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>velocity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>我们来打印一下触发到一个 flick 时候的 velocity（滑动速度）。</p> 
<p><img src="https://images2.imgbox.com/73/0e/9JzNL6Yn_o.png" alt=""></p> 
<p>我们发现 velocity 既然是 undefined。这是怎么回事呢？</p> 
<p><img src="https://images2.imgbox.com/0a/fc/RktscbjT_o.gif" alt=""></p> 
<p>大家不用怕，这个完全是可控的翻车，全是演技。如果我们回去 <code>gesture.js</code> 中查看 panend 的 dispatch，我们就会发现在 panend 被分发出来的时候，我们根本没有把 velocity 给传出来。</p> 
<p>所以我们需要在这里把 velocity 给加上。</p> 
<blockquote> 
 <p>其实我们这里还需要分发一个 end 事件，这个在本文章后面会使用到。这里就先补充上了。在 panend 的事件之后，我们加上 end 事件的分发：</p> 
</blockquote> 
<pre><code class="prism language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>dispatcher<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'panend'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
  startX<span class="token operator">:</span> context<span class="token punctuation">.</span>startX<span class="token punctuation">,</span>
  startY<span class="token operator">:</span> context<span class="token punctuation">.</span>startY<span class="token punctuation">,</span>
  clientX<span class="token operator">:</span> point<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span>
  clientY<span class="token operator">:</span> point<span class="token punctuation">.</span>clientY<span class="token punctuation">,</span>
  isVertical<span class="token operator">:</span> context<span class="token punctuation">.</span>isVertical<span class="token punctuation">,</span>
  isFlick<span class="token operator">:</span> context<span class="token punctuation">.</span>isFlick<span class="token punctuation">,</span>
  velocity<span class="token operator">:</span> v<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>dispatcher<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
  startX<span class="token operator">:</span> context<span class="token punctuation">.</span>startX<span class="token punctuation">,</span>
  startY<span class="token operator">:</span> context<span class="token punctuation">.</span>startY<span class="token punctuation">,</span>
  clientX<span class="token operator">:</span> point<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span>
  clientY<span class="token operator">:</span> point<span class="token punctuation">.</span>clientY<span class="token punctuation">,</span>
  isVertical<span class="token operator">:</span> context<span class="token punctuation">.</span>isVertical<span class="token punctuation">,</span>
  isFlick<span class="token operator">:</span> context<span class="token punctuation">.</span>isFlick<span class="token punctuation">,</span>
  velocity<span class="token operator">:</span> v<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这里修改好，我们就可以正常获得我们的 velocity（滑动速度）值了。</p> 
<p><img src="https://images2.imgbox.com/a5/d8/Xwmtkpuh_o.png" alt=""></p> 
<p>那么我们就来把 flick 事件的逻辑给添加进去。</p> 
<ul><li>这里我们判断如果 velocity 是小于 0 的话，证明我们是一个负数的速度，也就是说图片应该是往左边移动。这里我们就往上取整即可。（最后获得 direction = -1）</li><li>如果 velocity 是大于 0 的话，证明是一个正数的速度，也就是图片需要往右移动，这种情况我们就往下取整即可。（最后获得 direction = 1）</li></ul> 
<pre><code class="prism language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>isFlick<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>velocity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    direction <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">%</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    direction <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">%</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这样我们就完成了 flick 手势的实现了。</p> 
<h3><a id="_668"></a>调整动画时间</h3> 
<p>之前为了实现功能的时候利于调试，我们把所有动画的时间都改为了 1500 毫秒。现在我们的功能都实现完毕了。这里我们就可以把所有的动画时间都从 1500 毫秒改回 500 毫秒，让所有的动画更加自然一点。</p> 
<p>最后给大家看看完整的 <code>carousel.js</code> 的代码：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Component <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./framework.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> enableGesture <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./gesture.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> Timeline<span class="token punctuation">,</span> Animation <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./animation.js'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ease <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./ease.js'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Carousel</span> <span class="token keyword">extends</span> <span class="token class-name">Component</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 构造函数</span>
  <span class="token comment">// 创建 DOM 节点</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>attributes <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>attributes<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>root <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">'carousel'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> picture <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>src<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">let</span> child <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      child<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundImage <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">url('</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>picture<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">')</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> timeline <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Timeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    timeline<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">enableGesture</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
    <span class="token keyword">let</span> position <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 动画开始时间</span>
    <span class="token keyword">let</span> ax <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 动画产生的 x 偏移距离</span>
    <span class="token keyword">let</span> handler <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// 动画 interval</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'start'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      timeline<span class="token punctuation">.</span><span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 获取动画的进度</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> t <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> progress <span class="token operator">=</span> <span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> t<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">500</span><span class="token punctuation">;</span>
        ax <span class="token operator">=</span> <span class="token function">ease</span><span class="token punctuation">(</span>progress<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">500</span> <span class="token operator">-</span> <span class="token number">500</span><span class="token punctuation">;</span> <span class="token comment">// 获取图片偏移的距离</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        ax <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'pan'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 之前的 startX 我们可以直接在 event 中取得</span>
      <span class="token comment">// 因为我们在实现 gesture 的时候就都挂载到 event 中了</span>
      <span class="token keyword">let</span> x <span class="token operator">=</span> event<span class="token punctuation">.</span>clientX <span class="token operator">-</span> event<span class="token punctuation">.</span>startX <span class="token operator">-</span> ax<span class="token punctuation">;</span>
      <span class="token keyword">let</span> current <span class="token operator">=</span> position <span class="token operator">-</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token punctuation">(</span>x <span class="token operator">%</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">500</span><span class="token punctuation">;</span>

      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> offset <span class="token keyword">of</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> pos <span class="token operator">=</span> current <span class="token operator">+</span> offset<span class="token punctuation">;</span>
        <span class="token comment">// 计算图片所在 index</span>
        pos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pos <span class="token operator">%</span> children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">+</span> children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">%</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

        children<span class="token punctuation">[</span>pos<span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
        children<span class="token punctuation">[</span>pos<span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateX(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token operator">-</span>pos <span class="token operator">*</span> <span class="token number">500</span> <span class="token operator">+</span> offset <span class="token operator">*</span> <span class="token number">500</span> <span class="token operator">+</span> <span class="token punctuation">(</span>x <span class="token operator">%</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'panend'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      timeline<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      timeline<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      handler <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span>nextAnimation<span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">let</span> x <span class="token operator">=</span> event<span class="token punctuation">.</span>clientX <span class="token operator">-</span> event<span class="token punctuation">.</span>startX <span class="token operator">-</span> ax<span class="token punctuation">;</span>
      <span class="token keyword">let</span> current <span class="token operator">=</span> position <span class="token operator">-</span> <span class="token punctuation">(</span>x <span class="token operator">-</span> <span class="token punctuation">(</span>x <span class="token operator">%</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">500</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> direction <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">%</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>isFlick<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>velocity <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          direction <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">%</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
          direction <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">%</span> <span class="token number">500</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> offset <span class="token keyword">of</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> pos <span class="token operator">=</span> current <span class="token operator">+</span> offset<span class="token punctuation">;</span>
        <span class="token comment">// 计算图片所在 index</span>
        pos <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pos <span class="token operator">%</span> children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">+</span> children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">%</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

        children<span class="token punctuation">[</span>pos<span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">.</span>transition <span class="token operator">=</span> <span class="token string">'none'</span><span class="token punctuation">;</span>
        timeline<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
          <span class="token keyword">new</span> <span class="token class-name">Animation</span><span class="token punctuation">(</span>
            children<span class="token punctuation">[</span>pos<span class="token punctuation">]</span><span class="token punctuation">.</span>style<span class="token punctuation">,</span>
            <span class="token string">'transform'</span><span class="token punctuation">,</span>
            <span class="token operator">-</span>pos <span class="token operator">*</span> <span class="token number">500</span> <span class="token operator">+</span> offset <span class="token operator">*</span> <span class="token number">500</span> <span class="token operator">+</span> <span class="token punctuation">(</span>x <span class="token operator">%</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token operator">-</span>pos <span class="token operator">*</span> <span class="token number">500</span> <span class="token operator">+</span> offset <span class="token operator">*</span> <span class="token number">500</span> <span class="token operator">+</span> direction <span class="token operator">*</span> <span class="token number">500</span><span class="token punctuation">,</span>
            <span class="token number">500</span><span class="token punctuation">,</span>
            <span class="token number">0</span><span class="token punctuation">,</span>
            ease<span class="token punctuation">,</span>
            <span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateX(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>v<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      position <span class="token operator">=</span> current <span class="token operator">-</span> direction<span class="token punctuation">;</span>
      position <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>position <span class="token operator">%</span> children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">+</span> children<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token operator">%</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> <span class="token function-variable function">nextAnimation</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">let</span> children <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">.</span>children<span class="token punctuation">;</span>
      <span class="token comment">// 下一张图片的 index</span>
      <span class="token keyword">let</span> nextIndex <span class="token operator">=</span> <span class="token punctuation">(</span>position <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> children<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

      <span class="token comment">// 当前图片的节点</span>
      <span class="token keyword">let</span> current <span class="token operator">=</span> children<span class="token punctuation">[</span>position<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token comment">// 下一张图片的节点</span>
      <span class="token keyword">let</span> next <span class="token operator">=</span> children<span class="token punctuation">[</span>nextIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>

      t <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 先移动当前图片离开当前位置</span>
      timeline<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">Animation</span><span class="token punctuation">(</span>
          current<span class="token punctuation">.</span>style<span class="token punctuation">,</span>
          <span class="token string">'transform'</span><span class="token punctuation">,</span>
          <span class="token operator">-</span>position <span class="token operator">*</span> <span class="token number">500</span><span class="token punctuation">,</span>
          <span class="token operator">-</span><span class="token number">500</span> <span class="token operator">*</span> <span class="token punctuation">(</span>position <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token number">500</span><span class="token punctuation">,</span>
          <span class="token number">0</span><span class="token punctuation">,</span>
          ease<span class="token punctuation">,</span>
          <span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateX(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>v<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 移动下一张图片到当前显示的位置</span>
      timeline<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">Animation</span><span class="token punctuation">(</span>
          next<span class="token punctuation">.</span>style<span class="token punctuation">,</span>
          <span class="token string">'transform'</span><span class="token punctuation">,</span>
          <span class="token number">500</span> <span class="token operator">-</span> nextIndex <span class="token operator">*</span> <span class="token number">500</span><span class="token punctuation">,</span>
          <span class="token operator">-</span><span class="token number">500</span> <span class="token operator">*</span> nextIndex<span class="token punctuation">,</span>
          <span class="token number">500</span><span class="token punctuation">,</span>
          <span class="token number">0</span><span class="token punctuation">,</span>
          ease<span class="token punctuation">,</span>
          <span class="token parameter">v</span> <span class="token operator">=&gt;</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">translateX(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>v<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">px)</span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// 最后更新当前位置的 index</span>
      position <span class="token operator">=</span> nextIndex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 当前图片的 index</span>
    handler <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span>nextAnimation<span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">mountTo</span><span class="token punctuation">(</span><span class="token parameter">parent</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    parent<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<blockquote> 
 <p>我是来自《<strong>技术银河</strong>》的<strong>三钻</strong>，一位正在重塑知识的技术人。下期再见。</p> 
</blockquote> 
<hr> 
<h3><a id="__840"></a>⭐️ 三哥推荐</h3> 
<h4><a id="_841"></a>开源项目推荐</h4> 
<h5><a id="Hexo_Theme_Aurora_842"></a>Hexo Theme Aurora</h5> 
<p><img src="https://images2.imgbox.com/6b/bc/rtJazUt5_o.png" alt=""><br> <img src="https://images2.imgbox.com/49/25/5wKhnt9n_o.png" alt=""></p> 
<blockquote> 
 <p>在最近在版本 1.5.0 更新了以下功能：</p> 
 <p>》<a href="https://tridiamond.tech" rel="nofollow">预览</a>《</p> 
</blockquote> 
<p>✨ 新增</p> 
<ul><li>自适应 “推荐文章” 布局 (增加了一个新的 “<code>置顶文章布局</code>” !!) 
  <ul><li>能够在“推荐文章”和“置顶文章”模式之间自由切换</li><li>如果总文章少于 3 篇，将自动切换到“置顶文章”模式</li><li>在文章卡上添加了“置顶”和“推荐”标签</li><li><a href="https://aurora.tridiamond.tech/zh/guide/theme.html#%E6%8E%A8%E8%8D%90%E5%B8%83%E5%B1%80%E6%A8%A1%E5%BC%8F" rel="nofollow">📖 文档</a></li></ul> </li><li>增加了与 VuePress 一样的自定义容器 <a href="https://github.com/auroral-ui/hexo-theme-aurora/issues/77">#77</a> 
  <ul><li><code>Info</code> 容器</li><li><code>Warning</code> 容器</li><li><code>Danger</code> 容器</li><li><code>Detail</code> 容器</li><li><a href="https://tridiamond.tech/post/aurora%2Fcustom-quotes" rel="nofollow">预览</a></li></ul> </li><li>支持了更多的 SEO meta 数据 <a href="https://github.com/auroral-ui/hexo-theme-aurora/issues/76">#76</a> 
  <ul><li>添加了 <code>description</code></li><li>添加了 <code>keywords</code></li><li>添加了 <code>author</code></li><li><a href="https://aurora.tridiamond.tech/zh/guide/site-meta.html#seo-meta" rel="nofollow">📖 文档</a></li></ul> </li></ul> 
<p><img src="https://images2.imgbox.com/f3/ca/NMpyi2xK_o.png" alt=""></p> 
<p>最近博主在全面投入开发一个可以 “<strong>迈向未来的</strong>” Hexo 主题，以极光为主题的博客主题。</p> 
<p>如果你是一个开发者，做一个个人博客也是你简历上的一个亮光点。而如果你有一个超级炫酷的博客，那就更加是亮上加亮了，简直就闪闪发光。</p> 
<p>如果喜欢这个主题，可以在 Github 上给我点个 🌟 让彼此都发光吧～</p> 
<blockquote> 
 <p>主题 Github 地址：<a href="https://github.com/auroral-ui/hexo-theme-aurora">https://github.com/auroral-ui/hexo-theme-aurora</a><br> 主题使用文档：<a href="https://aurora.tridiamond.tech/zh/" rel="nofollow">https://aurora.tridiamond.tech/zh/</a></p> 
</blockquote> 
<hr> 
<h5><a id="VSCode_Aurora_Future_882"></a>VSCode Aurora Future</h5> 
<p><img src="https://images2.imgbox.com/1d/b7/kIhnecPl_o.png" alt=""><br> 对，博主还做了一个 Aurora 的 VSCode 主题。用了Hexo Theme Aurora 相对应的颜色色系。这个主题的重点特性的就只用了 3 个颜色，减少在写代码的时候被多色多彩的颜色所转移了你的注意力，让你更集中在写代码之中。</p> 
<p>喜欢的大家可以支持一下哦！ <strong>直接在 VSCode 的插件搜索中输入 “Aurora Future” 即可找到这个主题哦！～</strong></p> 
<blockquote> 
 <p>主题 Github 地址：<a href="https://github.com/auroral-ui/aurora-future-vscode-theme">https://github.com/auroral-ui/aurora-future-vscode-theme</a><br> 主题插件地址：<a href="https://marketplace.visualstudio.com/items?itemName=auroral-ui.aurora-future" rel="nofollow">https://marketplace.visualstudio.com/items?itemName=auroral-ui.aurora-future</a></p> 
</blockquote> 
<hr> 
<h5><a id="Firefox_Aurora_Future_893"></a>Firefox Aurora Future</h5> 
<p><img src="https://images2.imgbox.com/3f/6b/ghAF9pds_o.png" alt="">我不知道大家，但是最近我在用火狐浏览器来做开发了。个人觉得火狐还真的是不错的。推荐大家尝试一下。</p> 
<p>当然我这里想给大家介绍的是我在火狐也做了一个 Aurora 主题。对的！用的是同一套的颜色体系。喜欢的小伙伴可以试一下哦！</p> 
<blockquote> 
 <p>主题地址：<a href="https://addons.mozilla.org/en-US/firefox/addon/aurora-future/" rel="nofollow">https://addons.mozilla.org/en-US/firefox/addon/aurora-future/</a></p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f97761d41c84eba71d3191e99c7425c8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">重磅！微软发布 vscode.dev，把 VSCode 带入浏览器！</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cceb465c221e2693fe2c3a21f5c9a4c1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java学习笔记（2）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>