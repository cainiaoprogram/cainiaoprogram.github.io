<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[免费专栏] Android安全之Android Xposed插件开发，小白都能看得懂的教程 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="[免费专栏] Android安全之Android Xposed插件开发，小白都能看得懂的教程" />
<meta property="og:description" content="也许每个人出生的时候都以为这世界都是为他一个人而存在的，当他发现自己错的时候，他便开始长大
少走了弯路，也就错过了风景，无论如何，感谢经历
转移发布平台通知：将不再在CSDN博客发布新文章，敬请移步知识星球
感谢大家一直以来对我CSDN博客的关注和支持，但是我决定不再在这里发布新文章了。为了给大家提供更好的服务和更深入的交流，我开设了一个知识星球，内部将会提供更深入、更实用的技术文章，这些文章将更有价值，并且能够帮助你更好地解决实际问题。期待你加入我的知识星球，让我们一起成长和进步
Android安全付费专栏长期更新，本篇最新内容请前往：
[车联网安全自学篇] Android安全之Android Xposed插件开发，小白都能看得懂的教程 0x01 前言 1.1 安卓操作系统架构 Android是一种基于Linux的自由及开放源代码的操作系统。而Android系统构架是安卓系统的体系结构，其系统架构和其操作系统一样，采用了分层的架构，共分为四层五部分，四层指的是从高到低分别是Android应用层，Android应用框架层，Android系统运行层和Linux内核层；五部分指的是Linux Kernel、Android Runtime、Libraries、Application Framework、Applications。
1.1.1 Linux Kernel 在所有层的最底下是 Linux，它提供了基本的系统功能，比如进程管理，内存管理，设备管理（如摄像头，键盘，显示器）。
1.1.2 Android Runtime Android 运行时同时提供一系列核心的库来为 Android 应用程序开发者使用标准的 Java 语言来编写 Android 应用程序。Dalvik 虚拟机使得每一个 Android 应用程序运行在自己独立的虚拟机进程。Dalvik虚拟机可执行文件格式是.dex，dex格式是专为Dalvik设计的一种压缩格式，适合内存和处理器速度有限的系统。
1.1.3 Libraries Android包含一个C/C&#43;&#43;库的集合，供Android系统的各个组件使用。这些功能通过Android的应用程序框架（application framework）暴露给开发者。
1.1.4 Application Framework 通过提供开放的开发平台，Android使开发者能够编制极其丰富和新颖的应用程序。
1.1.5 Applications 应用框架层以 Java 类的形式为应用程序提供许多高级的服务。
1.2 安卓应用程序组件 应用程序组件是一个Android应用程序的基本构建块。在AndroidManifest.xml中描述了应用程序的每个组件，以及他们如何交互。
1.2.1 Android应用程序中四个主要组件 组件名描述Activities描述UI，并且处理用户与机器屏幕的交互Services处理与应用程序关联的后台操作Broadcast Receivers处理Android操作系统和应用程序之间的通信Content Providers处理数据和数据库管理方面的问题 1.2.2 附加组件 组件名描述Fragments代表活动中的一个行为或者一部分用户界面Views绘制在屏幕上的UI元素，包括按钮，列表等Layouts控制屏幕格式，展示视图外观的View的继承Intents组件间的消息连线Resources外部元素，例如字符串资源、常量资源及图片资源等Manifest应用程序的配置文件 1.3 什么是 Hook？ Hook 又叫“钩子”，它可以在事件传送的过程中截获并监控事件的传输，将自身的代码与系统方法进行融入
这样当这些方法被调用时，也就可以执行我们自己的代码，这也是面向切面编程的思想（AOP）
1.4 Hook 分类 1）根据Android开发模式，Native模式（C/C&#43;&#43;）和Java模式（Java）区分，在Android平台上" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/67095e992cc19f66ddf9aa91e0bce644/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-31T10:41:19+08:00" />
<meta property="article:modified_time" content="2023-03-31T10:41:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[免费专栏] Android安全之Android Xposed插件开发，小白都能看得懂的教程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <hr> 
<p><strong>也许每个人出生的时候都以为这世界都是为他一个人而存在的，当他发现自己错的时候，他便开始长大</strong></p> 
<p><strong>少走了弯路，也就错过了风景，无论如何，感谢经历</strong></p> 
<hr> 
<p><font color="red"><strong>转移发布平台通知：将不再在CSDN博客发布新文章，敬请移步知识星球</strong></font></p> 
<blockquote> 
 <p>感谢大家一直以来对我CSDN博客的关注和支持，但是我决定不再在这里发布新文章了。为了给大家提供更好的服务和更深入的交流，我开设了一个知识星球，内部将会提供更深入、更实用的技术文章，这些文章将更有价值，并且能够帮助你更好地解决实际问题。期待你加入我的知识星球，让我们一起成长和进步</p> 
</blockquote> 
<hr> 
<p>Android安全付费专栏长期更新，本篇最新内容请前往：</p> 
<ul><li><a href="https://orangey.blog.csdn.net/article/details/122780508" rel="nofollow">[车联网安全自学篇] Android安全之Android Xposed插件开发，小白都能看得懂的教程</a></li></ul> 
<h2><a id="0x01___19"></a>0x01 前言</h2> 
<h3><a id="11__21"></a>1.1 安卓操作系统架构</h3> 
<p>Android是一种基于Linux的自由及开放源代码的操作系统。而Android系统构架是安卓系统的体系结构，其系统架构和其操作系统一样，采用了分层的架构，共分为四层五部分，四层指的是从高到低分别是Android应用层，Android应用框架层，Android系统运行层和Linux内核层；五部分指的是Linux Kernel、Android Runtime、Libraries、Application Framework、Applications。</p> 
<h4><a id="111_Linux_Kernel_25"></a>1.1.1 Linux Kernel</h4> 
<p>在所有层的最底下是 Linux，它提供了基本的系统功能，比如进程管理，内存管理，设备管理（如摄像头，键盘，显示器）。</p> 
<h4><a id="112_Android_Runtime_29"></a>1.1.2 Android Runtime</h4> 
<p>Android 运行时同时提供一系列核心的库来为 Android 应用程序开发者使用标准的 Java 语言来编写 Android 应用程序。Dalvik 虚拟机使得每一个 Android 应用程序运行在自己独立的虚拟机进程。Dalvik虚拟机可执行文件格式是.dex，dex格式是专为Dalvik设计的一种压缩格式，适合内存和处理器速度有限的系统。</p> 
<h4><a id="113_Libraries_33"></a>1.1.3 Libraries</h4> 
<p>Android包含一个C/C++库的集合，供Android系统的各个组件使用。这些功能通过Android的应用程序框架（application framework）暴露给开发者。</p> 
<h4><a id="114_Application_Framework_37"></a>1.1.4 Application Framework</h4> 
<p>通过提供开放的开发平台，Android使开发者能够编制极其丰富和新颖的应用程序。</p> 
<h4><a id="115_Applications_40"></a>1.1.5 Applications</h4> 
<p>应用框架层以 Java 类的形式为应用程序提供许多高级的服务。</p> 
<h3><a id="12__44"></a>1.2 安卓应用程序组件</h3> 
<p>应用程序组件是一个Android应用程序的基本构建块。在AndroidManifest.xml中描述了应用程序的每个组件，以及他们如何交互。</p> 
<h4><a id="121_Android_48"></a>1.2.1 Android应用程序中四个主要组件</h4> 
<table><thead><tr><th>组件名</th><th>描述</th></tr></thead><tbody><tr><td>Activities</td><td>描述UI，并且处理用户与机器屏幕的交互</td></tr><tr><td>Services</td><td>处理与应用程序关联的后台操作</td></tr><tr><td>Broadcast Receivers</td><td>处理Android操作系统和应用程序之间的通信</td></tr><tr><td>Content Providers</td><td>处理数据和数据库管理方面的问题</td></tr></tbody></table> 
<h4><a id="122__57"></a>1.2.2 附加组件</h4> 
<table><thead><tr><th>组件名</th><th>描述</th></tr></thead><tbody><tr><td>Fragments</td><td>代表活动中的一个行为或者一部分用户界面</td></tr><tr><td>Views</td><td>绘制在屏幕上的UI元素，包括按钮，列表等</td></tr><tr><td>Layouts</td><td>控制屏幕格式，展示视图外观的View的继承</td></tr><tr><td>Intents</td><td>组件间的消息连线</td></tr><tr><td>Resources</td><td>外部元素，例如字符串资源、常量资源及图片资源等</td></tr><tr><td>Manifest</td><td>应用程序的配置文件</td></tr></tbody></table> 
<h3><a id="13__Hook_69"></a>1.3 什么是 Hook？</h3> 
<p>Hook 又叫“钩子”，它可以在事件传送的过程中截获并监控事件的传输，将自身的代码与系统方法进行融入</p> 
<p>这样当这些方法被调用时，也就可以执行我们自己的代码，这也是面向切面编程的思想（AOP）</p> 
<h3><a id="14_Hook__75"></a>1.4 Hook 分类</h3> 
<p>1）根据Android开发模式，Native模式（C/C++）和Java模式（Java）区分，在Android平台上</p> 
<ul><li>Java层级的Hook</li><li>Native层级的Hook</li></ul> 
<p>2）根 Hook 对象与 Hook 后处理事件方式不同，Hook还分为：</p> 
<ul><li>消息Hook</li><li>API Hook</li></ul> 
<p>3）针对Hook的不同进程上来说，还可分为：</p> 
<ul><li>全局Hook</li><li>单个进程Hook</li></ul> 
<h3><a id="15_Hook_92"></a>1.5 Hook原理</h3> 
<p>Hook技术本质是函数调用，由于处于Linux用户状态，每个进程有自己独立的进程控件，所以必须先注入所要Hook的进程空间，修改其内存中进程代码，替换过程表的符号地址，通过ptrace函数附加进程，向远程进程注入so库，从而达到监控以及远程进程关键函数挂钩</p> 
<p>Hook工作流程：</p> 
<ul><li> <p>Android相关内核函数：</p> 
  <ul><li>ptrace函数：跟踪一个目标进程，结束跟踪一个目标进程，获取内存字节，像内存写入地址</li><li>dlopen函数：以指定模式打开指定的动态链接库文件</li><li>mmap函数：分配一段临时的内存来完成代码的存放</li></ul> </li><li> <p>向目标进程注入代码总结后的步骤分为以下几步：</p> 
  <ul><li>用ptrace函数attch上目标进程</li><li>发现装载共享库so函数</li><li>装载指定的.so</li><li>让目标进程的执行流程跳转到注入的代码执行</li><li>使用ptrace函数的detach释放目标集成</li></ul> </li></ul> 
<h3><a id="16__Hook__112"></a>1.6 常见 Hook 框架</h3> 
<p>在Android开发中，有以下常见的一些Hook框架：</p> 
<p>1）Xposed</p> 
<p>Xposed 是国外大牛开发的一个工具，Xposed通过拦截安卓程序运行过程来达到修改程序行为的目的。不需要修改安卓源文件，而是通过分析程序运行来拦截并影响运行情况。具体需要把安卓apk逆向后然后分析代码，定位到具体的类，方法等，然后通过xposed来拦截修改方法等。</p> 
<p>使用Xposed模块的两个条件：</p> 
<ul><li>手机必须root（Xposed需要往/system里写入东西）</li><li>安装Xposed Installer</li></ul> 
<p>通过替换 /system/bin/app_process 程序控制 Zygote 进程，使得 app_process 在启动过程中会加载 XposedBridge.jar 这个 Jar 包，从而完成对 Zygote 进程及其创建的 Dalvik 虚拟机的劫持。</p> 
<p>Xposed 在开机的时候完成对所有的 Hook Function 的劫持，在原 Function 执行的前后加上自定义代码。</p> 
<p>下载地址：</p> 
<p>下面这个仅适用于 Android 4.0.3 至 Android 4.4 上的 root 访问<br> https://repo.xposed.info/module/de.robv.android.xposed.installer</p> 
<p>对于 Android 5.0 或更高版本改用下面这个<br> https://forum.xda-developers.com/t/official-xposed-for-lollipop-marshmallow-nougat-oreo-v90-beta3-2018-01-29.3034811/</p> 
<p>2）Cydia Substrate</p> 
<p>Cydia Substrate是一个基于Hook的代码修改框架，其可以在Android、iOS平台使用，并实现修改系统默认代码</p> 
<p>Cydia Substrate 框架为苹果用户提供了越狱相关的服务框架，当然也推出了 Android 版 。Cydia Substrate 是一个代码修改平台，它可以修改任何进程的代码。</p> 
<p>不管是用 Java 还是 C/C++（native代码）编写的，而 Xposed 只支持 Hook app_process 中的 Java 函数。</p> 
<p>下载地址：</p> 
<p>http://www.cydiasubstrate.com</p> 
<p>3）Legend</p> 
<p>Legend 是 Android 免 Root 环境下的一个 Apk Hook 框架，该框架代码设计简洁，通用性高，适合逆向工程时一些 Hook 场景。大部分的功能都放到了 Java 层，这样的兼容性就非常好</p> 
<p>原理是这样的，直接构造出新旧方法对应的虚拟机数据结构，然后替换信息写到内存中即可</p> 
<p>下载地址：</p> 
<p>https://github.com/asLody/legend</p> 
<p>4）VirtualXposed</p> 
<p>VirtualXposed 是基于VirtualApp 和 epic 在非ROOT环境下运行Xposed模块的实现（支持5.0~10.0)。</p> 
<p>与 Xposed 相比，目前 VirtualXposed 有两个限制：</p> 
<blockquote>
  不支持修改系统（可以修改普通APP中对系统API的调用），因此重力工具箱，应用控制器等无法使用 
</blockquote> 
<p>暂不支持资源HOOK，因此资源钩子不会起任何作用；使用资源HOOK的模块，相应的功能不会生效</p> 
<p>下载地址：</p> 
<p>https://github.com/android-hacker/VirtualXposed</p> 
<h3><a id="17_Hook__177"></a>1.7 Hook 必须掌握的知识</h3> 
<ul><li> <p>反射</p> </li><li> <p>java 的动态代理</p> </li></ul> 
<p>动态代理是指在运行时动态生成代理类，不需要我们像静态代理那个去手动写一个个的代理类。在 java 中，可使用 InvocationHandler 实现动态代理</p> 
<h3><a id="18_Hook__187"></a>1.8 Hook 选择的关键点</h3> 
<p>Hook 的选择点：尽量静态变量和单例，因为一旦创建对象，它们不容易变化，非常容易定位</p> 
<p>Hook 过程：</p> 
<ul><li>寻找 Hook 点，原则是尽量静态变量或者单例对象，尽量 Hook public 的对象和方法</li><li>选择合适的代理方式，如果是接口可以用动态代理</li><li>偷梁换柱 —— 用代理对象替换原始对象</li></ul> 
<p>Android 的 API 版本比较多，方法和类可能不一样，所以要做好 API 的兼容工作</p> 
<h3><a id="19_Xposed_199"></a>1.9 Xposed的一些类的介绍</h3> 
<ul><li>IXposedHookLoadPackage.java</li></ul> 
<p>加载回调接口，在xposed入口类继承，实现handleLoadPackage方法</p> 
<p>IXposedHookLoadPackage接口。该接口提供了一个名为handleLoadPackage的方法，这个方法在Android系统每次加载一个包的时候都会被调用</p> 
<table><thead><tr><th>handleLoadPackage</th><th>用于在加载应用程序的包的时候执行用户的操作</th></tr></thead><tbody><tr><td>LoadPackageParam loadPackageParam</td><td>包含了加载的应用程序的一些基本信息</td></tr></tbody></table> 
<ul><li>IXposedHookInitPackageResources.java</li></ul> 
<p>加载回调接口，用于修改app的资源文件，在xposed入口类继承，实现handleInitPackageResources(InitPackageResourcesParam resparam)方法</p> 
<table><thead><tr><th>handleInitPackageResources</th><th>用于在加载应用程序的包的时候执行用户的操作</th></tr></thead><tbody><tr><td>InitPackageResourcesParam resparam</td><td>包含了加载的应用程序的一些资源基本信息</td></tr></tbody></table> 
<ul><li>XposedHelpers.java</li></ul> 
<p>一些辅助方法，简化连接和调用方法/构造函数,获取和设置字段</p> 
<p>HOOK无参数的方法，XposedHelpers.findAndHookMethod()方法一般四个参数，分别为完整类名、ClassLoader对象、方法名以及一个回调接口</p> 
<pre><code class="prism language-java"><span class="token class-name">XposedHelpers</span><span class="token punctuation">.</span><span class="token function">findAndHookMethod</span><span class="token punctuation">(</span><span class="token string">"com.example.demo.MortgageActivity"</span><span class="token punctuation">,</span> loadPackageParam<span class="token punctuation">.</span>classLoader<span class="token punctuation">,</span>
        <span class="token string">"showLoan"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">XC_MethodHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">//……</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>HOOK有参数的方法，比如要传入两个int参数，则：</p> 
<pre><code class="prism language-java"><span class="token class-name">XposedHelpers</span><span class="token punctuation">.</span><span class="token function">findAndHookMethod</span><span class="token punctuation">(</span><span class="token string">"com.example.demo.MortgageActivity"</span><span class="token punctuation">,</span> loadPackageParam<span class="token punctuation">.</span>classLoader<span class="token punctuation">,</span>
        <span class="token string">"showLoan"</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">XC_MethodHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">//……</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>PS</strong>：new XC_MethodHook()有两个重要的内部函数beforeHookedMethod()和afterHookedMethod()，通过重写它们可以实现对任意方法的挂钩，它们的区别在于Hook前调用还是后调用</p> 
<pre><code class="prism language-c">beforeHookedMethod 该方法在hook目标方法执行前调用，
其中，参数param指的是目标方法的相关参数、回调、方法等信息

afterHookedMethod 该方法在hook目标方法执行后调用，
其中，参数param指的是目标方法的相关参数、回调、方法等信息。

Xposed运行多个模块对同一个方法进行hook时，
框架就会根据Xposed模块的优先级来排序
</code></pre> 
<p>XposedBridge类中hookAllMethods和log方法主要用于一次hook每个类的所有方法或够造函数</p> 
<pre><code class="prism language-java"><span class="token function">hookAllMethods</span><span class="token punctuation">(</span>
	<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> hookClass<span class="token punctuation">,</span><span class="token comment">//需要进行hook的类</span>
	<span class="token class-name">String</span> methodName<span class="token punctuation">,</span><span class="token comment">//需要进行hook的方法名</span>
	<span class="token class-name">XC_MethodHook</span> callback<span class="token comment">//回调函数</span>
<span class="token punctuation">)</span>
</code></pre> 
<p>XposedHookLoadPackage中的handleLoadPackage方法主要用于加载应用程序包时执行用户的操作。</p> 
<table><thead><tr><th>findAndHookMethod</th><th>hook一个类中的方法</th></tr></thead><tbody><tr><td>className</td><td>要hook的方法的所在类</td></tr><tr><td>classloader</td><td>要hook的包的classLoader，一般都写loadPackageParam.classLoader</td></tr><tr><td>methodName</td><td>要hook的方法</td></tr><tr><td>parameterTypesAndCallback</td><td>方法的参数和监听器</td></tr></tbody></table> 
<table><thead><tr><th>callMethod</th><th>在目标app中调用方法</th></tr></thead><tbody><tr><td>Object</td><td>要调用方法的所在类</td></tr><tr><td>methodName</td><td>要调用的方法名称</td></tr><tr><td>args</td><td>方法的参数</td></tr></tbody></table> 
<table><thead><tr><th>findClass</th><th>获取class类实例</th></tr></thead><tbody><tr><td>className</td><td>类名</td></tr><tr><td>classLoader</td><td>类加载器</td></tr></tbody></table> 
<ul><li>XposedBridge.java</li></ul> 
<table><thead><tr><th>log</th><th>在Xposed的app的日志功能里输出日志</th></tr></thead><tbody><tr><td>text</td><td>要输出的内容</td></tr></tbody></table> 
<ul><li>XC_MethodHook中定义了回调方法</li></ul> 
<h3><a id="110_Android_295"></a>1.10 Android应用各部分说明</h3> 
<h4><a id="1101_MainActivityjava_297"></a>1.10.1 MainActivity.java文件</h4> 
<p>主要活动代码，实际的应用程序文件，将被转化为Dalvik可执行文件并运行。<code>R.layout.activity_main</code>引用<code>res/layout/activity_main.xml</code>文件。</p> 
<p>onCreate() 活动被加载之后众多被调用的方法之一。</p> 
<p><img src="https://images2.imgbox.com/e4/f5/xGqK9x5o_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="1102_AndroidManifestxml_306"></a>1.10.2 AndroidManifest.xml文件</h4> 
<p>AndroidManifest.xml文件是整个应用程序的信息描述文件，定义了应用程序中包含的Activity、Service、Content provider和BroadcastReceiver组件信息。每个应用程序在根目录下必须包含一个AndroidManifest.xml文件，且文件名不能修改。在AndroidManifest.xml文件中，首先看到是的<code>&lt;manifest&gt;</code>节点，它是整个应用程序的基本属性，涵盖了默认进程名字，应用程序标识，安装位置，对系统的要求以及应用程序的版本等。</p> 
<ul><li>android:icon是普通图标</li><li>android:roundIcon是圆形图标</li><li>android:label属性指定应用的名称</li><li>android:name属性指定一个Activity类子类的全名</li></ul> 
<p>意图过滤器的action被命名为<code>android.intent.action.MAIN</code>，表明这个活动被用做应用程序的入口。</p> 
<p>意图过滤器的category被命名为<code>android.intent.category.LAUNCHER</code>，表明应用程序可以通过设备启动器的图标来启动。</p> 
<p><code>@string</code>指的是strings.xml，因此<code>@string/app_name</code>指的是定义在strings.xml中的app_name，这里实际为"HO22K"</p> 
<p><img src="https://images2.imgbox.com/14/e0/5odw35fQ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b6/de/Xk5uYNOs_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="1103_activity_mainxml_326"></a>1.10.3 activity_main.xml文件</h4> 
<p><code>activity_main.xml</code>可能将频繁修改这个文件来改变应用程序的布局。</p> 
<p>TextView是一个用于构建用户图形界面的Android控件。它包含有许多不同的属性，诸如<code>android:layout_width</code>，<code>android:layout_height</code>等用来设置它的宽度和高度等。这里我们给它显示一句话“橙留香的Hook”，引用自strings.xml文件</p> 
<p><img src="https://images2.imgbox.com/6c/a7/DsjJQhKM_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="111_Android_layout_335"></a>1.11 Android layout属性大全</h3> 
<p>activity_main.xml 编写时需要用到</p> 
<h4><a id="1111__true_false_339"></a>1.11.1 第一类：属性值 true或者 false</h4> 
<table><thead><tr><th>属性</th><th>描述</th></tr></thead><tbody><tr><td>android:layout_centerHrizontal</td><td>水平居中</td></tr><tr><td>android:layout_centerVertical</td><td>垂直居中</td></tr><tr><td>android:layout_centerInparent</td><td>相对于父元素完全居中</td></tr><tr><td>android:layout_alignParentBottom</td><td>贴紧父元素的下边缘</td></tr><tr><td>android:layout_alignParentLeft</td><td>贴紧父元素的左边缘</td></tr><tr><td>android:layout_alignParentRight</td><td>贴紧父元素的右边缘</td></tr><tr><td>android:layout_alignParentTop</td><td>贴紧父元素的上边缘</td></tr><tr><td>android:layout_alignWithParentIfMissing</td><td>如果对应的兄弟元素找不到的话就以父元素做参照物</td></tr><tr><td>android:layout_alignParentStart</td><td>紧贴父元素结束位置开始</td></tr><tr><td>android:layout_alignParentEnd</td><td>紧贴父元素结束位置结束</td></tr><tr><td>android:animateLayoutChanges</td><td>布局改变时是否有动画效果</td></tr><tr><td>android:clipChildren</td><td>定义子布局是否一定要在限定的区域内</td></tr><tr><td>android:clipToPadding</td><td>定义布局间是否有间距</td></tr><tr><td>android:animationCache</td><td>定义子布局也有动画效果</td></tr><tr><td>android:alwaysDrawnWithCache</td><td>定义子布局是否应用绘图的高速缓存</td></tr><tr><td>android:addStatesFromChildren</td><td>定义布局是否应用子布局的背景</td></tr><tr><td>android:splitMotionEvents</td><td>定义布局是否传递touch事件到子布局</td></tr><tr><td>android:focusableInTouchMode</td><td>定义是否可以通过touch获取到焦点</td></tr><tr><td>android:isScrollContainer</td><td>定义布局是否作为一个滚动容器 可以调整整个窗体</td></tr><tr><td>android:fadeScrollbars</td><td>滚动条自动隐藏</td></tr><tr><td>android:fitsSystemWindows</td><td>设置布局调整时是否考虑系统窗口(如状态栏)</td></tr><tr><td>android:visibility</td><td>定义布局是否可见</td></tr><tr><td>android:requiresFadingEdge</td><td>定义滚动时边缘是否褪色</td></tr><tr><td>android:clickable</td><td>定义是否可点击</td></tr><tr><td>android:longClickable</td><td>定义是否可长点击</td></tr><tr><td>android:saveEnabled</td><td>设置是否在窗口冻结时（如旋转屏幕）保存View的数据</td></tr><tr><td>android:filterTouchesWhenObscured</td><td>所在窗口被其它可见窗口遮住时,是否过滤触摸事件</td></tr><tr><td>android:keepScreenOn</td><td>设置屏幕常亮</td></tr><tr><td>android:duplicateParentState</td><td>是否从父容器中获取绘图状态(光标,按下等)</td></tr><tr><td>android:soundEffectsEnabled</td><td>点击或触摸是否有声音效果</td></tr><tr><td>android:hapticFeedbackEnabled</td><td>设置触感反馈</td></tr></tbody></table> 
<h4><a id="1112_idididname_375"></a>1.11.2 第二类：属性值必须为id的引用名<code>“@id/id-name”</code></h4> 
<table><thead><tr><th>属性</th><th>描述</th></tr></thead><tbody><tr><td>android:layout_alignBaseline</td><td>本元素的文本与父元素文本对齐</td></tr><tr><td>android:layout_below</td><td>在某元素的下方</td></tr><tr><td>android:layout_above</td><td>在某元素的的上方</td></tr><tr><td>android:layout_toLeftOf</td><td>在某元素的左边</td></tr><tr><td>android:layout_toRightOf</td><td>在某元素的右边</td></tr><tr><td>android:layout_toStartOf</td><td>本元素从某个元素开始</td></tr><tr><td>android:layout_toEndOf</td><td>本元素在某个元素结束</td></tr><tr><td>android:layout_alignTop</td><td>本元素的上边缘和某元素的的上边缘对齐</td></tr><tr><td>android:layout_alignLeft</td><td>本元素的左边缘和某元素的的左边缘对齐</td></tr><tr><td>android:layout_alignBottom</td><td>本元素的下边缘和某元素的的下边缘对齐</td></tr><tr><td>android:layout_alignRight</td><td>本元素的右边缘和某元素的的右边缘对齐</td></tr><tr><td>android:layout_alignStart</td><td>本元素与开始的父元素对齐</td></tr><tr><td>android:layout_alignEnd</td><td>本元素与结束的父元素对齐</td></tr><tr><td>android:ignoreGravity</td><td>指定元素不受重力的影响</td></tr><tr><td>android:layoutAnimation</td><td>定义布局显示时候的动画</td></tr><tr><td>android:id</td><td>为布局添加ID方便查找</td></tr><tr><td>android:tag</td><td>为布局添加tag方便查找与类似</td></tr><tr><td>android:scrollbarThumbHorizontal</td><td>设置水平滚动条的drawable</td></tr><tr><td>android:scrollbarThumbVertical</td><td>设置垂直滚动条的drawable</td></tr><tr><td>android:scrollbarTrackHorizontal</td><td>设置水平滚动条背景（轨迹）的色drawable</td></tr><tr><td>android:scrollbarTrackVertical</td><td>设置垂直滚动条背景（轨迹）的色drawable</td></tr><tr><td>android:scrollbarAlwaysDrawHorizontalTrack</td><td>设置水平滚动条是否含有轨道</td></tr><tr><td>android:scrollbarAlwaysDrawVerticalTrack</td><td>设置垂直滚动条是否含有轨道</td></tr><tr><td>android:nextFocusLeft</td><td>设置左边指定视图获得下一个焦点</td></tr><tr><td>android:nextFocusRight</td><td>设置右边指定视图获得下一个焦点</td></tr><tr><td>android:nextFocusUp</td><td>设置上边指定视图获得下一个焦点</td></tr><tr><td>android:nextFocusDown</td><td>设置下边指定视图获得下一个焦点</td></tr><tr><td>android:nextFocusForward</td><td>设置指定视图获得下一个焦点</td></tr><tr><td>android:contentDescription</td><td>说明</td></tr><tr><td>android:OnClick</td><td>点击时从上下文中调用指定的方法</td></tr></tbody></table> 
<h4><a id="1113_30dip40px50dp_410"></a>1.11.3 第三类：属性值为具体的像素值，如<code>30dip,40px,50dp</code></h4> 
<table><thead><tr><th>属性</th><th>描述</th></tr></thead><tbody><tr><td>android:layout_width</td><td>定义本元素的宽度</td></tr><tr><td>android:layout_height</td><td>定义本元素的高度</td></tr><tr><td>android:layout_margin</td><td>本元素离上下左右间的距离</td></tr><tr><td>android:layout_marginBottom</td><td>离某元素底边缘的距离</td></tr><tr><td>android:layout_marginLeft</td><td>离某元素左边缘的距离</td></tr><tr><td>android:layout_marginRight</td><td>离某元素右边缘的距离</td></tr><tr><td>android:layout_marginTop</td><td>离某元素上边缘的距离</td></tr><tr><td>android:layout_marginStart</td><td>本元素里开始的位置的距离</td></tr><tr><td>android:layout_marginEnd</td><td>本元素里结束位置的距离</td></tr><tr><td>android:scrollX</td><td>水平初始滚动偏移</td></tr><tr><td>android:scrollY</td><td>垂直初始滚动偏移</td></tr><tr><td>android:background</td><td>本元素的背景</td></tr><tr><td>android:padding</td><td>指定布局与子布局的间距</td></tr><tr><td>android:paddingLeft</td><td>指定布局左边与子布局的间距</td></tr><tr><td>android:paddingTop</td><td>指定布局上边与子布局的间距</td></tr><tr><td>android:paddingRight</td><td>指定布局右边与子布局的间距</td></tr><tr><td>android:paddingBottom</td><td>指定布局下边与子布局的间距</td></tr><tr><td>android:paddingStart</td><td>指定布局左边与子布局的间距与android:paddingLeft相同</td></tr><tr><td>android:paddingEnd</td><td>指定布局右边与子布局的间距与android:paddingRight相同</td></tr><tr><td>android:fadingEdgeLength</td><td>设置边框渐变的长度</td></tr><tr><td>android:minHeight</td><td>最小高度</td></tr><tr><td>android:minWidth</td><td>最小宽度</td></tr><tr><td>android:translation</td><td>X水平方向的移动距离</td></tr><tr><td>android:translation</td><td>Y垂直方向的移动距离</td></tr><tr><td>android:transformPivot</td><td>X相对于一点的水平方向偏转量</td></tr><tr><td>android:transformPivot</td><td>Y相对于一点的垂直方向偏转量</td></tr></tbody></table> 
<h4><a id="1114_Android_441"></a>1.11.4 第四类：属性值为Android内置值</h4> 
<table><thead><tr><th>属性</th><th>描述</th></tr></thead><tbody><tr><td>android:gravity</td><td>控件布局方式</td></tr><tr><td>android:layout_gravity</td><td>布局方式</td></tr><tr><td>android:persistentDrawingCachehua</td><td>定义绘图的高速缓存的持久性</td></tr><tr><td>android:descendantFocusability</td><td>控制子布局焦点获取方式 常用于listView的item中包含多个控件点击无效</td></tr><tr><td>android:scrollbars</td><td>设置滚动条的状态</td></tr><tr><td>android:scrollbarStyle</td><td>设置滚动条的样式</td></tr><tr><td>android:fitsSystemWindows</td><td>设置布局调整时是否考虑系统窗口(如状态栏)</td></tr><tr><td>android:scrollbarFadeDuration</td><td>设置滚动条淡入淡出时间</td></tr><tr><td>android:scrollbarDefaultDelayBeforeFade</td><td>设置滚动条N毫秒后开始淡化，以毫秒为单位</td></tr><tr><td>android:scrollbarSize</td><td>设置滚动调大小</td></tr><tr><td>android:fadingEdge</td><td>设置拉滚动条时，边框渐变的放向</td></tr><tr><td>android:drawingCacheQuality</td><td>设置绘图时半透明质量</td></tr><tr><td>android:OverScrollMode</td><td>滑动到边界时样式</td></tr><tr><td>android:alpha</td><td>设置透明度</td></tr><tr><td>android:rotation</td><td>旋转度数</td></tr><tr><td>android:rotation</td><td>X水平旋转度数</td></tr><tr><td>android:rotation</td><td>Y垂直旋转度数</td></tr><tr><td>android:scale</td><td>X设置X轴缩放</td></tr><tr><td>android:scale</td><td>Y设置Y轴缩放</td></tr><tr><td>android:verticalScrollbarPosition</td><td>摄者垂直滚动条的位置</td></tr><tr><td>android:layerType</td><td>设定支持</td></tr><tr><td>android:layoutDirection</td><td>定义布局图纸的方向</td></tr><tr><td>android:textDirection</td><td>定义文字方向</td></tr><tr><td>android:textAlignment</td><td>文字对齐方式</td></tr><tr><td>android:importantForAccessibility</td><td>设置可达性的重要行</td></tr><tr><td>android:labelFor</td><td>添加标签</td></tr></tbody></table> 
<h2><a id="0x02__Xposed_476"></a>0x02 Xposed环境搭建</h2> 
<p>下载Xposed APK：</p> 
<p>https://dl-xda.xposed.info/modules/de.robv.android.xposed.installer_v33_36570c.apk</p> 
<p><img src="https://images2.imgbox.com/78/1f/2a5wAfsi_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/85/b5/tC3nKEuh_o.png" alt="在这里插入图片描述"></p> 
<p>打开刚刚安装好的Xposed</p> 
<p><img src="https://images2.imgbox.com/4a/0d/FTCVaAEX_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/a9/ea/fjOdQpYn_o.png" alt="在这里插入图片描述"></p> 
<p>这里为了方便选择永久记住</p> 
<p><img src="https://images2.imgbox.com/aa/ea/I07LXHid_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/23/94/t220EbwS_o.png" alt="在这里插入图片描述"></p> 
<p>安装Xposed可能会出现如下情况：</p> 
<p><img src="https://images2.imgbox.com/d5/1f/CBjGMzr4_o.png" alt="在这里插入图片描述"></p> 
<p>安装完毕后可能会出现未激活, 拉入JustTrustMe.apk, 然后重启模拟器就可以了<br> 然后修改wifi的ip和端口</p> 
<p><img src="https://images2.imgbox.com/b2/f2/Uigmj9X2_o.png" alt="在这里插入图片描述"></p> 
<ul><li>下载<code>xposed-x86_64.zip</code></li></ul> 
<p>下载xposed作者模拟器是x86_64的</p> 
<p>https://github.com/youling257/XposedTools/files/1931996/xposed-x86_64.zip</p> 
<p>如果模拟器是x86下载下面这个</p> 
<p>https://dl-xda.xposed.info/framework/</p> 
<ul><li>下载<code>script.sh</code></li></ul> 
<p>找到安卓对应版本，作何雷电模拟器是7.1，搜索对应为安卓7.1 sdk</p> 
<p>x86_64的下载这个：</p> 
<p>https://forum.xda-developers.com/attachment.php?attachmentid=4489568&amp;d=1525092710</p> 
<p>x86的下载这个，script.txt：</p> 
<p>https://forum.xda-developers.com/attachments/script-txt.4489568/，改名为script.sh</p> 
<p>创建文件夹xposed，然后解压一下xposed压缩包，最后把xposed压缩包中的system文件夹和script.sh放入刚刚创建的xposed文件夹，最后的最后执行如下命令：</p> 
<pre><code class="prism language-c">adb<span class="token punctuation">.</span>exe remount
adb<span class="token punctuation">.</span>exe push D<span class="token operator">:</span>\test\xposed  <span class="token operator">/</span>system
adb<span class="token punctuation">.</span>exe shell
cd <span class="token operator">/</span>system
mount <span class="token operator">-</span>o remount <span class="token operator">-</span>w <span class="token operator">/</span>system
chmod <span class="token number">777</span> script<span class="token punctuation">.</span>sh
sh script<span class="token punctuation">.</span>sh
</code></pre> 
<p><img src="https://images2.imgbox.com/56/d7/dLwdcAdD_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="0x03_Xposed_547"></a>0x03 Xposed原理分析</h2> 
<p>Xposed框架的原理是修改系统文件，替换了<code>/system/bin/app_process</code>可执行文件，在启动Zygote时加载额外的jar文件（<code>/data/data/de.robv.android.xposed.installer/bin/XposedBridge.jar</code>），并执行一些初始化操作(执行XposedBridge的main方法)。然后开发人员就可以在这个Zygote上下文中进行某些Hook操作。</p> 
<p>在Android中，zygote是整个系统创建新进程的核心进程。zygote进程在内部会先启动Dalvik虚拟机，继而加载一些必要的系统资源和系统类，最后进入一种监听状态。</p> 
<p>在之后的运作中，当其他系统模块（比如AMS）希望创建新进程时，只需向zygote进程发出请求，zygote进程监听到该请求后，会相应地fork出新的进程，于是这个新进程在初生之时，就先天具有了自己的Dalvik虚拟机以及系统资源。</p> 
<p>zygote进程是由init进程启动起来，由init.rc 脚本中关于zygote的描述可知：zygote对应的可执行文件就是<code>/system/bin/app_process</code>，也就是说系统启动时会执行到这个可执行文件的main()函数里</p> 
<p>Xposed 提供了几个接口类供xposed模块继承，不同的接口类对应不同的hook时机 IXposedHookZygoteInit zygote 初始化前就执行挂钩，即loadModule执行时就挂钩了 IXposedHookLoadPackage apk包加载的时候执行挂钩，先将挂钩函数保存起来，等加载apk函数执行后触发callback （这里的callback是xposed框架自己挂钩的函数），再执行模块注册的挂钩函数 IXposedHookInitPackageResources apk资源实例化时执行挂钩，同上</p> 
<h2><a id="0x03_Xposed__560"></a>0x03 编写Xposed 模块</h2> 
<p>从本质上来讲，Xposed 模块也是一个 Android 程序。但与普通程序不同的是，想要让写出的Android程序成为一个Xposed 模块，要额外多完成以下四个硬性任务：</p> 
<ul><li>让手机上的xposed框架知道我们安装的这个程序是个xposed模块</li><li>模块里要包含有xposed的API的jar包，以实现下一步的hook操作</li><li>这个模块里面要有对目标程序进行hook操作的方法</li><li>要让手机上的xposed框架知道，我们编写的xposed模块中，哪一个方法是实现hook操作的</li></ul> 
<p>这就引出如下的四大件（与前四步一一对照）：</p> 
<ul><li>AndroidManifest.xml</li><li>XposedBridgeApi-xx.jar 与 build.gradle</li><li>实现hook操作的具体代码</li><li>xposed_Init</li></ul> 
<p><strong>PS</strong>：牢记以上四大件，按照顺序一个一个实现，就能完成Xposed模块编写</p> 
<h3><a id="31_Android_580"></a>3.1 创建一个Android项目</h3> 
<p><strong>官网下载地址</strong>：https://developer.android.com/studio?hl=zh-cn</p> 
<p>傻瓜式一键点点安装，安装过程忽略不写，不懂的可百度自行搜索</p> 
<p>首先打开AndroidStudio（以版本3.1为例），建立一个工程，提示我们选择“Activity”，那就选一个Empty Activity吧。（这个是模块的界面，随意选择即可）</p> 
<p><img src="https://images2.imgbox.com/f8/91/3rdIgQup_o.png" alt="在这里插入图片描述"></p> 
<p>新建完成后下载依赖时，可能会出现如下报错（是没有科学上网导致的，要么你科学上网，要么你把gradle版本下载到本地来安装</p> 
<p><img src="https://images2.imgbox.com/c2/9b/craWkIrv_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/0b/ea/xrIFM67V_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/8c/3a/RTxLCXDq_o.png" alt="在这里插入图片描述"></p> 
<p>改为如下地址：</p> 
<pre><code class="prism language-c">distributionUrl<span class="token operator">=</span>file<span class="token operator">:</span><span class="token comment">///C:/Users/xxxxx/.gradle/wrapper/dists/gradle-7.2-bin.zip</span>
</code></pre> 
<p>然后又有可能发现gradle插件下载又出现问题，解决办法如下：</p> 
<p><img src="https://images2.imgbox.com/b3/27/yO6ZiATw_o.png" alt="在这里插入图片描述"></p> 
<p>如上图，注释掉google()，新增如下maven：</p> 
<pre><code class="prism language-c">        <span class="token comment">//google()</span>
        maven <span class="token punctuation">{<!-- --></span> url 'https<span class="token operator">:</span><span class="token comment">//maven.aliyun.com/repository/google'}</span>
        maven <span class="token punctuation">{<!-- --></span> url 'https<span class="token operator">:</span><span class="token comment">//maven.aliyun.com/repository/jcenter'}</span>
        maven <span class="token punctuation">{<!-- --></span> url 'https<span class="token operator">:</span><span class="token comment">//maven.aliyun.com/repository/public'}</span>
</code></pre> 
<p>以及如下位置：</p> 
<p><img src="https://images2.imgbox.com/b9/6d/6Xvvh31e_o.png" alt="在这里插入图片描述"></p> 
<p>最后关闭Android Studio，再重新打开项目会自动加载，此时如果没有再有红色警示就代表OK了，然后直接编译一个Demo的APK（app/build/outputs/apk/debug目录下，可以看到app-debug.apk），看看是否能正常运行，如下图：</p> 
<p><img src="https://images2.imgbox.com/21/76/ePyeWWtt_o.png" alt="在这里插入图片描述"></p> 
<p>放到模拟器中，发现能正常安装并运行，如下图：</p> 
<p><img src="https://images2.imgbox.com/bd/70/8mmy5i2S_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="32_AndroidManifestxml_632"></a>3.2 配置AndroidManifest.xml</h3> 
<p>为了让Xposed 识别出这是个Xposed模块，需要添加如下内容：</p> 
<pre><code class="prism language-java">        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>告诉xposed框架这是一个xposed模块 <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>meta<span class="token operator">-</span>data
            android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"xposedmodule"</span>
            android<span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">/</span><span class="token operator">&gt;</span>

        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>关于xposed模块的描述 <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>meta<span class="token operator">-</span>data
            android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"xposeddescription"</span>
            android<span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">"XposeHook例程"</span><span class="token operator">/</span><span class="token operator">&gt;</span>

        <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>xposed模块支持的最低版本（以为<span class="token number">54</span>为例） <span class="token operator">--</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>meta<span class="token operator">-</span>data
            android<span class="token operator">:</span>name<span class="token operator">=</span><span class="token string">"xposedminversion"</span>
            android<span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">"54"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/06/82/6TDcr6px_o.png" alt="在这里插入图片描述"></p> 
<p>修改文本内容为：橙留香的HooK</p> 
<p><img src="https://images2.imgbox.com/7e/b5/cgLfDhsA_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b0/25/6EOjqgnw_o.png" alt="在这里插入图片描述"></p> 
<p>此时把编译好的APK丢进去，打开后，如下</p> 
<p><img src="https://images2.imgbox.com/c3/80/4iWTSkjm_o.png" alt="在这里插入图片描述"></p> 
<p><strong>PS</strong>：从上图已看出，Xposed框架已经认出了刚刚写的程序，但是现在这个模块什么都没有做，因为我们还没有做出修改</p> 
<h3><a id="33_XposedBridgeApixxjarbuildgradle_675"></a>3.3 配置<code>XposedBridgeApi-xx.jar</code>与<code>build.gradle</code></h3> 
<p>Xposed模块主要功能是用来Hook其他程序的各种函数。</p> 
<ul><li>接下来，如何让刚刚创建的那个Xposed“一穷二白”的模块增加一些其它的功能呢？</li></ul> 
<p>引入 XposedBridgeApi.jar包，可理解该包是一把兵器，Xposed模块有了这把绝世神器才能施展出Hook武功。</p> 
<p>3.x以前，都需要手动下载诸如XposedBridgeApi的jar包，然后手工导入到libs目录里</p> 
<ul><li>XposedBridgeApi-54下载</li></ul> 
<p>https://forum.xda-developers.com/attachment.php?s=5903ce1b3edb1032faba7292b21e1801&amp;attachmentid=2748878&amp;d=1400342298</p> 
<p><strong>PS</strong>：除了XposedBridgeApi-54，还有XposedBridgeApi-82.jar、XposedBridgeApi-87.jar、XposedBridgeApi-89.jar等版本</p> 
<p>官网下载：https://bintray.com/rovo89/de.robv.android.xposed/api</p> 
<p>在AndroidStudio 3.1里面，只需要一行代码，AndroidStuido就会自动配置XposedBridgeApi.jar</p> 
<ul><li>方法1：<br> Android Studio的依赖:</li></ul> 
<p>Xposed框架需要用到第三方库，在 app --&gt; build-gradle 添加依赖（最后一行）</p> 
<pre><code class="prism language-c">repositories <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 告诉AndroidStuido使用jcenter作为代码仓库，</span>
    <span class="token comment">// 从这个仓库里远程寻找 </span>
    <span class="token comment">// de.robv.android.xposed:api:82 这个API</span>
    <span class="token comment">// 但最新版的3.x版本已不推荐使用</span>
    <span class="token function">jcenter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{<!-- --></span>
    provided <span class="token char">'de.robv.android.xposed:api:82'</span>
<span class="token punctuation">}</span>
注：
   此处要用compileOnly这个修饰符，
   网上有些写的是provide，
   已经停用了
</code></pre> 
<pre><code class="prism language-c">    compileOnly <span class="token char">'de.robv.android.xposed:api:82'</span>
    compileOnly 'de<span class="token punctuation">.</span>robv<span class="token punctuation">.</span>android<span class="token punctuation">.</span>xposed<span class="token operator">:</span>api<span class="token operator">:</span><span class="token number">82</span><span class="token operator">:</span>sources'
</code></pre> 
<p>修改完成后，build.gradle会提示文件已经修改，是否同步。点击 “sync now”，同步即可，如下：</p> 
<p><img src="https://images2.imgbox.com/c5/4c/WhpmVxsT_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="34_hook_733"></a>3.4 实现hook操作修改</h3> 
<p>在MainActivity的同级路径下新建一个类“HO22K.java”，操作如下图：</p> 
<p><img src="https://images2.imgbox.com/09/bc/iFjsoi7q_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d1/f5/k6H5Ll8C_o.png" alt="在这里插入图片描述"></p> 
<p>代码如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>ho22k</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">de<span class="token punctuation">.</span>robv<span class="token punctuation">.</span>android<span class="token punctuation">.</span>xposed<span class="token punctuation">.</span></span><span class="token class-name">IXposedHookLoadPackage</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">de<span class="token punctuation">.</span>robv<span class="token punctuation">.</span>android<span class="token punctuation">.</span>xposed<span class="token punctuation">.</span></span><span class="token class-name">XposedBridge</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">de<span class="token punctuation">.</span>robv<span class="token punctuation">.</span>android<span class="token punctuation">.</span>xposed<span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span></span><span class="token class-name">XC_LoadPackage</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> HO22K <span class="token keyword">implements</span> <span class="token class-name">IXposedHookLoadPackage</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * xpose插件入口点
     * @param lpparam
     * @throws Throwable
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleLoadPackage</span><span class="token punctuation">(</span><span class="token class-name">XC_LoadPackage<span class="token punctuation">.</span>LoadPackageParam</span> loadPackageParam<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取加载的apk程序包名</span>
        <span class="token class-name">XposedBridge</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"当前启动的应用程序是: "</span> <span class="token operator">+</span> loadPackageParam<span class="token punctuation">.</span>packageName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">XposedBridge</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Hook成功咯，宝们～_~!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/68/eb/Z5qoXuYG_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="35_xposed_Init_771"></a>3.5 添加入口点xposed_Init</h3> 
<p>右键点击 “main” 文件夹 ， 选择new --&gt; Folder --&gt;Assets Folder，新建assets 文件夹：</p> 
<p><img src="https://images2.imgbox.com/32/95/SYEOPb39_o.png" alt="在这里插入图片描述"></p> 
<p>然后右键点击 assets文件夹， new–&gt; file，文件名为xposed_init（文件类型选text），并在其中写上入口类的完整路径（就是自己编写的那一个Hook类），这样， Xposed框架就能够从这个 xposed_init 读取信息来找到模块的入口，然后进行Hook操作了</p> 
<p><img src="https://images2.imgbox.com/b2/70/n8ZdKWIq_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/84/e8/0xh7Yi1A_o.png" alt="在这里插入图片描述"></p> 
<p>xposed_init里写当前类的路径 如果存在多个类，那么每行写一个，多个写多行</p> 
<p><img src="https://images2.imgbox.com/fc/17/JBNhTcnX_o.png" alt="在这里插入图片描述"></p> 
<p>编译APK，在如下路径：</p> 
<p><img src="https://images2.imgbox.com/a7/35/wXXpx8EK_o.png" alt="在这里插入图片描述"></p> 
<p><strong>PS</strong>：编译的时候需要关闭Android Studio的instant Run功能(不太清楚为什么要关闭，我没有关闭一样可以正常使用)，注意注意Android Studio 3.5往后的版本，Instant Run被HotSwap代替，如下图</p> 
<p><img src="https://images2.imgbox.com/77/69/U4wyCGRh_o.png" alt="在这里插入图片描述"></p> 
<p>安装apk，在Xposed模块中勾选插件，重启，此时插件已经可正常使用</p> 
<p><img src="https://images2.imgbox.com/27/2c/1A6FOUBh_o.png" alt="在这里插入图片描述"></p> 
<p>观察日志，可通过Xposed框架内部日志模块或LogCat 查看</p> 
<p><img src="https://images2.imgbox.com/73/c1/eJCBW6Pa_o.png" alt="在这里插入图片描述"></p> 
<p><strong>PS</strong>：Windows CMD查看日志可能是会有乱码，解决方法如下：</p> 
<pre><code class="prism language-c">执行如下命令后，代码页就被变成UTF<span class="token operator">-</span><span class="token number">8</span>
chcp <span class="token number">65001</span> 
</code></pre> 
<p><img src="https://images2.imgbox.com/63/ef/bkhOdkkt_o.png" alt="在这里插入图片描述"></p> 
<p>然后修改窗口属性，改变字体在命令行标题栏上点击右键，选择"属性"-&gt;“字体”，将字体修改为True Type字体"Lucida Console"，然后点击确定将属性应用到当前窗口</p> 
<pre><code class="prism language-c">adb<span class="token punctuation">.</span>exe shell

logcat
</code></pre> 
<p><img src="https://images2.imgbox.com/cd/6a/aY4KSMyo_o.png" alt="在这里插入图片描述"></p> 
<ul><li>方法2：下载jar文件，存放至libs目录，其它细节自行百度了解</li></ul> 
<p>不是网上说的单独建立lib文件夹，那是很久以前的方法，然后右键“Add As Library” 自行添加这个jar包。而<code>compileOnly 'de.robv.android.xposed:api:82'</code>和<code>compileOnly 'de.robv.android.xposed:api:82:sources'</code>仍然照常添加</p> 
<h2><a id="0x04__838"></a>0x04 其它一些案例</h2> 
<h3><a id="41_Hook_839"></a>4.1 按钮劫持Hook</h3> 
<p>实现一个APK，基础功能就是点击界面的按钮，就会弹出消息你未被劫持的消息，具体完整代码如下（test APK代码）：</p> 
<ul><li>MainActivity：</li></ul> 
<pre><code class="prism language-javapackage">
import androidx.appcompat.app.AppCompatActivity;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.Toast;


public class MainActivity extends AppCompatActivity {
    private Button button;

    public void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        button = (Button) findViewById(R.id.button);

        button.setOnClickListener(new View.OnClickListener() {
            public void onClick(View v) {
                Toast.makeText(MainActivity.this, toastMessage(), Toast.LENGTH_SHORT).show();
            }
        });
    }

    public String toastMessage() {
        return "想啥呢？同学，我未被劫持";
    }
}
</code></pre> 
<ul><li>activity_main.xml：</li></ul> 
<pre><code class="prism language-c"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>androidx<span class="token punctuation">.</span>constraintlayout<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>ConstraintLayout xmlns<span class="token operator">:</span>android<span class="token operator">=</span><span class="token string">"http://schemas.android.com/apk/res/android"</span>
    xmlns<span class="token operator">:</span>app<span class="token operator">=</span><span class="token string">"http://schemas.android.com/apk/res-auto"</span>
    xmlns<span class="token operator">:</span>tools<span class="token operator">=</span><span class="token string">"http://schemas.android.com/tools"</span>
    android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"match_parent"</span>
    android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"match_parent"</span>
    tools<span class="token operator">:</span>context<span class="token operator">=</span><span class="token string">".MainActivity"</span><span class="token operator">&gt;</span>


    <span class="token operator">&lt;</span>Button
        android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/button"</span>
        android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>text<span class="token operator">=</span><span class="token string">"按一下按钮，确认是否被劫持"</span>
        tools<span class="token operator">:</span>layout_editor_absoluteX<span class="token operator">=</span><span class="token string">"78dp"</span>
        tools<span class="token operator">:</span>layout_editor_absoluteY<span class="token operator">=</span><span class="token string">"364dp"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>androidx<span class="token punctuation">.</span>constraintlayout<span class="token punctuation">.</span>widget<span class="token punctuation">.</span>ConstraintLayout<span class="token operator">&gt;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/02/a0/kYvOyE6e_o.png" alt="在这里插入图片描述"></p> 
<p>然后在HO22K 项目里面创建Xposed插件，这里博主为了偷懒，直接在一个项目里面写了，所以不加载Xposed，只要APK执行就会调用HO22K类，达到类似HO22K效果（不建议跟博主一样，自己重新创建一个APK和插件APK，不要两个都写在一起），代码和效果如下：</p> 
<pre><code class="prism language-c">package com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>ho22k<span class="token punctuation">;</span>


import de<span class="token punctuation">.</span>robv<span class="token punctuation">.</span>android<span class="token punctuation">.</span>xposed<span class="token punctuation">.</span>IXposedHookLoadPackage<span class="token punctuation">;</span>
import de<span class="token punctuation">.</span>robv<span class="token punctuation">.</span>android<span class="token punctuation">.</span>xposed<span class="token punctuation">.</span>XC_MethodHook<span class="token punctuation">;</span>
import de<span class="token punctuation">.</span>robv<span class="token punctuation">.</span>android<span class="token punctuation">.</span>xposed<span class="token punctuation">.</span>XposedHelpers<span class="token punctuation">;</span>
import de<span class="token punctuation">.</span>robv<span class="token punctuation">.</span>android<span class="token punctuation">.</span>xposed<span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span>XC_LoadPackage<span class="token punctuation">;</span>

public class HO22K implements IXposedHookLoadPackage
<span class="token punctuation">{<!-- --></span>

    <span class="token comment">//Module继承了IXposedHookLoadPackage接口，当系统加载应用包的时候回回调 handleLoadPackage；</span>
    public <span class="token keyword">void</span> <span class="token function">handleLoadPackage</span><span class="token punctuation">(</span>XC_LoadPackage<span class="token punctuation">.</span>LoadPackageParam loadPackageParam<span class="token punctuation">)</span> throws Throwable <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//过滤包名，定位要Hook的包名</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>loadPackageParam<span class="token punctuation">.</span>packageName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"com.example.ho22k"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

            <span class="token comment">//定位要Hook的具体的类名</span>
            Class clazz <span class="token operator">=</span> loadPackageParam<span class="token punctuation">.</span>classLoader<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token string">"com.example.ho22k.MainActivity"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//Hook的方法为toastMessage，XposedHelpers的静态方法 findAndHookMethod就是hook函数的的方法，其参数对应为   类名+loadPackageParam.classLoader（照写）+方法名+参数类型（根据所hook方法的参数的类型，即有多少个写多少个，加上.class）+XC_MethodHook回调接口；</span>
            XposedHelpers<span class="token punctuation">.</span><span class="token function">findAndHookMethod</span><span class="token punctuation">(</span>clazz<span class="token punctuation">,</span> <span class="token string">"toastMessage"</span><span class="token punctuation">,</span> new <span class="token function">XC_MethodHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                protected <span class="token keyword">void</span> <span class="token function">beforeHookedMethod</span><span class="token punctuation">(</span>MethodHookParam param<span class="token punctuation">)</span> throws Throwable <span class="token punctuation">{<!-- --></span>
                    super<span class="token punctuation">.</span><span class="token function">beforeHookedMethod</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                protected <span class="token keyword">void</span> <span class="token function">afterHookedMethod</span><span class="token punctuation">(</span>XC_MethodHook<span class="token punctuation">.</span>MethodHookParam param<span class="token punctuation">)</span> throws Throwable <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//param.setResult("你已被劫持")将返回的结果设置成了你已被劫持</span>
                    param<span class="token punctuation">.</span><span class="token function">setResult</span><span class="token punctuation">(</span><span class="token string">"哦吼，同学你已被劫持"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/96/43/s2Ixorhh_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/3c/7e/rfEgcUK4_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/bc/ce/3EMgtXdY_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/6a/36/64xtCd4Q_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="42__951"></a>4.2 登陆劫持</h3> 
<p>登陆劫持密码这样的操作，首先写一个简单的登陆程序，完整代码如下：</p> 
<ul><li>MainActivity：</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>ho22k</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">androidx<span class="token punctuation">.</span>appcompat<span class="token punctuation">.</span>app<span class="token punctuation">.</span></span><span class="token class-name">AppCompatActivity</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>os<span class="token punctuation">.</span></span><span class="token class-name">Bundle</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>view<span class="token punctuation">.</span></span><span class="token class-name">View</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">Button</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">EditText</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">android<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span><span class="token class-name">Toast</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainActivity</span> <span class="token keyword">extends</span> <span class="token class-name">AppCompatActivity</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">EditText</span> <span class="token class-name">Name</span><span class="token punctuation">;</span>   <span class="token comment">//定义Plain Test控件第一个输入框的名字</span>
    <span class="token class-name">EditText</span> <span class="token class-name">Pass</span><span class="token punctuation">;</span>   <span class="token comment">//定义Plain Test控件第二个输入框的名字</span>

    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onCreate</span><span class="token punctuation">(</span><span class="token class-name">Bundle</span> savedInstanceState<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onCreate</span><span class="token punctuation">(</span>savedInstanceState<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setContentView</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>layout<span class="token punctuation">.</span>activity_main<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Name</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">EditText</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>TEXT_NAME<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//通过findViewById找到输入框控件对应的id并给它起一个名字</span>
        <span class="token class-name">Pass</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">EditText</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>TEXT_PASS<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//通过findViewById找到输入框控件对应的id并给它起一个名字</span>
        <span class="token class-name">Button</span> <span class="token class-name">Login</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Button</span><span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span><span class="token class-name">R</span><span class="token punctuation">.</span>id<span class="token punctuation">.</span>BTN_Login<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//通过findViewById找到按钮控件对应的id并给它起一个名字</span>
        <span class="token class-name">Login</span><span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">//监听有没有点击按钮控件 如果点击了就会执行onClick函数</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span><span class="token class-name">View</span> view<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">check</span><span class="token punctuation">(</span><span class="token class-name">Name</span><span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Pass</span><span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//调用check函数</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span><span class="token class-name">String</span> pass<span class="token punctuation">)</span>   <span class="token comment">//自定义函数check 这里用来检查用户名和密码是否是cck和1234</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"Orangey"</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span>pass<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"123456"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"登录成功"</span><span class="token punctuation">,</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//弹框</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
            <span class="token class-name">Toast</span><span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token class-name">MainActivity</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">"登录失败"</span><span class="token punctuation">,</span> <span class="token class-name">Toast</span><span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//弹框</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>activity_main.xml：</li></ul> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token class-name"><span class="token namespace">androidx<span class="token punctuation">.</span>constraintlayout<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span>ConstraintLayout</span> xmlns<span class="token operator">:</span>android<span class="token operator">=</span><span class="token string">"http://schemas.android.com/apk/res/android"</span>
    xmlns<span class="token operator">:</span>app<span class="token operator">=</span><span class="token string">"http://schemas.android.com/apk/res-auto"</span>
    xmlns<span class="token operator">:</span>tools<span class="token operator">=</span><span class="token string">"http://schemas.android.com/tools"</span>
    android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"match_parent"</span>
    android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"match_parent"</span>
    tools<span class="token operator">:</span>context<span class="token operator">=</span><span class="token string">".MainActivity"</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token class-name">TextView</span>
        android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/textView"</span>
        android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>layout_marginEnd<span class="token operator">=</span><span class="token string">"23dp"</span>
        android<span class="token operator">:</span>text<span class="token operator">=</span><span class="token string">"账号："</span>
        app<span class="token operator">:</span>layout_constraintBaseline_toBaselineOf<span class="token operator">=</span><span class="token string">"@+id/TEXT_NAME"</span>
        app<span class="token operator">:</span>layout_constraintEnd_toStartOf<span class="token operator">=</span><span class="token string">"@+id/TEXT_NAME"</span>
        app<span class="token operator">:</span>layout_constraintHorizontal_chainStyle<span class="token operator">=</span><span class="token string">"packed"</span>
        app<span class="token operator">:</span>layout_constraintStart_toStartOf<span class="token operator">=</span><span class="token string">"parent"</span>
        tools<span class="token operator">:</span>ignore<span class="token operator">=</span><span class="token string">"MissingConstraints"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token class-name">TextView</span>
        android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/textView2"</span>
        android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>layout_marginEnd<span class="token operator">=</span><span class="token string">"23dp"</span>
        android<span class="token operator">:</span>text<span class="token operator">=</span><span class="token string">"密码："</span>
        app<span class="token operator">:</span>layout_constraintBaseline_toBaselineOf<span class="token operator">=</span><span class="token string">"@+id/TEXT_PASS"</span>
        app<span class="token operator">:</span>layout_constraintEnd_toStartOf<span class="token operator">=</span><span class="token string">"@+id/TEXT_PASS"</span>
        app<span class="token operator">:</span>layout_constraintHorizontal_chainStyle<span class="token operator">=</span><span class="token string">"packed"</span>
        app<span class="token operator">:</span>layout_constraintStart_toStartOf<span class="token operator">=</span><span class="token string">"parent"</span>
        tools<span class="token operator">:</span>ignore<span class="token operator">=</span><span class="token string">"MissingConstraints"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token class-name">EditText</span>
        android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/TEXT_NAME"</span>
        android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>layout_alignBottom<span class="token operator">=</span><span class="token string">"@+id/textView"</span>
        android<span class="token operator">:</span>layout_marginTop<span class="token operator">=</span><span class="token string">"180dp"</span>
        android<span class="token operator">:</span>layout_marginEnd<span class="token operator">=</span><span class="token string">"1dp"</span>
        android<span class="token operator">:</span>layout_toEndOf<span class="token operator">=</span><span class="token string">"@+id/textView"</span>
        android<span class="token operator">:</span>layout_toRightOf<span class="token operator">=</span><span class="token string">"@+id/textView"</span>
        android<span class="token operator">:</span>ems<span class="token operator">=</span><span class="token string">"10"</span>
        android<span class="token operator">:</span>inputType<span class="token operator">=</span><span class="token string">"textPersonName"</span>
        app<span class="token operator">:</span>layout_constraintEnd_toEndOf<span class="token operator">=</span><span class="token string">"parent"</span>
        app<span class="token operator">:</span>layout_constraintStart_toEndOf<span class="token operator">=</span><span class="token string">"@+id/textView"</span>
        app<span class="token operator">:</span>layout_constraintTop_toTopOf<span class="token operator">=</span><span class="token string">"parent"</span>
        tools<span class="token operator">:</span>ignore<span class="token operator">=</span><span class="token string">"MissingConstraints"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token class-name">EditText</span>
        android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/TEXT_PASS"</span>
        android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>layout_alignBottom<span class="token operator">=</span><span class="token string">"@+id/textView2"</span>
        android<span class="token operator">:</span>layout_marginTop<span class="token operator">=</span><span class="token string">"35dp"</span>
        android<span class="token operator">:</span>layout_marginEnd<span class="token operator">=</span><span class="token string">"1dp"</span>
        android<span class="token operator">:</span>layout_toEndOf<span class="token operator">=</span><span class="token string">"@+id/textView2"</span>
        android<span class="token operator">:</span>layout_toRightOf<span class="token operator">=</span><span class="token string">"@+id/textView2"</span>
        android<span class="token operator">:</span>ems<span class="token operator">=</span><span class="token string">"10"</span>
        android<span class="token operator">:</span>inputType<span class="token operator">=</span><span class="token string">"textPassword"</span>
        app<span class="token operator">:</span>layout_constraintEnd_toEndOf<span class="token operator">=</span><span class="token string">"parent"</span>
        app<span class="token operator">:</span>layout_constraintStart_toEndOf<span class="token operator">=</span><span class="token string">"@+id/textView2"</span>
        app<span class="token operator">:</span>layout_constraintTop_toBottomOf<span class="token operator">=</span><span class="token string">"@+id/TEXT_NAME"</span>
        tools<span class="token operator">:</span>ignore<span class="token operator">=</span><span class="token string">"MissingConstraints"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>

    <span class="token operator">&lt;</span><span class="token class-name">Button</span>
        android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/BTN_Login"</span>
        android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"wrap_content"</span>
        android<span class="token operator">:</span>layout_marginTop<span class="token operator">=</span><span class="token string">"42dp"</span>
        android<span class="token operator">:</span>text<span class="token operator">=</span><span class="token string">"登录"</span>
        app<span class="token operator">:</span>layout_constraintEnd_toEndOf<span class="token operator">=</span><span class="token string">"@+id/TEXT_PASS"</span>
        app<span class="token operator">:</span>layout_constraintStart_toStartOf<span class="token operator">=</span><span class="token string">"@+id/TEXT_PASS"</span>
        app<span class="token operator">:</span>layout_constraintTop_toBottomOf<span class="token operator">=</span><span class="token string">"@+id/TEXT_PASS"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>


<span class="token operator">&lt;</span><span class="token operator">/</span><span class="token class-name"><span class="token namespace">androidx<span class="token punctuation">.</span>constraintlayout<span class="token punctuation">.</span>widget<span class="token punctuation">.</span></span>ConstraintLayout</span><span class="token operator">&gt;</span>
</code></pre> 
<p>账号：Orangey 密码：123456</p> 
<p>正确的账号密码登录如下图：</p> 
<p><img src="https://images2.imgbox.com/44/2e/xAI5uTNb_o.png" alt="在这里插入图片描述"></p> 
<p>账号：a 密码：123456<br> 错误的账号或密码登录如下图：</p> 
<p><img src="https://images2.imgbox.com/09/1e/8XjgP0P4_o.png" alt="在这里插入图片描述"></p> 
<p><strong>PS</strong>：如果出现界面布局混乱，只需要设置一下约束即可，如下图：</p> 
<p><img src="https://images2.imgbox.com/85/2e/K9MQTggV_o.png" alt="在这里插入图片描述"></p> 
<p><strong>目的</strong>：不管输入什么都会显示登陆成功，Hook对应的方法，并对相应的参数进行修改，还是使用上面的回调方法来实现</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">de<span class="token punctuation">.</span>robv<span class="token punctuation">.</span>android<span class="token punctuation">.</span>xposed<span class="token punctuation">.</span></span><span class="token class-name">IXposedHookLoadPackage</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">de<span class="token punctuation">.</span>robv<span class="token punctuation">.</span>android<span class="token punctuation">.</span>xposed<span class="token punctuation">.</span></span><span class="token class-name">XC_MethodHook</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">de<span class="token punctuation">.</span>robv<span class="token punctuation">.</span>android<span class="token punctuation">.</span>xposed<span class="token punctuation">.</span></span><span class="token class-name">XposedBridge</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">de<span class="token punctuation">.</span>robv<span class="token punctuation">.</span>android<span class="token punctuation">.</span>xposed<span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span></span><span class="token class-name">XC_LoadPackage</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">de<span class="token punctuation">.</span>robv<span class="token punctuation">.</span>android<span class="token punctuation">.</span>xposed<span class="token punctuation">.</span></span><span class="token class-name">XposedHelpers</span><span class="token punctuation">.</span>findAndHookMethod<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> HO22K <span class="token keyword">implements</span> <span class="token class-name">IXposedHookLoadPackage</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 包加载时候的回调
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleLoadPackage</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">XC_LoadPackage<span class="token punctuation">.</span>LoadPackageParam</span> lpparam<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>

        <span class="token comment">// 将包名不是 com.example.ho22k 的应用剔除掉,可以减少管理的类</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>lpparam<span class="token punctuation">.</span>packageName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"com.example.ho22k"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token class-name">XposedBridge</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"当前APP应用程序是: "</span> <span class="token operator">+</span> lpparam<span class="token punctuation">.</span>packageName<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//第一个参数是className，表示被注入的方法所在的类</span>
        <span class="token comment">//第二个参数是类加载器，照抄就行</span>
        <span class="token comment">//第三个参数是被注入的方法名</span>
        <span class="token comment">//第四五个参数是第三个参数的两个形参的类型</span>
        <span class="token comment">//最后一个参数是匿名内部类</span>
        <span class="token function">findAndHookMethod</span><span class="token punctuation">(</span><span class="token string">"com.example.ho22k.MainActivity"</span><span class="token punctuation">,</span> lpparam<span class="token punctuation">.</span>classLoader<span class="token punctuation">,</span> <span class="token string">"check"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
                <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">XC_MethodHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

                    <span class="token comment">/**
                     * 该方法在check方法调用之前被调用，输出一些日志，并且捕获参数的值。
                     * 最后两行的目的是改变参数的值。也就是说无论参数是什么值，都会被替换为name为Orangey,pass为123456
                     * @param param
                     * @throws Throwable
                     */</span>
                    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">beforeHookedMethod</span><span class="token punctuation">(</span><span class="token class-name">MethodHookParam</span> param<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token class-name">XposedBridge</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"同学，你正在被人开始劫持"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">XposedBridge</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"参数1 = "</span> <span class="token operator">+</span> param<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">XposedBridge</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"参数2 = "</span> <span class="token operator">+</span> param<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        param<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"Orangey"</span><span class="token punctuation">;</span>
                        param<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"123456"</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">/**
                     * 该方法在check方法调用之后被调用
                     * @param param
                     * @throws Throwable
                     */</span>

                    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">afterHookedMethod</span><span class="token punctuation">(</span><span class="token class-name">MethodHookParam</span> param<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token class-name">XposedBridge</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"哦吼，同学劫持已结束"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">XposedBridge</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"参数1 = "</span> <span class="token operator">+</span> param<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">XposedBridge</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"参数2 = "</span> <span class="token operator">+</span> param<span class="token punctuation">.</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>通过对方法的参数进行了重赋值，效果如下图：</p> 
<p><img src="https://images2.imgbox.com/77/b8/4fZp3gYt_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/18/4d/JM6N8Ns7_o.png" alt="日志里面看看"></p> 
<p>Github上的一些Xposed案例APK地址：</p> 
<ul><li>原始程序：https://github.com/Gordon0918/XposedHookTarget</li><li>hook修改源程序地址：https://github.com/Gordon0918/XposedHook</li></ul> 
<p><strong>参考链接</strong>：</p> 
<p>https://blog.csdn.net/gdutxiaoxu/article/details/81459830</p> 
<p>https://eastmoon.blog.csdn.net/article/details/103810710</p> 
<p>https://blog.csdn.net/SouthWind0/article/details/100669530</p> 
<p>https://blog.csdn.net/JBlock/article/details/84202240</p> 
<p>https://www.cnblogs.com/mukekeheart/p/5662842.html</p> 
<p>https://blog.csdn.net/song_lee/article/details/103299353</p> 
<hr> 
<p><strong>你以为你有很多路可以选择，其实你只有一条路可以走</strong></p> 
<hr>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f71f97869e3a17062eb970881ddb1c9b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">最新Snort3和Snort2安装详细教程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/24193600bb742c7b040133415543a0c2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">[免费专栏] Android安全之绕过SSL Pinning抓HTTPS数据</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>