<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android 动态禁止/允许Viewpager左（右）滑动 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android 动态禁止/允许Viewpager左（右）滑动" />
<meta property="og:description" content="最近在做一个仿抖音首页效果。大致结构为， MainActivity里Viewpager带3个fragment，中间的fragment又add了4个Tab（首页，关注，消息，我）
1 玩过抖音的孩子应该有点印象。在首页tab的时候，viewpager左右两个fragment还能滑出来，在关注tab，消息tab，我tab中，viewpager左右就滑不出来了——禁止了Viewpager左右滑动。
2 在首页tab中，还有推荐tab和城市tab，推荐tab正常左右滑动viewpager，而城市tab无法滑出右侧tab——禁止Viewpager右滑
说到底就是需要一个可以动态设置当前是否可以左（右）滑的Viewpager，网上看了下，emm…几乎是写viewpager禁止滑动的，好吧…过人还得自己写。
处理手势 禁止和允许，无非就是要不要处理这个touch事件。
允许——正常情况下，onTouchEvent返回的super.onTouchEvent(event)；
禁止——return true
private float lastX; private static final int LEFT_TO_RIGHT=1;//方向=从左到右 private static final int RIGHT_TO_LEFT=2;//方向=从右到左 //手指是否已经抬起 （如果不加入这个参数判断，在手指抬起的那一刻touch事件return了true，页面会卡在手指离开那时候的偏移位置） private boolean isUp=true; @Override public boolean onTouchEvent(MotionEvent event) { int direction=0; switch (event.getAction()){ case MotionEvent.ACTION_DOWN: isUp=false; //获取起始坐标值 lastX = event.getX(); break; case MotionEvent.ACTION_MOVE: if(event.getX()-lastX&lt;0){//从右到左滑（左滑） direction=RIGHT_TO_LEFT; }else {//从左到右滑（右滑） direction=LEFT_TO_RIGHT; } break; case MotionEvent.ACTION_UP: isUp=true; break; } if(isUp){ //手指抬起后,不再接管viewpager的事件，让它自由地滑动 return super.onTouchEvent(event); }else if(direction==RIGHT_TO_LEFT&amp;&amp;isCanGoRight){ //允许滑动则应该调用父类的方法 return super." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/785acbc3c86682f545fa45113e4fc407/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-11-15T09:50:49+08:00" />
<meta property="article:modified_time" content="2018-11-15T09:50:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android 动态禁止/允许Viewpager左（右）滑动</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>最近在做一个仿抖音首页效果。大致结构为， MainActivity里Viewpager带3个fragment，中间的fragment又add了4个Tab（首页，关注，消息，我）<br> 1 玩过抖音的孩子应该有点印象。在首页tab的时候，viewpager左右两个fragment还能滑出来，在关注tab，消息tab，我tab中，viewpager左右就滑不出来了——禁止了Viewpager左右滑动。<br> 2 在首页tab中，还有推荐tab和城市tab，推荐tab正常左右滑动viewpager，而城市tab无法滑出右侧tab——禁止Viewpager右滑<br> 说到底就是需要一个可以动态设置当前是否可以左（右）滑的Viewpager，网上看了下，emm…几乎是写viewpager禁止滑动的，好吧…过人还得自己写。</p> 
<h3><a id="_5"></a>处理手势</h3> 
<p>禁止和允许，无非就是要不要处理这个touch事件。<br> 允许——正常情况下，onTouchEvent返回的super.onTouchEvent(event)；<br> 禁止——return true</p> 
<pre><code>    private float lastX;
    private static final int LEFT_TO_RIGHT=1;//方向=从左到右
    private static final int RIGHT_TO_LEFT=2;//方向=从右到左
    //手指是否已经抬起 （如果不加入这个参数判断，在手指抬起的那一刻touch事件return了true，页面会卡在手指离开那时候的偏移位置）
    private boolean isUp=true;

    @Override
    public boolean onTouchEvent(MotionEvent event) {
        int direction=0;
        switch (event.getAction()){
            case MotionEvent.ACTION_DOWN:
                isUp=false;
                //获取起始坐标值
                lastX = event.getX();
                break;
            case MotionEvent.ACTION_MOVE:
                if(event.getX()-lastX&lt;0){//从右到左滑（左滑）
                    direction=RIGHT_TO_LEFT;
                }else {//从左到右滑（右滑）
                    direction=LEFT_TO_RIGHT;
                }
                break;
            case MotionEvent.ACTION_UP:
                isUp=true;
                break;
        }
        if(isUp){
            //手指抬起后,不再接管viewpager的事件，让它自由地滑动
            return super.onTouchEvent(event);
        }else
        if(direction==RIGHT_TO_LEFT&amp;&amp;isCanGoRight){
            //允许滑动则应该调用父类的方法
            return super.onTouchEvent(event);
        }else if(direction==LEFT_TO_RIGHT&amp;&amp;isCanGoLeft){
            return super.onTouchEvent(event);
        }else {
            //禁止滑动则不做任何操作，直接返回true即可
            return true;
        }
    }
</code></pre> 
<p>需要注意的地方是，在ACTION_UP的时候，不管是否某个方向禁止滑动，我们都要把touch事件还给viewpager做他本来想做的事情。不然页面在那一刻会卡住。<br> Viewpager在滑动的时候，有时候也会崩溃，报native。处理方法就是return super.方法的时候要catch一下。<br> 完整的Viewpager代码</p> 
<pre><code>import android.content.Context;
import android.support.v4.view.ViewPager;
import android.util.AttributeSet;
import android.util.Log;
import android.view.MotionEvent;

/**
 * Created by KID on 2018/11/14.
 * 可动态禁止（允许）左滑/右滑的viewpager
 */
public class ControlViewpger  extends ViewPager {
    //是否可以滑出左侧页面
    private boolean isCanGoLeft = true;
    //是否可以画出右侧页面
    private boolean isCanGoRight= true;

    public ControlViewpger(Context context) {
        super(context);
    }
    public ControlViewpger(Context context, AttributeSet attrs) {
        super(context, attrs);
    }
    public void setCanGoLeft(boolean canGoLeft) {
        isCanGoLeft = canGoLeft;
    }

    public void setCanGoRight(boolean canGoRight) {
        isCanGoRight = canGoRight;
    }
    @Override
    public boolean onInterceptTouchEvent(MotionEvent ev) {
        try {
            return super.onInterceptTouchEvent(ev);
        } catch (IllegalArgumentException ex) {
            ex.printStackTrace();
            Log.d("kid","IllegalArgumentException发生了");
        }
        return false;
    }

    private float lastX;
    private static final int LEFT_TO_RIGHT=1;//方向=从左到右
    private static final int RIGHT_TO_LEFT=2;//方向=从右到左
    //手指是否已经抬起 （如果不加入这个参数判断，在手指抬起的那一刻touch事件return了true，页面会卡在手指离开那时候的偏移位置）
    private boolean isUp=true;

    @Override
    public boolean onTouchEvent(MotionEvent event) {
        int direction=0;
        switch (event.getAction()){
            case MotionEvent.ACTION_DOWN:
                isUp=false;
                //获取起始坐标值
                lastX = event.getX();
                break;
            case MotionEvent.ACTION_MOVE:
                if(event.getX()-lastX&lt;0){//从右到左滑（左滑）
                    direction=RIGHT_TO_LEFT;
                }else {//从左到右滑（右滑）
                    direction=LEFT_TO_RIGHT;
                }
                break;
            case MotionEvent.ACTION_UP:
                isUp=true;
                break;
        }
        if(isUp){
            //手指抬起后,不再接管viewpager的事件，让它自由地滑动
            return tryCatchError(event);
        }else
        if(direction==RIGHT_TO_LEFT&amp;&amp;isCanGoRight){
            //允许滑动则应该调用父类的方法
            return tryCatchError(event);
        }else if(direction==LEFT_TO_RIGHT&amp;&amp;isCanGoLeft){
            //允许滑动则应该调用父类的方法
            return tryCatchError(event);
        }else {
            //禁止滑动则不做任何操作，直接返回true即可
            return true;
        }
    }

    /**
     * viewpager滑动偶尔莫名其妙崩溃报native,捕获异常以后，出现这种情况的时候App不会崩溃，只是卡顿那一短暂时间后继续正常操作
     * @param event
     * @return
     */
    private boolean tryCatchError(MotionEvent event){
        try {
            return super.onTouchEvent(event);
        } catch (IllegalArgumentException ex) {
            ex.printStackTrace();
            Log.d("kid","捕获浏览报错4");
        }
        return false;
    }
}
</code></pre> 
<p>根据自己业务需求，在某个时刻调用 mViewpger.setCanGoLeft 和 mViewpger.setCanGoRight， 控制viewpager当前是否可滑出左侧或右侧页面。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/03e02a07818ec2e5bcac885047318b2e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用Feign后service无法注入问题可能原因之一</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cb4f09ce95a521cb18e86d6435e7010e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Medusa(美杜莎)和Hydra(九头蛇)快速入门手册：01</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>