<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Tomcat -- 启动流程 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Tomcat -- 启动流程" />
<meta property="og:description" content="启动流程 web概念tomcat启动原理启动流程启动源码源码跟踪startup.bat 启动文件catalina.bat (bootstrap.jar)启动入口 Bootstrap.main Bootstrap初始化组件初始化Bootstrap -- bootstrap.init加载Bootstrap -- daemon.load(args)加载Catalina -- Catalina.load初始化Server -- Lifecycle.init()初始化Service -- service.init初始化Connector -- Connector.initInternal初始化ProtocolHandler初始化EndPoint -- AbstractEndpoint.init绑定Servlet Bootstrap启动启动Bootstrap -- bootstrap.start启动Catalina.start启动Server -- Lifecycle.start启动Service -- StandardService.startInternal启动Connector -- Connector.startInternal启动ProtocolHandler -- AbstractProtocol.start启动EndpointAcceptor接收器 -- socket.accept web概念 软件架构
a. C/S：客户端、服务器端架构，如微信，QQ
b. B/S：浏览器、服务器端架构，如淘宝等门户网站资源类别
a. 静态资源：所有用户访问得到的结果都一样，称为静态资源，可以直接被浏览器解析，如html、css、jpg等
b. 动态资源：每个用户访问得到的结果可能不一致，动态资源被访问后需要先转换为静态资源，再返回给浏览器，由浏览器解析，如：jsp、servlet等网络三要素
a. ip：电子设备在网络的唯一标识
b. 端口：应用程序在计算机中的唯一标识
c. 传输协议：规定数据传输的规则 tomcat启动原理 加载tomcat配置文件，初始化容器组件，监听对应的端口号，准备接受客户端请求
启动流程 启动tomcat，执行bin/startup.bat脚本，调用catalina.bat脚本执行调用BootStrap中main方法，调用init方法，通过反射创建Catalina对象及初始化类加载器main方法中调用load方法，会调用Catalina的load方法Catalina的load方法会进行Server中的一系列主键的初始化工作，并构造Digester对象，负责解析XML加载tomcat配置文件，初始化容器组件，监听对应的端口号，准备接受客户端请求 启动源码 生命周期方法（Lifecycle）
所有组件都存在初始化、启动、停止等生命周期方法，tomcat基于生命周期管理抽象成Lifecycle接口组件Server、Service、Container、Executor、Connector都实现Lifecycle，通过Lifecycle统一管理个组件的生命周期接口
○ init：初始化组件接口
○ start：启动组件接口
○ stop：停止组件接口
○ destroy：销毁组件接口 组件默认实现
源码跟踪 startup.bat 启动文件 :okHome //调用catalina." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/6e805613e15f2a6891cb7f59183bc2b6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-03T15:33:17+08:00" />
<meta property="article:modified_time" content="2022-07-03T15:33:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Tomcat -- 启动流程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>启动流程</h4> 
 <ul><li><ul><li><ul><li><a href="#web_2" rel="nofollow">web概念</a></li><li><a href="#tomcat_15" rel="nofollow">tomcat启动原理</a></li><li><ul><li><a href="#_19" rel="nofollow">启动流程</a></li><li><a href="#_26" rel="nofollow">启动源码</a></li><li><a href="#_38" rel="nofollow">源码跟踪</a></li><li><ul><li><a href="#startupbat__41" rel="nofollow">startup.bat 启动文件</a></li><li><a href="#catalinabat_bootstrapjar_67" rel="nofollow">catalina.bat (bootstrap.jar)</a></li><li><a href="#_Bootstrapmain_75" rel="nofollow">启动入口 Bootstrap.main</a></li></ul> 
     </li><li><a href="#Bootstrap_112" rel="nofollow">Bootstrap初始化组件</a></li><li><ul><li><a href="#Bootstrap__bootstrapinit_114" rel="nofollow">初始化Bootstrap -- bootstrap.init</a></li><li><a href="#Bootstrap__daemonloadargs_142" rel="nofollow">加载Bootstrap -- daemon.load(args)</a></li><li><a href="#Catalina__Catalinaload_156" rel="nofollow">加载Catalina -- Catalina.load</a></li><li><a href="#Server__Lifecycleinit_192" rel="nofollow">初始化Server -- Lifecycle.init()</a></li><li><a href="#Service__serviceinit_231" rel="nofollow">初始化Service -- service.init</a></li><li><a href="#Connector__ConnectorinitInternal_267" rel="nofollow">初始化Connector -- Connector.initInternal</a></li><li><a href="#ProtocolHandler_281" rel="nofollow">初始化ProtocolHandler</a></li><li><a href="#EndPoint__AbstractEndpointinit_294" rel="nofollow">初始化EndPoint -- AbstractEndpoint.init</a></li><li><a href="#Servlet_318" rel="nofollow">绑定Servlet</a></li></ul> 
     </li><li><a href="#Bootstrap_355" rel="nofollow">Bootstrap启动</a></li><li><ul><li><a href="#Bootstrap__bootstrapstart_356" rel="nofollow">启动Bootstrap -- bootstrap.start</a></li><li><a href="#Catalinastart_371" rel="nofollow">启动Catalina.start</a></li><li><a href="#Server__Lifecyclestart_415" rel="nofollow">启动Server -- Lifecycle.start</a></li><li><a href="#Service__StandardServicestartInternal_451" rel="nofollow">启动Service -- StandardService.startInternal</a></li><li><a href="#Connector__ConnectorstartInternal_483" rel="nofollow">启动Connector -- Connector.startInternal</a></li><li><a href="#ProtocolHandler__AbstractProtocolstart_495" rel="nofollow">启动ProtocolHandler -- AbstractProtocol.start</a></li><li><a href="#Endpoint_512" rel="nofollow">启动Endpoint</a></li><li><a href="#Acceptor__socketaccept_532" rel="nofollow">Acceptor接收器 -- socket.accept</a></li></ul> 
    </li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h4><a id="web_2"></a>web概念</h4> 
<ol><li>软件架构<br> a. C/S：客户端、服务器端架构，如微信，QQ<br> b. B/S：浏览器、服务器端架构，如淘宝等门户网站</li><li>资源类别<br> a. 静态资源：所有用户访问得到的结果都一样，称为静态资源，可以直接被浏览器解析，如html、css、jpg等<br> b. 动态资源：每个用户访问得到的结果可能不一致，动态资源被访问后需要先转换为静态资源，再返回给浏览器，由浏览器解析，如：jsp、servlet等</li><li>网络三要素<br> a. ip：电子设备在网络的唯一标识<br> b. 端口：应用程序在计算机中的唯一标识<br> c. 传输协议：规定数据传输的规则</li></ol> 
<h4><a id="tomcat_15"></a>tomcat启动原理</h4> 
<ul><li>加载tomcat配置文件，初始化容器组件，监听对应的端口号，准备接受客户端请求<br> <img src="https://images2.imgbox.com/1e/4c/fjOEHw02_o.png" alt="在这里插入图片描述"></li></ul> 
<h5><a id="_19"></a>启动流程</h5> 
<ul><li>启动tomcat，执行bin/startup.bat脚本，调用catalina.bat脚本</li><li>执行调用BootStrap中main方法，调用init方法，通过反射创建Catalina对象及初始化类加载器</li><li>main方法中调用load方法，会调用Catalina的load方法</li><li>Catalina的load方法会进行Server中的一系列主键的初始化工作，并构造Digester对象，负责解析XML</li><li>加载tomcat配置文件，初始化容器组件，监听对应的端口号，准备接受客户端请求</li></ul> 
<h5><a id="_26"></a>启动源码</h5> 
<p><strong>生命周期方法（Lifecycle）</strong></p> 
<ul><li>所有组件都存在初始化、启动、停止等生命周期方法，tomcat基于生命周期管理抽象成Lifecycle接口</li><li>组件Server、Service、Container、Executor、Connector都实现Lifecycle，通过Lifecycle统一管理个组件的生命周期接口<br> ○ init：初始化组件接口<br> ○ start：启动组件接口<br> ○ stop：停止组件接口<br> ○ destroy：销毁组件接口</li></ul> 
<p><strong>组件默认实现</strong><br> <img src="https://images2.imgbox.com/b9/0d/yhiVfSH5_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_38"></a>源码跟踪</h5> 
<p><img src="https://images2.imgbox.com/ed/34/vhtMf6aL_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="startupbat__41"></a>startup.bat 启动文件</h6> 
<pre><code class="prism language-powershell">:okHome
<span class="token operator">/</span><span class="token operator">/</span>调用catalina<span class="token punctuation">.</span>bat 
<span class="token function">set</span> <span class="token string">"EXECUTABLE=%CATALINA_HOME%\bin\catalina.bat"</span>

rem Check that target executable exists
<span class="token keyword">if</span> exist <span class="token string">"%EXECUTABLE%"</span> goto okExec
<span class="token function">echo</span> Cannot find <span class="token string">"%EXECUTABLE%"</span>
<span class="token function">echo</span> This file is needed to run this program
goto <span class="token keyword">end</span>
:okExec

rem Get remaining unshifted command line arguments and save them in the
<span class="token function">set</span> CMD_LINE_ARGS=
:setArgs
<span class="token keyword">if</span> <span class="token string">""</span><span class="token operator">%</span>1<span class="token string">""</span>==<span class="token string">""</span><span class="token string">""</span> goto doneSetArgs
<span class="token function">set</span> CMD_LINE_ARGS=<span class="token operator">%</span>CMD_LINE_ARGS% <span class="token operator">%</span>1
shift
goto setArgs
:doneSetArgs
<span class="token operator">/</span><span class="token operator">/</span>执行
call <span class="token string">"%EXECUTABLE%"</span> <span class="token function">start</span> <span class="token operator">%</span>CMD_LINE_ARGS%
:<span class="token keyword">end</span>
</code></pre> 
<h6><a id="catalinabat_bootstrapjar_67"></a>catalina.bat (bootstrap.jar)</h6> 
<pre><code class="prism language-powershell"><span class="token keyword">if</span> <span class="token string">"%CLASSPATH%"</span> == <span class="token string">""</span> goto emptyClasspath
<span class="token function">set</span> <span class="token string">"CLASSPATH=%CLASSPATH%;"</span>
:emptyClasspath
<span class="token function">set</span> <span class="token string">"CLASSPATH=%CLASSPATH%%CATALINA_HOME%\bin\bootstrap.jar"</span>
</code></pre> 
<h6><a id="_Bootstrapmain_75"></a>启动入口 Bootstrap.main</h6> 
<p>org.apache.catalina.startup.Bootstrap#main</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span> args<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>daemonLock<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//执行init方法初始化，创建Catalina对象</span>
        bootstrap<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//...</span>
        <span class="token class-name">String</span> command <span class="token operator">=</span> <span class="token string">"start"</span><span class="token punctuation">;</span>
        <span class="token comment">//...</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"startd"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            args<span class="token punctuation">[</span>args<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"start"</span><span class="token punctuation">;</span>
            daemon<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
            daemon<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"stopd"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            args<span class="token punctuation">[</span>args<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"stop"</span><span class="token punctuation">;</span>
            daemon<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"start"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            daemon<span class="token punctuation">.</span><span class="token function">setAwait</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            daemon<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
            daemon<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> daemon<span class="token punctuation">.</span><span class="token function">getServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"stop"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            daemon<span class="token punctuation">.</span><span class="token function">stopServer</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>command<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"configtest"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            daemon<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">==</span> daemon<span class="token punctuation">.</span><span class="token function">getServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="Bootstrap_112"></a>Bootstrap初始化组件</h5> 
<p>解析配置xml ：org.apache.catalina.startup.Catalina#parseServerXml</p> 
<h6><a id="Bootstrap__bootstrapinit_114"></a>初始化Bootstrap – bootstrap.init</h6> 
<ul><li>初始化ClassLoader</li><li>通过反射创建Catalina（反射解耦）</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//初始化ClassLoader</span>
    <span class="token function">initClassLoaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setContextClassLoader</span><span class="token punctuation">(</span>catalinaLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SecurityClassLoad</span><span class="token punctuation">.</span><span class="token function">securityClassLoad</span><span class="token punctuation">(</span>catalinaLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//使用自定义ClassLoader类加载器 反射创建Catalina</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> startupClass <span class="token operator">=</span> catalinaLoader<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token string">"org.apache.catalina.startup.Catalina"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Object</span> startupInstance <span class="token operator">=</span> startupClass<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> methodName <span class="token operator">=</span> <span class="token string">"setParentClassLoader"</span><span class="token punctuation">;</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> paramTypes<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    paramTypes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.lang.ClassLoader"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Object</span> paramValues<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    paramValues<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> sharedLoader<span class="token punctuation">;</span>
    <span class="token comment">//反射获取Catalina的setParentClassLoader</span>
    <span class="token class-name">Method</span> method <span class="token operator">=</span> startupInstance<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>methodName<span class="token punctuation">,</span> paramTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//设置父ClassLoader</span>
    method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>startupInstance<span class="token punctuation">,</span> paramValues<span class="token punctuation">)</span><span class="token punctuation">;</span>
    catalinaDaemon <span class="token operator">=</span> startupInstance<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

因为<span class="token class-name">Bootstrap</span>这个类在<span class="token class-name">Tomcat</span>打包发布时是放在bin\bootstrap<span class="token punctuation">.</span>jar中，
而<span class="token class-name">Catalina</span>类是放在lib\catalina<span class="token punctuation">.</span>jar中<span class="token punctuation">,</span>两个jar是用不同的<span class="token class-name">ClassLoader</span>加载的，
所以不能在<span class="token class-name">Bootstrap</span>类中直接引用<span class="token class-name">Catalina</span>类，只能通过反射。
</code></pre> 
<h6><a id="Bootstrap__daemonloadargs_142"></a>加载Bootstrap – daemon.load(args)</h6> 
<ul><li>执行Bootstrap的load方法</li><li>反射调用Catalina的load方法</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arguments<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span> methodName <span class="token operator">=</span> <span class="token string">"load"</span><span class="token punctuation">;</span>
    <span class="token comment">//....</span>
    <span class="token comment">//获取Catalina的load方法</span>
    <span class="token class-name">Method</span> method <span class="token operator">=</span> catalinaDaemon<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span>methodName<span class="token punctuation">,</span> paramTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//通过反射调用Catalina.load方法</span>
    method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>catalinaDaemon<span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="Catalina__Catalinaload_156"></a>加载Catalina – Catalina.load</h6> 
<ul><li>执行初始化</li><li>解析server.xml配置文件–parseServerXml<br> – 创建启动或者停止的xml解析器Digester</li><li>创建Server</li><li>初始化Server</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//执行初始化</span>
    <span class="token function">initDirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">initNaming</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//解析server.xml配置文件</span>
    <span class="token function">parseServerXml</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//创建Server</span>
    <span class="token class-name">Server</span> s <span class="token operator">=</span> <span class="token function">getServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//初始化Server</span>
    <span class="token function">getServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 解析server.xml</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">parseServerXml</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> start<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//....</span>
    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">ConfigurationSource<span class="token punctuation">.</span>Resource</span> resource <span class="token operator">=</span> <span class="token class-name">ConfigFileLoader</span><span class="token punctuation">.</span><span class="token function">getSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServerXml</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//创建启动或者停止的xml解析器Digester</span>
        <span class="token class-name">Digester</span> digester <span class="token operator">=</span> start <span class="token operator">?</span> <span class="token function">createStartDigester</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">createStopDigester</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//....</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"catalina.configFail"</span><span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>file<span class="token punctuation">.</span><span class="token function">canRead</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"catalina.incorrectPermissions"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h6><a id="Server__Lifecycleinit_192"></a>初始化Server – Lifecycle.init()</h6> 
<ul><li>调用抽象方法，执行具体实现，初始化</li><li>模板方法模式</li><li>执行实现的StandardServer.initInternal方法初始化Server</li><li>循环初始化Service</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">LifecycleException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>state<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">LifecycleState</span><span class="token punctuation">.</span>NEW<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">invalidTransition</span><span class="token punctuation">(</span><span class="token class-name">Lifecycle</span><span class="token punctuation">.</span>BEFORE_INIT_EVENT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">setStateInternal</span><span class="token punctuation">(</span><span class="token class-name">LifecycleState</span><span class="token punctuation">.</span>INITIALIZING<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//调用抽象方法，执行具体实现，初始化</span>
        <span class="token function">initInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">setStateInternal</span><span class="token punctuation">(</span><span class="token class-name">LifecycleState</span><span class="token punctuation">.</span>INITIALIZED<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">handleSubClassException</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">"lifecycleBase.initFail"</span><span class="token punctuation">,</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">LifecycleException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//初始化</span>
    <span class="token function">reconfigureUtilityExecutor</span><span class="token punctuation">(</span><span class="token function">getUtilityThreadsInternal</span><span class="token punctuation">(</span>utilityThreads<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">register</span><span class="token punctuation">(</span>utilityExecutor<span class="token punctuation">,</span> <span class="token string">"type=UtilityExecutor"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    onameStringCache <span class="token operator">=</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"type=StringCache"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Register the MBeanFactory</span>
    <span class="token class-name">MBeanFactory</span> factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MBeanFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    factory<span class="token punctuation">.</span><span class="token function">setContainer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    onameMBeanFactory <span class="token operator">=</span> <span class="token function">register</span><span class="token punctuation">(</span>factory<span class="token punctuation">,</span> <span class="token string">"type=MBeanFactory"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    globalNamingResources<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//循环初始化Service</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Service</span> service <span class="token operator">:</span> services<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        service<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="Service__serviceinit_231"></a>初始化Service – service.init</h6> 
<ul><li>同初始化Server，模板方法调用 Lifecycle.init()</li><li>调用StandardService.initInternal方法</li><li>初始化Engine引擎</li><li>初始化Executor线程连接池<br> ○ tomcat线程池与jdk线程池区别<br> ○ tomcat自定义TaskQueue, 默认队列大小是无限大队列,<br> ○ tomcat重写了offer入队方法,<br> ○ 如果线程池线程数量小于线程池最大线程池,则入队失败(会直接开启非核心线程接收请求,而非入队)</li><li>初始化监听器</li><li>初始化Connector连接器</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">LifecycleException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//初始化Engine引擎</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>engine <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        engine<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//初始化Executor线程池</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Executor</span> executor <span class="token operator">:</span> <span class="token function">findExecutors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>executor <span class="token keyword">instanceof</span> <span class="token class-name">JmxEnabled</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">JmxEnabled</span><span class="token punctuation">)</span> executor<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDomain</span><span class="token punctuation">(</span><span class="token function">getDomain</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        executor<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 初始化监听器</span>
    mapperListener<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//初始化Connector连接器</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>connectorsLock<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Connector</span> connector <span class="token operator">:</span> connectors<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            connector<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="Connector__ConnectorinitInternal_267"></a>初始化Connector – Connector.initInternal</h6> 
<ul><li>初始化CoyoteAdapter适配器</li><li>初始化ProtocolHandler</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">LifecycleException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 初始化CoyoteAdapter</span>
    adapter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CoyoteAdapter</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    protocolHandler<span class="token punctuation">.</span><span class="token function">setAdapter</span><span class="token punctuation">(</span>adapter<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//....</span>
    <span class="token comment">//初始化ProtocolHandler</span>
    protocolHandler<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="ProtocolHandler_281"></a>初始化ProtocolHandler</h6> 
<ul><li>初始化EndPoint</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//....</span>
    <span class="token class-name">String</span> endpointName <span class="token operator">=</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    endpoint<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>endpointName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> endpointName<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    endpoint<span class="token punctuation">.</span><span class="token function">setDomain</span><span class="token punctuation">(</span>domain<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//初始化EndPoint</span>
    endpoint<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="EndPoint__AbstractEndpointinit_294"></a>初始化EndPoint – AbstractEndpoint.init</h6> 
<ul><li>绑定Servlet</li><li>注册EndPoint</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bindOnInit<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//绑定Servlet相关能力</span>
        <span class="token function">bindWithCleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bindState <span class="token operator">=</span> <span class="token class-name">BindState</span><span class="token punctuation">.</span>BOUND_ON_INIT<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>domain <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 注册EndPoint</span>
        oname <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectName</span><span class="token punctuation">(</span>domain <span class="token operator">+</span> <span class="token string">":type=ThreadPool,name=\""</span> <span class="token operator">+</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Registry</span><span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">registerComponent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> oname<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ObjectName</span> socketPropertiesOname <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectName</span><span class="token punctuation">(</span>domain <span class="token operator">+</span> <span class="token string">":type=SocketProperties,name=\""</span> <span class="token operator">+</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        socketProperties<span class="token punctuation">.</span><span class="token function">setObjectName</span><span class="token punctuation">(</span>socketPropertiesOname<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Registry</span><span class="token punctuation">.</span><span class="token function">getRegistry</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">registerComponent</span><span class="token punctuation">(</span>socketProperties<span class="token punctuation">,</span> socketPropertiesOname<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SSLHostConfig</span> sslHostConfig <span class="token operator">:</span> <span class="token function">findSslHostConfigs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">registerJmx</span><span class="token punctuation">(</span>sslHostConfig<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="Servlet_318"></a>绑定Servlet</h6> 
<ul><li>初始化ServerSocket</li><li>初始化SSL</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//初始化ServerSocket</span>
    <span class="token function">initServerSocket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">setStopLatch</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//初始化SSL</span>
    <span class="token function">initialiseSsl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    selectorPool<span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//初始化ServerSocket</span>
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">initServerSocket</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">getUseInheritedChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        serverSock <span class="token operator">=</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">.</span><span class="token keyword">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        socketProperties<span class="token punctuation">.</span><span class="token function">setProperties</span><span class="token punctuation">(</span>serverSock<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">InetSocketAddress</span> addr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InetSocketAddress</span><span class="token punctuation">(</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getPortWithOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        serverSock<span class="token punctuation">.</span><span class="token function">socket</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span><span class="token function">getAcceptCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Channel</span> ic <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">inheritedChannel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ic <span class="token keyword">instanceof</span> <span class="token class-name">ServerSocketChannel</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            serverSock <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ServerSocketChannel</span><span class="token punctuation">)</span> ic<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>serverSock <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"endpoint.init.bind.inherited"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    serverSock<span class="token punctuation">.</span><span class="token function">configureBlocking</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//mimic APR behavior</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="Bootstrap_355"></a>Bootstrap启动</h5> 
<h6><a id="Bootstrap__bootstrapstart_356"></a>启动Bootstrap – bootstrap.start</h6> 
<ul><li>如果没有初始化，则在此初始化</li><li>反射调用Catalina的start方法</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//如果没有初始化，则在此初始化</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>catalinaDaemon <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token comment">//反射调用Catalina的start方法</span>
    <span class="token class-name">Method</span> method <span class="token operator">=</span> catalinaDaemon<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"start"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Class</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>catalinaDaemon<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">Object</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="Catalinastart_371"></a>启动Catalina.start</h6> 
<ul><li>启动Server</li><li>启动失败则销毁Server</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//启动Server</span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">getServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">LifecycleException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//启动失败则销毁</span>
            <span class="token function">getServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">LifecycleException</span> e1<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"destroy() failed for failed Server "</span><span class="token punctuation">,</span> e1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>generateCode<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// Generate loader which will load all generated classes</span>
        <span class="token function">generateLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Register shutdown hook</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>useShutdownHook<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>shutdownHook <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            shutdownHook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CatalinaShutdownHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addShutdownHook</span><span class="token punctuation">(</span>shutdownHook<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">LogManager</span> logManager <span class="token operator">=</span> <span class="token class-name">LogManager</span><span class="token punctuation">.</span><span class="token function">getLogManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>logManager <span class="token keyword">instanceof</span> <span class="token class-name">ClassLoaderLogManager</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ClassLoaderLogManager</span><span class="token punctuation">)</span> logManager<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setUseShutdownHook</span><span class="token punctuation">(</span>
                <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>await<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="Server__Lifecyclestart_415"></a>启动Server – Lifecycle.start</h6> 
<ul><li>调用抽象方法，执行具体实现，初始化</li><li>模板方法模式</li><li>执行实现的StandardServer.startInternal方法启动Server</li><li>循环启动Service</li></ul> 
<pre><code class="prism language-java">
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">LifecycleException</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">//....</span>
    <span class="token function">setStateInternal</span><span class="token punctuation">(</span><span class="token class-name">LifecycleState</span><span class="token punctuation">.</span>STARTING_PREP<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//</span>
    <span class="token function">startInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">startInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">LifecycleException</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">//循环启动service</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>servicesLock<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Service</span> service <span class="token operator">:</span> services<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            service<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>periodicEventDelay <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        monitorFuture <span class="token operator">=</span> <span class="token function">getUtilityExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scheduleWithFixedDelay</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token function">startPeriodicLifecycleEvent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="Service__StandardServicestartInternal_451"></a>启动Service – StandardService.startInternal</h6> 
<ul><li>启动Engine引擎</li><li>启动Executor线程连接池</li><li>启动监听器</li><li>启动Connector连接器</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">startInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">LifecycleException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 启动Engine引擎</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>engine <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>engine<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            engine<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
	<span class="token comment">//启动Executor线程连接池</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>executors<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Executor</span> executor<span class="token operator">:</span> executors<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            executor<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
	<span class="token comment">//启动监听器</span>
    mapperListener<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//启动Connector连接器</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>connectorsLock<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Connector</span> connector<span class="token operator">:</span> connectors<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>connector<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token class-name">LifecycleState</span><span class="token punctuation">.</span>FAILED<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                connector<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="Connector__ConnectorstartInternal_483"></a>启动Connector – Connector.startInternal</h6> 
<ul><li>设置状态</li><li>启动ProtocolHandler</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">startInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">LifecycleException</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">//设置状态</span>
    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token class-name">LifecycleState</span><span class="token punctuation">.</span>STARTING<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//启动ProtocolHandler</span>
    protocolHandler<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="ProtocolHandler__AbstractProtocolstart_495"></a>启动ProtocolHandler – AbstractProtocol.start</h6> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//启动Endpoint</span>
    endpoint<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    monitorFuture <span class="token operator">=</span> <span class="token function">getUtilityExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">scheduleWithFixedDelay</span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isPaused</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token function">startAsyncTimeout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="Endpoint_512"></a>启动Endpoint</h6> 
<ul><li>初始化连接</li><li>启动接收的线程</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>bindState <span class="token operator">==</span> <span class="token class-name">BindState</span><span class="token punctuation">.</span>UNBOUND<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">bindWithCleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        bindState <span class="token operator">=</span> <span class="token class-name">BindState</span><span class="token punctuation">.</span>BOUND_ON_START<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">startInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">startInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">//初始化连接</span>
    <span class="token function">initializeConnectionLatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//启动接收的线程</span>
    <span class="token function">startAcceptorThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="Acceptor__socketaccept_532"></a>Acceptor接收器 – socket.accept</h6> 
<ul><li>实现Runnable</li><li>run方法接收客户端请求</li><li>socket.accept监听接收客户端请求</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Acceptor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//接收客户端请求</span>
        socket <span class="token operator">=</span> endpoint<span class="token punctuation">.</span><span class="token function">serverSocketAccept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//socket.accept监听接收客户端请求</span>
<span class="token keyword">protected</span> <span class="token class-name">SocketChannel</span> <span class="token function">serverSocketAccept</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> serverSock<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>参考资源： <a href="https://www.bilibili.com/video/BV1dJ411N7Um?p=12" rel="nofollow">Java进阶教程Tomcat核心原理解析</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f03caddec01a82eb1da104ac0fca28a0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">matlab线性与非线性规划问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c12db0a9d9045c342d587b64af5d31d4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【无标题】Vue3之script-setup全面解析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>