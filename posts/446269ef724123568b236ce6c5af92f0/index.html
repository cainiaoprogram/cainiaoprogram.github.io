<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python优雅重启谷歌游览器并过cf - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Python优雅重启谷歌游览器并过cf" />
<meta property="og:description" content="python如何优雅的重启谷歌游览器？ 代码很简单：
import subprocess homepage = &#34;about:blank&#34; # 结束已经启动的谷歌游览器 subprocess.run(&#34;taskkill /f /im chrome.exe&#34;, shell=True) # debug启动谷歌游览器 subprocess.run([&#34;start&#34;, &#34;chrome&#34;, homepage, &#34;--remote-debugging-port=9222&#34;], shell=True) 注意：shell=True是必须的，因为start是命令行的命令。
为什么start命令可以直接启动谷歌？ 经过测试，在命令行中执行&#34;chrome&#34;提示找不到，但执行&#34;start chrome&#34;却能够顺利的启动：
&gt;chrome &#39;chrome&#39; 不是内部或外部命令，也不是可运行的程序或批处理文件。 &gt;start chrome &gt; 在Windows中直接执行，会在当前目录和环境变量中查找，但是start启动的机制却有所区别，start不仅会在当前目录和环境变量中查找命令，还会在注册表HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\和HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\
中查找命令。
之所以start chrome可以直接启动谷歌就是因为注册表\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\chrome.exe的存在，我们也可以通过读取该注册表获取谷歌游览器的位置：
import winreg key = winreg.OpenKey(winreg.HKEY_LOCAL_MACHINE, &#34;SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\chrome.exe&#34;) chrome_path = winreg.QueryValue(key, &#34;&#34;) chrome_path &#39;C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe&#39; 还可以获取谷歌游览器的两个位置是\HKEY_CLASSES_ROOT\Applications\chrome.exe\shell\open\command的值和HKEY_CLASSES_ROOT\ChromeHTML\Application的ApplicationIcon项，但它们需要对字符串进行额外处理。
如何优雅的过cf？ 方案1： 重启谷歌游览器后，等待一段时间后，再自动化工具接管游览器
from selenium import webdriver import subprocess # from selenium.webdriver.support import expected_conditions as EC # from selenium." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/446269ef724123568b236ce6c5af92f0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-06T15:59:17+08:00" />
<meta property="article:modified_time" content="2023-12-06T15:59:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python优雅重启谷歌游览器并过cf</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="python_0"></a>python如何优雅的重启谷歌游览器？</h2> 
<p>代码很简单：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> subprocess

homepage <span class="token operator">=</span> <span class="token string">"about:blank"</span>
<span class="token comment"># 结束已经启动的谷歌游览器</span>
subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">"taskkill /f /im chrome.exe"</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># debug启动谷歌游览器</span>
subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"start"</span><span class="token punctuation">,</span> <span class="token string">"chrome"</span><span class="token punctuation">,</span> homepage<span class="token punctuation">,</span>
               <span class="token string">"--remote-debugging-port=9222"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>注意：<code>shell=True</code>是必须的，因为start是命令行的命令。</p> 
</blockquote> 
<h2><a id="start_17"></a>为什么start命令可以直接启动谷歌？</h2> 
<p>经过测试，在命令行中执行"chrome"提示找不到，但执行"start chrome"却能够顺利的启动：</p> 
<pre><code>&gt;chrome
'chrome' 不是内部或外部命令，也不是可运行的程序或批处理文件。
&gt;start chrome
&gt;
</code></pre> 
<p>在Windows中直接执行，会在当前目录和环境变量中查找，但是start启动的机制却有所区别，start不仅会在当前目录和环境变量中查找命令，还会在注册表<code>HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\</code>和<code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\</code></p> 
<p>中查找命令。</p> 
<p>之所以<code>start chrome</code>可以直接启动谷歌就是因为注册表<code>\HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\chrome.exe</code>的存在，我们也可以通过读取该注册表获取谷歌游览器的位置：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> winreg

key <span class="token operator">=</span> winreg<span class="token punctuation">.</span>OpenKey<span class="token punctuation">(</span>winreg<span class="token punctuation">.</span>HKEY_LOCAL_MACHINE<span class="token punctuation">,</span>
                     <span class="token string">"SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\chrome.exe"</span><span class="token punctuation">)</span>
chrome_path <span class="token operator">=</span> winreg<span class="token punctuation">.</span>QueryValue<span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
chrome_path
</code></pre> 
<pre><code>'C:\\Program Files\\Google\\Chrome\\Application\\chrome.exe'
</code></pre> 
<p>还可以获取谷歌游览器的两个位置是<code>\HKEY_CLASSES_ROOT\Applications\chrome.exe\shell\open\command</code>的值和<code>HKEY_CLASSES_ROOT\ChromeHTML\Application</code>的<code>ApplicationIcon</code>项，但它们需要对字符串进行额外处理。</p> 
<h2><a id="cf_49"></a>如何优雅的过cf？</h2> 
<p><strong>方案1：</strong> 重启谷歌游览器后，等待一段时间后，再自动化工具接管游览器</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">import</span> subprocess
<span class="token comment"># from selenium.webdriver.support import expected_conditions as EC</span>
<span class="token comment"># from selenium.webdriver.support.ui import WebDriverWait</span>
<span class="token comment"># from selenium.webdriver.common.by import By</span>
<span class="token keyword">import</span> time

url <span class="token operator">=</span> <span class="token string">"https://cf地址/"</span>
<span class="token comment"># 结束已经启动的谷歌游览器</span>
subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">"taskkill /f /im chrome.exe"</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># debug启动谷歌</span>
subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"start"</span><span class="token punctuation">,</span> <span class="token string">"chrome"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span>
               <span class="token string">"--remote-debugging-port=9222"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># 等待cf通过</span>
time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token comment"># 接管已经经过cf验证的游览器</span>
option <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span>
option<span class="token punctuation">.</span>add_experimental_option<span class="token punctuation">(</span><span class="token string">"debuggerAddress"</span><span class="token punctuation">,</span> <span class="token string">"127.0.0.1:9222"</span><span class="token punctuation">)</span>
browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>options<span class="token operator">=</span>option<span class="token punctuation">)</span>
browser
</code></pre> 
<p>实际等待时间，根据网页实际情况来。cf往往有一个5秒盾的概念，所以等待6秒以上是合适的，然后根据网站本身的延迟增加时间。</p> 
<p>如果你觉得10秒等待太久，希望手动告诉游览器cf已经通过，可以查看方案2。</p> 
<p><strong>方案2：</strong> 代码启动谷歌游览器后，等待谷歌游览器关闭，再重新启动谷歌并接管。</p> 
<p>对于cf站，只要经过检测后往往都有缓存，不会再次进入检测，所以方案2有效，但是需要先获取谷歌游览器的位置再启动谷歌。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
<span class="token keyword">import</span> subprocess
<span class="token comment"># from selenium.webdriver.support import expected_conditions as EC</span>
<span class="token comment"># from selenium.webdriver.support.ui import WebDriverWait</span>
<span class="token comment"># from selenium.webdriver.common.by import By</span>
<span class="token keyword">import</span> time
<span class="token keyword">import</span> winreg

key <span class="token operator">=</span> winreg<span class="token punctuation">.</span>OpenKey<span class="token punctuation">(</span>winreg<span class="token punctuation">.</span>HKEY_LOCAL_MACHINE<span class="token punctuation">,</span>
                     <span class="token string">"SOFTWARE\Microsoft\Windows\CurrentVersion\App Paths\chrome.exe"</span><span class="token punctuation">)</span>
chrome_path <span class="token operator">=</span> winreg<span class="token punctuation">.</span>QueryValue<span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>

url <span class="token operator">=</span> <span class="token string">"https://steamdb.info/"</span>
<span class="token comment"># 结束已经启动的谷歌游览器</span>
subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">"taskkill /f /im chrome.exe"</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># 启动谷歌</span>
process <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span><span class="token punctuation">[</span>chrome_path<span class="token punctuation">,</span> url<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 等待用户手动关闭游览器，用户等待cf通过再关闭游览器即可</span>
process<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># debug启动谷歌</span>
subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span><span class="token punctuation">[</span>chrome_path<span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token string">"--remote-debugging-port=9222"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 接管debug游览器</span>
option <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span>
option<span class="token punctuation">.</span>add_experimental_option<span class="token punctuation">(</span><span class="token string">"debuggerAddress"</span><span class="token punctuation">,</span> <span class="token string">"127.0.0.1:9222"</span><span class="token punctuation">)</span>
browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>options<span class="token operator">=</span>option<span class="token punctuation">)</span>
browser
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ee553fe8928ed0ed140cad67770bbcb5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Spring 面试题——事务</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/15943455475e1fea578b26a68f357d9e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">R语言学习</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>