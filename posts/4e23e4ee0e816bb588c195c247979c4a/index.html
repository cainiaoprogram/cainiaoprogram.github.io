<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【数据处理】数据集划分、打乱(shuffle)、以及keras里K-折交叉验证 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【数据处理】数据集划分、打乱(shuffle)、以及keras里K-折交叉验证" />
<meta property="og:description" content="前言 在进行机器学习的时候，本质上都是在训练模型，而训练模型都离不开对数据集的处理。往往在模型表现不佳或难以再提升的情况下，进行一定的处理，科学的训练会使模型再更进一步。
目录 前言1 数据集划分1.1 常规理解1.2 自己理解 2 打乱(shuffle)2.1 numpy里的shuffle2.2 keras里的shuffle2.3 sklearn里的shuffle ★2.4 代码(2.1和2.3两种) 3 keras里进行K-折交叉验证3.1 K-折交叉验证3.2 keras模型实现K折交叉验证3.3 完整代码 1 数据集划分 1.1 常规理解 这是老生常谈的问题，但理论和实践还是会有偏差。理论上，数据集可划分为三类，训练集、验证集和测试集。引用cnn网络为什么有时验证集会和训练集一起参与训练？的一个理解，这三者的关系就如同刷题、模拟考和高考。刷题不能刷到模拟考题目，那模拟考直接起飞，高考题目不准看，看了考的分数就是假分数。
下面开始盗图，参考训练集、验证集、测试集划分，从图中可以看出各部分之间的关系，其中训练集和测试集是大家经常听到的，而验证集在图中归属于训练集，这也是导致验证集和测试集经常混淆的点。
参考中还给了不同数据集大小的情况下划分比例。
1.2 自己理解 自己其实在之前的博客中也经常搞混，现在来说下自己的理解，不一定正确。其实我认为，在写论文、打比赛的时候，我们主要划分的还是训练集与验证集，测试集不属于考虑范围，或者认为测试集和验证集是一个东西。以打比赛为例，我们拿到了比赛的数据集，然后自己进行了数据集划分，对于模型训练来说，数据量一般越多越好，所以我们是划分训练集与验证集，在验证集效果较好时，再把验证集也拿去训练。那测试集呢？测试集其实是比赛官方拿出一部分数据集出来，用它来评估你的模型。因此对于比赛选手来说，专门拿出测试集来仅进行测试是不利的，而一旦测试完又拿去训练，那就变成验证集了。所以，我认为只有真正在工业环境下，才需要进行严格的划分。
2 打乱(shuffle) 既然有数据集的划分，那么就少不了随机打乱。因为原本的数据集有可能是有序的，如果正例集中在前面，负例集中在后面，那么便会导致验证集或测试集会出现大部分是负例的情况。很有可能导致负例训练效果不佳，模型整体性能变差。此外，就算不是有序的，打乱也会显得更为“公平”，也给模型提升多一份机会。(即随机划分出的某个数据集可能更能代表整体数据(包括未收集到的数据))。
那么接下来介绍shuffle的几种方式：numpy shuffle、keras fit里的shuffle以及sklearn shuffle。
当你的数据集比较简单的时候，如特征与标签在一个numpy矩阵中，那么可以直接选用numpy里的shuffle。以鸢尾花数据集为例，该数据集本身是有序的，部分数据如下所示。
2.1 numpy里的shuffle 该方法适合简单的矩阵，且特征和标签未分开。如果是分开的，还要先合并再拆开。
# In[*] shuffle in numpy def shuffle_np(X,Y): Y = Y.reshape(len(Y),1) data = np.concatenate([X,Y],axis=-1) np.random.seed(1337) np.random.shuffle(data) print(data) X = data[:,:-1] Y = data[:,-1] return X,Y 部分效果。
2.2 keras里的shuffle 可参考Keras model.fit()参数详解，要注意这里的shuffle的解释是:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/4e23e4ee0e816bb588c195c247979c4a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-06-27T16:11:16+08:00" />
<meta property="article:modified_time" content="2020-06-27T16:11:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【数据处理】数据集划分、打乱(shuffle)、以及keras里K-折交叉验证</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>前言</h2> 
<p>  在进行机器学习的时候，本质上都是在训练模型，而训练模型都离不开对数据集的处理。往往在模型表现不佳或难以再提升的情况下，进行一定的处理，科学的训练会使模型再更进一步。<br> </p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_0" rel="nofollow">前言</a></li><li><a href="#1__3" rel="nofollow">1 数据集划分</a></li><li><ul><li><a href="#11__4" rel="nofollow">1.1 常规理解</a></li><li><a href="#12__12" rel="nofollow">1.2 自己理解</a></li></ul> 
  </li><li><a href="#2_shuffle_14" rel="nofollow">2 打乱(shuffle)</a></li><li><ul><li><a href="#21_numpyshuffle_19" rel="nofollow">2.1 numpy里的shuffle</a></li><li><a href="#22_kerasshuffle_35" rel="nofollow">2.2 keras里的shuffle</a></li><li><a href="#23_sklearnshuffle__39" rel="nofollow">2.3 sklearn里的shuffle ★</a></li><li><a href="#24_2123_46" rel="nofollow">2.4 代码(2.1和2.3两种)</a></li></ul> 
  </li><li><a href="#3_kerasK_108" rel="nofollow">3 keras里进行K-折交叉验证</a></li><li><ul><li><a href="#31_K_109" rel="nofollow">3.1 K-折交叉验证</a></li><li><a href="#32_kerasK_112" rel="nofollow">3.2 keras模型实现K折交叉验证</a></li><li><a href="#33__155" rel="nofollow">3.3 完整代码</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="1__3"></a>1 数据集划分</h2> 
<h3><a id="11__4"></a>1.1 常规理解</h3> 
<p>  这是老生常谈的问题，但理论和实践还是会有偏差。理论上，数据集可划分为三类，<strong>训练集</strong>、<strong>验证集</strong>和<strong>测试集</strong>。引用<a href="https://www.baidu.com/link?url=RYDAWHigKH1NSaGvbRpKKm0B9pyDHV6aBxSOmLk-Ixs0qb1nn9j2cnN4wRjX-mTLeyM4ouq8InilvW2KuHKbjK&amp;wd=&amp;eqid=f7ed6d13003500e4000000065ef6af95" rel="nofollow">cnn网络为什么有时验证集会和训练集一起参与训练？</a>的一个理解，这三者的关系就如同<strong>刷题</strong>、<strong>模拟考</strong>和<strong>高考</strong>。刷题不能刷到模拟考题目，那模拟考直接起飞，高考题目不准看，看了考的分数就是假分数。<br>   下面开始盗图，参考<a href="https://blog.csdn.net/u010916338/article/details/92585641">训练集、验证集、测试集划分</a>，从图中可以看出各部分之间的关系，其中训练集和测试集是大家经常听到的，而验证集在图中归属于训练集，这也是导致验证集和测试集经常混淆的点。<br> <img src="https://images2.imgbox.com/4f/e0/GwVO1i2d_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/03/21/Patmqb5c_o.png" alt="在这里插入图片描述"><br>   参考中还给了不同数据集大小的情况下划分比例。<br> <img src="https://images2.imgbox.com/28/b6/gdWrD7rt_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/03/cf/CzfOssBh_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="12__12"></a>1.2 自己理解</h3> 
<p>  自己其实在之前的博客中也经常搞混，现在来说下自己的理解，不一定正确。其实我认为，在写论文、打比赛的时候，我们主要划分的还是训练集与验证集，测试集不属于考虑范围，或者认为测试集和验证集是一个东西。以打比赛为例，我们拿到了比赛的数据集，然后自己进行了数据集划分，对于模型训练来说，数据量一般越多越好，所以我们是划分训练集与验证集，在验证集效果较好时，再把验证集也拿去训练。那测试集呢？测试集其实是比赛官方拿出一部分数据集出来，用它来评估你的模型。因此对于比赛选手来说，专门拿出测试集来仅进行测试是不利的，而一旦测试完又拿去训练，那就变成验证集了。所以，我认为只有真正在工业环境下，才需要进行严格的划分。</p> 
<h2><a id="2_shuffle_14"></a>2 打乱(shuffle)</h2> 
<p>  既然有数据集的划分，那么就少不了随机打乱。因为原本的数据集有可能是有序的，如果正例集中在前面，负例集中在后面，那么便会导致验证集或测试集会出现大部分是负例的情况。很有可能导致负例训练效果不佳，模型整体性能变差。此外，就算不是有序的，打乱也会显得更为“公平”，也给模型提升多一份机会。(即随机划分出的某个数据集可能更能代表整体数据(包括未收集到的数据))。<br>   那么接下来介绍shuffle的几种方式：numpy shuffle、keras fit里的shuffle以及sklearn shuffle。<br>   当你的数据集比较简单的时候，如特征与标签在一个numpy矩阵中，那么可以直接选用numpy里的shuffle。以鸢尾花数据集为例，该数据集本身是有序的，部分数据如下所示。<br> <img src="https://images2.imgbox.com/49/00/8GKiyaI0_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="21_numpyshuffle_19"></a>2.1 numpy里的shuffle</h3> 
<p>  该方法适合简单的矩阵，且特征和标签未分开。如果是分开的，还要先合并再拆开。</p> 
<pre><code class="prism language-python"><span class="token comment"># In[*] shuffle in numpy</span>
<span class="token keyword">def</span> <span class="token function">shuffle_np</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Y <span class="token operator">=</span> Y<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>Y<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">[</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">]</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">1337</span><span class="token punctuation">)</span>
    np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    X <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    Y <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> X<span class="token punctuation">,</span>Y
</code></pre> 
<p>  部分效果。<br> <img src="https://images2.imgbox.com/61/fc/N5VHkYpu_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="22_kerasshuffle_35"></a>2.2 keras里的shuffle</h3> 
<p>  可参考<a href="https://blog.csdn.net/weixin_40161254/article/details/102519416">Keras model.fit()参数详解</a>，要注意这里的shuffle的解释是:<br> <img src="https://images2.imgbox.com/1b/43/wkqDFf17_o.png" alt="在这里插入图片描述"><br>   但由于这是封闭的，看不到shuffle后的结果。其次，有很多博客说这个函数是个坑参考<a href="https://blog.csdn.net/zhzhx1204/article/details/77394093">[keras中文文档笔记6——使用陷阱]</a>，因为fit函数往往先执行了validation_split再执行shuffle,参考<a href="https://cloud.tencent.com/developer/article/1437999" rel="nofollow">[【私人笔记】深度学习框架keras踩坑记]</a>，意味着数据先被分割了再打乱，那么这个“打乱”可能并不能达到我们想要的效果，即仍会有负例全被分割在验证集，导致训练效果不佳的出现。</p> 
<h3><a id="23_sklearnshuffle__39"></a>2.3 sklearn里的shuffle ★</h3> 
<p>  这个是目前我接触到最好用的shuffle，因为它既可以如2.1一样，打乱一个矩阵，也可以同时打乱两个变量组成的特征与标签，而且随机种子也集成了，总之就是省事。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>utils <span class="token keyword">import</span> shuffle
X<span class="token punctuation">,</span>Y <span class="token operator">=</span> shuffle<span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">1337</span><span class="token punctuation">)</span> 
</code></pre> 
<p><img src="https://images2.imgbox.com/32/76/cwfLnrVr_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="24_2123_46"></a>2.4 代码(2.1和2.3两种)</h3> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn <span class="token keyword">import</span> datasets
<span class="token keyword">from</span> keras<span class="token punctuation">.</span>layers <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> keras<span class="token punctuation">.</span>backend <span class="token keyword">as</span> K
<span class="token keyword">from</span> keras <span class="token keyword">import</span> Model
<span class="token keyword">from</span> keras<span class="token punctuation">.</span>utils <span class="token keyword">import</span> plot_model<span class="token punctuation">,</span>to_categorical
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> keras<span class="token punctuation">.</span>utils <span class="token keyword">import</span> plot_model
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>utils <span class="token keyword">import</span> shuffle
<span class="token comment"># In[*] get data </span>
iris <span class="token operator">=</span> datasets<span class="token punctuation">.</span>load_iris<span class="token punctuation">(</span><span class="token punctuation">)</span>
X <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>iris<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>iris<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># In[*] shuffle in numpy</span>
<span class="token keyword">def</span> <span class="token function">shuffle_np</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Y <span class="token operator">=</span> Y<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>Y<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">[</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">]</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">1337</span><span class="token punctuation">)</span>
    np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    X <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    Y <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> X<span class="token punctuation">,</span>Y

<span class="token comment"># In[*] shuffle in sklearn</span>
<span class="token keyword">def</span> <span class="token function">shuffle_skl</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    X<span class="token punctuation">,</span>Y <span class="token operator">=</span> shuffle<span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">1337</span><span class="token punctuation">)</span> 
    <span class="token keyword">print</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">)</span>
    <span class="token keyword">return</span> X<span class="token punctuation">,</span>Y

<span class="token comment"># In[*] build model</span>
<span class="token keyword">def</span> <span class="token function">build_model</span><span class="token punctuation">(</span>fea_cnt<span class="token punctuation">,</span>numb<span class="token punctuation">)</span><span class="token punctuation">:</span>
    K<span class="token punctuation">.</span>clear_session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#清除之前的模型，省得压满内存</span>
    inputs <span class="token operator">=</span> Input<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">(</span>fea_cnt<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
    embds <span class="token operator">=</span> Dense<span class="token punctuation">(</span><span class="token number">32</span> <span class="token punctuation">,</span>activation<span class="token operator">=</span><span class="token string">'selu'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>inputs<span class="token punctuation">)</span>
    outputs <span class="token operator">=</span> Dense<span class="token punctuation">(</span>numb<span class="token punctuation">,</span>activation<span class="token operator">=</span><span class="token string">'softmax'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>embds<span class="token punctuation">)</span>
    
    model <span class="token operator">=</span> Model<span class="token punctuation">(</span>inputs<span class="token operator">=</span>inputs<span class="token punctuation">,</span> outputs<span class="token operator">=</span>outputs<span class="token punctuation">)</span>
    model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>loss<span class="token operator">=</span><span class="token string">'sparse_categorical_crossentropy'</span><span class="token punctuation">,</span> optimizer <span class="token operator">=</span> <span class="token string">'sgd'</span><span class="token punctuation">,</span> metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'accuracy'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span>summary<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> model

<span class="token comment"># In[*] train model</span>
fea_cnt <span class="token operator">=</span> <span class="token number">4</span>
numb <span class="token operator">=</span> <span class="token number">3</span>
model <span class="token operator">=</span> build_model<span class="token punctuation">(</span>fea_cnt<span class="token punctuation">,</span>numb<span class="token punctuation">)</span>
epochs <span class="token operator">=</span> <span class="token number">12</span> 
batch_size <span class="token operator">=</span> <span class="token number">4</span>

<span class="token comment">#X,Y = shuffle_np(X,Y)</span>
X<span class="token punctuation">,</span>Y <span class="token operator">=</span> shuffle_skl<span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">)</span>

model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y
          <span class="token punctuation">,</span>batch_size <span class="token operator">=</span> batch_size
          <span class="token punctuation">,</span>epochs <span class="token operator">=</span> epochs
          <span class="token punctuation">,</span>validation_split<span class="token operator">=</span> <span class="token number">0.2</span>
        <span class="token punctuation">)</span>
plot_model<span class="token punctuation">(</span>model<span class="token punctuation">,</span> to_file<span class="token operator">=</span><span class="token string">'./model.png'</span><span class="token punctuation">,</span>show_shapes<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>dpi<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">)</span> <span class="token comment">#输出框架图</span>
</code></pre> 
<h2><a id="3_kerasK_108"></a>3 keras里进行K-折交叉验证</h2> 
<h3><a id="31_K_109"></a>3.1 K-折交叉验证</h3> 
<p>  稍微看一下概念会觉得很好理解，数据集拆成<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         K 
        
       
      
        K 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.07153em;">K</span></span></span></span></span>分，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         K 
        
       
         − 
        
       
         1 
        
       
      
        K-1 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.76666em; vertical-align: -0.08333em;"></span><span class="mord mathdefault" style="margin-right: 0.07153em;">K</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span></span></span></span></span>训练，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         1 
        
       
      
        1 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span></span></span></span></span>验证，轮换着组合，共有<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          C 
         
        
          K 
         
         
         
           K 
          
         
           − 
          
         
           1 
          
         
        
       
         = 
        
        
        
          C 
         
        
          K 
         
        
          1 
         
        
       
         = 
        
       
         K 
        
       
      
        C_{K}^{K-1}=C_{K}^1=K 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.17499em; vertical-align: -0.293531em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.881462em;"><span class="" style="top: -2.40647em; margin-left: -0.07153em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.07153em;">K</span></span></span></span><span class="" style="top: -3.10313em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.07153em;">K</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.293531em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.08944em; vertical-align: -0.275331em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.07153em;">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -2.42467em; margin-left: -0.07153em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.07153em;">K</span></span></span></span><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.275331em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.07153em;">K</span></span></span></span></span>次，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         K 
        
       
      
        K 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.07153em;">K</span></span></span></span></span>一般取5，10。但是更深刻的问题来了，最后得到的是1个模型还是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         K 
        
       
      
        K 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.07153em;">K</span></span></span></span></span>个模型？最终模型与<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         K 
        
       
      
        K 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.07153em;">K</span></span></span></span></span>次训练的模型之间是什么关系？是直接选最好的吗？参考<a href="https://www.zhihu.com/question/29350545?sort=created" rel="nofollow">求解神经网络做十字交叉验证k=10，这种方法到底是得到十个模型还是一个模型。?</a><br>   我的理解是，一方面，K-折交叉验证目的是为了验证模型的性能，即避免实验出现的偶然性，用K次结果的平均值来代表此次模型的整体性能。另一方面，K-折最后K次的指标总会有高有低，那么我们可以选最优的那一个数据集的划分作为最终的划分，与shuffle一样，最优的数据集的划分说不定有更好的泛化效果。</p> 
<h3><a id="32_kerasK_112"></a>3.2 keras模型实现K折交叉验证</h3> 
<p>  值得注意的是kfold也有shuffle参数，因此可以直接用。同样，这里仅展示快速实现，因此还是用鸢尾花，尽管这个数据量太少，训练出的模型不稳定。</p> 
<pre><code class="prism language-python"><span class="token comment"># In[*] train model</span>
fea_cnt <span class="token operator">=</span> <span class="token number">4</span>
numb <span class="token operator">=</span> <span class="token number">3</span>
epochs <span class="token operator">=</span> <span class="token number">12</span> 
batch_size <span class="token operator">=</span> <span class="token number">4</span>
seed <span class="token operator">=</span> <span class="token number">1337</span>

<span class="token comment">#X,Y = shuffle_np(X,Y)</span>
<span class="token comment">#X,Y = shuffle_skl(X,Y)</span>

kfold <span class="token operator">=</span> StratifiedKFold<span class="token punctuation">(</span>n_splits<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span>seed<span class="token punctuation">)</span>
scores <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> train<span class="token punctuation">,</span> test <span class="token keyword">in</span> kfold<span class="token punctuation">.</span>split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> build_model<span class="token punctuation">(</span>fea_cnt<span class="token punctuation">,</span>numb<span class="token punctuation">)</span>
    train_x <span class="token operator">=</span> X<span class="token punctuation">[</span>train<span class="token punctuation">]</span>
    train_y <span class="token operator">=</span> Y<span class="token punctuation">[</span>train<span class="token punctuation">]</span>
    test_x <span class="token operator">=</span> X<span class="token punctuation">[</span>test<span class="token punctuation">]</span>
    test_y <span class="token operator">=</span> Y<span class="token punctuation">[</span>test<span class="token punctuation">]</span>
    
    h <span class="token operator">=</span> model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x <span class="token punctuation">,</span>train_y
          <span class="token punctuation">,</span>batch_size <span class="token operator">=</span> <span class="token number">64</span>
          <span class="token punctuation">,</span>epochs <span class="token operator">=</span> epochs
          <span class="token punctuation">,</span>validation_data<span class="token operator">=</span><span class="token punctuation">(</span>test_x<span class="token punctuation">,</span>test_y<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    scores<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>h<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">"loss"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>h<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">"acc"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                   h<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">"val_loss"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>h<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">"val_acc"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

scores <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>scores<span class="token punctuation">)</span>
scores <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>scores<span class="token punctuation">,</span>axis<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment">#print(scores)</span>
labs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"loss"</span><span class="token punctuation">,</span><span class="token string">"acc"</span><span class="token punctuation">,</span><span class="token string">"val_loss"</span><span class="token punctuation">,</span><span class="token string">"val_acc"</span><span class="token punctuation">]</span>
result <span class="token operator">=</span> <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token punctuation">[</span>l<span class="token operator">+</span><span class="token string">'_mean'</span> <span class="token keyword">for</span> l <span class="token keyword">in</span> labs<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>s<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">for</span> s <span class="token keyword">in</span> scores<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token keyword">for</span> res <span class="token keyword">in</span> result<span class="token punctuation">]</span>
<span class="token punctuation">[</span>plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>scores<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>label<span class="token operator">=</span>labs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>scores<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">'eval'</span><span class="token operator">+</span><span class="token string">'.png'</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span>bbox_inches <span class="token operator">=</span> <span class="token string">'tight'</span><span class="token punctuation">)</span> <span class="token comment">#bbox_inches可完整显示</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>  结果:<br> <img src="https://images2.imgbox.com/75/e4/B42Uzgog_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="33__155"></a>3.3 完整代码</h3> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn <span class="token keyword">import</span> datasets
<span class="token keyword">from</span> keras<span class="token punctuation">.</span>layers <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> keras<span class="token punctuation">.</span>backend <span class="token keyword">as</span> K
<span class="token keyword">from</span> keras <span class="token keyword">import</span> Model
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>utils <span class="token keyword">import</span> shuffle
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> StratifiedKFold
<span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt
<span class="token comment"># In[*] get data </span>
iris <span class="token operator">=</span> datasets<span class="token punctuation">.</span>load_iris<span class="token punctuation">(</span><span class="token punctuation">)</span>
X <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>iris<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
Y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>iris<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># In[*] shuffle in numpy</span>
<span class="token keyword">def</span> <span class="token function">shuffle_np</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Y <span class="token operator">=</span> Y<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>Y<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">[</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">]</span><span class="token punctuation">,</span>axis<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">1337</span><span class="token punctuation">)</span>
    np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token comment">#    print(data)</span>
    X <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    Y <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> X<span class="token punctuation">,</span>Y

<span class="token comment"># In[*] shuffle in sklearn</span>
<span class="token keyword">def</span> <span class="token function">shuffle_skl</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    X<span class="token punctuation">,</span>Y <span class="token operator">=</span> shuffle<span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">1337</span><span class="token punctuation">)</span> 
<span class="token comment">#    print(X,Y)</span>
    <span class="token keyword">return</span> X<span class="token punctuation">,</span>Y

<span class="token comment"># In[*] build model</span>
<span class="token keyword">def</span> <span class="token function">build_model</span><span class="token punctuation">(</span>fea_cnt<span class="token punctuation">,</span>numb<span class="token punctuation">)</span><span class="token punctuation">:</span>
    K<span class="token punctuation">.</span>clear_session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">#清除之前的模型，省得压满内存</span>
    inputs <span class="token operator">=</span> Input<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">(</span>fea_cnt<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'float32'</span><span class="token punctuation">)</span>
    embds <span class="token operator">=</span> Dense<span class="token punctuation">(</span><span class="token number">32</span> <span class="token punctuation">,</span>activation<span class="token operator">=</span><span class="token string">'selu'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>inputs<span class="token punctuation">)</span>
    outputs <span class="token operator">=</span> Dense<span class="token punctuation">(</span>numb<span class="token punctuation">,</span>activation<span class="token operator">=</span><span class="token string">'softmax'</span><span class="token punctuation">)</span><span class="token punctuation">(</span>embds<span class="token punctuation">)</span>
    
    model <span class="token operator">=</span> Model<span class="token punctuation">(</span>inputs<span class="token operator">=</span>inputs<span class="token punctuation">,</span> outputs<span class="token operator">=</span>outputs<span class="token punctuation">)</span>
    model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>loss<span class="token operator">=</span><span class="token string">'sparse_categorical_crossentropy'</span><span class="token punctuation">,</span> optimizer <span class="token operator">=</span> <span class="token string">'sgd'</span><span class="token punctuation">,</span> metrics<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'accuracy'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment">#    model.summary()</span>
    <span class="token keyword">return</span> model

<span class="token comment"># In[*] train model</span>
fea_cnt <span class="token operator">=</span> <span class="token number">4</span>
numb <span class="token operator">=</span> <span class="token number">3</span>
epochs <span class="token operator">=</span> <span class="token number">12</span> 
batch_size <span class="token operator">=</span> <span class="token number">4</span>
seed <span class="token operator">=</span> <span class="token number">1337</span>

<span class="token comment">#X,Y = shuffle_np(X,Y)</span>
<span class="token comment">#X,Y = shuffle_skl(X,Y)</span>

kfold <span class="token operator">=</span> StratifiedKFold<span class="token punctuation">(</span>n_splits<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span>seed<span class="token punctuation">)</span>
scores <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> train<span class="token punctuation">,</span> test <span class="token keyword">in</span> kfold<span class="token punctuation">.</span>split<span class="token punctuation">(</span>X<span class="token punctuation">,</span> Y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model <span class="token operator">=</span> build_model<span class="token punctuation">(</span>fea_cnt<span class="token punctuation">,</span>numb<span class="token punctuation">)</span>
    train_x <span class="token operator">=</span> X<span class="token punctuation">[</span>train<span class="token punctuation">]</span>
    train_y <span class="token operator">=</span> Y<span class="token punctuation">[</span>train<span class="token punctuation">]</span>
    test_x <span class="token operator">=</span> X<span class="token punctuation">[</span>test<span class="token punctuation">]</span>
    test_y <span class="token operator">=</span> Y<span class="token punctuation">[</span>test<span class="token punctuation">]</span>
    
    h <span class="token operator">=</span> model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_x <span class="token punctuation">,</span>train_y
          <span class="token punctuation">,</span>batch_size <span class="token operator">=</span> <span class="token number">64</span>
          <span class="token punctuation">,</span>epochs <span class="token operator">=</span> epochs
          <span class="token punctuation">,</span>validation_data<span class="token operator">=</span><span class="token punctuation">(</span>test_x<span class="token punctuation">,</span>test_y<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    scores<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>h<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">"loss"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>h<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">"acc"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                   h<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">"val_loss"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>h<span class="token punctuation">.</span>history<span class="token punctuation">[</span><span class="token string">"val_acc"</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

scores <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>scores<span class="token punctuation">)</span>
scores <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>scores<span class="token punctuation">,</span>axis<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token comment">#print(scores)</span>
labs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"loss"</span><span class="token punctuation">,</span><span class="token string">"acc"</span><span class="token punctuation">,</span><span class="token string">"val_loss"</span><span class="token punctuation">,</span><span class="token string">"val_acc"</span><span class="token punctuation">]</span>
result <span class="token operator">=</span> <span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token punctuation">[</span>l<span class="token operator">+</span><span class="token string">'_mean'</span> <span class="token keyword">for</span> l <span class="token keyword">in</span> labs<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>s<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">for</span> s <span class="token keyword">in</span> scores<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span> <span class="token keyword">for</span> res <span class="token keyword">in</span> result<span class="token punctuation">]</span>
<span class="token punctuation">[</span>plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>scores<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>label<span class="token operator">=</span>labs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>scores<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">'eval'</span><span class="token operator">+</span><span class="token string">'.png'</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span>bbox_inches <span class="token operator">=</span> <span class="token string">'tight'</span><span class="token punctuation">)</span> <span class="token comment">#bbox_inches可完整显示</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9763dcecbaf4d5859d216fc7f06ff199/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">R的randomForestSRC包做生存分析（用随机生存森林做生存分析）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/48ab06bc8c02a8733c94bb05807dbb3b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">读源码学MYSQL系列（二）decimal存储转化函数decimal2bin</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>