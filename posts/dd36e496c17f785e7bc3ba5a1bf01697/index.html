<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>entity framework 6 自己编写的通用数据类 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="entity framework 6 自己编写的通用数据类" />
<meta property="og:description" content="public class BaseDAL { string strConn = &#34;&#34;; public BaseDAL(string connString) { strConn = connString; } #region 通用增删改查 #region 非原始sql语句方式 /// &lt;summary&gt; /// 新增 /// &lt;/summary&gt; /// &lt;param name=&#34;entity&#34;&gt;实体&lt;/param&gt; /// &lt;returns&gt;返回受影响行数&lt;/returns&gt; public bool Add&lt;T&gt;(T entity) where T : class { using (SysDb&lt;T&gt; db = new SysDb&lt;T&gt;(strConn)) { db.Entry&lt;T&gt;(entity).State = EntityState.Added; return db.SaveChanges() &gt; 0; } } /// &lt;summary&gt; /// 修改 /// &lt;/summary&gt; /// &lt;param name=&#34;entity&#34;&gt;实体&lt;/param&gt; /// &lt;returns&gt;返回受影响行数&lt;/returns&gt; public bool Update&lt;T&gt;(T entity) where T : class { using (SysDb&lt;T&gt; db = new SysDb&lt;T&gt;(strConn)) { db." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/dd36e496c17f785e7bc3ba5a1bf01697/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-05-13T18:03:10+08:00" />
<meta property="article:modified_time" content="2014-05-13T18:03:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">entity framework 6 自己编写的通用数据类</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <pre><code class="language-csharp"> public class BaseDAL
    {
        string strConn = "";
        public BaseDAL(string connString)
        {
            strConn = connString;
        }

        #region 通用增删改查
        #region 非原始sql语句方式
        /// &lt;summary&gt;
        /// 新增
        /// &lt;/summary&gt;
        /// &lt;param name="entity"&gt;实体&lt;/param&gt;
        /// &lt;returns&gt;返回受影响行数&lt;/returns&gt;
        public bool Add&lt;T&gt;(T entity) where T : class
        {
            using (SysDb&lt;T&gt; db = new SysDb&lt;T&gt;(strConn))
            {
                db.Entry&lt;T&gt;(entity).State = EntityState.Added;
                return db.SaveChanges() &gt; 0;
            }
        }

        /// &lt;summary&gt;
        /// 修改
        /// &lt;/summary&gt;
        /// &lt;param name="entity"&gt;实体&lt;/param&gt;
        /// &lt;returns&gt;返回受影响行数&lt;/returns&gt;
        public bool Update&lt;T&gt;(T entity) where T : class
        {
            using (SysDb&lt;T&gt; db = new SysDb&lt;T&gt;(strConn))
            {
                db.Set&lt;T&gt;().Attach(entity);
                db.Entry&lt;T&gt;(entity).State = EntityState.Modified;
                return db.SaveChanges() &gt; 0;
            }
        }

        /// &lt;summary&gt;
        /// 删除
        /// &lt;/summary&gt;
        /// &lt;param name="entity"&gt;实体&lt;/param&gt;
        /// &lt;returns&gt;返回受影响行数&lt;/returns&gt;
        public bool Delete&lt;T&gt;(T entity) where T : class
        {
            using (SysDb&lt;T&gt; db = new SysDb&lt;T&gt;(strConn))
            {
                db.Set&lt;T&gt;().Attach(entity);
                db.Entry&lt;T&gt;(entity).State = EntityState.Deleted;
                return db.SaveChanges() &gt; 0;
            }
        }

        /// &lt;summary&gt;
        /// 根据条件删除
        /// &lt;/summary&gt;
        /// &lt;param name="deleWhere"&gt;删除条件&lt;/param&gt;
        /// &lt;returns&gt;返回受影响行数&lt;/returns&gt;
        public bool DeleteByConditon&lt;T&gt;(Expression&lt;Func&lt;T, bool&gt;&gt; deleWhere) where T : class
        {
            using (SysDb&lt;T&gt; db = new SysDb&lt;T&gt;(strConn))
            {
                List&lt;T&gt; entitys = db.Set&lt;T&gt;().Where(deleWhere).ToList();
                entitys.ForEach(m =&gt; db.Entry&lt;T&gt;(m).State = EntityState.Deleted);
                return db.SaveChanges() &gt; 0;
            }
        }

        /// &lt;summary&gt;
        /// 查找单个
        /// &lt;/summary&gt;
        /// &lt;param name="id"&gt;主键&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public T GetSingleById&lt;T&gt;(int id) where T : class
        {
            using (SysDb&lt;T&gt; db = new SysDb&lt;T&gt;(strConn))
            {
                return db.Set&lt;T&gt;().Find(id);
            }
        }

        /// &lt;summary&gt;
        /// 查找单个
        /// &lt;/summary&gt;
        /// &lt;param name="seleWhere"&gt;查询条件&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public T GetSingle&lt;T&gt;(Expression&lt;Func&lt;T, bool&gt;&gt; seleWhere) where T : class
        {
            using (SysDb&lt;T&gt; db = new SysDb&lt;T&gt;(strConn))
            {
                return db.Set&lt;T&gt;().AsExpandable().FirstOrDefault(seleWhere);
            }
        }

        /// &lt;summary&gt;
        /// 获取所有实体集合
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public List&lt;T&gt; GetAll&lt;T&gt;() where T : class
        {
            using (SysDb&lt;T&gt; db = new SysDb&lt;T&gt;(strConn))
            {
                return db.Set&lt;T&gt;().AsExpandable().ToList&lt;T&gt;();
            }
        }

        /// &lt;summary&gt;
        /// 获取所有实体集合(单个排序)
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public List&lt;T&gt; GetAll&lt;T, Tkey&gt;(Expression&lt;Func&lt;T, Tkey&gt;&gt; orderWhere, bool isDesc) where T : class
        {
            using (SysDb&lt;T&gt; db = new SysDb&lt;T&gt;(strConn))
            {
                return CommonSort(db.Set&lt;T&gt;().AsExpandable(), orderWhere, isDesc).ToList&lt;T&gt;();
            }
        }

        /// &lt;summary&gt;
        /// 获取所有实体集合(多个排序)
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public List&lt;T&gt; GetAll&lt;T&gt;(params OrderModelField[] orderByExpression) where T : class
        {
            using (SysDb&lt;T&gt; db = new SysDb&lt;T&gt;(strConn))
            {
                return CommonSort(db.Set&lt;T&gt;().AsExpandable(), orderByExpression).ToList();
            }
        }

        /// &lt;summary&gt;
        /// 单个排序通用方法
        /// &lt;/summary&gt;
        /// &lt;typeparam name="Tkey"&gt;排序字段&lt;/typeparam&gt;
        /// &lt;param name="data"&gt;要排序的数据&lt;/param&gt;
        /// &lt;param name="orderWhere"&gt;排序条件&lt;/param&gt;
        /// &lt;param name="isDesc"&gt;是否倒序&lt;/param&gt;
        /// &lt;returns&gt;排序后的集合&lt;/returns&gt;
        public IQueryable&lt;T&gt; CommonSort&lt;T, Tkey&gt;(IQueryable&lt;T&gt; data, Expression&lt;Func&lt;T, Tkey&gt;&gt; orderWhere, bool isDesc) where T : class
        {
            if (isDesc)
            {
                return data.OrderByDescending(orderWhere);
            }
            else
            {
                return data.OrderBy(orderWhere);
            }
        }

        /// &lt;summary&gt;
        /// 多个排序通用方法
        /// &lt;/summary&gt;
        /// &lt;typeparam name="Tkey"&gt;排序字段&lt;/typeparam&gt;
        /// &lt;param name="data"&gt;要排序的数据&lt;/param&gt;
        /// &lt;param name="orderWhereAndIsDesc"&gt;字典集合(排序条件,是否倒序)&lt;/param&gt;
        /// &lt;returns&gt;排序后的集合&lt;/returns&gt;
        public IQueryable&lt;T&gt; CommonSort&lt;T&gt;(IQueryable&lt;T&gt; data, params OrderModelField[] orderByExpression) where T : class
        {
            //创建表达式变量参数
            var parameter = Expression.Parameter(typeof(T), "o");

            if (orderByExpression != null &amp;&amp; orderByExpression.Length &gt; 0)
            {
                for (int i = 0; i &lt; orderByExpression.Length; i++)
                {
                    //根据属性名获取属性
                    var property = typeof(T).GetProperty(orderByExpression[i].PropertyName);
                    //创建一个访问属性的表达式
                    var propertyAccess = Expression.MakeMemberAccess(parameter, property);
                    var orderByExp = Expression.Lambda(propertyAccess, parameter);

                    string OrderName = "";
                    if (i &gt; 0)
                    {
                        OrderName = orderByExpression[i].IsDESC ? "ThenByDescending" : "ThenBy";
                    }
                    else
                        OrderName = orderByExpression[i].IsDESC ? "OrderByDescending" : "OrderBy";

                    MethodCallExpression resultExp = Expression.Call(typeof(Queryable), OrderName, new Type[] { typeof(T), property.PropertyType },
                        data.Expression, Expression.Quote(orderByExp));

                    data = data.Provider.CreateQuery&lt;T&gt;(resultExp);
                }
            }
            return data;
        }

        /// &lt;summary&gt;
        /// 根据条件查询实体集合
        /// &lt;/summary&gt;
        /// &lt;param name="seleWhere"&gt;查询条件 lambel表达式&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public List&lt;T&gt; GetList&lt;T&gt;(Expression&lt;Func&lt;T, bool&gt;&gt; seleWhere) where T : class
        {
            using (SysDb&lt;T&gt; db = new SysDb&lt;T&gt;(strConn))
            {
                return db.Set&lt;T&gt;().AsExpandable().Where(seleWhere).ToList();
            }
        }

        /// &lt;summary&gt;
        /// 根据条件查询实体集合
        /// &lt;/summary&gt;
        /// &lt;param name="seleWhere"&gt;查询条件 lambel表达式&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public List&lt;T&gt; GetList&lt;T, TValue&gt;(Expression&lt;Func&lt;T, TValue&gt;&gt; seleWhere, IEnumerable&lt;TValue&gt; conditions) where T : class
        {
            using (SysDb&lt;T&gt; db = new SysDb&lt;T&gt;(strConn))
            {

                return db.Set&lt;T&gt;().AsExpandable().WhereIn&lt;T, TValue&gt;(seleWhere, conditions).ToList();
            }
        }

        /// &lt;summary&gt;
        /// 根据条件查询实体集合(单个字段排序)
        /// &lt;/summary&gt;
        /// &lt;param name="seleWhere"&gt;查询条件 lambel表达式&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public List&lt;T&gt; GetList&lt;T, Tkey&gt;(Expression&lt;Func&lt;T, bool&gt;&gt; seleWhere, Expression&lt;Func&lt;T, Tkey&gt;&gt; orderWhere, bool isDesc) where T : class
        {
            using (SysDb&lt;T&gt; db = new SysDb&lt;T&gt;(strConn))
            {
                return CommonSort(db.Set&lt;T&gt;().AsExpandable().Where(seleWhere), orderWhere, isDesc).ToList();
            }
        }

        /// &lt;summary&gt;
        /// 根据条件查询实体集合(多个字段排序)
        /// &lt;/summary&gt;
        /// &lt;param name="seleWhere"&gt;查询条件 lambel表达式&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public List&lt;T&gt; GetList&lt;T&gt;(Expression&lt;Func&lt;T, bool&gt;&gt; seleWhere, params OrderModelField[] orderByExpression) where T : class
        {
            using (SysDb&lt;T&gt; db = new SysDb&lt;T&gt;(strConn))
            {
                return CommonSort(db.Set&lt;T&gt;().AsExpandable().Where(seleWhere), orderByExpression).ToList();
            }
        }

        /// &lt;summary&gt;
        /// 获取分页集合(无条件无排序)
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public List&lt;T&gt; GetListPaged&lt;T, Tkey&gt;(int pageIndex, int pageSize, out int totalcount) where T : class
        {
            using (SysDb&lt;T&gt; db = new SysDb&lt;T&gt;(strConn))
            {
                totalcount = db.Set&lt;T&gt;().AsExpandable().Count();//获取总数
                //需要增加AsExpandable(),否则查询的是所有数据到内存，然后再排序  AsExpandable是linqkit.dll中的方法
                return db.Set&lt;T&gt;().AsExpandable().Skip((pageIndex - 1) * pageSize).Take(pageSize).ToList();
            }
        }

        /// &lt;summary&gt;
        /// 获取分页集合(无条件单个排序)
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public List&lt;T&gt; GetListPaged&lt;T, Tkey&gt;(int pageIndex, int pageSize, Expression&lt;Func&lt;T, Tkey&gt;&gt; orderWhere, bool isDesc, out int totalcount) where T : class
        {
            using (SysDb&lt;T&gt; db = new SysDb&lt;T&gt;(strConn))
            {
                totalcount = db.Set&lt;T&gt;().AsExpandable().Count();//获取总数
                //需要增加AsExpandable(),否则查询的是所有数据到内存，然后再排序  AsExpandable是linqkit.dll中的方法
                return CommonSort(db.Set&lt;T&gt;().AsExpandable(), orderWhere, isDesc).Skip((pageIndex - 1) * pageSize).Take(pageSize).ToList();
            }
        }

        /// &lt;summary&gt;
        /// 获取分页集合(无条件多字段排序)
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public List&lt;T&gt; GetListPaged&lt;T&gt;(int pageIndex, int pageSize, out int totalcount, params OrderModelField[] orderByExpression) where T : class
        {
            using (SysDb&lt;T&gt; db = new SysDb&lt;T&gt;(strConn))
            {
                totalcount = db.Set&lt;T&gt;().AsExpandable().Count();//获取总数
                //需要增加AsExpandable(),否则查询的是所有数据到内存，然后再排序  AsExpandable是linqkit.dll中的方法
                return CommonSort(db.Set&lt;T&gt;().AsExpandable(), orderByExpression).Skip((pageIndex - 1) * pageSize).Take(pageSize).ToList();
            }
        }

        /// &lt;summary&gt;
        /// 获取分页集合(有条件无排序)
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public List&lt;T&gt; GetListPaged&lt;T, Tkey&gt;(int pageIndex, int pageSize, Expression&lt;Func&lt;T, bool&gt;&gt; seleWhere, out int totalcount) where T : class
        {
            using (SysDb&lt;T&gt; db = new SysDb&lt;T&gt;(strConn))
            {
                totalcount = db.Set&lt;T&gt;().AsExpandable().Where(seleWhere).Count();//获取总数
                //需要增加AsExpandable(),否则查询的是所有数据到内存，然后再排序  AsExpandable是linqkit.dll中的方法
                return db.Set&lt;T&gt;().AsExpandable().Where(seleWhere).Skip((pageIndex - 1) * pageSize).Take(pageSize).ToList();
            }
        }

        /// &lt;summary&gt;
        /// 获取分页集合(有条件单个排序)
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public List&lt;T&gt; GetListPaged&lt;T, Tkey&gt;(int pageIndex, int pageSize, Expression&lt;Func&lt;T, bool&gt;&gt; seleWhere,
            Expression&lt;Func&lt;T, Tkey&gt;&gt; orderWhere, bool isDesc, out int totalcount) where T : class
        {
            using (SysDb&lt;T&gt; db = new SysDb&lt;T&gt;(strConn))
            {
                totalcount = db.Set&lt;T&gt;().AsExpandable().Where(seleWhere).Count();//获取总数
                //需要增加AsExpandable(),否则查询的是所有数据到内存，然后再排序  AsExpandable是linqkit.dll中的方法
                return CommonSort(db.Set&lt;T&gt;().AsExpandable().Where(seleWhere), orderWhere, isDesc).Skip((pageIndex - 1) * pageSize).Take(pageSize).ToList();
            }
        }

        /// &lt;summary&gt;
        /// 获取分页集合(有条件多字段排序)
        /// &lt;/summary&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public List&lt;T&gt; GetListPaged&lt;T&gt;(int pageIndex, int pageSize, Expression&lt;Func&lt;T, bool&gt;&gt; seleWhere,
            out int totalcount, params OrderModelField[] orderModelFiled) where T : class
        {
            using (SysDb&lt;T&gt; db = new SysDb&lt;T&gt;(strConn))
            {
                totalcount = db.Set&lt;T&gt;().AsExpandable().Where(seleWhere).Count();//获取总数
                //需要增加AsExpandable(),否则查询的是所有数据到内存，然后再排序  AsExpandable是linqkit.dll中的方法
                return CommonSort(db.Set&lt;T&gt;().AsExpandable().Where(seleWhere), orderModelFiled).Skip((pageIndex - 1) * pageSize).Take(pageSize).ToList();
            }
        }
        #endregion

        #region 原始sql操作
        /// &lt;summary&gt;
        /// 执行操作
        /// &lt;/summary&gt;
        /// &lt;param name="sql"&gt;&lt;/param&gt;
        /// &lt;param name="paras"&gt;&lt;/param&gt;
        public void ExecuteSql(string sql, params object[] paras)
        {
            using (SysDb db = new SysDb(strConn))
            {
                db.Database.ExecuteSqlCommand(sql, paras);
            }
        }

        /// &lt;summary&gt;
        /// 查询列表
        /// &lt;/summary&gt;
        /// &lt;typeparam name="T"&gt;&lt;/typeparam&gt;
        /// &lt;param name="sql"&gt;&lt;/param&gt;
        /// &lt;param name="paras"&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public List&lt;T&gt; QueryList&lt;T&gt;(string sql, params object[] paras) where T : class
        {
            using (SysDb db = new SysDb(strConn))
            {
                return db.Database.SqlQuery&lt;T&gt;(sql, paras).ToList();
            }
        }

        /// &lt;summary&gt;
        /// 查询单个
        /// &lt;/summary&gt;
        /// &lt;typeparam name="T"&gt;&lt;/typeparam&gt;
        /// &lt;param name="sql"&gt;&lt;/param&gt;
        /// &lt;param name="paras"&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public T QuerySingle&lt;T&gt;(string sql, params object[] paras) where T : class
        {
            using (SysDb&lt;T&gt; db = new SysDb&lt;T&gt;(strConn))
            {
                return db.Database.SqlQuery&lt;T&gt;(sql, paras).FirstOrDefault();
            }
        }

        /// &lt;summary&gt;
        /// 执行事务
        /// &lt;/summary&gt;
        /// &lt;param name="lsSql"&gt;&lt;/param&gt;
        /// &lt;param name="lsParas"&gt;&lt;/param&gt;
        public void ExecuteTransaction(List&lt;String&gt; lsSql, List&lt;Object[]&gt; lsParas)
        {
            using (SysDb db = new SysDb(strConn))
            {
                using (var tran = db.Database.BeginTransaction())
                {
                    try
                    {
                        for (int i = 0; i &lt; lsSql.Count; i++)
                        {
                            if (lsParas != null &amp;&amp; lsParas.Count &gt; 0)
                            {
                                db.Database.ExecuteSqlCommand(lsSql[i], lsParas[i]);
                            }
                        }
                        foreach (String item in lsSql)
                        {
                            db.Database.ExecuteSqlCommand(item);
                        }

                        tran.Commit();
                    }
                    catch (Exception ex)
                    {
                        tran.Rollback();
                        throw ex;
                    }
                }
            }
        }
        #endregion
        #endregion

        #region 通用属性
        /// &lt;summary&gt;
        /// 获取数据库服务器当前时间。
        /// &lt;/summary&gt;
        public DateTime ServerTime
        {
            get
            {
                using (SysDb db = new SysDb(strConn))
                {
                    String sql = "SELECT GETDATE()";
                    Object objServerTime = db.Database.SqlQuery&lt;Object&gt;(sql);
                    return Convert.ToDateTime(objServerTime);
                }
            }
        }

        /// &lt;summary&gt;
        /// 获取数据库版本。
        /// &lt;/summary&gt;
        public String DatabaseVersion
        {
            get
            {
                using (SysDb db = new SysDb(strConn))
                {
                    try
                    {
                        String sql = "SELECT Version FROM Sys_Version";
                        Object objServerTime = db.Database.SqlQuery&lt;Object&gt;(sql);
                        return Convert.ToString(objServerTime);
                    }
                    catch
                    {
                    }
                    return String.Empty;
                }
            }
        }
        #endregion

    }
    public static class QueryableExtension
    {
        /// &lt;summary&gt;
        /// 扩展方法  支持 in 操作
        /// &lt;/summary&gt;
        /// &lt;typeparam name="TEntity"&gt;需要扩展的对象类型&lt;/typeparam&gt;
        /// &lt;typeparam name="TValue"&gt;in 的值类型&lt;/typeparam&gt;
        /// &lt;param name="source"&gt;需要扩展的对象&lt;/param&gt;
        /// &lt;param name="valueSelector"&gt;值选择器 例如c=&gt;c.UserId&lt;/param&gt;
        /// &lt;param name="values"&gt;值集合&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static IQueryable&lt;TEntity&gt; WhereIn&lt;TEntity, TValue&gt;(this IQueryable&lt;TEntity&gt; source, Expression&lt;Func&lt;TEntity, TValue&gt;&gt; valueSelector,
                IEnumerable&lt;TValue&gt; values)
        {
            if (null == valueSelector) { throw new ArgumentNullException("valueSelector"); }
            if (null == values) { throw new ArgumentNullException("values"); }
            ParameterExpression p = valueSelector.Parameters.Single();

            if (!values.Any())
            {
                return source;
            }
            var equals = values.Select(value =&gt; (Expression)Expression.Equal(valueSelector.Body, Expression.Constant(value, typeof(TValue))));
            var body = equals.Aggregate&lt;Expression&gt;((accumulate, equal) =&gt; Expression.Or(accumulate, equal));
            return source.Where(Expression.Lambda&lt;Func&lt;TEntity, bool&gt;&gt;(body, p));
        }
    }
    public struct OrderModelField
    {

        public bool IsDESC { get; set; }
        public string PropertyName { get; set; }
    }</code></pre> 
<p>dbcontext类：</p> 
<pre><code class="language-csharp">    public class SysDb : DbContext
    {
        bool isNew = true;//是否是新的sql执行
        string strMsg = "";//sql执行的相关信息
        string strConn = "";//数据库连接字符串
        string UserName = "";//日志用户名称
        string AdditionalInfo = "";//日志额外信息
        public SysDb(string connString) : // 数据库链接字符串
            base(connString)
        {
            strConn = connString;
            Database.SetInitializer&lt;SysDb&gt;(null);//设置为空，防止自动检查和生成
            base.Database.Log = (info) =&gt; Debug.WriteLine(info);
        }

        public SysDb(string connString, string logUserName, string logAdditionalInfo) : // 数据库链接字符串
            base(connString)
        {
            strConn = connString;
            Database.SetInitializer&lt;SysDb&gt;(null);//设置为空，防止自动检查和生成
            UserName = logUserName;
            AdditionalInfo = logAdditionalInfo;
            base.Database.Log = AddLogger;
        }

        protected override void OnModelCreating(DbModelBuilder modelBuilder)
        {
            //去掉复数映射
            modelBuilder.Conventions.Remove&lt;PluralizingTableNameConvention&gt;();
            base.OnModelCreating(modelBuilder);
        }

        /// &lt;summary&gt;
        /// 添加日志
        /// &lt;/summary&gt;
        /// &lt;param name="info"&gt;&lt;/param&gt;
        public void AddLogger(string info)
        {
            if (info != "\r\n" &amp;&amp; (!info.Contains("Sys_EventLog")))
            {
                string strTemp = info.ToUpper().Trim();
                if (isNew)
                {
                    //记录增删改
                    if (strTemp.StartsWith("INSERT") || strTemp.StartsWith("UPDATE") || strTemp.StartsWith("DELETE"))
                    {
                        strMsg = info;
                        isNew = false;
                    }
                }
                else
                {
                    if (strTemp.StartsWith("CLOSED CONNECTION"))
                    {
                        //增加新日志
                        using (SysDb db = new SysDb(strConn))
                        {
                            try
                            {
				//保存日志到数据库或其他地方

                            }
                            catch (Exception ex)
                            {
                                using (System.IO.StreamWriter sw = new System.IO.StreamWriter(AppDomain.CurrentDomain.BaseDirectory + "//logError.txt"))
                                {
                                    sw.Write(ex.Message);
                                    sw.Flush();
                                }
                            }
                        }
                        //清空
                        strMsg = "";
                        isNew = true;
                    }
                    else
                    {
                        strMsg += info;
                    }
                }

            }
        }

        
    }
    public class SysDb&lt;T&gt; : SysDb where T : class
    {
        public SysDb(string connString) : // 数据库链接字符串
            base(connString)
        {
            Database.SetInitializer&lt;SysDb&lt;T&gt;&gt;(null);//设置为空，防止自动检查和生成
        }

        public SysDb(string connString, string logUserName, string logAdditionalInfo) : // 数据库链接字符串
            base(connString,logUserName,logAdditionalInfo)
        {
            Database.SetInitializer&lt;SysDb&lt;T&gt;&gt;(null);//设置为空，防止自动检查和生成
        }

        public DbSet&lt;T&gt; Entities { get; set; }
    }</code></pre> 
<p><br> </p> 
<p>界面使用：（bll层忽略）</p> 
<p></p> 
<pre><code class="language-csharp"> public class BusinessController : Controller
    {
        //
        // GET: /Jygl/Business/
        BaseBLL basebll = new BaseBLL(WebHelper.Conn);

        public ActionResult GetXMList(int page,int rows)
        {
            int count = 0;
            //查询条件
            //Expression&lt;Func&lt;JY_XM, bool&gt;&gt; searchPredicate = PredicateBuilder.True&lt;JY_XM&gt;();
            //searchPredicate = searchPredicate.And(c =&gt; c.UserName.Contains(""));
            Expression&lt;Func&lt;JY_XM, int&gt;&gt; keySelector = u =&gt; u.UID;
            string str = ExceptionHelper&lt;JY_XM&gt;.TryCatchPageQueryJson&lt;int&gt;(basebll.GetListPaged, page, rows, keySelector, false, out count);
            return Content(str); 
        }

        [HttpPost]
        public ActionResult XMEdit(JY_XM jyxm)
        {
            basebll.Add(jyxm);
            return View();
        }

        public ActionResult GetAllGCLB()
        {

            List&lt;DICT_GCLB&gt; lsGCLB = basebll.GetAll&lt;DICT_GCLB&gt;();
            DICT_GCLB dicNew=new DICT_GCLB();
            dicNew.GCLBText="-请选择-";
            dicNew.GCLBId=0;
            lsGCLB.Add(dicNew);

            return Content(WebHelper.Json(lsGCLB));
        }

        public ActionResult GetAllArea()
        {
            List&lt;DICT_Area&gt; lsArea = basebll.GetAll&lt;DICT_Area&gt;();
            DICT_Area dicNew=new DICT_Area();
            dicNew.AreaText="-请选择-";
            dicNew.AreaId=0;
            lsArea.Add(dicNew);
            return Content(WebHelper.Json(lsArea));
        }
    }</code></pre> 
<br> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p><br> </p> 
<p>个人原创，欢迎转载，尊重劳动成果，引用注明来源。</p> 
<p><a target="_blank" href="http://blog.csdn.net/laokaizzz/article/details/25730813" rel="noopener noreferrer">http://blog.csdn.net/laokaizzz/article/details/25730813</a><br> </p> 
<p><br> </p> 
<p><br> </p> 
<div style="top:8675px">
  ﻿﻿ 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ba31164b7d5a82a611b422b6b26ff8dc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">人脸识别必读的N篇文章（转载）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a8df4538fc901d2b0c203a648f07bbbf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SQL Server 中日期比较</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>