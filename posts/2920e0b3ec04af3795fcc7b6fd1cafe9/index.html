<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Kubernetes 100个常用命令！ - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Kubernetes 100个常用命令！" />
<meta property="og:description" content="这篇文章是关于使用 Kubectl 进行 Kubernetes 诊断的指南。
列出了 100 个 Kubectl 命令，这些命令对于诊断 Kubernetes 集群中的问题非常有用。这些问题包括但不限于：
• 集群信息
• Pod 诊断
• 服务诊断
• 部署诊断
• 网络诊断
• 持久卷和持久卷声明诊断
• 资源使用情况
• 安全和授权
• 节点故障排除
• 其他诊断命令：文章还提到了许多其他命令，如资源扩展和自动扩展、作业和定时作业诊断、Pod 亲和性和反亲和性规则、RBAC 和安全、服务账号诊断、节点排空和取消排空、资源清理等。
图片
集群信息：
显示 Kubernetes 版本：kubectl version
显示集群信息：kubectl cluster-info
列出集群中的所有节点：kubectl get nodes
查看一个具体的节点详情：kubectl describe node 列出所有命名空间：kubectl get namespaces
列出所有命名空间中的所有 pod：kubectl get pods --all-namespaces
Pod 诊断：
列出特定命名空间中的 pod：kubectl get pods -n 查看一个 Pod 详情：kubectl describe pod -n 查看 Pod 日志：kubectl logs -n 尾部 Pod 日志：kubectl logs -f -n 在 pod 中执行命令：kubectl exec -it -n – Pod 健康检查：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/2920e0b3ec04af3795fcc7b6fd1cafe9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-02T22:50:40+08:00" />
<meta property="article:modified_time" content="2024-01-02T22:50:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Kubernetes 100个常用命令！</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>这篇文章是关于使用 Kubectl 进行 Kubernetes 诊断的指南。</p> 
<p>列出了 100 个 Kubectl 命令，这些命令对于诊断 Kubernetes 集群中的问题非常有用。这些问题包括但不限于：</p> 
<p>• 集群信息</p> 
<p>• Pod 诊断</p> 
<p>• 服务诊断</p> 
<p>• 部署诊断</p> 
<p>• 网络诊断</p> 
<p>• 持久卷和持久卷声明诊断</p> 
<p>• 资源使用情况</p> 
<p>• 安全和授权</p> 
<p>• 节点故障排除</p> 
<p>• 其他诊断命令：文章还提到了许多其他命令，如资源扩展和自动扩展、作业和定时作业诊断、Pod 亲和性和反亲和性规则、RBAC 和安全、服务账号诊断、节点排空和取消排空、资源清理等。</p> 
<p>图片</p> 
<p>集群信息：</p> 
<ol><li> <p>显示 Kubernetes 版本：kubectl version</p> </li><li> <p>显示集群信息：kubectl cluster-info</p> </li><li> <p>列出集群中的所有节点：kubectl get nodes</p> </li><li> <p>查看一个具体的节点详情：kubectl describe node </p> </li><li> <p>列出所有命名空间：kubectl get namespaces</p> </li><li> <p>列出所有命名空间中的所有 pod：kubectl get pods --all-namespaces</p> </li></ol> 
<p>Pod 诊断：</p> 
<ol><li> <p>列出特定命名空间中的 pod：kubectl get pods -n </p> </li><li> <p>查看一个 Pod 详情：kubectl describe pod -n </p> </li><li> <p>查看 Pod 日志：kubectl logs -n </p> </li><li> <p>尾部 Pod 日志：kubectl logs -f -n </p> </li><li> <p>在 pod 中执行命令：kubectl exec -it -n – </p> </li></ol> 
<p>Pod 健康检查：</p> 
<ol><li> <p>检查 Pod 准备情况：kubectl get pods -n -o jsonpath=‘{.status.conditions[?(@.type==“Ready”)].status}’</p> </li><li> <p>检查 Pod 事件：kubectl get events -n --field-selector involvedObject.name=</p> </li></ol> 
<p>Service诊断：</p> 
<ol><li> <p>列出命名空间中的所有服务：kubectl get svc -n </p> </li><li> <p>查看一个服务详情：kubectl describe svc -n </p> </li></ol> 
<p>Deployment诊断：</p> 
<ol><li> <p>列出命名空间中的所有Deployment：kubectl get deployments -n </p> </li><li> <p>查看一个Deployment详情：kubectl describe deployment -n </p> </li><li> <p>查看滚动发布状态：kubectl rollout status deployment/ -n </p> </li><li> <p>查看滚动发布历史记录：kubectl rollout history deployment/ -n </p> </li></ol> 
<p>StatefulSet诊断：</p> 
<ol><li> <p>列出命名空间中的所有 StatefulSet：kubectl get statefulsets -n </p> </li><li> <p>查看一个 StatefulSet详情：kubectl describe statefulset -n </p> </li></ol> 
<p>ConfigMap 和Secret诊断：</p> 
<ol><li> <p>列出命名空间中的 ConfigMap：kubectl get configmaps -n </p> </li><li> <p>查看一个ConfigMap详情：kubectl describe configmap -n </p> </li><li> <p>列出命名空间中的 Secret：kubectl get secrets -n </p> </li><li> <p>查看一个Secret详情：kubectl describe secret -n </p> </li></ol> 
<p>命名空间诊断：</p> 
<ol><li>查看一个命名空间详情：kubectl describe namespace </li></ol> 
<p>资源使用情况：</p> 
<ol><li> <p>检查 pod 的资源使用情况：kubectl top pod -n </p> </li><li> <p>检查节点资源使用情况：kubectl top nodes</p> </li></ol> 
<p>网络诊断：</p> 
<ol><li> <p>显示命名空间中 Pod 的 IP 地址：kubectl get pods -n -o custom-columns=POD:metadata.name,IP:status.podIP --no-headers</p> </li><li> <p>列出命名空间中的所有网络策略：kubectl get networkpolicies -n </p> </li><li> <p>查看一个网络策略详情：kubectl describe networkpolicy -n </p> </li></ol> 
<p>持久卷 (PV) 和持久卷声明 (PVC) 诊断：</p> 
<ol><li> <p>列出PV：kubectl get pv</p> </li><li> <p>查看一个PV详情：kubectl describe pv </p> </li><li> <p>列出命名空间中的 PVC：kubectl get pvc -n </p> </li><li> <p>查看PVC详情：kubectl describe pvc -n </p> </li></ol> 
<p>节点诊断：</p> 
<ol><li>获取特定节点上运行的 Pod 列表：kubectl get pods --field-selector spec.nodeName= -n </li></ol> 
<p>资源配额和限制：</p> 
<ol><li> <p>列出命名空间中的资源配额：kubectl get resourcequotas -n </p> </li><li> <p>查看一个资源配额详情：kubectl describe resourcequota -n </p> </li></ol> 
<p>自定义资源定义 (CRD) 诊断：</p> 
<ol><li> <p>列出命名空间中的自定义资源：kubectl get -n </p> </li><li> <p>查看自定义资源详情：kubectl describe -n </p> </li></ol> 
<p>使用这些命令时，请记住将, , , , , , , , , , , , , , 和替换为你的特定值。</p> 
<p>这些命令应该可以帮助你诊断 Kubernetes 集群以及在其中运行的应用程序。</p> 
<p>资源伸缩和自动伸缩</p> 
<ol><li> <p>Deployment伸缩：kubectl scale deployment --replicas= -n </p> </li><li> <p>设置Deployment的自动伸缩：kubectl autoscale deployment --min= --max= --cpu-percent= -n </p> </li><li> <p>检查水平伸缩器状态：kubectl get hpa -n </p> </li></ol> 
<p>作业和 CronJob 诊断：</p> 
<ol><li> <p>列出命名空间中的所有作业：kubectl get jobs -n </p> </li><li> <p>查看一份工作详情：kubectl describe job -n </p> </li><li> <p>列出命名空间中的所有 cron 作业：kubectl get cronjobs -n </p> </li><li> <p>查看一个 cron 作业详情：kubectl describe cronjob -n </p> </li></ol> 
<p>容量诊断：</p> 
<ol><li> <p>列出按容量排序的持久卷 (PV)：kubectl get pv --sort-by=.spec.capacity.storage</p> </li><li> <p>查看PV回收策略：kubectl get pv -o=jsonpath=‘{.spec.persistentVolumeReclaimPolicy}’</p> </li><li> <p>列出所有存储类别：kubectl get storageclasses</p> </li></ol> 
<p>Ingress和服务网格诊断：</p> 
<ol><li> <p>列出命名空间中的所有Ingress：kubectl get ingress -n </p> </li><li> <p>查看一个Ingress详情：kubectl describe ingress -n </p> </li><li> <p>列出命名空间中的所有 VirtualServices (Istio)：kubectl get virtualservices -n </p> </li><li> <p>查看一个 VirtualService (Istio)详情：kubectl describe virtualservice -n </p> </li></ol> 
<p>Pod 网络故障排除：</p> 
<ol><li> <p>运行网络诊断 Pod（例如 busybox）进行调试：kubectl run -it --rm --restart=Never --image=busybox net-debug-pod – /bin/sh</p> </li><li> <p>测试从 Pod 到特定端点的连接：kubectl exec -it -n – curl </p> </li><li> <p>跟踪从一个 Pod 到另一个 Pod 的网络路径：kubectl exec -it -n – traceroute </p> </li><li> <p>检查 Pod 的 DNS 解析：kubectl exec -it -n – nslookup </p> </li></ol> 
<p>配置和资源验证：</p> 
<ol><li> <p>验证 Kubernetes YAML 文件而不应用它：kubectl apply --dry-run=client -f </p> </li><li> <p>验证 pod 的安全上下文和功能：kubectl auth can-i list pods --as=system:serviceaccount::</p> </li></ol> 
<p>RBAC 和安全性：</p> 
<ol><li> <p>列出命名空间中的角色和角色绑定：kubectl get roles,rolebindings -n </p> </li><li> <p>查看角色或角色绑定详情：kubectl describe role -n </p> </li></ol> 
<p>服务帐户诊断：</p> 
<ol><li> <p>列出命名空间中的服务帐户：kubectl get serviceaccounts -n </p> </li><li> <p>查看一个服务帐户详情：kubectl describe serviceaccount -n </p> </li></ol> 
<p>清空节点和解除封锁：</p> 
<ol><li> <p>清空节点以进行维护：kubectl drain --ignore-daemonsets</p> </li><li> <p>解除对节点的封锁：kubectl uncordon </p> </li></ol> 
<p>资源清理：</p> 
<ol><li>强制删除 pod（不推荐）：kubectl delete pod -n --grace-period=0 --force</li></ol> 
<p>Pod 亲和性和反亲和性：</p> 
<ol><li> <p>列出 pod 的 pod 亲和性规则：kubectl get pod -n -o=jsonpath=‘{.spec.affinity}’</p> </li><li> <p>列出 pod 的 pod 反亲和性规则：kubectl get pod -n -o=jsonpath=‘{.spec.affinity.podAntiAffinity}’</p> </li></ol> 
<p>Pod 安全策略 (PSP)：</p> 
<ol><li>列出所有 Pod 安全策略（如果启用）：kubectl get psp</li></ol> 
<p>事件：</p> 
<ol><li> <p>查看最近的集群事件：kubectl get events --sort-by=.metadata.creationTimestamp</p> </li><li> <p>按特定命名空间过滤事件：kubectl get events -n </p> </li></ol> 
<p>节点故障排除：</p> 
<ol><li> <p>检查节点情况：kubectl describe node | grep Conditions -A5</p> </li><li> <p>列出节点容量和可分配资源：kubectl describe node | grep -E “Capacity|Allocatable”</p> </li></ol> 
<p>临时容器（Kubernetes 1.18+）：</p> 
<ol><li>运行临时调试容器：kubectl debug -it -n --image= – /bin/sh</li></ol> 
<p>资源指标（需要指标服务器）：</p> 
<ol><li>获取 Pod 的 CPU 和内存使用情况：kubectl top pod -n </li></ol> 
<p>kuelet诊断：</p> 
<ol><li>查看节点上的kubelet日志：kubectl logs -n kube-system kubelet-</li></ol> 
<p>使用Telepresence 进行高级调试：</p> 
<ol><li>使用 Telepresence 调试 pod：telepresence --namespace --swap-deployment </li></ol> 
<p>Kubeconfig 和上下文：</p> 
<ol><li> <p>列出可用的上下文：kubectl config get-contexts</p> </li><li> <p>切换到不同的上下文：kubectl config use-context </p> </li></ol> 
<p>Pod 安全标准（PodSecurity 准入控制器）：</p> 
<ol><li>列出 PodSecurityPolicy (PSP) 违规行为：kubectl get psp -A | grep -vE ‘NAME|REVIEWED’</li></ol> 
<p>Pod 中断预算 (PDB) 诊断：</p> 
<ol><li> <p>列出命名空间中的所有 PDB：kubectl get pdb -n </p> </li><li> <p>查看一个PDB详情：kubectl describe pdb -n </p> </li></ol> 
<p>资源锁诊断（如果使用资源锁）：</p> 
<ol><li>列出命名空间中的资源锁：kubectl get resourcelocks -n </li></ol> 
<p>服务端点和 DNS：</p> 
<ol><li> <p>列出服务的服务端点：kubectl get endpoints -n </p> </li><li> <p>检查 Pod 中的 DNS 配置：kubectl exec -it -n – cat /etc/resolv.conf</p> </li></ol> 
<p>自定义指标（Prometheus、Grafana）：</p> 
<ol><li>查询Prometheus指标：用于kubectl port-forward访问Prometheus和Grafana服务来查询自定义指标。</li></ol> 
<p>Pod 优先级和抢占：</p> 
<ol><li>列出优先级：kubectl get priorityclasses</li></ol> 
<p>Pod 开销（Kubernetes 1.18+）：</p> 
<ol><li>列出 pod 中的开销：kubectl get pod -n -o=jsonpath=‘{.spec.overhead}’</li></ol> 
<p>存储卷快照诊断（如果使用存储卷快照）：</p> 
<ol><li> <p>列出存储卷快照：kubectl get volumesnapshot -n </p> </li><li> <p>查看存储卷快照详情：kubectl describe volumesnapshot -n </p> </li></ol> 
<p>资源反序列化诊断：</p> 
<ol><li>反序列化并打印 Kubernetes 资源：kubectl get -n -o=json</li></ol> 
<p>节点污点：</p> 
<ol><li>列出节点污点：kubectl describe node | grep Taints</li></ol> 
<p>更改和验证 Webhook 配置：</p> 
<ol><li> <p>列出变异 webhook 配置：kubectl get mutatingwebhookconfigurations</p> </li><li> <p>列出验证 Webhook 配置：kubectl get validatingwebhookconfigurations</p> </li></ol> 
<p>Pod 网络策略：</p> 
<ol><li>列出命名空间中的 pod 网络策略：kubectl get networkpolicies -n </li></ol> 
<p>节点条件（Kubernetes 1.17+）：</p> 
<ol><li>自定义查询输出：kubectl get nodes -o custom-columns=NODE:.metadata.name,READY:.status.conditions[?(@.type==“Ready”)].status -l ‘node-role.kubernetes.io/worker=’</li></ol> 
<p>审核日志：</p> 
<ol><li>检索审核日志（如果启用）：检查 Kubernetes 审核日志配置以了解审核日志的位置。</li></ol> 
<p>节点操作系统详细信息：</p> 
<ol><li>获取节点的操作系统信息：kubectl get node -o jsonpath=‘{.status.nodeInfo.osImage}’</li></ol> 
<p>这些命令应该涵盖 Kubernetes 中的各种诊断场景。确保将、、等占位符替换为你的集群和用例的实际值。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e595242b6aadc324cde227bcdb79060c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【谷歌云】注册谷歌云 &amp; 创建Compute Engine</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c63179f5277ea93b6cedca97b619fa6a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">从信号处理角度彻底理解FFT</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>