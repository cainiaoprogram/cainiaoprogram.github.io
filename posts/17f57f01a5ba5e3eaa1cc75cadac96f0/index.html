<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Golang中的struct比较 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Golang中的struct比较" />
<meta property="og:description" content="1. 可排序、可比较和不可比较 可排序的数据类型有三种 整型Integer浮点型Floating-point字符串String可比较的数据类型除了上述三种外，还有Boolean，Complex，Pointer，Channel，Interface和Array不可比较的数据类型包括，Slice, Map, 和Function 2. 同一个struct的2个实例比较 包含不可比较的成员变量（map，slice，func等） ==操作符可以比较指针，不能直接比较实例；不包含不可比较的成员变量 ==操作符可以比较指针和实例；reflect.DeepEqual函数，指针和实例均可以比较（无论有没有包含不可比较的成员变量） package main import ( &#34;fmt&#34; &#34;reflect&#34; ) type T1 struct { Name string Age int Arr [2]bool ptr *int slice []int map1 map[string]string } func main() { t1 := T1{ Name: &#34;yxc&#34;, Age: 1, Arr: [2]bool{true, false}, ptr: new(int), slice: []int{1, 2, 3}, map1: make(map[string]string, 0), } t2 := T1{ Name: &#34;yxc&#34;, Age: 1, Arr: [2]bool{true, false}, ptr: new(int), slice: []int{1, 2, 3}, map1: make(map[string]string, 0), } // 报错 实例不能比较 Invalid operation: t1 == t2 (operator == not defined on T1) // fmt." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/17f57f01a5ba5e3eaa1cc75cadac96f0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-05-11T01:39:54+08:00" />
<meta property="article:modified_time" content="2020-05-11T01:39:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Golang中的struct比较</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>1. 可排序、可比较和不可比较</h3> 
<ul><li>可排序的数据类型有三种 
  <ul><li>整型Integer</li><li>浮点型Floating-point</li><li>字符串String</li></ul></li><li>可比较的数据类型除了上述三种外，还有Boolean，Complex，Pointer，Channel，Interface和Array</li><li>不可比较的数据类型包括，Slice, Map, 和Function</li></ul> 
<h3>2. 同一个struct的2个实例比较</h3> 
<ul><li>包含不可比较的成员变量（map，slice，func等） 
  <ul><li>==操作符可以比较指针，不能直接比较实例；</li></ul></li><li>不包含不可比较的成员变量 
  <ul><li>==操作符可以比较指针和实例；</li></ul></li><li>reflect.DeepEqual函数，指针和实例均可以比较（无论有没有包含不可比较的成员变量）</li></ul> 
<pre><code>package main

import (
	"fmt"
	"reflect"
)

type T1 struct {
	Name  string
	Age   int
	Arr   [2]bool
	ptr   *int
	slice []int
	map1  map[string]string
}

func main() {
	t1 := T1{
		Name:  "yxc",
		Age:   1,
		Arr:   [2]bool{true, false},
		ptr:   new(int),
		slice: []int{1, 2, 3},
		map1:  make(map[string]string, 0),
	}

	t2 := T1{
		Name:  "yxc",
		Age:   1,
		Arr:   [2]bool{true, false},
		ptr:   new(int),
		slice: []int{1, 2, 3},
		map1:  make(map[string]string, 0),
	}

	// 报错 实例不能比较 Invalid operation: t1 == t2 (operator == not defined on T1)
	// fmt.Println(t1 == t2)
	// 指针可以比较
	fmt.Println(&amp;t1 == &amp;t2) // false
	fmt.Println(reflect.DeepEqual(t1, t2)) // true

	t3 := &amp;T1{
		Name:  "yxc",
		Age:   1,
		Arr:   [2]bool{true, false},
		ptr:   new(int),
		slice: []int{1, 2, 3},
		map1:  make(map[string]string, 0),
	}

	t4 := &amp;T1{
		Name:  "yxc",
		Age:   1,
		Arr:   [2]bool{true, false},
		ptr:   new(int),
		slice: []int{1, 2, 3},
		map1:  make(map[string]string, 0),
	}

	fmt.Println(t3 == t4)                  // false
	fmt.Println(reflect.DeepEqual(t3, t4)) // true
	fmt.Printf("%p, %p \n", t3, t4)        // 0xc000046050, 0xc0000460a0
	fmt.Printf("%p, %p \n", &amp;t3, &amp;t4)      // 0xc000006030, 0xc000006038

	// 前面加*，表示指针指向的值，即结构体实例，不能用==
	// Invalid operation: *t3 == *t4 (operator == not defined on T1)
	// fmt.Println(*t3 == *t4)

	t5 := t3
	fmt.Println(t3 == t5)                  // true
	fmt.Println(reflect.DeepEqual(t3, t5)) // true
	fmt.Printf("%p, %p \n", t3, t5)        // 0xc000046050, 0xc000046050
	fmt.Printf("%p, %p \n", &amp;t3, &amp;t5)      // 0xc000006030, 0xc000006040
}</code></pre> 
<h3>3. 两个不同的struct的实例能不能比较</h3> 
<h4>3.1 两个struct可以相互转换，且不包含不可比较的成员变量，转换成相同类型后可以使用==操作符</h4> 
<pre><code>package main

import (
	"fmt"
)

type T2 struct {
	Name string
	Age  int
	Arr  [2]bool
	ptr  *int
}

type T3 struct {
	Name string
	Age  int
	Arr  [2]bool
	ptr  *int
}

func main() {
	var ss1 T2
	var ss2 T3

	// Cannot use 'ss2' (type T3) as type T2 in assignment
	//ss1 = ss2

	ss3 := T2(ss2)
	fmt.Println(ss3 == ss1) // true
}</code></pre> 
<h4>3.2 两个struct可以相互转换，但包含不可比较的成员变量</h4> 
<ul><li>转化成相同类型后，不可以比较实例，可以比较指针；</li><li>一定要转化后再使用reflect.DeepEqual函数进行比较，否则总是返回false，失去了比较的意义；</li></ul> 
<pre><code>package main

import (
	"fmt"
	"reflect"
)

type T2 struct {
	Name string
	Age  int
	Arr  [2]bool
	ptr  *int
	map1 map[string]string
}

type T3 struct {
	Name string
	Age  int
	Arr  [2]bool
	ptr  *int
	map1 map[string]string
}

func main() {
	var ss2 T2
	var ss3 T3

	// 不同类型的struct, 不可以直接用=赋值
	// Cannot use 'ss2' (type T2) as type T3 in assignment
	// ss2 = ss3

	// invalid operation: &amp;ss2 == &amp;ss3 (mismatched types *T2 and *T3)
	//fmt.Println(&amp;ss2==&amp;ss3)

	// invalid operation: ss2 == ss3 (mismatched types T2 and T3)
	//fmt.Println(ss2==ss3)

	fmt.Println(reflect.DeepEqual(ss3, ss2)) // false
	fmt.Println(reflect.DeepEqual(&amp;ss3, &amp;ss2)) // false

	ss4 := T2(ss3)
	// Invalid operation: ss4==ss2 (operator == not defined on T2)
	//fmt.Println(ss4==ss2)   //含有不可比较成员变量

	// 转化成相同类型后, 可以比较指针
	fmt.Println(&amp;ss4==&amp;ss2) // false
	fmt.Println(reflect.DeepEqual(ss4, ss2)) // true
}</code></pre> 
<h3>4. struct可以作为map的key么？</h3> 
<ul><li>struct必须是可比较的，才能作为key，否则编译时报错</li></ul> 
<pre><code>package main

import (
	"fmt"
)

type T1 struct {
	Name  string
	Age   int
	Arr   [2]bool
	ptr   *int
	//test  func(i int) (err error)
	//slice []int
	//map1  map[string]string
}

type T2 struct {
	Name string
	Age  int
	Arr  [2]bool
	ptr  *int
}

func main() {
	n := make(map[T2]string, 0) // 无报错
	fmt.Print(n)                // map[]
	// lnvalid map key type: the comparison operators == and != must be fully defined for key type
	m := make(map[T1]string, 0)
	fmt.Println(m)
}</code></pre> 
<h3>5. 参考资料</h3> 
<ul><li><a href="https://studygolang.com/articles/27045?fr=sidebar" rel="nofollow">https://studygolang.com/articles/27045?fr=sidebar</a></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7522798c5a449ef40e01c8c0c98bab07/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">BFC详解,从官方定义到上机实操</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/43379e08673bffb69805f9c485d1bd4b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">高通QPST备份QCN及恢复流程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>