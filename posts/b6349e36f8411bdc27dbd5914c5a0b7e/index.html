<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Qt5 编写应用程序扩展插件 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Qt5 编写应用程序扩展插件" />
<meta property="og:description" content="目录
一、编写插件步骤
1.1. 通过插件使应用程序可扩展涉及以下步骤：
1.2. 编写一个实现插件的步骤：
二、编写通过插件使应用程序可扩展
三、编写一个实现插件
一、编写插件步骤 1.1. 通过插件使应用程序可扩展涉及以下步骤： 定义一组用于与插件对话的接口(仅具有纯虚函数的类)。使用Q_DECLARE_INTERFACE ()宏向Qt的元对象系统声明该接口。在应用程序中使用QPluginLoader加载插件。使用qobject_cast()测试插件是否实现了给定的接口。 1.2. 编写一个实现插件的步骤： 声明一个插件类，该类继承自QObject和该插件要提供的接口。使用Q_INTERFACES ()宏告诉Qt的元对象系统有关接口的信息。使用Q_PLUGIN_METADATA ()宏导出插件。使用合适的.pro文件构建插件。 二、编写通过插件使应用程序可扩展 1. 新建一个子项目便于程序管理【文件-&gt;新建文件或项目-&gt;其它项目-&gt;子目录项目】
2. 名称随便命名即可,本次演示项目命名为【PluginProject】,然后指定目录
3. 指定构建套件默认即可
4.完成并添加应用程序项目
5.选择【Application-&gt;Qt Widgets Application】
6.本次演示应用程序命名为【MainApp】默认mainwindow窗口类
7.创建完成的项目结构如下,然后【MainApp右键-&gt;添加新的C&#43;&#43; Header File】命名为abstractinterface
8.定义一组用于与插件对话的接口(仅具有纯虚函数的类),使用Q_DECLARE_INTERFACE()宏向Qt的元对象系统声明该接口
#ifndef ABSTRACTINTERFACE_H #define ABSTRACTINTERFACE_H #include &lt;QtPlugin&gt; class QWidget; class AbstractInterface{ public: virtual ~AbstractInterface(){} //必须定义虚析构函数 virtual QWidget* createWidgetPlugin(QWidget *parent) const = 0; }; #define AbstarctInterface_IID &#34;qt.org.com.abstactinterface/1.0&#34; //iid随便命名当前项目独一无二即可 Q_DECLARE_INTERFACE(AbstractInterface,AbstarctInterface_IID) //声明接口 #endif // ABSTRACTINTERFACE_H 9.在mainwindow中使用QPluginLoader加载插件。使用qobject_cast()测试插件是否实现了给定的接口。
#ifndef MAINWINDOW_H #define MAINWINDOW_H #include &lt;QMainWindow&gt; class AbstractInterface; namespace Ui { class MainWindow; } class MainWindow : public QMainWindow { Q_OBJECT public: explicit MainWindow(QWidget *parent = nullptr); ~MainWindow(); private: Ui::MainWindow *ui; private: void loadPlugin(); //应用程序装载插件 private: AbstractInterface *mainInterface; //插件类 }; #endif // MAINWINDOW_H #include &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b6349e36f8411bdc27dbd5914c5a0b7e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-11T16:58:34+08:00" />
<meta property="article:modified_time" content="2022-01-11T16:58:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Qt5 编写应用程序扩展插件</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80%E3%80%81%E7%BC%96%E5%86%99%E6%8F%92%E4%BB%B6%E6%AD%A5%E9%AA%A4-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E7%BC%96%E5%86%99%E6%8F%92%E4%BB%B6%E6%AD%A5%E9%AA%A4" rel="nofollow">一、编写插件步骤</a></p> 
<p id="1.1.%20%E9%80%9A%E8%BF%87%E6%8F%92%E4%BB%B6%E4%BD%BF%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8F%AF%E6%89%A9%E5%B1%95%E6%B6%89%E5%8F%8A%E4%BB%A5%E4%B8%8B%E6%AD%A5%E9%AA%A4%EF%BC%9A-toc" style="margin-left:40px;"><a href="#1.1.%20%E9%80%9A%E8%BF%87%E6%8F%92%E4%BB%B6%E4%BD%BF%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8F%AF%E6%89%A9%E5%B1%95%E6%B6%89%E5%8F%8A%E4%BB%A5%E4%B8%8B%E6%AD%A5%E9%AA%A4%EF%BC%9A" rel="nofollow">1.1. 通过插件使应用程序可扩展涉及以下步骤：</a></p> 
<p id="1.2.%20%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E5%AE%9E%E7%8E%B0%E6%8F%92%E4%BB%B6%E7%9A%84%E6%AD%A5%E9%AA%A4%EF%BC%9A-toc" style="margin-left:40px;"><a href="#1.2.%20%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E5%AE%9E%E7%8E%B0%E6%8F%92%E4%BB%B6%E7%9A%84%E6%AD%A5%E9%AA%A4%EF%BC%9A" rel="nofollow">1.2. 编写一个实现插件的步骤：</a></p> 
<p id="%E4%BA%8C%E3%80%81%E7%BC%96%E5%86%99%E9%80%9A%E8%BF%87%E6%8F%92%E4%BB%B6%E4%BD%BF%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8F%AF%E6%89%A9%E5%B1%95-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E7%BC%96%E5%86%99%E9%80%9A%E8%BF%87%E6%8F%92%E4%BB%B6%E4%BD%BF%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8F%AF%E6%89%A9%E5%B1%95" rel="nofollow">二、编写通过插件使应用程序可扩展</a></p> 
<p id="%C2%A0%E4%B8%89%E3%80%81%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E5%AE%9E%E7%8E%B0%E6%8F%92%E4%BB%B6-toc" style="margin-left:0px;"><a href="#%C2%A0%E4%B8%89%E3%80%81%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E5%AE%9E%E7%8E%B0%E6%8F%92%E4%BB%B6" rel="nofollow"> 三、编写一个实现插件</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E4%B8%80%E3%80%81%E7%BC%96%E5%86%99%E6%8F%92%E4%BB%B6%E6%AD%A5%E9%AA%A4">一、编写插件步骤</h2> 
<h3 id="1.1.%20%E9%80%9A%E8%BF%87%E6%8F%92%E4%BB%B6%E4%BD%BF%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8F%AF%E6%89%A9%E5%B1%95%E6%B6%89%E5%8F%8A%E4%BB%A5%E4%B8%8B%E6%AD%A5%E9%AA%A4%EF%BC%9A">1.1. 通过插件使应用程序可扩展涉及以下步骤：</h3> 
<ol><li>定义一组用于与插件对话的接口(仅具有纯虚函数的类)。</li><li>使用Q_DECLARE_INTERFACE ()宏向Qt的元对象系统声明该接口。</li><li>在应用程序中使用QPluginLoader加载插件。</li><li>使用qobject_cast()测试插件是否实现了给定的接口。</li></ol> 
<h3 id="1.2.%20%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E5%AE%9E%E7%8E%B0%E6%8F%92%E4%BB%B6%E7%9A%84%E6%AD%A5%E9%AA%A4%EF%BC%9A">1.2. 编写一个实现插件的步骤：</h3> 
<ol><li>声明一个插件类，该类继承自QObject和该插件要提供的接口。</li><li>使用Q_INTERFACES ()宏告诉Qt的元对象系统有关接口的信息。</li><li>使用Q_PLUGIN_METADATA ()宏导出插件。</li><li>使用合适的.pro文件构建插件。</li></ol> 
<p></p> 
<h2 id="%E4%BA%8C%E3%80%81%E7%BC%96%E5%86%99%E9%80%9A%E8%BF%87%E6%8F%92%E4%BB%B6%E4%BD%BF%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E5%8F%AF%E6%89%A9%E5%B1%95">二、编写通过插件使应用程序可扩展</h2> 
<p>1. 新建一个子项目便于程序管理【文件-&gt;新建文件或项目-&gt;其它项目-&gt;子目录项目】</p> 
<p><img alt="" height="307" src="https://images2.imgbox.com/f5/55/Rgj14qpq_o.png" width="600"></p> 
<p>2. 名称随便命名即可,本次演示项目命名为【PluginProject】,然后指定目录</p> 
<p><span style="background-color:#0d0016;"><img alt="" height="302" src="https://images2.imgbox.com/ba/0e/aeNPmcxk_o.png" width="600"></span></p> 
<p>3. 指定构建套件默认即可</p> 
<p><img alt="" height="169" src="https://images2.imgbox.com/33/8d/8ZEcggbT_o.png" width="600"></p> 
<p> 4.完成并添加应用程序项目</p> 
<p><img alt="" height="299" src="https://images2.imgbox.com/3f/da/dSuhHQZs_o.png" width="600"></p> 
<p>5.选择【Application-&gt;Qt Widgets Application】</p> 
<p><img alt="" height="373" src="https://images2.imgbox.com/0f/a7/fCHOWia0_o.png" width="600"></p> 
<p>6.本次演示应用程序命名为【<strong>MainApp</strong>】默认mainwindow窗口类</p> 
<p><img alt="" height="428" src="https://images2.imgbox.com/3f/4a/MWGOf7pr_o.png" width="600"></p> 
<p> <img alt="" height="496" src="https://images2.imgbox.com/01/b8/bIpNIuHX_o.png" width="600"></p> 
<p> 7.创建完成的项目结构如下,然后【MainApp右键-&gt;添加新的C++ Header File】命名为abstractinterface</p> 
<p><img alt="" height="100" src="https://images2.imgbox.com/f1/f8/uxF0Ecjx_o.png" width="600"></p> 
<p><img alt="" height="341" src="https://images2.imgbox.com/1c/ca/6bxId2FU_o.png" width="600"></p> 
<p> <img alt="" height="252" src="https://images2.imgbox.com/0c/32/VVQGNZu1_o.png" width="261"></p> 
<p>8.定义一组用于与插件对话的接口(仅具有纯虚函数的类),使用Q_DECLARE_INTERFACE()宏向Qt的元对象系统声明该接口</p> 
<p><img alt="" height="141" src="https://images2.imgbox.com/4d/86/Fry2DxDc_o.png" width="600"></p> 
<pre><code class="language-cpp">#ifndef ABSTRACTINTERFACE_H
#define ABSTRACTINTERFACE_H
#include &lt;QtPlugin&gt;
class QWidget;
class AbstractInterface{
public:
    virtual ~AbstractInterface(){}  //必须定义虚析构函数
    virtual QWidget* createWidgetPlugin(QWidget *parent) const = 0;
};
#define AbstarctInterface_IID "qt.org.com.abstactinterface/1.0"   //iid随便命名当前项目独一无二即可
Q_DECLARE_INTERFACE(AbstractInterface,AbstarctInterface_IID)      //声明接口

#endif // ABSTRACTINTERFACE_H
</code></pre> 
<p> 9.在mainwindow中使用QPluginLoader加载插件。使用qobject_cast()测试插件是否实现了给定的接口。<img alt="" height="471" src="https://images2.imgbox.com/7f/c9/fRt320TS_o.png" width="1041"></p> 
<pre><code class="language-cpp">#ifndef MAINWINDOW_H
#define MAINWINDOW_H

#include &lt;QMainWindow&gt;
class AbstractInterface;
namespace Ui {
class MainWindow;
}

class MainWindow : public QMainWindow
{
    Q_OBJECT

public:
    explicit MainWindow(QWidget *parent = nullptr);
    ~MainWindow();

private:
    Ui::MainWindow *ui;
private:
    void loadPlugin();              //应用程序装载插件
private:
    AbstractInterface *mainInterface;      //插件类
};

#endif // MAINWINDOW_H
</code></pre> 
<p> <img alt="" height="729" src="https://images2.imgbox.com/2b/24/4u26Jsnq_o.png" width="1200"></p> 
<p></p> 
<pre><code class="language-cpp">#include "mainwindow.h"
#include "ui_mainwindow.h"
#include "abstractinterface.h"
#include &lt;QDir&gt;
#include &lt;QPluginLoader&gt;     //包含插件装载头文件
MainWindow::MainWindow(QWidget *parent) :
    QMainWindow(parent),
    ui(new Ui::MainWindow)
{
    ui-&gt;setupUi(this);
    loadPlugin();
}

MainWindow::~MainWindow()
{
    delete ui;
}

void MainWindow::loadPlugin()
{
    //插件存放在应用程序目录下的plugin目录下,便于管理
    QDir pluginDir(qApp-&gt;applicationDirPath());  //定位应用程序目录

    if( pluginDir.cd("plugin") )                 //进入plugin,前提先创建plugin目录
    {
        for(auto fileName:pluginDir.entryList(QDir::Files))  //遍历目录下的文件
        {
            QFileInfo info(fileName);
            if(info.completeSuffix() == "dll" || info.completeSuffix() == "so")  //过滤后缀为dll或so的动态库文件
            {
                QPluginLoader load(pluginDir.absoluteFilePath(fileName));        //装载插件
                QObject *pluginObj = load.instance();                            //获取插件根对象
                if(pluginObj)
                {
                    mainInterface = qobject_cast&lt;AbstractInterface *&gt;(pluginObj);  //转换
                    mainInterface-&gt;createWidgetPlugin(ui-&gt;centralWidget);
                }
            }
        }
    }
}
</code></pre> 
<h2 id="%C2%A0%E4%B8%89%E3%80%81%E7%BC%96%E5%86%99%E4%B8%80%E4%B8%AA%E5%AE%9E%E7%8E%B0%E6%8F%92%E4%BB%B6"> 三、编写一个实现插件</h2> 
<p>1.【PluginProject-&gt;右键-&gt;新子项目-&gt;Application-&gt;Qt Widgets Application】</p> 
<p><img alt="" height="201" src="https://images2.imgbox.com/fb/eb/4lwxoCEC_o.png" width="198"></p> 
<p><img alt="" height="526" src="https://images2.imgbox.com/06/53/HvDzjcG5_o.png" width="600"></p> 
<p>2. 项目名为【PluginApp】基类选择QWidget</p> 
<p><img alt="" height="421" src="https://images2.imgbox.com/af/c2/MJ7jcT2o_o.png" width="600"></p> 
<p><img alt="" height="500" src="https://images2.imgbox.com/6e/8c/btK61UT4_o.png" width="600"></p> 
<p>3.完成后的项目结构</p> 
<p><img alt="" height="482" src="https://images2.imgbox.com/51/bf/CXwcfwgs_o.png" width="283"></p> 
<p>4.把PluginApp.pro中的相关配置更改如下</p> 
<pre><code class="language-cpp">TARGET = PluginApp
TEMPLATE =lib                        #template改app为lib
CONFIG += plugin                     #增加plugin的配置
DESTDIR = ../MainApp/debug/plugin    #目标直接生成到MainApp的debug/plugin 
INCLUDEPATH += ../MainApp            #包含MainApp创建的abstractinterface.h

</code></pre> 
<p><img alt="" height="261" src="https://images2.imgbox.com/d8/b2/x17oCeem_o.png" width="600"></p> 
<p> 5.【PluginApp-&gt;右键-&gt;新增C++ Class】命名为InterfaceImplement,并继承QObject</p> 
<p><img alt="" height="379" src="https://images2.imgbox.com/0a/9e/qebr4bgK_o.png" width="600"></p> 
<p><img alt="" height="292" src="https://images2.imgbox.com/46/41/iHQMH6kx_o.png" width="288"></p> 
<p> 6.接口实现类继承QObject以及抽象的AbstractInterface,使用Q_INTERFACES()宏告诉Qt的元对象系统有关接口的信息。使用Q_PLUGIN_METADATA ()宏导出插件。</p> 
<p><img alt="" height="210" src="https://images2.imgbox.com/28/13/Ym3Fa6iv_o.png" width="600"></p> 
<pre><code class="language-cpp">#ifndef INTERFACEIMPLMENT_H
#define INTERFACEIMPLMENT_H

#include &lt;QObject&gt;
#include &lt;abstractinterface.h&gt;
class InterfaceImplment : public QObject, public AbstractInterface  //集成抽象接口
{
    Q_OBJECT
    Q_INTERFACES(AbstractInterface)                              //实现的接口
    Q_PLUGIN_METADATA(IID AbstarctInterface_IID)                 //导出接口后面的 FILE “jsonfile”可省略
public:
    explicit InterfaceImplment(QObject *parent = nullptr);
    ~InterfaceImplment() Q_DECL_OVERRIDE;
    QWidget *createWidgetPlugin(QWidget *parent) const Q_DECL_OVERRIDE;
};

#endif // INTERFACEIMPLMENT_H
</code></pre> 
<p>7.构建PluginWidget对象,PluginWidget主要演示一个用户名和密码登录判断的简单示例</p> 
<p><img alt="" height="220" src="https://images2.imgbox.com/60/a5/rpzI549H_o.png" width="600"></p> 
<pre><code class="language-cpp">#include "interfaceimplment.h"
#include "pluginwidget.h"     //包含plugwidget头文件
InterfaceImplment::InterfaceImplment(QObject *parent) : QObject(parent)
{

}
InterfaceImplment::~InterfaceImplment()
{

}
QWidget *InterfaceImplment::createWidgetPlugin(QWidget *parent) const
{
    PluginWidget * w = new PluginWidget(parent);     //返回PluginApp实现的界面类
    return w;
}</code></pre> 
<p></p> 
<p><img alt="" height="234" src="https://images2.imgbox.com/1d/4e/Rbfadeqs_o.png" width="600"></p> 
<p><img alt="" height="402" src="https://images2.imgbox.com/db/19/bFznhZdv_o.png" width="600"></p> 
<p>8. 构建【PluginProject】项目,无错误将在MainApp/debug/plugin中生成PluginApp动态库，</p> 
<p>然后单独运行MainAPP出现下面界面,表示插件扩展成功【在MainApp/debug中手动创建plugin文件夹】</p> 
<p><img alt="" height="85" src="https://images2.imgbox.com/86/37/HXAvJjYG_o.png" width="600"></p> 
<p></p> 
<p> <img alt="" height="329" src="https://images2.imgbox.com/98/62/gs2e4YW9_o.png" width="600"></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7e512a7c0e4e64dcc0b7363458dc883e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Intellij IDEA手动添加Libraries（非pom依赖的情况下）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7babbffe0349072b5a9b576d196c12c3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何解决Idea导入项目中Configuration Error: deployment source ‘StudentSystem:war exploded‘ is not valid错误</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>