<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>对zebra的一点思考(Think Of ZEBRA) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="对zebra的一点思考(Think Of ZEBRA)" />
<meta property="og:description" content="http://blog.csdn.net/xuyanbo2008/article/details/7439936
===================================================
此文并不针对zebra的应用，甚至不是一个架构的分析，只是对于Zebra的一点儿思考。 Zebra 设计得是如此简洁明快。每一种数据结构均对应于一定的应用，它们之间以一种松耦合的方式共存，而多种数据结构组成的功能模块几乎完美的结合在一起，完成了非常复杂的功能。它的设计思想就在于对C语言面向对象式的应用。 虽然很多程序均借鉴面向对象设计方式，但是Zebra的代码风格是易读的，非常易于理解和学习，与此同时，Zebra使用了丰富的数据结构，比 如链表、向量、表和队列等，它的松耦合方式使得每一数据结构封装的功能模块很容易被精简剥离出来，以备我们特殊的应用。这就是我写下Think Of ZEBRA非常重要的原因！ 1.ZEBRA中的thread 提起thread就会让人想起线程，Linux中的线程被称为pthread，这里的thread 不是pthread，因为它只是对线程的应用层模拟。ZEBRA借助自己的thread结构，将所有的事件（比如文件描述的读写事件，定时事件等）和对应 的处理函数封装起来，并取名为struct thread。然后这些threads又被装入不同的“线程“链表挂载到名为thread_master的结构中，这样所有的操作只需要面向 thead_master。
/* Thread itself. */
struct thread
{
unsigned char type; /* thread type */
struct thread *next; /* next pointer of the thread */
struct thread *prev; /* previous pointer of the thread */
struct thread_master *master; /* pointer to the struct thread_master. */
int (*func) (struct thread *); /* event function */
void *arg; /* event argument */" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c1ea7eedf9e0c66b9c1ad7c8d1c997d2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2013-03-18T10:08:00+08:00" />
<meta property="article:modified_time" content="2013-03-18T10:08:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">对zebra的一点思考(Think Of ZEBRA)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body"> 
 <p>http://blog.csdn.net/xuyanbo2008/article/details/7439936</p> 
 <p>===================================================</p> 
 <p><br></p> 
 <p></p> 
 <div style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> 
  <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">此文并不针对zebra的应用，甚至不是一个架构的分析，只是对于Zebra的一点儿思考。</span> 
 </div> 
 <div style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> 
  <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"> </span> 
 </div> 
 <div style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> 
  <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">Zebra 设计得是如此简洁明快。每一种数据结构均对应于一定的应用，它们之间以一种松耦合的方式共存，而多种数据结构组成的功能模块几乎完美的结合在一起，完成了非常复杂的功能。它的设计思想就在于对C语言面向对象式的应用。</span> 
 </div> 
 <div style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> 
  <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"> </span> 
 </div> 
 <div style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> 
  <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">虽然很多程序均借鉴面向对象设计方式，但是Zebra的代码风格是易读的，非常易于理解和学习，与此同时，Zebra使用了丰富的数据结构，比 如链表、向量、表和队列等，它的松耦合方式使得每一数据结构封装的功能模块很容易被精简剥离出来，以备我们特殊的应用。这就是我写下Think Of ZEBRA非常重要的原因！</span> 
 </div> 
 <div style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> 
  <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"> </span> 
 </div> 
 <div style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> 
  <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"><strong>1.ZEBRA中的thread</strong></span> 
 </div> 
 <div style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> 
  <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"><strong><br></strong>提起thread就会让人想起线程，Linux中的线程被称为pthread，这里的thread 不是pthread，因为它只是对线程的应用层模拟。ZEBRA借助自己的thread结构，将所有的事件（比如文件描述的读写事件，定时事件等）和对应 的处理函数封装起来，并取名为struct thread。然后这些threads又被装入不同的“线程“链表挂载到名为thread_master的结构中，这样所有的操作只需要面向 thead_master。<br></span> 
 </div> 
 <div style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> 
  <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"> </span> 
 </div> 
 <div style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> 
  <div class="codeText" id="codeText" style="font-family:Consolas, monospace;border:1px solid rgb(221,221,221);width:658px;letter-spacing:.1px;line-height:1.5;"> 
   <ol class="dp-css" style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;list-style-position:outside;line-height:1.3;color:rgb(92,92,92);"><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(0,0,0);"><span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">*</span> Thread itself<span style="line-height:1.5;color:rgb(0,0,204);">.</span> <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span><br></span></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> struct thread<br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(0,0,204);">{<!-- --></span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   unsigned char type<span style="line-height:1.5;color:rgb(0,0,204);">;</span>        <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">*</span> thread type <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   struct thread <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,255);">next</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span>        <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">*</span> <span style="line-height:1.5;color:rgb(0,0,255);">next</span> pointer of the thread <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   struct thread <span style="line-height:1.5;color:rgb(0,0,204);">*</span>prev<span style="line-height:1.5;color:rgb(0,0,204);">;</span>        <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">*</span> previous pointer of the thread <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   struct thread_master <span style="line-height:1.5;color:rgb(0,0,204);">*</span>master<span style="line-height:1.5;color:rgb(0,0,204);">;</span>    <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">*</span> pointer <span style="line-height:1.5;color:rgb(0,0,255);">to</span> the struct thread_master<span style="line-height:1.5;color:rgb(0,0,204);">.</span> <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   <span style="line-height:1.5;color:rgb(255,0,0);">int</span> <span style="line-height:1.5;color:rgb(0,0,204);">(</span><span style="line-height:1.5;color:rgb(0,0,204);">*</span>func<span style="line-height:1.5;color:rgb(0,0,204);">)</span> <span style="line-height:1.5;color:rgb(0,0,204);">(</span>struct thread <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span> <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">*</span> event <span style="line-height:1.5;color:rgb(0,0,255);">function</span> <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   void <span style="line-height:1.5;color:rgb(0,0,204);">*</span>arg<span style="line-height:1.5;color:rgb(0,0,204);">;</span>            <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">*</span> event argument <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   union <span style="line-height:1.5;color:rgb(0,0,204);">{<!-- --></span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(255,0,0);">int</span> val<span style="line-height:1.5;color:rgb(0,0,204);">;</span>            <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">*</span> <span style="line-height:1.5;color:rgb(255,0,0);">second</span> argument of the event<span style="line-height:1.5;color:rgb(0,0,204);">.</span> <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(255,0,0);">int</span> fd<span style="line-height:1.5;color:rgb(0,0,204);">;</span>            <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">*</span> file descriptor <span style="line-height:1.5;color:rgb(0,0,255);">in</span> <span style="line-height:1.5;color:rgb(0,0,255);">case</span> of read<span style="line-height:1.5;color:rgb(0,0,204);">/</span>write<span style="line-height:1.5;color:rgb(0,0,204);">.</span> <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     struct timeval sands<span style="line-height:1.5;color:rgb(0,0,204);">;</span>    <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">*</span> rest of <span style="line-height:1.5;color:rgb(255,0,0);">time</span> sands value<span style="line-height:1.5;color:rgb(0,0,204);">.</span> <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   <span style="line-height:1.5;color:rgb(0,0,204);">}</span> u<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   RUSAGE_T ru<span style="line-height:1.5;color:rgb(0,0,204);">;</span>            <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">*</span> Indepth usage info<span style="line-height:1.5;color:rgb(0,0,204);">.</span> <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(0,0,204);">}</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">*</span> Linked list of thread<span style="line-height:1.5;color:rgb(0,0,204);">.</span> <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> struct thread_list<br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(0,0,204);">{<!-- --></span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   struct thread <span style="line-height:1.5;color:rgb(0,0,204);">*</span>head<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   struct thread <span style="line-height:1.5;color:rgb(0,0,204);">*</span>tail<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   <span style="line-height:1.5;color:rgb(255,0,0);">int</span> count<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(0,0,204);">}</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">*</span> Master of the theads<span style="line-height:1.5;color:rgb(0,0,204);">.</span> <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> struct thread_master<br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(0,0,204);">{<!-- --></span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   struct thread_list read<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   struct thread_list write<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   struct thread_list timer<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   struct thread_list event<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   struct thread_list ready<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   struct thread_list unuse<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   fd_set readfd<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   fd_set writefd<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   fd_set exceptfd<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   unsigned long alloc<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(0,0,204);">}</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span></li></ol> 
  </div> 
 </div> 
 <p></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">thread_master线程管理者维护了6个“线程“队列：read、write、timer、event、ready和unuse。read 队列对应于描述符的读事件，write队列对应于描述符的写事件，timer通常为定时事件，event为自定义事件，这些事件需要我们自己在适合的时候 触发，并且这类事件不需要对描述符操作，也不需要延时。ready队列通常只是在内部使用，比如read,write或event队列中因事件触发，就会 把该”线程”移入ready队列进行统一处理。unuse是在一个”线程”执行完毕后被移入此队列，并且在需要创建一个新的”线程”时，将从该队列中取壳 资源，这样就避免了再次申请内存。只有再取不到的情况下才进行新”线程”的内存申请。</span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"> </span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"><strong>1.2 线程管理者中的"线程"链表函数</strong></span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"><strong><br></strong>struct thread_list是一个双向链表，对应的操作有:<br> //添加thread到指定的链表中的尾部<br> static void thread_list_add (struct thread_list *list, struct thread *thread);<br> //添加thread到指定的链表中指定的point前部，它在需要对链表进行排序的时候很有用<br> static void thread_list_add_before (struct thread_list *list, <br>    struct thread *point, <br>    struct thread *thread)；<br> //在指定的链表中删除制定的thread<br> static struct thread *thread_list_delete (struct thread_list *list, struct thread *thread);<br> //释放指定的链表list中所有的thread, m 中的alloc减去释放的"线程"个数<br> static void thread_list_free (struct thread_master *m, struct thread_list *list);<br> //移除list中的第一个thread 并返回<br> static struct thread *thread_trim_head (struct thread_list *list);</span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"> </span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"><strong>1.3 thread中的read队列</strong></span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"><strong><br></strong>考虑这样的应用：创建一个socket，并且需要listen在该socket上，然后读取信息，那么使用read队列是不二选择。下面是一个例子，这个例子将对标准输入文件描述符进行处理：</span></p> 
 <div class="codeText" style="font-family:Consolas, monospace;color:rgb(51,51,51);font-size:14px;border:1px solid rgb(221,221,221);width:658px;line-height:1.5;"> 
  <ol class="dp-css" style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;list-style-position:outside;line-height:1.3;color:rgb(92,92,92);"><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(0,0,0);">static <span style="line-height:1.5;color:rgb(255,0,0);">int</span> do_accept <span style="line-height:1.5;color:rgb(0,0,204);">(</span>struct thread <span style="line-height:1.5;color:rgb(0,0,204);">*</span>thread<span style="line-height:1.5;color:rgb(0,0,204);">)</span><br></span></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(0,0,204);">{<!-- --></span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> char buf<span style="line-height:1.5;color:rgb(0,0,204);">[</span>1024<span style="line-height:1.5;color:rgb(0,0,204);">]</span> <span style="line-height:1.5;color:rgb(0,0,204);">=</span> <span style="line-height:1.5;color:rgb(255,0,255);">""</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(255,0,0);">int</span> <span style="line-height:1.5;color:rgb(255,0,0);">len</span> <span style="line-height:1.5;color:rgb(0,0,204);">=</span> 0<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(255,0,0);">len</span> <span style="line-height:1.5;color:rgb(0,0,204);">=</span> read<span style="line-height:1.5;color:rgb(0,0,204);">(</span>THREAD_FD<span style="line-height:1.5;color:rgb(0,0,204);">(</span>thread<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">,</span> buf<span style="line-height:1.5;color:rgb(0,0,204);">,</span> 1024<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span>    <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> printf<span style="line-height:1.5;color:rgb(0,0,204);">(</span><span style="line-height:1.5;color:rgb(255,0,255);">"len:%d, %s"</span><span style="line-height:1.5;color:rgb(0,0,204);">,</span> <span style="line-height:1.5;color:rgb(255,0,0);">len</span><span style="line-height:1.5;color:rgb(0,0,204);">,</span> buf<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> return 0<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(0,0,204);">}</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(255,0,0);">int</span> main<span style="line-height:1.5;color:rgb(0,0,204);">(</span><span style="line-height:1.5;color:rgb(0,0,204);">)</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(0,0,204);">{<!-- --></span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     struct thread thread<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span> 创建线程管理者<br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     struct thread_master <span style="line-height:1.5;color:rgb(0,0,204);">*</span>master <span style="line-height:1.5;color:rgb(0,0,204);">=</span> thread_master_create<span style="line-height:1.5;color:rgb(0,0,204);">(</span><span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span>    <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span> 创建读线程，读线程处理的描述符是标准输入0，处理函数为do_accept<br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     thread_add_read<span style="line-height:1.5;color:rgb(0,0,204);">(</span>master<span style="line-height:1.5;color:rgb(0,0,204);">,</span> do_accept<span style="line-height:1.5;color:rgb(0,0,204);">,</span> <span style="line-height:1.5;color:rgb(0,0,255);">NULL</span><span style="line-height:1.5;color:rgb(0,0,204);">,</span> fileno<span style="line-height:1.5;color:rgb(0,0,204);">(</span>stdin<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span> 打印当前线程管理者中的所有线程<br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     thread_master_debug<span style="line-height:1.5;color:rgb(0,0,204);">(</span>master<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span> thread_fetch select所有的描述符，一旦侦听的描述符需要处理就将对应的”线程”        的地址通过thread返回<br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(0,0,255);">while</span><span style="line-height:1.5;color:rgb(0,0,204);">(</span>thread_fetch<span style="line-height:1.5;color:rgb(0,0,204);">(</span>master<span style="line-height:1.5;color:rgb(0,0,204);">,</span> <span style="line-height:1.5;color:rgb(0,0,204);">&amp;</span>thread<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">)</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(0,0,204);">{<!-- --></span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">      <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span> 执行处理函数<br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">        thread_call<span style="line-height:1.5;color:rgb(0,0,204);">(</span><span style="line-height:1.5;color:rgb(0,0,204);">&amp;</span>thread<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">        thread_master_debug<span style="line-height:1.5;color:rgb(0,0,204);">(</span>master<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">       <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span> 这里为什么需要再次添加呢？<br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">       thread_add_read<span style="line-height:1.5;color:rgb(0,0,204);">(</span>master<span style="line-height:1.5;color:rgb(0,0,204);">,</span> do_accept<span style="line-height:1.5;color:rgb(0,0,204);">,</span> <span style="line-height:1.5;color:rgb(0,0,255);">NULL</span><span style="line-height:1.5;color:rgb(0,0,204);">,</span> fileno<span style="line-height:1.5;color:rgb(0,0,204);">(</span>stdin<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">       thread_master_debug<span style="line-height:1.5;color:rgb(0,0,204);">(</span>master<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(0,0,204);">}</span>    <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     return 0<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(0,0,204);">}</span></li></ol> 
 </div> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"> </span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">编译执行，得到如下的结果：<br> // 这里readlist链表中加入了一个"线程"，其他链表为空<br> -----------<br> readlist  : count [1] head [0x93241d8] tail [0x93241d8] <br> writelist : count [0] head [(nil)] tail [(nil)]<br> timerlist : count [0] head [(nil)] tail [(nil)]<br> eventlist : count [0] head [(nil)] tail [(nil)]<br> unuselist : count [0] head [(nil)] tail [(nil)]<br> total alloc: [1]<br> -----------<br> // 输入hello，回车<br> Hello</span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">// thread_call调用do_accept进行了操作<br> len:6, hello</span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">// 发现“线程“被移入了unuselist<br> -----------<br> readlist  : count [0] head [(nil)] tail [(nil)]<br> writelist : count [0] head [(nil)] tail [(nil)]<br> timerlist : count [0] head [(nil)] tail [(nil)]<br> eventlist : count [0] head [(nil)] tail [(nil)]<br> unuselist : count [1] head [0x93241d8] tail [0x93241d8]<br> total alloc: [1]<br> -----------</span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">//再次调用thread_add_read发现unuselist被清空，并且”线程“再次加入readlist<br> -----------<br> readlist  : count [1] head [0x93241d8] tail [0x93241d8]<br> writelist : count [0] head [(nil)] tail [(nil)]<br> timerlist : count [0] head [(nil)] tail [(nil)]<br> eventlist : count [0] head [(nil)] tail [(nil)]<br> unuselist : count [0] head [(nil)] tail [(nil)]<br> total alloc: [1]<br> -----------<br></span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"><strong>1.4 thread_fetch 和thread_process_fd</strong></span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"><strong><br></strong>顾名思义，thread_fetch是用来获取需要执行的线程的，它是整个程序的核心。这里需要对它进行重点的分析。</span></p> 
 <div class="codeText" style="font-family:Consolas, monospace;color:rgb(51,51,51);font-size:14px;border:1px solid rgb(221,221,221);width:658px;line-height:1.5;"> 
  <ol class="dp-css" style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;list-style-position:outside;line-height:1.3;color:rgb(92,92,92);"><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(0,0,0);">struct thread <span style="line-height:1.5;color:rgb(0,0,204);">*</span>thread_fetch<span style="line-height:1.5;color:rgb(0,0,204);">(</span>struct thread_master <span style="line-height:1.5;color:rgb(0,0,204);">*</span>m<span style="line-height:1.5;color:rgb(0,0,204);">,</span> struct thread <span style="line-height:1.5;color:rgb(0,0,204);">*</span>fetch<span style="line-height:1.5;color:rgb(0,0,204);">)</span><br></span></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(0,0,204);">{<!-- --></span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   <span style="line-height:1.5;color:rgb(255,0,0);">int</span> num<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   <span style="line-height:1.5;color:rgb(255,0,0);">int</span> ready<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   struct thread <span style="line-height:1.5;color:rgb(0,0,204);">*</span>thread<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   fd_set readfd<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   fd_set writefd<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   fd_set exceptfd<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   struct timeval timer_now<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   struct timeval timer_val<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   struct timeval <span style="line-height:1.5;color:rgb(0,0,204);">*</span>timer_wait<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   struct timeval timer_nowait<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   timer_nowait<span style="line-height:1.5;color:rgb(0,0,204);">.</span>tv_sec <span style="line-height:1.5;color:rgb(0,0,204);">=</span> 0<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   timer_nowait<span style="line-height:1.5;color:rgb(0,0,204);">.</span>tv_usec <span style="line-height:1.5;color:rgb(0,0,204);">=</span> 0<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   <span style="line-height:1.5;color:rgb(0,0,255);">while</span><span style="line-height:1.5;color:rgb(0,0,204);">(</span>1<span style="line-height:1.5;color:rgb(0,0,204);">)</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   <span style="line-height:1.5;color:rgb(0,0,204);">{<!-- --></span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">*</span> 最先处理event队列 <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(0,0,255);">if</span><span style="line-height:1.5;color:rgb(0,0,204);">(</span><span style="line-height:1.5;color:rgb(0,0,204);">(</span>thread <span style="line-height:1.5;color:rgb(0,0,204);">=</span> thread_trim_head<span style="line-height:1.5;color:rgb(0,0,204);">(</span><span style="line-height:1.5;color:rgb(0,0,204);">&amp;</span>m<span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">&gt;</span>event<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">)</span> <span style="line-height:1.5;color:rgb(0,0,204);">!</span><span style="line-height:1.5;color:rgb(0,0,204);">=</span> <span style="line-height:1.5;color:rgb(0,0,255);">NULL</span><span style="line-height:1.5;color:rgb(0,0,204);">)</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">             return thread_run<span style="line-height:1.5;color:rgb(0,0,204);">(</span>m<span style="line-height:1.5;color:rgb(0,0,204);">,</span> thread<span style="line-height:1.5;color:rgb(0,0,204);">,</span> fetch<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">*</span> 接着处理timer队列 <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     gettimeofday<span style="line-height:1.5;color:rgb(0,0,204);">(</span><span style="line-height:1.5;color:rgb(0,0,204);">&amp;</span>timer_now<span style="line-height:1.5;color:rgb(0,0,204);">,</span> <span style="line-height:1.5;color:rgb(0,0,255);">NULL</span><span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(0,0,255);">for</span><span style="line-height:1.5;color:rgb(0,0,204);">(</span>thread <span style="line-height:1.5;color:rgb(0,0,204);">=</span> m<span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">&gt;</span>timer<span style="line-height:1.5;color:rgb(0,0,204);">.</span>head<span style="line-height:1.5;color:rgb(0,0,204);">;</span> thread<span style="line-height:1.5;color:rgb(0,0,204);">;</span> thread <span style="line-height:1.5;color:rgb(0,0,204);">=</span> thread<span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">&gt;</span><span style="line-height:1.5;color:rgb(0,0,255);">next</span><span style="line-height:1.5;color:rgb(0,0,204);">)</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(0,0,204);">{<!-- --></span> <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">        <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">*</span> 所有到时间的线程均将被处理 <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">         <span style="line-height:1.5;color:rgb(0,0,255);">if</span><span style="line-height:1.5;color:rgb(0,0,204);">(</span>timeval_cmp<span style="line-height:1.5;color:rgb(0,0,204);">(</span>timer_now<span style="line-height:1.5;color:rgb(0,0,204);">,</span> thread<span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">&gt;</span>u<span style="line-height:1.5;color:rgb(0,0,204);">.</span>sands<span style="line-height:1.5;color:rgb(0,0,204);">)</span> <span style="line-height:1.5;color:rgb(0,0,204);">&gt;</span><span style="line-height:1.5;color:rgb(0,0,204);">=</span> 0<span style="line-height:1.5;color:rgb(0,0,204);">)</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">          <span style="line-height:1.5;color:rgb(0,0,204);">{<!-- --></span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">          thread_list_delete<span style="line-height:1.5;color:rgb(0,0,204);">(</span><span style="line-height:1.5;color:rgb(0,0,204);">&amp;</span>m<span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">&gt;</span>timer<span style="line-height:1.5;color:rgb(0,0,204);">,</span> thread<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">          return thread_run<span style="line-height:1.5;color:rgb(0,0,204);">(</span>m<span style="line-height:1.5;color:rgb(0,0,204);">,</span> thread<span style="line-height:1.5;color:rgb(0,0,204);">,</span> fetch<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">         <span style="line-height:1.5;color:rgb(0,0,204);">}</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(0,0,204);">}</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">*</span> 处理ready中的线程 <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(0,0,255);">if</span><span style="line-height:1.5;color:rgb(0,0,204);">(</span><span style="line-height:1.5;color:rgb(0,0,204);">(</span>thread <span style="line-height:1.5;color:rgb(0,0,204);">=</span> thread_trim_head <span style="line-height:1.5;color:rgb(0,0,204);">(</span><span style="line-height:1.5;color:rgb(0,0,204);">&amp;</span>m<span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">&gt;</span>ready<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">)</span> <span style="line-height:1.5;color:rgb(0,0,204);">!</span><span style="line-height:1.5;color:rgb(0,0,204);">=</span> <span style="line-height:1.5;color:rgb(0,0,255);">NULL</span><span style="line-height:1.5;color:rgb(0,0,204);">)</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">        return thread_run<span style="line-height:1.5;color:rgb(0,0,204);">(</span>m<span style="line-height:1.5;color:rgb(0,0,204);">,</span> thread<span style="line-height:1.5;color:rgb(0,0,204);">,</span> fetch<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">*</span> Structure copy<span style="line-height:1.5;color:rgb(0,0,204);">.</span> <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     readfd <span style="line-height:1.5;color:rgb(0,0,204);">=</span> m<span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">&gt;</span>readfd<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     writefd <span style="line-height:1.5;color:rgb(0,0,204);">=</span> m<span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">&gt;</span>writefd<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     exceptfd <span style="line-height:1.5;color:rgb(0,0,204);">=</span> m<span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">&gt;</span>exceptfd<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">*</span> Calculate <span style="line-height:1.5;color:rgb(0,0,255);">select</span> wait timer<span style="line-height:1.5;color:rgb(0,0,204);">.</span> <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     timer_wait <span style="line-height:1.5;color:rgb(0,0,204);">=</span> thread_timer_wait<span style="line-height:1.5;color:rgb(0,0,204);">(</span>m<span style="line-height:1.5;color:rgb(0,0,204);">,</span> <span style="line-height:1.5;color:rgb(0,0,204);">&amp;</span>timer_val<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">*</span> 对所有描述符进行listen <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     num <span style="line-height:1.5;color:rgb(0,0,204);">=</span> <span style="line-height:1.5;color:rgb(0,0,255);">select</span><span style="line-height:1.5;color:rgb(0,0,204);">(</span>FD_SETSIZE<span style="line-height:1.5;color:rgb(0,0,204);">,</span> <span style="line-height:1.5;color:rgb(0,0,204);">&amp;</span>readfd<span style="line-height:1.5;color:rgb(0,0,204);">,</span> <span style="line-height:1.5;color:rgb(0,0,204);">&amp;</span>writefd<span style="line-height:1.5;color:rgb(0,0,204);">,</span> <span style="line-height:1.5;color:rgb(0,0,204);">&amp;</span>exceptfd<span style="line-height:1.5;color:rgb(0,0,204);">,</span> timer_wait<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">         xprintf<span style="line-height:1.5;color:rgb(0,0,204);">(</span><span style="line-height:1.5;color:rgb(255,0,255);">"select num:%d\n"</span><span style="line-height:1.5;color:rgb(0,0,204);">,</span> num<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(0,0,255);">if</span><span style="line-height:1.5;color:rgb(0,0,204);">(</span>num <span style="line-height:1.5;color:rgb(0,0,204);">=</span><span style="line-height:1.5;color:rgb(0,0,204);">=</span> 0<span style="line-height:1.5;color:rgb(0,0,204);">)</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">             continue<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(0,0,255);">if</span><span style="line-height:1.5;color:rgb(0,0,204);">(</span>num <span style="line-height:1.5;color:rgb(0,0,204);">&lt;</span> 0<span style="line-height:1.5;color:rgb(0,0,204);">)</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(0,0,204);">{<!-- --></span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">          <span style="line-height:1.5;color:rgb(0,0,255);">if</span><span style="line-height:1.5;color:rgb(0,0,204);">(</span>errno <span style="line-height:1.5;color:rgb(0,0,204);">=</span><span style="line-height:1.5;color:rgb(0,0,204);">=</span> EINTR<span style="line-height:1.5;color:rgb(0,0,204);">)</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">          continue<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">          return <span style="line-height:1.5;color:rgb(0,0,255);">NULL</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(0,0,204);">}</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">       <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">*</span> 处理read中线程 <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     ready <span style="line-height:1.5;color:rgb(0,0,204);">=</span> thread_process_fd<span style="line-height:1.5;color:rgb(0,0,204);">(</span>m<span style="line-height:1.5;color:rgb(0,0,204);">,</span> <span style="line-height:1.5;color:rgb(0,0,204);">&amp;</span>m<span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">&gt;</span>read<span style="line-height:1.5;color:rgb(0,0,204);">,</span> <span style="line-height:1.5;color:rgb(0,0,204);">&amp;</span>readfd<span style="line-height:1.5;color:rgb(0,0,204);">,</span> <span style="line-height:1.5;color:rgb(0,0,204);">&amp;</span>m<span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">&gt;</span>readfd<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">       <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">*</span> 处理 write中线程 <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span> <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">       ready <span style="line-height:1.5;color:rgb(0,0,204);">=</span> thread_process_fd<span style="line-height:1.5;color:rgb(0,0,204);">(</span>m<span style="line-height:1.5;color:rgb(0,0,204);">,</span> <span style="line-height:1.5;color:rgb(0,0,204);">&amp;</span>m<span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">&gt;</span>write<span style="line-height:1.5;color:rgb(0,0,204);">,</span> <span style="line-height:1.5;color:rgb(0,0,204);">&amp;</span>writefd<span style="line-height:1.5;color:rgb(0,0,204);">,</span> <span style="line-height:1.5;color:rgb(0,0,204);">&amp;</span>m<span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">&gt;</span>writefd<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">       <span style="line-height:1.5;color:rgb(0,0,255);">if</span><span style="line-height:1.5;color:rgb(0,0,204);">(</span><span style="line-height:1.5;color:rgb(0,0,204);">(</span>thread <span style="line-height:1.5;color:rgb(0,0,204);">=</span> thread_trim_head<span style="line-height:1.5;color:rgb(0,0,204);">(</span><span style="line-height:1.5;color:rgb(0,0,204);">&amp;</span>m<span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">&gt;</span>ready<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">)</span> <span style="line-height:1.5;color:rgb(0,0,204);">!</span><span style="line-height:1.5;color:rgb(0,0,204);">=</span> <span style="line-height:1.5;color:rgb(0,0,255);">NULL</span><span style="line-height:1.5;color:rgb(0,0,204);">)</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">        return thread_run<span style="line-height:1.5;color:rgb(0,0,204);">(</span>m<span style="line-height:1.5;color:rgb(0,0,204);">,</span> thread<span style="line-height:1.5;color:rgb(0,0,204);">,</span> fetch<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   <span style="line-height:1.5;color:rgb(0,0,204);">}</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(0,0,204);">}</span></li></ol> 
 </div> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">显然，Zebra中的thread机制并没有真正的优先级，而只是在处理的时候有些处理一些队列。他们的次序是：event、timer、 ready、 read和write。后面代码分析会得出read和write并没有明显的先后，因为它们最终都将被移入ready然后再被依次执行。而select同 时收到多个描述符事件的概率是很低的。</span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"> </span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">thread_process_fd对于read和write线程来说是另一个关键的函数。</span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"> </span></p> 
 <div class="codeText" style="font-family:Consolas, monospace;color:rgb(51,51,51);font-size:14px;border:1px solid rgb(221,221,221);width:658px;line-height:1.5;"> 
  <ol class="dp-css" style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;list-style-position:outside;line-height:1.3;color:rgb(92,92,92);"><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(0,0,0);"><span style="line-height:1.5;color:rgb(255,0,0);">Int</span> thread_process_fd <span style="line-height:1.5;color:rgb(0,0,204);">(</span>struct thread_master <span style="line-height:1.5;color:rgb(0,0,204);">*</span>m<span style="line-height:1.5;color:rgb(0,0,204);">,</span> struct thread_list <span style="line-height:1.5;color:rgb(0,0,204);">*</span>list<span style="line-height:1.5;color:rgb(0,0,204);">,</span><br></span></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">          fd_set <span style="line-height:1.5;color:rgb(0,0,204);">*</span>fdset<span style="line-height:1.5;color:rgb(0,0,204);">,</span> fd_set <span style="line-height:1.5;color:rgb(0,0,204);">*</span>mfdset<span style="line-height:1.5;color:rgb(0,0,204);">)</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(0,0,204);">{<!-- --></span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   struct thread <span style="line-height:1.5;color:rgb(0,0,204);">*</span>thread<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   struct thread <span style="line-height:1.5;color:rgb(0,0,204);">*</span><span style="line-height:1.5;color:rgb(0,0,255);">next</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   <span style="line-height:1.5;color:rgb(255,0,0);">int</span> ready <span style="line-height:1.5;color:rgb(0,0,204);">=</span> 0<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   <span style="line-height:1.5;color:rgb(0,0,255);">for</span> <span style="line-height:1.5;color:rgb(0,0,204);">(</span>thread <span style="line-height:1.5;color:rgb(0,0,204);">=</span> list<span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">&gt;</span>head<span style="line-height:1.5;color:rgb(0,0,204);">;</span> thread<span style="line-height:1.5;color:rgb(0,0,204);">;</span> thread <span style="line-height:1.5;color:rgb(0,0,204);">=</span> <span style="line-height:1.5;color:rgb(0,0,255);">next</span><span style="line-height:1.5;color:rgb(0,0,204);">)</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   <span style="line-height:1.5;color:rgb(0,0,204);">{<!-- --></span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">       <span style="line-height:1.5;color:rgb(0,0,255);">next</span> <span style="line-height:1.5;color:rgb(0,0,204);">=</span> thread<span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">&gt;</span><span style="line-height:1.5;color:rgb(0,0,255);">next</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">       <span style="line-height:1.5;color:rgb(0,0,255);">if</span> <span style="line-height:1.5;color:rgb(0,0,204);">(</span>FD_ISSET <span style="line-height:1.5;color:rgb(0,0,204);">(</span>THREAD_FD <span style="line-height:1.5;color:rgb(0,0,204);">(</span>thread<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">,</span> fdset<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">)</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">      <span style="line-height:1.5;color:rgb(0,0,204);">{<!-- --></span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">      assert <span style="line-height:1.5;color:rgb(0,0,204);">(</span>FD_ISSET <span style="line-height:1.5;color:rgb(0,0,204);">(</span>THREAD_FD <span style="line-height:1.5;color:rgb(0,0,204);">(</span>thread<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">,</span> mfdset<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">      FD_CLR<span style="line-height:1.5;color:rgb(0,0,204);">(</span>THREAD_FD <span style="line-height:1.5;color:rgb(0,0,204);">(</span>thread<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">,</span> mfdset<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">  <span style="line-height:1.5;color:rgb(0,0,204);">/</span><span style="line-height:1.5;color:rgb(0,0,204);">/</span> 将侦听到的描述符对应的线程移到ready链表中<br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">      thread_list_delete <span style="line-height:1.5;color:rgb(0,0,204);">(</span>list<span style="line-height:1.5;color:rgb(0,0,204);">,</span> thread<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">      thread_list_add <span style="line-height:1.5;color:rgb(0,0,204);">(</span><span style="line-height:1.5;color:rgb(0,0,204);">&amp;</span>m<span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">&gt;</span>ready<span style="line-height:1.5;color:rgb(0,0,204);">,</span> thread<span style="line-height:1.5;color:rgb(0,0,204);">)</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">      thread<span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">&gt;</span>type <span style="line-height:1.5;color:rgb(0,0,204);">=</span> THREAD_READY<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">      ready<span style="line-height:1.5;color:rgb(0,0,204);">+</span><span style="line-height:1.5;color:rgb(0,0,204);">+</span><span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(0,0,204);">}</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">     <span style="line-height:1.5;color:rgb(0,0,204);">}</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">   return ready<span style="line-height:1.5;color:rgb(0,0,204);">;</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(0,0,204);">}</span></li></ol> 
 </div> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">Thread_process_fd 将侦听到的描述符对应的线程移到ready链表中，并且进行文件描述的清除操作，文件描述符的添加在thread_add_read和thread_add_write中进行。</span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"> </span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"><strong>1.5 thread中的其他链表</strong></span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"><strong></strong> </span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">write链表的操作类似于read链表，而event链表是直接操作的。timer链表只是添加对时间的比对操作。<br> 在加入对应的链表时，使用不同的添加函数。<br> struct thread *<br> thread_add_read (struct thread_master *m, int (*func) (struct thread *), void *arg, int fd);<br> struct thread *thread_add_write (struct thread_master *m, int (*func) (struct thread *), void *arg, int fd);<br> struct thread *thread_add_event (struct thread_master *m, int (*func) (struct thread *), void *arg, int fd);<br> struct thread *thread_add_timer (struct thread_master *m, int (*func) (struct thread *), void *arg, int fd);</span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"> </span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"><strong>1.6 thread 机制中的其他函数</strong></span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"><strong></strong> </span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">//执行thread<br> void thread_call (struct thread *thread);</span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">//直接创建并执行，m参数可以为NULL<br> struct thread *thread_execute (struct thread_master *m,<br> int (*func)(struct thread *),  void *arg,  int val);</span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">//取消一个线程，thread中的master指针不可为空<br> void thread_cancel (struct thread *thread);</span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">//取消所有event链表中的参数为arg的线程<br> void thread_cancel_event (struct thread_master *m, void *arg);</span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">//类似于thread_call，区别是thread_call只是执行，不将其加入unuse链表。thread_run执行后会将其加入unuse链表。<br> struct thread *thread_run (struct thread_master *m, struct thread *thread,  struct thread *fetch);</span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">// 释放m及其中的线程链表<br> void thread_master_free (struct thread_master *m);</span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"> </span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"><strong>1.7 一些时间相关的函数</strong></span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"><strong></strong> </span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">static struct timeval timeval_subtract (struct timeval a, struct timeval b);</span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">static int timeval_cmp (struct timeval a, struct timeval b);<br> 当然也提供了简单的DEBUG函数thread_master_debug。</span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"> </span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"><strong>2.对ZEBRA中thread的应用</strong></span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"><strong></strong> </span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">对thread的应用的探讨是最重要的，也是最根本的。ZEBRA的thread机制，模拟了线程，便于平台间的移植，使流水线式的程序编码模块化，结构化。</span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"><br> 线程列表间的组合很容易实现状态机的功能。可以自定义应用层通信协议。比如我们定义一个sysstat的远程监控协议。 Client请求Server，请求Code 可以为SYS_MEM,SYS_RUNTIME,SYS_LOG等信息获取动作，也可以是SYS_REBOOT，SYS_SETTIME等动作请求, Server回应这个SYS_MEM等的结果。通常这很简单，但是如果我们需要添加一些步骤，比如用户验证过程呢？</span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"><br>  </span></p> 
 <div class="codeText" style="font-family:Consolas, monospace;color:rgb(51,51,51);font-size:14px;border:1px solid rgb(221,221,221);width:658px;line-height:1.5;"> 
  <ol class="dp-css" style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;list-style-position:outside;line-height:1.3;color:rgb(92,92,92);"><li>   </li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> <span style="line-height:1.5;color:rgb(0,0,0);">              Request Auth<br></span></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> Client<span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">&gt;</span>Server<br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">               Response PWD<span style="line-height:1.5;color:rgb(0,0,204);">?</span><br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> Client<span style="line-height:1.5;color:rgb(0,0,204);">&lt;</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span>Server<br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">               Provide PWD<br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> Client<span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">&gt;</span>Server<br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">               Auth Result<br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> Client<span style="line-height:1.5;color:rgb(0,0,204);">&lt;</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span>Server<br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">               SYS_LOG<br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> Client<span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">&gt;</span>Server<br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;">               SYS_LOG_INFO<br></li><li style="list-style-type:decimal;list-style-position:outside;line-height:1.5;"> Client<span style="line-height:1.5;color:rgb(0,0,204);">&lt;</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span><span style="line-height:1.5;color:rgb(0,0,204);">-</span>Server</li></ol> 
 </div> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"> </span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">再考虑三次认证错误触发黑名单事件！状态机就是在处理完上一事件后，添加不同的事件线程。</span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"><br>  </span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"><strong>3.对ZEBRA的思考</strong></span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;"> </span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">Zebra由Kunihiro Ishiguro开发于15年前，Kunihiro Ishiguro离开了Zebra，而后它的名字被改成了quagga，以至于在因特网上输入Zebra后，你得到只有斑马的注释。Zebra提供了一整 套基于TCP/IP网络的路由协议的支持，如RIPv1，RIPv2的，RIPng，OSPFv2，OSPFv3，BGP等，然而它的亮点并不在于此，而 在于它对程序架构的组织，你可以容易的剥离它，使他成为专用的cli程序，也已可以轻易的提取其中的一类数据结构，也可以借用他的thread机制实现复 杂的状态机。</span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">编码的价值往往不在于写了多少，而在于对他们的组织！好的组织体现美好的架构、设计的艺术，可以给人启迪，并在此基础上激发出更多的灵感。如果一个 初学者想学习程序设计的架构，无疑选择Zebra是一个明智的选择，你不仅可以学到各种数据结构，基于C的面向对象设计，还有CLI，以及各种网络路由协 议，最重要是的Zebra条理清晰，代码紧凑，至少不会让你焦头烂额！</span></p> 
 <p style="font-family:'宋体', Arial;color:rgb(51,51,51);font-size:14px;line-height:1.5;"> <span style="font-family:'WenQuanYi Micro Hei Mono', 'WenQuanYi Micro Hei', 'Microsoft Yahei Mono', 'Microsoft Yahei', sans-serif;">如果你不知道代码中的xprintf是怎么一回事，那么看看另一篇文章《<a href="http://blog.chinaunix.net/link.php?url=http://blog.chinaunix.net%2Fspace.php%3Fuid%3D20608849%26amp%3Bdo%3Dblog%26amp%3Bid%3D365933" rel="nofollow" style="color:rgb(99,64,27);text-decoration:none;">一个通用的debug系统</a> 》！</span></p> 
 <br> 
</div> 
<p>转载于:https://www.cnblogs.com/iplus/archive/2013/03/18/4467312.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ff11be484d35d06f495018ea459a4c14/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">qjh.py</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d6479a717308a69a5a72efcbedec2345/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">office使用技巧</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>