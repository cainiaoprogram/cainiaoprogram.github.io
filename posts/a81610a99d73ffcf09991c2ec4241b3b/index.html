<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C#读写各类文件合集 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="C#读写各类文件合集" />
<meta property="og:description" content="C#文件操作合集 一、利用字节流与文件流读写txt、json文件1.以文件的方式进行操作2.以文件流的方式进行读写3.以二进制数据流的方式进行读写4.以文本流的方式进行读写5.JOSN文件的读写 二、kernel32读写ini文件三、XML文件的读写1.DataSet读取操作2.使用Json.Net转换读取3.使用XmlDocument读取4.使用XmlTextReader读取5.使用 Linq to Xml读取 四、EXCEL文件的读写1.以NPOI的方式读写2.以ClosedXML的方式读写3.以Spire.Xls的方式读写4.以EPPlus的方式读写 五、CSV文件的读取 一、利用字节流与文件流读写txt、json文件 1.以文件的方式进行操作 适用于小型文本全文的读取和写入。
首先创建C#窗体程序，然后写入以下代码：
string filePath = @&#34;D:\Test_C#\TestTxt.txt&#34;; // 1、文件操作类(File) void FileDo() { string ret = &#34;&#34;; #region 读取 { //File.ReadAllBytes打开一个二进制文件，将文件的内容读入一个字节数组，然后关闭该文件。因为可以读取到每个字节 所以可以处理所有类型的文件 byte[] buffer1 = File.ReadAllBytes(filePath); //File.ReadAllText 打开一个文本文件，将文件中的所有文本读取到一个字符串中，然后关闭此文件。 string alltxt = File.ReadAllText(filePath); string[] lines = File.ReadAllLines(filePath); ret = Encoding.UTF8.GetString(buffer1); Console.WriteLine(ret); } #endregion #region 写入 { //覆盖式写入 byte[] buffer2 = Encoding.UTF8.GetBytes(ret&#43;&#34;\n黄河入海流&#34;); //File.WriteAllBytes创建一个新文件，在其中写入指定的字节数组，然后关闭该文件。 如果目标文件已存在，则覆盖该文件。 File.WriteAllBytes(filePath, buffer2); //File.WriteAllText 创建一个新文件，向其中写入内容，然后关闭文件。 如果目标文件已存在，则覆盖该文件。 File.WriteAllText(filePath2, ret); } #endregion } 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a81610a99d73ffcf09991c2ec4241b3b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-08T17:28:44+08:00" />
<meta property="article:modified_time" content="2022-09-08T17:28:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C#读写各类文件合集</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>C#文件操作合集</h4> 
 <ul><li><a href="#txtjson_2" rel="nofollow">一、利用字节流与文件流读写txt、json文件</a></li><li><ul><li><a href="#1_3" rel="nofollow">1.以文件的方式进行操作</a></li><li><a href="#2_36" rel="nofollow">2.以文件流的方式进行读写</a></li><li><a href="#3_70" rel="nofollow">3.以二进制数据流的方式进行读写</a></li><li><a href="#4_97" rel="nofollow">4.以文本流的方式进行读写</a></li><li><a href="#5JOSN_121" rel="nofollow">5.JOSN文件的读写</a></li></ul> 
  </li><li><a href="#kernel32ini_174" rel="nofollow">二、kernel32读写ini文件</a></li><li><a href="#XML_233" rel="nofollow">三、XML文件的读写</a></li><li><ul><li><a href="#1DataSet_234" rel="nofollow">1.DataSet读取操作</a></li><li><a href="#2JsonNet_298" rel="nofollow">2.使用Json.Net转换读取</a></li><li><a href="#3XmlDocument_315" rel="nofollow">3.使用XmlDocument读取</a></li><li><a href="#4XmlTextReader_379" rel="nofollow">4.使用XmlTextReader读取</a></li><li><a href="#5_Linq_to_Xml_420" rel="nofollow">5.使用 Linq to Xml读取</a></li></ul> 
  </li><li><a href="#EXCEL_438" rel="nofollow">四、EXCEL文件的读写</a></li><li><ul><li><a href="#1NPOI_440" rel="nofollow">1.以NPOI的方式读写</a></li><li><a href="#2ClosedXML_466" rel="nofollow">2.以ClosedXML的方式读写</a></li><li><a href="#3SpireXls_481" rel="nofollow">3.以Spire.Xls的方式读写</a></li><li><a href="#4EPPlus_497" rel="nofollow">4.以EPPlus的方式读写</a></li></ul> 
  </li><li><a href="#CSV_515" rel="nofollow">五、CSV文件的读取</a></li></ul> 
</div> 
<p></p> 
<h2><a id="txtjson_2"></a>一、利用字节流与文件流读写txt、json文件</h2> 
<h3><a id="1_3"></a>1.以文件的方式进行操作</h3> 
<p>适用于小型文本全文的读取和写入。<br> 首先创建C#窗体程序，然后写入以下代码：</p> 
<pre><code class="prism language-javascript">string filePath <span class="token operator">=</span> @<span class="token string">"D:\Test_C#\TestTxt.txt"</span><span class="token punctuation">;</span>
<span class="token comment">// 1、文件操作类(File)</span>
<span class="token keyword">void</span> <span class="token function">FileDo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    string ret <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    #region 读取
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//File.ReadAllBytes打开一个二进制文件，将文件的内容读入一个字节数组，然后关闭该文件。因为可以读取到每个字节 所以可以处理所有类型的文件</span>
        byte<span class="token punctuation">[</span><span class="token punctuation">]</span> buffer1 <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">ReadAllBytes</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//File.ReadAllText 打开一个文本文件，将文件中的所有文本读取到一个字符串中，然后关闭此文件。</span>
        string alltxt <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">ReadAllText</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        string<span class="token punctuation">[</span><span class="token punctuation">]</span> lines <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">ReadAllLines</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ret <span class="token operator">=</span> Encoding<span class="token punctuation">.</span><span class="token constant">UTF8</span><span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>buffer1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    #endregion

    #region 写入
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//覆盖式写入</span>
        byte<span class="token punctuation">[</span><span class="token punctuation">]</span> buffer2 <span class="token operator">=</span> Encoding<span class="token punctuation">.</span><span class="token constant">UTF8</span><span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>ret<span class="token operator">+</span><span class="token string">"\n黄河入海流"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//File.WriteAllBytes创建一个新文件，在其中写入指定的字节数组，然后关闭该文件。 如果目标文件已存在，则覆盖该文件。</span>
        File<span class="token punctuation">.</span><span class="token function">WriteAllBytes</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> buffer2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//File.WriteAllText 创建一个新文件，向其中写入内容，然后关闭文件。 如果目标文件已存在，则覆盖该文件。</span>
        File<span class="token punctuation">.</span><span class="token function">WriteAllText</span><span class="token punctuation">(</span>filePath2<span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    #endregion
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="2_36"></a>2.以文件流的方式进行读写</h3> 
<pre><code class="prism language-javascript"><span class="token keyword">void</span> <span class="token function">FileStreamDo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    #region 读取
    byte<span class="token punctuation">[</span><span class="token punctuation">]</span> buffer<span class="token punctuation">;</span>
    <span class="token comment">//方式1</span>
    <span class="token comment">//1.FileStream文件流——这个类主要用于在二进制文件中读写二进制数据。</span>
    <span class="token comment">//FileStream类操作字节和字节数组,有些操作比如随机文件访问（访问文件中间某点的数据），就必须由FileStream对象执行。</span>
    <span class="token function">using</span> <span class="token punctuation">(</span>FileStream fs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileStream</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span>fs<span class="token punctuation">.</span>Length<span class="token punctuation">]</span><span class="token punctuation">;</span>
        fs<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//2.StreamReader（流读取器）和StreamWriter（流写入器）这两个类专门用于文本格式的流产品API</span>
    <span class="token comment">//3.BinaryReader和BinaryWriter这两个类专门用于读写二进制格式的流产品API.</span>
    <span class="token comment">//方式2</span>
    <span class="token comment">//using (FileStream fs = File.OpenRead(filePath))</span>
    <span class="token comment">//{<!-- --></span>
    <span class="token comment">//    buffer = new byte[fs.Length];</span>
    <span class="token comment">//    fs.Read(buffer, 0, buffer.Length);</span>
    <span class="token comment">//}</span>
    #endregion
    <span class="token comment">//读取1中文件流，写入2中</span>
    #region 写入
    <span class="token function">using</span> <span class="token punctuation">(</span>FileStream fs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileStream</span><span class="token punctuation">(</span>filePath2<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        buffer <span class="token operator">=</span> Encoding<span class="token punctuation">.</span><span class="token constant">UTF8</span><span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>Encoding<span class="token punctuation">.</span><span class="token constant">UTF8</span><span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"\n欲穷千里目"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fs<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> buffer<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        fs<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    #endregion
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="3_70"></a>3.以二进制数据流的方式进行读写</h3> 
<pre><code class="prism language-javascript"><span class="token keyword">void</span> <span class="token function">BinaryDo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    #region 读取
    byte<span class="token punctuation">[</span><span class="token punctuation">]</span> buffer<span class="token punctuation">;</span>
    <span class="token comment">//方式1</span>
    <span class="token comment">//Stream类操作字符数据。字符数据易于使用</span>
    <span class="token function">using</span> <span class="token punctuation">(</span><span class="token parameter">Stream stream <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>filePath2<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">)</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">using</span> <span class="token punctuation">(</span>BinaryReader reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BinaryReader</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            buffer <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">ReadBytes</span><span class="token punctuation">(</span><span class="token punctuation">(</span>int<span class="token punctuation">)</span>stream<span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将流读入到字节数组中</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    #endregion
    #region 写入
    <span class="token function">using</span> <span class="token punctuation">(</span><span class="token parameter">Stream stream <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>filePath3<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">)</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">using</span> <span class="token punctuation">(</span>BinaryWriter writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BinaryWriter</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            writer<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>Encoding<span class="token punctuation">.</span><span class="token constant">UTF8</span><span class="token punctuation">.</span><span class="token function">GetBytes</span><span class="token punctuation">(</span>Encoding<span class="token punctuation">.</span><span class="token constant">UTF8</span><span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n更上一层楼"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    #endregion
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="4_97"></a>4.以文本流的方式进行读写</h3> 
<pre><code class="prism language-javascript"><span class="token keyword">void</span> <span class="token function">StreamDo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    string text <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    #region 读取
    <span class="token function">using</span> <span class="token punctuation">(</span>StreamReader reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StreamReader</span><span class="token punctuation">(</span>filePath3<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        text <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">ReadToEnd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    #endregion

    #region 写入
    <span class="token function">using</span> <span class="token punctuation">(</span>FileStream fs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileStream</span><span class="token punctuation">(</span>filePath4<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">using</span> <span class="token punctuation">(</span>StreamWriter writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StreamWriter</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            writer<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>text<span class="token operator">+</span><span class="token string">"\nThis is tuesday!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    #endregion
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="5JOSN_121"></a>5.JOSN文件的读写</h3> 
<p>首先安装依赖包</p> 
<pre><code class="prism language-javascript">Install <span class="token operator">-</span> Package Newtonsoft<span class="token punctuation">.</span>Json
</code></pre> 
<p>config.json内容如下：</p> 
<pre><code class="prism language-javascript"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"server"</span><span class="token operator">:</span> <span class="token string">"1.1.1.1"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"user"</span><span class="token operator">:</span> <span class="token string">"sa"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"passwd"</span><span class="token operator">:</span> <span class="token string">"1"</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>代码块入下：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">void</span> <span class="token function">Get_Json</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{<!-- --></span>
        StreamReader reader <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">OpenText</span><span class="token punctuation">(</span>filePath5<span class="token punctuation">)</span><span class="token punctuation">;</span>
        JsonTextReader jsonTextReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonTextReader</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span><span class="token punctuation">;</span>
        JObject jsonObject <span class="token operator">=</span> <span class="token punctuation">(</span>JObject<span class="token punctuation">)</span>JToken<span class="token punctuation">.</span><span class="token function">ReadFrom</span><span class="token punctuation">(</span>jsonTextReader<span class="token punctuation">)</span><span class="token punctuation">;</span>
        string server <span class="token operator">=</span> jsonObject<span class="token punctuation">[</span><span class="token string">"server"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//user ,passwd 类似</span>
        reader<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>Exception ex<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"读取错误"</span> <span class="token operator">+</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">Set_Json</span><span class="token punctuation">(</span><span class="token parameter">string server</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{<!-- --></span>
        StreamReader reader <span class="token operator">=</span> File<span class="token punctuation">.</span><span class="token function">OpenText</span><span class="token punctuation">(</span>filePath5<span class="token punctuation">)</span><span class="token punctuation">;</span>
        JsonTextReader jsonTextReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonTextReader</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span><span class="token punctuation">;</span>
        JObject jsonObject <span class="token operator">=</span> <span class="token punctuation">(</span>JObject<span class="token punctuation">)</span>JToken<span class="token punctuation">.</span><span class="token function">ReadFrom</span><span class="token punctuation">(</span>jsonTextReader<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jsonObject<span class="token punctuation">[</span><span class="token string">"server"</span><span class="token punctuation">]</span> <span class="token operator">=</span> server<span class="token punctuation">;</span> 
        reader<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        string output <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeObject</span><span class="token punctuation">(</span>jsonObject<span class="token punctuation">,</span> Newtonsoft<span class="token punctuation">.</span>Json<span class="token punctuation">.</span>Formatting<span class="token punctuation">.</span>Indented<span class="token punctuation">)</span><span class="token punctuation">;</span>
        File<span class="token punctuation">.</span><span class="token function">WriteAllText</span><span class="token punctuation">(</span>filePath5<span class="token punctuation">,</span> output<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span><span class="token punctuation">(</span>Exception ex<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"写入错误"</span><span class="token operator">+</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//Set_server("1.1.1.2");</span>
<span class="token comment">//Get_server();</span>
</code></pre> 
<h2><a id="kernel32ini_174"></a>二、kernel32读写ini文件</h2> 
<p>创建.ini文件，内容如下：<br> （注意文件编码格式使用ANSI，否则读取会出现乱码）</p> 
<pre><code class="prism language-javascript"><span class="token punctuation">[</span>Information<span class="token punctuation">]</span>
Name<span class="token operator">=</span>醒醒
Gender<span class="token operator">=</span>男
Age<span class="token operator">=</span><span class="token number">35</span>
Region<span class="token operator">=</span>广东
</code></pre> 
<p>然后写入以下代码块：</p> 
<pre><code class="prism language-javascript">string filePath6 <span class="token operator">=</span> @<span class="token string">"D:\Test_C#\temp.ini"</span><span class="token punctuation">;</span>
<span class="token comment">/// 获取值</span>
<span class="token comment">/// &lt;param name="section"&gt;段落名&lt;/param&gt;</span>
<span class="token comment">/// &lt;param name="key"&gt;键名&lt;/param&gt;</span>
<span class="token comment">/// &lt;param name="defval"&gt;读取异常是的缺省值&lt;/param&gt;</span>
<span class="token comment">/// &lt;param name="retval"&gt;键名所对应的的值，没有找到返回空值&lt;/param&gt;</span>
<span class="token comment">/// &lt;param name="size"&gt;返回值允许的大小&lt;/param&gt;</span>
<span class="token comment">/// &lt;param name="filepath"&gt;ini文件的完整路径&lt;/param&gt;</span>
<span class="token punctuation">[</span><span class="token function">DllImport</span><span class="token punctuation">(</span><span class="token string">"kernel32.dll"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">static</span> extern int <span class="token function">GetPrivateProfileString</span><span class="token punctuation">(</span>
            string section<span class="token punctuation">,</span>
            string key<span class="token punctuation">,</span>
            string defval<span class="token punctuation">,</span>
            StringBuilder retval<span class="token punctuation">,</span>
            int size<span class="token punctuation">,</span>
            string filepath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 写入</span>
<span class="token punctuation">[</span><span class="token function">DllImport</span><span class="token punctuation">(</span><span class="token string">"kernel32.dll"</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">static</span> extern int <span class="token function">WritePrivateProfileString</span><span class="token punctuation">(</span>
    string section<span class="token punctuation">,</span>
    string key<span class="token punctuation">,</span>
    string val<span class="token punctuation">,</span>
    string filepath<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取数据</span>
<span class="token keyword">static</span> string <span class="token function">getString</span><span class="token punctuation">(</span><span class="token parameter">string section<span class="token punctuation">,</span> string key<span class="token punctuation">,</span> string def<span class="token punctuation">,</span> string filename</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    StringBuilder sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">GetPrivateProfileString</span><span class="token punctuation">(</span>section<span class="token punctuation">,</span> key<span class="token punctuation">,</span> def<span class="token punctuation">,</span> sb<span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 写入数据</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">writeString</span><span class="token punctuation">(</span><span class="token parameter">string section<span class="token punctuation">,</span> string key<span class="token punctuation">,</span> string val<span class="token punctuation">,</span> string filename</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">WritePrivateProfileString</span><span class="token punctuation">(</span>section<span class="token punctuation">,</span> key<span class="token punctuation">,</span> val<span class="token punctuation">,</span> filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//调用上述方法</span>
<span class="token keyword">void</span> <span class="token function">IniDO</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    string names <span class="token operator">=</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"Information"</span><span class="token punctuation">,</span> <span class="token string">"Name"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> filePath6<span class="token punctuation">)</span><span class="token punctuation">;</span>
    string gender <span class="token operator">=</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"Information"</span><span class="token punctuation">,</span> <span class="token string">"Gender"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> filePath6<span class="token punctuation">)</span><span class="token punctuation">;</span>
    string age <span class="token operator">=</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"Information"</span><span class="token punctuation">,</span> <span class="token string">"Age"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> filePath6<span class="token punctuation">)</span><span class="token punctuation">;</span>
    string region <span class="token operator">=</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"Information"</span><span class="token punctuation">,</span> <span class="token string">"Region"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> filePath6<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"名称："</span><span class="token operator">+</span>names<span class="token operator">+</span><span class="token string">"\n性别:"</span><span class="token operator">+</span> gender <span class="token operator">+</span> <span class="token string">"\n年龄:"</span><span class="token operator">+</span> age <span class="token operator">+</span> <span class="token string">"\n籍贯:"</span> <span class="token operator">+</span> region<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//IniDO();</span>
</code></pre> 
<h2><a id="XML_233"></a>三、XML文件的读写</h2> 
<h3><a id="1DataSet_234"></a>1.DataSet读取操作</h3> 
<p>创建两个.xml文件，内容如下：<br> 不带ID的文件</p> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span> <span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>studentList<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>student<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>张三<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>sex<span class="token operator">&gt;</span>男<span class="token operator">&lt;</span><span class="token operator">/</span>sex<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>old<span class="token operator">&gt;</span><span class="token number">20</span><span class="token operator">&lt;</span><span class="token operator">/</span>old<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>student<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>student<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>李四<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>sex<span class="token operator">&gt;</span>女<span class="token operator">&lt;</span><span class="token operator">/</span>sex<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>old<span class="token operator">&gt;</span><span class="token number">21</span><span class="token operator">&lt;</span><span class="token operator">/</span>old<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>student<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>studentList<span class="token operator">&gt;</span>
</code></pre> 
<p>带ID的文件</p> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"utf-8"</span> <span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>studentList<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>student Type<span class="token operator">=</span><span class="token string">"Bad"</span> <span class="token constant">ISBN</span><span class="token operator">=</span><span class="token string">"541801"</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>name id<span class="token operator">=</span><span class="token string">"1"</span><span class="token operator">&gt;</span>张三<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>sex id<span class="token operator">=</span><span class="token string">"11"</span><span class="token operator">&gt;</span>男<span class="token operator">&lt;</span><span class="token operator">/</span>sex<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>old id<span class="token operator">=</span><span class="token string">"111"</span><span class="token operator">&gt;</span><span class="token number">20</span><span class="token operator">&lt;</span><span class="token operator">/</span>old<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>student<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>student Type<span class="token operator">=</span><span class="token string">"Good"</span> <span class="token constant">ISBN</span><span class="token operator">=</span><span class="token string">"541802"</span><span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>name id<span class="token operator">=</span><span class="token string">"2"</span><span class="token operator">&gt;</span>李四<span class="token operator">&lt;</span><span class="token operator">/</span>name<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>sex id<span class="token operator">=</span><span class="token string">"22"</span><span class="token operator">&gt;</span>女<span class="token operator">&lt;</span><span class="token operator">/</span>sex<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>old id<span class="token operator">=</span><span class="token string">"222"</span><span class="token operator">&gt;</span><span class="token number">21</span><span class="token operator">&lt;</span><span class="token operator">/</span>old<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>student<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>studentList<span class="token operator">&gt;</span>
</code></pre> 
<p>C#代码块如下：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">void</span> <span class="token function">DataSet_ReadXml</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//dataset读取简单xml文件</span>
    DataSet ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ds<span class="token punctuation">.</span><span class="token function">ReadXml</span><span class="token punctuation">(</span>filePath7<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//读取第一条数据的name节点</span>
    string name <span class="token operator">=</span> ds<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Rows<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//输出：张三</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">DataSet_ReadXml_id</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//dataset读取带属性的xml文件</span>
    DataSet ds <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ds<span class="token punctuation">.</span><span class="token function">ReadXml</span><span class="token punctuation">(</span>filePath8<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//读取的节点名称</span>
    string nodeName <span class="token operator">=</span> <span class="token string">"name"</span><span class="token punctuation">;</span>
    string name <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    name <span class="token operator">=</span> ds<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span>nodeName<span class="token punctuation">]</span><span class="token punctuation">.</span>Rows<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>nodeName <span class="token operator">+</span> <span class="token string">"_Text"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//读取节点的id属性</span>
    string id <span class="token operator">=</span> ds<span class="token punctuation">.</span>Tables<span class="token punctuation">[</span>nodeName<span class="token punctuation">]</span><span class="token punctuation">.</span>Rows<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//输出：id:1,name:张三</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"id:{0},name:{1}"</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//DataSet_ReadXml();</span>
<span class="token comment">//DataSet_ReadXml_id();</span>
</code></pre> 
<h3><a id="2JsonNet_298"></a>2.使用Json.Net转换读取</h3> 
<pre><code class="prism language-javascript"><span class="token keyword">void</span> <span class="token function">XmlToJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//XmlDocument读取xml文件</span>
    XmlDocument xmlDoc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XmlDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xmlDoc<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span>filePath8<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//转换为json</span>
    string json <span class="token operator">=</span> JsonConvert<span class="token punctuation">.</span><span class="token function">SerializeXmlNode</span><span class="token punctuation">(</span>xmlDoc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//解析json</span>
    JObject jobj <span class="token operator">=</span> JObject<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>
    JArray jarr <span class="token operator">=</span> JArray<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>jobj<span class="token punctuation">[</span><span class="token string">"studentList"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"student"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//输出：id:1,name:张三</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"id:{0},name:{1}"</span><span class="token punctuation">,</span> jarr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"#text"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> jarr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"@id"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//XmlToJson();</span>
</code></pre> 
<h3><a id="3XmlDocument_315"></a>3.使用XmlDocument读取</h3> 
<pre><code class="prism language-javascript"><span class="token keyword">void</span> <span class="token function">XmlDocument_Load</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//XmlDocument读取xml文件</span>
    XmlDocument xmlDoc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XmlDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    xmlDoc<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span>filePath8<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//获取xml根节点</span>
    XmlNode xmlRoot <span class="token operator">=</span> xmlDoc<span class="token punctuation">.</span>DocumentElement<span class="token punctuation">;</span>
    <span class="token comment">//根据节点顺序逐步读取</span>
    <span class="token comment">//读取第一个name节点</span>
    string name <span class="token operator">=</span> xmlRoot<span class="token punctuation">.</span><span class="token function">SelectSingleNode</span><span class="token punctuation">(</span><span class="token string">"student/name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">;</span>

    <span class="token comment">//读取节点的id属性</span>
    string id <span class="token operator">=</span> xmlRoot<span class="token punctuation">.</span><span class="token function">SelectSingleNode</span><span class="token punctuation">(</span><span class="token string">"student/name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Attributes<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">;</span>
    <span class="token comment">//输出：id:1,name:张三</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"id:{0},name:{1}"</span><span class="token punctuation">,</span> id<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//读取所有的name节点</span>
    <span class="token function">foreach</span> <span class="token punctuation">(</span>XmlNode node <span class="token keyword">in</span> xmlRoot<span class="token punctuation">.</span><span class="token function">SelectNodes</span><span class="token punctuation">(</span><span class="token string">"student/name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//循环输出</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token string">"id:{0},name:{1}"</span><span class="token punctuation">,</span> node<span class="token punctuation">.</span>Attributes<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">,</span> node<span class="token punctuation">.</span>InnerText<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//XmlDocument_Load();</span>
<span class="token keyword">void</span> <span class="token function">XmlDocument_Load2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//使用的时候,首先声明一个XmlDocument对象,然后调用Load方法,从指定的路径加载XML文件.</span>
    XmlDocument doc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XmlDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    XmlReaderSettings settings <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XmlReaderSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    settings<span class="token punctuation">.</span>IgnoreComments <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token comment">//忽略文档里面的注释</span>
    <span class="token function">using</span> <span class="token punctuation">(</span><span class="token parameter">XmlReader reader <span class="token operator">=</span> XmlReader<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>filePath8<span class="token punctuation">,</span> settings<span class="token punctuation">)</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        doc<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//doc.Load(@"d:/demo.xml");</span>
        <span class="token comment">//然后可以通过调用SelectSingleNode得到指定的结点,通过GetAttribute得到具体的属性值.参看下面的代码</span>
        <span class="token comment">// 得到根节点bookstore</span>
        XmlNode xn <span class="token operator">=</span> doc<span class="token punctuation">.</span><span class="token function">SelectSingleNode</span><span class="token punctuation">(</span><span class="token string">"studentList"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 得到根节点的所有子节点</span>
        XmlNodeList xnl <span class="token operator">=</span> xn<span class="token punctuation">.</span>ChildNodes<span class="token punctuation">;</span>
        string info <span class="token operator">=</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
        string info2 <span class="token operator">=</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
        <span class="token function">foreach</span> <span class="token punctuation">(</span><span class="token parameter">XmlNode xn1 <span class="token keyword">in</span> xnl</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            
            <span class="token comment">// 将节点转换为元素，便于得到节点的属性值</span>
            XmlElement xe <span class="token operator">=</span> <span class="token punctuation">(</span>XmlElement<span class="token punctuation">)</span>xn1<span class="token punctuation">;</span>
            <span class="token comment">// 得到&lt;student&gt;标签的Type和ISBN两个属性的属性值</span>
            info <span class="token operator">+=</span> <span class="token string">"TYPE:"</span> <span class="token operator">+</span> xe<span class="token punctuation">.</span><span class="token function">GetAttribute</span><span class="token punctuation">(</span><span class="token string">"Type"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            info <span class="token operator">+=</span> <span class="token string">"  ISBN:"</span> <span class="token operator">+</span> xe<span class="token punctuation">.</span><span class="token function">GetAttribute</span><span class="token punctuation">(</span><span class="token string">"ISBN"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
            <span class="token comment">// 得到Book节点的所有子节点</span>
            XmlNodeList xnl0 <span class="token operator">=</span> xe<span class="token punctuation">.</span>ChildNodes<span class="token punctuation">;</span>
            info2 <span class="token operator">+=</span> <span class="token string">"name:"</span> <span class="token operator">+</span> xnl0<span class="token punctuation">.</span><span class="token function">Item</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">;</span>
            info2 <span class="token operator">+=</span> <span class="token string">"  sex:"</span> <span class="token operator">+</span> xnl0<span class="token punctuation">.</span><span class="token function">Item</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">;</span>
            info2 <span class="token operator">+=</span> <span class="token string">"  old:"</span> <span class="token operator">+</span> xnl0<span class="token punctuation">.</span><span class="token function">Item</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>InnerText <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>info<span class="token operator">+</span>info2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//XmlDocument_Load2();</span>
</code></pre> 
<h3><a id="4XmlTextReader_379"></a>4.使用XmlTextReader读取</h3> 
<pre><code class="prism language-javascript">#region XmlTextReaderDemo
 <span class="token keyword">void</span> <span class="token function">XmlTextReaderDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    string info <span class="token operator">=</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
    string info2 <span class="token operator">=</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
    XmlTextReader reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XmlTextReader</span><span class="token punctuation">(</span>filePath8<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>reader<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>reader<span class="token punctuation">.</span>NodeType <span class="token operator">==</span> XmlNodeType<span class="token punctuation">.</span>Element<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>reader<span class="token punctuation">.</span>Name <span class="token operator">==</span> <span class="token string">"student"</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                info <span class="token operator">+=</span> <span class="token string">"TYPE:"</span> <span class="token operator">+</span> reader<span class="token punctuation">.</span><span class="token function">GetAttribute</span><span class="token punctuation">(</span><span class="token string">"Type"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                info <span class="token operator">+=</span> <span class="token string">"  ISBN:"</span> <span class="token operator">+</span> reader<span class="token punctuation">.</span><span class="token function">GetAttribute</span><span class="token punctuation">(</span><span class="token string">"ISBN"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>reader<span class="token punctuation">.</span>Name <span class="token operator">==</span> <span class="token string">"name"</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                info2 <span class="token operator">+=</span> <span class="token string">"name:"</span> <span class="token operator">+</span> reader<span class="token punctuation">.</span><span class="token function">ReadElementContentAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>reader<span class="token punctuation">.</span>Name <span class="token operator">==</span> <span class="token string">"sex"</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                info2 <span class="token operator">+=</span> <span class="token string">"  sex:"</span> <span class="token operator">+</span> reader<span class="token punctuation">.</span><span class="token function">ReadElementString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>reader<span class="token punctuation">.</span>Name <span class="token operator">==</span> <span class="token string">"old"</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                info2 <span class="token operator">+=</span> <span class="token string">"  old:"</span> <span class="token operator">+</span> reader<span class="token punctuation">.</span><span class="token function">ReadElementString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//for(int i=0;i&lt;reader.AttributeCount;i++)</span>
            <span class="token comment">//{<!-- --></span>
            <span class="token comment">//  reader.MoveToAttribute(i);</span>
            <span class="token comment">//}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    reader<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>info <span class="token operator">+</span> info2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
#endregion XmlTextReaderDemo
<span class="token comment">//XmlTextReaderDemo();</span>
</code></pre> 
<h3><a id="5_Linq_to_Xml_420"></a>5.使用 Linq to Xml读取</h3> 
<pre><code class="prism language-javascript"><span class="token keyword">void</span> <span class="token function">Linq_To_Xml</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    XElement xe <span class="token operator">=</span> XElement<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span>filePath8<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//xe.Descendants</span>
    <span class="token keyword">var</span> elements <span class="token operator">=</span> from ele <span class="token keyword">in</span> xe<span class="token punctuation">.</span><span class="token function">Elements</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                   select ele<span class="token punctuation">;</span>
    string info <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token function">foreach</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">var</span> ele <span class="token keyword">in</span> elements</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        info <span class="token operator">+=</span> <span class="token string">"name:"</span> <span class="token operator">+</span> ele<span class="token punctuation">.</span><span class="token function">Element</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value<span class="token punctuation">;</span>
        info <span class="token operator">+=</span> <span class="token string">"  old:"</span> <span class="token operator">+</span> ele<span class="token punctuation">.</span><span class="token function">Element</span><span class="token punctuation">(</span><span class="token string">"old"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">+</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//Linq_To_Xml();</span>
</code></pre> 
<h2><a id="EXCEL_438"></a>四、EXCEL文件的读写</h2> 
<p>参考文章：<a href="https://www.jb51.net/article/176769.htm" rel="nofollow">EXCEL的读取方式</a></p> 
<h3><a id="1NPOI_440"></a>1.以NPOI的方式读写</h3> 
<pre><code class="prism language-javascript"><span class="token comment">//NPOI方式</span>
<span class="token comment">//优点：用户电脑上没有安装office，使用NPOI，依旧可以在它的机器上对word或者excel文档进行读写</span>
<span class="token comment">//缺点：有的需要下载插件，添加到系统引用中。</span>
<span class="token comment">//如果需要读写多种Word、Excel等Office文件，OpenXml和NPOI也是不错的选择。</span>
<span class="token comment">//using NPOI.SS.UserModel;</span>
<span class="token keyword">void</span> <span class="token function">Excle_NPOI</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//导入</span>
    IWorkbook workbook <span class="token operator">=</span> WorkbookFactory<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>filePath12<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ISheet sheet <span class="token operator">=</span> workbook<span class="token punctuation">.</span><span class="token function">GetSheetAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取第一个工作薄</span>
    sheet<span class="token punctuation">.</span><span class="token function">CreateRow</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">CreateCell</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetCellValue</span><span class="token punctuation">(</span><span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//向第一行第一个单元格写入字符串</span>
    sheet<span class="token punctuation">.</span><span class="token function">CreateRow</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">CreateCell</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetCellValue</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    sheet<span class="token punctuation">.</span><span class="token function">CreateRow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">CreateCell</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetCellValue</span><span class="token punctuation">(</span><span class="token string">"B"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    IRow row <span class="token operator">=</span> <span class="token punctuation">(</span>IRow<span class="token punctuation">)</span>sheet<span class="token punctuation">.</span><span class="token function">GetRow</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取第一行</span>
    <span class="token comment">//设置第一行第一列值,更多方法请参考源官方Demo</span>
    row<span class="token punctuation">.</span><span class="token function">CreateCell</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">SetCellValue</span><span class="token punctuation">(</span><span class="token string">"Excle_NPOI"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置第一行第一列值</span>
    <span class="token comment">//导出excel</span>
    FileStream fs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileStream</span><span class="token punctuation">(</span>filePath12<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Create<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>ReadWrite<span class="token punctuation">)</span><span class="token punctuation">;</span>
    workbook<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>fs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">Excle_NPOI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="2ClosedXML_466"></a>2.以ClosedXML的方式读写</h3> 
<p>添加相应的NuGet包</p> 
<pre><code class="prism language-javascript"><span class="token comment">//using ClosedXML.Excel;</span>
<span class="token keyword">void</span> <span class="token function">Excle_ClosedXml</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> workbook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XLWorkbook</span><span class="token punctuation">(</span>filePath11<span class="token punctuation">)</span><span class="token punctuation">;</span>
    IXLWorksheet sheet <span class="token operator">=</span> workbook<span class="token punctuation">.</span><span class="token function">Worksheet</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//这个库也是从1开始</span>
    <span class="token comment">//设置第一行第一列值,更多方法请参考官方Demo</span>
    sheet<span class="token punctuation">.</span><span class="token function">Cell</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">"Excle_ClosedXml"</span><span class="token punctuation">;</span><span class="token comment">//该方法也是从1开始，非0</span>
    workbook<span class="token punctuation">.</span><span class="token function">SaveAs</span><span class="token punctuation">(</span>filePath12<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//Excle_ClosedXml();</span>
<span class="token comment">//导出不支持覆盖，如果路径12的文件存在则报错？</span>
</code></pre> 
<h3><a id="3SpireXls_481"></a>3.以Spire.Xls的方式读写</h3> 
<pre><code class="prism language-javascript"><span class="token comment">//如果需要在WinForm中展示，那么Spire.Office可能是唯一选择。</span>
<span class="token comment">//Nuget下载Free Spire.xls</span>
<span class="token keyword">void</span> <span class="token function">Excle_spire</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    Spire<span class="token punctuation">.</span>Xls<span class="token punctuation">.</span>Workbook workbook <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Spire<span class="token punctuation">.</span>Xls<span class="token punctuation">.</span>Workbook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    workbook<span class="token punctuation">.</span><span class="token function">LoadFromFile</span><span class="token punctuation">(</span>filePath11<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//处理Excel数据，更多请参考官方Demo</span>
    Spire<span class="token punctuation">.</span>Xls<span class="token punctuation">.</span>Worksheet sheet <span class="token operator">=</span> workbook<span class="token punctuation">.</span>Worksheets<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    sheet<span class="token punctuation">.</span>Range<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Text <span class="token operator">=</span> <span class="token string">"Excle_spire"</span><span class="token punctuation">;</span><span class="token comment">//该方法也是从1开始，非0</span>
    workbook<span class="token punctuation">.</span><span class="token function">SaveToFile</span><span class="token punctuation">(</span>filePath12<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//Excle_spire();</span>
<span class="token comment">//覆盖式导出</span>
</code></pre> 
<h3><a id="4EPPlus_497"></a>4.以EPPlus的方式读写</h3> 
<pre><code class="prism language-javascript"><span class="token comment">//如果只是需要读写Excel，那么EPPlus非常方便而且符合使用习惯。</span>
<span class="token comment">//using OfficeOpenXml;</span>
<span class="token keyword">void</span> <span class="token function">TestEPPlus</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    ExcelPackage<span class="token punctuation">.</span>LicenseContext <span class="token operator">=</span> LicenseContext<span class="token punctuation">.</span>NonCommercial<span class="token punctuation">;</span><span class="token comment">//指明非商业应用；EPPlus通过LicenseContext来区分商业应用（Commercial）和非商业应用（NonCommercial）</span>
    ExcelPackage <span class="token keyword">package</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExcelPackage</span><span class="token punctuation">(</span>filePath12<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//加载Excel工作簿</span>
    ExcelWorksheet sheet1 <span class="token operator">=</span> <span class="token keyword">package</span><span class="token punctuation">.</span>Workbook<span class="token punctuation">.</span>Worksheets<span class="token punctuation">[</span><span class="token string">"Sheet1"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//读取工作簿中名为"Sheet1"的工作表</span>

    sheet1<span class="token punctuation">.</span>Cells<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">"A"</span><span class="token punctuation">;</span><span class="token comment">//设置单元格内容</span>
    sheet1<span class="token punctuation">.</span>Cells<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">"B"</span><span class="token punctuation">;</span>
    sheet1<span class="token punctuation">.</span>Cells<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Value <span class="token operator">=</span> <span class="token string">"C"</span><span class="token punctuation">;</span>
    <span class="token comment">//package.Save();//将更改保存到原文件</span>
    <span class="token keyword">package</span><span class="token punctuation">.</span><span class="token function">SaveAs</span><span class="token punctuation">(</span>filePath12<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将更改保存到新的文件，类似于另存为</span>
<span class="token punctuation">}</span>
<span class="token comment">//TestEPPlus();</span>
</code></pre> 
<h2><a id="CSV_515"></a>五、CSV文件的读取</h2> 
<p>参考博客：<a href="https://blog.csdn.net/fanwenhu/article/details/100030534">CSV文件的读取方式</a></p> 
<pre><code class="prism language-javascript">DataTable <span class="token function">CSV2DataTable</span><span class="token punctuation">(</span><span class="token parameter">string fileName</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{<!-- --></span>
        DataTable dt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataTable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        FileStream fs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileStream</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> FileMode<span class="token punctuation">.</span>Open<span class="token punctuation">,</span> FileAccess<span class="token punctuation">.</span>Read<span class="token punctuation">)</span><span class="token punctuation">;</span>
        StreamReader sr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StreamReader</span><span class="token punctuation">(</span>fs<span class="token punctuation">,</span> Encoding<span class="token punctuation">.</span>Default<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//记录每次读取的一行记录</span>
        string strLine <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
        <span class="token comment">//记录每行记录中的各字段内容</span>
        string<span class="token punctuation">[</span><span class="token punctuation">]</span> aryLine<span class="token punctuation">;</span>
        <span class="token comment">//标示列数</span>
        int columnCount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token comment">//标示是否是读取的第一行</span>
        bool IsFirst <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token comment">//逐行读取CSV中的数据</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>strLine <span class="token operator">=</span> sr<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            aryLine <span class="token operator">=</span> strLine<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">'"'</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">TrimEnd</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>IsFirst <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                IsFirst <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                columnCount <span class="token operator">=</span> aryLine<span class="token punctuation">.</span>Length<span class="token punctuation">;</span>
                <span class="token comment">//创建列</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span>int i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> columnCount<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    DataColumn dc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataColumn</span><span class="token punctuation">(</span>aryLine<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">try</span>
                    <span class="token punctuation">{<!-- --></span>
                        dt<span class="token punctuation">.</span>Columns<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>dc<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">catch</span> <span class="token punctuation">(</span>Exception ex<span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                DataRow dr <span class="token operator">=</span> dt<span class="token punctuation">.</span><span class="token function">NewRow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span>int j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> columnCount<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    dr<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> aryLine<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                dt<span class="token punctuation">.</span>Rows<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>dr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        sr<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fs<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> dt<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span>Exception<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//仅能读取简单的CSV</span>
<span class="token comment">//DataTable dt = CSV2DataTable(filePath9);</span>
<span class="token comment">//for (int i = 0; dt.Rows.Count&lt;i; i++)</span>
<span class="token comment">//{<!-- --></span>
<span class="token comment">//    Console.Write("");</span>
<span class="token comment">//}</span>
</code></pre> 
<p>simple.csv文件示例</p> 
<pre><code class="prism language-javascript">Test1<span class="token punctuation">,</span>Test2<span class="token punctuation">,</span>Test3<span class="token punctuation">,</span>Test4<span class="token punctuation">,</span>Test5<span class="token punctuation">,</span>Test6
s1<span class="token punctuation">,</span>s2<span class="token punctuation">,</span>s3<span class="token punctuation">,</span>s4<span class="token punctuation">,</span>s5<span class="token punctuation">,</span>s6
r1<span class="token punctuation">,</span>r2<span class="token punctuation">,</span>r3<span class="token punctuation">,</span>r4<span class="token punctuation">,</span>r5<span class="token punctuation">,</span>r6
</code></pre> 
<p>以上便是本文的所有内容啦，如有遗漏，欢迎补充！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4e9d5f2bdeaf95c26588d7347e3bf87b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C语言经典算法实例4：判断回文数</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6f2115a87f7a38dc8b87c7ff9ef10ff5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">h5 js调用移动端 相机 相册</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>