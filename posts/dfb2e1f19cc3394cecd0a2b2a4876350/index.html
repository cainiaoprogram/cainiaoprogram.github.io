<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>详细介绍chrony服务器 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="详细介绍chrony服务器" />
<meta property="og:description" content="chrony服务器 硬件时间：BIOS里面；关机后依然运行，主板电池为它供电；RTC时钟
系统时间：开机后，软件启动读取硬件时钟，之后独立运行
Chrony 的配置文件是/etc/chrony.conf
chronyd服务器端
chronyc客户端
Chrony是一个开源自由的网络时间协议 NTP 的客户端和服务器软软件。它能让计算机保持系统时钟与时钟服务器（NTP）同步，因此让你的计算机保持精确的时间，Chrony也可以作为服务端软件为其他计算机提供时间同步服务。
Chrony由两个程序组成，分别是chronyd和chronyc
chronyd是一个后台运行的守护进程，用于调整内核中运行的系统时钟和时钟服务器同步。它确定计算机增减时间的比率，并对此进行补偿。（平滑的变化）
chronyc提供了一个用户界面，用于监控性能并进行多样化的配置。它可以在chronyd实例控制的计算机上工作，也可以在一台不同的远程计算机上工作。
NTP 是网络时间协议（Network Time Protocol）的简称，通过 udp 123 端口进行网络时钟同步。
RHEL7中默认使用chrony作为时间服务器，也支持NTP，需要额外安装。
NTP与chrony不能同时存在，只能用其中一个
一，一些相关的简单命令 1，使用命令Systecmctl restart chronyd 启动状态
2，使用命令Systemctl status chronyd查看chronyd的状态
3，使用命令Timedatectl 查看时间状态
4，使用命令rpm -qa | grep chrony查看是否安装chrony软件 5，如果没有的可以用Yum install chrony -y命令安装
6，使用命令cat /etc/services在linux查看服务对应的端口
二，chrony服务器配置 1，从阿里云同步时间（第一台机器） （1）使用命令vim /etc/chrony.conf打开配置文件
（2）注释掉pool ntp服务器池，添加一个阿里云的单个ntp服务器
Server ntp.aliyun.comiburst （此台服务器从阿里云来同步时间）
allow：默认情况下不允许任何ntp客户端访问
allow 192.168.0.0/16 （打开允许后面的服务器从此服务器来同步时间）
:wq保存并退出
（3）重启chronyd服务 systemctl restart chronyd
（4）使用timedatectl命令来查看状态是否为yes active
（5）Ping ntp.aliyun.com查看是否能够ping通，以及是否拿到ip
2，从第一台机器同步时间（第二台机器） （1） 克隆第一台机器（第二台机器）后改掉ip 和 主机名" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/dfb2e1f19cc3394cecd0a2b2a4876350/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-20T08:24:12+08:00" />
<meta property="article:modified_time" content="2023-02-20T08:24:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">详细介绍chrony服务器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>chrony服务器</h2> 
<p></p> 
<p style="margin-left:0;">硬件时间：BIOS里面；关机后依然运行，主板电池为它供电；<span style="color:#e84c22;">RTC</span><span style="color:#e84c22;">时钟</span></p> 
<p style="margin-left:0;">系统时间：开机后，软件启动读取硬件时钟，之后<span style="color:#e84c22;">独立运行</span></p> 
<p style="margin-left:0;"><span style="color:#494949;">Chrony 的配置文件是/etc/chrony.conf</span></p> 
<p>chronyd服务器端</p> 
<p>chronyc客户端</p> 
<blockquote> 
 <p>Chrony是一个开源自由的网络时间协议 NTP 的客户端和服务器软软件。它能让计算机保持系统时钟与时钟服务器（NTP）同步，因此让你的计算机保持精确的时间，Chrony也可以作为服务端软件为其他计算机提供时间同步服务。</p> 
 <p></p> 
 <p>Chrony由两个程序组成，分别是chronyd和chronyc</p> 
 <p></p> 
 <p>chronyd是一个后台运行的守护进程，用于调整内核中运行的系统时钟和时钟服务器同步。它确定计算机增减时间的比率，并对此进行补偿。（平滑的变化）</p> 
 <p></p> 
 <p></p> 
 <p>chronyc提供了一个用户界面，用于监控性能并进行多样化的配置。它可以在chronyd实例控制的计算机上工作，也可以在一台不同的远程计算机上工作。</p> 
 <p></p> 
 <p>NTP 是网络时间协议（Network Time Protocol）的简称，通过 udp 123 端口进行网络时钟同步。</p> 
 <p></p> 
 <p>RHEL7中默认使用chrony作为时间服务器，也支持NTP，需要额外安装。</p> 
 <p></p> 
 <p>NTP与chrony不能同时存在，只能用其中一个</p> 
</blockquote> 
<p></p> 
<h3>一，一些相关的简单命令</h3> 
<p>1，使用命令Systecmctl restart chronyd 启动状态</p> 
<p>2，使用命令Systemctl status chronyd查看chronyd的状态</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/f4/3a/F3u7ikMr_o.png"></p> 
<p>3，使用命令Timedatectl 查看时间状态</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/9b/76/FDod85rC_o.png"></p> 
<p>4，使用命令rpm -qa | grep chrony查看是否安装chrony软件 </p> 
<p><img alt="" height="103" src="https://images2.imgbox.com/c6/f0/p4Pase7d_o.png" width="1047"></p> 
<p>5，如果没有的可以用Yum install chrony -y命令安装</p> 
<p>6，使用命令cat /etc/services在linux查看服务对应的端口</p> 
<p></p> 
<p></p> 
<h3>二，chrony服务器配置</h3> 
<h4>1，从阿里云同步时间（第一台机器）</h4> 
<p>（1）使用命令vim /etc/chrony.conf打开配置文件</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/0f/79/Bx8y8PHQ_o.png"></p> 
<p></p> 
<p>（2）注释掉pool ntp服务器池，添加一个阿里云的单个ntp服务器</p> 
<blockquote> 
 <p>Server ntp.aliyun.comiburst （此台服务器从阿里云来同步时间）</p> 
 <p>allow：默认情况下<span style="color:#fe2c24;">不</span>允许任何ntp客户端访问</p> 
 <p>allow 192.168.0.0/16 （打开允许后面的服务器从此服务器来同步时间）</p> 
</blockquote> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/1e/38/QwEzBZO0_o.png"></p> 
<p>:wq保存并退出</p> 
<p></p> 
<p>（3）重启chronyd服务 systemctl restart chronyd</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/d2/12/KH4r88Rh_o.png"></p> 
<p></p> 
<p>（4）使用timedatectl命令来查看状态是否为yes active</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/1e/bd/88G9SRWf_o.png"></p> 
<p></p> 
<p>（5）Ping <a href="https://ntp.aliyun.com" rel="nofollow" title="ntp.aliyun.com">ntp.aliyun.com</a>查看是否能够ping通，以及是否拿到ip</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/e8/cc/nBHAxdBw_o.png"></p> 
<p></p> 
<h4>2，从第一台机器同步时间（第二台机器）</h4> 
<p>（1） 克隆第一台机器（第二台机器）后改掉ip 和 主机名</p> 
<p>        使用命令systemctl status chronyd查看状态</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/6d/f1/s1ar1nuT_o.png"></p> 
<p></p> 
<p>（2）使用命令vim/etc/chrony.conf打开配置文件同步第一台</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/d3/1f/yf5K5oDt_o.png"></p> 
<p>:wq 保存退出</p> 
<p></p> 
<p>（3）使用命令systemctlrestart chronyd 重启服务</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/4d/8f/lTnxtu1w_o.png"></p> 
<p>（4）使用命令chronycsources查看时钟服务器的状态</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/1c/0e/Vl17hhTl_o.png"></p> 
<p>（5）Timedatectl 查看时间是否同步，ntp服务器的状态</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/bb/fb/ybmu7xqn_o.png"></p> 
<p>（6）Chronyc tracking查看跟踪信息</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/1d/5a/WL0HbQ3o_o.png"></p> 
<p></p> 
<p></p> 
<h3>三，chronyc命令</h3> 
<blockquote> 
 <p><strong>M </strong></p> 
 <p>这表示信号源的模式。<em>^</em>表示服务器，<em>=</em>表示对等方，<em>＃</em>表示本地连接的参考时</p> 
 <p>钟。</p> 
 <p>S</p> 
 <p>此列指示源的状态。</p> 
 <p>•       <strong><em>* 表示 chronyd当前同步到的源。 </em></strong></p> 
 <p>•       <strong><em>+ 表示可接受的信号源，与选定的信号源组合在一起。（信号源可以用，我们没</em></strong></p> 
 <p><strong><em>           有使用它）</em></strong></p> 
 <p>•        <strong><em>- 表示被合并算法排除的可接受源。（不接受的时间源）</em></strong></p> 
 <p>•       ？指示已失去连接性或其数据包未通过所有测试的源。它也显示在启动时，直</p> 
 <p>            到从中至少收集了 3 个样本为止。 （连接过，且连接成功过，此时已经断开）</p> 
 <p>•        x 表示 chronyd 认为是虚假行情的时钟（即，其时间与大多数其他来源不一</p> 
 <p>              致）。</p> 
 <p>•       〜 表示时间似乎具有太多可变性的来源。（不可靠）</p> 
</blockquote> 
<p></p> 
<p>-v 详细信息</p> 
<p></p> 
<p><strong>1，查看 ntp_servers</strong></p> 
<p><strong>chronycsources -v</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/f1/a1/ROxmmj2V_o.png"></p> 
<p></p> 
<blockquote> 
 <p><strong>Name/IP address </strong></p> 
 <p>这显示了源的名称或 IP 地址，或参考时钟的参考 ID。</p> 
 <p><strong>Stratum </strong></p> 
 <p>这显示了来源的层，如其最近收到的样本中所报告的那样。层 1 表示一台具有本</p> 
 <p>地连接的参考时钟的计算机。与第 1 层计算机同步的计算机位于第 2层。与第 2</p> 
 <p>层计算机同步的计算机位于第 3 层，依此类推。</p> 
 <p><strong>Poll </strong></p> 
 <p>这显示轮询源的速率，以秒为单位的时间间隔的以 2 为底的对数。因此，值为 6</p> 
 <p>表示每 64 秒进行一次测量。<strong>chronyd 会</strong>根据当前情况自动<strong>更改</strong>轮询速率。</p> 
 <p><strong>Reach </strong></p> 
 <p>这显示了源的可达性寄存器以八进制数字打印。寄存器有 8 位，并在每个从源接</p> 
 <p>收或丢失的数据包上更新。值 377 表示从最后八次传输中收到了对所有用户的有</p> 
 <p>效答复。</p> 
 <p><strong>LastRx </strong></p> 
 <p>此列显示多长时间前从来源接收到了最后一个好的样本（在下一列中显示）。未通</p> 
 <p>过某些测试的测量将被忽略。通常以秒为单位。字母 <em>m</em>，<em>h</em>，<em>d </em>或 <em>y </em>表示分钟，小</p> 
 <p>时，天或年。</p> 
 <p><strong>Last sample （偏移量）</strong></p> 
 <p>此列显示上次测量时本地时钟与源之间的偏移。方括号中的数字表示实际测得的偏</p> 
 <p>移量。可以用 <em>ns</em>（表示纳秒），<em>us </em>（表示微秒），<em>ms</em>（表示毫秒）或 <em>s</em>（表示</p> 
 <p>秒）作为后缀。方括号左侧的数字表示原始测量值，已调整为允许此后施加于本地</p> 
 <p>时钟的任何摆度。</p> 
 <p><em>+/-</em>指示器后面的数字表示测量中的误差范围。正偏移表示本地时钟位于源时钟之</p> 
 <p>前</p> 
</blockquote> 
<p></p> 
<p><strong>2，查看 ntp_servers 状态</strong></p> 
<p><strong>chronycsourcestats </strong></p> 
<blockquote> 
 <p>-Name/IP address 时间源的域名、IP地址或Refernce ID。</p> 
 <p>- NP 服务器当前保留的样本点的数量。偏移率和偏移值是通过这些样本点进行线性回归计算预估的。</p> 
 <p>- NR 这是最后一次回归计算后，具有相同符号的残差的运行次数。如果这个数字相对于样本的数量开始变得太小，则表明直线不再适合数据。如果运行的次数过低，那么chronyd将丢弃旧的样本并重新运行回归计算，直到运行的次数可以接受为止。</p> 
 <p>- Span表示最老的样本与最新的样本之前的时间间隔。如果没有显示单位，则单位是s（秒）。</p> 
 <p>-Frequency 估计的时间源的residual frequency。以ppm（百万分之一）为单位。‘+’表示本地时间比时间源快，‘-’表示比时间源慢。</p> 
 <p>- FreqSkew 这是频率的估计误差范围，以ppm（百万分之一）为单位。</p> 
 <p>-Offset 这是估计的时间源的偏移量。</p> 
 <p>- StdDev 这是估计的样本标准差。</p> 
</blockquote> 
<p></p> 
<p><strong>3，查看 ntp_servers 是否在线</strong></p> 
<p><strong>chronycactivity -v</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/d4/2e/U5IxpDNs_o.png"></p> 
<p>200表示查看成功，查看所有时钟源的状态</p> 
<p></p> 
<p><strong>4，查看 ntp 详细信息</strong></p> 
<p><strong>chronyctracking -v</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/8a/9a/vlUSyhqh_o.png"></p> 
<p></p> 
<p><strong>5，强制同步下系统时钟（需要重启服务，才能生效）</strong></p> 
<p><strong>chronyc-a makestep</strong></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0a46c8f4bbe94ac9f41a290b56fe55b1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">BGP 实验</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/69e66844db1bf53dbe63f0176772e1a4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">tooltip不生效问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>