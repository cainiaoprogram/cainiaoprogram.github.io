<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>NMS(非极大值抑制) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="NMS(非极大值抑制)" />
<meta property="og:description" content="近段时间一直在看multi-person pose estimation，在最后有一个剔除候选keypoint的过程，该过程采用的NMS方法。但我一直对NMS不理解，经过查找资料，整理出本人对NMS的理解内容，如有不对请指出。
在引进NMS概念之前我们先介绍IOU(交并比)，因为在NMS中选出框图起到至关重要的作用
1、IOU(交并比)
物体检测需要定位出物体的bounding box，就像上面的图片一样，我们不仅要定位出车辆的bounding box 我们还要识别出bounding box 里面的物体就是车辆。
对于bounding box的定位精度，有一个很重要的概念，那就是定位精度评价公式：IOU。
IOU表示了bounding box 与 ground truth 的重叠度，如下图所示：
矩形框A、B的一个重合度IOU计算公式为：
IOU=Area(A∩B)/Area(A∪B)
就是矩形框A、B的重叠面积占A、B并集的面积比例:
IOU=SI/(SA&#43;SB-SI)
如何计算IOU（交并比）
首先求出重合面积：
选取两个矩形框左顶角的横，纵坐标的最大值，x21，y21；选取两个矩形框右下边角的横纵坐标的最小值，x12，y12;
重合面积计算：
inter= 并集的面积计算：
计算IOU：
具体实例如下：
有了IOU（交并比）的概念理解，接下来我们就进入正题，介绍NMS
2、NMS概念
NMS也即非极大值抑制。在最近几年常见的物体检测算法（包括rcnn、sppnet、fast-rcnn、faster-rcnn等）中，最终都会从一张图片中找出很多个可能是物体的矩形框，然后为每个矩形框为做类别分类概率：
所谓非极大值抑制：依靠分类器得到多个候选框，以及关于候选框中属于类别的概率值，根据分类器得到的类别分类概率做排序，具体算法流程如下：
（1）将所有框的得分排序，选中最高分及其对应的框 （2）遍历其余的框，如果和当前最高分框的重叠面积(IOU)大于一定阈值，我们就将框删除。（为什么要删除，是因为超过设定阈值，认为两个框的里面的物体属于同一个类别，比如都属于狗这个类别。我们只需要留下一个类别的可能性框图即可。）
（3）从未处理的框中继续选一个得分最高的，重复上述过程。
举例说明：（1）（2），这里设定交并比&gt;=0.6就删除对比框图，留下最高分的框图；对于低于阈值的框图留下，然后在剩下的框图中排序，选出置信度值高的框图，然后重复交并比比较这个过程。
（1）选出Dog这个框图
（1）选出Bike这个框图" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/da592182b8dcc94402463197ddd95223/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-10T21:08:04+08:00" />
<meta property="article:modified_time" content="2022-03-10T21:08:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">NMS(非极大值抑制)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>近段时间一直在看multi-person pose estimation，在最后有一个剔除候选keypoint的过程，该过程采用的NMS方法。但我一直对NMS不理解，经过查找资料，整理出本人对NMS的理解内容，如有不对请指出。</p> 
<p>在引进NMS概念之前我们先介绍IOU(交并比)，因为在NMS中选出框图起到至关重要的作用</p> 
<p>1、IOU(交并比)</p> 
<p>                           <img alt="" height="320" src="https://images2.imgbox.com/8e/c7/sP2MTHjG_o.png" width="426"></p> 
<p>物体检测需要定位出物体的bounding box，就像上面的图片一样，我们不仅要定位出车辆的bounding box 我们还要识别出bounding box 里面的物体就是车辆。</p> 
<p>对于bounding box的定位精度，有一个很重要的概念，那就是定位精度评价公式：IOU。</p> 
<p>IOU表示了bounding box 与 ground truth 的重叠度，如下图所示：</p> 
<p><img alt="这里写图片描述" src="https://images2.imgbox.com/50/09/Zl1sT9YB_o.png"></p> 
<p>矩形框A、B的一个重合度IOU计算公式为：</p> 
<p>                                                                 IOU=Area(A∩B)/Area(A∪B)</p> 
<p>就是矩形框A、B的重叠面积占A、B并集的面积比例:</p> 
<p>                                                                 IOU=SI/(SA+SB-SI)</p> 
<p>如何计算IOU（交并比）</p> 
<p>                                 <img alt="" height="362" src="https://images2.imgbox.com/6e/a9/6ObJFidd_o.png" width="437"></p> 
<p>首先求出重合面积：</p> 
<p>     选取两个矩形框左顶角的横，纵坐标的最大值，x21，y21；选取两个矩形框右下边角的横纵坐标的最小值，x12，y12;</p> 
<p>重合面积计算：</p> 
<p>                             inter=    <img alt="\left | x12-x21 \right |*\left | y12-y21 \right |" class="mathcode" src="https://images2.imgbox.com/95/ff/TISWhRDL_o.gif"></p> 
<p>并集的面积计算：</p> 
<p>                        <img alt="b =\left | x_{11}- x_{12}\right |*\left | y_{11}- y_{12} \right |+\left | x_{21}- x_{22}\right |*\left | y_{21}- y_{22} \right |-inter" class="mathcode" src="https://images2.imgbox.com/a7/5b/Bwc3TlS4_o.png"></p> 
<p>                              </p> 
<p>计算IOU：</p> 
<p>                                   <img alt="IOU=\frac{inter}{b}" class="mathcode" src="https://images2.imgbox.com/5c/3a/pgqiHKMx_o.gif"></p> 
<p><br> 具体实例如下：</p> 
<p><img alt="" height="298" src="https://images2.imgbox.com/21/9e/rPAnW3ht_o.png" width="600"></p> 
<p>有了IOU（交并比）的概念理解，接下来我们就进入正题，介绍NMS</p> 
<p>2、NMS概念</p> 
<p>NMS也即非极大值抑制。在最近几年常见的物体检测算法（包括rcnn、sppnet、fast-rcnn、faster-rcnn等）中，最终都会从一张图片中找出很多个可能是物体的矩形框，然后为每个矩形框为做类别分类概率：</p> 
<p>所谓非极大值抑制：依靠分类器得到多个候选框，以及关于候选框中属于类别的概率值，根据<span style="color:#f33b45;">分类器</span>得到的类别分类概率做排序，具体算法流程如下：</p> 
<p>（1）将所有框的得分排序，选中最高分及其对应的框 <br> （2）遍历其余的框，如果和当前最高分框的重叠面积(IOU)大于一定阈值，我们就将框删除。（为什么要删除，是因为超过设定阈值，认为两个框的里面的物体属于同一个类别，比如都属于狗这个类别。我们只需要留下一个类别的可能性框图即可。）<br> （3）从未处理的框中继续选一个得分最高的，重复上述过程。</p> 
<p>举例说明：（1）（2），这里设定交并比&gt;=0.6就删除对比框图，留下最高分的框图；对于低于阈值的框图留下，然后在剩下的框图中排序，选出置信度值高的框图，然后重复交并比比较这个过程。</p> 
<p>（1）选出<span style="color:#f33b45;">Dog</span>这个框图</p> 
<p><img alt="" height="298" src="https://images2.imgbox.com/2f/56/RJkx4LTQ_o.png" width="600"></p> 
<p><img alt="" height="293" src="https://images2.imgbox.com/64/46/DYkbT3Zq_o.png" width="600"></p> 
<p><img alt="" height="301" src="https://images2.imgbox.com/0b/90/ojzn1o1b_o.png" width="600"></p> 
<p>（1）选出<span style="color:#f33b45;">Bike</span>这个框图</p> 
<p><img alt="" height="296" src="https://images2.imgbox.com/82/55/eBOA7a2C_o.png" width="600"></p> 
<p><img alt="" height="293" src="https://images2.imgbox.com/13/b8/flLmwFix_o.png" width="600"></p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6cafb2044ab4b41f5f49aae9659d4a7a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">杰魔（Geomagic Design）逆向工程软件学习0-产品逆向工程介绍</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b2fc158ec67d3bbc164275ceb60665cb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">金融风控实战——迁移学习</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>