<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>解锁测试性能瓶颈：深度探讨JMeter分布式性能测试！ - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="解锁测试性能瓶颈：深度探讨JMeter分布式性能测试！" />
<meta property="og:description" content="在做后端服务器性能测试中，我们会经常听到&#39;分布式&#39;。但你是否了解分布式呢？今天，我们就来给大家讲讲，在企业实战中，如何使用分布式进行性能测试，实战过程中，又有哪些地方要特别注意？
01、为什么要使用分布式 做性能测试时，如果被测系统性能比较好，或者系统项目比较大，那么一般都会要求能支持比较高的并发用户数。而我们做性能测试时，发起请求的机器，硬件资源是一定的，不可能配置无限大。
所以，它能发起的并发用户数是有限的，而当我们发起方一台电脑能发起的并发用户数小于我们性能测试期望的并发用户数时，我们就会自然而然想到增加发起方的电脑。增加发起方电脑数量，那么，发起的并发用户数累加，就增大了。
发起方一台电脑，不管是 windows 系统还是 Linux 系统，一般而言，大概能支持 1.5k 左右并发用户，更多并发用户就要采用分布式。
那么，接下来的问题就是如何配置分布式？
02、如何配置分布式 助攻机配置，修改 jmeter.properties 文件
首先，我们准备多台机器，作为助攻机器；
然后，检查每台机器上是否安装了 JDK，并且 JDK 版本是否都一致；
然后，在助攻机器上放置相同版本的 jmeter；
接下来，配置 jmeter.properties 文件，
修改 server_port 端口，自定义一个端口
修改 server.rmi.ssl.disable=true
修改 server.rmi.port 端口 ---- 可选
启动服务：jmeter-server -Djava.rmi.server.hostname=ip_address
检查防火墙，关闭或开放 自定义的 server_port 端口
现在我也找了很多测试的朋友，做了一个分享技术的交流群，共享了很多我们收集的技术文档和视频教程。 如果你不想再体验自学时找不到资源，没人解答问题，坚持几天便放弃的感受 可以加入我们一起交流。而且还有很多在自动化，性能，安全，测试开发等等方面有一定建树的技术大牛 分享他们的经验，还会分享很多直播讲座和技术沙龙 可以免费学习！划重点！开源的！！！ qq群号：691998057【暗号：csdn999】 主控机器配置，修改 jmeter.properties 文件
修改 remote_hosts，值为助攻机器 ip
修改，server.rmi.ssl.disable=true
修改， mode=Standard
03、分布式机配置有哪些注意事项 分布式的配置，是不是很简单呢？
是的，这个配置实际上一点都不难，如果你要自己练手，按照上面的操作，就能很简单配置成功。但是，当你在企业项目中实战时，还会这么简单吗？如果你企业的项目，需要支持大几万的并发，要使用几十台助攻机器，是不是就简单重复上面的操作就可以了呢？
答案是否定的。
现在有几十台 Linux 机器，放在你面前，供你去配置为助攻机。数量比较大，完全无法保证每一台都一模一样，所以，我们先要检查机器配置。
1、硬件资源
CPU、内存是一台电脑的核心， 几十台机器，我们完全无法保证每一台都一样，在助攻机的要求中，虽然，没有对 CPU 和内存做要求，但是，如果每台机器能提供的资源不一样，那么能产生的并发用户数量肯定也会不相等。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/6a8cd70e4db1bf93c1e9671487e34364/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-05T14:11:37+08:00" />
<meta property="article:modified_time" content="2024-01-05T14:11:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">解锁测试性能瓶颈：深度探讨JMeter分布式性能测试！</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p class="img-center"><img alt="" height="555" src="https://images2.imgbox.com/e9/15/cYCIUf5l_o.png" width="1008"></p> 
<p>在做后端服务器性能测试中，我们会经常听到'分布式'。但你是否了解分布式呢？今天，我们就来给大家讲讲，在企业实战中，如何使用分布式进行性能测试，实战过程中，又有哪些地方要特别注意？</p> 
<p></p> 
<h2>01<strong>、为什么要使用分布式</strong></h2> 
<p>做性能测试时，如果被测系统性能比较好，或者系统项目比较大，那么一般都会要求能支持比较高的并发用户数。而我们做性能测试时，发起请求的机器，硬件资源是一定的，不可能配置无限大。</p> 
<p>所以，它能发起的并发用户数是有限的，而当我们发起方一台电脑能发起的并发用户数小于我们性能测试期望的并发用户数时，我们就会自然而然想到增加发起方的电脑。增加发起方电脑数量，那么，发起的并发用户数累加，就增大了。</p> 
<p>发起方一台电脑，不管是 windows 系统还是 Linux 系统，一般而言，大概能支持 1.5k 左右并发用户，更多并发用户就要采用分布式。</p> 
<p class="img-center"><img alt="" height="509" src="https://images2.imgbox.com/c5/74/4DyRfO6S_o.png" width="728"></p> 
<p></p> 
<p>那么，接下来的问题就是<strong>如何配置分布式？</strong></p> 
<p></p> 
<h2>02<strong>、如何配置分布式</strong></h2> 
<p>助攻机配置，修改 jmeter.properties 文件</p> 
<ul><li> <p>首先，我们准备多台机器，作为助攻机器；</p> </li><li> <p>然后，检查每台机器上是否安装了 JDK，并且 JDK 版本是否都一致；</p> </li><li> <p>然后，在助攻机器上放置相同版本的 jmeter；</p> </li><li> <p>接下来，配置 jmeter.properties 文件，</p> </li></ul> 
<ul><li> <p>修改 server_port 端口，自定义一个端口</p> </li><li> <p>修改 server.rmi.ssl.disable=true</p> </li><li> <p>修改 server.rmi.port 端口 ---- 可选</p> </li><li> <p>启动服务：<code>jmeter-server -Djava.rmi.server.hostname=ip_address</code></p> </li><li> <p>检查防火墙，关闭或开放 自定义的 server_port 端口</p> </li></ul> 
<pre><code>现在我也找了很多测试的朋友，做了一个分享技术的交流群，共享了很多我们收集的技术文档和视频教程。
如果你不想再体验自学时找不到资源，没人解答问题，坚持几天便放弃的感受
可以加入我们一起交流。而且还有很多在自动化，性能，安全，测试开发等等方面有一定建树的技术大牛
分享他们的经验，还会分享很多直播讲座和技术沙龙
可以免费学习！划重点！开源的！！！
qq群号：691998057【暗号：csdn999】</code></pre> 
<p class="img-center"><img alt="" height="128" src="https://images2.imgbox.com/0b/01/nWECIeDi_o.png" width="720"></p> 
<p><strong>主控机器配置，修改 jmeter.properties 文件</strong></p> 
<ul><li> <p>修改 remote_hosts，值为助攻机器 ip</p> </li><li> <p>修改，server.rmi.ssl.disable=true</p> </li><li> <p>修改， mode=Standard</p> </li></ul> 
<p></p> 
<h2><strong>03、</strong><strong>分布式机配置有哪些注意事项</strong></h2> 
<p>分布式的配置，是不是很简单呢？</p> 
<p>是的，这个配置实际上一点都不难，如果你要自己练手，按照上面的操作，就能很简单配置成功。但是，当你在企业项目中实战时，还会这么简单吗？如果你企业的项目，需要支持大几万的并发，要使用几十台助攻机器，是不是就简单重复上面的操作就可以了呢？</p> 
<p>答案是否定的。</p> 
<p>现在有几十台 Linux 机器，放在你面前，供你去配置为助攻机。数量比较大，完全无法保证每一台都一模一样，所以，我们先要检查机器配置。</p> 
<p class="img-center"><img alt="" height="258" src="https://images2.imgbox.com/ac/75/DTYGgu7y_o.png" width="732"></p> 
<p><strong>1、硬件资源</strong></p> 
<p>CPU、内存是一台电脑的核心， 几十台机器，我们完全无法保证每一台都一样，在助攻机的要求中，虽然，没有对 CPU 和内存做要求，但是，如果每台机器能提供的资源不一样，那么能产生的并发用户数量肯定也会不相等。</p> 
<p>所以，我们需要找出有机器中，最低配置的机器，然后，<strong>以最低配置机器为参考配置 jmeter 的堆栈信息</strong>。</p> 
<ul><li> <p>通过 <code>top</code> 命令，查看下每个系统的 CPU 和内存信息</p> </li><li> <p>修改 jmeter 的 bin 文件夹中 <code>jmeter</code> 文件 <code>HEAP:="-Xms1g -Xmx1g -XX:MaxMetaspaceSize=256m"</code> 修改堆栈信息中的大小。</p> </li><li> <p>不配置，在执行高并发用户数时，jmeter 可能会出现 OOM 问题</p> </li></ul> 
<p></p> 
<p><strong>2、系统环境</strong></p> 
<p><strong>JDK</strong></p> 
<p>机器多了，每台机器的 JDK 大版本是否一致，可能就是个问题。如果，机器上没有安装，哪可以直接去安装指定版本即可，但是，如果助攻机器上已经安装了其他版本的 JDK，并且正运行其他 Java 项目，这个时候怎么办呢？</p> 
<p>指定 jmeter 的运行 JDK 版本</p> 
<ul><li> <p>下载解压指定 JDK 版本到 Linux 的 <code>/usr/local</code> 文件夹下， 不要去配置改动系统环境变量</p> </li><li> <p>在 jmeter 的 jmeter 文件中，添加 <code>JAVA_HOME=/usr/local/jdk版本/</code> 指定 jmeter 运行的 JDK 版本，这样，就不用改动操作系统的 JDK，不影响系统中其他 Java 项目</p> </li></ul> 
<p></p> 
<p><strong>jmeter</strong></p> 
<ul><li> <p>jmeter 版本</p> </li></ul> 
<ul><li> 
  <ol><li> <p>所有助攻机器上 jmeter 的<strong>版本都必须一致</strong>。</p> </li><li> <p>jmeter.properties 要修改 <strong>ssl.disable=true</strong>， 端口可以不相同</p> </li><li> <p>如果代<strong>码中使用了第三方插件，助攻机器上，也必须有这些插件包</strong></p> </li></ol></li></ul> 
<ul><li> <p>环境变量</p> </li></ul> 
<ul><li> 
  <ol><li> <p>jmeter 运行，本身可以不配置 JMETER_HOME 环境变量，但是，当机器多了时，还是建议在所有机器上配置 JMETER_HOME 环境变量</p> </li></ol></li><li> <p>HEAP 配置</p> </li><li> 
  <ol><li> <p>机器多了，可能每台机器的内存都不一样， 我们期望助攻机器能产生更大的并发用户数，所以，建议修改每台机器的 HEAP 配置信息，设置为相同</p> </li></ol></li><li> <p>CSV 文件</p> </li><li> 
  <ol><li> <p>如果写的 jmeter 脚本中，使用了 CSV 数据文件设置，那么文件的路径，<strong>请使用相对路径写法。</strong></p> </li><li> <p>jmeter-server <strong>助攻服务在哪个路径下启动，就要在所有的机器上，上传 CSV 文件到该路径下的相对位置。</strong></p> </li></ol></li></ul> 
<p></p> 
<p><strong>os 操作系统</strong></p> 
<ul><li> <p>os 版本：没有要求，可以是不同版本</p> </li><li> <p>端口区间：</p> </li></ul> 
<ul><li> <p>操作系统的端口数量是有限的，不同系统，默认情况下，<strong>打开的端口数量可能不相等，这就需要我们去配置一下每台机器上打开的端口范围。</strong></p> </li><li> <p>sysctl -a | grep net.ipv4.ip_local_port_range</p> </li></ul> 
<p>这个命令可以查看当前机器上，开启的端口范围</p> 
<ul><li> <p>sysctl -w net.ipv4.ip_local_port_range="1024 65534" 然后再执行 sysctl -p 生效。这样，设置每台机器上，开启的端口范围</p> </li><li> <p>sysctl -a | grep net.ipv4.ip_local_port_range</p> </li></ul> 
<p>这个命令可以查看当前机器上，开启的端口范围</p> 
<ul><li> <p>打开文件数量</p> </li></ul> 
<ul><li> <p><strong>操作系统对每个程序能打开的文件数量是有限制的，这个是系统限制</strong>，我们可以通过 <code>ulimit -n</code> 看到， 也可以通过 <code>cat /proc/进程id/limit</code> 查看某个进程今天能打开的文件数量限制。</p> </li><li> <p>因为性能测试助攻机，也是要发起大量请求的，这有可能要打开大量的文件，如果文件数量限制过小，也会导致问题，所以，我们可以通过 <code>ulimit -n 数量</code> 来修改进程可以打开的文件数量。然后，重启动 jmeter-server 助攻服务，这样，就会以你修改后的数量来做限制了。</p> <p></p> </li></ul> 
<ul><li> <p>时间</p> </li></ul> 
<ul><li> <p>助攻机器多了，可能出现每台机器的时间不一样，我们可以通过 <code>date</code> 查看每台机器的时间。</p> </li><li> <p>性能测试，期望是在同一时间能发起大量请求，如果，多台机器时间不一致，那么在同一时间，发起的请求数量可能就达不到预期要求，所以，我们<strong>需要同步设定每台机器的时间</strong>。<code>date -s 时间</code> 来设定系统时间。</p> </li></ul> 
<p></p> 
<p><strong>网络环境</strong></p> 
<ul><li> <p>几十台机器，网络配置可能会不一样，如果这些助攻机器到被测服务器之间的网络存在问题，那么，可能就会导致请求压力上不会，甚至出现网络错误。</p> </li><li> <p>我们可以在每台助攻机器上，使用 <code>tracepath 被测服务器</code> 来<strong>查看助攻机到被测服务器之间的网络情况</strong>。如果发现，网络延迟时间很长，哪就说明，当前机器，可能网络配置有问题。在使用时，可能就要剔除这台助攻机器。</p> </li></ul> 
<p></p> 
<p><strong>启动服务</strong></p> 
<ul><li> <p>在每台助攻机器上执行：<code>jmeter-server -Djava.rmi.server.hostname=ipaddr</code> 因为每台的 ip 地址都不一样，所以，这个命令必须一个一个的敲。同时，我们<strong>可以加个’&amp;‘ 符号</strong>，把命令转换为后台运行。</p> </li><li> <p>在主控机器上执行：<code>java -Xms48g -Xmx48g -XX:MaxMetaspaceSize=2g -jar $JMETER_HOME/bin/ApacheJMeter.jar -n -R xxx:port,xxx:port -t xxx.jmx -l xxxx.jtl -e -o xxdirect</code></p> </li><li> <p><code>-Xms48g -Xmx48g -XX:MaxMetaspaceSize=2g</code> 这个是设置主控机器 jmeter 的堆栈信息，这个大小，可以根据自己机器的内存大小灵活修改，但是，<strong>这个一定要设置的比较大</strong>。如果小了，生成报告的时间就会很长。</p> </li><li> <p><code>$JMETER_HOME/bin/ApacheJMeter.jar</code> 为自己的 jmeter 路径</p> </li><li> <p><code>-R xxx:port,xxx:port</code> 指定助攻机器。可以根据自己的需要指定。如果，不需要采用分布式，就不用这一段，<strong>如果要用分布式，就要使用这一段，多台时，就用逗号分隔</strong>。</p> </li><li> <p><code>-t xxx.jmx</code> 你放在主控机器上的 jmeter 脚本文件</p> </li></ul> 
<p>好了，这些注意事项，你都学会了吗？</p> 
<p><strong>END今天的分享就到此结束了，点赞关注不迷路！</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d86fda0a2cfde9885d4c79397ab154be/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Qt学习大全</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fa7d9b9c89e379ec3311c4cada602e9f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MySQL运维实战(2.4) SSL认证在MySQL中的应用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>