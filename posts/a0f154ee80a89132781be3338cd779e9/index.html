<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Mysql按周分区的方法 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Mysql按周分区的方法" />
<meta property="og:description" content="在一个项目中用到一个日志表，想根据按周来进行分区：
CREATE TABLE T_log( id INT(11) NOT NULL AUTO_INCREMENT, zoneid INT(11) NOT NULL, numcount INT(11) NOT NULL, ts TIMESTAMP NULL DEFAULT &#39;0000-00-00 00:00:00&#39; ON UPDATE CURRENT_TIMESTAMP, PRIMARY KEY (id,ts) ) PARTITION BY RANGE (WEEK(ts)) ( PARTITION p1 VALUES LESS THAN (1), PARTITION p2 VALUES LESS THAN (2), PARTITION p3 VALUES LESS THAN (3), ... PARTITION p52 VALUES LESS THAN (52), PARTITION p53 VALUES LESS THAN MAXVALUE); 错误码: 1564
This partition function is not allowed 结果报错，week()函数不能作为分区函数。试了weekofyear()函数也不行。 换成yearweek()函数，可以，但又遇到了新问题：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a0f154ee80a89132781be3338cd779e9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-01-03T17:25:07+08:00" />
<meta property="article:modified_time" content="2014-01-03T17:25:07+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Mysql按周分区的方法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>在一个项目中用到一个日志表，想根据按周来进行分区：</p> 
<p></p> 
<pre><code class="language-sql">CREATE TABLE T_log(
 id INT(11) NOT NULL AUTO_INCREMENT,
  zoneid INT(11) NOT NULL,
  numcount INT(11) NOT NULL,
  ts TIMESTAMP NULL DEFAULT '0000-00-00 00:00:00' ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (id,ts)
) 
PARTITION BY RANGE (WEEK(ts)) (
    PARTITION p1 VALUES LESS THAN (1),
    PARTITION p2 VALUES LESS THAN (2),
    PARTITION p3 VALUES LESS THAN (3),
    ...
    PARTITION p52 VALUES LESS THAN (52),
    PARTITION p53 VALUES LESS THAN MAXVALUE);</code></pre> 
<span style="color:#990000">错误码: 1564<br> This partition function is not allowed</span> 
<br> 结果报错，week()函数不能作为分区函数。试了weekofyear()函数也不行。 
<p></p> 
<p>换成yearweek()函数，可以，但又遇到了新问题：</p> 
<p></p> 
<pre><code class="language-sql">CREATE TABLE T_log(
 id INT(11) NOT NULL AUTO_INCREMENT,
  zoneid INT(11) NOT NULL,
  numcount INT(11) NOT NULL,
  ts TIMESTAMP NULL DEFAULT '0000-00-00 00:00:00' ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (id,ts)
) 
PARTITION BY RANGE (YEARWEEK(ts)) (
    PARTITION p1 VALUES LESS THAN (201401),
    PARTITION p2 VALUES LESS THAN (201402),
    PARTITION p3 VALUES LESS THAN (201403),
    
    PARTITION p51 VALUES LESS THAN (201452),
    PARTITION p52 VALUES LESS THAN MAXVALUE);
    
</code></pre> 
<br> 
<span style="color:#cc0000">错误码: 1486<br> Constant, random or timezone-dependent expressions in (sub)partitioning function are not allowed</span> 
<br> 
<p></p> 
<p>报错：常量、随机或者依赖时区的表达式不能作为分区函数。</p> 
<p>把ts列换成datetime类型，创建成功。</p> 
<p></p> 
<pre><code class="language-sql">CREATE TABLE T_log(
 id INT(11) NOT NULL AUTO_INCREMENT,
  zoneid INT(11) NOT NULL,
  numcount INT(11) NOT NULL,
  ts DATETIME NULL DEFAULT '0000-00-00 00:00:00' ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (id,ts)
) 
PARTITION BY RANGE (YEARWEEK(ts)) (
    PARTITION p1 VALUES LESS THAN (201401),
    PARTITION p2 VALUES LESS THAN (201402),
    PARTITION p3 VALUES LESS THAN (201403),
    
    PARTITION p51 VALUES LESS THAN (201452),
    PARTITION p52 VALUES LESS THAN MAXVALUE);</code></pre> 
<br> 
<br> 
<p></p> 
<p><br> </p> 
<p><br> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1602724d62e042fb7739138312e6de5a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python 2 中文乱码解决方案：</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ed75d4cb2183e20ee1b9abc3e5224452/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">安装ASPCMS出现：提示：【】错误号：-2147467259 错误描述：未指定的错误</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>