<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>NRF52833学习笔记（2）——双UART串口使用 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="NRF52833学习笔记（2）——双UART串口使用" />
<meta property="og:description" content="一、简介 UARTE 是带有 EasyDMA 的通用异步接收器/发送器 UART。提供快速、全双工、异步的串口通信，内置流量控制（CTS，RTS）支持硬件，速率高达 1 Mbps。
以下是 UARTE 的主要功能：
全双工操作自动硬件流控制生成9位数据带奇偶校验EasyDMA波特率高达 1 Mbps在支持的事务之间返回 IDLE（使用HW流控制时）一个停止位最低有效位（LSB）优先 用于每个 UART 接口的 GPIO 可以从设备上的任何 GPIO 来选择并且独立地为可配置的。这使得能够在器件的引脚和有效地利用电路板空间和信号路有很大的灵活性。
二、硬件连接 功能引脚描述UART0_TXD6串口0发送端UART0_RXD8串口0接收端UART1_TXD5串口1发送端UART1_RXD7串口1接收端 三、修改文件 3.1 app_uart.h app_uart.h 位于 SDK\components\libraries\uart，将原文件备份，将以下内容替换到原文件
/** * Copyright (c) 2013 - 2020, Nordic Semiconductor ASA * * All rights reserved. * * Redistribution and use in source and binary forms, with or without modification, * are permitted provided that the following conditions are met: * * 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/183f44761eab0eb86afb41e0499cd7b6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-17T17:18:52+08:00" />
<meta property="article:modified_time" content="2020-12-17T17:18:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">NRF52833学习笔记（2）——双UART串口使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_1"></a>一、简介</h2> 
<p><strong>UARTE</strong> 是带有 EasyDMA 的通用异步接收器/发送器 UART。提供快速、全双工、异步的串口通信，内置流量控制（CTS，RTS）支持硬件，速率高达 1 Mbps。</p> 
<p>以下是 UARTE 的主要功能：</p> 
<ul><li>全双工操作</li><li>自动硬件流控制</li><li>生成9位数据带奇偶校验</li><li>EasyDMA</li><li>波特率高达 1 Mbps</li><li>在支持的事务之间返回 IDLE（使用HW流控制时）</li><li>一个停止位</li><li>最低有效位（LSB）优先</li></ul> 
<p>用于每个 UART 接口的 GPIO 可以从设备上的任何 GPIO 来选择并且独立地为可配置的。这使得能够在器件的引脚和有效地利用电路板空间和信号路有很大的灵活性。<br> <img src="https://images2.imgbox.com/6b/18/BiH9F790_o.png" alt=""></p> 
<h2><a id="_17"></a>二、硬件连接</h2> 
<table><thead><tr><th>功能</th><th>引脚</th><th>描述</th></tr></thead><tbody><tr><td>UART0_TXD</td><td>6</td><td>串口0发送端</td></tr><tr><td>UART0_RXD</td><td>8</td><td>串口0接收端</td></tr><tr><td>UART1_TXD</td><td>5</td><td>串口1发送端</td></tr><tr><td>UART1_RXD</td><td>7</td><td>串口1接收端</td></tr></tbody></table> 
<h2><a id="_25"></a>三、修改文件</h2> 
<h3><a id="31_app_uarth_26"></a>3.1 app_uart.h</h3> 
<p>app_uart.h 位于 SDK\components\libraries\uart，将原文件备份，将以下内容替换到原文件</p> 
<pre><code class="prism language-cpp"><span class="token comment">/**
 * Copyright (c) 2013 - 2020, Nordic Semiconductor ASA
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form, except as embedded into a Nordic
 *    Semiconductor ASA integrated circuit in a product or a software update for
 *    such product, must reproduce the above copyright notice, this list of
 *    conditions and the following disclaimer in the documentation and/or other
 *    materials provided with the distribution.
 *
 * 3. Neither the name of Nordic Semiconductor ASA nor the names of its
 *    contributors may be used to endorse or promote products derived from this
 *    software without specific prior written permission.
 *
 * 4. This software, with or without modification, must only be used with a
 *    Nordic Semiconductor ASA integrated circuit.
 *
 * 5. Any software provided in binary form under this license must not be reverse
 *    engineered, decompiled, modified and/or disassembled.
 *
 * THIS SOFTWARE IS PROVIDED BY NORDIC SEMICONDUCTOR ASA "AS IS" AND ANY EXPRESS
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY, NONINFRINGEMENT, AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL NORDIC SEMICONDUCTOR ASA OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 * GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */</span>
<span class="token comment">/**@file
 *
 * @defgroup app_uart UART module
 * @{
 * @ingroup app_common
 *
 * @brief UART module interface.
 */</span>

<span class="token macro property">#<span class="token directive keyword">ifndef</span> APP_UART_H__</span>
<span class="token macro property">#<span class="token directive keyword">define</span> APP_UART_H__</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdbool.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"app_util_platform.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"nrf_drv_uart.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"app_fifo.h"</span></span>


<span class="token macro property">#<span class="token directive keyword">ifdef</span> __cplusplus</span>
<span class="token keyword">extern</span> <span class="token string">"C"</span> <span class="token punctuation">{<!-- --></span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>

<span class="token macro property">#<span class="token directive keyword">define</span>  UART_PIN_DISCONNECTED 0xFFFFFFFF </span><span class="token comment">/**&lt; Value indicating that no pin is connected to this UART register. */</span>

<span class="token comment">/**@brief UART Flow Control modes for the peripheral.
 */</span>
<span class="token keyword">typedef</span> <span class="token keyword">enum</span>
<span class="token punctuation">{<!-- --></span>
    APP_UART_FLOW_CONTROL_DISABLED<span class="token punctuation">,</span> <span class="token comment">/**&lt; UART Hw Flow Control is disabled. */</span>
    APP_UART_FLOW_CONTROL_ENABLED<span class="token punctuation">,</span>  <span class="token comment">/**&lt; Standard UART Hw Flow Control is enabled. */</span>
<span class="token punctuation">}</span> app_uart_flow_control_t<span class="token punctuation">;</span>

<span class="token comment">/**@brief UART communication structure holding configuration settings for the peripheral.
 */</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">uint32_t</span>                rx_pin_no<span class="token punctuation">;</span>    <span class="token comment">/**&lt; RX pin number. */</span>
    <span class="token keyword">uint32_t</span>                tx_pin_no<span class="token punctuation">;</span>    <span class="token comment">/**&lt; TX pin number. */</span>
    <span class="token keyword">uint32_t</span>                rts_pin_no<span class="token punctuation">;</span>   <span class="token comment">/**&lt; RTS pin number, only used if flow control is enabled. */</span>
    <span class="token keyword">uint32_t</span>                cts_pin_no<span class="token punctuation">;</span>   <span class="token comment">/**&lt; CTS pin number, only used if flow control is enabled. */</span>
    app_uart_flow_control_t flow_control<span class="token punctuation">;</span> <span class="token comment">/**&lt; Flow control setting, if flow control is used, the system will use low power UART mode, based on CTS signal. */</span>
    <span class="token keyword">bool</span>                    use_parity<span class="token punctuation">;</span>   <span class="token comment">/**&lt; Even parity if TRUE, no parity if FALSE. */</span>
    <span class="token keyword">uint32_t</span>                baud_rate<span class="token punctuation">;</span>    <span class="token comment">/**&lt; Baud rate configuration. */</span>
<span class="token punctuation">}</span> app_uart_comm_params_t<span class="token punctuation">;</span>

<span class="token comment">/**@brief UART buffer for transmitting/receiving data.
 */</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">uint8_t</span> <span class="token operator">*</span> rx_buf<span class="token punctuation">;</span>      <span class="token comment">/**&lt; Pointer to the RX buffer. */</span>
    <span class="token keyword">uint32_t</span>  rx_buf_size<span class="token punctuation">;</span> <span class="token comment">/**&lt; Size of the RX buffer. */</span>
    <span class="token keyword">uint8_t</span> <span class="token operator">*</span> tx_buf<span class="token punctuation">;</span>      <span class="token comment">/**&lt; Pointer to the TX buffer. */</span>
    <span class="token keyword">uint32_t</span>  tx_buf_size<span class="token punctuation">;</span> <span class="token comment">/**&lt; Size of the TX buffer. */</span>
<span class="token punctuation">}</span> app_uart_buffers_t<span class="token punctuation">;</span>

<span class="token comment">/**@brief Enumeration which defines events used by the UART module upon data reception or error.
 *
 * @details The event type is used to indicate the type of additional information in the event
 * @ref app_uart_evt_t.
 */</span>
<span class="token keyword">typedef</span> <span class="token keyword">enum</span>
<span class="token punctuation">{<!-- --></span>
    APP_UART_DATA_READY<span class="token punctuation">,</span>          <span class="token comment">/**&lt; An event indicating that UART data has been received. The data is available in the FIFO and can be fetched using @ref app_uart_get. */</span>
    APP_UART_FIFO_ERROR<span class="token punctuation">,</span>          <span class="token comment">/**&lt; An error in the FIFO module used by the app_uart module has occured. The FIFO error code is stored in app_uart_evt_t.data.error_code field. */</span>
    APP_UART_COMMUNICATION_ERROR<span class="token punctuation">,</span> <span class="token comment">/**&lt; An communication error has occured during reception. The error is stored in app_uart_evt_t.data.error_communication field. */</span>
    APP_UART_TX_EMPTY<span class="token punctuation">,</span>            <span class="token comment">/**&lt; An event indicating that UART has completed transmission of all available data in the TX FIFO. */</span>
    APP_UART_DATA<span class="token punctuation">,</span>                <span class="token comment">/**&lt; An event indicating that UART data has been received, and data is present in data field. This event is only used when no FIFO is configured. */</span>
<span class="token punctuation">}</span> app_uart_evt_type_t<span class="token punctuation">;</span>

<span class="token comment">/**@brief Struct containing events from the UART module.
 *
 * @details The app_uart_evt_t is used to notify the application of asynchronous events when data
 * are received on the UART peripheral or in case an error occured during data reception.
 */</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span>
<span class="token punctuation">{<!-- --></span>
    app_uart_evt_type_t evt_type<span class="token punctuation">;</span> <span class="token comment">/**&lt; Type of event. */</span>
    <span class="token keyword">union</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">uint32_t</span> error_communication<span class="token punctuation">;</span> <span class="token comment">/**&lt; Field used if evt_type is: APP_UART_COMMUNICATION_ERROR. This field contains the value in the ERRORSRC register for the UART peripheral. The UART_ERRORSRC_x defines from nrf5x_bitfields.h can be used to parse the error code. See also the \nRFXX Series Reference Manual for specification. */</span>
        <span class="token keyword">uint32_t</span> error_code<span class="token punctuation">;</span>          <span class="token comment">/**&lt; Field used if evt_type is: NRF_ERROR_x. Additional status/error code if the error event type is APP_UART_FIFO_ERROR. This error code refer to errors defined in nrf_error.h. */</span>
        <span class="token keyword">uint8_t</span>  value<span class="token punctuation">;</span>               <span class="token comment">/**&lt; Field used if evt_type is: NRF_ERROR_x. Additional status/error code if the error event type is APP_UART_FIFO_ERROR. This error code refer to errors defined in nrf_error.h. */</span>
    <span class="token punctuation">}</span> data<span class="token punctuation">;</span>
<span class="token punctuation">}</span> app_uart_evt_t<span class="token punctuation">;</span>

<span class="token comment">/**@brief Function for handling app_uart event callback.
 *
 * @details Upon an event in the app_uart module this callback function will be called to notify
 *          the application about the event.
 *
 * @param[in]   p_app_uart_event Pointer to UART event.
 */</span>
<span class="token keyword">typedef</span> <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span> app_uart_event_handler_t<span class="token punctuation">)</span> <span class="token punctuation">(</span>app_uart_evt_t <span class="token operator">*</span> p_app_uart_event<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> nrf_uart_obj<span class="token punctuation">{<!-- --></span>
	nrf_drv_uart_t		instance<span class="token punctuation">;</span>
	<span class="token keyword">bool</span> rx_done<span class="token punctuation">;</span>
	<span class="token keyword">bool</span> rx_ovf<span class="token punctuation">;</span>
	app_uart_event_handler_t   event_handler<span class="token punctuation">;</span>
	<span class="token keyword">uint8_t</span> tx_buffer<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">uint8_t</span> rx_buffer<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	app_fifo_t rx_fifo<span class="token punctuation">;</span>    <span class="token comment">/**&lt; RX FIFO buffer for storing data received on the UART until the application fetches them using app_uart_get(). */</span>
	app_fifo_t tx_fifo<span class="token punctuation">;</span><span class="token comment">/**&lt; TX FIFO buffer for storing data to be transmitted on the UART when TXD is ready. Data is put to the buffer on using app_uart_put(). */</span>
	app_uart_comm_params_t <span class="token keyword">const</span><span class="token operator">*</span> comm_params<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> nrf_uart_obj nrf_uart_obj_t<span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">define</span> APP_UART_DEF(_name, _instance, _buf_size, _event_handler)	\
	static uint8_t	   _name##_rx_buf[_buf_size]; \
	static uint8_t	   _name##_tx_buf[_buf_size]; \
	static app_uart_buffers_t _name##_buffers = { \
		.rx_buf      = _name##_rx_buf,                     \
        .rx_buf_size = sizeof (_name##_rx_buf),            \
        .tx_buf      = _name##_tx_buf,                     \
        .tx_buf_size = sizeof (_name##_tx_buf),  \
	};  \
	nrf_uart_obj_t _name = {\
		.instance = NRF_DRV_UART_INSTANCE(_instance),\
		.rx_done = false,\
		.rx_ovf = false,\
		.event_handler = _event_handler,\
	}</span>

<span class="token comment">/**@brief Macro for safe initialization of the UART module in a single user instance when using
 *        a FIFO together with UART.
 *
 * @param[in]   P_COMM_PARAMS   Pointer to a UART communication structure: app_uart_comm_params_t
 * @param[in]   RX_BUF_SIZE     Size of desired RX buffer, must be a power of 2 or ZERO (No FIFO).
 * @param[in]   TX_BUF_SIZE     Size of desired TX buffer, must be a power of 2 or ZERO (No FIFO).
 * @param[in]   EVT_HANDLER   Event handler function to be called when an event occurs in the
 *                              UART module.
 * @param[in]   IRQ_PRIO        IRQ priority, app_irq_priority_t, for the UART module irq handler.
 * @param[out]  ERR_CODE        The return value of the UART initialization function will be
 *                              written to this parameter.
 *
 * @note Since this macro allocates a buffer and registers the module as a GPIOTE user when flow
 *       control is enabled, it must only be called once.
 */</span>
<span class="token macro property">#<span class="token directive keyword">define</span> APP_UART_FIFO_INIT(P_COMM_PARAMS, RX_BUF_SIZE, TX_BUF_SIZE, EVT_HANDLER, IRQ_PRIO, ERR_CODE) \
    do                                                                                             \
    {                                                                                              \
        app_uart_buffers_t buffers;                                                                \
        static uint8_t     rx_buf[RX_BUF_SIZE];                                                    \
        static uint8_t     tx_buf[TX_BUF_SIZE];                                                    \
                                                                                                   \
        buffers.rx_buf      = rx_buf;                                                              \
        buffers.rx_buf_size = sizeof (rx_buf);                                                     \
        buffers.tx_buf      = tx_buf;                                                              \
        buffers.tx_buf_size = sizeof (tx_buf);                                                     \
        ERR_CODE = app_uart_init(P_COMM_PARAMS, &amp;buffers, EVT_HANDLER, IRQ_PRIO);                  \
    } while (0)</span>

<span class="token comment">/**@brief Macro for safe initialization of the UART module in a single user instance.
 *
 * @param[in]   P_COMM_PARAMS   Pointer to a UART communication structure: app_uart_comm_params_t
 * @param[in]   EVT_HANDLER   Event handler function to be called when an event occurs in the
 *                              UART module.
 * @param[in]   IRQ_PRIO        IRQ priority, app_irq_priority_t, for the UART module irq handler.
 * @param[out]  ERR_CODE        The return value of the UART initialization function will be
 *                              written to this parameter.
 *
 * @note Since this macro allocates registers the module as a GPIOTE user when flow control is
 *       enabled, it must only be called once.
 */</span>
<span class="token macro property">#<span class="token directive keyword">define</span> APP_UART_INIT(P_COMM_PARAMS, EVT_HANDLER, IRQ_PRIO, ERR_CODE)                              \
    do                                                                                             \
    {                                                                                              \
        ERR_CODE = app_uart_init(P_COMM_PARAMS, NULL, EVT_HANDLER, IRQ_PRIO);                      \
    } while (0)</span>

<span class="token comment">/**@brief Function for initializing the UART module. Use this initialization when several instances of the UART
 *        module are needed.
 *
 *
 * @note Normally single initialization should be done using the APP_UART_INIT() or
 *       APP_UART_INIT_FIFO() macro depending on whether the FIFO should be used by the UART, as
 *       that will allocate the buffers needed by the UART module (including aligning the buffer
 *       correctly).

 * @param[in]     p_comm_params     Pin and communication parameters.
 * @param[in]     p_buffers         RX and TX buffers, NULL is FIFO is not used.
 * @param[in]     error_handler     Function to be called in case of an error.
 * @param[in]     irq_priority      Interrupt priority level.
 *
 * @retval      NRF_SUCCESS               If successful initialization.
 * @retval      NRF_ERROR_INVALID_LENGTH  If a provided buffer is not a power of two.
 * @retval      NRF_ERROR_NULL            If one of the provided buffers is a NULL pointer.
 *
 * The below errors are propagated by the UART module to the caller upon registration when Hardware
 * Flow Control is enabled. When Hardware Flow Control is not used, these errors cannot occur.
 * @retval      NRF_ERROR_INVALID_STATE   The GPIOTE module is not in a valid state when registering
 *                                        the UART module as a user.
 * @retval      NRF_ERROR_INVALID_PARAM   The UART module provides an invalid callback function when
 *                                        registering the UART module as a user.
 *                                        Or the value pointed to by *p_uart_uid is not a valid
 *                                        GPIOTE number.
 * @retval      NRF_ERROR_NO_MEM          GPIOTE module has reached the maximum number of users.
 */</span>
<span class="token keyword">uint32_t</span> <span class="token function">app_uart_init</span><span class="token punctuation">(</span>nrf_uart_obj_t <span class="token operator">*</span> uart_obj<span class="token punctuation">,</span>
                             app_uart_buffers_t <span class="token operator">*</span>     p_buffers<span class="token punctuation">,</span>
                             app_irq_priority_t       irq_priority<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**@brief Function for getting a byte from the UART.
 *
 * @details This function will get the next byte from the RX buffer. If the RX buffer is empty
 *          an error code will be returned and the app_uart module will generate an event upon
 *          reception of the first byte which is added to the RX buffer.
 *
 * @param[out] p_byte    Pointer to an address where next byte received on the UART will be copied.
 *
 * @retval NRF_SUCCESS          If a byte has been received and pushed to the pointer provided.
 * @retval NRF_ERROR_NOT_FOUND  If no byte is available in the RX buffer of the app_uart module.
 */</span>
<span class="token keyword">uint32_t</span> <span class="token function">app_uart_get</span><span class="token punctuation">(</span>nrf_uart_obj_t <span class="token operator">*</span> uart_obj<span class="token punctuation">,</span> <span class="token keyword">uint8_t</span> <span class="token operator">*</span> p_byte<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**@brief Function for putting a byte on the UART.
 *
 * @details This call is non-blocking.
 *
 * @param[in] byte   Byte to be transmitted on the UART.
 *
 * @retval NRF_SUCCESS        If the byte was successfully put on the TX buffer for transmission.
 * @retval NRF_ERROR_NO_MEM   If no more space is available in the TX buffer.
 *                            NRF_ERROR_NO_MEM may occur if flow control is enabled and CTS signal
 *                            is high for a long period and the buffer fills up.
 * @retval NRF_ERROR_INTERNAL If UART driver reported error.
 */</span>
<span class="token keyword">uint32_t</span> <span class="token function">app_uart_put</span><span class="token punctuation">(</span>nrf_uart_obj_t <span class="token operator">*</span> uart_obj<span class="token punctuation">,</span> <span class="token keyword">uint8_t</span> byte<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**@brief Function for flushing the RX and TX buffers (Only valid if FIFO is used).
 *        This function does nothing if FIFO is not used.
 *
 * @retval  NRF_SUCCESS  Flushing completed (Current implementation will always succeed).
 */</span>
<span class="token keyword">uint32_t</span> <span class="token function">app_uart_flush</span><span class="token punctuation">(</span>nrf_uart_obj_t <span class="token operator">*</span> uart_obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**@brief Function for closing the UART module.
 *
 * @retval  NRF_SUCCESS             If successfully closed.
 * @retval  NRF_ERROR_INVALID_PARAM If an invalid user id is provided or the user id differs from
 *                                  the current active user.
 */</span>
<span class="token keyword">uint32_t</span> <span class="token function">app_uart_close</span><span class="token punctuation">(</span>nrf_uart_obj_t <span class="token operator">*</span> uart_obj<span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token macro property">#<span class="token directive keyword">ifdef</span> __cplusplus</span>
<span class="token punctuation">}</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>

<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">//APP_UART_H__</span>

<span class="token comment">/** @} */</span>
</code></pre> 
<h3><a id="32_app_uart_fifoc_323"></a>3.2 app_uart_fifo.c</h3> 
<p>app_uart_fifo.c 位于 SDK\components\libraries\uart，将原文件备份，将以下内容替换到原文件</p> 
<pre><code class="prism language-cpp"><span class="token comment">/**
 * Copyright (c) 2015 - 2020, Nordic Semiconductor ASA
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form, except as embedded into a Nordic
 *    Semiconductor ASA integrated circuit in a product or a software update for
 *    such product, must reproduce the above copyright notice, this list of
 *    conditions and the following disclaimer in the documentation and/or other
 *    materials provided with the distribution.
 *
 * 3. Neither the name of Nordic Semiconductor ASA nor the names of its
 *    contributors may be used to endorse or promote products derived from this
 *    software without specific prior written permission.
 *
 * 4. This software, with or without modification, must only be used with a
 *    Nordic Semiconductor ASA integrated circuit.
 *
 * 5. Any software provided in binary form under this license must not be reverse
 *    engineered, decompiled, modified and/or disassembled.
 *
 * THIS SOFTWARE IS PROVIDED BY NORDIC SEMICONDUCTOR ASA "AS IS" AND ANY EXPRESS
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY, NONINFRINGEMENT, AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL NORDIC SEMICONDUCTOR ASA OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 * GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"sdk_common.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">if</span> NRF_MODULE_ENABLED(APP_UART)</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"app_uart.h"</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"nrf_drv_uart.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"nrf_assert.h"</span></span>

<span class="token comment">//static nrf_drv_uart_t app_uart_inst = NRF_DRV_UART_INSTANCE(APP_UART_DRIVER_INSTANCE);</span>

<span class="token keyword">static</span> __INLINE <span class="token keyword">uint32_t</span> <span class="token function">fifo_length</span><span class="token punctuation">(</span>app_fifo_t <span class="token operator">*</span> <span class="token keyword">const</span> fifo<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token keyword">uint32_t</span> tmp <span class="token operator">=</span> fifo<span class="token operator">-</span><span class="token operator">&gt;</span>read_pos<span class="token punctuation">;</span>
  <span class="token keyword">return</span> fifo<span class="token operator">-</span><span class="token operator">&gt;</span>write_pos <span class="token operator">-</span> tmp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property">#<span class="token directive keyword">define</span> FIFO_LENGTH(F) fifo_length(&amp;F)              </span><span class="token comment">/**&lt; Macro to calculate length of a FIFO. */</span>


<span class="token comment">//static app_uart_event_handler_t   m_event_handler;            /**&lt; Event handler function. */</span>
<span class="token comment">//static uint8_t tx_buffer[1];</span>
<span class="token comment">//static uint8_t rx_buffer[1];</span>
<span class="token comment">//static bool m_rx_ovf;</span>

<span class="token comment">//static app_fifo_t                  m_rx_fifo;                               /**&lt; RX FIFO buffer for storing data received on the UART until the application fetches them using app_uart_get(). */</span>
<span class="token comment">//static app_fifo_t                  m_tx_fifo;                               /**&lt; TX FIFO buffer for storing data to be transmitted on the UART when TXD is ready. Data is put to the buffer on using app_uart_put(). */</span>

<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">uart_event_handler</span><span class="token punctuation">(</span>nrf_drv_uart_event_t <span class="token operator">*</span> p_event<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> p_context<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    app_uart_evt_t app_uart_event<span class="token punctuation">;</span>
    <span class="token keyword">uint32_t</span> err_code<span class="token punctuation">;</span>

    nrf_uart_obj_t <span class="token operator">*</span> uart_obj <span class="token operator">=</span> <span class="token punctuation">(</span>nrf_uart_obj_t <span class="token operator">*</span><span class="token punctuation">)</span>p_context<span class="token punctuation">;</span>

    <span class="token keyword">switch</span> <span class="token punctuation">(</span>p_event<span class="token operator">-</span><span class="token operator">&gt;</span>type<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> NRF_DRV_UART_EVT_RX_DONE<span class="token operator">:</span>
            <span class="token comment">// If 0, then this is a RXTO event with no new bytes.</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>p_event<span class="token operator">-</span><span class="token operator">&gt;</span>data<span class="token punctuation">.</span>rxtx<span class="token punctuation">.</span>bytes <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
               <span class="token comment">// A new start RX is needed to continue to receive data</span>
               <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token function">nrf_drv_uart_rx</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>instance<span class="token punctuation">,</span> uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>rx_buffer<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// Write received byte to FIFO.</span>
            err_code <span class="token operator">=</span> <span class="token function">app_fifo_put</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>rx_fifo<span class="token punctuation">,</span> p_event<span class="token operator">-</span><span class="token operator">&gt;</span>data<span class="token punctuation">.</span>rxtx<span class="token punctuation">.</span>p_data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>err_code <span class="token operator">!=</span> NRF_SUCCESS<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                app_uart_event<span class="token punctuation">.</span>evt_type          <span class="token operator">=</span> APP_UART_FIFO_ERROR<span class="token punctuation">;</span>
                app_uart_event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>error_code   <span class="token operator">=</span> err_code<span class="token punctuation">;</span>
                uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">event_handler</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>app_uart_event<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// Notify that there are data available.</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FIFO_LENGTH</span><span class="token punctuation">(</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>rx_fifo<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                app_uart_event<span class="token punctuation">.</span>evt_type <span class="token operator">=</span> APP_UART_DATA_READY<span class="token punctuation">;</span>
                uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">event_handler</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>app_uart_event<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// Start new RX if size in buffer.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">FIFO_LENGTH</span><span class="token punctuation">(</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>rx_fifo<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>rx_fifo<span class="token punctuation">.</span>buf_size_mask<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token function">nrf_drv_uart_rx</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>instance<span class="token punctuation">,</span> uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>rx_buffer<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// Overflow in RX FIFO.</span>
                uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>rx_ovf <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">case</span> NRF_DRV_UART_EVT_ERROR<span class="token operator">:</span>
            app_uart_event<span class="token punctuation">.</span>evt_type                 <span class="token operator">=</span> APP_UART_COMMUNICATION_ERROR<span class="token punctuation">;</span>
            app_uart_event<span class="token punctuation">.</span>data<span class="token punctuation">.</span>error_communication <span class="token operator">=</span> p_event<span class="token operator">-</span><span class="token operator">&gt;</span>data<span class="token punctuation">.</span>error<span class="token punctuation">.</span>error_mask<span class="token punctuation">;</span>
            <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token function">nrf_drv_uart_rx</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>instance<span class="token punctuation">,</span> uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>rx_buffer<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">event_handler</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>app_uart_event<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">case</span> NRF_DRV_UART_EVT_TX_DONE<span class="token operator">:</span>
            <span class="token comment">// Get next byte from FIFO.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">app_fifo_get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>tx_fifo<span class="token punctuation">,</span> uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>tx_buffer<span class="token punctuation">)</span> <span class="token operator">==</span> NRF_SUCCESS<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token function">nrf_drv_uart_tx</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>instance<span class="token punctuation">,</span> uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>tx_buffer<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// Last byte from FIFO transmitted, notify the application.</span>
                app_uart_event<span class="token punctuation">.</span>evt_type <span class="token operator">=</span> APP_UART_TX_EMPTY<span class="token punctuation">;</span>
                uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">event_handler</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>app_uart_event<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">uint32_t</span> <span class="token function">app_uart_init</span><span class="token punctuation">(</span>nrf_uart_obj_t <span class="token operator">*</span> uart_obj<span class="token punctuation">,</span>
                             app_uart_buffers_t <span class="token operator">*</span>     p_buffers<span class="token punctuation">,</span>
                             app_irq_priority_t       irq_priority<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">uint32_t</span> err_code<span class="token punctuation">;</span>

<span class="token comment">//    m_event_handler = event_handler;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>p_buffers <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> NRF_ERROR_INVALID_PARAM<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Configure buffer RX buffer.</span>
    err_code <span class="token operator">=</span> <span class="token function">app_fifo_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>rx_fifo<span class="token punctuation">,</span> p_buffers<span class="token operator">-</span><span class="token operator">&gt;</span>rx_buf<span class="token punctuation">,</span> p_buffers<span class="token operator">-</span><span class="token operator">&gt;</span>rx_buf_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">VERIFY_SUCCESS</span><span class="token punctuation">(</span>err_code<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Configure buffer TX buffer.</span>
    err_code <span class="token operator">=</span> <span class="token function">app_fifo_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>tx_fifo<span class="token punctuation">,</span> p_buffers<span class="token operator">-</span><span class="token operator">&gt;</span>tx_buf<span class="token punctuation">,</span> p_buffers<span class="token operator">-</span><span class="token operator">&gt;</span>tx_buf_size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">VERIFY_SUCCESS</span><span class="token punctuation">(</span>err_code<span class="token punctuation">)</span><span class="token punctuation">;</span>

    nrf_drv_uart_config_t config <span class="token operator">=</span> NRF_DRV_UART_DEFAULT_CONFIG<span class="token punctuation">;</span>
    config<span class="token punctuation">.</span>baudrate <span class="token operator">=</span> <span class="token punctuation">(</span>nrf_uart_baudrate_t<span class="token punctuation">)</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>comm_params<span class="token operator">-</span><span class="token operator">&gt;</span>baud_rate<span class="token punctuation">;</span>
    config<span class="token punctuation">.</span>hwfc <span class="token operator">=</span> <span class="token punctuation">(</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>comm_params<span class="token operator">-</span><span class="token operator">&gt;</span>flow_control <span class="token operator">==</span> APP_UART_FLOW_CONTROL_DISABLED<span class="token punctuation">)</span> <span class="token operator">?</span>
            NRF_UART_HWFC_DISABLED <span class="token operator">:</span> NRF_UART_HWFC_ENABLED<span class="token punctuation">;</span>
    config<span class="token punctuation">.</span>interrupt_priority <span class="token operator">=</span> irq_priority<span class="token punctuation">;</span>
    config<span class="token punctuation">.</span>parity <span class="token operator">=</span> uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>comm_params<span class="token operator">-</span><span class="token operator">&gt;</span>use_parity <span class="token operator">?</span> NRF_UART_PARITY_INCLUDED <span class="token operator">:</span> NRF_UART_PARITY_EXCLUDED<span class="token punctuation">;</span>
    config<span class="token punctuation">.</span>pselcts <span class="token operator">=</span> uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>comm_params<span class="token operator">-</span><span class="token operator">&gt;</span>cts_pin_no<span class="token punctuation">;</span>
    config<span class="token punctuation">.</span>pselrts <span class="token operator">=</span> uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>comm_params<span class="token operator">-</span><span class="token operator">&gt;</span>rts_pin_no<span class="token punctuation">;</span>
    config<span class="token punctuation">.</span>pselrxd <span class="token operator">=</span> uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>comm_params<span class="token operator">-</span><span class="token operator">&gt;</span>rx_pin_no<span class="token punctuation">;</span>
    config<span class="token punctuation">.</span>pseltxd <span class="token operator">=</span> uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>comm_params<span class="token operator">-</span><span class="token operator">&gt;</span>tx_pin_no<span class="token punctuation">;</span>
    config<span class="token punctuation">.</span>p_context <span class="token operator">=</span> uart_obj<span class="token punctuation">;</span>

    err_code <span class="token operator">=</span> <span class="token function">nrf_drv_uart_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>instance<span class="token punctuation">,</span> <span class="token operator">&amp;</span>config<span class="token punctuation">,</span> uart_event_handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">VERIFY_SUCCESS</span><span class="token punctuation">(</span>err_code<span class="token punctuation">)</span><span class="token punctuation">;</span>
    uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>rx_ovf <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span> 

    <span class="token comment">// Turn on receiver if RX pin is connected</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>comm_params<span class="token operator">-</span><span class="token operator">&gt;</span>rx_pin_no <span class="token operator">!=</span> UART_PIN_DISCONNECTED<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">nrf_drv_uart_rx</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>instance<span class="token punctuation">,</span> uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>rx_buffer<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> NRF_SUCCESS<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">uint32_t</span> <span class="token function">app_uart_flush</span><span class="token punctuation">(</span>nrf_uart_obj_t <span class="token operator">*</span> uart_obj<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">uint32_t</span> err_code<span class="token punctuation">;</span>

    err_code <span class="token operator">=</span> <span class="token function">app_fifo_flush</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>rx_fifo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">VERIFY_SUCCESS</span><span class="token punctuation">(</span>err_code<span class="token punctuation">)</span><span class="token punctuation">;</span>

    err_code <span class="token operator">=</span> <span class="token function">app_fifo_flush</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>tx_fifo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">VERIFY_SUCCESS</span><span class="token punctuation">(</span>err_code<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> NRF_SUCCESS<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">uint32_t</span> <span class="token function">app_uart_get</span><span class="token punctuation">(</span>nrf_uart_obj_t <span class="token operator">*</span> uart_obj<span class="token punctuation">,</span> <span class="token keyword">uint8_t</span> <span class="token operator">*</span> p_byte<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">ASSERT</span><span class="token punctuation">(</span>p_byte<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">bool</span> rx_ovf <span class="token operator">=</span> uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>rx_ovf<span class="token punctuation">;</span>

    ret_code_t err_code <span class="token operator">=</span>  <span class="token function">app_fifo_get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>rx_fifo<span class="token punctuation">,</span> p_byte<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// If FIFO was full new request to receive one byte was not scheduled. Must be done here.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>rx_ovf<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>rx_ovf <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">uint32_t</span> uart_err_code <span class="token operator">=</span> <span class="token function">nrf_drv_uart_rx</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>instance<span class="token punctuation">,</span> uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>rx_buffer<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// RX resume should never fail.</span>
        <span class="token function">APP_ERROR_CHECK</span><span class="token punctuation">(</span>uart_err_code<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> err_code<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">uint32_t</span> <span class="token function">app_uart_put</span><span class="token punctuation">(</span>nrf_uart_obj_t <span class="token operator">*</span> uart_obj<span class="token punctuation">,</span> <span class="token keyword">uint8_t</span> byte<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">uint32_t</span> err_code<span class="token punctuation">;</span>
    err_code <span class="token operator">=</span> <span class="token function">app_fifo_put</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>tx_fifo<span class="token punctuation">,</span> byte<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err_code <span class="token operator">==</span> NRF_SUCCESS<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// The new byte has been added to FIFO. It will be picked up from there</span>
        <span class="token comment">// (in 'uart_event_handler') when all preceding bytes are transmitted.</span>
        <span class="token comment">// But if UART is not transmitting anything at the moment, we must start</span>
        <span class="token comment">// a new transmission here.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">nrf_drv_uart_tx_in_progress</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>instance<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// This operation should be almost always successful, since we've</span>
            <span class="token comment">// just added a byte to FIFO, but if some bigger delay occurred</span>
            <span class="token comment">// (some heavy interrupt handler routine has been executed) since</span>
            <span class="token comment">// that time, FIFO might be empty already.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">app_fifo_get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>tx_fifo<span class="token punctuation">,</span> uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>tx_buffer<span class="token punctuation">)</span> <span class="token operator">==</span> NRF_SUCCESS<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                err_code <span class="token operator">=</span> <span class="token function">nrf_drv_uart_tx</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>instance<span class="token punctuation">,</span> uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>tx_buffer<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> err_code<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">uint32_t</span> <span class="token function">app_uart_close</span><span class="token punctuation">(</span>nrf_uart_obj_t <span class="token operator">*</span> uart_obj<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">nrf_drv_uart_uninit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart_obj<span class="token operator">-</span><span class="token operator">&gt;</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> NRF_SUCCESS<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">//NRF_MODULE_ENABLED(APP_UART)</span>
</code></pre> 
<h3><a id="33_retargetc_583"></a>3.3 retarget.c</h3> 
<p>retarget.c 位于 SDK\components\libraries\uart，将原文件备份，将以下内容替换到原文件</p> 
<pre><code class="prism language-cpp"><span class="token comment">/**
 * Copyright (c) 2014 - 2020, Nordic Semiconductor ASA
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form, except as embedded into a Nordic
 *    Semiconductor ASA integrated circuit in a product or a software update for
 *    such product, must reproduce the above copyright notice, this list of
 *    conditions and the following disclaimer in the documentation and/or other
 *    materials provided with the distribution.
 *
 * 3. Neither the name of Nordic Semiconductor ASA nor the names of its
 *    contributors may be used to endorse or promote products derived from this
 *    software without specific prior written permission.
 *
 * 4. This software, with or without modification, must only be used with a
 *    Nordic Semiconductor ASA integrated circuit.
 *
 * 5. Any software provided in binary form under this license must not be reverse
 *    engineered, decompiled, modified and/or disassembled.
 *
 * THIS SOFTWARE IS PROVIDED BY NORDIC SEMICONDUCTOR ASA "AS IS" AND ANY EXPRESS
 * OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
 * OF MERCHANTABILITY, NONINFRINGEMENT, AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL NORDIC SEMICONDUCTOR ASA OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE
 * GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
 * HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
 * LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT
 * OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"sdk_common.h"</span></span>
<span class="token comment">/** @file
 *
 * @defgroup retarget Retarget layer for stdio functions
 * @{
 * @ingroup app_common
 * @} */</span>
<span class="token macro property">#<span class="token directive keyword">if</span> NRF_MODULE_ENABLED(RETARGET)</span>
<span class="token macro property">#<span class="token directive keyword">if</span> !defined(NRF_LOG_USES_RTT) || NRF_LOG_USES_RTT != 1</span>
<span class="token macro property">#<span class="token directive keyword">if</span> !defined(HAS_SIMPLE_UART_RETARGET)</span>


<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdint.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"app_uart.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"nrf_error.h"</span></span>


<span class="token macro property">#<span class="token directive keyword">if</span> defined(__CC_ARM)</span>

<span class="token comment">// This part is taken from MDK-ARM template file and is required here to prevent</span>
<span class="token comment">// linker from selecting libraries functions that use semihosting and failing</span>
<span class="token comment">// because of multiple definitions of fgetc() and fputc().</span>
<span class="token comment">// Refer to: http://www.keil.com/support/man/docs/gsac/gsac_retargetcortex.htm</span>
<span class="token comment">// -- BEGIN --</span>
<span class="token keyword">struct</span> __FILE <span class="token punctuation">{<!-- --></span> <span class="token keyword">int</span> handle<span class="token punctuation">;</span> <span class="token comment">/* Add whatever you need here */</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
FILE __stdout<span class="token punctuation">;</span>
FILE __stdin<span class="token punctuation">;</span>
<span class="token comment">// --- END ---</span>

<span class="token keyword">extern</span> <span class="token keyword">uint32_t</span> <span class="token function">_app_uart_get</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span> <span class="token operator">*</span> p_byte<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">extern</span> <span class="token keyword">uint32_t</span> <span class="token function">_app_uart_put</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span> byte<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">fgetc</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span> p_file<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">uint8_t</span> input<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">_app_uart_get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>input<span class="token punctuation">)</span> <span class="token operator">==</span> NRF_ERROR_NOT_FOUND<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// No implementation needed.</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> input<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">fputc</span><span class="token punctuation">(</span><span class="token keyword">int</span> ch<span class="token punctuation">,</span> FILE <span class="token operator">*</span> p_file<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">UNUSED_PARAMETER</span><span class="token punctuation">(</span>p_file<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">UNUSED_VARIABLE</span><span class="token punctuation">(</span><span class="token function">_app_uart_put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span><span class="token punctuation">)</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ch<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property">#<span class="token directive keyword">elif</span> defined(__GNUC__) &amp;&amp; defined(__SES_ARM)</span>

<span class="token keyword">int</span> <span class="token function">__getchar</span><span class="token punctuation">(</span>FILE <span class="token operator">*</span> p_file<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">uint8_t</span> input<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">app_uart_get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>input<span class="token punctuation">)</span> <span class="token operator">==</span> NRF_ERROR_NOT_FOUND<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// No implementation needed.</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> input<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property">#<span class="token directive keyword">if</span> defined(__SES_VERSION) &amp;&amp; (__SES_VERSION &gt;= 34000)</span>
<span class="token keyword">int</span> <span class="token function">__putchar</span><span class="token punctuation">(</span><span class="token keyword">int</span> ch<span class="token punctuation">,</span> __printf_tag_ptr tag_ptr<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">UNUSED_PARAMETER</span><span class="token punctuation">(</span>tag_ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">UNUSED_VARIABLE</span><span class="token punctuation">(</span><span class="token function">app_uart_put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span><span class="token punctuation">)</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ch<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token macro property">#<span class="token directive keyword">else</span></span>
<span class="token keyword">int</span> <span class="token function">__putchar</span><span class="token punctuation">(</span><span class="token keyword">int</span> ch<span class="token punctuation">,</span> FILE <span class="token operator">*</span> p_file<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">UNUSED_PARAMETER</span><span class="token punctuation">(</span>p_file<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">UNUSED_VARIABLE</span><span class="token punctuation">(</span><span class="token function">app_uart_put</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span><span class="token punctuation">)</span>ch<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ch<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>

<span class="token macro property">#<span class="token directive keyword">elif</span> defined(__GNUC__) &amp;&amp; !defined(__SES_ARM)</span>

<span class="token keyword">int</span> <span class="token function">_write</span><span class="token punctuation">(</span><span class="token keyword">int</span> file<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> p_char<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>

    <span class="token function">UNUSED_PARAMETER</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">UNUSED_VARIABLE</span><span class="token punctuation">(</span><span class="token function">app_uart_put</span><span class="token punctuation">(</span><span class="token operator">*</span>p_char<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> len<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">_read</span><span class="token punctuation">(</span><span class="token keyword">int</span> file<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span> p_char<span class="token punctuation">,</span> <span class="token keyword">int</span> len<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">UNUSED_PARAMETER</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">app_uart_get</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span> <span class="token operator">*</span><span class="token punctuation">)</span>p_char<span class="token punctuation">)</span> <span class="token operator">==</span> NRF_ERROR_NOT_FOUND<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// No implementation needed.</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token macro property">#<span class="token directive keyword">elif</span> defined(__ICCARM__)</span>

size_t <span class="token function">__write</span><span class="token punctuation">(</span><span class="token keyword">int</span> handle<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span> buffer<span class="token punctuation">,</span> size_t size<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token function">UNUSED_PARAMETER</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">UNUSED_VARIABLE</span><span class="token punctuation">(</span><span class="token function">app_uart_put</span><span class="token punctuation">(</span><span class="token operator">*</span>buffer<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> size<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

size_t <span class="token function">__read</span><span class="token punctuation">(</span><span class="token keyword">int</span> handle<span class="token punctuation">,</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span> buffer<span class="token punctuation">,</span> size_t size<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">UNUSED_PARAMETER</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">UNUSED_PARAMETER</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">app_uart_get</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span> <span class="token operator">*</span><span class="token punctuation">)</span>buffer<span class="token punctuation">)</span> <span class="token operator">==</span> NRF_ERROR_NOT_FOUND<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// No implementation needed.</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">long</span> <span class="token function">__lseek</span><span class="token punctuation">(</span><span class="token keyword">int</span> handle<span class="token punctuation">,</span> <span class="token keyword">long</span> offset<span class="token punctuation">,</span> <span class="token keyword">int</span> whence<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">__close</span><span class="token punctuation">(</span><span class="token keyword">int</span> handle<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> filename<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property">#<span class="token directive keyword">endif</span></span>

<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">// !defined(HAS_SIMPLE_UART_RETARGET)</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">// NRF_LOG_USES_RTT != 1</span>
<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">//NRF_MODULE_ENABLED(RETARGET)</span>
</code></pre> 
<h2><a id="_777"></a>四、移植文件</h2> 
<p>链接：<a href="https://pan.baidu.com/s/1eyT7_gK1MBkvk9PNVT_u3g" rel="nofollow">https://pan.baidu.com/s/1eyT7_gK1MBkvk9PNVT_u3g</a> 提取码：h664<br> 将 <strong>board_uart.c</strong> 和 <strong>board_uart.h</strong> 两个文件加入工程的Application文件夹下<br> <img src="https://images2.imgbox.com/2e/a1/D4XR9F9f_o.png" alt=""><br> <img src="https://images2.imgbox.com/41/c6/wTys1Y1H_o.png" alt=""></p> 
<h3><a id="41_board_uartc_783"></a>4.1 board_uart.c</h3> 
<pre><code class="prism language-cpp"><span class="token comment">/*********************************************************************
 * INCLUDES
 */</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"nrf_uart.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"app_uart.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"nrf_log.h"</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"board_uart.h"</span></span>

<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">uart0_handleEvent</span><span class="token punctuation">(</span>app_uart_evt_t <span class="token operator">*</span>pEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">uart1_handleEvent</span><span class="token punctuation">(</span>app_uart_evt_t <span class="token operator">*</span>pEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*********************************************************************
 * GLOBAL VARIABLES
 */</span>

<span class="token comment">/*********************************************************************
 * LOCAL VARIABLES
 */</span>
<span class="token function">APP_UART_DEF</span><span class="token punctuation">(</span>uart0<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> UART_RX_BUF_SIZE<span class="token punctuation">,</span> uart0_handleEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">APP_UART_DEF</span><span class="token punctuation">(</span>uart1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> UART_RX_BUF_SIZE<span class="token punctuation">,</span> uart1_handleEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">uint8_t</span> s_uart0ReadDataBuffer<span class="token punctuation">[</span>UART_RX_BUF_SIZE<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">uint8_t</span> s_index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">bool</span> s_begin <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">uint8_t</span> s_uart1ReadDataBuffer<span class="token punctuation">[</span>UART_RX_BUF_SIZE<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">uint8_t</span> s_index2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token keyword">bool</span> s_begin2 <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

<span class="token comment">/*********************************************************************
 * PUBLIC FUNCTIONS
 */</span>
<span class="token comment">/**
 @brief 串口驱动初始化
 @param 无
 @return 无
*/</span>
<span class="token keyword">void</span> <span class="token function">UART_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">uint32_t</span> errCode<span class="token punctuation">;</span>
    
    <span class="token comment">/*------------------------ UART0 ------------------------*/</span>
    app_uart_comm_params_t <span class="token keyword">const</span> commParams_0 <span class="token operator">=</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">.</span>rx_pin_no    <span class="token operator">=</span> BOARD_UART0_RX_IO<span class="token punctuation">,</span>
        <span class="token punctuation">.</span>tx_pin_no    <span class="token operator">=</span> BOARD_UART0_TX_IO<span class="token punctuation">,</span>
        <span class="token punctuation">.</span>rts_pin_no   <span class="token operator">=</span> NRF_UART_PSEL_DISCONNECTED<span class="token punctuation">,</span>
        <span class="token punctuation">.</span>cts_pin_no   <span class="token operator">=</span> NRF_UART_PSEL_DISCONNECTED<span class="token punctuation">,</span>                    
        <span class="token punctuation">.</span>flow_control <span class="token operator">=</span> APP_UART_FLOW_CONTROL_DISABLED<span class="token punctuation">,</span>             <span class="token comment">// 关掉流控</span>
        <span class="token punctuation">.</span>use_parity   <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token macro property">#<span class="token directive keyword">if</span> defined (UART_PRESENT)</span>
        <span class="token punctuation">.</span>baud_rate    <span class="token operator">=</span> NRF_UART_BAUDRATE_115200                    <span class="token comment">// 波特率</span>
<span class="token macro property">#<span class="token directive keyword">else</span></span>
        <span class="token punctuation">.</span>baud_rate    <span class="token operator">=</span> NRF_UARTE_BAUDRATE_115200
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    uart0<span class="token punctuation">.</span>comm_params <span class="token operator">=</span> <span class="token operator">&amp;</span>commParams_0<span class="token punctuation">;</span>
    errCode <span class="token operator">=</span> <span class="token function">app_uart_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart0<span class="token punctuation">,</span> <span class="token operator">&amp;</span>uart0_buffers<span class="token punctuation">,</span> APP_IRQ_PRIORITY_LOWEST<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">APP_ERROR_CHECK</span><span class="token punctuation">(</span>errCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">/*------------------------ UART1 ------------------------*/</span>
    app_uart_comm_params_t <span class="token keyword">const</span> commParams_1 <span class="token operator">=</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">.</span>rx_pin_no    <span class="token operator">=</span> BOARD_UART1_RX_IO<span class="token punctuation">,</span>
        <span class="token punctuation">.</span>tx_pin_no    <span class="token operator">=</span> BOARD_UART1_TX_IO<span class="token punctuation">,</span>
        <span class="token punctuation">.</span>rts_pin_no   <span class="token operator">=</span> NRF_UART_PSEL_DISCONNECTED<span class="token punctuation">,</span>
        <span class="token punctuation">.</span>cts_pin_no   <span class="token operator">=</span> NRF_UART_PSEL_DISCONNECTED<span class="token punctuation">,</span>                    
        <span class="token punctuation">.</span>flow_control <span class="token operator">=</span> APP_UART_FLOW_CONTROL_DISABLED<span class="token punctuation">,</span>             <span class="token comment">// 关掉流控</span>
        <span class="token punctuation">.</span>use_parity   <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token macro property">#<span class="token directive keyword">if</span> defined (UART_PRESENT)</span>
        <span class="token punctuation">.</span>baud_rate    <span class="token operator">=</span> NRF_UART_BAUDRATE_115200                    <span class="token comment">// 波特率</span>
<span class="token macro property">#<span class="token directive keyword">else</span></span>
        <span class="token punctuation">.</span>baud_rate    <span class="token operator">=</span> NRF_UART_BAUDRATE_115200
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    uart1<span class="token punctuation">.</span>comm_params <span class="token operator">=</span> <span class="token operator">&amp;</span>commParams_1<span class="token punctuation">;</span>
    errCode <span class="token operator">=</span> <span class="token function">app_uart_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>uart1_buffers<span class="token punctuation">,</span> APP_IRQ_PRIORITY_LOWEST<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">APP_ERROR_CHECK</span><span class="token punctuation">(</span>errCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 @brief 串口写数据函数
 @param uartNum -[in] 串口号
 @param pData -[in] 写入数据
 @param dataLen -[in] 写入数据长度
 @return 无
*/</span>
<span class="token keyword">void</span> <span class="token function">UART_WriteData</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span> uartNum<span class="token punctuation">,</span> <span class="token keyword">uint8_t</span> <span class="token operator">*</span>pData<span class="token punctuation">,</span> <span class="token keyword">uint8_t</span> dataLen<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">uint8_t</span> i<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>uartNum <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> dataLen<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">app_uart_put</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart0<span class="token punctuation">,</span> pData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>uartNum <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> dataLen<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">app_uart_put</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart0<span class="token punctuation">,</span> pData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">uint32_t</span> <span class="token function">_app_uart_get</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span> <span class="token operator">*</span> p_byte<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">app_uart_get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart1<span class="token punctuation">,</span> p_byte<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">uint32_t</span> <span class="token function">_app_uart_put</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span> byte<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">app_uart_put</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart1<span class="token punctuation">,</span> byte<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">/*********************************************************************
 * LOCAL FUNCTIONS
 */</span>
<span class="token comment">/**
 @brief 串口0读取数据处理函数
 @param pEvent -[in] 串口事件
 @return 无
*/</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">uart0_handleEvent</span><span class="token punctuation">(</span>app_uart_evt_t <span class="token operator">*</span>pEvent<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">uint8_t</span> dataChar <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">switch</span><span class="token punctuation">(</span>pEvent<span class="token operator">-</span><span class="token operator">&gt;</span>evt_type<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 已接收到UART数据</span>
        <span class="token keyword">case</span> APP_UART_DATA_READY<span class="token operator">:</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">UNUSED_VARIABLE</span><span class="token punctuation">(</span><span class="token function">app_uart_get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart0<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dataChar<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// 不是回车符或换行符则开始   </span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>dataChar <span class="token operator">!=</span> <span class="token string">'\n'</span> <span class="token operator">&amp;&amp;</span> dataChar <span class="token operator">!=</span> <span class="token string">'\r'</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                s_begin <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>s_begin<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                s_uart0ReadDataBuffer<span class="token punctuation">[</span>s_index<span class="token punctuation">]</span> <span class="token operator">=</span> dataChar<span class="token punctuation">;</span>
                s_index<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 遇到回车符或换行符结束      </span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s_uart0ReadDataBuffer<span class="token punctuation">[</span>s_index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'\n'</span><span class="token punctuation">)</span> <span class="token operator">||</span>
               <span class="token punctuation">(</span>s_uart0ReadDataBuffer<span class="token punctuation">[</span>s_index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'\r'</span><span class="token punctuation">)</span> <span class="token operator">||</span>
               <span class="token punctuation">(</span>s_index <span class="token operator">&gt;=</span> MAX_RECV_BUF_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
				<span class="token function">NRF_LOG_HEXDUMP_INFO</span><span class="token punctuation">(</span>s_uart0ReadDataBuffer<span class="token punctuation">,</span> s_index<span class="token punctuation">)</span><span class="token punctuation">;</span>   

                <span class="token function">memset</span><span class="token punctuation">(</span>s_uart0ReadDataBuffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> s_index<span class="token punctuation">)</span><span class="token punctuation">;</span> 
                s_index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                s_begin <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token comment">// 接收过程中发生通信错误</span>
        <span class="token keyword">case</span> APP_UART_COMMUNICATION_ERROR<span class="token operator">:</span>
<span class="token comment">//            APP_ERROR_HANDLER(pEvent-&gt;data.error_communication);</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token comment">// app_uart模块使用的FIFO模块中出现错误</span>
        <span class="token keyword">case</span> APP_UART_FIFO_ERROR<span class="token operator">:</span>
<span class="token comment">//            APP_ERROR_HANDLER(pEvent-&gt;data.error_code);</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 @brief 串口1读取数据处理函数
 @param pEvent -[in] 串口事件
 @return 无
*/</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">uart1_handleEvent</span><span class="token punctuation">(</span>app_uart_evt_t <span class="token operator">*</span>pEvent<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">uint8_t</span> dataChar <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">switch</span><span class="token punctuation">(</span>pEvent<span class="token operator">-</span><span class="token operator">&gt;</span>evt_type<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 已接收到UART数据</span>
        <span class="token keyword">case</span> APP_UART_DATA_READY<span class="token operator">:</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">UNUSED_VARIABLE</span><span class="token punctuation">(</span><span class="token function">app_uart_get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>uart1<span class="token punctuation">,</span> <span class="token operator">&amp;</span>dataChar<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 不是回车符或换行符则开始   </span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>dataChar <span class="token operator">!=</span> <span class="token string">'\n'</span> <span class="token operator">&amp;&amp;</span> dataChar <span class="token operator">!=</span> <span class="token string">'\r'</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                s_begin2 <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>s_begin2<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                s_uart1ReadDataBuffer<span class="token punctuation">[</span>s_index2<span class="token punctuation">]</span> <span class="token operator">=</span> dataChar<span class="token punctuation">;</span>
                s_index2<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 遇到回车符或换行符结束      </span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s_uart1ReadDataBuffer<span class="token punctuation">[</span>s_index2 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'\n'</span><span class="token punctuation">)</span> <span class="token operator">||</span>
               <span class="token punctuation">(</span>s_uart1ReadDataBuffer<span class="token punctuation">[</span>s_index2 <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'\r'</span><span class="token punctuation">)</span> <span class="token operator">||</span>
               <span class="token punctuation">(</span>s_index2 <span class="token operator">&gt;=</span> MAX_RECV_BUF_SIZE<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
				<span class="token function">NRF_LOG_HEXDUMP_INFO</span><span class="token punctuation">(</span>s_uart1ReadDataBuffer<span class="token punctuation">,</span> s_index2<span class="token punctuation">)</span><span class="token punctuation">;</span>   

                <span class="token function">memset</span><span class="token punctuation">(</span>s_uart1ReadDataBuffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> s_index2<span class="token punctuation">)</span><span class="token punctuation">;</span> 
                s_index2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                s_begin2 <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token comment">// 接收过程中发生通信错误</span>
        <span class="token keyword">case</span> APP_UART_COMMUNICATION_ERROR<span class="token operator">:</span>
<span class="token comment">//            APP_ERROR_HANDLER(pEvent-&gt;data.error_communication);</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token comment">// app_uart模块使用的FIFO模块中出现错误</span>
        <span class="token keyword">case</span> APP_UART_FIFO_ERROR<span class="token operator">:</span>
<span class="token comment">//            APP_ERROR_HANDLER(pEvent-&gt;data.error_code);</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>

        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/****************************************************END OF FILE****************************************************/</span>
</code></pre> 
<h3><a id="42_board_uarth_1016"></a>4.2 board_uart.h</h3> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">ifndef</span> _BOARD_UART_H_</span>
<span class="token macro property">#<span class="token directive keyword">define</span> _BOARD_UART_H_</span>

<span class="token comment">/*********************************************************************
 * INCLUDES
 */</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"nrf_gpio.h"</span></span>

<span class="token comment">/*********************************************************************
 * DEFINITIONS
 */</span>
<span class="token macro property">#<span class="token directive keyword">define</span> UART_TX_BUF_SIZE                256                     </span><span class="token comment">// UART TX buffer size</span>
<span class="token macro property">#<span class="token directive keyword">define</span> UART_RX_BUF_SIZE                256                     </span><span class="token comment">// UART RX buffer size</span>

<span class="token comment">// UART0</span>
<span class="token macro property">#<span class="token directive keyword">define</span> BOARD_UART0_TX_IO               6                       </span><span class="token comment">// 发送引脚  </span>
<span class="token macro property">#<span class="token directive keyword">define</span> BOARD_UART0_RX_IO               8                       </span><span class="token comment">// 接收引脚</span>
<span class="token comment">// UART1</span>
<span class="token macro property">#<span class="token directive keyword">define</span> BOARD_UART1_TX_IO               5   					</span><span class="token comment">// 发送引脚  </span>
<span class="token macro property">#<span class="token directive keyword">define</span> BOARD_UART1_RX_IO               7   					</span><span class="token comment">// 接收引脚</span>

<span class="token macro property">#<span class="token directive keyword">define</span> UART0                           0</span>
<span class="token macro property">#<span class="token directive keyword">define</span> UART1                           1</span>

<span class="token comment">/*********************************************************************
 * GLOBAL VARIABLES
 */</span>

<span class="token comment">/*********************************************************************
 * API FUNCTIONS
 */</span>
<span class="token keyword">void</span> <span class="token function">UART_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">UART_WriteData</span><span class="token punctuation">(</span><span class="token keyword">uint8_t</span> uartNum<span class="token punctuation">,</span> <span class="token keyword">uint8_t</span> <span class="token operator">*</span>pData<span class="token punctuation">,</span> <span class="token keyword">uint8_t</span> dataLen<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">/* _BOARD_UART_H_ */</span>
</code></pre> 
<h2><a id="API_1054"></a>五、API调用</h2> 
<p>需包含头文件 <strong>board_uart.h</strong></p> 
<p><strong>UART_Init</strong></p> 
<table><thead><tr><th>功能</th><th>初始化UART驱动</th></tr></thead><tbody><tr><td>函数定义</td><td>void UART_Init(void)</td></tr><tr><td>参数</td><td>无</td></tr><tr><td>返回</td><td>无</td></tr></tbody></table> 
<p><strong>UART_WriteData</strong></p> 
<table><thead><tr><th>功能</th><th>串口写数据函数</th></tr></thead><tbody><tr><td>函数定义</td><td>void UART_WriteData(uint8_t uartNum, uint8 *pData, uint8 dataLen)</td></tr><tr><td>参数</td><td>uartNum：串口号<br>pData：写入数据<br>pdataLen：写入数据长度</td></tr><tr><td>返回</td><td>无</td></tr></tbody></table> 
<h2><a id="SDK_1071"></a>六、SDK配置</h2> 
<p>点击 <strong>sdk_config.h</strong> 文件<br> <img src="https://images2.imgbox.com/f1/db/wt5v1cxD_o.png" alt=""><br> 选择 <strong>Configuration Wizard</strong><br> <img src="https://images2.imgbox.com/23/d6/K8ASBxfo_o.png" alt=""><br> nRF_Drivers 中勾选UART、UARTE、FIFO、STRERROR和RETARGET相关选项<br> <img src="https://images2.imgbox.com/5a/ea/7QnQVax2_o.png" alt=""><br> <img src="https://images2.imgbox.com/3b/c9/RculUcEA_o.png" alt=""></p> 
<p>有的工程 <strong>nRF_Libraries</strong> 没有 <code>APP_FIFO_ENABLED</code>、<code>APP_UART_ENABLED</code>、<code>RETARGET_ENABLED</code>，则在 <strong>sdk_config.h</strong> 6044行后加上</p> 
<pre><code class="prism language-cpp"><span class="token comment">//==========================================================</span>
<span class="token comment">// &lt;q&gt; APP_FIFO_ENABLED  - app_fifo - Software FIFO implementation</span>
<span class="token macro property">#<span class="token directive keyword">ifndef</span> APP_FIFO_ENABLED</span>
<span class="token macro property">#<span class="token directive keyword">define</span> APP_FIFO_ENABLED 1</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>

<span class="token comment">// &lt;e&gt; APP_UART_ENABLED - app_uart - UART driver</span>
<span class="token comment">//==========================================================</span>
<span class="token macro property">#<span class="token directive keyword">ifndef</span> APP_UART_ENABLED</span>
<span class="token macro property">#<span class="token directive keyword">define</span> APP_UART_ENABLED 1</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token comment">// &lt;o&gt; APP_UART_DRIVER_INSTANCE  - UART instance used</span>
 
<span class="token comment">// &lt;0=&gt; 0 </span>

<span class="token macro property">#<span class="token directive keyword">ifndef</span> APP_UART_DRIVER_INSTANCE</span>
<span class="token macro property">#<span class="token directive keyword">define</span> APP_UART_DRIVER_INSTANCE 0</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>

<span class="token comment">// &lt;/e&gt;</span>

<span class="token comment">// &lt;q&gt; RETARGET_ENABLED  - retarget - Retargeting stdio functions</span>
<span class="token macro property">#<span class="token directive keyword">ifndef</span> RETARGET_ENABLED</span>
<span class="token macro property">#<span class="token directive keyword">define</span> RETARGET_ENABLED 1</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
</code></pre> 
<p>在 <strong>nRF_Drivers</strong> UART_ENABLED 上加上 UART1 使能<br> <img src="https://images2.imgbox.com/7b/1a/FrhapJtc_o.png" alt=""></p> 
<pre><code class="prism language-cpp"><span class="token comment">// &lt;e&gt; UART1_ENABLED - Enable UART1 instance</span>
<span class="token comment">//==========================================================</span>
<span class="token macro property">#<span class="token directive keyword">ifndef</span> UART1_ENABLED</span>
<span class="token macro property">#<span class="token directive keyword">define</span> UART1_ENABLED 1</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token comment">// &lt;q&gt; UART0_CONFIG_USE_EASY_DMA  - Default setting for using EasyDMA</span>
 

<span class="token macro property">#<span class="token directive keyword">ifndef</span> UART1_CONFIG_USE_EASY_DMA</span>
<span class="token macro property">#<span class="token directive keyword">define</span> UART1_CONFIG_USE_EASY_DMA 1</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>

<span class="token comment">// &lt;/e&gt;</span>
</code></pre> 
<h2><a id="_1126"></a>七、添加组件库</h2> 
<p>在 <strong>nRF_Drivers</strong> 文件夹和 <strong>nRF_Libraries</strong> 文件夹确认以下组件库是否存在，不存在则添加。<br> <img src="https://images2.imgbox.com/63/08/NkCAgzmH_o.png" alt=""><br> 在主从一体的工程中后三个文件没有，需要添加：</p> 
<ol><li>添加 <strong>app_uart_fifo.c</strong> 和 <strong>retarget.c</strong><br> <img src="https://images2.imgbox.com/7e/67/amelBDVH_o.png" alt=""><br> <img src="https://images2.imgbox.com/80/24/XkEjS7CQ_o.png" alt=""><br> <img src="https://images2.imgbox.com/07/15/9T1fJKCi_o.png" alt=""></li><li>添加 <strong>app_fifo.c</strong><br> <img src="https://images2.imgbox.com/8f/2d/TZ17xxL5_o.png" alt=""><br> <img src="https://images2.imgbox.com/83/f2/zI0Lbx5I_o.png" alt=""></li><li>添加上述编译文件路径<br> <img src="https://images2.imgbox.com/4d/1f/zgrVEWle_o.png" alt=""><br> <img src="https://images2.imgbox.com/f3/90/kcOUwv5m_o.png" alt=""></li></ol> 
<h2><a id="_1141"></a>八、使用例子</h2> 
<p>1）添加头文件</p> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"board_uart.h"</span></span>
</code></pre> 
<p>2）添加初始化代码<br> 加入 <strong>UART_Init()</strong></p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">bool</span> erase_bonds<span class="token punctuation">;</span>

    <span class="token comment">/*-------------------------- 外设驱动初始化 ---------------------------*/</span>
	<span class="token comment">// Initialize.</span>
    <span class="token function">log_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>																	<span class="token comment">// 日志驱动初始化																	</span>
    <span class="token function">timers_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>																<span class="token comment">// 定时器驱动初始化（在此加入自定义定时器）</span>
	<span class="token function">UART_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>																<span class="token comment">// SI522驱动初始化（含SPI）	</span>
	
	<span class="token comment">/*-------------------------- 蓝牙协议栈初始化 ---------------------------*/</span>
    <span class="token function">power_management_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ble_stack_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>															<span class="token comment">// 协议栈初始化</span>
    <span class="token function">gap_params_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">gatt_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">advertising_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>															<span class="token comment">// 广播初始化</span>
    <span class="token function">services_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>															<span class="token comment">// 服务初始化</span>
    <span class="token function">conn_params_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>															<span class="token comment">// 连接参数初始化</span>
    <span class="token function">peer_manager_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">/*-------------------------- 开启应用 ---------------------------*/</span>
	<span class="token comment">// Start execution.</span>
    <span class="token function">NRF_LOG_INFO</span><span class="token punctuation">(</span><span class="token string">"Template example started."</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token function">advertising_start</span><span class="token punctuation">(</span>erase_bonds<span class="token punctuation">)</span><span class="token punctuation">;</span>												<span class="token comment">// 开启广播	</span>
	<span class="token function">application_timers_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>													<span class="token comment">// 定时器应用开启（在此开启自定义定时器）	</span>
	
    <span class="token comment">// Enter main loop.</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">idle_state_handle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>3）写入串口数据</p> 
<pre><code class="prism language-cpp"><span class="token keyword">uint8_t</span> temp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0x01</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">UART_WriteData</span><span class="token punctuation">(</span>UART0<span class="token punctuation">,</span> <span class="token punctuation">(</span>uint8 <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>temp<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">UART_WriteData</span><span class="token punctuation">(</span>UART1<span class="token punctuation">,</span> <span class="token punctuation">(</span>uint8 <span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>temp<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>4）接收串口数据<br> <img src="https://images2.imgbox.com/23/fa/xIckr93N_o.png" alt=""></p> 
<hr> 
<p>• 由 <a href="https://blog.csdn.net/qq_36347513">Leung</a> 写于 2020 年 12 月 17 日</p> 
<p>• 参考：<a href="https://blog.csdn.net/chhen168/article/details/107808707">nrf52840的uart0与uart1双串口使用</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/411c4958be342b6ea12fb19f7aa9bbc8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">安装linux 系统出现An Unknown Error Has Occurred报错原因和解决方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c90155513971e3f5200c9683392d2a1a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">sql server 没有备份怎么恢复误删的表数据_恢复误删的数据库</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>