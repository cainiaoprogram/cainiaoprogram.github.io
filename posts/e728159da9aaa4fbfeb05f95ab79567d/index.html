<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>什么是幂等操作(http,xcap) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="什么是幂等操作(http,xcap)" />
<meta property="og:description" content="什么是幂等操作?
下面是在网络上收集的结果，主要是从网络协议方面来解释的
1. 幂等的意味着对同一URL的多个请求应该返回同样的结果。这里我再解释一下幂等这个概念：幂等（idempotent、idempotence）是一个数学或计算机学概念，常见于抽象代数中。　幂等有一下几种定义：　对于单目运算，如果一个运算对于在范围内的所有的一个数多次进行该运算所得的结果和进行一次该运算所得的结果是一样的，那么我们就称该运算是幂等的。比如绝对值运算就是一个例子，在实数集中，有abs(a)=abs(abs(a))。　对于双目运算，则要求当参与运算的两个值是等值的情况下，如果满足运算结果与参与运算的两个值相等，则称该运算幂等，如求两个数的最大值的函数，有在在实数集中幂等，即max(x,x)　=　x。　看完上述解释后，应该可以理解GET幂等的含义了。 2. XCAP（XML Configuration Access Protocol，XML配置访问协议），也称XML配置接入协议。它是IETF制定的一个协议，前面陆续发布了一系列草案，于2007年5月正式成为RFC规范。该协议允许客户端读、写、修改存放在服务器中的XML格式的应用配置数据。XCAP将XML文档中的节点映射到HTTP URIs中，使得这些组件能够直接通过HTTP访问。该协议中有一个极为重要的概念—幂等性，英文为idempotency。如果读者最先没有接触过相关协议，初次遇到这个概念难免不知所云。本文结合XCAP协议对这个概念做出解释。首先，我们来看一下XCAP协议的原文，看看协议怎么说。原文摘自RFC 4825。7. Client OperationsHTTP also specifies that PUT and DELETE requests are idempotent. This means that, if the client performs a PUT on a document and it succeeds, it can perform the same PUT, and the resulting document will look the same（HTTP也要求PUT和DELETE请求满足幂等性。这意味着，如果一个客户端在一个文档上执行了PUT操作，并且执行成功。那么在该文档上再次执行同样的PUT操作，操作后的文档跟操作前是一样的（即内容没有发生改变））. Similarly, when a client performs a DELETE, if it succeeds, a subsequent DELETE to the same URI will generate a 404; the resource no longer exists on the server since it was deleted by the previous DELETE operation(同样地，当客户端执行一个DELETE，如果成功了，那么接下来的具有同样URI的DELETE操作将返回404，这是因为先前的DELETE已经将该资源删除，该资源已经不存在了) ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/e728159da9aaa4fbfeb05f95ab79567d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2009-04-05T00:16:00+08:00" />
<meta property="article:modified_time" content="2009-04-05T00:16:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">什么是幂等操作(http,xcap)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span class="Apple-style-span" style="word-spacing: 0px; font: bold 20px arial; text-transform: none; color: #000000; text-indent: 0px; white-space: normal; letter-spacing: normal; border-collapse: collapse; orphans: 2; widows: 2; webkit-border-horizontal-spacing: 2px; webkit-border-vertical-spacing: 2px; webkit-text-decorations-in-effect: none; webkit-text-size-adjust: auto; webkit-text-stroke-width: 0;">什么是幂等操作?</span></p> 
<p> </p> 
<p><span class="Apple-style-span" style="font-weight: bold; word-spacing: 0px; text-transform: none; color: #000000; text-indent: 0px; line-height: normal; font-style: normal; font-family: arial; white-space: normal; letter-spacing: normal; border-collapse: collapse; font-variant: normal; orphans: 2; widows: 2; webkit-border-horizontal-spacing: 2px; webkit-border-vertical-spacing: 2px; webkit-text-decorations-in-effect: none; webkit-text-size-adjust: auto; webkit-text-stroke-width: 0;"><span style="font-size: xx-small;">下面是在网络上收集的结果，主要是从网络协议方面来解释的</span></span></p> 
<p> </p> 
<p><span class="Apple-style-span" style="word-spacing: 0px; font: bold 20px arial; text-transform: none; color: #000000; text-indent: 0px; white-space: normal; letter-spacing: normal; border-collapse: collapse; orphans: 2; widows: 2; webkit-border-horizontal-spacing: 2px; webkit-border-vertical-spacing: 2px; webkit-text-decorations-in-effect: none; webkit-text-size-adjust: auto; webkit-text-stroke-width: 0;"><span class="Apple-style-span" style="word-spacing: 0px; font: 14px/22px Helvetica; text-transform: none; color: #000000; text-indent: 0px; white-space: normal; letter-spacing: normal; border-collapse: collapse; text-align: left; orphans: 2; widows: 2; webkit-border-horizontal-spacing: 0px; webkit-border-vertical-spacing: 0px; webkit-text-decorations-in-effect: none; webkit-text-size-adjust: auto; webkit-text-stroke-width: 0;">1. 幂等的意味着对同一URL的多个请求应该返回同样的结果。这里我再解释一下幂等这个概念：<br style="line-height: normal; word-wrap: break-word;"><br style="line-height: normal; word-wrap: break-word;">幂等（idempotent、idempotence）是一个数学或计算机学概念，常见于抽象代数中。<br style="line-height: normal; word-wrap: break-word;"><br style="line-height: normal; word-wrap: break-word;">　　幂等有一下几种定义：<br style="line-height: normal; word-wrap: break-word;"><br style="line-height: normal; word-wrap: break-word;">　　对于单目运算，如果一个运算对于在范围内的所有的一个数多次进行该运算所得的结果和进行一次该运算所得的结果是一样的，那么我们就称该运算是幂等的。比如绝对值运算就是一个例子，在实数集中，有abs(a)=abs(abs(a))。<br style="line-height: normal; word-wrap: break-word;"><br style="line-height: normal; word-wrap: break-word;">　　对于双目运算，则要求当参与运算的两个值是等值的情况下，如果满足运算结果与参与运算的两个值相等，则称该运算幂等，如求两个数的最大值的函数，有在在实数集中幂等，即max(x,x)　=　x。<br style="line-height: normal; word-wrap: break-word;"><br style="line-height: normal; word-wrap: break-word;">　　看完上述解释后，应该可以理解GET幂等的含义了。</span></span> </p> 
<p> </p> 
<p><span class="Apple-style-span" style="word-spacing: 0px; font: 14px/21px arial; text-transform: none; color: #000000; text-indent: 0px; white-space: normal; letter-spacing: normal; border-collapse: collapse; orphans: 2; widows: 2; webkit-border-horizontal-spacing: 2px; webkit-border-vertical-spacing: 2px; webkit-text-decorations-in-effect: none; webkit-text-size-adjust: auto; webkit-text-stroke-width: 0;">2. XCAP（XML Configuration Access Protocol，XML配置访问协议），也称XML配置接入协议。它是IETF制定的一个协议，前面陆续发布了一系列草案，于2007年5月正式成为RFC规范。该协议允许客户端读、写、修改存放在服务器中的XML格式的应用配置数据。XCAP将XML文档中的节点映射到HTTP URIs中，使得这些组件能够直接通过HTTP访问。该协议中有一个极为重要的概念—幂等性，英文为idempotency。如果读者最先没有接触过相关协议，初次遇到这个概念难免不知所云。本文结合XCAP协议对这个概念做出解释。首先，我们来看一下XCAP协议的原文，看看协议怎么说。原文摘自RFC 4825。7.       Client OperationsHTTP also specifies that PUT and DELETE requests are idempotent. This means that, if the client performs a PUT on a document and it succeeds, it can perform the same PUT, and the resulting document will look the same（HTTP也要求PUT和DELETE请求满足幂等性。这意味着，如果一个客户端在一个文档上执行了PUT操作，并且执行成功。那么在该文档上再次执行同样的PUT操作，操作后的文档跟操作前是一样的（即内容没有发生改变））. Similarly, when a client performs a DELETE, if it succeeds, a subsequent DELETE to the same URI will generate a 404; the resource no longer exists on the server since it was deleted by the previous DELETE operation(同样地，当客户端执行一个DELETE，如果成功了，那么接下来的具有同样URI的DELETE操作将返回404，这是因为先前的DELETE已经将该资源删除，该资源已经不存在了) . To maintain this property, the client SHOULD construct its URIs such that, after the modification has taken place, the URI in the request will point to the resource just   inserted for PUT (i.e., the body of the request), and will point to   nothing for DELETE（为了维护这个属性，客户端构造的URI应该满足：修改发生之后，请求中的URI对于PUT来说将指向刚刚插入的资源（如请求消息体），对于DELETE则指向空）. If this property is maintained, it is the case that GET to the URI in the PUT will return the same content (i.e., GET(PUT(X)) == x). This property implies idempotency（如果满足该属性，那么对PUT请求中的URI执行GET操作将返回与PUT请求消息体中同样的内容（即GET(PUT(X)==X)）这个属性就被称为幂等性）. Although a request can still be idempotent if it does not possess this property, XCAP does not permit such requests. If the client's request does not have this property, the server will reject the request with a 409 and indicate a cannot-insert error condition.（尽管不拥有这个属性的请求也可能是幂等的，但是XCAP不允许这样的请求。如果客户的请求不具有这个属性，那么服务器将以409拒绝，并指示不能插入错误。）   从上面协议中的描述可以看出，这里的幂等性主要与修改操作有关，即PUT和DELETE方法。对于PUT来说，就是同样的PUT操作无论执行多少次，其结果都跟第一次执行的结果相同，后面会介绍一个例子。而对于DELETE操作来说，一次删除之后资源就不存在了。这里举一个不满足幂等性的DELETE例子，如某个DELETE操作指示删除XML文档中某个根元素下的第一个元素，如果该根元素下不只一个元素，那么显然该操作不满足幂等性。因为第一次该根元素下的第一个元素被删除了，但是第二个元素自动成为了该根元素的第一个元素，第二次执行DELETE时并不返回404，因此不满足幂等性的规定。下面我们再看看协议中7.4节对幂等性的描述，它提到了幂等性对操作所带来的限制以及解决办法。7.4. Create or Replace an ElementTo be certain that element insertions have the GET(PUT(x))==x property, the client can check that the attribute predicates in the final path segment of the URI match the attributes of the element in the body of the request. As an example of an request that would not have this property and therefore not be idempotent, consider the following PUT request (URIs are line-folded for readability):（为了确保元素插入满足幂等性，客户端应该检查URI路径中的属性谓词，看它是否与请求消息体中元素的属性值向匹配。一个不具有该属性的请求，它是非幂等的，来看下面的请求（URI折行是为了便于阅读））   PUT   /rls-services/users/<a style="color: #3366cc; text-decoration: none;" href="http://sip:bill@example.com/index/~~/rls-services/" rel="nofollow">sip:bill@example.com/index/~~/rls-services/</a><span class="Apple-converted-space"> </span>  service%5b@uri=%<a style="color: #3366cc; text-decoration: none;" href="mailto:22sip%3Agood-friends@example.com" rel="nofollow">22sip:good-friends@example.com</a>%22%5d    HTTP/1.1   Content-Type:application/xcap-el+xml   Host:<span class="Apple-converted-space"> </span><a style="color: #3366cc; text-decoration: none;" href="http://xcap.example.com/" rel="nofollow">xcap.example.com</a><span class="Apple-converted-space"> </span>  &lt;service uri="<a style="color: #3366cc; text-decoration: none;" href="mailto:sip%3Amybuddies@example.com" rel="nofollow">sip:mybuddies@example.com</a>"&gt;     &lt;resource-list&gt;<a style="color: #3366cc; text-decoration: none;" href="http://xcap.example.com/resource-lists/users" rel="nofollow">http://xcap.example.com/resource-lists/users</a><span class="Apple-converted-space"> </span>  /<a style="color: #3366cc; text-decoration: none;" href="http://sip:joe@example.com/index/~~/resource-lists/list%5b@name=%22l1%22%5d" rel="nofollow">sip:joe@example.com/index/~~/resource-lists/list%5b@name=%22l1%22%5d</a><span class="Apple-converted-space"> </span>  &lt;/resource-list&gt;      &lt;packages&gt;      &lt;package&gt;presence&lt;/package&gt;     &lt;/packages&gt;   &lt;/service&gt;This request will fail with a 409. The Request URI contains a final path segment with a predicate based on attributes -   @uri="<a style="color: #3366cc; text-decoration: none;" href="mailto:sip%3Agood-friends@example.com" rel="nofollow">sip:good-friends@example.com</a>". However, this will not match the value of the "uri" attribute in the element in the body (<a style="color: #3366cc; text-decoration: none;" href="mailto:sip%3Amybuddies@example.com" rel="nofollow">sip:mybuddies@example.com</a>)（请求将以409失败。该请求的URI中包含了@uri="<a style="color: #3366cc; text-decoration: none;" href="mailto:sip%3Agood-friends@example.com" rel="nofollow">sip:good-friends@example.com</a>"。然而它与请求消息体中元素的属性值<a style="color: #3366cc; text-decoration: none;" href="mailto:sip%3Amybuddies@example.com" rel="nofollow">sip:mybuddies@example.com</a>不匹配）.    也就是说，上面例子中URI中属性指示的值与请求消息体中不匹配，因此不满足幂等性。下面的协议部分讲述了幂等性的局限性。The GET(PUT(x))==x property introduces some limitations on the types   of operations possible. It will not be possible to replace an element with one that has a new value for an attribute that is the sole unique element identifier, if the URI contained a node selector which was using the previous value of that attribute for purposes of selecting the element. This is exactly the use case in the example above（GET(PUT(x))==x属性给某些操作带来了一些限制。对于用一个新的属性值去替换一个元素，而该属性是该元素的唯一标识，这操作是可能执行的。因为如果URI的节点选择符中包含了先前的属性值，那么这正好是上面例中的情况）. To get around this limitation, the selection can be done by position instead of attribute value, or the parent of the element to be replaced can be selected, and then the body of the PUT operation would contain the parent, the child to be replaced, and all other siblings.（为了解决这个限制问题，可以通过基于位置的属性值替换。或者通过选择元素的父元素替换，这样它的子元素和所有其他兄弟都将被替换。）下面对上面协议的描述做一个解释。幂等性带来的限制就是如果该属性唯一标识该元素，那么无法用新的属性值去替换一个元素。比如下面的例子，假设XML文档中含有如下元素：&lt;book id=”1234567”&gt;Inside the C++ Object Model&lt;/book&gt;这个时候你以如下的元素来替换上面的元素将是无法办到的，即&lt;book id=”7654321”&gt;Unix Network Programming&lt;/book&gt;原因在于，你如果要替换该元素那么首先要通过id=”1234567”来把该元素标识出来，即指明你要替换这个元素。然而你的PUT请求消息体中的id却是”7654321”，这就恰恰违背了幂等性操作的约束。这就使幂等性所带来的限制。</span></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e7a0928b5d078b3de69ee6b66db985c5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">iBatis resultMap报错　nullValue完美解决</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d5e1e65953c356831296cdf399e5ca12/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">各大主流的虚拟机比较</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>