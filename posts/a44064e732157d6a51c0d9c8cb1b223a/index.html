<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>POST上传JSON数据 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="POST上传JSON数据" />
<meta property="og:description" content="POST上传JSON数据到服务器时有以下两种方式，但是最常用的是第二种：
第一种：将要上传的JSON字符串（内容中的双引号前面必须要加转义字符\）然后按照UTF8编码格式转为NSData再设置给请求的数据体。如下所示：NSString *str = @&#34;{\&#34;username\&#34; : \&#34;小明\&#34;,\&#34;age\&#34; : \&#34;24\&#34;}&#34;;request.HTTPBody = [str dataUsingEncoding:NSUTF8StringEncoding];
第二种：就要上传的数据保存到字典或数组中（只限于此两种容器），然后需要检测给定的对象是否能被序列化。需要使用NSJSONSerialization的方法isValidJSONObject：进行判断，如果能被序列化则进行序列化操作。
NSJSONSerialization的介绍：
An object that may be converted to JSON must have the following properties:
- Top level object is an NSArray or NSDictionary
表示顶级结点是字典或数组
- All objects are NSString, NSNumber, NSArray, NSDictionary, or NSNull
所有对象是 NSString, NSNumber, NSArray, NSDictionary, or NSNull
- All dictionary keys are NSStrings
所有字典的Key必须是NSString
- NSNumbers are not NaN or infinity
NSNumber必须指定，不能是无穷大。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a44064e732157d6a51c0d9c8cb1b223a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-10-28T16:41:00+08:00" />
<meta property="article:modified_time" content="2015-10-28T16:41:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">POST上传JSON数据</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="font-size:18px;">POST上传JSON数据到服务器时有以下两种方式，但是最常用的是第二种：</span></p> 
<p><span style="font-size:18px;">第一种：将要上传的JSON字符串（内容中的双引号前面必须要加转义字符\）然后按照UTF8编码格式转为NSData再设置给请求的数据体。如下所示：<span class="s1">NSString *str = @"{\"username\" : \"</span><span class="s2">小明</span><span class="s1">\",\"age\" : \"24\"}";</span>request.HTTPBody = [str dataUsingEncoding:NSUTF8StringEncoding];</span></p> 
<p><span style="font-size:18px;">第二种：就要上传的数据保存到字典或数组中（只限于此两种容器），然后需要检测给定的对象是否能被序列化。需要使用NSJSONSerialization的方法isValidJSONObject：进行判断，如果能被序列化则进行序列化操作。</span></p> 
<p></p> 
<p class="p1"><span style="font-size:18px;"><span class="s1">NSJSONSerialization</span><span class="s2">的介绍：</span></span></p> 
<p class="p2"><span class="s1"><span style="font-size:18px;"></span></span></p> 
<p class="p1"><span class="s1"><span style="font-size:18px;">An object that may be converted to JSON must have the following properties:</span></span></p> 
<p class="p1"><span class="s1"><span style="font-size:18px;">- Top level object is an NSArray or NSDictionary</span></span></p> 
<p class="p3"><span style="font-size:18px;"><span class="s3"> </span><span class="s1">表示顶级结点是字典或数组</span></span></p> 
<p class="p2"><span class="s1"><span style="font-size:18px;"></span></span><span style="font-size:18px;">- All objects are NSString, NSNumber, NSArray, NSDictionary, or NSNull</span></p> 
<p class="p1"><span style="font-size:18px;"><span class="s1"></span><span class="s2">所有对象是</span><span class="s1"> NSString, NSNumber, NSArray, NSDictionary, or NSNull</span></span></p> 
<p class="p2"><span class="s1"><span style="font-size:18px;"></span></span><span style="font-size:18px;">- All dictionary keys are NSStrings</span></p> 
<p class="p1"><span style="font-size:18px;"><span class="s1"></span><span class="s2">所有字典的</span><span class="s1">Key</span><span class="s2">必须是</span><span class="s1">NSString</span></span></p> 
<p class="p2"><span class="s1"><span style="font-size:18px;"></span></span><span style="font-size:18px;">- NSNumbers are not NaN or infinity</span></p> 
<p class="p3"><span style="font-size:18px;"><span class="s3">NSNumber</span><span class="s1">必须指定，不能是无穷大。</span></span></p> 
<p class="p2"><span class="s1"><span style="font-size:18px;"></span></span><span style="font-size:18px;">+ (BOOL)isValidJSONObject:(id)obj;</span></p> 
<p class="p3"><span style="font-size:18px;"><span class="s3"></span><span class="s1">用来检测给定的对象能否被序列化</span></span></p> 
<span style="font-size:18px;"><br></span> 
<p><span style="font-size:18px;">具体工程如下：</span></p> 
<p></p> 
<pre><code class="language-objc">&lt;span style="font-size:18px;"&gt;//
//  ViewController.m
//  POST上传JSON数据
//
//  Created by apple on 15/10/28.
//  Copyright (c) 2015年 LiuXun. All rights reserved.
//

#import "ViewController.h"

@interface ViewController ()

@end

@implementation ViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    
    
    // 1. url
    NSURL *url = [NSURL URLWithString:@"http://127.0.0.1/post/postjson.php"];
    
    // 2. 请求
    NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url cachePolicy:1 timeoutInterval:2.0f];
    
    // 2.1 设置HTTP方法
    request.HTTPMethod = @"POST";
    
    // 2.2 上传JSON数据（本质就是一个字符串，特殊的字符串）
    // 序列化：将NSArray/NSDictionary 转成JSON特殊数据类型的二进制数据
    // 反序列化：将服务器返回的二进制数据转成NSArray/NSDictionary
//    NSString *str = @"{\"username\" : \"小明\",\"age\" : \"24\"}";
//    request.HTTPBody = [str dataUsingEncoding:NSUTF8StringEncoding];
    
    NSDictionary *dict1 = @{@"name":@"xiaofang", @"age":@"18"};
     NSDictionary *dict2 = @{@"name":@"xiaoming", @"age":@(108)};
    NSArray *array = @[dict1,dict2];
    
    // 检测给定的对象能否被序列化
    if (![NSJSONSerialization isValidJSONObject:array]) {
        NSLog(@"格式不正确，不能被序列化");
        return;
    }
    request.HTTPBody = [NSJSONSerialization dataWithJSONObject:array options:0 error:NULL];
    
    // 3. 连接
    [NSURLConnection sendAsynchronousRequest:request queue:[NSOperationQueue mainQueue] completionHandler:^(NSURLResponse *response, NSData *data, NSError *connectionError) {
        // 返回二进制数据
        id result = [[NSString alloc] initWithData:data encoding:NSUTF8StringEncoding];
        NSLog(@"result= %@", result);
        
    }];

}

-(void)test
{

}
@end

/***
 NSJSONSerialization的介绍：
 
 An object that may be converted to JSON must have the following properties:
 - Top level object is an NSArray or NSDictionary
  表示顶级结点是字典或数组
 
 - All objects are NSString, NSNumber, NSArray, NSDictionary, or NSNull
 所有对象是 NSString, NSNumber, NSArray, NSDictionary, or NSNull
 
 - All dictionary keys are NSStrings
 所有字典的Key必须是NSString
 
 - NSNumbers are not NaN or infinity
 NSNumber必须指定，不能是无穷大。
 
 + (BOOL)isValidJSONObject:(id)obj;
 用来检测给定的对象能否被序列化
 */&lt;/span&gt;</code></pre> 
<span style="font-size:18px;"><br> 运行结果如下：</span> 
<p></p> 
<p><span style="font-size:18px;"><img src="https://images2.imgbox.com/b4/27/3RGpUanw_o.png" alt=""></span><br></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/845ee0fd6ab657a79eab6d2400099c26/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">常用排序算法分析与实现</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d29981e4b8f57d49540af86d49ab303d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Yarn 调度器Scheduler详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>