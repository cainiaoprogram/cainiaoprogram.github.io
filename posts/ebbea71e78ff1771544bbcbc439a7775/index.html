<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Kafka-配置Kerberos安全认证(JDK8、JDK11) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Kafka-配置Kerberos安全认证(JDK8、JDK11)" />
<meta property="og:description" content="一、相关配置 1、JAAS 配置文件
KafkaClient { com.sun.security.auth.module.Krb5LoginModule required useKeyTab=true storeKey=true serviceName=&#34;kafka&#34; keyTab=&#34;D:/code/demo/conf/kafka.service.keytab&#34; principal=&#34;kafka/hdp-1&#34;; }; 2、keytab 文件（kafka.service.keytab）
从 Kerberos 服务器上拷贝到目标机器 或 找运维人员要一份
3、Kerberos 配置文件（krb5.conf）
krb5文件参数说明：krb5.conf(5)
从 Kerberos 服务器上拷贝到目标机器 或 找运维人员要一份
# Configuration snippets may be placed in this directory as well # JDK11此行配置要去掉 includedir /etc/krb5.conf.d/ [logging] default = FILE:/var/log/krb5libs.log kdc = FILE:/var/log/krb5kdc.log admin_server = FILE:/var/log/kadmind.log [libdefaults] default_realm = HADOOP.COM dns_lookup_realm = false dns_lookup_kdc = false ticket_lifetime = 24h renew_lifetime = 7d forwardable = true rdns = false udp_preference_limit = 1 [realms] HADOOP." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ebbea71e78ff1771544bbcbc439a7775/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-19T13:40:43+08:00" />
<meta property="article:modified_time" content="2023-12-19T13:40:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Kafka-配置Kerberos安全认证(JDK8、JDK11)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>一、相关配置</h4> 
<p>1、JAAS 配置文件</p> 
<pre><code class="language-bash">KafkaClient {
    com.sun.security.auth.module.Krb5LoginModule required
    useKeyTab=true
    storeKey=true
    serviceName="kafka"
    keyTab="D:/code/demo/conf/kafka.service.keytab"
    principal="kafka/hdp-1";
};</code></pre> 
<p>2、keytab 文件（kafka.service.keytab）</p> 
<p>从 Kerberos 服务器上拷贝到目标机器 或 找运维人员要一份</p> 
<p>3、Kerberos 配置文件（krb5.conf）</p> 
<p>krb5文件参数说明：<a href="https://www.daemon-systems.org/man/krb5.conf.5.html" rel="nofollow" title="krb5.conf(5)">krb5.conf(5)</a></p> 
<p>从 Kerberos 服务器上拷贝到目标机器 或 找运维人员要一份</p> 
<pre><code class="language-java"># Configuration snippets may be placed in this directory as well
# JDK11此行配置要去掉
includedir /etc/krb5.conf.d/

[logging]
 default = FILE:/var/log/krb5libs.log
 kdc = FILE:/var/log/krb5kdc.log
 admin_server = FILE:/var/log/kadmind.log

[libdefaults]
  default_realm = HADOOP.COM 
  dns_lookup_realm = false
  dns_lookup_kdc = false
  ticket_lifetime = 24h  
  renew_lifetime = 7d   
  forwardable = true
  rdns = false
  udp_preference_limit = 1

[realms]
 HADOOP.COM = {   
  kdc = hdp-1:88  
  admin_server = hdp-1:749
  default_domain = HADOOP.COM
 }

[domain_realm]
 .HADOOP.COM = HADOOP.COM 
 HADOOP.COM = HADOOP.COM
</code></pre> 
<p><span style="color:#fe2c24;">Tip：</span>JDK11版本 sun.security.krb5.Config 类有修改，不去掉会有如下报错：</p> 
<pre><code class="language-java">Caused by: KrbException: krb5.conf loading failed</code></pre> 
<p><img alt="" height="662" src="https://images2.imgbox.com/2b/45/KObSjzXL_o.png" width="1200"></p> 
<p> readConfigFileLines方法：<img alt="" height="1086" src="https://images2.imgbox.com/4e/dc/RslUXrvB_o.png" width="1200"></p> 
<p></p> 
<h4>二、修改hosts文件</h4> 
<pre><code class="language-bash">192.168.16.14  hdp-1</code></pre> 
<p></p> 
<h4>三、根据自己的kafka版本引入依赖</h4> 
<pre><code class="language-bash">        &lt;!-- 需要引入与所安装的kafka对应版本的依赖 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt;
            &lt;artifactId&gt;kafka-clients&lt;/artifactId&gt;
            &lt;version&gt;3.1.0&lt;/version&gt;
        &lt;/dependency&gt;</code></pre> 
<p></p> 
<h4>四、生产者样例代码</h4> 
<pre><code class="language-java">package com.example.demo.kafka;

import org.apache.kafka.clients.producer.KafkaProducer;
import org.apache.kafka.clients.producer.Producer;
import org.apache.kafka.clients.producer.ProducerRecord;

import java.util.Properties;

/**
 * @Author: meng
 * @Version: 1.0
 */
public class ProductKafkaKerberos {

    public static void main(String[] args) {
        String filePath = System.getProperty("user.dir") + "\\conf\\";
        System.setProperty("java.security.auth.login.config", filePath + "kafka_client_jaas.conf");
        System.setProperty("java.security.krb5.conf", filePath + "krb5.conf");

        Properties props = new Properties();
        props.put("bootstrap.servers", "hdp-1:9092");
        props.put("acks", "all");
        props.put("key.serializer", "org.apache.kafka.common.serialization.StringSerializer");
        props.put("value.serializer", "org.apache.kafka.common.serialization.StringSerializer");
        // sasl
        props.put("jaas.enabled", true);
        props.put("sasl.mechanism", "GSSAPI");
        props.put("security.protocol", "SASL_PLAINTEXT");
        props.put("sasl.kerberos.service.name", "kafka");

        Producer&lt;String, String&gt; producer = new KafkaProducer&lt;&gt;(props);
        for (int i = 0; i &lt; 3; i++) {
            producer.send(new ProducerRecord&lt;String, String&gt;("test", Integer.toString(i), Integer.toString(i)));
        }
        System.out.println("producer is success");
        producer.close();
    }

}
</code></pre> 
<p></p> 
<h4>五、消费者样例代码</h4> 
<pre><code class="language-java">package com.example.demo.kafka;

import org.apache.kafka.clients.consumer.ConsumerRecord;
import org.apache.kafka.clients.consumer.ConsumerRecords;
import org.apache.kafka.clients.consumer.KafkaConsumer;

import java.time.Duration;
import java.util.Arrays;
import java.util.Properties;

/**
 * @Author: meng
 * @Version: 1.0
 */
public class ConsumertKafkaKerberos {

    public static void main(String[] args) {
        String filePath = System.getProperty("user.dir") + "\\conf\\";
        System.setProperty("java.security.auth.login.config", filePath + "kafka_client_jaas.conf");
        System.setProperty("java.security.krb5.conf", filePath + "krb5.conf");

        Properties props = new Properties();
        props.put("bootstrap.servers", "hdp-1:9092");
        props.put("group.id", "test_group");
        props.put("enable.auto.commit", "true");
        props.put("auto.commit.interval.ms", "1000");
        props.put("key.deserializer", "org.apache.kafka.common.serialization.StringDeserializer");
        props.put("value.deserializer", "org.apache.kafka.common.serialization.StringDeserializer");
        // sasl
        props.put("sasl.mechanism", "GSSAPI");
        props.put("security.protocol", "SASL_PLAINTEXT");
        props.put("sasl.kerberos.service.name", "kafka");

        @SuppressWarnings("resource")
        KafkaConsumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;String, String&gt;(props);
        String topic = "test";
        consumer.subscribe(Arrays.asList(topic));
        while (true) {
            try {
                ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(1000));
                for (ConsumerRecord&lt;String, String&gt; record : records) {
                    System.out.printf("offset = %d, partition = %d, key = %s, value = %s%n",
                            record.offset(), record.partition(), record.key(), record.value());
                }
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    }

}
</code></pre> 
<p></p> 
<p></p> 
<p></p> 
<p>相关博客：<a class="has-card" href="https://www.cnblogs.com/myownswordsman/p/kafka-security-kerberos.html" rel="nofollow" title="https://www.cnblogs.com/myownswordsman/p/kafka-security-kerberos.html"><span class="link-card-box"><span class="link-title">https://www.cnblogs.com/myownswordsman/p/kafka-security-kerberos.html</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/b6/59/apOJFI2p_o.png" alt="icon-default.png?t=N7T8">https://www.cnblogs.com/myownswordsman/p/kafka-security-kerberos.html</span></span></a><a class="has-card" href="https://seevae.github.io/2020/09/12/%E8%AF%A6%E8%A7%A3kerberos%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B/" rel="nofollow" title="详解kerberos认证原理 | Hero"><span class="link-card-box"><span class="link-title">详解kerberos认证原理 | Hero</span><span class="link-desc">前言Kerberos协议是一个专注于验证通信双方身份的网络协议，不同于其他网络安全协议的保证整个通信过程的传输安全，kerberos侧重于通信前双方身份的认定工作，帮助客户端和服务端解决“证明我自己是我自己”的问题，从而使得通信两端能够完全信任对方身份，在一个不安全的网络中完成一次安全的身份认证继而进行安全的通信。由于整个Kerberos认证过程较为复杂繁琐且网上版本较多，特整理此文以便复习与分享</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/ee/5b/yErNcFO3_o.png" alt="icon-default.png?t=N7T8">https://seevae.github.io/2020/09/12/%E8%AF%A6%E8%A7%A3kerberos%E8%AE%A4%E8%AF%81%E6%B5%81%E7%A8%8B/</span></span></a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ba61ad06141467b234602cb3cc1c33b1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SCS【37】hdWGCNA在空间转录组学中的作用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f2f5076bf34b1263cb5e78439402bdd0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">@rollup/plugin-html 详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>