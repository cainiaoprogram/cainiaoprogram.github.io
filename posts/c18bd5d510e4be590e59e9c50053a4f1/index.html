<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>nuxt.js服务端渲染项目性能优化总结 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="nuxt.js服务端渲染项目性能优化总结" />
<meta property="og:description" content="众所周知，Vue作为前端开发的三大框架扛把子之一，在国内众多小微厂使用还是很多的，都知道Vue一般作为客户端渲染模式，在某些业务场景可能十分不友好，比如电商业务；为啥说不友好呢，因为Vue一般是使用客户端渲染，数据都是通过Ajax请求回来的，搜索引擎无法抓取到动态的内容，所以要用到服务端渲染，服务端有多种实现方式，Vue官方也自带SSR解决方案，Vue服务端渲染
由于项目前端使用的是Nuxt实现的SSR，在其中也踩了不少坑，做过几轮性能优化，下面通过实际项目经验总结一下：
从项目基础配置方面 页面布局结构化，例如：footer，header，main等解构语义标签的应用 &lt;!--default.vue--&gt; &lt;header&gt; &lt;!--网站公用头部--&gt; &lt;/header&gt; &lt;main&gt; &lt;!--网站试图渲染--&gt; &lt;Nuxt /&gt; &lt;/main&gt; &lt;footer&gt; &lt;!--网站公用底部--&gt; &lt;/footer&gt; 使用Webpack这个工具进行合理的文件拆包，Webpack用好之后十分强大，最后项目文件编译之后包文件大小是固定的，如果拆包粒度过小，导致并发请求多，每个请求中TTFB里等待时间较长，如果拆包粒度过大，导致下载时间较长，需要不断调试，寻找适合项目的平衡点；Webpack拆包文档第三方包组件安装依赖按需引入加载，如果是协助辅助开发环境的npm包或辅助编译的包不要安装在生产环境，会被打包进包文件中，导致包文件过大；分析打包之后的文件包含的依赖，移除无用的plugins（如移动端的vconsole工具）；一般脚手架都自带分析工具指令，如package.json下&#34;build:ana&#34;: &#34;nuxt build --analyze&#34;，运行npm run build:ana，会展示编译后包文件包含的大小，将不需要的资源移除；合理使用vue-lazy-hydration水合组件，合理使用客户端渲染，可有效防止页面偏移分数和LCP分数；合理使用CDN缓存，如脚本资源、图片等放CDN；合理引入加载第三方脚本，如livechat、 googleMap等脚本的初始化脚本，如非必要可使用滚屏加载初始化脚本或在需要使用的模块使用初始化脚本；图片大小优化，如单张占位图可压缩后使用大小缩小了5.5倍；压缩链接 除了项目基础配置能大幅提高项目测试评分外，还有很大一部分源于各位编程大佬的编码风格和程序稳定性，小厂一般都没啥规范，规范也不容易推行起来，下面我们从项目规范方便再讲一讲：
从项目编码规范方面 首页首屏加载移除无用的网络加载请求，看不到的地方使用滚屏加载（可以判断是否是爬虫），真正实现所看即所得，首页删除多余的相同功能的组件引入；项目组件引入懒加载，如初始状态组件不需要展示的组件可优先不渲染组件（v-if）；项目中组件粒度的合理拆分和组件封装复用；项目编码删除冗余的嵌套HTML标签，融合可以减少的HTML嵌套标签，减少组件之间的嵌套层级，嵌套层级越深，DOM层级就越深；正确的使用HTML标签嵌套，p、h1~h5等标签含有语义，里面不可嵌套块级标签，尽可能不嵌套其他HTML标签；首页banner使用原生HTML标签使用背景图占位，可加快FCP和LCP的速度，Element-UI 的bannerUI组件解析渲染速度相对较慢； &lt;!--index.vue--&gt; &lt;div style=&#34;150px&#34; v-if=&#34;!bannerList.length&#34;&gt; &lt;!--使用CSS背景占位，加快首屏渲染和最大页面元素渲染--&gt; &lt;div&gt; &lt;el-carousel height=&#34;150px&#34; v-else&gt; &lt;el-carousel-item v-for=&#34;item in 4&#34; :key=&#34;item&#34;&gt; &lt;h3 class=&#34;small&#34;&gt;{{ item }}&lt;/h3&gt; &lt;/el-carousel-item&gt; &lt;/el-carousel&gt; &lt;!--to do ...--&gt; &lt;script&gt; // ... data() { return { bannerList: [] // 通过ajax拿到数据赋值 } } &lt;/script&gt; 服务端asyncData使用安全的解构语法(let { data } = res || {};)解构服务端数据，服务端数据解构异常报错不会体现在浏览器上，出现问题十分难排查；合理使用公共方法，将页面中大量的逻辑判断条件抽离成函数或计算属性； 附上相关链接：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c18bd5d510e4be590e59e9c50053a4f1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-15T21:34:06+08:00" />
<meta property="article:modified_time" content="2022-08-15T21:34:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">nuxt.js服务端渲染项目性能优化总结</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>众所周知，<code>Vue</code>作为前端开发的三大框架扛把子之一，在国内众多小微厂使用还是很多的，都知道<code>Vue</code>一般作为客户端渲染模式，在某些业务场景可能十分不友好，比如电商业务；为啥说不友好呢，因为<code>Vue</code>一般是使用客户端渲染，数据都是通过<code>Ajax</code>请求回来的，搜索引擎无法抓取到动态的内容，所以要用到服务端渲染，服务端有多种实现方式，<code>Vue</code>官方也自带<code>SSR</code>解决方案，<a href="https://cn.vuejs.org/guide/scaling-up/ssr.html#access-to-platform-specific-apis" rel="nofollow">Vue服务端渲染</a><br> 由于项目前端使用的是<code>Nuxt</code>实现的<code>SSR</code>，在其中也踩了不少坑，做过几轮性能优化，下面通过实际项目经验总结一下：</p> 
<h6><a id="_2"></a>从项目基础配置方面</h6> 
<ol><li>页面布局结构化，例如：<code>footer</code>，<code>header</code>，<code>main</code>等解构语义标签的应用</li></ol> 
<pre><code class="prism language-html"><span class="token comment">&lt;!--default.vue--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--网站公用头部--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>main</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!--网站试图渲染--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Nuxt</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>main</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--网站公用底部--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<ol start="2"><li>使用<code>Webpack</code>这个工具进行合理的文件拆包，<code>Webpack</code>用好之后十分强大，最后项目文件编译之后包文件大小是固定的，如果拆包粒度过小，导致并发请求多，每个请求中<code>TTFB</code>里等待时间较长，如果拆包粒度过大，导致下载时间较长，需要不断调试，寻找适合项目的平衡点；<a href="https://webpack.docschina.org/plugins/split-chunks-plugin#root" rel="nofollow">Webpack拆包文档</a></li><li>第三方包组件安装依赖按需引入加载，如果是协助辅助开发环境的<code>npm</code>包或辅助编译的包不要安装在生产环境，会被打包进包文件中，导致包文件过大；分析打包之后的文件包含的依赖，移除无用的<code>plugins</code>（如移动端的<code>vconsole</code>工具）；一般脚手架都自带分析工具指令，如<code>package.json</code>下<code>"build:ana": "nuxt build --analyze"</code>，运行<code>npm run build:ana</code>，会展示编译后包文件包含的大小，将不需要的资源移除；</li><li>合理使用<code>vue-lazy-hydration</code>水合组件，合理使用客户端渲染，可有效防止页面偏移分数和<code>LCP</code>分数；</li><li>合理使用CDN缓存，如脚本资源、图片等放CDN；</li><li>合理引入加载第三方脚本，如<code>livechat</code>、 <code>googleMap</code>等脚本的初始化脚本，如非必要可使用滚屏加载初始化脚本或在需要使用的模块使用初始化脚本；</li><li>图片大小优化，如单张占位图可压缩后使用大小缩小了5.5倍；<a href="https://tinypng.com/" rel="nofollow">压缩链接</a></li></ol> 
<p>除了项目基础配置能大幅提高项目测试评分外，还有很大一部分源于各位编程大佬的编码风格和程序稳定性，小厂一般都没啥规范，规范也不容易推行起来，下面我们从项目规范方便再讲一讲：</p> 
<h6><a id="_27"></a>从项目编码规范方面</h6> 
<ol><li>首页首屏加载移除无用的网络加载请求，看不到的地方使用滚屏加载（可以判断是否是爬虫），真正实现所看即所得，首页删除多余的相同功能的组件引入；</li><li>项目组件引入懒加载，如初始状态组件不需要展示的组件可优先不渲染组件（<code>v-if</code>）；</li><li>项目中组件粒度的合理拆分和组件封装复用；</li><li>项目编码删除冗余的嵌套<code>HTML</code>标签，融合可以减少的<code>HTML</code>嵌套标签，减少组件之间的嵌套层级，嵌套层级越深，<code>DOM</code>层级就越深；</li><li>正确的使用<code>HTML</code>标签嵌套，<code>p</code>、<code>h1~h5</code>等标签含有语义，里面不可嵌套块级标签，尽可能不嵌套其他<code>HTML</code>标签；</li><li>首页<code>banner</code>使用原生<code>HTML</code>标签使用背景图占位，可加快<code>FCP</code>和<code>LCP</code>的速度，<code>Element-UI</code> 的<code>banner</code>UI组件解析渲染速度相对较慢；</li></ol> 
<pre><code class="prism language-html"><span class="token comment">&lt;!--index.vue--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css">150px</span><span class="token punctuation">"</span></span></span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>!bannerList.length<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--使用CSS背景占位，加快首屏渲染和最大页面元素渲染--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-carousel</span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>150px<span class="token punctuation">"</span></span> <span class="token attr-name">v-else</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-carousel-item</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item in 4<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h3</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>small<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{ item }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h3</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-carousel-item</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-carousel</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!--to do ...--&gt;</span>
 
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
 <span class="token comment">// ...</span>
 <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
   	<span class="token literal-property property">bannerList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">// 通过ajax拿到数据赋值</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<ol start="7"><li>服务端<code>asyncData</code>使用安全的解构语法(<code>let { data } = res || {};</code>)解构服务端数据，服务端数据解构异常报错不会体现在浏览器上，出现问题十分难排查；</li><li>合理使用公共方法，将页面中大量的逻辑判断条件抽离成函数或计算属性；</li></ol> 
<p>附上相关链接：<br> <a href="https://gtmetrix.com/" rel="nofollow">测分网站</a><br> <a href="https://web.dev/lcp/#what-elements-are-considered" rel="nofollow">LCP</a><br> <a href="https://web.dev/fcp/" rel="nofollow">FCP</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/625d864a0ed6e32e32f1f88ea5d86e57/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">android AV流程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4bf0c1ec9ee3cdd546d985f2c0070935/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java基础|file类的创建、相对路径的三种写法【建议收藏】</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>