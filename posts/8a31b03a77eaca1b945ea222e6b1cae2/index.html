<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>自动化运维管理工具 Ansible的详细解读 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="自动化运维管理工具 Ansible的详细解读" />
<meta property="og:description" content="Ansible的详细解读 一、Ansible介绍2.1 Ansible能做什么？2.2 Ansible的特性和原理 二、Ansible部署① 管理端安装 ansible 服务② 配置主机清单③ 配置密钥对验证④ 设置免密登录⑤ 查询被控制端的当前日期测试 三、Ansible命令模块3.1 command模块3.2 shell模块3.3 cron模块3.4 user模块3.5 group模块3.6 copy模块3.7 file模块3.8 hostname 模块3.9 ping 模块3.10 yum 模块3.11 service/systemd 模块3.12 script 模块3.13 setup 模块 一、Ansible介绍 ____Ansible是一个基于 Python开发 的配置管理和应用部署工具，现在也在自动化管理领域大放异彩。它融合了众多老牌运维工具的优点，Pubbet和Saltstack能实现的功能，Ansible基本上都可以实现。
2.1 Ansible能做什么？ ____Ansible能批量配置、部署、管理上千台主机。比如以前需要切换到每个主机上执行的一或多个操作，使用Ansible只需在固定的一台Ansible控制节点上去完成所有主机的操作。
____Ansible是 基于模块工作 的，它只是提供了一种运行框架，它本身没有完成任务的能力，真正执行操作的是Ansible的模块 ，比如copy模块用于拷贝文件到远程主机上，service模块用于管理服务的启动、停止、重启等。
2.2 Ansible的特性和原理 ____Ansible其中一个比较鲜明的特性是Agentless ，即无Agent的存在，它就像普通命令一样，并非C/S软件，也只需在某个作为控制节点的主机上安装一次Ansible即可， 通常它基于ssh连接 来控制远程主机，远程主机上不需要安装Ansible或其它额外的服务。
____使用者在使用时，在服务器终端输入命令或者playbooks，会通过预定好的规则将playbook拆解为play，再组织成ansible可以识别的任务调用模块和插件，根据主机清单通过SSH将临时文件发给远程的客户端执行并返回结果，执行结束后自动删除。
____Ansible的另一个比较鲜明的特性是它的绝大多数模块都具备幂等性(idempotence)。所谓幂等性，指的是多次操作或多次执行对系统资源的影响是一致的。 比如执行systemctl stop xxx 命令来停止服务，当发现要停止的目标服务已经处于停止状态,它什么也不会做，所以多次停止的结果仍然是停止，不会改变结果，它是幂等的，而systemctl restart xxx是非幂等的。
____Ansible的很多模块在执行时都会先判断目标节点是否要执行任务，所以，可以放心大胆地让Ansible去执行任务，重复执行某个任务绝大多数时候不会产生任何副作用。
二、Ansible部署 环境准备工作：
服务器类型系统和IP地址需要安装的组件Ansible管理服务器CentOS7.4(64 位) 192.168.80.10Ansible被管理客户端CentOS7.4(64 位) 192.168.80.20———被管理客户端CentOS7.4(64 位) 192.168.80.30——— 所有服务器关闭防火墙和SElinux
systemctl stop firewalld setenforce 0 ① 管理端安装 ansible 服务 cd /etc/yum." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/8a31b03a77eaca1b945ea222e6b1cae2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-06T01:43:56+08:00" />
<meta property="article:modified_time" content="2021-08-06T01:43:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">自动化运维管理工具 Ansible的详细解读</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/a1/72/mmOFitso_o.png" alt="在这里插入图片描述"></p> 
<p></p> 
<div class="toc"> 
 <h4>Ansible的详细解读</h4> 
 <ul><li><a href="#Ansible_3" rel="nofollow">一、Ansible介绍</a></li><li><ul><li><a href="#21_Ansible_6" rel="nofollow">2.1 Ansible能做什么？</a></li><li><a href="#22_Ansible_14" rel="nofollow">2.2 Ansible的特性和原理</a></li></ul> 
  </li><li><a href="#Ansible_27" rel="nofollow">二、Ansible部署</a></li><li><ul><li><a href="#__ansible__46" rel="nofollow">① 管理端安装 ansible 服务</a></li><li><a href="#__67" rel="nofollow">② 配置主机清单</a></li><li><a href="#__79" rel="nofollow">③ 配置密钥对验证</a></li><li><a href="#__93" rel="nofollow">④ 设置免密登录</a></li><li><a href="#__101" rel="nofollow">⑤ 查询被控制端的当前日期测试</a></li></ul> 
  </li><li><a href="#Ansible_112" rel="nofollow">三、Ansible命令模块</a></li><li><ul><li><a href="#31%09command_120" rel="nofollow">3.1 command模块</a></li><li><a href="#32_shell_144" rel="nofollow">3.2 shell模块</a></li><li><a href="#33%09cron_154" rel="nofollow">3.3 cron模块</a></li><li><a href="#34_user_174" rel="nofollow">3.4 user模块</a></li><li><a href="#35_group_199" rel="nofollow">3.5 group模块</a></li><li><a href="#36_copy_213" rel="nofollow">3.6 copy模块</a></li><li><a href="#37%09file_240" rel="nofollow">3.7 file模块</a></li><li><a href="#38_hostname__264" rel="nofollow">3.8 hostname 模块</a></li><li><a href="#39_ping__272" rel="nofollow">3.9 ping 模块</a></li><li><a href="#310%09yum__279" rel="nofollow">3.10 yum 模块</a></li><li><a href="#311%09servicesystemd__292" rel="nofollow">3.11 service/systemd 模块</a></li><li><a href="#312%09script%09_310" rel="nofollow">3.12 script 模块</a></li><li><a href="#313_setup__326" rel="nofollow">3.13 setup 模块</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="Ansible_3"></a>一、Ansible介绍</h2> 
<p><font color="white">____</font>Ansible是一个基于<font size="3" color="red"> Python开发 </font>的配置管理和应用部署工具，现在也在<font size="3" color="red">自动化管理</font>领域大放异彩。它融合了众多老牌运维工具的优点，Pubbet和Saltstack能实现的功能，Ansible基本上都可以实现。</p> 
<h3><a id="21_Ansible_6"></a>2.1 Ansible能做什么？</h3> 
<p><img src="https://images2.imgbox.com/bf/30/UHRBJOlK_o.png" alt="在这里插入图片描述"></p> 
<p><font color="white">____</font>Ansible能<mark>批量配置、部署、管理上千台主机</mark>。比如以前需要切换到每个主机上执行的一或多个操作，使用Ansible只需在固定的一台Ansible控制节点上去完成所有主机的操作。</p> 
<p><font color="white">____</font>Ansible是<font size="3" color="red"> 基于模块工作 </font>的，它只是提供了一种运行框架，它本身没有完成任务的能力，真正执行操作的是<font size="3" color="red">Ansible的模块 </font>，比如copy模块用于拷贝文件到远程主机上，service模块用于管理服务的<font size="3" color="red">启动、停止、重启等。</font></p> 
<h3><a id="22_Ansible_14"></a>2.2 Ansible的特性和原理</h3> 
<p><font color="white">____</font>Ansible其中一个比较鲜明的特性是<font size="3" color="red">Agentless </font>，即无Agent的存在，它就像普通命令一样，并非C/S软件，也只需在某个作为控制节点的主机上安装一次Ansible即可， 通常它<font size="3" color="red">基于ssh连接 </font>来控制远程主机，<font size="3" color="red">远程主机上不需要安装Ansible</font>或其它额外的服务。</p> 
<p><font color="white">____</font>使用者在使用时，在服务器终端输入命令或者playbooks，会<font size="3" color="orange">通过预定好的规则将playbook拆解为play，再组织成ansible可以识别的任务调用模块和插件，根据主机清单通过SSH将临时文件发给远程的客户端执行并返回结果，执行结束后自动删除。</font></p> 
<p><font color="white">____</font>Ansible的另一个比较鲜明的特性是它的绝大多数模块都具备<font size="3" color="oran">幂等性(idempotence)。</font>所谓幂等性，指的是<font size="3" color="oran">多次操作或多次执行对系统资源的影响是一致的。 </font>比如执行systemctl stop xxx 命令来停止服务，当发现要停止的目标服务已经处于停止状态,它什么也不会做，所以多次停止的结果仍然是停止，不会改变结果，它是幂等的，而systemctl restart xxx是非幂等的。</p> 
<p><font color="white">____</font>Ansible的很多模块在执行时都会先判断目标节点是否要执行任务，所以，可以放心大胆地让Ansible去执行任务，重复执行某个任务绝大多数时候不会产生任何副作用。</p> 
<hr> 
<h2><a id="Ansible_27"></a>二、Ansible部署</h2> 
<p><mark>环境准备工作：</mark></p> 
<table><thead><tr><th>服务器类型</th><th>系统和IP地址</th><th>需要安装的组件</th></tr></thead><tbody><tr><td>Ansible管理服务器</td><td>CentOS7.4(64 位) 192.168.80.10</td><td>Ansible</td></tr><tr><td>被管理客户端</td><td>CentOS7.4(64 位) 192.168.80.20</td><td>———</td></tr><tr><td>被管理客户端</td><td>CentOS7.4(64 位) 192.168.80.30</td><td>———</td></tr></tbody></table> 
<p><mark>所有服务器关闭防火墙和SElinux</mark></p> 
<pre><code class="prism language-handlebars"><span class="token variable">systemctl</span> <span class="token variable">stop</span> <span class="token variable">firewalld</span>
<span class="token variable">setenforce</span> <span class="token number">0</span>
</code></pre> 
<hr> 
<h3><a id="__ansible__46"></a>① 管理端安装 ansible 服务</h3> 
<pre><code class="prism language-handlebars"><span class="token variable">cd</span> <span class="token punctuation">/</span><span class="token variable">etc</span><span class="token punctuation">/</span><span class="token variable">yum</span><span class="token punctuation">.</span><span class="token variable">repos</span><span class="token punctuation">.</span><span class="token variable">d</span><span class="token punctuation">/</span>
<span class="token variable">mv</span> <span class="token variable">repo</span><span class="token punctuation">.</span><span class="token variable">bak</span><span class="token punctuation">/</span><span class="token punctuation">*</span> <span class="token punctuation">.</span><span class="token punctuation">/</span>
<span class="token variable">yum</span> <span class="token variable">install</span> <span class="token variable">-y</span> <span class="token variable">epel-release</span>
<span class="token variable">yum</span> <span class="token variable">install</span> <span class="token variable">-y</span> <span class="token variable">ansible</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/6b/67/LzSSABjt_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/fb/2d/vbwK2LOH_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-xml">yum install tree -y					#安装tree命令
tree /etc/ansible/					#树形结构展示ansible目录
/etc/ansible/
├── ansible.cfg						# ansible的配置文件，一般 无需修改
├── hosts							# ansible的主机清单，用于存储需要管理的远程主机的相关信息
└── roles							# 公共角色目录
</code></pre> 
<h3><a id="__67"></a>② 配置主机清单</h3> 
<pre><code class="prism language-handlebars"><span class="token variable">vim</span> <span class="token punctuation">/</span><span class="token variable">etc</span><span class="token punctuation">/</span><span class="token variable">ansible</span><span class="token punctuation">/</span><span class="token variable">hosts</span>				
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">webservers</span><span class="token punctuation">]</span></span>						<span class="token punctuation">#</span><span class="token variable">配置组名</span>
<span class="token number">192.168</span><span class="token number">.80</span><span class="token number">.50</span>						<span class="token block keyword">#组里包含的被管理主机IP地址或主机名（主机名需要先修改/etc/hosts文件）</span>

<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">dbservers</span><span class="token punctuation">]</span></span>
<span class="token number">192.168</span><span class="token number">.80</span><span class="token number">.60</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/64/55/PYd74Le9_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="__79"></a>③ 配置密钥对验证</h3> 
<pre><code class="prism language-handlebars"><span class="token variable">ssh-keygen</span> <span class="token variable">-t</span> <span class="token variable">rsa</span>		<span class="token punctuation">#</span><span class="token variable">生成密钥对</span>
<span class="token variable">abc123</span>					<span class="token punctuation">#</span><span class="token variable">设置密码</span>

<span class="token variable">ssh-copy-id</span> <span class="token variable">root</span><span class="token punctuation">@</span><span class="token number">192.168</span><span class="token number">.80</span><span class="token number">.50</span>
<span class="token variable">ssh-copy-id</span> <span class="token variable">root</span><span class="token punctuation">@</span><span class="token number">192.168</span><span class="token number">.80</span><span class="token number">.60</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/9f/56/rc5E1CJd_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/9a/ec/vpOqJHSF_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/93/8a/snzfcf4J_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="__93"></a>④ 设置免密登录</h3> 
<pre><code class="prism language-handlebars"><span class="token variable">ssh-agent</span> <span class="token variable">bash</span>
<span class="token variable">ssh-add</span>
<span class="token variable">abc123</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/40/24/zqTaKwWy_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="__101"></a>⑤ 查询被控制端的当前日期测试</h3> 
<pre><code class="prism language-handlebars"><span class="token variable">ansible</span> <span class="token variable">webservers</span> <span class="token variable">-m</span> <span class="token variable">command</span> <span class="token variable">-a</span> <span class="token string">'date'</span>
<span class="token variable">ansible</span> <span class="token variable">dbservers</span> <span class="token variable">-m</span> <span class="token variable">command</span> <span class="token variable">-a</span> <span class="token string">'date'</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/24/13/8LdU78pK_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h2><a id="Ansible_112"></a>三、Ansible命令模块</h2> 
<pre><code class="prism language-handlebars"><span class="token variable">ansible-doc</span> <span class="token variable">-l</span>			<span class="token punctuation">#</span><span class="token variable">查询所有已安装的模块，按q退出</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/78/ef/tJ7oazbS_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="31%09command_120"></a>3.1 command模块</h3> 
<p><mark>在远程主机执行命令，不支持管道，重定向等shell的特性。</mark></p> 
<pre><code class="prism language-handlebars"><span class="token variable">ansible-doc</span> <span class="token variable">-s</span> <span class="token variable">command</span>					<span class="token punctuation">#</span><span class="token variable">-s</span> <span class="token variable">列出指定模块的描述信息和操作动作</span>

<span class="token variable">ansible</span> <span class="token number">192.168</span><span class="token number">.80</span><span class="token number">.60</span> <span class="token variable">-m</span> <span class="token variable">command</span> <span class="token variable">-a</span> <span class="token string">'date'</span>			<span class="token block keyword">#指定ip执行</span> <span class="token variable">date</span> <span class="token variable">命令</span>
<span class="token variable">ansible</span> <span class="token variable">webservers</span> <span class="token variable">-m</span> <span class="token variable">command</span> <span class="token variable">-a</span> <span class="token string">'free'</span>				<span class="token block keyword">#指定组执行</span> <span class="token variable">date</span> <span class="token variable">命令</span>
<span class="token variable">ansible</span> <span class="token variable">dbservers</span> <span class="token variable">-m</span> <span class="token variable">command</span> <span class="token variable">-a</span> <span class="token string">'free'</span>
<span class="token variable">ansible</span> <span class="token variable">all</span> <span class="token variable">-m</span> <span class="token variable">command</span> <span class="token variable">-a</span> <span class="token string">'date'</span>					<span class="token block keyword">#all代表所有</span> <span class="token variable">hosts</span> <span class="token variable">主机</span>
<span class="token variable">ansible</span> <span class="token variable">all</span> <span class="token variable">-a</span> <span class="token string">'date'</span>								<span class="token block keyword">#如省略</span> <span class="token variable">-m</span> <span class="token variable">模块，则代表为默认的</span> <span class="token variable">command</span> <span class="token variable">模块</span>

<span class="token punctuation">#</span><span class="token punctuation">#</span><span class="token punctuation">#</span><span class="token variable">常用用参数</span>
<span class="token variable">chdir</span><span class="token punctuation">:</span><span class="token variable">在远程主机上运行命令前提前进入目录</span>
<span class="token variable">creates</span><span class="token punctuation">:</span><span class="token variable">判断指定文件是否存在，如果存在，不执行后面的操作</span>
<span class="token variable">removes</span><span class="token punctuation">:</span><span class="token variable">判断指定文件是否存在，如果存在，执行后而的操作</span><span class="token punctuation">.</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/1a/93/3OXVGiHQ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/aa/17/T2jKYvKd_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/70/81/1BcyVZaR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="32_shell_144"></a>3.2 shell模块</h3> 
<p><mark>在远程主机执行命令，相当于调用远程主机的shell进程，然后在该shell 下打开-一个子shel1运行命令(支持管道符号等功能)</mark></p> 
<pre><code class="prism language-handlebars"><span class="token variable">ansible-doc</span> <span class="token variable">-s</span> <span class="token variable">shell</span>
<span class="token variable">ansible</span> <span class="token variable">webservers</span> <span class="token variable">-m</span> <span class="token variable">shell</span> <span class="token variable">-a</span> <span class="token string">'cat /etc/passwd | wc -l'</span>			<span class="token block keyword">##查看passwd文档有多少行</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3c/8c/2t0dmnIk_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="33%09cron_154"></a>3.3 cron模块</h3> 
<p><mark>在远程主机定义任务计划，其中有两种状态（state）：present表示添加（可以省略），absent表示移除。</mark></p> 
<pre><code class="prism language-handlebars"><span class="token variable">ansible-doc</span> <span class="token variable">-s</span> <span class="token variable">cron</span>					<span class="token punctuation">#</span><span class="token variable">查看相关说明，按q退出</span>

<span class="token variable">常用参数：</span>
<span class="token variable">minute</span><span class="token punctuation">/</span><span class="token variable">hour</span><span class="token punctuation">/</span><span class="token variable">day</span><span class="token punctuation">/</span><span class="token variable">month</span><span class="token punctuation">/</span><span class="token variable">weekday</span><span class="token punctuation">:</span><span class="token variable">分</span><span class="token punctuation">/</span><span class="token variable">时</span><span class="token punctuation">/</span><span class="token variable">日</span><span class="token punctuation">/</span><span class="token variable">月</span> <span class="token punctuation">/</span><span class="token variable">周</span>
<span class="token variable">job</span><span class="token punctuation">:</span><span class="token variable">任务计划要执行的命令</span>
<span class="token variable">name</span> <span class="token punctuation">:</span><span class="token variable">任务计划的名称</span>

<span class="token variable">ansible</span> <span class="token variable">webservers</span> <span class="token variable">-m</span> <span class="token variable">cron</span> <span class="token variable">-a</span> <span class="token string">'minute="*/1" job="/bin/echo helloworld" name="test crontab"'</span>
<span class="token variable">ansible</span> <span class="token variable">webservers</span> <span class="token variable">-m</span> <span class="token variable">command</span> <span class="token variable">-a</span> <span class="token string">'crontab -l'</span>

<span class="token block keyword">##移除计划性任务，加入该计划没有名字，name=None即可</span>
<span class="token variable">ansible</span> <span class="token variable">webservers</span> <span class="token variable">-m</span> <span class="token variable">cron</span> <span class="token variable">-a</span> <span class="token string">'name="test crontab" state=absent'</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/04/e3/wTotb1Iq_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/08/68/JqHPTbvg_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="34_user_174"></a>3.4 user模块</h3> 
<p><mark>用户管理模块</mark></p> 
<pre><code class="prism language-handlebars"><span class="token variable">ansible-doc</span> <span class="token variable">-s</span> <span class="token variable">user</span>

<span class="token variable">常用的参数：</span>
<span class="token variable">name</span> <span class="token punctuation">:</span><span class="token variable">用户名，必选参数</span>
<span class="token variable">state</span><span class="token punctuation">=</span><span class="token variable">present</span> <span class="token punctuation">|</span> <span class="token variable">absent</span><span class="token punctuation">:</span><span class="token variable">创建账号或者删除账号，present表示创建，absent</span> <span class="token variable">表示删除</span>
<span class="token variable">system</span><span class="token punctuation">=</span><span class="token variable">yes</span> <span class="token punctuation">|</span> <span class="token variable">no</span><span class="token punctuation">:</span><span class="token variable">是否为系统账号</span>
<span class="token variable">uid</span><span class="token punctuation">:</span> <span class="token variable">用户uid</span>
<span class="token variable">group</span><span class="token punctuation">:</span><span class="token variable">用户基本组</span>
<span class="token variable">shell</span><span class="token punctuation">:</span><span class="token variable">默认使用的shell</span>
<span class="token variable">move_home</span><span class="token punctuation">=</span><span class="token variable">yse</span> <span class="token punctuation">|</span> <span class="token variable">no</span><span class="token punctuation">:</span><span class="token variable">如果设置的家日录已经存在，是否将已经存在的家日录进行移动</span>
<span class="token variable">password</span><span class="token punctuation">:</span><span class="token variable">用户的密码，建议使用加密后的字符串</span>
<span class="token variable">comment</span><span class="token punctuation">:</span><span class="token variable">用户的注释信息</span>
<span class="token variable">remove</span><span class="token punctuation">=</span><span class="token variable">yes</span> <span class="token punctuation">|</span> <span class="token variable">no</span><span class="token punctuation">:</span><span class="token variable">当state</span><span class="token punctuation">=</span><span class="token variable">absent时，</span> <span class="token variable">是否删除用户的家目录</span>

<span class="token variable">ansible</span> <span class="token variable">webservers</span> <span class="token variable">-m</span> <span class="token variable">user</span> <span class="token variable">-a</span> <span class="token string">'name="test001"'</span>						<span class="token block keyword">#创建</span>
<span class="token variable">ansible</span> <span class="token variable">webservers</span> <span class="token variable">-m</span> <span class="token variable">command</span> <span class="token variable">-a</span> <span class="token string">'tail -1 /etc/passwd'</span>				<span class="token block keyword">#查看确认</span>
<span class="token variable">ansible</span> <span class="token variable">webservers</span> <span class="token variable">-m</span> <span class="token variable">user</span> <span class="token variable">-a</span> <span class="token string">'name="test001" state=absent'</span>			<span class="token block keyword">#删除</span>
<span class="token variable">ansible</span> <span class="token variable">webservers</span> <span class="token variable">-m</span> <span class="token variable">command</span> <span class="token variable">-a</span> <span class="token string">'tail -1 /etc/passwd'</span>				<span class="token block keyword">#查看确认</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/67/89/JKgl1xeT_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="35_group_199"></a>3.5 group模块</h3> 
<p><mark>用户组管理的模块</mark></p> 
<pre><code class="prism language-handlebars"><span class="token variable">ansible-doc</span> <span class="token variable">-s</span> <span class="token variable">group</span>			<span class="token punctuation">#</span><span class="token variable">查看相关文档</span>

<span class="token variable">ansible</span> <span class="token variable">dbservers</span> <span class="token variable">-m</span> <span class="token variable">group</span> <span class="token variable">-a</span> <span class="token string">'name=mysql gid=300 system=yes'</span>
<span class="token variable">ansible</span> <span class="token variable">dbservers</span> <span class="token variable">-m</span> <span class="token variable">command</span> <span class="token variable">-a</span> <span class="token string">'tail -1 /etc/group'</span>
<span class="token variable">ansible</span> <span class="token variable">dbservers</span> <span class="token variable">-m</span> <span class="token variable">user</span> <span class="token variable">-a</span> <span class="token string">'name="test002" uid=300 system=yes group=mysql'</span>
<span class="token variable">ansible</span> <span class="token variable">dbservers</span> <span class="token variable">-m</span> <span class="token variable">command</span> <span class="token variable">-a</span> <span class="token string">'tail -2 /etc/passwd'</span>
<span class="token variable">ansible</span> <span class="token variable">dbservers</span> <span class="token variable">-a</span> <span class="token string">'id test002'</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/73/38/o1LCk1CK_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="36_copy_213"></a>3.6 copy模块</h3> 
<p><mark>用于复制指定主机文件到远程主机上</mark></p> 
<pre><code class="prism language-handlebars"><span class="token variable">ansible-doc</span> <span class="token variable">-s</span> <span class="token variable">copy</span>				<span class="token punctuation">#</span><span class="token variable">查看相关文档</span>

<span class="token punctuation">#</span><span class="token punctuation">#</span><span class="token variable">常用参数</span>
<span class="token variable">dest</span><span class="token punctuation">:</span><span class="token variable">指出复制文件的日标及位置，使用绝对路径，如果是源目录，指目标也要是目录，如果目标文件已经存在会覆盖原有的内容</span>
<span class="token variable">src</span><span class="token punctuation">:</span><span class="token variable">指出源文件的路径，可以使用相对路径或绝对路径，支持直接指定目录，如果源是目录则目标也要是目录</span>
<span class="token variable">mode</span><span class="token punctuation">:</span><span class="token variable">指出复制时，目标文件的权限</span>
<span class="token variable">owner</span><span class="token punctuation">:</span><span class="token variable">指出复制时，日标文件的属主</span>
<span class="token variable">group</span><span class="token punctuation">:</span><span class="token variable">指出复制时，目标文件的属组</span>
<span class="token variable">content</span><span class="token punctuation">:</span><span class="token variable">指出复制到日标主机上的内容，不能与src一起使用</span>

<span class="token punctuation">#</span><span class="token punctuation">#</span><span class="token variable">测试创建文件并修改权限</span>
<span class="token variable">ansible</span> <span class="token variable">dbservers</span> <span class="token variable">-a</span> <span class="token string">'mkdir /test'</span>
<span class="token variable">ansible</span> <span class="token variable">dbservers</span> <span class="token variable">-m</span> <span class="token variable">copy</span> <span class="token variable">-a</span> <span class="token string">'src=/etc/passwd dest=/test/passwd.bak owner=root mode=640'</span>
<span class="token variable">ansible</span> <span class="token variable">dbservers</span> <span class="token variable">-a</span> <span class="token string">'ls -l /test'</span>

<span class="token block keyword">##测试创建文件并写入内容</span>
<span class="token variable">ansible</span> <span class="token variable">dbservers</span> <span class="token variable">-m</span> <span class="token variable">copy</span> <span class="token variable">-a</span> <span class="token string">'content="this is test txt" dest=/test/test.txt'</span>
<span class="token variable">ansible</span> <span class="token variable">dbservers</span> <span class="token variable">-a</span> <span class="token string">'ls -l /test'</span>
<span class="token variable">ansible</span> <span class="token variable">dbservers</span> <span class="token variable">-a</span> <span class="token string">'cat /test/test.txt'</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/70/8b/LIl0BhsW_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/2a/a4/HO63boWP_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="37%09file_240"></a>3.7 file模块</h3> 
<p><mark>设置文件属性</mark></p> 
<pre><code class="prism language-handlebars"><span class="token variable">ansible-doc</span> <span class="token variable">-s</span> <span class="token variable">file</span>

<span class="token punctuation">#</span><span class="token variable">修改文件的属主属组权限等</span>
<span class="token variable">ansible</span> <span class="token variable">dbservers</span> <span class="token variable">-m</span> <span class="token variable">file</span> <span class="token variable">-a</span> <span class="token string">'owner=zhangsan group=mysql mode=777 path=/opt/123.txt'</span>	
<span class="token variable">ansible</span> <span class="token variable">dbservers</span> <span class="token variable">-a</span> <span class="token string">'ls -l /opt'</span>

<span class="token block keyword">##设置/opt/</span><span class="token number">123.</span><span class="token variable">txt</span><span class="token punctuation">.</span><span class="token variable">bak</span> <span class="token variable">为</span> <span class="token punctuation">/</span><span class="token variable">opt</span><span class="token punctuation">/</span><span class="token number">123.</span><span class="token variable">txt</span> <span class="token variable">的链接文件</span>
<span class="token variable">ansible</span> <span class="token variable">dbservers</span> <span class="token variable">-m</span> <span class="token variable">file</span> <span class="token variable">-a</span> <span class="token string">'path=/opt/123.txt.link src=/opt/123.txt state=link'</span>

<span class="token variable">ansible</span> <span class="token variable">dbservers</span> <span class="token variable">-m</span> <span class="token variable">file</span> <span class="token variable">-a</span> <span class="token string">'path=/opt/abc.txt state=touch'</span>	<span class="token block keyword">#创建一个文件</span>
<span class="token variable">ansible</span> <span class="token variable">dbservers</span> <span class="token variable">-m</span> <span class="token variable">file</span> <span class="token variable">-a</span> <span class="token string">'path=/opt/abc.txt state=absent'</span>	<span class="token block keyword">#删除一个文件</span>
</code></pre> 
<p>① 修改属主和属组及权限<br> <img src="https://images2.imgbox.com/a0/55/uyIw6w7j_o.png" alt="在这里插入图片描述"><br> ② 创建软链接<br> <img src="https://images2.imgbox.com/3f/8a/ecYNd3WG_o.png" alt="在这里插入图片描述"><br> ③ 创建文件，并删除文件<br> <img src="https://images2.imgbox.com/93/85/AzDBj385_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="38_hostname__264"></a>3.8 hostname 模块</h3> 
<p><mark>用于管理远程主机上的主机名</mark></p> 
<pre><code class="prism language-handlebars"><span class="token variable">ansible</span> <span class="token variable">dbservers</span> <span class="token variable">-m</span> <span class="token variable">hostname</span> <span class="token variable">-a</span> <span class="token string">'name=testhost'</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/1b/82/Q3lGqhp5_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/32/e1/RJxR0eQr_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="39_ping__272"></a>3.9 ping 模块</h3> 
<p><mark>检测远程主机的连通性</mark></p> 
<pre><code class="prism language-handlebars"><span class="token variable">ansible</span> <span class="token variable">all</span> <span class="token variable">-m</span> <span class="token variable">ping</span> 
</code></pre> 
<p><img src="https://images2.imgbox.com/b7/83/Af39AatK_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="310%09yum__279"></a>3.10 yum 模块</h3> 
<p><mark>在远程主机上安装与卸载软件包</mark></p> 
<pre><code class="prism language-handlebars"><span class="token variable">ansible-doc</span> <span class="token variable">-s</span> <span class="token variable">yum</span>

<span class="token variable">ansible</span> <span class="token variable">webservers</span> <span class="token variable">-m</span> <span class="token variable">yum</span> <span class="token variable">-a</span> <span class="token string">'name=httpd'</span>						<span class="token block keyword">#安装服务</span>
<span class="token variable">ansible</span> <span class="token variable">webservers</span> <span class="token variable">-m</span> <span class="token variable">yum</span> <span class="token variable">-a</span> <span class="token string">'name=httpd state=absent'</span>			<span class="token block keyword">#卸载服务</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/4a/b1/9Vqrb6eu_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a4/a1/1WfrAZ6E_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="311%09servicesystemd__292"></a>3.11 service/systemd 模块</h3> 
<p><mark>用于在远程主机上管理服务的运行状态</mark></p> 
<pre><code class="prism language-handlebars"><span class="token variable">ansible-doc</span> <span class="token variable">-s</span> <span class="token variable">service</span>

<span class="token punctuation">#</span><span class="token punctuation">#</span><span class="token variable">常用的参数</span>
<span class="token variable">name</span><span class="token punctuation">:</span><span class="token variable">被管理的服务名称。</span>
<span class="token variable">state</span><span class="token punctuation">=</span><span class="token variable">started</span> <span class="token punctuation">|</span> <span class="token variable">stopped</span> <span class="token punctuation">|</span> <span class="token variable">restarted</span><span class="token punctuation">:</span><span class="token variable">动作包含启动关闭或者重启。</span>
<span class="token variable">enabled</span><span class="token punctuation">=</span><span class="token variable">yes</span> <span class="token punctuation">|</span> <span class="token variable">no</span><span class="token punctuation">:</span><span class="token variable">表示是否设置该服务开机自启。</span>
<span class="token variable">runlevel</span><span class="token punctuation">:</span><span class="token variable">如果设定了enabled开机自启去，则要定义在哪些运行目标下自启动。</span>

<span class="token variable">ansible</span> <span class="token variable">webservers</span> <span class="token variable">-m</span> <span class="token variable">service</span> <span class="token variable">-a</span> <span class="token string">'name=httpd enabled=true state=started'</span>		<span class="token block keyword">#安装服务并设为开机自启</span>
<span class="token variable">systemctl</span> <span class="token variable">is-enabled</span>  <span class="token variable">httpd</span><span class="token punctuation">.</span><span class="token variable">service</span>									<span class="token punctuation">#</span><span class="token variable">被控制端查看是否设为开机自启</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/59/86/u3lL5Di8_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/16/10/gGwjcqkE_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="312%09script%09_310"></a>3.12 script 模块</h3> 
<p><mark>实现远程批量运行本地 shell 脚本</mark></p> 
<pre><code class="prism language-handlebars"><span class="token variable">ansible-doc</span> <span class="token variable">-s</span> <span class="token variable">script</span>

<span class="token variable">vim</span> <span class="token variable">test</span><span class="token punctuation">.</span><span class="token variable">sh</span>						<span class="token punctuation">#</span><span class="token variable">编写一个脚本</span>
<span class="token punctuation">#</span><span class="token punctuation">!</span><span class="token punctuation">/</span><span class="token variable">bin</span><span class="token punctuation">/</span><span class="token variable">bash</span>
<span class="token variable">echo</span> <span class="token string">"hello ansible from script"</span> <span class="token punctuation">&gt;</span> <span class="token punctuation">/</span><span class="token variable">opt</span><span class="token punctuation">/</span><span class="token variable">script</span><span class="token punctuation">.</span><span class="token variable">txt</span>		<span class="token punctuation">#</span><span class="token variable">在script</span><span class="token punctuation">.</span><span class="token variable">txt中写入指定内容</span>

<span class="token variable">chmod</span> <span class="token punctuation">+</span><span class="token variable">x</span> <span class="token variable">test</span><span class="token punctuation">.</span><span class="token variable">sh</span> 										<span class="token punctuation">#</span><span class="token variable">赋予权限</span>
<span class="token variable">ansible</span> <span class="token variable">dbservers</span> <span class="token variable">-m</span> <span class="token variable">script</span> <span class="token variable">-a</span> <span class="token string">'test.sh'</span>				<span class="token block keyword">#实现远程运行本地的脚本</span>
<span class="token variable">ansible</span> <span class="token variable">dbservers</span> <span class="token variable">-a</span> <span class="token string">'cat /opt/script.txt'</span>				<span class="token block keyword">#查看生成的文档内容</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/cc/67/nbBilX1y_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="313_setup__326"></a>3.13 setup 模块</h3> 
<p><mark>facts组件是用来收集被管理节点信息的，使用 setup 模块可以获取这些信息</mark></p> 
<pre><code class="prism language-handlebars"><span class="token variable">ansible-doc</span> <span class="token variable">-s</span> <span class="token variable">setup</span>

<span class="token variable">ansible</span> <span class="token variable">webservers</span> <span class="token variable">-m</span> <span class="token variable">setup</span>							<span class="token punctuation">#</span><span class="token variable">获取mysql组主机的facts信息</span>
<span class="token variable">ansible</span> <span class="token variable">dbservers</span> <span class="token variable">-m</span> <span class="token variable">setup</span> <span class="token variable">-a</span> <span class="token variable">‘filter</span><span class="token punctuation">=</span><span class="token punctuation">*</span><span class="token variable">ipv4’</span>		<span class="token punctuation">#</span><span class="token variable">使用filter可以筛选指定的facts信息</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/21/36/VGUzKRJf_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b5/b7/841kVjdV_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/223fdcd2051e4fd03a2d88eb3fac2c7b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">不让ajax方法自动加载,jQuery EasyUI动态添加控件或者ajax加载页面后不能自动渲染问题的解决方法...</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/62c73456c745f69f8213a5521c5ca7b4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ajax中json方法吗,ajax中JSON.stringify()和JSON.parse()方法的使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>