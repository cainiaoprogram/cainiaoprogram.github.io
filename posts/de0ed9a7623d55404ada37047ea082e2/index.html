<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>hbase kerberos - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="hbase kerberos" />
<meta property="og:description" content="原文链接：HBase ThriftServer Kerberos认证 - 程序员大本营
1.前置 用户可以通过ThriftServer来访问HBase服务，它的特点如下：
ThriftServer代理用户访问HBase服务返回操作结果，用户客户端不需要直接跟HBase进行通信用户可以使用java/python/php/c&#43;&#43;等语言的Thrift客户端代码访问HBase服务(HBase本身客户端只支持java语言) 2. Kerberos下的ThriftServer使用 如果HBase集群开启了Kerberos认证(E-MapReduce可一键创建安全集群，非常方便)，那么用户怎么通过ThriftServer访问HBase服务呢？
2.1 ThriftServer配置Kerberos
ThriftServer其实是HBase服务的客户端，既然HBase开启了Kerberos认证，那么ThrifServer也必须配置Kerberos的信息才能正常访问HBase集群服务。
在ThriftServer的hbase-site.xml文件中添加新配置:
&lt;property&gt;
&lt;name&gt;hbase.security.authentication&lt;/name&gt;
&lt;value&gt;kerberos&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;hbase.thrift.kerberos.principal&lt;/name&gt;
&lt;value&gt;hbase/_HOST@EMR.123456.COM&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;hbase.thrift.keytab.file&lt;/name&gt;
&lt;value&gt;/etc/ecm/hbase-conf/hbase-thrift.keytab&lt;/value&gt;
&lt;/property&gt;
上述配置中实际值以用户为准(principle和keytab需对应)。
2.2 ThriftClient访问ThriftServer
用户使用python/java/php等Thrift客户端访问ThrifServer有两种方式：
2.2.1 ThriftServer不对Client进行身份认证
任何用户都可以通过ThriftServer访问HBase服务，而且都是以ThriftServer本身配置的hbase.thrift.kerberos.principal中的用户名去访问HBase服务，即对HBase服务来说只有一个固定的用户来访问。
如下图所示：
这种方式使得HBase集群的Kerberos认证无效，不适合使用开启了Kerberos的场景。
2.2.2 ThriftServer对Client进行身份认证
ThriftServer可以开启对Client进行身份认证，而且以实际的用户身份访问HBase服务。
需要做如下配置：
ThriftServer的hbase-site.xml中增加新的配置： &lt;property&gt;
&lt;name&gt;hbase.thrift.security.qop&lt;/name&gt;
&lt;value&gt;auth&lt;/value&gt;
&lt;/property&gt;
其中hbase.thrift.security.qop可以是auth/auth-init/auth-conf中的一个
HBase集群的所有节点core-site.xml中增加新的配置： &lt;property&gt;
&lt;name&gt;hadoop.proxyuser.$user.hosts&lt;/name&gt;
&lt;value&gt;*&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
&lt;name&gt;hadoop.proxyuser.$user.groups&lt;/name&gt;
&lt;value&gt;*&lt;/value&gt;
&lt;/property&gt;
备注:
a) $user为ThriftServer本身配置的hbase.thrift.kerberos.principal中的用户
b) 重启HBase集群(无需重启HDFS)
3. 代码示例 上述2.2.2节的场景代码
3.1 python
参考github上一个项目: GitHub - joshelser/hbase-thrift1-python-sasl: Python client code for Apache HBase 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/de0ed9a7623d55404ada37047ea082e2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-27T09:23:53+08:00" />
<meta property="article:modified_time" content="2021-10-27T09:23:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">hbase kerberos</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>原文链接：<a href="https://www.pianshen.com/article/2303409528/" rel="nofollow" title="HBase ThriftServer Kerberos认证 - 程序员大本营">HBase ThriftServer Kerberos认证 - 程序员大本营</a></p> 
<p></p> 
<h4>1.前置</h4> 
<p>用户可以通过ThriftServer来访问HBase服务，它的特点如下：</p> 
<ul><li>ThriftServer代理用户访问HBase服务返回操作结果，用户客户端不需要直接跟HBase进行通信</li><li>用户可以使用java/python/php/c++等语言的Thrift客户端代码访问HBase服务(HBase本身客户端只支持java语言)</li></ul> 
<h4>2. Kerberos下的ThriftServer使用</h4> 
<p>如果HBase集群开启了Kerberos认证(<code>E-MapReduce可一键创建安全集群，非常方便</code>)，那么用户怎么通过ThriftServer访问HBase服务呢？</p> 
<p>2.1 ThriftServer配置Kerberos</p> 
<p>ThriftServer其实是HBase服务的客户端，既然HBase开启了Kerberos认证，那么ThrifServer也必须配置Kerberos的信息才能正常访问HBase集群服务。</p> 
<p>在ThriftServer的hbase-site.xml文件中添加新配置:</p> 
<pre></pre> 
<ol><li> <p><code>&lt;property&gt;</code></p> </li><li> <p><code>&lt;name&gt;hbase.security.authentication&lt;/name&gt;</code></p> </li><li> <p><code>&lt;value&gt;kerberos&lt;/value&gt;</code></p> </li><li> <p><code>&lt;/property&gt;</code></p> </li><li> <p><code>&lt;property&gt;</code></p> </li><li> <p><code>&lt;name&gt;hbase.thrift.kerberos.principal&lt;/name&gt;</code></p> </li><li> <p><code>&lt;value&gt;hbase/_HOST@EMR.123456.COM&lt;/value&gt;</code></p> </li><li> <p><code>&lt;/property&gt;</code></p> </li><li> <p><code>&lt;property&gt;</code></p> </li><li> <p><code>&lt;name&gt;hbase.thrift.keytab.file&lt;/name&gt;</code></p> </li><li> <p><code>&lt;value&gt;/etc/ecm/hbase-conf/hbase-thrift.keytab&lt;/value&gt;</code></p> </li><li> <p><code>&lt;/property&gt;</code></p> </li></ol> 
<p>上述配置中实际值以用户为准(principle和keytab需对应)。</p> 
<p>2.2 ThriftClient访问ThriftServer</p> 
<p>用户使用python/java/php等Thrift客户端访问ThrifServer有两种方式：</p> 
<p>2.2.1 ThriftServer不对Client进行身份认证</p> 
<p>任何用户都可以通过ThriftServer访问HBase服务，而且都是以ThriftServer本身配置的<code>hbase.thrift.kerberos.principal</code>中的用户名去访问HBase服务，即对HBase服务来说只有一个固定的用户来访问。</p> 
<p>如下图所示：</p> 
<p><code>这种方式使得HBase集群的Kerberos认证无效，不适合使用开启了Kerberos的场景。</code></p> 
<p>2.2.2 ThriftServer对Client进行身份认证</p> 
<p>ThriftServer可以开启对Client进行身份认证，而且以实际的用户身份访问HBase服务。</p> 
<p></p> 
<p>需要做如下配置：</p> 
<ul><li>ThriftServer的hbase-site.xml中增加新的配置：</li></ul> 
<pre></pre> 
<ol><li> <p><code>&lt;property&gt;</code></p> </li><li> <p><code>&lt;name&gt;hbase.thrift.security.qop&lt;/name&gt;</code></p> </li><li> <p><code>&lt;value&gt;auth&lt;/value&gt;</code></p> </li><li> <p><code>&lt;/property&gt;</code></p> </li></ol> 
<p>其中<code>hbase.thrift.security.qop</code>可以是auth/auth-init/auth-conf中的一个</p> 
<ul><li>HBase集群的所有节点core-site.xml中增加新的配置：</li></ul> 
<pre></pre> 
<ol><li> <p><code>&lt;property&gt;</code></p> </li><li> <p><code>&lt;name&gt;hadoop.proxyuser.$user.hosts&lt;/name&gt;</code></p> </li><li> <p><code>&lt;value&gt;*&lt;/value&gt;</code></p> </li><li> <p><code>&lt;/property&gt;</code></p> </li><li> <p><code>&lt;property&gt;</code></p> </li><li> <p><code>&lt;name&gt;hadoop.proxyuser.$user.groups&lt;/name&gt;</code></p> </li><li> <p><code>&lt;value&gt;*&lt;/value&gt;</code></p> </li><li> <p><code>&lt;/property&gt;</code></p> </li></ol> 
<p><strong>备注:</strong><br> a) $user为ThriftServer本身配置的hbase.thrift.kerberos.principal中的用户<br> b) 重启HBase集群(无需重启HDFS)</p> 
<h4>3. 代码示例</h4> 
<p>上述<code>2.2.2节</code>的场景代码</p> 
<p>3.1 python</p> 
<p>参考github上一个项目: <br><a href="https://github.com/joshelser/hbase-thrift1-python-sasl" title="GitHub - joshelser/hbase-thrift1-python-sasl: Python client code for Apache HBase 1.x using Kerberos authentication over SASL">GitHub - joshelser/hbase-thrift1-python-sasl: Python client code for Apache HBase 1.x using Kerberos authentication over SASL</a></p> 
<p>使用方式在<code>README.md</code>中:</p> 
<pre></pre> 
<ol><li> <p><code>-&gt; 在客户端运行的账号下kinit初始化好Kerberos的TGT</code></p> </li><li> <p><code>-&gt; ./setup.sh</code></p> </li><li> <p><code>-&gt; python get_row.py</code></p> </li></ol> 
<p>备注: <code>get_row.py</code>需要根据实际集群的配置修改相关参数</p> 
<p>3.2 java</p> 
<p>HBase官方的example jar有示例代码:<br><a href="https://github.com/apache/hbase/tree/master/hbase-examples" title="hbase/hbase-examples at master · apache/hbase · GitHub">hbase/hbase-examples at master · apache/hbase · GitHub</a></p> 
<p><a href="https://github.com/apache/hbase/blob/master/hbase-examples/src/main/java/org/apache/hadoop/hbase/thrift/DemoClient.java" title="hbase/DemoClient.java at master · apache/hbase · GitHub">hbase/DemoClient.java at master · apache/hbase · GitHub</a></p> 
<pre></pre> 
<ol><li> <p><code>-&gt; 在客户端运行的账号下kinit初始化好Kerberos的TGT</code></p> </li><li> <p><code>-&gt;</code></p> </li><li> <p><code>export HBASE_EXAMPLE_CLASSPATH=`hbase classpath`;</code></p> </li><li><li> <p><code>java -cp /usr/lib/hbase-current/lib/hbase-examples-1.1.1.jar:$HBASE_EXAMPLE_CLASSPATH org.apache.hadoop.hbase.thrift.DemoClient $thrift_server_host $thrift_serve_port true</code></p> </li></ol> 
<p><code>有兴趣或者有需求的用户可以关注一下E-MapReduce的安全相关的功能，有问题及时联系和反馈。</code></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4bd6a6de9a73d5abb6ff6e54a17668d7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【meshlab使用指南】01、删除点云</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ce68c2fe5b2dae4a3c0a42a4c648b74f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">保姆式教程教你如何一步步在window10系统下安装mindspore框架&#43;pycharm导入python遇到的问题解决</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>