<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>用 JavaScript 实现手势库 — 封装手势库【前端组件化】 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="用 JavaScript 实现手势库 — 封装手势库【前端组件化】" />
<meta property="og:description" content="前端《组件化系列》目录 「一」用 JSX 建立组件 Parser（解析器）「二」使用 JSX 建立 Markup 组件风格「三」用 JSX 实现 Carousel 轮播组件「四」用 JavaScript 实现时间轴与动画「五」用 JavaScript 实现三次贝塞尔动画库 - 前端组件化「六」用 JavaScript 实现手势库 - 实现监听逻辑「七」用 JavaScript 实现手势库 — 手势逻辑「八」用 JavaScript 实现手势库 — 支持多键触发「九」用 JavaScript 实现手势库 — 事件派发与 Flick 事件「十」用 JavaScript 实现手势库 — 封装手势库 《 本期 》… 待续 … 经历了多次的迭代，我们的手势库功能都已经实现了。但是到了这里我们的代码确实需要重新整理和封装了。如果同学们还记得的，我们之间一开始获取的元素 element 是写死的。但是作为一个手势库，我们绑定的元素必然是由这个库的使用者而决定的。
有一些同学可能就会问：“为什么不一开始就想好怎么写，一开始就封装好呢？现在实现了所有功能，再回头去封装，不是重复工作，浪费了时间了吗？”
其实如果我们一开始我们就想怎么封装，应该怎么设计这个库。因为设计需要考虑的因素很多，而且要实现的功能还没有落实。其实往往这个时候设计出来的方案或者架构到了后面都会被修改 N 次的。那么最后我们花在设计的时间就会比我们花在实现这些功能上要多得多。但是如果我们是先实现了功能，然后再去封装，就变得简单的多。
所以接下来我们就开始封装这个手势库吧！
要封装这个手势库，第一件事就是列出现有的函数，并且给他们归类。那么我们的这个手势库的其实就 3 个部分：
Listener 监听器 mouse 事件 mousedownmouseupmousemove touch 事件 touchstarttouchmovetouchendcancel recognizer 识别器 start()move()end() dispatcher 分发器 dispatch() 如果我们想把这个库做成一个 API 的话，我们就可以用上面提到的三个部分来解耦。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0360e5b2a888212f3de62021da4d8757/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-21T12:15:00+08:00" />
<meta property="article:modified_time" content="2021-06-21T12:15:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">用 JavaScript 实现手势库 — 封装手势库【前端组件化】</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/a7/1a/bhr11lHg_o.jpg" alt=""></p> 
<h3><a id="_1"></a>前端《组件化系列》目录</h3> 
<ul><li>「一」<a href="https://tridiamond.blog.csdn.net/article/details/112352745" rel="nofollow">用 JSX 建立组件 Parser（解析器）</a></li><li>「二」<a href="https://tridiamond.blog.csdn.net/article/details/112655866" rel="nofollow">使用 JSX 建立 Markup 组件风格</a></li><li>「三」<a href="https://tridiamond.blog.csdn.net/article/details/112656150" rel="nofollow">用 JSX 实现 Carousel 轮播组件</a></li><li>「四」<a href="https://tridiamond.blog.csdn.net/article/details/115437875" rel="nofollow">用 JavaScript 实现时间轴与动画</a></li><li>「五」<a href="https://tridiamond.blog.csdn.net/article/details/115438950" rel="nofollow">用 JavaScript 实现三次贝塞尔动画库 - 前端组件化</a></li><li>「六」<a href="https://tridiamond.blog.csdn.net/article/details/116136518" rel="nofollow">用 JavaScript 实现手势库 - 实现监听逻辑</a></li><li>「七」<a href="https://tridiamond.blog.csdn.net/article/details/116399017" rel="nofollow">用 JavaScript 实现手势库 — 手势逻辑</a></li><li>「八」<a href="https://tridiamond.blog.csdn.net/article/details/116633780" rel="nofollow">用 JavaScript 实现手势库 — 支持多键触发</a></li><li>「九」<a href="https://tridiamond.blog.csdn.net/article/details/117129384" rel="nofollow">用 JavaScript 实现手势库 — 事件派发与 Flick 事件</a></li><li>「十」<a href="https://tridiamond.blog.csdn.net/article/details/118083272" rel="nofollow">用 JavaScript 实现手势库 — 封装手势库</a> 《 本期 》</li><li>… 待续 …</li></ul> 
<p>经历了多次的迭代，我们的手势库功能都已经实现了。但是到了这里我们的代码确实需要重新整理和封装了。如果同学们还记得的，我们之间一开始获取的元素 <code>element</code> 是写死的。但是作为一个手势库，我们绑定的元素必然是由这个库的使用者而决定的。</p> 
<blockquote> 
 <p>有一些同学可能就会问：“为什么不一开始就想好怎么写，一开始就封装好呢？现在实现了所有功能，再回头去封装，不是重复工作，浪费了时间了吗？”</p> 
</blockquote> 
<blockquote> 
 <p>其实如果我们一开始我们就想怎么封装，应该怎么设计这个库。因为设计需要考虑的因素很多，而且要实现的功能还没有落实。其实往往这个时候设计出来的方案或者架构到了后面都会被修改 N 次的。那么最后我们花在设计的时间就会比我们花在实现这些功能上要多得多。但是如果我们是先实现了功能，然后再去封装，就变得简单的多。</p> 
</blockquote> 
<p>所以接下来我们就开始封装这个手势库吧！</p> 
<p>要封装这个手势库，第一件事就是列出现有的函数，并且给他们归类。那么我们的这个手势库的其实就 <strong>3 个部分</strong>：</p> 
<ul><li><strong>Listener 监听器</strong> 
  <ul><li>mouse 事件 
    <ul><li>mousedown</li><li>mouseup</li><li>mousemove</li></ul> </li><li>touch 事件 
    <ul><li>touchstart</li><li>touchmove</li><li>touchend</li><li>cancel</li></ul> </li></ul> </li><li><strong>recognizer 识别器</strong> 
  <ul><li>start()</li><li>move()</li><li>end()</li></ul> </li><li><strong>dispatcher 分发器</strong> 
  <ul><li>dispatch()</li></ul> </li></ul> 
<p>如果我们想把这个库做成一个 API 的话，我们就可以用上面提到的三个部分来解耦。</p> 
<p>按照我们上面写的 3 个部分来看，其实他们是有串联关系，甚至是嵌套关系的。首先我们需要实例一个 <code>Listener</code> 监听器。然后这个 <code>Listener</code> 需要有一个 <code>Recognizer</code> 识别器，用来识别监听到的事件。最后我们的识别器需要有一个 <code>Dispatcher</code> 派发器，被识别的事件会通过派发器分发出去。</p> 
<p>所以最后我们调用这个手势 API 的方式应该是这样的：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">new</span> <span class="token class-name">Listener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Recognizer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Dispatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="Listener__49"></a>Listener 监听器</h3> 
<p>那么我们来看看怎么实现 <code>Listener</code>。</p> 
<p>因为一个 Listener 实例会默认传入一个 Recognizer，所以我们先建立一个 contructor 构造函数，让它接收传入的 <code>Recognizer</code>。Listener 也需要知道它监听的元素，所以我们 constructor 里面也需要接收一个 element 元素。</p> 
<pre><code class="prism language-javascript"><span class="token comment">/**
 * 监听器
 */</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Listener</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> recognizer<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>然后我们就可以把我们之前写的所有监听的函数都复制到 Listener 类里面。我们之前是直接调用 <code>start</code>、<code>move</code> 和 <code>end</code> 事件处理函数的，而这里都换成使用 Recognizer 调用。</p> 
<p>都改完之后，我们的 Listener 类应该是这样的。</p> 
<pre><code class="prism language-javascript"><span class="token comment">/**
 * 监听器
 */</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Listener</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> recognizer<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> contexts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Map</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> isListeningMouse <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousedown'</span><span class="token punctuation">,</span> event <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">let</span> context <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      contexts<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`mouse</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> event<span class="token punctuation">.</span>button<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>

      recognizer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">let</span> <span class="token function-variable function">mousemove</span> <span class="token operator">=</span> event <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> button <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span>button <span class="token operator">&lt;=</span> event<span class="token punctuation">.</span>buttons<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>button <span class="token operator">&amp;</span> event<span class="token punctuation">.</span>buttons<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">let</span> key<span class="token punctuation">;</span>
            <span class="token comment">// Order of buttons &amp; button is not the same</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>button <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
              key <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>button <span class="token operator">===</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
              key <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
              key <span class="token operator">=</span> button<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">let</span> context <span class="token operator">=</span> contexts<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">'mouse'</span> <span class="token operator">+</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            recognizer<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          button <span class="token operator">=</span> button <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token keyword">let</span> <span class="token function-variable function">mouseup</span> <span class="token operator">=</span> event <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> context <span class="token operator">=</span> contexts<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`mouse</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> event<span class="token punctuation">.</span>button<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        recognizer<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        contexts<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`mouse</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token number">1</span> <span class="token operator">&lt;&lt;</span> event<span class="token punctuation">.</span>button<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>buttons <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> mousemove<span class="token punctuation">)</span><span class="token punctuation">;</span>
          document<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseup'</span><span class="token punctuation">,</span> mouseup<span class="token punctuation">)</span><span class="token punctuation">;</span>
          isListeningMouse <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isListeningMouse<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> mousemove<span class="token punctuation">)</span><span class="token punctuation">;</span>
        document<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mouseup'</span><span class="token punctuation">,</span> mouseup<span class="token punctuation">)</span><span class="token punctuation">;</span>
        isListeningMouse <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchstart'</span><span class="token punctuation">,</span> event <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> touch <span class="token keyword">of</span> event<span class="token punctuation">.</span>changedTouches<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> context <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        contexts<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>touch<span class="token punctuation">.</span>identifier<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        recognizer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span>touch<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchmove'</span><span class="token punctuation">,</span> event <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> touch <span class="token keyword">of</span> event<span class="token punctuation">.</span>changedTouches<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> context <span class="token operator">=</span> contexts<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>touch<span class="token punctuation">.</span>identifier<span class="token punctuation">)</span><span class="token punctuation">;</span>
        recognizer<span class="token punctuation">.</span><span class="token function">move</span><span class="token punctuation">(</span>touch<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'touchend'</span><span class="token punctuation">,</span> event <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> touch <span class="token keyword">of</span> event<span class="token punctuation">.</span>changedTouches<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> context <span class="token operator">=</span> contexts<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>touch<span class="token punctuation">.</span>identifier<span class="token punctuation">)</span><span class="token punctuation">;</span>
        recognizer<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>touch<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        contexts<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span>touch<span class="token punctuation">.</span>identifier<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    element<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'cancel'</span><span class="token punctuation">,</span> event <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> touch <span class="token keyword">of</span> event<span class="token punctuation">.</span>changedTouches<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> context <span class="token operator">=</span> contexts<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>touch<span class="token punctuation">.</span>identifier<span class="token punctuation">)</span><span class="token punctuation">;</span>
        recognizer<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span>touch<span class="token punctuation">,</span> context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        contexts<span class="token punctuation">.</span><span class="token keyword">delete</span><span class="token punctuation">(</span>touch<span class="token punctuation">.</span>identifier<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这样我们就封装好我们的 Listener 监听器了。接下来我们就可以开始封装我们的 Recognizer 识别器。</p> 
<h3><a id="Recognizer__160"></a>Recognizer 识别器</h3> 
<p>Recognizer 是用来封装我们的 <code>start</code>, <code>move</code>、<code>end</code> 和 <code>cancel</code> 四个函数的。这四个函数的作用无非就是<strong>识别这些鼠标事件是属于那种类型的，然后把对应的手势类型分发出去。</strong></p> 
<p>首先我们的 Recognizer 实例的时候是需要接收一个 Dispatcher 分发器的。这个类会在我们所有事件判断好之后，调用它的 dispatch 分发函数来派发我们的事件。所以我们简单的在 constructor 构造函数中记录下来即可。</p> 
<p>然后我们把之前写好的四个函数复制到 Recognizer 。改好后我们整个 Recognizer 就是这样的：</p> 
<pre><code class="prism language-javascript"><span class="token comment">/**
 * 识别器
 */</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Recognizer</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>dispatcher<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dispatcher <span class="token operator">=</span> dispatcher<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">start</span><span class="token punctuation">(</span>point<span class="token punctuation">,</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">(</span>context<span class="token punctuation">.</span>startX <span class="token operator">=</span> point<span class="token punctuation">.</span>clientX<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>startY <span class="token operator">=</span> point<span class="token punctuation">.</span>clientY<span class="token punctuation">)</span><span class="token punctuation">;</span>

    context<span class="token punctuation">.</span>points <span class="token operator">=</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{<!-- --></span>
        t<span class="token punctuation">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        x<span class="token punctuation">:</span> point<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span>
        y<span class="token punctuation">:</span> point<span class="token punctuation">.</span>clientY<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>

    context<span class="token punctuation">.</span>isPan <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>isTap <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span>isPress <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    context<span class="token punctuation">.</span>handler <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      context<span class="token punctuation">.</span>isPan <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      context<span class="token punctuation">.</span>isTap <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      context<span class="token punctuation">.</span>isPress <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'press-start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      context<span class="token punctuation">.</span>handler <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">move</span><span class="token punctuation">(</span>point<span class="token punctuation">,</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> dx <span class="token operator">=</span> point<span class="token punctuation">.</span>clientX <span class="token operator">-</span> context<span class="token punctuation">.</span>startX<span class="token punctuation">,</span>
      dy <span class="token operator">=</span> point<span class="token punctuation">.</span>clientY <span class="token operator">-</span> context<span class="token punctuation">.</span>startY<span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>context<span class="token punctuation">.</span>isPan <span class="token operator">&amp;&amp;</span> dx <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">+</span> dy <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      context<span class="token punctuation">.</span>isPan <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      context<span class="token punctuation">.</span>isTap <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      context<span class="token punctuation">.</span>isPress <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'pan-start'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>isPan<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'pan'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    context<span class="token punctuation">.</span>points <span class="token operator">=</span> context<span class="token punctuation">.</span>points<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>point <span class="token operator">=&gt;</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> point<span class="token punctuation">.</span>t <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    context<span class="token punctuation">.</span>points<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      t<span class="token punctuation">:</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      x<span class="token punctuation">:</span> point<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span>
      y<span class="token punctuation">:</span> point<span class="token punctuation">.</span>clientY<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token function">end</span><span class="token punctuation">(</span>point<span class="token punctuation">,</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    context<span class="token punctuation">.</span>isFlick <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>isTap<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">//console.log('tap');</span>
      <span class="token comment">// 把原先的 console.log 换成 dispatch 调用</span>
      <span class="token comment">// 这个事件不需要任何特殊属性，直接传`空对象`即可</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'tap'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
      
    context<span class="token punctuation">.</span>points <span class="token operator">=</span> context<span class="token punctuation">.</span>points<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>point <span class="token operator">=&gt;</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> point<span class="token punctuation">.</span>t <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">let</span> d<span class="token punctuation">,</span> v<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>context<span class="token punctuation">.</span>points<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      v <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
      d <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span>point<span class="token punctuation">.</span>clientX <span class="token operator">-</span> context<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span>point<span class="token punctuation">.</span>clientY <span class="token operator">-</span> context<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      v <span class="token operator">=</span> d <span class="token operator">/</span> <span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> context<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token operator">&gt;</span> <span class="token number">1.5</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      context<span class="token punctuation">.</span>isFlick <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'flick'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
      context<span class="token punctuation">.</span>isFlick <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>   
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>isPan<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'panend'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>isPress<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'press-end'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">cancel</span><span class="token punctuation">(</span>point<span class="token punctuation">,</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">clearTimeout</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'cancel'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>同学们还记得之前说过，这 4 个事件处理函数中的事件都是还没有分发出去的。所有事件识别后，我们都只是 <code>console.log</code> 打印了一下。</p> 
<p>所以接下来我们来完成这一部分的逻辑吧～</p> 
<p>首先是 <code>press</code>（或者是 press-start），这个我们是不需要传任何的参数出去的。所以我们直接 disptach 出去即可。</p> 
<pre><code class="prism language-javascript">context<span class="token punctuation">.</span>handler <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  context<span class="token punctuation">.</span>isPan <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  context<span class="token punctuation">.</span>isTap <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  context<span class="token punctuation">.</span>isPress <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>dispatcher<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'press'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  context<span class="token punctuation">.</span>handler <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>然后就是 <code>panstart</code> 移动开始这个事件，这个事件就需要把数据传出去的。这里我们就把一下关键数据给分发出去：</p> 
<ul><li><code>startX</code> - 开始点的 x 坐标</li><li><code>startY</code> - 开始点的 y 坐标</li><li><code>clientX</code> - 当前位置的 x 坐标</li><li><code>clientY</code> - 当前位置的 y 坐标</li><li><code>isVertical</code> - 当前的移动是否是垂直方向的，这个状态在做一些定向功能的时候会有用，所以我们这里附加了这个判断。 
  <ul><li>计算也很简单，如果 dx 水平线的移动距离小于 dy 垂直的移动距离，那么现在这个移动动作就是垂直的，否则就是水平线的移动。</li><li>这里我们要注意的是，要对比的是他们绝对的移动长度，我们是要忽略附属的情况（忽略是往左还是往右，往上还是往下，只需要移动的长度）</li><li>所以我们要让 dx 和 dy 是一个正数，这里就使用 <code>Math.abs()</code></li></ul> </li></ul> 
<p>在这个事件里，这 4 个数据就够了，如果遇到一些功能需要 panstart 给予更多的数据，我们可以回到这个库的这里进行添加即可。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>context<span class="token punctuation">.</span>isPan <span class="token operator">&amp;&amp;</span> dx <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">+</span> dy <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  context<span class="token punctuation">.</span>isPan <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  context<span class="token punctuation">.</span>isTap <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  context<span class="token punctuation">.</span>isPress <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  context<span class="token punctuation">.</span>isVertical <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>dx<span class="token punctuation">)</span> <span class="token operator">&lt;</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>dy<span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>dispatcher<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'panstart'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
    startX<span class="token punctuation">:</span> context<span class="token punctuation">.</span>startX<span class="token punctuation">,</span>
    startY<span class="token punctuation">:</span> context<span class="token punctuation">.</span>startY<span class="token punctuation">,</span>
    clientX<span class="token punctuation">:</span> point<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span>
    clientY<span class="token punctuation">:</span> point<span class="token punctuation">.</span>clientY<span class="token punctuation">,</span>
    isVertical<span class="token punctuation">:</span> context<span class="token punctuation">.</span>isVertical<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">clearTimeout</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>接下来的 <code>pan</code> 事件也是与我们的 panstart 的逻辑一样即可。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>dispatcher<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'pan'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
  startX<span class="token punctuation">:</span> context<span class="token punctuation">.</span>startX<span class="token punctuation">,</span>
  startY<span class="token punctuation">:</span> context<span class="token punctuation">.</span>startY<span class="token punctuation">,</span>
  clientX<span class="token punctuation">:</span> point<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span>
  clientY<span class="token punctuation">:</span> point<span class="token punctuation">.</span>clientY<span class="token punctuation">,</span>
  isVertical<span class="token punctuation">:</span> context<span class="token punctuation">.</span>isVertical<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这里我们改造了一下 panend 触发的位置，因为无论当前是一个移动结束，还是一个 flick，有时候我们功能上是不需要监听 flick 的。所以之前我们存在 flick 就不输出 panend 其实是错误的。</p> 
<p>所以这里我们就把 panend 的派发逻辑放在 flick 判断之后，然后放入一个 panend 的派发事件，传出去的参数与上面的 pan 一样，这里加上 <code>isFlick</code> 参数，把当前的移动状态是否是 flick 事件的状态也传出去给手势库的使用者。</p> 
<p>虽然我们已经在 panend 中给出了 velocity （速度）的参数。但是使用场景来说，有些时候我们是需要单独监听 flick 事件的。所以我们当前的移动事件是一个 flick 的话，我们也一样会派发一个 flick 事件，并且在传出去的参数中加上 <code>velocity</code> 速度这个参数。</p> 
<p>最后 isPan 判断里面的代码是这样的：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">let</span> d<span class="token punctuation">,</span> v<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>context<span class="token punctuation">.</span>points<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  v <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
  d <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span>point<span class="token punctuation">.</span>clientX <span class="token operator">-</span> context<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span>point<span class="token punctuation">.</span>clientY <span class="token operator">-</span> context<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  v <span class="token operator">=</span> d <span class="token operator">/</span> <span class="token punctuation">(</span>Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> context<span class="token punctuation">.</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>v <span class="token operator">&gt;</span> <span class="token number">1.5</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  context<span class="token punctuation">.</span>isFlick <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'flick'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
  context<span class="token punctuation">.</span>isFlick <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>   
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token punctuation">.</span>isPan<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>dispatcher<span class="token punctuation">.</span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token string">'panend'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
    startX<span class="token punctuation">:</span> context<span class="token punctuation">.</span>startX<span class="token punctuation">,</span>
    startY<span class="token punctuation">:</span> context<span class="token punctuation">.</span>startY<span class="token punctuation">,</span>
    clientX<span class="token punctuation">:</span> point<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span>
    clientY<span class="token punctuation">:</span> point<span class="token punctuation">.</span>clientY<span class="token punctuation">,</span>
    isVertical<span class="token punctuation">:</span> context<span class="token punctuation">.</span>isVertical<span class="token punctuation">,</span>
    isFlick<span class="token punctuation">:</span> context<span class="token punctuation">.</span>isFlick<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>好，我们还有一个 press 和 cancel 事件的派发，这里我们就直接使用 <code>this.dispatcher.dispatch</code> 就好了，也不需要传任何的而外参数了。因为这些事件没有必要。</p> 
<h3><a id="Dispatcher__368"></a>Dispatcher 派发器</h3> 
<p>最后我们就是来实现我们在 Recognizer 里面用到的 Dispatcher。这个非常的简单，就是把我们 dispatch 函数写入一个 Dispatcher 类里面即可。最后因为 element 是传进来 dipatcher 当中的。所以我们需要在 constructor 里面接收并且记录在类属性当中即可。</p> 
<pre><code class="prism language-javascript"><span class="token comment">/**
 * 分发器
 */</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Dispatcher</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">constructor</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>element <span class="token operator">=</span> element<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">dispatch</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> properties<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> event <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Event</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> name <span class="token keyword">in</span> properties<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      event<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> properties<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>element<span class="token punctuation">.</span><span class="token function">dispatchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_390"></a>一体化启用函数</h3> 
<p>最后我们加入一个函数，可以让使用者直接通过这个方法来使用我们的手势库。记住 “高内聚” 的设计理念，就是让你的使用者不需要知道我们封装的服务里的任何复杂内容和使用方式。封装一些简单方便的方法给予使用者们，让他们更友好的使用这个功能。</p> 
<p>所以这里我们就加入了 <code>enableGesture</code> 函数，这个函数值需要接收一个 element 参数，即可开启我们所有的事件监听能力。</p> 
<pre><code class="prism language-javascript"><span class="token comment">/**
 * 给某个 element 启用手势库的监听
 * 一体化的处理方法
 *
 * @param {Element} element 元素
 */</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">enableGesture</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">new</span> <span class="token class-name">Listener</span><span class="token punctuation">(</span>element<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Recognizer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Dispatcher</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这样我们完美的写好了一个 Gesture 库，它可以完美地给我们的 Carousel 组件提供手势功能了。</p> 
<p>接下来我们自己测试一下我们封装的代码是否可靠。在我们的 gesture.html 中引用我们刚刚写的 enable</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">oncontextmenu</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>event.preventDefault()<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> enableGesture <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./gesture.js'</span><span class="token punctuation">;</span>
  <span class="token function">enableGesture</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>documentElement<span class="token punctuation">)</span><span class="token punctuation">;</span>

  document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'tap'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Tapped!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><img src="https://images2.imgbox.com/57/a5/k5SXxuFg_o.png" alt=""></p> 
<p>没有任何问题的话，当我们点击一下浏览器空白页面的时候，我们 console 中就会输出一个 “Tapped!”。这样就证明我们的手势库可以投入使用了。</p> 
<blockquote> 
 <p>我是来自《<strong>技术银河</strong>》的<strong>三钻</strong>，一位正在重塑知识的技术人。下期再见。</p> 
</blockquote> 
<hr> 
<h3><a id="__432"></a>⭐️ 三哥推荐</h3> 
<h4><a id="_433"></a>开源项目推荐</h4> 
<h5><a id="Hexo_Theme_Aurora_434"></a>Hexo Theme Aurora</h5> 
<p><img src="https://images2.imgbox.com/b5/69/vzjiRp2N_o.png" alt=""><br> <img src="https://images2.imgbox.com/cd/9b/KsZSbxfq_o.png" alt=""></p> 
<blockquote> 
 <p>在最近在版本 1.5.0 更新了以下功能：</p> 
 <p>》<a href="https://tridiamond.tech" rel="nofollow">预览</a>《</p> 
</blockquote> 
<p>✨ 新增</p> 
<ul><li>自适应 “推荐文章” 布局 (增加了一个新的 “<code>置顶文章布局</code>” !!) 
  <ul><li>能够在“推荐文章”和“置顶文章”模式之间自由切换</li><li>如果总文章少于 3 篇，将自动切换到“置顶文章”模式</li><li>在文章卡上添加了“置顶”和“推荐”标签</li><li><a href="https://aurora.tridiamond.tech/zh/guide/theme.html#%E6%8E%A8%E8%8D%90%E5%B8%83%E5%B1%80%E6%A8%A1%E5%BC%8F" rel="nofollow">📖 文档</a></li></ul> </li><li>增加了与 VuePress 一样的自定义容器 <a href="https://github.com/auroral-ui/hexo-theme-aurora/issues/77">#77</a> 
  <ul><li><code>Info</code> 容器</li><li><code>Warning</code> 容器</li><li><code>Danger</code> 容器</li><li><code>Detail</code> 容器</li><li><a href="https://tridiamond.tech/post/aurora%2Fcustom-quotes" rel="nofollow">预览</a></li></ul> </li><li>支持了更多的 SEO meta 数据 <a href="https://github.com/auroral-ui/hexo-theme-aurora/issues/76">#76</a> 
  <ul><li>添加了 <code>description</code></li><li>添加了 <code>keywords</code></li><li>添加了 <code>author</code></li><li><a href="https://aurora.tridiamond.tech/zh/guide/site-meta.html#seo-meta" rel="nofollow">📖 文档</a></li></ul> </li></ul> 
<p><img src="https://images2.imgbox.com/e1/1f/aD4ScfTL_o.png" alt=""></p> 
<p>最近博主在全面投入开发一个可以 “<strong>迈向未来的</strong>” Hexo 主题，以极光为主题的博客主题。</p> 
<p>如果你是一个开发者，做一个个人博客也是你简历上的一个亮光点。而如果你有一个超级炫酷的博客，那就更加是亮上加亮了，简直就闪闪发光。</p> 
<p>如果喜欢这个主题，可以在 Github 上给我点个 🌟 让彼此都发光吧～</p> 
<blockquote> 
 <p>主题 Github 地址：<a href="https://github.com/auroral-ui/hexo-theme-aurora">https://github.com/auroral-ui/hexo-theme-aurora</a><br> 主题使用文档：<a href="https://aurora.tridiamond.tech/zh/" rel="nofollow">https://aurora.tridiamond.tech/zh/</a></p> 
</blockquote> 
<hr> 
<h5><a id="VSCode_Aurora_Future_474"></a>VSCode Aurora Future</h5> 
<p><img src="https://images2.imgbox.com/51/29/SHwAewKf_o.png" alt=""><br> 对，博主还做了一个 Aurora 的 VSCode 主题。用了Hexo Theme Aurora 相对应的颜色色系。这个主题的重点特性的就只用了 3 个颜色，减少在写代码的时候被多色多彩的颜色所转移了你的注意力，让你更集中在写代码之中。</p> 
<p>喜欢的大家可以支持一下哦！ <strong>直接在 VSCode 的插件搜索中输入 “Aurora Future” 即可找到这个主题哦！～</strong></p> 
<blockquote> 
 <p>主题 Github 地址：<a href="https://github.com/auroral-ui/aurora-future-vscode-theme">https://github.com/auroral-ui/aurora-future-vscode-theme</a><br> 主题插件地址：<a href="https://marketplace.visualstudio.com/items?itemName=auroral-ui.aurora-future" rel="nofollow">https://marketplace.visualstudio.com/items?itemName=auroral-ui.aurora-future</a></p> 
</blockquote> 
<hr> 
<h5><a id="Firefox_Aurora_Future_485"></a>Firefox Aurora Future</h5> 
<p><img src="https://images2.imgbox.com/f4/66/s418nLuC_o.png" alt="">我不知道大家，但是最近我在用火狐浏览器来做开发了。个人觉得火狐还真的是不错的。推荐大家尝试一下。</p> 
<p>当然我这里想给大家介绍的是我在火狐也做了一个 Aurora 主题。对的！用的是同一套的颜色体系。喜欢的小伙伴可以试一下哦！</p> 
<blockquote> 
 <p>主题地址：<a href="https://addons.mozilla.org/en-US/firefox/addon/aurora-future/" rel="nofollow">https://addons.mozilla.org/en-US/firefox/addon/aurora-future/</a></p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/870145d29239260999b28da5a5ca7acd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">hive2.0.1执行存储过程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/79dda896185c5a13568c234e1ed6456a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">平凡函数依赖是什么？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>