<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>解决CentOS系统时间与UTC时间不一致问题---实践 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="解决CentOS系统时间与UTC时间不一致问题---实践" />
<meta property="og:description" content="1.问题描述 最近在划水的鱼博客项目上用 @Scheduled 和corn表达式写了个定时器，项目在本地windows上跑是没有问题的，但是发现发布到linux服务上时，定时器运行时间不对了。与我设置的定时时间相差了8个小时。
查了相关资料发现是：linux的CentOS系统时间与UTC时间不一致导致的
2.原因 ​ 咱们在安装完Centos Linux操做系统以后，点击系统的时间发现与如今所使用的时间不一致，相差有8小时，而在安装系统的时候咱们选择的时区是上海，可是CentOS Linux默认的bios时间是utc时间(UTC是协调世界时(Universal Time Coordinated)英文缩写，是由国际无线电咨询委员会规定和推荐,并由国际时间局(BIH)负责保持的以秒为基础的时间标度。
​ UTC至关于本初子午线(即经度0度)上的平均太阳时，过去曾用格林威治平均时(GMT)来表示.北京时间比UTC时间早8小时，以1999年1月1日0000UTC为例，UTC时间是零点，北京时间为1999年1月1日早上8点整。)，因此咱们在时间上面相隔了8个小时。这个时候bios的时间和系统的时间固然是不一致，一个表明 utc 时间，一个表明cst（＋8时区），即上海的时间。
查看时间命令：
1.查看系统时间： date 2.查看utc时间 date -u 很明显两个时间相差勒8个小时，所以就出现了以上的问题。
3.解决办法 在CentOS Linux中终端命令中执行如下命令：
3.1 编辑时间配置文件 vi /etc/sysconfig/clock ------------------------------ ZONE=&#34;Asia/Shanghai&#34;操作系统 UTC=false #设置为false，硬件时钟不于utc时间一致同步 ARC=falsei 3.2 linux的时区设置为上海时区 ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime 3.3 对准时间 ntpdate 47.99.xxx.xxx(你的ip) 若是没有安装ntp服务器，刚须要先执行如下命令 安装npt服务器：
yum install ntp 如果报这个问题：
解决杀掉进程
使用lsof –i:123 没有lsof命令的话：yum install -y lsof [root@izbp12w1juq9po2x7vs7nnz ~]# lsof -i:123 COMMAND PID USER FD TYPE DEVICE SIZE/OFF NODE NAME ntpd 31393 ntp 16u IPv4 48258263 0t0 UDP *:ntp ntpd 31393 ntp 17u IPv6 48258264 0t0 UDP *:ntp ntpd 31393 ntp 18u IPv4 48258269 0t0 UDP localhost:ntp ntpd 31393 ntp 19u IPv4 48258270 0t0 UDP izbp12w1juq9po2x7vs7nnz:ntp ntpd 31393 ntp 20u IPv4 48258271 0t0 UDP izbp12w1juq9po2x7vs7nnz:ntp [root@izbp12w1juq9po2x7vs7nnz ~]# kill -9 31393 然后再执行命令：ntpdate 47." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/28f1c5e109c059d1c8bd9242ba8ae49a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-13T11:19:48+08:00" />
<meta property="article:modified_time" content="2021-10-13T11:19:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">解决CentOS系统时间与UTC时间不一致问题---实践</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h5><a id="1_1"></a>1.问题描述</h5> 
<p>最近在<a href="https://shukai.fun/" rel="nofollow">划水的鱼</a>博客项目上用 @Scheduled 和corn表达式写了个定时器，项目在本地windows上跑是没有问题的，但是发现发布到linux服务上时，定时器运行时间不对了。与我设置的定时时间相差了8个小时。</p> 
<p>查了相关资料发现是：<strong>linux的CentOS系统时间与UTC时间不一致导致的</strong></p> 
<h5><a id="2_7"></a>2.原因</h5> 
<p>​ 咱们在安装完Centos Linux操做系统以后，点击系统的时间发现与如今所使用的时间不一致，相差有8小时，而在安装系统的时候咱们选择的时区是上海，可是CentOS Linux默认的bios时间是utc时间(UTC是协调世界时(Universal Time Coordinated)英文缩写，是由国际无线电咨询委员会规定和推荐,并由国际时间局(BIH)负责保持的以秒为基础的时间标度。</p> 
<p>​ UTC至关于本初子午线(即经度0度)上的平均太阳时，过去曾用格林威治平均时(GMT)来表示.北京时间比UTC时间早8小时，以1999年1月1日0000UTC为例，UTC时间是零点，北京时间为1999年1月1日早上8点整。)，因此咱们在时间上面相隔了8个小时。这个时候bios的时间和系统的时间固然是不一致，一个表明 utc 时间，一个表明cst（＋8时区），即上海的时间。</p> 
<p>查看时间命令：</p> 
<pre><code>1.查看系统时间：
date
2.查看utc时间
date -u
</code></pre> 
<p><img src="https://images2.imgbox.com/f8/86/7nKj1ofA_o.png" alt="image-20211013095940378"></p> 
<p>很明显两个时间相差勒8个小时，所以就出现了以上的问题。</p> 
<h5><a id="3_26"></a>3.解决办法</h5> 
<p>在CentOS Linux中终端命令中执行如下命令：</p> 
<h6><a id="31__30"></a>3.1 编辑时间配置文件</h6> 
<pre><code class="prism language-shell"><span class="token function">vi</span> /etc/sysconfig/clock 
------------------------------
 <span class="token assign-left variable">ZONE</span><span class="token operator">=</span><span class="token string">"Asia/Shanghai"</span>操作系统
 <span class="token assign-left variable">UTC</span><span class="token operator">=</span>false                          <span class="token comment">#设置为false，硬件时钟不于utc时间一致同步</span>
 <span class="token assign-left variable">ARC</span><span class="token operator">=</span>falsei
</code></pre> 
<h6><a id="32_linux_40"></a>3.2 linux的时区设置为上海时区</h6> 
<pre><code class="prism language-shell"><span class="token function">ln</span> -sf /usr/share/zoneinfo/Asia/Shanghai    /etc/localtime
</code></pre> 
<h6><a id="33__46"></a>3.3 对准时间</h6> 
<pre><code class="prism language-shell">ntpdate <span class="token number">47.99</span>.xxx.xxx<span class="token punctuation">(</span>你的ip<span class="token punctuation">)</span>
</code></pre> 
<p>若是没有安装ntp服务器，刚须要先执行如下命令 安装npt服务器：</p> 
<pre><code class="prism language-shell">yum <span class="token function">install</span> ntp
</code></pre> 
<p>如果报这个问题：</p> 
<p><img src="https://images2.imgbox.com/78/b5/tDLaEhPM_o.png" alt="image-20211013095248340"></p> 
<p>解决杀掉进程</p> 
<pre><code>使用lsof –i:123
没有lsof命令的话：yum install -y lsof

[root@izbp12w1juq9po2x7vs7nnz ~]# lsof -i:123
COMMAND   PID USER   FD   TYPE   DEVICE SIZE/OFF NODE NAME
ntpd    31393  ntp   16u  IPv4 48258263      0t0  UDP *:ntp 
ntpd    31393  ntp   17u  IPv6 48258264      0t0  UDP *:ntp 
ntpd    31393  ntp   18u  IPv4 48258269      0t0  UDP localhost:ntp 
ntpd    31393  ntp   19u  IPv4 48258270      0t0  UDP izbp12w1juq9po2x7vs7nnz:ntp 
ntpd    31393  ntp   20u  IPv4 48258271      0t0  UDP izbp12w1juq9po2x7vs7nnz:ntp 
[root@izbp12w1juq9po2x7vs7nnz ~]# kill -9 31393

然后再执行命令：ntpdate 47.99.xxx.xxx(你的ip)
</code></pre> 
<p>如果报错：</p> 
<p><img src="https://images2.imgbox.com/47/b1/ou7NuNRR_o.png" alt="image-20211013101651247"></p> 
<pre><code>解决办法：
①在本机上装ntpd服务
②启动ntpd服务
③检查ntp server完成了与自身的同步
④使用ntpdate让其它节点与ntp server进行同步
</code></pre> 
<h6><a id="34__94"></a>3.4 设置硬件时间和系统时间一致并校准</h6> 
<pre><code class="prism language-shell">/sbin/hwclock --systohc
</code></pre> 
<p>好了，咱们的CentOS linux系统时间和计算机硬件时间终于都是cst时间了，而且都是上海时区，终因而正常啦。</p> 
<p>时间是同步了，但是在网上搜方法时，将CST时间换成了GMT了，不影响使用就不关心了。</p> 
<p><strong>GMT时间是格林尼治标准时间。CST时间是指包含中国。美国。巴西，澳大利亚四个时区的时间。</strong></p> 
<p><img src="https://images2.imgbox.com/08/c3/iXptNAuu_o.png" alt="image-20211013110801332"></p> 
<p>还有一个简单的方法就是直接改时间，命令：</p> 
<pre><code>date -s 2021/10/13
date -s 11:04
</code></pre> 
<p><img src="https://images2.imgbox.com/58/1a/W7GrToU4_o.png" alt="image-20211013111445519"></p> 
<p>完事！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/04c2f4731255eaf98dc23bf9db43682c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java大厂面试题2021【Redis的应用-关注和粉丝】【Redis的应用-redis数据类型】【程序算法炒基金】【2021面试必看】A股基金投资记录（从2021-10-11起投）每日更新实操</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ba91a9cfca8e44ef09bac79c2c29587c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">三种方法生成随机数之srand篇</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>