<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>代码覆盖率统计Super-jacoco在公司级容器化项目中的具体应用方案 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="代码覆盖率统计Super-jacoco在公司级容器化项目中的具体应用方案" />
<meta property="og:description" content="目录
一、介绍
二、自己在本地搭建Super-jacoco服务
2.1 准备工作
2.2 部署super jacoco服务
1、下载super jacoco 项目
2、初始化数据库
3、配置application.properties
4、编译super jacoco项目
5、部署 super jacoco 服务
2.3 启动被测项目
2.4、代码覆盖率收集
2.4.1 启动代码覆盖率收集
2.4.2 获取代码覆盖率
三、公司项目级docker容器化项目Super-jacoco应用
3.1 镜像准备
3.2 部署项目
3.3 测试同学部署Super-jacoco服务
3.3.1 、数据库准备，用于存储报告信息等。
3.3.2 配置Super-jacoco服务application.properties信息
3.3.3、编译super jacoco项目
3.3.4、部署 super jacoco 服务
3.4、代码覆盖率收集
3.4.1 启动代码覆盖率收集
3.4.2 获取代码覆盖率
四、报错处理
4.1 &#34;errMsg&#34;: &#34;统计失败:编译代码出错&#34;
4.2 编译失败 （权限相关）
4.3 编译失败 （网络慢）
4.4 编译失败 五、Super-jacoco原理
5.1 整体流程
5.2 获取增量代码
5.3. jacoco 二次改造，支持增量方法列表参数
5.4. 执行" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/7c39aba3331bccdcae497a335659ad4f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-31T15:04:15+08:00" />
<meta property="article:modified_time" content="2023-10-31T15:04:15+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">代码覆盖率统计Super-jacoco在公司级容器化项目中的具体应用方案</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80%E3%80%81%E4%BB%8B%E7%BB%8D-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E4%BB%8B%E7%BB%8D" rel="nofollow">一、介绍</a></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="%E4%BA%8C%E3%80%81%E8%87%AA%E5%B7%B1%E5%9C%A8%E6%9C%AC%E5%9C%B0%E6%90%AD%E5%BB%BASuper-jacoco%E6%9C%8D%E5%8A%A1-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E8%87%AA%E5%B7%B1%E5%9C%A8%E6%9C%AC%E5%9C%B0%E6%90%AD%E5%BB%BASuper-jacoco%E6%9C%8D%E5%8A%A1" rel="nofollow">二、自己在本地搭建Super-jacoco服务</a></p> 
<p id="2.1%20%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C-toc" style="margin-left:0px;"><a href="#2.1%20%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C" rel="nofollow">2.1 准备工作</a></p> 
<p id="2.2%20%E9%83%A8%E7%BD%B2super%20jacoco%E6%9C%8D%E5%8A%A1-toc" style="margin-left:40px;"><a href="#2.2%20%E9%83%A8%E7%BD%B2super%20jacoco%E6%9C%8D%E5%8A%A1" rel="nofollow">2.2 部署super jacoco服务</a></p> 
<p id="1%E3%80%81%E4%B8%8B%E8%BD%BDsuper%20jacoco%20%E9%A1%B9%E7%9B%AE-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E4%B8%8B%E8%BD%BDsuper%20jacoco%20%E9%A1%B9%E7%9B%AE" rel="nofollow">1、下载super jacoco 项目</a></p> 
<p id="2%E3%80%81%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93-toc" style="margin-left:80px;"><a href="#2%E3%80%81%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93" rel="nofollow">2、初始化数据库</a></p> 
<p id="3%E3%80%81%E9%85%8D%E7%BD%AEapplication.properties-toc" style="margin-left:80px;"><a href="#3%E3%80%81%E9%85%8D%E7%BD%AEapplication.properties" rel="nofollow">3、配置application.properties</a></p> 
<p id="4%E3%80%81%E7%BC%96%E8%AF%91super%20jacoco%E9%A1%B9%E7%9B%AE-toc" style="margin-left:80px;"><a href="#4%E3%80%81%E7%BC%96%E8%AF%91super%20jacoco%E9%A1%B9%E7%9B%AE" rel="nofollow">4、编译super jacoco项目</a></p> 
<p id="5%E3%80%81%E9%83%A8%E7%BD%B2%C2%A0super%20jacoco%20%E6%9C%8D%E5%8A%A1-toc" style="margin-left:80px;"><a href="#5%E3%80%81%E9%83%A8%E7%BD%B2%C2%A0super%20jacoco%20%E6%9C%8D%E5%8A%A1" rel="nofollow">5、部署 super jacoco 服务</a></p> 
<p id="2.3%20%E5%90%AF%E5%8A%A8%E8%A2%AB%E6%B5%8B%E9%A1%B9%E7%9B%AE-toc" style="margin-left:40px;"><a href="#2.3%20%E5%90%AF%E5%8A%A8%E8%A2%AB%E6%B5%8B%E9%A1%B9%E7%9B%AE" rel="nofollow">2.3 启动被测项目</a></p> 
<p id="2.4%E3%80%81%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87%E6%94%B6%E9%9B%86-toc" style="margin-left:40px;"><a href="#2.4%E3%80%81%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87%E6%94%B6%E9%9B%86" rel="nofollow">2.4、代码覆盖率收集</a></p> 
<p id="2.4.1%20%E5%90%AF%E5%8A%A8%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87%E6%94%B6%E9%9B%86-toc" style="margin-left:80px;"><a href="#2.4.1%20%E5%90%AF%E5%8A%A8%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87%E6%94%B6%E9%9B%86" rel="nofollow">2.4.1 启动代码覆盖率收集</a></p> 
<p id="2.4.2%C2%A0%E8%8E%B7%E5%8F%96%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87-toc" style="margin-left:80px;"><a href="#2.4.2%C2%A0%E8%8E%B7%E5%8F%96%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87" rel="nofollow">2.4.2 获取代码覆盖率</a></p> 
<p id="%E4%B8%89%E3%80%81%E5%85%AC%E5%8F%B8%E9%A1%B9%E7%9B%AE%E7%BA%A7docker%E5%AE%B9%E5%99%A8%E5%8C%96%E9%A1%B9%E7%9B%AESuper-jacoco%E5%BA%94%E7%94%A8-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E5%85%AC%E5%8F%B8%E9%A1%B9%E7%9B%AE%E7%BA%A7docker%E5%AE%B9%E5%99%A8%E5%8C%96%E9%A1%B9%E7%9B%AESuper-jacoco%E5%BA%94%E7%94%A8" rel="nofollow">三、公司项目级docker容器化项目Super-jacoco应用</a></p> 
<p id="3.1%20%E9%95%9C%E5%83%8F%E5%87%86%E5%A4%87-toc" style="margin-left:40px;"><a href="#3.1%20%E9%95%9C%E5%83%8F%E5%87%86%E5%A4%87" rel="nofollow">3.1 镜像准备</a></p> 
<p id="3.2%C2%A0%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE-toc" style="margin-left:40px;"><a href="#3.2%C2%A0%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE" rel="nofollow">3.2 部署项目</a></p> 
<p id="3.3%20%E6%B5%8B%E8%AF%95%E5%90%8C%E5%AD%A6%E9%83%A8%E7%BD%B2Super-jacoco%E6%9C%8D%E5%8A%A1-toc" style="margin-left:40px;"><a href="#3.3%20%E6%B5%8B%E8%AF%95%E5%90%8C%E5%AD%A6%E9%83%A8%E7%BD%B2Super-jacoco%E6%9C%8D%E5%8A%A1" rel="nofollow">3.3 测试同学部署Super-jacoco服务</a></p> 
<p id="3.3.1%20%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%86%E5%A4%87%EF%BC%8C%E7%94%A8%E4%BA%8E%E5%AD%98%E5%82%A8%E6%8A%A5%E5%91%8A%E4%BF%A1%E6%81%AF%E7%AD%89%E3%80%82-toc" style="margin-left:80px;"><a href="#3.3.1%20%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%86%E5%A4%87%EF%BC%8C%E7%94%A8%E4%BA%8E%E5%AD%98%E5%82%A8%E6%8A%A5%E5%91%8A%E4%BF%A1%E6%81%AF%E7%AD%89%E3%80%82" rel="nofollow">3.3.1 、数据库准备，用于存储报告信息等。</a></p> 
<p id="3.3.2%20%E9%85%8D%E7%BD%AESuper-jacoco%E6%9C%8D%E5%8A%A1application.properties%E4%BF%A1%E6%81%AF-toc" style="margin-left:80px;"><a href="#3.3.2%20%E9%85%8D%E7%BD%AESuper-jacoco%E6%9C%8D%E5%8A%A1application.properties%E4%BF%A1%E6%81%AF" rel="nofollow">3.3.2 配置Super-jacoco服务application.properties信息</a></p> 
<p id="%C2%A03.3.3%E3%80%81%E7%BC%96%E8%AF%91super%20jacoco%E9%A1%B9%E7%9B%AE-toc" style="margin-left:80px;"><a href="#%C2%A03.3.3%E3%80%81%E7%BC%96%E8%AF%91super%20jacoco%E9%A1%B9%E7%9B%AE" rel="nofollow"> 3.3.3、编译super jacoco项目</a></p> 
<p id="3.3.4%E3%80%81%E9%83%A8%E7%BD%B2%C2%A0super%20jacoco%20%E6%9C%8D%E5%8A%A1-toc" style="margin-left:80px;"><a href="#3.3.4%E3%80%81%E9%83%A8%E7%BD%B2%C2%A0super%20jacoco%20%E6%9C%8D%E5%8A%A1" rel="nofollow">3.3.4、部署 super jacoco 服务</a></p> 
<p id="%C2%A03.4%E3%80%81%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87%E6%94%B6%E9%9B%86-toc" style="margin-left:40px;"><a href="#%C2%A03.4%E3%80%81%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87%E6%94%B6%E9%9B%86" rel="nofollow"> 3.4、代码覆盖率收集</a></p> 
<p id="3.4.1%20%E5%90%AF%E5%8A%A8%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87%E6%94%B6%E9%9B%86-toc" style="margin-left:80px;"><a href="#3.4.1%20%E5%90%AF%E5%8A%A8%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87%E6%94%B6%E9%9B%86" rel="nofollow">3.4.1 启动代码覆盖率收集</a></p> 
<p id="3.4.2%C2%A0%E8%8E%B7%E5%8F%96%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87-toc" style="margin-left:80px;"><a href="#3.4.2%C2%A0%E8%8E%B7%E5%8F%96%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87" rel="nofollow">3.4.2 获取代码覆盖率</a></p> 
<p id="%E5%9B%9B%E3%80%81%E6%8A%A5%E9%94%99%E5%A4%84%E7%90%86-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%E3%80%81%E6%8A%A5%E9%94%99%E5%A4%84%E7%90%86" rel="nofollow">四、报错处理</a></p> 
<p id="4.1%20%22errMsg%22%3A%20%22%E7%BB%9F%E8%AE%A1%E5%A4%B1%E8%B4%A5%3A%E7%BC%96%E8%AF%91%E4%BB%A3%E7%A0%81%E5%87%BA%E9%94%99%22-toc" style="margin-left:40px;"><a href="#4.1%20%22errMsg%22%3A%20%22%E7%BB%9F%E8%AE%A1%E5%A4%B1%E8%B4%A5%3A%E7%BC%96%E8%AF%91%E4%BB%A3%E7%A0%81%E5%87%BA%E9%94%99%22" rel="nofollow">4.1 "errMsg": "统计失败:编译代码出错"</a></p> 
<p id="4.2%20%E7%BC%96%E8%AF%91%E5%A4%B1%E8%B4%A5%20%EF%BC%88%E6%9D%83%E9%99%90%E7%9B%B8%E5%85%B3%EF%BC%89-toc" style="margin-left:40px;"><a href="#4.2%20%E7%BC%96%E8%AF%91%E5%A4%B1%E8%B4%A5%20%EF%BC%88%E6%9D%83%E9%99%90%E7%9B%B8%E5%85%B3%EF%BC%89" rel="nofollow">4.2 编译失败 （权限相关）</a></p> 
<p id="4.3%C2%A0%E7%BC%96%E8%AF%91%E5%A4%B1%E8%B4%A5%20%EF%BC%88%E7%BD%91%E7%BB%9C%E6%85%A2%EF%BC%89-toc" style="margin-left:40px;"><a href="#4.3%C2%A0%E7%BC%96%E8%AF%91%E5%A4%B1%E8%B4%A5%20%EF%BC%88%E7%BD%91%E7%BB%9C%E6%85%A2%EF%BC%89" rel="nofollow">4.3 编译失败 （网络慢）</a></p> 
<p id="4.4%C2%A0%E7%BC%96%E8%AF%91%E5%A4%B1%E8%B4%A5%C2%A0-toc" style="margin-left:40px;"><a href="#4.4%C2%A0%E7%BC%96%E8%AF%91%E5%A4%B1%E8%B4%A5%C2%A0" rel="nofollow">4.4 编译失败 </a></p> 
<p id="%E4%BA%94%E3%80%81Super-jacoco%E5%8E%9F%E7%90%86-toc" style="margin-left:0px;"><a href="#%E4%BA%94%E3%80%81Super-jacoco%E5%8E%9F%E7%90%86" rel="nofollow">五、Super-jacoco原理</a></p> 
<p id="5.1%20%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B-toc" style="margin-left:40px;"><a href="#5.1%20%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B" rel="nofollow">5.1 整体流程</a></p> 
<p id="5.2%C2%A0%E8%8E%B7%E5%8F%96%E5%A2%9E%E9%87%8F%E4%BB%A3%E7%A0%81-toc" style="margin-left:40px;"><a href="#5.2%C2%A0%E8%8E%B7%E5%8F%96%E5%A2%9E%E9%87%8F%E4%BB%A3%E7%A0%81" rel="nofollow">5.2 获取增量代码</a></p> 
<p id="5.3.%20jacoco%20%E4%BA%8C%E6%AC%A1%E6%94%B9%E9%80%A0%EF%BC%8C%E6%94%AF%E6%8C%81%E5%A2%9E%E9%87%8F%E6%96%B9%E6%B3%95%E5%88%97%E8%A1%A8%E5%8F%82%E6%95%B0-toc" style="margin-left:40px;"><a href="#5.3.%20jacoco%20%E4%BA%8C%E6%AC%A1%E6%94%B9%E9%80%A0%EF%BC%8C%E6%94%AF%E6%8C%81%E5%A2%9E%E9%87%8F%E6%96%B9%E6%B3%95%E5%88%97%E8%A1%A8%E5%8F%82%E6%95%B0" rel="nofollow">5.3. jacoco 二次改造，支持增量方法列表参数</a></p> 
<p id="5.4.%20%E6%89%A7%E8%A1%8C-toc" style="margin-left:40px;"><a href="#5.4.%20%E6%89%A7%E8%A1%8C" rel="nofollow">5.4. 执行</a></p> 
<p id="5.5.%20%E6%8A%A5%E5%91%8A%E8%BE%93%E5%87%BA-toc" style="margin-left:40px;"><a href="#5.5.%20%E6%8A%A5%E5%91%8A%E8%BE%93%E5%87%BA" rel="nofollow">5.5. 报告输出</a></p> 
<p id="5.6%E3%80%81%E6%9E%B6%E6%9E%84-toc" style="margin-left:40px;"><a href="#5.6%E3%80%81%E6%9E%B6%E6%9E%84" rel="nofollow">5.6、架构</a></p> 
<p id="%E5%85%AD%E3%80%81%E7%9B%B8%E5%85%B3%E8%B5%84%E6%96%99%EF%BC%9A-toc" style="margin-left:0px;"><a href="#%E5%85%AD%E3%80%81%E7%9B%B8%E5%85%B3%E8%B5%84%E6%96%99%EF%BC%9A" rel="nofollow">六、相关资料：</a></p> 
<p id="%E4%B8%83%E3%80%81%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87%E6%94%B6%E9%9B%86%20%EF%BC%88%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E%EF%BC%89-toc" style="margin-left:0px;"><a href="#%E4%B8%83%E3%80%81%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87%E6%94%B6%E9%9B%86%20%EF%BC%88%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E%EF%BC%89" rel="nofollow">七、代码覆盖率收集 （使用说明）</a></p> 
<p id="7.1%20%E6%AD%A3%E5%B8%B8%E5%9C%BA%E6%99%AF-toc" style="margin-left:40px;"><a href="#7.1%20%E6%AD%A3%E5%B8%B8%E5%9C%BA%E6%99%AF" rel="nofollow">7.1 正常场景</a></p> 
<p id="7.2%20%E8%A2%AB%E6%B5%8B%E9%A1%B9%E7%9B%AE%E9%87%8D%E5%90%AF%E7%9A%84%E5%9C%BA%E6%99%AF-toc" style="margin-left:40px;"><a href="#7.2%20%E8%A2%AB%E6%B5%8B%E9%A1%B9%E7%9B%AE%E9%87%8D%E5%90%AF%E7%9A%84%E5%9C%BA%E6%99%AF" rel="nofollow">7.2 被测项目重启的场景</a></p> 
<p id="7.3%C2%A0%E8%A2%AB%E6%B5%8B%E9%A1%B9%E7%9B%AE%EF%BC%88%E6%96%B0%E5%A2%9E%E4%BA%86%E4%BB%A3%E7%A0%81%EF%BC%89%E9%87%8D%E5%90%AF%E7%9A%84%E5%9C%BA%E6%99%AF-toc" style="margin-left:40px;"><a href="#7.3%C2%A0%E8%A2%AB%E6%B5%8B%E9%A1%B9%E7%9B%AE%EF%BC%88%E6%96%B0%E5%A2%9E%E4%BA%86%E4%BB%A3%E7%A0%81%EF%BC%89%E9%87%8D%E5%90%AF%E7%9A%84%E5%9C%BA%E6%99%AF" rel="nofollow">7.3 被测项目（新增了代码）重启的场景</a></p> 
<p id="%E5%85%AB%E3%80%81%E6%8A%A5%E5%91%8A%E8%A7%A3%E8%AF%BB%EF%BC%9A-toc" style="margin-left:0px;"><a href="#%E5%85%AB%E3%80%81%E6%8A%A5%E5%91%8A%E8%A7%A3%E8%AF%BB%EF%BC%9A" rel="nofollow">八、报告解读：</a></p> 
<p id="%E4%B9%9D%E3%80%81%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%EF%BC%9A-toc" style="margin-left:0px;"><a href="#%E4%B9%9D%E3%80%81%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%EF%BC%9A" rel="nofollow">九、注意事项：</a></p> 
<p id="-toc" style="margin-left:40px;"></p> 
<hr id="hr-toc"> 
<p></p> 
<p></p> 
<h2 id="%E4%B8%80%E3%80%81%E4%BB%8B%E7%BB%8D">一、介绍</h2> 
<p>Super-jacoco 在jacoco 上发展而来，可以统计增量代码覆盖率的统计。</p> 
<p>jacoco 相关说明：<a href="https://blog.csdn.net/qq_39208536/article/details/125653263?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522169760802216800215093345%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=169760802216800215093345&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-125653263-null-null.nonecase&amp;utm_term=%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87&amp;spm=1018.2226.3001.4450" title="jacoco代码覆盖率_jacoco覆盖率_做测试的喵酱的博客-CSDN博客">jacoco代码覆盖率_jacoco覆盖率_做测试的喵酱的博客-CSDN博客</a></p> 
<p>本文介绍 Super-jacoco 统计手工用例代码覆盖率的统计数据。</p> 
<p><strong>主要分两部分：</strong></p> 
<p><strong>一、自己在本地搭建Super-jacoco，自己玩一玩</strong></p> 
<p><strong>二、在公司的容器化项目中，如何使用Super-jacoco统计手工用例的代码覆盖率</strong></p> 
<h3></h3> 
<p> GitHub项目地址：</p> 
<p><a href="https://github.com/didi/super-jacoco" title="GitHub - didi/super-jacoco">GitHub - didi/super-jacoco</a></p> 
<p><a href="https://github.com/didi/super-jacoco" title="GitHub - didi/super-jacoco">GitHub - didi/super-jacoco</a></p> 
<p>尽量使用git命令，直接下载：</p> 
<pre><code class="language-sql">git clone https://github.com/didi/super-jacoco.git
</code></pre> 
<p></p> 
<h2 id="%E4%BA%8C%E3%80%81%E8%87%AA%E5%B7%B1%E5%9C%A8%E6%9C%AC%E5%9C%B0%E6%90%AD%E5%BB%BASuper-jacoco%E6%9C%8D%E5%8A%A1">二、自己在本地搭建Super-jacoco服务</h2> 
<h2 id="2.1%20%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C">2.1 准备工作</h2> 
<ol><li>准备gitlab用户</li><li>准备一个MySQL数据库5.x或者8.x版本</li></ol> 
<h3 id="2.2%20%E9%83%A8%E7%BD%B2super%20jacoco%E6%9C%8D%E5%8A%A1">2.2 部署super jacoco服务</h3> 
<h4 id="1%E3%80%81%E4%B8%8B%E8%BD%BDsuper%20jacoco%20%E9%A1%B9%E7%9B%AE">1、下载super jacoco 项目</h4> 
<p><a href="https://github.com/didi/super-jacoco" title="GitHub - didi/super-jacoco">GitHub - didi/super-jacoco</a></p> 
<h4 id="2%E3%80%81%E5%88%9D%E5%A7%8B%E5%8C%96%E6%95%B0%E6%8D%AE%E5%BA%93">2、初始化数据库</h4> 
<p>在super jacoco 项目中，sql/coverage_report.sql 文件用于初始化数据库。</p> 
<pre><code class="language-sql">CREATE DATABASE `super-jacoco` DEFAULT CHARACTER SET utf8 COLLATE utf8_bin ;
CREATE TABLE `diff_coverage_report` (
  `id` int(10) NOT NULL AUTO_INCREMENT,
  `job_record_uuid` varchar(80) NOT NULL COMMENT '请求唯一标识码',
  `request_status` int(10) NOT NULL COMMENT '请求执行状态,1=下载代码成功,2=生成diffmethod成功，3=生成报告成功,-1=执行出错',
  `giturl` varchar(80) NOT NULL COMMENT 'git 地址',
  `now_version` varchar(80) NOT NULL COMMENT '本次提交的commidId',
  `base_version` varchar(80) NOT NULL COMMENT '比较的基准commitId',
  `diffmethod` mediumtext COMMENT '增量代码的diff方法集合',
  `type` int(11) NOT NULL DEFAULT '0' COMMENT '2=增量代码覆盖率,1=全量覆盖率',
  `report_url` varchar(300) NOT NULL DEFAULT '' COMMENT '覆盖率报告url',
  `line_coverage` double(5,2) NOT NULL DEFAULT '-1.00' COMMENT '行覆盖率',
  `branch_coverage` double(5,2) NOT NULL DEFAULT '-1.00' COMMENT '分支覆盖率',
  `err_msg` varchar(1000) NOT NULL DEFAULT '' COMMENT '错误信息',
  `create_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
  `update_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
  `sub_module` varchar(255) NOT NULL DEFAULT '' COMMENT '子项目目录名称',
  `from` int(10) NOT NULL DEFAULT '0' COMMENT '1=单元测试，2=环境部署1=单元测试，2=hu',
  `now_local_path` varchar(500) NOT NULL DEFAULT '',
  `base_local_path` varchar(500) NOT NULL DEFAULT '',
  `log_file` varchar(255) NOT NULL DEFAULT '',
  PRIMARY KEY (`job_record_uuid`),
  KEY `id` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8 COMMENT='增量代码覆盖率';

CREATE TABLE `diff_deploy_info` (
  `id` int(10) NOT NULL AUTO_INCREMENT,
  `job_record_uuid` varchar(80) NOT NULL COMMENT '请求唯一标识码',
  `address` varchar(15) NOT NULL COMMENT 'HOST',
  `port` int(10) NOT NULL COMMENT '端口',
  `code_path` varchar(1000) NOT NULL DEFAULT '' COMMENT 'nowVersion代码目录',
  `child_modules` varchar(1000) NOT NULL DEFAULT '' COMMENT '项目子模块名称',
  PRIMARY KEY (`job_record_uuid`),
  KEY `id` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=0 DEFAULT CHARSET=utf8 COMMENT='服务部署地址';



</code></pre> 
<h4 id="3%E3%80%81%E9%85%8D%E7%BD%AEapplication.properties">3、配置application.properties</h4> 
<p>在下载下来的项目中，application.properties配置信息</p> 
<p>src/main/resources/application.properties</p> 
<pre><code># 以下信息需要手动配置
spring.datasource.url=jdbc:mysql://127.0.0.1:3306/super-jacoco?useUnicode=true&amp;characterEncoding=UTF-8&amp;zeroDateTimeBehavior=convertToNull&amp;allowMultiQueries=true&amp;serverTimezone=Asia/Shanghai&amp;useSSL=false
spring.datasource.username=root
spring.datasource.password=123456
#git username &amp; password
gitlab.username=miaojiang
gitlab.password=mj123456</code></pre> 
<p>主要配置</p> 
<p>数据库的连接信息：url 账号 密码</p> 
<p>gitlab 的账号、密码</p> 
<p></p> 
<p><strong>注意：</strong></p> 
<p>数据库的驱动配置，5.x与8.x 版本的MySQL，驱动是不一致的，根据自己的数据库配置。</p> 
<p> 如果你的数据库为MySQL 8.x，需要修改项目中的驱动。</p> 
<p><strong>1、修改pom.xml文件</strong></p> 
<pre><code>&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;com.didichuxing.chefuqa&lt;/groupId&gt;
    &lt;artifactId&gt;super-jacoco&lt;/artifactId&gt;
    &lt;packaging&gt;jar&lt;/packaging&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

    &lt;name&gt;super-jacoco&lt;/name&gt;
    &lt;description&gt;project for Spring cloud eureka client&lt;/description&gt;

    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;2.0.2.RELEASE&lt;/version&gt;
        &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;
    &lt;/parent&gt;

    &lt;properties&gt;
        &lt;entity.target.dir&gt;src/main/java/&lt;/entity.target.dir&gt;
        &lt;dao.resources.dir&gt;src/main/resources/&lt;/dao.resources.dir&gt;
        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
        &lt;java.version&gt;1.8&lt;/java.version&gt;
        &lt;spring-cloud.version&gt;Finchley.RELEASE&lt;/spring-cloud.version&gt;
        &lt;mybatis-spring-boot&gt;1.2.0&lt;/mybatis-spring-boot&gt;
        &lt;mysql-connector&gt;8.0.26&lt;/mysql-connector&gt;
        &lt;JAVA_HOME&gt;/Library/Java/JavaVirtualMachines/jdk1.8.0_121.jdk/Contents/Home&lt;/JAVA_HOME&gt;
    &lt;/properties&gt;

    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.jodd&lt;/groupId&gt;
            &lt;artifactId&gt;jodd-core&lt;/artifactId&gt;
            &lt;version&gt;5.1.6&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;dom4j&lt;/groupId&gt;
            &lt;artifactId&gt;dom4j&lt;/artifactId&gt;
            &lt;version&gt;1.6.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.jacoco&lt;/groupId&gt;
            &lt;artifactId&gt;org.jacoco.core&lt;/artifactId&gt;
            &lt;version&gt;0.8.4&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.ow2.asm&lt;/groupId&gt;
            &lt;artifactId&gt;asm&lt;/artifactId&gt;
            &lt;version&gt;7.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework&lt;/groupId&gt;
            &lt;artifactId&gt;spring-context-support&lt;/artifactId&gt;
            &lt;version&gt;5.1.4.RELEASE&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
            &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;${mybatis-spring-boot}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;version&gt;1.16.16&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- MySQL 连接驱动依赖 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;mysql&lt;/groupId&gt;
            &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
            &lt;version&gt;${mysql-connector}&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;commons-lang&lt;/groupId&gt;
            &lt;artifactId&gt;commons-lang&lt;/artifactId&gt;
            &lt;version&gt;2.6&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;
            &lt;artifactId&gt;commons-pool2&lt;/artifactId&gt;
            &lt;version&gt;2.5.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.codehaus.jackson&lt;/groupId&gt;
            &lt;artifactId&gt;jackson-mapper-asl&lt;/artifactId&gt;
            &lt;version&gt;1.9.13&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.codehaus.jackson&lt;/groupId&gt;
            &lt;artifactId&gt;jackson-core-asl&lt;/artifactId&gt;
            &lt;version&gt;1.9.13&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.google.guava&lt;/groupId&gt;
            &lt;artifactId&gt;guava&lt;/artifactId&gt;
            &lt;version&gt;15.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;net.sf.json-lib&lt;/groupId&gt;
            &lt;artifactId&gt;json-lib&lt;/artifactId&gt;
            &lt;version&gt;2.4&lt;/version&gt;
            &lt;classifier&gt;jdk15&lt;/classifier&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.jayway.jsonpath&lt;/groupId&gt;
            &lt;artifactId&gt;json-path&lt;/artifactId&gt;
            &lt;version&gt;2.2.0&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.sharegov&lt;/groupId&gt;
            &lt;artifactId&gt;mjson&lt;/artifactId&gt;
            &lt;version&gt;1.4.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;joda-time&lt;/groupId&gt;
            &lt;artifactId&gt;joda-time&lt;/artifactId&gt;
            &lt;version&gt;2.3&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- pinyin--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;com.belerweb&lt;/groupId&gt;
            &lt;artifactId&gt;pinyin4j&lt;/artifactId&gt;
            &lt;version&gt;2.5.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.jdom&lt;/groupId&gt;
            &lt;artifactId&gt;jdom2&lt;/artifactId&gt;
            &lt;version&gt;2.0.6&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- ssh的依赖 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;ch.ethz.ganymed&lt;/groupId&gt;
            &lt;artifactId&gt;ganymed-ssh2&lt;/artifactId&gt;
            &lt;version&gt;build210&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.tmatesoft.svnkit&lt;/groupId&gt;
            &lt;artifactId&gt;svnkit&lt;/artifactId&gt;
            &lt;version&gt;1.8.7&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt;
            &lt;artifactId&gt;httpclient&lt;/artifactId&gt;
            &lt;version&gt;4.5.5&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt;
            &lt;artifactId&gt;httpmime&lt;/artifactId&gt;
            &lt;version&gt;4.2.3&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;io.rest-assured&lt;/groupId&gt;
            &lt;artifactId&gt;rest-assured&lt;/artifactId&gt;
            &lt;version&gt;3.1.1&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.eclipse.jgit&lt;/groupId&gt;
            &lt;artifactId&gt;org.eclipse.jgit&lt;/artifactId&gt;
            &lt;version&gt;4.9.0.201710071750-r&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;com.github.javaparser&lt;/groupId&gt;
            &lt;artifactId&gt;javaparser-core&lt;/artifactId&gt;
            &lt;version&gt;3.4.4&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;!-- Swagger2核心包 --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.springfox&lt;/groupId&gt;
            &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;
            &lt;version&gt;2.7.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.springfox&lt;/groupId&gt;
            &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;
            &lt;version&gt;2.7.0&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;!-- jsoup HTML parser library @ http://jsoup.org/ --&gt;
            &lt;groupId&gt;org.jsoup&lt;/groupId&gt;
            &lt;artifactId&gt;jsoup&lt;/artifactId&gt;
            &lt;version&gt;1.10.2&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;tk.mybatis&lt;/groupId&gt;
            &lt;artifactId&gt;mapper-spring-boot-starter&lt;/artifactId&gt;
            &lt;version&gt;2.0.2&lt;/version&gt;
        &lt;/dependency&gt;

    &lt;/dependencies&gt;

    &lt;dependencyManagement&gt;
        &lt;dependencies&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
                &lt;artifactId&gt;spring-cloud-dependencies&lt;/artifactId&gt;
                &lt;version&gt;${spring-cloud.version}&lt;/version&gt;
                &lt;type&gt;pom&lt;/type&gt;
                &lt;scope&gt;import&lt;/scope&gt;
            &lt;/dependency&gt;
        &lt;/dependencies&gt;
    &lt;/dependencyManagement&gt;

    &lt;build&gt;
        &lt;finalName&gt;super-jacoco&lt;/finalName&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;source&gt;1.8&lt;/source&gt;
                    &lt;target&gt;1.8&lt;/target&gt;
                    &lt;compilerArguments&gt;
                        &lt;bootclasspath&gt;${java.home}/lib/rt.jar:${java.home}/lib/jce.jar&lt;/bootclasspath&gt;
                    &lt;/compilerArguments&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;
                &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;1.3.7&lt;/version&gt;
                &lt;configuration&gt;
                    &lt;verbose&gt;true&lt;/verbose&gt;
                    &lt;overwrite&gt;true&lt;/overwrite&gt;
                    &lt;configurationFile&gt;
                        ${basedir}/src/main/resources/tk-mybatis-autogen.xml
                    &lt;/configurationFile&gt;
                    &lt;!--允许移动生成的文件 --&gt;
                    &lt;verbose&gt;true&lt;/verbose&gt;
                    &lt;overwrite&gt;true&lt;/overwrite&gt;
                &lt;/configuration&gt;
                &lt;dependencies&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;mysql&lt;/groupId&gt;
                        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
                        &lt;version&gt;8.0.26&lt;/version&gt;
                    &lt;/dependency&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;tk.mybatis&lt;/groupId&gt;
                        &lt;artifactId&gt;mapper&lt;/artifactId&gt;
                        &lt;version&gt;4.1.5&lt;/version&gt;
                    &lt;/dependency&gt;
                &lt;/dependencies&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;
&lt;/project&gt;</code></pre> 
<p><strong>2、application.properties修改数据库配置驱动</strong></p> 
<p> 下面这个是8.x MySQL的驱动</p> 
<pre><code class="language-sql">spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver</code></pre> 
<p></p> 
<p><img alt="" height="206" src="https://images2.imgbox.com/a8/3c/BRGnY7Rh_o.png" width="548"></p> 
<h4 id="4%E3%80%81%E7%BC%96%E8%AF%91super%20jacoco%E9%A1%B9%E7%9B%AE"><br> 4、编译super jacoco项目</h4> 
<p>修改完super jacoco项目中的配置文件，就可以编译该项目了。生成super jacoco.jar</p> 
<h4 id="5%E3%80%81%E9%83%A8%E7%BD%B2%C2%A0super%20jacoco%20%E6%9C%8D%E5%8A%A1">5、部署 super jacoco 服务</h4> 
<p> 启动super-jacoco.jar 服务</p> 
<p>执行命令</p> 
<pre><code class="language-sql">nohup java -jar super-jacoco.jar &amp;</code></pre> 
<p>默认端口为8899</p> 
<p></p> 
<p>可以8899端口，程序是否启动成功</p> 
<pre><code class="language-sql">lsof -i:8899</code></pre> 
<p>注意：</p> 
<p>在部署 super jacoco 服务的机器上，一定要有以下环境：</p> 
<p>1、有mvn环境，如果没有的话，需要配置</p> 
<p>2、有git环境，并配置了能拉取被测项目的gitlab账号和密码。</p> 
<p>可以自己在这台机器上手动试一下，是否有权限</p> 
<pre><code class="language-sql">git clone xxx.xxx.git</code></pre> 
<p></p> 
<p>相关资料：</p> 
<p><a href="https://miaojiang.blog.csdn.net/article/details/122717611" rel="nofollow" title="Mac下安装Maven&amp;idea配置maven_做测试的喵酱的博客-CSDN博客">Mac下安装Maven&amp;idea配置maven_做测试的喵酱的博客-CSDN博客</a></p> 
<p><a href="https://miaojiang.blog.csdn.net/article/details/125660945" rel="nofollow" title="mac&amp;linux配置环境变量详解_vim ~/.zshrc-CSDN博客">mac&amp;linux配置环境变量详解_vim ~/.zshrc-CSDN博客</a></p> 
<p></p> 
<h3 id="2.3%20%E5%90%AF%E5%8A%A8%E8%A2%AB%E6%B5%8B%E9%A1%B9%E7%9B%AE">2.3 启动被测项目</h3> 
<p>1、在super jacoco项目中，找到jacoco/org.jacoco.agent-0.8.5-runtime.jar 文件。</p> 
<p>将org.jacoco.agent-0.8.5-runtime.jar 文件，放在被测服务部署的项目上。</p> 
<p>如放置路径为/usr/local/org.jacoco.agent-0.8.5-runtime.jar</p> 
<p>被测项目为 mock-server.jar</p> 
<p>启动被测项目：</p> 
<pre><code class="language-sql">nohup java -javaagent:/usr/local/org.jacoco.agent-0.8.5-runtime.jar=includes=*,output=tcpserver,port=18513,address=*,append=true -jar mock-server.jar &gt; /dev/null 2&gt;&amp;1 &amp;</code></pre> 
<p>命令解释：</p> 
<ul><li> <p><code>nohup</code>：忽略挂起信号，允许命令在后台运行。</p> </li><li> <p><code>java</code>：启动 Java 虚拟机。</p> </li><li> <p><code>-javaagent:/usr/local/org.jacoco.agent-0.8.5-runtime.jar=includes=*,output=tcpserver,port=18513,address=*,append=true</code>：配置 JaCoCo 代码覆盖率工具代理，其中：</p> 
  <ul><li> <p><code>/usr/local/org.jacoco.agent-0.8.5-runtime.jar</code>：指定 JaCoCo 代理 Jar 文件的路径。</p> </li><li> <p><code>includes=*</code>：指定要包括在覆盖率报告中的类的匹配模式。此处将所有类都包括在内。</p> </li><li> <p><code>output=tcpserver</code>：指定覆盖率信息的输出模式。此处使用 TCP 服务器模式。</p> </li><li> <p><code>port=18513</code>：指定 TCP 服务器的端口号。</p> </li><li> <p><code>address=*</code>：指定 TCP 服务器的地址。此处使用星号 <code>*</code> 表示接受所有来自任何地址的连接。</p> </li><li> <p><code>append=true</code>：指定是否将新的覆盖率数据附加到现有数据文件中。此处附加新的数据以保留历史数据。</p> </li></ul></li><li> <p><code>-jar mock-server.jar</code>：指定要运行的 Jar 文件，即 MockServer 的可执行 Jar 文件。</p> </li><li> <p><code>&gt; /dev/null</code>：将标准输出重定向到 <code>/dev/null</code>，即不输出任何信息。</p> </li><li> <p><code>2&gt;&amp;1</code>：将标准错误输出重定向到标准输出。</p> </li><li> <p><code>&amp;</code>：将进程置于后台运行。</p> </li></ul> 
<p></p> 
<p>注意：</p> 
<p><code>port=18513 端口，是在被测试的服务所在服务器上，18513端口上，启一个jacoco监听的服务，一定要保证部署被测项目的机器，放开了18513 端口，且我们有权限访问18513 端口。</code></p> 
<p></p> 
<p>启动被测项目后，我们可以查看<code>18513 端口的服务是否启动成功</code></p> 
<pre><code class="language-sql">lsof -i:18513</code></pre> 
<p></p> 
<h3 id="2.4%E3%80%81%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87%E6%94%B6%E9%9B%86">2.4、代码覆盖率收集</h3> 
<p>假如：</p> 
<p>super jacoco 服务部署在了 123.123.123.123 这台服务上了</p> 
<p>被测项目mock-server 部署在了 456.456.456.456 机器上了</p> 
<h4 id="2.4.1%20%E5%90%AF%E5%8A%A8%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87%E6%94%B6%E9%9B%86">2.4.1 启动代码覆盖率收集</h4> 
<p>1)启动覆盖率收集URL：</p> 
<pre><code class="language-sql">http://123.123.123.123 /cov/triggerEnvCov</code></pre> 
<p><strong>调用方法：POST参数（body方式传入）：</strong></p> 
<pre><code class="language-sql">{
	"uuid": "uuid",
	"type": 1,
	"gitUrl": "git@git",
	"subModule": "",
	"baseVersion": "master",
	"nowVersion": "master"，
	"address": "456.456.456.456",
	"port": "18513"
}</code></pre> 
<p>备注：</p> 
<p>IP和port为被测服务所在服务器的IP和端口</p> 
<p>uuid： 自定义的一个id，将来拉取覆盖率时，通过这个uuid来拉取</p> 
<p>gitUrl： 被测项目的gitlab地址</p> 
<p></p> 
<p><strong>返回：</strong></p> 
<pre><code>{
	"code": 200,
	"data": true,
	"msg": "msg"
}</code></pre> 
<h4 id="2.4.2%C2%A0%E8%8E%B7%E5%8F%96%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87">2.4.2 获取代码覆盖率</h4> 
<p>覆盖率结果URL：</p> 
<pre><code class="language-sql">http://123.123.123.123/cov/getEnvCoverResult</code></pre> 
<p>调用方法：</p> 
<p>GET</p> 
<p>参数：</p> 
<p>uuid(String)</p> 
<p>返回：</p> 
<pre><code>{
	"code": 200,
	"data": {
		"coverStatus": 1,
		"errMsg": "msg",
		"lineCoverage": 100.0,
		"branchCoverage": 100.0,
		"logFile": "file content",
		"reportUrl": "http://"
	},
	"msg": "msg"
}</code></pre> 
<p></p> 
<h2 id="%E4%B8%89%E3%80%81%E5%85%AC%E5%8F%B8%E9%A1%B9%E7%9B%AE%E7%BA%A7docker%E5%AE%B9%E5%99%A8%E5%8C%96%E9%A1%B9%E7%9B%AESuper-jacoco%E5%BA%94%E7%94%A8">三、公司项目级docker容器化项目Super-jacoco应用</h2> 
<p>前提：</p> 
<p>需要运维、网络、研发、测试同学的相互配合。</p> 
<p>但是整体流程，其实和上面是一致的。</p> 
<p>下载Super-jacoco 项目：</p> 
<pre><code class="language-sql">git clone https://github.com/didi/super-jacoco.git</code></pre> 
<p>然后取出Super-jacoco 项目 中的 jacoco/org.jacoco.agent-0.8.5-runtime.jar 文件，与sql/coverage_report.sql文件。</p> 
<h3 id="3.1%20%E9%95%9C%E5%83%8F%E5%87%86%E5%A4%87">3.1 镜像准备</h3> 
<p>本部分公司，主要是由运维同学负责。</p> 
<p>举例：</p> 
<p>依然是部署mock-server服务。</p> 
<p><strong>之前的流程：</strong></p> 
<p>运维: 准备 Dockerfile文件---生成镜像</p> 
<p>部署被测项目：拉取镜像，拉取被测项目的代码，进行编译，生成jar包。在容器中启动该项目</p> 
<p><strong>应用jacoco流程：</strong></p> 
<p>运维: 先把jacoco agent 的jar包打 放到某一个公共服务器的位置，<br> 然后编写 Dockerfile文件，在里面写拉jacoco agent  jar包的命令。 最后再通过这个Dockerfile文件生成的image镜像</p> 
<p>部署被测项目：</p> 
<p>拉取镜像，拉取被测项目的代码，进行编译，生成jar包。在容器中启动该项目。需要配置JAVA_OPTS的环境变量，把java agent信息配置到变量里</p> 
<pre><code class="language-sql"> -javaagent:/usr/local/org.jacoco.agent-0.8.5-runtime.jar=includes=*,output=tcpserver,port=18513,address=*,append=true</code></pre> 
<p> 服务的启动命令是</p> 
<pre><code class="language-sql">java $JAVA_OPTS -jar xxx.jar</code></pre> 
<p>这样，就拼接成了完整的运行命令：</p> 
<p>java -javaagent:/usr/local/org.jacoco.agent-0.8.5-runtime.jar=includes=*,output=tcpserver,port=18513,address=*,append=true -jar mock-server.jar</p> 
<p></p> 
<p><strong>运维同学要注意：</strong></p> 
<p>要放开18513 这个端口，如果要对该端口做代理的话：</p> 
<p>jacoco并非http/https，如果测试环境的k8s集群里面，访问形式为ingress+svc的形式，ingress配置域名，svc配置ClusterIP的模式。但是这个ingress只能代理http/https两种协议的请求。这种代理模式是不通的。需要把svc的ClusterIP改为了NodePort的模式，就可以直接通过公共节点+PORT进行访问了。</p> 
<p></p> 
<p></p> 
<h3 id="3.2%C2%A0%E9%83%A8%E7%BD%B2%E9%A1%B9%E7%9B%AE">3.2 部署项目</h3> 
<p>负责部署项目的同学 测试/研发，在自己公司的部署平台上，选择上面创建好的镜像，配置部署项目的命令。</p> 
<h3 id="3.3%20%E6%B5%8B%E8%AF%95%E5%90%8C%E5%AD%A6%E9%83%A8%E7%BD%B2Super-jacoco%E6%9C%8D%E5%8A%A1">3.3 测试同学部署Super-jacoco服务</h3> 
<h4 id="3.3.1%20%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%86%E5%A4%87%EF%BC%8C%E7%94%A8%E4%BA%8E%E5%AD%98%E5%82%A8%E6%8A%A5%E5%91%8A%E4%BF%A1%E6%81%AF%E7%AD%89%E3%80%82">3.3.1 、数据库准备，用于存储报告信息等。</h4> 
<p>安装MySQL。</p> 
<p>使用sql/coverage_report.sql 初始化MySQL信息</p> 
<h4 id="3.3.2%20%E9%85%8D%E7%BD%AESuper-jacoco%E6%9C%8D%E5%8A%A1application.properties%E4%BF%A1%E6%81%AF">3.3.2 配置Super-jacoco服务application.properties信息</h4> 
<p>在下载下来的项目中，application.properties配置信息</p> 
<p>src/main/resources/application.properties</p> 
<pre><code># 以下信息需要手动配置
spring.datasource.url=jdbc:mysql://127.0.0.1:3306/super-jacoco?useUnicode=true&amp;characterEncoding=UTF-8&amp;zeroDateTimeBehavior=convertToNull&amp;allowMultiQueries=true&amp;serverTimezone=Asia/Shanghai&amp;useSSL=false
spring.datasource.username=root
spring.datasource.password=123456
#git username &amp; password
gitlab.username=miaojiang
gitlab.password=mj123456</code></pre> 
<p>主要配置</p> 
<p>数据库的连接信息：url 账号 密码</p> 
<p>gitlab 的账号、密码</p> 
<p></p> 
<p><strong>注意：</strong></p> 
<p>数据库的驱动配置，5.x与8.x 版本的MySQL，驱动是不一致的，根据自己的数据库配置。</p> 
<p> 如果你的数据库为MySQL 8.x，需要修改项目中的驱动，具体修改方式在第二章有写，上面翻一番</p> 
<h4 id="%C2%A03.3.3%E3%80%81%E7%BC%96%E8%AF%91super%20jacoco%E9%A1%B9%E7%9B%AE"> 3.3.3、编译super jacoco项目</h4> 
<p>修改完super jacoco项目中的配置文件，就可以编译该项目了。生成super jacoco.jar</p> 
<h4 id="3.3.4%E3%80%81%E9%83%A8%E7%BD%B2%C2%A0super%20jacoco%20%E6%9C%8D%E5%8A%A1">3.3.4、部署 super jacoco 服务</h4> 
<p> 启动super-jacoco.jar 服务</p> 
<p>执行命令</p> 
<pre><code class="language-sql">nohup java -jar super-jacoco.jar &amp;</code></pre> 
<p>默认端口为8899</p> 
<p></p> 
<p>可以8899端口，程序是否启动成功</p> 
<pre><code class="language-sql">lsof -i:8899</code></pre> 
<p>注意：</p> 
<p>在部署 super jacoco 服务的机器上，一定要有以下环境：</p> 
<p>1、有mvn环境，如果没有的话，需要配置</p> 
<p>2、有git环境，并配置了能拉取被测项目的gitlab账号和密码。</p> 
<p>可以自己在这台机器上手动试一下，是否有权限</p> 
<pre><code class="language-sql">git clone xxx.xxx.git</code></pre> 
<p>3、启动super jacoco 服务的机器，一定要有访问被测服务器18513端口的权限。</p> 
<p>公司中对服务器权限、端口权限控制的比较严，可能需要走工单进行申请，这个需要注意。</p> 
<p></p> 
<h3 id="%C2%A03.4%E3%80%81%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87%E6%94%B6%E9%9B%86"> 3.4、代码覆盖率收集</h3> 
<p>假如：</p> 
<p>super jacoco 服务部署在了 123.123.123.123 这台服务上了</p> 
<p>被测项目mock-server 部署在了 456.456.456.456 机器上了</p> 
<h4 id="3.4.1%20%E5%90%AF%E5%8A%A8%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87%E6%94%B6%E9%9B%86">3.4.1 启动代码覆盖率收集</h4> 
<p>1)启动覆盖率收集URL：</p> 
<pre><code class="language-sql">http://123.123.123.123 /cov/triggerEnvCov</code></pre> 
<p><strong>调用方法：POST参数（body方式传入）：</strong></p> 
<pre><code class="language-sql">{
	"uuid": "uuid",
	"type": 1,
	"gitUrl": "git@git",
	"subModule": "",
	"baseVersion": "master",
	"nowVersion": "master"，
	"address": "456.456.456.456",
	"port": "18513"
}</code></pre> 
<p>备注：</p> 
<p>IP和port为被测服务所在服务器的IP和端口</p> 
<p>uuid： 自定义的一个id，将来拉取覆盖率时，通过这个uuid来拉取</p> 
<p>gitUrl： 被测项目的gitlab地址</p> 
<p></p> 
<p><strong>返回：</strong></p> 
<pre><code>{
	"code": 200,
	"data": true,
	"msg": "msg"
}</code></pre> 
<h4 id="3.4.2%C2%A0%E8%8E%B7%E5%8F%96%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87">3.4.2 获取代码覆盖率</h4> 
<p>覆盖率结果URL：</p> 
<pre><code class="language-sql">http://123.123.123.123/cov/getEnvCoverResult</code></pre> 
<p>调用方法：</p> 
<p>GET</p> 
<p>参数：</p> 
<p>uuid(String)</p> 
<p>返回：</p> 
<pre><code>{
	"code": 200,
	"data": {
		"coverStatus": 1,
		"errMsg": "msg",
		"lineCoverage": 100.0,
		"branchCoverage": 100.0,
		"logFile": "file content",
		"reportUrl": "http://"
	},
	"msg": "msg"
}</code></pre> 
<h2 id="%E5%9B%9B%E3%80%81%E6%8A%A5%E9%94%99%E5%A4%84%E7%90%86">四、报错处理</h2> 
<h3></h3> 
<h3 id="4.1%20%22errMsg%22%3A%20%22%E7%BB%9F%E8%AE%A1%E5%A4%B1%E8%B4%A5%3A%E7%BC%96%E8%AF%91%E4%BB%A3%E7%A0%81%E5%87%BA%E9%94%99%22">4.1 "errMsg": "统计失败:编译代码出错"</h3> 
<p><strong>背景：</strong></p> 
<p>拉取报告时 提示 ，统计失败:编译代码出错</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/bf/1b/1IhLz3US_o.png" width="1200"></p> 
<p><strong>原因：</strong></p> 
<p>查看启动super jacoco 服务的日志：</p> 
<pre><code>2023-10-12 17:01:14,642 INFO (CodeCloneExecutor.java:45)- uuid miaojiang开始下载代码...
2023-10-12 17:01:16,316 INFO (CodeCloneExecutor.java:52)- uuid miaojiang完成下载代码...
2023-10-12 17:01:16,322 DEBUG (BaseJdbcLogger.java:181)- ==&gt;  Preparing: UPDATE diff_coverage_report SET `request_status`=?, `err_msg`=?, `line_coverage`=?, `branch_coverage`=?, `report_url`=?, `diffmethod`=?, `log_file`=?, `now_local_path`=?, `update_time`=NOW() WHERE job_record_uuid=?
2023-10-12 17:01:16,323 DEBUG (BaseJdbcLogger.java:181)- ==&gt; Parameters: 102(Integer), (String), -1.0(Double), -1.0(Double), (String), (String), http://127.0.0.1:8899/logs/miaojiang.log(String), /Users/zhaohui/app/super_jacoco/clonecode/miaojiang/master(String), miaojiang(String)
2023-10-12 17:01:16,327 DEBUG (BaseJdbcLogger.java:181)- &lt;==    Updates: 1
2023-10-12 17:01:16,328 DEBUG (BaseJdbcLogger.java:181)- ==&gt;  Preparing: UPDATE diff_coverage_report SET `request_status`=?, `err_msg`=?, `line_coverage`=?, `branch_coverage`=?, `report_url`=?, `diffmethod`=?, `log_file`=?, `now_local_path`=?, `update_time`=NOW() WHERE job_record_uuid=?
2023-10-12 17:01:16,329 DEBUG (BaseJdbcLogger.java:181)- ==&gt; Parameters: 3(Integer), (String), -1.0(Double), -1.0(Double), (String), (String), http://127.0.0.1:8899/logs/miaojiang.log(String), /Users/zhaohui/app/super_jacoco/clonecode/miaojiang/master(String), miaojiang(String)
2023-10-12 17:01:16,331 DEBUG (BaseJdbcLogger.java:181)- &lt;==    Updates: 1
IP:127.0.0.1
2023-10-12 17:01:16,335 INFO (CmdExecutor.java:43)- CmdThreadPool:java.util.concurrent.ThreadPoolExecutor@4b5dade5[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0]
2023-10-12 17:01:16,335 INFO (CmdExecutor.java:48)- executeCmd : bash -c cd /Users/zhaohui/app/super_jacoco/clonecode/miaojiang/master&amp;&amp;mvn clean compile &gt;&gt;/Users/zhaohui/report/logs/miaojiang.log
2023-10-12 17:01:16,346 INFO (CmdExecutor.java:101)- bash: mvn: command not found
2023-10-12 17:01:16,347 INFO (CmdExecutor.java:56)- readLine.stop();
2023-10-12 17:01:16,347 INFO (CmdExecutor.java:58)- progressBar.stop();
2023-10-12 17:01:16,348 INFO (CmdExecutor.java:59)- executeCmd done !!!!!!
2023-10-12 17:01:16,348 INFO (CmdExecutor.java:60)- worker done !!!!!! times = 0s
2023-10-12 17:01:16,349 DEBUG (BaseJdbcLogger.java:181)- ==&gt;  Preparing: UPDATE diff_coverage_report SET `request_status`=?, `err_msg`=?, `line_coverage`=?, `branch_coverage`=?, `report_url`=?, `diffmethod`=?, `log_file`=?, `now_local_path`=?, `update_time`=NOW() WHERE job_record_uuid=?
2023-10-12 17:01:16,350 DEBUG (BaseJdbcLogger.java:181)- ==&gt; Parameters: 203(Integer), 编译代码出错(String), -1.0(Double), -1.0(Double), (String), (String), http://127.0.0.1:8899/logs/miaojiang.log(String), /Users/zhaohui/app/super_jacoco/clonecode/miaojiang/master(String), miaojiang(String)
2023-10-12 17:01:16,352 DEBUG (BaseJdbcLogger.java:181)- &lt;==    Updates: 1
2023-10-12 17:01:16,352 INFO (CodeCovServiceImpl.java:252)- Thread-4计算覆盖率具体步骤...编译失败uuid=miaojiang
2023-10-12 17:01:16,353 INFO (CodeCovServiceImpl.java:309)- Thread-4计算覆盖率具体步骤...编译失败uuid=miaojiang
2023-10-12 17:01:19,981 DEBUG (BaseJdbcLogger.java:181)- ==&gt;  Preparing: SELECT * from diff_coverage_report WHERE `request_status`=? AND `from`=? ORDER BY `update_time` asc limit ?
2023-10-12 17:01:19,987 DEBUG (BaseJdbcLogger.java:181)- ==&gt; Parameters: 0(Integer), 1(Integer), 1(Integer)</code></pre> 
<p><strong>根据日志信息，可以看出发生了以下事件：</strong></p> 
<p>17:01:14 - miaojiang开始下载代码。<br> 17:01:16 - miaojiang完成下载代码。<br> 17:01:16 - 执行数据库更新操作，更新了diff_coverage_report表的一行数据。<br> 17:01:16 - 执行数据库更新操作，再次更新了diff_coverage_report表的一行数据。<br> 17:01:16 - 从IP地址为127.0.0.1的主机上执行命令：cd /Users/zhaohui/app/super_jacoco/clonecode/miaojiang/master&amp;&amp;mvn clean compile &gt;&gt;/Users/zhaohui/report/logs/miaojiang.log，但是出现了错误：bash: mvn: command not found。<br> 17:01:16 - 终止读取日志和进度条。<br> 17:01:16 - 执行命令结束，执行时间为0秒。<br> 17:01:16 - 再次执行数据库更新操作，更新了diff_coverage_report表的一行数据，将request_status设为203，err_msg设为"编译代码出错"。<br> 17:01:16 - Thread-4处理计算覆盖率的具体步骤时发生编译失败，uuid为miaojiang。<br> 17:01:19 - 执行数据库查询操作，从diff_coverage_report表中选取request_status为0，from为1的记录，并按update_time升序排列，限制返回结果数量为1个。</p> 
<p></p> 
<p>注意：</p> 
<p><strong>bash: mvn: command not found。</strong></p> 
<p>说明 127.0.0.1 服务上，没有配置mvn环境</p> 
<p></p> 
<p><strong>解决办法：</strong></p> 
<p>在127.0.0.1 机器上，配置mvn环境</p> 
<p></p> 
<h3 id="4.2%20%E7%BC%96%E8%AF%91%E5%A4%B1%E8%B4%A5%20%EF%BC%88%E6%9D%83%E9%99%90%E7%9B%B8%E5%85%B3%EF%BC%89">4.2 编译失败 （权限相关）</h3> 
<p>编译失败，还有一种可能是权限问题，在执行 mvn clean compile 时，可能需要拉取一些公司的内部资源，如果没有权限的话，依然会编译失败</p> 
<p></p> 
<h3 id="4.3%C2%A0%E7%BC%96%E8%AF%91%E5%A4%B1%E8%B4%A5%20%EF%BC%88%E7%BD%91%E7%BB%9C%E6%85%A2%EF%BC%89">4.3 编译失败 （网络慢）</h3> 
<p>编译过程中，在官方仓库拉取mvn资源时（repo.maven.apache.org），网络原因，下载速度非常慢，导致编译失败。</p> 
<p>我们可以给mvn settings.xml 配置一个国内的镜像，加速一下。</p> 
<p>找到mvn地址</p> 
<pre><code>echo $M2_HOME</code></pre> 
<p>找到这个路径下的/conf/settings.xml 文件。</p> 
<p>在 Maven 的 settings.xml 文件中可以设置镜像站点，在 &lt;mirrors&gt; 标签中添加一个新的镜像即可。例如：</p> 
<pre><code>&lt;mirrors&gt;
  &lt;mirror&gt;
    &lt;id&gt;alimaven&lt;/id&gt;
    &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;
    &lt;mirrorOf&gt;*&lt;/mirrorOf&gt;
  &lt;/mirror&gt;
&lt;/mirrors&gt;
</code></pre> 
<h3 id="4.4%C2%A0%E7%BC%96%E8%AF%91%E5%A4%B1%E8%B4%A5%C2%A0">4.4 编译失败 </h3> 
<p><strong>报错：</strong></p> 
<p>2023-10-19 10:32:12,387 INFO (CmdExecutor.java:48)- executeCmd : bash -c cd /root/app/super_jacoco/clonecode/101901/master&amp;&amp;java -jar /root/org.jacoco.cli-1.0.2-SNAPSHOT-nodeps.jar dump --address 10.110.10.100 --port 18513 --destfile ./jacoco.exec 2023-10-19 10:32:12,393 INFO (CmdExecutor.java:101)- Error: Unable to access jarfile /root/org.jacoco.cli-1.0.2-SNAPSHOT-nodeps.jar</p> 
<p><strong>解决办法：</strong></p> 
<p>手动将super jacoco 项目中jacoco/org.jacoco.cli-1.0.2-SNAPSHOT-nodeps.jar 文件，复制到服务器的/root目录下</p> 
<p></p> 
<p></p> 
<p></p> 
<h2 id="%E4%BA%94%E3%80%81Super-jacoco%E5%8E%9F%E7%90%86">五、Super-jacoco原理</h2> 
<h3 id="5.1%20%E6%95%B4%E4%BD%93%E6%B5%81%E7%A8%8B">5.1 整体流程</h3> 
<p><img alt="" height="864" src="https://images2.imgbox.com/ae/7d/lgDKvWxf_o.png" width="1080"></p> 
<p>为了支持增量覆盖率收集，我们需要做两件事情：**1）**获取不同版本代码diff文件；**2）**对jacoco进行二次开发，使其支持增量方法列表参数。</p> 
<h3 id="5.2%C2%A0%E8%8E%B7%E5%8F%96%E5%A2%9E%E9%87%8F%E4%BB%A3%E7%A0%81">5.2 获取增量代码</h3> 
<p>主要流程：拉取master（参照分支）和feature(提测分支)代码，再通过JGit对两个分支源码进行比对，获取增量代码。以下为部分代码片段：</p> 
<p><img alt="" height="601" src="https://images2.imgbox.com/a3/05/Uu1KtADn_o.png" width="1000"></p> 
<h3 id="5.3.%20jacoco%20%E4%BA%8C%E6%AC%A1%E6%94%B9%E9%80%A0%EF%BC%8C%E6%94%AF%E6%8C%81%E5%A2%9E%E9%87%8F%E6%96%B9%E6%B3%95%E5%88%97%E8%A1%A8%E5%8F%82%E6%95%B0">5.3. jacoco 二次改造，支持增量方法列表参数</h3> 
<p>JaCoCo 对 exec 的解析主要是在 Analyzer 类的 analyzeClass(final byte[] source) 方法。这里面会调用 createAnalyzingVisitor 方法，生成一个用于解析的 ASM 类访问器，继续跟代码，发现对方法级别的探针计算逻辑是在 ClassProbesAdapter 类的 visitMethod 方法里面。所以我们只需要改造 visitMethod 方法，使它只对提取出的每个类的新增或变更方法做解析，非指定类和方法不做处理。改造后的核心代码片段如下：</p> 
<p><img alt="" height="770" src="https://images2.imgbox.com/8c/45/I2e8QMhA_o.png" width="1080"></p> 
<h3 id="5.4.%20%E6%89%A7%E8%A1%8C">5.4. 执行</h3> 
<p>只需要在执行的mvn命令中加入-Djacoco.diffFile=变更方法列表，即可收集变更方法的代码覆盖率。如果不传入-Djacoco.diffFile或者Djacoco.diffFile参数为空，则默认收集全量覆盖率。</p> 
<h3 id="5.5.%20%E6%8A%A5%E5%91%8A%E8%BE%93%E5%87%BA">5.5. 报告输出</h3> 
<p>覆盖率报告如下图，在图中是某个 service 的实现类，在最新的代码中有23个方法，但是只会对变更或新增的5个方法进行覆盖率统计与显示：</p> 
<h2 id="%E2%80%8B%E7%BC%96%E8%BE%91"><img alt="" height="225" src="https://images2.imgbox.com/5e/f9/8dGYecSw_o.png" width="1080"></h2> 
<h3 id="5.6%E3%80%81%E6%9E%B6%E6%9E%84">5.6、架构</h3> 
<p>底层架构</p> 
<p><img alt="" height="613" src="https://images2.imgbox.com/02/f4/AaJukIPq_o.png" width="531"></p> 
<h3></h3> 
<h2 id="%E5%85%AD%E3%80%81%E7%9B%B8%E5%85%B3%E8%B5%84%E6%96%99%EF%BC%9A">六、相关资料：</h2> 
<p> <a href="https://juejin.cn/post/6907552109915275277" rel="nofollow" title="滴滴开源Super-jacoco：java代码覆盖率收集平台 - 掘金">滴滴开源Super-jacoco：java代码覆盖率收集平台 - 掘金</a></p> 
<h2 id="%E4%B8%83%E3%80%81%E4%BB%A3%E7%A0%81%E8%A6%86%E7%9B%96%E7%8E%87%E6%94%B6%E9%9B%86%20%EF%BC%88%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E%EF%BC%89">七、代码覆盖率收集 （使用说明）</h2> 
<p>在super jacoco的基础上，进行了二次开发，集成到了测试平台。</p> 
<p>这里简单说一下使用方法：</p> 
<p><span style="color:#fe2c24;"><strong>数据是5分钟自动拉取一次，如果已经创建过任务，不需要再次创建任务。</strong></span></p> 
<p><span style="color:#be191c;"><strong>项目重启之前，创建一个任务。重启项目后，再创建新的任务：</strong></span></p> 
<p><span style="color:#be191c;"><strong>旧的任务会合并新的数据。新的任务并不会合并之前的报告。</strong></span></p> 
<h3 id="7.1%20%E6%AD%A3%E5%B8%B8%E5%9C%BA%E6%99%AF">7.1 正常场景</h3> 
<p>整体顺序是：</p> 
<p>1、先启动被测应用</p> 
<p>2、执行手工测试</p> 
<p>3、创建任务1（接口：/cov/triggerEnvCov）</p> 
<p>4、拉取报告（接口：/cov/getEnvCoverResult?uuid=任务1）</p> 
<p>5、执行的手工测试被成功收集</p> 
<p>注意：</p> 
<p>先执行手动测试，还是先创建任务，先后是没有顺序的，都可以的。</p> 
<h3 id="7.2%20%E8%A2%AB%E6%B5%8B%E9%A1%B9%E7%9B%AE%E9%87%8D%E5%90%AF%E7%9A%84%E5%9C%BA%E6%99%AF">7.2 被测项目重启的场景</h3> 
<p>1、项目启动</p> 
<p>2、创建任务001（接口：/cov/triggerEnvCov）</p> 
<p>3、执行手工测试（A模块）</p> 
<p>4、重启被测项目</p> 
<p>5、创建任务002</p> 
<p>6、执行手工测试（B模块）</p> 
<p>查看数据（最好等5分钟之后，因为数据5分钟自动拉取一次）</p> 
<p>任务001：包含A模块与B模块的数据</p> 
<p>任务002：只包含B模块的数据</p> 
<p></p> 
<h3 id="7.3%C2%A0%E8%A2%AB%E6%B5%8B%E9%A1%B9%E7%9B%AE%EF%BC%88%E6%96%B0%E5%A2%9E%E4%BA%86%E4%BB%A3%E7%A0%81%EF%BC%89%E9%87%8D%E5%90%AF%E7%9A%84%E5%9C%BA%E6%99%AF">7.3 被测项目（新增了代码）重启的场景</h3> 
<p>1、项目启动</p> 
<p>2、创建任务001（接口：/cov/triggerEnvCov）</p> 
<p>3、执行手工测试（A模块）</p> 
<p>4、重启被测项目，并新增了C模块的代码</p> 
<p>5、创建任务002</p> 
<p>6、执行手工测试（B模块与C模块的数据）</p> 
<p>查看数据（最好等5分钟之后，因为数据5分钟自动拉取一次）</p> 
<p>任务001：包含A模块与B模块的数据</p> 
<p>任务002：包含B模块与C模块的数据</p> 
<p></p> 
<h3>7.4 增量代码覆盖</h3> 
<p>研发在master上拉了一个dev分支。在dev分支上开发了一些新的功能。</p> 
<p>我只想要统计dev分支上新增的代码覆盖率，而不是dev分支所有的代码覆盖率。</p> 
<p>创建任务：</p> 
<pre><code class="hljs">{
	"uuid": "test_new_develop",
	"type": 2,
	"gitUrl": "http://xxxx.git",
	"subModule": "",
	"baseVersion": "master",
	"nowVersion": "develop",
	"address": "127.0.0.1",
	"port": "18513"
}</code></pre> 
<p>type:2 代表统计增量代码覆盖率</p> 
<p>baseVersion：master  最原始的分支，用来被比较的</p> 
<p>"nowVersion": "develop" 研发新增代码的分支</p> 
<p></p> 
<p></p> 
<h2 id="%E5%85%AB%E3%80%81%E6%8A%A5%E5%91%8A%E8%A7%A3%E8%AF%BB%EF%BC%9A">八、报告解读：</h2> 
<p><strong>条件覆盖</strong></p> 
<p>红钻：表示未覆盖</p> 
<p>黄钻：表示部分覆盖</p> 
<p>绿钻：表示全部覆盖</p> 
<p>注：条件覆盖都是用钻表示。</p> 
<p><strong>Lines覆盖</strong></p> 
<p>红色背景：无覆盖，该行的所有指令均无执行。</p> 
<p>背景：部分覆盖，该行部分指令被执行。</p> 
<p>绿色背景：全覆盖，该行所有指令被执行。</p> 
<p></p> 
<h2 id="%E4%B9%9D%E3%80%81%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%EF%BC%9A">九、注意事项：</h2> 
<p>9.1 被测项目启动命令：</p> 
<pre><code class="language-bash">nohup java -javaagent:/usr/web/cs_super_jacoco/org.jacoco.agent-0.8.5-runtime.jar=includes=*,output=tcpserver,port=18513,address=,append=true -jar com_ky.jar &gt; /dev/null 2&gt;&amp;1 &amp;
</code></pre> 
<p>注意：</p> 
<div></div> 
<div> 
 <p style="margin-left:0;text-align:left;"><span style="color:#000000;">includes</span><span style="color:#9a6e3a;">=</span><span style="color:#000000;">* ，这里一定要使用星号哦，不要忘了</span></p> 
</div> 
<h3></h3> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f23cbab00d9d061e23266f4208a6189c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">企业应用集成的9大业务优势</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b2ea867e66ff1d61904a286d732d4933/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Flutter 开发、测试，网络调试工具</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>