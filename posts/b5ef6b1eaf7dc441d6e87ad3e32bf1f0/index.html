<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>php中防止SQL注入的最佳解决方法 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="php中防止SQL注入的最佳解决方法" />
<meta property="og:description" content="本篇文章介绍了，php中防止SQL注入的最佳解决方法。需要的朋友参考下
如果用户输入的是直接插入到一个SQL语句中的查询，应用程序会很容易受到SQL注入，例如下面的例子:
复制代码代码如下: $unsafe_variable = $_POST[&#39;user_input&#39;]; mysql_query(&#34;INSERT INTO table (column) VALUES (&#39;&#34; . $unsafe_variable . &#34;&#39;)&#34;); 这是因为用户可以输入类似VALUE&#34;); DROP TABLE表; - ，使查询变成：
复制代码代码如下: INSERT INTO table (column) VALUES(&#39;VALUE&#39;); DROP TABLE table;&#39; 我们应该怎么防止这种情况呢?下面我们来看看Theo的回答 使用预备义语句和参数化查询。对于带有任何参数的sql语句都会被发送到数据库服务器，并被解析！对于攻击者想要恶意注入sql是不可能的！
实现这一目标基本上有两种选择：
1.使用PDO(PHP Data Objects )
复制代码代码如下: $stmt = $pdo-&gt;prepare(&#39;SELECT * FROM employees WHERE name = :name&#39;); $stmt-&gt;execute(array(&#39;:name&#39; =&gt; $name));
foreach ($stmt as $row) {
// do something with $row
}
2.使用mysqli
复制代码代码如下: $stmt = $dbConnection-&gt;prepare(&#39;SELECT * FROM employees WHERE name = ?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b5ef6b1eaf7dc441d6e87ad3e32bf1f0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-01-14T17:25:01+08:00" />
<meta property="article:modified_time" content="2015-01-14T17:25:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">php中防止SQL注入的最佳解决方法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <table class="content " width="100%" cellspacing="0" cellpadding="0" align="center" style="width:683px; color:rgb(51,51,51); font-family:宋体; font-size:12px; line-height:20px; table-layout:fixed; word-wrap:break-word"><tbody><tr><td align="center" style="margin:0px; padding:0px; vertical-align:top">  </td></tr><tr><td align="left" class="content_word" id="read_tpc" style="margin:0px; padding:0px; font-size:14px; vertical-align:top; line-height:23px"> <span id="zoom" style="font-family:宋体"></span> 
    <div style="float:left"></div> <span style="color:rgb(0,0,0); background-color:rgb(247,252,255); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif">本篇文章介绍了，php中防止SQL注入的最佳解决方法。需要的朋友参考下</span><br> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(0,0,0); background-color:rgb(247,252,255); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif"> 如果用户输入的是直接插入到一个SQL语句中的查询，应用程序会很容易受到SQL注入，例如下面的例子:<br> </p> 
    <div class="codetitle" style="margin:3px auto 0px; padding:0px 3px; color:rgb(0,0,0); background-color:rgb(242,246,251); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif"> 
     <a target="_blank" style="outline:none; color:rgb(51,51,51)"><u>复制代码</u></a>代码如下: 
    </div> 
    <div class="codebody" style="border:1px solid rgb(0,153,204); margin:0px auto 3px; padding:0px 3px 0px 5px; color:rgb(0,0,0); background-color:rgb(221,237,251); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif"> 
     <br> $unsafe_variable = $_POST['user_input']; 
     <br> mysql_query("INSERT INTO table (column) VALUES ('" . $unsafe_variable . "')"); 
     <br> 
    </div> <br> <span style="color:rgb(0,0,0); background-color:rgb(247,252,255); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif">这是因为用户可以输入类似VALUE"); DROP TABLE表; - ，使查询变成：</span><br> 
    <div class="codetitle" style="margin:3px auto 0px; padding:0px 3px; color:rgb(0,0,0); background-color:rgb(242,246,251); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif"> 
     <a target="_blank" style="outline:none; color:rgb(51,51,51)"><u>复制代码</u></a>代码如下: 
    </div> 
    <div class="codebody" style="border:1px solid rgb(0,153,204); margin:0px auto 3px; padding:0px 3px 0px 5px; color:rgb(0,0,0); background-color:rgb(221,237,251); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif"> 
     <br> INSERT INTO table (column) VALUES('VALUE'); DROP TABLE table;' 
     <br> 
    </div> <br> <br> <span style="color:rgb(0,0,0); background-color:rgb(247,252,255); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif">我们应该怎么防止这种情况呢?下面我们来看看Theo的回答</span> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(0,0,0); background-color:rgb(247,252,255); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif">  </p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(0,0,0); background-color:rgb(247,252,255); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif"> 使用预备义语句和参数化查询。对于带有任何参数的sql语句都会被发送到数据库服务器，并被解析！对于攻击者想要恶意注入sql是不可能的！</p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(0,0,0); background-color:rgb(247,252,255); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif"> 实现这一目标基本上有两种选择：</p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(0,0,0); background-color:rgb(247,252,255); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif"> <strong>1.使用PDO(PHP Data Objects )<br> </strong></p> 
    <div class="codetitle" style="margin:3px auto 0px; padding:0px 3px; color:rgb(0,0,0); background-color:rgb(242,246,251); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif"> 
     <a target="_blank" style="outline:none; color:rgb(51,51,51)"><u>复制代码</u></a>代码如下: 
    </div> 
    <div class="codebody" style="border:1px solid rgb(0,153,204); margin:0px auto 3px; padding:0px 3px 0px 5px; color:rgb(0,0,0); background-color:rgb(221,237,251); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif"> 
     <br> $stmt = $pdo-&gt;prepare('SELECT * FROM employees WHERE name = :name'); 
     <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">  </p> 
     <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> $stmt-&gt;execute(array(':name' =&gt; $name));</p> 
     <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> foreach ($stmt as $row) {<!-- --><br>     // do something with $row<br> }<br> </p> 
    </div> <br> <br> <strong>2.使用mysqli<br> </strong> 
    <div class="codetitle" style="margin:3px auto 0px; padding:0px 3px; color:rgb(0,0,0); background-color:rgb(242,246,251); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif"> 
     <a target="_blank" style="outline:none; color:rgb(51,51,51)"><u>复制代码</u></a>代码如下: 
    </div> 
    <div class="codebody" style="border:1px solid rgb(0,153,204); margin:0px auto 3px; padding:0px 3px 0px 5px; color:rgb(0,0,0); background-color:rgb(221,237,251); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif"> 
     <br> $stmt = $dbConnection-&gt;prepare('SELECT * FROM employees WHERE name = ?'); 
     <br> $stmt-&gt;bind_param('s', $name); 
     <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">  </p> 
     <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> $stmt-&gt;execute();</p> 
     <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> $result = $stmt-&gt;get_result();<br> while ($row = $result-&gt;fetch_assoc()) {<!-- --><br>     // do something with $row<br> }<br> </p> 
    </div> <br> <br> <strong>PDO(PHP数据对象)</strong> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(0,0,0); background-color:rgb(247,252,255); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif">  </p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(0,0,0); background-color:rgb(247,252,255); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif"> 注意当使用PDO访问MySQL数据库真正的预备义语句并不是默认使用的！为了解决这个问题，你必须禁用仿真准备好的语句。使用PDO创建连接的例子如下：<br> </p> 
    <div class="codetitle" style="margin:3px auto 0px; padding:0px 3px; color:rgb(0,0,0); background-color:rgb(242,246,251); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif"> 
     <a target="_blank" style="outline:none; color:rgb(51,51,51)"><u>复制代码</u></a>代码如下: 
    </div> 
    <div class="codebody" style="border:1px solid rgb(0,153,204); margin:0px auto 3px; padding:0px 3px 0px 5px; color:rgb(0,0,0); background-color:rgb(221,237,251); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif"> 
     <br> $dbConnection = new PDO('mysql:dbname=dbtest;host=127.0.0.1;charset=utf8', 'user', 'pass'); 
     <br> $dbConnection-&gt;setAttribute(PDO::ATTR_EMULATE_PREPARES, false); 
     <br> $dbConnection-&gt;setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION); 
     <br> 
    </div> <br> <span style="color:rgb(0,0,0); background-color:rgb(247,252,255); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif">在上面例子中错误模式ERRMODE不是严格必须的，但是建议添加它。当运行出错产生致命错误时，这种方法脚本不会停止。并给开发人员捕捉任何错误的机会（当抛出PDOException异常时）。</span> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(0,0,0); background-color:rgb(247,252,255); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif">  </p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(0,0,0); background-color:rgb(247,252,255); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif"> setAttribute()那一行是强制性的，它告诉PDO禁用仿真预备义语句，使用真正的预备义语句。这可以确保语句和值在发送给MySQL数据库服务器前不被PHP解析(攻击者没有机会注入恶意的SQL).</p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(0,0,0); background-color:rgb(247,252,255); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif"> 当然你可以在构造函数选项中设置字符集参数，特别注意'老'的PHP版本（5.3.6）会在DSN中忽略掉字符集参数。</p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(0,0,0); background-color:rgb(247,252,255); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif"> <strong>Explanation(解释)<br> <br> </strong>在你传递的sql预备义语句 被数据库服务器解析和编译会发生什么？通过指定的字符(在上面例子中像a?或者像:name)告诉数据库引擎你想要过滤什么.然后调用execute执行结合好的预备义语句和你指定的参数值.</p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(0,0,0); background-color:rgb(247,252,255); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif"> 这里最重要的是，该参数值是和预编译的语句结合的，而不是和一个SQL字符串.SQL注入的工作原理是通过欺骗手段创建的SQL脚本包括恶意字符串发送到数据库.因此，通过发送实际的分开的sql参数,你会降低风险.使用准备好的语句时，你发送的任何参数，将只被视为字符串（虽然数据库引擎可能会做一些参数的优化，当然最终可能会为数字）.在上面的例子中，如果变量$name包含'sarah';DELETE * FROM employees,结果只会是一个搜索的字符串"'sarah';DELETE * FROM employees",你不会得到一个空表。</p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(0,0,0); background-color:rgb(247,252,255); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif"> 使用准备好的语句的另一个好处是，如果你在同一会话中多次执行相同的语句，这将只被解析和编译一次，给你一些的速度增长。<br> 哦，既然你问如何进行插入，这里是一个例子（使用PDO）：<br> </p> 
    <div class="codetitle" style="margin:3px auto 0px; padding:0px 3px; color:rgb(0,0,0); background-color:rgb(242,246,251); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif"> 
     <a target="_blank" style="outline:none; color:rgb(51,51,51)"><u>复制代码</u></a>代码如下: 
    </div> 
    <div class="codebody" style="border:1px solid rgb(0,153,204); margin:0px auto 3px; padding:0px 3px 0px 5px; color:rgb(0,0,0); background-color:rgb(221,237,251); font-family:Tahoma,Helvetica,Arial,宋体,sans-serif"> 
     <br> $preparedStatement = $db-&gt;prepare('INSERT INTO table (column) VALUES (:column)'); 
     <br> $preparedStatement-&gt;execute(array(':column' =&gt; $unsafeva lue)); 
     <br> 
    </div> 
    <div> 
     <br> 
    </div> </td></tr></tbody></table>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/29d812e5d8af2246e7135c9d27b35695/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">网易云课堂程序设计入门—Java语言（第五周）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c019b65e0b003fc33c47adf5179f658f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Mysql Fabric HA配置测试</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>