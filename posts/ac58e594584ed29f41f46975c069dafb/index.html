<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vba之与excel司龄计算 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vba之与excel司龄计算" />
<meta property="og:description" content="一、其实很简单：
1、计算工龄
&#34;M2&#34;为单元格的工龄日期。
=CEILING(DATEDIF(M2,NOW(),&#34;M&#34;)/12,0.5)
2、工龄分段公式
=LOOKUP(L156,{0,5,10,15,20,25;&#34;5年以下&#34;,&#34;5~10年&#34;,&#34;10~15年&#34;,&#34;15年~20年&#34;,&#34;20~25年&#34;,&#34;25年以上&#34;})
二、适用VBA实现
Sub 插入新列并计算司龄() Dim ws As Worksheet Dim lastRow As Long Dim i As Long Dim entryDate As Date Dim yearsOfService As Double &#39; 指定要操作的工作表 Set ws = ThisWorkbook.Sheets(&#34;测试&#34;) &#39;！！！！！！！！必须为此表名 If IsError(Application.Match(&#34;司龄&#34;, ws.Rows(1), 0)) Then &#39; 在最后一列右侧插入两个新列 ws.Cells(1, ws.Cells(1, ws.Columns.Count).End(xlToLeft).Column &#43; 1).Value = &#34;司龄&#34; ws.Cells(1, ws.Cells(1, ws.Columns.Count).End(xlToLeft).Column &#43; 1).Value = &#34;司龄分段&#34; End If Dim sllb As Variant Dim slfd As Variant Dim sl_start As Variant sllb = Application." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ac58e594584ed29f41f46975c069dafb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-03T18:42:32+08:00" />
<meta property="article:modified_time" content="2024-01-03T18:42:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vba之与excel司龄计算</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>一、其实很简单：</p> 
<p>1、计算工龄</p> 
<p>"M2"为单元格的工龄日期。</p> 
<p>=CEILING(DATEDIF(M2,NOW(),"M")/12,0.5)</p> 
<p>2、工龄分段公式</p> 
<p>=LOOKUP(L156,{0,5,10,15,20,25;"5年以下","5~10年","10~15年","15年~20年","20~25年","25年以上"})</p> 
<p>二、适用VBA实现</p> 
<pre><code class="language-vbscript">Sub 插入新列并计算司龄()
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim i As Long
    Dim entryDate As Date
    Dim yearsOfService As Double
    
    ' 指定要操作的工作表
    Set ws = ThisWorkbook.Sheets("测试") '！！！！！！！！必须为此表名
    If IsError(Application.Match("司龄", ws.Rows(1), 0)) Then
    
    ' 在最后一列右侧插入两个新列
    ws.Cells(1, ws.Cells(1, ws.Columns.Count).End(xlToLeft).Column + 1).Value = "司龄"
    ws.Cells(1, ws.Cells(1, ws.Columns.Count).End(xlToLeft).Column + 1).Value = "司龄分段"

    End If
    Dim sllb As Variant
    Dim slfd As Variant
    Dim sl_start As Variant
    sllb = Application.Match("司龄", ws.Rows(1), 0)
    slfd = Application.Match("司龄分段", ws.Rows(1), 0)
    sl_start = Application.Match("进入集团日期", ws.Rows(1), 0) ' 进入集团日期所在的列，查找
    
    ws.Columns(sllb).Select
    With Selection
    .HorizontalAlignment = Excel.xlCenter
    .Font.Name = "宋体"
   End With
   
    ws.Columns(slfd).Select
    With Selection
    .VerticalAlignment = Excel.xlCenter
    .Font.Name = "宋体"
   End With

    
    
    
    ' 获取最后一行
    lastRow = ws.Cells(ws.Rows.Count, sl_start).End(xlUp).Row
    'ws.Cells(3, 6) = lastRow
    
    ' 计算司龄并写入新列
    For i = 2 To lastRow
        entryDate = ws.Cells(i, sl_start).Value  ' 进入集团日期所在的列，这里假设是第1列
        yearsOfService = Round(((Date - entryDate) / 365.25), 1)  ' 计算司龄，保留1位小数
        
        If yearsOfService - Int(yearsOfService) &lt; 0.5 Then
            yearsOfService = Int(yearsOfService) + 0.5 ' 小数位小于0.5则按0.5年
        Else
            yearsOfService = Int(yearsOfService) + 1  ' 小数位大于0.5则按1年
        End If
        'ws.Cells(2, 5) = sllb
        'ws.Cells(i, sllb).Font.Name = "宋体"

        ws.Cells(i, sllb).Value = yearsOfService   ' 写入司龄列
        
        ' 计算司龄分段并写入新列
        'ws.Cells(i, slfd).Font.Name = "宋体"
        If yearsOfService &lt; 5 Then
            ws.Cells(i, slfd).Value = "&lt;5年"
        ElseIf yearsOfService &lt; 10 Then
            ws.Cells(i, slfd).Value = "5~10年"
        ElseIf yearsOfService &lt; 15 Then
            ws.Cells(i, slfd).Value = "10~15年"
        ElseIf yearsOfService &lt; 20 Then
            ws.Cells(i, slfd).Value = "15~20年"
        Else
            ws.Cells(i, slfd).Value = "&gt;20年"
        End If
    Next i
    
End Sub

</code></pre> 
<p>这段VBA代码实现了在指定工作表中插入两列，并计算员工的司龄并写入新插入的列中。具体实现步骤如下：</p> 
<ol><li>首先指定要操作的工作表为"测试"。</li><li>判断是否已存在"司龄"和"司龄分段"列，若不存在，则在最后一列的右侧插入这两个新列。</li><li>获取进入集团日期所在的列，并将司龄和司龄分段列的文字格式设置为居中和宋体。</li><li>获取最后一行的行号。</li><li>对每一行进行循环，获取进入集团日期的数值，并根据当前日期计算司龄，保留小数点后一位。</li><li>根据司龄的值判断司龄分段，并将计算结果写入司龄和司龄分段列中。</li></ol> 
<p>总体来说，这段代码实现了在指定工作表中添加司龄和司龄分段两列，并根据员工的进入集团日期计算其司龄并分类。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a5320d6301a4b86a71712bc69a60db7b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">关于系统设计的一些思考</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a10300328e25022eae7976bb35df7eec/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JavaSE学习笔记 2023-12-26 --枚举和注释</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>