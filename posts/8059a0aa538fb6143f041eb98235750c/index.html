<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>《快学Scala》- 练习题 第十章 特质 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="《快学Scala》- 练习题 第十章 特质" />
<meta property="og:description" content="问题一：定义特质，与类java.awt.geom.Ellipse2D混入问题二：定义特质scala.math.Ordered[Point]问题三：查看BitSet类的线性化规格说明问题四：定义特质scala.math.Ordered[Point]问题五： Java Beans 规范属性变更监听器(property change listener)问题六：Java AWT类库中，Container类问题七：设计Scala特质问题八：设计特质完成java.io.BufferedInputStream修饰器的作用问题九：使用本章的日志生成器特质，给前一个练习中的方案添加日志功能，要求体现出缓冲的效果。问题十：实现一个IterableInputStream类，扩展java.io.InputStream并混入Iterable[Byte]特质 问题一：定义特质，与类java.awt.geom.Ellipse2D混入 // 问题一： // java.awt.Rectangle类有2个很有用的方法translate和grow, // 但可惜的是像java.awt.geom.Ellipse2D这样的类中没有, // 在scala中, 你可以解决掉这个问题, 定义一个RectangleLike的特质, 假如具体的translate和grow方法, // 提供任何你需要用来实现的抽象方法, 以便你可以像如下代码这样混入该特质 val egg = new java.awt.geom.Ellipse2D.Double(5, 10, 20, 30 ) with RectangleLike egg.translate(10, -10) egg.grow(10, 20) trait RectangleLike{ //自身类型，表明该特质只能混入java.awt.geom.Ellipse2D.Double的子类 this : java.awt.geom.Ellipse2D.Double =&gt; translate(x: Double, y: Double){ ... // } grow(x: Double, y: Double){ ... } } 问题二：定义特质scala.math.Ordered[Point] import java.awt.Point /* * 问题二： * 通过把scala.math.Ordered[Point]混入java.awt.Point的方式, 定义OrderedPoint类, * 按辞典方式排序, 也就是说, 如果x &lt; x&#39; 或者x = x&#39;且 y &lt; y&#39; 则 (x,y) &lt; (x&#39;, y&#39;)则(x,y) &lt; (x&#39;,y&#39;)。 */ class OrderedPoint extends java." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/8059a0aa538fb6143f041eb98235750c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-08-02T17:41:36+08:00" />
<meta property="article:modified_time" content="2018-08-02T17:41:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">《快学Scala》- 练习题 第十章 特质</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <ul><li> 
   <ul><li> 
     <ul><li><a href="#%E9%97%AE%E9%A2%98%E4%B8%80%E5%AE%9A%E4%B9%89%E7%89%B9%E8%B4%A8%E4%B8%8E%E7%B1%BBjavaawtgeomellipse2d%E6%B7%B7%E5%85%A5" rel="nofollow">问题一：定义特质，与类java.awt.geom.Ellipse2D混入</a></li><li><a href="#%E9%97%AE%E9%A2%98%E4%BA%8C%E5%AE%9A%E4%B9%89%E7%89%B9%E8%B4%A8scalamathorderedpoint" rel="nofollow">问题二：定义特质scala.math.Ordered[Point]</a></li><li><a href="#%E9%97%AE%E9%A2%98%E4%B8%89%E6%9F%A5%E7%9C%8Bbitset%E7%B1%BB%E7%9A%84%E7%BA%BF%E6%80%A7%E5%8C%96%E8%A7%84%E6%A0%BC%E8%AF%B4%E6%98%8E" rel="nofollow">问题三：查看BitSet类的线性化规格说明</a></li><li><a href="#%E9%97%AE%E9%A2%98%E5%9B%9B%E5%AE%9A%E4%B9%89%E7%89%B9%E8%B4%A8scalamathorderedpoint" rel="nofollow">问题四：定义特质scala.math.Ordered[Point]</a></li><li><a href="#%E9%97%AE%E9%A2%98%E4%BA%94-java-beans-%E8%A7%84%E8%8C%83%E5%B1%9E%E6%80%A7%E5%8F%98%E6%9B%B4%E7%9B%91%E5%90%AC%E5%99%A8property-change-listener" rel="nofollow">问题五： Java Beans 规范属性变更监听器(property change listener)</a></li><li><a href="#%E9%97%AE%E9%A2%98%E5%85%ADjava-awt%E7%B1%BB%E5%BA%93%E4%B8%ADcontainer%E7%B1%BB" rel="nofollow">问题六：Java AWT类库中，Container类</a></li><li><a href="#%E9%97%AE%E9%A2%98%E4%B8%83%E8%AE%BE%E8%AE%A1scala%E7%89%B9%E8%B4%A8" rel="nofollow">问题七：设计Scala特质</a></li><li><a href="#%E9%97%AE%E9%A2%98%E5%85%AB%E8%AE%BE%E8%AE%A1%E7%89%B9%E8%B4%A8%E5%AE%8C%E6%88%90javaiobufferedinputstream%E4%BF%AE%E9%A5%B0%E5%99%A8%E7%9A%84%E4%BD%9C%E7%94%A8" rel="nofollow">问题八：设计特质完成java.io.BufferedInputStream修饰器的作用</a></li><li><a href="#%E9%97%AE%E9%A2%98%E4%B9%9D%E4%BD%BF%E7%94%A8%E6%9C%AC%E7%AB%A0%E7%9A%84%E6%97%A5%E5%BF%97%E7%94%9F%E6%88%90%E5%99%A8%E7%89%B9%E8%B4%A8%E7%BB%99%E5%89%8D%E4%B8%80%E4%B8%AA%E7%BB%83%E4%B9%A0%E4%B8%AD%E7%9A%84%E6%96%B9%E6%A1%88%E6%B7%BB%E5%8A%A0%E6%97%A5%E5%BF%97%E5%8A%9F%E8%83%BD%E8%A6%81%E6%B1%82%E4%BD%93%E7%8E%B0%E5%87%BA%E7%BC%93%E5%86%B2%E7%9A%84%E6%95%88%E6%9E%9C" rel="nofollow">问题九：使用本章的日志生成器特质，给前一个练习中的方案添加日志功能，要求体现出缓冲的效果。</a></li><li><a href="#%E9%97%AE%E9%A2%98%E5%8D%81%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AAiterableinputstream%E7%B1%BB%E6%89%A9%E5%B1%95javaioinputstream%E5%B9%B6%E6%B7%B7%E5%85%A5iterablebyte%E7%89%B9%E8%B4%A8" rel="nofollow">问题十：实现一个IterableInputStream类，扩展java.io.InputStream并混入Iterable[Byte]特质</a></li></ul> </li></ul> </li></ul> 
</div> 
<p></p> 
<h4 id="问题一定义特质与类javaawtgeomellipse2d混入">问题一：定义特质，与类java.awt.geom.Ellipse2D混入</h4> 
<pre class="prettyprint"><code class=" hljs cs"><span class="hljs-comment">// 问题一：</span>
<span class="hljs-comment">// java.awt.Rectangle类有2个很有用的方法translate和grow, </span>
<span class="hljs-comment">// 但可惜的是像java.awt.geom.Ellipse2D这样的类中没有,</span>
<span class="hljs-comment">// 在scala中, 你可以解决掉这个问题, 定义一个RectangleLike的特质, 假如具体的translate和grow方法, </span>
<span class="hljs-comment">// 提供任何你需要用来实现的抽象方法, 以便你可以像如下代码这样混入该特质</span></code></pre> 
<hr> 
<pre class="prettyprint"><code class=" hljs r">val egg = new java.awt.geom.Ellipse2D.Double(<span class="hljs-number">5</span>, <span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span> ) with RectangleLike
egg.translate(<span class="hljs-number">10</span>, -<span class="hljs-number">10</span>)
egg.grow(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>)

trait RectangleLike{
   //自身类型，表明该特质只能混入java.awt.geom.Ellipse2D.Double的子类
    this :  java.awt.geom.Ellipse2D.Double =&gt;   
    translate(x: Double, y: Double){
        <span class="hljs-keyword">...</span>   //
    }

    grow(x: Double, y: Double){
        <span class="hljs-keyword">...</span>
    }
}</code></pre> 
<h4 id="问题二定义特质scalamathorderedpoint">问题二：定义特质scala.math.Ordered[Point]</h4> 
<pre class="prettyprint"><code class=" hljs scala"><span class="hljs-keyword">import</span> java.awt.Point

<span class="hljs-comment">/*
 * 问题二：
 * 通过把scala.math.Ordered[Point]混入java.awt.Point的方式, 定义OrderedPoint类,
 * 按辞典方式排序, 也就是说, 如果x &lt; x' 或者x = x'且 y &lt; y' 则 (x,y) &lt; (x', y')则(x,y) &lt; (x',y')。
 */</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">OrderedPoint</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">java</span>.<span class="hljs-title">awt</span>.<span class="hljs-title">Point</span> <span class="hljs-keyword">with</span> <span class="hljs-title">scala</span>.<span class="hljs-title">math</span>.<span class="hljs-title">Ordered</span>[<span class="hljs-title">Point</span>] {<!-- --></span>
  <span class="hljs-keyword">override</span> <span class="hljs-keyword">def</span> compare(that: Point): Int = {
    <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">this</span>.x &lt; that.x) || (<span class="hljs-keyword">this</span>.x == that.x &amp;&amp; <span class="hljs-keyword">this</span>.y &lt; that.y)) -<span class="hljs-number">1</span>
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.x == that.x &amp;&amp; <span class="hljs-keyword">this</span>.y == that.y) <span class="hljs-number">0</span>
    <span class="hljs-keyword">else</span> <span class="hljs-number">1</span>
  }
}</code></pre> 
<h4 id="问题三查看bitset类的线性化规格说明">问题三：查看BitSet类的线性化规格说明</h4> 
<pre class="prettyprint"><code class=" hljs cs">  <span class="hljs-comment">/*
   * 10.3
   * 查看BitSet类,将它的所有超类和特质绘制成一张图, 忽略类型参数, 然后给出该特质的线性化规格说明
   * 略，等待补充
   */</span></code></pre> 
<h4 id="问题四定义特质scalamathorderedpoint">问题四：定义特质scala.math.Ordered[Point]</h4> 
<pre class="prettyprint"><code class=" hljs scala">  <span class="hljs-comment">/*
   * 10.4
   * 提供一个CryptoLogger类, 将日志消息以凯撒密码加密, 缺省情况下密钥为3, 不过使用者也可以重写它, 提供缺省密钥和-3作为密钥时的使用示例
   */</span>
<span class="hljs-keyword">package</span> example.traits.exercise

<span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Logger</span> {<!-- --></span>
  <span class="hljs-keyword">val</span> key = <span class="hljs-number">3</span>

  <span class="hljs-keyword">def</span> log(message: String): String
}

<span class="hljs-comment">// 凯撒密码加密</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CryptoLogger</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Logger</span> {<!-- --></span>
  <span class="hljs-keyword">override</span> <span class="hljs-keyword">def</span> log(message: String): String = {
    <span class="hljs-keyword">for</span>( ch &lt;- message) <span class="hljs-keyword">yield</span> <span class="hljs-keyword">if</span>(key &gt;= <span class="hljs-number">0</span>) (<span class="hljs-number">97</span> + (ch - <span class="hljs-number">97</span> + key) % <span class="hljs-number">26</span>).toChar <span class="hljs-keyword">else</span> (<span class="hljs-number">97</span> + (ch - <span class="hljs-number">97</span> + key + <span class="hljs-number">26</span> ) % <span class="hljs-number">26</span>).toChar
  }
}


<span class="hljs-comment">//Test</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TraitTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">FunSuite</span> <span class="hljs-keyword">with</span> <span class="hljs-title">BeforeAndAfter</span> {<!-- --></span>

  before {
    println(<span class="hljs-string">"---------"</span>)
  }
  test(<span class="hljs-string">"Trait-Exercise-CryptoLogger"</span>) {
    <span class="hljs-keyword">var</span> logger = <span class="hljs-keyword">new</span> CryptoLogger
    <span class="hljs-keyword">var</span> result = logger.log(<span class="hljs-string">"abc"</span>)
    println(result)
    assert(result === <span class="hljs-string">"def"</span>)

    logger = <span class="hljs-keyword">new</span> CryptoLogger {
      <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> key: Int = -<span class="hljs-number">3</span>
    }
    result = logger.log(<span class="hljs-string">"abc"</span>)
    println(result)
    assert(result === <span class="hljs-string">"xyz"</span>)
  }
}

</code></pre> 
<h4 id="问题五-java-beans-规范属性变更监听器property-change-listener">问题五： Java Beans 规范属性变更监听器(property change listener)</h4> 
<pre class="prettyprint"><code class=" hljs cs"><span class="hljs-comment">/*  问题五：
   * JavaBeans规范里有一种提法叫做属性变更监听器(property change listener),
   * 这是bean用来通知其属性变更的标准方式, 
   * PropertyChangeSupport类对于任何想要支持属性变更监听器的bean而言是个便捷的超类,
   * 但可惜已有其他超类的类, 比如JComponent , 必须重新实现相应的方法, 
   * 将PropertyChangeSupport重新实现为一个特质, 然后把它混入到java.awt.Point类中
   * */</span>
</code></pre> 
<pre class="prettyprint"><code class=" hljs python"><span class="hljs-keyword">import</span> java.beans.{PropertyChangeEvent, PropertyChangeListener}


trait PropertyChangeSupportLike { 

  lazy val pcs = new java.beans.PropertyChangeSupport(this)   

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">addPropertyChangeListener</span><span class="hljs-params">(listener: PropertyChangeListener)</span>:</span> Unit = pcs.addPropertyChangeListener(listener)

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">removePropertyChangeListener</span><span class="hljs-params">(listener: PropertyChangeListener)</span>:</span> Unit = pcs.removePropertyChangeListener(listener)

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getPropertyChangeListeners</span>:</span> Array[PropertyChangeListener] = pcs.getPropertyChangeListeners

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">addPropertyChangeListener</span><span class="hljs-params">(propertyName: String, listener: PropertyChangeListener)</span>:</span> Unit = pcs.addPropertyChangeListener(propertyName, listener)

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">removePropertyChangeListener</span><span class="hljs-params">(propertyName: String, listener: PropertyChangeListener)</span>:</span> Unit = pcs.removePropertyChangeListener(propertyName, listener)

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getPropertyChangeListeners</span><span class="hljs-params">(propertyName: String)</span>:</span> Array[PropertyChangeListener] = pcs.getPropertyChangeListeners(propertyName)

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">firePropertyChange</span><span class="hljs-params">(propertyName: String, oldValue: Object, newValue: Object)</span>:</span> Unit = pcs.firePropertyChange(propertyName, oldValue, newValue)

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">firePropertyChange</span><span class="hljs-params">(propertyName: String, oldValue: Int, newValue: Int)</span>:</span> Unit = pcs.firePropertyChange(propertyName, oldValue, newValue)

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">firePropertyChange</span><span class="hljs-params">(propertyName: String, oldValue: Boolean, newValue: Boolean)</span>:</span> Unit = pcs.firePropertyChange(propertyName, oldValue, newValue)

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">firePropertyChange</span><span class="hljs-params">(event: PropertyChangeEvent)</span>:</span> Unit = pcs.firePropertyChange(event)

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fireIndexedPropertyChange</span><span class="hljs-params">(propertyName: String, index: Int, oldValue: Object, newValue: Object)</span>:</span> Unit = fireIndexedPropertyChange(propertyName, index, oldValue, newValue)

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fireIndexedPropertyChange</span><span class="hljs-params">(propertyName: String, index: Int, oldValue: Int, newValue: Int)</span>:</span> Unit = fireIndexedPropertyChange(propertyName, index, oldValue, newValue)

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fireIndexedPropertyChange</span><span class="hljs-params">(propertyName: String, index: Int, oldValue: Boolean, newValue: Boolean)</span>:</span> Unit = fireIndexedPropertyChange(propertyName, index, oldValue, newValue)

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">hasListeners</span><span class="hljs-params">(propertyName: String)</span>:</span> Boolean = pcs.hasListeners(propertyName)

}</code></pre> 
<hr> 
<pre class="prettyprint"><code class=" hljs scala"><span class="hljs-comment">//Test</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TraitTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">FunSuite</span> <span class="hljs-keyword">with</span> <span class="hljs-title">BeforeAndAfter</span> {<!-- --></span>

  before {
    println(<span class="hljs-string">"---------"</span>)
  }
  test(<span class="hljs-string">"Trait-Exercise-PropertyChangeSupport"</span>) {
    <span class="hljs-keyword">val</span> point = <span class="hljs-keyword">new</span> java.awt.Point(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>) <span class="hljs-keyword">with</span> PropertyChangeSupportLike
    point.addPropertyChangeListener(<span class="hljs-string">"x"</span>, (evt: PropertyChangeEvent) =&gt; {
      println(evt)
    })

    point.x = <span class="hljs-number">3</span>
    point.firePropertyChange(<span class="hljs-string">"x"</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)

  }
}</code></pre> 
<h4 id="问题六java-awt类库中container类">问题六：Java AWT类库中，Container类</h4> 
<pre class="prettyprint"><code class=" hljs mathematica">  /*
   * 问题六：
   * 在Java AWT类库中, 我们有一个Container类, 一个可以用于各种组件的Component子类, 举例来说,
   * <span class="hljs-keyword">Button</span>是一个Component, 但<span class="hljs-keyword">Panel</span>是Container, 这是一个运转中的组合模式,
   * Swaing有JComponent和JContainer,但如果你仔细看的话,你会发现一些奇怪的细节,
   * 尽管把其他组件添加到比如JButton中毫无意义, JComponent依然扩展自Container,
   * Swing的设计者们理想情况下应该会更倾向于图<span class="hljs-number">10</span>-<span class="hljs-number">4</span>中的设计,
   * 但在Java中那是不可能的, 请解释这是为什么?Scala中如何用特质来设计出这样的效果呢?
   */</code></pre> 
<pre class="prettyprint"><code class=" hljs scala"><span class="hljs-comment">// 答：Java语言、Scala语言，仅仅单继承。JContainer不能同时继承JComponent和Container</span>

<span class="hljs-comment">//使用trait</span>
<span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Componet</span> {<!-- --></span>}
<span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">JComponet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Componet</span>{<!-- --></span>}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JButton</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JComponet</span>{<!-- --></span>}

<span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Container</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span>{<!-- --></span>}
<span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">JContainer</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JComponent</span> <span class="hljs-keyword">with</span> <span class="hljs-title">Container</span>{<!-- --></span>}
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">JPanel</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">JContainer</span>{<!-- --></span>}</code></pre> 
<h4 id="问题七设计scala特质">问题七：设计Scala特质</h4> 
<h4 id="问题八设计特质完成javaiobufferedinputstream修饰器的作用">问题八：设计特质完成java.io.BufferedInputStream修饰器的作用</h4> 
<pre class="prettyprint"><code class=" hljs python">// 问题八：
// 在java.io类库中，你可以通过BufferedInputStream修饰器来给输入流增加缓冲机制。
// 用特质来重新实现缓冲。简单起见， 重写read方法


<span class="hljs-keyword">import</span> java.io.{IOException, InputStream}

trait BufferedInputStreamLike {
  this: InputStream =&gt;

  protected val bufSize: Int = BufferedInputStreamLike.DEFAULT_BUFFER_SIZE
  protected var pos: Int = <span class="hljs-number">0</span>
  protected var count: Int = <span class="hljs-number">0</span>

  protected val buf = new Array[Byte](bufSize)

  override <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">read</span><span class="hljs-params">()</span>:</span> Int = synchronized{
    <span class="hljs-keyword">if</span> (pos &gt;= count) {
      fill()
      <span class="hljs-keyword">if</span> (pos &gt;= count)
         <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>
    }
    val buffer = getBufIfOpen
    pos += <span class="hljs-number">1</span>
    buffer(pos - <span class="hljs-number">1</span>)
  }

  private <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fill</span><span class="hljs-params">()</span>:</span> Unit = {
    count = <span class="hljs-number">0</span>
    pos = <span class="hljs-number">0</span>
    val n = this.read(getBufIfOpen, <span class="hljs-number">0</span>, buf.length)
    <span class="hljs-keyword">if</span> (n &gt; <span class="hljs-number">0</span>)
      count += n
  }


  private <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">getBufIfOpen</span>:</span> Array[Byte] = {
    <span class="hljs-keyword">if</span> (buf == null) new IOException(<span class="hljs-string">"Stream closed"</span>)
    buf
  }

}

object BufferedInputStreamLike {
  val DEFAULT_BUFFER_SIZE = <span class="hljs-number">8192</span>
}
</code></pre> 
<hr> 
<pre class="prettyprint"><code class=" hljs scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">TraitTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">FunSuite</span> <span class="hljs-keyword">with</span> <span class="hljs-title">BeforeAndAfter</span> {<!-- --></span>

  before {
    println(<span class="hljs-string">"---------"</span>)
  }

  test(<span class="hljs-string">"BufferedInputStreamLike"</span>) {
    <span class="hljs-keyword">var</span> start = System.nanoTime()

    <span class="hljs-keyword">val</span> fileInputStream = <span class="hljs-keyword">new</span> FileInputStream(<span class="hljs-string">"/home/jack/top"</span>)
    <span class="hljs-keyword">for</span> (i &lt;- <span class="hljs-number">1</span> to <span class="hljs-number">100000</span>) fileInputStream.read()

    <span class="hljs-keyword">var</span> end = System.nanoTime()
    println(s<span class="hljs-string">"Without\tBufferedInputStreamLike, cost time:${end -start} ns"</span> )
    fileInputStream.close()



    <span class="hljs-comment">// Part II</span>
    start = System.nanoTime()

    <span class="hljs-keyword">val</span> bufferedInputStream: FileInputStream <span class="hljs-keyword">with</span> BufferedInputStreamLike = <span class="hljs-keyword">new</span> {<!-- --><span class="hljs-keyword">val</span> bufferSize = <span class="hljs-number">100000</span>} <span class="hljs-keyword">with</span> FileInputStream(<span class="hljs-string">"/home/jack/top"</span>) <span class="hljs-keyword">with</span> BufferedInputStreamLike
    <span class="hljs-keyword">for</span> (i &lt;- <span class="hljs-number">1</span> to <span class="hljs-number">100000</span>) bufferedInputStream.read()

    end = System.nanoTime()
    println(s<span class="hljs-string">"With\tBufferedInputStreamLike, cost time:${end -start} ns"</span> )

    bufferedInputStream.close()

  }

<span class="hljs-comment">// sbt shell </span>
<span class="hljs-comment">// testOnly Trai* -- -z "InputStreamLike"</span>
<span class="hljs-comment">/*
---------
Without BufferedInputStreamLike, cost time:54517999 ns
With    BufferedInputStreamLike, cost time:19849703 ns
[info] TraitTest:
[info] - BufferedInputStreamLike
[info] Run completed in 191 milliseconds.
[info] Total number of tests run: 1
[info] Suites: completed 1, aborted 0
[info] Tests: succeeded 1, failed 0, canceled 0, ignored 0, pending 0
[info] All tests passed.
[success] Total time: 0 s, completed Aug 2, 2018 5:01:07 PM
*/</span>
</code></pre> 
<h4 id="问题九使用本章的日志生成器特质给前一个练习中的方案添加日志功能要求体现出缓冲的效果">问题九：使用本章的日志生成器特质，给前一个练习中的方案添加日志功能，要求体现出缓冲的效果。</h4> 
<pre class="prettyprint"><code class=" hljs python">package example.traits

trait Logger { 
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">log</span><span class="hljs-params">(msg: String)</span>:</span> Unit ={}
}</code></pre> 
<hr> 
<pre class="prettyprint"><code class=" hljs scala"><span class="hljs-keyword">package</span> example.traits

<span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">ConsoleLogger</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Logger</span> {<!-- --></span>
  <span class="hljs-keyword">override</span> <span class="hljs-keyword">def</span> log(msg: String): Unit = {
    println(msg)
  }
}</code></pre> 
<pre class="prettyprint"><code class=" hljs scala"><span class="hljs-keyword">package</span> example.traits.exercise

<span class="hljs-keyword">import</span> java.io.{IOException, InputStream}

<span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">BufferedInputStreamLike</span> {<!-- --></span>
  <span class="hljs-javadoc">/** trait指定自类型 **/</span>
  <span class="hljs-keyword">this</span>: InputStream <span class="hljs-keyword">with</span> example.traits.Logger =&gt;    

  <span class="hljs-keyword">protected</span> <span class="hljs-keyword">val</span> bufSize: Int = BufferedInputStreamLike.DEFAULT_BUFFER_SIZE
  <span class="hljs-keyword">protected</span> <span class="hljs-keyword">var</span> pos: Int = <span class="hljs-number">0</span>
  <span class="hljs-keyword">protected</span> <span class="hljs-keyword">var</span> count: Int = <span class="hljs-number">0</span>

  <span class="hljs-keyword">protected</span> <span class="hljs-keyword">val</span> buf = <span class="hljs-keyword">new</span> Array[Byte](bufSize)

  <span class="hljs-keyword">override</span> <span class="hljs-keyword">def</span> read(): Int = synchronized {
    <span class="hljs-keyword">if</span> (pos &gt;= count) {
      fill()
      <span class="hljs-keyword">if</span> (pos &gt;= count)
        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>
    }
    <span class="hljs-keyword">val</span> buffer = getBufIfOpen
    pos += <span class="hljs-number">1</span>
    buffer(pos - <span class="hljs-number">1</span>)
  }

  <span class="hljs-keyword">private</span> <span class="hljs-keyword">def</span> fill(): Unit = {
    count = <span class="hljs-number">0</span>
    pos = <span class="hljs-number">0</span>
    <span class="hljs-keyword">val</span> n = <span class="hljs-keyword">this</span>.read(getBufIfOpen, <span class="hljs-number">0</span>, buf.length)
    <span class="hljs-keyword">if</span> (n &gt; <span class="hljs-number">0</span>) {
      count += n
      log(<span class="hljs-string">"buffered %d bytes: %s"</span>.format(n, buf.mkString(<span class="hljs-string">", "</span>)))    <span class="hljs-javadoc">/**添加日志功能**/</span>
    }
  }


  <span class="hljs-keyword">private</span> <span class="hljs-keyword">def</span> getBufIfOpen: Array[Byte] = {
    <span class="hljs-keyword">if</span> (buf == <span class="hljs-keyword">null</span>) <span class="hljs-keyword">new</span> IOException(<span class="hljs-string">"Stream closed"</span>)
    buf
  }

}

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">BufferedInputStreamLike</span> {<!-- --></span>
  <span class="hljs-keyword">val</span> DEFAULT_BUFFER_SIZE = <span class="hljs-number">8192</span>
}</code></pre> 
<hr> 
<pre class="prettyprint"><code class=" hljs scala">  test(<span class="hljs-string">"BufferedInputStreamLike - ConsoleLogger"</span>) {
    <span class="hljs-comment">// Part II</span>
    <span class="hljs-keyword">val</span> start = System.nanoTime()

    <span class="hljs-keyword">val</span> bufferedInputStream = <span class="hljs-keyword">new</span> {
      <span class="hljs-keyword">override</span> <span class="hljs-keyword">val</span> bufSize = <span class="hljs-number">20</span>
    } <span class="hljs-keyword">with</span> FileInputStream(<span class="hljs-string">"/home/jack/top"</span>) <span class="hljs-keyword">with</span> BufferedInputStreamLike <span class="hljs-keyword">with</span> ConsoleLogger
    <span class="hljs-keyword">for</span> (i &lt;- <span class="hljs-number">1</span> to <span class="hljs-number">10</span>) bufferedInputStream.read()

    <span class="hljs-keyword">val</span> end = System.nanoTime()
    println(s<span class="hljs-string">"With\tBufferedInputStreamLike, cost time:${end - start} ns"</span>)

    bufferedInputStream.close()
  }

  <span class="hljs-javadoc">/**  sbt shell  日志 
[IJ]sbt:scala-tutorial&gt; testOnly Trai* -- -z "ConsoleLogger"
---------
buffered 20 bytes: 85, 83, 69, 82, 32, 32, 32, 32, 32, 32, 32, 80, 73, 68, 32, 37, 67, 80, 85, 32
With    BufferedInputStreamLike, cost time:774421 ns
[info] TraitTest:
[info] - BufferedInputStreamLike - ConsoleLogger
[info] Run completed in 107 milliseconds.
[info] Total number of tests run: 1
[info] Suites: completed 1, aborted 0
[info] Tests: succeeded 1, failed 0, canceled 0, ignored 0, pending 0
[info] All tests passed.
[success] Total time: 0 s, completed Aug 2, 2018 5:32:07 PM
  */</span></code></pre> 
<h4 id="问题十实现一个iterableinputstream类扩展javaioinputstream并混入iterablebyte特质">问题十：实现一个IterableInputStream类，扩展java.io.InputStream并混入Iterable[Byte]特质</h4> 
<pre class="prettyprint"><code class=" hljs scala"><span class="hljs-keyword">package</span> example.traits.exercise

<span class="hljs-comment">// java.io.FileInputStream 存在native方法： </span>
<span class="hljs-comment">// private native int read0() throws IOException;</span>
<span class="hljs-comment">// private native int readBytes(byte b[], int off, int len) throws IOException;</span>
<span class="hljs-comment">// private native int available0() throws IOException;</span>
<span class="hljs-comment">// SocketInputStream也存在类似native方法</span>

<span class="hljs-comment">// 但是本例中IterableInputStream，缺少相关的native方法。</span>
<span class="hljs-comment">// 本题，仅是了解概念，IterableInputStream 无法实例化。</span>
<span class="hljs-keyword">abstract</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IterableInputStream</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">java</span>.<span class="hljs-title">io</span>.<span class="hljs-title">InputStream</span> <span class="hljs-keyword">with</span> <span class="hljs-title">Iterable</span>[<span class="hljs-title">Byte</span>] {<!-- --></span>

  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">IterableInputStreamIterator</span><span class="hljs-params">(inputStream: IterableInputStream)</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Iterator</span>[<span class="hljs-title">Byte</span>] {<!-- --></span>

    <span class="hljs-keyword">override</span> <span class="hljs-keyword">def</span> hasNext: Boolean = inputStream.available() &gt; <span class="hljs-number">0</span>

    <span class="hljs-keyword">override</span> <span class="hljs-keyword">def</span> next(): Byte = inputStream.read().toByte
  }


  <span class="hljs-keyword">override</span> <span class="hljs-keyword">def</span> iterator: Iterator[Byte] = <span class="hljs-keyword">new</span> IterableInputStreamIterator(<span class="hljs-keyword">this</span>)

}
</code></pre> 
<p><a href="https://github.com/junyalu/scala-hello/blob/master/src/charpter10.scala">Github 答案参考</a> <br> <a href="http://vernonzheng.com/2015/02/02/%E3%80%8A%E5%BF%AB%E5%AD%A6scala%E3%80%8B%E4%B9%A0%E9%A2%98%E8%A7%A3%E7%AD%94-%E7%AC%AC%E5%8D%81%E7%AB%A0-%E7%89%B9%E8%B4%A8/" rel="nofollow">《快学scala》习题解答-第十章-特质</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/674b46fbbfe692e5846dd90a0d426ab8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">IPv6，到底是什么？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d0122cf2c970b45000195a2a50efcf2c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">阿里在线测评解析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>