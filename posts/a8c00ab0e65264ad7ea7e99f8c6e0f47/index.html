<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>编写优雅代码的最佳实践 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="编写优雅代码的最佳实践" />
<meta property="og:description" content="Robert Martin曾说过&#34;在代码阅读中说脏话的频率是衡量代码质量额唯一标准&#34;。同时，代码的写法应当使别人理解它所需的时间最小化，也就是说我们写的代码是给人看的而不是给机器看的。那么，如何编写优雅代码呢？可以从思想层面和具体技巧层面来优化代码，思想层面指的是遵循面向对象设计原则，本期介绍的是具体技巧。
##1. 代码总是越短越好吗？
assert((!(bucket = findBucket(key))) || !bucket.isOccupied()); 复制代码 上面这行代码虽然比较短，但是难以阅读。为了更好地阅读，我们做如下修改：
bucket = findBucket(key); if(bucket != null){ assert(!bucket.isOccupied()); } 复制代码 减少代码行数是一个好目标，但是让阅读代码的事件最小化是个更好的目标。
2. 给重要语句添加注释 // Fast version of &#34;hash = (65599*hash) &#43; c&#34; hash = (hash &lt;&lt; 6) &#43; (hash &lt;&lt; 16) - hash &#43; c 复制代码 上面这行代码如果没有添加注释，我们根本不知道是什么意思，但是有了这行注释，我们就知道通过移位操作来提升性能。
## 3. tmp的使用 tmp是我们经常用的，譬如说两个变量置换，都已变成约定俗成了。
tmp = right; right = left; left = tmp; 复制代码 String tmp = user.getName(); tmp &#43;= &#34; &#34; &#43; user." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a8c00ab0e65264ad7ea7e99f8c6e0f47/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-04-24T04:16:06+08:00" />
<meta property="article:modified_time" content="2018-04-24T04:16:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">编写优雅代码的最佳实践</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="article-content"> 
 <p>Robert Martin曾说过"在代码阅读中说脏话的频率是衡量代码质量额唯一标准"。同时，<strong>代码的写法应当使别人理解它所需的时间最小化</strong>，也就是说我们写的代码是给人看的而不是给机器看的。那么，如何编写优雅代码呢？可以从思想层面和具体技巧层面来优化代码，思想层面指的是遵循面向对象设计原则，本期介绍的是具体技巧。</p> 
 <p>##1. 代码总是越短越好吗？</p> 
 <pre><code class="hljs bash copyable">assert((!(bucket = findBucket(key))) || !bucket.isOccupied());
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>上面这行代码虽然比较短，但是难以阅读。为了更好地阅读，我们做如下修改：</p> 
 <pre><code class="hljs bash copyable">bucket = findBucket(key);
<span class="hljs-keyword">if</span>(bucket != null){
  assert(!bucket.isOccupied());
}
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p><strong>减少代码行数是一个好目标，但是让阅读代码的事件最小化是个更好的目标</strong>。</p> 
 <h3 class="heading">2. 给重要语句添加注释</h3> 
 <pre><code class="hljs bash copyable">// Fast version of <span class="hljs-string">"hash = (65599*hash) + c"</span>
<span class="hljs-built_in">hash</span> = (<span class="hljs-built_in">hash</span> &lt;&lt; 6) + (<span class="hljs-built_in">hash</span> &lt;&lt; 16) - <span class="hljs-built_in">hash</span> + c
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>上面这行代码如果没有添加注释，我们根本不知道是什么意思，但是有了这行注释，我们就知道通过移位操作来提升性能。</p> 
 <p>## 3. tmp的使用 tmp是我们经常用的，譬如说两个变量置换，都已变成约定俗成了。</p> 
 <pre><code class="hljs bash copyable">tmp = right;
right = left;
left = tmp;
<span class="copy-code-btn">复制代码</span></code></pre> 
 <pre><code class="hljs bash copyable">String tmp = user.getName();
tmp += <span class="hljs-string">" "</span> + user.getPhoneNumber();
tmp += <span class="hljs-string">" "</span> + user.getEmail();
template.set(<span class="hljs-string">"user_info"</span>,tmp);
<span class="copy-code-btn">复制代码</span></code></pre> 
 <h3 class="heading">4.<code>i，j，k，iter，it</code>：只用做索引或者循环迭代</h3> 
 <p><code>i，j，k，iter，it</code>被用做索引或者循环迭代已成为业界规范了（i是index的缩写），例如：</p> 
 <pre><code class="hljs bash copyable"><span class="hljs-keyword">for</span>(int i=0;i&lt;100;i++){
  <span class="hljs-keyword">for</span>(int j=0;j&lt;100;j++){
    ......
  }
}

Iterator&lt;String&gt; iter = list.iterator();
<span class="hljs-keyword">while</span>(iter.hasNext()){
  ......
}
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>如果我们在其他地方使用i，j，k，那么就会增加阅读者的时间。</p> 
 <h3 class="heading">5. 附带重要属性</h3> 
 <p>我们把命名当做一种注释的方式，让它承载更多的信息！ </p> 
 <figure> 
  <figcaption></figcaption> 
 </figure> 
 <p></p> 
 <h3 class="heading">6. 名字需要多长？</h3> 
 <ul><li>在小的作用域中使用简短的名字</li><li>在作用域大的可以使用长名字</li></ul> 
 <pre><code class="hljs bash copyable"><span class="hljs-keyword">if</span>(debug){
  Map&lt;String,Integer&gt; m = new HashMap&lt;&gt;();
  lookUpNamesNumbers(m);
  <span class="hljs-built_in">print</span>(m);
}
<span class="copy-code-btn">复制代码</span></code></pre> 
 <h3 class="heading">7. 不要使用容易误解的名字</h3> 
 <pre><code class="hljs bash copyable">results = Database.all_objects.filter(<span class="hljs-string">"year&lt;=2011"</span>)
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>上面这行代码结果现在包含哪些信息？filter是把年份小于等于2011年的数据过滤掉？还是保留？</p> 
 <h3 class="heading">8. 推荐用min和max来表示极限</h3> 
 <pre><code class="hljs bash copyable">MAX_ITEMS_IN_CART = 10;

<span class="hljs-keyword">if</span> (shoppingCart.numOfItems()&gt; MAX_ITEMS_IN_CART){
    error(<span class="hljs-string">"Too many items in cart"</span>);
}
<span class="copy-code-btn">复制代码</span></code></pre> 
 <h3 class="heading">9. 推荐用begin和end来表示包含/排除范围</h3> 
 <p></p> 
 <figure> 
  <figcaption></figcaption> 
 </figure> begin表示包含，end表示排除，在Java中典型的例子就是String.substring() 
 <p></p> 
 <pre><code class="hljs bash copyable">
String s = <span class="hljs-string">"Hello world"</span>;

s.substring(2,5);-&gt; <span class="hljs-string">"llo"</span>

<span class="copy-code-btn">复制代码</span></code></pre> 
 <h3 class="heading">10.与使用者的期望相匹配</h3> 
 <p>一般来说，getter方法就是获取一个字段的值，用户期待的是轻量级的方法，如果你要是在其中做了太多的计算，就应该考虑改名。</p> 
 <pre><code class="hljs bash copyable">
public double <span class="hljs-function"><span class="hljs-title">getMeanPrice</span></span>(){

//遍历所有条目计算总价，然后计算平均价格

}

public double <span class="hljs-function"><span class="hljs-title">computeMeanPrice</span></span>(){

//遍历所有条目计算总价，然后计算平均价格

}

<span class="copy-code-btn">复制代码</span></code></pre> 
 <h3 class="heading">11.不要为那些从代码本身就能快速推断的事实写注释</h3> 
 <pre><code class="hljs bash copyable">
public  class Account {  

    // Constructor

   public  <span class="hljs-function"><span class="hljs-title">Account</span></span>(){

   }

   // Set the profit member to a new value    

   void <span class="hljs-built_in">set</span>Profit(double profit){

         …….

   }   

    // Return the profit from this Account    

    double <span class="hljs-function"><span class="hljs-title">getProfit</span></span>(){

        ….

    }

};

<span class="copy-code-btn">复制代码</span></code></pre> 
 <h3 class="heading">12. 不要给不好的名字加注释--应该把名字改好</h3> 
 <pre><code class="hljs bash copyable">// Releases the handle <span class="hljs-keyword">for</span> this key.This doesn<span class="hljs-string">'t modify the actual registry.
void deleteRegistry(RegistryKey key)
</span><span class="copy-code-btn">复制代码</span></code></pre> 
 <p>乍一看我们会误认为这是一个删除注册表的函数，可是注释里澄清它不就改动真正的注册表。因此，我们可以用一个更加自我说明的名字，例如：</p> 
 <pre><code class="hljs bash copyable">void releaseRegistryHandle(registryKey key);
<span class="copy-code-btn">复制代码</span></code></pre> 
 <h3 class="heading">13.为代码中的瑕疵写注释</h3> 
 <p>// TODO:采用更快算法或者当代码没有完成时 // TODO(dustin):处理除JPEG以外的图像格式 </p> 
 <figure> 
  <figcaption></figcaption> 
 </figure> 
 <p></p> 
 <h3 class="heading">14.为常量写注释</h3> 
 <pre><code class="hljs bash copyable">// users thought 0.72 gave the best size/quality tradeoff
image_quality = 0.72;

// as long as it<span class="hljs-string">'s &gt;= 2*num_processors,that'</span>s good enough
NUM_THREADS = 8;

// impose a reasonable <span class="hljs-built_in">limit</span> - no human can <span class="hljs-built_in">read</span> that much anywhere
const int MAX_RSS_SUBSCRIPTIONS = 1000;
<span class="copy-code-btn">复制代码</span></code></pre> 
 <h3 class="heading">15. 站在读者的角度写注释</h3> 
 <pre><code class="hljs bash copyable">struct Recoder {
    vector&lt;<span class="hljs-built_in">float</span>&gt; data;
    ......
    void <span class="hljs-function"><span class="hljs-title">clear</span></span>(){
        // 每个人读到这里都会问，为啥不直接调用data.clear()
        vector&lt;<span class="hljs-built_in">float</span>&gt;().swap(data);
    }
}
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>如果有一个好的注释可以解答读者的疑问，将上述进行如下修改：强制Vector真正地把内存归还给内存分配器，详情请查阅STL swap trick。</p> 
 <h3 class="heading">16. 公布可能的陷阱</h3> 
 <pre><code class="hljs bash copyable">void sendMail(String to,String subject,String body);
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>这个函数由于需要调用外部服务器发送邮件，可能会很耗时，有可能导致使用者的线程挂起。需要将这段描述放到注释中。</p> 
 <h3 class="heading">17. 条件语句中参数的顺序</h3> 
 <p></p> 
 <figure> 
  <figcaption></figcaption> 
 </figure> 一般原则：将变量放在左边，常量放在右边。更宽泛地说， 
 <strong>将比较稳定的变量放在右边</strong>，变化较大的放在左边。如 if ( length &gt;= 10) 而不是 if ( 10 &lt;= length)。但是， 
 <strong>在非“大小”比较的情况下，上面的原则似乎不起作用</strong>，例如验证一个请求参数是否为某个特定值： 
 <code>if ( request.getParameterValue("name")).equals("Brandon"))</code>,此时将常量"Brandon"可以避免出现空指针的情况（上行的参数没有name或者值为空）。 
 <p></p> 
 <h3 class="heading">18. if/else语句块的顺序</h3> 
 <p>if/else书写规范：首先处理正逻辑而不是负逻辑，例如 if(ok)，而不是if(!ok)；其次处理掉简单的情况，这有利于让if和else处理代码在同一个屏幕内可见。</p> 
 <h3 class="heading">19. 通过提早返回减少嵌套</h3> 
 <p>使用提前返回的机制，可以把函数的嵌套层级变浅。举个栗子，没有使用提前返回的代码：</p> 
 <pre><code class="hljs bash copyable">static bool <span class="hljs-function"><span class="hljs-title">checkUserAuthority</span></span>()
        {
            bool a, b, c, d, e;

            <span class="hljs-keyword">if</span> (a)
            {
                <span class="hljs-keyword">if</span> (b)
                {
                    <span class="hljs-keyword">if</span> (c)
                    {
                        <span class="hljs-keyword">if</span> (d)
                        {
                            <span class="hljs-keyword">if</span> (e)
                            {
                                <span class="hljs-built_in">return</span> <span class="hljs-literal">true</span>;
                            }
                        }
                    }
                }
            }

            <span class="hljs-built_in">return</span> <span class="hljs-literal">false</span>;
        }
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>使用了提前返回的代码：</p> 
 <pre><code class="hljs bash copyable">static bool <span class="hljs-function"><span class="hljs-title">checkUserAuthority</span></span>()
        {
            bool a, b, c, d, e;

            <span class="hljs-keyword">if</span> (!a)
                <span class="hljs-built_in">return</span> <span class="hljs-literal">false</span>;

            <span class="hljs-keyword">if</span> (!b)
                <span class="hljs-built_in">return</span> <span class="hljs-literal">false</span>;

            <span class="hljs-keyword">if</span> (!c)
                <span class="hljs-built_in">return</span> <span class="hljs-literal">false</span>;

            <span class="hljs-keyword">if</span> (!d)
                <span class="hljs-built_in">return</span> <span class="hljs-literal">false</span>;

            <span class="hljs-keyword">if</span> (!e)
                <span class="hljs-built_in">return</span> <span class="hljs-literal">false</span>;

            <span class="hljs-built_in">return</span> <span class="hljs-literal">true</span>;
       
        }
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>##20. 通过 "总结变量" 增加可读性</p> 
 <pre><code class="hljs bash copyable"><span class="hljs-keyword">if</span>(request.user.id == document.owner_id){
    // user can edit this document ...
}

<span class="hljs-keyword">if</span>(request.user.id != document.owner_id){
    // document is <span class="hljs-built_in">read</span>-only...
}
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>通过观察，我们提取一个变量<code>final boolean user_owns_document=(request.user.id == document.owner_id)</code>，接着代码就可以修改成：</p> 
 <pre><code class="hljs bash copyable"><span class="hljs-keyword">if</span>(user_owns_document){
 // user can edit this document ...
}
<span class="hljs-keyword">if</span>(!user_owns_document){
    // document is <span class="hljs-built_in">read</span>-only...
}

<span class="copy-code-btn">复制代码</span></code></pre> 
 <h3 class="heading">21. 减少控制流变量</h3> 
 <p>在while、for等循环语句中，我们通常使用自定义的bool变量，来控制流转。</p> 
 <pre><code class="hljs bash copyable">boolean <span class="hljs-keyword">done</span> = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">while</span>(/* condition */ &amp;&amp; !<span class="hljs-keyword">done</span>){
    ...
    <span class="hljs-keyword">if</span>(...){
        <span class="hljs-keyword">done</span> = <span class="hljs-literal">true</span>;
        <span class="hljs-built_in">continue</span>;
    }
}
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>以我们的经验，"控制流变量" 可以通过优化程序结构、逻辑来消除。</p> 
 <pre><code class="hljs bash copyable"><span class="hljs-keyword">while</span>(/* condition */){
    ...
    <span class="hljs-keyword">if</span>(...){
        <span class="hljs-built_in">break</span>;
    }
}
<span class="copy-code-btn">复制代码</span></code></pre> 
 <h3 class="heading">22. 缩小变量的作用域</h3> 
 <pre><code class="hljs bash copyable">void <span class="hljs-function"><span class="hljs-title">foo</span></span>(){
    int i = 7;

    <span class="hljs-keyword">if</span>(someCondition){
        // i is used only within this block
    }

}

void <span class="hljs-function"><span class="hljs-title">foo</span></span>(){
    <span class="hljs-keyword">if</span>(someCondition){
        int i = 7;
        // i is used only within this block
    }
}
<span class="copy-code-btn">复制代码</span></code></pre> 
 <h3 class="heading">23. 不要为了共享而把变量设置为类的字段</h3> 
 <pre><code class="hljs bash copyable">public class LargeClass{
    String s;
    void <span class="hljs-function"><span class="hljs-title">method1</span></span>(){
        s = ...
        method2();
    }
    void <span class="hljs-function"><span class="hljs-title">method2</span></span>(){
        //使用s
    }
}
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>通过参数传递来实现数据共享</p> 
 <pre><code class="hljs bash copyable">public class LargeClass{
    void <span class="hljs-function"><span class="hljs-title">method1</span></span>(){
        String s = ...
        method2(s);
    }
    void method2(String s){
        //使用s
    }
}
<span class="copy-code-btn">复制代码</span></code></pre> 
 <h3 class="heading">24. 不要把所有变量都定义在开头</h3> 
 <p>把所有变量定义在开头是C语言的风格，面向对象语言习惯将变量定义在离它开始使用的地方。</p> 
 <pre><code class="hljs bash copyable">public void <span class="hljs-function"><span class="hljs-title">foo</span></span>(){
  boolean debug = <span class="hljs-literal">false</span>;
  String[] pvs;
  String pn;
  String pv;
  ...
}
<span class="copy-code-btn">复制代码</span></code></pre> 
 <p>除了上述建议之外，我们还可以参考阿里Java规范，<strong>关注微信号："木可大大"</strong>，发送"阿里Java规范"即可获得相关资料。</p> 
 <hr> 
 <p></p> 
 <figure> 
  <figcaption></figcaption> 
 </figure> 
 <p></p> 
 <p>欢迎关注微信公众号：木可大大，所有文章都将同步在公众号上。</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/497ad41651c10f7843cc279e0809e92f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">np.c_和np.r_的用法解析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1b3e52a47116ae8dfc9d5ab1b80bf37e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">RFID读写器</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>