<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>K8S--安装MySQL8（单机） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="K8S--安装MySQL8（单机）" />
<meta property="og:description" content="原文网址：K8S--安装MySQL8（单机）-CSDN博客
简介 本文介绍K8S部署MySQL8（单机）的方法。
-----------------------------------------------------------------------------------------------
分享Java真实高频面试题，吊打面试官： Java后端真实面试题大全 - 自学精灵
分享靠谱的Java高级实战，包含：高并发、架构、全局处理等：JavaWeb高级实战 - 自学精灵
-----------------------------------------------------------------------------------------------
本文的目标
1.通过PV和PVC（hostPath方式）存储MySQL的数据
2.通过Deployment、Service部署MySQL8，并通过NodePort暴露给外部
3.使用Navicat进行测试
官网网址
运行一个单实例有状态应用 | Kubernetes
概述 1.持久化PV存储方式
数据库必须持久化数据，否则节点重启后数据就没了。PV和PVC可以对数据持久化，支持多种方式：
hostPath、NFS、RDB等等。数据要节点共享的，否则如果节点在其他机器上启动了，就无法访问到数据了。所以，生产环境一般采用这些方式：NFS挂载、用云服务器的RDB等。
本文为了简单，只部署一个MySQL节点，使用hostPath方式，不支持节点共享。
2.持久化PV分配方式
本文我直接手动预先创建。生产环境应该通过StorageClass采用Dynamic Provisioning。
3.数据库高可用
数据库一般要配置主从或者集群，实现高可用。一般使用StatefulSet部署，StatefulSet用于管理有状态应用的负载均衡，管理一组Pod的实现、扩容、缩容，并保证它们的顺序和唯一性。
StatefulSets维护的Pod有唯一的、持久的身份和稳定的主机名，不用管它们位于哪个节点上。即使StatefulSet中的Pod发生故障，存储卷与新Pod进行匹配也很容易。
1.创建PV和PVC存储 先创建目录：
mkdir -p /work/devops/k8s/app/mysql/mnt 创建名为 pv.yaml的文件，内容如下：
apiVersion: v1 kind: PersistentVolume metadata: name: mysql-pv namespace: db labels: type: db-pv spec: storageClassName: manual capacity: storage: 5Gi accessModes: - ReadWriteOnce hostPath: path: &#34;/work/devops/k8s/app/mysql/mnt&#34; --- apiVersion: v1 kind: PersistentVolumeClaim metadata: name: mysql-pvc namespace: db spec: storageClassName: manual accessModes: - ReadWriteOnce resources: requests: storage: 5Gi 创建pv：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ef0971609a8a086fc67cf7a7129477f4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-08T13:43:47+08:00" />
<meta property="article:modified_time" content="2024-01-08T13:43:47+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">K8S--安装MySQL8（单机）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>原文网址：<a href="https://knife.blog.csdn.net/article/details/135400711" rel="nofollow" title="K8S--安装MySQL8（单机）-CSDN博客">K8S--安装MySQL8（单机）-CSDN博客</a></p> 
<h2>简介</h2> 
<p>本文介绍K8S部署MySQL8（单机）的方法。</p> 
<p id="ua01eb6ae">-----------------------------------------------------------------------------------------------<br> 分享Java真实高频面试题，吊打面试官： <a href="https://learn.skyofit.com/archives/66" rel="nofollow" title="Java后端真实面试题大全 - 自学精灵">Java后端真实面试题大全 - 自学精灵</a><br> 分享靠谱的Java高级实战，包含：高并发、架构、全局处理等：<a href="https://learn.skyofit.com/archives/1510" rel="nofollow" title="JavaWeb高级实战 - 自学精灵">JavaWeb高级实战 - 自学精灵</a><br> -----------------------------------------------------------------------------------------------</p> 
<p><strong>本文的目标</strong></p> 
<p>1.通过PV和PVC（hostPath方式）存储MySQL的数据<br> 2.通过Deployment、Service部署MySQL8，并通过NodePort暴露给外部<br> 3.使用Navicat进行测试</p> 
<p><strong>官网网址</strong></p> 
<p><a href="https://kubernetes.io/zh-cn/docs/tasks/run-application/run-single-instance-stateful-application/" rel="nofollow" title="运行一个单实例有状态应用 | Kubernetes">运行一个单实例有状态应用 | Kubernetes</a></p> 
<h2>概述</h2> 
<p><strong>1.持久化PV存储方式</strong></p> 
<p>数据库必须持久化数据，否则节点重启后数据就没了。PV和PVC可以对数据持久化，支持多种方式：<br> hostPath、NFS、RDB等等。数据要节点共享的，否则如果节点在其他机器上启动了，就无法访问到数据了。所以，生产环境一般采用这些方式：NFS挂载、用云服务器的RDB等。</p> 
<p>本文为了简单，只部署一个MySQL节点，使用hostPath方式，不支持节点共享。</p> 
<p><strong>2.持久化PV分配方式</strong></p> 
<p>本文我直接手动预先创建。生产环境应该通过StorageClass采用Dynamic Provisioning。</p> 
<p><strong>3.数据库高可用</strong></p> 
<p>数据库一般要配置主从或者集群，实现高可用。一般使用StatefulSet部署，StatefulSet用于管理有状态应用的负载均衡，管理一组Pod的实现、扩容、缩容，并保证它们的顺序和唯一性。</p> 
<p>StatefulSets维护的Pod有唯一的、持久的身份和稳定的主机名，不用管它们位于哪个节点上。即使StatefulSet中的Pod发生故障，存储卷与新Pod进行匹配也很容易。</p> 
<h2>1.创建PV和PVC存储</h2> 
<p>先创建目录：</p> 
<pre><code>mkdir -p /work/devops/k8s/app/mysql/mnt</code></pre> 
<p>创建名为 pv.yaml的文件，内容如下：</p> 
<pre><code>apiVersion: v1
kind: PersistentVolume
metadata:
  name: mysql-pv
  namespace: db
  labels:
    type: db-pv
spec:
  storageClassName: manual
  capacity:
    storage: 5Gi
  accessModes:
    - ReadWriteOnce
  hostPath:
    path: "/work/devops/k8s/app/mysql/mnt"
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mysql-pvc
  namespace: db
spec:
  storageClassName: manual
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 5Gi
</code></pre> 
<p>创建pv：</p> 
<pre><code>kubectl apply -f pv.yaml</code></pre> 
<p><strong>查看PV</strong></p> 
<pre><code>kubectl get pv mysql-pv</code></pre> 
<p> 结果：（创建成功）</p> 
<p><img alt="" height="74" src="https://images2.imgbox.com/b9/1f/X3qlZVfZ_o.png" width="1200"></p> 
<p><strong>查看PVC</strong></p> 
<pre><code>kubectl get pvc -A</code></pre> 
<p>或者</p> 
<pre><code>get pvc mysql-pvc -n db</code></pre> 
<p>结果 （创建成功，绑定到了mysql-pv）</p> 
<p><img alt="" height="94" src="https://images2.imgbox.com/3b/33/9MdgmSI5_o.png" width="1142"></p> 
<h3>2.创建MySQL应用</h3> 
<h3>1.创建命名空间</h3> 
<p>用于数据库相关应用。</p> 
<p>创建名为db-namespace.yaml的文件，内容如下：</p> 
<pre><code># 创建命名空间
apiVersion: v1
kind: Namespace
metadata:
  name: db
  labels:
    name: db
</code></pre> 
<p>执行命令创建它：</p> 
<pre><code>kubectl apply -f db-namespace.yaml</code></pre> 
<h3>2.创建MySQL应用</h3> 
<p>这里用Configmap配置MySQL、用Deployment部署mysql镜像、用Service将MySQL暴露出来。</p> 
<p>创建名为k8s.yaml的文件，内容如下：</p> 
<pre><code>apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-config
  namespace: db
data:
  my.cnf: |-
    [client]
    default-character-set=utf8mb4
     
    [mysql]
    default-character-set=utf8mb4
     
    [mysqld]
    #服务端口号 默认3306
    port=3306
     
    # 数据路径，默认是/var/lib/mysql/
    #datadir = /app/data/
     
    init_connect='SET NAMES utf8mb4'
    character-set-server=utf8mb4
    collation-server=utf8mb4_unicode_ci
     
    # 最大连接数
    max_connections=200
     
    # 连接失败的最大次数。防止有人从该主机试图攻击数据库系统
    max_connect_errors=20
 
    # 创建新表时将使用的默认存储引擎
    default-storage-engine=INNODB
    
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: mysql-deployment
  namespace: db
spec:
  replicas: 1
  selector:
    matchLabels:
      name: mysql
  template:
    metadata:
      labels:
        name: mysql
    spec:
      containers:
        - name: mysql8
          image: mysql:8.0
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 3306
          env:
            - name: TZ
              value: Asia/Shanghai
            - name: MYSQL_ROOT_PASSWORD
              value: "123456"
            - name: MYSQL_USER
              value: admin
            - name: MYSQL_PASSWORD
              value: "222333"
          volumeMounts:
            - name: volume
              mountPath: /var/lib/mysql/
              subPath: data
            - name: volume
              mountPath: /var/log/mysql/
              subPath: log
            - name: config
              mountPath: /etc/mysql/conf.d/my.cnf
      volumes:
      - name: volume
        persistentVolumeClaim:
          claimName: mysql-pvc
      - name: config
        configMap:
          name: mysql-config
---
apiVersion: v1
kind: Service
metadata:
  name: mysql-service
  namespace: db
  labels:
    app: mysql
spec:
  type: NodePort
  ports:
  - port: 3306
    targetPort: 3306
    nodePort: 30005
  selector:
    name: mysql</code></pre> 
<p>查看结果（已成功启动）</p> 
<pre><code>kubectl get pods -A</code></pre> 
<p>结果</p> 
<p><img alt="" height="210" src="https://images2.imgbox.com/b1/43/GZxorCc5_o.png" width="1198"></p> 
<h2>3.用Navicat测试</h2> 
<p>用Navicat测试连接：（连接成功）</p> 
<p><img alt="" height="667" src="https://images2.imgbox.com/6c/07/HlJxprd0_o.png" width="562"></p> 
<p id="u0850dd93"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c4785c3e8bda21c57e23ed824d7d5625/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">PTA是什么？BT-WIFI共存</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/98d7a860c15f79dca84354858b27aaee/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Ubuntu20.04系统环境配置</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>