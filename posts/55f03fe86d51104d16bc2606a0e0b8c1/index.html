<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ffmpeg中如何加入trueHD/mlp编码器 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ffmpeg中如何加入trueHD/mlp编码器" />
<meta property="og:description" content="在ffmpeg标准版中已经存在mlp音频解码器，但却没有编码器，但在soc版本中是有的，且有一个专门的目录mlp存放。
和其它编码器，mlp编码的相关文件是mlpenc.h和mlpenc.c，但在soc中不能直接加入，需要在接口上加以更改，改接口是mlp_encode_frame，细心的开发人员不难发现，他们是不一样的。 在soc或早期版本中如下:
int (*encode)(AVCodecContext *,
uint8_t *buf, int buf_size, void *data);
后来使用了encode2，其定义如下: int(*encode2)(AVCodecContext*avctx, AVPacket*avpkt, constAVFrame*frame, int*got_packet_ptr);
在avcodec.h中当然也必须更改REGISTER_DECODER(MLP,mlp)更改为REGISTER_ENCDEC(MLP, mlp).
有测试过的同学也发现这个mlp编码器并不能在ts或m2ts中进行复用流的编码，这是因为在复合流中使用的是其复杂形式，名称为trueHD.
所以在同步头中还应根据mlp还是trueHD作一点更改，当然这一点根据只能编码出trueHD的裸流音频。
如果直接使用-i filename -avcodec truehd -ac2 outpath/outname.m2ts，播放时会没有声音，这是为什么呢？
这是因为在ffmpeg中并没有对turehd的流进行标识，正确的做法是在节目表中写入truehd的标识0x83，如此便能成功。
补充说明:mlp的fourCC(&#39;M&#39;,&#39;L&#39;,&#39;P&#39;,&#39; &#39; ), trueHD的fourCC(&#39;T&#39;,&#39;R&#39;,&#39;H&#39;,&#39;D&#39;)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/55f03fe86d51104d16bc2606a0e0b8c1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2013-07-31T00:21:16+08:00" />
<meta property="article:modified_time" content="2013-07-31T00:21:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ffmpeg中如何加入trueHD/mlp编码器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>    <span style="font-size:18px">在ffmpeg标准版中已经存在mlp音频解码器，但却没有编码器，但在soc版本中是有的，且有一个专门的目录mlp存放。</span></p> 
<p><span style="font-size:18px">    和其它编码器，mlp编码的相关文件是mlpenc.h和mlpenc.c，但在soc中不能直接加入，需要在接口上加以更改，改接口是mlp_encode_frame，</span><span style="font-size:18px">细心的开发人员不难发现，他们是不一样的。</span><span style="font-size:18px">   在soc或早期版本中如下:</span></p> 
<p><span style="font-size:18px">   </span><span style="font-family:SimSun; font-size:14px; color:#cc6600"><strong>int (*encode)(AVCodecContext *,<br>                 uint8_t *buf, <br>                 int buf_size, <br>                 void *data);</strong></span></p> 
<p><span style="font-size:18px">后来使用了encode2，其定义如下:  </span><br> <span class="default"><span style="font-size:18px"><span class="darkgreen"></span></span><span class="darkgreen" style="font-size:18px; font-family:monospace; line-height:20px; white-space:pre-wrap; color:rgb(0,153,0)"></span><span style="font-family:SimSun; font-size:14px; color:#cc6600"><strong><span class="darkgreen" style="line-height:20px; white-space:pre-wrap">int</span><span style="line-height:20px; white-space:pre-wrap"></span><span class="darkred" style="line-height:20px; white-space:pre-wrap">(*</span><span style="line-height:20px; white-space:pre-wrap">encode2</span><span class="darkred" style="line-height:20px; white-space:pre-wrap">)(</span><span class="teal" style="line-height:20px; white-space:pre-wrap">AVCodecContext</span><span class="darkred" style="line-height:20px; white-space:pre-wrap">*</span><span style="line-height:20px; white-space:pre-wrap">avctx</span><span class="darkred" style="line-height:20px; white-space:pre-wrap">,</span></strong></span></span><span class="default"><span style="font-family:SimSun; font-size:14px; color:rgb(204,102,0)"><strong><span class="teal" style="line-height:20px; white-space:pre-wrap"> </span></strong></span></span></p> 
<p><span class="default"><span style="font-family:SimSun; font-size:14px; color:rgb(204,102,0)"><strong><span class="teal" style="line-height:20px; white-space:pre-wrap"><span style="white-space:pre"></span>AVPacket</span><span class="darkred" style="line-height:20px; white-space:pre-wrap">*</span><span style="line-height:20px; white-space:pre-wrap">avpkt</span><span class="darkred" style="line-height:20px; white-space:pre-wrap">,</span></strong></span></span><span class="default"><span style="font-family:SimSun; font-size:14px; color:rgb(204,102,0)"><strong><span style="line-height:20px; white-space:pre-wrap"><span class="blue"> </span></span></strong></span></span></p> 
<p><span class="default"><span style="font-family:SimSun; font-size:14px; color:rgb(204,102,0)"><span style="font-weight:bold"><span style="line-height:20px; white-space:pre-wrap"><span class="blue"><span style="white-space:pre"></span>const</span></span><span class="teal" style="line-height:20px; white-space:pre-wrap">AVFrame</span><span class="darkred" style="line-height:20px; white-space:pre-wrap">*</span><span style="line-height:20px; white-space:pre-wrap">frame</span><span class="darkred" style="line-height:20px; white-space:pre-wrap">,</span></span></span></span><span class="darkgreen" style="font-weight:bold; color:rgb(204,102,0); font-family:SimSun; font-size:14px; line-height:20px; white-space:pre-wrap; background-color:white"> </span></p> 
<p><span class="darkgreen" style="font-weight:bold; color:rgb(204,102,0); font-family:SimSun; font-size:14px; line-height:20px; white-space:pre-wrap; background-color:white"><span style="white-space:pre"></span>int</span><span class="darkred" style="font-weight:bold; color:rgb(204,102,0); font-family:SimSun; font-size:14px; line-height:20px; white-space:pre-wrap; background-color:white">*</span><span style="color:rgb(204,102,0); font-family:SimSun; font-size:14px; line-height:20px; white-space:pre-wrap"><strong>got_packet_ptr</strong></span><span class="darkred" style="font-weight:bold; color:rgb(204,102,0); font-family:SimSun; font-size:14px; line-height:20px; white-space:pre-wrap; background-color:white">);</span></p> 
<p><span style="font-size:18px">   在avcodec.h中当然也必须更改REGISTER_DECODER(MLP,mlp)更改为REGISTER_ENCDEC(MLP, mlp).</span></p> 
<p><span style="font-size:18px">    有测试过的同学也发现这个mlp编码器并不能在ts或m2ts中进行复用流的编码，这是因为在复合流中使用的是其复杂形式，名称为trueHD.</span></p> 
<p><span style="font-size:18px">    所以在同步头中还应根据mlp还是trueHD作一点更改，当然这一点根据只能编码出trueHD的裸流音频。</span></p> 
<p><span style="font-size:18px">    如果直接使用-i filename -avcodec truehd -ac2 outpath/outname.m2ts，播放时会没有声音，这是为什么呢？</span></p> 
<p><span style="font-size:18px">    这是因为在ffmpeg中并没有对turehd的流进行标识，正确的做法是在节目表中写入truehd的标识0x83，如此便能成功。</span></p> 
<p><span style="font-size:18px">    补充说明:mlp的fourCC('M','L','P',' ' ), trueHD的fourCC('T','R','H','D').</span></p> 
<p>    </p> 
<p>    </p> 
<p>   </p> 
<p>   </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d47afd65659b378388185cd3ac11fa75/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">程序员——伤不起的三十岁</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ed036bb4c2fd30945a622f5775531a01/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Nginx出现“ 413 （499 502 404）  Request Entity Too Large”错误解决方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>