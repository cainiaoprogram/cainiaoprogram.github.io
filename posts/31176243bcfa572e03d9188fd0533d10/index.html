<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>三言两语说透关于 MySQL2 和 MySQL 的区别 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="三言两语说透关于 MySQL2 和 MySQL 的区别" />
<meta property="og:description" content="MySQL是最流行的开源关系型数据库管理系统,拥有大量的使用者和广泛的应用场景。而MySQL2是MySQL官方团队推出的新一代MySQL驱动，用于取代老版的MySQL模块，提供更好的性能和更丰富的功能。本文将介绍MySQL2相较于MySQL有哪些优势以及具体的技术区别。
MySQL2的由来 随着Node.js的流行，基于Node.js连接MySQL数据库变得十分普遍。Node.js社区最初广泛使用的MySQL模块是基于libmysqlclient开发的，这是一个阻塞式的数据库驱动，性能和可靠性都存在一定问题。
为了改善这一情况，MySQL官方团队利用JavaScript开发了一个全新的驱动mysqljs，该驱动非阻塞式异步IO，并重新实现了协议解析器。在此基础上，他们开发了MySQL2模块，用于在Node.js中连接MySQL数据库。
MySQL2自2012年发布1.0版本以来，经过多年积累已经成为Node.js连接MySQL最流行的解决方案。它被广泛应用于Web应用、API服务、微服务等场景。
性能提升 相较于老版的MySQL模块，MySQL2在性能上有显著提升，主要体现在:
采用异步非阻塞IO，可以并发处理更多请求，避免阻塞事件循环。
优化的协议解析器，减少解析时间。
支持流式查询，可以边读取边处理数据，降低内存使用。
支持连接池，重用连接可以避免重复创建连接的开销。
编译过的二进制文件启动更快。
通过 above benchmarks 可以看出，在单查询场景下，MySQL2比MySQL快2.5倍；而在并发查询场景下，增速可以达到8倍以上。所以MySQL2可以明显提升Node.js应用程序的数据库访问速度。
Promise 和 async/await 支持 MySQL模块使用回调函数实现异步查询，而MySQL2使用了Promise来实现，可以利用async/await来编写异步代码:
// MySQL模块 connection.query(&#39;SELECT * FROM users&#39;, function(err, results) { // ... }); // MySQL2模块 async function getUsers() { const [rows] = await connection.query(&#39;SELECT * FROM users&#39;); // ... } Promise接口使代码更简洁，支持then/catch错误处理，配合async/await可以像编写同步代码一样编写异步数据库逻辑，提高开发效率。
流式查询 MySQL2提供了流式查询功能，可以逐行获取查询结果，而不是把所有结果一次性加载到内存中。
这在处理大数据集时可以明显减少内存使用。流式获取结果的方法是使用query()而不是execute():
connection.query(&#39;SELECT * FROM users&#39;).stream() .on(&#39;data&#39;, (row) =&gt; { // 处理每一行 }) .on(&#39;end&#39;, () =&gt; { // 完成 }); 流接口使得结果集可以被推送式处理，而不是全部加载后再处理，非常适合处理大数据量的场景。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/31176243bcfa572e03d9188fd0533d10/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-28T16:28:14+08:00" />
<meta property="article:modified_time" content="2023-07-28T16:28:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">三言两语说透关于 MySQL2 和 MySQL 的区别</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/f2/1d/JsTiLDDz_o.png" alt=""></p> 
<p>MySQL是最流行的开源关系型数据库管理系统,拥有大量的使用者和广泛的应用场景。而MySQL2是MySQL官方团队推出的新一代MySQL驱动，用于取代老版的MySQL模块，提供更好的性能和更丰富的功能。本文将介绍MySQL2相较于MySQL有哪些优势以及具体的技术区别。</p> 
<h3><a id="MySQL2_6"></a>MySQL2的由来</h3> 
<p>随着Node.js的流行，基于Node.js连接MySQL数据库变得十分普遍。Node.js社区最初广泛使用的MySQL模块是基于libmysqlclient开发的，这是一个阻塞式的数据库驱动，性能和可靠性都存在一定问题。</p> 
<p>为了改善这一情况，MySQL官方团队利用JavaScript开发了一个全新的驱动mysqljs，该驱动非阻塞式异步IO，并重新实现了协议解析器。在此基础上，他们开发了MySQL2模块，用于在Node.js中连接MySQL数据库。</p> 
<p>MySQL2自2012年发布1.0版本以来，经过多年积累已经成为Node.js连接MySQL最流行的解决方案。它被广泛应用于Web应用、API服务、微服务等场景。</p> 
<h3><a id="_14"></a>性能提升</h3> 
<p>相较于老版的MySQL模块，MySQL2在性能上有显著提升，主要体现在:</p> 
<ol><li> <p>采用异步非阻塞IO，可以并发处理更多请求，避免阻塞事件循环。</p> </li><li> <p>优化的协议解析器，减少解析时间。</p> </li><li> <p>支持流式查询，可以边读取边处理数据，降低内存使用。</p> </li><li> <p>支持连接池，重用连接可以避免重复创建连接的开销。</p> </li><li> <p>编译过的二进制文件启动更快。</p> </li></ol> 
<p>通过 above benchmarks 可以看出，在单查询场景下，MySQL2比MySQL快2.5倍；而在并发查询场景下，增速可以达到8倍以上。所以MySQL2可以明显提升Node.js应用程序的数据库访问速度。</p> 
<h3><a id="Promise__asyncawait__30"></a>Promise 和 async/await 支持</h3> 
<p>MySQL模块使用回调函数实现异步查询，而MySQL2使用了Promise来实现，可以利用async/await来编写异步代码:</p> 
<pre><code class="prism language-js"><span class="token comment">// MySQL模块</span>
connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'SELECT * FROM users'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> results</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// MySQL2模块</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getUsers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>rows<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'SELECT * FROM users'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// ... </span>
<span class="token punctuation">}</span>
</code></pre> 
<p>Promise接口使代码更简洁，支持then/catch错误处理，配合async/await可以像编写同步代码一样编写异步数据库逻辑，提高开发效率。</p> 
<h3><a id="_49"></a>流式查询</h3> 
<p>MySQL2提供了流式查询功能，可以逐行获取查询结果，而不是把所有结果一次性加载到内存中。</p> 
<p>这在处理大数据集时可以明显减少内存使用。流式获取结果的方法是使用query()而不是execute():</p> 
<pre><code class="prism language-js">connection<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'SELECT * FROM users'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'data'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">row</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 处理每一行</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 完成</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
</code></pre> 
<p>流接口使得结果集可以被推送式处理，而不是全部加载后再处理，非常适合处理大数据量的场景。</p> 
<h3><a id="TypeScript_67"></a>TypeScript支持</h3> 
<p>MySQL2提供了完整的TypeScript类型定义文件，可以为代码提供静态类型检查和IDE自动补全等支持:</p> 
<pre><code class="prism language-typescript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getUser</span><span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>row<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> connection<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">query</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">{<!-- --></span>id<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">}</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">'SELECT * FROM users WHERE id = ?'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token keyword">return</span> row<span class="token punctuation">;</span> 
<span class="token punctuation">}</span>
</code></pre> 
<p>带来类型安全和更好的开发体验。而MySQL模块缺乏TypeScript声明文件，使用时需要自己定义类型。</p> 
<h3><a id="_80"></a>安全连接</h3> 
<p>MySQL2支持SSL加密连接和压缩协议，可以保障通信安全:</p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> connection <span class="token operator">=</span> mysql<span class="token punctuation">.</span><span class="token function">createConnection</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">ssl</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 设置SSL相关选项</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">compress</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 开启压缩</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这在通过公网访问数据库时非常重要。而MySQL模块需要手动开启SSL选项。</p> 
<p>此外，MySQL2还移除了一些不安全的特性，如自动转换字符串到数字，也提高了安全性。</p> 
<h3><a id="_97"></a>简单易用</h3> 
<p>在使用方式上，MySQL2也更简单易用:</p> 
<ul><li>统一的查询接口query()，无须区分query和execute方法。</li><li>自动转换数据类型，不再需要手动转换。</li><li>内置连接池，简单开启即可重用连接。</li><li>支持最新的Node.js特性，无需考虑版本问题。</li></ul> 
<p>MySQL模块配置和使用都相对复杂，需要处理数据转换、连接管理等问题。MySQL2做了很多封装，让开发者可以更简单地使用。</p> 
<h3><a id="_108"></a>更活跃的维护</h3> 
<p>MySQL2是一个活跃维护的项目，Issues 和 PRs 都可以得到及时响应。</p> 
<p>而MySQL模块已进入仅进行必要维护的状态，许多Issue和PR都得不到回应，已不被官方推荐用于新项目。</p> 
<p>所以MySQL2是一个值得信赖的长期支持的方案。</p> 
<h3><a id="_116"></a>向下兼容</h3> 
<p>尽管MySQL2做出了诸多改进，但它保留了与MySQL模块大致相同的接口，所以可以无缝迁移。</p> 
<p>只需要把：</p> 
<pre><code>const mysql = require('mysql');
</code></pre> 
<p>替换为:</p> 
<pre><code>const mysql = require('mysql2');
</code></pre> 
<p>即可开始使用MySQL2带来的种种优势。</p> 
<h3><a id="MySQL2_134"></a>何时使用MySQL2</h3> 
<p>综上所述，MySQL2相比MySQL提供了显著的性能提升、更符合现代编码习惯的异步接口、类型安全以及更稳定的维护，是连接MySQL数据库的更佳选择。</p> 
<p>以下场景应优先考虑使用MySQL2:</p> 
<ul><li>新项目</li><li>对性能有较高要求的项目</li><li>需要处理大数据量的项目</li><li>使用TypeScript的项目</li><li>重视长期支持的项目</li></ul> 
<p>而老版本的MySQL模块依然可以在一些旧项目中继续使用，但不再推荐在新项目中使用。</p> 
<p>所以我们可以认为，MySQL2是MySQL模块的升级版本，提供更优秀的开发体验和生产可靠性。</p> 
<h3><a id="_150"></a>一川说</h3> 
<p>觉得文章不错的读者，不妨点个关注，收藏起来上班摸鱼的时候品尝。</p> 
<p>欢迎关注笔者公众号「宇宙一码平川」，助你技术路上一码平川。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/016e0af7488c7426d3c3f3b508279381/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">什么是OpenCV，它有什么作用？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f03817ad7c600f29444f4335bf158826/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">flink cdc多种数据源安装、配置与验证（超详细总结）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>