<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Groovy入门学习[脚本编程入门] - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Groovy入门学习[脚本编程入门]" />
<meta property="og:description" content="文章目录 1 注释和变量定义2 数据类型及方法2.1 运算符2.2 数值2.3 字符串-不可变对象2.4 列表2.5 映射2.6 range-范围 3 正则表达式4 输入输出5 自定义方法6 内置方法7 流程控制7.1 while7.2 for7.3 if7.4 switch7.5 循环关键字:break/continue 8 闭包 closure9 文件和命令行参数10 解析 XML11 执行本地命令12 获取Gerrit仓库分支 Apache Groovy is a powerful, optionally typed and dynamic language, with static-typing and static compilation capabilities, for the Java platform aimed at improving developer productivity thanks to a concise, familiar and easy to learn syntax. It integrates smoothly with any Java program, and immediately delivers to your application powerful features, including scripting capabilities, Domain-Specific Language authoring, runtime and compile-time meta-programming and functional programming." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9d6c485b13cd63eda19c478dc9bbda23/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-07T16:28:53+08:00" />
<meta property="article:modified_time" content="2023-10-07T16:28:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Groovy入门学习[脚本编程入门]</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1__24" rel="nofollow">1 注释和变量定义</a></li><li><a href="#2__77" rel="nofollow">2 数据类型及方法</a></li><li><ul><li><a href="#21__89" rel="nofollow">2.1 运算符</a></li><li><a href="#22__112" rel="nofollow">2.2 数值</a></li><li><a href="#23__121" rel="nofollow">2.3 字符串-不可变对象</a></li><li><a href="#24__174" rel="nofollow">2.4 列表</a></li><li><a href="#25__194" rel="nofollow">2.5 映射</a></li><li><a href="#26_range_241" rel="nofollow">2.6 range-范围</a></li></ul> 
  </li><li><a href="#3__265" rel="nofollow">3 正则表达式</a></li><li><a href="#4__301" rel="nofollow">4 输入输出</a></li><li><a href="#5__347" rel="nofollow">5 自定义方法</a></li><li><a href="#6__402" rel="nofollow">6 内置方法</a></li><li><a href="#7__525" rel="nofollow">7 流程控制</a></li><li><ul><li><a href="#71_while_531" rel="nofollow">7.1 while</a></li><li><a href="#72_for_549" rel="nofollow">7.2 for</a></li><li><a href="#73_if_579" rel="nofollow">7.3 if</a></li><li><a href="#74_switch_606" rel="nofollow">7.4 switch</a></li><li><a href="#75_breakcontinue_627" rel="nofollow">7.5 循环关键字:break/continue</a></li></ul> 
  </li><li><a href="#8__closure_631" rel="nofollow">8 闭包 closure</a></li><li><a href="#9__762" rel="nofollow">9 文件和命令行参数</a></li><li><a href="#10__XML_942" rel="nofollow">10 解析 XML</a></li><li><a href="#11__1008" rel="nofollow">11 执行本地命令</a></li><li><a href="#12_Gerrit_1257" rel="nofollow">12 获取Gerrit仓库分支</a></li></ul> 
</div> 
<p></p> 
<p><img src="https://images2.imgbox.com/29/a6/dRabTQs7_o.jpg" alt="Groovy图标"><br> Apache Groovy is a powerful, optionally typed and dynamic language, with static-typing and static compilation capabilities, for the Java platform aimed at improving developer productivity thanks to a concise, familiar and easy to learn syntax. It integrates smoothly with any Java program, and immediately delivers to your application powerful features, including scripting capabilities, Domain-Specific Language authoring, runtime and compile-time meta-programming and functional programming.</p> 
<p>看官网图标就不简单，这门语言及其特殊，综合多门语言的语法特点，既能用编译型语言的语法书写，也能按脚本语言的语法书写，即有编程语言风格，也有脚本语言特色。使用脚本式风格属性，还可以用不同风格方式表达。继承了Java语言，理论上使用Java写的，Groovy也能正常编译通过。貌似编译是Java编译，先把Groovy转换成Java后再编译。</p> 
<p>官网文档：<a href="http://www.groovy-lang.org/documentation.html" rel="nofollow">Apache Groovy<br> </a></p> 
<p>使用 <code>-D file.encoding</code> 参数来设置脚本的默认编码</p> 
<pre><code>groovy -D file.encoding=UTF-8  .\test.groovy

脚本中获取编码:
println("Default encoding is: " + System.getProperty("file.encoding"))
</code></pre> 
<p>怎么查看数据类型</p> 
<pre><code>def myVar = "Hello"
println(myVar.getClass())
</code></pre> 
<h2><a id="1__24"></a>1 注释和变量定义</h2> 
<p>注释分单行注释和多行注释</p> 
<pre><code>单行注释://
多行注释:/* ... */
</code></pre> 
<p><strong>使用 def 定义变量的时候,会自动转换为对应类型</strong></p> 
<p><strong>引用变量不存在会报错</strong>:println(var)/println(“${var}”)</p> 
<p>变量定义<br> 自动识别:<br> def x = 5<br> def y = “hello world”</p> 
<p>指定变量类型,如:Boolean, BigDecimal, Integer, Float, Double, String, ArrayList(List), LinkedHashMap(Map), <strong>指定了变量类型不能把其他类型的值赋值给它 !!</strong><br> 数值:Integer/BigDecimal</p> 
<p>示例:</p> 
<pre><code class="prism language-groovy">Boolean a <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"true"</span></span>
BigDecimal b <span class="token operator">=</span> <span class="token number">20</span>
Integer c <span class="token operator">=</span> <span class="token number">30</span>
Integer c1 <span class="token operator">=</span> <span class="token number">30.8</span>  <span class="token comment">// 会自动转换为整形</span>
Float d <span class="token operator">=</span> <span class="token number">12.8</span>
String e <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"ok"</span></span>
List f <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span>
Map g <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token interpolation-string"><span class="token string">"name"</span></span><span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">"star"</span></span><span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">"age"</span></span><span class="token punctuation">:</span> <span class="token number">18</span><span class="token punctuation">]</span>
Double h <span class="token operator">=</span> <span class="token number">12.346</span>

<span class="token function">println</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token function">println</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
<span class="token function">println</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token function">println</span><span class="token punctuation">(</span>c1<span class="token punctuation">)</span>
<span class="token function">println</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
<span class="token function">println</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token function">println</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token function">println</span><span class="token punctuation">(</span>g<span class="token punctuation">)</span>
<span class="token function">println</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span>

<span class="token comment">// true</span>
<span class="token comment">// 20</span>
<span class="token comment">// 30</span>
<span class="token comment">// 30</span>
<span class="token comment">// 12.8</span>
<span class="token comment">// ok</span>
<span class="token comment">// [1, 2, 3]</span>
<span class="token comment">// [name:star, age:18]</span>
<span class="token comment">// 12.346</span>

</code></pre> 
<h2><a id="2__77"></a>2 数据类型及方法</h2> 
<p>Groovy 支持以下数据类型：</p> 
<ol><li>基本数据类型：byte、short、int、long、float、double、boolean、char</li><li>对象数据类型：String、BigDecimal、BigInteger、Date、Time、Timestamp、File、URL、Map、List、Set、Range、Pattern、Matcher、Closure、Class、Object 等</li><li>特殊数据类型：null、void</li></ol> 
<p>需要注意的是，Groovy 是一种动态类型语言，变量的数据类型可以在运行时动态改变。因此，Groovy 的数据类型比 Java 更加灵活。</p> 
<p>类型:数值/字符串/列表/映射/范围(数组 def tup = (1…5))</p> 
<p>定义布尔类型:boolean result = 3 &gt; 5</p> 
<h3><a id="21__89"></a>2.1 运算符</h3> 
<p>算术运算符:加减乘除取模<br> 赋值运算符:= += -= *= /=<br> 自增自减运算符:++ –<br> 关系运算符:大于/大于等于/小于/小于等于<br> 等于运算符:等于== 不等于!= ,计算结果是布尔值. <code>&lt;=&gt;</code> 符号 <code>"hello"&lt;=&gt;"hellq"</code> 值为-1, <code>5&lt;=&gt;6</code> 值为-1, <code>5&lt;=&gt;2</code> 值为 1,也就是前面与后面比较,大于就是 1,小于就是-1,等于就是 0<br> 逻辑运算符:</p> 
<pre><code>println(! (3 &gt; 5))      // true
println( 3 &gt; 2 &amp;&amp; 3 &gt; 5) // false
println( 3 &gt; 2 || 3 &gt;5)  // true
</code></pre> 
<p>三元运算符(条件运算符):</p> 
<pre><code>println( false?false:true)
println(3&lt;2?false:3&gt;5?true:false) // 3&lt;2 是false,false取冒号后面的值,(冒号后面计算3&gt;5?true:false,3&gt;5是false,取fasle)
println(3&lt;2?false:3&lt;5?true:false)
// true
// false
// true
</code></pre> 
<h3><a id="22__112"></a>2.2 数值</h3> 
<p>整数:正数/零/负数<br> 浮点数:正/负浮点数</p> 
<p>整数运算符:加减乘除/取模<br> 浮点数运算符:加减乘除<br> 整数与浮点数:加减乘除</p> 
<h3><a id="23__121"></a>2.3 字符串-不可变对象</h3> 
<p>使用引号将字符串包裹起来,可以使用单引号/双引号/三引号,三引号可以包含多行文本<br> <strong>注意:</strong> 跟 shell 一样,使用$引用变量,<strong>单引号不会解释变量</strong></p> 
<p>字符串索引:<br> <code>索引从 0 开始,var[3]/var[-1],var[1..3]是 1 到 3 包含 3,var[1..&lt;3]不包含 3,var[4..2]反向,var[2,1,6]取第 2/1/6 个字符</code></p> 
<p>基本操作:<br> 数学符号:加减乘</p> 
<p>比较字符串: 等于/不等于/<code>&lt;=&gt;</code></p> 
<p>基本函数:<br> .size() 字符个数<br> .length() 字符长度,2 个含义相同<br> .count(‘x’) 统计 x 的数量<br> .contains(“hello”) 返回布尔值,是否包含 hello<br> .center(字符串,填充符号)<br> .compareToIgnoreCase(字符串) 跟字符串比较大小,按词典顺序比较,返回整形<br> .endsWith(字符串)<br> .equalsIgnoreCase(字符串) 返回 bool 值<br> .matches(正则) 全部匹配才返回 true<br> .replaceAll(正则,闭包函数)<br> .reverse()反转<br> .split(正则)<br> .strim() 去除字符串前后空格<br> .substring(开始,结束)<br> .toCharacter<br> .toDouble<br> .toFloat<br> .toInteger<br> .toLong<br> .toLowerCase<br> .toUpperCase<br> .tokenize()空格作为字符串分隔符,或传参给定字符串<br> .readLines(字符串)<br> .eachLine(闭包函数) eachLine(字符串,闭包函数)<br> eachLine 示例:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> func <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>v <span class="token operator">-&gt;</span> print v<span class="token punctuation">}</span>

<span class="token keyword">def</span> s <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"""hello
world
nice\n"""</span></span>

func <span class="token interpolation-string"><span class="token string">"hello"</span></span>
<span class="token function">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
s<span class="token punctuation">.</span><span class="token function">eachLine</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="24__174"></a>2.4 列表</h3> 
<p><strong>重要</strong>:列表可以是任意元素的集合,数值/字符串/列表/映射/函数/对象(变量/类对象),列表跟字符串一样,索引从 0 开始</p> 
<p>列表索引跟字符串一样</p> 
<p>列表可以使用加法/减法/&lt;&lt;追加新元素</p> 
<p>列表方法:<br> .add(元素) .add(索引,元素)<br> .addAll(元素集合)<br> .contains(元素) 返回 bool 值<br> .flatten() 子元素展开形成新列表<br> .getAt(索引) .getAt(range 对象)返回多个元素的列表 .getAt(指定多个子元素索引)<br> .intersect(列表) 交集<br> .isEmpty() 返回 bool 值<br> .pop() 删除最后一个元素<br> .remove(索引/元素值) 整数默认是索引,字符串或者其他默认是元素值<br> .size() 元素个数<br> .sort() 排序</p> 
<h3><a id="25__194"></a>2.5 映射</h3> 
<p>示例:</p> 
<pre><code class="prism language-groovy"><span class="token punctuation">[</span><span class="token interpolation-string"><span class="token string">"name"</span></span><span class="token punctuation">:</span><span class="token interpolation-string"><span class="token string">"star"</span></span><span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">"age"</span></span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token interpolation-string"><span class="token string">"name"</span></span><span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">"age"</span></span><span class="token punctuation">]</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> x <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">def</span> y <span class="token operator">=</span> <span class="token number">2</span>
<span class="token keyword">def</span> m <span class="token operator">=</span> <span class="token punctuation">[</span>x<span class="token punctuation">:</span>y<span class="token punctuation">,</span>y<span class="token punctuation">:</span>x<span class="token punctuation">]</span> 键是变量不会解析<span class="token punctuation">,</span>值是变量会解析变量
<span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span> # <span class="token punctuation">[</span>x<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">]</span>

引用方法<span class="token punctuation">:</span>m<span class="token punctuation">.</span>x<span class="token punctuation">,</span>m<span class="token punctuation">[</span><span class="token interpolation-string"><span class="token string">"x"</span></span><span class="token punctuation">]</span>
</code></pre> 
<p>方法:<br> .containsKey(键) 返回 bool 值<br> .get(键) 键不存在返回空, .get(键,默认值)<br> .keySet() 获取所有键集合,列表类型<br> .put(键,值)添加元素<br> .size()返回键值对个数<br> .values() 所有的值集合,collection 类型(List 也是集合类型一种), values().asList()返回列表</p> 
<p>列表和映射的联合应用:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> library <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token interpolation-string"><span class="token string">"Ken"</span></span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token interpolation-string"><span class="token string">"Groovy"</span></span><span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">"UML"</span></span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token interpolation-string"><span class="token string">"John"</span></span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token interpolation-string"><span class="token string">"Java"</span></span><span class="token punctuation">]</span>
<span class="token punctuation">]</span>

library<span class="token punctuation">[</span><span class="token interpolation-string"><span class="token string">"Sally"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token interpolation-string"><span class="token string">"Basic"</span></span><span class="token punctuation">]</span>
library<span class="token punctuation">[</span><span class="token interpolation-string"><span class="token string">"John"</span></span><span class="token punctuation">]</span> <span class="token operator">=</span> library<span class="token punctuation">[</span><span class="token interpolation-string"><span class="token string">"John"</span></span><span class="token punctuation">]</span><span class="token operator">&lt;&lt;</span><span class="token interpolation-string"><span class="token string">"Golang"</span></span>
<span class="token function">println</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"library: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">library</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
println <span class="token interpolation-string"><span class="token string">"Ken has borrowed UML? </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">library<span class="token punctuation">[</span><span class="token string">'Ken'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">'UML'</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span>
println <span class="token interpolation-string"><span class="token string">"borrowers number: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">library<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span> 
println <span class="token interpolation-string"><span class="token string">"borrowers:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">library<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span> 
println <span class="token interpolation-string"><span class="token string">"Ken borrowed books:${library["</span></span>Ken<span class="token interpolation-string"><span class="token string">"]}"</span></span> 
println <span class="token interpolation-string"><span class="token string">"library values: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">library<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span>

<span class="token comment">// library: [Ken:[Groovy, UML], John:[Java, Golang], Sally:[Basic]]</span>
<span class="token comment">// Ken has borrowed UML? true</span>
<span class="token comment">// borrowers number: 3</span>
<span class="token comment">// borrowers:[John, Ken, Sally]</span>
<span class="token comment">// Ken borrowed books:[Groovy, UML]</span>
<span class="token comment">// library values: [[Groovy, UML], [Java, Golang], [Basic]]</span>
</code></pre> 
<h3><a id="26_range_241"></a>2.6 range-范围</h3> 
<p>示例:</p> 
<pre><code>1..100
1..&lt;10
"a".."z"
10..1
"Z".."X"
1..5+3
</code></pre> 
<p>def num = 1…10<br> 举例:num.size()</p> 
<p>方法:<br> .contains(元素) 返回 bool 值<br> .get(索引)<br> .getFrom() 获取第一个值<br> .getTo() 获取最后一个值<br> .isReverse() 是否逆序,bool 值<br> .size() 长度<br> .subList(from,to) 返回列表</p> 
<h2><a id="3__265"></a>3 正则表达式</h2> 
<p>定义正则:def reg =~ “hello”<br> 部分匹配:=~<br> 全部匹配:==~</p> 
<p>元字符:</p> 
<pre><code>^ $ . * + ? {} []字符集 [^]非字符集 
(ab)*,ab出现任意次数 (a|b)*,a或b出现任意次数
元字符匹配要转义两个反斜杠\\ ,如:def reg =~ "\\.txt"
斜杆/包裹正则只需要单个斜杆,如: def reg =~ /\.txt/,含义同上
</code></pre> 
<p>转义: <code>\w</code> 单词字符, <code>\d</code> 数字, <code>\s</code> 空字符, <code>\W</code> 非单词字符, <code>\D</code> 非数字, <code>\S</code> 非空白字符</p> 
<p>正则案例:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>*

<span class="token keyword">def</span> s <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"--11star 10:20PM"</span></span>

<span class="token keyword">def</span> pt <span class="token operator">=</span> <span class="token string">'(\\w+)\\s+((\\d{1,2}):(\\d{2})([AP]M))'</span>

<span class="token keyword">def</span> matcher1 <span class="token operator">=</span> s <span class="token operator">=~</span> pt
<span class="token function">println</span><span class="token punctuation">(</span>matcher1<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 要整行匹配才是true,不是整行匹配可以输出matcher1[0]</span>
<span class="token function">println</span><span class="token punctuation">(</span>matcher1<span class="token punctuation">)</span>
<span class="token function">println</span><span class="token punctuation">(</span>matcher1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token function">println</span><span class="token punctuation">(</span>matcher1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// false</span>
<span class="token comment">// java.util.regex.Matcher[pattern=(\w+)\s+((\d{1,2}):(\d{2})([AP]M)) region=0,16 lastmatch=]</span>
<span class="token comment">// [11star 10:10PM, 11star, 10:10PM, 10, 10, PM]  // matcher1[0]是全部,1是第一个括号,2是后面的外边括号,3/4/5是里面的小括号</span>
<span class="token comment">// PM</span>
</code></pre> 
<h2><a id="4__301"></a>4 输入输出</h2> 
<p>print 输出不换号,print(“hello”) print “hello”,2 种写法,函数式和闭包式,可以输出任意类型的值<br> println 输出换行<br> <code>print("hello world")</code><br> <code>print("hello \n world")</code></p> 
<p>格式化输出:printf<br> 示例:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> a <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"name"</span></span>
<span class="token keyword">def</span> b <span class="token operator">=</span> <span class="token number">18</span>
<span class="token keyword">def</span> c <span class="token operator">=</span> <span class="token number">60.8</span> <span class="token comment">// 在def定义的时候自动转换为对应类型,如果是60会报错</span>

<span class="token function">printf</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"name is %s,age is %d, weight is %.2f"</span></span><span class="token punctuation">,</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">]</span><span class="token punctuation">)</span>

name is name<span class="token punctuation">,</span>age is <span class="token number">18</span><span class="token punctuation">,</span> weight is <span class="token number">60.80</span>
</code></pre> 
<p>字符串格式化: %20s,%-20s(文字靠左)</p> 
<p><strong>基本输入</strong>:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> System<span class="token punctuation">.</span><span class="token function">console</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"请输入名字:"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">getInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> System<span class="token punctuation">.</span><span class="token function">console</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"your age:"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> System<span class="token punctuation">.</span><span class="token function">console</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"your weight:"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toDouble</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> name <span class="token operator">=</span> <span class="token function">getString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> age <span class="token operator">=</span> <span class="token function">getInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> weight <span class="token operator">=</span> <span class="token function">getWeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">println</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"your name:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string">, age: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">age</span></span><span class="token string">, weight: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">weight</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment">// PS D:\my_document\vscode-project&gt; groovy -D file.encoding=UTF-8  .\test.groovy </span>
<span class="token comment">// 请输入名字:star</span>
<span class="token comment">// your age:18</span>
<span class="token comment">// your weight:60</span>
<span class="token comment">// your name:star, age: 18, weight: 60.0</span>
</code></pre> 
<h2><a id="5__347"></a>5 自定义方法</h2> 
<p>简单输出:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> <span class="token function">greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    println <span class="token interpolation-string"><span class="token string">"hello world"</span></span>
<span class="token punctuation">}</span>

<span class="token function">greeting</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 多行语句可以分号隔开 print "hello";print " ";print "world"</span>
</code></pre> 
<p>内置变量:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">def</span> name <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"star"</span></span>
    <span class="token keyword">def</span> age <span class="token operator">=</span> <span class="token number">18</span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"my name is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string">, age is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">age</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>外部传参:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> <span class="token function">info</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"my name is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string">, age is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">age</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">info</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"star"</span></span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>
</code></pre> 
<p>默认参数:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> <span class="token function">info</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"my name is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string">, age is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">age</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">info</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"star"</span></span><span class="token punctuation">)</span>
</code></pre> 
<p>函数返回值:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> <span class="token function">info</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token interpolation-string"><span class="token string">"my name is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">name</span></span><span class="token string">, age is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">age</span></span><span class="token string">"</span></span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> s <span class="token operator">=</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"star"</span></span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span>
<span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="6__402"></a>6 内置方法</h2> 
<p>assert(3 == 5),如果 bool 值为 FALSE,则断言失败,抛出异常</p> 
<p><strong>upto 方法</strong>:数字序列迭代</p> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> sum <span class="token operator">=</span> <span class="token number">0</span>
<span class="token number">1</span><span class="token punctuation">.</span><span class="token function">upto</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>n <span class="token operator">-&gt;</span> sum <span class="token operator">+=</span> n<span class="token punctuation">}</span>
<span class="token function">println</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span>
</code></pre> 
<p><strong>each 方法</strong>:集合/字符串/列表/映射</p> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> s <span class="token operator">=</span> <span class="token string">''</span>
<span class="token interpolation-string"><span class="token string">"hello"</span></span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>it <span class="token operator">-&gt;</span> s <span class="token operator">+=</span> it<span class="token punctuation">;</span>s <span class="token operator">+=</span> <span class="token interpolation-string"><span class="token string">"-"</span></span><span class="token punctuation">}</span>
<span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>


<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>it <span class="token operator">-&gt;</span> println it<span class="token punctuation">}</span>

<span class="token keyword">def</span> m <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token interpolation-string"><span class="token string">"Ken"</span></span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">"Sally"</span></span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">]</span>
m<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>it <span class="token operator">-&gt;</span> println it<span class="token punctuation">}</span>
m<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>it <span class="token operator">-&gt;</span> <span class="token function">println</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">it<span class="token punctuation">.</span>key</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> age is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">it<span class="token punctuation">.</span>value</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span>

<span class="token comment">// h-e-l-l-o-</span>
<span class="token comment">// 1</span>
<span class="token comment">// 2</span>
<span class="token comment">// 3</span>
<span class="token comment">// 4</span>
<span class="token comment">// Ken=18</span>
<span class="token comment">// Sally=20</span>
<span class="token comment">// Ken age is 18</span>
<span class="token comment">// Sally age is 20</span>
</code></pre> 
<p>each 配合 if 条件语句:</p> 
<pre><code>[1,2,3,4].each(){it -&gt; if(it%2 ==0)println it}

// 2
// 4
</code></pre> 
<p><strong>find 方法,只返回查到的第一个元素</strong>:闭包必须返回 bool 值,所有返回 true 的元素形成一个新的元素集合</p> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> lst <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span>
lst <span class="token operator">=</span> lst<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>it <span class="token operator">-&gt;</span> it <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">}</span>
<span class="token function">println</span><span class="token punctuation">(</span>lst<span class="token punctuation">)</span>

<span class="token keyword">def</span> m <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token interpolation-string"><span class="token string">"Ken"</span></span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">"John"</span></span><span class="token punctuation">:</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">"Sally"</span></span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">]</span>
<span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
m <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>it <span class="token operator">-&gt;</span> it<span class="token punctuation">.</span>value <span class="token operator">&gt;</span> <span class="token number">20</span><span class="token punctuation">}</span>
<span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>key<span class="token punctuation">)</span>

<span class="token comment">// 3</span>
<span class="token comment">// [Ken:18, John:22, Sally:24]</span>
<span class="token comment">// John=22</span>
<span class="token comment">// John</span>
</code></pre> 
<p><strong>findAll 方法,只返回查到的所有元素</strong>:闭包必须返回 bool 值,所有返回 true 的元素形成一个新的元素集合</p> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> lst <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span>
lst <span class="token operator">=</span> lst<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>it <span class="token operator">-&gt;</span> it <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token punctuation">}</span>
<span class="token function">println</span><span class="token punctuation">(</span>lst<span class="token punctuation">)</span>

<span class="token keyword">def</span> m <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token interpolation-string"><span class="token string">"Ken"</span></span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">"John"</span></span><span class="token punctuation">:</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">"Sally"</span></span><span class="token punctuation">:</span><span class="token number">24</span><span class="token punctuation">]</span>
<span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
m <span class="token operator">=</span> m<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>it <span class="token operator">-&gt;</span> it<span class="token punctuation">.</span>value <span class="token operator">&gt;</span> <span class="token number">20</span><span class="token punctuation">}</span>
<span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span>
<span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span>key<span class="token punctuation">)</span>
<span class="token function">println</span><span class="token punctuation">(</span>m<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// [3, 4]</span>
<span class="token comment">// [Ken:18, John:22, Sally:24]</span>
<span class="token comment">// [John:22, Sally:24]</span>
<span class="token comment">// null</span>
<span class="token comment">// [John, Sally]</span>
</code></pre> 
<p><strong>any 方法</strong>:每个元素迭代使用闭包函数返回值,类型为 bool,任意一个返回 true 则表达式为真,否则为假</p> 
<pre><code>def lst = [1,2,3,4]
def b = 'hello'
println(b)
b = lst.any(){it -&gt; it &gt; 0}  // b可以重新复制为布尔类型
println(b)
</code></pre> 
<p><strong>every 方法</strong>:每个元素迭代使用闭包函数返回值,类型为 bool,所有元素返回 true 则表达式为真,否则为假</p> 
<pre><code>def lst = [1,2,3,4]
def b = 'hello'
println(b)
b = lst.every(){it -&gt; it &gt; 0}
println(b)
b = lst.every(){it -&gt; it &gt; 3}
println(b)
</code></pre> 
<p><strong>collect 方法</strong>:所有元素经过闭包函数运算后,返回同样长度的新列表,类似于 Python 的 map 函数</p> 
<pre><code>def lst = [1,2,3,4]
lst = lst.collect(){it -&gt; it * it}
println(lst)

// [1, 4, 9, 16]
</code></pre> 
<p><strong>inject 方法</strong>:把集合的第一个元素和第二个元素通过闭包计算,返回的结果再与第三个元素计算,以此类推,最后返回总的计算结果</p> 
<pre><code>def lst = [1,2,3,4]

def sum = lst.inject(){previous, element -&gt; previous + element}
println(sum)  // 10
</code></pre> 
<h2><a id="7__525"></a>7 流程控制</h2> 
<p>三种流程控制结构:</p> 
<ul><li>顺序</li><li>选择</li><li>迭代</li></ul> 
<h3><a id="71_while_531"></a>7.1 while</h3> 
<p>基本结构:</p> 
<pre><code>while(condition){
	statement 1
	statement 2
}

def LIMIT = 5
def count = 1
while(count &lt;= LIMIT){
    println count
    count++
}

</code></pre> 
<h3><a id="72_for_549"></a>7.2 for</h3> 
<p>循环可以是某个范围/集合(列表/映射/数组)<br> 示例:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">for</span><span class="token punctuation">(</span>count <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">..</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    println count
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span>var <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'world'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    println var
<span class="token punctuation">}</span>

<span class="token keyword">def</span> staff <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token interpolation-string"><span class="token string">"Ken"</span></span><span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token interpolation-string"><span class="token string">"John"</span></span><span class="token punctuation">:</span><span class="token number">22</span><span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">"Sally"</span></span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> total <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span><span class="token punctuation">(</span>s <span class="token keyword">in</span> staff<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    total <span class="token operator">+=</span> s<span class="token punctuation">.</span>value
<span class="token punctuation">}</span>
<span class="token function">println</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"ages: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">total</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

</code></pre> 
<p>对数组做循环:</p> 
<pre><code>def tup = (1..5)
println(tup)
for(i in tup){
    println(i)
}
</code></pre> 
<h3><a id="73_if_579"></a>7.3 if</h3> 
<p>基本结构:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">if</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	statement <span class="token number">1</span>
<span class="token punctuation">}</span> 

<span class="token keyword">if</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	statement <span class="token number">1</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
	statement <span class="token number">2</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span><span class="token punctuation">(</span>condition1<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	statement <span class="token number">1</span>
<span class="token punctuation">}</span> 
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>condition2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	statement <span class="token number">2</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>condition3<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	statement <span class="token number">3</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
	statement <span class="token number">4</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="74_switch_606"></a>7.4 switch</h3> 
<p>基本结构:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">switch</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">case</span> express <span class="token number">1</span><span class="token punctuation">:</span>
        statement <span class="token number">1</span>
        <span class="token keyword">break</span>
    <span class="token keyword">case</span> express <span class="token number">2</span><span class="token punctuation">:</span>
        statement <span class="token number">2</span>
        <span class="token keyword">break</span>
    <span class="token keyword">case</span> express <span class="token number">3</span><span class="token punctuation">:</span>
        statement <span class="token number">3</span>
        <span class="token keyword">break</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
        statement <span class="token number">4</span>
	    <span class="token keyword">break</span>
<span class="token punctuation">}</span>

express 可以是范围<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">..</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token interpolation-string"><span class="token string">/字符串("hello")/</span></span>列表<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span>正则<span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">}</span>
</code></pre> 
<h3><a id="75_breakcontinue_627"></a>7.5 循环关键字:break/continue</h3> 
<p>break:可以用在 while/for/switch 语句中<br> continue:可以用在 while/for 循环中</p> 
<h2><a id="8__closure_631"></a>8 闭包 closure</h2> 
<p><strong>闭包函数可以直接使用外部变量,普通函数只能通过传参</strong></p> 
<p>闭包特性:</p> 
<ol><li>闭包可以当做函数使用</li><li>闭包可以作为其他函数的参数</li><li>闭包可以作为其他闭包的参数</li><li>闭包作为返回值</li><li>闭包作为列表元素</li><li>闭包可以定义在闭包函数中</li></ol> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> lst <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> isEven <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>param <span class="token operator">-&gt;</span> param<span class="token operator">%</span><span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">}</span>
<span class="token keyword">def</span> isOdd <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>param <span class="token operator">-&gt;</span> param<span class="token operator">%</span><span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">}</span>

<span class="token keyword">def</span> elem <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>num <span class="token operator">-&gt;</span> 
    <span class="token keyword">if</span><span class="token punctuation">(</span>num <span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> isEven  <span class="token comment">// 闭包作为返回值</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>num <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> isOdd
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">def</span> elemEven <span class="token operator">=</span> <span class="token function">elem</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> elemOdd <span class="token operator">=</span> <span class="token function">elem</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
lst <span class="token operator">=</span> lst<span class="token punctuation">.</span>findAll elemOdd
<span class="token function">println</span><span class="token punctuation">(</span>lst<span class="token punctuation">)</span>

<span class="token keyword">def</span> clos_list <span class="token operator">=</span> <span class="token punctuation">[</span>isEven<span class="token punctuation">,</span> isOdd<span class="token punctuation">]</span> <span class="token comment">//  闭包作为列表参数</span>
<span class="token function">println</span><span class="token punctuation">(</span>clos_list<span class="token punctuation">)</span>


<span class="token comment">// [1, 3]</span>
<span class="token comment">// [test$_run_closure1@47f4e407, test$_run_closure2@2d1dee39]</span>
</code></pre> 
<p><strong>闭包调用方法</strong>:</p> 
<pre><code>def closx = {println "hello ${it}"}

closx.call("Groovy")
closx "Groovy"
closx("Groovy")
</code></pre> 
<p>无参闭包示例:</p> 
<pre><code>def clos = {println "hello world"}
clos()
</code></pre> 
<p>有参闭包示例:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> clos <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>param <span class="token operator">-&gt;</span> println param<span class="token punctuation">}</span>
<span class="token keyword">def</span> closx <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>param <span class="token operator">-&gt;</span> <span class="token function">println</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">param</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token function">clos</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"world"</span></span><span class="token punctuation">)</span>
<span class="token function">closx</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"world"</span></span><span class="token punctuation">)</span>
</code></pre> 
<p>单个参数可以隐藏:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> clos <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>println it<span class="token punctuation">}</span>
<span class="token keyword">def</span> closx <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>println <span class="token interpolation-string"><span class="token string">"hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">it</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">}</span>
<span class="token function">clos</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"world"</span></span><span class="token punctuation">)</span>
<span class="token function">closx</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"world"</span></span><span class="token punctuation">)</span>

变量名称必须是it
</code></pre> 
<p>调用外部变量:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> var <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"hello"</span></span>
<span class="token keyword">def</span> clos <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>param <span class="token operator">-&gt;</span> println <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">var</span></span><span class="token string"> world"</span></span><span class="token punctuation">}</span>
<span class="token function">clos</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>闭包作为函数参数,闭包不会读取函数内部变量</strong>:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> greeting <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"hello"</span></span>
<span class="token keyword">def</span> closx <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>param <span class="token operator">-&gt;</span> println <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">greeting</span></span><span class="token string"> world"</span></span><span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">demo</span><span class="token punctuation">(</span>clos<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">def</span> greeting <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"nice"</span></span>
    clos<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"star"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">demo</span><span class="token punctuation">(</span>closx<span class="token punctuation">)</span>
</code></pre> 
<p>函数调用闭包几种方法:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> greeting <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"hello"</span></span>
<span class="token keyword">def</span> closx <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>param <span class="token operator">-&gt;</span> println <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">greeting</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">param</span></span><span class="token string">"</span></span><span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">demo</span><span class="token punctuation">(</span>clos<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">def</span> greeting <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"nice"</span></span>
    clos<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"star"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 第一种方法:</span>
<span class="token function">demo</span><span class="token punctuation">(</span>closx<span class="token punctuation">)</span>
<span class="token comment">// 第二种方法:</span>
demo closx
<span class="token comment">// 第三种方法:</span>
<span class="token function">demo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>param <span class="token operator">-&gt;</span> <span class="token function">println</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"good </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">param</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span>
</code></pre> 
<p>闭包高级用法:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> lst <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> doubles <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>param <span class="token operator">-&gt;</span> <span class="token number">2</span> <span class="token operator">*</span> param<span class="token punctuation">}</span>
<span class="token keyword">def</span> triples <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>param <span class="token operator">-&gt;</span> <span class="token number">3</span> <span class="token operator">*</span> param<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">map</span><span class="token punctuation">(</span>clos<span class="token punctuation">,</span> list<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> list<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>clos<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">println</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span>doubles<span class="token punctuation">,</span> lst<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">println</span><span class="token punctuation">(</span><span class="token function">map</span><span class="token punctuation">(</span>triples<span class="token punctuation">,</span> lst<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// [2, 4, 6, 8]</span>
<span class="token comment">// [3, 6, 9, 12]</span>
</code></pre> 
<h2><a id="9__762"></a>9 文件和命令行参数</h2> 
<p>获取命令行参数:</p> 
<pre><code class="prism language-groovy">println <span class="token interpolation-string"><span class="token string">"args: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">args</span></span><span class="token string">"</span></span>
println <span class="token interpolation-string"><span class="token string">"args num: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">args<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span>
println <span class="token interpolation-string"><span class="token string">"args 0: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span>

<span class="token comment">// PS D:\my_document\vscode-project&gt; groovy .\test.groovy hello world</span>
<span class="token comment">// args: [hello, world]</span>
<span class="token comment">// args num: 2</span>
<span class="token comment">// args 0: hello</span>
<span class="token comment">// PS D:\my_document\vscode-project&gt; groovy .\test.groovy "hello world"</span>
<span class="token comment">// args: [hello world]</span>
<span class="token comment">// args num: 1</span>
<span class="token comment">// args 0: hello world</span>
<span class="token comment">// PS D:\my_document\vscode-project&gt; groovy .\test.groovy "hello world" "love groovy"</span>
<span class="token comment">// args: [hello world, love groovy]</span>
<span class="token comment">// args num: 2</span>
<span class="token comment">// args 0: hello world</span>
</code></pre> 
<p><strong>文件处理方法</strong>:<br> append(字符串)将字符串追加到文件末尾<br> createNewFile() 创建一个新的空文档,当且仅当文件不存在时才能创建,返回布尔值,表示成功或失败<br> delete() 删除由路径表示的文件或目录,返回布尔值,不存在不会报错,目录不是空的无法删除,可以先用 eachFileRecurse 删除文件,再删除目录<br> eachFile(闭包函数)为指定目录的每个文件应用闭包函数<br> eachFileRecurse(闭包函数),功能同上,但是会递归去执行<br> eachLine(闭包函数)逐行遍历指定文档<br> exists() 判断指定路径是否存在文件或目录<br> getPath()将抽象路径转换为一个路径字符串,返回字符串<br> getText() 读取文本内容作为一个字符串返回<br> isDirectory()判断是否是一个目录,返回布尔值<br> mkdir()创建目录,返回布尔值<br> withPrintWriter(闭包函数)为文件创建一个新的 PrintWriter 方法,并传递给闭包,并在此确认文件是否被关闭</p> 
<p>一行一行读取文件并显示:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>File 

<span class="token keyword">if</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    println <span class="token interpolation-string"><span class="token string">"Usage: script.groovy filename"</span></span>
    System<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>eachLine <span class="token punctuation">{<!-- --></span>line <span class="token operator">-&gt;</span> 
        println <span class="token interpolation-string"><span class="token string">"Line: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">line</span></span><span class="token string">"</span></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// PS D:\my_document\vscode-project&gt; groovy .\test.groovy "utf8.txt"</span>
<span class="token comment">// Line: 这里是utf-8编码</span>
<span class="token comment">// Line: fille encoding type is utf-8</span>
<span class="token comment">// Line: 结束</span>
</code></pre> 
<p>读取文件返回字符串:</p> 
<pre><code>def s = new File(args[0]).getText()
println(s)
</code></pre> 
<p>统计文件字符数/单词数/行数:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>File


<span class="token keyword">def</span> chars <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">def</span> words <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">def</span> lines <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"utf8.txt"</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span>eachLine <span class="token punctuation">{<!-- --></span>line <span class="token operator">-&gt;</span>
    chars <span class="token operator">+=</span> line<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    words <span class="token operator">+=</span> line<span class="token punctuation">.</span><span class="token function">tokenize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    lines<span class="token operator">++</span>
<span class="token punctuation">}</span>
<span class="token function">println</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"chars:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">chars</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,words:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">words</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,lines:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$</span><span class="token expression">lines</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token comment">// chars:40,words:7,lines:3</span>
</code></pre> 
<p>列出目录下所有文件:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>File 

<span class="token keyword">def</span> <span class="token function">listDir</span><span class="token punctuation">(</span>dirFile<span class="token punctuation">,</span> indent<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    dirFile<span class="token punctuation">.</span>eachFile <span class="token punctuation">{<!-- --></span>file <span class="token operator">-&gt;</span>
        <span class="token punctuation">(</span><span class="token number">0</span><span class="token operator">..&lt;</span>indent<span class="token punctuation">)</span><span class="token punctuation">.</span>each <span class="token punctuation">{<!-- --></span>print <span class="token interpolation-string"><span class="token string">" "</span></span><span class="token punctuation">}</span>
        println <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">file<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token function">listDir</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">+</span>indent<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">printDir</span><span class="token punctuation">(</span>dirName<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">listDir</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>dirName<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span> <span class="token operator">||</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">println</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"Usage: script.groovy directory"</span></span><span class="token punctuation">)</span>
    System<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">printDir</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// PS D:\my_document\vscode-project&gt; groovy -D file.encoding=UTF-8  .\test.groovy "test\\down"</span>
<span class="token comment">// process.bat</span>
<span class="token comment">// t-link.txt.lnk</span>
<span class="token comment">// t.txt</span>
<span class="token comment">// testdir</span>
<span class="token comment">//   test.txt</span>
<span class="token comment">//   testdir2</span>
<span class="token comment">//     test2-1.txt</span>
<span class="token comment">//     test2-2.txt</span>
<span class="token comment">// 测试.txt</span>
</code></pre> 
<p>目录递归查找文件:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>File 

<span class="token keyword">def</span> <span class="token function">printDir</span><span class="token punctuation">(</span>dirName<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>dirName<span class="token punctuation">)</span><span class="token punctuation">.</span>eachFileRecurse <span class="token punctuation">{<!-- --></span>file <span class="token operator">-&gt;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> size<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            println <span class="token interpolation-string"><span class="token string">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">file<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">2</span> <span class="token operator">||</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isDirectory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    println <span class="token interpolation-string"><span class="token string">"Usage: script.groovy dirname"</span></span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">printDir</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// PS D:\my_document\vscode-project&gt; groovy -D file.encoding=UTF-8  .\test.groovy "test\\down" 80</span>
<span class="token comment">// process.bat</span>
<span class="token comment">// t-link.txt.lnk</span>
<span class="token comment">// test.txt</span>
</code></pre> 
<p>文件拷贝:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>*

<span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    println <span class="token interpolation-string"><span class="token string">"Usage: script.groovy filename1 filename2"</span></span>
    System<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">def</span> outFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>outFile<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        outFile<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">def</span> printWriter <span class="token operator">=</span> outFile<span class="token punctuation">.</span><span class="token function">newPrintWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>eachLine <span class="token punctuation">{<!-- --></span>line <span class="token operator">-&gt;</span>
        printWriter<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    printWriter<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    printWriter<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>文件拷贝方法 2:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>*

<span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    println <span class="token interpolation-string"><span class="token string">"Usage: script.groovy filename1 filename2"</span></span>
    System<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>withPrintWriter  <span class="token punctuation">{<!-- --></span>printWriter <span class="token operator">-&gt;</span>
        <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>eachLine <span class="token punctuation">{<!-- --></span>line <span class="token operator">-&gt;</span>
            printWriter<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="10__XML_942"></a>10 解析 XML</h2> 
<p>使用正则匹配获取 project 属性:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>File


<span class="token keyword">def</span> file <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"test.xml"</span></span>

<span class="token keyword">def</span> re_pt <span class="token operator">=</span> <span class="token string">'\s*&lt;project\\s+name="(\\S+)".*'</span>

<span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">.</span>eachLine <span class="token punctuation">{<!-- --></span>line <span class="token operator">-&gt;</span>
    matcher <span class="token operator">=</span> line <span class="token operator">=~</span> re_pt
    <span class="token keyword">if</span><span class="token punctuation">(</span>matcher<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        println <span class="token interpolation-string"><span class="token string">"name: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">matcher<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>示例 books.xml 文件:</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>books</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>book</span> <span class="token attr-name">isbn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1234567890<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Java Programming<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>author</span><span class="token punctuation">&gt;</span></span>John Smith<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>author</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>book</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>book</span> <span class="token attr-name">isbn</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0987654321<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Python Programming<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>author</span><span class="token punctuation">&gt;</span></span>Jane Doe<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>author</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>book</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>books</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>Jenkins 中导入以下 4 个模块无报错:</p> 
<pre><code>import groovy.xml.MarkupBuilder 
import groovy.json.JsonSlurper
import groovy.util.XmlSlurper
import groovy.util.XmlParser 
</code></pre> 
<p>解析 XML 文件</p> 
<pre><code>import groovy.util.XmlParser

def xml = new XmlParser().parse(new File('books.xml'))

xml.book.each { book -&gt;
    println "Title: ${book.title.text()}"
    println "Author: ${book.author.text()}"
    println "ISBN: ${book.@isbn}"
    println "------------------------"
}
</code></pre> 
<p>输出结果:</p> 
<pre><code>Title: Java Programming
Author: John Smith
ISBN: 1234567890
------------------------
Title: Python Programming
Author: Jane Doe
ISBN: 0987654321
------------------------
</code></pre> 
<h2><a id="11__1008"></a>11 执行本地命令</h2> 
<pre><code class="prism language-groovy"><span class="token keyword">import</span> groovy<span class="token punctuation">.</span>util<span class="token punctuation">.</span>XmlParser 
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>File 


<span class="token keyword">def</span> file <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">".repo/manifest.xml"</span></span>
file <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"/home/build/jenkins/workspace/dynamic_gerrit_paramter_build_test/t.txt"</span></span>
<span class="token keyword">def</span> prj_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">boolean</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> <span class="token boolean">true</span>
prj_list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>

<span class="token keyword">def</span> command <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'pwd'</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> processBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span>
<span class="token keyword">def</span> process <span class="token operator">=</span> processBuilder<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> line
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    prj_list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

process<span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>



<span class="token comment">// return ['master', 'feature', 'hotfix', 'develop']</span>
<span class="token keyword">return</span> prj_list
</code></pre> 
<p>Windows 执行命令:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> command <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'C:\\Windows\\System32\\cmd.exe'</span><span class="token punctuation">,</span> <span class="token string">'/c'</span><span class="token punctuation">,</span> <span class="token string">'dir'</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> processBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span>
<span class="token keyword">def</span> process <span class="token operator">=</span> processBuilder<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> line
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    println line
<span class="token punctuation">}</span>

process<span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>


第二种方法<span class="token punctuation">:</span>
<span class="token keyword">def</span> lst <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> command <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"ls -l"</span></span>
<span class="token keyword">def</span> process <span class="token operator">=</span> Runtime<span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span>
process<span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
reader <span class="token operator">=</span> process<span class="token punctuation">.</span>inputStream<span class="token punctuation">.</span>text
reader<span class="token punctuation">.</span>eachLine <span class="token punctuation">{<!-- --></span>line <span class="token operator">-&gt;</span>
    lst<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

第三种方法<span class="token punctuation">:</span>
<span class="token keyword">def</span> command <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"ls -l"</span></span>
<span class="token keyword">def</span> output <span class="token operator">=</span> command<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
<span class="token comment">// println output</span>
output<span class="token punctuation">.</span>eachLine <span class="token punctuation">{<!-- --></span> line <span class="token operator">-&gt;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        hash_list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>多次执行宿主机的命令:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> commands <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">'C:\\Windows\\System32\\cmd.exe'</span><span class="token punctuation">,</span> <span class="token string">'/c'</span><span class="token punctuation">,</span> <span class="token string">'dir'</span><span class="token punctuation">,</span> <span class="token string">'ansi.txt'</span><span class="token punctuation">,</span> <span class="token string">'/b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">'C:\\Windows\\System32\\cmd.exe'</span><span class="token punctuation">,</span> <span class="token string">'/c'</span><span class="token punctuation">,</span> <span class="token string">'type'</span><span class="token punctuation">,</span> <span class="token string">'ansi.txt'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span><span class="token string">'C:\\Windows\\System32\\cmd.exe'</span><span class="token punctuation">,</span> <span class="token string">'/c'</span><span class="token punctuation">,</span> <span class="token string">'dir'</span><span class="token punctuation">,</span>  <span class="token string">'test.xml'</span><span class="token punctuation">,</span> <span class="token string">'/b'</span><span class="token punctuation">]</span>
<span class="token punctuation">]</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">def</span> command <span class="token punctuation">:</span> commands<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">def</span> processBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span>
    <span class="token keyword">def</span> process <span class="token operator">=</span> processBuilder<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> inputStream <span class="token operator">=</span> process<span class="token punctuation">.</span>inputStream
    <span class="token keyword">def</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">)</span>
    reader<span class="token punctuation">.</span>eachLine <span class="token punctuation">{<!-- --></span> line <span class="token operator">-&gt;</span>
        <span class="token function">println</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    process<span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>获取当前服务器 IP:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">import</span> groovy<span class="token punctuation">.</span>util<span class="token punctuation">.</span>XmlParser 
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>File 


<span class="token keyword">def</span> file <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">".repo/manifest.xml"</span></span>
file <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"/home/build/jenkins/workspace/dynamic_gerrit_paramter_build_test/t.txt"</span></span>
file <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"/tmp"</span></span>
<span class="token keyword">def</span> prj_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">boolean</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
prj_list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>


<span class="token keyword">def</span> command <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'hostname'</span><span class="token punctuation">,</span> <span class="token string">'-I'</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> processBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span>
<span class="token keyword">def</span> process <span class="token operator">=</span> processBuilder<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> line
<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>line <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    prj_list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

process<span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>使用 groovy 脚本多次执行宿主机的命令:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">def</span> command <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'ls'</span><span class="token punctuation">,</span> <span class="token string">'-l'</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> processBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProcessBuilder</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span>

<span class="token comment">// 执行命令10次</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">def</span> process <span class="token operator">=</span> processBuilder<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">def</span> inputStream <span class="token operator">=</span> process<span class="token punctuation">.</span>inputStream
    <span class="token keyword">def</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">)</span>
    reader<span class="token punctuation">.</span>eachLine <span class="token punctuation">{<!-- --></span> line <span class="token operator">-&gt;</span>
        <span class="token function">println</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    process<span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>获取当前年月日,时分秒,纳秒:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>LocalTime
<span class="token keyword">import</span> java<span class="token punctuation">.</span>time<span class="token punctuation">.</span>LocalDate

<span class="token keyword">def</span> now <span class="token operator">=</span> LocalTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> hour <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">getHour</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> minute <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">getMinute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> second <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">getSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">println</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"Current time is: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">hour</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">minute</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">second</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">def</span> c_time <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">getHour</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> now<span class="token punctuation">.</span><span class="token function">getMinute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> now<span class="token punctuation">.</span><span class="token function">getSecond</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">println</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"Current time is: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">c_time</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>


now <span class="token operator">=</span> LocalDate<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> year <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">getYear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> month <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">getMonthValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> day <span class="token operator">=</span> now<span class="token punctuation">.</span><span class="token function">getDayOfMonth</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">println</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"Current date is: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">year</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">month</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">day</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">def</span> nanoTime <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token function">println</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"Current nanoseconds is: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">nanoTime</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
<span class="token function">println</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"nano to int: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">nanoTime<span class="token punctuation">.</span><span class="token function">toInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre> 
<p>保存为 JSON 数据格式到文件:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">import</span> groovy<span class="token punctuation">.</span>json<span class="token punctuation">.</span>JsonBuilder

<span class="token comment">// 创建一个Map对象，用于存储数据</span>
<span class="token keyword">def</span> data <span class="token operator">=</span> <span class="token punctuation">[</span>
    name<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">"John"</span></span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
    email<span class="token punctuation">:</span> <span class="token interpolation-string"><span class="token string">"john@example.com"</span></span>
<span class="token punctuation">]</span>

<span class="token comment">// 创建JsonBuilder对象，并将Map对象转换为JSON格式</span>
<span class="token keyword">def</span> json <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonBuilder</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrettyString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 创建File对象，并将JSON字符串写入文件</span>
<span class="token keyword">def</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"data.json"</span></span><span class="token punctuation">)</span>
file<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span>
<span class="token keyword">def</span> printWriter <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">newPrintWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
printWriter<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
printWriter<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>读取文件中的 JSON 数据:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">import</span> groovy<span class="token punctuation">.</span>json<span class="token punctuation">.</span>JsonSlurper

<span class="token comment">// 创建File对象，并读取文件中的JSON字符串</span>
<span class="token keyword">def</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"data.json"</span></span><span class="token punctuation">)</span>
<span class="token keyword">def</span> json <span class="token operator">=</span> file<span class="token punctuation">.</span>text

<span class="token comment">// 创建JsonSlurper对象，并将JSON字符串转换为Map对象</span>
<span class="token keyword">def</span> slurper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonSlurper</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> data <span class="token operator">=</span> slurper<span class="token punctuation">.</span><span class="token function">parseText</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span>

<span class="token comment">// 输出Map对象中的数据</span>
println <span class="token interpolation-string"><span class="token string">"Name: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">data<span class="token punctuation">.</span>name</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span>
println <span class="token interpolation-string"><span class="token string">"Age: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">data<span class="token punctuation">.</span>age</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span>
println <span class="token interpolation-string"><span class="token string">"Email: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token expression">data<span class="token punctuation">.</span>email</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span></span>
</code></pre> 
<p>Jenkins 中 tag 参数写入并读取代码(样例):</p> 
<pre><code class="prism language-groovy"><span class="token keyword">import</span> groovy<span class="token punctuation">.</span>json<span class="token punctuation">.</span>JsonBuilder
<span class="token keyword">import</span> groovy<span class="token punctuation">.</span>json<span class="token punctuation">.</span>JsonSlurper
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>File

<span class="token keyword">def</span> tag_dict <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>key <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">..</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    key <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"project/build/name"</span></span> <span class="token operator">+</span> key 
    <span class="token keyword">def</span> value_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>value <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">..</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        value <span class="token operator">=</span> key <span class="token operator">+</span> <span class="token interpolation-string"><span class="token string">"-"</span></span> <span class="token operator">+</span> value
        value_list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    tag_dict<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value_list<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">def</span> json <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonBuilder</span><span class="token punctuation">(</span>tag_dict<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrettyString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"/tmp/data.json"</span></span><span class="token punctuation">)</span>
file<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span>

<span class="token keyword">def</span> file_read <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"/tmp/data.json"</span></span><span class="token punctuation">)</span>
<span class="token keyword">boolean</span> b <span class="token operator">=</span> file_read<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> json_read <span class="token operator">=</span> file_read<span class="token punctuation">.</span>text

<span class="token keyword">def</span> slurper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonSlurper</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> data_read <span class="token operator">=</span> slurper<span class="token punctuation">.</span><span class="token function">parseText</span><span class="token punctuation">(</span>json_read<span class="token punctuation">)</span>

<span class="token keyword">return</span> data_read<span class="token punctuation">[</span>project<span class="token punctuation">]</span>
<span class="token comment">// return tag_dict[project]</span>
</code></pre> 
<p>groovy 读取 JSON 文件,指定文件编码为 utf-8:</p> 
<pre><code class="prism language-groovy"><span class="token keyword">import</span> groovy<span class="token punctuation">.</span>json<span class="token punctuation">.</span>JsonSlurper

<span class="token keyword">def</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"path/to/your/json/file.json"</span></span><span class="token punctuation">)</span>
<span class="token keyword">def</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">"UTF-8"</span></span><span class="token punctuation">)</span>
<span class="token keyword">def</span> json <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonSlurper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span>

<span class="token comment">// 处理读取到的JSON数据</span>
</code></pre> 
<h2><a id="12_Gerrit_1257"></a>12 获取Gerrit仓库分支</h2> 
<p>参考文档：<a href="https://blog.csdn.net/myweishanli/article/details/38201423">设置java.net.URL请求方式post get</a></p> 
<p>都是groovy内置模块，无需额外安装，代码如下：</p> 
<pre><code class="prism language-groovy"><span class="token keyword">package</span> test

<span class="token keyword">import</span> java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>URL
<span class="token keyword">import</span> java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>HttpURLConnection
<span class="token keyword">import</span> groovy<span class="token punctuation">.</span>json<span class="token punctuation">.</span>JsonSlurper


List list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
String username <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"admin"</span></span>
String password <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"123456"</span></span>
String responseCookie <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">""</span></span>
String gerritLoginURL <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"http://192.168.72.55:8080/login"</span></span>
String gerritHomeURL <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"http://192.168.72.55:8080"</span></span>

<span class="token comment">// 仓库名称</span>
String prjName <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">"android/kernel"</span></span>

<span class="token comment">// 设置默认cookie handler,新创建连接自动添加handler中cookie</span>
CookieManager cookieManager <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CookieManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
CookieHandler<span class="token punctuation">.</span><span class="token function">setDefault</span><span class="token punctuation">(</span>cookieManager<span class="token punctuation">)</span>

<span class="token comment">// 创建连接，设置请求方法</span>
URL url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>gerritLoginURL<span class="token punctuation">)</span>
HttpURLConnection connection <span class="token operator">=</span> <span class="token punctuation">(</span>HttpURLConnection<span class="token punctuation">)</span> url<span class="token punctuation">.</span><span class="token function">openConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
connection<span class="token punctuation">.</span><span class="token function">setDoOutput</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
connection<span class="token punctuation">.</span><span class="token function">setRequestMethod</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"POST"</span></span><span class="token punctuation">)</span>
connection<span class="token punctuation">.</span><span class="token function">setRequestProperty</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"User-Agent"</span></span><span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64)"</span></span><span class="token punctuation">)</span>

<span class="token comment">// 发送POST请求，写入请求数据账号密码</span>
String auth <span class="token operator">=</span> String<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"username=%s&amp;password=%s"</span></span><span class="token punctuation">,</span> username<span class="token punctuation">,</span> password<span class="token punctuation">)</span>
OutputStream os <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
os<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>auth<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
os<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 获取连接状态及cookie</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>connection<span class="token punctuation">.</span>responseCode <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	responseCookie <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">getHeaderField</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"Set-Cookie"</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
	list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"error"</span></span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> list
<span class="token punctuation">}</span>

<span class="token comment">//获取登录后的cookie</span>
<span class="token comment">//println(connection.responseCode)</span>
<span class="token comment">//List cookies = cookieManager.getCookieStore().getCookies();</span>
<span class="token comment">//for (HttpCookie cookie : cookies) {<!-- --></span>
<span class="token comment">//	System.out.println(cookie);</span>
<span class="token comment">//}</span>

<span class="token comment">// 获取仓库分支数据</span>
String branchText <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">""</span></span>
String gerritBranchURL <span class="token operator">=</span> gerritHomeURL <span class="token operator">+</span> <span class="token interpolation-string"><span class="token string">"/projects/"</span></span> <span class="token operator">+</span> prjName<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"/"</span></span><span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">"%2F"</span></span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token interpolation-string"><span class="token string">"/branches/"</span></span>
url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span>gerritBranchURL<span class="token punctuation">)</span>
connection <span class="token operator">=</span> <span class="token punctuation">(</span>HttpURLConnection<span class="token punctuation">)</span> url<span class="token punctuation">.</span><span class="token function">openConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>connection<span class="token punctuation">.</span>responseCode <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	branchText <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">")]}'"</span></span><span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">""</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
	list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"error"</span></span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> list
<span class="token punctuation">}</span>

<span class="token comment">// 获取分支</span>
JsonSlurper js <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonSlurper</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>element <span class="token keyword">in</span> js<span class="token punctuation">.</span><span class="token function">parseText</span><span class="token punctuation">(</span>branchText<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	s <span class="token operator">=</span> element<span class="token punctuation">.</span>ref<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"refs/heads/"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">"refs/heads/"</span></span><span class="token punctuation">,</span> <span class="token interpolation-string"><span class="token string">""</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/744968b04ec967de8909ad3de64f2c3e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">linux文件组 avc: denied { dac_read_search } for capability=2</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/61c1aaa5123823fcfc0cdd4a8300b69c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">STM32F103&#43;RFID-RC522模块 实现简单读卡写卡demo</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>