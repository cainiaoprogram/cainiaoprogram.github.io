<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>WinServer 2012 R2 AD 组策略 禁止域用户离线缓存登陆 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="WinServer 2012 R2 AD 组策略 禁止域用户离线缓存登陆" />
<meta property="og:description" content="缓存登录主要是为了解决当公司域控制器发生故障联系不上DC或用户拿笔记本电脑回家不拔VPN的情况下，依然能够登录到系统。如果用户登录的时候联系不到DC，那么就凭用户登录时输入的用户名和密码去缓存中校验，如果能联系上DC就不会使用缓存技术。
默认情况下不做任何设置，客户端可以缓存10个域账号，最多可以缓存50个域账号，理论上缓存时间为永久，缓存位置如下：
1、域账号信息如下
用户计算机组织单位权限组zhangsanzhangsanxielongdomain usersh.itITdomain admins （1）以管理员运行注册表 找到 KEY_LOCAL_MACHINE → SECUITY
（2）默认管理员是没有 SECURITY 权限的，需要给管理员添加权限
（3）添加权限 3、刷新后查看，默认情况下，客户端可以缓存10个域账号，如下图所示 NL$1 至 NL$10
（1）红线标注的NL$1，NL$2 说明已经有2个域账号登陆已被缓存，本例分别是 zhangsan 跟 管理员 sh.it，因为之前已经登陆过。
（2）我们尝试关掉DC服务器，然后把上面的2个红线标注的Key删除后，在试着登陆，提示无法登陆，因为这时缓存已经被我们手动删除了。而且DC也被关闭了，所以这时就无法登陆了。
这里如果把上面NL&amp;开头的1-10项和NL&amp;Control 删除，重启电脑的时候会自动重新生成新的 10个Key
4、我们也可以在DC服务器通过组策略统一设置，方法如下：
（1）在OU下面创建一个GPO，注意这里要把计算机也要放到这个OU下面，因为设置的是计算机
（2） 计算机配置 → Windows 设置 → 安全设置 → 本地策略 → 安全选项 → 交互式登陆：之前登录到缓存的次数（域控制器不可用时）
(3) 将不要缓存登陆次数设为 0
（4）强制更新组策略，DC服务器跟客户端分别执行
gpupdate /force
5、我们把 DC1 关机
6、 客户端开机再次登陆，已无法登陆
7、把DC1开机后，客户端成功登陆
8、此时发现 Cache 里面没有缓存 NL$1 至 NL$10 的值，所以也就无法缓存登陆了，注意这里只是隐藏了，如果你把组策略移除，缓存值还是会复原的。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b631ee63a56956eebb4dba3c6502e92c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-20T11:10:26+08:00" />
<meta property="article:modified_time" content="2023-11-20T11:10:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">WinServer 2012 R2 AD 组策略 禁止域用户离线缓存登陆</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>缓存登录主要是为了解决当公司域控制器发生故障联系不上DC或用户拿笔记本电脑回家不拔VPN的情况下，依然能够登录到系统。如果用户登录的时候联系不到DC，那么就凭用户登录时输入的用户名和密码去缓存中校验，如果能联系上DC就不会使用缓存技术。</p> 
<p>默认情况下不做任何设置，客户端可以缓存10个域账号，最多可以缓存50个域账号，理论上缓存时间为永久，缓存位置如下：</p> 
<p>1、域账号信息如下</p> 
<table border="1" cellpadding="1" cellspacing="1"><tbody><tr><td>用户</td><td>计算机</td><td>组织单位</td><td>权限组</td></tr><tr><td>zhangsan</td><td>zhangsan</td><td>xielong</td><td>domain user</td></tr><tr><td>sh.it</td><td></td><td>IT</td><td>domain admins</td></tr></tbody></table> 
<p>（1）以管理员运行注册表 找到 KEY_LOCAL_MACHINE → SECUITY</p> 
<p><img alt="" height="400" src="https://images2.imgbox.com/f1/21/Am5rgp0w_o.png" width="542"></p> 
<p>（2）默认管理员是没有 SECURITY 权限的，需要给管理员添加权限</p> 
<p><img alt="" height="506" src="https://images2.imgbox.com/33/36/YVaMSTGu_o.png" width="430"></p> 
<p>（3）添加权限 </p> 
<p><img alt="" height="632" src="https://images2.imgbox.com/ad/b8/Br4KLr9q_o.png" width="470"></p> 
<p>3、刷新后查看，默认情况下，客户端可以缓存10个域账号，如下图所示 NL$1 至 NL$10</p> 
<p>（1）红线标注的NL$1，NL$2 说明已经有2个域账号登陆已被缓存，本例分别是 zhangsan 跟 管理员 sh.it，因为之前已经登陆过。</p> 
<p><img alt="" height="444" src="https://images2.imgbox.com/64/2c/TsYMXDTZ_o.png" width="665"></p> 
<p>（2）我们尝试关掉DC服务器，然后把上面的2个红线标注的Key删除后，在试着登陆，提示无法登陆，因为这时缓存已经被我们手动删除了。而且DC也被关闭了，所以这时就无法登陆了。</p> 
<p><span style="color:#fe2c24;">这里如果把上面NL&amp;开头的1-10项和NL&amp;Control 删除，重启电脑的时候会自动重新生成新的 10个Key</span></p> 
<p><img alt="" height="561" src="https://images2.imgbox.com/58/0d/zKt7DFyA_o.png" width="624"></p> 
<p> 4、我们也可以在DC服务器通过组策略统一设置，方法如下：</p> 
<p>（1）在OU下面创建一个GPO，注意这里要把计算机也要放到这个OU下面，因为设置的是计算机</p> 
<p><img alt="" height="497" src="https://images2.imgbox.com/29/6e/ueEA0Mvq_o.png" width="495"></p> 
<p><img alt="" height="373" src="https://images2.imgbox.com/1c/1a/Bc8HrNSM_o.png" width="496">  </p> 
<p>（2） 计算机配置 → Windows 设置 → 安全设置 → 本地策略 → 安全选项 → 交互式登陆：之前登录到缓存的次数（域控制器不可用时）</p> 
<p><img alt="" height="533" src="https://images2.imgbox.com/64/9d/TgFw5JKn_o.png" width="579"></p> 
<p>(3) 将不要缓存登陆次数设为 0</p> 
<p><img alt="" height="434" src="https://images2.imgbox.com/d1/2e/kBgu3bHj_o.png" width="490"></p> 
<p>（4）强制更新组策略，DC服务器跟客户端分别执行</p> 
<blockquote> 
 <p>gpupdate /force</p> 
</blockquote> 
<p>5、我们把 DC1 关机</p> 
<p><img alt="" height="436" src="https://images2.imgbox.com/8d/34/6Zi9iBBn_o.png" width="563"></p> 
<p>6、 客户端开机再次登陆，已无法登陆</p> 
<p><img alt="" height="554" src="https://images2.imgbox.com/db/d1/uX1o5ugM_o.png" width="723"></p> 
<p>7、把DC1开机后，客户端成功登陆</p> 
<p><img alt="" height="662" src="https://images2.imgbox.com/f2/ba/mGR1ZNtM_o.png" width="604"></p> 
<p>8、此时发现 Cache 里面没有缓存 NL$1 至 NL$10 的值，所以也就无法缓存登陆了，注意这里只是隐藏了，如果你把组策略移除，缓存值还是会复原的。</p> 
<p><img alt="" height="433" src="https://images2.imgbox.com/ca/82/UY0jmZtl_o.png" width="465"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cae72936288ec90e63d0e156ab36aa93/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ubuntu20.04蓝牙连接airpods</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8e73076cb8ca1f16fe9fd555fbeb920d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">电脑自动重启关闭</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>