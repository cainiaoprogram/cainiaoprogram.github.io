<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Redis7分布式缓存之基础 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Redis7分布式缓存之基础" />
<meta property="og:description" content="Redis7分布式缓存 一、Redis入门概述1.主流功能与应用2.命名规则 二、Redis 10 大数据类型1.redis字符串 (String)2. redis列表 (List)3. redis哈希表 (Hash)4. redis集合 (Set)5. redis有序集合 (ZSet)6. redis地理空间(GEO)7. redis基数统计 (HyperLogLog)8. redis位图 (bitmap)9. redis位域 (bitfield)10. redis流(Stream) 三. `Redis持久化`1. RDB① 是什么② 能干嘛Snapshotting Config 快照时间配置（`redis.conf`） ③ 如何恢复④ 如何备份`BGSAVE(默认)` ⑤ 优点⑥ 缺点⑦ 那些情况会触发RDB快照⑧ 如何禁用快照 2. AOF （`Aof保存的是appendonly.aof文件`）① 是什么② AOF持久化工作流程③ AOF缓冲区三种写回策略④ 如何开启AOF⑤ 优点⑥ 缺点⑦ AOF重写机制Ⅰ是什么Ⅱ 触发机制Ⅲ 案例说明Ⅳ 重新原理 ⑧ AOF优化配置项详解⑨ 小总结 3. AOF&#43;RDB4. 纯缓存模式 四. Redis事务1. 是什么2. 能干嘛3. Redis事务 VS 数据库事务4. Redis事务常用命令 五. Redis管道1. 面试题2. 是什么① 解决思路 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c3e2bbd08601cbebdb5a8c3e16376368/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-27T13:35:13+08:00" />
<meta property="article:modified_time" content="2023-06-27T13:35:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Redis7分布式缓存之基础</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Redis7分布式缓存</h4> 
 <ul><li><a href="#Redis_3" rel="nofollow">一、Redis入门概述</a></li><li><ul><li><a href="#1_4" rel="nofollow">1.主流功能与应用</a></li><li><a href="#2_9" rel="nofollow">2.命名规则</a></li></ul> 
  </li><li><a href="#Redis_10__12" rel="nofollow">二、Redis 10 大数据类型</a></li><li><ul><li><a href="#1redis_String_15" rel="nofollow">1.redis字符串 (String)</a></li><li><a href="#2_redis_List_18" rel="nofollow">2. redis列表 (List)</a></li><li><a href="#3_redis_Hash_20" rel="nofollow">3. redis哈希表 (Hash)</a></li><li><a href="#4_redis_Set_23" rel="nofollow">4. redis集合 (Set)</a></li><li><a href="#5_redis_ZSet_25" rel="nofollow">5. redis有序集合 (ZSet)</a></li><li><a href="#6_redisGEO_28" rel="nofollow">6. redis地理空间(GEO)</a></li><li><a href="#7_redis_HyperLogLog_31" rel="nofollow">7. redis基数统计 (HyperLogLog)</a></li><li><a href="#8_redis_bitmap_34" rel="nofollow">8. redis位图 (bitmap)</a></li><li><a href="#9_redis_bitfield_37" rel="nofollow">9. redis位域 (bitfield)</a></li><li><a href="#10_redisStream_40" rel="nofollow">10. redis流(Stream)</a></li></ul> 
  </li><li><a href="#_Redis_43" rel="nofollow">三. `Redis持久化`</a></li><li><ul><li><a href="#1_RDB_45" rel="nofollow">1. RDB</a></li><li><ul><li><a href="#__46" rel="nofollow">① 是什么</a></li><li><a href="#__49" rel="nofollow">② 能干嘛</a></li><li><ul><li><a href="#Snapshotting_Config_redisconf_51" rel="nofollow">Snapshotting Config 快照时间配置（`redis.conf`）</a></li></ul> 
    </li><li><a href="#__54" rel="nofollow">③ 如何恢复</a></li><li><a href="#__57" rel="nofollow">④ 如何备份</a></li><li><ul><li><a href="#BGSAVE_61" rel="nofollow">`BGSAVE(默认)`</a></li></ul> 
    </li><li><a href="#__68" rel="nofollow">⑤ 优点</a></li><li><a href="#__71" rel="nofollow">⑥ 缺点</a></li><li><a href="#_RDB_75" rel="nofollow">⑦ 那些情况会触发RDB快照</a></li><li><a href="#__78" rel="nofollow">⑧ 如何禁用快照</a></li></ul> 
   </li><li><a href="#2_AOF_Aofappendonlyaof_83" rel="nofollow">2. AOF （`Aof保存的是appendonly.aof文件`）</a></li><li><ul><li><a href="#__84" rel="nofollow">① 是什么</a></li><li><a href="#_AOF_86" rel="nofollow">② AOF持久化工作流程</a></li><li><a href="#_AOF_90" rel="nofollow">③ AOF缓冲区三种写回策略</a></li><li><a href="#_AOF_96" rel="nofollow">④ 如何开启AOF</a></li><li><a href="#__103" rel="nofollow">⑤ 优点</a></li><li><a href="#__107" rel="nofollow">⑥ 缺点</a></li><li><a href="#_AOF_111" rel="nofollow">⑦ AOF重写机制</a></li><li><ul><li><a href="#_112" rel="nofollow">Ⅰ是什么</a></li><li><a href="#__116" rel="nofollow">Ⅱ 触发机制</a></li><li><a href="#__121" rel="nofollow">Ⅲ 案例说明</a></li><li><a href="#___126" rel="nofollow">Ⅳ 重新原理</a></li></ul> 
    </li><li><a href="#_AOF_128" rel="nofollow">⑧ AOF优化配置项详解</a></li><li><a href="#__131" rel="nofollow">⑨ 小总结</a></li></ul> 
   </li><li><a href="#3_AOFRDB_133" rel="nofollow">3. AOF+RDB</a></li><li><a href="#4__139" rel="nofollow">4. 纯缓存模式</a></li></ul> 
  </li><li><a href="#_Redis_143" rel="nofollow">四. Redis事务</a></li><li><ul><li><a href="#1__144" rel="nofollow">1. 是什么</a></li><li><a href="#2__148" rel="nofollow">2. 能干嘛</a></li><li><a href="#3_Redis_VS__151" rel="nofollow">3. Redis事务 VS 数据库事务</a></li><li><a href="#4_Redis_153" rel="nofollow">4. Redis事务常用命令</a></li></ul> 
  </li><li><a href="#_Redis_159" rel="nofollow">五. Redis管道</a></li><li><ul><li><a href="#1__160" rel="nofollow">1. 面试题</a></li><li><a href="#2__164" rel="nofollow">2. 是什么</a></li><li><ul><li><a href="#__167" rel="nofollow">① 解决思路</a></li></ul> 
   </li><li><a href="#3___169" rel="nofollow">3. 小总结</a></li></ul> 
  </li><li><a href="#_Redisreplica_172" rel="nofollow">六. Redis复制（replica）</a></li><li><ul><li><a href="#1__173" rel="nofollow">1. 是什么</a></li><li><a href="#2__175" rel="nofollow">2. 能干嘛</a></li><li><a href="#3__177" rel="nofollow">3. 怎么玩</a></li><li><a href="#4__179" rel="nofollow">4. 案例分析</a></li><li><ul><li><a href="#__180" rel="nofollow">① 架构说明</a></li><li><a href="#__184" rel="nofollow">② 小口诀</a></li><li><a href="#__186" rel="nofollow">③ 修改配置文件细节操作</a></li><li><ul><li><a href="#_daemonize_yes__188" rel="nofollow">Ⅰ 开启`daemonize yes` 开启后台运行</a></li><li><a href="#_bind_127001_redis_191" rel="nofollow">Ⅱ 注释掉bind 127.0.0.1 否则别的redis连不上</a></li><li><a href="#_protectedmode_no__193" rel="nofollow">Ⅲ protected-mode no 保护模式关闭</a></li><li><a href="#__195" rel="nofollow">Ⅳ 指定端口</a></li><li><a href="#__dir_197" rel="nofollow">Ⅴ 指定当前工作目录 dir</a></li><li><a href="#_pidpidfile_199" rel="nofollow">Ⅵ pid文件名字,pidfile</a></li><li><a href="#_loglogfile_201" rel="nofollow">Ⅶ log文件名字,logfile</a></li><li><a href="#_requirepass_203" rel="nofollow">Ⅷ requirepass</a></li><li><a href="#_dumprdb_205" rel="nofollow">Ⅸ dump.rdb名字</a></li><li><a href="#_aofappendfilename_207" rel="nofollow">Ⅹ aof文件,appendfilename</a></li><li><a href="#I_masterauth_209" rel="nofollow">ⅩI `从机访问主机的通行密码masterauth，必须`</a></li></ul> 
    </li><li><a href="#5_211" rel="nofollow">5.常用三招</a></li><li><ul><li><a href="#___212" rel="nofollow">① 一主二仆</a></li><li><a href="#__215" rel="nofollow">② 薪火相传</a></li><li><a href="#___217" rel="nofollow">③ 反客为主</a></li></ul> 
    </li><li><a href="#6_219" rel="nofollow">6.复制原理和工作流程</a></li><li><a href="#7__222" rel="nofollow">7. 复制缺点</a></li></ul> 
  </li></ul> 
  </li><li><a href="#Redissentinel_225" rel="nofollow">七、Redis哨兵（sentinel）</a></li><li><ul><li><a href="#1__226" rel="nofollow">1. 是什么</a></li><li><a href="#2_230" rel="nofollow">2.能干嘛</a></li><li><a href="#3__232" rel="nofollow">3. 怎么玩</a></li><li><ul><li><a href="#_Redissentinel_233" rel="nofollow">① Redis哨兵（sentinel）架构，前提说明</a></li><li><a href="#__237" rel="nofollow">② 案例步骤</a></li><li><ul><li><a href="#optsentinelconf_239" rel="nofollow">Ⅰ先看看/opt目录下默认的sentinel.conf文件的内容</a></li><li><a href="#__241" rel="nofollow">Ⅱ 重点参数项说明</a></li><li><a href="#_246" rel="nofollow">Ⅲ</a></li><li><a href="#_250" rel="nofollow">Ⅳ</a></li><li><a href="#_253" rel="nofollow">Ⅴ</a></li></ul> 
    </li><li><a href="#__257" rel="nofollow">③ 其它步骤</a></li></ul> 
   </li><li><a href="#4__259" rel="nofollow">4. 哨兵运行流程和选举原理</a></li><li><ul><li><a href="#_SDownSubjectively_Down_261" rel="nofollow">① SDown主观下线(Subjectively Down)</a></li><li><a href="#_ODownObjectively_Down_264" rel="nofollow">② ODown客观下线(Objectively Down)</a></li><li><a href="#__267" rel="nofollow">③ 选举出领导者哨兵(哨兵中选出兵王)</a></li><li><a href="#_master_270" rel="nofollow">④ 由兵王开始推动故障切换流程并选出一个新master</a></li></ul> 
   </li><li><a href="#5__275" rel="nofollow">5. 哨兵使用建议</a></li></ul> 
  </li><li><a href="#_Rediscluster_278" rel="nofollow">八. Redis集群(cluster)</a></li><li><ul><li><a href="#1__279" rel="nofollow">1. 是什么</a></li><li><a href="#2__285" rel="nofollow">2. 能干嘛</a></li><li><a href="#3_slot_287" rel="nofollow">3. `集群算法-分片-槽位slot`</a></li><li><ul><li><a href="#_redisslot_289" rel="nofollow">① redis集群的槽位slot</a></li><li><a href="#_redis_291" rel="nofollow">② redis集群的分片</a></li><li><a href="#__293" rel="nofollow">③ 他两的优势</a></li><li><a href="#_slot3_296" rel="nofollow">④ slot槽位映射，一般业界有3种解决方案</a></li><li><ul><li><a href="#_298" rel="nofollow">Ⅰ哈希取余分区</a></li><li><a href="#__300" rel="nofollow">Ⅱ 一致性哈希算法分区</a></li><li><a href="#__305" rel="nofollow">`Ⅲ 哈希槽分区`</a></li><li><ul><li><a href="#_307" rel="nofollow">是什么</a></li></ul> 
    </li></ul> 
   </li></ul> 
   </li><li><a href="#4_redis16384__310" rel="nofollow">4. `为什么redis集群的最大槽数是16384个 ?`</a></li><li><a href="#5_317" rel="nofollow">5.</a></li></ul> 
  </li><li><a href="#_SpringBootRedis_318" rel="nofollow">九. SpringBoot集成Redis</a></li><li><ul><li><a href="#1_Jedis_320" rel="nofollow">1. Jedis</a></li><li><a href="#2_Lettuce_322" rel="nofollow">2. Lettuce</a></li><li><ul><li><a href="#__323" rel="nofollow">① 是什么</a></li><li><a href="#_JedisLettuce_325" rel="nofollow">② Jedis和Lettuce的区别</a></li></ul> 
   </li><li><a href="#3_RedisTemplate_328" rel="nofollow">3. `集成RedisTemplate-推荐使用`</a></li><li><ul><li><a href="#__329" rel="nofollow">① 连接单机</a></li><li><ul><li><a href="#__330" rel="nofollow">Ⅰ 序列化问题</a></li><li><a href="#__338" rel="nofollow">Ⅱ 配置类</a></li></ul> 
    </li><li><a href="#__378" rel="nofollow">② 连接集群</a></li><li><ul><li><a href="#_yml_379" rel="nofollow">Ⅰ 改写yml</a></li><li><a href="#__381" rel="nofollow">Ⅱ 故障</a></li><li><a href="#__384" rel="nofollow">Ⅲ 导致原因</a></li><li><a href="#__386" rel="nofollow">Ⅳ 解决方案</a></li><li><ul><li><ul><li><a href="#_389" rel="nofollow">`刷新节点集群拓扑动态感应`</a></li></ul> 
     </li></ul> 
    </li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<p><a href="https://github.com/redis/redis/releases">Redis7 Github</a></p> 
<h2><a id="Redis_3"></a>一、Redis入门概述</h2> 
<h3><a id="1_4"></a>1.主流功能与应用</h3> 
<ul><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> <strong><code>分布式缓存，挡在mysql数据库之前的带刀护卫</code></strong></li></ul> 
<p><img src="https://images2.imgbox.com/8d/56/ooAEXEud_o.png" alt=""></p> 
<h3><a id="2_9"></a>2.命名规则</h3> 
<p><img src="https://images2.imgbox.com/a8/ac/9GGHAUHC_o.png" alt=""></p> 
<hr> 
<h2><a id="Redis_10__12"></a>二、Redis 10 大数据类型</h2> 
<p><strong><code>这里说的数据类型是value的数据类型，key的类型都是字符串</code></strong><br> <img src="https://images2.imgbox.com/d8/a2/qOYjVqY4_o.png" alt=""></p> 
<h3><a id="1redis_String_15"></a>1.redis字符串 (String)</h3> 
<p><img src="https://images2.imgbox.com/bf/7d/umMYrSbP_o.png" alt=""></p> 
<h3><a id="2_redis_List_18"></a>2. redis列表 (List)</h3> 
<p><img src="https://images2.imgbox.com/2b/b5/JsCN0ciF_o.png" alt=""></p> 
<h3><a id="3_redis_Hash_20"></a>3. redis哈希表 (Hash)</h3> 
<p><img src="https://images2.imgbox.com/ea/33/mEEmd9RF_o.png" alt=""></p> 
<h3><a id="4_redis_Set_23"></a>4. redis集合 (Set)</h3> 
<p><img src="https://images2.imgbox.com/f3/47/Bkfn1vwR_o.png" alt=""></p> 
<h3><a id="5_redis_ZSet_25"></a>5. redis有序集合 (ZSet)</h3> 
<p><img src="https://images2.imgbox.com/a0/d4/Xopazit9_o.png" alt=""></p> 
<h3><a id="6_redisGEO_28"></a>6. redis地理空间(GEO)</h3> 
<p><img src="https://images2.imgbox.com/bc/bb/oAQQ7miC_o.png" alt=""></p> 
<h3><a id="7_redis_HyperLogLog_31"></a>7. redis基数统计 (HyperLogLog)</h3> 
<p><img src="https://images2.imgbox.com/26/d4/k7X7YCrI_o.png" alt=""></p> 
<h3><a id="8_redis_bitmap_34"></a>8. redis位图 (bitmap)</h3> 
<p><img src="https://images2.imgbox.com/6d/fa/cd7aoK6U_o.png" alt=""></p> 
<h3><a id="9_redis_bitfield_37"></a>9. redis位域 (bitfield)</h3> 
<p><img src="https://images2.imgbox.com/b5/ec/D2YugnLz_o.png" alt=""></p> 
<h3><a id="10_redisStream_40"></a>10. redis流(Stream)</h3> 
<p><img src="https://images2.imgbox.com/28/c9/voz639bl_o.png" alt=""></p> 
<hr> 
<h2><a id="_Redis_43"></a>三. <code>Redis持久化</code></h2> 
<h3><a id="1_RDB_45"></a>1. RDB</h3> 
<h4><a id="__46"></a>① 是什么</h4> 
<p><img src="https://images2.imgbox.com/37/6a/lASWUIaZ_o.png" alt=""><br> <img src="https://images2.imgbox.com/f4/ce/AINqyHbf_o.png" alt=""></p> 
<h4><a id="__49"></a>② 能干嘛</h4> 
<p><img src="https://images2.imgbox.com/44/67/cSM54s0f_o.png" alt=""></p> 
<h5><a id="Snapshotting_Config_redisconf_51"></a>Snapshotting Config 快照时间配置（<code>redis.conf</code>）</h5> 
<p><img src="https://images2.imgbox.com/2a/9d/ksEf8Xag_o.png" alt=""></p> 
<h4><a id="__54"></a>③ 如何恢复</h4> 
<p><img src="https://images2.imgbox.com/8b/c1/y0wYvDho_o.png" alt=""><br> <img src="https://images2.imgbox.com/ab/c0/55DE2yWa_o.png" alt=""></p> 
<h4><a id="__57"></a>④ 如何备份</h4> 
<p><img src="https://images2.imgbox.com/8a/8e/Yclc3IT7_o.png" alt=""></p> 
<p><img src="https://images2.imgbox.com/bb/ca/c7wu3kzB_o.png" alt=""></p> 
<h5><a id="BGSAVE_61"></a><code>BGSAVE(默认)</code></h5> 
<p><img src="https://images2.imgbox.com/0b/b2/BnkuILXK_o.png" alt=""></p> 
<p><img src="https://images2.imgbox.com/5e/25/vNqTF0kV_o.png" alt=""><br> <img src="https://images2.imgbox.com/04/33/yc0PALei_o.png" alt=""></p> 
<h4><a id="__68"></a>⑤ 优点</h4> 
<p><img src="https://images2.imgbox.com/50/21/gA4LeXfG_o.png" alt=""><br> <img src="https://images2.imgbox.com/0f/18/nQQloPog_o.png" alt=""></p> 
<h4><a id="__71"></a>⑥ 缺点</h4> 
<p><img src="https://images2.imgbox.com/5c/6b/9VI38oV6_o.png" alt=""><br> <img src="https://images2.imgbox.com/ad/00/SY7JF6y6_o.png" alt=""><br> <img src="https://images2.imgbox.com/46/dc/7OWOgWgW_o.png" alt=""></p> 
<h4><a id="_RDB_75"></a>⑦ 那些情况会触发RDB快照</h4> 
<p><img src="https://images2.imgbox.com/f1/d3/zXUIf7PE_o.png" alt=""></p> 
<h4><a id="__78"></a>⑧ 如何禁用快照</h4> 
<p><img src="https://images2.imgbox.com/7b/3c/zvaFoI8u_o.png" alt=""></p> 
<h3><a id="2_AOF_Aofappendonlyaof_83"></a>2. AOF （<code>Aof保存的是appendonly.aof文件</code>）</h3> 
<h4><a id="__84"></a>① 是什么</h4> 
<p><img src="https://images2.imgbox.com/40/f2/nCK4retj_o.png" alt=""></p> 
<h4><a id="_AOF_86"></a>② AOF持久化工作流程</h4> 
<p><img src="https://images2.imgbox.com/3c/5f/2Lv7kcaL_o.png" alt=""><br> <img src="https://images2.imgbox.com/1c/da/9H1Bvw3k_o.png" alt=""></p> 
<h4><a id="_AOF_90"></a>③ AOF缓冲区三种写回策略</h4> 
<p><img src="https://images2.imgbox.com/a5/eb/dtLzauC2_o.png" alt=""></p> 
<p><img src="https://images2.imgbox.com/21/98/KGtehA2R_o.png" alt=""></p> 
<p><img src="https://images2.imgbox.com/df/79/WrcdLgDl_o.png" alt=""></p> 
<h4><a id="_AOF_96"></a>④ 如何开启AOF</h4> 
<p><img src="https://images2.imgbox.com/79/64/hRTkrIt6_o.png" alt=""></p> 
<p><img src="https://images2.imgbox.com/1b/be/3y5cmJgd_o.png" alt=""><br> <img src="https://images2.imgbox.com/dc/68/Qx8he961_o.png" alt=""><br> <img src="https://images2.imgbox.com/d8/5d/79gs6PYA_o.png" alt=""><br> <img src="https://images2.imgbox.com/0c/45/g59uSrCh_o.png" alt=""></p> 
<h4><a id="__103"></a>⑤ 优点</h4> 
<p><img src="https://images2.imgbox.com/47/38/izgPKwLR_o.png" alt=""><br> <img src="https://images2.imgbox.com/64/c0/eWKHngkK_o.png" alt=""></p> 
<h4><a id="__107"></a>⑥ 缺点</h4> 
<p><img src="https://images2.imgbox.com/b3/92/1IJSvBgL_o.png" alt=""></p> 
<p><img src="https://images2.imgbox.com/56/9e/EKInQGiQ_o.png" alt=""></p> 
<h4><a id="_AOF_111"></a>⑦ AOF重写机制</h4> 
<h5><a id="_112"></a>Ⅰ是什么</h5> 
<p><img src="https://images2.imgbox.com/e2/7c/pUv7NRXm_o.png" alt=""><br> <img src="https://images2.imgbox.com/8c/f6/M3F3Oj5u_o.png" alt=""></p> 
<h5><a id="__116"></a>Ⅱ 触发机制</h5> 
<p><img src="https://images2.imgbox.com/ca/00/531PlHSk_o.png" alt=""><br> <img src="https://images2.imgbox.com/dd/2d/e6w7mp2z_o.png" alt=""></p> 
<h5><a id="__121"></a>Ⅲ 案例说明</h5> 
<p><img src="https://images2.imgbox.com/0c/ef/Nn5WRc3k_o.png" alt=""><br> <img src="https://images2.imgbox.com/97/35/kqYkPghL_o.png" alt=""></p> 
<h5><a id="___126"></a>Ⅳ 重新原理</h5> 
<p><img src="https://images2.imgbox.com/de/6b/FPyWwUjz_o.png" alt=""></p> 
<h4><a id="_AOF_128"></a>⑧ AOF优化配置项详解</h4> 
<p><img src="https://images2.imgbox.com/4c/2b/TGdoNKGU_o.png" alt=""></p> 
<h4><a id="__131"></a>⑨ 小总结</h4> 
<p><img src="https://images2.imgbox.com/9c/c9/wvkCKvzA_o.png" alt=""></p> 
<h3><a id="3_AOFRDB_133"></a>3. AOF+RDB</h3> 
<p><img src="https://images2.imgbox.com/c7/7b/WNr0LJUe_o.png" alt=""><br> <img src="https://images2.imgbox.com/9e/88/uCFysZB1_o.png" alt=""><br> <img src="https://images2.imgbox.com/3d/15/HBBKM9It_o.png" alt=""><br> <img src="https://images2.imgbox.com/b0/1d/mr6BX4Db_o.png" alt=""><br> <img src="https://images2.imgbox.com/97/2b/upEmDA3H_o.png" alt=""></p> 
<h3><a id="4__139"></a>4. 纯缓存模式</h3> 
<p><img src="https://images2.imgbox.com/44/92/3FTaxs9M_o.png" alt=""></p> 
<hr> 
<h2><a id="_Redis_143"></a>四. Redis事务</h2> 
<h3><a id="1__144"></a>1. 是什么</h3> 
<p><img src="https://images2.imgbox.com/a8/5f/cJZAQ8u4_o.png" alt=""></p> 
<h3><a id="2__148"></a>2. 能干嘛</h3> 
<blockquote> 
 <p><strong>一个队列中，一次性、顺序性、排他性的执行一系列命令</strong></p> 
</blockquote> 
<h3><a id="3_Redis_VS__151"></a>3. Redis事务 VS 数据库事务</h3> 
<p><img src="https://images2.imgbox.com/0d/fe/SwLl1IJW_o.png" alt=""></p> 
<h3><a id="4_Redis_153"></a>4. Redis事务常用命令</h3> 
<p><img src="https://images2.imgbox.com/e7/0c/wMtoWan0_o.png" alt=""><br> <img src="https://images2.imgbox.com/fc/b1/sTJvbbgG_o.png" alt=""><br> <img src="https://images2.imgbox.com/9d/46/kv1iovLQ_o.png" alt=""><br> <img src="https://images2.imgbox.com/47/c5/oJq9asbz_o.png" alt=""></p> 
<hr> 
<h2><a id="_Redis_159"></a>五. Redis管道</h2> 
<h3><a id="1__160"></a>1. 面试题</h3> 
<p><img src="https://images2.imgbox.com/af/72/tmhja5Lo_o.png" alt=""></p> 
<p><img src="https://images2.imgbox.com/9b/b6/E9eq2d7q_o.png" alt=""></p> 
<h3><a id="2__164"></a>2. 是什么</h3> 
<p><img src="https://images2.imgbox.com/11/0b/hNdFS8Y8_o.png" alt=""></p> 
<h4><a id="__167"></a>① 解决思路</h4> 
<p><img src="https://images2.imgbox.com/20/6a/Oc8BssOM_o.png" alt=""></p> 
<h3><a id="3___169"></a>3. 小总结</h3> 
<p><img src="https://images2.imgbox.com/d6/25/LeppgTd3_o.png" alt=""></p> 
<hr> 
<h2><a id="_Redisreplica_172"></a>六. Redis复制（replica）</h2> 
<h3><a id="1__173"></a>1. 是什么</h3> 
<p><img src="https://images2.imgbox.com/c1/38/Nl956YBE_o.png" alt=""></p> 
<h3><a id="2__175"></a>2. 能干嘛</h3> 
<p><img src="https://images2.imgbox.com/70/6a/Q6Fpx229_o.png" alt=""></p> 
<h3><a id="3__177"></a>3. 怎么玩</h3> 
<p><img src="https://images2.imgbox.com/cc/20/AT3lrp4n_o.png" alt=""></p> 
<h3><a id="4__179"></a>4. 案例分析</h3> 
<h4><a id="__180"></a>① 架构说明</h4> 
<p><img src="https://images2.imgbox.com/85/a6/pOKtv9A9_o.png" alt=""><br> <img src="https://images2.imgbox.com/33/97/4MCjvouM_o.png" alt=""></p> 
<h4><a id="__184"></a>② 小口诀</h4> 
<p><img src="https://images2.imgbox.com/0d/da/qObYMO3J_o.png" alt=""></p> 
<h4><a id="__186"></a>③ 修改配置文件细节操作</h4> 
<p><img src="https://images2.imgbox.com/89/20/lGhHOUV5_o.png" alt=""></p> 
<h5><a id="_daemonize_yes__188"></a>Ⅰ 开启<code>daemonize yes</code> 开启后台运行</h5> 
<p><img src="https://images2.imgbox.com/2e/6f/wXHAG2DU_o.png" alt=""></p> 
<h5><a id="_bind_127001_redis_191"></a>Ⅱ 注释掉bind 127.0.0.1 否则别的redis连不上</h5> 
<p><img src="https://images2.imgbox.com/f1/b1/aQop4G0X_o.png" alt=""></p> 
<h5><a id="_protectedmode_no__193"></a>Ⅲ protected-mode no 保护模式关闭</h5> 
<p><img src="https://images2.imgbox.com/c3/50/s4wXYi30_o.png" alt=""></p> 
<h5><a id="__195"></a>Ⅳ 指定端口</h5> 
<p><img src="https://images2.imgbox.com/db/f1/wxwDFcWY_o.png" alt=""></p> 
<h5><a id="__dir_197"></a>Ⅴ 指定当前工作目录 dir</h5> 
<p><img src="https://images2.imgbox.com/34/32/p0RrzZl3_o.png" alt=""></p> 
<h5><a id="_pidpidfile_199"></a>Ⅵ pid文件名字,pidfile</h5> 
<p><img src="https://images2.imgbox.com/11/12/MI5amobR_o.png" alt=""></p> 
<h5><a id="_loglogfile_201"></a>Ⅶ log文件名字,logfile</h5> 
<p><img src="https://images2.imgbox.com/35/c1/EH70BhIE_o.png" alt=""></p> 
<h5><a id="_requirepass_203"></a>Ⅷ requirepass</h5> 
<p><img src="https://images2.imgbox.com/a4/29/CkJYCuJV_o.png" alt=""></p> 
<h5><a id="_dumprdb_205"></a>Ⅸ dump.rdb名字</h5> 
<p><img src="https://images2.imgbox.com/7b/85/w0h79eFx_o.png" alt=""></p> 
<h5><a id="_aofappendfilename_207"></a>Ⅹ aof文件,appendfilename</h5> 
<p><img src="https://images2.imgbox.com/e3/f4/Wz1X3ZMS_o.png" alt=""></p> 
<h5><a id="I_masterauth_209"></a>ⅩI <code>从机访问主机的通行密码masterauth，必须</code></h5> 
<p><img src="https://images2.imgbox.com/75/bf/yOqKa7BL_o.png" alt=""></p> 
<h4><a id="5_211"></a>5.常用三招</h4> 
<h5><a id="___212"></a>① 一主二仆</h5> 
<p><img src="https://images2.imgbox.com/1e/68/vWgp84Dy_o.png" alt=""></p> 
<h5><a id="__215"></a>② 薪火相传</h5> 
<p><img src="https://images2.imgbox.com/37/f9/9l1D8OOQ_o.png" alt=""></p> 
<h5><a id="___217"></a>③ 反客为主</h5> 
<p><img src="https://images2.imgbox.com/dd/eb/9NxmLNy7_o.png" alt=""></p> 
<h4><a id="6_219"></a>6.复制原理和工作流程</h4> 
<p><img src="https://images2.imgbox.com/3b/29/UgfMCBMQ_o.png" alt=""><br> <img src="https://images2.imgbox.com/74/9f/rmcMY8gc_o.png" alt=""></p> 
<h4><a id="7__222"></a>7. 复制缺点</h4> 
<p><img src="https://images2.imgbox.com/c7/46/gPvwQpDm_o.png" alt=""><br> <img src="https://images2.imgbox.com/46/c9/og0NzuPu_o.png" alt=""></p> 
<h2><a id="Redissentinel_225"></a>七、Redis哨兵（sentinel）</h2> 
<h3><a id="1__226"></a>1. 是什么</h3> 
<p><img src="https://images2.imgbox.com/34/aa/nj4gIEHP_o.png" alt=""><br> <img src="https://images2.imgbox.com/c4/cd/x0cegfh6_o.png" alt=""></p> 
<h3><a id="2_230"></a>2.能干嘛</h3> 
<p><img src="https://images2.imgbox.com/b0/cd/oYRSQWFM_o.png" alt=""></p> 
<h3><a id="3__232"></a>3. 怎么玩</h3> 
<h4><a id="_Redissentinel_233"></a>① Redis哨兵（sentinel）架构，前提说明</h4> 
<p><img src="https://images2.imgbox.com/2b/ba/XRCNCoce_o.png" alt=""><br> <img src="https://images2.imgbox.com/4a/1c/Gd2wQjKp_o.png" alt=""></p> 
<h4><a id="__237"></a>② 案例步骤</h4> 
<p><img src="https://images2.imgbox.com/1e/54/dxOIZv9X_o.png" alt=""></p> 
<h5><a id="optsentinelconf_239"></a>Ⅰ先看看/opt目录下默认的sentinel.conf文件的内容</h5> 
<p><img src="https://images2.imgbox.com/e3/dc/p4zRdlMI_o.png" alt=""></p> 
<h5><a id="__241"></a>Ⅱ 重点参数项说明</h5> 
<p><img src="https://images2.imgbox.com/f2/7a/hx0DvXpF_o.png" alt=""><br> <img src="https://images2.imgbox.com/10/1d/NaMyWpF5_o.png" alt=""><br> <img src="https://images2.imgbox.com/b0/d1/qI1BCv4y_o.png" alt=""><br> <img src="https://images2.imgbox.com/92/7b/o85x0HcD_o.png" alt=""></p> 
<h5><a id="_246"></a>Ⅲ</h5> 
<p><img src="https://images2.imgbox.com/d9/c4/22ng44oF_o.png" alt=""><br> <img src="https://images2.imgbox.com/67/7b/6RLaWJu5_o.png" alt=""></p> 
<h5><a id="_250"></a>Ⅳ</h5> 
<p><img src="https://images2.imgbox.com/1f/df/p27cFgkN_o.png" alt=""><br> <img src="https://images2.imgbox.com/da/aa/vXAnPFtH_o.png" alt=""><img src="https://images2.imgbox.com/fe/61/TRvOmEjh_o.png" alt=""></p> 
<h5><a id="_253"></a>Ⅴ</h5> 
<p><img src="https://images2.imgbox.com/b5/6b/0ztSN7Sc_o.png" alt=""></p> 
<h4><a id="__257"></a>③ 其它步骤</h4> 
<p><img src="https://images2.imgbox.com/64/1d/9rgybZHN_o.png" alt=""></p> 
<h3><a id="4__259"></a>4. 哨兵运行流程和选举原理</h3> 
<p><img src="https://images2.imgbox.com/9c/97/UOJDHtYT_o.png" alt=""></p> 
<h4><a id="_SDownSubjectively_Down_261"></a>① SDown主观下线(Subjectively Down)</h4> 
<p><img src="https://images2.imgbox.com/8e/24/qFusEg16_o.png" alt=""><br> <img src="https://images2.imgbox.com/ac/e1/2YnG7EKp_o.png" alt=""></p> 
<h4><a id="_ODownObjectively_Down_264"></a>② ODown客观下线(Objectively Down)</h4> 
<p><img src="https://images2.imgbox.com/0a/ac/8RjdbKQU_o.png" alt=""><br> <img src="https://images2.imgbox.com/99/7d/v4x4qVHS_o.png" alt=""></p> 
<h4><a id="__267"></a>③ 选举出领导者哨兵(哨兵中选出兵王)</h4> 
<p><img src="https://images2.imgbox.com/59/42/JW9L1m57_o.png" alt=""><br> <img src="https://images2.imgbox.com/1a/de/kgK1Zx1H_o.png" alt=""></p> 
<h4><a id="_master_270"></a>④ 由兵王开始推动故障切换流程并选出一个新master</h4> 
<p><img src="https://images2.imgbox.com/fa/e1/fRFvbiVK_o.png" alt=""></p> 
<h3><a id="5__275"></a>5. 哨兵使用建议</h3> 
<p><img src="https://images2.imgbox.com/68/e1/UGgXU31W_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h2><a id="_Rediscluster_278"></a>八. Redis集群(cluster)</h2> 
<h3><a id="1__279"></a>1. 是什么</h3> 
<p><img src="https://images2.imgbox.com/a4/be/wuRDidBF_o.png" alt=""><br> <img src="https://images2.imgbox.com/f8/58/qUvAlPVM_o.png" alt=""></p> 
<p><img src="https://images2.imgbox.com/a9/1f/eFxaKnrs_o.png" alt=""></p> 
<h3><a id="2__285"></a>2. 能干嘛</h3> 
<p><img src="https://images2.imgbox.com/5e/d8/btyPBsfT_o.png" alt=""></p> 
<h3><a id="3_slot_287"></a>3. <code>集群算法-分片-槽位slot</code></h3> 
<p><img src="https://images2.imgbox.com/a2/37/BAf1gs06_o.png" alt=""></p> 
<h4><a id="_redisslot_289"></a>① redis集群的槽位slot</h4> 
<p><img src="https://images2.imgbox.com/f7/04/0OWOWJDd_o.png" alt=""></p> 
<h4><a id="_redis_291"></a>② redis集群的分片</h4> 
<p><img src="https://images2.imgbox.com/39/d8/kKLLiY6C_o.png" alt=""></p> 
<h4><a id="__293"></a>③ 他两的优势</h4> 
<p><img src="https://images2.imgbox.com/cc/cd/dua142Kp_o.png" alt=""></p> 
<h4><a id="_slot3_296"></a>④ slot槽位映射，一般业界有3种解决方案</h4> 
<p><img src="https://images2.imgbox.com/f5/e8/pcm4Wtck_o.png" alt=""></p> 
<h5><a id="_298"></a>Ⅰ哈希取余分区</h5> 
<p><img src="https://images2.imgbox.com/29/4e/jx6DaZ0F_o.png" alt=""></p> 
<h5><a id="__300"></a>Ⅱ 一致性哈希算法分区</h5> 
<p><img src="https://images2.imgbox.com/0d/d5/J0GAypfy_o.png" alt=""><br> <img src="https://images2.imgbox.com/c4/4f/2Ks1M0eJ_o.png" alt=""></p> 
<h5><a id="__305"></a><code>Ⅲ 哈希槽分区</code></h5> 
<p><img src="https://images2.imgbox.com/d9/0c/hkDEU6Bs_o.png" alt=""></p> 
<h6><a id="_307"></a>是什么</h6> 
<p><img src="https://images2.imgbox.com/ec/79/VpuQm4LQ_o.png" alt="">###### 哈希槽计算<br> <img src="https://images2.imgbox.com/e9/5d/4IOka7wG_o.png" alt=""></p> 
<h3><a id="4_redis16384__310"></a>4. <code>为什么redis集群的最大槽数是16384个 ?</code></h3> 
<p><img src="https://images2.imgbox.com/ea/11/9JgPXocK_o.png" alt=""><br> <img src="https://images2.imgbox.com/4c/e9/nAazk5lp_o.png" alt=""><br> <img src="https://images2.imgbox.com/d7/cf/FsIMwN31_o.png" alt=""><br> <img src="https://images2.imgbox.com/43/16/Dhlczz2T_o.png" alt=""><br> <img src="https://images2.imgbox.com/5c/73/0TBbD1Ex_o.png" alt=""><br> <img src="https://images2.imgbox.com/cf/31/I4OBgW5K_o.png" alt=""></p> 
<h3><a id="5_317"></a>5.</h3> 
<h2><a id="_SpringBootRedis_318"></a>九. SpringBoot集成Redis</h2> 
<p><img src="https://images2.imgbox.com/c6/0e/B8OIBm3Y_o.png" alt=""></p> 
<h3><a id="1_Jedis_320"></a>1. Jedis</h3> 
<p><strong>Jedis Client是Redis官网推荐的一个面向java客户端库文件实现了对各类API进行封装调用</strong></p> 
<h3><a id="2_Lettuce_322"></a>2. Lettuce</h3> 
<h4><a id="__323"></a>① 是什么</h4> 
<p><img src="https://images2.imgbox.com/22/5d/f0PVv3xA_o.png" alt=""></p> 
<h4><a id="_JedisLettuce_325"></a>② Jedis和Lettuce的区别</h4> 
<p><img src="https://images2.imgbox.com/a1/84/5eebR6cv_o.png" alt=""></p> 
<h3><a id="3_RedisTemplate_328"></a>3. <code>集成RedisTemplate-推荐使用</code></h3> 
<h4><a id="__329"></a>① 连接单机</h4> 
<h5><a id="__330"></a>Ⅰ 序列化问题</h5> 
<p><img src="https://images2.imgbox.com/a6/cd/5ylLhDUc_o.png" alt=""></p> 
<p><img src="https://images2.imgbox.com/f4/b3/5WkV6HQp_o.png" alt=""><br> <img src="https://images2.imgbox.com/df/4c/iz8tUQpr_o.png" alt=""></p> 
<p><img src="https://images2.imgbox.com/ce/72/Uizd0VJc_o.png" alt=""></p> 
<h5><a id="__338"></a>Ⅱ 配置类</h5> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * redis序列化的工具配置类，下面这个请一定开启配置
     * 127.0.0.1:6379&gt; keys *
     * 1) "ord:102"  序列化过
     * 2) "\xac\xed\x00\x05t\x00\aord:102"   野生，没有序列化过
     * this.redisTemplate.opsForValue(); //提供了操作string类型的所有方法
     * this.redisTemplate.opsForList(); // 提供了操作list类型的所有方法
     * this.redisTemplate.opsForSet(); //提供了操作set的所有方法
     * this.redisTemplate.opsForHash(); //提供了操作hash表的所有方法
     * this.redisTemplate.opsForZSet(); //提供了操作zset的所有方法
     * @param lettuceConnectionFactory
     * @return
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">LettuceConnectionFactory</span> lettuceConnectionFactory<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> redisTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        redisTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>lettuceConnectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置key序列化方式string</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置value的序列化方式json，使用GenericJackson2JsonRedisSerializer替换默认序列化</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setValueSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        redisTemplate<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        redisTemplate<span class="token punctuation">.</span><span class="token function">setHashValueSerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GenericJackson2JsonRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        redisTemplate<span class="token punctuation">.</span><span class="token function">afterPropertiesSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="__378"></a>② 连接集群</h4> 
<h5><a id="_yml_379"></a>Ⅰ 改写yml</h5> 
<p><img src="https://images2.imgbox.com/e2/97/NMpZwiV2_o.png" alt=""></p> 
<h5><a id="__381"></a>Ⅱ 故障</h5> 
<p><img src="https://images2.imgbox.com/e2/b7/YI173cD8_o.png" alt=""><br> <img src="https://images2.imgbox.com/8a/0f/hwiXonAm_o.png" alt=""></p> 
<h5><a id="__384"></a>Ⅲ 导致原因</h5> 
<p><img src="https://images2.imgbox.com/bb/7c/JZiFINLX_o.png" alt=""></p> 
<h5><a id="__386"></a>Ⅳ 解决方案</h5> 
<p><img src="https://images2.imgbox.com/02/d7/zqUxFgXU_o.png" alt=""><br> <img src="https://images2.imgbox.com/7c/3c/NPTSU14b_o.png" alt=""></p> 
<h6><a id="_389"></a><code>刷新节点集群拓扑动态感应</code></h6> 
<p><img src="https://images2.imgbox.com/03/d9/G4cUsEDn_o.png" alt=""></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a161f40703bc92c4a2f73fa4edba261f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">TCP和UDP</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6a311bfbd245be9178cc3788c9f631d4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">geemap</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>