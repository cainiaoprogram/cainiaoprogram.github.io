<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>网页轮播图的实现方式 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="网页轮播图的实现方式" />
<meta property="og:description" content="轮播图 轮播图是Web开发中常见的组件之一，通常第三方框架都自带这个组件，或是通过使用第三方插件实现，无需程序员自己重新编码，但在面试中会被问道其实现原理。轮播图的实现方式有很多种，本文轮播图实现代码来自[黑马程序员的视频教程]，纯js实现，支持无缝滚动。
动画 在实现轮播图前，我们需要封装一个动画函数。
function animate(obj, target) { obj.timer = setInterval(function () { var step = (target - obj.offsetLeft) / 10; if (obj.offsetLeft &gt;= target) clearInterval(obj.timer); obj.style.left = obj.offsetLeft &#43; step &#43; &#34;px&#34;; }, 15); } // 调用 var div = document.querySelector(&#34;div&#34;); div.addEventListener(&#34;click&#34;, function () { animate(div, 300); }); 这里会存在一个Bug，就是多次点击div盒子触发animate()函数，导致有多个定时器的步长累加，速度随点击次数增加。
解决办法：
1.创建定时器前先清除
// 清除定时器 clearInterval(obj.timer); // 创建定时器 obj.timer = setInterval(function () { ... } 2.通过if判断定时器是否被创建，没有创建则执行创建定时器代码
if (typeof obj.timer == &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a0eba5d2d5994a5844460d599b56fd1c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-30T05:00:00+08:00" />
<meta property="article:modified_time" content="2022-12-30T05:00:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">网页轮播图的实现方式</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown" style="font-size: 16px;"> 
 <h3 id="轮播图">轮播图</h3> 
 <p>轮播图是Web开发中常见的组件之一，通常第三方框架都自带这个组件，或是通过使用第三方插件实现，无需程序员自己重新编码，但在面试中会被问道其实现原理。轮播图的实现方式有很多种，本文轮播图实现代码来自[黑马程序员的视频教程]，纯js实现，支持无缝滚动。</p> 
 <h3 id="动画">动画</h3> 
 <p>在实现轮播图前，我们需要封装一个动画函数。</p> 
 <pre class="has"><code class="language-javascript">function animate(obj, target) {
	obj.timer = setInterval(function () {
		var step = (target - obj.offsetLeft) / 10;
		if (obj.offsetLeft &gt;= target) clearInterval(obj.timer);
			obj.style.left = obj.offsetLeft + step + "px";
	}, 15);
}
// 调用
var div = document.querySelector("div");
div.addEventListener("click", function () {
	animate(div, 300);
});</code></pre> 
 <p>这里会存在一个Bug，就是多次点击div盒子触发animate()函数，导致有多个定时器的步长累加，速度随点击次数增加。<br> 解决办法：<br> 1.创建定时器前先清除</p> 
 <pre class="has"><code class="language-javascript">// 清除定时器
clearInterval(obj.timer);
// 创建定时器
obj.timer = setInterval(function () {
	...
}</code></pre> 
 <p>2.通过if判断定时器是否被创建，没有创建则执行创建定时器代码</p> 
 <pre class="has"><code class="language-javascript">if (typeof obj.timer == "undefined") {
	obj.timer = setInterval(function () {
		...
	}
}</code></pre> 
 <h4 id="步长step计算">步长(step)计算</h4> 
 <p>动画需要按照先快后慢的方式运行。这里需要用到步长公式：<br> 步长 = (目标值-当前位置)/10<br> 步长公式理解：分母不变，分子越小，结果越小；从而结果由大到小变化，前面的结果越大，得到步长越大，速度越快；后面的结果越小，速度越慢。</p> 
 <pre class="has"><code class="language-javascript">var step = (target - obj.offsetLeft) / 10;</code></pre> 
 <p>因为步长公式运算会存在小数，所以 if (obj.offsetLeft &gt;= target) clearInterval(obj.timer); 判断其实并没有起作用，因为step = 0.4，target = 300，obj.offsetLeft= 296，</p> 
 <p><img src="https://images2.imgbox.com/69/c9/DMEyBJrp_o.png" alt="image" style="outline: none;"></p> 
 <p>解决办法：<br> 步长为正数，先上取整。为负数向下取整。<br> 假设step=0.4，如果往下取整那么step=0，那么obj.offsetLeft &gt;= target等式不成立(因为obj.offsetLeft比target小0.4)，计时器就陷入了死循环。<br> 同理，当为负数时，只有向下取整。(注意等式条件为：obj.offsetLeft == target)</p> 
 <pre class="has"><code class="language-javascript">step = step &gt; 0 ? Math.ceil(step) : Math.floor(step);</code></pre> 
 <h4 id="动画的完整代码">动画的完整代码：</h4> 
 <pre class="has"><code class="language-javascript">// 动画函数 (对象，目标位置，回调函数)
function animate(obj, target, callback) {
    // 清除定时器
    clearInterval(obj.timer);
    obj.timer = setInterval(function () {
        var step = (target - obj.offsetLeft) / 10;
        step = step &gt; 0 ? Math.ceil(step) : Math.floor(step);
        if (obj.offsetLeft == target) {
            clearInterval(obj.timer);
            // 回调函数
            callback &amp;&amp; callback();
        }
        obj.style.left = obj.offsetLeft + step + "px";
    }, 15);
}</code></pre> 
 <h3 id="轮播图实现原理">轮播图实现原理</h3> 
 <p>多个图片并排排列，为了解决无缝切换的问题，最后一张为第一张图片。通过动画使focus1~4这四张图片不断显示，从而达到轮播的效果。<br> 静态图示：<img src="https://images2.imgbox.com/07/db/6nDUHlk1_o.png" alt="image" style="outline: none;"><br> 动态图示：<img src="https://images2.imgbox.com/70/f4/woKfnfST_o.gif" alt="image" style="outline: none;"></p> 
 <h4 id="步骤">步骤</h4> 
 <h5 id="移动步长的计算公式">移动步长的计算公式</h5> 
 <p>移动步长 = 索引 * mian盒子宽度；因为向左移动，所以取负。</p> 
 <pre class="has"><code class="language-javascript">-index * mainWidth</code></pre> 
 <ul><li>第一张移动 0 ，表示不移动，因为当前显示的图片就是第一张。<img src="https://images2.imgbox.com/fd/89/z5LwKJj6_o.png" alt="image" style="outline: none;"></li><li>第二张移动 1*mainWidth = 1个mainWidth单位，表示移动1张图片的距离，显示的内容就是第2张。<img src="https://images2.imgbox.com/91/6f/ir6RtFkV_o.png" alt="image" style="outline: none;"></li><li>第三张移动 2*mainWidth = 2个mainWidth单位，表示移动2张图片的距离，显示的内容就是第3张。依次类推<br> 因为index是我们设置的属性(li.setAttribute('index', i);)所以最大值就是图片数量-1。</li></ul> 
 <h5 id="1鼠标经过左右按钮显示动画停止鼠标离开左右按钮显示动画自动播放">1.鼠标经过，左右按钮显示，动画停止；鼠标离开，左右按钮显示，动画自动播放。</h5> 
 <pre class="has"><code class="language-javascript">var left = document.querySelector('.left');     // 左翻页按钮
    var right = document.querySelector('.right');   // 右翻页按钮
    var main = document.querySelector('.main');     // 用户可视区域
    var mainWidth = main.offsetWidth;               // mian盒子宽度

    // 鼠标经过
    main.addEventListener('mouseenter', function () {
        left.style.display = 'block';
        right.style.display = 'block';
        // 清除定时器，自动翻页动画停止
        clearInterval(timer);
        timer = null; 
    });
    // 鼠标离开
    main.addEventListener('mouseleave', function () {
        left.style.display = 'none';
        right.style.display = 'none';
        // 自动翻页动画开始
        timer = setInterval(function () {
            right.click();
        }, 2000);
    });
    // 定时器，自动翻页
    var timer = setInterval(function () {
        right.click();
    }, 2000);</code></pre> 
 <h5 id="2点击小圆圈实现滚动图片">2.点击小圆圈实现滚动图片。</h5> 
 <pre class="has"><code class="language-javascript">var ul = main.querySelector('ul');  // 图片列表
    var ol = main.querySelector('.circle'); // 圆圈列表

    // 动态创建圆圈，数量根据 图片个数 决定
    for (var i = 0; i &lt; ul.children.length; i++) {
        var li = document.createElement('li');
        li.setAttribute('index', i);
        ol.appendChild(li);
        // 绑定点击事件
        li.addEventListener('click', function () {
            // 所有圆圈去除类名 current 
            for (var i = 0; i &lt; ol.children.length; i++) {
                ol.children[i].className = '';
            }
            // 当前圆圈添加类名 current
            this.className = 'current';
            // 获得索引。用户点击了第几个图片
            var index = this.getAttribute('index');
            num = index;
            circle = index;
            // 向左滚动
            animate(ul, -index * mainWidth);
        })
    }
    // 克隆第一个图片放到ul的最后
    ol.children[0].className = 'current';
    var first = ul.children[0].cloneNode(true);
    ul.appendChild(first);</code></pre> 
 <h5 id="3点击左右翻页按钮实现翻页小圆圈跟随变动">3.点击左、右翻页按钮实现翻页，小圆圈跟随变动。</h5> 
 <pre class="has"><code class="language-javascript">var num = 0;        // 当前滚动图片索引
    var circle = 0;     // 圆圈索引
    var flag = true;    //  是否滚动完成的标志

    // 右翻页
    right.addEventListener('click', function () {
        if (flag) {
            flag = false;
            // 如果滚动到最后一张，即克隆的第一张
            if (num == ul.children.length - 1) {
                ul.style.left = 0;
                num = 0;
            }
            num++;
            animate(ul, -num * mainWidth, function () {
                flag = true;
            });
            circle++;
            // 圆圈到了最后一个
            if (circle == ol.children.length) {
                circle = 0;
            }
            circleChange();
        }
    });
    // 左翻页
    left.addEventListener('click', function () {
        if (flag) {
            flag = false;
            // 如果是第一张
            if (num == 0) {
                num = ul.children.length - 1;
                ul.style.left = -num * mainWidth + 'px';
            }
            num--;
            animate(ul, -num * mainWidth, function () {
                flag = true;
            });
            circle--;
            if (circle &lt; 0) {
                circle = ol.children.length - 1;
            }
            circleChange();
        }
    });
    // 圆圈状态切换
    function circleChange() {
        for (var i = 0; i &lt; ol.children.length; i++) {
            ol.children[i].className = '';
        }
        ol.children[circle].className = 'current';
    }</code></pre> 
 <p>代码下载：<a href="https://wybing.lanzouw.com/iAjpe0jok2ab" rel="noopener noopener noreferrer" target="_blank">https://wybing.lanzouw.com/iAjpe0jok2ab</a></p> 
 <h3 id="完整代码">完整代码</h3> 
 <h4 id="indexhtml">index.html</h4> 
 <pre class="has"><code class="language-javascript">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;title&gt;轮播图&lt;/title&gt;
    &lt;link rel="stylesheet" href="./css/index.css"&gt;
    &lt;script src="./js/animate.js"&gt;&lt;/script&gt;
    &lt;script src="./js/index.js"&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;div class="main"&gt;
        &lt;!-- 左按钮 --&gt;
        &lt;a href="javascript:;" class="left"&gt;&amp;lt;&lt;/a&gt;
        &lt;!-- 右按钮 --&gt;
        &lt;a href="javascript:;" class="right"&gt;&amp;gt;&lt;/a&gt;
        &lt;!-- 滚动区 --&gt;
        &lt;ul&gt;
            &lt;li&gt;
                &lt;a href="#"&gt;&lt;img src="img/focus1.jpg"&gt;&lt;/a&gt;
            &lt;/li&gt;
            &lt;li&gt;
                &lt;a href="#"&gt;&lt;img src="img/focus2.jpg"&gt;&lt;/a&gt;
            &lt;/li&gt;
            &lt;li&gt;
                &lt;a href="#"&gt;&lt;img src="img/focus3.jpg"&gt;&lt;/a&gt;
            &lt;/li&gt;
            &lt;li&gt;
                &lt;a href="#"&gt;&lt;img src="img/focus4.jpg"&gt;&lt;/a&gt;
            &lt;/li&gt;
        &lt;/ul&gt;
        &lt;!-- 小圆 --&gt;
        &lt;ol class="circle"&gt;
        &lt;/ol&gt;
    &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre> 
 <h4 id="indexcss">index.css</h4> 
 <pre class="has"><code class="language-javascript">*{
	padding: 0;
	margin: 0;
}
ul,ol{
	list-style: none;
}
a{
	text-decoration: none;
}

.main{
	position: relative;
	width: 590px;
	height: 470px;
	margin: 150px auto;
	overflow: hidden;
}

.main ul{
	position: absolute;
	left: 0;
	top: 0;
	width: 1000%;
}

.main ul li{
	float:left;
}

.left,.right{
	display: none;
	position: absolute;
	top: 50%;
	margin-top: -20px;
	width: 24px;
	height: 40px;
	background: rgba(0, 0, 0, .3);
	text-align: center;
	line-height: 40px;
	color: #fff;
	font-size: 18px;
	z-index: 2;
}
.right{
	right: 0;
}

.circle {
	position: absolute;
	bottom: 15px;
	left:50%;
    transform: translateX(-50%);
}

.circle li {
	float: left;
	width: 8px;
	height: 8px;
	border: 2px solid orange;
	margin: 0 3px;
	border-radius: 50%;
	cursor: pointer;
}
.current {
    background-color: orange;
}</code></pre> 
 <h4 id="animatejs">animate.js</h4> 
 <pre class="has"><code class="language-javascript">// 动画函数 (对象，目标位置，回调函数)
function animate(obj, target, callback) {
    // 清除定时器
    clearInterval(obj.timer);
    obj.timer = setInterval(function () {
        var step = (target - obj.offsetLeft) / 10;
        step = step &gt; 0 ? Math.ceil(step) : Math.floor(step);
        if (obj.offsetLeft == target) {
            clearInterval(obj.timer);
            // 回调函数
            callback &amp;&amp; callback();
        }
        obj.style.left = obj.offsetLeft + step + "px";
    }, 15);
}</code></pre> 
 <h4 id="indexjs">index.js</h4> 
 <pre class="has"><code class="language-javascript">window.addEventListener('load', function () {

    var left = document.querySelector('.left');     // 左翻页按钮
    var right = document.querySelector('.right');   // 右翻页按钮
    var main = document.querySelector('.main');     // 用户可视区域
    var mainWidth = main.offsetWidth;               // mian盒子宽度

    // 鼠标经过
    main.addEventListener('mouseenter', function () {
        left.style.display = 'block';
        right.style.display = 'block';
        // 清除定时器，自动翻页动画停止
        clearInterval(timer);
        timer = null; 
    });
    // 鼠标离开
    main.addEventListener('mouseleave', function () {
        left.style.display = 'none';
        right.style.display = 'none';
        // 自动翻页动画开始
        timer = setInterval(function () {
            right.click();
        }, 2000);
    });

    
    var ul = main.querySelector('ul');  // 图片列表
    var ol = main.querySelector('.circle'); // 圆圈列表

    // 动态创建圆圈，数量根据 图片个数 决定
    for (var i = 0; i &lt; ul.children.length; i++) {
        var li = document.createElement('li');
        li.setAttribute('index', i);
        ol.appendChild(li);
        // 绑定点击事件
        li.addEventListener('click', function () {
            // 所有圆圈去除类名 current 
            for (var i = 0; i &lt; ol.children.length; i++) {
                ol.children[i].className = '';
            }
            // 当前圆圈添加类名 current
            this.className = 'current';
            // 获得索引。用户点击了第几个图片
            var index = this.getAttribute('index');
            num = index;
            circle = index;
            // 向左滚动
            animate(ul, -index * mainWidth);
        })
    }
    // 克隆第一个图片放到ul的最后
    ol.children[0].className = 'current';
    var first = ul.children[0].cloneNode(true);
    ul.appendChild(first);

    var num = 0;        // 当前滚动图片索引
    var circle = 0;     // 圆圈索引
    var flag = true;    //  是否滚动完成的标志

    // 右翻页
    right.addEventListener('click', function () {
        if (flag) {
            flag = false;
            // 如果滚动到最后一张，即克隆的第一张
            if (num == ul.children.length - 1) {
                ul.style.left = 0;
                num = 0;
            }
            num++;
            animate(ul, -num * mainWidth, function () {
                flag = true;
            });
            circle++;
            // 圆圈到了最后一个
            if (circle == ol.children.length) {
                circle = 0;
            }
            circleChange();
        }
    });
    // 左翻页
    left.addEventListener('click', function () {
        if (flag) {
            flag = false;
            // 如果是第一张
            if (num == 0) {
                num = ul.children.length - 1;
                ul.style.left = -num * mainWidth + 'px';
            }
            num--;
            animate(ul, -num * mainWidth, function () {
                flag = true;
            });
            circle--;
            if (circle &lt; 0) {
                circle = ol.children.length - 1;
            }
            circleChange();
        }
    });
    // 圆圈状态切换
    function circleChange() {
        for (var i = 0; i &lt; ol.children.length; i++) {
            ol.children[i].className = '';
        }
        ol.children[circle].className = 'current';
    }
    // 定时器，自动翻页
    var timer = setInterval(function () {
        right.click();
    }, 2000);
})</code></pre> 
 <h3 id="参考">参考</h3> 
 <ul><li>代码来自<a href="https://www.bilibili.com/video/BV1k4411w7sV" rel="noopener noopener noreferrer" target="_blank">黑马程序员视频教程</a></li></ul> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c6273d58e12618e63ae1ffd387f75703/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java学习笔记【7】面向对象</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1812f38347b72bba148276a1c3f71ec0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JVM-垃圾回收</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>