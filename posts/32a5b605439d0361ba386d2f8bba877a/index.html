<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【亚马逊云科技】使用Helm 3为Amazon EKS部署Prometheus&#43;Grafana监控平台 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【亚马逊云科技】使用Helm 3为Amazon EKS部署Prometheus&#43;Grafana监控平台" />
<meta property="og:description" content="文章目录 1. 创建Kubernetes命名空间2. 添加Prometheus社区helm chart3. 安装prometheus4. 检查Prometheus Pod运行状况5. 检查Prometheus Service部署情况6. 修改服务访问端口类型7. 访问Prometheus数据收集情况8. 访问Grafana9. 设置数据源10. 查看Kubernetes各类性能可视化参数信息 1. 创建Kubernetes命名空间 首先，创建一个 Kubernetes 命名空间，并使用 helm 来部署 stable/monitoring 软件包：
$ kubectl create namespace monitoring 操作过程演示：
[ec2-user@ip-172-31-37-104 ~]$ kubectl create namespace monitoring namespace/monitoring created [ec2-user@ip-172-31-37-104 ~]$ kubectl get ns NAME STATUS AGE default Active 153m kube-node-lease Active 153m kube-public Active 153m kube-system Active 153m monitoring Active 86m 2. 添加Prometheus社区helm chart 其次，添加 Prometheus 社区helm chart：
$ helm repo add prometheus-community https://prometheus-community." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/32a5b605439d0361ba386d2f8bba877a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-06T22:51:40+08:00" />
<meta property="article:modified_time" content="2024-01-06T22:51:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【亚马逊云科技】使用Helm 3为Amazon EKS部署Prometheus&#43;Grafana监控平台</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/a0/27/UfoIiMnm_o.gif" alt="在这里插入图片描述"></p> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><ul><li><a href="#1_Kubernetes_3" rel="nofollow">1. 创建Kubernetes命名空间</a></li><li><a href="#2_Prometheushelm_chart_26" rel="nofollow">2. 添加Prometheus社区helm chart</a></li><li><a href="#3_prometheus_65" rel="nofollow">3. 安装prometheus</a></li><li><a href="#4_Prometheus_Pod_83" rel="nofollow">4. 检查Prometheus Pod运行状况</a></li><li><a href="#5_Prometheus_Service_104" rel="nofollow">5. 检查Prometheus Service部署情况</a></li><li><a href="#6__127" rel="nofollow">6. 修改服务访问端口类型</a></li><li><a href="#7_Prometheus_158" rel="nofollow">7. 访问Prometheus数据收集情况</a></li><li><a href="#8_Grafana_164" rel="nofollow">8. 访问Grafana</a></li><li><a href="#9__179" rel="nofollow">9. 设置数据源</a></li><li><a href="#10_Kubernetes_196" rel="nofollow">10. 查看Kubernetes各类性能可视化参数信息</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h4><a id="1_Kubernetes_3"></a>1. 创建Kubernetes命名空间</h4> 
<p>首先，创建一个 Kubernetes 命名空间，并使用 <code>helm</code> 来部署 <code>stable/monitoring</code> 软件包：</p> 
<pre><code class="prism language-shell">$ kubectl create namespace monitoring
</code></pre> 
<p>操作过程演示：</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>ec2-user@ip-172-31-37-104 ~<span class="token punctuation">]</span>$ kubectl create namespace monitoring 
namespace/monitoring  created

<span class="token punctuation">[</span>ec2-user@ip-172-31-37-104 ~<span class="token punctuation">]</span>$ kubectl get ns
NAME              STATUS   AGE
default           Active   153m
kube-node-lease   Active   153m
kube-public       Active   153m
kube-system       Active   153m
monitoring        Active   86m
</code></pre> 
<h4><a id="2_Prometheushelm_chart_26"></a>2. 添加Prometheus社区helm chart</h4> 
<p>其次，添加 Prometheus 社区helm chart：</p> 
<pre><code class="prism language-bash">$ helm repo <span class="token function">add</span> prometheus-community https://prometheus-community.github.io/helm-charts

$ helm repo update

$ helm repo list

$ helm search repo stable/prometheus-operator
$ helm search repo prometheus-operator
</code></pre> 
<p>操作过程演示：</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>ec2-user@ip-172-31-37-104 ~<span class="token punctuation">]</span>$ helm repo <span class="token function">add</span> prometheus-community https://prometheus-community.github.io/helm-charts
<span class="token string">"prometheus-community"</span> already exists with the same configuration, skipping

<span class="token punctuation">[</span>ec2-user@ip-172-31-37-104 ~<span class="token punctuation">]</span>$ helm repo update
Hang tight <span class="token keyword">while</span> we grab the latest from your chart repositories<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.Successfully got an update from the <span class="token string">"grafana"</span> chart repository
<span class="token punctuation">..</span>.Successfully got an update from the <span class="token string">"prometheus-community"</span> chart repository
<span class="token punctuation">..</span>.Successfully got an update from the <span class="token string">"stable"</span> chart repository
Update Complete. ⎈Happy Helming<span class="token operator">!</span>⎈

<span class="token punctuation">[</span>ec2-user@ip-172-31-37-104 ~<span class="token punctuation">]</span>$ helm repo list
NAME                    URL
prometheus-community    https://prometheus-community.github.io/helm-charts
grafana                 https://grafana.github.io/helm-charts
stable                  https://charts.helm.sh/stable

<span class="token punctuation">[</span>ec2-user@ip-172-31-37-104 ~<span class="token punctuation">]</span>$ helm search repo prometheus-community/prometheus-operator
NAME                            CHART VERSION   APP VERSION     DESCRIPTION
stable/prometheus-operator      <span class="token number">9.3</span>.2           <span class="token number">0.38</span>.1          DEPRECATED Provides easy monitoring definitions<span class="token punctuation">..</span>.
</code></pre> 
<h4><a id="3_prometheus_65"></a>3. 安装prometheus</h4> 
<p>接着，使用helm install安装prometheus：</p> 
<pre><code class="prism language-bash">helm <span class="token function">install</span> stable prometheus-community/kube-prometheus-stack <span class="token parameter variable">--debug</span>
</code></pre> 
<p>创建过程显示正常，最后会输出如下内容：</p> 
<pre><code class="prism language-nash">NOTES:
kube-prometheus-stack has been installed. Check its status by running:
  kubectl --namespace default get pods -l "release=stable"

Visit https://github.com/prometheus-operator/kube-prometheus for instructions on how to create &amp; configure Alertmanager and Prometheus instances using the Operator.
</code></pre> 
<h4><a id="4_Prometheus_Pod_83"></a>4. 检查Prometheus Pod运行状况</h4> 
<p>最后，检查Prometheus Pods的部署情况。</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>ec2-user@ip-172-31-37-104 ~<span class="token punctuation">]</span>$ kubectl get pods <span class="token parameter variable">-n</span> monitoring
NAME                                                     READY   STATUS    RESTARTS   AGE
alertmanager-stable-kube-prometheus-sta-alertmanager-0   <span class="token number">2</span>/2     Running   <span class="token number">0</span>          131m
prometheus-stable-kube-prometheus-sta-prometheus-0       <span class="token number">2</span>/2     Running   <span class="token number">0</span>          131m
stable-grafana-58b76cd9d7-tgd8r                          <span class="token number">3</span>/3     Running   <span class="token number">0</span>          131m
stable-kube-prometheus-sta-operator-7699d6bfb8-zx8jn     <span class="token number">1</span>/1     Running   <span class="token number">0</span>          131m
stable-kube-state-metrics-65f45c47c9-5zmj5               <span class="token number">1</span>/1     Running   <span class="token number">0</span>          131m
stable-prometheus-node-exporter-2q98d                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          126m
stable-prometheus-node-exporter-98cf4                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          131m
stable-prometheus-node-exporter-d6jnm                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          128m
stable-prometheus-node-exporter-gp5dh                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          131m
stable-prometheus-node-exporter-gqqls                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          128m
stable-prometheus-node-exporter-sqg6x                    <span class="token number">1</span>/1     Running   <span class="token number">0</span>          126m
<span class="token punctuation">[</span>ec2-user@ip-172-31-37-104 ~<span class="token punctuation">]</span>$
</code></pre> 
<h4><a id="5_Prometheus_Service_104"></a>5. 检查Prometheus Service部署情况</h4> 
<p>检查部署完成的服务 <code>kubectl get svc</code></p> 
<pre><code class="prism language-bash">$ kubectl get svc <span class="token parameter variable">-n</span> monitoring
</code></pre> 
<blockquote> 
 <p>检查部署完成的Prometheus Pods可以看到每个节点都运行了 <code>node-exporter</code> 且已经运行起 Prometheus和Grafana</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>ec2-user@ip-172-31-37-104 ~<span class="token punctuation">]</span>$ kubectl get svc <span class="token parameter variable">-n</span> monitoring
NAME                                      TYPE        CLUSTER-IP       EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>                         AGE
alertmanager-operated                     ClusterIP   None             <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">9093</span>/TCP,9094/TCP,9094/UDP      79m
prometheus-operated                       ClusterIP   None             <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">9090</span>/TCP                        79m
stable-grafana                            NodePort    <span class="token number">10.100</span>.215.171   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span>:32311/TCP                    79m
stable-kube-prometheus-sta-alertmanager   ClusterIP   <span class="token number">10.100</span>.237.236   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">9093</span>/TCP,8080/TCP               79m
stable-kube-prometheus-sta-operator       ClusterIP   <span class="token number">10.100</span>.79.75     <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">443</span>/TCP                         79m
stable-kube-prometheus-sta-prometheus     NodePort    <span class="token number">10.100</span>.141.226   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">9090</span>:31634/TCP,8080:31429/TCP   79m
stable-kube-state-metrics                 ClusterIP   <span class="token number">10.100</span>.222.140   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">8080</span>/TCP                        79m
stable-prometheus-node-exporter           ClusterIP   <span class="token number">10.100</span>.168.39    <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">9100</span>/TCP                        79m
</code></pre> 
<h4><a id="6__127"></a>6. 修改服务访问端口类型</h4> 
<blockquote> 
 <p>🛑情况说明：默认情况下， <code>prometheus</code> 和 <code>grafana</code> 服务都是使用ClusterIP在集群内部，所以要能够在外部访问，需要使用 <code>NodePort</code></p> 
 <hr> 
 <p>✅操作内容：修改 <code>stable-kube-prometheus-sta-prometheus</code> 服务和 <code>stable-grafana</code> 服务配置文件中的内容，将 <code>type</code> 从 <code>ClusterIP</code> 修改为 <code>NodePort</code>。</p> 
</blockquote> 
<pre><code class="prism language-bash">$ kubectl edit svc stable-grafana
</code></pre> 
<p><img src="https://images2.imgbox.com/dc/e2/ahUcLF9N_o.png" alt="image-20230712125628700"></p> 
<pre><code class="prism language-bash">$ kubectl edit svc stable-kube-prometheus-sta-prometheus
</code></pre> 
<p><img src="https://images2.imgbox.com/65/f5/8HrId1hg_o.png" alt="image-20230712125646789"></p> 
<blockquote> 
 <p>执行<code>kubectl get svc -n monitoring</code>命令，查看对应服务访问的外置端口。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/aa/82/vnsHxUo1_o.png" alt="image-20230712130129183"></p> 
<blockquote> 
 <p>注意：<code>检查对应的主机安全组的端口是否开启。</code></p> 
</blockquote> 
<h4><a id="7_Prometheus_158"></a>7. 访问Prometheus数据收集情况</h4> 
<blockquote> 
 <p>访问Prometheus数据收集情况。其中一个集群工作节点的IP地址+prometheus端口。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/64/e5/wx6pHxIu_o.png" alt="image-20230712130643481"></p> 
<h4><a id="8_Grafana_164"></a>8. 访问Grafana</h4> 
<blockquote> 
 <p>访问Grafana。对Amazon EKS中的数据进行数据可观测性查看。其中一个集群工作节点的IP地址+grafana端口。</p> 
 <hr> 
 <p>访问 Grafana 面板，初始账号 <code>admin</code> 密码是 <code>prom-operator</code> ，请立即修改</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/b5/ae/nxZztT1l_o.png" alt="image-20230712141136331"></p> 
<h4><a id="9__179"></a>9. 设置数据源</h4> 
<blockquote> 
 <p>1、设置名称。设置为默认数据源</p> 
 <hr> 
 <p>2、Prometheus server URL：Prometheus的SVC对应的Cluster-IP</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/df/46/uBtHqaoz_o.png" alt="image-20230712140937751"></p> 
<ul><li>点击“Save &amp; test”保存并测试。输出结果如下所示，表示成功。</li></ul> 
<p><img src="https://images2.imgbox.com/cd/06/9Vl9BXSK_o.png" alt="image-20230712141241463"></p> 
<h4><a id="10_Kubernetes_196"></a>10. 查看Kubernetes各类性能可视化参数信息</h4> 
<ul><li>查看Kubernetes网络工作负载</li></ul> 
<p><img src="https://images2.imgbox.com/ef/cb/JTyqFIFm_o.png" alt="image-20230712141018536"></p> 
<ul><li>查看Kubernetes Pod网络传输情况</li></ul> 
<p><img src="https://images2.imgbox.com/02/10/gj9p822f_o.png" alt="image-20230712141045398"></p> 
<ul><li>查看Kubernetes 服务器接口</li></ul> 
<p><img src="https://images2.imgbox.com/03/cb/E27a5e79_o.png" alt="image-20230712141056844"></p> 
<ul><li>查看需要Kubelet命令查询操作的数据</li></ul> 
<p><img src="https://images2.imgbox.com/f7/31/Z14cV87t_o.png" alt="image-20230712141108990"></p> 
<ul><li>查看Kubernetes Proxy</li></ul> 
<p><img src="https://images2.imgbox.com/8c/44/1hzJj1xQ_o.png" alt="image-20230712141255088"></p> 
<ul><li>全局查看Prometheus</li></ul> 
<p><img src="https://images2.imgbox.com/36/38/0ElWocFq_o.png" alt="image-20230712141310421"></p> 
<ul><li>查看集群工作节点的系统配置参数信息</li></ul> 
<p><img src="https://images2.imgbox.com/41/4f/ZQA2PXBH_o.png" alt="image-20230712141338782"></p> 
<p><img src="https://images2.imgbox.com/1f/71/F9gICYUx_o.png" alt="image-20230712141348105"><br> <img src="https://images2.imgbox.com/a8/11/0SUIZgAh_o.jpg" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/46/eb/jysQXbsV_o.gif" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e6298d68e748b8cb2e5efae4073794fd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">大型语言模型的幻觉问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/319ed47a7c2e9fccdb0e3993dcb96171/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MySQL--基础篇</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>