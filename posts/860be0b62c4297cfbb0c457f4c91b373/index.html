<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>卷积神经网络（CNN）中感受野的计算问题 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="卷积神经网络（CNN）中感受野的计算问题" />
<meta property="og:description" content="感受野 在卷积神经网络中，感受野（Receptive Field）的定义是卷积神经网络每一层输出的特征图（feature map）上每个像素点在原始图像上映射的区域大小，这里的原始图像是指网络的输入图像，是经过预处理（如resize，warp，crop）后的图像。
神经元之所以无法对原始图像的所有信息进行感知，是因为在卷积神经网络中普遍使用卷积层和pooling层，在层与层之间均为局部连接。
神经元感受野的值越大表示其能接触到的原始图像范围就越大，也意味着它可能蕴含更为全局，语义层次更高的特征；相反，值越小则表示其所包含的特征越趋向局部和细节。因此感受野的值可以用来大致判断每一层的抽象层次.
总而言之,我们感受野就额是要求神经网络中间某一层的输出特征图上的一个元素所在原图上的覆盖大小.
感受野的计算 如下图所示的原始图像，经过kernel_size=3, stride=2的Conv1，kernel_size=2, stride=1的Conv2后，输出特征图大小为2×2，很明显，原始图像的每个单元的感受野为1，Conv1的每个单元的感受野为3，而由于Conv2的每个单元都是由范围的Conv1构成，因此回溯到原始图像，每个单元能够看到大小的区域范围。
那么卷积神经网络的每一层感受野应该如何计算呢？很明显，深层卷积层的感受野大小和它之前所有层的滤波器大小和步长有关系，而涉及到这两个参数的有卷积层和pooling层。我们用分别kn,sn,rn表示第n层的kernel_size，stride，receptive_field，通过对n-1层输出特征图的kn×kn个感受野为rn−1的特征单元卷积得到的n层输出特征单元最大的感受野为rn−1×kn，但在对n-1层输入特征图进行卷积时，经常会由于sn−1小于kn−1而存在重叠，因此要减去个重叠部分（kn=2存在一个重叠部分，kn=3存在两个重叠部分）。
重叠的部分怎么算呢?显然重叠的部分一定是与你的stride的有关的,如果你的stride很大,显然是不会有重合,所以,越小重合越多.(注意:这里计算的是在原图上的重合)
显然，kn−sn表示的是一次重合的多少。如果要计算在原图上的重合,则
(kn−sn)×rn−1
是不是很简单啊,由此我们可以知道要求第n层输出的感受野,就要知道前一层n-1的感受野,以及本层的kernel和stride大小,这是一个不断递推的过程.
对于卷积神经网络,其感受野计算有如下规律:
或者写为：
另一种计算卷积核的方法——逆向法 从当前层开始计算,慢慢往上计算:
RF=(RF−1)∗stride kernelsize
如何增加感受野 在深度学习中，对具体的任务有时需要增加感受野来提高性能，比如在人体姿态估计中，大的感受野对学习长距离的空间位置关系(long-range spatial relationship)，建立内隐空间模型(implicit spatial model)有帮助，因此也要知道增大感受野的手段。
根据以上说的感受野的计算，也可以分析出，增加层数、增大strides，增加fsize即卷积滤波器的大小都可以增加感受野的大小。
在看CPM(Convolutional Pose Machines) 时，作者做了一个简单的总结：
Large receptive fields can be achieved either by pooling at the expense of precision, increasing the kernel size of the convolutional filters at the expense of increasing the number of parameters, or by increasing the number of convolutional layers at the risk often countering vanishing gradients during training." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/860be0b62c4297cfbb0c457f4c91b373/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-12T16:35:48+08:00" />
<meta property="article:modified_time" content="2023-12-12T16:35:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">卷积神经网络（CNN）中感受野的计算问题</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<h3 id="感受野">感受野</h3> 
<p></p> 
<p>在卷积神经网络中，感受野（Receptive Field）的定义是卷积神经网络每一层输出的特征图（feature map）上每个像素点在原始图像上映射的区域大小，这里的原始图像是指网络的输入图像，是经过预处理（如resize，warp，crop）后的图像。</p> 
<p>神经元之所以无法对原始图像的所有信息进行感知，是因为在卷积神经网络中普遍使用卷积层和pooling层，在层与层之间均为局部连接。</p> 
<p>神经元感受野的值越大表示其能接触到的原始图像范围就越大，也意味着它可能蕴含更为全局，语义层次更高的特征；相反，值越小则表示其所包含的特征越趋向局部和细节。因此感受野的值可以用来大致判断每一层的抽象层次.</p> 
<p><strong>总而言之,我们感受野就额是要求神经网络中间某一层的输出特征图上的一个元素所在原图上的覆盖大小.</strong></p> 
<h3 id="感受野的计算">感受野的计算</h3> 
<p>如下图所示的原始图像，经过kernel_size=3, stride=2的Conv1，kernel_size=2, stride=1的Conv2后，输出特征图大小为2×2，很明显，原始图像的每个单元的感受野为1，Conv1的每个单元的感受野为3，而由于Conv2的每个单元都是由范围的Conv1构成，因此回溯到原始图像，每个单元能够看到大小的区域范围。</p> 
<p class=" has-jax has-jax has-jax has-jax has-jax has-jax has-jax has-jax has-jax has-jax"><img class="alignnone size-medium wp-image-27791" src="https://images2.imgbox.com/54/2f/EmmVgm7h_o.png" alt="卷积神经网络（CNN）中感受野的计算问题-图片1" width="700" height="450"></p> 
<p>那么卷积神经网络的每一层感受野应该如何计算呢？很明显，深层卷积层的感受野大小和它之前所有层的滤波器大小和步长有关系，而涉及到这两个参数的有卷积层和pooling层。我们用分别k<sub>n</sub>,s<sub>n</sub>,r<sub>n</sub>表示第n层的kernel_size，stride，receptive_field，通过对n-1层输出特征图的k<sub>n</sub>×k<sub>n</sub>个感受野为r<sub>n−1</sub>的特征单元卷积得到的n层输出特征单元最大的感受野为rn−1×k<sub>n</sub>，但在对n-1层输入特征图进行卷积时，经常会由于s<sub>n</sub>−1小于kn−1而存在重叠，因此要减去个重叠部分（k<sub>n</sub>=2存在一个重叠部分，k<sub>n</sub>=3存在两个重叠部分）。</p> 
<p>重叠的部分怎么算呢?显然重叠的部分一定是与你的stride的有关的,如果你的stride很大,显然是不会有重合,所以,越小重合越多.(注意:这里计算的是在原图上的重合)</p> 
<p>显然，k<sub>n</sub>−s<sub>n</sub>表示的是一次重合的多少。如果要计算在原图上的重合,则</p> 
<p>(k<sub>n</sub>−s<sub>n</sub>)×r<sub>n−1</sub></p> 
<p>是不是很简单啊,由此我们可以知道要求第n层输出的感受野,就要知道前一层n-1的感受野,以及本层的kernel和stride大小,这是一个不断递推的过程.</p> 
<p>对于卷积神经网络,其感受野计算有如下规律:</p> 
<p><img class="size-full wp-image-27794 aligncenter" src="https://images2.imgbox.com/77/82/Z8vyqRMV_o.png" alt="卷积神经网络（CNN）中感受野的计算问题-图片2" width="443" height="164"></p> 
<p>或者写为：</p> 
<p><img class="size-full wp-image-27795 aligncenter" src="https://images2.imgbox.com/5f/3a/EE7x4Hgo_o.png" alt="卷积神经网络（CNN）中感受野的计算问题-图片3" width="294" height="34"></p> 
<p><img class="alignnone size-medium wp-image-27792" src="https://images2.imgbox.com/5e/e0/VG5Egg5l_o.png" alt="卷积神经网络（CNN）中感受野的计算问题-图片4" width="700" height="518"></p> 
<h3 id="另一种计算卷积核的方法——逆向法">另一种计算卷积核的方法——逆向法</h3> 
<p>从当前层开始计算,慢慢往上计算:</p> 
<p>RF=(RF−1)∗stride kernelsize</p> 
<p><img class="alignnone size-medium wp-image-27793" src="https://images2.imgbox.com/61/d9/wqXE6Ue7_o.png" alt="卷积神经网络（CNN）中感受野的计算问题-图片5" width="700" height="763"></p> 
<h3 id="如何增加感受野">如何增加感受野</h3> 
<p>在深度学习中，对具体的任务有时需要增加感受野来提高性能，比如在人体姿态估计中，大的感受野对学习长距离的空间位置关系(long-range spatial relationship)，建立内隐空间模型(implicit spatial model)有帮助，因此也要知道增大感受野的手段。</p> 
<p>根据以上说的感受野的计算，也可以分析出，增加层数、增大strides，增加fsize即卷积滤波器的大小都可以增加感受野的大小。</p> 
<p>在看CPM(Convolutional Pose Machines) 时，作者做了一个简单的总结：</p> 
<blockquote> 
 <p> Large receptive fields can be achieved either by pooling at the expense of precision, increasing the kernel size of the convolutional filters at the expense of increasing the number of parameters, or by increasing the number of convolutional layers at the risk often countering vanishing gradients during training.</p> 
</blockquote> 
<p>总结一下共三种方法：</p> 
<ul><li>增加pooling层，但是会降低准确性（pooling过程中造成了信息损失）</li><li>增大卷积核的kernel size，但是会增加参数（卷积层的参数计算参考[2]）</li><li>增加卷积层的个数，但是会面临梯度消失的问题（梯度消失参考[3]）</li></ul> 
<p>CPM中作者用的增加卷积层个数的方法来增加感受野，但是他用多阶段训练的方式并引入中间层监督的方法来解决梯度消失的问题。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9a6452520053754513dbf41fc7dc1e78/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">构建Gradle项目控制台报错：Could not resolve all dependencies for configuration ‘:testCompileClasspath‘</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f2e795496704bde7be8811f1050ea021/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">《RT-DETR魔术师》专栏介绍 &amp; CSDN独家改进创新实战 &amp; 专栏目录</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>