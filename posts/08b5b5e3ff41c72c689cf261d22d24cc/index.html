<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>对Jenkinsfile语法说不，开源项目Jenkins Json Build挺你 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="对Jenkinsfile语法说不，开源项目Jenkins Json Build挺你" />
<meta property="og:description" content="对Jenkinsfile语法说不，开源项目Jenkins Json Build挺你 项目背景 我所在的组织项目数量众多，使用的语言和框架也很多，比如Java、ReactNative、C# .NET、Android、iOS等，部署环境也是多种多样比如Tomcat、K8S、IIS、客户端应用是局域网内企业证书安装等，我们没有专门的配置管理员或构建部署专员，都是开发人员自己在Jenkins中写构建脚本，每个项目都有自己的构建脚本（Scripted Pipelines），但类型相同的项目比如都是Java或都是.NET项目之间，构建脚本其实都很类似，都是靠几个已存在的构建脚本改写出来的，其实开发人员对编写Jenkins构建脚本了解也不多，另外因为没有规则和约束，更没有代码复用的机制，构建部署工作很混乱和难以管理。
项目解决的问题 在上述情况下我们开发了Jenkins-Json-Build项目,该项目适合于有一些编程经验的人员在不需要了解Jenkins构建脚本如何编写的情况下，通过简单的配置Json文件，就可以轻松完成一个项目的获取源码、单元测试、代码检查、编译构建、部署等步骤，实现一个典型的CI过程，又因为此项目使用了Jenkins共享类库（Shared Libraries）机制，构建脚本复用率得到了大幅度提高，并且开发人员可以方便的扩展更多的功能，满足不同构建部署场景的需要，此项目非常适合那些开发人员自己管理构建部署的团队，通过Jenkins-Json-Build项目组织对构建部署过程进行了统一的管理和监督，又让每个项目有足够的灵活性和自主权满足各自项目构建部署的特殊性。
一个Java项目构建示例 构建服务器上需要安装的软件 构建服务器上需要安装Java、Maven和Sonar-Scanner（此项可选）。
JAVA安装Maven安装Sonar-Scanner 构建需要依赖的Jenkins插件 JUnitJaCoCo Jenkinsfile文件内容 因为采用pipeline script from SCM构建方式，所以用Declarative Pipeline方式在Jenkinsfile中编写构建脚本：
@Library(&#39;shared-library&#39;) _ pipeline { agent any parameters { //定义构建参数 choice choices: [&#39;-&#39;], description: &#39;请选择部署方式&#39;, name: &#39;deploy-choice&#39; } stages { stage(&#39;初始化&#39;) { steps { script{ //加载源码仓库根目录下的jenkins-project.json构建配置文件 runWrapper.loadJSON(&#39;/jenkins-project.json&#39;) runWrapper.runSteps(&#39;初始化&#39;) } } } stage(&#39;单元测试&#39;) { steps { script{ //执行单元测试步骤 runWrapper.runSteps(&#39;单元测试&#39;) } } } stage(&#39;代码检查&#39;) { steps { script{ //执行代码检查步骤，比如SonarQube runWrapper.runSteps(&#39;代码检查&#39;) } } } stage(&#39;编译构建&#39;) { steps { script{ //执行编译步骤 runWrapper." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/08b5b5e3ff41c72c689cf261d22d24cc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-09-09T14:11:06+08:00" />
<meta property="article:modified_time" content="2020-09-09T14:11:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">对Jenkinsfile语法说不，开源项目Jenkins Json Build挺你</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="JenkinsfileJenkins_Json_Build_0"></a>对Jenkinsfile语法说不，开源项目Jenkins Json Build挺你</h2> 
<p><img src="https://images2.imgbox.com/2a/30/7548gX8m_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_5"></a>项目背景</h3> 
<p>我所在的组织项目数量众多，使用的语言和框架也很多，比如Java、ReactNative、C# .NET、Android、iOS等，部署环境也是多种多样比如Tomcat、K8S、IIS、客户端应用是局域网内企业证书安装等，我们没有专门的配置管理员或构建部署专员，都是开发人员自己在Jenkins中写构建脚本，每个项目都有自己的构建脚本（Scripted Pipelines），但类型相同的项目比如都是Java或都是.NET项目之间，构建脚本其实都很类似，都是靠几个已存在的构建脚本改写出来的，其实开发人员对编写Jenkins构建脚本了解也不多，另外因为没有规则和约束，更没有代码复用的机制，构建部署工作很混乱和难以管理。</p> 
<h3><a id="_9"></a>项目解决的问题</h3> 
<p>在上述情况下我们开发了<a href="https://github.com/gyyx/jenkins-json-build">Jenkins-Json-Build</a>项目,该项目适合于有一些编程经验的人员在不需要了解Jenkins构建脚本如何编写的情况下，通过简单的配置Json文件，就可以轻松完成一个项目的获取源码、单元测试、代码检查、编译构建、部署等步骤，实现一个典型的CI过程，又因为此项目使用了Jenkins共享类库（Shared Libraries）机制，构建脚本复用率得到了大幅度提高，并且开发人员可以方便的扩展更多的功能，满足不同构建部署场景的需要，此项目非常适合那些开发人员自己管理构建部署的团队，通过Jenkins-Json-Build项目组织对构建部署过程进行了统一的管理和监督，又让每个项目有足够的灵活性和自主权满足各自项目构建部署的特殊性。</p> 
<h3><a id="Java_13"></a>一个Java项目构建示例</h3> 
<h4><a id="_15"></a>构建服务器上需要安装的软件</h4> 
<p>构建服务器上需要安装Java、Maven和Sonar-Scanner（此项可选）。</p> 
<ul><li><a href="https://github.com/sunweisheng/Kvm/blob/master/Install-Java-18.md">JAVA安装</a></li><li><a href="https://github.com/sunweisheng/Jenkins/blob/master/Install-Maven.md">Maven安装</a></li><li><a href="https://github.com/sunweisheng/Jenkins/blob/master/Install-SonarQube-8.3.md">Sonar-Scanner</a></li></ul> 
<h4><a id="Jenkins_23"></a>构建需要依赖的Jenkins插件</h4> 
<ul><li>JUnit</li><li>JaCoCo</li></ul> 
<h4><a id="Jenkinsfile_28"></a>Jenkinsfile文件内容</h4> 
<p>因为采用pipeline script from SCM构建方式，所以用Declarative Pipeline方式在Jenkinsfile中编写构建脚本：</p> 
<pre><code class="prism language-groovy"><span class="token annotation punctuation">@Library</span><span class="token punctuation">(</span><span class="token string">'shared-library'</span><span class="token punctuation">)</span> <span class="token number">_</span>

pipeline <span class="token punctuation">{<!-- --></span>
  agent any
  parameters <span class="token punctuation">{<!-- --></span> <span class="token comment">//定义构建参数</span>
    choice choices<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'-'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> description<span class="token punctuation">:</span> <span class="token string">'请选择部署方式'</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'deploy-choice'</span>
  <span class="token punctuation">}</span>
  stages <span class="token punctuation">{<!-- --></span>
    <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'初始化'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      steps <span class="token punctuation">{<!-- --></span>
        script<span class="token punctuation">{<!-- --></span>
          <span class="token comment">//加载源码仓库根目录下的jenkins-project.json构建配置文件</span>
          runWrapper<span class="token operator">.</span><span class="token function">loadJSON</span><span class="token punctuation">(</span><span class="token string">'/jenkins-project.json'</span><span class="token punctuation">)</span>
          runWrapper<span class="token operator">.</span><span class="token function">runSteps</span><span class="token punctuation">(</span><span class="token string">'初始化'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'单元测试'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      steps <span class="token punctuation">{<!-- --></span>
        script<span class="token punctuation">{<!-- --></span>
          <span class="token comment">//执行单元测试步骤</span>
          runWrapper<span class="token operator">.</span><span class="token function">runSteps</span><span class="token punctuation">(</span><span class="token string">'单元测试'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'代码检查'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      steps <span class="token punctuation">{<!-- --></span>
        script<span class="token punctuation">{<!-- --></span>
          <span class="token comment">//执行代码检查步骤，比如SonarQube</span>
          runWrapper<span class="token operator">.</span><span class="token function">runSteps</span><span class="token punctuation">(</span><span class="token string">'代码检查'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'编译构建'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      steps <span class="token punctuation">{<!-- --></span>
        script<span class="token punctuation">{<!-- --></span>
          <span class="token comment">//执行编译步骤</span>
          runWrapper<span class="token operator">.</span><span class="token function">runSteps</span><span class="token punctuation">(</span><span class="token string">'编译构建'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">stage</span><span class="token punctuation">(</span><span class="token string">'部署'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      steps <span class="token punctuation">{<!-- --></span>
        script<span class="token punctuation">{<!-- --></span>
          <span class="token comment">//根据选择的部署方式执行部署步骤</span>
          runWrapper<span class="token operator">.</span><span class="token function">runStepForEnv</span><span class="token punctuation">(</span><span class="token string">'部署'</span><span class="token punctuation">,</span><span class="token string">'deploy-choice'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>上述Jenkinsfile文件可用于所有类型的项目构建，实际使用的时候一般还会用到以下三个Jenkins插件：</p> 
<ul><li><a href="https://github.com/jenkinsci/agent-server-parameter-plugin">Agent Server Parameter Plugin 用于选择构建的Agent服务器</a></li><li><a href="https://github.com/jenkinsci/custom-checkbox-parameter-plugin">Custom Checkbox Parameter Plugin 用于选择子项目进行构建,多用于微服务项目</a></li><li><a href="https://github.com/jenkinsci/git-parameter-plugin">Git Parameter 用于选择分支构建</a></li></ul> 
<h4><a id="JSON_92"></a>JSON配置文件内容</h4> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string">"初始化"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"检查Java环境"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"Type"</span><span class="token punctuation">:</span> <span class="token string">"COMMAND_STDOUT"</span><span class="token punctuation">,</span>
      <span class="token string">"Success-IndexOf"</span><span class="token punctuation">:</span> <span class="token string">"java version \"1.8.0_211\""</span><span class="token punctuation">,</span>
      <span class="token string">"Script"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"输出Java版本"</span><span class="token punctuation">:</span> <span class="token string">"java -version 2&gt;&amp;1"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"检查Maven环境"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"Type"</span><span class="token punctuation">:</span> <span class="token string">"COMMAND_STDOUT"</span><span class="token punctuation">,</span>
      <span class="token string">"Success-IndexOf"</span><span class="token punctuation">:</span> <span class="token string">"Apache Maven 3.6.3"</span><span class="token punctuation">,</span>
      <span class="token string">"Script"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"输出Maven版本"</span><span class="token punctuation">:</span> <span class="token string">"mvn -v"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"检查SonarScanner环境"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"Type"</span><span class="token punctuation">:</span> <span class="token string">"COMMAND_STDOUT"</span><span class="token punctuation">,</span>
      <span class="token string">"Success-IndexOf"</span><span class="token punctuation">:</span> <span class="token string">"SonarScanner 4.4.0.2170"</span><span class="token punctuation">,</span>
      <span class="token string">"Script"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"输出SonarScanner版本"</span><span class="token punctuation">:</span> <span class="token string">"sonar-scanner -v"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"绑定构建参数"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"Type"</span><span class="token punctuation">:</span> <span class="token string">"BUILD_PARAMETER_DROP_DOWN_MENU"</span><span class="token punctuation">,</span>
      <span class="token string">"StepsName"</span><span class="token punctuation">:</span> <span class="token string">"部署"</span><span class="token punctuation">,</span>
      <span class="token string">"ParamName"</span><span class="token punctuation">:</span> <span class="token string">"deploy-choice"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"单元测试"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"执行Maven单元测试脚本"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"Type"</span><span class="token punctuation">:</span> <span class="token string">"COMMAND_STATUS"</span><span class="token punctuation">,</span>
      <span class="token string">"Script"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"Maven单元测试"</span><span class="token punctuation">:</span> <span class="token string">"cd ${PROJECT_PATH};mvn clean test"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"执行JUnit插件"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"Type"</span><span class="token punctuation">:</span> <span class="token string">"JUNIT_PLUG_IN"</span><span class="token punctuation">,</span>
      <span class="token string">"JunitReportPath"</span><span class="token punctuation">:</span> <span class="token string">"**/${PROJECT_DIR}/**/target/**/TEST-*.xml"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"执行Jacoco插件"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"Type"</span><span class="token punctuation">:</span> <span class="token string">"JACOCO_PLUG_IN"</span><span class="token punctuation">,</span>
      <span class="token string">"classPattern"</span><span class="token punctuation">:</span><span class="token string">"${PROJECT_PATH}/target/classes"</span><span class="token punctuation">,</span>
      <span class="token string">"InclusionPattern"</span><span class="token punctuation">:</span><span class="token string">"${PROJECT_PATH}/**"</span><span class="token punctuation">,</span>
      <span class="token string">"LineCoverage"</span><span class="token punctuation">:</span><span class="token string">"95"</span><span class="token punctuation">,</span>
      <span class="token string">"InstructionCoverage"</span><span class="token punctuation">:</span><span class="token string">"0"</span><span class="token punctuation">,</span>
      <span class="token string">"MethodCoverage"</span><span class="token punctuation">:</span><span class="token string">"100"</span><span class="token punctuation">,</span>
      <span class="token string">"BranchCoverage"</span><span class="token punctuation">:</span><span class="token string">"95"</span><span class="token punctuation">,</span>
      <span class="token string">"ClassCoverage"</span><span class="token punctuation">:</span><span class="token string">"100"</span><span class="token punctuation">,</span>
      <span class="token string">"ComplexityCoverage"</span><span class="token punctuation">:</span><span class="token string">"0"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"代码检查"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"执行SQ代码扫描"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"Type"</span><span class="token punctuation">:</span> <span class="token string">"SONAR_QUBE"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"编译构建"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"执行Maven构建"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"Type"</span><span class="token punctuation">:</span> <span class="token string">"COMMAND_STATUS"</span><span class="token punctuation">,</span>
      <span class="token string">"Script"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"Maven构建"</span><span class="token punctuation">:</span> <span class="token string">"cd ${PROJECT_PATH};mvn clean package -U -DskipTests"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string">"部署"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"模拟部署脚本-1"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"Type"</span><span class="token punctuation">:</span> <span class="token string">"COMMAND_STATUS"</span><span class="token punctuation">,</span>
      <span class="token string">"Script"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"拷贝文件"</span><span class="token punctuation">:</span> <span class="token string">"echo 模拟拷贝文件"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">"模拟部署脚本-2"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"Type"</span><span class="token punctuation">:</span> <span class="token string">"COMMAND_STATUS"</span><span class="token punctuation">,</span>
      <span class="token string">"Script"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"HTTP传输文件"</span><span class="token punctuation">:</span> <span class="token string">"echo HTTP传输文件"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>配置说明：</p> 
<pre><code class="prism language-json"><span class="token string">"检查Java环境"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"Type"</span><span class="token punctuation">:</span> <span class="token string">"COMMAND_STDOUT"</span><span class="token punctuation">,</span>
      <span class="token string">"Success-IndexOf"</span><span class="token punctuation">:</span> <span class="token string">"java version \"1.8.0_211\""</span><span class="token punctuation">,</span>
      <span class="token string">"Script"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"输出Java版本"</span><span class="token punctuation">:</span> <span class="token string">"java -version 2&gt;&amp;1"</span>
      <span class="token punctuation">}</span>
</code></pre> 
<p>该类型的节点不是必须的（但看几年前写的配置文件时很有用，对需要的构建环境一目了然），目的是检查构建服务器是否具备需要的构建环境，在命令的标准输出内未含有Success-IndexOf节点定义的字符串则执行失败，对应的另一个节点名称是Fail-IndexOf，标准输出如果含有Fail-IndexOf定义的字符串则执行失败，两者选择其一使用。</p> 
<pre><code class="prism language-json"><span class="token string">"绑定构建参数"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"Type"</span><span class="token punctuation">:</span> <span class="token string">"BUILD_PARAMETER_DROP_DOWN_MENU"</span><span class="token punctuation">,</span>
      <span class="token string">"StepsName"</span><span class="token punctuation">:</span> <span class="token string">"部署"</span><span class="token punctuation">,</span>
      <span class="token string">"ParamName"</span><span class="token punctuation">:</span> <span class="token string">"deploy-choice"</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>将部署节点（Steps）内的具体构建步骤（Step）列表，绑定到名为deploy-choice的下拉菜单构建参数上。</p> 
<pre><code class="prism language-json"><span class="token string">"执行JUnit插件"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"Type"</span><span class="token punctuation">:</span> <span class="token string">"JUNIT_PLUG_IN"</span><span class="token punctuation">,</span>
      <span class="token string">"JunitReportPath"</span><span class="token punctuation">:</span> <span class="token string">"**/${PROJECT_DIR}/**/target/**/TEST-*.xml"</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>使用Jenkins的JUnit插件生成Junit和TestNG的测试报告。</p> 
<pre><code class="prism language-json"><span class="token string">"执行Jacoco插件"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"Type"</span><span class="token punctuation">:</span> <span class="token string">"JACOCO_PLUG_IN"</span><span class="token punctuation">,</span>
      <span class="token string">"classPattern"</span><span class="token punctuation">:</span><span class="token string">"${PROJECT_PATH}/target/classes"</span><span class="token punctuation">,</span>
      <span class="token string">"InclusionPattern"</span><span class="token punctuation">:</span><span class="token string">"${PROJECT_PATH}/**"</span><span class="token punctuation">,</span>
      <span class="token string">"LineCoverage"</span><span class="token punctuation">:</span><span class="token string">"95"</span><span class="token punctuation">,</span>
      <span class="token string">"InstructionCoverage"</span><span class="token punctuation">:</span><span class="token string">"0"</span><span class="token punctuation">,</span>
      <span class="token string">"MethodCoverage"</span><span class="token punctuation">:</span><span class="token string">"100"</span><span class="token punctuation">,</span>
      <span class="token string">"BranchCoverage"</span><span class="token punctuation">:</span><span class="token string">"95"</span><span class="token punctuation">,</span>
      <span class="token string">"ClassCoverage"</span><span class="token punctuation">:</span><span class="token string">"100"</span><span class="token punctuation">,</span>
      <span class="token string">"ComplexityCoverage"</span><span class="token punctuation">:</span><span class="token string">"0"</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>使用Jenkins的Jacoco插件检查单元测试覆盖度。</p> 
<pre><code class="prism language-json"><span class="token string">"代码检查"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"执行SQ代码扫描"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"Type"</span><span class="token punctuation">:</span> <span class="token string">"SONAR_QUBE"</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> 
<p>执行SonarQube代码检查，需要在项目根目录下要创建sonar-project.properties配置文件，以Java项目的配置文件为例：</p> 
<pre><code class="prism language-conf"># must be unique in a given SonarQube instance
sonar.projectKey=Jenkins:Test-Java-Build

sonar.projectVersion=1.0

# Path is relative to the sonar-project.properties file. Defaults to .
sonar.sources=src
sonar.sourceEncoding=UTF-8
sonar.java.binaries=./target/classes
</code></pre> 
<pre><code class="prism language-json"><span class="token string">"执行Maven构建"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string">"Type"</span><span class="token punctuation">:</span> <span class="token string">"COMMAND_STATUS"</span><span class="token punctuation">,</span>
      <span class="token string">"Script"</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"Maven构建"</span><span class="token punctuation">:</span> <span class="token string">"cd ${PROJECT_PATH};mvn clean package -U -DskipTests"</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>该节点就是执行命令，这里具体构建命令是用mvn clean package -U -DskipTests命令完成的。</p> 
<p>经过上述配置文件的执行，我们可以很简单的完成所有的构建步骤：</p> 
<p><img src="https://images2.imgbox.com/03/d8/bMU3suD5_o.png" alt="在这里插入图片描述"></p> 
<p>这里篇幅有限，更多内容请到项目仓库查看比如：</p> 
<ul><li>构建JS项目</li><li>构建ReactNative项目</li><li>构建Android项目</li><li>构建iOS项目</li><li>构建.NET项目</li><li>构建多个子项目</li><li>构建成功和失败处理</li><li>在K8S内创建Pod进行构建</li></ul> 
<h3><a id="Jenkins_274"></a>欢迎大家去关注、交流更多的关于Jenkins构建的问题和经验</h3> 
<p>项目仓库地址：<a href="https://github.com/gyyx/jenkins-json-build">Jenkins Json Build</a></p> 
<h3><a id="_278"></a>使用此项目的方法：</h3> 
<p>1.首先了解Jenkins如何配置共享类库（https://www.jenkins.io/doc/book/pipeline/shared-libraries/）<br> 2.将此项目的共享类库代码（三个文件夹）存储在git仓库中，并将此仓库配置为Jenkins共享类库（https://github.com/gyyx/jenkins-json-build/tree/master/shared-library）<br> 3.可以参考项目仓库提供说明文件编写Jenkinsfile脚本进行项目构建工作（https://github.com/gyyx/jenkins-json-build）</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0021dc4f1f3c5e2244debe86403e7400/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何在独显电脑上让PotPlayer输出5.1声道音频到JBL CINEMA 615音响</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/665b1c5a714ec3956c63680d93ec9a90/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">azure 安全组_扩展Azure安全功能</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>