<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>不同Vlan的PC相互通信（一） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="不同Vlan的PC相互通信（一）" />
<meta property="og:description" content="不同Vlan的PC相互通信（一） 本周计算机网络实验，实验内容是：只使用Vlan的trunk接口和access接口实现两个二层交换机上属于不同Vlan的PC互通
预备知识 交换机端口 以太网端口有三种链路类型：access、hybrid、trunk.
Access端口只能允许一个Vlan通过，一般用于连接终端，也是端口默认的类型。
Trunk端口可以允许多个Vlan通过，一般用于交换机之间的连接:
Port link-type trunk
Hybrid端口和Trunk端口唯一不同之处在于发送数据时：
Hybrid端口既可以允许多个Vlan的报文发送时不打标签，也可以允许多个Vlan的报文发送时打标签；Trunk端口只允许和自己pvid值相同的Vlan报文发送时不打标签。所以Hybrid端口不仅用于连接交换机，还可以连接终端。Port link-type hybrid 端口接收报文 Access端口收报文:
收到一个报文，判断是否有Vlan信息： 如果没有则打上端口的PVID，并进行交换转发如果有则直接丢弃（缺省）。 trunk端口收报文：
收到一个报文，判断是否有Vlan信息： 如果没有则打上端口的PVID，并进行交换转发如果有判断该trunk端口是否允许该Vlan的数据进入：如果允许则报文携带原有Vlan标记进行转发，否则丢弃该报文。 hybrid端口收报文：
收到一个报文，判断是否有Vlan信息： 如果没有则打上端口的PVID，并进行交换转发如果有则判断该hybrid端口是否允许该Vlan的数据进入：如果可以则转发，否则丢弃。 端口发送报文 Acess端口发报文：
将报文的vlan tag剥离，直接发送出去。trunk端口发报文：
比较端口的PVID和将要发送报文的Vlan信息： 如果两者相等则剥离Vlan信息，再发送否则报文将携带原有的Vlan标记转发。 hybrid端口发报文：
1、判断该Vlan在本端口的属性
2、如果是untag则剥离Vlan信息，再发送，如果是tag则比较端口的PVID和将要发送报文的Vlan信息，如果两者相等则剥离Vlan信息，再发送，否则报文将携带原有的Vlan标记进行转发。 实验环境 上课时是在实体交换机上操作，课后使用华为eNSP模拟试验，加深印象。
华为eNSP:
网络拓扑图 设备配置 交换机配置 LSW1
LSW2
PC机配置 PC1：
PC2：
PC3：
PC4：
PC5：
PC6：
实验结果 Vlan 100的PC1可以访问对端 Vlan 200的PC2.
Vlan 100和Vlan 100、Vlan 200 和Vlan 200间均不能通信，为什么？
Vlan50和Vlan50的相互通信不受任何影响，为什么？
结果分析 由交换机端口收发报文的性质可知，实验结果与预期一致。
附配置命令 交换机的基本配置 •显示交换机的各种运行状态
[sw]display current-configuration
[sw]display interface" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a9db3ba23ee7fbddd1738f5f183441b9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-05-21T21:58:40+08:00" />
<meta property="article:modified_time" content="2019-05-21T21:58:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">不同Vlan的PC相互通信（一）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="VlanPC_0"></a>不同Vlan的PC相互通信（一）</h2> 
<blockquote> 
 <blockquote> 
  <p>本周计算机网络实验，实验内容是：<strong>只使用Vlan的trunk接口和access接口实现两个二层交换机上属于不同Vlan的PC互通</strong></p> 
 </blockquote> 
</blockquote> 
<h2><a id="_4"></a>预备知识</h2> 
<h3><a id="_6"></a>交换机端口</h3> 
<p>以太网端口有三种链路类型：access、hybrid、trunk.</p> 
<ul><li> <p>Access端口只能允许一个Vlan通过，一般用于连接终端，也是端口默认的类型。</p> </li><li> <p>Trunk端口可以允许多个Vlan通过，一般用于交换机之间的连接:</p> <p><strong><code>Port link-type trunk</code></strong></p> </li><li> <p>Hybrid端口和Trunk端口唯一不同之处在于发送数据时：</p> 
  <ol><li>Hybrid端口既可以允许多个Vlan的报文发送时不打标签，也可以允许多个Vlan的报文发送时打标签；</li><li>Trunk端口只允许和自己pvid值相同的Vlan报文发送时不打标签。所以Hybrid端口不仅用于连接交换机，还可以连接终端。<strong><code>Port link-type hybrid</code></strong></li></ol> </li></ul> 
<h3><a id="_21"></a>端口接收报文</h3> 
<ul><li><strong>Access端口收报文:</strong><br> 收到一个报文，判断是否有Vlan信息： 
  <ol><li>如果<strong>没有</strong>则打上端口的PVID，并进行交换转发</li><li>如果<strong>有</strong>则直接丢弃（缺省）。</li></ol> </li><li><strong>trunk端口收报文：</strong><br> 收到一个报文，判断是否有Vlan信息： 
  <ol><li>如果<strong>没有</strong>则打上端口的PVID，并进行交换转发</li><li>如果<strong>有</strong>判断该trunk端口是否允许该Vlan的数据进入：如果允许则报文携带原有Vlan标记进行转发，否则丢弃该报文。</li></ol> </li><li><strong>hybrid端口收报文：</strong><br> 收到一个报文，判断是否有Vlan信息： 
  <ol><li>如果<strong>没有</strong>则打上端口的PVID，并进行交换转发</li><li>如果<strong>有</strong>则判断该hybrid端口是否允许该Vlan的数据进入：如果可以则转发，否则丢弃。</li></ol> </li></ul> 
<h3><a id="_36"></a>端口发送报文</h3> 
<ul><li><strong>Acess端口发报文：</strong><br> 将报文的vlan tag剥离，直接发送出去。</li><li><strong>trunk端口发报文：</strong><br> 比较端口的PVID和将要发送报文的Vlan信息： 
  <ol><li>如果两者相等则剥离Vlan信息，再发送</li><li>否则报文将携带原有的Vlan标记转发。</li></ol> </li><li><strong>hybrid端口发报文：</strong><br> 1、判断该Vlan在本端口的属性<br> 2、如果是untag则剥离Vlan信息，再发送，如果是tag则比较端口的PVID和将要发送报文的Vlan信息，如果两者相等则剥离Vlan信息，再发送，否则报文将携带原有的Vlan标记进行转发。</li></ul> 
<h2><a id="_48"></a>实验环境</h2> 
<p>上课时是在实体交换机上操作，课后使用华为eNSP模拟试验，加深印象。</p> 
<p><strong>华为eNSP:</strong></p> 
<p><img src="https://images2.imgbox.com/82/f0/EzMrtQIf_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_55"></a>网络拓扑图</h2> 
<p><img src="https://images2.imgbox.com/db/b9/LP7mrReB_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_58"></a>设备配置</h2> 
<h3><a id="_60"></a>交换机配置</h3> 
<ul><li>LSW1<br> <img src="https://images2.imgbox.com/e1/0c/uzTGQJbs_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d7/84/EcCXtJlG_o.png" alt="在这里插入图片描述"></li><li>LSW2<br> <img src="https://images2.imgbox.com/8c/14/uS28jtPp_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/59/c6/lar2kGCO_o.png" alt="在这里插入图片描述"></li></ul> 
<h3><a id="PC_68"></a>PC机配置</h3> 
<p><strong>PC1：</strong><br> <img src="https://images2.imgbox.com/50/e2/SMBEW9zy_o.png" alt="在这里插入图片描述"></p> 
<p><strong>PC2：</strong><br> <img src="https://images2.imgbox.com/48/0d/kY8CBiUq_o.png" alt="在这里插入图片描述"></p> 
<p><strong>PC3：</strong><br> <img src="https://images2.imgbox.com/25/11/S8a04F2z_o.png" alt="在这里插入图片描述"></p> 
<p><strong>PC4：</strong><br> <img src="https://images2.imgbox.com/45/08/3459PCdP_o.png" alt="在这里插入图片描述"></p> 
<p><strong>PC5：</strong><br> <img src="https://images2.imgbox.com/34/0c/YpIIynzo_o.png" alt="在这里插入图片描述"></p> 
<p><strong>PC6：</strong><br> <img src="https://images2.imgbox.com/fe/ec/lYaQbhbE_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_87"></a>实验结果</h2> 
<p><strong>Vlan 100的PC1可以访问对端 Vlan 200的PC2.</strong><br> <img src="https://images2.imgbox.com/08/c4/PbvqAPQf_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a2/92/ei6mWyoa_o.png" alt="在这里插入图片描述"></p> 
<p>Vlan 100和Vlan 100、Vlan 200 和Vlan 200间均不能通信，为什么？</p> 
<p><img src="https://images2.imgbox.com/f6/28/raBMKZMy_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/5e/0a/Y940IQWy_o.png" alt="在这里插入图片描述"></p> 
<p>Vlan50和Vlan50的相互通信不受任何影响，为什么？</p> 
<p><img src="https://images2.imgbox.com/da/3e/LXzeUyM9_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/b3/62/C5kPLZLF_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_104"></a>结果分析</h2> 
<p>由交换机端口收发报文的性质可知，实验结果与预期一致。</p> 
<h2><a id="_108"></a>附配置命令</h2> 
<h3><a id="_110"></a>交换机的基本配置</h3> 
<p>•显示交换机的各种运行状态</p> 
<p>[sw]display current-configuration</p> 
<p>[sw]display interface</p> 
<p>[sw]display ip routing-table</p> 
<p>[sw]display arp</p> 
<p>•配置主机名</p> 
<p>​ [sw]sysname</p> 
<p>•删除某条命令：undo</p> 
<h3><a id="Vlan_128"></a>Vlan创建及端口指定</h3> 
<p>•创建/删除Vlan</p> 
<p>[sw]Vlan 10</p> 
<p>[sw]undo Vlan 10</p> 
<p>•给指定Vlan增加/删除以太网接口</p> 
<p>[sw-Vlan10]port g0/0/1</p> 
<p>[sw-Vlan10]undo port g0/0/1</p> 
<h3><a id="IP_142"></a>配置交换机管理IP地址</h3> 
<p>•[sw] interface vlan 1</p> 
<p>•[sw-vlanif1] ip address 192.168.1.1 255.255.255.0</p> 
<p><strong>注意：</strong></p> 
<p>•交换机<strong>Vlan 1</strong> 默认是交换机器的管理中心,在默认的情况下,交换机所有的接口都处于此下,为其配置地址可以连通到所有的接口.</p> 
<p>•二层交换机的管理IP只能有一个生效。</p> 
<p>•默认情况下给Vlan1配置IP，因为交换机所有接口默认都属于Vlan1</p> 
<p>•给不同Vlan配置IP地址时，VlanIP地址不能在同一网段</p> 
<p>例：Vlan1 192.168.1.1 Vlan10 192.168.1.2（不允许）</p> 
<h3><a id="_160"></a>交换机端口参数的配置</h3> 
<p>•进入ethernet0/0/10端口</p> 
<p>[sw]interface ethernet0/0/10</p> 
<p>•配置端口速率为100M</p> 
<p>[sw-ethernet0/0/10]speed 100</p> 
<p>•配置端口的双工模式为全双工</p> 
<p>[sw-ethernet0/0/10]duplex full</p> 
<p>•配置端口速率参数有1000（1000M）、100（100M）、10（10M）、auto(自适应)，默认是auto</p> 
<p>•配置模式有full (全双工)、half(半双工)、auto（自适应），默认是auto</p> 
<p>•端口预设模式是自适应（auto）时，需要先解除自适应（auto）</p> 
<p>[sw-ethernet0/0/10] undo negotiation auto</p> 
<h3><a id="_182"></a>交换机端口类别的配置</h3> 
<p>•端口加入Vlan</p> 
<p>[sw]Vlan 10</p> 
<p>[sw-Vlan 10]port ethernet0/0/10</p> 
<p>•配置端口类别成trunk或hybrid类型</p> 
<p>[sw-ethernet0/0/10]port link-type trunk/hybrid</p> 
<p>•端口切回access类型（端口缺省都属于access）</p> 
<p>[sw-ethernet0/0/10]undo port link-type trunk/hybrid</p> 
<p>•给trunk/hybrid端口设置PVID值（缺省ID），因为trunk/hybrid端口可以允许多个Vlan数据通过，所以要设置PVID。</p> 
<p>[sw-ethernet0/0/10]port trunk/hybrid pvid Vlan 20</p> 
<p>•设置trunk端口允许通过的Vlan</p> 
<p>[sw-ethernet0/0/10]port trunk allow-pass Vlan10 20</p> 
<p>•设置hybrid端口发报文时执行“撕标签”操作的Vlan，同时也是允许通过的Vlan（类似access）</p> 
<p>[sw-ethernet0/0/10]port hybrid untagged Vlan 10 20</p> 
<p>•设置hybrid端口发报文时带标签，同时也是允许通过的Vlan（类似trunk）</p> 
<p>[sw-ethernet0/0/10]port hybrid tagged Vlan 10 20</p> 
<h3><a id="_214"></a>交换机接口关闭和开启</h3> 
<p>•将接口关闭<br> [sw-ethernet0/0/1] shutdown</p> 
<p>•将接口启用<br> [sw-ethernet0/0/1] undo shutdown</p> 
<p><strong>•在配置完接口属性后，最好执行一套接口关闭和开启的操作，以保证接口的开启状态以及运行刚设置的脚本。</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e88df3e1f834242e7d4baac5314f665f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C#关于控制线程的停止和继续</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ba85f169d9a56bc09059852ed77ab645/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">UE4 阴影距离修改，解决阴影错误</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>