<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python opencv-批量调整图片的曝光率 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python opencv-批量调整图片的曝光率" />
<meta property="og:description" content="#--coding:utf-8-- import cv2 import numpy as np import os def gamma_trans(img,gamma):#gamma函数处理 gamma_table=[np.power(x/255.0,gamma)*255.0 for x in range(256)]#建立映射表 gamma_table=np.round(np.array(gamma_table)).astype(np.uint8)#颜色值为整数 return cv2.LUT(img,gamma_table)#图片颜色查表。另外可以根据光强（颜色）均匀化原则设计自适应算法。 def nothing(x): pass cv2.namedWindow(&#34;demo&#34;,0)#将显示窗口的大小适应于显示器的分辨率 cv2.createTrackbar(&#39;Value of Gamma&#39;,&#39;demo&#39;,100,1000,nothing)#使用滑动条动态调节参数gamma data_base_dir=&#34;C:\\Users\\HUANG\\Desktop\\pict&#34;#输入文件夹的路径 outfile_dir=&#34;C:\\Users\\HUANG\\Desktop\\pictout&#34;#输出文件夹的路径 processed_number=0#统计处理图片的数量 print &#34;press enter to make sure your operation and process the next picture&#34; for file in os.listdir(data_base_dir):#遍历目标文件夹图片 read_img_name=data_base_dir&#43;&#39;//&#39;&#43;file.strip()#取图片完整路径 image=cv2.imread(read_img_name)#读入图片 while(1): value_of_gamma=cv2.getTrackbarPos(&#39;Value of Gamma&#39;,&#39;demo&#39;)#gamma取值 value_of_gamma=value_of_gamma*0.01#压缩gamma范围，以进行精细调整 image_gamma_correct=gamma_trans(image,value_of_gamma)#2.5为gamma函数的指数值，大于1曝光度下降，大于0小于1曝光度增强 cv2.imshow(&#34;demo&#34;,image_gamma_correct) k=cv2.waitKey(1) if k==13:#按回车键确认处理、保存图片到输出文件夹和读取下一张图片 processed_number&#43;=1 out_img_name=outfile_dir&#43;&#39;//&#39;&#43;file.strip() cv2.imwrite(out_img_name,image_gamma_correct) print &#34;The number of photos which were processed is &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0ec9eab1f9e591c8ad2f3fbcac2342f0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-01-28T20:59:25+08:00" />
<meta property="article:modified_time" content="2018-01-28T20:59:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python opencv-批量调整图片的曝光率</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p></p> 
<pre><code class="language-html">#--coding:utf-8--
import cv2
import numpy as np
import os

def gamma_trans(img,gamma):#gamma函数处理
    gamma_table=[np.power(x/255.0,gamma)*255.0 for x in range(256)]#建立映射表
    gamma_table=np.round(np.array(gamma_table)).astype(np.uint8)#颜色值为整数
    return cv2.LUT(img,gamma_table)#图片颜色查表。另外可以根据光强（颜色）均匀化原则设计自适应算法。
def nothing(x):
    pass

cv2.namedWindow("demo",0)#将显示窗口的大小适应于显示器的分辨率
cv2.createTrackbar('Value of Gamma','demo',100,1000,nothing)#使用滑动条动态调节参数gamma

data_base_dir="C:\\Users\\HUANG\\Desktop\\pict"#输入文件夹的路径
outfile_dir="C:\\Users\\HUANG\\Desktop\\pictout"#输出文件夹的路径
processed_number=0#统计处理图片的数量
print "press enter to make sure your operation and process the next picture"

for file in os.listdir(data_base_dir):#遍历目标文件夹图片
    read_img_name=data_base_dir+'//'+file.strip()#取图片完整路径
    image=cv2.imread(read_img_name)#读入图片

    while(1):
        value_of_gamma=cv2.getTrackbarPos('Value of Gamma','demo')#gamma取值
        value_of_gamma=value_of_gamma*0.01#压缩gamma范围，以进行精细调整
        image_gamma_correct=gamma_trans(image,value_of_gamma)#2.5为gamma函数的指数值，大于1曝光度下降，大于0小于1曝光度增强
        cv2.imshow("demo",image_gamma_correct)
        k=cv2.waitKey(1)
        if k==13:#按回车键确认处理、保存图片到输出文件夹和读取下一张图片
            processed_number+=1
            out_img_name=outfile_dir+'//'+file.strip()
            cv2.imwrite(out_img_name,image_gamma_correct)
            print "The number of photos which were processed is ",processed_number
            break</code></pre> 
<p><img src="https://images2.imgbox.com/8f/bb/h3CqyeFT_o.jpg" align="left" width="350" height="250" alt=""><img src="https://images2.imgbox.com/10/7f/hzlpEIuu_o.jpg" width="350" height="250" alt=""></p> 
<p><br> </p> 
<p><span style="font-family:SimSun; font-size:14px">上图为处理前后的结果，图片效果大为改善，处理后的图片颜色更加均匀和丰富。关键的处理过程是利用了gamma函数对颜色空间进行了非线性变换：</span></p> 
<p><br> </p> 
<p style="text-align:center">Color_trans=(Color/255)^R*255</p> 
<p style="text-align:left"><br> </p> 
<p style="text-align:left"><span style="font-family:SimSun; font-size:14px">由下图gamma函数图像可以看出，当R&gt;1时，曲线在R=1的下方，颜色空间的数值在变换后整体下降，R越大，颜色数值下降得越明显，宏观的表现为图片亮度下降增加。当0&lt;R&lt;1时，曲线在R=1的上方，颜色空间的数值在变换后整体上升，R越小，颜色数值上升得越明显，宏观的表现为图片亮度上升增加。</span></p> 
<p style="text-align:left"><br> </p> 
<p style="text-align:left">              <img src="https://images2.imgbox.com/be/d5/86rNEqTs_o.png" width="600" height="400" border="2" alt=""></p> 
<p style="text-align:left"><br> </p> 
<p style="text-align:left"><span style="font-family:SimSun; font-size:14px">当一张图片的像素在颜色空间的值都比较大（曝光过度）或者比较小（曝光不足）的情况下，选用合理的R值能减小或者增加其颜色亮度，并使颜色分布更为均匀和丰富，图片效果得到明显的改善。<strong>但是这种方法并非对所有在曝光上有缺陷的图片都适用，</strong>这是在使用这个方法的时候<strong><u>必须要注意</u></strong>的。</span></p> 
<p style="text-align:left"><u><br> </u></p> 
<p style="text-align:left"><u><span style="font-family:SimSun; font-size:14px">当一张曝光过度的图片中存在颜色较暗的区域（比如背光面，阴影，颜色较深的物体），由gamma函数图像可以看出，当选取较小的R值，过度曝光得不到充分的改善；而当选取较大的R值，该区域将会变成黑乎乎的一片。同样，当一张曝光不足的图片存在颜色较亮的区域（比如天空，白色背景，反光物等），如果选取R值较大，则曝光不足得不到改善；而当选取较小的R值，这个区域将变得更亮，从图片上看就觉得很“扎眼”。</span></u></p> 
<p style="text-align:left"><br> </p> 
<p style="text-align:left"><span style="font-family:SimSun; font-size:14px">因此，虽然这种方法对图片的曝光率具有较好的调整效果，但是如果素材明暗差异较大，在调整调整较亮或较暗区域时，要注意减小对较暗或较亮区域的影响。事实上可以根据相同的原理，利用插值的方法构造相对应的处理函数，<span style="color:rgb(79,79,79); font-family:SimSun; font-size:14px; line-height:28px">以得到更加精致的处理效果。</span></span></p> 
<p><br> </p> 
<p><br> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/22635042b6ed6519200b057b3947f2b0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">特征工程之特征选择</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/32f96b31a00c9797de5d5c95c41dea49/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">单独获取字典中的键和值、并进行字典排序——Python</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>