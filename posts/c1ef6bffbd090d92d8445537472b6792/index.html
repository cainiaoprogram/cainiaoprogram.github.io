<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>机器学习中关于随机森林和XGBoost算法的特征选择 （一） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="机器学习中关于随机森林和XGBoost算法的特征选择 （一）" />
<meta property="og:description" content="文章目录 前言一、历年论文对特征选择的处理（选取两篇）1.具体问题2.优秀论文 二、XGBoost算法的应用三、随机森林的特征选择四、自己对特征选择的处理五、遇到的问题和建议总结 前言 近年来机器学习在数学建模竞赛和大数据竞赛中的应用越来越广泛，本文是基于2023年mothor cup 大数据竞赛B题第一问中特征选择，参考历年优秀论文和数学建模清风老师的内容，结合自己的实际想法而作。
一、历年论文对特征选择的处理（选取两篇） 1.具体问题 依据附件1“估价训练数据”所提供的训练用二手车交易样本数据及题目文本涉及的其他相关资料，基于机器学习及统计学理论知识，联系结合各特征变量，训练并测试模型，以选择二手车交易的最优估价方法并预测附件2“估计验证数据”的二手车零售交易价格，最后将预测结果保存在附件3“估价模型结果”文件中。
2.优秀论文 论文1：针对问题一，第一步(数据清洗)：本文运用统计指标、K近邻算法(KNN)等填充方法，逐个对附件1、附件2进行缺失值、异常值处理。第二步(特征工程)：本文对部分类别特征数据进行标签编码和独热编码，然后进行特征构造并删除重复信息的字段，同时对部分数值特征进行分箱处理。第三步(可视化)：利用pandas-profiling工具生成研究报告，并通过绘制分布图、热力图、三维柱状图、三维散点图等，对特征变量进行统计解释。第四步(模型准备)：本文依据题干信息及统计学理论，建立并采用评测标准、调整决定系数𝑹𝟐、平均相对误差、5%误差准确率这四项指标作为本文的模型评估标准。第五步(模型建立)：本文先建立神经网络模型评判数据集预测情况，然后利用XGBoost算法、随机森林、SFS序列前向选择筛选得到34个特征。
通过联合比较XGBoost算法中特征重要性分数大于0.3%的变量与随机森林回归模型重要性评分大于0.03的变量，取其交集得到二者共同遴选出的特征变量，再将之与步骤三中特征前向选择的结果取并集，并绘制关键词标签云，最终筛选得到34个特征变量。
去有风的地方 A Beautiful Smile 失眠 眼泪落下之前
论文二·：摘要：针对问题一，主要需要确定影响成交价格的因素并建立合适的预测模型。本文建立了基于Stacking 技术XGBoost、LightGBM 和CatBoost 融合模型来进行估价，并运用贝叶斯优化进行模型超参数调优。首先，我们对数据进行异常值剔除、正态转换和缺省值填补的预处理，构造出便于统计分析的特征，选取与成交价格有密切关系的28 个特征并做检验。
正文：首先对构造后得到的连续特征进行相关性分析：计算变量间的Pearson 系数，正值表示正相关，负值表示负相关，绝对值越大表示线性相关程度越高。然后利用XGBoost 算法获取特征重要性，依据模型在验证集上的效果对特征按照重要性程度从低到高进行排序。
两篇论文解决的都是相同的问题，很明显论文1的陈述更加全面准确，论文2稍显逊色。二者都运用了XGBoost对特征的重要性排序，论文1中的独热编码和标签词云也是非常精彩的应用，接下来介绍XGBoost.
二、XGBoost算法的应用 目前机器学习中应用最多的是python，各个平台对机器学习的介绍大多数都是Python，下面的代码是jyputer notebook中的，相较于Python的编辑环境，notebook比较类似，可能更简便，可以从winpython或者anaconda运行。
代码如下（示例）：
# plot feature importance using built-in function import matplotlib.pyplot as plt import matplotlib matplotlib.use(&#39;qt4agg&#39;) #指定默认字体 matplotlib.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;] matplotlib.rcParams[&#39;font.family&#39;]=&#39;sans-serif&#39; #解决负号&#39;-&#39;显示为方块的问题 matplotlib.rcParams[&#39;axes.unicode_minus&#39;] = False %matplotlib inline %config InlineBackend.figure_format = &#39;svg&#39; plt.savefig(&#39;Water-pause-times.png&#39;, dpi=500, bbox_inches=&#39;tight&#39;) # 解决图片不清晰，不完整的问题 plt.show() from numpy import loadtxt import pandas as pd from xgboost import XGBClassifier from xgboost import plot_importance from matplotlib import pyplot dataset = pd." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c1ef6bffbd090d92d8445537472b6792/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-20T18:39:49+08:00" />
<meta property="article:modified_time" content="2023-01-20T18:39:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">机器学习中关于随机森林和XGBoost算法的特征选择 （一）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_7" rel="nofollow">前言</a></li><li><a href="#_14" rel="nofollow">一、历年论文对特征选择的处理（选取两篇）</a></li><li><ul><li><a href="#1_15" rel="nofollow">1.具体问题</a></li><li><a href="#2_17" rel="nofollow">2.优秀论文</a></li></ul> 
  </li><li><a href="#XGBoost_25" rel="nofollow">二、XGBoost算法的应用</a></li><li><a href="#_66" rel="nofollow">三、随机森林的特征选择</a></li><li><a href="#_97" rel="nofollow">四、自己对特征选择的处理</a></li><li><a href="#_100" rel="nofollow">五、遇到的问题和建议</a></li><li><a href="#_107" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_7"></a>前言</h2> 
<p>近年来机器学习在数学建模竞赛和大数据竞赛中的应用越来越广泛，本文是基于2023年mothor cup 大数据竞赛B题第一问中特征选择，参考<strong>历年优秀论文</strong>和<strong>数学建模清风</strong>老师的内容，结合自己的实际想法而作。</p> 
<hr> 
<h2><a id="_14"></a>一、历年论文对特征选择的处理（选取两篇）</h2> 
<h3><a id="1_15"></a>1.具体问题</h3> 
<p>依据附件1“估价训练数据”所提供的训练用二手车交易样本数据及题目文本涉及的其他相关资料，基于机器学习及统计学理论知识，联系结合各特征变量，训练并测试模型，以选择二手车交易的最优估价方法并预测附件2“估计验证数据”的二手车零售交易价格，最后将预测结果保存在附件3“估价模型结果”文件中。</p> 
<h3><a id="2_17"></a>2.优秀论文</h3> 
<p>论文1：针对问题一，第一步(数据清洗)：本文运用统计指标、K近邻算法(KNN)等填充方法，逐个对附件1、附件2进行缺失值、异常值处理。第二步(特征工程)：本文对部分类别特征数据进行标签编码和独热编码，然后进行特征构造并删除重复信息的字段，同时对部分数值特征进行分箱处理。第三步(可视化)：利用pandas-profiling工具生成研究报告，并通过绘制分布图、热力图、三维柱状图、三维散点图等，对特征变量进行统计解释。第四步(模型准备)：本文依据题干信息及统计学理论，建立并采用评测标准、调整决定系数𝑹𝟐、平均相对误差、5%误差准确率这四项指标作为本文的模型评估标准。第五步(模型建立)：本文先建立神经网络模型评判数据集预测情况，然后利用XGBoost算法、随机森林、SFS序列前向选择筛选得到34个特征。<br> <img src="https://images2.imgbox.com/16/91/6FvtibTF_o.png" alt="在这里插入图片描述"><br> 通过联合比较XGBoost算法中特征重要性分数大于0.3%的变量与随机森林回归模型重要性评分大于0.03的变量，取其交集得到二者共同遴选出的特征变量，再将之与步骤三中特征前向选择的结果取并集，并绘制关键词标签云，最终筛选得到34个特征变量。<br> 去有风的地方 A Beautiful Smile 失眠 眼泪落下之前<br> 论文二·：摘要：针对问题一，主要需要确定影响成交价格的因素并建立合适的预测模型。本文建立了基于Stacking 技术XGBoost、LightGBM 和CatBoost 融合模型来进行估价，并运用贝叶斯优化进行模型超参数调优。首先，我们对数据进行异常值剔除、正态转换和缺省值填补的预处理，构造出便于统计分析的特征，选取与成交价格有密切关系的28 个特征并做检验。<br> 正文：首先对构造后得到的连续特征进行相关性分析：计算变量间的Pearson 系数，正值表示正相关，负值表示负相关，绝对值越大表示线性相关程度越高。然后利用XGBoost 算法获取特征重要性，依据模型在验证集上的效果对特征按照重要性程度从低到高进行排序。<br> 两篇论文解决的都是相同的问题，很明显论文1的陈述更加全面准确，论文2稍显逊色。二者都运用了XGBoost对特征的重要性排序，论文1中的独热编码和标签词云也是非常精彩的应用，接下来介绍XGBoost.</p> 
<h2><a id="XGBoost_25"></a>二、XGBoost算法的应用</h2> 
<p>目前机器学习中应用最多的是python，各个平台对机器学习的介绍大多数都是Python，下面的代码是jyputer notebook中的，相较于Python的编辑环境，notebook比较类似，可能更简便，可以从winpython或者anaconda运行。<br> 代码如下（示例）：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">plot</span> <span class="token expression">feature importance using built<span class="token operator">-</span>in function</span></span>
import matplotlib<span class="token punctuation">.</span>pyplot as plt
import matplotlib
matplotlib<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token char">'qt4agg'</span><span class="token punctuation">)</span>
#指定默认字体
matplotlib<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token char">'font.sans-serif'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token char">'SimHei'</span><span class="token punctuation">]</span>
matplotlib<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token char">'font.family'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token char">'sans-serif'</span>
#解决负号<span class="token char">'-'</span>显示为方块的问题
matplotlib<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token char">'axes.unicode_minus'</span><span class="token punctuation">]</span> <span class="token operator">=</span> False
<span class="token operator">%</span>matplotlib <span class="token keyword">inline</span>
<span class="token operator">%</span>config InlineBackend<span class="token punctuation">.</span>figure_format <span class="token operator">=</span> <span class="token char">'svg'</span>
plt<span class="token punctuation">.</span><span class="token function">savefig</span><span class="token punctuation">(</span><span class="token char">'Water-pause-times.png'</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">500</span><span class="token punctuation">,</span> bbox_inches<span class="token operator">=</span><span class="token char">'tight'</span><span class="token punctuation">)</span> # 解决图片不清晰，不完整的问题
plt<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

from numpy import loadtxt
import pandas as pd
from xgboost import XGBClassifier
from xgboost import plot_importance
from matplotlib import pyplot

dataset <span class="token operator">=</span> pd<span class="token punctuation">.</span><span class="token function">read_excel</span><span class="token punctuation">(</span><span class="token char">'jupyter 试.xlsx'</span><span class="token punctuation">)</span>
dataset<span class="token punctuation">.</span><span class="token function">head</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
y<span class="token operator">=</span>dataset<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span>#取<span class="token number">1</span>到<span class="token number">3</span>行，前两列，取前不去后，从<span class="token number">0</span>开始
X<span class="token operator">=</span>dataset<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token operator">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">]</span>
model <span class="token operator">=</span> <span class="token function">XGBClassifier</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
from sklearn<span class="token punctuation">.</span>preprocessing import LabelEncoder
le <span class="token operator">=</span> <span class="token function">LabelEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> le<span class="token punctuation">.</span><span class="token function">fit_transform</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>

model<span class="token punctuation">.</span><span class="token function">fit</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
<span class="token macro property"><span class="token directive-hash">#</span> <span class="token directive keyword">plot</span> <span class="token expression">feature importance</span></span>
<span class="token function">plot_importance</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span>
pyplot<span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
pyplot<span class="token punctuation">.</span><span class="token function">figure</span><span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>此代码也是多方查阅，并非原创，如有侵权还望见谅。</p> 
<h2><a id="_66"></a>三、随机森林的特征选择</h2> 
<pre><code class="prism language-cpp">利用随机森林得到指标的重要性
（因为这个过程中具有随机性，所以每次运行的结果可能有细微区别，我们以某一次的结果为主就好了）
trainingData <span class="token operator">=</span> data1<span class="token punctuation">;</span>
inputTable <span class="token operator">=</span> trainingData<span class="token punctuation">;</span>
predictorNames <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token char">'VarName1'</span><span class="token punctuation">,</span> <span class="token char">'VarName2'</span><span class="token punctuation">,</span> <span class="token char">'VarName3'</span><span class="token punctuation">,</span> <span class="token char">'VarName4'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
predictors <span class="token operator">=</span> <span class="token function">inputTable</span><span class="token punctuation">(</span><span class="token operator">:</span><span class="token punctuation">,</span> predictorNames<span class="token punctuation">)</span><span class="token punctuation">;</span>
response <span class="token operator">=</span> inputTable<span class="token punctuation">.</span>VarName5<span class="token punctuation">;</span>
isCategoricalPredictor <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token operator">%</span> Train a classifier
<span class="token operator">%</span> This code specifies all the classifier options <span class="token operator">and</span> trains the classifier<span class="token punctuation">.</span>
<span class="token keyword">template</span> <span class="token operator">=</span> <span class="token function">templateTree</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token char">'MaxNumSplits'</span><span class="token punctuation">,</span> <span class="token number">143</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
classificationEnsemble <span class="token operator">=</span> <span class="token function">fitcensemble</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    predictors<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    response<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token char">'Method'</span><span class="token punctuation">,</span> <span class="token char">'Bag'</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token char">'NumLearningCycles'</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token char">'Learners'</span><span class="token punctuation">,</span> <span class="token keyword">template</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token char">'ClassNames'</span><span class="token punctuation">,</span> <span class="token function">categorical</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token char">'变色鸢尾'</span><span class="token punctuation">;</span> <span class="token char">'山鸢尾'</span><span class="token punctuation">;</span> <span class="token char">'维吉尼亚鸢尾'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


importance <span class="token operator">=</span><span class="token function">oobPermutedPredictorImportance</span><span class="token punctuation">(</span>classificationEnsemble<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token operator">%</span> 可以将重要性归一化到<span class="token punctuation">[</span><span class="token number">0</span> <span class="token number">1</span><span class="token punctuation">]</span>区间内  <span class="token operator">%</span> https<span class="token operator">:</span><span class="token comment">//ww2.mathworks.cn/matlabcentral/answers/783611-need-predictor-importance-in-random-forest-expressed-as-a-percentage#answer_671247</span>
<span class="token function">importance</span><span class="token punctuation">(</span>importance<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
importance <span class="token operator">=</span> importance<span class="token punctuation">.</span><span class="token operator">/</span><span class="token function">sum</span><span class="token punctuation">(</span>importance<span class="token punctuation">)</span>
</code></pre> 
<p>此代码完全借鉴于清风老师随机森林的特征选择，具体课程是机器学习进阶中的21讲和22讲，真心推荐清风老师的课程，性价比很高，很实用。</p> 
<h2><a id="_97"></a>四、自己对特征选择的处理</h2> 
<p>第一步（数据预处理）：对附件1与附件2的数据集进行预处理，利用统计学手段处理原始数据集中的缺失值。第二步（变量划分）对语音业务和上网业务的影响因素划分为分类变量和数值变量，并将分类变量转化为独热编码。第三步（统计学分析）：对分类变量和数值变量分别进行方差分析和相关性分析，以其是否通过显著性检验和假设性检验来筛选主要因素。第四步（特征排序）：利用Jyputer notebook中的XGBoost算法进行特征排序，最后结合二者的交集确定主要因素。<br> 由于时间关系和能力问题，对于论文1中相对完美的特征选择并没有完全实现，采取方差分析和相关系数与XGBoost算法结合的粗略计算筛选，相较于论文2有进步但还是差强人意。</p> 
<h2><a id="_100"></a>五、遇到的问题和建议</h2> 
<p>问题1：独热编码问题，查阅资料可以利用Python 中的pandas库实现，或者在Excel中的if函数。<br> 问题2：XGBoost在MATLAB中实现难度较大，需要下载工具箱，并且下载地址在外网，经常打不开，网上的资源也是面包多上的付费资源，价格也挺昂贵，还是用开源的Python比较好。但是变量太多会出现画图重叠的问题，每次使用部分变量不知道会不会有影响。</p> 
<hr> 
<h2><a id="_107"></a>总结</h2> 
<p>希望以上内容能对涉及有关内容的友友们有所帮助，同时也希望基础不太好或者初学者更多地接触Python，当然也推荐购买数学建模清风老师的课程，涉及到SPSS、STATA、MATLAB、EXCEL、画图软件等等。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/763ab0f3ec23686a46e5d6aa47e03a00/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C&#43;&#43;调用yolov5 onnx模型的初步探索</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0ba7ccef5812ef5ed1a83b922cf39048/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">CRNN模型Python实现笔记一</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>