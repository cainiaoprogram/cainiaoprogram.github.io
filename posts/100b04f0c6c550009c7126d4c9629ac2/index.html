<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>LTE切换信令详析及注释（附图） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="LTE切换信令详析及注释（附图）" />
<meta property="og:description" content="典型的前台切换信令如下图所示，从测量报告上报到切换完成后直至读取目标小区的系统消息，与前台UE相关的总共有7条层三信令。
7条信令的作用基本如下：
UE测量报告上报：告知源eNodeB目标小区的PCI，需要进行切换；
源小区向UE下发RRC连接重配置信息：此信息中将分配的专用接入签名配置给UE；
UE向目标小区发RRC连接重配置完成消息：表示UE已经切换到了目标侧；
目标小区向UE下发RRC连接重配置信息：此信息中将目前小区中的邻区信息下发给UE，开测量。
UE向目标小区发RRC连接重配置完成消息：表示UE已经打开了测量，可以进行下次切换；
UE在目标小区读取系统消息。
下面对各个前台信令中的解码内容进行详细说明：
1---测量报告
测量报告中报告了本小区RSRP值、RSRQ值以及目标小区PCI、目标小区RSRP值、目标小区RSRQ值。
其中主要注意的是目标小区PCI以及目标小区RSRP值。（测出来的RSRP值减去140即可转换为通常的负值。后面括号中的区间即为转换为转换后的值。）
2---源小区向UE下发RRC链接重配置信息
在UE上包测量报告后，源小区向目标小区发起“Handover Request”请求。目标小区收到请求后回应“Handover Request Acknowlege”，然后源小区向UE下发RRC连接重配置信息。
此时，消息将告诉UE的信息有：
告诉UE停止进行测量（MeasObjectToRemoveList）；
告诉UE目标小区PCI（mobilityControlInfo消息中）；
告诉UE目标小区相对频点号；
告诉UE目标小区载频带宽；
T304定时器（T304是连接模式下UE等待UE Capability Information Confirm的定时器，单位为毫秒默认设置为1S）；
无线资源配置
PRACH信道相关的配置信息参考如下表：
RRC Connection Reconfiguration还包含各个信道的配置信息，如PDSCH、PUSCH、PHICH、PUCCH、上行功率控制信息，以及小区通道数配置信息。
PDSCH- referencesignalpower为单个RE的参考信号的功率（绝对值），D=(P&#43;60)*10，取值范围(-60…50) Step:0.1,单位dBm，如上图值为12，实际功率值为12/10-60= -58.8dBm。
P_B为包含小区RS的PDSCH的EPRE与不包含小区RS的PDSCH的EPRE的比值，取值范围enumerate(0,1,2,3)。
PUSCH信道相关配置信息如下表所示：
Antennalportscount为小区支持的天线端口数目，配置范围为0~2，分别对应的天线端口数目enumerate(1,2,4)。
3---UE向目标小区发RRC连接重配置完成
UE收到目标小区下发的重配消息后，按照消息内的要求进行重配，重配完成后对RRC Connection Reconfiguration消息的回应消息，无实质内容。
4---目标小区向UE下发RRC连接重配置信息
在UE向目标小区发RRC连接重配置完成消息后，若后台信令正常，则目标小区再次向UE下发RRC连接重配置信息，此次重配消息中包含了目标小区的邻区列表以及开测量（代替TDS中的测量控制）。
1、目标小区的频点、带宽、邻区配置数量和小区质量偏移 RRC Connection Reconfiguration信令首先提供给终端目标小区的频点、带宽、邻区配置数量和小区质量偏移。
AllowedMeasBandWidth表示可测量带宽，配置值范围为0~5，分别对应1.4M(6RB)，3M(15RB)，5M(25RB)，10M(50RB)，15M(75RB)，20M(100RB)。
NeighCellConfig值表示配置的邻区数目，为16进制数值。
Q_OffsetRange是频间偏移值，影响小区间重选的偏移值，配置值范围为0~30，分别对应的实际取值：enumerate(-24,-22,-20,-18,-16,-14,-12,-10,-8,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,8,10,12,14,16,18,20,22,24)dB
2、邻区信息及A3事件相关参数 在RRC Connection Reconfiguration中还包括把邻区信息、A3事件相关参数提供给终端，因而在TD-LTE系统里没有测量控制信令
上图所示，RRC Connection Reconfiguration还包含邻区列表信息，包括所有邻区的小区编号Cell ID、PCI、Q_Offset等信息。
另外，携带了A3事件相关的测量信息，包括如下信息：
A3_Offset表示触发A3事件的偏移量。
Hysterisis表示进行判决时迟滞范围，取值范围0~30，分别对应(0，0.5，…，15)dB，step 0.5dB。
Time to Trigger监测到事件发生的时刻到事件上报的时刻之间的时间差，其含义是只有当特定测量事件（如2a）条件在一段时间即触发时间（TimeToTrigger）内始终满足事件条件才上报该事件，取值范围0~15，对应的实际取值enum(0, 40, 64, 80, 100, 128, 160, 256, 320, 480, 512, 640, 1024, 1280, 2560, 5120)ms。上图配置为8对应320ms。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/100b04f0c6c550009c7126d4c9629ac2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-12-13T15:03:24+08:00" />
<meta property="article:modified_time" content="2019-12-13T15:03:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">LTE切换信令详析及注释（附图）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>典型的前台切换信令如下图所示，从测量报告上报到切换完成后直至读取目标小区的系统消息，与前台UE相关的总共有7条层三信令。</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/58/d2/mmmBagEl_o.png"></p> 
<p>7条信令的作用基本如下：</p> 
<ul><li> <p>UE测量报告上报：告知源eNodeB目标小区的PCI，需要进行切换；</p> </li><li> <p>源小区向UE下发RRC连接重配置信息：此信息中将分配的专用接入签名配置给UE；</p> </li><li> <p>UE向目标小区发RRC连接重配置完成消息：表示UE已经切换到了目标侧；</p> </li><li> <p>目标小区向UE下发RRC连接重配置信息：此信息中将目前小区中的邻区信息下发给UE，开测量。</p> </li><li> <p>UE向目标小区发RRC连接重配置完成消息：表示UE已经打开了测量，可以进行下次切换；</p> </li><li> <p>UE在目标小区读取系统消息。</p> </li></ul> 
<p>下面对各个前台信令中的解码内容进行详细说明：</p> 
<p> </p> 
<p>1<strong>---测量报告</strong></p> 
<p>测量报告中报告了本小区RSRP值、RSRQ值以及目标小区PCI、目标小区RSRP值、目标小区RSRQ值。</p> 
<p>其中主要注意的是目标小区PCI以及目标小区RSRP值。（测出来的RSRP值减去140即可转换为通常的负值。后面括号中的区间即为转换为转换后的值。）</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/ed/9e/Pg4zZalb_o.png"></p> 
<p> </p> 
<p>2<strong>---源小区向UE下发RRC链接重配置信息</strong></p> 
<p>在UE上包测量报告后，源小区向目标小区发起“Handover Request”请求。目标小区收到请求后回应“Handover Request Acknowlege”，然后源小区向UE下发RRC连接重配置信息。</p> 
<p>此时，消息将告诉UE的信息有：</p> 
<ul><li> <p>告诉UE停止进行测量（MeasObjectToRemoveList）；</p> </li><li> <p>告诉UE目标小区PCI（mobilityControlInfo消息中）；</p> </li><li> <p>告诉UE目标小区相对频点号；</p> </li><li> <p>告诉UE目标小区载频带宽；</p> </li><li> <p>T304定时器（T304是连接模式下UE等待UE Capability Information Confirm的定时器，单位为毫秒默认设置为1S）；</p> </li><li> <p>无线资源配置</p> </li></ul> 
<p><img alt="" class="has" src="https://images2.imgbox.com/9b/89/db1dFyhj_o.png"></p> 
<p>PRACH信道相关的配置信息参考如下表：</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/9e/3d/a3ps1Uce_o.png"></p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/7a/f0/86Ru8G2n_o.png"></p> 
<p>RRC Connection Reconfiguration还包含各个信道的配置信息，如PDSCH、PUSCH、PHICH、PUCCH、上行功率控制信息，以及小区通道数配置信息。</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/4f/3e/ywv9710T_o.png"></p> 
<p><strong>PDSCH- referencesignalpower</strong>为单个RE的参考信号的功率（绝对值），D=(P+60)*10，取值范围(-60…50) Step:0.1,单位dBm，如上图值为12，实际功率值为12/10-60= -58.8dBm。</p> 
<p><strong>P_B</strong><strong>为</strong>包含小区RS的PDSCH的EPRE与不包含小区RS的PDSCH的EPRE的比值，取值范围enumerate(0,1,2,3)。</p> 
<p><strong>PUSCH</strong><strong>信道相关配置信息</strong>如下表所示：</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/fa/d3/Fx9oBSqe_o.png"></p> 
<p><strong>Antennalportscount</strong><strong>为小</strong>区支持的天线端口数目，配置范围为0~2，分别对应的天线端口数目enumerate(1,2,4)。</p> 
<p> </p> 
<p>3<strong>---UE向目标小区发RRC连接重配置完成</strong></p> 
<p>UE收到目标小区下发的重配消息后，按照消息内的要求进行重配，重配完成后对RRC Connection Reconfiguration消息的回应消息，无实质内容。</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/61/23/DqGfuFvg_o.png"></p> 
<p> </p> 
<p>4<strong>---目标小区向UE下发RRC连接重配置信息</strong></p> 
<p>在UE向目标小区发RRC连接重配置完成消息后，若后台信令正常，则目标小区再次向UE下发RRC连接重配置信息，此次重配消息中包含了目标小区的邻区列表以及开测量（代替TDS中的测量控制）。</p> 
<h4>1、目标小区的频点、带宽、邻区配置数量和小区质量偏移</h4> 
<p>RRC Connection Reconfiguration信令首先提供给终端目标小区的频点、带宽、邻区配置数量和小区质量偏移。</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/c5/db/IsmAqNcC_o.png"></p> 
<p><strong>AllowedMeasBandWidth</strong>表示可测量带宽，配置值范围为0~5，分别对应1.4M(6RB)，3M(15RB)，5M(25RB)，10M(50RB)，15M(75RB)，20M(100RB)。</p> 
<p><strong>NeighCellConfig</strong><strong>值</strong>表示配置的邻区数目，为16进制数值。</p> 
<p><strong>Q_OffsetRange</strong><strong>是</strong>频间偏移值，影响小区间重选的偏移值，配置值范围为0~30，分别对应的实际取值：enumerate(-24,-22,-20,-18,-16,-14,-12,-10,-8,-6,-5,-4,-3,-2,-1,0,1,2,3,4,5,6,8,10,12,14,16,18,20,22,24)dB</p> 
<p> </p> 
<h4><strong>2、邻区信息及A3事件相关参数</strong></h4> 
<p>在RRC Connection Reconfiguration中还包括把邻区信息、A3事件相关参数提供给终端，因而在TD-LTE系统里没有测量控制信令</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/77/36/GfL9Vf6h_o.png"></p> 
<p>上图所示，RRC Connection Reconfiguration还包含邻区列表信息，包括所有邻区的小区编号Cell ID、PCI、Q_Offset等信息。</p> 
<p>另外，携带了A3事件相关的测量信息，包括如下信息：</p> 
<p><strong>A3_Offset</strong>表示触发A3事件的偏移量。</p> 
<p><strong>Hysterisis</strong>表示进行判决时迟滞范围，取值范围0~30，分别对应(0，0.5，…，15)dB，step 0.5dB。</p> 
<p><strong>Time to Trigger</strong>监测到事件发生的时刻到事件上报的时刻之间的时间差，其含义是只有当特定测量事件（如2a）条件在一段时间即触发时间（TimeToTrigger）内始终满足事件条件才上报该事件，取值范围0~15，对应的实际取值enum(0, 40, 64, 80, 100, 128, 160, 256, 320, 480, 512, 640, 1024, 1280, 2560, 5120)ms。上图配置为8对应320ms。</p> 
<p><strong>Trigger Quantity</strong>表示事件触发的测量指标，可选RSRP、RSRQ，配置值为0~1，分别对应测量的指标enumerate(rsrp, rsrq)。</p> 
<p><strong>MaxReportCells</strong>表示最大上报小区数目，对应可配置的数目为1~8个。</p> 
<p><strong>ReportInterval</strong>事件触发周期报告间隔，配置范围0~12，对应的配置值enum(120ms, 240ms, 480ms, 640ms, 1024ms, 2048ms, 5120ms, 10240ms, 1min, 6min, 12min, 30min, 60min)。</p> 
<p><strong>ReportAmount</strong>事件触发周期报告次数，配置范围0~7，分别对应的值为(1, 2, 4, 8, 16, 32, 64, Infinity)次，上图中配置为0,对应上报报告次数为1次。</p> 
<p><br><strong>3、滤波系数相关参数</strong></p> 
<p>FilterCoefficient测量时的RSRP层3滤波系数，配置范围0~14，对应的取值enum (0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 13, 15, 17, 19)。</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/c3/d5/4BorG5rX_o.png"></p> 
<p> </p> 
<p>5<strong>---切换实际案例</strong></p> 
<p>如何快速从层三信令上确定是否是由于邻区漏配导致的掉线？</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/eb/e8/kkWg8bzd_o.png"></p> 
<p>如上图，若发现信令中连续发现存在3次测量报告，且后续直接进行系统消息的读取，则可怀疑是存在邻区漏配的问题。</p> 
<p>首先从测量报告的上一次重配置消息中确认该小区的邻区列表：</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/66/8b/Uql1zUnH_o.png"></p> 
<p>从上表中可以看到该小区已经配置的邻区PCI有161、153、151、162、160、168、185、192、152、161、191等共十个邻区。</p> 
<p>再查看三次测量报告的测量的PCI的值：</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/51/f9/3OwkZGgF_o.png"></p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/fd/d8/OaZq378S_o.png"></p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/30/43/kwSPn92T_o.png"></p> 
<p>由三次测量报告可见，UE在该小区需要向PCI为136的小区进行切换，而在本小区的小区列表中并不存在136的小区，因此该小区存在邻区漏配的情况。</p> 
<p> </p> 
<p>6<strong>---相关疑问</strong></p> 
<p><strong>Q:</strong><strong>如果测量报告中有两个小区同时满足测量条件，系统如何处理？</strong></p> 
<p>如果在实际测试中发现有两个小区的信号满足触发要求，UE会将两个小区的信号场强均上报。在系统中，上报满足条件小区数可设置，目前中兴设备设置最多报告3个小区。eNodeB根据上报的场强进行切换。</p> 
<p><strong>Q:</strong><strong>为什么系统消息有在两次重配后收到，也有在两次重配间收到的情况？</strong></p> 
<p>     由于系统消息的下发是采用固定的周期间隔进行下发，如果UE在目标小区后收到系统消息的时间处于两次重配之间则为后一种情况。如果UE在目标小区后收到系统消息的时间处于两次重配之后则为前一种情况。</p> 
<p><strong>Q:</strong><strong>测量报告中的值转换为负值时，为什么显示为一个区间？</strong></p> 
<p>     在测量报告中的格式通常为“RSRP_Range = 56 ( -85 dBm &lt;= RSRP &lt; -84 dBm )”，如果按照56 -140=-84 dBm。但实际显示为“-85 dBm &lt;= RSRP &lt; -84 dBm”这一个区间。主要原因是由于RSRP测量的值是RS的线性平均值（即将20M带宽内的所有RS的场强进行叠加后取均值），这样得到的结果不可能全是整数，因此软件显示是一个区间。</p> 
<p> </p> 
<p>7<strong>---切换流程</strong></p> 
<h4><strong>1 Inter-eNB X2 HandOver</strong></h4> 
<p><img alt="" class="has" src="https://images2.imgbox.com/39/31/SqtPUe9M_o.png"></p> 
<p><strong>Inter-eNB X2 HandOver</strong><strong>说明：</strong></p> 
<p>1、当eNB收到测量报告，或是因为内部负荷分担等原因，触发了切换判决，进行eNB间小区间通过X2口的切换。</p> 
<p>2、源eNB通过X2接口给目标eNB发送HANDOVER REQUEST消息，包含本eNodeB分配的Old eNB UE X2AP ID，MME分配的MME UE S1AP ID，需要建立的EPS承载列表以及每个EPS承载对应的核心网侧的数据传送的地址。目标ENB收到HANDOVER REQUEST后开始对要切换入的ERABs进行接纳处理。</p> 
<p>3、目标eNB向源eNB发送HANDOVER REQUEST ACKNOWLEDGE 消息，包含New eNB UE X2AP ID、Old eNB UE X2AP ID、新建EPS承载对应在D侧上下行数据传送的地址、目标侧分配的专用接入签名等参数。</p> 
<p>4、源eNB向UE发送RRC CONNECTION RECONFIGURATION，将分配的专用接入签名配置给UE。</p> 
<p>5、源eNB将上下行PDCP的序号通过SN STATUS TRANSFER消息发送给目标eNB。同时，切换期间的业务数据转发开始进行。</p> 
<p> 6、UE在目标eNB接入，发送RRC CONNECTION RECONFIGURATION COMPLETE消息。表示UE已经切换到了目标侧。</p> 
<p>7、目标eNB给MME发送PATH SWITCH REQUEST消息，通知MME切换业务数据的接续路径，从源eNB到目标eNB，消息中包含原侧侧的MME UE S1AP ID、目标侧侧分配的eNB UE S1AP 、EPS承载在目标侧将使用的下行地址。</p> 
<p>8、MME返回PATH SWITCH REQUEST ACKNOWLEDGE消息，表明目标侧下行地址接续已经完成，目标eNB保存消息中的MME UE S1AP ID。</p> 
<p> 9、目标eNB通过X2接口的UE Context Release消息释放掉源eNB的资源。</p> 
<p> </p> 
<h4><strong>2 Inter-eNB S1 HandOver</strong></h4> 
<p><img alt="" class="has" src="https://images2.imgbox.com/ba/4f/i5HPqQAs_o.png"></p> 
<p><strong>Inter-eNB S1 HandOver</strong><strong>说明：</strong></p> 
<p>1、当eNB收到测量报告，或是因为内部负荷分担等原因，触发了切换判决，进行eNB间小区间通过S1口的切换。</p> 
<p>2、源eNB通过S1接口的HANDOVER REQUIRED消息发起切换请求，消息中包含MME UE S1AP ID、源侧分配的eNB UE S1AP ID等信息。</p> 
<p>3、The target eNB receives the HANDOVER REQUEST message from the MME and try to admit the handover E-RABs. MME向目标eNB发送HANDOVER REQUEST消息，消息中包括MME分配的MME UE S1AP ID、需要建立的EPS列表以及每个EPS承载对应的核心网侧数据传送的地址等参数。</p> 
<p>4、目标eNB分配后目标侧的资源后，进行切换入的承载接纳处理，，给MME发送HANDOVER REQUEST ACKNOWLEDGE消息，包含目标侧侧分配的eNB UE S1AP ID，接纳成功的EPS承载对应的eNodeB侧数据传送的地址等参数。</p> 
<p>5、原eNB收到HANDOVER COMMAND，获知接纳成功的承载信息以及切换期间业务数据转发的目标侧地址 。</p> 
<p>6、源eNB向UE发送RRCConnectionReconfiguration消息，指示UE切换指定的小区.</p> 
<p>7、源eNB通过eNB Status Transfer消息，MME通过MME Status Transfer消息 ，将PDCP序号通过MME从源eNB传递到目标eNB。</p> 
<p>8、目标eNB收到UE发送的RRCConnectionReconfigurationComplete消息，表明切换成功。</p> 
<p>9、目标侧eNB发送HANDOVER NOTIFY消息，通知MME目标侧UE已经成功接入。</p> 
<p>10、源侧eNB发送</p> 
<p>9、 The source eNB receives the UE CONTEXT RELEASE COMMAND message from the MME,begins release resource.</p> 
<p>10、MME发送UE CONTEXT RELEASE COMPLETE给eNB，释放原侧资源。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/270e0a7cf81bbcc73f33c5d7587cca68/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">JPA：Spring Data JPA     @OneToMany级联，多方删除修改新增总结（尤其删除操作:添加注解属性orphanRemoval在下一篇解释删除）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8b10a65413dbe199a5f79561ed9d51a0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【数据处理】 python 极速极简画图——频数(率)分布直方图</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>