<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python编程之子进程管理(subprocess)详解 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Python编程之子进程管理(subprocess)详解" />
<meta property="og:description" content="文章目录 引言模块介绍subprocess.run()实例 subprocess.Popen()实例 注意 Reference 引言 在写程序时，我们无法避免需要运行外部程序，相较于功能比较简单的os.system()，更加倾向于使用subprocess模块来执行外部程序。
模块介绍 subprocess.run() 使用subprocess.run()执行命令的时候，父进程会一直等待直到子进程结束后才会继续运行父进程
subprocess.run(args, *, stdin=None, input=None, stdout=None, stderr=None, capture_output=False, shell=False, cwd=None, timeout=None, check=False, encoding=None, errors=None, text=None, env=None, universal_newlines=None, **other_popen_kwargs) &#34;&#34;&#34; 参数介绍 1. args: cmd命令 2. stdin: 传递参数进来 3. input: 传递参数进来，使用input的时候不能使用stdin 4. stdout: 外部程序的输出，可以指定通过管道(subprocess.PIPE) 5. stderr: 外部程序的报错输出, 可以指定通过管道(subprocess.PIPE)或者和stdout使用同一句柄(stderr=subprocess.STDOUT) 6. capture_output: 同时获取stdout和stderr 7. shell: 是否通过shell执行命令 8. cwd: 命令执行的工作目录 9. timeout: 如果超时则终止子进程，该参数被传递给Popen.communicate() 10. check: 检查returncode是否为0，如果不为0则引发subprocess.CalledProcessError错误, 可以通过try....except...捕获 11. encoding: 编码类型 12. errors: 13. text: 可用来代替universal_newlines 14." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/41773eac9def4adb6b06c87a8bd31d75/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-02T09:16:05+08:00" />
<meta property="article:modified_time" content="2023-08-02T09:16:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python编程之子进程管理(subprocess)详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">引言</a></li><li><a href="#_8" rel="nofollow">模块介绍</a></li><li><ul><li><a href="#subprocessrun_9" rel="nofollow">subprocess.run()</a></li><li><ul><li><a href="#_39" rel="nofollow">实例</a></li></ul> 
   </li><li><a href="#subprocessPopen_67" rel="nofollow">subprocess.Popen()</a></li><li><ul><li><a href="#_113" rel="nofollow">实例</a></li></ul> 
   </li><li><a href="#_130" rel="nofollow">注意</a></li></ul> 
  </li><li><a href="#Reference_133" rel="nofollow">Reference</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>引言</h2> 
<p>在写程序时，我们无法避免需要运行外部程序，相较于功能比较简单的os.system()，更加倾向于使用subprocess模块来执行外部程序。</p> 
<h2><a id="_8"></a>模块介绍</h2> 
<h3><a id="subprocessrun_9"></a>subprocess.run()</h3> 
<p>使用subprocess.run()执行命令的时候，父进程会一直等待直到子进程结束后才会继续运行父进程</p> 
<pre><code class="prism language-python">subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>args<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> stdin<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token builtin">input</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> stderr<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> capture_output<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> cwd<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> check<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> 
　　　　　　　　　　encoding<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> env<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> universal_newlines<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token operator">**</span>other_popen_kwargs<span class="token punctuation">)</span>

<span class="token triple-quoted-string string">"""
参数介绍
    
    1. args: cmd命令
    2. stdin: 传递参数进来
    3. input: 传递参数进来，使用input的时候不能使用stdin
    4. stdout: 外部程序的输出，可以指定通过管道(subprocess.PIPE)
    5. stderr: 外部程序的报错输出, 可以指定通过管道(subprocess.PIPE)或者和stdout使用同一句柄(stderr=subprocess.STDOUT)
    6. capture_output: 同时获取stdout和stderr
    7. shell: 是否通过shell执行命令
    8. cwd: 命令执行的工作目录
    9. timeout: 如果超时则终止子进程，该参数被传递给Popen.communicate()
    10. check: 检查returncode是否为0，如果不为0则引发subprocess.CalledProcessError错误, 可以通过try....except...捕获
    11. encoding: 编码类型
    12. errors: 
    13. text: 可用来代替universal_newlines
    14. env: 设置环境变量
    15. universal_newlines: 返回数据以文本字符串输出，否则为二进制输出

"""</span>
</code></pre> 
<h4><a id="_39"></a>实例</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> subprocess <span class="token keyword">as</span> sp

<span class="token comment"># 三种方式构造命令</span>
sp<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'ls -l'</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

sp<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'ls'</span><span class="token punctuation">,</span> <span class="token string">'-l'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

sp<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'ls'</span><span class="token punctuation">,</span> <span class="token string">'-l'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># 判断是否正确执行命令</span>
sp<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'ls -l'</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> check<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># 获取命令的输出</span>
p <span class="token operator">=</span> sp<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'ls -l'</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> check<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>sp<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>sp<span class="token punctuation">.</span>PIPE<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 使用stdin接受数据传入</span>
p1 <span class="token operator">=</span> sp<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'ls -l'</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> check<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>sp<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>sp<span class="token punctuation">.</span>PIPE<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

p2 <span class="token operator">=</span> sp<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'grep lovefish'</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> check<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> stdin<span class="token operator">=</span>p1<span class="token punctuation">.</span>stdout<span class="token punctuation">,</span> stdout<span class="token operator">=</span>sp<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>sp<span class="token punctuation">.</span>PIPE<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>p2<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="subprocessPopen_67"></a>subprocess.Popen()</h3> 
<pre><code class="prism language-python"> 
subprocess<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span>args<span class="token punctuation">,</span> bufsize<span class="token operator">=</span><span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> executable<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> stdin<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> stderr<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> preexec_fn<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> close_fds<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> 
　　　　　　　　　　shell<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> cwd<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> env<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> universal_newlines<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> startupinfo<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> 
　　　　　　　　　　creationflags<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> restore_signals<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> start_new_session<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> pass_fds<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">,</span> 
　　　　　　　　　　group<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> extra_groups<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> umask<span class="token operator">=</span><span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> text<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> pipesize<span class="token operator">=</span><span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">"""
参数介绍

    1. args：cmd命令，字符串或者列表
    2. bufsize：0：无缓冲； 1：行缓冲，只可以在universal_newlines=True时被使用；其他正值则为缓冲区的大小；负数则为使用系统默认缓冲
    3. executable：一般不使用，用来表示shell程序
    4. stdin：传递数据进来
    5. stdout：命令的输出，可以指定通过管道输出(subprocess.PIPE)
    6. stderr：命令的报错输出，可以通过管道(subprocess.PIPE)或者和stdout使用同一句柄输出(subprocess.STDOUT)
    7. preexec_fns： 在exec之前执行
    8. close_fds：如果为真，在unix下，则关闭除0，1，2之外的文件。在windows下无法设置close_fds为真和重定向stderr和stdout
    9. shell：是否通过shell执行命令
    10. cwd：命令执行的工作目录
    11. env：设置环境变量
    12. universal_newlines：让返回数据以文本字符串输出
    13. pipesize：设置sp.PIPE的大小

函数介绍

    1. Popen.poll()：检查子进程是否结束
    2. Popen.wait()：等待直到子进程结束
    3. Popen.communicate()：内部数据交互，将数据发送给stdin，返回stdout和stderr
    4. Popen.send_signal()：发送信号给子进程
    5. Popen.terminate()：终止子进程，unix下对应SIGTERM，windows下对应TerminateProcess() 
    6. Popen.kill()：杀死子进程，unix下对应SIGKILL，windows下和terminate()一致

对象介绍

    1. Popen.args：命令
    2. Popen.stdout：命令的输出
    3. Popen.stderr：命令的报错输出
    4. Popen.stdin：命令接受的数据
    5. Popen.pid：子进程的ID
    6. Popen.returncode：返回值
    
"""</span>
</code></pre> 
<h4><a id="_113"></a>实例</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> subprocess <span class="token keyword">as</span> sp

<span class="token comment">#  父进程不等待子进程</span>
p <span class="token operator">=</span> sp<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span><span class="token string">'ls -l'</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>  stdout<span class="token operator">=</span>sp<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>sp<span class="token punctuation">.</span>PIPE<span class="token punctuation">)</span>

<span class="token comment"># 父进程等待子进程结束之后再继续运行</span>
p <span class="token operator">=</span> sp<span class="token punctuation">.</span>Popen<span class="token punctuation">(</span><span class="token string">'ls -l'</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>  stdout<span class="token operator">=</span>sp<span class="token punctuation">.</span>PIPE<span class="token punctuation">,</span> stderr<span class="token operator">=</span>sp<span class="token punctuation">.</span>PIPE<span class="token punctuation">)</span>

p<span class="token punctuation">.</span>wait<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 使用内容管理器</span>
<span class="token keyword">with</span> Popen<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"ls -l"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>PIPE<span class="token punctuation">)</span> <span class="token keyword">as</span> proc<span class="token punctuation">:</span> 
　　<span class="token keyword">print</span><span class="token punctuation">(</span>proc<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_130"></a>注意</h3> 
<p>在使用管道(PIPE)输出stdout或者stderr时，请注意输出的数据量不能超过PIPE的上限，否则就会出现PIPE被阻塞，导致程序被阻塞无法继续运行，可以通过使用Popen.communicate()把stdout和stderr的输出存到内存中来缓解由于PIPE过小导致subprocess.Popen()无法继续运行程序的问题</p> 
<h2><a id="Reference_133"></a>Reference</h2> 
<p><a href="https://docs.python.org/3/library/subprocess.html" rel="nofollow">subprocess 官方文档</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/550ed090d2b9aa0b55f4e82e94542da2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">[CentOS]Chkrootkit后门检测工具的安装</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/686b791dc43378c00dea9155ec23259a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">生化危机5找不到xlive.dll，要如何修复xlive.dll缺失</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>