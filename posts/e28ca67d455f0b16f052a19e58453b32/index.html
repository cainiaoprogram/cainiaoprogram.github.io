<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python模块selenium实例：电影分类排名数据生成json，sqlite和excel（openpyxl）文件（一） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Python模块selenium实例：电影分类排名数据生成json，sqlite和excel（openpyxl）文件（一）" />
<meta property="og:description" content="Python中的selenium模块是可以启动浏览器与人交互。我们知道requests模块在网页下载时配合上BeautifluSoup会简单很多，但是随着很多网站越来越注重反爬，会拒绝提供页面，而selenium模块通过启动浏览器像和普通浏览器一样的流量模式使你更容易被接受下载信息，同时长期有效性也会大很多。
这次我们的实例是通过爬取网站IMDb获取电影分类排名数据。需要说明的是这个网站在我们国内登录会有些困难，但是会登的上去，只是没那么顺畅。
同样首先我们先确定好我们的任务：
selenium模块应用的前期准备。IMDb网页分析。通过selenium获取想要的数据信息。将信息格式化。格式化后的信息存储到json，sqlite及excel中。 为此我们需要完成以下操作：
selenium模块安装及安装浏览器的webdriver。确定电影排名的网址以及网页源代码（html）内信息所在的元素。通过find_elements_*方法寻找元素并通过.text方法获取元素内文本。通过对爬取的文本进行格式化为字典模式并添加到列表中方便处理。通过json将每个类别的电影数据分别写入一个json文件，然后将所有的电影汇总写入一个json文件，最后通过sqlite3，openpyxl模块将所有的json文件写入sqlite及excel文件中。 由于内容较多我们分两篇来练习，今天就先完成1-4部分。话不多说就开始练习吧。
首先，准备工作，安装selenium模块这个就不赘述了，大家自行安装。
其次准备工作的另外一项是安装相应的浏览器的webdriver，我自己用的是chrome浏览器，所以需要去ChromePriver下载Windows系统的版本，然后将chromedriver.exe添加到PATH路径上。如果你用的其它浏览器如Firefox，请自行去下载相应的webdriver并添加到环境变量中。
接下来到了分析电影网站的步骤，我们先打开其主页，点击menu中IMDb Top 250 Movies的选项进入top250排名页面会发现此页上的电影排名并没有详细的信息，而且是个总的排名，但是我们注意到页面右边有Top Rated Movies by Genre，这表示每个分类的电影排名，先点击Action动作片分类，进去页面这里提供给我们的信息有：这个排名是在每部至少出租数25000，按照降序排列，每页有50部，默认的是按照IMDb评分排列的，并且有每部电影的详细信息如时长，评分，媒体评分，电影简介，导演，演员，投票数，票房等，这正是我们所需要的，Perfect！
再来分析分析网址的构成，网址如下：
https://www.imdb.com/search/title/?genres=action&amp;sort=user_rating,desc&amp;title_type=feature&amp;title_type=25000,&amp;pf_rd_m=A2FGELUUNOQJNL&amp;pf_rd_p=5aab685f-35eb-40f3-95f7-c53f09d542c3&amp;pf_rd_r=KXNCSE4DS589EV2SE77Q&amp;pf_rd_s=right-6&amp;pf_rd_t=15506&amp;pf_rd_i=top&amp;ref_=chttp_gnr_1
我们看下问号后面的部分，看着挺长，但是我们需要的是
genres，sort，title_type，title_type，同时还有个start表示从第几个开始，上面提到了一页有50个电影，所以start=51则表示第二页，以此类推。
所以我们需要请求的网址为：
https://www.imdb.com/search/title/?genres=action&amp;sort=user_rating,desc&amp;title_type=feature&amp;title_type=25000,&amp;start=1。
网址确定了，下面分析网页的元素，F12打开开发者工具，找到我们所需信息的元素，会发现每部电影的信息都包含在css类名为lister-item-content的div元素内。OK，至此我们完成了页面的分析，下面开始下载数据。
首先我们建立imdbmovies_ranking_bygenre.py文件，首先引入模块：
from selenium import webdriver webdriver提供了很多寻找元素的方法如下：
#使用class类name的元素： browser.find_element_by_class_name(name) browser.find_elements_by_class_name(name) #匹配css selector的元素 browser.find_element_by_css_selector(selector) browser.find_elements_by_css_selector(selector) #匹配id属性值的元素 browser.find_elements_by_id(id) browser.find_elements_by_id(id) #完全匹配提供的text的&lt;a&gt;元素 browser.find_element_by_link_text(text) browser.find_elements_by_link_text(text) #包含提供的text的&lt;a&gt;元素 browser.find_element_by_partial_link_text(text) browser.find_elements_by_partial_link_text(text) #匹配name属性值的元素 browser.find_element_by_name(name) browser.find_elements_by_name(name) #匹配标签name的元素 browser.find_element_by_tag_name(name) browser.find_elements_by_tag_name(name) 需要说明的是browser.find_element和browser.find_elements的区别为，browser.find_element返回第一个匹配的元素，而browser.find_elements则包含页面中匹配的所有元素。同时除了by_tag_name不区分大小写，其它的所有参数都区分大小写。以上所有方法返回的是webelement对象，有了此对象通过text方法获取元素内的文本，所以我们的代码如下：
def movie_lst_data(genres): &#34;&#34;&#34;Get the data from url&#34;&#34;&#34; movie_lst = [] for i in [&#39;1&#39;,&#39;51&#39;]: options = webdriver." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/e28ca67d455f0b16f052a19e58453b32/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-28T08:30:20+08:00" />
<meta property="article:modified_time" content="2022-04-28T08:30:20+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python模块selenium实例：电影分类排名数据生成json，sqlite和excel（openpyxl）文件（一）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>Python中的selenium模块是可以启动浏览器与人交互。我们知道requests模块在网页下载时配合上BeautifluSoup会简单很多，但是随着很多网站越来越注重反爬，会拒绝提供页面，而selenium模块通过启动浏览器像和普通浏览器一样的流量模式使你更容易被接受下载信息，同时长期有效性也会大很多。<br> 这次我们的实例是通过爬取网站IMDb获取电影分类排名数据。需要说明的是这个网站在我们国内登录会有些困难，但是会登的上去，只是没那么顺畅。<br> 同样首先我们先确定好我们的任务：</p> 
<ol><li>selenium模块应用的前期准备。</li><li>IMDb网页分析。</li><li>通过selenium获取想要的数据信息。</li><li>将信息格式化。</li><li>格式化后的信息存储到json，sqlite及excel中。</li></ol> 
<p>为此我们需要完成以下操作：</p> 
<ol><li>selenium模块安装及安装浏览器的webdriver。</li><li>确定电影排名的网址以及网页源代码（html）内信息所在的元素。</li><li>通过find_elements_*方法寻找元素并通过.text方法获取元素内文本。</li><li>通过对爬取的文本进行格式化为字典模式并添加到列表中方便处理。</li><li>通过json将每个类别的电影数据分别写入一个json文件，然后将所有的电影汇总写入一个json文件，最后通过sqlite3，openpyxl模块将所有的json文件写入sqlite及excel文件中。</li></ol> 
<p>由于内容较多我们分两篇来练习，今天就先完成1-4部分。话不多说就开始练习吧。</p> 
<p>首先，准备工作，安装selenium模块这个就不赘述了，大家自行安装。<br> 其次准备工作的另外一项是安装相应的浏览器的webdriver，我自己用的是chrome浏览器，所以需要去ChromePriver下载Windows系统的版本，然后将chromedriver.exe添加到PATH路径上。如果你用的其它浏览器如Firefox，请自行去下载相应的webdriver并添加到环境变量中。</p> 
<p>接下来到了分析电影网站的步骤，我们先打开其主页，点击menu中IMDb Top 250 Movies的选项进入top250排名页面会发现此页上的电影排名并没有详细的信息，而且是个总的排名，但是我们注意到页面右边有Top Rated Movies by Genre，这表示每个分类的电影排名，先点击Action动作片分类，进去页面这里提供给我们的信息有：这个排名是在每部至少出租数25000，按照降序排列，每页有50部，默认的是按照IMDb评分排列的，并且有每部电影的详细信息如时长，评分，媒体评分，电影简介，导演，演员，投票数，票房等，这正是我们所需要的，Perfect！<br> 再来分析分析网址的构成，网址如下：<br> https://www.imdb.com/search/title/?genres=action&amp;sort=user_rating,desc&amp;title_type=feature&amp;title_type=25000,&amp;pf_rd_m=A2FGELUUNOQJNL&amp;pf_rd_p=5aab685f-35eb-40f3-95f7-c53f09d542c3&amp;pf_rd_r=KXNCSE4DS589EV2SE77Q&amp;pf_rd_s=right-6&amp;pf_rd_t=15506&amp;pf_rd_i=top&amp;ref_=chttp_gnr_1<br> 我们看下问号后面的部分，看着挺长，但是我们需要的是<br> genres，sort，title_type，title_type，同时还有个start表示从第几个开始，上面提到了一页有50个电影，所以start=51则表示第二页，以此类推。<br> 所以我们需要请求的网址为：<br> https://www.imdb.com/search/title/?genres=action&amp;sort=user_rating,desc&amp;title_type=feature&amp;title_type=25000,&amp;start=1。<br> 网址确定了，下面分析网页的元素，F12打开开发者工具，找到我们所需信息的元素，会发现每部电影的信息都包含在css类名为lister-item-content的div元素内。OK，至此我们完成了页面的分析，下面开始下载数据。</p> 
<p>首先我们建立imdbmovies_ranking_bygenre.py文件，首先引入模块：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> selenium <span class="token keyword">import</span> webdriver
</code></pre> 
<p>webdriver提供了很多寻找元素的方法如下：</p> 
<pre><code class="prism language-python"><span class="token comment">#使用class类name的元素：</span>
browser<span class="token punctuation">.</span>find_element_by_class_name<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>find_elements_by_class_name<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
<span class="token comment">#匹配css selector的元素</span>
browser<span class="token punctuation">.</span>find_element_by_css_selector<span class="token punctuation">(</span>selector<span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>find_elements_by_css_selector<span class="token punctuation">(</span>selector<span class="token punctuation">)</span>
<span class="token comment">#匹配id属性值的元素</span>
browser<span class="token punctuation">.</span>find_elements_by_id<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>find_elements_by_id<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span>
<span class="token comment">#完全匹配提供的text的&lt;a&gt;元素</span>
browser<span class="token punctuation">.</span>find_element_by_link_text<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>find_elements_by_link_text<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
<span class="token comment">#包含提供的text的&lt;a&gt;元素</span>
browser<span class="token punctuation">.</span>find_element_by_partial_link_text<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>find_elements_by_partial_link_text<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
<span class="token comment">#匹配name属性值的元素</span>
browser<span class="token punctuation">.</span>find_element_by_name<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>find_elements_by_name<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
<span class="token comment">#匹配标签name的元素</span>
browser<span class="token punctuation">.</span>find_element_by_tag_name<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
browser<span class="token punctuation">.</span>find_elements_by_tag_name<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
</code></pre> 
<p>需要说明的是browser.find_element和browser.find_elements的区别为，browser.find_element返回第一个匹配的元素，而browser.find_elements则包含页面中匹配的所有元素。同时除了by_tag_name不区分大小写，其它的所有参数都区分大小写。以上所有方法返回的是webelement对象，有了此对象通过text方法获取元素内的文本，所以我们的代码如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">movie_lst_data</span><span class="token punctuation">(</span>genres<span class="token punctuation">)</span><span class="token punctuation">:</span>
	 <span class="token triple-quoted-string string">"""Get the data from url"""</span>
	movie_lst <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
	<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token string">'51'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
		options <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span>
		options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'lang=en_US'</span><span class="token punctuation">)</span>
		browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>chrome_options <span class="token operator">=</span> options<span class="token punctuation">)</span>
		start <span class="token operator">=</span> i    
		url <span class="token operator">=</span> <span class="token string">'https://www.imdb.com/search/title?title_type=feature&amp;num_votes=25000,&amp;genres={}&amp;sort=user_rating,desc&amp;start={}&amp;ref_=adv_nxt'</span>\
		        <span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>genres<span class="token punctuation">,</span>start<span class="token punctuation">)</span>
		browser<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span> 
		elems <span class="token operator">=</span> browser<span class="token punctuation">.</span>find_elements_by_class_name<span class="token punctuation">(</span><span class="token string">'lister-item-content'</span><span class="token punctuation">)</span> 
		<span class="token keyword">for</span> elem <span class="token keyword">in</span> elems<span class="token punctuation">:</span>
            movie_dict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
            movie_str <span class="token operator">=</span> elem<span class="token punctuation">.</span>text
            <span class="token comment">#print(movie_str)</span>
</code></pre> 
<p>对代码进行一下说明，</p> 
<pre><code class="prism language-python">options <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>ChromeOptions<span class="token punctuation">(</span><span class="token punctuation">)</span>
options<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'lang=en_US'</span><span class="token punctuation">)</span>
browser <span class="token operator">=</span> webdriver<span class="token punctuation">.</span>Chrome<span class="token punctuation">(</span>chrome_options <span class="token operator">=</span> options<span class="token punctuation">)</span>
</code></pre> 
<p>这三行是打开浏览器，我们要使浏览器用默认语言为英语的状态下打开浏览器，为什么呢，和IMDb网站的语言支持政策有关，大家可以自行去查看。<br> 打开浏览器之后，我们需要通过browser.get(url) 输入网址并打开网页，这里把其放入for循环中，因为我想每个分类爬取100部（不想太多是鉴于这个网站打开并不顺畅），然后函数内传递类别的参数，这样就构成了我们网址，打开网页后通过browser.find_elements_by_class_name获取所有元素，再通过一个for循环遍历每个元素，然后通过text方法获取每个元素的内容（注意text方法只能获取单个元素的文本，所有我们需要遍历所有元素）。通过打印出来可以得知每个元素内的文本内容如下：</p> 
<pre><code>2. The Lion King (1994)\n
G | 88 min | Animation, Adventure, Drama\n
8.5 Rate this\n
88 Metascore\n
Lion prince Simba and his father are targeted by his bitter uncle, who wants to ascend the throne himself.\n
Directors: Roger Allers, Rob Minkoff | Stars: Matthew Broderick, Jeremy Irons, James Earl Jones, Whoopi Goldberg\n
Votes: 1,019,044 | Gross: $422.78M\n
</code></pre> 
<p>这是一个字符串，所以我们要把这个字符串格式化添加到字典中去，所以后面代码如下：</p> 
<pre><code class="prism language-python"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token operator">*</span>movie_str <span class="token operator">=</span> elem<span class="token punctuation">.</span>text<span class="token operator">*</span>
	
	<span class="token comment"># Convert str to list</span>
	movieLst <span class="token operator">=</span> movie_str<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>
	<span class="token comment"># Generate dict</span>
	movie_dict<span class="token punctuation">[</span><span class="token string">"Rank"</span><span class="token punctuation">]</span> <span class="token operator">=</span> movieLst<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
	<span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>movieLst<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">:</span>
	    movieName <span class="token operator">=</span> movieLst<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
	    movie_dict<span class="token punctuation">[</span><span class="token string">'Movie'</span><span class="token punctuation">]</span> <span class="token operator">=</span> movieName
	<span class="token keyword">else</span><span class="token punctuation">:</span>
	    movie_dict<span class="token punctuation">[</span><span class="token string">'Movie'</span><span class="token punctuation">]</span> <span class="token operator">=</span> movieLst<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
	movie_dict<span class="token punctuation">[</span><span class="token string">'Year'</span><span class="token punctuation">]</span> <span class="token operator">=</span> movieLst<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>            
	<span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>movieLst<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">:</span>
	    movie_dict<span class="token punctuation">[</span><span class="token string">'Duration'</span><span class="token punctuation">]</span> <span class="token operator">=</span> movieLst<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
	    movie_dict<span class="token punctuation">[</span><span class="token string">'Movie Genres'</span><span class="token punctuation">]</span> <span class="token operator">=</span> movieLst<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">elif</span> <span class="token builtin">len</span><span class="token punctuation">(</span>movieLst<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">:</span>
	    movie_dict<span class="token punctuation">[</span><span class="token string">'Duration'</span><span class="token punctuation">]</span> <span class="token operator">=</span> movieLst<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
	    movie_dict<span class="token punctuation">[</span><span class="token string">'Movie Genres'</span><span class="token punctuation">]</span> <span class="token operator">=</span> movieLst<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
	movie_dict<span class="token punctuation">[</span><span class="token string">'IMDb Score'</span><span class="token punctuation">]</span> <span class="token operator">=</span>  movieLst<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
	<span class="token keyword">if</span> <span class="token builtin">len</span> <span class="token punctuation">(</span>movieLst<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">7</span><span class="token punctuation">:</span>
	    movie_dict<span class="token punctuation">[</span><span class="token string">'Metascore'</span><span class="token punctuation">]</span> <span class="token operator">=</span>  movieLst<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
	    movie_dict<span class="token punctuation">[</span><span class="token string">'Plot'</span><span class="token punctuation">]</span> <span class="token operator">=</span>  movieLst<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>
	    movie_dict<span class="token punctuation">[</span><span class="token string">'Director'</span><span class="token punctuation">]</span> <span class="token operator">=</span> movieLst<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
	    movie_dict<span class="token punctuation">[</span><span class="token string">'Stars'</span><span class="token punctuation">]</span> <span class="token operator">=</span> movieLst<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
	    <span class="token keyword">if</span> <span class="token string">"|"</span><span class="token keyword">in</span> movieLst<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
	        movie_dict<span class="token punctuation">[</span><span class="token string">'Votes'</span><span class="token punctuation">]</span> <span class="token operator">=</span> movieLst<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
	        movie_dict<span class="token punctuation">[</span><span class="token string">'Gross'</span><span class="token punctuation">]</span> <span class="token operator">=</span> movieLst<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
	    <span class="token keyword">else</span><span class="token punctuation">:</span>
	        movie_dict<span class="token punctuation">[</span><span class="token string">'Votes'</span><span class="token punctuation">]</span> <span class="token operator">=</span> movieLst<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
	        movie_dict<span class="token punctuation">[</span><span class="token string">'Gross'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"NO DATA"</span>
	<span class="token keyword">elif</span> <span class="token builtin">len</span> <span class="token punctuation">(</span>movieLst<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">:</span>   
	    movie_dict<span class="token punctuation">[</span><span class="token string">'Metascore'</span><span class="token punctuation">]</span> <span class="token operator">=</span>  <span class="token string">"NO DATA"</span>
	    movie_dict<span class="token punctuation">[</span><span class="token string">'Plot'</span><span class="token punctuation">]</span> <span class="token operator">=</span>  movieLst<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
	    movie_dict<span class="token punctuation">[</span><span class="token string">'Director'</span><span class="token punctuation">]</span> <span class="token operator">=</span> movieLst<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
	    movie_dict<span class="token punctuation">[</span><span class="token string">'Stars'</span><span class="token punctuation">]</span> <span class="token operator">=</span> movieLst<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
	    <span class="token keyword">if</span> <span class="token string">"|"</span><span class="token keyword">in</span> movieLst<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
	        movie_dict<span class="token punctuation">[</span><span class="token string">'Votes'</span><span class="token punctuation">]</span> <span class="token operator">=</span> movieLst<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
	        movie_dict<span class="token punctuation">[</span><span class="token string">'Gross'</span><span class="token punctuation">]</span> <span class="token operator">=</span> movieLst<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
	    <span class="token keyword">else</span><span class="token punctuation">:</span>
	        movie_dict<span class="token punctuation">[</span><span class="token string">'Votes'</span><span class="token punctuation">]</span> <span class="token operator">=</span> movieLst<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
	        movie_dict<span class="token punctuation">[</span><span class="token string">'Gross'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"NO DATA"</span> 
	movie_lst<span class="token punctuation">.</span>append<span class="token punctuation">(</span>movie_dict<span class="token punctuation">)</span>
</code></pre> 
<p>上述代码中我们首先把每个字符转为列表，然后把每项信息添加到字典中，注意的是列表中有些元素会有些变化，例如媒体评分若是没有则列表的长度就会变为6，而包含时长的元素通过“|”分出的列表长度会有两种情况，还有有些电影没有票房数据等等这些都会影响我们对列表的引用，所以要把数据进行周全的分析以避免错误。<br> 运行无误后每部电影的信息如下所示的字典格式添加到了列表中：</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token string">"Rank"</span><span class="token punctuation">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span>
    <span class="token string">"Movie"</span><span class="token punctuation">:</span> <span class="token string">"K.G.F: Chapter 2"</span><span class="token punctuation">,</span>
    <span class="token string">"Year"</span><span class="token punctuation">:</span> <span class="token string">"2022"</span><span class="token punctuation">,</span>
    <span class="token string">"Duration"</span><span class="token punctuation">:</span> <span class="token string">"168 min"</span><span class="token punctuation">,</span>
    <span class="token string">"Movie Genres"</span><span class="token punctuation">:</span> <span class="token string">"Action, Crime, Drama"</span><span class="token punctuation">,</span>
    <span class="token string">"IMDb Score"</span><span class="token punctuation">:</span> <span class="token string">"9.0"</span><span class="token punctuation">,</span>
    <span class="token string">"Metascore"</span><span class="token punctuation">:</span> <span class="token string">"NO DATA"</span><span class="token punctuation">,</span>
    <span class="token string">"Plot"</span><span class="token punctuation">:</span> <span class="token string">"In the blood-soaked Kolar Gold Fields, Rocky's name strikes fear into his foes. While his allies look up to him, the government sees him as a threat to law and order. Rocky must battle threats from all sides for unchallenged supremacy."</span><span class="token punctuation">,</span>
    <span class="token string">"Director"</span><span class="token punctuation">:</span> <span class="token string">"Prashanth Neel"</span><span class="token punctuation">,</span>
    <span class="token string">"Stars"</span><span class="token punctuation">:</span> <span class="token string">"Yash, Sanjay Dutt, Srinidhi Shetty, Raveena Tandon"</span><span class="token punctuation">,</span>
    <span class="token string">"Votes"</span><span class="token punctuation">:</span> <span class="token string">"78,538"</span><span class="token punctuation">,</span>
    <span class="token string">"Gross"</span><span class="token punctuation">:</span> <span class="token string">"NO DATA"</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

</code></pre> 
<p>注意每个页面数据下载完成后要关闭浏览器，不然要打开很多个。最后我们的函数返回我们下载完成的列表：</p> 
<pre><code class="prism language-python">    	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    	browser<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># print(elem.text)</span>
	<span class="token keyword">return</span>  movie_lst
</code></pre> 
<p>然后我们再建立一个函数，将每部电影的数据写入一个json文件中：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">movie_json_data</span><span class="token punctuation">(</span>movie_lst<span class="token punctuation">,</span>genres<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Generate the json data"""</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'json_data/{}_movies(100).json'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>genres<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> json_file<span class="token punctuation">:</span>
            json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>movie_lst<span class="token punctuation">,</span> json_file<span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre> 
<p>最后运行函数：</p> 
<pre><code class="prism language-python"><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""genres = [
            'Action','Adventure','Animation'
            'Biography','Comedy','Crime',
            'Drama','Family','Fantasy',
            'Film_Noir','History','Horror',
            'Music','Musical','Mystery',
            'Romance','Sci_Fi','Sport',
            'Thriller','War','Western',
            ]"""</span>
        genres <span class="token operator">=</span> <span class="token string">"Action"</span>
        movie_lst <span class="token operator">=</span> movie_lst_data<span class="token punctuation">(</span>genres<span class="token punctuation">)</span>     
        movie_json_data<span class="token punctuation">(</span>movie_lst<span class="token punctuation">,</span>genres<span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ERROR: "</span><span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>这里需要说明的是，本来类别也可以通过for循环类别列表自动完成，但是考虑到这个网站的登录变数较大，所以还是手动运行每个类别比较好。链接不上的情况下程序会退出，这时要重新运行，有时候需要运行多几次才能成功，如Action类别的电影成功运行如下图所示：<br> <img src="https://images2.imgbox.com/fb/fb/r7F0fFkx_o.gif" alt="在这里插入图片描述"></p> 
<p>每个网页运行完成后会自动关闭浏览器，然后再次打开第二页，完成后再次关闭，最后数据都写入json文件，当所有的类别都完成后我们会看到我们的文件夹内生成了所有的类别电影的排名100的文件，<br> 而生成的json文件内容如下：<br> <img src="https://images2.imgbox.com/12/0e/gACzcabP_o.png" alt="在这里插入图片描述"></p> 
<p>至此我们前4项的工作和生成json文件部分部分也就完成了，这也我们这个实例的第一部分。<br> 后面第二部分我们会将每个类别的电影数据汇聚成一个按照IMDb分数排行总数据写入json，同时将所有的json数据写入到sqliet和excel中去。<br> （本来文章有很多图片展示的，但图片多了总是待审核，所以无奈删除了一些）<br> 未完待续…</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8ee8ad6fb543daf00077d7e9c13cce3f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">windows常用快捷键</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4193fc8eb0b270de0c709cfb630012a7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">详细介绍如何在华为云调用SDK的Python代码(以文字识别OCR技术实现身份证识别为例)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>