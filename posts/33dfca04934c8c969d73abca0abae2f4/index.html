<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>大创项目推荐 深度学习动物识别 - 卷积神经网络 机器视觉 图像识别 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="大创项目推荐 深度学习动物识别 - 卷积神经网络 机器视觉 图像识别" />
<meta property="og:description" content="文章目录 0 前言1 背景2 算法原理2.1 动物识别方法概况2.2 常用的网络模型2.2.1 B-CNN2.2.2 SSD 3 SSD动物目标检测流程4 实现效果5 部分相关代码5.1 数据预处理5.2 构建卷积神经网络5.3 tensorflow计算图可视化5.4 网络模型训练5.5 对猫狗图像进行2分类 6 最后 0 前言 🔥 优质竞赛项目系列，今天要分享的是
🚩 深度学习动物识别 - 卷积神经网络 机器视觉 图像识别
该项目较为新颖，适合作为竞赛课题方向，学长非常推荐！
🥇学长这里给一个题目综合评分(每项满分5分)
难度系数：3分工作量：3分创新点：4分 🧿 更多资料, 项目分享：
https://gitee.com/dancheng-senior/postgraduate
1 背景 目前，由于计算机能力和相关理论的发展获得了重大突破，基于深度学习的图像检测与识别技术已经广泛应用到人们的生产生活中。学长将深度学习的技术应用到野生动物图像识别中，优化了传统的识别方法，形成对野生动物图像更为准确的识别，为实现高效的野生动物图像识别提供了可能。不同于传统的野生动物识别，基于深度学习的野生动物识别技术可以捕获到野生动物更加细致的信息，有利于对野生动物进行更加准确的识别和研究。因此，对基于深度学习的野生动物识别和研究，可以更好的帮助社会管理者和政府全面有效的对野生动物进行保护和监管，这也正是保护和识别野生动物的关键，同时这对整个自然和社会的和谐发展具有极大的推动作用。
2 算法原理 2.1 动物识别方法概况 基于人工特征的野生动物识别方法主要通过人工对野生动物图像中具有辨识度的特征信息进行提取，并通过特征比对的方式就可以对野生动物所属的类别进行识别判断。
在深度学习技术普及之前，传统的数字图像处理技术与传统机器学习技术一直是研究的热点。传统的数字图像处理技术有模块分割、降低噪声点、边缘检测等方法。传统的机器学习技术有支持向量机、随机森林算法、BP
神经网络算法等。
深度学习技术是通过计算机模拟人类大脑的分层表达结构来建立网络模型，从原始数据集中对相关信息逐层提取。之后通过建立相应的神经网络对数据进行学习和分析，从而提高对目标预测和识别的准确率。如今，深度学习技术已经相对成熟，在对目标进行特征提取方面，卷积神经网络技术逐渐取代了传统的图像处理技术，并且在人类的生产生活中得到了广泛应用，这为研究野生动物更高效的识别方法奠定了基础。
2.2 常用的网络模型 图像识别是指对原始图像进行整体分析来达到预测原始图像所属类别的技术。计算机视觉领域中对图像识别技术进行了优化，与此同时，深度学习技术也对图像识别领域展开了突破。目前在图像识别领域中，研究人员开始使用深度学习的技术，并通过在实际应用中发现，基于深度学习的识别技术比传统的识别技术效果更好，且更具有优势。
2.2.1 B-CNN 双线性卷积神经网络(Bilinear
CNN，B-CNN)[34]是用两个卷积神经网络对图像进行特征提取，然后使用相应的函数将得到所有特征进行组合，组合的数据带入到分类器中进行分类。
2.2.2 SSD 经典的 SSD 模型是由经典网络和特征提取网络组成。
通过引入性能更好的特征提取网络对 SSD
目标检测模型进行了优化。Fu[49]等人提出了增加卷积神经网络层数和深度的方法用于提高识别准确率。通过实际应用之后，发现该方法识别准确率确实得到了一定程度的提高，但是模型结构却越来越复杂，同时对深层次的网络训练也越来越困难。
3 SSD动物目标检测流程 学长首先对 DenseNet-169 网络进行初始化，使用 DenseNet-169 网络作为目标检测的前置网络结构，并运用迁移学习的方法对" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/33dfca04934c8c969d73abca0abae2f4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-03T18:00:52+08:00" />
<meta property="article:modified_time" content="2024-01-03T18:00:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">大创项目推荐 深度学习动物识别 - 卷积神经网络 机器视觉 图像识别</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#0__2" rel="nofollow">0 前言</a></li><li><a href="#1__20" rel="nofollow">1 背景</a></li><li><a href="#2__24" rel="nofollow">2 算法原理</a></li><li><ul><li><a href="#21__26" rel="nofollow">2.1 动物识别方法概况</a></li><li><a href="#22__35" rel="nofollow">2.2 常用的网络模型</a></li><li><ul><li><a href="#221_BCNN_39" rel="nofollow">2.2.1 B-CNN</a></li><li><a href="#222_SSD_46" rel="nofollow">2.2.2 SSD</a></li></ul> 
  </li></ul> 
  </li><li><a href="#3_SSD_55" rel="nofollow">3 SSD动物目标检测流程</a></li><li><a href="#4__63" rel="nofollow">4 实现效果</a></li><li><a href="#5__72" rel="nofollow">5 部分相关代码</a></li><li><ul><li><a href="#51__74" rel="nofollow">5.1 数据预处理</a></li><li><a href="#52__189" rel="nofollow">5.2 构建卷积神经网络</a></li><li><a href="#53_tensorflow_218" rel="nofollow">5.3 tensorflow计算图可视化</a></li><li><a href="#54__240" rel="nofollow">5.4 网络模型训练</a></li><li><a href="#55_2_291" rel="nofollow">5.5 对猫狗图像进行2分类</a></li></ul> 
  </li><li><a href="#6__297" rel="nofollow">6 最后</a></li></ul> 
</div> 
<p></p> 
<h2><a id="0__2"></a>0 前言</h2> 
<p>🔥 优质竞赛项目系列，今天要分享的是</p> 
<p>🚩 <strong>深度学习动物识别 - 卷积神经网络 机器视觉 图像识别</strong></p> 
<p>该项目较为新颖，适合作为竞赛课题方向，学长非常推荐！</p> 
<p>🥇学长这里给一个题目综合评分(每项满分5分)</p> 
<ul><li>难度系数：3分</li><li>工作量：3分</li><li>创新点：4分</li></ul> 
<p>🧿 <strong>更多资料, 项目分享：</strong></p> 
<p><a href="https://gitee.com/dancheng-senior/postgraduate" rel="nofollow">https://gitee.com/dancheng-senior/postgraduate</a></p> 
<h2><a id="1__20"></a>1 背景</h2> 
<p>目前，由于计算机能力和相关理论的发展获得了重大突破，基于深度学习的图像检测与识别技术已经广泛应用到人们的生产生活中。学长将深度学习的技术应用到野生动物图像识别中，优化了传统的识别方法，形成对野生动物图像更为准确的识别，为实现高效的野生动物图像识别提供了可能。不同于传统的野生动物识别，基于深度学习的野生动物识别技术可以捕获到野生动物更加细致的信息，有利于对野生动物进行更加准确的识别和研究。因此，对基于深度学习的野生动物识别和研究，可以更好的帮助社会管理者和政府全面有效的对野生动物进行保护和监管，这也正是保护和识别野生动物的关键，同时这对整个自然和社会的和谐发展具有极大的推动作用。</p> 
<h2><a id="2__24"></a>2 算法原理</h2> 
<h3><a id="21__26"></a>2.1 动物识别方法概况</h3> 
<p>基于人工特征的野生动物识别方法主要通过人工对野生动物图像中具有辨识度的特征信息进行提取，并通过特征比对的方式就可以对野生动物所属的类别进行识别判断。</p> 
<p>在深度学习技术普及之前，传统的数字图像处理技术与传统机器学习技术一直是研究的热点。传统的数字图像处理技术有模块分割、降低噪声点、边缘检测等方法。传统的机器学习技术有支持向量机、随机森林算法、BP<br> 神经网络算法等。</p> 
<p>深度学习技术是通过计算机模拟人类大脑的分层表达结构来建立网络模型，从原始数据集中对相关信息逐层提取。之后通过建立相应的神经网络对数据进行学习和分析，从而提高对目标预测和识别的准确率。如今，深度学习技术已经相对成熟，在对目标进行特征提取方面，卷积神经网络技术逐渐取代了传统的图像处理技术，并且在人类的生产生活中得到了广泛应用，这为研究野生动物更高效的识别方法奠定了基础。</p> 
<h3><a id="22__35"></a>2.2 常用的网络模型</h3> 
<p>图像识别是指对原始图像进行整体分析来达到预测原始图像所属类别的技术。计算机视觉领域中对图像识别技术进行了优化，与此同时，深度学习技术也对图像识别领域展开了突破。目前在图像识别领域中，研究人员开始使用深度学习的技术，并通过在实际应用中发现，基于深度学习的识别技术比传统的识别技术效果更好，且更具有优势。</p> 
<h4><a id="221_BCNN_39"></a>2.2.1 B-CNN</h4> 
<p>双线性卷积神经网络(Bilinear<br> CNN，B-CNN)[34]是用两个卷积神经网络对图像进行特征提取，然后使用相应的函数将得到所有特征进行组合，组合的数据带入到分类器中进行分类。</p> 
<p><img src="https://images2.imgbox.com/13/d5/uEon7TCG_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="222_SSD_46"></a>2.2.2 SSD</h4> 
<p>经典的 SSD 模型是由经典网络和特征提取网络组成。</p> 
<p>通过引入性能更好的特征提取网络对 SSD<br> 目标检测模型进行了优化。Fu[49]等人提出了增加卷积神经网络层数和深度的方法用于提高识别准确率。通过实际应用之后，发现该方法识别准确率确实得到了一定程度的提高，但是模型结构却越来越复杂，同时对深层次的网络训练也越来越困难。</p> 
<p><img src="https://images2.imgbox.com/68/7a/e1ss4Y6L_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="3_SSD_55"></a>3 SSD动物目标检测流程</h2> 
<p><img src="https://images2.imgbox.com/c2/9b/wjjH7KBK_o.png" alt="在这里插入图片描述"></p> 
<p>学长首先对 DenseNet-169 网络进行初始化，使用 DenseNet-169 网络作为目标检测的前置网络结构，并运用迁移学习的方法对<br> DenseNet-169 进行预训练，并将Snapshot Serengeti数据集下的权重值迁移到野生动物检测任务中，使数据集的训练速度得到提升。将<br> DenseNet-169 作为前置网络置于 SSD 中的目标提取检测网络之前，更换完前置网络的 SSD 目标检测网络依然完整。</p> 
<h2><a id="4__63"></a>4 实现效果</h2> 
<p><img src="https://images2.imgbox.com/f7/59/0yADXqdZ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/68/9d/fImT4ehv_o.png" alt="在这里插入图片描述"></p> 
<p><strong>做一个GUI交互界面</strong></p> 
<p><img src="https://images2.imgbox.com/65/72/7wj6sSdn_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="5__72"></a>5 部分相关代码</h2> 
<h3><a id="51__74"></a>5.1 数据预处理</h3> 
<p>​</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv
<span class="token keyword">import</span> os
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token keyword">import</span> random
<span class="token keyword">import</span> pickle

<span class="token keyword">import</span> time

start_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>

data_dir <span class="token operator">=</span> <span class="token string">'./data'</span>
batch_save_path <span class="token operator">=</span> <span class="token string">'./batch_files'</span>

<span class="token comment"># 创建batch文件存储的文件夹</span>
os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>batch_save_path<span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># 图片统一大小：100 * 100</span>
<span class="token comment"># 训练集 20000：100个batch文件，每个文件200张图片</span>
<span class="token comment"># 验证集 5000：一个测试文件，测试时 50张 x 100 批次</span>

<span class="token comment"># 进入图片数据的目录，读取图片信息</span>
all_data_files <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_dir<span class="token punctuation">,</span> <span class="token string">'train/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># print(all_data_files)</span>

<span class="token comment"># 打算数据的顺序</span>
random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>all_data_files<span class="token punctuation">)</span>

all_train_files <span class="token operator">=</span> all_data_files<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">20000</span><span class="token punctuation">]</span>
all_test_files <span class="token operator">=</span> all_data_files<span class="token punctuation">[</span><span class="token number">20000</span><span class="token punctuation">:</span><span class="token punctuation">]</span>

train_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
train_label <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
train_filenames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

test_data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
test_label <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
test_filenames <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment"># 训练集</span>
<span class="token keyword">for</span> each <span class="token keyword">in</span> all_train_files<span class="token punctuation">:</span>
    img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_dir<span class="token punctuation">,</span><span class="token string">'train/'</span><span class="token punctuation">,</span>each<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
    resized_img <span class="token operator">=</span> cv<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    img_data <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>resized_img<span class="token punctuation">)</span>
    train_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>img_data<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">'cat'</span> <span class="token keyword">in</span> each<span class="token punctuation">:</span>
        train_label<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> <span class="token string">'dog'</span> <span class="token keyword">in</span> each<span class="token punctuation">:</span>
        train_label<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'%s is wrong train file'</span><span class="token operator">%</span><span class="token punctuation">(</span>each<span class="token punctuation">)</span><span class="token punctuation">)</span>
    train_filenames<span class="token punctuation">.</span>append<span class="token punctuation">(</span>each<span class="token punctuation">)</span>

<span class="token comment"># 测试集</span>
<span class="token keyword">for</span> each <span class="token keyword">in</span> all_test_files<span class="token punctuation">:</span>
    img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>data_dir<span class="token punctuation">,</span><span class="token string">'train/'</span><span class="token punctuation">,</span>each<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    resized_img <span class="token operator">=</span> cv<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    img_data <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>resized_img<span class="token punctuation">)</span>
    test_data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>img_data<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">'cat'</span> <span class="token keyword">in</span> each<span class="token punctuation">:</span>
        test_label<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">elif</span> <span class="token string">'dog'</span> <span class="token keyword">in</span> each<span class="token punctuation">:</span>
        test_label<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">'%s is wrong test file'</span><span class="token operator">%</span><span class="token punctuation">(</span>each<span class="token punctuation">)</span><span class="token punctuation">)</span>
    test_filenames<span class="token punctuation">.</span>append<span class="token punctuation">(</span>each<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>train_data<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>test_data<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 制作100个batch文件</span>
start <span class="token operator">=</span> <span class="token number">0</span>
end <span class="token operator">=</span> <span class="token number">200</span>
<span class="token keyword">for</span> num <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">101</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    batch_data <span class="token operator">=</span> train_data<span class="token punctuation">[</span>start<span class="token punctuation">:</span> end<span class="token punctuation">]</span>
    batch_label <span class="token operator">=</span> train_label<span class="token punctuation">[</span>start<span class="token punctuation">:</span> end<span class="token punctuation">]</span>
    batch_filenames <span class="token operator">=</span> train_filenames<span class="token punctuation">[</span>start<span class="token punctuation">:</span> end<span class="token punctuation">]</span>
    batch_name <span class="token operator">=</span> <span class="token string">'training batch {} of 15'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>

    all_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'data'</span><span class="token punctuation">:</span>batch_data<span class="token punctuation">,</span>
    <span class="token string">'label'</span><span class="token punctuation">:</span>batch_label<span class="token punctuation">,</span>
    <span class="token string">'filenames'</span><span class="token punctuation">:</span>batch_filenames<span class="token punctuation">,</span>
    <span class="token string">'name'</span><span class="token punctuation">:</span>batch_name
    <span class="token punctuation">}</span>

    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>batch_save_path<span class="token punctuation">,</span> <span class="token string">'train_batch_{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        pickle<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>all_data<span class="token punctuation">,</span> f<span class="token punctuation">)</span>

    start <span class="token operator">+=</span> <span class="token number">200</span>
    end <span class="token operator">+=</span> <span class="token number">200</span>

<span class="token comment"># 制作测试文件</span>
all_test_data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">'data'</span><span class="token punctuation">:</span>test_data<span class="token punctuation">,</span>
    <span class="token string">'label'</span><span class="token punctuation">:</span>test_label<span class="token punctuation">,</span>
    <span class="token string">'filenames'</span><span class="token punctuation">:</span>test_filenames<span class="token punctuation">,</span>
    <span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'test batch 1 of 1'</span>
    <span class="token punctuation">}</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>batch_save_path<span class="token punctuation">,</span> <span class="token string">'test_batch'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    pickle<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>all_test_data<span class="token punctuation">,</span> f<span class="token punctuation">)</span>

end_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'制作结束, 用时{}秒'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>end_time <span class="token operator">-</span> start_time<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="52__189"></a>5.2 构建卷积神经网络</h3> 
<p><strong>cnn卷积神经网络的编写如下，编写卷积层、池化层和全连接层的代码</strong></p> 
<p>​</p> 
<pre><code class="prism language-python">conv1_1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>conv2d<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">'same'</span><span class="token punctuation">,</span> activation<span class="token operator">=</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'conv1_1'</span><span class="token punctuation">)</span>
conv1_2 <span class="token operator">=</span> tf<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>conv2d<span class="token punctuation">(</span>conv1_1<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">'same'</span><span class="token punctuation">,</span> activation<span class="token operator">=</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'conv1_2'</span><span class="token punctuation">)</span>
pool1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>max_pooling2d<span class="token punctuation">(</span>conv1_2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'pool1'</span><span class="token punctuation">)</span>
conv2_1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>conv2d<span class="token punctuation">(</span>pool1<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">'same'</span><span class="token punctuation">,</span> activation<span class="token operator">=</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'conv2_1'</span><span class="token punctuation">)</span>
conv2_2 <span class="token operator">=</span> tf<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>conv2d<span class="token punctuation">(</span>conv2_1<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">'same'</span><span class="token punctuation">,</span> activation<span class="token operator">=</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'conv2_2'</span><span class="token punctuation">)</span>
pool2 <span class="token operator">=</span> tf<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>max_pooling2d<span class="token punctuation">(</span>conv2_2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'pool2'</span><span class="token punctuation">)</span>
conv3_1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>conv2d<span class="token punctuation">(</span>pool2<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">'same'</span><span class="token punctuation">,</span> activation<span class="token operator">=</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'conv3_1'</span><span class="token punctuation">)</span>
conv3_2 <span class="token operator">=</span> tf<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>conv2d<span class="token punctuation">(</span>conv3_1<span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">'same'</span><span class="token punctuation">,</span> activation<span class="token operator">=</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'conv3_2'</span><span class="token punctuation">)</span>
pool3 <span class="token operator">=</span> tf<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>max_pooling2d<span class="token punctuation">(</span>conv3_2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'pool3'</span><span class="token punctuation">)</span>
conv4_1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>conv2d<span class="token punctuation">(</span>pool3<span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">'same'</span><span class="token punctuation">,</span> activation<span class="token operator">=</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'conv4_1'</span><span class="token punctuation">)</span>
conv4_2 <span class="token operator">=</span> tf<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>conv2d<span class="token punctuation">(</span>conv4_1<span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token string">'same'</span><span class="token punctuation">,</span> activation<span class="token operator">=</span>tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'conv4_2'</span><span class="token punctuation">)</span>
pool4 <span class="token operator">=</span> tf<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>max_pooling2d<span class="token punctuation">(</span>conv4_2<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'pool4'</span><span class="token punctuation">)</span>

flatten <span class="token operator">=</span> tf<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>flatten<span class="token punctuation">(</span>pool4<span class="token punctuation">)</span>
fc1 <span class="token operator">=</span> tf<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>dense<span class="token punctuation">(</span>flatten<span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">)</span>
fc1_dropout <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>dropout<span class="token punctuation">(</span>fc1<span class="token punctuation">,</span> keep_prob<span class="token operator">=</span>keep_prob<span class="token punctuation">)</span>
fc2 <span class="token operator">=</span> tf<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>dense<span class="token punctuation">(</span>fc1<span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>relu<span class="token punctuation">)</span>
fc2_dropout <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>dropout<span class="token punctuation">(</span>fc2<span class="token punctuation">,</span> keep_prob<span class="token operator">=</span>keep_prob<span class="token punctuation">)</span>
fc3 <span class="token operator">=</span> tf<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>dense<span class="token punctuation">(</span>fc2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="53_tensorflow_218"></a>5.3 tensorflow计算图可视化</h3> 
<p>​</p> 
<pre><code class="prism language-python">self<span class="token punctuation">.</span>x <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">,</span> IMAGE_SIZE<span class="token punctuation">,</span> IMAGE_SIZE<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'input_data'</span><span class="token punctuation">)</span>
self<span class="token punctuation">.</span>y <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>int64<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'output_data'</span><span class="token punctuation">)</span>
self<span class="token punctuation">.</span>keep_prob <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>

<span class="token comment"># 图片输入网络中</span>
fc <span class="token operator">=</span> self<span class="token punctuation">.</span>conv_net<span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>keep_prob<span class="token punctuation">)</span>
self<span class="token punctuation">.</span>loss <span class="token operator">=</span> tf<span class="token punctuation">.</span>losses<span class="token punctuation">.</span>sparse_softmax_cross_entropy<span class="token punctuation">(</span>labels<span class="token operator">=</span>self<span class="token punctuation">.</span>y<span class="token punctuation">,</span> logits<span class="token operator">=</span>fc<span class="token punctuation">)</span>
self<span class="token punctuation">.</span>y_ <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>softmax<span class="token punctuation">(</span>fc<span class="token punctuation">)</span> <span class="token comment"># 计算每一类的概率</span>
self<span class="token punctuation">.</span>predict <span class="token operator">=</span> tf<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>fc<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
self<span class="token punctuation">.</span>acc <span class="token operator">=</span> tf<span class="token punctuation">.</span>reduce_mean<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>cast<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>equal<span class="token punctuation">(</span>self<span class="token punctuation">.</span>predict<span class="token punctuation">,</span> self<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span><span class="token punctuation">)</span>
self<span class="token punctuation">.</span>train_op <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>AdamOptimizer<span class="token punctuation">(</span>LEARNING_RATE<span class="token punctuation">)</span><span class="token punctuation">.</span>minimize<span class="token punctuation">(</span>self<span class="token punctuation">.</span>loss<span class="token punctuation">)</span>
self<span class="token punctuation">.</span>saver <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>Saver<span class="token punctuation">(</span>max_to_keep<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<p>最后的saver是要将训练好的模型保存到本地。</p> 
<h3><a id="54__240"></a>5.4 网络模型训练</h3> 
<p>然后编写训练部分的代码，训练步骤为1万步</p> 
<p>​</p> 
<pre><code class="prism language-python">acc_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
    sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>global_variables_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>TRAIN_STEP<span class="token punctuation">)</span><span class="token punctuation">:</span>
        train_data<span class="token punctuation">,</span> train_label<span class="token punctuation">,</span> _ <span class="token operator">=</span> self<span class="token punctuation">.</span>batch_train_data<span class="token punctuation">.</span>next_batch<span class="token punctuation">(</span>TRAIN_SIZE<span class="token punctuation">)</span>

        eval_ops <span class="token operator">=</span> <span class="token punctuation">[</span>self<span class="token punctuation">.</span>loss<span class="token punctuation">,</span> self<span class="token punctuation">.</span>acc<span class="token punctuation">,</span> self<span class="token punctuation">.</span>train_op<span class="token punctuation">]</span>
        eval_ops_results <span class="token operator">=</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>eval_ops<span class="token punctuation">,</span> feed_dict<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
            self<span class="token punctuation">.</span>x<span class="token punctuation">:</span>train_data<span class="token punctuation">,</span>
            self<span class="token punctuation">.</span>y<span class="token punctuation">:</span>train_label<span class="token punctuation">,</span>
            self<span class="token punctuation">.</span>keep_prob<span class="token punctuation">:</span><span class="token number">0.7</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        loss_val<span class="token punctuation">,</span> train_acc <span class="token operator">=</span> eval_ops_results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>

        acc_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>train_acc<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            acc_mean <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>acc_list<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'step:{0},loss:{1:.5},acc:{2:.5},acc_mean:{3:.5}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
                i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>loss_val<span class="token punctuation">,</span>train_acc<span class="token punctuation">,</span>acc_mean
            <span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">1000</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            test_acc_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>TEST_STEP<span class="token punctuation">)</span><span class="token punctuation">:</span>
                test_data<span class="token punctuation">,</span> test_label<span class="token punctuation">,</span> _ <span class="token operator">=</span> self<span class="token punctuation">.</span>batch_test_data<span class="token punctuation">.</span>next_batch<span class="token punctuation">(</span>TRAIN_SIZE<span class="token punctuation">)</span>
                acc_val <span class="token operator">=</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span>self<span class="token punctuation">.</span>acc<span class="token punctuation">]</span><span class="token punctuation">,</span>feed_dict<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>
                    self<span class="token punctuation">.</span>x<span class="token punctuation">:</span>test_data<span class="token punctuation">,</span>
                    self<span class="token punctuation">.</span>y<span class="token punctuation">:</span>test_label<span class="token punctuation">,</span>
                    self<span class="token punctuation">.</span>keep_prob<span class="token punctuation">:</span><span class="token number">1.0</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            test_acc_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>acc_val<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[Test ] step:{0}, mean_acc:{1:.5}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
                i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>test_acc_list<span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 保存训练后的模型</span>
    os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>SAVE_PATH<span class="token punctuation">,</span> exist_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>saver<span class="token punctuation">.</span>save<span class="token punctuation">(</span>sess<span class="token punctuation">,</span> SAVE_PATH <span class="token operator">+</span> <span class="token string">'my_model.ckpt'</span><span class="token punctuation">)</span>
</code></pre> 
<p>训练结果如下：</p> 
<p><img src="https://images2.imgbox.com/a8/58/HqmiX6gg_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="55_2_291"></a>5.5 对猫狗图像进行2分类</h3> 
<p><img src="https://images2.imgbox.com/10/98/l58pkdm9_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/30/54/W3NpwaBN_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="6__297"></a>6 最后</h2> 
<p>🧿 <strong>更多资料, 项目分享：</strong></p> 
<p><a href="https://gitee.com/dancheng-senior/postgraduate" rel="nofollow">https://gitee.com/dancheng-senior/postgraduate</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7ecb761c599052e9675597138ff2d253/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">大创项目推荐 深度学习人脸表情识别算法 - opencv python 机器视觉</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/90023f040f7946607bc6cf92de8c7b4a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">golang 如何判断变量的类型</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>