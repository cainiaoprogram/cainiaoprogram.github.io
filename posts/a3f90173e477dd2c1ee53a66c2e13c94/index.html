<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用CubeMX快速搭建FREERTOS - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用CubeMX快速搭建FREERTOS" />
<meta property="og:description" content="如何使用STM32快速搭建FREERTOS 小编之前一直使用正点原子家的产品， 最近准备学习学习TOUCHGFX,要用到HAL&#43;RTOS,原子家的使用起来不方便。于是琢磨着使用STM32CUBEMX直接生成FREERTOS&#43;HAL工程。非常方便，在这里分享给大家
CUBEMX安装 安装CUBEMX前， 需要安装JAVA，注意一定要下载64位JAVA才可，大家可参考这个教程https://jingyan.baidu.com/article/3aed632ede2a2f7010809114.html进行下载安装
2022.6.18更新：Win11，cubemx6.5版本，已经不需要自己安装java环境了。
CUBEMX软件可以直接从官网下载最新版，链接在此https://www.st.com/en/development-tools/stm32cubemx.html。软件直接选择最新版安装。
装好后（首次打开可能需要更新， 耐心等待），点击下图位置安装相应的支持包。我这里使用的是正点原子F407最小系统板
创建第一个工程 1，选择MCU型号
2，配置SYS
点击左边的SYS选项卡，选择Debug模式为SW。注意这里将时钟源换成了Timer1。这个时钟源是给HAL库提供时钟的。HAL在运行一些超时监测的代码时， 需要一个时钟源提供时钟，一般用systick。但是本例中systick被RTOS占用。所以修改HAL时钟源为Timer1.
3，配置RCC
这里使用的是外部晶振
4，配置一个LED引脚
5，配置RTOS
V1， V2 的区别我也不大清楚。网上也没搜索到，这里暂且V1。 大家有知道的请在下方留言。FREERTOS内部的配置不在这里介绍了，这里不改动任何配置
6，配置时钟树
我用的是外部8M晶振， 参数如下。这里仅做参考，大家根据自己的情况配置，只要不报错应该都没啥问题。
7，配置工程选项
注意：Application structure 建议选择Advanced， 小编之前用Basic， 在代码重新生成时会把usercode覆盖掉（代码书写位置正确的情况下也会这样）。
8，生成代码
小编比较习惯用单独的.c.h 文件，大家按习惯来
9，测试
至此， 我们的RTOS已经完成了， 为了验证一下，我们可以写一个小程序验证一下
生成的freertos里， cubemx已经为我们创建好了一个任务defaultTask， 我们直接将我们的代码塞到这个线程里即可。
在freertos.c里添加如下代码：
void StartDefaultTask(void const * argument) { /* USER CODE BEGIN StartDefaultTask */ /* Infinite loop */ for(;;) { HAL_GPIO_TogglePin(GPIOF,GPIO_PIN_9);//翻转电平 osDelay(500);	//延时&#43;调度 } /* USER CODE END StartDefaultTask */ } 。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a3f90173e477dd2c1ee53a66c2e13c94/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-18T00:35:40+08:00" />
<meta property="article:modified_time" content="2022-06-18T00:35:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用CubeMX快速搭建FREERTOS</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="STM32FREERTOS_0"></a>如何使用STM32快速搭建FREERTOS</h2> 
<p>小编之前一直使用正点原子家的产品， 最近准备学习学习TOUCHGFX,要用到HAL+RTOS,原子家的使用起来不方便。于是琢磨着使用STM32CUBEMX直接生成FREERTOS+HAL工程。非常方便，在这里分享给大家</p> 
<h3><a id="CUBEMX_4"></a>CUBEMX安装</h3> 
<p>安装CUBEMX前， 需要安装JAVA，注意一定要下载<mark>64位JAVA</mark>才可，大家可参考这个教程<a href="https://jingyan.baidu.com/article/3aed632ede2a2f7010809114.html" rel="nofollow">https://jingyan.baidu.com/article/3aed632ede2a2f7010809114.html</a>进行下载安装<br> 2022.6.18更新：Win11，cubemx6.5版本，已经不需要自己安装java环境了。<br> <img src="https://images2.imgbox.com/12/2b/LDO0MZp6_o.png" alt="在这里插入图片描述"><br> CUBEMX软件可以直接从官网下载最新版，链接在此<a href="https://www.st.com/en/development-tools/stm32cubemx.html" rel="nofollow">https://www.st.com/en/development-tools/stm32cubemx.html</a>。软件直接选择最新版安装。<br> <img src="https://images2.imgbox.com/8f/a5/uqKJooyR_o.png" alt="在这里插入图片描述"></p> 
<p>装好后（首次打开可能需要更新， 耐心等待），点击下图位置安装相应的支持包。我这里使用的是正点原子F407最小系统板</p> 
<p><img src="https://images2.imgbox.com/b6/7d/zYEkKHgu_o.png" alt="安装MCU支持包"><br> <img src="https://images2.imgbox.com/91/b7/qrSfWFxv_o.png" alt="安装MCUY支持包"></p> 
<h3><a id="_15"></a>创建第一个工程</h3> 
<p><strong>1，选择MCU型号</strong><br> <img src="https://images2.imgbox.com/51/99/8DkiHQGk_o.png" alt="选择MCU"><img src="https://images2.imgbox.com/0f/fc/ts7F2O5Y_o.png" alt="在这里插入图片描述"><br> <strong>2，配置SYS</strong><br> 点击左边的SYS选项卡，<mark>选择Debug模式为SW</mark>。注意这里将时钟源换成了Timer1。这个时钟源是给HAL库提供时钟的。HAL在运行一些超时监测的代码时， 需要一个时钟源提供时钟，一般用systick。但是本例中systick被RTOS占用。<mark>所以修改HAL时钟源为Timer1</mark>.<br> <img src="https://images2.imgbox.com/3c/f5/OOFzqezq_o.png" alt="在这里插入图片描述"><br> <strong>3，配置RCC</strong><br> 这里使用的是外部晶振<br> <img src="https://images2.imgbox.com/46/49/GknAf2AS_o.png" alt="在这里插入图片描述"><br> <strong>4，配置一个LED引脚</strong><br> <img src="https://images2.imgbox.com/5f/32/0dLqa0Oy_o.png" alt="在这里插入图片描述"><br> <strong>5，配置RTOS</strong><br> V1， V2 的区别我也不大清楚。网上也没搜索到，这里暂且V1。 大家有知道的请在下方留言。FREERTOS内部的配置不在这里介绍了，这里不改动任何配置<br> <img src="https://images2.imgbox.com/f2/9e/mXUrWnqA_o.png" alt="在这里插入图片描述"><br> <strong>6，配置时钟树</strong><br> 我用的是外部8M晶振， 参数如下。这里仅做参考，大家根据自己的情况配置，只要不报错应该都没啥问题。<br> <img src="https://images2.imgbox.com/6b/fb/PPNX738y_o.png" alt="在这里插入图片描述"><br> <strong>7，配置工程选项</strong><br> 注意：<mark>Application structure 建议选择Advanced</mark>， 小编之前用Basic， 在代码重新生成时会把usercode覆盖掉（代码书写位置正确的情况下也会这样）。<br> <img src="https://images2.imgbox.com/aa/fe/vfvHFw9L_o.png" alt="在这里插入图片描述"><br> <strong>8，生成代码</strong><br> 小编比较习惯用单独的.c.h 文件，大家按习惯来<br> <img src="https://images2.imgbox.com/f8/10/L6gxFatc_o.png" alt="在这里插入图片描述"><br> <strong>9，测试</strong><br> 至此， 我们的RTOS已经完成了， 为了验证一下，我们可以写一个小程序验证一下</p> 
<p>生成的freertos里， cubemx已经为我们创建好了一个任务defaultTask， 我们直接将我们的代码塞到这个线程里即可。</p> 
<p>在freertos.c里添加如下代码：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">void</span> <span class="token function">StartDefaultTask</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">void</span> <span class="token keyword">const</span> <span class="token operator">*</span> argument</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token comment">/* USER CODE BEGIN StartDefaultTask */</span>
  <span class="token comment">/* Infinite loop */</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
		<span class="token function">HAL_GPIO_TogglePin</span><span class="token punctuation">(</span><span class="token constant">GPIOF</span><span class="token punctuation">,</span><span class="token constant">GPIO_PIN_9</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//翻转电平</span>
		<span class="token function">osDelay</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">//延时+调度</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/* USER CODE END StartDefaultTask */</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>。<br> 。<br> 。</p> 
<p><mark>完活</mark><br> 。<br> 。<br> 。<br> PS，关于CUBEMX生成的FREERTOS<br> ST在FREERTOS的基础上做了封装，大家可以打开cmsis_os.c就可以看到。所有关于freertos的操作全部被再封装了一遍， 好处就是即使不同的RTOS， 用户代码也不会改变。而且ST的封装感觉挺好用的。大家根据自己的情况来。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/510419a7d7e2247b7390ddf9cb1d602a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MATLAB系统辨识</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/eadfd611ce30364f2624a2180ccfb790/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">分支限界法求0-1背包问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>