<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>代替swagger-ui的knife4j踩坑 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="代替swagger-ui的knife4j踩坑" />
<meta property="og:description" content="感觉在swagger-ui上加了一些功能,基本配置
https://doc.xiaominfo.com/knife4j/#spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84
rebel&#43;idea 热部署
坑:
接口文档设置属性不生效
接口文档修改不生效
解决:
注意是否有重复字段,检查是否继承基础类,父子类有属性重复,用了@ApiModelProperty的name属性,你用就用,name的值要和字段保持一次,别拼错了,害人害己,不加也可用,搞不懂为什么要加
我不知道是我没配置好还是knife退化了,swagger-ui的文档,接口顺序是按照代码顺序来的,knife不一致,别给我说去手动一个个加顺序注解,还有一个是实体的字段顺序,也是的,不和代码顺序一致,希望改进下,还要加个配置类,没有默认集成
接口排序
https://doc.xiaominfo.com/knife4j/apiSort.html#tags%E5%88%86%E7%BB%84%E6%8E%92%E5%BA%8F
实体字段排序
import com.fasterxml.jackson.databind.introspect.AnnotatedField; import com.fasterxml.jackson.databind.introspect.BeanPropertyDefinition; import com.google.common.base.Optional; import io.swagger.annotations.ApiModelProperty; import lombok.extern.slf4j.Slf4j; import org.springframework.stereotype.Component; import springfox.documentation.spi.DocumentationType; import springfox.documentation.spi.schema.ModelPropertyBuilderPlugin; import springfox.documentation.spi.schema.contexts.ModelPropertyContext; import springfox.documentation.swagger.common.SwaggerPluginSupport; import java.lang.reflect.Field; import static springfox.documentation.schema.Annotations.findPropertyAnnotation; import static springfox.documentation.swagger.schema.ApiModelProperties.findApiModePropertyAnnotation; /** * &lt;Description&gt; * * @author CJJ * @version 1.0 * @createDate 2020/07/13 14:38 * @see com.suncnpap.common.config.swagger */ @Slf4j @Component public class CustomApiModelPropertyPositionBuilder implements ModelPropertyBuilderPlugin { @Override public boolean supports(DocumentationType delimiter) { return SwaggerPluginSupport." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a7455f85ce4d00d7bd190c2b7b1c4981/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-13T17:28:04+08:00" />
<meta property="article:modified_time" content="2020-07-13T17:28:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">代替swagger-ui的knife4j踩坑</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>感觉在swagger-ui上加了一些功能,基本配置</p> 
<p><a href="https://doc.xiaominfo.com/knife4j/#spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84" rel="nofollow">https://doc.xiaominfo.com/knife4j/#spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84</a></p> 
<p>rebel+idea 热部署</p> 
<p>坑:</p> 
<p><span style="color:#f33b45;">接口文档设置属性不生效</span></p> 
<p><span style="color:#f33b45;">接口文档修改不生效</span></p> 
<p><span style="color:#f33b45;">解决:</span></p> 
<p><span style="color:#f33b45;">注意是否有重复字段,检查是否继承基础类,父子类有属性重复,用了</span><span style="color:#f33b45;">@ApiModelProperty的name属性,你用就用,name的值要和字段保持一次,别拼错了,害人害己,不加也可用,搞不懂为什么要加</span></p> 
<p>我不知道是我没配置好还是knife退化了,swagger-ui的文档,接口顺序是按照代码顺序来的,knife不一致,别给我说去手动一个个加顺序注解,还有一个是实体的字段顺序,也是的,不和代码顺序一致,希望改进下,还要加个配置类,没有默认集成</p> 
<p>接口排序</p> 
<p><a href="https://doc.xiaominfo.com/knife4j/apiSort.html#tags%E5%88%86%E7%BB%84%E6%8E%92%E5%BA%8F" rel="nofollow">https://doc.xiaominfo.com/knife4j/apiSort.html#tags%E5%88%86%E7%BB%84%E6%8E%92%E5%BA%8F</a></p> 
<p>实体字段排序</p> 
<pre><code>import com.fasterxml.jackson.databind.introspect.AnnotatedField;
import com.fasterxml.jackson.databind.introspect.BeanPropertyDefinition;
import com.google.common.base.Optional;
import io.swagger.annotations.ApiModelProperty;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Component;
import springfox.documentation.spi.DocumentationType;
import springfox.documentation.spi.schema.ModelPropertyBuilderPlugin;
import springfox.documentation.spi.schema.contexts.ModelPropertyContext;
import springfox.documentation.swagger.common.SwaggerPluginSupport;

import java.lang.reflect.Field;

import static springfox.documentation.schema.Annotations.findPropertyAnnotation;
import static springfox.documentation.swagger.schema.ApiModelProperties.findApiModePropertyAnnotation;

/**
 * &lt;Description&gt;
 *
 * @author CJJ
 * @version 1.0
 * @createDate 2020/07/13 14:38
 * @see com.suncnpap.common.config.swagger
 */
@Slf4j
@Component
public class CustomApiModelPropertyPositionBuilder implements ModelPropertyBuilderPlugin {


    @Override
    public boolean supports(DocumentationType delimiter) {
        return SwaggerPluginSupport.pluginDoesApply(delimiter);
    }

    @Override
    public void apply(ModelPropertyContext context) {

        Optional&lt;BeanPropertyDefinition&gt; beanPropertyDefinitionOpt = context.getBeanPropertyDefinition();
        Optional&lt;ApiModelProperty&gt; annotation = Optional.absent();

        if (context.getAnnotatedElement().isPresent()) {
            annotation = annotation.or(findApiModePropertyAnnotation(context.getAnnotatedElement().get()));
        }

        if (context.getBeanPropertyDefinition().isPresent()) {
            annotation = annotation.or(findPropertyAnnotation(context.getBeanPropertyDefinition().get(), ApiModelProperty.class));
        }

        if (beanPropertyDefinitionOpt.isPresent()) {
            BeanPropertyDefinition beanPropertyDefinition = beanPropertyDefinitionOpt.get();
            if (annotation.isPresent() &amp;&amp; annotation.get().position() != 0) {
                return;
            }

            AnnotatedField field = beanPropertyDefinition.getField();
            Class&lt;?&gt; clazz = field.getDeclaringClass();
            Field[] declaredFields = clazz.getDeclaredFields();
            Field declaredField;

            try {
                declaredField = clazz.getDeclaredField(field.getName());
            } catch (NoSuchFieldException | SecurityException e) {
                log.error("", e);
                return;
            }

            int indexOf = -1;
            for (int i = 0; i &lt; declaredFields.length; i++) {
                if(declaredFields[i].equals(declaredField)) {
                    indexOf = i;
                    break;
                }
            }
            if (indexOf != -1) {
                context.getBuilder().position(indexOf);
            }

        }

    }

}
</code></pre> 
<p>不要搞那么多花里胡哨的行不行,行不行,好浪费时间找你们留的bug...........</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f097f25450688506ccae8df11d98dd93/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">开放授权协议：Oauth2.0</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/083e5b70a20fd71d5be99f71e23139f9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C&#43;&#43;函数的参数类型中为什么要加const</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>