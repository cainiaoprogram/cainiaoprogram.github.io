<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[清华大学]漏洞挖掘之状态敏感的模糊测试StateFuzz - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="[清华大学]漏洞挖掘之状态敏感的模糊测试StateFuzz" />
<meta property="og:description" content="Dr.赵博栋 Prof.张超 清华大学 网络研究院 INSC
本文主要介绍了通过State Fuzz对Linux驱动程序进行模糊测试，该Fuzz方法由赵博栋博士在InForSec会议上分享，并在USENIX Security上发布.StateFuzz :System Call-Based State-Aware Linux Driver Fuzzing.该篇文章主要介绍了核心方法，为展示测试数据与实验展望.
前言： 模糊测试是当前主流的漏洞挖掘方法，近年来发现了大量的未知漏洞，受到工业界和学术界的广泛关注。其中，以代码覆盖率为进化指标的灰盒测试方案得到大量研究，衍生出了大量优化改进方案。但是，代码覆盖率与漏洞之间存在gap，提高代码覆盖率不一定能够有效发现潜在的安全漏洞。提出了状态敏感的模糊测试方法StateFuzz (USENIX’22)，引入了程序状态作为进化指标，实验结果表明了该方法的有效性，在Linux和Android驱动中发现了数十个未知漏洞。本次报告将与大家探讨这一方案。
背景 漏洞：网络空间重要安全威胁 重要事件：乌克兰断电事件 震网病毒事件 WannaCry HeartBleed(websites) Aurora(Google)
漏洞：网络攻击的突破口 制导部分(漏洞) 战斗部分(漏洞利用) 控制部分(恶意代码)
美国军火商Lockheed-Martin提出的&#34;杀伤链&#34;
Reconnaissance 目标侦查 （漏洞挖掘）
Research,identification,and selection of targets
Weaponization 武器定制 （漏洞利用）
Pairing remote access malware with exploit into a
deliverable payload(e.g.Adobe PDF and Microsoft Office files)
Delivery 武器投放（主动/被动）
Transmission of weapon to target(e.g. via email attachments websites,r USB drivers)
Exploitation 武器生效（漏洞触发与劫持）" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/3e4dacf31c946f9800f7fd76f80cd365/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-13T21:51:34+08:00" />
<meta property="article:modified_time" content="2023-10-13T21:51:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[清华大学]漏洞挖掘之状态敏感的模糊测试StateFuzz</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>Dr.赵博栋 Prof.张超 清华大学 网络研究院 INSC</strong><br> 本文主要介绍了通过State Fuzz对Linux驱动程序进行模糊测试，该Fuzz方法由赵博栋博士在InForSec会议上分享，并在USENIX Security上发布.StateFuzz :System Call-Based State-Aware Linux Driver Fuzzing.该篇文章主要介绍了核心方法，为展示测试数据与实验展望.<br> <img src="https://images2.imgbox.com/7a/e8/ziEn2irh_o.jpg" alt="在这里插入图片描述"></p> 
<h3><a id="_4"></a>前言：</h3> 
<p>模糊测试是当前主流的漏洞挖掘方法，近年来发现了大量的未知漏洞，受到工业界和学术界的广泛关注。其中，以代码覆盖率为进化指标的灰盒测试方案得到大量研究，衍生出了大量优化改进方案。但是，代码覆盖率与漏洞之间存在gap，提高代码覆盖率不一定能够有效发现潜在的安全漏洞。提出了状态敏感的模糊测试方法StateFuzz (USENIX’22)，引入了程序状态作为进化指标，实验结果表明了该方法的有效性，在Linux和Android驱动中发现了数十个未知漏洞。本次报告将与大家探讨这一方案。</p> 
<h2><a id="_8"></a>背景</h2> 
<h3><a id="_10"></a>漏洞：网络空间重要安全威胁</h3> 
<p>重要事件：乌克兰断电事件 震网病毒事件 WannaCry HeartBleed(websites) Aurora(Google)</p> 
<h3><a id="_14"></a>漏洞：网络攻击的突破口</h3> 
<p>制导部分(漏洞) 战斗部分(漏洞利用) 控制部分(恶意代码)</p> 
<p>美国军火商Lockheed-Martin提出的"杀伤链"</p> 
<ul><li> <p>Reconnaissance 目标侦查 （<strong>漏洞挖掘</strong>）<br> Research,identification,and selection of targets</p> </li><li> <p>Weaponization 武器定制 （<strong>漏洞利用</strong>）<br> Pairing remote access malware with exploit into a<br> deliverable payload(e.g.Adobe PDF and Microsoft Office files)</p> </li><li> <p>Delivery 武器投放（主动/被动）<br> Transmission of weapon to target(e.g. via email attachments websites,r USB drivers)</p> </li><li> <p>Exploitation 武器生效（漏洞触发与劫持）</p> <p>Once delivered,the weapon’s code is triggered,exploiting vulnerable applications or systems.</p> </li><li> <p>Installation 持久驻留（<strong>恶意代码</strong>）</p> <p>The weapon installs a backdoor on a target’s system allowing persistent access.</p> </li><li> <p>Command &amp; Control 远程控制（僵尸网络）</p> <p>Outside server communicates with the weapons providing "hands on keyboard access"inside the</p> <p>target’s network.</p> </li><li> <p>Actions on Objective 最终行动（窃密/破坏/跳板）</p> <p>The attacker works to achieve the objective of the intrusion,which can include exfiltration or destruction of data,or intrusion of another target.</p> </li></ul> 
<h3><a id="_47"></a>漏洞与漏洞利用</h3> 
<p>漏洞挖掘与漏洞利用生成本质上都是输入空间搜素问题<br> 输入样本空间 -&gt; 漏洞Poc样本空间 -&gt; 目标(软件、硬件、网络)<br> 漏洞示例CVE-2009-4270</p> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">outprintf</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>fmt<span class="token punctuation">,</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token keyword">int</span> count<span class="token punctuation">;</span><span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>va_list args<span class="token punctuation">;</span>
  <span class="token function">va_start</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span>fmt<span class="token punctuation">)</span><span class="token punctuation">;</span>
  count <span class="token operator">=</span> <span class="token function">vsprintf</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>fmt<span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">outwrite</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//print out</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>arg<span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>arg <span class="token operator">=</span> <span class="token operator">*</span>argv<span class="token operator">++</span><span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">switch</span><span class="token punctuation">(</span>arg<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
      <span class="token keyword">case</span> <span class="token char">'-'</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">switch</span><span class="token punctuation">(</span>arg<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
          <span class="token keyword">case</span> <span class="token number">0</span><span class="token punctuation">;</span>
          <span class="token keyword">default</span><span class="token operator">:</span>
              <span class="token function">outprintf</span><span class="token punctuation">(</span><span class="token string">"unknown switch %s\n"</span><span class="token punctuation">,</span>arg<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">default</span><span class="token operator">:</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token punctuation">}</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<p>count = vsprintf(buf,fmt,args);没有对内存拷贝长度进行限制，造成了栈溢出问题<br> Vul trigger conditions:</p> 
<ul><li>Path constraints 路径约束</li><li>Vul constraints 漏洞约束<br> Discover vulnerabilities:</li><li>Symbolic execution 符号执行</li><li>Fuzzing(testing) 模糊测试<br> 基于代码覆盖率的Fuzzing更擅长解决Path constraints，</li></ul> 
<h2><a id="_84"></a>漏洞挖掘技术概览</h2> 
<h3><a id="_85"></a>漏洞挖掘技术发展历史</h3> 
<p>第一阶段(1960s-1970s):人工审核(依赖经验、无法扩展) -&gt; 源代码审计、逆向工程、经验规则<br> 第二阶段(1970s-1990s):规则扫描(误报高/可扩展性差) -&gt; 静态分析、符号执行、模型检验<br> 第三阶段(1990s-2013s):动态测试(漏报高、覆盖率低) -&gt; 随机畸形测试例，模拟攻击者攻击输入<br> 第四阶段(2013s-2023s):智能挖掘(智能进化) -&gt; 知识与数据驱动，遗传进化算法</p> 
<h3><a id="_SAST_92"></a>第二代方案:规则扫描 静态分析(SAST)</h3> 
<ul><li>基于经验规则静态扫描</li></ul> 
<blockquote> 
 <p>优点：速度快<br> 缺点:误报高、无法输出poc验证脚本<br> 瓶颈:不可判定(rice定理)</p> 
</blockquote> 
<h3><a id="_DASTIAST_98"></a>第三代方案：动态测试 DAST、IAST</h3> 
<ul><li>基于动态信息的漏洞挖掘</li></ul> 
<blockquote> 
 <p>优点:误报低<br> 缺点:覆盖率低，漏报高<br> 工业化产品:OWASP BURPSUITE VERACODE</p> 
</blockquote> 
<h3><a id="fuzzing_104"></a>第三代方案:模糊测试(fuzzing)</h3> 
<ul><li>Fuzzing 模糊测试</li></ul> 
<blockquote> 
 <p>生成/变异测试例，测试，检查，重复…<br> Generator/Mutator -&gt; inputs -&gt; monitor(target program) -&gt; Security violation? -&gt; bugs</p> 
</blockquote> 
<ul><li>科学问题/挑战:</li></ul> 
<blockquote> 
 <p>在无穷的输入空间中，如何高校搜素有限的漏洞样本？</p> 
</blockquote> 
<h3><a id="Fuzzing_1Generationbased_111"></a>Fuzzing 1:Generation-based</h3> 
<p>基于模块生成测试用例(e.g. grammar,specification)</p> 
<blockquote> 
 <p>优点: valid inputs,more code coverage<br> 缺点: hard to setup,requires input knowledge(human efforts)<br> 工业界应用:peach bstorm</p> 
</blockquote> 
<h3><a id="Fuzzing_2Mutationbased_117"></a>Fuzzing 2:Mutation-based</h3> 
<p>变异旧测试用例来生成新的测试用例</p> 
<blockquote> 
 <p>优点:easy to setup,no prior knowledge required<br> 缺点:invalid inputs,limited code coverage(checksum,magic number etc.)<br> 工业界应用:Google OSS-Fuzz Micorsoft Project OneFuzz</p> 
</blockquote> 
<h3><a id="_123"></a>第四代方案:智能模糊测试</h3> 
<p><strong>目前学术界的探索方向：</strong><br> 广度：支持不同类型的目标软件<br> 模糊测试系统应用到目标软件里面。<br> 深度：提升种子生成、变异、测试效率<br> 主要在种子变异和种子挑选环节进行方法优化。</p> 
<p>提供较好的初始种子测试例 -&gt; 种子池挑选种子 -&gt; 种子变异 -&gt;能量分配(变异次数) -&gt; 新测试例 -&gt; 测试执行(覆盖率跟踪/安全监控)<br> 主要思想是优胜劣汰的方法，覆盖率跟踪使用遗传算法实现，得到的测试例覆盖率如果得到提升(进化)，将会被筛选出作为种子放入种子池中。</p> 
<h3><a id="VUL337__133"></a>VUL337 课题组漏洞挖掘研究成果</h3> 
<p>广度探索:</p> 
<ul><li>固件/硬件 IOT 芯片 Bios/TEE</li><li>内核/驱动 Windows MacOS Linux</li><li>系统软件 浏览器 hypervisor SGX/TEE应用</li><li>用户态软件 代码库 二进制程序 GUI程序</li><li>区块链 符号执行 智能合约 DeFi</li><li>网络设备/协议 网络服务 5G、路由器 网联车<br> 深度探索:</li><li>种子生成 &gt; 自动/智能 输入格式识别</li><li>种子排序挑选 &gt; 自动/智能程序语义理解</li><li>种子变异</li><li>测试性能优化 &gt; 并行化、硬件协同</li><li>进化信号跟踪 &gt; 精确、轻量化</li><li>进化策略 &gt; 代码覆盖率、状态制导</li><li>安全违例检测 &gt; 定向挖掘、瓶颈爆破</li></ul> 
<h2><a id="USENIX_2022_151"></a>状态敏感模糊测试USENIX 2022</h2> 
<h3><a id="Code_Coverage__Limitation_153"></a>Code Coverage - Limitation</h3> 
<ul><li>Example:maze game</li></ul> 
<blockquote> 
 <p>most code can be explored easily<br> no guidance to trigger the bug<br> <strong>State:values of maze[y][x]</strong></p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token keyword">while</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  ox<span class="token operator">=</span>x<span class="token punctuation">;</span> oy<span class="token operator">=</span>y<span class="token punctuation">;</span>

  <span class="token keyword">switch</span><span class="token punctuation">(</span>input<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">case</span><span class="token operator">:</span> <span class="token char">'W'</span><span class="token operator">:</span> y<span class="token operator">--</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span><span class="token operator">:</span> <span class="token char">'S'</span><span class="token operator">:</span> y<span class="token operator">+=</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span><span class="token operator">:</span> <span class="token char">'A'</span><span class="token operator">:</span> x<span class="token operator">--</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span><span class="token operator">:</span> <span class="token char">'D'</span><span class="token operator">:</span> x<span class="token operator">+=</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>maze<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token operator">==</span><span class="token char">'#'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token function">Bug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token comment">//If target is blocked,do not advance.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>maze<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token char">' '</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>x <span class="token operator">=</span> ox<span class="token punctuation">;</span> y <span class="token operator">=</span>oy<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>Another Example:DNN testing</li></ul> 
<blockquote> 
 <p>most (Python) code can be explored easily<br> State:output of neurons(activated or not)</p> 
</blockquote> 
<h3><a id="StateFuzzStateaware_Fuzzing_177"></a>StateFuzz:State-aware Fuzzing</h3> 
<ul><li>Intuition:guide fuzzers to explore more program states<br> 我们通过引导模糊测试，去探索更多的程序状态(Program State)。<br> Program State:A combination of Register values and Memory values.<br> 所有寄存器的值和内存的值的组合。<br> 问题：如何去跟踪这样庞大的组合？</li><li>Intuition: guide fuzzers to explore more program states</li><li>Need to answer 3 quesions</li></ul> 
<blockquote> 
 <p>Q1: what are appropriate program states?如何定义一个确认的程序状态？<br> Q2: how to recognize and track program states?如何识别与跟踪程序状态？<br> Q3: how to guide fuzzers to explore program states?如何去引导模糊测试？</p> 
</blockquote> 
<h3><a id="Q1What_are_program_states_189"></a>Q1:What are program states?</h3> 
<ul><li>Values of all memory and registers?</li></ul> 
<blockquote> 
 <p>the number of such states is overwhelmingly large<br> hard to track in practice</p> 
</blockquote> 
<ul><li>Manual annotation:</li></ul> 
<blockquote> 
 <p>human efforts needed</p> 
</blockquote> 
<ul><li>Protocal status code:</li></ul> 
<blockquote> 
 <p>not always available</p> 
</blockquote> 
<ul><li>Using variables to represent states is very common<br> 使用变量来标识状态，我们也可以通过变量作为我们的程序状态。</li><li>Ideally,a state is a combination of all program variables(including memory and register values)</li></ul> 
<blockquote> 
 <p>state explodsion!</p> 
</blockquote> 
<ul><li>Practically,states will <strong>persist</strong> across interaction boundaries,which will be read by an interaction,and<br> <strong>written</strong> another interaction.</li></ul> 
<blockquote> 
 <p>have <strong>a long life time</strong><br> can be <strong>updated</strong>(i.e… state transition)by users<br> can <strong>affect</strong> the program’s control flow or memory access<br> Ex:FTP Server Program<br> User -&gt; Pass Packet / User Packet -&gt; FTP Server</p> 
</blockquote> 
<pre><code class="prism language-c"><span class="token keyword">int</span> <span class="token function">ftpUSER</span><span class="token punctuation">(</span>PFTPCONTEXT context<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">ftpPASS</span><span class="token punctuation">(</span>PFTPCONTEXT context<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>Ex:the variable context -&gt; Access is shared by the Pass and List request</p> 
<pre><code class="prism language-c"><span class="token keyword">int</span> <span class="token function">ftpLIST</span><span class="token punctuation">(</span>PFTPCONTEXT context<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>params<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>context<span class="token operator">-&gt;</span>Access <span class="token operator">==</span> FTP ACCESS_NOT_LOGGED_IN<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token function">sendstring</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span>error530<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-c"><span class="token keyword">int</span> <span class="token function">ftpPASS</span><span class="token punctuation">(</span>PFCONTEXT context<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>params<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcasecmp</span><span class="token punctuation">(</span>temptext<span class="token punctuation">,</span><span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    context<span class="token operator">-&gt;</span>Access <span class="token operator">=</span> FTP_ACCESS_FULL<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="Q2How_to_track_states_229"></a>Q2:How to track states?</h3> 
<ul><li>Step1:Recognize State Variables(varialbes shared by different user actions) 
  <blockquote> 
   <p>step 1.1:recognize user actions 识别状态变量</p> 
  </blockquote> 
  <ul><li>interaces that could be accessed by users</li></ul> 
  <blockquote> 
   <p>step 1.2:recognize variables accessed by actions</p> 
  </blockquote> 
  <ul><li>read/write variables</li></ul> 
  <blockquote> 
   <p>step 1.3:intersection of actions’ variable</p> 
  </blockquote> 
  <ul><li>read by one action,and write by the other action</li></ul> </li><li>Example:the Maze game 
  <blockquote> 
   <p>variables read by action ‘w’:LVMap[‘w’]={y}<br> variables written by action ‘s’：SVMap[‘s’]={y}<br> State variable set V=V U (LVMap[‘w’] 交 SVMap[‘s’])</p> 
  </blockquote> </li></ul> 
<pre><code class="prism language-c"><span class="token keyword">while</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  ox<span class="token operator">=</span>x<span class="token punctuation">;</span> oy<span class="token operator">=</span>y<span class="token punctuation">;</span>

  <span class="token keyword">switch</span><span class="token punctuation">(</span>input<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">case</span><span class="token operator">:</span> <span class="token char">'W'</span><span class="token operator">:</span> y<span class="token operator">--</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span><span class="token operator">:</span> <span class="token char">'S'</span><span class="token operator">:</span> y<span class="token operator">+=</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span><span class="token operator">:</span> <span class="token char">'A'</span><span class="token operator">:</span> x<span class="token operator">--</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span><span class="token operator">:</span> <span class="token char">'D'</span><span class="token operator">:</span> x<span class="token operator">+=</span><span class="token punctuation">;</span><span class="token keyword">break</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>maze<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token operator">==</span><span class="token char">'#'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token function">Bug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
  <span class="token comment">//If target is blocked,do not advance.</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>maze<span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token char">' '</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>x <span class="token operator">=</span> ox<span class="token punctuation">;</span> y <span class="token operator">=</span>oy<span class="token punctuation">;</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>Step2:Calculate and track states(a combination of all state variables)</li></ul> 
<blockquote> 
 <p>how?</p> 
</blockquote> 
<p>Recall:How does AFL track code coverage?</p> 
<ul><li>coverage = combinations of code blocks</li><li>But number of combinations is too large.</li></ul> 
<p>Instution:state coverage = combinations of state-variables’ values.</p> 
<p>Analyze the value ranges of each state-variable</p> 
<ul><li>e.g. (MIN,0],[0,4],(4,10],(10.MAX))<br> 跟踪变量的值域范围，而不是跟踪某一个值.<br> We identify value ranges by solving constrains of condition statements.<br> But the value set of each state-variables is too large,which causes edge explosion.</li></ul> 
<p>通过判断变量是否影响相同的程序控制流，对变量进行组合.<br> The combination of two relevant state-variables values.<br> Both variables affect the same control-flow path or memory accessing.</p> 
<pre><code class="prism language-c"><span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>x<span class="token operator">&lt;=</span><span class="token number">4</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">else</span> 
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<h3><a id="Q3How_to_explore_program_sates_287"></a>Q3:How to explore program sates?</h3> 
<p>遗传算法，使用代码覆盖率作为反馈Check Feedback.我们将状态变量的值域也作为遗传算法的指标.</p> 
<ul><li> <p>Based on existing genetic algorithm</p> 
  <blockquote> 
   <p>which relies only on code coverage feedback currently</p> 
  </blockquote> 
  <ul><li>Our solution: 3-dimension feedback machanism</li></ul> </li><li> <p>A test case is interesting,if it</p> </li></ul> 
<blockquote> 
 <p>discovers new code<br> discovers new value ranges of state variables<br> discover new extremum values of state variables</p> 
</blockquote> 
<h3><a id="StateFuzzImplementation_299"></a>StateFuzz:Implementation</h3> 
<p>1.Kernel Source code -&gt; Program State Recognition(Static Analysis静态分析-&gt;State-variable List状态变量集合-&gt;Static Symbolic Execution静态符号执行-&gt;提取约束条件State-Variable Value Ranges)<br> 2.Instrumentation(State-variable Tracking Instrumentation &amp;Code Coverage Instrumentation-&gt;Instrumented Kernel内核插桩)<br> 3.Fuzzing Loop(根据代码插桩情况选择如何保留种子Seed Preservation -&gt; Seed Selection -&gt;Mutation)</p> 
<p>具体实现细节</p> 
<ul><li> <p>State Recognition</p> 
  <blockquote> 
   <p>DIFUZE(for program action recognition)<br> CRIX(for building call graph)<br> Clang Static Analyzer(for static symbolic execution)</p> 
  </blockquote> </li><li> <p>Instrumentation</p> 
  <blockquote> 
   <p>LLVM Sancov<br> SVF</p> 
  </blockquote> </li><li> <p>Fuzzing loop</p> 
  <blockquote> 
   <p>Syzkaller</p> 
  </blockquote> </li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/46c4dd0180088f639c3183e1573fc882/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">华为eNSP防火墙USG6000V 导入包</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/36da28127d6bd2b4dfe2568fc603b976/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">亲测解决Clearing orphaned inode 或者recovering journal</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>