<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ES数据存储搜索引擎入门到整合Springboot一章直达 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ES数据存储搜索引擎入门到整合Springboot一章直达" />
<meta property="og:description" content="前言 学习一门语言，我们从熟悉其语法开始，慢慢深入动手实践，并开始将其使用到对应的场景上，当我们遇到相应的问题，能够联想到使用该技术，并能够信手拈来的时候，才是我们真正掌握了一门技术或者语言的时候。学习的时候可以和其他学过的知识点相关联，如ES可以与MYSQL特性相关联，就像编程入门从C开始一样，是介于C的语法基础，触类旁通其他语言，下面介绍的是ES的使用场景，语法，和对应的操作过程。
一. ES数据库说明 es数据库是一个搜索引擎，既可以存储数据，又可以将数据进行细粒度划分，切分为多个索引条件，并支持全文检索，是一个分布式概念的数据存储搜索引擎。基于JAVA和Lucence创建。
二. ES的常见概念 集群，节点，索引，类型，映射，文档，段域，反向索引，DSL索引
集群： 多个服务构建成一个集群节点： 一个集群上的节点，指代集群上的一个服务索引： index ，是es的一个基本概念，依靠索引可以进行数据的检索，相当于myql的数据库（database）的量级映射： 在存储数据的时候规定映射规则可以限制存储进es的数据，相当于mysql的表结构。文档：文档是es存储的基本单位，相当于mysql的行的概念段域：相当于mysql的列反向索引：相当于mysql正向查询DSL索引：依靠es查询规则而进行的查询，相当于mysql的sql查询 ES关系型数据库索引（index）数据库（DataBase）类型（Type）表（Table）映射（Mapping）表结构（Schema）文档（Document）行（ROw）字段（Field）列（Column）反向索引正向索引DSL查询SQL查询 三. ES的应用场景 ① 监控。对日志类数据进行存储、分析、可视化。对日志数据，ES给出了ELK的解决方案。其中logstash采集日志，ES进行复杂的数据分析，转换你的日志，并将他们存储在es中，kibana进行可视化展示。
② 线上商城系统，用户需要搜素购物系统网站上的商品信息。es可以存储所有的商品信息和一些库存信息，用户通过搜索引擎可以查询到自己需要的商品信息。
③ json文档数据库。用于存放java格式的文档。
④ 提供全文搜素并高亮关键字
四. ES的使用原理 存储和查询原理 lucence的存储和查询过程主要是：
存储过程： ① 存储文档经过词法分析得到一系列的词(Term)
② 通过一系列词来创建形成词典和反向索引表
③ 将索引进行存储并写入硬盘。
查询过程：
① 用户输入查询语句。
② 对查询语句经过词法分析得到一系列词(Term) 。
③ 通过语法分析得到一个查询树。
④ 通过索引存储将索引读入到内存。
⑤ 利用查询树搜索索引，从而得到每个词(Term) 的文档链表，对文档链表进行交、差、并得到结果文档。
⑥ 将搜索到的结果文档对查询的相关性进行排序。
⑦ 返回查询结果给用户。
ES写数据分别是写入一个新的文档和在原有文档的基础上进行数据的追加（覆盖原有的文档）。两者基本上没有什么区别，后者是把原来的文档进行删除，再重新写入。
ES写数据流程： （1） 客户端选择一个ES节点发送写请求，ES节点接收请求变为协调节点。
（2） 协调节点判断写请求中如果没有指定文档id，则自动生成一个doc_id。协调节点对doc_id进行哈希取值，判断出文档应存储在哪个切片中。协调节点找到存储切片的对应节点位置，将请求转发给对应的node节点。
（3） Node节点的primary shard处理请求，并将数据同步到replica shard
（4） 协调节点发现所有的primary shard和所有的replica shard都处理完之后，就返回结果给客户端。
五. ES存储和查询数据 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a13939a51e59656ecdff6087b7810849/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-14T17:47:11+08:00" />
<meta property="article:modified_time" content="2023-08-14T17:47:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ES数据存储搜索引擎入门到整合Springboot一章直达</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>前言</h4> 
<p>学习一门语言，我们从熟悉其语法开始，慢慢深入动手实践，并开始将其使用到对应的场景上，当我们遇到相应的问题，能够联想到使用该技术，并能够信手拈来的时候，才是我们真正掌握了一门技术或者语言的时候。学习的时候可以和其他学过的知识点相关联，如ES可以与MYSQL特性相关联，就像编程入门从C开始一样，是介于C的语法基础，触类旁通其他语言，下面介绍的是ES的使用场景，语法，和对应的操作过程。</p> 
<h4>一. ES数据库说明</h4> 
<p>es数据库是一个搜索引擎，既可以存储数据，又可以将数据进行细粒度划分，切分为多个索引条件，并支持全文检索，是一个分布式概念的数据存储搜索引擎。基于JAVA和Lucence创建。</p> 
<h4>二. ES的常见概念</h4> 
<p>集群，节点，索引，类型，映射，文档，段域，反向索引，DSL索引</p> 
<ol><li>集群： 多个服务构建成一个集群</li><li>节点： 一个集群上的节点，指代集群上的一个服务</li><li>索引： index ，是es的一个基本概念，依靠索引可以进行数据的检索，相当于myql的数据库（database）的量级</li><li>映射： 在存储数据的时候规定映射规则可以限制存储进es的数据，相当于mysql的表结构。</li><li>文档：文档是es存储的基本单位，相当于mysql的行的概念</li><li>段域：相当于mysql的列</li><li>反向索引：相当于mysql正向查询</li><li>DSL索引：依靠es查询规则而进行的查询，相当于mysql的sql查询 </li></ol> 
<table border="1" cellpadding="1" cellspacing="1"><tbody><tr><td>ES</td><td>关系型数据库</td></tr><tr><td>索引（index）</td><td>数据库（DataBase）</td></tr><tr><td>类型（Type）</td><td>表（Table）</td></tr><tr><td>映射（Mapping）</td><td>表结构（Schema）</td></tr><tr><td>文档（Document）</td><td>行（ROw）</td></tr><tr><td>字段（Field）</td><td>列（Column）</td></tr><tr><td>反向索引</td><td>正向索引</td></tr><tr><td>DSL查询</td><td>SQL查询</td></tr></tbody></table> 
<h4> 三. ES的应用场景</h4> 
<p>① 监控。对日志类数据进行存储、分析、可视化。对日志数据，ES给出了ELK的解决方案。其中logstash采集日志，ES进行复杂的数据分析，转换你的日志，并将他们存储在es中，kibana进行可视化展示。</p> 
<p>② 线上商城系统，用户需要搜素购物系统网站上的商品信息。es可以存储所有的商品信息和一些库存信息，用户通过搜索引擎可以查询到自己需要的商品信息。</p> 
<p>③ json文档数据库。用于存放java格式的文档。</p> 
<p>④ 提供全文搜素并高亮关键字<br>  </p> 
<h4>四. ES的使用原理</h4> 
<h5>存储和查询原理</h5> 
<p>lucence的存储和查询过程主要是：</p> 
<h5><strong> 存储过程：</strong></h5> 
<p>① 存储文档经过词法分析得到一系列的词(Term)<br> ② 通过一系列词来创建形成词典和反向索引表<br> ③ 将索引进行存储并写入硬盘。<br> 查询过程：</p> 
<p>① 用户输入查询语句。<br> ② 对查询语句经过词法分析得到一系列词(Term) 。<br> ③ 通过语法分析得到一个查询树。<br> ④ 通过索引存储将索引读入到内存。<br> ⑤ 利用查询树搜索索引，从而得到每个词(Term) 的文档链表，对文档链表进行交、差、并得到结果文档。<br> ⑥ 将搜索到的结果文档对查询的相关性进行排序。<br> ⑦ 返回查询结果给用户。</p> 
<p>  </p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/ef/bc/89g8jVrm_o.png"></p> 
<p> </p> 
<p>ES写数据分别是写入一个新的文档和在原有文档的基础上进行数据的追加（覆盖原有的文档）。两者基本上没有什么区别，后者是把原来的文档进行删除，再重新写入。</p> 
<h5 style="background-color:transparent;"><strong>ES写数据流程：</strong></h5> 
<p>（1）  客户端选择一个ES节点发送写请求，ES节点接收请求变为协调节点。</p> 
<p>（2）  协调节点判断写请求中如果没有指定文档id，则自动生成一个doc_id。协调节点对doc_id进行哈希取值，判断出文档应存储在哪个切片中。协调节点找到存储切片的对应节点位置，将请求转发给对应的node节点。</p> 
<p>（3）  Node节点的primary shard处理请求，并将数据同步到replica shard</p> 
<p>（4）  协调节点发现所有的primary shard和所有的replica shard都处理完之后，就返回结果给客户端。<br>  </p> 
<h4 style="background-color:transparent;">五. ES存储和查询数据</h4> 
<h5> 1.存储megacorp公司员工的信息，包含员工first_name,last_name,age,interests</h5> 
<pre><code class="language-java">#存储员工信息
PUT /megacorp/employee/1
{
  "frist_name":"sam",
  "last_name":"tom",
  "interests":["swmming","basketball","music"],
  "about":"I love coding",
  "age":25
}


PUT /megacorp/employee/2
{
  "frist_name":"Smith",
  "last_name":"Math",
  "interests":["basketball","music"],
  "about":"I love coding",
  "age":32
}

PUT /megacorp/employee/3
{
  "frist_name":"Jone",
  "last_name":"KeByt",
  "interests":["music"],
  "about":"I love coding",
  "age":40
}</code></pre> 
<p>megacorp为索引，代表公司（数据库），employee代表类型，表示员工表，数字1，2，3代表员工1，2，3</p> 
<p><strong>分词存储员工信息，使用mapping映射存储结构，同时设置字段的分词细粒度</strong></p> 
<p>分词：例如：司马玉龙，可以分解为司马，玉龙，司，马，玉，龙。查询的时候如果条件在分词里面，可以查询到该文档，比如电商平台的搜索依靠的也是分词搜索商品，直接将类似（包含关键字）的商品带出。</p> 
<pre><code class="language-java">#ik_max_word 代表最大分词细粒度分解字段
POST /employees/slae/
{
  "mappings":{
    "perperties":{
      "frist_name":{
        "type": "text"
      },
      "last_name":{
        "type": "text"
      },
      "full_name":{
        "type": "text",
        "analyzer":"ik_max_word",
        "search_analyzer":"ik_max_word"
      },
      "address":{
        "type":"text",
        "analyzer":"ik_max_word",
        "search_analyzer":"ik_max_word"
      },
      "sex":{
        "type":"text"
      },
      "salay":{
        "type":"text"
      }
    }
  }
}</code></pre> 
<h5>2.查询员工信息</h5> 
<p><strong>（1）查询所有员工信息</strong></p> 
<pre><code class="language-java">GET /megacorp/employee/_search</code></pre> 
<p>结果，将搜索的结果集存放在hits里面</p> 
<p class="img-center"><img alt="" height="400" src="https://images2.imgbox.com/24/89/8aGj3Q4h_o.png" width="237"></p> 
<p><strong> （2）条件查询</strong></p> 
<p><strong>依靠员工last_name查询</strong></p> 
<pre><code class="language-java">#条件查询
GET /megacorp/employee/_search?q=last_name:tom</code></pre> 
<p> </p> 
<p class="img-center"><img alt="" height="400" src="https://images2.imgbox.com/90/29/jCGPOWuu_o.png" width="229"></p> 
<p><strong> 依靠员工frist_name查询</strong></p> 
<pre><code class="language-java">GET /megacorp/employee/_search
{
  "query":{
    "match": {
      "frist_name": "sam"
    }
  }
}</code></pre> 
<p><strong>过滤查询，先执行filter的条件，在执行query里面的条件</strong></p> 
<p>filter过滤可以有 range(范围)，exists(存在)，ids(文档id)，term,terms(字段) 过滤，下面举例range，其他条件类似。</p> 
<pre><code class="language-java">#filter过滤，相当于mysql 大于小于范围查询
GET /megacorp/employee/_search
{
  "query":{
    "bool":{
      "must": {
        "match":
        {
          "frist_name":"sam"
        }
      },
      "filter": [
        {
          "range": {
            "age": {
              "gte": 20,
              "lte": 40
            }
          }
        }
      ]
    }
  }
}</code></pre> 
<p><strong>term（分析）搜索</strong></p> 
<p>类似于myql的group by 分组查询</p> 
<p> 前提是查询的字段具有分词结构，即设置了analyzer</p> 
<pre><code class="language-java">GET /megacorp/employee/_search
{
  "aggs":{
    "all_address":{
      "terms":{
        "field":"address"
      }
    }
  }
}</code></pre> 
<p class="img-center"><img alt="" height="541" src="https://images2.imgbox.com/cc/00/vuVuRKAX_o.png" width="402"></p> 
<p> 在没有分词结构的基础上查询出现,文本字段不是分析排序结构，所有操作不能依靠默认进行。</p> 
<pre><code class="language-java">GET /megacorp/employee/_search
{
  "aggs":{
    "all_address":{
      "terms":{
        "field":"frist_name"
      }
    }
  }
}</code></pre> 
<p><img alt="" height="241" src="https://images2.imgbox.com/15/9b/cs3jr3qQ_o.png" width="832"></p> 
<p> </p> 
<p><strong>短语搜索</strong></p> 
<pre><code class="language-java">GET /megacorp/employee/_search
{
  "query":{
    "match_phrase": {
      "frist_name": "smith"
    }
  }
}</code></pre> 
<p><strong>高亮搜索</strong></p> 
<pre><code class="language-java">GET /megacorp/employee/_search
{
  "query":{
    "match_phrase": {
      "frist_name": "smith"
    }
  },
  "highlight":{
    "fields": {
      "frist_name": {}
    }
  }
}</code></pre> 
<p> </p> 
<p class="img-center"><img alt="" height="408" src="https://images2.imgbox.com/13/8b/egmRln6C_o.png" width="299"></p> 
<p> <strong>(3)深入-高级搜索</strong></p> 
<p><strong>结构搜索</strong></p> 
<p><strong>精确搜索</strong></p> 
<p>使用_bulk 一次性插入多条数据</p> 
<pre><code class="language-java">POST /my_store/products/_bulk
{ "index": { "_id": 1 }}
{ "price" : 10, "productID" : "XHDK-A-1293-#fJ3" }
{ "index": { "_id": 2 }}
{ "price" : 20, "productID" : "KDKE-B-9947-#kL5" }
{ "index": { "_id": 3 }}
{ "price" : 30, "productID" : "JODL-X-1937-#pV7" }
{ "index": { "_id": 4 }}
{ "price" : 30, "productID" : "QQPX-R-3956-#aD8" }</code></pre> 
<p><strong> term精确搜索</strong></p> 
<pre><code class="language-java">GET /my_store/products/_search
{
    "query" : {
        "constant_score" : { 
            "filter" : {
                "term" : { 
                    "price" : 20
                }
            }
        }
    }
}</code></pre> 
<p> term为简单的精准查询，就像mysql中的sql</p> 
<pre><code class="language-java">select * from products where price = 20</code></pre> 
<p>constant_score的意思是不评分计算查询，将term转换成filter过滤。</p> 
<p><strong>组合过滤器-bool过滤器</strong></p> 
<p>结构</p> 
<pre><code class="language-java">GET /my_store/products/_search
{
  "query":{
    "bool": {
      "should": [
        {}
      ],
      "must": [
        {}
      ],
      "must_not": [
        {}
      ]
    }
  }
}</code></pre> 
<p> should：与myql的OR等价。</p> 
<p>must：与mysql的AND等价。</p> 
<p>must_not：与mysql的NOT等价。</p> 
<p>例：查询价格在10~20的文档</p> 
<p>mysql：select * from products where price &gt;= 10 and pirce&lt;=20 </p> 
<pre><code class="language-java">GET /my_store/products/_search
{
  "query":{
    "bool": {
      "should": [
        {
          "constant_score": {
            "filter": {
              "range": {
                "price": {
                  "gte": 10,
                  "lte": 20
                }
              }
            }
          }
        }
      ]
    }
  }
}</code></pre> 
<p class="img-center"><img alt="" height="402" src="https://images2.imgbox.com/55/84/XqjuBbf2_o.png" width="401"></p> 
<p><strong> 嵌套bool</strong></p> 
<p>查询sql </p> 
<pre><code class="language-java">SELECT document
FROM   products
WHERE  productID      = "KDKE-B-9947-#kL5"
  OR (     productID = "JODL-X-1937-#pV7"
       AND price     = 30 )</code></pre> 
<p> 转成DSL</p> 
<pre><code class="language-java">{
  "query":{
    "constant_score": {
      "filter": {
        "bool": {
          "should":[
            {
              "term":{
                "productID":"KDKE-B-9947-#kL5"
              }
            },
          {
            "bool":{
              "must":[
                    {
                      "term":
                      {
                       "productID":"JODL-X-1937-#pV7" 
                      }
                    },
                    {
                      "term":
                      {
                        "price":30
                      }
                    }
                ]
              }
          }
        ]
        }
      },
      "boost": 1.2
    }
  }
}</code></pre> 
<p><strong>多个精确搜索</strong></p> 
<p>使用terms多条件精准查询</p> 
<pre><code class="language-java">GET /my_store/products/_search
{
  "query":{
    "constant_score": {
      "filter": {
        "terms": {
          "price": [20,30]
        }
      },
      "boost": 1.2
    }
  }
}</code></pre> 
<p><strong>处理空值NULL</strong></p> 
<pre><code class="language-java">POST /my_index/posts/_bulk
{ "index": { "_id": "1"              }}
{ "tags" : ["search"]                }  
{ "index": { "_id": "2"              }}
{ "tags" : ["search", "open_source"] }  
{ "index": { "_id": "3"              }}
{ "other_field" : "some data"        }  
{ "index": { "_id": "4"              }}
{ "tags" : null                      }  
{ "index": { "_id": "5"              }}
{ "tags" : ["search", null]          }  </code></pre> 
<p>mysql语句</p> 
<pre><code class="language-java">SELECT tags
FROM   posts
WHERE  tags IS NOT NULL</code></pre> 
<p> ES-DSL，使用exists判断</p> 
<pre><code class="language-java">GET /my_index/posts/_search
{
    "query" : {
        "constant_score" : {
            "filter" : {
                "exists" : { "field" : "tags" }
            }
        }
    }
}</code></pre> 
<p><strong>match搜索</strong></p> 
<p> match搜索本质是多个<strong>term</strong>搜索的结果集，多个<strong>term</strong>搜索之后合并，如果有分词，则返回有分词的结果，没有分词就返回直接查询，match是匹配查询，即全文中有没有匹配这个单词的，有匹配的带出。</p> 
<pre><code class="language-java">GET /employees/slae/_search
{
  "query":{
    "match": {
      "full_name": "lisisi"
    }
  }
}</code></pre> 
<pre><code class="language-java">POST /my_index/my_type/_bulk
{ "index": { "_id": 1 }}
{ "title": "The quick brown fox" }
{ "index": { "_id": 2 }}
{ "title": "The quick brown fox jumps over the lazy dog" }
{ "index": { "_id": 3 }}
{ "title": "The quick brown fox jumps over the quick dog" }
{ "index": { "_id": 4 }}
{ "title": "Brown fox brown dog" }</code></pre> 
<p> 单个单词匹配</p> 
<pre><code class="language-java">GET /my_index/my_type/_search
{
    "query": {
        "match": {
            "title": "QUICK!"
        }
    }
}</code></pre> 
<p>组合查询</p> 
<pre><code class="language-java">GET /my_index/my_type/_search
{
  "query": {
    "bool": {
      "must":     { "match": { "title": "quick" }},
      "must_not": { "match": { "title": "lazy"  }},
      "should": [
                  { "match": { "title": "brown" }},
                  { "match": { "title": "dog"   }}
      ]
    }
  }
}</code></pre> 
<p></p> 
<h5>3.删除员工信息</h5> 
<pre><code class="language-java">#删除员工1
DELETE /megacorp/employee/1</code></pre> 
<h5>4.修改员工信息</h5> 
<pre><code class="language-java">#修改员工1的信息
PUT /megacorp/employee/1
{
  "frist_name":"smith",
  "last_name":"ttm",
  "interests":["swmming","basketball","music"],
  "about":"I love coding",
  "age":25
}</code></pre> 
<p class="img-center"><img alt="" height="373" src="https://images2.imgbox.com/97/d8/bK9hlphp_o.png" width="274"></p> 
<p> 语法介绍到这里，篇幅太长，可以参考<a href="https://www.elastic.co/guide/cn/elasticsearch/guide/" rel="nofollow" title="https://www.elastic.co/guide/cn/elasticsearch/guide/">https://www.elastic.co/guide/cn/elasticsearch/guide/</a></p> 
<h4>六. ES整合Springboot</h4> 
<h5> 1.引入依赖</h5> 
<p>Springboot版本2.5，引入2.7es</p> 
<pre><code class="language-XML">&lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;com.jcraft&lt;/groupId&gt;
            &lt;artifactId&gt;jsch&lt;/artifactId&gt;
            &lt;version&gt;0.1.55&lt;/version&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;!-- https://mvnrepository.com/artifact/org.elasticsearch.client/elasticsearch-rest-high-level-client --&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;
            &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;/artifactId&gt;
&lt;!--            &lt;version&gt;7.15.0&lt;/version&gt;--&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-elasticsearch&lt;/artifactId&gt;
&lt;!--            &lt;version&gt;3.0.2&lt;/version&gt;--&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;!--rabbitmq--&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.netty&lt;/groupId&gt;
            &lt;artifactId&gt;netty-all&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-websocket&lt;/artifactId&gt;
        &lt;/dependency&gt;

    &lt;/dependencies&gt;</code></pre> 
<h5><strong>2.创建RestHightClient配置</strong></h5> 
<pre><code class="language-java">@Configuration
public class RestHighClient extends AbstractElasticsearchConfiguration {
    @Bean
    @ConditionalOnMissingBean
    @Override
    public RestHighLevelClient elasticsearchClient() {
        final ClientConfiguration clientConfiguration = ClientConfiguration
                .builder()
                .connectedTo("192.168.219.137:9200")
                .build();
        return RestClients.create(clientConfiguration).rest();
    }
}</code></pre> 
<h5><strong>3.创建实体类</strong></h5> 
<pre><code class="language-java">@Data
@AllArgsConstructor
@NoArgsConstructor
@Document(indexName = "teacher",createIndex = true)
public class Teacher {
    @Id
    @Field(store = true,type = FieldType.Keyword)
    private String id;

    @Field(store = true,type = FieldType.Text)
    private String teacherName;

    @Field(store = true,type = FieldType.Text)
    private String email;

    @Field(store = true,type = FieldType.Text,analyzer = "ik_max_word")
    private String address;

    @Field(store = true,type = FieldType.Text)
    private String phone;

}</code></pre> 
<p>@Document表示创建实体类的同时创建ES文档，并将实体类的字段都当成是ES中的字段，</p> 
<p>@Field中可以规定字段的类型和是否进行分词</p> 
<h5>4.创建ES映射仓库</h5> 
<pre><code class="language-java">@Component
public interface EsTeacherMapper extends ElasticsearchRepository&lt;Teacher,String&gt; {
}</code></pre> 
<p>接口继承ElasticsearchReposity接口，接口里面集成了增删改查的方法，这里的用法很便捷，非常类似MybatisPlus的用法，用过MybatisPlus的小伙伴应该很容易上手。</p> 
<h5>5.调用接口实现操作</h5> 
<pre><code class="language-java">@SpringBootTest
class ElasticsearchApplicationTests {

    @Resource
    RestHighClient restHightClient;
    @Autowired
    EsTeacherMapper teacherMapper;

 @Test
    public void PutData(){
        Teacher teacher = new Teacher();
        teacher.setId("A00003");
        teacher.setTeacherName("陈平安");
        teacher.setPhone("34546565265");
        teacher.setEmail("2435454656@qq.com");
        teacher.setAddress("大丽龙泉县落魄山竹楼");
        Teacher save = teacherMapper.save(teacher);
        System.out.println(save);
    }

@Test
    public void query() throws IOException {
        /**
         * 依靠id查询
         */
        Optional&lt;Teacher&gt; a00001 = teacherMapper.findById("A00002");
        System.out.println(a00001.get());
        /**
         * 查询所有
         */
        Iterable&lt;Teacher&gt; all = teacherMapper.findAll();
        all.forEach(teacher -&gt; System.out.println(teacher));
        /**
         * 条件查询
         */
        MultiMatchQueryBuilder multiMatchQueryBuilder = QueryBuilders
.multiMatchQuery("竹楼", "address");
        SearchRequest searchRequest = new SearchRequest("teacher");
        SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();
        searchSourceBuilder.query(multiMatchQueryBuilder);
        searchRequest.source(searchSourceBuilder);
        SearchResponse search = restHightClient.elasticsearchClient().search(searchRequest, RequestOptions.DEFAULT);
        SearchHit[] hits = search.getHits().getHits();
        for (SearchHit hit: hits) {
            System.out.println(hit.getIndex()+":"+hit.getSourceAsString());
        }
    }

/**
*filter查询
**/
    @Test
    public void filterQuery() throws IOException {
        SearchRequest searchRequest = new SearchRequest("teacher");
        SearchSourceBuilder searchSourceBuilder = new SearchSourceBuilder();
        searchSourceBuilder
                .query(QueryBuilders.termQuery("address","解放"))
                .postFilter(QueryBuilders.idsQuery().addIds("A00001"));
        searchRequest.source(searchSourceBuilder);
        SearchResponse search = restHightClient.elasticsearchClient()
                .search(searchRequest, RequestOptions.DEFAULT);
        SearchHit[] hits = search.getHits().getHits();
        for (SearchHit showHit:hits) {
            System.out.println(showHit.getSourceAsString());
        }
        searchSourceBuilder.query(QueryBuilders.matchQuery("address","解放"));
        searchRequest.source(searchSourceBuilder);
        SearchResponse response = restHightClient.elasticsearchClient()
                .search(searchRequest,RequestOptions.DEFAULT);
        SearchHit[] hits1 = response.getHits().getHits();
        for (SearchHit searchHit: hits1) {
            System.out.println(searchHit.getSourceAsString());
        }
    }

}</code></pre> 
<p><strong>存放数据</strong></p> 
<p><img alt="" height="65" src="https://images2.imgbox.com/f1/79/aU2Cqxx9_o.png" width="999"></p> 
<p><strong>查询数据</strong></p> 
<p><strong>依靠id查询</strong></p> 
<p><img alt="" height="34" src="https://images2.imgbox.com/cd/c6/2EzsgxSb_o.png" width="1080"><strong> 查询所有数据</strong></p> 
<p><img alt="" height="100" src="https://images2.imgbox.com/2e/b2/9Lku4JAk_o.png" width="1084"></p> 
<p><strong>match条件查询</strong></p> 
<p><img alt="" height="60" src="https://images2.imgbox.com/1d/f8/elUVIcdr_o.png" width="1200"> <strong>filter过滤查询</strong></p> 
<p><img alt="" height="65" src="https://images2.imgbox.com/d5/39/YXnkXM1o_o.png" width="1200"></p> 
<h4> 结语</h4> 
<p>代码虐我千百遍，待它如初恋，卖油翁小故事，无他，唯手熟尔。</p> 
<p> </p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/18cbaa10f3efc657bfcf53ef81de5843/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">keil护眼色配置及插件整理</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c49a830e12673e70304e40918aeb859b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【uniapp】微信小程序，取视频第一帧，前提是 图片是在 阿里云的oss上</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>