<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Nginx报错 HTTP 413 Request Entity Too Large（Payload Too Large）解决方案 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Nginx报错 HTTP 413 Request Entity Too Large（Payload Too Large）解决方案" />
<meta property="og:description" content="原因 上传文件时，请求参数过大，导致超出服务端限制。
客户端发送的实体主体部分比服务器能够或者希望处理的要大。 解决 Nginx默认最大能够上传1MB文件，打开nginx.conf在http{}中，找到server{}设置：
client_max_body_size 30m;（配置客户端请求实体最大值）
client_body_buffer_size 128k;（配置请求体缓存区大小）
client_max_body_size
client_max_body_size 默认 1M，表示 客户端请求服务器最大允许大小，在“Content-Length”请求头中指定。如果请求的正文数据大于client_max_body_size，HTTP协议会报错 413 Request Entity Too Large。如果需要上传大文件，一定要修改该值。
client_body_buffer_size
Nginx分配给请求数据的Buffer大小，如果请求的数据小于client_body_buffer_size直接将数据先在内存中存储。如果请求的值大于client_body_buffer_size小于client_max_body_size，就会将数据先存储到临时文件中，在哪个临时文件中呢？
client_body_temp 指定的路径中，默认该路径值是/tmp/.
所以配置的client_body_temp地址，一定让执行的Nginx的用户组有读写权限。否则，当传输的数据大于client_body_buffer_size，写进临时文件失败会报错。
如果追求效率，就设置 client_max_body_size，client_body_buffer_size相同的值，这样就不会存储临时文件，直接存储在内存了。
当请求为GET请求时，可以在nginx.conf的http{}中，找到server{}设置： client_header_buffer_size 2k;
large_client_header_buffers 4 16k;
具体大小根据实际情况而定，这里仅做示例
client_header_buffer_size
client_header_buffer_size 默认值：1k，这个指令表示客户端请求的http头部缓冲区大小。绝大多数情况，下一个头部请求的大小不会大于1k。不过如果有来自于wap客户端的较大的cookie它可能会大于1k，Nginx将分配给它一个更大的缓冲区，这个值可以在large_client_header_buffers里面设置。
large_client_header_buffers
默认值：large_client_header_buffers 4 4k，指令表示客户端请求的一些比较大的头文件到缓冲区的最大值。如果一个请求的URI大小超过这个值，服务器将返回一个&#34;Request URI too large&#34; (414)，同样如果一个请求的头部字段大于这个值，服务器将返回&#34;Bad request&#34;(400)。
缓冲区根据需求的不同是分开的。 默认一个缓冲区大小为操作系统中分页文件大小，通常是4k或8k，如果一个连接请求将状态转换为 keep-alive，这个缓冲区将被释放。
改完配置后，执行如下命令，热更新nginx配置:
nginx -s reload 总结 文件无法上传大概就有以下四个方面的原因： 服务器对上传文件带下做了限制（Nginx，Apache，IIS等服务器，文中仅对Nginx配置做了说明）
网关对上传文件大小做了限制，此时添加配置即可。
SpringBoot/Spring对上传文件大小做了限制，添加配置即可。
文件确实过大，前后端链接超时，自动断开链接，可自己设置断点续传。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/fa211f2add1089addf473340ca16dd3f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-04T15:41:35+08:00" />
<meta property="article:modified_time" content="2023-12-04T15:41:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Nginx报错 HTTP 413 Request Entity Too Large（Payload Too Large）解决方案</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>原因</h2> 
<p>上传文件时，请求参数过大，导致超出服务端限制。</p> 
<p>客户端发送的实体主体部分比服务器能够或者希望处理的要大。 </p> 
<h2>解决</h2> 
<p><strong>Nginx默认最大能够上传1MB文件，打开nginx.conf在http{}中，找到server{}设置：<br> client_max_body_size 30m;（配置客户端请求实体最大值）<br> client_body_buffer_size 128k;（配置请求体缓存区大小）</strong></p> 
<blockquote> 
 <p><strong>client_max_body_size</strong><br> client_max_body_size<strong><strong> </strong></strong>默认 1M，表示 客户端请求服务器最大允许大小，在“Content-Length”请求头中指定。如果请求的正文数据大于client_max_body_size，HTTP协议会报错 413 Request Entity Too Large。如果需要上传大文件，一定要修改该值。</p> 
 <p></p> 
 <p><strong>client_body_buffer_size</strong><br> Nginx分配给请求数据的Buffer大小，如果请求的数据小于client_body_buffer_size直接将数据先在内存中存储。如果请求的值大于client_body_buffer_size小于client_max_body_size，就会将数据先存储到临时文件中，在哪个临时文件中呢？<br> client_body_temp 指定的路径中，默认该路径值是/tmp/.<br> 所以配置的client_body_temp地址，一定让执行的Nginx的用户组有读写权限。否则，当传输的数据大于client_body_buffer_size，写进临时文件失败会报错。</p> 
 <p><br><strong>如果追求效率，就设置 client_max_body_size，client_body_buffer_size相同的值，这样就不会存储临时文件，直接存储在内存了。</strong></p> 
</blockquote> 
<p><strong>当请求为GET请求时，可以在nginx.conf的http{}中，找到server{}设置： </strong></p> 
<p><strong>client_header_buffer_size 2k;</strong></p> 
<p><strong>large_client_header_buffers 4 16k;</strong></p> 
<p><em>具体大小根据实际情况而定，这里仅做示例</em></p> 
<blockquote> 
 <p><strong>client_header_buffer_size</strong></p> 
 <p>client_header_buffer_size 默认值：1k，这个指令表示客户端请求的http头部缓冲区大小。绝大多数情况，下一个头部请求的大小不会大于1k。不过如果有来自于wap客户端的较大的cookie它可能会大于1k，Nginx将分配给它一个更大的缓冲区，这个值可以在large_client_header_buffers里面设置。</p> 
 <p><strong>large_client_header_buffers</strong></p> 
 <p>默认值：large_client_header_buffers 4 4k，指令表示客户端请求的一些比较大的头文件到缓冲区的最大值。如果一个请求的URI大小超过这个值，服务器将返回一个"Request URI too large" (414)，同样如果一个请求的头部字段大于这个值，服务器将返回"Bad request"(400)。</p> 
 <p></p> 
 <p>缓冲区根据需求的不同是分开的。 默认一个缓冲区大小为操作系统中分页文件大小，通常是4k或8k，如果一个连接请求将状态转换为 keep-alive，这个缓冲区将被释放。</p> 
</blockquote> 
<p> 改完配置后，执行如下命令，热更新nginx配置:</p> 
<pre><code class="hljs">nginx -s reload</code></pre> 
<h4><strong>总结  文件无法上传大概就有以下四个方面的原因：</strong></h4> 
<p>服务器对上传文件带下做了限制（Nginx，Apache，IIS等服务器，文中仅对Nginx配置做了说明）<br> 网关对上传文件大小做了限制，此时添加配置即可。<br> SpringBoot/Spring对上传文件大小做了限制，添加配置即可。<br> 文件确实过大，前后端链接超时，自动断开链接，可自己设置断点续传。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fac54b709902afaf0e1c54b5cf52cd74/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">uniapp自定义进度条组件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4725363a918ea131c732265488cb53b1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">gitlab 界面，提交历史后面出现流水线：已失败的问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>