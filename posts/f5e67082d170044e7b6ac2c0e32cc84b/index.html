<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>nginx请求限制配置方法 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="nginx请求限制配置方法" />
<meta property="og:description" content="这篇文章给大家介绍nginx请求限制配置方法，包括http协议的连接和请求，nginx配置语法，本文给大家介绍的非常详细，需要的朋友参考下吧
Nginx 是一个很强大的高性能Web和反向代理服务，它具有很多非常优越的特性：
在连接高并发的情况下，Nginx是Apache服务不错的替代品：Nginx在美国是做虚拟主机生意的老板们经常选择的软件平台之一。能够支持高达 50,000 个并发连接数的响应，感谢Nginx为我们选择了 epoll and kqueue作为开发模型。
一、Nginx的请求限制 limit_conn_module 连接频率限制limit_req_module 请求频率限制 二、HTTP协议的连接与请求 1、HTTP协议的连接与请求的概念
HTTP请求是建立在一次TCP连接基础之上，完成一次http协议的请求www.meimeitu8.com先要进行tcp的三次握手。在TCP连接的基础之上再建立HTTP的请求，一次TCP请求至少产生一次HTTP请求。 2、HTTP协议的连接与请求的图解
3、HTTP协议的连接与请求的版本关系
HTTP协议版本连接关系HTTP1.0TCP不能复用HTTP1.1顺序性TCP复用HTTP2.0多路复用TCP复用 三、Nginx连接限制的配置语法 1、limit_conn_zone的配置语法
Syntax：limit_conn_zone key zone=name:size; limit_conn_zone表示申请的连接存储空间。key 表示连接以哪个作为key，例如以客户端的ip作为key，限制的就是客户端的ip。zone=name表示申请的存储空间的名称。size表示申请的存储空间的大小Default：—— 表示默认没有配置Context：http 表示需要在http块中进行配置 2、limit_conn的配置语法
Syntax：limit_conn zone number; zone表示limit_conn_zone中申请的存储空间的名称，number表示并发请求的限制，即同一时间限制连接数Default：—— 表示默认没有配置Context：http，server，location 表示需要在http块或server块或location块中进行配置 四、Nginx请求限制的配置语法 1、limit_req_zone的配置语法
Syntax：limit_req_zone key zone=name:size rate=rate; limit_req_zone表示申请的连接存储空间。key 表示连接以哪个作为key，例如以客户端的ip作为key，限制的就是客户端的ip。zone=name表示申请的存储空间的名称。size表示申请的存储空间的大小。rate表示请求的限制是多大，指的是一个限制的单位（以秒为单位）Default：—— 表示默认没有配置Context：http 表示需要在http块中进行配置 2、limit_req的配置语法
Syntax：limit_req zone=name [burst = number] [nodelay]; zone=name表示limit_req_zone中申请的存储空间的名称；burst = number表示超过了设置的速率www.rsxedu.com以后，遗留的请求数量放到下一秒执行；Default：—— 表示默认没有配置Context：http，server，location 表示需要在http块或server块或location块中进行配置 五、Nginx请求限制的配置演示 1、先创建是一个submodule.html页面，上传到/opt/app/html目录下，以便配置好sub_module模块编译参数后访问/opt/app/html目录下的submodule.html页面,查看替换的内容。
submodule.html页面
1
2
3
4
5
6
7
8
9" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/f5e67082d170044e7b6ac2c0e32cc84b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-23T16:25:28+08:00" />
<meta property="article:modified_time" content="2021-07-23T16:25:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">nginx请求限制配置方法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>这篇文章给大家介绍nginx请求限制配置方法，包括http协议的连接和请求，nginx配置语法，本文给大家介绍的非常详细，需要的朋友参考下吧</p> 
<p>Nginx 是一个很强大的高性能Web和反向代理服务，它具有很多非常优越的特性：<br> 在连接高并发的情况下，Nginx是Apache服务不错的替代品：Nginx在美国是做虚拟主机生意的老板们经常选择的软件平台之一。能够支持高达 50,000 个并发连接数的响应，感谢Nginx为我们选择了 epoll and kqueue作为开发模型。</p> 
<h3>一、Nginx的请求限制</h3> 
<ul><li>limit_conn_module 连接频率限制</li><li>limit_req_module 请求频率限制</li></ul> 
<h3>二、HTTP协议的连接与请求</h3> 
<p>1、HTTP协议的连接与请求的概念</p> 
<ul><li>HTTP请求是建立在一次TCP连接基础之上，完成一次http协议的请求www.meimeitu8.com先要进行tcp的三次握手。</li><li>在TCP连接的基础之上再建立HTTP的请求，一次TCP请求至少产生一次HTTP请求。</li></ul> 
<p>2、HTTP协议的连接与请求的图解</p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/f6/7c/JhzCNixf_o.png"></p> 
<p>3、HTTP协议的连接与请求的版本关系</p> 
<p></p> 
<table><thead><tr><th>HTTP协议版本</th><th>连接关系</th></tr></thead><tbody><tr><td>HTTP1.0</td><td>TCP不能复用</td></tr><tr><td>HTTP1.1</td><td>顺序性TCP复用</td></tr><tr><td>HTTP2.0</td><td>多路复用TCP复用</td></tr></tbody></table> 
<p></p> 
<h3>三、Nginx连接限制的配置语法</h3> 
<p>1、limit_conn_zone的配置语法</p> 
<ul><li>Syntax：limit_conn_zone key zone=name:size; limit_conn_zone表示申请的连接存储空间。key 表示连接以哪个作为key，例如以客户端的ip作为key，限制的就是客户端的ip。zone=name表示申请的存储空间的名称。size表示申请的存储空间的大小</li><li>Default：—— 表示默认没有配置</li><li>Context：http 表示需要在http块中进行配置</li></ul> 
<p>2、limit_conn的配置语法</p> 
<ul><li>Syntax：limit_conn zone number; zone表示limit_conn_zone中申请的存储空间的名称，number表示并发请求的限制，即同一时间限制连接数</li><li>Default：—— 表示默认没有配置</li><li>Context：http，server，location 表示需要在http块或server块或location块中进行配置</li></ul> 
<h3>四、Nginx请求限制的配置语法</h3> 
<p>1、limit_req_zone的配置语法</p> 
<ul><li>Syntax：limit_req_zone key zone=name:size rate=rate; limit_req_zone表示申请的连接存储空间。key 表示连接以哪个作为key，例如以客户端的ip作为key，限制的就是客户端的ip。zone=name表示申请的存储空间的名称。size表示申请的存储空间的大小。rate表示请求的限制是多大，指的是一个限制的单位（以秒为单位）</li><li>Default：—— 表示默认没有配置</li><li>Context：http 表示需要在http块中进行配置</li></ul> 
<p>2、limit_req的配置语法</p> 
<ul><li>Syntax：limit_req zone=name [burst = number] [nodelay]; zone=name表示limit_req_zone中申请的存储空间的名称；burst = number表示超过了设置的速率www.rsxedu.com以后，遗留的请求数量放到下一秒执行；</li><li>Default：—— 表示默认没有配置</li><li>Context：http，server，location 表示需要在http块或server块或location块中进行配置</li></ul> 
<h3>五、Nginx请求限制的配置演示</h3> 
<p>1、先创建是一个submodule.html页面，上传到/opt/app/html目录下，以便配置好sub_module模块编译参数后访问/opt/app/html目录下的submodule.html页面,查看替换的内容。</p> 
<p>submodule.html页面</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> </td><td> <p><code>&lt;html&gt;</code></p> <p><code>    </code><code>&lt;head&gt;</code></p> <p><code>        </code><code>&lt;meta charset=</code><code>"utf-8"</code><code>&gt;</code></p> <p><code>        </code><code>&lt;title&gt;submodule&lt;/title&gt;</code></p> <p><code>    </code><code>&lt;/head&gt;</code></p> <p><code>    </code><code>&lt;body&gt;</code></p> <p><code>        </code><code>&lt;a&gt;html&lt;/a&gt;&lt;/br&gt;</code></p> <p><code>        </code><code>&lt;a&gt;xml&lt;/a&gt;&lt;/br&gt;</code></p> <p><code>        </code><code>&lt;a&gt;json&lt;/a&gt;&lt;/br&gt;</code></p> <p><code>        </code><code>&lt;a&gt;xml&lt;/a&gt;&lt;/br&gt;</code></p> <p><code>        </code><code>&lt;a&gt;jsp&lt;/a&gt;&lt;/br&gt;</code></p> <p><code>        </code><code>&lt;a&gt;html&lt;/a&gt;</code></p> <p><code>    </code><code>&lt;/body&gt;</code></p> <p><code>&lt;/html&gt;</code></p> </td></tr></tbody></table> 
<p>浏览器访问如下图</p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/87/7b/zCTiUJFz_o.png"></p> 
<p>2、编辑nginx.conf配置文件</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> </td><td> <p><code>[root@localhost /]# vim /etc/nginx/nginx.conf</code></p> </td></tr></tbody></table> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/7d/83/fBMfElp6_o.png"></p> 
<p>3、在http块中添加如下配置</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> </td><td> <p><code>#$binary_remote_addr表示客户端的地址；</code></p> <p><code>#zone=req_zone表示同一个客户端地址发起的请求的存储空间名称</code></p> <p><code>#1r/s 表示每秒一次</code></p> <p><code>limit_req_zone $binary_remote_addr zone=req_zone:1m rate=1r/s;</code></p> </td></tr></tbody></table> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/7e/9b/zfXseQs8_o.png"></p> 
<p>4、在http块的location块中添加如下配置</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> </td><td> <p><code>#nginx连接请求限制的配置</code></p> <p><code>location / {<!-- --></code></p> <p><code>    </code><code>root /opt/app/html;</code></p> <p><code>    </code><code>limit_req zone=req_zone;</code></p> <p><code>}</code></p> </td></tr></tbody></table> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/b3/4f/CSBjx2Q3_o.png"></p> 
<p>5、检查配置修改的配置文件是否正确，返回successful表示配置文件修改无错。否则检查配置文件语法。</p> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/b6/7f/FvWhrSET_o.png"></p> 
<p>6、重新加载配置文件</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> </td><td> <p><code>[root@localhost /]# systemctl reload nginx</code></p> </td></tr></tbody></table> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/2f/96/hbj5EoD4_o.png"></p> 
<p>7、借助ab压力测试工具做并发请求</p> 
<p>ab压力测试工具的安装参考lz此博文链接：https://wwwxz.blog.csdn.net/article/details/118584751</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> </td><td> <p><code>#-n表示发起请求次数，-c表示并发请求次数 </code></p> <p><code>[root@localhost ~]# ab -n 20 -c 10 <a href="http://localhost/submodule.html" rel="nofollow">http://localhost/submodule.html</a></code></p> </td></tr></tbody></table> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/d7/a3/RS79dbVj_o.png"></p> 
<p>到此这篇关于nginx请求限制配置方法的文章</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/50fdda699f4a655adb6a58a415f36736/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue 生命周期图 &#43; activated &#43; deactivated</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/666c8e4beab6fb1a89940ad04b5b34a6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue ref和$refs 获取不到值</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>