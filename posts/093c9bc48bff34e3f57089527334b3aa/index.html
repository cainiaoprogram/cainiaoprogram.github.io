<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【操作系统】磁盘管理高级 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【操作系统】磁盘管理高级" />
<meta property="og:description" content="文章目录 RAID磁盘阵列什么是RAID？RAID 0RAID 1RAID 5RAID 10磁盘阵列管理mdadm 工具的使用创建并管理RAID LVM 磁盘管理物理卷 - PV卷组 - VG逻辑卷 - LV命令行创建 LVM调整 LVM 的大小删除逻辑卷 RAID磁盘阵列 Redundant Array of Independent Disks - 独立冗余磁盘阵列
什么是RAID？ 把多个磁盘设备组合成一个容量更大、更安全的磁盘阵列 把数据切割成多个区段，分别存放在不同的物理硬盘设备上，然后利用 分散读写技术 来提升磁盘阵列整体的性能； 同时把多个重要数据的 副本 同步到不同的物理硬盘设备上，从而起到非常好的 数据冗余备份 效果 优点
冗余备份硬盘吞吐量提升，读写速度提升反面：成本支出提升 RAID 磁盘阵列 方案：
至少十几种，详细介绍四种
RAID 0RAID 1RAID 5RAID 10 RAID 0 数据条带化 数量：2块及以上的硬盘，性能和容量随硬盘数递增 优点：所有的RAID级别中，速度最快；（并发读取和写入）
缺点：无冗余或错误修复能力，无法容忍硬盘损坏。
RAID 1 数据镜像（一模一样的备份） 数量：2块及以上的硬盘（偶数） 优点：数据在每组磁盘中都有一份，读性能好，一组磁盘损坏，不影响数据访问；
缺点：写性能下降，因为要写双份数据；
RAID 5 奇偶校验 数量：3块及以上的硬盘 并发存放 优点：能容忍任意坏掉一块盘，奇偶校验恢复 接近 RAID-0 的数据读取速度，具有一定的容灾能力，写速度比RAID-1慢
RAID 10 奇偶校验 数量：至少4块 优点：更好的性能，更好的可靠性" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/093c9bc48bff34e3f57089527334b3aa/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-03T10:49:01+08:00" />
<meta property="article:modified_time" content="2023-07-03T10:49:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【操作系统】磁盘管理高级</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#RAID_3" rel="nofollow">RAID磁盘阵列</a></li><li><ul><li><a href="#RAID_6" rel="nofollow">什么是RAID？</a></li><li><a href="#RAID_0_31" rel="nofollow">RAID 0</a></li><li><a href="#RAID_1_39" rel="nofollow">RAID 1</a></li><li><a href="#RAID_5_47" rel="nofollow">RAID 5</a></li><li><a href="#RAID_10_55" rel="nofollow">RAID 10</a></li><li><a href="#_71" rel="nofollow">磁盘阵列管理</a></li><li><ul><li><a href="#mdadm__77" rel="nofollow">mdadm 工具的使用</a></li><li><ul><li><a href="#RAID_89" rel="nofollow">创建并管理RAID</a></li></ul> 
   </li></ul> 
  </li></ul> 
  </li><li><a href="#LVM__131" rel="nofollow">LVM 磁盘管理</a></li><li><ul><li><a href="#__PV_135" rel="nofollow">物理卷 - PV</a></li><li><a href="#__VG_141" rel="nofollow">卷组 - VG</a></li><li><a href="#__LV_149" rel="nofollow">逻辑卷 - LV</a></li><li><a href="#_LVM_166" rel="nofollow">命令行创建 LVM</a></li><li><a href="#_LVM__188" rel="nofollow">调整 LVM 的大小</a></li><li><a href="#_215" rel="nofollow">删除逻辑卷</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="RAID_3"></a>RAID磁盘阵列</h2> 
<p>Redundant Array of Independent Disks - <code>独立冗余磁盘阵列</code></p> 
<h3><a id="RAID_6"></a>什么是RAID？</h3> 
<pre><code class="prism language-bash">把多个磁盘设备组合成一个容量更大、更安全的磁盘阵列

把数据切割成多个区段，分别存放在不同的物理硬盘设备上，然后利用 分散读写技术 来提升磁盘阵列整体的性能；

同时把多个重要数据的 副本 同步到不同的物理硬盘设备上，从而起到非常好的 数据冗余备份 效果
</code></pre> 
<blockquote> 
 <p>优点</p> 
</blockquote> 
<ol><li>冗余备份</li><li>硬盘吞吐量提升，读写速度提升</li><li>反面：成本支出提升</li></ol> 
<blockquote> 
 <p>RAID 磁盘阵列 方案：</p> 
</blockquote> 
<p>至少十几种，详细介绍四种</p> 
<ul><li>RAID 0</li><li>RAID 1</li><li>RAID 5</li><li>RAID 10</li></ul> 
<h3><a id="RAID_0_31"></a>RAID 0</h3> 
<pre><code class="prism language-bash">数据条带化
数量：2块及以上的硬盘，性能和容量随硬盘数递增
</code></pre> 
<p>优点：<font color="red">所有的RAID级别中，速度最快；（并发读取和写入）</font><br> 缺点：<strong>无冗余或错误修复能力，无法容忍硬盘损坏。</strong></p> 
<h3><a id="RAID_1_39"></a>RAID 1</h3> 
<pre><code class="prism language-bash">数据镜像（一模一样的备份）
数量：2块及以上的硬盘（偶数）
</code></pre> 
<p>优点：数据在每组磁盘中都有一份，读性能好，一组磁盘损坏，不影响数据访问；<br> 缺点：写性能下降，因为要写双份数据；</p> 
<h3><a id="RAID_5_47"></a>RAID 5</h3> 
<pre><code class="prism language-bash">奇偶校验
数量：3块及以上的硬盘

并发存放
</code></pre> 
<p>优点：能容忍任意坏掉一块盘，奇偶校验恢复 接近 RAID-0 的数据读取速度，具有一定的容灾能力，写速度比RAID-1慢</p> 
<h3><a id="RAID_10_55"></a>RAID 10</h3> 
<pre><code class="prism language-bash">奇偶校验
数量：至少4块
</code></pre> 
<p>优点：更好的性能，更好的可靠性<br> 缺点：成本高，容量小</p> 
<pre><code class="prism language-bash"><span class="token number">1</span>.RAID-0:无容灾，很少单独使用
<span class="token number">2</span>.RAID-1:操作系统-日志文件；
<span class="token number">3</span>.RAID-5：数据文件、备份文件
<span class="token number">4</span>.RAID-10：所有类型都使用，成本影响较大；
</code></pre> 
<h3><a id="_71"></a>磁盘阵列管理</h3> 
<p>需要用到 mdadm 工具</p> 
<pre><code class="prism language-bash"><span class="token function">rpm</span> -qa <span class="token function">mdadm</span>
</code></pre> 
<h4><a id="mdadm__77"></a>mdadm 工具的使用</h4> 
<blockquote> 
 <p>RAID创建步骤</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token number">1</span>. 确认mdama工具已安装；
<span class="token number">2</span>. 添加磁盘（至少2块）；
<span class="token number">3</span>. 进行 分区 和 格式化 （fdisk  ，  mkfs）
<span class="token number">4</span>. 使用 mdada 命令创建管理 RAID  【见下文】
<span class="token number">5</span>. 模拟磁盘坏道的情况
<span class="token number">6</span>. 数据的恢复
</code></pre> 
<h5><a id="RAID_89"></a>创建并管理RAID</h5> 
<pre><code class="prism language-bash"><span class="token comment"># 1. 创立RAID</span>
<span class="token function">mdadm</span> -Cv /dev/md1 -l1 -n2 /dev/sdb1 /dev/sdc1	<span class="token comment">#RAID1 卷</span>
<span class="token function">mdadm</span> -Cv /dev/md5 -l5 -n3 /dev/sdb2 /dev/sdc2 /dev/sdd2	<span class="token comment">#RAID5 卷</span>
<span class="token comment"># 2. 查看RAID</span>
<span class="token function">mdadm</span> -D /dev/md1
<span class="token comment"># 3. 创建配置文件</span>
<span class="token function">mdadm</span> -D -s <span class="token operator">&gt;&gt;</span> /etc/mdadm.conf
<span class="token comment"># 4. 停止RAID</span>
<span class="token function">mdadm</span> -s /dev/md1
<span class="token comment"># 5. 激活RAID</span>
<span class="token function">mdadm</span> -A /dev/md1
</code></pre> 
<p>访问：</p> 
<pre><code class="prism language-bash">
<span class="token function">mkdir</span> /mnt/md1	<span class="token comment">#创建一个挂载点</span>
<span class="token function">mount</span> /dev/md1 /mnt/md1	<span class="token comment">#挂载RAID</span>

<span class="token comment"># 开机自动挂载</span>
<span class="token comment">#将下述信息加入到 /etc/fstab中</span>
<span class="token comment"># /dev/md1	/mnt/md1 auto defaults 0 0</span>
<span class="token comment"># /dev/md5  /mnt/md5 auto defaults 0 0</span>
</code></pre> 
<blockquote> 
 <p>实例</p> 
</blockquote> 
<p>创建一个RAID5的磁盘阵列，要求容量大小为8G，文件系统为ext4，能实现开机自动挂载到 /raid5 目录</p> 
<pre><code class="prism language-bash">
</code></pre> 
<hr> 
<h2><a id="LVM__131"></a>LVM 磁盘管理</h2> 
<p>作用：动态调整磁盘容量。如果 硬件支持 ，可以添加一个硬盘到一个正在运行中的卷组，从而提高磁盘管理的灵活性。</p> 
<h3><a id="__PV_135"></a>物理卷 - PV</h3> 
<pre><code class="prism language-bash"><span class="token number">1</span>. 物理卷 是 LVM　的最基本的　物理　组成部分，可以是整个硬盘也可以是硬盘中的某个分区；
<span class="token number">2</span>. 怎么生成pv：利用　<span class="token function">fdisk</span> 命令把实际的分区转化成为 8e 的系统格式，然后利用 pvcreate 把分区变成能够利用的物理卷
</code></pre> 
<p><img src="https://images2.imgbox.com/c2/70/6HEdQVWN_o.png" alt="物理卷"></p> 
<h3><a id="__VG_141"></a>卷组 - VG</h3> 
<pre><code class="prism language-bash">VG（Volumn Group,卷组）：一个或多个物理卷组合而成的整体。<span class="token punctuation">[</span>逻辑上，非物理上<span class="token punctuation">]</span>
PE：是LVM最小的存储单位，一般大小为 4MB ，是构成 VG 的基本单位
</code></pre> 
<p><img src="https://images2.imgbox.com/af/b1/9Gi1ETrW_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="__LV_149"></a>逻辑卷 - LV</h3> 
<pre><code class="prism language-bash"><span class="token number">1</span>. 逻辑卷：从 卷组<span class="token punctuation">[</span>VG<span class="token punctuation">]</span> 中分割出一块空间，用于建立文件系统
</code></pre> 
<p><img src="https://images2.imgbox.com/09/76/LNDWuiBU_o.png" alt="在这里插入图片描述"></p> 
<p><font color="red"><strong>部署 LVM 需要逐个配置 物理卷、卷组 和 逻辑卷</strong></font></p> 
<table><thead><tr><th>功能</th><th>物理卷pv管理</th><th>卷组VG管理</th><th>逻辑卷lv管理</th></tr></thead><tbody><tr><td>scan - 扫描</td><td>pvscan</td><td>vgscan</td><td>lvscan</td></tr><tr><td><strong>create - 建立</strong></td><td><strong>pvcreate</strong></td><td><strong>vgcreate</strong></td><td><strong>lvcreate</strong></td></tr><tr><td>display - 显示</td><td>pvdisplay</td><td>vgdiaplay</td><td>lvdislay</td></tr><tr><td>remove - 移除</td><td>pvremove</td><td>vgremove</td><td>lvremove</td></tr><tr><td><strong>extend - 扩展</strong></td><td></td><td><strong>vgextend</strong></td><td><strong>lvextend</strong></td></tr><tr><td><strong>reduce - 减少</strong></td><td></td><td><strong>vgreduce</strong></td><td><strong>lvreduce</strong></td></tr></tbody></table> 
<h3><a id="_LVM_166"></a>命令行创建 LVM</h3> 
<pre><code class="prism language-bash"><span class="token comment"># 命令行创建 LVM</span>
<span class="token comment">#1. 创建 物理卷，卷组，逻辑卷,,,首先创建LVM</span>
<span class="token comment">#2. 挂载 逻辑卷LV</span>
<span class="token comment"># 常用命令</span>
pvcreate 物理磁盘/物理磁盘的分区   <span class="token comment">#创建物理卷</span>
vgcreate 卷组名 物理卷1 物理卷2  <span class="token comment">#合并物理卷为 卷组</span>
lvcreate -L 容量大小 -n 逻辑卷名 卷组名  <span class="token comment"># 创建逻辑卷方式一</span>
<span class="token comment"># 或者： lvcreate -l PE个数 -n 逻辑卷名 卷组名   #创建逻辑卷方式二</span>
lvextend -L +容量大小 逻辑卷的绝对路径   <span class="token comment">#合并逻辑卷</span>
lvextend -L 容量大小 逻辑卷的绝对路径   <span class="token comment">#指定逻辑卷，扩展至指定大小</span>
</code></pre> 
<blockquote> 
 <p>创建 逻辑卷 步骤</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token number">1</span>.让物理磁盘支持 LVM 技术：pvcreate 
<span class="token number">2</span>.把pv增加到卷组VG中：vgcreate
<span class="token number">3</span>.创建逻辑卷lv：lvcreate
</code></pre> 
<h3><a id="_LVM__188"></a>调整 LVM 的大小</h3> 
<blockquote> 
 <p>扩大</p> 
</blockquote> 
<p>只要卷组中有足够的资源，就可以一直为逻辑卷扩容<br> 切记：<strong>扩展前，一定要卸载设备和挂载点的关联</strong> umount</p> 
<pre><code class="prism language-bash"><span class="token comment"># 1.扩展</span>
lvextend -L 300M /dev/myvg/mylv
<span class="token comment"># 2.检查硬盘完整性，并重置硬盘容量</span>
e2fsck -f /dev/myvg/mylv
	<span class="token comment">#检查inode、块和大小；检查目录结构；检查目录连接性；检查引用计数；检查组概要信息</span>
<span class="token comment"># 3.重新挂载</span>
<span class="token function">mount</span> 
</code></pre> 
<blockquote> 
 <p>缩小</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token comment">#1.调整文件系统的大小</span>
resize2fs 位置 大小
<span class="token comment">#2.调整lv大小</span>
lvreduce -L 大小 位置
<span class="token comment">#3.重新设置文件系统</span>
<span class="token comment">#4.重新挂载</span>
</code></pre> 
<h3><a id="_215"></a>删除逻辑卷</h3> 
<pre><code class="prism language-bash"><span class="token comment">#删除逻辑卷</span>
lvremove lv_name
<span class="token comment">#删除卷组，可以删除，可以不删除，自己选择</span>
<span class="token comment">#vgremove vg_name</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9f15b4ca95ff3760786f929baf029f39/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux进程管理-实时调度</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/69dd13a2971499c94530ca72de4b815b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于SpringBoot的校园请假管理系统</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>