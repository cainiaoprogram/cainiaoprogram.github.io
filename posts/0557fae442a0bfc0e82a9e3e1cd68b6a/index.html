<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>在Arm服务器上使用jaybedeapi操作oracle数据库 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="在Arm服务器上使用jaybedeapi操作oracle数据库" />
<meta property="og:description" content="在基于arm架构的服务器上，无法使用cx_Oracle，目前使用jaybedeapi成功。
1. 在arm环境的机器上安装jaybedeapi和jpype1，将如下包复制到生产环境下的site-packages下面：
2. 从oracle官网下载ojdbc7.jar并复制到程序所在目录。
3. python程序如下：
host = &#34;&#34; port = &#34;1521&#34; service_name = &#34;&#34; url = f&#39;jdbc:oracle:thin:@//{host}:1521/{service_name}&#39; user = &#39;&#39; password = &#39;&#39; dirver = &#39;oracle.jdbc.driver.OracleDriver&#39; jarFile = &#39;ojdbc7.jar&#39; def run_sql(commandText): connection = jaydebeapi.connect(dirver, url, [user, password], jarFile) cursor = connection.cursor() cursor.execute(commandText) cursor.close() connection.close() return 4. 批量插入
基于jaydebeapi的数据库批量插入方法与基于cx_Oracle的方式不同，尤其是如果oracle数据库中的字段为date格式，处理方式也是不同的。基于cx_Oracle的方式在之前的文章里已经总结过：
https://mp-new.csdn.net/mp_blog/creation/editor/113185783
而基于jaydepeapi的处理代码如下：
def data_output(data, int_cols, dataTable): &#39;&#39;&#39; @Args: data: dataframe to be inserted. int_cols: 整数类型的变量名称 dataTable: 表名称 &#39;&#39;&#39; connection = jaydebeapi." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0557fae442a0bfc0e82a9e3e1cd68b6a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-04T11:11:29+08:00" />
<meta property="article:modified_time" content="2021-06-04T11:11:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">在Arm服务器上使用jaybedeapi操作oracle数据库</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>在基于arm架构的服务器上，无法使用cx_Oracle，目前使用jaybedeapi成功。</p> 
<p>1. 在arm环境的机器上安装jaybedeapi和jpype1，将如下包复制到生产环境下的site-packages下面：</p> 
<p><img alt="" height="161" src="https://images2.imgbox.com/93/3e/6N0wM9EH_o.png" width="307"></p> 
<p>2. 从oracle官网下载ojdbc7.jar并复制到程序所在目录。</p> 
<p> </p> 
<p>3. python程序如下：</p> 
<pre><code>host = ""
port = "1521"
service_name = ""
url = f'jdbc:oracle:thin:@//{host}:1521/{service_name}'
user = ''
password = ''
dirver = 'oracle.jdbc.driver.OracleDriver'
jarFile = 'ojdbc7.jar'

def run_sql(commandText):    
    connection = jaydebeapi.connect(dirver, url, [user, password], jarFile)
    cursor = connection.cursor()  
    cursor.execute(commandText)     
    cursor.close()  
    connection.close()
    return
</code></pre> 
<p>4. 批量插入</p> 
<p>基于jaydebeapi的数据库批量插入方法与基于cx_Oracle的方式不同，尤其是如果oracle数据库中的字段为date格式，处理方式也是不同的。基于cx_Oracle的方式在之前的文章里已经总结过：</p> 
<p><a href="https://mp-new.csdn.net/mp_blog/creation/editor/113185783" rel="nofollow">https://mp-new.csdn.net/mp_blog/creation/editor/113185783</a></p> 
<p>而基于jaydepeapi的处理代码如下：</p> 
<pre><code>def data_output(data, int_cols, dataTable):
    '''
    @Args:
        data: dataframe to be inserted.
        int_cols: 整数类型的变量名称
        dataTable: 表名称
    '''      
    connection = jaydebeapi.connect(dirver, url, [user, password], jarFile)
    cursor = connection.cursor()
    query = "INSERT INTO " + "{} ({})" + " VALUES ({})"
    columns = list(data.columns)
    acols = ','.join(columns)
    aidx = ["to_date(:%s, 'yyyy-mm-dd')" % i if i.find('date')&gt;-1 else ':%s' % i for i in columns]    
    aname = ','.join(aidx)    
    query_fmt = query.format(dataTable, acols, aname)  
    data = data.reset_index(drop=True)
    dtHigh = data.shape[0]
    dtWidth = data.shape[1]
    creatVar = locals()
    wholeData = []
    for i in range(dtHigh):
        value_list = {}
        for j in range(dtWidth):      
            f = columns[j]            
            if f in int_cols:
                value_list.update({f: int(data.loc[i, f])})
            else:
                value_list.update({f: data.loc[i, f]})
        wholeData.append(list(value_list.values()))    
    
    cursor.executemany(query_fmt, wholeData)
    cursor.close()
    connection.close()
    print('***data inserted successfully')
    return</code></pre> 
<p>区别在于executemany的第二个参数，cx_Oracle支持的是dict形式，而jay支持的形式是list格式。</p> 
<p>如果有date变量，需要转成形式insert into table (col1, col2) values (:col1, to_date(:col2, 'yyyy-mm-dd'))的方式传入sql中。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f92f65cddea957cbe7a18ab0a70b8d80/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Java实习生】每日面试题打卡——操作系统篇</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7964f90d70a459a08e1e2a34b596c049/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">leetcode_525_连续数组</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>