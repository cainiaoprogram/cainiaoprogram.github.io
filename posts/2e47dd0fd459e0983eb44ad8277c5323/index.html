<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>编写Android.mk / Android.bp 引用三方 jar 包，aar包，so 库 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="编写Android.mk / Android.bp 引用三方 jar 包，aar包，so 库" />
<meta property="og:description" content="一.前言 在Android10之后，所有项目工程中，官方推荐使用Android.bp去编译构建，以前使用Android.mk构建的项目随着版本迭代升级，慢慢需要变更为Android.bp， 两者的语法都需要去了解并熟练使用。 笔者之前写过Android.mk的语句介绍，里面有介绍每句代码的含义编写Android.mk把Android studio项目编译到AOSP源码中
后来也总结过 Android.bp基本用法： Android.bp 语法和使用 比较基础，也是在项目中运用到了就记录下来。
本篇文章写的是在项目工程中编写Android.mk和 Android.bp 文件，引入第三方的jar包，aar包， so库，引入特许白名单权限xml文件。
二. Android.mk 编写 1. 引入jar包 比如，我们当前目录下的 libs 有okhttp-3.4.11.jar 包，我想引用它
需要两个步骤
第一步， 声明我们 jar 包所在的目录，我的是AndroidStudio工程目录，所以jar包的路径是app/libs/okhttp-3.4.11.jar
LOCAL_PREBUILT_STATIC_JAVA_LIBRARIES := okhttp3:app/libs/okhttp-3.4.11.jar
这行代码的意思大概可以理解成这样，声明一个变量 okhttp3，它的 value 是 app/libs/okhttp-3.4.11.jar
include $(CLEAR_VARS) LOCAL_PREBUILT_STATIC_JAVA_LIBRARIES := okhttp3:app/libs/okhttp-3.4.11.jar \ okio:app/libs/okio-1.9.0.jar include $(BUILD_MULTI_PREBUILT) #这里是多个jar包预编译 第二步. 引用我们声明 jar 包的变量 引用我们上面声明的 okhttp3
LOCAL_STATIC_JAVA_LIBRARIES := okhttp3
LOCAL_STATIC_JAVA_LIBRARIES := okhttp3 \ okio 2. 引入aar包 第一步：先声明 aar 包的位置
include $(CLEAR_VARS) LOCAL_PREBUILT_STATIC_JAVA_LIBRARIES := \ lottie-2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/2e47dd0fd459e0983eb44ad8277c5323/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-28T15:20:11+08:00" />
<meta property="article:modified_time" content="2023-09-28T15:20:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">编写Android.mk / Android.bp 引用三方 jar 包，aar包，so 库</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>一.前言</h3> 
<p>        在Android10之后，所有项目工程中，官方推荐使用Android.bp去编译构建，以前使用Android.mk构建的项目随着版本迭代升级，慢慢需要变更为Android.bp， 两者的语法都需要去了解并熟练使用。 笔者之前写过Android.mk的语句介绍，里面有介绍每句代码的含义<a class="link-info" href="https://blog.csdn.net/u012514113/article/details/124384430" title="编写Android.mk把Android studio项目编译到AOSP源码中">编写Android.mk把Android studio项目编译到AOSP源码中</a></p> 
<p>后来也总结过 Android.bp基本用法： <a class="link-info" href="https://blog.csdn.net/u012514113/article/details/125443131" title="Android.bp 语法和使用">Android.bp 语法和使用</a>   比较基础，也是在项目中运用到了就记录下来。</p> 
<p>本篇文章写的是在项目工程中编写Android.mk和 Android.bp 文件，引入第三方的jar包，aar包， so库，引入特许白名单权限xml文件。</p> 
<h3></h3> 
<p></p> 
<p></p> 
<h3>二. Android.mk 编写</h3> 
<h4>1. 引入jar包</h4> 
<p>比如，我们当前目录下的 libs 有okhttp-3.4.11.jar 包，我想引用它</p> 
<p>需要两个步骤</p> 
<p>第一步， 声明我们 jar 包所在的目录，<span style="color:#fe2c24;">我的是AndroidStudio工程目录，所以jar包的路径是app/libs/okhttp-3.4.11.jar</span></p> 
<p>LOCAL_PREBUILT_STATIC_JAVA_LIBRARIES := okhttp3:app/libs/okhttp-3.4.11.jar</p> 
<p>这行代码的意思大概可以理解成这样，声明一个变量 okhttp3，它的 value 是 app/libs/okhttp-3.4.11.jar</p> 
<pre><code class="language-java">include $(CLEAR_VARS)
LOCAL_PREBUILT_STATIC_JAVA_LIBRARIES := okhttp3:app/libs/okhttp-3.4.11.jar \
                                        okio:app/libs/okio-1.9.0.jar
include $(BUILD_MULTI_PREBUILT)  #这里是多个jar包预编译</code></pre> 
<p>第二步. 引用我们声明 jar 包的变量 引用我们上面声明的 okhttp3</p> 
<p>LOCAL_STATIC_JAVA_LIBRARIES := okhttp3</p> 
<pre><code class="language-java">LOCAL_STATIC_JAVA_LIBRARIES := okhttp3 \
                               okio</code></pre> 
<p></p> 
<p></p> 
<p></p> 
<h4>2. 引入aar包</h4> 
<p>第一步：先声明 aar 包的位置</p> 
<pre><code class="language-bash">include $(CLEAR_VARS)
LOCAL_PREBUILT_STATIC_JAVA_LIBRARIES := \
   lottie-2.8.0:app/libs/lottie-2.8.0.aar
include $(BUILD_MULTI_PREBUILT)</code></pre> 
<p>第二步：引用声明的 aar 变量 lottie-2.8.0</p> 
<pre><code class="language-bash">LOCAL_STATIC_JAVA_AAR_LIBRARIES := lottie-2.8.0</code></pre> 
<p>第三步：添加引用的 aar 包资源</p> 
<pre><code class="language-bash">LOCAL_AAPT_FLAGS := \
  --auto-add-overlay \
  --extra-packages com.airbnb.lottie</code></pre> 
<p></p> 
<p></p> 
<p></p> 
<h4>3. 引入so库</h4> 
<p>假如我们当前目录下的 lib 目录下 有 armeabi-v7a，arm64-v8a 目录，里面分别有 libaes-jni.so， 如果我们在编译 apk 的时候，想把这些 so 库 打包进去，在 mk 文件中要怎样配置呢？</p> 
<p><img alt="" height="232" src="https://images2.imgbox.com/fe/2c/fSHiJn0E_o.png" width="397"></p> 
<p>第一步，直接在 mk 文件中配置以下内容，预编译处理</p> 
<pre><code class="language-java">include $(CLEAR_VARS)
LOCAL_MODULE_TAGS := optional
#后缀
LOCAL_MODULE_SUFFIX := .so
#模块名
LOCAL_MODULE := libaes-jni
#编译到system/libs/目录下
LOCAL_MODULE_CLASS := SHARED_LIBRARIES

#另外一种写法，根据平台arm  arm64 去选择编译对应的so文件
#ifeq ($(strip $(TARGET_ARCH)),arm64)
#LOCAL_SRC_FILES :=app/libs/arm64-v8a/libaes-jni.so
#else ifeq ($(strip $(TARGET_ARCH)),arm)
#LOCAL_SRC_FILES :=app/libs/armeabi-v7a/libaes-jni.so
#endif

#arm arm64都编译
LOCAL_SRC_FILES_arm :=app/libs/armeabi-v7a/libaes-jni.so
LOCAL_SRC_FILES_arm64 :=app/libs/arm64-v8a/libaes-jni.so
LOCAL_MODULE_TARGET_ARCHS:= arm arm64
LOCAL_MULTILIB := both
include $(BUILD_PREBUILT)</code></pre> 
<p>第二步： 引用目标 so 库</p> 
<p>在include $(CLEAR_VARS) 和 include $(BUILD_PACKAGE) 之间添加以下内容</p> 
<pre><code class="language-java">LOCAL_REQUIRED_MODULES := libaes-jni


#如果你写这句话 把这个libaes-jni.so 同时也打包 放在out/target/产品名路径/你的apk具体路径下/lib/#目录中
#LOCAL_JNI_SHARED_LIBRARIES := libaes-jni</code></pre> 
<p></p> 
<p>备注：</p> 
<p>LOCAL_MODULE_CLASS：（prebuilt）标识了所编译模块最后放置的位置，如果不指定，不会放到系统中。<br> LOCAL_MODULE_CLASS := ETC 放于system/etc目录<br> LOCAL_MODULE_CLASS := EXECUTABLES 放于/system/bin目录<br> LOCAL_MODULE_CLASS := SHARED_LIBRARIES 放在/system/lib目录<br> LOCAL_MODULE_CLASS := JAVA_LIBRARIES<br> LOCAL_MODULE_CLASS := STATIC_LIBRARIES<br> LOCAL_MODULE_CLASS := APPS 放在/system/app目录<br>  </p> 
<p>LOCAL_JNI_SHARED_LIBRARIES变量主要是用在JNI的编译中，如果你要在你的Java代码中引用JNI中的共享库*.so，此变量就是共享库的名字。<br> 那么你要注意的一点是：在你的Project根目录下的Android.mk中要定义此变量用来引用你要使用的JNI中的共享库*.so  定义了要包含的so库文件的名字，如果程序没有采用jni，就不需要</p> 
<p><br> LOCAL_JNI_SHARED_LIBRARIES := libxxx    这样在编译的时候，NDK自动会把这个libxxx打包进apk； 放在out/target/产品名路径/你的apk具体路径下/lib/目录中</p> 
<p>LOCAL_REQUIRED_MODULES 指定模块运行所依赖的模块(模块安装时将会同步安装它所依赖的模块)</p> 
<p></p> 
<p></p> 
<h4>4. 引入特许白名单权限xml</h4> 
<p>com.test.mtk.xml 内容：</p> 
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;permissions&gt;
    &lt;privapp-permissions package="com.test.mtk"&gt;
        &lt;permission name="android.permission.MASTER_CLEAR" /&gt;
    &lt;/privapp-permissions&gt;
&lt;/permissions&gt;</code></pre> 
<p>第一步：预编译处理</p> 
<pre><code class="language-bash">
######预编译priv-app 权限，输出路径为system/etc/permissions###########
# Permissions pre-grant
include $(CLEAR_VARS)
LOCAL_MODULE := com.test.mtk.xml
LOCAL_MODULE_CLASS := ETC
LOCAL_MODULE_PATH := $(TARGET_OUT_ETC)/permissions
LOCAL_SRC_FILES := $(LOCAL_MODULE)
include $(BUILD_PREBUILT)
</code></pre> 
<p>第二步：指定app运行所依赖的模块</p> 
<pre><code class="language-bash">
######编译priv-app 权限到apk中###########
LOCAL_REQUIRED_MODULES := com.test.mtk.xml
</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/76b5a200ad74e0375ee82611b62f2e34/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【C语言_printf()】教你如何使用printf()，格式化输出</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/132ad8e234f204b6afaef97119b71622/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">利用bat脚本 一键将文件中的png图片转为 jpg图片</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>