<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>嵌入式硬件通信接口协议-IIC（一）协议基础 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="嵌入式硬件通信接口协议-IIC（一）协议基础" />
<meta property="og:description" content="文章首发于同名微信公众号：DigCore
欢迎关注同名微信公众号：DigCore，及时获取最新技术博文。
原文链接：https://mp.weixin.qq.com/s/zJ7cnuxMzESSDnan3Izmkw
本节继续讲嵌入式硬件通信接口协议中的又一个串行通信接口-IIC。相比于UART串口协议和SPI串行外设接口协议，这个IIC又有其独特之处。
简介
IIC（Inter-Integrated Circuit），集成电路总线。
IIC 即Inter-IntegratedCircuit(集成电路总线），这种总线类型是由飞利浦半导体公司在八十年代初设计出来的一种简单、双向、二线制、同步串行总线，主要是用来连接整体电路(ICS) ，IIC是一种多向控制总线，也就是说多个芯片可以连接到同一总线结构下，同时每个芯片都可以作为实时数据传输的控制源。这种方式简化了信号传输总线接口。
--from 百度百科
https://baike.baidu.com/item/iic/3524834
相比于SPI接口《嵌入式硬件通信接口协议-SPI（一）协议基础》，此处的IIC接口定义了多主多从的通信架构，在同一IIC总线上可有多个主机和多个从机。“主-&gt;从”的通信架构使得通信的主动权在主机端，主机发起一次通信，从机做出响应。
信号线
IIC作为两线串行总线，信号线分别是：
SCL（Serial ClockLine）：串行时钟，主机输出
SDA（Serial DataLine）：串行数据，双向传输
总线信号的电平在电路连接上，一般加上拉电阻Rp，使得总线在空闲时，信号管脚处于高电平状态。
这里可以具体到一些芯片的手册里，明确写出线路连接时的上拉电阻要求：
SHT20温湿度传感器要求的上拉电阻：
在触摸按键BS116A-3芯片数据手册中：
信号时序
IIC作为同步串行总线，可以认为有两个同步信号，第一个是通信起始、结束标志，告知挂在IIC总线上的从机设备，何时开始通信并且何时结束；第二个是同步时钟信号SCL，收发双方进行数据的交互时，都是基于SCL的跳变进行逐bit输出和采样的。
起始标志
处于空闲状态下时，SCL和SDA都是高电平，某一时刻，SDA拉低，则此刻认为开始IIC传输。
结束标志
即将完成数据传输时，在SCL处于高电平时，将SDA强制拉高，则此刻认为结束IIC传输。
数据输出
在SCL为低电平时，发送方根据传输的数据内容逐bit改变SDA的电平。
数据采样
在SCL为高电平时，接收方读取SDA的电平逐bit接收，并逐8个bit组成1个Byte。
应答ACK
ACK表示在8bit数据后的第9个时钟的高电平期间，SDA保持低电平。
应答NACK
NACK表示在8bit数据后的第9个时钟的高电平期间，SDA保持高电平。
关于理解和记忆，推荐分组记忆：
SCL高电平时，SDA拉低开始，SDA拉高结束；
SCL高电平时，接收方采样SDA管脚电平；SCL低电平时，发送方改变SDA管脚电平；
应答位，SDA低电平表示ACK，SDA高电平表示NACK。
以上就是IIC在通信过程中，可能出现的信号时序状态特征。
如果要和SPI接口对比，我们发现，在IIC总线上挂了多个从设备，某个时刻某个主机要与某个从设备通信时，却不像SPI那样有单独一个片选信号管脚SS。
那么IIC要实现主机与指定从机的通信，需要每次开始通信时，主机会先把指定从机设备的地址通过接口发出，这样一来，对应的从机设备即可被选中，才能进行后续的通信操作。
类似的，每个具有IIC接口的外围器件，其数据手册中都有关于地址的配置：
SHT20温湿度芯片地址配置：
BS116-3触摸芯片地址配置：
AT24C1024B存储芯片：
我们发现，IIC设备的地址普遍是7bit，而发送一次数据都是一个字节8bit地发送，所以要发送地址时，都会带上读写位，组成一个字节后发出。
读写位的意义，主要在于明确IIC从机设备，在被主机“点名”后，接下来是被主机读取还是被主机写入，靠的就是这个读写位来判断。
另外，类似于AT24C1024B存储芯片，在7bit的地址位里，又有3个bit的A2、A1、A0可以在硬件电路上选择不同的连接方式，从而又有8种不同的从机地址，也就是说同个IIC总线上可以挂同种型号的AT24C1024B存储芯片8片。
接口配置项
相比于SPI接口丰富的配置项，然而IIC仅有2根数据线，可配置的也就是时钟SCL的翻转速率，因为这个时钟的速率直接影响到数据的传输速率。
这里所配置的推荐值，应该确认IIC总线上各个从机设备的速率极限，这样在设计IIC接口时，能够兼容总线上的所有设备通信速率。
SHT20温湿度传感器： BS116-3触摸芯片时钟极限： AT24C1024B存储芯片的时钟要求： 综上所述，IIC总线接口，属于两线、多主多从、半双工通信接口协议。熟悉两根信号线的时序图，基本上对IIC的了解就差不多了。
关于IIC接口的分层架构设计，敬请期待后续更新。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/8966412dcee0074f2a9a3b3f9213166a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-03-05T17:55:18+08:00" />
<meta property="article:modified_time" content="2019-03-05T17:55:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">嵌入式硬件通信接口协议-IIC（一）协议基础</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>文章首发于同名微信公众号：<span style="color:#f33b45;"><strong>DigCore</strong></span></p> 
<p>欢迎关注同名微信公众号：<span style="color:#f33b45;"><strong>DigCore</strong></span>，及时获取最新技术博文。</p> 
<p>原文链接：<a href="https://mp.weixin.qq.com/s/zJ7cnuxMzESSDnan3Izmkw" rel="nofollow">https://mp.weixin.qq.com/s/zJ7cnuxMzESSDnan3Izmkw</a></p> 
<p> </p> 
<p> </p> 
<p>本节继续讲嵌入式硬件通信接口协议中的又一个串行通信接口-IIC。相比于UART串口协议和SPI串行外设接口协议，这个IIC又有其独特之处。</p> 
<p> </p> 
<ul><li> <p><strong>简介</strong></p> </li></ul> 
<p> </p> 
<p>IIC（Inter-Integrated Circuit），集成电路总线。</p> 
<p> </p> 
<blockquote> 
 <p>IIC 即Inter-IntegratedCircuit(集成电路总线），这种总线类型是由<em>飞利浦</em>半导体公司在八十年代初设计出来的一种简单、双向、二线制、同步串行总线，主要是用来连接整体电路(ICS) ，IIC是一种多向<em>控制总线</em>，也就是说多个芯片可以连接到同一总线结构下，同时每个芯片都可以作为实时数据传输的控制源。这种方式简化了信号传输总线接口。</p> 
 <p>--from 百度百科</p> 
 <p><em>https://baike.baidu.com/item/iic/3524834</em></p> 
</blockquote> 
<p> </p> 
<p>相比于SPI接口《<a href="https://mp.weixin.qq.com/s?__biz=MzI1MzgwMTM4Ng==&amp;mid=2247483937&amp;idx=1&amp;sn=99481034b3444a76575e624da3c81eb2&amp;scene=21#wechat_redirect" rel="nofollow">嵌入式硬件通信接口协议-SPI（一）协议基础</a>》，此处的IIC接口定义了多主多从的通信架构，在同一IIC总线上可有多个主机和多个从机。“主-&gt;从”的通信架构使得通信的主动权在主机端，主机发起一次通信，从机做出响应。</p> 
<p> </p> 
<ul><li> <p><strong>信号线</strong></p> </li></ul> 
<p>IIC作为两线串行总线，信号线分别是：</p> 
<p>SCL（Serial ClockLine）：串行时钟，主机输出</p> 
<p>SDA（Serial DataLine）：串行数据，双向传输</p> 
<p> </p> 
<p><strong>总线信号的电平在电路连接上，一般加上拉电阻Rp，使得总线在空闲时，信号管脚处于高电平状态。</strong></p> 
<p> </p> 
<p>这里可以具体到一些芯片的手册里，明确写出线路连接时的上拉电阻要求：</p> 
<p> </p> 
<p>SHT20温湿度传感器要求的上拉电阻：</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/28/d0/SN4hmBU0_o.jpg"></p> 
<p> </p> 
<p>在触摸按键BS116A-3芯片数据手册中：</p> 
<p> </p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/7f/e4/MNAIvGhS_o.jpg"></p> 
<p> </p> 
<p> </p> 
<ul><li> <p><strong>信号时序</strong></p> </li></ul> 
<p>IIC作为同步串行总线，可以认为有两个同步信号，第一个是通信起始、结束标志，告知挂在IIC总线上的从机设备，何时开始通信并且何时结束；第二个是同步时钟信号SCL，收发双方进行数据的交互时，都是基于SCL的跳变进行逐bit输出和采样的。</p> 
<p> </p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/73/1c/Zx6bDp4z_o.jpg"></p> 
<p> </p> 
<ul><li> <p><strong>起始标志</strong></p> </li></ul> 
<p>处于空闲状态下时，SCL和SDA都是高电平，某一时刻，SDA拉低，则此刻认为开始IIC传输。</p> 
<ul><li> <p><strong>结束标志</strong></p> </li></ul> 
<p>即将完成数据传输时，在SCL处于高电平时，将SDA强制拉高，则此刻认为结束IIC传输。</p> 
<ul><li> <p><strong>数据输出</strong></p> </li></ul> 
<p>在SCL为低电平时，发送方根据传输的数据内容逐bit改变SDA的电平。</p> 
<ul><li> <p><strong>数据采样</strong></p> </li></ul> 
<p>在SCL为高电平时，接收方读取SDA的电平逐bit接收，并逐8个bit组成1个Byte。</p> 
<ul><li> <p><strong>应答ACK</strong></p> </li></ul> 
<p>ACK表示在8bit数据后的第9个时钟的高电平期间，SDA保持低电平。</p> 
<ul><li> <p><strong>应答NACK</strong></p> </li></ul> 
<p>NACK表示在8bit数据后的第9个时钟的高电平期间，SDA保持高电平。</p> 
<p> </p> 
<p>关于理解和记忆，推荐分组记忆：</p> 
<blockquote> 
 <p>SCL高电平时，SDA拉低开始，SDA拉高结束；</p> 
 <p>SCL高电平时，接收方采样SDA管脚电平；SCL低电平时，发送方改变SDA管脚电平；</p> 
 <p>应答位，SDA低电平表示ACK，SDA高电平表示NACK。</p> 
</blockquote> 
<p> </p> 
<p>以上就是IIC在通信过程中，可能出现的信号时序状态特征。</p> 
<p> </p> 
<p>如果要和SPI接口对比，我们发现，在IIC总线上挂了多个从设备，某个时刻某个主机要与某个从设备通信时，却不像SPI那样有单独一个片选信号管脚SS。</p> 
<p> </p> 
<p>那么IIC要实现主机与指定从机的通信，需要每次开始通信时，主机会先把指定从机设备的地址通过接口发出，这样一来，对应的从机设备即可被选中，才能进行后续的通信操作。</p> 
<p> </p> 
<p>类似的，每个具有IIC接口的外围器件，其数据手册中都有关于地址的配置：</p> 
<p> </p> 
<p>SHT20温湿度芯片地址配置：</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/8e/4a/3nwsmzJE_o.jpg"></p> 
<p>BS116-3触摸芯片地址配置：</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/67/fd/NInVownK_o.jpg"></p> 
<p>AT24C1024B存储芯片：</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/27/c4/SaQp5f18_o.jpg"></p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/03/ab/JFFqTwe4_o.jpg"></p> 
<p> </p> 
<p>我们发现，IIC设备的地址普遍是<strong>7bit</strong>，而发送一次数据都是一个字节<strong>8bit</strong>地发送，所以要发送地址时，都会带上读写位，组成一个字节后发出。</p> 
<p> </p> 
<p><strong>读写位的意义，主要在于明确IIC从机设备，在被主机“点名”后，接下来是被主机读取还是被主机写入，靠的就是这个读写位来判断。</strong></p> 
<p> </p> 
<p><em>另外，类似于AT24C1024B存储芯片，在7bit的地址位里，又有3个bit的A2、A1、A0可以在硬件电路上选择不同的连接方式，从而又有8种不同的从机地址，也就是说同个IIC总线上可以挂同种型号的AT24C1024B存储芯片8片。</em></p> 
<p> </p> 
<ul><li> <p><strong>接口配置项</strong></p> </li></ul> 
<p>相比于SPI接口丰富的配置项，然而IIC仅有2根数据线，可配置的也就是时钟SCL的翻转速率，因为这个时钟的速率直接影响到数据的传输速率。</p> 
<p> </p> 
<p>这里所配置的推荐值，应该确认IIC总线上各个从机设备的速率极限，这样在设计IIC接口时，能够兼容总线上的所有设备通信速率。</p> 
<p> </p> 
<p>SHT20温湿度传感器： </p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/df/84/EgyqzKKZ_o.jpg"></p> 
<p> </p> 
<p>BS116-3触摸芯片时钟极限： </p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/56/d2/CLIV4DFH_o.jpg"></p> 
<p>AT24C1024B存储芯片的时钟要求： </p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/3e/66/RQDhdgGX_o.jpg"></p> 
<p>综上所述，IIC总线接口，属于两线、多主多从、半双工通信接口协议。熟悉两根信号线的时序图，基本上对IIC的了解就差不多了。</p> 
<p> </p> 
<p>关于IIC接口的分层架构设计，敬请期待后续更新。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c16b1f786791da3ce2e038dcbaaa3778/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【嵌入式编程】函数返回类型设计</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6f702b49a32b6cfb4d7564d09c273c69/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Unity 之 Application各种路径在终端的本地路径</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>