<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>无人机操作系统 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="无人机操作系统" />
<meta property="og:description" content="主流飞控的嵌入式实时内核依据软件架构、接口标准、兼容性等划分为两大类：类Unix如NuttX等，微内核类如FreeRTOS和uCOSii等。
实时主要是指具备高优先级任务抢占低优先级任务的能力，调度延迟以系统时钟量级来计。
类Unix、微核本质是调度器，由一些线性数据结构实现对任务线程的管理。而ROS本质是多进程Socket通信中间件。
类Unix操作系统
PC端Unix操作系统启动之后呈现出进程树和文件系统树，进程树表达所有进程之间都具有亲缘关系，而文件系统树表达文件系统路径之间的挂载关系。
NuttX是类Unix嵌入式实时操作系统，因为处理器架构不同，又限于资源压力，相比于Linux，它对机制实现做了一些简化。NuttX支持8bit到64bit微处理器环境，支持POSIX/ANSI标准的任务控制、命名管道、计数信号量、信号、互斥量以及文件系统等机制，下面是NuttX架构图
NuttX支持用户线程和内核线程，而不具有Linux意义下的进程概念。取而代之的是NuttX线程组，包括一个主任务线程和由主线程创建的pthreads，线程组线程彼此共享资源如环境变量、文件描述符、文件流、sockets等。
NuttX上有task的概念，task是一种特殊的pthread，和pthread资源共享程度相比，task有一定独立度。对于线程/任务控制，NuttX提供了VxWorks与POSIX风格的API，实现最大程度兼容性。对于内核线程，他们相比于用户态有内核资源访问权限。
NuttX按照优先级调度，高优任务在阻塞之前独占CPU，同优先级任务按先来先调度顺序执行，NuttX任务或线程可以通过选项配置round-robin或sporadic方式调度。
除了线程与任务之外，NuttX还有一种任务执行方案，work queue。
work queue是一系列需要执行的工作加入到队列中，由一些线程来消费执行。NuttX支持三种类型work queue：
（1）高优内核work queue
一般用于处理中断句柄中的延迟任务，也可用于驱动底层处理工作，因为这些任务通常是高优快速运行的；
（2）低优内核work queue
低优先级工作队列更适合于处理面向应用层的工作，比如文件系统清理，内存垃圾回收，异步IO操作等；
（3）用户模式work queue
面向应用层，但是访问内核资源需要系统调用增加开销，用户自行结合实际情况选取。
在任务同步、通信，资源互斥保护方面，NuttX支持命名管道，计数信号量，信号，共享内存等。父子关系的线程或任务之间可以用waitpid等同步，非父子关系可以用其他如命名管道等方式做同步，PX4中的uORB就是基于命名管道实现的，命名管道支持POSIX标准文件系统操作。
NuttX接口上对外暴露Open、Close、Read、Write、Ioctl以及Poll，如设备驱动，命名管道。
NuttX伪根文件系统是全内存的，其他或真实文件系统可以挂载到根下。
NuttX设备驱动包括字符设备驱动，如常见串口驱动，模数驱动，PWM驱动，CAN驱动，正交编码器，定时器驱动，RTC驱动，FOC（Field Oriented Control）控制交流电机驱动等。除了最常见的字符设备驱动之外，还有以块为单位读写访问的字符设备驱动以及一些特殊设备驱动：SYSLOG，RAM LOG等。PX4中传感器驱动是对字符设备的进一步开发，放在PX4-Autopilot\src\drivers路径中。
微内核
与类Unix相比，微核的调度、通信等机制都是独立实现，不遵守接口标准，因此更轻量。相比于裸机编程，使用微内核，业务被模块化,架构更清楚，开发者对调度和通信的实现无需过多关注。微内核代表产品包括FreeRTOS、uCOSii，以及国产RT-thread，以FreeRTOS为例介绍。
FreeRTOS支持消息队列，用于任务间通信，本质是一段对各个任务可见的共享内存。也支持二值信号量（或互斥信号量）做资源互斥保护以及多值信号量做同步。
对中断的响应和处理也是嵌入式编程需要关注的一个特性，在FreeRTOS中，中断事件可以与常规task进行通信和同步。此外，微核支持临界区来关闭调度和中断，临界区逻辑需要尽可能短小，以保证实时性。
内存管理方面，与NuttX一样，对于没有MMU的STM32F4处理器， TCB(Task Control Block)与各自的栈链表形式保存在扁平内存中。
对于类Unix和微核，没有明显程序运行效率上差别。
类Unix操作系统遵守协议标准，对Linux特性熟悉的可以很容易上手开发，同时可以使用KConfig剪裁配置系统功能；
微核优势在于轻量级，系统代码占用几K空间，比较受到国内MCU开发者青睐。
欢迎关注公众号“我想我思”" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b6186af3977176b08bba0025845bd10c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-07T10:35:21+08:00" />
<meta property="article:modified_time" content="2023-09-07T10:35:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">无人机操作系统</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>主流飞控的嵌入式实时内核依据软件架构、接口标准、兼容性等划分为两大类：类Unix如NuttX等，微内核类如FreeRTOS和uCOSii等。</p> 
<p>实时主要是指具备高优先级任务抢占低优先级任务的能力，调度延迟以系统时钟量级来计。</p> 
<p>类Unix、微核本质是调度器，由一些线性数据结构实现对任务线程的管理。而ROS本质是多进程Socket通信中间件。</p> 
<p><strong>类Unix操作系统</strong></p> 
<p>PC端Unix操作系统启动之后呈现出进程树和文件系统树，进程树表达所有进程之间都具有亲缘关系，而文件系统树表达文件系统路径之间的挂载关系。</p> 
<p>NuttX是类Unix嵌入式实时操作系统，因为处理器架构不同，又限于资源压力，相比于Linux，它对机制实现做了一些简化。NuttX支持8bit到64bit微处理器环境，支持POSIX/ANSI标准的任务控制、命名管道、计数信号量、信号、互斥量以及文件系统等机制，下面是NuttX架构图</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="488" src="https://images2.imgbox.com/2e/48/lygXv0fC_o.jpg" width="385"></p> 
<p>NuttX支持用户线程和内核线程，而不具有Linux意义下的进程概念。取而代之的是NuttX线程组，包括一个主任务线程和由主线程创建的pthreads，线程组线程彼此共享资源如环境变量、文件描述符、文件流、sockets等。</p> 
<p>NuttX上有task的概念，task是一种特殊的pthread，和pthread资源共享程度相比，task有一定独立度。对于线程/任务控制，NuttX提供了VxWorks与POSIX风格的API，实现最大程度兼容性。对于内核线程，他们相比于用户态有内核资源访问权限。</p> 
<p>NuttX按照优先级调度，高优任务在阻塞之前独占CPU，同优先级任务按先来先调度顺序执行，NuttX任务或线程可以通过选项配置round-robin或sporadic方式调度。</p> 
<p>除了线程与任务之外，NuttX还有一种任务执行方案，work queue。</p> 
<p>work queue是一系列需要执行的工作加入到队列中，由一些线程来消费执行。NuttX支持三种类型work queue：</p> 
<p>（1）高优内核work queue</p> 
<p>一般用于处理中断句柄中的延迟任务，也可用于驱动底层处理工作，因为这些任务通常是高优快速运行的；</p> 
<p>（2）低优内核work queue</p> 
<p>低优先级工作队列更适合于处理面向应用层的工作，比如文件系统清理，内存垃圾回收，异步IO操作等；</p> 
<p>（3）用户模式work queue</p> 
<p>面向应用层，但是访问内核资源需要系统调用增加开销，用户自行结合实际情况选取。</p> 
<p>在任务同步、通信，资源互斥保护方面，NuttX支持命名管道，计数信号量，信号，共享内存等。父子关系的线程或任务之间可以用waitpid等同步，非父子关系可以用其他如命名管道等方式做同步，PX4中的uORB就是基于命名管道实现的，命名管道支持POSIX标准文件系统操作。</p> 
<p>NuttX接口上对外暴露Open、Close、Read、Write、Ioctl以及Poll，如设备驱动，命名管道。</p> 
<p>NuttX伪根文件系统是全内存的，其他或真实文件系统可以挂载到根下。</p> 
<p>NuttX设备驱动包括字符设备驱动，如常见串口驱动，模数驱动，PWM驱动，CAN驱动，正交编码器，定时器驱动，RTC驱动，FOC（Field Oriented Control）控制交流电机驱动等。除了最常见的字符设备驱动之外，还有以块为单位读写访问的字符设备驱动以及一些特殊设备驱动：SYSLOG，RAM LOG等。PX4中传感器驱动是对字符设备的进一步开发，放在PX4-Autopilot\src\drivers路径中。</p> 
<p><strong>微内核</strong></p> 
<p>与类Unix相比，微核的调度、通信等机制都是独立实现，不遵守接口标准，因此更轻量。相比于裸机编程，使用微内核，业务被模块化,架构更清楚，开发者对调度和通信的实现无需过多关注。微内核代表产品包括FreeRTOS、uCOSii，以及国产RT-thread，以FreeRTOS为例介绍。</p> 
<p>FreeRTOS支持消息队列，用于任务间通信，本质是一段对各个任务可见的共享内存。也支持二值信号量（或互斥信号量）做资源互斥保护以及多值信号量做同步。</p> 
<p>对中断的响应和处理也是嵌入式编程需要关注的一个特性，在FreeRTOS中，中断事件可以与常规task进行通信和同步。此外，微核支持临界区来关闭调度和中断，临界区逻辑需要尽可能短小，以保证实时性。</p> 
<p>内存管理方面，与NuttX一样，对于没有MMU的STM32F4处理器， TCB(Task Control Block)与各自的栈链表形式保存在扁平内存中。</p> 
<p>对于类Unix和微核，没有明显程序运行效率上差别。</p> 
<p>类Unix操作系统遵守协议标准，对Linux特性熟悉的可以很容易上手开发，同时可以使用KConfig剪裁配置系统功能；</p> 
<p>微核优势在于轻量级，系统代码占用几K空间，比较受到国内MCU开发者青睐。</p> 
<p><strong>欢迎关注公众号“我想我思”</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dee59cd45db648fb4b41507eef4a6499/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Typora使用技巧 | 各种跳转 【必备】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/887170dd29d05ea447fe8afb8d9b79eb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">当在PyCharm控制台中遇到中文乱码问题时，如何解决？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>