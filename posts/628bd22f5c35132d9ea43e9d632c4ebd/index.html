<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>å¤§æ•°æ®é¡¹ç›®åˆ†äº« - æ·±åº¦å­¦ä¹  å¤§æ•°æ® è‚¡ç¥¨é¢„æµ‹ç³»ç»Ÿ - python lstm - èœé¸Ÿç¨‹åºå‘˜åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="å¤§æ•°æ®é¡¹ç›®åˆ†äº« - æ·±åº¦å­¦ä¹  å¤§æ•°æ® è‚¡ç¥¨é¢„æµ‹ç³»ç»Ÿ - python lstm" />
<meta property="og:description" content="æ–‡ç« ç›®å½• 0 å‰è¨€1 è¯¾é¢˜æ„ä¹‰1.1 è‚¡ç¥¨é¢„æµ‹ä¸»æµæ–¹æ³• 2 ä»€ä¹ˆæ˜¯LSTM2.1 å¾ªç¯ç¥ç»ç½‘ç»œ2.1 LSTMè¯ç”Ÿ 2 å¦‚ä½•ç”¨LSTMåšè‚¡ç¥¨é¢„æµ‹2.1 ç®—æ³•æ„å»ºæµç¨‹2.2 éƒ¨åˆ†ä»£ç  3 å®ç°æ•ˆæœ3.1 æ•°æ®3.2 é¢„æµ‹ç»“æœé¡¹ç›®è¿è¡Œå±•ç¤ºå¼€å‘ç¯å¢ƒæ•°æ®è·å– 0 å‰è¨€ ğŸ”¥ è¿™ä¸¤å¹´å¼€å§‹æ¯•ä¸šè®¾è®¡å’Œæ¯•ä¸šç­”è¾©çš„è¦æ±‚å’Œéš¾åº¦ä¸æ–­æå‡ï¼Œä¼ ç»Ÿçš„æ¯•è®¾é¢˜ç›®ç¼ºå°‘åˆ›æ–°å’Œäº®ç‚¹ï¼Œå¾€å¾€è¾¾ä¸åˆ°æ¯•ä¸šç­”è¾©çš„è¦æ±‚ï¼Œè¿™ä¸¤å¹´ä¸æ–­æœ‰å­¦å¼Ÿå­¦å¦¹å‘Šè¯‰å­¦é•¿è‡ªå·±åšçš„é¡¹ç›®ç³»ç»Ÿè¾¾ä¸åˆ°è€å¸ˆçš„è¦æ±‚ã€‚
ä¸ºäº†å¤§å®¶èƒ½å¤Ÿé¡ºåˆ©ä»¥åŠæœ€å°‘çš„ç²¾åŠ›é€šè¿‡æ¯•è®¾ï¼Œå­¦é•¿åˆ†äº«ä¼˜è´¨æ¯•ä¸šè®¾è®¡é¡¹ç›®ï¼Œä»Šå¤©è¦åˆ†äº«çš„æ˜¯
ğŸš© æ·±åº¦å­¦ä¹  å¤§æ•°æ® è‚¡ç¥¨é¢„æµ‹ç³»ç»Ÿ
ğŸ¥‡å­¦é•¿è¿™é‡Œç»™ä¸€ä¸ªé¢˜ç›®ç»¼åˆè¯„åˆ†(æ¯é¡¹æ»¡åˆ†5åˆ†)
éš¾åº¦ç³»æ•°ï¼š3åˆ†å·¥ä½œé‡ï¼š3åˆ†åˆ›æ–°ç‚¹ï¼š4åˆ† ğŸ§¿ é€‰é¢˜æŒ‡å¯¼, é¡¹ç›®åˆ†äº«ï¼š
https://gitee.com/yaa-dc/warehouse-1/blob/master/python/README.md
1 è¯¾é¢˜æ„ä¹‰ åˆ©ç”¨ç¥ç»ç½‘ç»œæ¨¡å‹å¦‚æœèƒ½å¤Ÿæé«˜å¯¹è‚¡ç¥¨ä»·æ ¼çš„é¢„æµ‹ç²¾åº¦ï¼Œæ›´å¥½åœ°æŒæ¡è‚¡ç¥¨ä»·æ ¼å‘å±•è¶‹åŠ¿ï¼Œè¿™å¯¹äºæŠ•èµ„è€…æ¥è¯´å¯ä»¥åŠæ—¶åˆ¶å®šç›¸åº”çš„å‘å±•ç­–ç•¥ï¼Œæ›´å¥½åœ°åº”å¯¹æœªæ¥å‘ç”Ÿçš„ä¸ç¡®å®šæ€§äº‹ä»¶ï¼Œå¯¹äºä¸ªäººæ¥è¯´å¯ä»¥é™ä½æŠ•èµ„é£é™©ï¼Œå‡å°‘è´¢äº§æŸå¤±ï¼Œå®ç°é«˜æ•ˆæŠ•èµ„ï¼Œå…·æœ‰ä¸€å®šçš„å®è·µä»·å€¼ã€‚
1.1 è‚¡ç¥¨é¢„æµ‹ä¸»æµæ–¹æ³• è‚¡ç¥¨å¸‚åœºå¤æ‚ã€éçº¿æ€§çš„ç‰¹ç‚¹ä½¿æˆ‘ä»¬éš¾ä»¥æ‰æ‘¸å…¶å˜åŒ–è§„å¾‹ï¼Œç›®å‰æœ‰å¾ˆå¤šé¢„æµ‹è‚¡ç¥¨èµ°åŠ¿çš„è®ºæ–‡å’Œç®—æ³•ã€‚
å®šé‡åˆ†æä»ç²¾ç¡®çš„æ•°æ®èµ„æ–™ä¸­è·å¾—è‚¡ç¥¨å‘å±•çš„ä»·å€¼è§„å¾‹ï¼Œé€šè¿‡å»ºç«‹æ¨¡å‹åˆ©ç”¨æ•°å­¦è¯­è¨€å¯¹è‚¡å¸‚çš„å‘å±•æƒ…å†µåšå‡ºè§£é‡Šä¸é¢„æµ‹ã€‚
ç›®å‰å¸¸ç”¨çš„å®šé‡åˆ†ææ–¹æ³•æœ‰ï¼š
ä¼ ç»Ÿæ—¶é—´åºåˆ—é¢„æµ‹æ¨¡å‹é©¬å°”å¯å¤«é“¾é¢„æµ‹ç°è‰²ç³»ç»Ÿç†è®ºé¢„æµ‹é—ä¼ ç®—æ³•æœºå™¨å­¦ä¹ é¢„æµ‹ç­‰æ–¹æ³• 2 ä»€ä¹ˆæ˜¯LSTM LSTMæ˜¯é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLSTMï¼ŒLong Short-Term Memoryï¼‰ï¼Œæƒ³è¦ç†è§£ä»€ä¹ˆæ˜¯LSTMï¼Œé¦–å…ˆè¦äº†è§£ä»€ä¹ˆæ˜¯å¾ªç¯ç¥ç»ç½‘ç»œã€‚
2.1 å¾ªç¯ç¥ç»ç½‘ç»œ å¯¹äºä¼ ç»Ÿçš„BPç¥ç»ç½‘ç»œå¦‚æ·±åº¦å‰é¦ˆç½‘ç»œã€å·ç§¯ç¥ç»ç½‘ç»œæ¥è¯´ï¼ŒåŒå±‚åŠè·¨å±‚ä¹‹é—´çš„ç¥ç»å…ƒæ˜¯ç‹¬ç«‹çš„ï¼Œä½†å®é™…åº”ç”¨ä¸­å¯¹äºä¸€äº›æœ‰ä¸Šä¸‹è”ç³»çš„åºåˆ—æ¥è¯´ï¼Œå¦‚æœèƒ½å¤Ÿå­¦ä¹ åˆ°å®ƒä»¬ä¹‹é—´çš„ç›¸äº’å…³ç³»ï¼Œä½¿ç½‘ç»œèƒ½å¤Ÿå¯¹ä¸åŒæ—¶åˆ»çš„è¾“å…¥åºåˆ—äº§ç”Ÿä¸€å®šçš„è”ç³»ï¼Œåƒç”Ÿç‰©çš„å¤§è„‘ä¸€æ ·æœ‰â€œè®°å¿†åŠŸèƒ½â€ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬çš„æ¨¡å‹ä¹Ÿå°±ä¼šæœ‰æ›´ä½çš„è®­ç»ƒå‡ºé”™é¢‘ç‡åŠæ›´å¥½çš„æ³›åŒ–èƒ½åŠ›ã€‚
JordanMIæå‡ºåºåˆ—ç†è®ºï¼Œæè¿°äº†ä¸€ç§ä½“ç°â€œå¹¶è¡Œåˆ†å¸ƒå¼å¤„ç†â€çš„ç½‘ç»œåŠ¨æ€ç³»ç»Ÿï¼Œé€‚ç”¨äºè¯­éŸ³ç”Ÿæˆä¸­çš„ååŒå‘éŸ³é—®é¢˜ï¼Œå¹¶è¿›è¡Œäº†ç›¸å…³ä»¿çœŸå®éªŒï¼ŒElmanJLè®¤ä¸ºè¿æ¥ä¸»ä¹‰æ¨¡å‹ä¸­å¯¹æ—¶é—´å¦‚ä½•è¡¨ç¤ºæ˜¯è‡³å…³é‡è¦çš„ï¼Œ1990å¹´ä»–æå‡ºä½¿ç”¨å¾ªç¯è¿æ¥ä¸ºç½‘ç»œæä¾›åŠ¨æ€å†…å­˜ï¼Œä»ç›¸å¯¹ç®€å•çš„å¼‚æˆ–é—®é¢˜åˆ°æ¢å¯»å•è¯çš„è¯­ä¹‰ç‰¹å¾ï¼Œç½‘ç»œå‡å­¦ä¹ åˆ°äº†æœ‰è¶£çš„å†…éƒ¨è¡¨ç¤ºï¼Œç½‘ç»œè¿˜å°†ä»»åŠ¡éœ€æ±‚å’Œå†…å­˜éœ€æ±‚ç»“åˆåœ¨ä¸€èµ·ï¼Œç”±æ­¤å½¢æˆäº†ç®€å•å¾ªç¯ç½‘ç»œçš„åŸºç¡€æ¡†æ¶ã€‚
å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰ä¹‹é—´çš„ç¥ç»å…ƒæ˜¯ç›¸äº’è¿æ¥çš„ï¼Œä¸ä»…åœ¨å±‚ä¸å±‚ä¹‹é—´çš„ç¥ç»å…ƒå»ºç«‹è¿æ¥ï¼Œè€Œä¸”æ¯ä¸€å±‚ä¹‹é—´çš„ç¥ç»å…ƒä¹Ÿå»ºç«‹äº†è¿æ¥ï¼Œéšè—å±‚ç¥ç»å…ƒçš„è¾“å…¥ç”±å½“å‰è¾“å…¥å’Œä¸Šä¸€æ—¶åˆ»éšè—å±‚ç¥ç»å…ƒçš„è¾“å‡ºå…±åŒå†³å®šï¼Œæ¯ä¸€æ—¶åˆ»çš„éšè—å±‚ç¥ç»å…ƒè®°ä½äº†ä¸Šä¸€æ—¶åˆ»éšè—å±‚ç¥ç»å…ƒçš„è¾“å‡ºï¼Œç›¸å½“äºå¯¹ç½‘ç»œå¢æ·»äº†â€œè®°å¿†â€åŠŸèƒ½ã€‚æˆ‘ä»¬éƒ½çŸ¥é“åœ¨è¾“å…¥åºåˆ—ä¸­ä¸å¯é¿å…ä¼šå‡ºç°é‡å¤æˆ–ç›¸ä¼¼çš„æŸäº›åºåˆ—ä¿¡æ¯ï¼Œæˆ‘ä»¬å¸Œæœ›RNNèƒ½å¤Ÿä¿ç•™è¿™äº›è®°å¿†ä¿¡æ¯ä¾¿äºå†æ¬¡è°ƒç”¨ï¼Œä¸”RNNç»“æ„ä¸­ä¸åŒæ—¶åˆ»å‚æ•°æ˜¯å…±äº«çš„ï¼Œè¿™ä¸€ä¼˜ç‚¹ä¾¿äºç½‘ç»œåœ¨ä¸åŒä½ç½®ä¾æ—§èƒ½å°†è¯¥é‡å¤ä¿¡æ¯è¯†åˆ«å‡ºæ¥ï¼Œè¿™æ ·ä¸€æ¥æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›è‡ªç„¶æœ‰æ‰€ä¸Šå‡ã€‚
RNNç»“æ„å¦‚ä¸‹ï¼š
2.1 LSTMè¯ç”Ÿ RNNåœ¨è§£å†³é•¿åºåˆ—é—®é¢˜æ—¶æœªèƒ½æœ‰è‰¯å¥½çš„å»ºæ¨¡æ•ˆæœï¼Œå­˜åœ¨é•¿æœŸä¾èµ–çš„å¼Šç«¯ï¼Œå¯¹æ­¤HochreiterSç­‰äººå¯¹ç¥ç»å•å…ƒåšå‡ºäº†æ”¹è¿›ï¼Œå¼•å…¥è‡ªå¾ªç¯ä½¿æ¢¯åº¦ä¿¡æ¯å¾—ä»¥é•¿æ—¶é—´æŒç»­æµåŠ¨ï¼Œå³æ¨¡å‹å¯ä»¥æ‹¥æœ‰é•¿æœŸè®°å¿†ä¿¡æ¯ï¼Œä¸”è‡ªå¾ªç¯æƒé‡å¯ä»¥æ ¹æ®å‰åä¿¡æ¯è¿›è¡Œè°ƒæ•´å¹¶ä¸æ˜¯å›ºå®šçš„ã€‚ä½œä¸ºRNNçš„ä¸€ç§ç‰¹æ®Šç»“æ„ï¼Œå®ƒå¯ä»¥æ ¹æ®å‰åè¾“å…¥æƒ…å†µå†³å®šå†å²ä¿¡æ¯çš„å»ç•™ï¼Œå¢è¿›çš„é—¨æ§æœºåˆ¶å¯ä»¥åŠ¨æ€æ”¹å˜ç´¯ç§¯çš„æ—¶é—´å°ºåº¦è¿›è€Œæ§åˆ¶ç¥ç»å•å…ƒçš„ä¿¡æ¯æµï¼Œè¿™æ ·ç¥ç»ç½‘ç»œä¾¿èƒ½å¤Ÿè‡ªå·±æ ¹æ®æƒ…å†µå†³å®šæ¸…é™¤æˆ–ä¿ç•™æ—§çš„ä¿¡æ¯ï¼Œä¸è‡³äºçŠ¶æ€ä¿¡æ¯è¿‡é•¿é€ æˆç½‘ç»œå´©æºƒï¼Œè¿™ä¾¿æ˜¯é•¿çŸ­æœŸè®°å¿†ï¼ˆLSTMï¼‰ç½‘ç»œã€‚éšç€ä¿¡æ¯ä¸æ–­æµå…¥ï¼Œè¯¥æ¨¡å‹æ¯ä¸ªç¥ç»å…ƒå†…éƒ¨çš„é—å¿˜é—¨ã€è¾“å…¥é—¨ã€è¾“å‡ºé—¨ä¸‰ä¸ªé—¨æ§æœºåˆ¶ä¼šå¯¹æ¯ä¸€æ—¶åˆ»çš„ä¿¡æ¯åšå‡ºåˆ¤æ–­å¹¶åŠæ—¶è¿›è¡Œè°ƒæ•´æ›´æ–°ï¼ŒLSTMæ¨¡å‹ç°å·²å¹¿æ³›åº”ç”¨äºæ— çº¦æŸæ‰‹å†™è¯†åˆ«ã€è¯­éŸ³è¯†åˆ«ã€æœºå™¨ç¿»è¯‘ç­‰é¢†åŸŸã€‚
2 å¦‚ä½•ç”¨LSTMåšè‚¡ç¥¨é¢„æµ‹ 2.1 ç®—æ³•æ„å»ºæµç¨‹ 2.2 éƒ¨åˆ†ä»£ç  import numpy as np import matplotlib.pyplot as plt import tensorflow as tf import pandas as pd import math def LSTMtest(data): n1 = len(data[0]) - 1 #å› ä¸ºæœ€åä¸€ä½ä¸ºlabel n2 = len(data) print(n1, n2) # è®¾ç½®å¸¸é‡ input_size = n1 # è¾“å…¥ç¥ç»å…ƒä¸ªæ•° rnn_unit = 10 # LSTMå•å…ƒ(ä¸€å±‚ç¥ç»ç½‘ç»œ)ä¸­çš„ä¸­ç¥ç»å…ƒçš„ä¸ªæ•° lstm_layers = 7 # LSTMå•å…ƒä¸ªæ•° output_size = 1 # è¾“å‡ºç¥ç»å…ƒä¸ªæ•°ï¼ˆé¢„æµ‹å€¼ï¼‰ lr = 0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/628bd22f5c35132d9ea43e9d632c4ebd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-08T10:10:36+08:00" />
<meta property="article:modified_time" content="2023-10-08T10:10:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="èœé¸Ÿç¨‹åºå‘˜åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">èœé¸Ÿç¨‹åºå‘˜åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">å¤§æ•°æ®é¡¹ç›®åˆ†äº« - æ·±åº¦å­¦ä¹  å¤§æ•°æ® è‚¡ç¥¨é¢„æµ‹ç³»ç»Ÿ - python lstm</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>æ–‡ç« ç›®å½•</h4> 
 <ul><li><a href="#0__4" rel="nofollow">0 å‰è¨€</a></li><li><a href="#1__22" rel="nofollow">1 è¯¾é¢˜æ„ä¹‰</a></li><li><ul><li><a href="#11__26" rel="nofollow">1.1 è‚¡ç¥¨é¢„æµ‹ä¸»æµæ–¹æ³•</a></li></ul> 
  </li><li><a href="#2_LSTM_41" rel="nofollow">2 ä»€ä¹ˆæ˜¯LSTM</a></li><li><ul><li><a href="#21__45" rel="nofollow">2.1 å¾ªç¯ç¥ç»ç½‘ç»œ</a></li><li><a href="#21_LSTM_57" rel="nofollow">2.1 LSTMè¯ç”Ÿ</a></li></ul> 
  </li><li><a href="#2_LSTM_66" rel="nofollow">2 å¦‚ä½•ç”¨LSTMåšè‚¡ç¥¨é¢„æµ‹</a></li><li><ul><li><a href="#21__68" rel="nofollow">2.1 ç®—æ³•æ„å»ºæµç¨‹</a></li><li><a href="#22__72" rel="nofollow">2.2 éƒ¨åˆ†ä»£ç </a></li></ul> 
  </li><li><a href="#3__293" rel="nofollow">3 å®ç°æ•ˆæœ</a></li><li><ul><li><a href="#31__295" rel="nofollow">3.1 æ•°æ®</a></li><li><a href="#32__302" rel="nofollow">3.2 é¢„æµ‹ç»“æœ</a></li><li><ul><li><ul><li><a href="#_312" rel="nofollow">é¡¹ç›®è¿è¡Œå±•ç¤º</a></li><li><a href="#_321" rel="nofollow">å¼€å‘ç¯å¢ƒ</a></li><li><a href="#_338" rel="nofollow">æ•°æ®è·å–</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr color="#000000" size='1"'> 
<h2><a id="0__4"></a>0 å‰è¨€</h2> 
<p>ğŸ”¥ è¿™ä¸¤å¹´å¼€å§‹æ¯•ä¸šè®¾è®¡å’Œæ¯•ä¸šç­”è¾©çš„è¦æ±‚å’Œéš¾åº¦ä¸æ–­æå‡ï¼Œä¼ ç»Ÿçš„æ¯•è®¾é¢˜ç›®ç¼ºå°‘åˆ›æ–°å’Œäº®ç‚¹ï¼Œå¾€å¾€è¾¾ä¸åˆ°æ¯•ä¸šç­”è¾©çš„è¦æ±‚ï¼Œè¿™ä¸¤å¹´ä¸æ–­æœ‰å­¦å¼Ÿå­¦å¦¹å‘Šè¯‰å­¦é•¿è‡ªå·±åšçš„é¡¹ç›®ç³»ç»Ÿè¾¾ä¸åˆ°è€å¸ˆçš„è¦æ±‚ã€‚</p> 
<p>ä¸ºäº†å¤§å®¶èƒ½å¤Ÿé¡ºåˆ©ä»¥åŠæœ€å°‘çš„ç²¾åŠ›é€šè¿‡æ¯•è®¾ï¼Œå­¦é•¿åˆ†äº«ä¼˜è´¨æ¯•ä¸šè®¾è®¡é¡¹ç›®ï¼Œä»Šå¤©è¦åˆ†äº«çš„æ˜¯</p> 
<p>ğŸš© <strong>æ·±åº¦å­¦ä¹  å¤§æ•°æ® è‚¡ç¥¨é¢„æµ‹ç³»ç»Ÿ</strong></p> 
<p>ğŸ¥‡å­¦é•¿è¿™é‡Œç»™ä¸€ä¸ªé¢˜ç›®ç»¼åˆè¯„åˆ†(æ¯é¡¹æ»¡åˆ†5åˆ†)</p> 
<ul><li>éš¾åº¦ç³»æ•°ï¼š3åˆ†</li><li>å·¥ä½œé‡ï¼š3åˆ†</li><li>åˆ›æ–°ç‚¹ï¼š4åˆ†</li></ul> 
<p>ğŸ§¿ <strong>é€‰é¢˜æŒ‡å¯¼, é¡¹ç›®åˆ†äº«ï¼š</strong></p> 
<p><a href="https://gitee.com/yaa-dc/warehouse-1/blob/master/python/README.md" rel="nofollow">https://gitee.com/yaa-dc/warehouse-1/blob/master/python/README.md</a></p> 
<h2><a id="1__22"></a>1 è¯¾é¢˜æ„ä¹‰</h2> 
<p>åˆ©ç”¨ç¥ç»ç½‘ç»œæ¨¡å‹å¦‚æœèƒ½å¤Ÿæé«˜å¯¹è‚¡ç¥¨ä»·æ ¼çš„é¢„æµ‹ç²¾åº¦ï¼Œæ›´å¥½åœ°æŒæ¡è‚¡ç¥¨ä»·æ ¼å‘å±•è¶‹åŠ¿ï¼Œè¿™å¯¹äºæŠ•èµ„è€…æ¥è¯´å¯ä»¥åŠæ—¶åˆ¶å®šç›¸åº”çš„å‘å±•ç­–ç•¥ï¼Œæ›´å¥½åœ°åº”å¯¹æœªæ¥å‘ç”Ÿçš„ä¸ç¡®å®šæ€§äº‹ä»¶ï¼Œå¯¹äºä¸ªäººæ¥è¯´å¯ä»¥é™ä½æŠ•èµ„é£é™©ï¼Œå‡å°‘è´¢äº§æŸå¤±ï¼Œå®ç°é«˜æ•ˆæŠ•èµ„ï¼Œå…·æœ‰ä¸€å®šçš„å®è·µä»·å€¼ã€‚</p> 
<h3><a id="11__26"></a>1.1 è‚¡ç¥¨é¢„æµ‹ä¸»æµæ–¹æ³•</h3> 
<p>è‚¡ç¥¨å¸‚åœºå¤æ‚ã€éçº¿æ€§çš„ç‰¹ç‚¹ä½¿æˆ‘ä»¬éš¾ä»¥æ‰æ‘¸å…¶å˜åŒ–è§„å¾‹ï¼Œç›®å‰æœ‰å¾ˆå¤šé¢„æµ‹è‚¡ç¥¨èµ°åŠ¿çš„è®ºæ–‡å’Œç®—æ³•ã€‚</p> 
<p>å®šé‡åˆ†æä»ç²¾ç¡®çš„æ•°æ®èµ„æ–™ä¸­è·å¾—è‚¡ç¥¨å‘å±•çš„ä»·å€¼è§„å¾‹ï¼Œé€šè¿‡å»ºç«‹æ¨¡å‹åˆ©ç”¨æ•°å­¦è¯­è¨€å¯¹è‚¡å¸‚çš„å‘å±•æƒ…å†µåšå‡ºè§£é‡Šä¸é¢„æµ‹ã€‚</p> 
<p>ç›®å‰å¸¸ç”¨çš„å®šé‡åˆ†ææ–¹æ³•æœ‰ï¼š</p> 
<ul><li>ä¼ ç»Ÿæ—¶é—´åºåˆ—é¢„æµ‹æ¨¡å‹</li><li>é©¬å°”å¯å¤«é“¾é¢„æµ‹</li><li>ç°è‰²ç³»ç»Ÿç†è®ºé¢„æµ‹</li><li>é—ä¼ ç®—æ³•</li><li>æœºå™¨å­¦ä¹ é¢„æµ‹ç­‰æ–¹æ³•</li></ul> 
<h2><a id="2_LSTM_41"></a>2 ä»€ä¹ˆæ˜¯LSTM</h2> 
<p>LSTMæ˜¯é•¿çŸ­æœŸè®°å¿†ç½‘ç»œï¼ˆLSTMï¼ŒLong Short-Term Memoryï¼‰ï¼Œæƒ³è¦ç†è§£ä»€ä¹ˆæ˜¯LSTMï¼Œé¦–å…ˆè¦äº†è§£ä»€ä¹ˆæ˜¯å¾ªç¯ç¥ç»ç½‘ç»œã€‚</p> 
<h3><a id="21__45"></a>2.1 å¾ªç¯ç¥ç»ç½‘ç»œ</h3> 
<p>å¯¹äºä¼ ç»Ÿçš„BPç¥ç»ç½‘ç»œå¦‚æ·±åº¦å‰é¦ˆç½‘ç»œã€å·ç§¯ç¥ç»ç½‘ç»œæ¥è¯´ï¼ŒåŒå±‚åŠè·¨å±‚ä¹‹é—´çš„ç¥ç»å…ƒæ˜¯ç‹¬ç«‹çš„ï¼Œä½†å®é™…åº”ç”¨ä¸­å¯¹äºä¸€äº›æœ‰ä¸Šä¸‹è”ç³»çš„åºåˆ—æ¥è¯´ï¼Œå¦‚æœèƒ½å¤Ÿå­¦ä¹ åˆ°å®ƒä»¬ä¹‹é—´çš„ç›¸äº’å…³ç³»ï¼Œä½¿ç½‘ç»œèƒ½å¤Ÿå¯¹ä¸åŒæ—¶åˆ»çš„è¾“å…¥åºåˆ—äº§ç”Ÿä¸€å®šçš„è”ç³»ï¼Œåƒç”Ÿç‰©çš„å¤§è„‘ä¸€æ ·æœ‰â€œè®°å¿†åŠŸèƒ½â€ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬çš„æ¨¡å‹ä¹Ÿå°±ä¼šæœ‰æ›´ä½çš„è®­ç»ƒå‡ºé”™é¢‘ç‡åŠæ›´å¥½çš„æ³›åŒ–èƒ½åŠ›ã€‚</p> 
<p>JordanMIæå‡ºåºåˆ—ç†è®ºï¼Œæè¿°äº†ä¸€ç§ä½“ç°â€œå¹¶è¡Œåˆ†å¸ƒå¼å¤„ç†â€çš„ç½‘ç»œåŠ¨æ€ç³»ç»Ÿï¼Œé€‚ç”¨äºè¯­éŸ³ç”Ÿæˆä¸­çš„ååŒå‘éŸ³é—®é¢˜ï¼Œå¹¶è¿›è¡Œäº†ç›¸å…³ä»¿çœŸå®éªŒï¼ŒElmanJLè®¤ä¸ºè¿æ¥ä¸»ä¹‰æ¨¡å‹ä¸­å¯¹æ—¶é—´å¦‚ä½•è¡¨ç¤ºæ˜¯è‡³å…³é‡è¦çš„ï¼Œ1990å¹´ä»–æå‡ºä½¿ç”¨å¾ªç¯è¿æ¥ä¸ºç½‘ç»œæä¾›åŠ¨æ€å†…å­˜ï¼Œä»ç›¸å¯¹ç®€å•çš„å¼‚æˆ–é—®é¢˜åˆ°æ¢å¯»å•è¯çš„è¯­ä¹‰ç‰¹å¾ï¼Œç½‘ç»œå‡å­¦ä¹ åˆ°äº†æœ‰è¶£çš„å†…éƒ¨è¡¨ç¤ºï¼Œç½‘ç»œè¿˜å°†ä»»åŠ¡éœ€æ±‚å’Œå†…å­˜éœ€æ±‚ç»“åˆåœ¨ä¸€èµ·ï¼Œç”±æ­¤å½¢æˆäº†ç®€å•å¾ªç¯ç½‘ç»œçš„åŸºç¡€æ¡†æ¶ã€‚</p> 
<p>å¾ªç¯ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰ä¹‹é—´çš„ç¥ç»å…ƒæ˜¯ç›¸äº’è¿æ¥çš„ï¼Œä¸ä»…åœ¨å±‚ä¸å±‚ä¹‹é—´çš„ç¥ç»å…ƒå»ºç«‹è¿æ¥ï¼Œè€Œä¸”æ¯ä¸€å±‚ä¹‹é—´çš„ç¥ç»å…ƒä¹Ÿå»ºç«‹äº†è¿æ¥ï¼Œéšè—å±‚ç¥ç»å…ƒçš„è¾“å…¥ç”±å½“å‰è¾“å…¥å’Œä¸Šä¸€æ—¶åˆ»éšè—å±‚ç¥ç»å…ƒçš„è¾“å‡ºå…±åŒå†³å®šï¼Œæ¯ä¸€æ—¶åˆ»çš„éšè—å±‚ç¥ç»å…ƒè®°ä½äº†ä¸Šä¸€æ—¶åˆ»éšè—å±‚ç¥ç»å…ƒçš„è¾“å‡ºï¼Œç›¸å½“äºå¯¹ç½‘ç»œå¢æ·»äº†â€œè®°å¿†â€åŠŸèƒ½ã€‚æˆ‘ä»¬éƒ½çŸ¥é“åœ¨è¾“å…¥åºåˆ—ä¸­ä¸å¯é¿å…ä¼šå‡ºç°é‡å¤æˆ–ç›¸ä¼¼çš„æŸäº›åºåˆ—ä¿¡æ¯ï¼Œæˆ‘ä»¬å¸Œæœ›RNNèƒ½å¤Ÿä¿ç•™è¿™äº›è®°å¿†ä¿¡æ¯ä¾¿äºå†æ¬¡è°ƒç”¨ï¼Œä¸”RNNç»“æ„ä¸­ä¸åŒæ—¶åˆ»å‚æ•°æ˜¯å…±äº«çš„ï¼Œè¿™ä¸€ä¼˜ç‚¹ä¾¿äºç½‘ç»œåœ¨ä¸åŒä½ç½®ä¾æ—§èƒ½å°†è¯¥é‡å¤ä¿¡æ¯è¯†åˆ«å‡ºæ¥ï¼Œè¿™æ ·ä¸€æ¥æ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›è‡ªç„¶æœ‰æ‰€ä¸Šå‡ã€‚</p> 
<p>RNNç»“æ„å¦‚ä¸‹ï¼š</p> 
<p><img src="https://images2.imgbox.com/ee/ae/SzNuqpjk_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="21_LSTM_57"></a>2.1 LSTMè¯ç”Ÿ</h3> 
<p>RNNåœ¨è§£å†³é•¿åºåˆ—é—®é¢˜æ—¶æœªèƒ½æœ‰è‰¯å¥½çš„å»ºæ¨¡æ•ˆæœï¼Œå­˜åœ¨é•¿æœŸä¾èµ–çš„å¼Šç«¯ï¼Œå¯¹æ­¤HochreiterSç­‰äººå¯¹ç¥ç»å•å…ƒåšå‡ºäº†æ”¹è¿›ï¼Œå¼•å…¥è‡ªå¾ªç¯ä½¿æ¢¯åº¦ä¿¡æ¯å¾—ä»¥é•¿æ—¶é—´æŒç»­æµåŠ¨ï¼Œå³æ¨¡å‹å¯ä»¥æ‹¥æœ‰é•¿æœŸè®°å¿†ä¿¡æ¯ï¼Œä¸”è‡ªå¾ªç¯æƒé‡å¯ä»¥æ ¹æ®å‰åä¿¡æ¯è¿›è¡Œè°ƒæ•´å¹¶ä¸æ˜¯å›ºå®šçš„ã€‚ä½œä¸ºRNNçš„ä¸€ç§ç‰¹æ®Šç»“æ„ï¼Œå®ƒå¯ä»¥æ ¹æ®å‰åè¾“å…¥æƒ…å†µå†³å®šå†å²ä¿¡æ¯çš„å»ç•™ï¼Œå¢è¿›çš„é—¨æ§æœºåˆ¶å¯ä»¥åŠ¨æ€æ”¹å˜ç´¯ç§¯çš„æ—¶é—´å°ºåº¦è¿›è€Œæ§åˆ¶ç¥ç»å•å…ƒçš„ä¿¡æ¯æµï¼Œè¿™æ ·ç¥ç»ç½‘ç»œä¾¿èƒ½å¤Ÿè‡ªå·±æ ¹æ®æƒ…å†µå†³å®šæ¸…é™¤æˆ–ä¿ç•™æ—§çš„ä¿¡æ¯ï¼Œä¸è‡³äºçŠ¶æ€ä¿¡æ¯è¿‡é•¿é€ æˆç½‘ç»œå´©æºƒï¼Œè¿™ä¾¿æ˜¯é•¿çŸ­æœŸè®°å¿†ï¼ˆLSTMï¼‰ç½‘ç»œã€‚éšç€ä¿¡æ¯ä¸æ–­æµå…¥ï¼Œè¯¥æ¨¡å‹æ¯ä¸ªç¥ç»å…ƒå†…éƒ¨çš„é—å¿˜é—¨ã€è¾“å…¥é—¨ã€è¾“å‡ºé—¨ä¸‰ä¸ªé—¨æ§æœºåˆ¶ä¼šå¯¹æ¯ä¸€æ—¶åˆ»çš„ä¿¡æ¯åšå‡ºåˆ¤æ–­å¹¶åŠæ—¶è¿›è¡Œè°ƒæ•´æ›´æ–°ï¼ŒLSTMæ¨¡å‹ç°å·²å¹¿æ³›åº”ç”¨äºæ— çº¦æŸæ‰‹å†™è¯†åˆ«ã€è¯­éŸ³è¯†åˆ«ã€æœºå™¨ç¿»è¯‘ç­‰é¢†åŸŸã€‚</p> 
<p><img src="https://images2.imgbox.com/f3/a4/plnuELzq_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="2_LSTM_66"></a>2 å¦‚ä½•ç”¨LSTMåšè‚¡ç¥¨é¢„æµ‹</h2> 
<h3><a id="21__68"></a>2.1 ç®—æ³•æ„å»ºæµç¨‹</h3> 
<p><img src="https://images2.imgbox.com/1a/4a/RPkqTXB7_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="22__72"></a>2.2 éƒ¨åˆ†ä»£ç </h3> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> math

<span class="token keyword">def</span> <span class="token function">LSTMtest</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>

    n1 <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token comment">#å› ä¸ºæœ€åä¸€ä½ä¸ºlabel</span>
    n2 <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">)</span>

    <span class="token comment"># è®¾ç½®å¸¸é‡</span>
    input_size <span class="token operator">=</span> n1  <span class="token comment"># è¾“å…¥ç¥ç»å…ƒä¸ªæ•°</span>
    rnn_unit <span class="token operator">=</span> <span class="token number">10</span>    <span class="token comment"># LSTMå•å…ƒ(ä¸€å±‚ç¥ç»ç½‘ç»œ)ä¸­çš„ä¸­ç¥ç»å…ƒçš„ä¸ªæ•°</span>
    lstm_layers <span class="token operator">=</span> <span class="token number">7</span>  <span class="token comment"># LSTMå•å…ƒä¸ªæ•°</span>
    output_size <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># è¾“å‡ºç¥ç»å…ƒä¸ªæ•°ï¼ˆé¢„æµ‹å€¼ï¼‰</span>
    lr <span class="token operator">=</span> <span class="token number">0.0006</span>      <span class="token comment"># å­¦ä¹ ç‡</span>

    train_end_index <span class="token operator">=</span> math<span class="token punctuation">.</span>floor<span class="token punctuation">(</span>n2<span class="token operator">*</span><span class="token number">0.9</span><span class="token punctuation">)</span>  <span class="token comment"># å‘ä¸‹å–æ•´</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'train_end_index'</span><span class="token punctuation">,</span> train_end_index<span class="token punctuation">)</span>
    <span class="token comment"># å‰90%æ•°æ®ä½œä¸ºè®­ç»ƒé›†ï¼Œå10%ä½œä¸ºæµ‹è¯•é›†</span>
    <span class="token comment"># è·å–è®­ç»ƒé›†</span>
    <span class="token comment"># time_step æ—¶é—´æ­¥ï¼Œbatch_size æ¯ä¸€æ‰¹æ¬¡è®­ç»ƒå¤šå°‘ä¸ªæ ·ä¾‹</span>
    <span class="token keyword">def</span> <span class="token function">get_train_data</span><span class="token punctuation">(</span>batch_size<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">,</span> time_step<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> train_begin<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> train_end<span class="token operator">=</span>train_end_index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        batch_index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        data_train <span class="token operator">=</span> data<span class="token punctuation">[</span>train_begin<span class="token punctuation">:</span>train_end<span class="token punctuation">]</span>
        normalized_train_data <span class="token operator">=</span> <span class="token punctuation">(</span>data_train <span class="token operator">-</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>data_train<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>data_train<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># æ ‡å‡†åŒ–</span>
        train_x<span class="token punctuation">,</span> train_y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># è®­ç»ƒé›†</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>normalized_train_data<span class="token punctuation">)</span> <span class="token operator">-</span> time_step<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> i <span class="token operator">%</span> batch_size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token comment"># å¼€å§‹ä½ç½®</span>
                batch_index<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
                <span class="token comment"># ä¸€æ¬¡å–time_stepè¡Œæ•°æ®</span>
            <span class="token comment"># xå­˜å‚¨è¾“å…¥ç»´åº¦ï¼ˆä¸åŒ…æ‹¬labelï¼‰ :X(æœ€åä¸€ä¸ªä¸å–ï¼‰</span>
            <span class="token comment"># æ ‡å‡†åŒ–(å½’ä¸€åŒ–ï¼‰</span>
            x <span class="token operator">=</span> normalized_train_data<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i <span class="token operator">+</span> time_step<span class="token punctuation">,</span> <span class="token punctuation">:</span>n1<span class="token punctuation">]</span>
            <span class="token comment"># yå­˜å‚¨label</span>
            y <span class="token operator">=</span> normalized_train_data<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i <span class="token operator">+</span> time_step<span class="token punctuation">,</span> n1<span class="token punctuation">,</span> np<span class="token punctuation">.</span>newaxis<span class="token punctuation">]</span>
            <span class="token comment"># np.newaxisåˆ†åˆ«æ˜¯åœ¨è¡Œæˆ–åˆ—ä¸Šå¢åŠ ç»´åº¦</span>
            train_x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            train_y<span class="token punctuation">.</span>append<span class="token punctuation">(</span>y<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># ç»“æŸä½ç½®</span>
        batch_index<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>normalized_train_data<span class="token punctuation">)</span> <span class="token operator">-</span> time_step<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'batch_index'</span><span class="token punctuation">,</span> batch_index<span class="token punctuation">)</span>
        <span class="token comment"># print('train_x', train_x)</span>
        <span class="token comment"># print('train_y', train_y)</span>
        <span class="token keyword">return</span> batch_index<span class="token punctuation">,</span> train_x<span class="token punctuation">,</span> train_y

    <span class="token comment"># è·å–æµ‹è¯•é›†</span>
    <span class="token keyword">def</span> <span class="token function">get_test_data</span><span class="token punctuation">(</span>time_step<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> test_begin<span class="token operator">=</span>train_end_index<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        data_test <span class="token operator">=</span> data<span class="token punctuation">[</span>test_begin<span class="token punctuation">:</span><span class="token punctuation">]</span>
        mean <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>data_test<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
        std <span class="token operator">=</span> np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>data_test<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># çŸ©é˜µæ ‡å‡†å·®</span>
        <span class="token comment"># æ ‡å‡†åŒ–(å½’ä¸€åŒ–ï¼‰</span>
        normalized_test_data <span class="token operator">=</span> <span class="token punctuation">(</span>data_test <span class="token operator">-</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>data_test<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> np<span class="token punctuation">.</span>std<span class="token punctuation">(</span>data_test<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token comment"># " // "è¡¨ç¤ºæ•´æ•°é™¤æ³•ã€‚æœ‰sizeä¸ªsample</span>
        test_size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>normalized_test_data<span class="token punctuation">)</span> <span class="token operator">+</span> time_step <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span> time_step
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'test_size$$$$$$$$$$$$$$'</span><span class="token punctuation">,</span> test_size<span class="token punctuation">)</span>
        test_x<span class="token punctuation">,</span> test_y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>test_size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            x <span class="token operator">=</span> normalized_test_data<span class="token punctuation">[</span>i <span class="token operator">*</span> time_step<span class="token punctuation">:</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> time_step<span class="token punctuation">,</span> <span class="token punctuation">:</span>n1<span class="token punctuation">]</span>
            y <span class="token operator">=</span> normalized_test_data<span class="token punctuation">[</span>i <span class="token operator">*</span> time_step<span class="token punctuation">:</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> time_step<span class="token punctuation">,</span> n1<span class="token punctuation">]</span>
            test_x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>x<span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            test_y<span class="token punctuation">.</span>extend<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
        test_x<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>normalized_test_data<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> time_step<span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span>n1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        test_y<span class="token punctuation">.</span>extend<span class="token punctuation">(</span><span class="token punctuation">(</span>normalized_test_data<span class="token punctuation">[</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> time_step<span class="token punctuation">:</span><span class="token punctuation">,</span> n1<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tolist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> mean<span class="token punctuation">,</span> std<span class="token punctuation">,</span> test_x<span class="token punctuation">,</span> test_y

    <span class="token comment"># â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”å®šä¹‰ç¥ç»ç½‘ç»œå˜é‡â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span>
    <span class="token comment"># è¾“å…¥å±‚ã€è¾“å‡ºå±‚æƒé‡ã€åç½®ã€dropoutå‚æ•°</span>
    <span class="token comment"># éšæœºäº§ç”Ÿ w,b</span>
    weights <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'in'</span><span class="token punctuation">:</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span><span class="token punctuation">[</span>input_size<span class="token punctuation">,</span> rnn_unit<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'out'</span><span class="token punctuation">:</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span><span class="token punctuation">[</span>rnn_unit<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    biases <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'in'</span><span class="token punctuation">:</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token punctuation">[</span>rnn_unit<span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'out'</span><span class="token punctuation">:</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>constant<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    keep_prob <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'keep_prob'</span><span class="token punctuation">)</span>  <span class="token comment"># dropout é˜²æ­¢è¿‡æ‹Ÿåˆ</span>

    <span class="token comment"># â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”å®šä¹‰ç¥ç»ç½‘ç»œâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span>
    <span class="token keyword">def</span> <span class="token function">lstmCell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># basicLstmå•å…ƒ</span>
        <span class="token comment"># tf.nn.rnn_cell.BasicLSTMCell(self, num_units, forget_bias=1.0,</span>
        <span class="token comment"># tate_is_tuple=True, activation=None, reuse=None, name=None) </span>
        <span class="token comment"># num_units:intç±»å‹ï¼ŒLSTMå•å…ƒ(ä¸€å±‚ç¥ç»ç½‘ç»œ)ä¸­çš„ä¸­ç¥ç»å…ƒçš„ä¸ªæ•°ï¼Œå’Œå‰é¦ˆç¥ç»ç½‘ç»œä¸­éšå«å±‚ç¥ç»å…ƒä¸ªæ•°æ„æ€ç›¸åŒ</span>
        <span class="token comment"># forget_bias:floatç±»å‹ï¼Œåç½®å¢åŠ äº†å¿˜è®°é—¨ã€‚ä»CudnnLSTMè®­ç»ƒçš„æ£€æŸ¥ç‚¹(checkpoin)æ¢å¤æ—¶ï¼Œå¿…é¡»æ‰‹åŠ¨è®¾ç½®ä¸º0.0ã€‚</span>
        <span class="token comment"># state_is_tuple:å¦‚æœä¸ºTrueï¼Œåˆ™æ¥å—å’Œè¿”å›çš„çŠ¶æ€æ˜¯c_stateå’Œm_stateçš„2-tupleï¼›å¦‚æœä¸ºFalseï¼Œåˆ™ä»–ä»¬æ²¿ç€åˆ—è½´è¿æ¥ã€‚åä¸€ç§å³å°†è¢«å¼ƒç”¨ã€‚</span>
        <span class="token comment"># ï¼ˆLSTMä¼šä¿ç•™ä¸¤ä¸ªstateï¼Œä¹Ÿå°±æ˜¯ä¸»çº¿çš„state(c_state),å’Œåˆ†çº¿çš„state(m_state)ï¼Œä¼šåŒ…å«åœ¨å…ƒç»„ï¼ˆtupleï¼‰é‡Œè¾¹</span>
        <span class="token comment"># state_is_tuple=Trueå°±æ˜¯åˆ¤å®šç”Ÿæˆçš„æ˜¯å¦ä¸ºä¸€ä¸ªå…ƒç»„ï¼‰</span>
        <span class="token comment">#   åˆå§‹åŒ–çš„ c å’Œ a éƒ½æ˜¯zero_state ä¹Ÿå°±æ˜¯éƒ½ä¸ºlist[]çš„zeroï¼Œè¿™æ˜¯å‚æ•°state_is_tupleçš„æƒ…å†µä¸‹</span>
        <span class="token comment">#   åˆå§‹state,å…¨éƒ¨ä¸º0ï¼Œæ…¢æ…¢çš„ç´¯åŠ è®°å¿†</span>
        <span class="token comment"># activation:å†…éƒ¨çŠ¶æ€çš„æ¿€æ´»å‡½æ•°ã€‚é»˜è®¤ä¸ºtanh</span>
        <span class="token comment"># reuse:å¸ƒå°”ç±»å‹ï¼Œæè¿°æ˜¯å¦åœ¨ç°æœ‰èŒƒå›´ä¸­é‡ç”¨å˜é‡ã€‚å¦‚æœä¸ä¸ºTrueï¼Œå¹¶ä¸”ç°æœ‰èŒƒå›´å·²ç»å…·æœ‰ç»™å®šå˜é‡ï¼Œåˆ™ä¼šå¼•å‘é”™è¯¯ã€‚</span>
        <span class="token comment"># name:Stringç±»å‹ï¼Œå±‚çš„åç§°ã€‚å…·æœ‰ç›¸åŒåç§°çš„å±‚å°†å…±äº«æƒé‡ï¼Œä½†ä¸ºäº†é¿å…é”™è¯¯ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹éœ€è¦reuse=True.</span>
        <span class="token comment">#</span>

        basicLstm <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>rnn_cell<span class="token punctuation">.</span>BasicLSTMCell<span class="token punctuation">(</span>rnn_unit<span class="token punctuation">,</span> forget_bias<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span> state_is_tuple<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token comment"># dropout æœªä½¿ç”¨</span>
        drop <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>rnn_cell<span class="token punctuation">.</span>DropoutWrapper<span class="token punctuation">(</span>basicLstm<span class="token punctuation">,</span> output_keep_prob<span class="token operator">=</span>keep_prob<span class="token punctuation">)</span>
        <span class="token keyword">return</span> basicLstm

   

    <span class="token keyword">def</span> <span class="token function">lstm</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># å‚æ•°ï¼šè¾“å…¥ç½‘ç»œæ‰¹æ¬¡æ•°ç›®</span>
        batch_size <span class="token operator">=</span> tf<span class="token punctuation">.</span>shape<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        time_step <span class="token operator">=</span> tf<span class="token punctuation">.</span>shape<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
        w_in <span class="token operator">=</span> weights<span class="token punctuation">[</span><span class="token string">'in'</span><span class="token punctuation">]</span>
        b_in <span class="token operator">=</span> biases<span class="token punctuation">[</span><span class="token string">'in'</span><span class="token punctuation">]</span>

        <span class="token comment"># å¿˜è®°é—¨ï¼ˆè¾“å…¥é—¨ï¼‰</span>
        <span class="token comment"># å› ä¸ºè¦è¿›è¡ŒçŸ©é˜µä¹˜æ³•,æ‰€ä»¥reshape</span>
        <span class="token comment"># éœ€è¦å°†tensorè½¬æˆ2ç»´è¿›è¡Œè®¡ç®—</span>
        <span class="token builtin">input</span> <span class="token operator">=</span> tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>X<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> input_size<span class="token punctuation">]</span><span class="token punctuation">)</span>
        input_rnn <span class="token operator">=</span> tf<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">,</span> w_in<span class="token punctuation">)</span> <span class="token operator">+</span> b_in
        <span class="token comment"># å°†tensorè½¬æˆ3ç»´ï¼Œè®¡ç®—åçš„ç»“æœä½œä¸ºå¿˜è®°é—¨çš„è¾“å…¥</span>
        input_rnn <span class="token operator">=</span> tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>input_rnn<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> time_step<span class="token punctuation">,</span> rnn_unit<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'input_rnn'</span><span class="token punctuation">,</span> input_rnn<span class="token punctuation">)</span>
        <span class="token comment"># æ›´æ–°é—¨</span>
        <span class="token comment"># æ„å»ºå¤šå±‚çš„lstm</span>
        cell <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>rnn_cell<span class="token punctuation">.</span>MultiRNNCell<span class="token punctuation">(</span><span class="token punctuation">[</span>lstmCell<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>lstm_layers<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        init_state <span class="token operator">=</span> cell<span class="token punctuation">.</span>zero_state<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>

        <span class="token comment"># è¾“å‡ºé—¨</span>
        w_out <span class="token operator">=</span> weights<span class="token punctuation">[</span><span class="token string">'out'</span><span class="token punctuation">]</span>
        b_out <span class="token operator">=</span> biases<span class="token punctuation">[</span><span class="token string">'out'</span><span class="token punctuation">]</span>
        <span class="token comment"># output_rnnæ˜¯æœ€åä¸€å±‚æ¯ä¸ªstepçš„è¾“å‡º,final_statesæ˜¯æ¯ä¸€å±‚çš„æœ€åé‚£ä¸ªstepçš„è¾“å‡º</span>
        output_rnn<span class="token punctuation">,</span> final_states <span class="token operator">=</span> tf<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>dynamic_rnn<span class="token punctuation">(</span>cell<span class="token punctuation">,</span> input_rnn<span class="token punctuation">,</span> initial_state<span class="token operator">=</span>init_state<span class="token punctuation">,</span> dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
        output <span class="token operator">=</span> tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>output_rnn<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> rnn_unit<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment"># è¾“å‡ºå€¼ï¼ŒåŒæ—¶ä½œä¸ºä¸‹ä¸€å±‚è¾“å…¥é—¨çš„è¾“å…¥</span>
        pred <span class="token operator">=</span> tf<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>output<span class="token punctuation">,</span> w_out<span class="token punctuation">)</span> <span class="token operator">+</span> b_out
        <span class="token keyword">return</span> pred<span class="token punctuation">,</span> final_states

    <span class="token comment"># â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”è®­ç»ƒæ¨¡å‹â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</span>

    <span class="token keyword">def</span> <span class="token function">train_lstm</span><span class="token punctuation">(</span>batch_size<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">,</span> time_step<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> train_begin<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> train_end<span class="token operator">=</span>train_end_index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># äºæ˜¯å°±æœ‰äº†tf.placeholderï¼Œ</span>
        <span class="token comment"># æˆ‘ä»¬æ¯æ¬¡å¯ä»¥å°† ä¸€ä¸ªminibatchä¼ å…¥åˆ°x = tf.placeholder(tf.float32,[None,32])ä¸Šï¼Œ</span>
        <span class="token comment"># ä¸‹ä¸€æ¬¡ä¼ å…¥çš„xéƒ½æ›¿æ¢æ‰ä¸Šä¸€æ¬¡ä¼ å…¥çš„xï¼Œ</span>
        <span class="token comment"># è¿™æ ·å°±å¯¹äºæ‰€æœ‰ä¼ å…¥çš„minibatch xå°±åªä¼šäº§ç”Ÿä¸€ä¸ªopï¼Œ</span>
        <span class="token comment"># ä¸ä¼šäº§ç”Ÿå…¶ä»–å¤šä½™çš„opï¼Œè¿›è€Œå‡å°‘äº†graphçš„å¼€é”€ã€‚</span>

        X <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">,</span> time_step<span class="token punctuation">,</span> input_size<span class="token punctuation">]</span><span class="token punctuation">)</span>
        Y <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token punctuation">[</span><span class="token boolean">None</span><span class="token punctuation">,</span> time_step<span class="token punctuation">,</span> output_size<span class="token punctuation">]</span><span class="token punctuation">)</span>
        batch_index<span class="token punctuation">,</span> train_x<span class="token punctuation">,</span> train_y <span class="token operator">=</span> get_train_data<span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> time_step<span class="token punctuation">,</span> train_begin<span class="token punctuation">,</span> train_end<span class="token punctuation">)</span>
        <span class="token comment"># ç”¨tf.variable_scopeæ¥å®šä¹‰é‡å¤åˆ©ç”¨,LSTMä¼šç»å¸¸ç”¨åˆ°</span>
        <span class="token keyword">with</span> tf<span class="token punctuation">.</span>variable_scope<span class="token punctuation">(</span><span class="token string">"sec_lstm"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            pred<span class="token punctuation">,</span> state_ <span class="token operator">=</span> lstm<span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token comment"># predè¾“å‡ºå€¼ï¼Œstate_æ˜¯æ¯ä¸€å±‚çš„æœ€åé‚£ä¸ªstepçš„è¾“å‡º</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'pred,state_'</span><span class="token punctuation">,</span> pred<span class="token punctuation">,</span> state_<span class="token punctuation">)</span>

        <span class="token comment"># æŸå¤±å‡½æ•°</span>
        <span class="token comment"># [-1]â€”â€”åˆ—è¡¨ä»åå¾€å‰æ•°ç¬¬ä¸€åˆ—ï¼Œå³predä¸ºé¢„æµ‹å€¼ï¼ŒYä¸ºçœŸå®å€¼(Label)</span>
        <span class="token comment">#tf.reduce_mean å‡½æ•°ç”¨äºè®¡ç®—å¼ é‡tensoræ²¿ç€æŒ‡å®šçš„æ•°è½´ï¼ˆtensorçš„æŸä¸€ç»´åº¦ï¼‰ä¸Šçš„çš„å¹³å‡å€¼</span>
        loss <span class="token operator">=</span> tf<span class="token punctuation">.</span>reduce_mean<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>square<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>pred<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span> tf<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>Y<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># è¯¯å·®lossåå‘ä¼ æ’­â€”â€”å‡æ–¹è¯¯å·®æŸå¤±</span>
        <span class="token comment"># æœ¬è´¨ä¸Šæ˜¯å¸¦æœ‰åŠ¨é‡é¡¹çš„RMSpropï¼Œå®ƒåˆ©ç”¨æ¢¯åº¦çš„ä¸€é˜¶çŸ©ä¼°è®¡å’ŒäºŒé˜¶çŸ©ä¼°è®¡åŠ¨æ€è°ƒæ•´æ¯ä¸ªå‚æ•°çš„å­¦ä¹ ç‡ã€‚</span>
        <span class="token comment"># Adamçš„ä¼˜ç‚¹ä¸»è¦åœ¨äºç»è¿‡åç½®æ ¡æ­£åï¼Œæ¯ä¸€æ¬¡è¿­ä»£å­¦ä¹ ç‡éƒ½æœ‰ä¸ªç¡®å®šèŒƒå›´ï¼Œä½¿å¾—å‚æ•°æ¯”è¾ƒå¹³ç¨³.</span>
        train_op <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>AdamOptimizer<span class="token punctuation">(</span>lr<span class="token punctuation">)</span><span class="token punctuation">.</span>minimize<span class="token punctuation">(</span>loss<span class="token punctuation">)</span>
        saver <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>Saver<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>global_variables<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> max_to_keep<span class="token operator">=</span><span class="token number">15</span><span class="token punctuation">)</span>

        <span class="token keyword">with</span> tf<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> sess<span class="token punctuation">:</span>
            <span class="token comment"># åˆå§‹åŒ–</span>
            sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>global_variables_initializer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            theloss <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token comment"># è¿­ä»£æ¬¡æ•°</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> step <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>batch_index<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token comment"># sess.run(b, feed_dict = replace_dict)</span>
                    state_<span class="token punctuation">,</span> loss_ <span class="token operator">=</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span>train_op<span class="token punctuation">,</span> loss<span class="token punctuation">]</span><span class="token punctuation">,</span>
                                        feed_dict<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>X<span class="token punctuation">:</span> train_x<span class="token punctuation">[</span>batch_index<span class="token punctuation">[</span>step<span class="token punctuation">]</span><span class="token punctuation">:</span>batch_index<span class="token punctuation">[</span>step <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                                   Y<span class="token punctuation">:</span> train_y<span class="token punctuation">[</span>batch_index<span class="token punctuation">[</span>step<span class="token punctuation">]</span><span class="token punctuation">:</span>batch_index<span class="token punctuation">[</span>step <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                                   keep_prob<span class="token punctuation">:</span> <span class="token number">0.5</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                                        <span class="token comment">#  ä½¿ç”¨feed_dictå®ŒæˆçŸ©é˜µä¹˜æ³• å¤„ç†å¤šè¾“å…¥</span>
                                        <span class="token comment">#  feed_dictçš„ä½œç”¨æ˜¯ç»™ä½¿ç”¨placeholderåˆ›å»ºå‡ºæ¥çš„tensorèµ‹å€¼</span>


                                        <span class="token comment">#  [batch_index[step]: batch_index[step + 1]]è¿™ä¸ªåŒºé—´çš„Xä¸Y</span>
                                        <span class="token comment">#  keep_probçš„æ„æ€æ˜¯ï¼šç•™ä¸‹çš„ç¥ç»å…ƒçš„æ¦‚ç‡ï¼Œå¦‚æœkeep_probä¸º0çš„è¯ï¼Œ å°±æ˜¯è®©æ‰€æœ‰çš„ç¥ç»å…ƒéƒ½å¤±æ´»ã€‚</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Number of iterations:"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token string">" loss:"</span><span class="token punctuation">,</span> loss_<span class="token punctuation">)</span>
                theloss<span class="token punctuation">.</span>append<span class="token punctuation">(</span>loss_<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"model_save: "</span><span class="token punctuation">,</span> saver<span class="token punctuation">.</span>save<span class="token punctuation">(</span>sess<span class="token punctuation">,</span> <span class="token string">'model_save2\\modle.ckpt'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The train has finished"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> theloss

    theloss <span class="token operator">=</span> train_lstm<span class="token punctuation">(</span><span class="token punctuation">)</span>

    
            <span class="token comment"># ç›¸å¯¹è¯¯å·®=ï¼ˆæµ‹é‡å€¼-è®¡ç®—å€¼ï¼‰/è®¡ç®—å€¼Ã—100%</span>
            test_y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>test_y<span class="token punctuation">)</span> <span class="token operator">*</span> std<span class="token punctuation">[</span>n1<span class="token punctuation">]</span> <span class="token operator">+</span> mean<span class="token punctuation">[</span>n1<span class="token punctuation">]</span>
            test_predict <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>test_predict<span class="token punctuation">)</span> <span class="token operator">*</span> std<span class="token punctuation">[</span>n1<span class="token punctuation">]</span> <span class="token operator">+</span> mean<span class="token punctuation">[</span>n1<span class="token punctuation">]</span>
            acc <span class="token operator">=</span> np<span class="token punctuation">.</span>average<span class="token punctuation">(</span>np<span class="token punctuation">.</span><span class="token builtin">abs</span><span class="token punctuation">(</span>test_predict <span class="token operator">-</span> test_y<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span>test_predict<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> test_y<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token builtin">len</span><span class="token punctuation">(</span>test_predict<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"é¢„æµ‹çš„ç›¸å¯¹è¯¯å·®:"</span><span class="token punctuation">,</span> acc<span class="token punctuation">)</span>

            <span class="token keyword">print</span><span class="token punctuation">(</span>theloss<span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>theloss<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> theloss<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'times'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'loss valuet'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'loss-----blue'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># ä»¥æŠ˜çº¿å›¾è¡¨ç¤ºé¢„æµ‹ç»“æœ</span>
            plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>test_predict<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> test_predict<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>test_y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> test_y<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'r'</span><span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'time value/day'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'close value/point'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'predict-----blue,real-----red'</span><span class="token punctuation">,</span> fontsize<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>



    prediction<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>éœ€è¦å®Œæ•´ä»£ç å·¥ç¨‹çš„åŒå­¦ï¼Œè¯·è”ç³»å­¦é•¿è·å–</strong></p> 
<h2><a id="3__293"></a>3 å®ç°æ•ˆæœ</h2> 
<h3><a id="31__295"></a>3.1 æ•°æ®</h3> 
<p>é‡‡é›†è‚¡ç¥¨æ•°æ®<br> <img src="https://images2.imgbox.com/f0/c1/dZOsHKje_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> ä»»é€‰å‡ æ”¯è‚¡ç¥¨ä½œä¸ºç ”ç©¶å¯¹è±¡ã€‚</p> 
<h3><a id="32__302"></a>3.2 é¢„æµ‹ç»“æœ</h3> 
<p><img src="https://images2.imgbox.com/3d/cf/wu2GazpI_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> <img src="https://images2.imgbox.com/dc/2a/DrYC5v5p_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> <img src="https://images2.imgbox.com/2b/ff/sUuHzkxN_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><img src="https://images2.imgbox.com/c9/e5/FwKyrlQF_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h5><a id="_312"></a>é¡¹ç›®è¿è¡Œå±•ç¤º</h5> 
<p>åºŸè¯ä¸å¤šè¯´, å…ˆå±•ç¤ºé¡¹ç›®è¿è¡Œç»“æœ, åé¢æ‰è¿›è¡ŒæŠ€æœ¯è®²è§£</p> 
<p>å¯¹æŸå…¬å¸çš„è‚¡ç¥¨è¿›è¡Œåˆ†æå’Œé¢„æµ‹ :<br> <img src="https://images2.imgbox.com/9b/ad/QtPVQm7w_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h5><a id="_321"></a>å¼€å‘ç¯å¢ƒ</h5> 
<p>å¦‚æœåªè¿è¡Œwebé¡¹ç›®ï¼Œåˆ™åªéœ€å®‰è£…å¦‚ä¸‹åŒ…ï¼š</p> 
<ul><li> <p>python 3.6.x</p> </li><li> <p>django &gt;= 2.1.4 ï¼ˆæˆ–è€…ä½¿ç”¨condaå®‰è£…æœ€æ–°ç‰ˆï¼‰</p> </li><li> <p>pandas &gt;= 0.23.4 ï¼ˆæˆ–è€…ä½¿ç”¨condaå®‰è£…æœ€æ–°ç‰ˆï¼‰</p> </li><li> <p>numpy &gt;= 1.15.2 ï¼ˆæˆ–è€…ä½¿ç”¨condaå®‰è£…æœ€æ–°ç‰ˆï¼‰<br> *apscheduler = 2.1.2 ï¼ˆè¯·ç”¨pip install apscheduler==2.1.2 å®‰è£…ï¼Œcondaè£…çš„ç‰ˆæœ¬ä¸å…¼å®¹ï¼‰<br> å¦‚æœéœ€è¦è®­ç»ƒæ¨¡å‹æˆ–è€…ä½¿ç”¨æ¨¡å‹æ¥é¢„æµ‹(æ³¨ï¼šéœ€è¦ä¿è¯æœ¬æœºæ‹¥æœ‰ NVIDIA GPUä»¥åŠæ˜¾å¡é©±åŠ¨)ï¼Œåˆ™è¿˜éœ€è¦å®‰è£…ï¼š</p> </li><li> <p>tensorflow-gpu &gt;= 1.10.0 ï¼ˆå¯ä»¥ä½¿ç”¨condaå®‰è£…æœ€æ–°ç‰ˆã€‚å¦‚ç”¨condaå®‰è£…ï¼Œcudatoolkitå’Œcudnnä¼šè¢«è‡ªåŠ¨å®‰è£…ï¼‰</p> </li><li> <p>cudatoolkit &gt;= 9.0 ï¼ˆæ ¹æ®è‡ªå·±æœ¬æœºçš„æ˜¾å¡å‹å·å†³å®šï¼Œè¯·å»NVIDIAå®˜ç½‘æŸ¥çœ‹ï¼‰</p> </li><li> <p>cudnn &gt;= 7.1.4 ï¼ˆç‰ˆæœ¬ä¸cudatoolkit9.0å¯¹åº”çš„ï¼Œå…¶ä»–ç‰ˆæœ¬è¯·å»NVIDIAå®˜ç½‘æŸ¥çœ‹å¯¹åº”çš„cudatoolkitç‰ˆæœ¬ï¼‰</p> </li><li> <p>keras &gt;= 2.2.2 ï¼ˆå¯ä»¥ä½¿ç”¨condaå®‰è£…æœ€æ–°ç‰ˆï¼‰</p> </li><li> <p>matplotlib &gt;= 2.2.2 ï¼ˆå¯ä»¥ä½¿ç”¨condaå®‰è£…æœ€æ–°ç‰ˆï¼‰</p> </li></ul> 
<h5><a id="_338"></a>æ•°æ®è·å–</h5> 
<p>è®­ç»ƒæ¨¡å‹çš„æ•°æ®ï¼Œå³10ä¸ªå…¬å¸çš„å†å²è‚¡ç¥¨æ•°æ®ã€‚è·å–å›½å†…ä¸Šå¸‚å…¬å¸å†å²è‚¡ç¥¨æ•°æ®, å¹¶ä»¥csvæ ¼å¼ä¿å­˜ä¸‹æ¥ã€‚csvæ ¼å¼æ–¹ä¾¿ç”¨pandasè¯»å–ï¼Œè¾“å…¥åˆ°LSTMç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œ ç”¨äºè®­ç»ƒæ¨¡å‹ä»¥åŠé¢„æµ‹è‚¡ç¥¨æ•°æ®ã€‚</p> 
<p>ğŸ§¿ <strong>é€‰é¢˜æŒ‡å¯¼, é¡¹ç›®åˆ†äº«ï¼š</strong></p> 
<p><a href="https://gitee.com/yaa-dc/warehouse-1/blob/master/python/README.md" rel="nofollow">https://gitee.com/yaa-dc/warehouse-1/blob/master/python/README.md</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/27bcdfe6f6f8c90d85eb64d0dd9237e2/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">SpringBoot å¦‚ä½•é…ç½® SSL</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/aa621dfc539067295fdb585610fe7c4d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">Camundaé€‚é…è¾¾æ¢¦æ•°æ®åº“</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 èœé¸Ÿç¨‹åºå‘˜åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>