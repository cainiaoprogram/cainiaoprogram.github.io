<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>unicode编码下CString、string、char*、int之间的相互转换 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="unicode编码下CString、string、char*、int之间的相互转换" />
<meta property="og:description" content="//unicode //CString转int CString m_cstr; int m_int; string m_str; m_cstr = L&#34;100&#34;; m_int = _ttoi(m_cstr);//_ttoi m_int = 100; m_cstr.Format(L&#34;%d&#34;, m_int);//Format //CString转string //方法一	string m_str2(CW2A(m_cstr.GetString())); //采用的方法 //方法二 CT2CA m_ct2ca(m_cstr); string m_str3(m_ct2ca); //方法三 wstring m_wstr(m_cstr); m_str.assign(m_wstr.begin(), m_wstr.end()); //方法四 m_str = CT2A(m_cstr.GetBuffer());//转化为非unicode. //string转CString /*c_str()和data()区别是：前者返回带&#39;/0&#39;的字符串，后者则返回不带&#39;/0&#39;的字符串*/ CString m_cstr2(m_str.c_str()); CString m_cstr3(m_str.data()); m_cstr = m_str.c_str(); m_cstr = m_str.data(); m_cstr.Format(L&#34;%s&#34;, m_str.c_str());//string-&gt;CString m_cstr.Format(L&#34;%s&#34;, m_str.data());//string-&gt;CString	//Unicode下CString转换为char*类型 char * m_chr; m_cstr = _T(&#34;hello&#34;); USES_CONVERSION; m_chr = T2A(m_cstr);//T2A m_chr = W2A(m_cstr);//W2A int n = m_cstr." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/3f2c77bb323ccf43180b126381cdb889/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-12-24T15:36:21+08:00" />
<meta property="article:modified_time" content="2018-12-24T15:36:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">unicode编码下CString、string、char*、int之间的相互转换</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <pre><code class="prism language-cpp"><span class="token comment">//unicode</span>
<span class="token comment">//CString转int  </span>
	CString m_cstr<span class="token punctuation">;</span>
	<span class="token keyword">int</span> m_int<span class="token punctuation">;</span>
	string m_str<span class="token punctuation">;</span>
	m_cstr <span class="token operator">=</span> L<span class="token string">"100"</span><span class="token punctuation">;</span>
	m_int <span class="token operator">=</span> <span class="token function">_ttoi</span><span class="token punctuation">(</span>m_cstr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//_ttoi</span>
	m_int <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
	m_cstr<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span>L<span class="token string">"%d"</span><span class="token punctuation">,</span> m_int<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Format</span>
	
	<span class="token comment">//CString转string</span>
	<span class="token comment">//方法一	</span>
	string <span class="token function">m_str2</span><span class="token punctuation">(</span><span class="token function">CW2A</span><span class="token punctuation">(</span>m_cstr<span class="token punctuation">.</span><span class="token function">GetString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//采用的方法</span>
	<span class="token comment">//方法二</span>
	CT2CA <span class="token function">m_ct2ca</span><span class="token punctuation">(</span>m_cstr<span class="token punctuation">)</span><span class="token punctuation">;</span>
	string <span class="token function">m_str3</span><span class="token punctuation">(</span>m_ct2ca<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//方法三</span>
	wstring <span class="token function">m_wstr</span><span class="token punctuation">(</span>m_cstr<span class="token punctuation">)</span><span class="token punctuation">;</span>
	m_str<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>m_wstr<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> m_wstr<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//方法四</span>
	m_str <span class="token operator">=</span> <span class="token function">CT2A</span><span class="token punctuation">(</span>m_cstr<span class="token punctuation">.</span><span class="token function">GetBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//转化为非unicode.</span>
	
	<span class="token comment">//string转CString</span>
	<span class="token comment">/*c_str()和data()区别是：前者返回带'/0'的字符串，后者则返回不带'/0'的字符串*/</span>
	CString <span class="token function">m_cstr2</span><span class="token punctuation">(</span>m_str<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	CString <span class="token function">m_cstr3</span><span class="token punctuation">(</span>m_str<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	m_cstr <span class="token operator">=</span> m_str<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	m_cstr <span class="token operator">=</span> m_str<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	m_cstr<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span>L<span class="token string">"%s"</span><span class="token punctuation">,</span> m_str<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//string-&gt;CString</span>
	m_cstr<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span>L<span class="token string">"%s"</span><span class="token punctuation">,</span> m_str<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//string-&gt;CString	</span>

	<span class="token comment">//Unicode下CString转换为char*类型</span>
	<span class="token keyword">char</span> <span class="token operator">*</span> m_chr<span class="token punctuation">;</span>
	m_cstr <span class="token operator">=</span> <span class="token function">_T</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	USES_CONVERSION<span class="token punctuation">;</span>
	m_chr <span class="token operator">=</span> <span class="token function">T2A</span><span class="token punctuation">(</span>m_cstr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//T2A</span>
	m_chr <span class="token operator">=</span> <span class="token function">W2A</span><span class="token punctuation">(</span>m_cstr<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//W2A</span>

	<span class="token keyword">int</span> n <span class="token operator">=</span> m_cstr<span class="token punctuation">.</span><span class="token function">GetLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//按字符计算，m_cstr的长度</span>
	<span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">WideCharToMultiByte</span><span class="token punctuation">(</span>CP_ACP<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> m_cstr<span class="token punctuation">,</span> n<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//按Byte计算m_cstr长度</span>
	<span class="token keyword">char</span> <span class="token operator">*</span>chr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">char</span><span class="token punctuation">[</span>len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//按字节为单位</span>
	<span class="token function">WideCharToMultiByte</span><span class="token punctuation">(</span>CP_ACP<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> m_cstr<span class="token punctuation">,</span> n<span class="token punctuation">,</span> chr<span class="token punctuation">,</span> len<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//宽字节转换为多字节编码</span>
	chr<span class="token punctuation">[</span>len<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span> <span class="token comment">//不要忽略末尾结束标志</span>
	<span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> chr<span class="token punctuation">;</span>
	
	<span class="token comment">//Unicode下char*转换为CString类型</span>
	m_chr <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>
	m_cstr <span class="token operator">=</span> <span class="token function">A2T</span><span class="token punctuation">(</span>m_chr<span class="token punctuation">)</span><span class="token punctuation">;</span>
	m_cstr <span class="token operator">=</span> <span class="token function">A2W</span><span class="token punctuation">(</span>m_chr<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">int</span> charLen <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>m_chr<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//计算pChar所指向的字符串大小，以字节为单位，一个汉字占两个字节  </span>
	<span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">MultiByteToWideChar</span><span class="token punctuation">(</span>CP_ACP<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> m_chr<span class="token punctuation">,</span> charLen<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//计算多字节字符的大小，按字符计算  </span>
	<span class="token keyword">wchar_t</span> <span class="token operator">*</span>pWChar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">wchar_t</span><span class="token punctuation">[</span>len <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//为宽字节字符数申请空间，  </span>
	<span class="token function">MultiByteToWideChar</span><span class="token punctuation">(</span>CP_ACP<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> m_chr<span class="token punctuation">,</span> charLen<span class="token punctuation">,</span> pWChar<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//多字节编码转换成宽字节编码  </span>
	pWChar<span class="token punctuation">[</span>len<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span>
	m_cstr<span class="token punctuation">.</span><span class="token function">Append</span><span class="token punctuation">(</span>pWChar<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">delete</span><span class="token punctuation">[</span><span class="token punctuation">]</span> pWChar<span class="token punctuation">;</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/98575ef4ff40a39359fbac694f30e90b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">面试官让用5种python方法实现字符串反转？对不起我有16种……</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ef433cf494bcf79679e388d1ee5d7951/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C&#43;&#43;修改图片的尺寸</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>