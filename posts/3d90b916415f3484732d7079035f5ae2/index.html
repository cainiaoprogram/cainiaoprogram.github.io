<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>android捕获异常并保存到sd卡文件目录里 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="android捕获异常并保存到sd卡文件目录里" />
<meta property="og:description" content="/** * UncaughtException处理类,当程序发生Uncaught异常的时候,有该类来接管程序,并记录发送错误报告. * * @author user */ public class CrashHandler implements UncaughtExceptionHandler { /** tag */ public static final String TAG = &#34;CrashHandler&#34;; // CrashHandler实例 private static CrashHandler instance = new CrashHandler(); private final int sleepDuration = 3000; // 系统默认的UncaughtException处理类 private Thread.UncaughtExceptionHandler mDefaultHandler; // 程序的Context对象 private Context mContext; // 用来存储设备信息和异常信息 private Map&lt;String, String&gt; infos = new HashMap&lt;String, String&gt;(); // 用于格式化日期,作为日志文件名的一部分 private DateFormat formatter = new SimpleDateFormat(&#34;yyyy-MM-dd-HH-mm-ss&#34;); /** 保证只有一个CrashHandler实例 */ private CrashHandler() { } /** * 获取CrashHandler实例 ,单例模式 * * @return CrashHandler实例 */ public static CrashHandler getInstance() { return instance; } /** * 初始化 * * @param context * 上下文 */ public void init(Context context) { mContext = context; // 获取系统默认的UncaughtException处理器 mDefaultHandler = Thread." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/3d90b916415f3484732d7079035f5ae2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-09-07T15:03:23+08:00" />
<meta property="article:modified_time" content="2015-09-07T15:03:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">android捕获异常并保存到sd卡文件目录里</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <pre style="background-color:#2b2b2b; color:#a9b7c6; font-family:'Consolas'; font-size:10.5pt"><span style="color:#629755"><em>/**
</em></span><span style="color:#629755"><em> * UncaughtException</em></span><span style="color:#629755; font-family:'宋体'"><em>处理类</em></span><span style="color:#629755"><em>,</em></span><span style="color:#629755; font-family:'宋体'"><em>当程序发生</em></span><span style="color:#629755"><em>Uncaught</em></span><span style="color:#629755; font-family:'宋体'"><em>异常的时候</em></span><span style="color:#629755"><em>,</em></span><span style="color:#629755; font-family:'宋体'"><em>有该类来接管程序</em></span><span style="color:#629755"><em>,</em></span><span style="color:#629755; font-family:'宋体'"><em>并记录发送错误报告</em></span><span style="color:#629755"><em>.
</em></span><span style="color:#629755"><em> * 
</em></span><span style="color:#629755"><em> * </em></span><span style="color:#629755"><strong><em>@author </em></strong></span><span style="color:#629755"><em>user
</em></span><span style="color:#629755"><em> */
</em></span><span style="color:#cc7832">public class </span>CrashHandler <span style="color:#cc7832">implements </span>UncaughtExceptionHandler
{
    <span style="color:#629755"><em>/** tag */
</em></span><span style="color:#629755"><em>    </em></span><span style="color:#cc7832">public static final </span>String <span style="color:#9876aa"><em>TAG </em></span>= <span style="color:#6a8759">"CrashHandler"</span><span style="color:#cc7832">;
</span><span style="color:#cc7832">
</span><span style="color:#cc7832">    </span><span style="color:#808080">// CrashHandler</span><span style="color:#808080; font-family:'宋体'">实例
</span><span style="color:#808080; font-family:'宋体'">    </span><span style="color:#cc7832">private static </span>CrashHandler <span style="color:#9876aa"><em>instance </em></span>= <span style="color:#cc7832">new </span>CrashHandler()<span style="color:#cc7832">;
</span><span style="color:#cc7832">
</span><span style="color:#cc7832">    private final int </span><span style="color:#9876aa">sleepDuration </span>= <span style="color:#6897bb">3000</span><span style="color:#cc7832">;
</span><span style="color:#cc7832">
</span><span style="color:#cc7832">    </span><span style="color:#808080">// </span><span style="color:#808080; font-family:'宋体'">系统默认的</span><span style="color:#808080">UncaughtException</span><span style="color:#808080; font-family:'宋体'">处理类
</span><span style="color:#808080; font-family:'宋体'">    </span><span style="color:#cc7832">private </span>Thread.UncaughtExceptionHandler <span style="color:#9876aa">mDefaultHandler</span><span style="color:#cc7832">;
</span><span style="color:#cc7832">
</span><span style="color:#cc7832">    </span><span style="color:#808080">// </span><span style="color:#808080; font-family:'宋体'">程序的</span><span style="color:#808080">Context</span><span style="color:#808080; font-family:'宋体'">对象
</span><span style="color:#808080; font-family:'宋体'">    </span><span style="color:#cc7832">private </span>Context <span style="color:#9876aa">mContext</span><span style="color:#cc7832">;
</span><span style="color:#cc7832">
</span><span style="color:#cc7832">    </span><span style="color:#808080">// </span><span style="color:#808080; font-family:'宋体'">用来存储设备信息和异常信息
</span><span style="color:#808080; font-family:'宋体'">    </span><span style="color:#cc7832">private </span>Map&lt;String<span style="color:#cc7832">, </span>String&gt; <span style="color:#9876aa">infos </span>= <span style="color:#cc7832">new </span>HashMap&lt;String<span style="color:#cc7832">, </span>String&gt;()<span style="color:#cc7832">;
</span><span style="color:#cc7832">
</span><span style="color:#cc7832">    </span><span style="color:#808080">// </span><span style="color:#808080; font-family:'宋体'">用于格式化日期</span><span style="color:#808080">,</span><span style="color:#808080; font-family:'宋体'">作为日志文件名的一部分
</span><span style="color:#808080; font-family:'宋体'">    </span><span style="color:#cc7832">private </span>DateFormat <span style="color:#9876aa">formatter </span>= <span style="color:#cc7832">new </span>SimpleDateFormat(<span style="color:#6a8759">"yyyy-MM-dd-HH-mm-ss"</span>)<span style="color:#cc7832">;
</span><span style="color:#cc7832">
</span><span style="color:#cc7832">    </span><span style="color:#629755"><em>/** </em></span><span style="color:#629755; font-family:'宋体'"><em>保证只有一个</em></span><span style="color:#629755"><em>CrashHandler</em></span><span style="color:#629755; font-family:'宋体'"><em>实例 </em></span><span style="color:#629755"><em>*/
</em></span><span style="color:#629755"><em>    </em></span><span style="color:#cc7832">private </span>CrashHandler()
    {
    }

    <span style="color:#629755"><em>/**
</em></span><span style="color:#629755"><em>     * </em></span><span style="color:#629755; font-family:'宋体'"><em>获取</em></span><span style="color:#629755"><em>CrashHandler</em></span><span style="color:#629755; font-family:'宋体'"><em>实例 </em></span><span style="color:#629755"><em>,</em></span><span style="color:#629755; font-family:'宋体'"><em>单例模式
</em></span><span style="color:#629755; font-family:'宋体'"><em>     </em></span><span style="color:#629755"><em>*
</em></span><span style="color:#629755"><em>     * </em></span><span style="color:#629755"><strong><em>@return </em></strong></span><span style="color:#629755"><em>CrashHandler</em></span><span style="color:#629755; font-family:'宋体'"><em>实例
</em></span><span style="color:#629755; font-family:'宋体'"><em>     </em></span><span style="color:#629755"><em>*/
</em></span><span style="color:#629755"><em>    </em></span><span style="color:#cc7832">public static </span>CrashHandler <span style="color:#ffc66d">getInstance</span>()
    {
        <span style="color:#cc7832">return </span><span style="color:#9876aa"><em>instance</em></span><span style="color:#cc7832">;
</span><span style="color:#cc7832">    </span>}

    <span style="color:#629755"><em>/**
</em></span><span style="color:#629755"><em>     * </em></span><span style="color:#629755; font-family:'宋体'"><em>初始化
</em></span><span style="color:#629755; font-family:'宋体'"><em>     </em></span><span style="color:#629755"><em>* 
</em></span><span style="color:#629755"><em>     * </em></span><span style="color:#629755"><strong><em>@param </em></strong></span><span style="color:#8a653b"><em>context
</em></span><span style="color:#8a653b"><em>     </em></span><span style="color:#629755"><em>*            </em></span><span style="color:#629755; font-family:'宋体'"><em>上下文
</em></span><span style="color:#629755; font-family:'宋体'"><em>     </em></span><span style="color:#629755"><em>*/
</em></span><span style="color:#629755"><em>    </em></span><span style="color:#cc7832">public void </span><span style="color:#ffc66d">init</span>(Context context)
    {
        <span style="color:#9876aa">mContext </span>= context<span style="color:#cc7832">;
</span><span style="color:#cc7832">        </span><span style="color:#808080">// </span><span style="color:#808080; font-family:'宋体'">获取系统默认的</span><span style="color:#808080">UncaughtException</span><span style="color:#808080; font-family:'宋体'">处理器
</span><span style="color:#808080; font-family:'宋体'">        </span><span style="color:#9876aa">mDefaultHandler </span>= Thread.<span style="font-style:italic">getDefaultUncaughtExceptionHandler</span>()<span style="color:#cc7832">;
</span><span style="color:#cc7832">        </span><span style="color:#808080">// </span><span style="color:#808080; font-family:'宋体'">设置该</span><span style="color:#808080">CrashHandler</span><span style="color:#808080; font-family:'宋体'">为程序的默认处理器
</span><span style="color:#808080; font-family:'宋体'">        </span>Thread.<span style="font-style:italic">setDefaultUncaughtExceptionHandler</span>(<span style="color:#cc7832">this</span>)<span style="color:#cc7832">;
</span><span style="color:#cc7832">    </span>}

    <span style="color:#629755"><em>/**
</em></span><span style="color:#629755"><em>     * </em></span><span style="color:#629755; font-family:'宋体'"><em>当</em></span><span style="color:#629755"><em>UncaughtException</em></span><span style="color:#629755; font-family:'宋体'"><em>发生时会转入该函数来处理
</em></span><span style="color:#629755; font-family:'宋体'"><em>     </em></span><span style="color:#629755"><em>*/
</em></span><span style="color:#629755"><em>    </em></span><span style="color:#bbb529">@Override
</span><span style="color:#bbb529">    </span><span style="color:#cc7832">public void </span><span style="color:#ffc66d">uncaughtException</span>(Thread thread<span style="color:#cc7832">, </span>Throwable ex)
    {
        LogUtil.<span style="font-style:italic">w</span>(<span style="color:#9876aa"><em>TAG</em></span><span style="color:#cc7832">, </span><span style="color:#6a8759">"uncaughtException"</span>)<span style="color:#cc7832">;
</span><span style="color:#cc7832">        if </span>(!handleException(ex) &amp;&amp; <span style="color:#9876aa">mDefaultHandler </span>!= <span style="color:#cc7832">null</span>)
        {
            <span style="color:#808080">// </span><span style="color:#808080; font-family:'宋体'">如果用户没有处理则让系统默认的异常处理器来处理
</span><span style="color:#808080; font-family:'宋体'">            </span><span style="color:#9876aa">mDefaultHandler</span>.uncaughtException(thread<span style="color:#cc7832">, </span>ex)<span style="color:#cc7832">;
</span><span style="color:#cc7832">        </span>}
        <span style="color:#cc7832">else
</span><span style="color:#cc7832">        </span>{
            <span style="color:#cc7832">try
</span><span style="color:#cc7832">            </span>{
                Thread.<span style="font-style:italic">sleep</span>(<span style="color:#9876aa">sleepDuration</span>)<span style="color:#cc7832">;
</span><span style="color:#cc7832">            </span>}
            <span style="color:#cc7832">catch </span>(InterruptedException e)
            {
                LogUtil.<span style="font-style:italic">e</span>(<span style="color:#9876aa"><em>TAG</em></span><span style="color:#cc7832">, </span><span style="color:#6a8759">"error : "</span><span style="color:#cc7832">, </span>e)<span style="color:#cc7832">;
</span><span style="color:#cc7832">            </span>}
            <span style="color:#808080">// </span><span style="color:#808080; font-family:'宋体'">退出程序
</span><span style="color:#808080; font-family:'宋体'">            </span>android.os.Process.<span style="font-style:italic">killProcess</span>(android.os.Process.<span style="font-style:italic">myPid</span>())<span style="color:#cc7832">;
</span><span style="color:#cc7832">            </span>System.<span style="font-style:italic">exit</span>(<span style="color:#6897bb">1</span>)<span style="color:#cc7832">;
</span><span style="color:#cc7832">        </span>}
    }

    <span style="color:#629755"><em>/**
</em></span><span style="color:#629755"><em>     * </em></span><span style="color:#629755; font-family:'宋体'"><em>自定义错误处理</em></span><span style="color:#629755"><em>,</em></span><span style="color:#629755; font-family:'宋体'"><em>收集错误信息 发送错误报告等操作均在此完成</em></span><span style="color:#629755"><em>.
</em></span><span style="color:#629755"><em>     * 
</em></span><span style="color:#629755"><em>     * </em></span><span style="color:#629755"><strong><em>@param </em></strong></span><span style="color:#8a653b"><em>ex </em></span><span style="color:#629755; font-family:'宋体'"><em>错误信息
</em></span><span style="color:#629755; font-family:'宋体'"><em>     </em></span><span style="color:#629755"><em>* </em></span><span style="color:#629755"><strong><em>@return </em></strong></span><span style="color:#629755"><em>true:</em></span><span style="color:#629755; font-family:'宋体'"><em>如果处理了该异常信息</em></span><span style="color:#629755"><em>;</em></span><span style="color:#629755; font-family:'宋体'"><em>否则返回</em></span><span style="color:#629755"><em>false.
</em></span><span style="color:#629755"><em>     */
</em></span><span style="color:#629755"><em>    </em></span><span style="color:#cc7832">private boolean </span><span style="color:#ffc66d">handleException</span>(Throwable ex)
    {
        LogUtil.<span style="font-style:italic">w</span>(<span style="color:#9876aa"><em>TAG</em></span><span style="color:#cc7832">, </span><span style="color:#6a8759">"handleException"</span>)<span style="color:#cc7832">;
</span><span style="color:#cc7832">        if </span>(ex == <span style="color:#cc7832">null</span>)
        {
            <span style="color:#cc7832">return false;
</span><span style="color:#cc7832">        </span>}
        ex.printStackTrace()<span style="color:#cc7832">;
</span><span style="color:#cc7832">        </span><span style="color:#808080">// </span><span style="color:#808080; font-family:'宋体'">使用</span><span style="color:#808080">Toast</span><span style="color:#808080; font-family:'宋体'">来显示异常信息
</span><span style="color:#808080; font-family:'宋体'">        </span><span style="color:#cc7832">new </span>Thread()
        {
            <span style="color:#bbb529">@Override
</span><span style="color:#bbb529">            </span><span style="color:#cc7832">public void </span><span style="color:#ffc66d">run</span>()
            {
                Looper.<span style="font-style:italic">prepare</span>()<span style="color:#cc7832">;
</span><span style="color:#cc7832">                </span>Toast.<span style="font-style:italic">makeText</span>(<span style="color:#9876aa">mContext</span><span style="color:#cc7832">, </span><span style="color:#6a8759">"</span><span style="color:#6a8759; font-family:'宋体'">很抱歉</span><span style="color:#6a8759">,</span><span style="color:#6a8759; font-family:'宋体'">程序出现异常</span><span style="color:#6a8759">,</span><span style="color:#6a8759; font-family:'宋体'">即将退出</span><span style="color:#6a8759">."</span><span style="color:#cc7832">, </span>Toast.<span style="color:#9876aa"><em>LENGTH_LONG</em></span>)
                        .show()<span style="color:#cc7832">;
</span><span style="color:#cc7832">                </span>Looper.<span style="font-style:italic">loop</span>()<span style="color:#cc7832">;
</span><span style="color:#cc7832">            </span>}
        }.start()<span style="color:#cc7832">;
</span><span style="color:#cc7832">        </span><span style="color:#808080">// </span><span style="color:#808080; font-family:'宋体'">收集设备参数信息
</span><span style="color:#808080; font-family:'宋体'">        </span>collectDeviceInfo(<span style="color:#9876aa">mContext</span>)<span style="color:#cc7832">;
</span><span style="color:#cc7832">        </span><span style="color:#808080">// </span><span style="color:#808080; font-family:'宋体'">保存日志文件
</span><span style="color:#808080; font-family:'宋体'">        </span>saveCrashInfoToFile(ex)<span style="color:#cc7832">;
</span><span style="color:#cc7832">        return true;
</span><span style="color:#cc7832">    </span>}

    <span style="color:#629755"><em>/**
</em></span><span style="color:#629755"><em>     * </em></span><span style="color:#629755; font-family:'宋体'"><em>收集设备参数信息
</em></span><span style="color:#629755; font-family:'宋体'"><em>     </em></span><span style="color:#629755"><em>* 
</em></span><span style="color:#629755"><em>     * </em></span><span style="color:#629755"><strong><em>@param </em></strong></span><span style="color:#8a653b"><em>ctx
</em></span><span style="color:#8a653b"><em>     </em></span><span style="color:#629755"><em>*            </em></span><span style="color:#629755; font-family:'宋体'"><em>上下文
</em></span><span style="color:#629755; font-family:'宋体'"><em>     </em></span><span style="color:#629755"><em>*/
</em></span><span style="color:#629755"><em>    </em></span><span style="color:#cc7832">public void </span><span style="color:#ffc66d">collectDeviceInfo</span>(Context ctx)
    {
        LogUtil.<span style="font-style:italic">w</span>(<span style="color:#9876aa"><em>TAG</em></span><span style="color:#cc7832">, </span><span style="color:#6a8759">"collectDeviceInfo"</span>)<span style="color:#cc7832">;
</span><span style="color:#cc7832">        try
</span><span style="color:#cc7832">        </span>{
            PackageManager pm = ctx.getPackageManager()<span style="color:#cc7832">;
</span><span style="color:#cc7832">            </span>PackageInfo pi = pm.getPackageInfo(ctx.getPackageName()<span style="color:#cc7832">,
</span><span style="color:#cc7832">                    </span>PackageManager.<span style="color:#9876aa"><em>GET_ACTIVITIES</em></span>)<span style="color:#cc7832">;
</span><span style="color:#cc7832">            if </span>(pi != <span style="color:#cc7832">null</span>)
            {
                String versionName = pi.<span style="color:#9876aa">versionName </span>== <span style="color:#cc7832">null </span>? <span style="color:#6a8759">"null"
</span><span style="color:#6a8759">                        </span>: pi.<span style="color:#9876aa">versionName</span><span style="color:#cc7832">;
</span><span style="color:#cc7832">                </span>String versionCode = pi.<span style="color:#9876aa">versionCode </span>+ <span style="color:#6a8759">""</span><span style="color:#cc7832">;
</span><span style="color:#cc7832">                </span><span style="color:#9876aa">infos</span>.put(<span style="color:#6a8759">"versionName"</span><span style="color:#cc7832">, </span>versionName)<span style="color:#cc7832">;
</span><span style="color:#cc7832">                </span><span style="color:#9876aa">infos</span>.put(<span style="color:#6a8759">"versionCode"</span><span style="color:#cc7832">, </span>versionCode)<span style="color:#cc7832">;
</span><span style="color:#cc7832">            </span>}
        }
        <span style="color:#cc7832">catch </span>(NameNotFoundException e)
        {
            LogUtil.<span style="font-style:italic">e</span>(<span style="color:#9876aa"><em>TAG</em></span><span style="color:#cc7832">, </span><span style="color:#6a8759">"an error occured when collect package info"</span><span style="color:#cc7832">, </span>e)<span style="color:#cc7832">;
</span><span style="color:#cc7832">        </span>}
        Field[] fields = Build.<span style="color:#cc7832">class</span>.getDeclaredFields()<span style="color:#cc7832">;
</span><span style="color:#cc7832">        for </span>(Field field : fields)
        {
            <span style="color:#cc7832">try
</span><span style="color:#cc7832">            </span>{
                field.setAccessible(<span style="color:#cc7832">true</span>)<span style="color:#cc7832">;
</span><span style="color:#cc7832">                </span><span style="color:#9876aa">infos</span>.put(field.getName()<span style="color:#cc7832">, </span>field.get(<span style="color:#cc7832">null</span>).toString())<span style="color:#cc7832">;
</span><span style="color:#cc7832">                </span>LogUtil.<span style="font-style:italic">d</span>(<span style="color:#9876aa"><em>TAG</em></span><span style="color:#cc7832">, </span>field.getName() + <span style="color:#6a8759">" : " </span>+ field.get(<span style="color:#cc7832">null</span>))<span style="color:#cc7832">;
</span><span style="color:#cc7832">            </span>}
            <span style="color:#cc7832">catch </span>(Exception e)
            {
                LogUtil.<span style="font-style:italic">e</span>(<span style="color:#9876aa"><em>TAG</em></span><span style="color:#cc7832">, </span><span style="color:#6a8759">"an error occured when collect crash info"</span><span style="color:#cc7832">, </span>e)<span style="color:#cc7832">;
</span><span style="color:#cc7832">            </span>}
        }
    }

    <span style="color:#629755"><em>/**
</em></span><span style="color:#629755"><em>     * </em></span><span style="color:#629755; font-family:'宋体'"><em>保存错误信息到文件中
</em></span><span style="color:#629755; font-family:'宋体'"><em>     </em></span><span style="color:#629755"><em>* 
</em></span><span style="color:#629755"><em>     * </em></span><span style="color:#629755"><strong><em>@param </em></strong></span><span style="color:#8a653b"><em>ex
</em></span><span style="color:#8a653b"><em>     </em></span><span style="color:#629755"><em>* </em></span><span style="color:#629755"><strong><em>@return </em></strong></span><span style="color:#629755; font-family:'宋体'"><em>返回文件名称</em></span><span style="color:#629755"><em>,</em></span><span style="color:#629755; font-family:'宋体'"><em>便于将文件传送到服务器
</em></span><span style="color:#629755; font-family:'宋体'"><em>     </em></span><span style="color:#629755"><em>*/
</em></span><span style="color:#629755"><em>    </em></span><span style="color:#cc7832">private </span>String <span style="color:#ffc66d">saveCrashInfoToFile</span>(Throwable ex)
    {
        LogUtil.<span style="font-style:italic">w</span>(<span style="color:#9876aa"><em>TAG</em></span><span style="color:#cc7832">, </span><span style="color:#6a8759">"saveCrashInfo2File"</span>)<span style="color:#cc7832">;
</span><span style="color:#cc7832">        </span>StringBuffer sb = <span style="color:#cc7832">new </span>StringBuffer()<span style="color:#cc7832">;
</span><span style="color:#cc7832">        for </span>(Map.Entry&lt;String<span style="color:#cc7832">, </span>String&gt; entry : <span style="color:#9876aa">infos</span>.entrySet())
        {
            String key = entry.getKey()<span style="color:#cc7832">;
</span><span style="color:#cc7832">            </span>String value = entry.getValue()<span style="color:#cc7832">;
</span><span style="color:#cc7832">            </span>sb.append(key + <span style="color:#6a8759">"=" </span>+ value + <span style="color:#6a8759">"</span><span style="color:#cc7832">\n</span><span style="color:#6a8759">"</span>)<span style="color:#cc7832">;
</span><span style="color:#cc7832">        </span>}

        Writer writer = <span style="color:#cc7832">new </span>StringWriter()<span style="color:#cc7832">;
</span><span style="color:#cc7832">        </span>PrintWriter printWriter = <span style="color:#cc7832">new </span>PrintWriter(writer)<span style="color:#cc7832">;
</span><span style="color:#cc7832">        </span>ex.printStackTrace(printWriter)<span style="color:#cc7832">;
</span><span style="color:#cc7832">        </span>Throwable cause = ex.getCause()<span style="color:#cc7832">;
</span><span style="color:#cc7832">        while </span>(cause != <span style="color:#cc7832">null</span>)
        {
            cause.printStackTrace(printWriter)<span style="color:#cc7832">;
</span><span style="color:#cc7832">            </span>cause = cause.getCause()<span style="color:#cc7832">;
</span><span style="color:#cc7832">        </span>}
        printWriter.close()<span style="color:#cc7832">;
</span><span style="color:#cc7832">        </span>String result = writer.toString()<span style="color:#cc7832">;
</span><span style="color:#cc7832">        </span>sb.append(result)<span style="color:#cc7832">;
</span><span style="color:#cc7832">        try
</span><span style="color:#cc7832">        </span>{
            <span style="color:#cc7832">long </span>timestamp = System.<span style="font-style:italic">currentTimeMillis</span>()<span style="color:#cc7832">;
</span><span style="color:#cc7832">            </span>String time = <span style="color:#9876aa">formatter</span>.format(<span style="color:#cc7832">new </span>Date())<span style="color:#cc7832">;
</span><span style="color:#cc7832">            </span>String fileName = <span style="color:#6a8759">"crash-" </span>+ time + <span style="color:#6a8759">"-" </span>+ timestamp + <span style="color:#6a8759">".log"</span><span style="color:#cc7832">;
</span><span style="color:#cc7832">            if </span>(Environment.<span style="font-style:italic">getExternalStorageState</span>().equals(
                    Environment.<span style="color:#9876aa"><em>MEDIA_MOUNTED</em></span>))
            {
                String path = "保存路径"<span style="color:#cc7832">;
</span><span style="color:#cc7832">                </span>File dir = <span style="color:#cc7832">new </span>File(path)<span style="color:#cc7832">;
</span><span style="color:#cc7832">                if </span>(!dir.exists())
                {
                    dir.mkdirs()<span style="color:#cc7832">;
</span><span style="color:#cc7832">                </span>}
                FileOutputStream fos = <span style="color:#cc7832">new </span>FileOutputStream(path + fileName)<span style="color:#cc7832">;
</span><span style="color:#cc7832">                </span>fos.write(sb.toString().getBytes())<span style="color:#cc7832">;
</span><span style="color:#cc7832">                </span>fos.close()<span style="color:#cc7832">;
</span><span style="color:#cc7832">            </span>}
            <span style="color:#cc7832">return </span>fileName<span style="color:#cc7832">;
</span><span style="color:#cc7832">        </span>}
        <span style="color:#cc7832">catch </span>(Exception e)
        {
            LogUtil.<span style="font-style:italic">e</span>(<span style="color:#9876aa"><em>TAG</em></span><span style="color:#cc7832">, </span><span style="color:#6a8759">"an error occured while writing file..."</span><span style="color:#cc7832">, </span>e)<span style="color:#cc7832">;
</span><span style="color:#cc7832">        </span>}
        <span style="color:#cc7832">return null;
</span><span style="color:#cc7832">    </span>}
}
</pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/337dc840ea56d2f6f0030aaec437759f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">js和java交互中文乱码解决办法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7b437fe619611fc1ca0eeee3556f53e1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java RMI 框架（远程方法调用）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>