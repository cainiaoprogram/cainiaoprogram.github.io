<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于Prometheus&#43;Grafana搭建监控平台（Windows/Linux环境exporter部署） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="基于Prometheus&#43;Grafana搭建监控平台（Windows/Linux环境exporter部署）" />
<meta property="og:description" content="待优化：添加端口及防火墙开放配置 1. 介绍 1.1 Prometheus是什么?Prometheus（普罗米修斯）是一个最初在SoundCloud上构建的监控系统。自2012年成为社区开源项目，拥有非常活跃的开发人员和用户社区。为强调开源及独立维护，Prometheus于2016年加入云原生云计算基金会（CNCF），成为继Kubernetes之后的第二个托管项目。
Prometheus - Monitoring system &amp; time series database
Prometheus · GitHub
作为新一代的监控框架，Prometheus 具有以下特点：
• 多维数据模型：由度量名称和键值对标识的时间序列数据
• PromSQL：一种灵活的查询语言，可以利用多维数据完成复杂的查询
• 不依赖分布式存储，单个服务器节点可直接工作
• 基于HTTP的pull方式采集时间序列数据
• 推送时间序列数据通过PushGateway组件支持
• 通过服务发现或静态配置发现目标
• 多种图形模式及仪表盘支持
Prometheus适用于以机器为中心的监控以及高度动态面向服务架构的监控。
1.2 Grafana是什么？ Grafana是一个开源的度量分析和可视化系统。
Grafana支持查询普罗米修斯。自Grafana 2.5.0（2015-10-28）以来，包含了Prometheus的Grafana数据源。
Download Grafana | Grafana Labs
从Grafana.com导入预先构建的仪表板。
Grafana.com维护着一组共享仪表板 ，可以下载并与Grafana的独立实例一起使用。
https://grafana.com/dashboards/9276
简单来说：Grafana提供了比Prometheus更加友好美观的展示界面
2. Prometheus&#43;Grafana安装 2.1 组件 组件说明prometheus-2.41.0.windows-amd64监控server端，用于汇总展示各收集器的资源情况（界面丑）grafana-enterprise-8.2.2.windows-amd64度量分析可视化系统，仪表盘多，替换prometheus默认展示界面 2.2 安装包下载 Prometheus下载地址：https://prometheus.io/download/
​ grafana下载： https://grafana.com/grafana/download?platform=windows
2.3 百度云网盘下载地址 Promethe&#43;Grafana ：https://pan.baidu.com/s/1s03HZ9AlMNbWQKc9-QisUw?pwd=bk1k
2.4 Prometheus 安装 2.4.1 部署配置Prometheus 在全英文路径下解压prometheus-2.41.0.windows-amd64.zip修改prometheus.yml，将localhost改为127.0.0.1，避免出现莫名其妙的问题（其它涉及到localhost的配置，也是改为127.0.0.1） 以管理员身份运行 prometheus." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ed88c12d82637827428a2000d9959d4c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-15T11:09:31+08:00" />
<meta property="article:modified_time" content="2023-05-15T11:09:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于Prometheus&#43;Grafana搭建监控平台（Windows/Linux环境exporter部署）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 id="%E5%BE%85%E4%BC%98%E5%8C%96%EF%BC%9A%E6%B7%BB%E5%8A%A0%E7%AB%AF%E5%8F%A3%E5%8F%8A%E9%98%B2%E7%81%AB%E5%A2%99%E5%BC%80%E6%94%BE%E9%85%8D%E7%BD%AE"><span style="color:#fe2c24;">待优化：添加端口及防火墙开放配置</span></h2> 
<p></p> 
<h2 id="1.%20%E4%BB%8B%E7%BB%8D">1. 介绍</h2> 
<p>1.1 Prometheus是什么?Prometheus（普罗米修斯）是一个最初在SoundCloud上构建的监控系统。自2012年成为社区开源项目，拥有非常活跃的开发人员和用户社区。为强调开源及独立维护，Prometheus于2016年加入云原生云计算基金会（CNCF），成为继Kubernetes之后的第二个托管项目。</p> 
<p><img alt="" height="866" src="https://images2.imgbox.com/e0/dc/LXN2BYgD_o.png" width="1200"></p> 
<p><a href="https://prometheus.io" rel="nofollow" title="Prometheus - Monitoring system &amp; time series database">Prometheus - Monitoring system &amp; time series database</a></p> 
<p><a href="https://github.com/prometheus" title="Prometheus · GitHub">Prometheus · GitHub</a></p> 
<p>作为新一代的监控框架，Prometheus 具有以下特点：</p> 
<blockquote> 
 <p>    • 多维数据模型：由度量名称和键值对标识的时间序列数据</p> 
 <p>    • PromSQL：一种灵活的查询语言，可以利用多维数据完成复杂的查询</p> 
 <p>    • 不依赖分布式存储，单个服务器节点可直接工作</p> 
 <p>    • 基于HTTP的pull方式采集时间序列数据</p> 
 <p>    • 推送时间序列数据通过PushGateway组件支持</p> 
 <p>    • 通过服务发现或静态配置发现目标</p> 
 <p>    • 多种图形模式及仪表盘支持</p> 
</blockquote> 
<p><strong> Prometheus适用于以机器为中心的监控以及高度动态面向服务架构的监控。</strong></p> 
<h3 id="1.2%20Grafana%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F">1.2 Grafana是什么？</h3> 
<p><strong>Grafana是一个开源的度量分析和可视化系统。</strong></p> 
<p>Grafana支持查询普罗米修斯。自Grafana 2.5.0（2015-10-28）以来，包含了Prometheus的Grafana数据源。</p> 
<p><img alt="" height="385" src="https://images2.imgbox.com/15/6f/p0DdtLre_o.png" width="855"></p> 
<p>  <a href="https://grafana.com/grafana/download" rel="nofollow" title="Download Grafana | Grafana Labs">Download Grafana | Grafana Labs</a></p> 
<p><strong>从Grafana.com导入预先构建的仪表板。</strong></p> 
<p>Grafana.com维护着一组共享仪表板 ，可以下载并与Grafana的独立实例一起使用。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/06/7d/9398B8Qj_o.png" width="1200"></p> 
<p><a href="https://grafana.com/dashboards/9276" rel="nofollow" title="https://grafana.com/dashboards/9276">https://grafana.com/dashboards/9276</a></p> 
<blockquote> 
 <p>简单来说：Grafana提供了比Prometheus更加友好美观的展示界面</p> 
</blockquote> 
<p></p> 
<h2 id="2.%20Prometheus%2BGrafana%E5%AE%89%E8%A3%85">2. Prometheus+Grafana安装</h2> 
<h3 id="2.1%20%E7%BB%84%E4%BB%B6">2.1 组件</h3> 
<table border="1" cellpadding="1" cellspacing="1" style="width:630px;"><tbody><tr><td style="text-align:center;">组件</td><td style="text-align:center;">说明</td></tr><tr><td>prometheus-2.41.0.windows-amd64</td><td>监控server端，用于汇总展示各收集器的资源情况（界面丑）</td></tr><tr><td>grafana-enterprise-8.2.2.windows-amd64</td><td>度量分析可视化系统，仪表盘多，替换prometheus默认展示界面</td></tr></tbody></table> 
<h3 id="2.2%20%E5%AE%89%E8%A3%85%E5%8C%85%E4%B8%8B%E8%BD%BD">2.2 安装包下载</h3> 
<p>Prometheus下载地址：<a class="link-info" href="https://prometheus.io/download/" rel="nofollow" title="https://prometheus.io/download/">https://prometheus.io/download/</a></p> 
<p>​ grafana下载： <a class="link-info" href="https://grafana.com/grafana/download?platform=windows" rel="nofollow" title="https://grafana.com/grafana/download?platform=windows">https://grafana.com/grafana/download?platform=windows</a></p> 
<h3 id="2.3%20%E7%99%BE%E5%BA%A6%E4%BA%91%E7%BD%91%E7%9B%98%E4%B8%8B%E8%BD%BD%E5%9C%B0%E5%9D%80">2.3 百度云网盘下载地址</h3> 
<p>Promethe+Grafana ：<a class="link-info" href="https://pan.baidu.com/s/1s03HZ9AlMNbWQKc9-QisUw?pwd=bk1k" rel="nofollow" title="https://pan.baidu.com/s/1s03HZ9AlMNbWQKc9-QisUw?pwd=bk1k">https://pan.baidu.com/s/1s03HZ9AlMNbWQKc9-QisUw?pwd=bk1k</a></p> 
<h3 id="2.4%20Prometheus%20%E5%AE%89%E8%A3%85">2.4 Prometheus 安装</h3> 
<h4 id="2.4.1%20%E9%83%A8%E7%BD%B2%E9%85%8D%E7%BD%AEPrometheus">2.4.1 部署配置Prometheus</h4> 
<ul><li>在全英文路径下解压prometheus-2.41.0.windows-amd64.zip</li><li>修改prometheus.yml，将localhost改为127.0.0.1，避免出现莫名其妙的问题（其它涉及到localhost的配置，也是改为127.0.0.1）</li></ul> 
<p><img alt="" height="419" src="https://images2.imgbox.com/80/9e/9EuE3ddG_o.png" width="1200"></p> 
<ul><li>以管理员身份运行 prometheus.exe 启动prometheus，任务栏会新增一个黑窗口（不要关闭）</li><li>浏览器打开http://127.0.0.1:9090/targets，prometheus状态为up，出现如下界面即成功</li></ul> 
<p><img alt="" height="537" src="https://images2.imgbox.com/1e/5f/CLCv5ZME_o.png" width="1028"></p> 
<h4 id="2.4.2%20%E5%8F%AF%E8%A7%86%E5%8C%96%E7%AE%A1%E7%90%86%E7%95%8C%E9%9D%A2%E4%BB%8B%E7%BB%8D">2.4.2 可视化管理界面介绍</h4> 
<p><img alt="" height="454" src="https://images2.imgbox.com/81/23/gTmJyU26_o.png" width="1152"></p> 
<h4 id="2.4.3%20%E6%9F%A5%E7%9C%8BPrometheus%E6%98%AF%E5%90%A6%E6%AD%A3%E5%B8%B8%E5%90%AF%E5%8A%A8%E4%B8%8E%E6%8C%87%E6%A0%87%E8%AF%BB%E5%8F%96%E7%8A%B6%E6%80%81">2.4.3 查看Prometheus是否正常启动与指标读取状态</h4> 
<p><img alt="" height="443" src="https://images2.imgbox.com/2c/b3/FPuQVEtB_o.png" width="983"></p> 
<p>在prometheus.yaml中配置了 【- targets: ["127.0.0.1:9090"]】之后，就可以读取一些默认的指标信息。这里的 State 是 “UP” 表示该组件是否正常启动，因为这是读取Prometheus本身，只要能进入该界面，就必定是 “UP” 。后续如果添加了对 Exporeter（比如：windows-exporter）的配置，那么从这个 State 可以看到对应的 exporter 是否被 Prometheus 正常监听到。</p> 
<h4 id="2.4.4%20Prometheus%20%E6%B7%BB%E5%8A%A0%E4%B8%BA%20Windows%20%E6%9C%8D%E5%8A%A1">2.4.4 Prometheus 添加为 Windows 服务</h4> 
<p>待定</p> 
<h3 id="2.5%C2%A0%20%E5%AE%89%E8%A3%85%20Grafana">2.5  安装 Grafana</h3> 
<p>相对于Granfan，prometheus的默认界面比较单一，可看到的关键资源信息不多，下面使用Grafana展示具体资源状况。</p> 
<h4 id="2.5.1%20%E5%AE%89%E8%A3%85%E6%B5%81%E7%A8%8B">2.5.1 安装流程</h4> 
<p>在全英文路径下解压 grafana-enterprise-8.2.2.windows-amd64.zip ，双击bin目录下grafana-server.exe，任务栏会新增一个命令行窗户（不要关闭）。</p> 
<p>浏览器打开 http://127.0.0.1:3000（默认账号密码都是admin），远程访问用  ip:3000 ：</p> 
<p><img alt="" height="623" src="https://images2.imgbox.com/ab/f9/vchJWmWq_o.png" width="800"></p> 
<h4 id="%C2%A02.5.2%20%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E6%BA%90%EF%BC%8C%E5%85%B3%E8%81%94prometheus%E7%AB%AF"> 2.5.2 创建数据源，关联prometheus端</h4> 
<p>（1）点击设置（小齿轮），选择Data Source</p> 
<p><img alt="" height="674" src="https://images2.imgbox.com/70/47/p3JIJXxL_o.png" width="1200"></p> 
<p> （2）点击 Add data source，选择 Prometheus</p> 
<p><img alt="" height="484" src="https://images2.imgbox.com/8c/6c/I34t07Z0_o.png" width="1200"></p> 
<p><img alt="" height="453" src="https://images2.imgbox.com/af/3d/nEWvgWcd_o.png" width="1200"></p> 
<p> （3）全部使用默认配置， <strong>这里一定要将localhost改为127.0.0.1</strong>，下拉， 点击Save &amp; test</p> 
<p><img alt="" height="1047" src="https://images2.imgbox.com/d9/0e/EC9rXvZQ_o.png" width="600"></p> 
<h2 id="3.%20Windows%20%E5%AE%89%E8%A3%85%20exporter">3. Windows 安装 exporter</h2> 
<h3 id="3.1%20%E9%83%A8%E7%BD%B2%E9%85%8D%E7%BD%AEwindows%E8%B5%84%E6%BA%90%E9%87%87%E9%9B%86%E5%99%A8">3.1 部署配置windows资源采集器</h3> 
<h4 id="3.1.1%20%E5%AE%89%E8%A3%85%E5%8C%85%E4%B8%8B%E8%BD%BD">3.1.1 安装包下载</h4> 
<p>  ​官方下载地址：<a class="link-info" href="https://github.com/prometheus-community/windows_exporter/releases" title="https://github.com/prometheus-community/windows_exporter/releases">https://github.com/prometheus-community/windows_exporter/releases</a></p> 
<p>  百度云网盘：<a class="link-info" href="https://pan.baidu.com/s/1KXedfMPOs84CsbxXRCxKhQ?pwd=38i6" rel="nofollow" title="https://pan.baidu.com/s/1KXedfMPOs84CsbxXRCxKhQ?pwd=38i6">https://pan.baidu.com/s/1KXedfMPOs84CsbxXRCxKhQ?pwd=38i6</a></p> 
<h4 id="3.1.2%20%E5%AE%89%E8%A3%85Windows-exporter">3.1.2 安装Windows-exporter</h4> 
<p>（1）用管理员身份运行 windows_exporter-0.20.0-amd64.msi ，运行成功后服务中可以看到windows_exporter服务</p> 
<p>（2）将服务状态修改为 “自动（延迟启动）”</p> 
<p><img alt="" height="597" src="https://images2.imgbox.com/ba/d2/6ptdM2NG_o.png" width="1200"></p> 
<p>（3）浏览器访问http://127.0.0.1:9182/metrics，看到如下界面成功</p> 
<p><img alt="" height="643" src="https://images2.imgbox.com/28/2f/0xICaPsu_o.png" width="1188"></p> 
<p>（4） 在prometheus端配置windows_exporter采集器地址，在prometheus.yml 中添加如下内容 <strong>（注意缩进）</strong></p> 
<pre><code>  - job_name: "192.168.126.1:windows-exporter"
    static_configs:
      - targets: ["192.168.126.1:9182"]</code></pre> 
<p>（5）重启prometheus端，打开http://127.0.0.1:9090/targets，windows状态为up即成功</p> 
<p><img alt="" height="216" src="https://images2.imgbox.com/e5/2b/OVdNkbX7_o.png" width="800"></p> 
<h4 id="3.1.3%20%E5%AF%BC%E5%85%A5%20windows-exporter%20%E4%BB%AA%E8%A1%A8%E7%9B%98">3.1.3 导入 windows-exporter 仪表盘</h4> 
<p>（1）打开Dashboards-Manage</p> 
<p><img alt="" height="350" src="https://images2.imgbox.com/76/7c/rckQEFMU_o.png" width="500"></p> 
<p>（2）点击 import</p> 
<p><img alt="" height="444" src="https://images2.imgbox.com/20/9f/9TpeTE9m_o.png" width="1138"></p> 
<p>（3）仪表盘模板导入</p> 
<p><img alt="" height="528" src="https://images2.imgbox.com/09/fd/zHJhBAYA_o.png" width="700"></p> 
<p> 仪表盘有两种导入的方式，一种是选择上传 json 文件，该文件是仪表盘json文件，一次上传一个，选择模板后，点击import。另一种是根据 dashboard ID 上传，在 "Load" 按钮前面输入官方提供的 dashboard ID ，然后点击 "Load" 按钮。</p> 
<p>当前导入的是 windows-exporter 的dashboard ，选择用 dashboard ID进行import:</p> 
<p><img alt="" height="401" src="https://images2.imgbox.com/39/0a/VcMrxJ2F_o.png" width="500"></p> 
<p>这里我输入了 10467，它是 windows-exporter的 dashboard ID，然后点击 “Load”</p> 
<p>（4）选择数据来源，也就是选择 Prometheus 实例</p> 
<p><img alt="" height="780" src="https://images2.imgbox.com/fc/e3/9Bkx29bz_o.png" width="1062"></p> 
<p>进入当前页面，在底部的 prometheus 下拉框选择 Prometheus 实例，点击 import 完成。</p> 
<p>（5）打开Dashboards，可以看到已经添加了的 [windows资源监控] 仪表盘，打开详情如下：</p> 
<p><img alt="" height="1104" src="https://images2.imgbox.com/4c/79/RHlFtRLr_o.png" width="1200"></p> 
<h3 id="3.2%20%E9%83%A8%E7%BD%B2%E9%85%8D%E7%BD%AE%20rabbitmq_exporter">3.2 部署配置 rabbitmq_exporter</h3> 
<h4 id="3.2.1%20%E5%AE%89%E8%A3%85%E5%8C%85%E4%B8%8B%E8%BD%BD">3.2.1 安装包下载</h4> 
<p>官方下载地址：<a href="https://github.com/kbudde/rabbitmq_exporter/releases" title="Releases · kbudde/rabbitmq_exporter · GitHub">Releases · kbudde/rabbitmq_exporter · GitHub</a></p> 
<p>百度云网盘：<a class="link-info" href="https://pan.baidu.com/s/1KXedfMPOs84CsbxXRCxKhQ?pwd=38i6" rel="nofollow" title="https://pan.baidu.com/s/1KXedfMPOs84CsbxXRCxKhQ?pwd=38i6">https://pan.baidu.com/s/1KXedfMPOs84CsbxXRCxKhQ?pwd=38i6</a></p> 
<h4 id="3.2.2%20%E5%AE%89%E8%A3%85%20rabbitmq_exporter">3.2.2 安装 rabbitmq_exporter</h4> 
<p>解压下载的安装包 rabbitmq_exporter_1.0.0-RC19_windows_amd64.tar.gz 到全英文路径下</p> 
<p><img alt="" height="265" src="https://images2.imgbox.com/42/dc/JVT5CHJE_o.png" width="960">启动 rabbitmq_exporter ，在命令行执行  rabbitmq_exporter.exe 文件。</p> 
<p><img alt="" height="404" src="https://images2.imgbox.com/89/b0/36aBQNBV_o.png" width="700"></p> 
<h4 id="3.2.3%20%E6%B7%BB%E5%8A%A0%E5%88%B0%20Prometheus%20%E9%85%8D%E7%BD%AE%E7%9B%91%E6%8E%A7">3.2.3 添加到 Prometheus 配置监控</h4> 
<p>（1）修改Prometheus配置文件，在 prometheus.yml 中添加如下内容：</p> 
<pre><code class="language-bash">  - job_name: "192.168.1.126:rabbitmq-exporter"
    static_configs:
      - targets: ["192.168.1.126:9419"]</code></pre> 
<p> （2）重启Prometheus</p> 
<p>稍等一会，访问http://127.0.0.1:9090/targets，发现node_exporter已经添加进去。</p> 
<p><img alt="" height="239" src="https://images2.imgbox.com/36/79/NpieLd4b_o.png" width="800"></p> 
<p>（3）查看监控指标数据</p> 
<p><img alt="" height="640" src="https://images2.imgbox.com/08/e8/a4GuQG7i_o.png" width="1079"></p> 
<p> rabbitmq 基于erlang组件安装，所以有部分 go_ 开头 的指标信息，其余 rabbitmq_ 开头的指标数据则是 rabbitmq 自己的。</p> 
<h4 id="%C2%A03.2.4%20%E9%85%8D%E7%BD%AE%20Grafana"> 3.2.4 配置 Grafana</h4> 
<p>去地址：<a href="https://grafana.com/grafana/dashboards/" rel="nofollow" title="Dashboards | Grafana Labs">Dashboards | Grafana Labs</a>查找rabbitmq_exporter模板。<br> 这里使用：RabbitMQ Metrics from rabbitmq_exporter，ID 号为：10120。</p> 
<p><img alt="" height="675" src="https://images2.imgbox.com/72/b4/I3D9vknf_o.png" width="800"></p> 
<p>在 Dashboards  manager 使用 dashboard ID 进行 import 加载仪表盘，效果如下：</p> 
<p><img alt="" height="390" src="https://images2.imgbox.com/06/42/CjUcRdHZ_o.png" width="800"></p> 
<h3 id="%C2%A03.3%20%E9%83%A8%E7%BD%B2%E9%85%8D%E7%BD%AE%20mysql_exporter"> 3.3 部署配置 mysql_exporter</h3> 
<h4 id="3.3.1%20%E5%AE%89%E8%A3%85%E5%8C%85%E4%B8%8B%E8%BD%BD">3.3.1 安装包下载</h4> 
<p>官方下载地址：<a href="https://github.com/prometheus/mysqld_exporter/releases" title="Releases · mysqld_exporter · GitHub">Releases · mysqld_exporter · GitHub</a></p> 
<p>百度云网盘：<a class="link-info" href="https://pan.baidu.com/s/1KXedfMPOs84CsbxXRCxKhQ?pwd=38i6" rel="nofollow" title="https://pan.baidu.com/s/1KXedfMPOs84CsbxXRCxKhQ?pwd=38i6">https://pan.baidu.com/s/1KXedfMPOs84CsbxXRCxKhQ?pwd=38i6</a></p> 
<h4 id="3.3.2%20%E5%AE%89%E8%A3%85%20mysql_exporter">3.3.2 安装 mysql_exporter</h4> 
<p>解压下载的安装包 mysqld_exporter-0.14.0.windows-amd64.zip 到全英文路径下</p> 
<p><img alt="" height="129" src="https://images2.imgbox.com/48/04/DwE2TZ2P_o.png" width="913"></p> 
<p> 启动 mysql_exporter ，在命令行执行  mysql_exporter.exe 文件。</p> 
<p><img alt="" height="220" src="https://images2.imgbox.com/63/2e/TCS7Kdsw_o.png" width="806"></p> 
<p>进入mysql_exporter目录，cmd命令行执行：</p> 
<pre><code class="language-sql">mysqld_exporter.exe --config.my-cnf=.my.cnf</code></pre> 
<h4>3.3.3 添加到 Prometheus 配置监控</h4> 
<p>（1）修改Prometheus配置文件，在 prometheus.yml 中添加如下内容：</p> 
<pre><code class="language-bash">  - job_name: 'mysql'
    static_configs:
      - targets: ['192.168.1.106:9104']</code></pre> 
<p> （2）重启Prometheus</p> 
<p>稍等一会，访问http://127.0.0.1:9090/targets，发现mysql_exporter已经添加进去。</p> 
<p><img alt="" height="690" src="https://images2.imgbox.com/c2/a1/pvdxg9yj_o.png" width="1200"></p> 
<p> （3）查看监控指标数据</p> 
<p><img alt="" height="661" src="https://images2.imgbox.com/6f/bf/MIFJ6tLA_o.png" width="1200"></p> 
<h4> 3.3.4 配置 Grafana</h4> 
<p>去地址：<a href="https://grafana.com/grafana/dashboards/" rel="nofollow" title="Dashboards | Grafana Labs">Dashboards | Grafana Labs</a>查找rabbitmq_exporter模板。<br> 这里使用：MySQL Exporter Quickstart and Dashboard ，ID 号为：14057。</p> 
<p><img alt="" height="827" src="https://images2.imgbox.com/c1/c5/raxpfIun_o.png" width="1200"></p> 
<p>在 Dashboards  manager 使用 dashboard ID 进行 import 加载仪表盘</p> 
<h3>3.5 部署配置 redis_exporter</h3> 
<h4>3.5.1 安装包下载</h4> 
<p>官方下载地址：<a class="link-info" href="https://github.com/oliver006/redis_exporter/releases/" title="Releases · redis_exporter · GitHub">Releases · redis_exporter · GitHub</a></p> 
<p>百度云网盘：<a href="https://pan.baidu.com/s/1KXedfMPOs84CsbxXRCxKhQ?pwd=38i6" rel="nofollow" title="百度网盘 请输入提取码">百度网盘 请输入提取码</a></p> 
<h4>3.5.2 安装 redis_exporter</h4> 
<p>解压下载的安装包 mysqld_exporter-0.14.0.windows-amd64.zip 到全英文路径下</p> 
<p><img alt="" height="289" src="https://images2.imgbox.com/59/e8/btBbrJyr_o.png" width="740"><br> 启动 redis_exporter ，在命令行执行  redis_exporter.exe 文件。</p> 
<p><img alt="" height="187" src="https://images2.imgbox.com/08/7c/0iCmEWvk_o.png" width="744"></p> 
<p>进入redis_exporter目录，cmd命令行执行：</p> 
<pre><code>redis_exporter.exe -redis.addr 192.168.1.38:6379 -redis.password xxxxxx -web.listen-address :9121</code></pre> 
<p><img alt="" height="273" src="https://images2.imgbox.com/b9/44/rvTW1qBN_o.png" width="1111"></p> 
<h4>3.5.3 添加到 Prometheus 配置监控</h4> 
<p>（1）修改Prometheus配置文件，在 prometheus.yml 中添加如下内容：</p> 
<pre><code>  - job_name: "127.0.0.1:redis_exporter"
    static_configs:
      - targets: ["127.0.0.1:9121"]</code></pre> 
<p> （2）重启Prometheus</p> 
<p>稍等一会，访问http://127.0.0.1:9090/targets，发现redis_exporter已经添加进去。</p> 
<p><img alt="" height="423" src="https://images2.imgbox.com/aa/4d/EPrfIj7D_o.png" width="1200"></p> 
<p> （3）查看监控指标数据</p> 
<p><img alt="" height="479" src="https://images2.imgbox.com/fb/f2/yNkLjFhU_o.png" width="904"></p> 
<h4> 3.5.4 配置 Grafana</h4> 
<p>去地址：<a href="https://grafana.com/grafana/dashboards/" rel="nofollow" title="Dashboards | Grafana Labs">Dashboards | Grafana Labs</a>查找rabbitmq_exporter模板。<br> 这里使用：Redis Dashboard for Prometheus Redis Exporter ，ID 号为：11835。</p> 
<p><img alt="" height="974" src="https://images2.imgbox.com/6f/9b/sUc66PIU_o.png" width="1021"></p> 
<p> 在 Dashboards  manager 使用 dashboard ID 进行 import 加载仪表盘</p> 
<p><img alt="" height="1053" src="https://images2.imgbox.com/68/31/83YYV2h2_o.png" width="1038"></p> 
<p></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="4.%20Linux%20%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%20exporter">4. Linux 安装部署 exporter</h2> 
<h3 id="4.1%20%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85%20node_exporter">4.1 部署安装 node_exporter</h3> 
<h4 id="4.1.1%20%E5%AE%89%E8%A3%85%E5%8C%85%E4%B8%8B%E8%BD%BD">4.1.1 安装包下载</h4> 
<p>​官方下载地址：<a class="link-info" href="https://github.com/prometheus/node_exporter/releases" title="https://github.com/prometheus/node_exporter/releases">https://github.com/prometheus/node_exporter/releases</a></p> 
<p>百度云网盘：<a class="link-info" href="https://pan.baidu.com/s/1Xn-mTCo4DqENRlEgo2dRjg?pwd=bl7x" rel="nofollow" title="https://pan.baidu.com/s/1Xn-mTCo4DqENRlEgo2dRjg?pwd=bl7x">https://pan.baidu.com/s/1Xn-mTCo4DqENRlEgo2dRjg?pwd=bl7x</a></p> 
<h4 id="4.1.2%20%E5%AE%89%E8%A3%85">4.1.2 安装</h4> 
<p>将安装包 node_exporter-0.18.1.linux-amd64.tar.gz 上传至服务器。</p> 
<pre><code class="language-bash">tar zvxf node_exporter-0.18.1.linux-amd64.tar.gz
mv node_exporter-0.18.1.linux-amd64 /usr/local/node_exporter
</code></pre> 
<h4 id="4.1.3%20%E6%B3%A8%E5%86%8C%E4%B8%BA%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1">4.1.3 注册为系统服务</h4> 
<pre><code class="language-bash">vim /usr/lib/systemd/system/node_exporter.service</code></pre> 
<p>添加内容：</p> 
<pre><code class="language-bash">[Unit]
Description=node_exporter
Documentation=https://github.com/prometheus/node_exporter
After=network.target

[Service]
Type=simple
User=root
ExecStart=/usr/local/node_exporter/node_exporter
Restart=on-failure
[Install]
WantedBy=multi-user.target
</code></pre> 
<p>重置系统服务并将node_exporter开机自启、启动 node_exporter服务</p> 
<pre><code class="language-bash">systemctl daemon-reload
systemctl enable node_exporter
systemctl start node_exporter</code></pre> 
<h4 id="4.1.4%20%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BF%E9%97%AEhttp%3A%2F%2F192.168.126.138%3A9100%2Fmetrics%EF%BC%8C%E7%9C%8B%E5%88%B0%E5%A6%82%E4%B8%8B%E7%95%8C%E9%9D%A2%E6%88%90%E5%8A%9F">4.1.4 浏览器访问http://192.168.126.138:9100/metrics，看到如下界面成功</h4> 
<p><img alt="" height="487" src="https://images2.imgbox.com/7f/08/OjZUw4tp_o.png" width="1015"></p> 
<h4 id="4.1.5%20%E6%B7%BB%E5%8A%A0%E5%88%B0%20Prometheus%20%E9%85%8D%E7%BD%AE%E7%9B%91%E6%8E%A7">4.1.5 添加到 Prometheus 配置监控</h4> 
<p> （1）修改Prometheus配置文件，在 prometheus.yml 中添加如下内容：</p> 
<pre><code class="language-bash">  - job_name: "192.168.126.138:node-exporter"
    static_configs:
      - targets: ["192.168.126.138:9100"]</code></pre> 
<p>（2）重启Prometheus</p> 
<p>稍等一会，访问http://127.0.0.1:9090/targets，发现node_exporter已经添加进去。</p> 
<p><img alt="" height="688" src="https://images2.imgbox.com/cd/9b/QR0X7j9G_o.png" width="1200"></p> 
<h4 id="%C2%A04.1.6%20%E9%85%8D%E7%BD%AE%20Grafana"> 4.1.6 配置 Grafana</h4> 
<p>去地址：<a href="https://grafana.com/grafana/dashboards/" rel="nofollow" title="Dashboards | Grafana Labs">Dashboards | Grafana Labs</a>查找node_exporter模板。<br> 这里使用：Node Exporter for Prometheus Dashboard based on 11074，ID 号为：15172。</p> 
<p><img alt="" height="521" src="https://images2.imgbox.com/3f/0e/Td4mreEk_o.png" width="700"></p> 
<p>在 Dashboards  manager 使用 dashboard ID 进行 import 加载仪表盘，效果如下：</p> 
<p><img alt="" height="902" src="https://images2.imgbox.com/c2/48/ehcPrzwZ_o.png" width="1200"></p> 
<h3 id="4.2%C2%A0%20%E9%83%A8%E7%BD%B2%E5%AE%89%E8%A3%85%20oracle_exporter">4.2  部署安装 oracle_exporter</h3> 
<h4 id="4.2.1%20%E5%AE%89%E8%A3%85%E5%8C%85%E4%B8%8B%E8%BD%BD">4.2.1 安装包下载</h4> 
<p>官方下载地址：https://github.com/iamseth/oracledb_exporter/releases</p> 
<p>百度云网盘：<a class="link-info" href="https://pan.baidu.com/s/1Xn-mTCo4DqENRlEgo2dRjg?pwd=bl7x" rel="nofollow" title="https://pan.baidu.com/s/1Xn-mTCo4DqENRlEgo2dRjg?pwd=bl7x">https://pan.baidu.com/s/1Xn-mTCo4DqENRlEgo2dRjg?pwd=bl7x</a></p> 
<h4 id="%C2%A04.2.2%20%E5%AE%89%E8%A3%85"> 4.2.2 安装</h4> 
<p>将安装包 node_exporter-0.18.1.linux-amd64.tar.gz 上传至服务器。</p> 
<div> 
 <pre><code class="language-bash">tar -zxvf oracledb_exporter.0.2.9-ora18.5.linux-amd64.tar.gz
mv oracledb_exporter.0.2.9-ora18.5.linux-amd64 /usr/local/oracle_exporter
</code></pre> 
</div> 
<h4 id="4.2.3%20%E7%BC%96%E8%BE%91%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">4.2.3 编辑环境变量配置文件</h4> 
<p>增加一个TNS_ADMIN环境变量</p> 
<div> 
 <pre><code class="language-bash">vim ~/.bash_profile</code></pre> 
</div> 
<p>我这里的配置是</p> 
<div> 
 <pre><code class="language-bash"># oracle环境变量
export ORACLE_SID=orcl
export ORACLE_HOME=/data/oracle/product/11.2.0/db_1
# oracledb_exporter环境变量
export PATH=$PATH:$ORACLE_HOME/bin
# export DATA_SOURCE_NAME=用户名/密码
export DATA_SOURCE_NAME=system/oracle
export LD_LIBRARY_PATH=$ORACLE_HOME/lib</code></pre> 
</div> 
<p>修改bash_profile完成后，执行<code>  </code></p> 
<div> 
 <pre><code class="language-bash">source ~/.bash_profile</code></pre> 
</div> 
<h4 id="4.2.4%20lib%20%E6%96%87%E4%BB%B6%E7%BC%BA%E5%A4%B1%E9%97%AE%E9%A2%98">4.2.4 lib 文件缺失问题</h4> 
<p>检查 oracle安装路径的 $ORACLE_HOME/lib 目录下 是否有 libclntsh.so.18.1 文件，如果缺少该文件，启动 oracle_exporter 会失败。</p> 
<p>进入 oracle 安装目录的 /lib 文件夹下，创建 libclntsh.so.18.1 的软连接：</p> 
<div> 
 <pre><code class="language-bash">ln -s libclntsh.so.18.1 libclntsh.so</code></pre> 
</div> 
<h4 id="4.2.5%20%E5%90%8E%E5%8F%B0%E5%90%AF%E5%8A%A8%20oracle_exporter">4.2.5 后台启动 oracle_exporter</h4> 
<p>当然我们启动oracledb_exporter最好以不挂断、后台运行的方式启动</p> 
<div> 
 <pre><code class="language-bash">    nohup ./oracledb_exporter &amp;</code></pre> 
</div> 
<h4 id="4.2.6%20%E6%B5%8F%E8%A7%88%E5%99%A8%E8%AE%BF%E9%97%AEhttp%3A%2F%2F192.168.126.138%3A9161%2Fmetrics%EF%BC%8C%E7%9C%8B%E5%88%B0%E5%A6%82%E4%B8%8B%E7%95%8C%E9%9D%A2%E6%88%90%E5%8A%9F">4.2.6 浏览器访问http://192.168.126.138:9161/metrics，看到如下界面成功</h4> 
<p><img alt="" height="539" src="https://images2.imgbox.com/fb/31/SNhpEWyE_o.png" width="1200">​</p> 
<h4 id="4.2.7%20%E6%B7%BB%E5%8A%A0%E5%88%B0%20Prometheus%20%E9%85%8D%E7%BD%AE%E7%9B%91%E6%8E%A7">4.2.7 添加到 Prometheus 配置监控</h4> 
<p> （1）修改Prometheus配置文件，在 prometheus.yml 中添加如下内容：</p> 
<div> 
 <pre><code class="language-bash">  - job_name: "192.168.126.138:oracle-exporter"
    static_configs:
      - targets: ["192.168.126.138:9161"]</code></pre> 
</div> 
<p>（2）重启Prometheus</p> 
<p>稍等一会，访问http://127.0.0.1:9090/targets，发现oracledb_exporter已经添加进去。</p> 
<p><img alt="" height="948" src="https://images2.imgbox.com/ec/9c/7YCC6A5U_o.png" width="1200">​</p> 
<h4 id="%C2%A0%C2%A04.2.8%20%E9%85%8D%E7%BD%AE%20Grafana">  4.2.8 配置 Grafana</h4> 
<p>去地址：<a href="https://grafana.com/grafana/dashboards/" rel="nofollow" title="Dashboards | Grafana Labs">Dashboards | Grafana Labs</a>查找oracledb_exporter模板。<br> 这里使用：Node Exporter for Prometheus Dashboard based on 11074，ID 号为：15172。</p> 
<p><img alt="" height="802" src="https://images2.imgbox.com/a3/76/2uq5mmb1_o.png" width="800">​</p> 
<p>在 Dashboards  manager 使用 dashboard ID 进行 import 加载仪表盘，效果如下：</p> 
<p><img alt="" height="257" src="https://images2.imgbox.com/e5/c2/6VaOGScA_o.png" width="800">​</p> 
<p><img alt="" height="959" src="https://images2.imgbox.com/a8/b8/VfclZZTb_o.png" width="800">​</p> 
<p> 填写 dashboards ID后，点击 “Load” 加载仪表盘。<img alt="" height="631" src="https://images2.imgbox.com/c9/11/F9KLmEO5_o.png" width="800">​</p> 
<p> 选择 Prometheus 实例。</p> 
<p><img alt="" height="1008" src="https://images2.imgbox.com/43/6e/lTZn4MhJ_o.png" width="1200">​</p> 
<h3 id="4.3%20%E9%83%A8%E7%BD%B2%20nginx_exporter">4.3 部署 nginx_exporter</h3> 
<h4 id="4.3.1%20%E5%89%8D%E7%BD%AE%E6%9D%A1%E4%BB%B6">4.3.1 前置条件</h4> 
<p>nginx 需要安装 nginx-module-vts 创建，该插件在 nginx 安装时进行加入到编译参数中。</p> 
<p>（1）安装依赖模块</p> 
<pre><code class="language-bash">yum install ‐y pcre pcre‐devel
yum install ‐y zlib zlib‐devel
yum install ‐y openssl openssl‐devel
</code></pre> 
<p>（2）下载 nginx</p> 
<pre><code class="language-bash">#下载 Nginx
wget http://nginx.org/download/nginx-1.17.7.tar.gz</code></pre> 
<p>（3）解压安装 nginx</p> 
<pre><code class="language-bash">tar -zxvf nginx-1.17.1.tar.gz
</code></pre> 
<p>（4）下载 vts 模块</p> 
<p>下载链接：<a href="https://github.com/vozlt/nginx-module-vts/archive/v0.1.18.tar.gz" title="https://github.com/vozlt/nginx-module-vts/archive/v0.1.18.tar.gz">https://github.com/vozlt/nginx-module-vts/archive/v0.1.18.tar.gz</a></p> 
<p>百度云网盘：<a href="https://pan.baidu.com/s/1Xn-mTCo4DqENRlEgo2dRjg?pwd=bl7x" rel="nofollow" title="https://pan.baidu.com/s/1Xn-mTCo4DqENRlEgo2dRjg?pwd=bl7x">https://pan.baidu.com/s/1Xn-mTCo4DqENRlEgo2dRjg?pwd=bl7x</a></p> 
<p>（5）解压 v0.1.18.tar.gz 到 /usr/local/nginx 目录下</p> 
<p><img alt="" height="349" src="https://images2.imgbox.com/15/bc/hC3kH4tx_o.png" width="547"></p> 
<p>（6）编译安装 nginx</p> 
<p>进入Nginx目录<br> 执行命令 ./configure 是用来生成Makefile，为下一步的编译做准备 --add-module=后面跟上插件的下载地址</p> 
<pre><code class="language-bash">./configure --prefix=/usr/local/nginx --with-http_ssl_module  --add-module=/opt/nginx-1.17.7/nginx-module-vts-0.1.18/
#编译不安装
make &amp; make install</code></pre> 
<p>进入 /usr/local/nginx/conf 目录下，修改nginx.conf配置文件添加一下信息</p> 
<pre><code class="language-bash">http {
    vhost_traffic_status_zone;
    vhost_traffic_status_filter_by_host on;
    server {
    #   vhost_traffic_status off;
        location /status {
            vhost_traffic_status_display;
            vhost_traffic_status_display_format html;
        }
    }
}
</code></pre> 
<p>打开vhost过滤</p> 
<pre><code class="language-bash">vhost_traffic_status_filter_by_host on;</code></pre> 
<p>开启此功能，在Nginx配置有多个server_name的情况下，会根据不同的server_name进行流量的统计，否则默认会把流量全部计算到第一个server_name上。<br> 在不想统计流量的server区域禁用vhost_traffic_status，配置示例：</p> 
<pre><code class="language-bash">server {
...
vhost_traffic_status off;
...
}
</code></pre> 
<p>假如nginx没有规范配置server_name或者无需进行监控的server上，那么建议在此vhost上禁用统计监控功能。否则会出现“127.0.0.1”，hostname等的域名监控信息。</p> 
<p>完整配置：</p> 
<pre><code class="language-bash">http {

    include       mime.types;
    default_type  application/octet-stream;

    sendfile        on;
    keepalive_timeout  65;
	
	vhost_traffic_status_zone;
    vhost_traffic_status_filter_by_host on;
 
    server {
        listen       80;
        server_name  localhost;
		
        location / {
            root   html;
            index  index.html index.htm;
        }

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

        location /status {
            vhost_traffic_status_display;
            vhost_traffic_status_display_format html;
        }
    }
}</code></pre> 
<p>测试配置文件</p> 
<pre><code class="language-bash">[root@linkhot04 sbin]# ./nginx -t
nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok
nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful</code></pre> 
<p>启动nginx ，访问 status</p> 
<pre><code class="language-bash">./nginx
访问状态接口
http://192.168.126.138/status</code></pre> 
<h4 id="%E2%80%8B%E7%BC%96%E8%BE%91"><img alt="" height="403" src="https://images2.imgbox.com/45/05/QYwp5NLX_o.png" width="800"></h4> 
<h4 id="4.3.2%20%E5%AE%89%E8%A3%85%E5%8C%85%E4%B8%8B%E8%BD%BD">4.3.2 安装包下载</h4> 
<p>官方下载地址：<a href="https://github.com/hnlq715/nginx-vts-exporter/releases" title="Releases · hnlq715/nginx-vts-exporter · GitHub">Releases · hnlq715/nginx-vts-exporter · GitHub</a></p> 
<p>百度云网盘：<a class="link-info" href="https://pan.baidu.com/s/1Xn-mTCo4DqENRlEgo2dRjg?pwd=bl7x" rel="nofollow" title="https://pan.baidu.com/s/1Xn-mTCo4DqENRlEgo2dRjg?pwd=bl7x">https://pan.baidu.com/s/1Xn-mTCo4DqENRlEgo2dRjg?pwd=bl7x</a></p> 
<h4 id="%C2%A04.3.3%20%E5%AE%89%E8%A3%85"> 4.3.3 安装</h4> 
<p>将安装包 node_exporter-0.18.1.linux-amd64.tar.gz 上传至服务器。</p> 
<pre><code>tar -zxvf nginx-vts-exporter-0.10.3.linux-amd64.tar.gz
mv nginx-vts-exporter-0.10.3.linux-amd64 /usr/local/nginx_vts_exporter</code></pre> 
<h4 id="4.3.4%20%E5%90%AF%E5%8A%A8%20exporter">4.3.4 启动 exporter</h4> 
<pre><code class="language-bash">nohup ./nginx-vts-exporter -nginx.scrape_uri=http://192.168.126.138/status/format/json  &amp;
</code></pre> 
<p>参看采集指标</p> 
<p><a href="http://192.168.126.138:9913/metrics" rel="nofollow" title="192.168.126.138:9913/metrics">192.168.126.138:9913/metrics</a></p> 
<p><img alt="" height="942" src="https://images2.imgbox.com/cb/a0/Mm88PLAv_o.png" width="1200"></p> 
<h4 id="%C2%A04.3.5%20%E6%B7%BB%E5%8A%A0%E5%88%B0%20Prometheus%20%E9%85%8D%E7%BD%AE%E7%9B%91%E6%8E%A7"> 4.3.5 添加到 Prometheus 配置监控</h4> 
<p> （1）修改Prometheus配置文件，在 prometheus.yml 中添加如下内容：</p> 
<div> 
 <pre><code class="language-bash">  - job_name: "192.168.126.138:nginx-exporter"
    static_configs:
      - targets: ["192.168.126.138:9931"]</code></pre> 
</div> 
<p>（2）重启Prometheus</p> 
<p>稍等一会，访问http://127.0.0.1:9090/targets，发现oracledb_exporter已经添加进去。</p> 
<p><img alt="" height="948" src="https://images2.imgbox.com/4e/9f/1bi9sfCp_o.png" width="1200">​</p> 
<h4>  4.3.6 配置 Grafana</h4> 
<p>去地址：<a href="https://grafana.com/grafana/dashboards/" rel="nofollow" title="Dashboards | Grafana Labs">Dashboards | Grafana Labs</a>查找oracledb_exporter模板。<br> 这里使用：Nginx VTS Stats，ID 号为：2949。</p> 
<p><img alt="" height="1010" src="https://images2.imgbox.com/42/ac/vziWoW7l_o.png" width="1028"></p> 
<p> 在 Dashboards  manager 使用 dashboard ID 进行 import 加载仪表盘，效果如下：</p> 
<p><img alt="" height="257" src="https://images2.imgbox.com/e3/5c/DG0Y04hr_o.png" width="800">​</p> 
<p> 填写 dashboards ID后，点击 “Load” 加载仪表盘。</p> 
<p><img alt="" height="723" src="https://images2.imgbox.com/38/14/N51mn26e_o.png" width="784">​</p> 
<p> 选择 Prometheus 实例。</p> 
<div></div> 
<p><img alt="" height="413" src="https://images2.imgbox.com/7c/0c/aFm5p3g7_o.png" width="900"></p> 
<h3>4.4 部署 MSSQL_exporter</h3> 
<h4>4.41 说明</h4> 
<p>MSSQL的监控，官网没有提供采集器，所以只能用其他程序来监控，本文就用了 sql-exporter。</p> 
<p>它可以理解成一个远程连接数据库的工具，可以用它来连接sql server/mysql 等等数据库，并以SQL查询方式采集SQL查询结果。</p> 
<p>SQL_Exporter 是中心化的，可以把对不同实例的agent链接，都放在一台linux服务器上，以便管理、修改。你想想看，如果你更新了采集指标，只需要在该台中心化服务器重启sql_exporter agent采集客户端即可生效。</p> 
<p>不像其他 mysql/linux/windows采集器，他们是部署在实际被采集的服务器上的，如果你想要更新采集器(虽然它做的很好了，不需要更新。除此之外就是无法加入自定义的采集指标或者采集项)，那么需要到那么多台被采集的客户端机器上去覆盖更新，很痛苦的。</p> 
<h4>4.4.2 安装包下载</h4> 
<p>官方下载地址：<a href="https://github.com/free/sql_exporter/releases" title="Releases · mssql-exporter · GitHub">Releases · mssql-exporter · GitHub</a></p> 
<p>百度云网盘：<a class="link-info" href="https://pan.baidu.com/s/1Xn-mTCo4DqENRlEgo2dRjg?pwd=bl7x" rel="nofollow" title="https://pan.baidu.com/s/1Xn-mTCo4DqENRlEgo2dRjg?pwd=bl7x">https://pan.baidu.com/s/1Xn-mTCo4DqENRlEgo2dRjg?pwd=bl7x</a></p> 
<h4> 4.4.3 安装</h4> 
<p><strong>方式一：</strong>将安装包 node_exporter-0.18.1.linux-amd64.tar.gz 上传至服务器。</p> 
<p><strong>方式二：</strong>下载解压 sql_exporter</p> 
<pre><code>wget https://github.com/free/sql_exporter/releases/download/0.5/sql_exporter-0.5.linux-amd64.tar.gz</code></pre> 
<p>解压 exporter安装包</p> 
<pre><code>tar -zxf sql_exporter-0.5.linux-amd64.tar.gzln -s sql_exporter-0.5.linux-amd64 sql_exporter

mv sql_exporter-0.5.linux-amd64 sql_exporter
# 移动路径
cp -R sql_exporter /usr/local/</code></pre> 
<h4>4.4.4 修改配置文件</h4> 
<pre><code>vi sql_exporter.yml</code></pre> 
<p><img alt="" height="406" src="https://images2.imgbox.com/40/d9/zpt9T59q_o.png" width="948"></p> 
<h4>4.4.5 启动 exporter</h4> 
<pre><code># 进入目录
cd /usr/local/sql_exporter
# 启动服务
nohup ./sql_exporter &amp;
</code></pre> 
<p>查看采集指标</p> 
<p><img alt="" height="598" src="https://images2.imgbox.com/30/96/I9lOIkVp_o.png" width="1023"></p> 
<h4> 4.4.6 添加到 Prometheus 配置监控</h4> 
<p> （1）修改Prometheus配置文件，在 prometheus.yml 中添加如下内容：</p> 
<div> 
 <pre><code class="language-bash">  - job_name: "192.168.126.138:mssql-xporter"
    static_configs:
      - targets: ["192.168.126.138:9399"]</code></pre> 
</div> 
<p>（2）重启Prometheus</p> 
<p>稍等一会，访问http://127.0.0.1:9090/targets，发现sqlserver_exporter已经添加进去。</p> 
<p><img alt="" height="760" src="https://images2.imgbox.com/d7/96/cg0uuHQ7_o.png" width="1200"></p> 
<h4>  4.4.7 配置 Grafana</h4> 
<p>去地址：<a href="https://grafana.com/grafana/dashboards/" rel="nofollow" title="Dashboards | Grafana Labs">Dashboards | Grafana Labs</a>查找sql server_exporter模板。<br> 这里使用：Microsoft SQL Server，ID 号为：13919。</p> 
<p> 填写 dashboards ID后，点击 “Load” 加载仪表盘。</p> 
<p>​<img alt="" height="1058" src="https://images2.imgbox.com/2a/4c/WU6hb2p2_o.png" width="1038"></p> 
<p> 在 Dashboards  manager 使用 dashboard ID 进行 import 加载仪表盘，效果如下：</p> 
<div></div> 
<p><img alt="" height="548" src="https://images2.imgbox.com/d6/2e/LALA2Ujj_o.png" width="1038"></p> 
<p>  填写 dashboards ID后，点击 “Load” 加载仪表盘。</p> 
<p><img alt="" height="746" src="https://images2.imgbox.com/b2/42/On7TzfKY_o.png" width="791"></p> 
<p>选择 Prometheus 实例。</p> 
<p><img alt="" height="904" src="https://images2.imgbox.com/36/f7/oRNjKEMY_o.png" width="1037"></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/42efd79729551a3427ed905500a24e31/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C&#43;&#43; typeid关键字详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/55481160b06016170cfff3bcee8138bc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Simulink】 0基础入门教程 P2 常用模块的使用介绍</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>