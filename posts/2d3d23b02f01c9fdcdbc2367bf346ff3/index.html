<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>KVM虚拟化技术（二）之创建虚拟机（命令行方式） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="KVM虚拟化技术（二）之创建虚拟机（命令行方式）" />
<meta property="og:description" content="大家好，我是邵奈一，一个不务正业的程序猿、正儿八经的斜杠青年。
1、世人称我为：被代码耽误的诗人、没天赋的书法家、五音不全的歌手、专业跑龙套演员、不合格的运动员…
2、这几年，我整理了很多IT技术相关的教程给大家，爱生活、爱分享。
3、如果您觉得文章有用，请收藏，转发，评论，并关注我，谢谢！
博客导航跳转（请收藏）：邵奈一的技术博客导航
| 公众号 | 微信 | 微博 | CSDN | 简书 |
教程目录 0x00 教程内容0x01 创建虚拟机1. 上传ISO镜像到服务器2. 创建虚拟机 0x02 配置虚拟机网络0x03 修改虚拟机的主机名0xFF 总结 0x00 教程内容 创建虚拟机配置虚拟机网络修改虚拟机的主机名 上一教程已经安装好了KVM，并且配置好了网桥，那么接下来就可以创建虚拟机了。其实过程非常简单，跟我们在VMware里创建虚拟机非常相似，只不过我们这里使用命令行方式创建而已。
0x01 创建虚拟机 1. 上传ISO镜像到服务器 2. 创建虚拟机 创建一个存放虚拟机系统的卷 qemu-img create -f qcow2 /var/lib/libvirt/images/base.qcow2 20G 参数说明-f指定卷的格式为qcow2/var/lib/libvirt/images虚拟机卷存放的默认路径base.qcow2完整卷名20G卷的大小 创建虚拟机 执行的命令如下：
virt-install \ -n base \ -r 4096 \ --vcpus 2 \ --disk /var/lib/libvirt/images/base.qcow2 \ --location /opt/iso/CentOS-7-x86_64-DVD-1908.iso \ --nographics \ --network bridge=br0 \ --network bridge=br0 \ --os-type linux \ --os-variant rhel7 \ --console pty,target_type=serial \ --extra-args &#39;console=ttyS0,115200n8 serial&#39; 命令含义说明如下：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/2d3d23b02f01c9fdcdbc2367bf346ff3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-03T12:03:14+08:00" />
<meta property="article:modified_time" content="2021-06-03T12:03:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">KVM虚拟化技术（二）之创建虚拟机（命令行方式）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p><strong>大家好，我是邵奈一，一个不务正业的程序猿、正儿八经的斜杠青年。</strong><br> 1、世人称我为：被代码耽误的诗人、没天赋的书法家、五音不全的歌手、专业跑龙套演员、不合格的运动员…<br> 2、这几年，我整理了很多IT技术相关的教程给大家，爱生活、爱分享。<br> 3、如果您觉得文章有用，请收藏，转发，评论，并关注我，谢谢！<br> <strong>博客导航跳转（请收藏）：</strong><a href="https://blog.csdn.net/shaock2018/article/details/89349249">邵奈一的技术博客导航</a><br> | <a href="https://img-blog.csdnimg.cn/20190608000417972.jpeg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NoYW9jazIwMTg=,size_16,color_FFFFFF,t_70" rel="nofollow">公众号</a> | <a href="https://img-blog.csdnimg.cn/20190514084602748.png" rel="nofollow">微信</a> | <a href="https://weibo.com/5680168183/" rel="nofollow">微博</a> | <a href="https://blog.csdn.net/shaock2018">CSDN</a> | <a href="https://www.jianshu.com/u/6f033c6a3b90" rel="nofollow">简书</a> |</p> 
</blockquote> 
<hr> 
<p></p> 
<div class="toc"> 
 <h4>教程目录</h4> 
 <ul><li><a href="#0x00__9" rel="nofollow">0x00 教程内容</a></li><li><a href="#0x01__16" rel="nofollow">0x01 创建虚拟机</a></li><li><ul><li><ul><li><ul><li><a href="#1_ISO_17" rel="nofollow">1. 上传ISO镜像到服务器</a></li><li><a href="#2__19" rel="nofollow">2. 创建虚拟机</a></li></ul> 
   </li></ul> 
  </li></ul> 
  </li><li><a href="#0x02__111" rel="nofollow">0x02 配置虚拟机网络</a></li><li><a href="#0x03__153" rel="nofollow">0x03 修改虚拟机的主机名</a></li><li><a href="#0xFF__161" rel="nofollow">0xFF 总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="0x00__9"></a>0x00 教程内容</h2> 
<ol><li>创建虚拟机</li><li>配置虚拟机网络</li><li>修改虚拟机的主机名</li></ol> 
<p>上一教程已经安装好了KVM，并且配置好了网桥，那么接下来就可以创建虚拟机了。其实过程非常简单，跟我们在VMware里创建虚拟机非常相似，只不过我们这里使用命令行方式创建而已。</p> 
<h2><a id="0x01__16"></a>0x01 创建虚拟机</h2> 
<h5><a id="1_ISO_17"></a>1. 上传ISO镜像到服务器</h5> 
<p><img src="https://images2.imgbox.com/84/98/3PLhn9w9_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2__19"></a>2. 创建虚拟机</h5> 
<ol><li>创建一个存放虚拟机系统的卷</li></ol> 
<pre><code class="prism language-shell">qemu-img create -f qcow2 /var/lib/libvirt/images/base.qcow2 20G
</code></pre> 
<p><img src="https://images2.imgbox.com/a6/22/mdLWmaA4_o.png" alt="在这里插入图片描述"></p> 
<table><thead><tr><th align="left">参数</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">-f</td><td align="left">指定卷的格式为qcow2</td></tr><tr><td align="left">/var/lib/libvirt/images</td><td align="left">虚拟机卷存放的默认路径</td></tr><tr><td align="left">base.qcow2</td><td align="left">完整卷名</td></tr><tr><td align="left">20G</td><td align="left">卷的大小</td></tr></tbody></table> 
<ol start="2"><li>创建虚拟机</li></ol> 
<p>执行的命令如下：</p> 
<pre><code class="prism language-shell">virt-install <span class="token punctuation">\</span>
-n base <span class="token punctuation">\</span>
-r <span class="token number">4096</span> <span class="token punctuation">\</span>
--vcpus <span class="token number">2</span> <span class="token punctuation">\</span>
--disk /var/lib/libvirt/images/base.qcow2 <span class="token punctuation">\</span>
--location /opt/iso/CentOS-7-x86_64-DVD-1908.iso <span class="token punctuation">\</span>
--nographics <span class="token punctuation">\</span>
--network <span class="token assign-left variable">bridge</span><span class="token operator">=</span>br0 <span class="token punctuation">\</span>
--network <span class="token assign-left variable">bridge</span><span class="token operator">=</span>br0 <span class="token punctuation">\</span>
--os-type linux <span class="token punctuation">\</span>
--os-variant rhel7 <span class="token punctuation">\</span>
--console pty,target_type<span class="token operator">=</span>serial <span class="token punctuation">\</span>
--extra-args <span class="token string">'console=ttyS0,115200n8 serial'</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/34/7f/tYQhVXJ8_o.png" alt="在这里插入图片描述"><br> 命令含义说明如下：</p> 
<pre><code class="prism language-shell">virt-install <span class="token punctuation">\</span>				<span class="token comment">#创建命令</span>
-n base <span class="token punctuation">\</span>					<span class="token comment">#虚拟机显示名（非虚拟机主机名）</span>
-r <span class="token number">4096</span> <span class="token punctuation">\</span>					<span class="token comment">#虚拟机内存大小</span>
--vcpus <span class="token number">2</span> <span class="token punctuation">\</span>					<span class="token comment">#虚拟机cpu个数</span>
--disk /var/lib/libvirt/images/base.qcow2 <span class="token punctuation">\</span>			<span class="token comment">#系统磁盘卷路径</span>
--location /opt/iso/CentOS-7-x86_64-DVD-1908.iso <span class="token punctuation">\</span>		<span class="token comment">#系统安装iso路径</span>
--nographics <span class="token punctuation">\</span>										<span class="token comment">#不调用图形化界面</span>
--network <span class="token assign-left variable">bridge</span><span class="token operator">=</span>br0 <span class="token punctuation">\</span>								<span class="token comment">#网卡1指定网桥</span>
--network <span class="token assign-left variable">bridge</span><span class="token operator">=</span>br0 <span class="token punctuation">\</span>								<span class="token comment">#网卡2指定网桥</span>
--os-type linux <span class="token punctuation">\</span>									<span class="token comment">#操作系统类型</span>
--os-variant rhel7 <span class="token punctuation">\</span>									<span class="token comment">#操作系统版本</span>
--console pty,target_type<span class="token operator">=</span>serial <span class="token punctuation">\</span>					<span class="token comment">#console控制通道</span>
--extra-args <span class="token string">'console=ttyS0,115200n8 serial'</span>			<span class="token comment">#文本输出</span>
</code></pre> 
<p>主要需要修改的地方是：n、r、vcpus、disk、location、network</p> 
<p>执行命令后一会会显示以下内容：<br> <img src="https://images2.imgbox.com/71/56/ZIc5NM3u_o.png" alt="在这里插入图片描述"><br> 各选项含义如下：<br> 1）语言设置 2）时区设置 3）安装源 4）软件包选择<br> 5）系统分区 6）Kdump功能 7）网络配置 8）密码设置<br> 9）创建用户<br> 按“q”退出，按“b”开始安装。必须把带“！”号的都设置好才能开始安装。</p> 
<p>接下来可以进行一一设置，可以按照自己的想法来，以下是我提供的参考：</p> 
<p>1）语言设置（默认英语，这里不动）</p> 
<p>2）时区设置</p> 
<p>这里依次输入2-&gt;1-&gt;2-&gt;回车-&gt;65，进行设置！<br> 注意这里的选择会因为ISO镜像的不同而不同，时区我们只需要选择成“shanghai”就可以了。<br> <img src="https://images2.imgbox.com/3a/ce/2nD9QYy7_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/0e/9e/glzK2L4x_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/88/84/rztQkltH_o.png" alt="在这里插入图片描述"><br> 设置好后，！号就变成x了。</p> 
<p>3）这里我不动</p> 
<p>4）软件包选择（默认是Minimal Install，可以根据实际修改，这里我不变）</p> 
<p>5）系统分区</p> 
<p>这里全部选择默认的即可，按 <code>c</code> 即可继续。</p> 
<p>8）密码设置（自己设置好即可）</p> 
<p>完成设置后就可以开始安装系统了，按“b”开始安装：<br> <img src="https://images2.imgbox.com/c0/b0/VblQKqpX_o.png" alt="在这里插入图片描述"><br> 稍等一会，显示如下表示安装结束，按回车重启系统：<br> <img src="https://images2.imgbox.com/35/21/hptLLbux_o.png" alt="在这里插入图片描述"><br> 重启后输入用户名和密码就可以登录进你创建的虚拟机了：<br> <img src="https://images2.imgbox.com/99/a8/JxNd8uTF_o.png" alt="在这里插入图片描述"><br> 重新开一个会话链接上宿主机，查看网桥情况，可以看到在“interfaces”下多了vnet0和vnet1这2个网卡，这是刚建好的虚拟机网卡，已桥接在物理网卡上了：</p> 
<pre><code class="prism language-shell">brctl show
</code></pre> 
<p><img src="https://images2.imgbox.com/23/21/JSmVDWN4_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="0x02__111"></a>0x02 配置虚拟机网络</h2> 
<ol><li>修改网络配置文件</li></ol> 
<p>之后你就可以进入你新建的虚拟机，然后像平常一样配置主机名和网络了，操作参考：<br> <a href="https://blog.csdn.net/shaock2018/article/details/83588140#3ip_18">设置网络</a></p> 
<p>使用console连接虚拟机的命令（base为安装虚拟机时指定的名字）：</p> 
<pre><code class="prism language-shell"><span class="token function">virsh</span> console base
</code></pre> 
<p>此操作只能打开一个，后面改好ip后，可以直接ssh进去，就可以打开多个会话了。</p> 
<pre><code class="prism language-shell"><span class="token builtin class-name">cd</span> /etc/sysconfig/network-scripts/
</code></pre> 
<p><img src="https://images2.imgbox.com/22/fb/CGoPM4am_o.png" alt="在这里插入图片描述"><br> 修改网卡配置</p> 
<pre><code class="prism language-shell"><span class="token function">vi</span> ifcfg-eth0
</code></pre> 
<p><img src="https://images2.imgbox.com/a7/78/9M4KZQlC_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-shell"><span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token number">192.168</span>.80.219
<span class="token assign-left variable">GATEWAY</span><span class="token operator">=</span><span class="token number">192.168</span>.80.1
<span class="token assign-left variable">DNS1</span><span class="token operator">=</span><span class="token number">192.168</span>.80.1
<span class="token assign-left variable">DNS2</span><span class="token operator">=</span><span class="token number">114.114</span>.114.114
<span class="token assign-left variable">NETMASK</span><span class="token operator">=</span><span class="token number">255.255</span>.255.0
</code></pre> 
<p>注意：<br> 1、这里最好加多一个DNS2，因为可能会应该配置原因，直接使用<code>192.168.80.1</code>会不能上外网。<br> 2、这里的IP地址最好先ping一下是否ping得通，如果ping得通，可能是别人正在使用的ip，此时可以换一个。</p> 
<ol start="2"><li>校验网络</li></ol> 
<p>修改好之后重启网络然后ping百度，发现是可以通的：</p> 
<pre><code class="prism language-shell">systemctl restart network
</code></pre> 
<pre><code class="prism language-shell"><span class="token function">ping</span> www.baidu.com
</code></pre> 
<p><img src="https://images2.imgbox.com/c4/3c/qrJzjGcZ_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="0x03__153"></a>0x03 修改虚拟机的主机名</h2> 
<pre><code class="prism language-bash">hostnamectl set-hostname base
<span class="token function">bash</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/05/51/rmjamEr4_o.png" alt="在这里插入图片描述"><br> 至此，命令行创建虚拟机及相关配置的教程结束！</p> 
<h2><a id="0xFF__161"></a>0xFF 总结</h2> 
<ol><li>还是非常简单的，而且步骤也非常固定，只需要简单修改就可以入门，之后还有更多的操作教程，请继续留意本博客，谢谢！</li></ol> 
<blockquote> 
 <p><strong>邵奈一</strong> 原创不易，如转载请标明出处，教育是一生的事业。</p> 
</blockquote> 
<hr>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f19a8ed118d801a99717f63efc0d4a5e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">《给java开发者的实操避坑指南》学习笔记——空指针和异常</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7c95a0e46e1c5e8ea5bc909bccc65116/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">‘grep‘ 不是内部或外部命令，也不是可运行的程序 或批处理文件。</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>