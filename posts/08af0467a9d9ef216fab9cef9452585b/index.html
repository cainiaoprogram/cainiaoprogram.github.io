<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于Vue&#43;SpringCloudAlibaba微服务电商项目实战-构建会员服务-011：基于Vue快速整合会员服务接口 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="基于Vue&#43;SpringCloudAlibaba微服务电商项目实战-构建会员服务-011：基于Vue快速整合会员服务接口" />
<meta property="og:description" content="011：基于Vue快速整合会员服务接口 1 构建前端Vue项目调用后端接口实现联合登录效果演示2 什么是微服务前后端分离开发的模式3 联合登录接口接口简单回顾4 前后端分离解决跨域的问题5 Vue项目中构建登录页面加载网络6 回调接口需要Web层实现中转的原理7 前端获取Url中的token参数实现传递8 Vue整合后端微服务接口实现联合登录演示9 微信联合登录生成二维码说明 1 构建前端Vue项目调用后端接口实现联合登录效果演示 今日课程任务
如何快速理解前后端分离架构模式前后端分离架构模式还存在哪些缺点快速构建Vue项目调用后端接口前后端分离架构如何解决跨域的问题基于Vue调用后端接口实现联合登录如何快速部署Vue项目 2 什么是微服务前后端分离开发的模式 早期java项目 分成三层结构
com.mayikt.controller 单独web项目 ftl/jsp
com.mayikt.service
com.mayikt.dao
这种架构模式没有体现让专业的人做专业的事情
微服务架构提倡：让专业的人做专业的事情 前后端分离架构模式
如何理解前后端分离架构模式？
将以前控制层业务逻辑的操作全部交给前端开发实现，后端工程师主要开发接口被前端调用。
Vue项目的应用场景：
适用于移动端Web、微信公众号、企业级管理平台 （对搜索引擎seo不友好）
前后端分离架构模式存在哪些优缺点：
缺点：
1.联调测试 需要搭建局域网或者外网映射
2.沟通成本比较高 后端有变动需要通知前端
3.只适合比较大的互联网团队
4.跨域问题
优点：
后端开发不需要修改页面，让专业的人做专业的事情，效率更高
前后端分离架构前端页面如何部署？
前端项目实际上就是静态html&#43;ajax调用接口绑定数据，放在nginx/tomcat服务器/cdn加速服务器中均可运行。
3 联合登录接口接口简单回顾 需要提供查询联合登录渠道接口 首页登录展示图标登录接口改造，如果有传递openIdToken，关联到数据库中根据openIdToken判断是否已经关联账号，如果关联则跳转到首页，没有关联则跳转到关联页面 查询渠道接口
数据库表meite_union_login新增字段union_image_log，存储渠道图标用于页面展示
UnionLoginDTO
@Data public class UnionLoginDTO { /** * 手机号码 */ @ApiModelProperty(value = &#34;手机号码&#34;, name = &#34;mobile&#34;, required = true) private String mobile; /** * 密码 */ @ApiModelProperty(value = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/08af0467a9d9ef216fab9cef9452585b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-08T16:54:28+08:00" />
<meta property="article:modified_time" content="2021-06-08T16:54:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于Vue&#43;SpringCloudAlibaba微服务电商项目实战-构建会员服务-011：基于Vue快速整合会员服务接口</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>011：基于Vue快速整合会员服务接口</h4> 
 <ul><li><ul><li><a href="#1_Vue_2" rel="nofollow">1 构建前端Vue项目调用后端接口实现联合登录效果演示</a></li><li><a href="#2__11" rel="nofollow">2 什么是微服务前后端分离开发的模式</a></li><li><a href="#3__38" rel="nofollow">3 联合登录接口接口简单回顾</a></li><li><a href="#4__91" rel="nofollow">4 前后端分离解决跨域的问题</a></li><li><a href="#5_Vue_111" rel="nofollow">5 Vue项目中构建登录页面加载网络</a></li><li><a href="#6_Web_155" rel="nofollow">6 回调接口需要Web层实现中转的原理</a></li><li><a href="#7_Urltoken_205" rel="nofollow">7 前端获取Url中的token参数实现传递</a></li><li><a href="#8_Vue_338" rel="nofollow">8 Vue整合后端微服务接口实现联合登录演示</a></li><li><a href="#9__344" rel="nofollow">9 微信联合登录生成二维码说明</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="1_Vue_2"></a>1 构建前端Vue项目调用后端接口实现联合登录效果演示</h3> 
<p><strong>今日课程任务</strong></p> 
<ol><li>如何快速理解前后端分离架构模式</li><li>前后端分离架构模式还存在哪些缺点</li><li>快速构建Vue项目调用后端接口</li><li>前后端分离架构如何解决跨域的问题</li><li>基于Vue调用后端接口实现联合登录</li><li>如何快速部署Vue项目</li></ol> 
<h3><a id="2__11"></a>2 什么是微服务前后端分离开发的模式</h3> 
<p><strong>早期java项目 分成三层结构</strong><br> com.mayikt.controller 单独web项目 ftl/jsp<br> com.mayikt.service<br> com.mayikt.dao<br> 这种架构模式没有体现让专业的人做专业的事情</p> 
<p><strong>微服务架构提倡</strong>：让专业的人做专业的事情 前后端分离架构模式</p> 
<p><strong>如何理解前后端分离架构模式？</strong><br> 将以前控制层业务逻辑的操作全部交给前端开发实现，后端工程师主要开发接口被前端调用。</p> 
<p><strong>Vue项目的应用场景：</strong><br> 适用于移动端Web、微信公众号、企业级管理平台 （对搜索引擎seo不友好）</p> 
<p><strong>前后端分离架构模式存在哪些优缺点：</strong><br> <strong>缺点：</strong><br> 1.联调测试 需要搭建局域网或者外网映射<br> 2.沟通成本比较高 后端有变动需要通知前端<br> 3.只适合比较大的互联网团队<br> 4.跨域问题<br> <strong>优点：</strong><br> 后端开发不需要修改页面，让专业的人做专业的事情，效率更高</p> 
<p><strong>前后端分离架构前端页面如何部署？</strong><br> 前端项目实际上就是静态html+ajax调用接口绑定数据，放在nginx/tomcat服务器/cdn加速服务器中均可运行。</p> 
<h3><a id="3__38"></a>3 联合登录接口接口简单回顾</h3> 
<ol><li>需要提供查询联合登录渠道接口 首页登录展示图标</li><li>登录接口改造，如果有传递openIdToken，关联到数据库中</li><li>根据openIdToken判断是否已经关联账号，如果关联则跳转到首页，没有关联则跳转到关联页面</li></ol> 
<p><strong>查询渠道接口</strong><br> 数据库表meite_union_login新增字段union_image_log，存储渠道图标用于页面展示<br> <strong>UnionLoginDTO</strong></p> 
<pre><code class="prism language-javascript">@Data
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UnionLoginDTO</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 手机号码
     */</span>
    @<span class="token function">ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"手机号码"</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"mobile"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String mobile<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 密码
     */</span>
    @<span class="token function">ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"密码"</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"passWord"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String passWord<span class="token punctuation">;</span>


    @<span class="token function">ApiModelProperty</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"开放平台令牌"</span><span class="token punctuation">,</span> name <span class="token operator">=</span> <span class="token string">"openIdToken"</span><span class="token punctuation">,</span> required <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String openIdToken<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>MemberUnionLoginService/MemberUnionLoginServiceImpl</strong></p> 
<pre><code class="prism language-javascript"><span class="token comment">/**
 * 查询当前开通的渠道
 *
 * @return
 */</span>
@<span class="token function">GetMapping</span><span class="token punctuation">(</span><span class="token string">"/unionLoginList"</span><span class="token punctuation">)</span>
@ResponseBody
BaseResponse<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>UnionLoginDTO<span class="token operator">&gt;&gt;</span> <span class="token function">unionLoginList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-javascript">@Override
<span class="token keyword">public</span> BaseResponse<span class="token operator">&lt;</span>List<span class="token operator">&lt;</span>UnionLoginDTO<span class="token operator">&gt;&gt;</span> <span class="token function">unionLoginList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    List<span class="token operator">&lt;</span>UnionLoginDO<span class="token operator">&gt;</span> unionLoginList <span class="token operator">=</span> unionLoginMapper<span class="token punctuation">.</span><span class="token function">selectByUnionLoginList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>unionLoginList <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">setResultError</span><span class="token punctuation">(</span><span class="token string">"当前没有可用渠道"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    List<span class="token operator">&lt;</span>UnionLoginDO<span class="token operator">&gt;</span> unionLoginDtos <span class="token operator">=</span> MeiteBeanUtils<span class="token punctuation">.</span><span class="token function">doToDtoList</span><span class="token punctuation">(</span>unionLoginList<span class="token punctuation">,</span> UnionLoginDO<span class="token punctuation">.</span>class<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">setResultSuccess</span><span class="token punctuation">(</span>unionLoginDtos<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>测试效果：</strong><br> <img src="https://images2.imgbox.com/4f/4c/4VVbDap9_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4__91"></a>4 前后端分离解决跨域的问题</h3> 
<p><strong>前后端分离解决跨域的问题 来源浏览器的安全策略</strong><br> 浏览器地址访问http://127.0.0.1:8849/mayikt_mt_shop/login.html访问vue项目，<br> 页面里面发出ajax请求必须要和地址栏的ip和端口必须要保持一致，否则浏览器会有安全策略问题。<br> ajax请求：http://127.0.0.1:7070/unionLoginList</p> 
<p><strong>解决跨域方案（浏览器访问端口号和页面请求的端口号不一致）</strong></p> 
<ol><li>在响应头中设置允许跨域 只适合于小公司<br> 响应配置response.setHeader(“Access-Control-Allow-Origin”,"*")</li><li>使用HttpClient转发 效率低</li><li>使用jsonp处理 Jsonp不支持post请求，属于前端解决</li><li>使用Nginx解决跨域，保持域名和端口一致性<br> www.mayikt.com/vue 转发到vue项目<br> www.mayikt.com/api 转发到接口项目</li><li>可以直接在nginx中配置允许跨域的代码<br> “Access-Control-Allow-Origin”,"*"</li><li>使用网关配置类似于nginx允许跨域的代码</li><li>使用SpringBoot注解形式@CrossOrigin</li><li>使用微服务网关也可以配置，配置浏览器访问的项目与接口项目的域名和端口号一致<br> <img src="https://images2.imgbox.com/c4/46/QVQYFzgf_o.png" alt="在这里插入图片描述"></li></ol> 
<h3><a id="5_Vue_111"></a>5 Vue项目中构建登录页面加载网络</h3> 
<p><strong>Vue前端页面</strong><br> Axios 官方文档 https://www.kancloud.cn/yunye/axios/234845</p> 
<p><strong>login.html</strong></p> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"logon_others"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"logon_others_title"</span><span class="token operator">&gt;</span>其他登录方式<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>a <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"logon_qq"</span> v<span class="token operator">-</span><span class="token keyword">for</span><span class="token operator">=</span><span class="token string">"(p) in dunionLogins"</span> <span class="token operator">:</span>href<span class="token operator">=</span><span class="token string">"p.requestAddress"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>img <span class="token operator">:</span>src<span class="token operator">=</span><span class="token string">"p.unionImgLog"</span> <span class="token operator">:</span>alt<span class="token operator">=</span><span class="token string">"p.unionName"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
…
<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"./js/union_login.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> 
<p><strong>union_login.js</strong></p> 
<pre><code>var vue = new Vue({
	el: "#app",
	data: {
		msg: "mayikt",
		dunionLogins: []
	},
	created: function() {
		this.loadUnionLoginList();
	},
	methods: {
		loadUnionLoginList: function() {
			var temp = this;
			axios.get('http://127.0.0.1:7070/unionLoginList')
				.then(function(response) {
					// alert(response);
					var data = response.data.data;
					temp.dunionLogins = data;
					console.log(response);
				})
				.catch(function(error) {
					console.log(error);
				});
		}

	}
})
</code></pre> 
<p><strong>测试效果：</strong><br> <img src="https://images2.imgbox.com/c5/53/wcjbZlEf_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="6_Web_155"></a>6 回调接口需要Web层实现中转的原理</h3> 
<p><img src="https://images2.imgbox.com/2c/e5/6ZL4ymIY_o.png" alt="在这里插入图片描述"><br> 会员接口中直接写重定向代码到vue项目不符合规范，需要一个web项目作为中转。<br> 通常情况应该起一个web-member项目调用会员服务接口，配置qq、微信回调地址为web接口地址，调用成功返回bindingurl页面，失败返回错误页面。</p> 
<p><strong>为了简化流程此处先将回调接口改为重定向到Vue项目</strong></p> 
<pre><code class="prism language-javascript">@<span class="token function">GetMapping</span><span class="token punctuation">(</span><span class="token string">"/login/oauth/callback"</span><span class="token punctuation">)</span>
<span class="token comment">//    public BaseResponse&lt;JSONObject&gt; unionLoginCallback(@RequestParam("unionPublicId") String unionPublicId);</span>
    <span class="token keyword">public</span> String <span class="token function">unionLoginCallback</span><span class="token punctuation">(</span>@<span class="token function">RequestParam</span><span class="token punctuation">(</span><span class="token string">"unionPublicId"</span><span class="token punctuation">)</span> String unionPublicId<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-javascript">@Controller
@CrossOrigin
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemberUnionLoginServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">BaseApiService</span> <span class="token keyword">implements</span> <span class="token class-name">MemberUnionLoginService</span> <span class="token punctuation">{<!-- --></span>

    @Autowired
    <span class="token keyword">private</span> UnionLoginMapper unionLoginMapper<span class="token punctuation">;</span>
    @Autowired
    <span class="token keyword">private</span> TokenUtil tokenUtil<span class="token punctuation">;</span>
    @<span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">"${mayikt.login.vue.bindingurl}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String bindingurl<span class="token punctuation">;</span>

    @Override
    <span class="token keyword">public</span> String <span class="token function">unionLoginCallback</span><span class="token punctuation">(</span><span class="token parameter">String unionPublicId</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 根据渠道id查询 联合基本信息</span>
        UnionLoginDO unionLoginDo <span class="token operator">=</span> unionLoginMapper<span class="token punctuation">.</span><span class="token function">selectByUnionLoginId</span><span class="token punctuation">(</span>unionPublicId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        String unionBeanId <span class="token operator">=</span> unionLoginDo<span class="token punctuation">.</span><span class="token function">getUnionBeanId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//  从Spring容器中根据beanid 查找到我们的策略类</span>
        UnionLoginStrategy unionLoginStrategy <span class="token operator">=</span> SpringContextUtils<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span>unionBeanId<span class="token punctuation">,</span> UnionLoginStrategy<span class="token punctuation">.</span>class<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 根据当前线程获取request对象</span>
        HttpServletRequest request <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>ServletRequestAttributes<span class="token punctuation">)</span>
                <span class="token punctuation">(</span>RequestContextHolder<span class="token punctuation">.</span><span class="token function">currentRequestAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String openId <span class="token operator">=</span> unionLoginStrategy<span class="token punctuation">.</span><span class="token function">unionLoginCallback</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> unionLoginDo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        JSONObject jsonObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"openId"</span><span class="token punctuation">,</span> openId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"unionPublicId"</span><span class="token punctuation">,</span> unionPublicId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        String openToken <span class="token operator">=</span> tokenUtil<span class="token punctuation">.</span><span class="token function">createToken</span><span class="token punctuation">(</span><span class="token string">"mayikt.unionLogin."</span><span class="token punctuation">,</span> jsonObject<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"redirect:"</span> <span class="token operator">+</span> bindingurl <span class="token operator">+</span> openToken<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>bootstrap.yml</strong></p> 
<pre><code>mayikt:
  login:
      vue:
      bindingurl: http://127.0.0.1:8849/mayikt_mt_shop/relation_login.html?openIdToken=
</code></pre> 
<h3><a id="7_Urltoken_205"></a>7 前端获取Url中的token参数实现传递</h3> 
<p><strong>relation_login.html 第三方登录页面</strong></p> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
		<span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">function</span> <span class="token function">getQueryString</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">"(^|&amp;)"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"=([^&amp;]*)(&amp;|$)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">var</span> r <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>search<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">unescape</span><span class="token punctuation">(</span>r<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">function</span> <span class="token function">locationBindLogin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"bind_login.html?openIdToken="</span> <span class="token operator">+</span> <span class="token function">getQueryString</span><span class="token punctuation">(</span><span class="token string">'openIdToken'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:7070/openIdToken?openIdToken='</span> <span class="token operator">+</span> <span class="token function">getQueryString</span><span class="token punctuation">(</span><span class="token string">'openIdToken'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">var</span> data <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">var</span> userToken <span class="token operator">=</span> data<span class="token punctuation">.</span>data<span class="token punctuation">.</span>userToken<span class="token punctuation">;</span>
						window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"index.html?userToken="</span> <span class="token operator">+</span> userToken<span class="token punctuation">;</span>
						<span class="token keyword">return</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
…
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"bind"</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"bind_contain"</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>确认关联小米账号<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">"http://static.mayikt.com/QQ20191226.png"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>p <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"name"</span><span class="token operator">&gt;</span>蚂蚁课堂创始人<span class="token operator">-</span>余胜军<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>您的<span class="token constant">QQ</span>尚未关联小米账号<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"bind_bottom"</span><span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span>a href<span class="token operator">=</span><span class="token string">"register.html"</span><span class="token operator">&gt;</span>关联新账号<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span>a <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"old_"</span> href<span class="token operator">=</span><span class="token string">"javascript:void(0);"</span> onclick<span class="token operator">=</span><span class="token string">"locationBindLogin()"</span><span class="token operator">&gt;</span>关联到已有账号<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

		<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
</code></pre> 
<p><strong>bind_login.html 绑定账号页面</strong></p> 
<pre><code class="prism language-javascript">	<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"Joint"</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>a <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"logon_logo"</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">"http://static.mayikt.com/logomayishangcheng.png"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>a<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"Joint_container"</span> id<span class="token operator">=</span><span class="token string">"app"</span><span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>请登录您要关联的账号<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"regbox"</span><span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"el-input el-input--suffix"</span><span class="token operator">&gt;</span>
						<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> autocomplete<span class="token operator">=</span><span class="token string">"off"</span>
						  v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"phone"</span>
						 placeholder<span class="token operator">=</span><span class="token string">"账号"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"el-input__inner"</span><span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"el-input el-input--suffix"</span><span class="token operator">&gt;</span>
						<span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"password"</span>
						  v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">"passWord"</span>
						 autocomplete<span class="token operator">=</span><span class="token string">"off"</span> placeholder<span class="token operator">=</span><span class="token string">"密码"</span> <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"el-input__inner"</span><span class="token operator">&gt;</span>
						<span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"el-input__suffix"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span>span <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"el-input__suffix-inner"</span><span class="token operator">&gt;</span>
							<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
						<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span>button type<span class="token operator">=</span><span class="token string">"button"</span>  @click<span class="token operator">=</span><span class="token string">"login()"</span>   <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">"el-button el-button--default"</span><span class="token operator">&gt;</span>
					<span class="token operator">&lt;</span>span <span class="token operator">&gt;</span>绑定并登录<span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">&gt;</span>
				<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
			<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"https://cdn.jsdelivr.net/npm/vue/dist/vue.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"https://unpkg.com/axios/dist/axios.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
			<span class="token keyword">function</span> <span class="token function">getQueryString</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">"(^|&amp;)"</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">"=([^&amp;]*)(&amp;|$)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">var</span> r <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>search<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>reg<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>r <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">unescape</span><span class="token punctuation">(</span>r<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
		<span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"js/bind_login.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
</code></pre> 
<p><strong>bind_login.js</strong></p> 
<pre><code>var vue = new Vue({
	el: "#app",
	data: {
		phone: "",
		passWord: ""
	},
	methods: {
		login: function() {
			var temp = this;
			axios.post('http://127.0.0.1:7070/login', {
					mobile: this.phone,
					passWord: this.passWord,
					openIdToken: getQueryString("openIdToken")
				}, {
					headers: {
						'X-Real-IP': '127.0.0.1',
						'channel': 'PC',
						'deviceInfor': 'huawei8'
					}
				})
				.then(function(response) {
					var data = response.data;
					if (data.code != 200) {
						alert(data.msg);
						return;
					}
					alert('登录成功');
					var userToken = data.data.userToken;
					window.location.href = "index.html?userToken=" + userToken;
				})
				.catch(function(error) {
					console.log(error);
				});
		}
	}
})
</code></pre> 
<p><strong>测试效果：</strong><br> <img src="https://images2.imgbox.com/5a/22/Czl8kQrU_o.png" alt="在这里插入图片描述"><br> 填入账号密码调用后台login接口传递openIdToken，异步方法AsyncLoginLogManage更新数据库绑定账户openId。<br> <img src="https://images2.imgbox.com/6b/c1/LPHMQsGN_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="8_Vue_338"></a>8 Vue整合后端微服务接口实现联合登录演示</h3> 
<p><strong>测试效果：</strong><br> <img src="https://images2.imgbox.com/be/9e/SK7SRPTm_o.png" alt="在这里插入图片描述"><br> <strong>注意</strong>：实现类MemberOpenIdTokenLoginImpl/MemberUnionLoginServiceImpl/<br> MemberLoginServiceImpl上面都要加上注解@CrossOrigin</p> 
<h3><a id="9__344"></a>9 微信联合登录生成二维码说明</h3> 
<p>整体流程同qq联合登录类似，不同之处在于点击微信登录图标前端页面显示二维码（后端调用生成二维码接口返回给前端），用户微信扫码相当于QQ点击头像授权操作，然后账户未绑定则更新openId，如果已绑定直接跳转到首页。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2390a7147b36d78adc99c3282f9fe1c7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">从键盘输入a, b, c的值，编程计算并输出一元二次方程ax2 &#43; bx &#43; c = 0的根。</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cb817d00fa3b31ad1d55b5901663f8b6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">凸优化——无约束优化问题常用求解方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>