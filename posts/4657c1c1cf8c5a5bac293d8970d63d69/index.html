<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>23_linux笔记-ansible - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="23_linux笔记-ansible" />
<meta property="og:description" content="文章目录 示例1：永久修改selinux示例2：看当前系统有多少连接 (establish)知识点1 SSH访问控制示例：/etc/hosts.deny 知识点2 ssh隧道知识点3 ansible服务知识点4 了解云计算知识点5 ansible不是守护进程知识点6 ansible的模块1、copy模块2、fetch模块3、command模块4、shell模块5、file模块6、cron模块7、yum模块8、service模块9、script模块 知识点7 查看系统版本知识点8 链接示例1：软链接示例2：硬链接 知识点9 playbook示例1：编写/执行 playbook示例2：yaml文件怎么去编写示例3：多个操作 博客cPen_web 示例1：永久修改selinux [root@cPen_A ~]# vim /etc/selinux/config SELINUX=disabled 示例2：看当前系统有多少连接 (establish) [root@cPen_B ~]# netstat -anplut|grep -E &#34;ESTABLISHED|LISTEN|TIME_WAIT&#34;|awk -F&#34; &#34; {&#39;print $6&#39;}|sort|uniq -c 2 ESTABLISHED 2 LISTEN #------------------------------------------------------------------------------- [root@cPen_B ~]# netstat -anplut Active Internet connections (servers and established) Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name tcp 0 0 0.0.0.0:2233 0.0.0.0:* LISTEN 911/sshd tcp 0 232 192." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/4657c1c1cf8c5a5bac293d8970d63d69/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-11-25T19:27:29+08:00" />
<meta property="article:modified_time" content="2020-11-25T19:27:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">23_linux笔记-ansible</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1selinux_3" rel="nofollow">示例1：永久修改selinux</a></li><li><a href="#2_establish_9" rel="nofollow">示例2：看当前系统有多少连接 (establish)</a></li><li><a href="#1_SSH_25" rel="nofollow">知识点1 SSH访问控制</a></li><li><ul><li><a href="#etchostsdeny_30" rel="nofollow">示例：/etc/hosts.deny</a></li></ul> 
  </li><li><a href="#2_ssh_43" rel="nofollow">知识点2 ssh隧道</a></li><li><a href="#3_ansible_96" rel="nofollow">知识点3 ansible服务</a></li><li><a href="#4__205" rel="nofollow">知识点4 了解云计算</a></li><li><a href="#5_ansible_217" rel="nofollow">知识点5 ansible不是守护进程</a></li><li><a href="#6_ansible_230" rel="nofollow">知识点6 ansible的模块</a></li><li><ul><li><a href="#1copy_232" rel="nofollow">1、copy模块</a></li><li><a href="#2fetch_278" rel="nofollow">2、fetch模块</a></li><li><a href="#3command_310" rel="nofollow">3、command模块</a></li><li><a href="#4shell_337" rel="nofollow">4、shell模块</a></li><li><a href="#5file_344" rel="nofollow">5、file模块</a></li><li><a href="#6cron_378" rel="nofollow">6、cron模块</a></li><li><a href="#7yum_423" rel="nofollow">7、yum模块</a></li><li><a href="#8service_444" rel="nofollow">8、service模块</a></li><li><a href="#9script_469" rel="nofollow">9、script模块</a></li></ul> 
  </li><li><a href="#7__483" rel="nofollow">知识点7 查看系统版本</a></li><li><a href="#8__491" rel="nofollow">知识点8 链接</a></li><li><ul><li><a href="#1_492" rel="nofollow">示例1：软链接</a></li><li><a href="#2_501" rel="nofollow">示例2：硬链接</a></li></ul> 
  </li><li><a href="#9_playbook_528" rel="nofollow">知识点9 playbook</a></li><li><ul><li><a href="#1_playbook_550" rel="nofollow">示例1：编写/执行 playbook</a></li><li><a href="#2yaml_563" rel="nofollow">示例2：yaml文件怎么去编写</a></li><li><a href="#3_594" rel="nofollow">示例3：多个操作</a></li></ul> 
 </li></ul> 
</div> 
<br> 
<a href="https://blog.csdn.net/cPen_web">博客cPen_web</a> 
<p></p> 
<h2><a id="1selinux_3"></a>示例1：永久修改selinux</h2> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_A ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/selinux/config </span>
SELINUX<span class="token operator">=</span>disabled
</code></pre> 
<h2><a id="2_establish_9"></a>示例2：看当前系统有多少连接 (establish)</h2> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_B ~<span class="token punctuation">]</span><span class="token comment"># netstat -anplut|grep -E "ESTABLISHED|LISTEN|TIME_WAIT"|awk -F" " {'print $6'}|sort|uniq -c</span>
      2 ESTABLISHED
      2 LISTEN
<span class="token comment">#-------------------------------------------------------------------------------</span>
<span class="token punctuation">[</span>root@cPen_B ~<span class="token punctuation">]</span><span class="token comment"># netstat -anplut</span>
Active Internet connections <span class="token punctuation">(</span>servers and established<span class="token punctuation">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 0.0.0.0:2233            0.0.0.0:*               LISTEN      911/sshd            
tcp        0    232 192.168.0.31:2233       192.168.0.42:54290      ESTABLISHED 1402/sshd: root <span class="token punctuation">[</span>pr 
<span class="token comment">#-------------------------------------------------------------------------------------------------------------</span>
<span class="token comment"># pstree	查看进程之间的关系</span>
<span class="token comment"># netstat	查看当前网络连接</span>
</code></pre> 
<h2><a id="1_SSH_25"></a>知识点1 SSH访问控制</h2> 
<p>SSH使用TCP Wrappers实现访问控制 # 注：做访问控制<br> 主要配置文件<br> ·/etc/hosts.allow<br> ·/etc/hosts.deny</p> 
<h3><a id="etchostsdeny_30"></a>示例：/etc/hosts.deny</h3> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_A ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/hosts.deny </span>
sshd:192.168.0.31	
<span class="token comment"># 注：访问控制，拒绝192.168.0.31 不需要重启服务，有守护进程帮它控制</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#注：主机公钥在 /etc/ssh/下面	默认使用ecdsa模式</span>
<span class="token comment">#注：known_hosts文件里有什么	前面是ip地址，后面是公钥</span>
<span class="token comment">#注：authorized_keys	放受信任的公钥</span>
</code></pre> 
<h2><a id="2_ssh_43"></a>知识点2 ssh隧道</h2> 
<p>#注：本地端口转发<br> CSDN https://www.cnblogs.com/keerya/p/7612715.html<br> 端口转发：A、C、B主机。主机B起了个nginx服务 端口号80；主机A不能直接访问主机B，但主机A可以访问主机C，主机C可以访问主机B (A–&gt;C–&gt;B)；A可以ssh到C，A跳到C，然后访问B的80端口 (nginx)。现在 在主机C上面建立一个隧道，隧道开启15577端口连接B的80端口，A去访问15577端口相当于去访问B的80映射</p> 
<pre><code class="prism language-bash"><span class="token comment">#注：ssh隧道 第一个用于不能直接访问的情况；第二个考虑密文传输</span>
<span class="token punctuation">[</span>root@cPen_C ~<span class="token punctuation">]</span><span class="token comment"># lsof -i:15577			# 注：在C主机上操作，15577端口未被占用</span>
<span class="token punctuation">[</span>root@cPen_C ~<span class="token punctuation">]</span><span class="token comment"># ssh -g -L 15577:192.168.0.39:80 sanchuang@192.168.0.39 -p 2233</span>
<span class="token comment">#注：192.168.0.39 右边B主机ip地址		# 注：在C主机上开通一个隧道 端口为15577</span>
<span class="token punctuation">[</span>root@cPen_A ~<span class="token punctuation">]</span><span class="token comment"># curl 192.168.0.48:15577	# 注：模仿网络访问 (80端口nginx网页使用curl访问)</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html PUBLIC <span class="token string">"-//W3C//DTD XHTML 1.1//EN"</span> <span class="token string">"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"</span><span class="token operator">&gt;</span>	<span class="token comment"># 注：返回的内容</span>
<span class="token comment">#注：192.168.0.48 中间C主机ip地址		# 注：注意防火墙	iptables -F</span>
<span class="token comment">#注：访问中间C主机的15577端口 转接成右边B主机的80端口</span>
<span class="token comment">#注：注意 不能绑定到本地的回环地址 127.0.0.1	只能访问自己 (所以 -g) -g作用 本地所有ip都是访问</span>
<span class="token comment">#注：- L是本地端口转发</span>
<span class="token comment">#注：一般可以开启65535个端口</span>
</code></pre> 
<p>#总结：ssh隧道<br> 端口转发<br> 1、关闭防火墙<br> 2、关闭selinux</p> 
<pre><code class="prism language-bash"><span class="token comment">#本地端口转发</span>
<span class="token comment"># ssh -g -L 15577:192.168.0.39:80 192.168.0.39 -p 2233	# 注：C主机上执行 把B主机80端口映射本地15577端口</span>
</code></pre> 
<p>实验环境：<br> A主机：192.168.0.132<br> C主机：192.168.0.48<br> B主机：192.168.0.39 <br> 在C主机上执行：[root@cPen_C ~]# ssh -g -L 15577:192.168.0.39:80 192.168.0.39 -p 2233<br> 把B主机的80端口映射到本地的15577端口<br> 访问C主机的15577端口就是访问B主机的80端口</p> 
<pre><code class="prism language-bash"><span class="token comment">#远程端口转发</span>
<span class="token comment"># ssh -R 15566:192.168.0.39:80 -fN 192.168.0.132 -p 2233 # 注：C主机上 把B主机80端口 映射到 A主机15566端口</span>
</code></pre> 
<p>远程端口转发：在C主机上执行：[root@C .ssh]# ssh -R 15566:192.168.0.39:80 -fN 192.168.0.132 -p 2233<br> 把B主机的80端口映射到A主机的15566端口<br> 访问A主机的15566就是访问B主机的80</p> 
<pre><code class="prism language-bash"><span class="token comment">#注：A主机 192.168.0.132</span>
<span class="token comment">#注：B主机 192.168.0.39</span>
<span class="token comment">#注：在C主机上建立远程通道，在C主机上为A主机启动15566端口，映射到B主机</span>
<span class="token punctuation">[</span>root@cPen_A ~<span class="token punctuation">]</span><span class="token comment"># lsof -i:15566				# 注：A主机开启15566端口</span>
sshd    2067 root    8u  IPv6  38604      0t0  TCP localhost:15566 <span class="token punctuation">(</span>LISTEN<span class="token punctuation">)</span>	<span class="token comment"># 注：监听的是本地回环地址</span>
sshd    2067 root    9u  IPv4  38605      0t0  TCP localhost:15566 <span class="token punctuation">(</span>LISTEN<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@cPen_A ~<span class="token punctuation">]</span><span class="token comment"># curl 127.0.0.1:15566			# 注：访问本地15566端口映射到B主机的80端口</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html PUBLIC <span class="token string">"-//W3C//DTD XHTML 1.1//EN"</span> <span class="token string">"http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd"</span><span class="token operator">&gt;</span> <span class="token comment"># 返回的内容</span>
</code></pre> 
<h2><a id="3_ansible_96"></a>知识点3 ansible服务</h2> 
<p>ansible是一个自动化运维工具的名称<br> 基于Python开发，集合了众多运维工具的优点（puppet,fabric,slatstack），实现批量系统配置，程序的部署，批量运行命令等</p> 
<p>Linux运维：自动化（脚本），智能化，平台化</p> 
<p>Linux运维人员，人肉运维不可取<br> 诞生了一系列的运维工具，ansible就是其中之一</p> 
<p>日常运维：<br> 1、软件安装<br> 2、服务的配置<br> 3、运行脚本<br> 4、升级<br> 5、备份</p> 
<p>ansible基于Python开发，依赖于：paramiko,PyYaml和jinja三个关键组件<br> #其他服务需要部署agent，而ansible只需要部署到server，只要十万台的key都上传到其他机器上<br> #注：glibc 内核底层的库</p> 
<p>#实验环境<br> a： 192.168.0.132（ansible）<br> c: 192.168.0.48<br> b: 192.168.0.39<br> 实验前提，做好免密码认证，详见ssh服务<br> a --&gt; b , a --&gt; c a可以免密码登录到b和c</p> 
<p>1、在a上安装ansible<br> [root@cPen_A .ssh]# yum install epel-release # 注：安装epel源<br> [root@cPen_A .ssh]# yum install ansible # 注：安装ansible<br> 2、配置<br> 配置目录：<br> /etc/ansible/ansible.cfg<br> /etc/ansible/hosts<br> 这个配置文件就是默认的主机清单配置文件，可以通过重新定义<br> 备份/etc/ansible/hosts文件<br> 编辑/etc/ansible/hosts文件</p> 
<pre><code class="prism language-bash"><span class="token comment">#将需要管理的主机添加到webser组</span>
<span class="token comment">#如果通过ssh登录的端口不是22号端口，就需要在配置文件中指明端口号……没写完</span>
<span class="token punctuation">[</span>root@cPen_A ansible<span class="token punctuation">]</span><span class="token comment"># cp hosts{,.bak}	# 注：备份</span>
<span class="token punctuation">[</span>root@cPen_A ansible<span class="token punctuation">]</span><span class="token comment"># ls</span>
ansible.cfg  hosts  hosts.bak  roles
<span class="token punctuation">[</span>root@cPen_A ansible<span class="token punctuation">]</span><span class="token comment"># &gt;hosts			# 注：老的清空</span>
<span class="token punctuation">[</span>root@cPen_A ansible<span class="token punctuation">]</span><span class="token comment"># vim hosts			</span>
<span class="token punctuation">[</span>webser<span class="token punctuation">]</span>
192.168.0.31:2233
192.168.0.55
</code></pre> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_A /<span class="token punctuation">]</span><span class="token comment"># cd /etc</span>
<span class="token punctuation">[</span>root@cPen_A etc<span class="token punctuation">]</span><span class="token comment"># ls |grep ansible</span>
ansible
<span class="token punctuation">[</span>root@cPen_A etc<span class="token punctuation">]</span><span class="token comment"># cd ansible</span>
<span class="token punctuation">[</span>root@cPen_A ansible<span class="token punctuation">]</span><span class="token comment"># ls</span>
ansible.cfg  hosts  roles						<span class="token comment"># 注：host定义主机清单</span>
<span class="token punctuation">[</span>root@cPen_A ansible<span class="token punctuation">]</span><span class="token comment"># less ansible.cfg </span>
<span class="token comment">#inventory      = /etc/ansible/hosts				# 注：主机清单</span>
<span class="token comment">#library        = /usr/share/my_modules/</span>
<span class="token comment">#module_utils   = /usr/share/my_module_utils/</span>
<span class="token comment">#remote_tmp     = ~/.ansible/tmp</span>
……
<span class="token punctuation">[</span>root@cPen_A ansible<span class="token punctuation">]</span><span class="token comment"># less hosts </span>
<span class="token comment">## [webservers]						# 注：[中括号]里webservers 组名  对这个组进行访问控制</span>
<span class="token comment">## alpha.example.org</span>
<span class="token comment">## beta.example.org</span>
<span class="token comment">## 192.168.1.100</span>
<span class="token comment">## 192.168.1.110</span>
</code></pre> 
<p>3、ansible使用<br> -m 指定模块名</p> 
<p>HOST-PATTERN #匹配主机模式,如all表示所有主机<br> -m MOD_NAME #模块名 如:ping<br> -a MOD_ARGS #模块执行的参数<br> -f FORKS #生成几个子进行程执行<br> -C #(不执行，模拟跑)<br> -u Username #某主机的用户名<br> -c CONNection #连接方式（default smart）</p> 
<p>ansible 主执行程序,一般用于命令行下执行<br> ansible-playbook 执行playbook中的任务<br> ansible-doc 获取各模块的帮助信息</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_A ~<span class="token punctuation">]</span><span class="token comment"># ansible -h					# 注：ansible -h帮助文档</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_A ~<span class="token punctuation">]</span><span class="token comment"># ansible</span>
………………
ansible: error: too few arguments
<span class="token punctuation">[</span>root@cPen_A ~<span class="token punctuation">]</span><span class="token comment"># which ansible</span>
/usr/bin/ansible
<span class="token punctuation">[</span>root@cPen_A ~<span class="token punctuation">]</span><span class="token comment"># ls -al /bin/ansible</span>
lrwxrwxrwx 1 root root 20 11月 24 16:41 /bin/ansible -<span class="token operator">&gt;</span> /usr/bin/ansible-2.7
Ansible
<span class="token punctuation">[</span>root@cPen_A ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m shell -a "ip a"	# 注：匹配所有主机 使用shell模块 执行ip a</span>
<span class="token punctuation">[</span>root@cPen_A ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m shell -a "mkdir /tmp/sc"</span>
……
192.168.0.55 <span class="token operator">|</span> CHANGED <span class="token operator">|</span> rc<span class="token operator">=</span>0 <span class="token operator">&gt;&gt;</span>				<span class="token comment"># 注：返回0 执行执行成功</span>
……
<span class="token punctuation">[</span>root@cPen_A ~<span class="token punctuation">]</span><span class="token comment"># ansible webser -m shell -a "mkdir /tmp/sc"	# 注：匹配webser组	没写完</span>
192.168.0.55 <span class="token operator">|</span> FAILED <span class="token operator">|</span> rc<span class="token operator">=</span>1 <span class="token operator">&gt;&gt;</span>				<span class="token comment"># 注：返回1 表示执行失败</span>
</code></pre> 
<h2><a id="4__205"></a>知识点4 了解云计算</h2> 
<p>云计算<br> openstack<br> docker<br> kvm<br> 虚拟化技术：在本身物理机的基础上虚拟出云主机<br> #唯一的不好是 安全性不高 数据保存在别人那里的 (影响不大)</p> 
<p>#trouble shooting的能力 问题解答的能力</p> 
<p>#注：ssh开启2种验证 - 先公钥认证 再密码认证 密码认证失败 提示permit deny</p> 
<h2><a id="5_ansible_217"></a>知识点5 ansible不是守护进程</h2> 
<pre><code class="prism language-bash"><span class="token comment">#ansible 不是守护进程 执行ansible命令的时候才会执行ansible</span>
<span class="token comment">#守护进程：一直在内存里面，等待别人连接</span>
<span class="token comment">#ssh是守护进程</span>
<span class="token comment">#执行1条命令 命令不是守护进程</span>

<span class="token comment">#ansible不是一个守护进程（守护进程：起来后一直在内存中运行，等待其他人访问）</span>
<span class="token comment">#ansible就是一个命令脚本，使用Python写的</span>

<span class="token comment">#[root@cPen_A ansible]# sudo -i			#注：直接回到root用户</span>
</code></pre> 
<h2><a id="6_ansible_230"></a>知识点6 ansible的模块</h2> 
<p>ansible的模块</p> 
<h3><a id="1copy_232"></a>1、copy模块</h3> 
<pre><code class="prism language-bash">从本地copy文件分发到目录主机路径 
	参数说明:
	src<span class="token operator">=</span> 源文件路径			<span class="token comment"># 注：source 源</span>
dest<span class="token operator">=</span> 目标路径 			<span class="token comment"># 注：destination 目的地</span>
注意src<span class="token operator">=</span> 路径后面带/ 表示带里面的所有内容复制到目标目录下，不带/是目录递归复制过去
	content<span class="token operator">=</span> 自行填充的文件内容
	owner 属主
	group 属组
	mode权限
</code></pre> 
<p>示例1：shell模块、copy模块</p> 
<pre><code class="prism language-bash"><span class="token comment">#示例1：使用ansible 在B、C主机创建/lianxi 目录</span>
<span class="token comment">#-m	指定模块</span>
<span class="token comment">#-a	传的参数</span>
ansible 接 指定主机 -m 指定模块 -a 执行的参数
<span class="token punctuation">[</span>root@cPen_A ansible<span class="token punctuation">]</span><span class="token comment"># ansible all -m shell -a "mkdir /lianxi -p"</span>
<span class="token comment">#注：rc ==&gt; reutrn code --&gt; 为0表示执行成功</span>
<span class="token comment">#注：rc ==&gt; reutrn code --&gt; 为1表示执行失败</span>
<span class="token comment">#示例2：将ansible-copy文件 复制到主机B、C/lianxi/ansible目录下，指定权限属主数组</span>
<span class="token punctuation">[</span>root@cPen_A lianxi<span class="token punctuation">]</span><span class="token comment"># vim ansible-copy</span>
<span class="token punctuation">[</span>root@cPen_A lianxi<span class="token punctuation">]</span><span class="token comment"># ansible all -m copy -a "src=/lianxi/ansible-copy dest=/lianxi/ansible mode=777 owner=sanchuang group=sanchuang"</span>
<span class="token comment">#注：确认B、C主机 指定的用户sanchuang和组sanchuang存在</span>
<span class="token comment">#md5sum	一般来说 是 信息的摘要		判定文件是否被修改</span>
</code></pre> 
<p>示例2：指定webser组，将/etc/passwd 赋值到主机/tmp目录下，指定权限777</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_A lianxi<span class="token punctuation">]</span><span class="token comment"># ansible webser -m copy -a "src=/etc/passwd dest=/tmp mode=777"</span>
</code></pre> 
<p>示例3：copy src路径后面带/不带/的区别</p> 
<pre><code class="prism language-bash"><span class="token comment">#注：src= 路径后面带/ 表示带里面的所有内容复制到目标目录下，不带/是目录递归复制过去</span>
<span class="token comment">#注：不带/</span>
<span class="token punctuation">[</span>root@cPen_A copy_dir<span class="token punctuation">]</span><span class="token comment"># ansible all -m copy -a "src=/lianxi/copy_dir dest=/lianxi/ansible"</span>
<span class="token comment">#注：带/</span>
<span class="token punctuation">[</span>root@cPen_A copy_dir<span class="token punctuation">]</span><span class="token comment"># ansible all -m copy -a "src=/lianxi/copy_dir/ dest=/lianxi/ansible"</span>

<span class="token comment">#带/表示拷贝目录下的子文件或者子文件夹</span>
<span class="token comment">#不带/表示拷贝整个目录</span>
</code></pre> 
<h3><a id="2fetch_278"></a>2、fetch模块</h3> 
<p>#注：从远程主机拉取文件到本地</p> 
<p>示例</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_A lianxi<span class="token punctuation">]</span><span class="token comment"># ansible webser -m fetch -a "src=/etc/hostname dest=/lianxi mode=644"</span>
192.168.0.22 <span class="token operator">|</span> CHANGED <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string">"changed"</span><span class="token keyword">:</span> true, 
    <span class="token string">"checksum"</span><span class="token keyword">:</span> <span class="token string">"c468f7340237d9f531122f5b03345ce8ac5641b4"</span>, 		  <span class="token comment"># 注：拉去下来后会比较</span>
    <span class="token string">"dest"</span><span class="token keyword">:</span> <span class="token string">"/lianxi/192.168.0.22/etc/hostname"</span>, 
    <span class="token string">"md5sum"</span><span class="token keyword">:</span> <span class="token string">"8d23b0947f191eb9c20728677271eb4d"</span>, 
    <span class="token string">"remote_checksum"</span><span class="token keyword">:</span> <span class="token string">"c468f7340237d9f531122f5b03345ce8ac5641b4"</span>, <span class="token comment"># 注：和远程比较 内容是否变更</span>
    <span class="token string">"remote_md5sum"</span><span class="token keyword">:</span> null
<span class="token punctuation">}</span>
<span class="token comment">#注：大文件传送中途 突然断掉了 ，文件没有传完  保存的md5sum和它的md5sum不一样</span>
<span class="token comment">#注：如果2个值一致	说明传完了</span>
<span class="token punctuation">[</span>root@cPen_A lianxi<span class="token punctuation">]</span><span class="token comment"># ls				# 注：路径自动加了个以ip地址为名的文件夹</span>
192.168.0.20  192.168.0.22  ansible-copy  copy_dir
<span class="token punctuation">[</span>root@cPen_A lianxi<span class="token punctuation">]</span><span class="token comment"># cd 192.168.0.20</span>
<span class="token punctuation">[</span>root@cPen_A 192.168.0.20<span class="token punctuation">]</span><span class="token comment"># ls</span>
etc
</code></pre> 
<pre><code class="prism language-bash">从远程主机拉取文件到本地
fetch会自动的在dest指定目录后加上远程主机命名的目录结构后面接src目录结构
fetch存储到本地的目录结构	dest + 远程主机名 + src

<span class="token comment">#注：md5可以判定	1、文件是否修改；2、文件是否传完</span>
<span class="token comment">#注：或者使用任何hash算法中的其中一种，去比较值是否相等</span>
</code></pre> 
<h3><a id="3command_310"></a>3、command模块</h3> 
<p>在远程主机上执行命令,属于裸执行,非键值对显示;不进行shell解析</p> 
<p>示例1：command、shell</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_A 192.168.0.20<span class="token punctuation">]</span><span class="token comment"># ansible all -m command -a "ifconfig"</span>
<span class="token punctuation">[</span>root@cPen_A 192.168.0.20<span class="token punctuation">]</span><span class="token comment"># ansible all -m shell -a "ifconfig"</span>
</code></pre> 
<p>示例2：command裸执行 (后面传的参数不会做解析)</p> 
<pre><code class="prism language-bash"><span class="token comment">#注：把ifconfig|grep inet整个当做1个命令去执行</span>
<span class="token punctuation">[</span>root@cPen_A 192.168.0.20<span class="token punctuation">]</span><span class="token comment"># ansible all -m command -a "ifconfig|grep inet"</span>
192.168.0.22 <span class="token operator">|</span> FAILED <span class="token operator">|</span> rc<span class="token operator">=</span>2 <span class="token operator">&gt;&gt;</span>
<span class="token punctuation">[</span>Errno 2<span class="token punctuation">]</span> 没有那个文件或目录
<span class="token comment">#属于裸执行，不会解析它的管道符号 会认为ifconfig|grep inet 是一个命令</span>

<span class="token comment">#注：shell可以 (后面传的参数会做解析)</span>
<span class="token punctuation">[</span>root@cPen_A 192.168.0.20<span class="token punctuation">]</span><span class="token comment"># ansible all -m shell -a "ifconfig|grep inet"</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_A ansible<span class="token punctuation">]</span><span class="token comment"># ifconfig			# 注：查看网卡(看的东西多一点)</span>
<span class="token comment">#注：可以看接收包、返回包、字节，有多少错误</span>
<span class="token punctuation">[</span>root@cPen_A ansible<span class="token punctuation">]</span><span class="token comment"># ip a				# 注：查看网卡</span>
</code></pre> 
<h3><a id="4shell_337"></a>4、shell模块</h3> 
<p>示例</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_A 192.168.0.20<span class="token punctuation">]</span><span class="token comment"># ansible all -m shell -a "ifconfig|grep inet"</span>
跟command一样，只不过shell模块可以解析管道之类的功能
</code></pre> 
<h3><a id="5file_344"></a>5、file模块</h3> 
<pre><code class="prism language-bash">设置文件属性<span class="token punctuation">(</span>创建文件<span class="token punctuation">)</span>
	常用参数:
	path目标路径
	state directory为目录,link为软件链接
	group 目录属组
	owner 属主
	等,其他参数通过ansible-doc -s <span class="token function">file</span> 获取

state --
absent	删除文件和目录的
directory	目录
<span class="token function">touch</span>	新建空文件
<span class="token function">link</span>		软链接
hard		硬链接
</code></pre> 
<p>示例1：查看file文件帮助信息</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_A lianxi<span class="token punctuation">]</span><span class="token comment"># ansible-doc -s file			# 注：查看file文件帮助信息</span>
</code></pre> 
<p>示例2：在目标主机/tmp目录下创建目录<br> #注：创建文件目录</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_A lianxi<span class="token punctuation">]</span><span class="token comment"># ansible all -m file -a "path=/tmp/sanchuang state=directory"</span>
</code></pre> 
<p>示例3：设置修改文件属性</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_A lianxi<span class="token punctuation">]</span><span class="token comment"># ansible all -m file -a "path=/tmp/passwd owner=sanchuang"</span>
</code></pre> 
<h3><a id="6cron_378"></a>6、cron模块</h3> 
<pre><code class="prism language-bash">6、通过cron模块对目标主机生成计划任务
常用参数:
除了分<span class="token punctuation">(</span>minute<span class="token punctuation">)</span>时<span class="token punctuation">(</span>hour<span class="token punctuation">)</span>日<span class="token punctuation">(</span>day<span class="token punctuation">)</span>月<span class="token punctuation">(</span>month<span class="token punctuation">)</span>周<span class="token punctuation">(</span>week<span class="token punctuation">)</span>外
name: 本次计划任务的名称
state: present 生成<span class="token punctuation">(</span>默认<span class="token punctuation">)</span> <span class="token operator">|</span>absent 删除 <span class="token punctuation">(</span>基于name<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#注：首先查看程序有没有起来</span>
<span class="token punctuation">[</span>root@cPen_A ~<span class="token punctuation">]</span><span class="token comment"># ps -ef |grep crond</span>
root        702      1  0 10:59 ?        00:00:00 /usr/sbin/crond -n
root       3582   3553  0 14:41 pts/3    00:00:00 <span class="token function">grep</span> --color<span class="token operator">=</span>auto crond
<span class="token comment">#注：学会看日志</span>
<span class="token punctuation">[</span>root@cPen_A ~<span class="token punctuation">]</span><span class="token comment"># cd /var/log/</span>
<span class="token punctuation">[</span>root@cPen_A log<span class="token punctuation">]</span><span class="token comment"># less cron</span>
Nov 25 12:01:01 cPen_A run-parts<span class="token punctuation">(</span>/etc/cron.hourly<span class="token punctuation">)</span><span class="token punctuation">[</span>3498<span class="token punctuation">]</span>: finished 0anacron
</code></pre> 
<p>示例1：添加计划任务</p> 
<pre><code class="prism language-bash"><span class="token comment">#注：每三分钟输出当前时间，到/tmp/time.txt文件中</span>
<span class="token punctuation">[</span>root@cPen_A log<span class="token punctuation">]</span><span class="token comment"># ansible all -m cron -a "minute=*/3 job='date &gt;&gt;/tmp/time.txt' name=date_test state=present"		# 注：minute=*/3	指定每3分钟 date &gt;&gt;/tmp/time.txt 命令</span>
<span class="token punctuation">[</span>root@cPen_B ~<span class="token punctuation">]</span><span class="token comment"># crontab -l</span>
<span class="token comment">#Ansible: date_test</span>
*/3 * * * * <span class="token function">date</span> <span class="token operator">&gt;&gt;</span>/tmp/time.txt

<span class="token punctuation">[</span>root@cPen_A log<span class="token punctuation">]</span><span class="token comment"># ansible 192.168.0.20 -m cron -a "minute=*/3 job='date &gt;&gt;/tmp/time.txt' name=date_test state=present"		# 注：可以单独为某个主机设置  并非一定批量处理</span>
</code></pre> 
<p>示例2：删除计划任务</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_A log<span class="token punctuation">]</span><span class="token comment"># ansible 192.168.0.20 -m cron -a  "name=date_test state=absent"</span>
</code></pre> 
<p>ntp服务是一个时间管理服务器<br> 示例：ntp服务 系统时间管理服务</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_A log<span class="token punctuation">]</span><span class="token comment"># yum install ntp				# 注：centos7</span>
<span class="token punctuation">[</span>root@cPen_B ~<span class="token punctuation">]</span><span class="token comment"># yum install chrony				# 注：centos8里面  ntp已被 chrony取代</span>
<span class="token punctuation">[</span>root@cPen_A log<span class="token punctuation">]</span><span class="token comment"># ntpdate ntp1.aliyun.com		# 注：同步阿里云的时间</span>
<span class="token comment">#注：使用ntp客户端 同步ntp的服务器 把时间同步</span>
</code></pre> 
<h3><a id="7yum_423"></a>7、yum模块</h3> 
<pre><code class="prism language-bash">7、故名思义就是yum安装软件包的模块<span class="token punctuation">;</span>
常用参数说明:
enablerepo,disablerepo表示启用与禁用某repo库
name 安装包名
state <span class="token punctuation">(</span>present<span class="token string">' orinstalled'</span>, latest<span class="token string">')表示安装, (absent'</span> or `removed'<span class="token punctuation">)</span> 表示删除

<span class="token comment">#注：name安装的包名	state 安装还是卸载</span>
</code></pre> 
<p>示例：安装wget</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_A log<span class="token punctuation">]</span><span class="token comment"># ansible all -m yum -a "name=wget state=installed"</span>
</code></pre> 
<p>示例：卸载wget</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_A log<span class="token punctuation">]</span><span class="token comment"># ansible all -m yum -a "name=wget state=absent"</span>
</code></pre> 
<h3><a id="8service_444"></a>8、service模块</h3> 
<pre><code class="prism language-bash">8、服务管理模块
常用参数:
name:服务名
state:服务状态  started（启动）	stopped（关闭）	restarted（重启）	reloaded（重新加载）
enabled: 是否开机启动 <span class="token boolean">true</span><span class="token operator">|</span><span class="token boolean">false</span>
runlevel: 启动级别 <span class="token punctuation">(</span>systemed方式忽略<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#安装文件传输服务vsftpd</span>
<span class="token punctuation">[</span>root@cPen_A log<span class="token punctuation">]</span><span class="token comment"># ansible all -m yum -a "name=vsftpd state=installed"</span>
</code></pre> 
<p>示例：关闭vsftpd服务</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_A log<span class="token punctuation">]</span><span class="token comment"># ansible all -m service -a "name=vsftpd state=stopped"</span>
</code></pre> 
<p>示例：开启vsftpd服务</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_A log<span class="token punctuation">]</span><span class="token comment"># ansible all -m service -a "name=vsftpd state=started"</span>
</code></pre> 
<h3><a id="9script_469"></a>9、script模块</h3> 
<p>把本地的脚本传到远端执行;前提是到远端可以执行,不要把Linux下的脚本同步到windows下执行;</p> 
<pre><code class="prism language-bash"><span class="token comment">#注：只在远程服务器执行脚本，不上传脚本到远程服务器</span>

<span class="token punctuation">[</span>root@cPen_A ~<span class="token punctuation">]</span><span class="token comment"># vim test.sh</span>
<span class="token comment">#!/bin/bash</span>
<span class="token keyword">echo</span> <span class="token string">"test ansible"</span> <span class="token operator">&gt;&gt;</span>/tmp/ansible.txt
<span class="token punctuation">[</span>root@cPen_A ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m script -a "/root/test.sh"	# 注：/root/test.sh脚本路径</span>
</code></pre> 
<p>示例：执行慢 机器多 怎么解决<br> 答：可以使用多进程去执行<br> -f 6 指定6个进程去执行</p> 
<h2><a id="7__483"></a>知识点7 查看系统版本</h2> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_B ~<span class="token punctuation">]</span><span class="token comment"># uname -r					# 注：查看系统内核</span>
4.18.0-193.el8.x86_64
<span class="token punctuation">[</span>root@cPen_B ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/redhat-release 		# 注：查看/etc/redhat-release 去查看系统版本</span>
CentOS Linux release 8.2.2004 <span class="token punctuation">(</span>Core<span class="token punctuation">)</span> 
</code></pre> 
<h2><a id="8__491"></a>知识点8 链接</h2> 
<h3><a id="1_492"></a>示例1：软链接</h3> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_A lianxi<span class="token punctuation">]</span><span class="token comment"># ln -s ansible-copy ansible-copy-likcs-s	#注：前面原文件 后面链接文件</span>
<span class="token punctuation">[</span>root@cPen_A lianxi<span class="token punctuation">]</span><span class="token comment"># ls -al 		# 注：-s soft软</span>
lrwxrwxrwx   1 root root  12 11月 25 11:30 ansible-copy-likcs-s -<span class="token operator">&gt;</span> ansible-copy
<span class="token comment">#注：软连接	相当于快捷方式</span>
<span class="token comment">#注：软链接删掉不会影响原文件，软链接的原文件删掉了会影响链接文件</span>
</code></pre> 
<h3><a id="2_501"></a>示例2：硬链接</h3> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_A lianxi<span class="token punctuation">]</span><span class="token comment"># ln ansible-copy ansible-copy-link</span>
<span class="token punctuation">[</span>root@cPen_A lianxi<span class="token punctuation">]</span><span class="token comment"># ls -al</span>
-rw-r--r--   2 root root  20 11月 25 10:12 ansible-copy-link
<span class="token function">rm</span> -rf 删除源文件 硬链接文件 依旧没事
<span class="token comment">#注：硬链接 可以去做备份</span>
<span class="token comment">#注：硬链接的原文件删掉了不会影响链接文件</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#软链接、硬链接</span>
<span class="token comment">#创建一个硬链接 文件的链接数会+1</span>
<span class="token comment">#删除硬链接文件或者是源文件  只是把文件的链接数-1  文件不会被真正删除</span>
<span class="token comment">#创建一个硬链接</span>
<span class="token punctuation">[</span>root@cPen_A lianxi<span class="token punctuation">]</span><span class="token comment"># ls -al</span>
-rw-r--r--   2 root root  20 11月 25 10:12 ansible-copy		<span class="token comment"># 注：链接为2</span>
<span class="token comment">#注：软链接</span>
lrwxrwxrwx   1 root root  12 11月 25 11:30 ansible-copy-likcs-s -<span class="token operator">&gt;</span> ansible-copy <span class="token comment"># 注：链接为1</span>
<span class="token comment">#注：硬链接</span>
-rw-r--r--   2 root root  20 11月 25 10:12 ansible-copy-link	<span class="token comment"># 注：链接为2</span>
符号链接数 1 是
<span class="token function">rm</span> -rf 删除的是 文件名 和 磁盘里面data的链接
data还存在于磁盘里 ，过一段时间 新的数据会覆盖 data
<span class="token comment">#注：为1表示删除了后就没有了，为2表示删除后还有</span>
</code></pre> 
<h2><a id="9_playbook_528"></a>知识点9 playbook</h2> 
<pre><code class="prism language-bash">如果ansible的各模块<span class="token punctuation">(</span>能实现各种功能<span class="token punctuation">)</span>是车间里的各工具<span class="token punctuation">;</span>playbook就是指导手册,目标远程主机就是库存和原料对象
<span class="token comment">#注：语法 yaml格式配置</span>
</code></pre> 
<pre><code class="prism language-bash">1、playbook的核心元素
hosts <span class="token keyword">:</span> playbook配置文件作用的主机
tasks: 任务列表
variables: 变量 
templates:包含模板语法的文本文件
handlers :由特定条件触发的任务
roles :用于层次性、结构化地组织playbook。roles 能够根据层次型结构自动装载变量文件、tasks以及handlers等
2、playbook运行方式
ansible-playbook --check 只检测可能会发生的改变,但不真执行操作
ansible-playbook --list-hosts 列出运行任务的主机
ansible-playbook --syntax-check playbook.yaml 语法检测
ansible-playbook -t TAGS_NAME playbook.yaml 只执行TAGS_NAME任务
ansible-playbook playbook.yaml 运行
</code></pre> 
<h3><a id="1_playbook_550"></a>示例1：编写/执行 playbook</h3> 
<pre><code class="prism language-bash"><span class="token comment">#注：把A机器的/etc/passwd复制到其他机器的/tmp/passwd_tmp下</span>
<span class="token punctuation">[</span>root@cPen_A ~<span class="token punctuation">]</span><span class="token comment"># vim ansible_playbook_sc.yaml		#注：编写playbook</span>
- hosts: all
  remote_user: root
  tasks:
  - name: up <span class="token function">file</span>
    copy: src<span class="token operator">=</span>/etc/passwd dest<span class="token operator">=</span>/tmp/passwd_tmp
<span class="token comment">#执行playbook</span>
<span class="token punctuation">[</span>root@cPen_A ~<span class="token punctuation">]</span><span class="token comment"># ansible-playbook ansible_playbook_sc.yaml </span>
</code></pre> 
<h3><a id="2yaml_563"></a>示例2：yaml文件怎么去编写</h3> 
<pre><code class="prism language-bash"><span class="token comment">#第1步 先安装python3：yum install python3</span>
<span class="token comment">#第2步 使用pip3安装PyYaml模块</span>
<span class="token punctuation">[</span>root@cPen_A ~<span class="token punctuation">]</span><span class="token comment"># pip3 install PyYaml</span>
<span class="token punctuation">[</span>root@cPen_A ~<span class="token punctuation">]</span><span class="token comment"># python3</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token function">import</span> yaml
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> fp <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">"ansible_playbook_sc.yaml"</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> dict <span class="token operator">=</span> yaml.load<span class="token punctuation">(</span>fp<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> dict
<span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'hosts'</span><span class="token keyword">:</span> <span class="token string">'all'</span>, <span class="token string">'remote_user'</span><span class="token keyword">:</span> <span class="token string">'root'</span>, <span class="token string">'tasks'</span><span class="token keyword">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token keyword">:</span> <span class="token string">'up file'</span>, <span class="token string">'copy'</span><span class="token keyword">:</span> <span class="token string">'src=/etc/passwd dest=/tmp/passwd_tmp'</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#注：使用</span>
1、创建yaml文件
<span class="token punctuation">[</span>root@cPen_A ~<span class="token punctuation">]</span><span class="token comment"># cat ansible_playbook_sc.yaml 	# 注：类似于字典形式 - 相当于list ；里面相当于字典</span>
- hosts: all								<span class="token comment"># 注：对所有主机生效（什么组）</span>
  remote_user: root						<span class="token comment"># 注：root用户执行</span>
  tasks:									<span class="token comment"># 注：让它做什么事情</span>
  - name: up <span class="token function">file</span>							<span class="token comment"># 注：事情名字叫up file</span>
    copy: src<span class="token operator">=</span>/etc/passwd dest<span class="token operator">=</span>/tmp/passwd_tmp	<span class="token comment"># 注：使用copy模块 执行源 目的地址</span>
2、可以使用Python解析yaml
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token function">import</span> yaml
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> fp <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">"ansible_playbook_sc.yaml"</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> dict <span class="token operator">=</span> yaml.load<span class="token punctuation">(</span>fp<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> dict
<span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'hosts'</span><span class="token keyword">:</span> <span class="token string">'all'</span>, <span class="token string">'remote_user'</span><span class="token keyword">:</span> <span class="token string">'root'</span>, <span class="token string">'tasks'</span><span class="token keyword">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token keyword">:</span> <span class="token string">'up file'</span>, <span class="token string">'copy'</span><span class="token keyword">:</span> <span class="token string">'src=/etc/passwd dest=/tmp/passwd_tmp'</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token comment">#注：使用copy模块 来指定src dest</span>
</code></pre> 
<h3><a id="3_594"></a>示例3：多个操作</h3> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cPen_A ~<span class="token punctuation">]</span><span class="token comment"># vim ansible_playbook_sc.yaml					# 注：编写</span>
- hosts: all
  remote_user: root
  tasks:
  - name: up <span class="token function">file</span>
    copy: src<span class="token operator">=</span>/etc/passwd dest<span class="token operator">=</span>/tmp/passwd_tmp
  - name: download redis
    yum: name<span class="token operator">=</span>redis state<span class="token operator">=</span>installed
- hosts: webser
  tasks:
  - name: remove <span class="token function">file</span>
    shell: <span class="token function">rm</span> -rf /tmp/passwd_tmp
<span class="token punctuation">[</span>root@cPen_A ~<span class="token punctuation">]</span><span class="token comment"># ansible-playbook ansible_playbook_sc.yaml 		# 注：运行</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/915af62378e876b4052f4a8915d26b2a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">在家或者公司如何登录服务器</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d4aac1175cdc272820037a17c27f3f28/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">机器学习--模型评价和选择（8）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>