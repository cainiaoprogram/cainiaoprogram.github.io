<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用ganache-cli和truffle构建以太坊智能合约，以实现“基于哈希锁定的跨链技术”为例 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用ganache-cli和truffle构建以太坊智能合约，以实现“基于哈希锁定的跨链技术”为例" />
<meta property="og:description" content="目录 配置以太坊开发环境部署智能合约调用智能合约 配置以太坊开发环境 系统与工具的版本: Ubuntu 21.04 npm 7.5.2 Ganache CLI v6.12.2 (ganache-core: 2.13.2) Truffle v5.3.4 (core: 5.3.4) Solidity v0.5.16 (solc-js) Node v12.21.0 Web3.js v1.3.5 更新源：
$ sudo apt-get update 安装npm：
$ sudo apt-get install npm 使用root权限，然后安装truffle和ganache-cil：
$ sudo su # npm install -g truffle # npm install -g ganache-cli 克隆智能合约代码：
$ git clone https://github.com/longyangyi/HashTimeLockContract-yi.git 代码目录结构如下：
HashTimeLockContract-yi ├── contracts │ ├── HashTimeLockContract.sol 智能合约源码 │ └── Migrations.sol 用于部署 ├── migrations │ └── 1_initial_migration." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b89cc5f7da829c71fe67b6d308d8e934/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-15T11:53:41+08:00" />
<meta property="article:modified_time" content="2022-04-15T11:53:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用ganache-cli和truffle构建以太坊智能合约，以实现“基于哈希锁定的跨链技术”为例</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><ul><li><a href="#_2" rel="nofollow">配置以太坊开发环境</a></li><li><a href="#_120" rel="nofollow">部署智能合约</a></li><li><a href="#_263" rel="nofollow">调用智能合约</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_2"></a>配置以太坊开发环境</h3> 
<pre><code class="prism language-bash">系统与工具的版本:

Ubuntu <span class="token number">21.04</span>
<span class="token function">npm</span> <span class="token number">7.5</span>.2
Ganache CLI v6.12.2 <span class="token punctuation">(</span>ganache-core: <span class="token number">2.13</span>.2<span class="token punctuation">)</span>
Truffle v5.3.4 <span class="token punctuation">(</span>core: <span class="token number">5.3</span>.4<span class="token punctuation">)</span>
Solidity v0.5.16 <span class="token punctuation">(</span>solc-js<span class="token punctuation">)</span>
Node v12.21.0
Web3.js v1.3.5
</code></pre> 
<p>更新源：</p> 
<pre><code class="prism language-bash">$ <span class="token function">sudo</span> <span class="token function">apt-get</span> update
</code></pre> 
<p>安装npm：</p> 
<pre><code class="prism language-bash">$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> <span class="token function">npm</span>
</code></pre> 
<p>使用root权限，然后安装truffle和ganache-cil：</p> 
<pre><code class="prism language-bash">$ <span class="token function">sudo</span> <span class="token function">su</span>
<span class="token comment"># npm install -g truffle</span>
<span class="token comment"># npm install -g ganache-cli</span>
</code></pre> 
<p>克隆智能合约代码：</p> 
<pre><code class="prism language-bash">$ <span class="token function">git</span> clone https://github.com/longyangyi/HashTimeLockContract-yi.git
</code></pre> 
<p>代码目录结构如下：</p> 
<pre><code class="prism language-bash">HashTimeLockContract-yi
├── contracts
│   ├── HashTimeLockContract.sol 智能合约源码
│   └── Migrations.sol 用于部署
├── migrations
│   └── 1_initial_migration.js 用于部署
└── truffle-config.js 配置文件
</code></pre> 
<ul><li>HashTimeLockContract.sol 中的核心函数功能：</li></ul> 
<pre><code class="prism language-bash">    <span class="token keyword">function</span> newContract<span class="token punctuation">(</span>address payable _receiver, bytes32 _hashlock, uint _timelock<span class="token punctuation">)</span>
        external
        payable
        fundsSent
        futureTimelock<span class="token punctuation">(</span>_timelock<span class="token punctuation">)</span>
        returns <span class="token punctuation">(</span>bytes32 contractId<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        contractId <span class="token operator">=</span> sha256<span class="token punctuation">(</span>
            abi.encodePacked<span class="token punctuation">(</span>
                msg.sender,
                _receiver,
                msg.value,
                _hashlock,
                _timelock
            <span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>haveContract<span class="token punctuation">(</span>contractId<span class="token punctuation">))</span>
            revert<span class="token punctuation">(</span><span class="token string">"Contract already exists"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        contracts<span class="token punctuation">[</span>contractId<span class="token punctuation">]</span> <span class="token operator">=</span> LockContract<span class="token punctuation">(</span>
            msg.sender,
            _receiver,
            msg.value, //note-louis: sender transfer <span class="token string">"msg.value"</span> coins to this contract 
            _hashlock,
            _timelock,
            false,
            false,
            0x0
        <span class="token punctuation">)</span><span class="token punctuation">;</span>

        emit LogHTLCNew<span class="token punctuation">(</span>
            contractId,
            msg.sender,
            _receiver,
            msg.value,
            _hashlock,
            _timelock
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> withdraw<span class="token punctuation">(</span>bytes32 _contractId, bytes32 _preimage<span class="token punctuation">)</span>
        external
        contractExists<span class="token punctuation">(</span>_contractId<span class="token punctuation">)</span>
        hashlockMatches<span class="token punctuation">(</span>_contractId, _preimage<span class="token punctuation">)</span>
        withdrawable<span class="token punctuation">(</span>_contractId<span class="token punctuation">)</span>
        returns <span class="token punctuation">(</span>bool<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        LockContract storage c <span class="token operator">=</span> contracts<span class="token punctuation">[</span>_contractId<span class="token punctuation">]</span><span class="token punctuation">;</span>
        c.preimage <span class="token operator">=</span> _preimage<span class="token punctuation">;</span>
        c.withdrawn <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        c.receiver.transfer<span class="token punctuation">(</span>c.amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        emit LogHTLCWithdraw<span class="token punctuation">(</span>_contractId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin class-name">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre> 
<ul><li>参考链接：<br> <a href="https://github.com/trufflesuite/truffle">truffle</a><br> <a href="https://github.com/trufflesuite/ganache-cli">ganache-cli</a><br> <a href="https://github.com/longyangyi/HashTimeLockContract-yi">HashTimeLockContract-yi</a></li></ul> 
<h3><a id="_120"></a>部署智能合约</h3> 
<p>先启动ganache-cli，用于模拟以太坊运行环境：</p> 
<pre><code class="prism language-bash">$ ganache-cli
Ganache CLI v6.12.2 <span class="token punctuation">(</span>ganache-core: <span class="token number">2.13</span>.2<span class="token punctuation">)</span>

Available Accounts
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> 0x4ab7fCA3bbb0dd145D9715adD1396e8718E9b0C1 <span class="token punctuation">(</span><span class="token number">100</span> ETH<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 0x7A01354De9F3CbfE121CBD2183B6f8Bbc9Cf1a85 <span class="token punctuation">(</span><span class="token number">100</span> ETH<span class="token punctuation">)</span>
<span class="token punctuation">..</span>.
Private Keys
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> 0xab37569222bfd1c8f34650bb37480bbbf124410b1a3d8470582a638d39d6c86e
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 0xf4a1ddd0b0e63e86a6c28321ac0cde19409b3955ea1ce0f09db514f43f72ecc9
<span class="token punctuation">..</span>.
Listening on <span class="token number">127.0</span>.0.1:8545
</code></pre> 
<p>ganache-cli 工具自动生成多个账户与私钥。<br> account (0) 0x4ab7fCA3bbb0dd145D9715adD1396e8718E9b0C1放置哈希锁。<br> account (1) 0x7A01354De9F3CbfE121CBD2183B6f8Bbc9Cf1a85提供原像preimage解锁。</p> 
<p>进入文件夹HashTimeLockContract-yi，使用truffle工具部署智能合约：</p> 
<pre><code class="prism language-bash">$ <span class="token builtin class-name">cd</span> HashTimeLockContract-yi
$ truffle migrate

Compiling your contracts<span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token operator">&gt;</span> Compiling ./contracts/HashTimeLockContract.sol
<span class="token operator">&gt;</span> Artifacts written to /home/louis/HashTimeLockContract-yi/build/contracts
<span class="token operator">&gt;</span> Compiled successfully using:
   - solc: <span class="token number">0.5</span>.16+commit.9c3226ce.Emscripten.clang



Starting migrations<span class="token punctuation">..</span>.
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
<span class="token operator">&gt;</span> Network name:    <span class="token string">'development'</span>
<span class="token operator">&gt;</span> Network id:      <span class="token number">1621335557793</span>
<span class="token operator">&gt;</span> Block gas limit: <span class="token number">6721975</span> <span class="token punctuation">(</span>0x6691b7<span class="token punctuation">)</span>


1_initial_migration.js
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>

   Deploying <span class="token string">'Migrations'</span>
   ----------------------
   <span class="token operator">&gt;</span> transaction hash:    0x042cb657fc218e799133769ad1be70e2e0b7d6ab8297d3acd654667c7f1ecf97
   <span class="token operator">&gt;</span> Blocks: <span class="token number">0</span>            Seconds: <span class="token number">0</span>
   <span class="token operator">&gt;</span> contract address:    0x76E28398a0C0154a1E34ff0a05573603D4832b6e
   <span class="token operator">&gt;</span> block number:        <span class="token number">1</span>
   <span class="token operator">&gt;</span> block timestamp:     <span class="token number">1621335566</span>
   <span class="token operator">&gt;</span> account:             0x4ab7fCA3bbb0dd145D9715adD1396e8718E9b0C1
   <span class="token operator">&gt;</span> balance:             <span class="token number">99.99549526</span>
   <span class="token operator">&gt;</span> gas used:            <span class="token number">225237</span> <span class="token punctuation">(</span>0x36fd5<span class="token punctuation">)</span>
   <span class="token operator">&gt;</span> gas price:           <span class="token number">20</span> gwei
   <span class="token operator">&gt;</span> value sent:          <span class="token number">0</span> ETH
   <span class="token operator">&gt;</span> total cost:          <span class="token number">0.00450474</span> ETH


   Deploying <span class="token string">'HashTimeLockContract'</span>
   --------------------------------
   <span class="token operator">&gt;</span> transaction hash:    0x1d1dceabb99006c39c2fac2c0add470ce2ed71460ad529e1ee0f63165b4b3a14
   <span class="token operator">&gt;</span> Blocks: <span class="token number">0</span>            Seconds: <span class="token number">0</span>
   <span class="token operator">&gt;</span> contract address:    0x9D9baf837F31C0C34060539Dab5A8bE9e60CaB28
   <span class="token operator">&gt;</span> block number:        <span class="token number">2</span>
   <span class="token operator">&gt;</span> block timestamp:     <span class="token number">1621335567</span>
   <span class="token operator">&gt;</span> account:             0x4ab7fCA3bbb0dd145D9715adD1396e8718E9b0C1
   <span class="token operator">&gt;</span> balance:             <span class="token number">99.97478414</span>
   <span class="token operator">&gt;</span> gas used:            <span class="token number">1035556</span> <span class="token punctuation">(</span>0xfcd24<span class="token punctuation">)</span>
   <span class="token operator">&gt;</span> gas price:           <span class="token number">20</span> gwei
   <span class="token operator">&gt;</span> value sent:          <span class="token number">0</span> ETH
   <span class="token operator">&gt;</span> total cost:          <span class="token number">0.02071112</span> ETH


   <span class="token operator">&gt;</span> Saving migration to chain.
   <span class="token operator">&gt;</span> Saving artifacts
   -------------------------------------
   <span class="token operator">&gt;</span> Total cost:          <span class="token number">0.02521586</span> ETH


Summary
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
<span class="token operator">&gt;</span> Total deployments:   <span class="token number">2</span>
<span class="token operator">&gt;</span> Final cost:          <span class="token number">0.02521586</span> ETH

</code></pre> 
<p>得到了contract address，就是部署成功后智能合约的地址：<br> 0x9D9baf837F31C0C34060539Dab5A8bE9e60CaB28。</p> 
<ul><li>ganache-cli 窗口显示产生区块的过程：</li></ul> 
<pre><code class="prism language-bash">  Transaction: 0x042cb657fc218e799133769ad1be70e2e0b7d6ab8297d3acd654667c7f1ecf97
  Contract created: 0x76e28398a0c0154a1e34ff0a05573603d4832b6e
  Gas usage: <span class="token number">225237</span>
  Block Number: <span class="token number">1</span>
  Block Time: Tue May <span class="token number">18</span> <span class="token number">2021</span> <span class="token number">18</span>:59:26 GMT+0800 <span class="token punctuation">(</span>China Standard Time<span class="token punctuation">)</span>

eth_getTransactionReceipt
eth_getCode
eth_getTransactionByHash
eth_getBlockByNumber
eth_getBalance
net_version
eth_getBlockByNumber
eth_getBlockByNumber
net_version
eth_getBlockByNumber
eth_estimateGas
net_version
eth_blockNumber
eth_getBlockByNumber
eth_sendTransaction

  Transaction: 0x1d1dceabb99006c39c2fac2c0add470ce2ed71460ad529e1ee0f63165b4b3a14
  Contract created: 0x9d9baf837f31c0c34060539dab5a8be9e60cab28
  Gas usage: <span class="token number">1035556</span>
  Block Number: <span class="token number">2</span>
  Block Time: Tue May <span class="token number">18</span> <span class="token number">2021</span> <span class="token number">18</span>:59:27 GMT+0800 <span class="token punctuation">(</span>China Standard Time<span class="token punctuation">)</span>

eth_getTransactionReceipt
eth_getCode
eth_getTransactionByHash
eth_getBlockByNumber
eth_getBalance
eth_getBlockByNumber
eth_getBlockByNumber
eth_sendTransaction

  Transaction: 0xcf0c5d2d74bd863a4c649b421e4a708c91eae1c7c42c2b320e872ea97084e5b7
  Gas usage: <span class="token number">42363</span>
  Block Number: <span class="token number">3</span>
  Block Time: Tue May <span class="token number">18</span> <span class="token number">2021</span> <span class="token number">18</span>:59:27 GMT+0800 <span class="token punctuation">(</span>China Standard Time<span class="token punctuation">)</span>
</code></pre> 
<p>此时智能合约已经在ganache-cli上成功运行。</p> 
<h3><a id="_263"></a>调用智能合约</h3> 
<ul><li>使用truffle控制台：</li></ul> 
<pre><code class="prism language-bash">$ truffle console

定义一个变量：
truffle<span class="token punctuation">(</span>development<span class="token punctuation">)</span><span class="token operator">&gt;</span> var contract
undefined

获取智能合约实例：
truffle<span class="token punctuation">(</span>development<span class="token punctuation">)</span><span class="token operator">&gt;</span> HashTimeLockContract.deployed<span class="token punctuation">(</span><span class="token punctuation">)</span>.then<span class="token punctuation">(</span>function<span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>contract<span class="token operator">=</span> instance<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
undefined

调用智能合约中的函数，<span class="token punctuation">(</span><span class="token punctuation">)</span>里的函数参数请参照前文中的函数代码，<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>里代表交易发起者和交易金额：
truffle<span class="token punctuation">(</span>development<span class="token punctuation">)</span><span class="token operator">&gt;</span> <span class="token builtin class-name">let</span> result <span class="token operator">=</span> await contract.newContract.sendTransaction<span class="token punctuation">(</span><span class="token string">"0x7A01354De9F3CbfE121CBD2183B6f8Bbc9Cf1a85"</span>, <span class="token string">"0x66687aadf862bd776c8fc18b8e9f8e20089714856ee233b3902a591d0d5f2925"</span>, <span class="token string">"0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"</span>, <span class="token punctuation">{<!-- --></span>from: <span class="token string">"0x4ab7fCA3bbb0dd145D9715adD1396e8718E9b0C1"</span>, value: web3.utils.toWei<span class="token punctuation">(</span><span class="token string">'10'</span>, <span class="token string">'ether'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
undefined
</code></pre> 
<ul><li>ganache-cli 同步产生区块：</li></ul> 
<pre><code class="prism language-bash">  Transaction: 0x7b0fa92a508ae139a00fad34650f476a8020f30a682e112deee44664a01a287d
  Gas usage: <span class="token number">134656</span>
  Block Number: <span class="token number">4</span>
  Block Time: Tue May <span class="token number">18</span> <span class="token number">2021</span> <span class="token number">19</span>:04:44 GMT+0800 <span class="token punctuation">(</span>China Standard Time<span class="token punctuation">)</span>
</code></pre> 
<ul><li>查看日志中的函数返回值：</li></ul> 
<pre><code class="prism language-Bash">truffle(development)&gt; result.receipt.logs
[
  {
    logIndex: 0,
    transactionIndex: 0,
    transactionHash: '0x7b0fa92a508ae139a00fad34650f476a8020f30a682e112deee44664a01a287d',
    blockHash: '0xdb420eb823c1260dc387c2bc605d4596d3ac207dbe7ffed996408ef455253b82',
    blockNumber: 4,
    address: '0x9D9baf837F31C0C34060539Dab5A8bE9e60CaB28',
    type: 'mined',
    removed: false,
    id: 'log_c0c74164',
    event: 'LogHTLCNew',
    args: Result {
      '0': '0xb63552c6ff936222e485d73f300d0e08ef487690eba066a2b607c05a1fd0b164',
      '1': '0x4ab7fCA3bbb0dd145D9715adD1396e8718E9b0C1',
      '2': '0x7A01354De9F3CbfE121CBD2183B6f8Bbc9Cf1a85',
      '3': [BN],
      '4': '0x66687aadf862bd776c8fc18b8e9f8e20089714856ee233b3902a591d0d5f2925',
      '5': [BN],
      __length__: 6,
      contractId: '0xb63552c6ff936222e485d73f300d0e08ef487690eba066a2b607c05a1fd0b164',
      sender: '0x4ab7fCA3bbb0dd145D9715adD1396e8718E9b0C1',
      receiver: '0x7A01354De9F3CbfE121CBD2183B6f8Bbc9Cf1a85',
      amount: [BN],
      hashlock: '0x66687aadf862bd776c8fc18b8e9f8e20089714856ee233b3902a591d0d5f2925',
      timelock: [BN]
    }
  }
]
</code></pre> 
<p>日志中存在返回值contractId: ‘0xb63552c6ff936222e485d73f300d0e08ef487690eba066a2b607c05a1fd0b164’。</p> 
<ul><li>查看账户余额，智能合约的地址也能查看到余额：</li></ul> 
<pre><code class="prism language-bash">truffle<span class="token punctuation">(</span>development<span class="token punctuation">)</span><span class="token operator">&gt;</span> web3.eth.getBalance<span class="token punctuation">(</span><span class="token string">"0x4ab7fCA3bbb0dd145D9715adD1396e8718E9b0C1"</span><span class="token punctuation">)</span>
<span class="token string">'89971243760000000000'</span> 账户<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>减少10 ether和少量交易费
truffle<span class="token punctuation">(</span>development<span class="token punctuation">)</span><span class="token operator">&gt;</span> web3.eth.getBalance<span class="token punctuation">(</span><span class="token string">"0x7A01354De9F3CbfE121CBD2183B6f8Bbc9Cf1a85"</span><span class="token punctuation">)</span>
<span class="token string">'100000000000000000000'</span> 账户<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>不变
truffle<span class="token punctuation">(</span>development<span class="token punctuation">)</span><span class="token operator">&gt;</span> web3.eth.getBalance<span class="token punctuation">(</span><span class="token string">"0x9d9baf837f31c0c34060539dab5a8be9e60cab28"</span><span class="token punctuation">)</span>
<span class="token string">'10000000000000000000'</span> 智能合约的账户增加10 ether
</code></pre> 
<ul><li>调用另一个函数，函数参数请参照前文的智能合约代码：</li></ul> 
<pre><code class="prism language-bash">truffle<span class="token punctuation">(</span>development<span class="token punctuation">)</span><span class="token operator">&gt;</span> contract.withdraw<span class="token punctuation">(</span><span class="token string">"0xb63552c6ff936222e485d73f300d0e08ef487690eba066a2b607c05a1fd0b164"</span>, <span class="token string">"0x0000000000000000000000000000000000000000000000000000000000000000"</span>, <span class="token punctuation">{<!-- --></span>from: <span class="token string">"0x7A01354De9F3CbfE121CBD2183B6f8Bbc9Cf1a85"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  tx: <span class="token string">'0x21d3361666cc50221416790abd35d236121f8e444c5dbdfc854a6404a4329c15'</span>,
  receipt: <span class="token punctuation">{<!-- --></span>
    transactionHash: <span class="token string">'0x21d3361666cc50221416790abd35d236121f8e444c5dbdfc854a6404a4329c15'</span>,
    transactionIndex: <span class="token number">0</span>,
    blockHash: <span class="token string">'0x9d3c674ba28a4ed5879408a0ca79c40378d43feb79d2c0bfcf9b7eeed0820f0c'</span>,
    blockNumber: <span class="token number">5</span>,
    from: <span class="token string">'0x7a01354de9f3cbfe121cbd2183b6f8bbc9cf1a85'</span>,
    to: <span class="token string">'0x9d9baf837f31c0c34060539dab5a8be9e60cab28'</span>,
    gasUsed: <span class="token number">60168</span>,
    cumulativeGasUsed: <span class="token number">60168</span>,
    contractAddress: null,
    logs: <span class="token punctuation">[</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span> <span class="token punctuation">]</span>,
    status: true,
    logsBloom: <span class="token string">'0x00000000000000000000800000000000000000000400000000000000000000010000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000'</span>,
    rawLogs: <span class="token punctuation">[</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>,
  logs: <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
      logIndex: <span class="token number">0</span>,
      transactionIndex: <span class="token number">0</span>,
      transactionHash: <span class="token string">'0x21d3361666cc50221416790abd35d236121f8e444c5dbdfc854a6404a4329c15'</span>,
      blockHash: <span class="token string">'0x9d3c674ba28a4ed5879408a0ca79c40378d43feb79d2c0bfcf9b7eeed0820f0c'</span>,
      blockNumber: <span class="token number">5</span>,
      address: <span class="token string">'0x9D9baf837F31C0C34060539Dab5A8bE9e60CaB28'</span>,
      type: <span class="token string">'mined'</span>,
      removed: false,
      id: <span class="token string">'log_0638e82b'</span>,
      event: <span class="token string">'LogHTLCWithdraw'</span>,
      args: <span class="token punctuation">[</span>Result<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>ganache-cli 同步产生区块：</li></ul> 
<pre><code class="prism language-bash">  Transaction: 0x21d3361666cc50221416790abd35d236121f8e444c5dbdfc854a6404a4329c15
  Gas usage: <span class="token number">60168</span>
  Block Number: <span class="token number">5</span>
  Block Time: Tue May <span class="token number">18</span> <span class="token number">2021</span> <span class="token number">19</span>:10:02 GMT+0800 <span class="token punctuation">(</span>China Standard Time<span class="token punctuation">)</span>
</code></pre> 
<p>再次查看余额：</p> 
<pre><code class="prism language-bash">truffle<span class="token punctuation">(</span>development<span class="token punctuation">)</span><span class="token operator">&gt;</span> web3.eth.getBalance<span class="token punctuation">(</span><span class="token string">"0x4ab7fCA3bbb0dd145D9715adD1396e8718E9b0C1"</span><span class="token punctuation">)</span>
<span class="token string">'89971243760000000000'</span>
truffle<span class="token punctuation">(</span>development<span class="token punctuation">)</span><span class="token operator">&gt;</span> web3.eth.getBalance<span class="token punctuation">(</span><span class="token string">"0x7A01354De9F3CbfE121CBD2183B6f8Bbc9Cf1a85"</span><span class="token punctuation">)</span>
<span class="token string">'109998796640000000000'</span> 账户<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>增加10 ether
truffle<span class="token punctuation">(</span>development<span class="token punctuation">)</span><span class="token operator">&gt;</span> web3.eth.getBalance<span class="token punctuation">(</span><span class="token string">"0x9d9baf837f31c0c34060539dab5a8be9e60cab28"</span><span class="token punctuation">)</span>
<span class="token string">'0'</span> 智能合约账户余额清零
</code></pre> 
<p>至此便实现了account(0)中的10 ether通过哈希锁定的方式转移至account(1)。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/47c926bbf6a68fa8ab6a52d6f62e64ed/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">NMS（非极大值抑制）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fb98c83104fd5a2158bd8b851bc039fa/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python统计文件夹中图片的数量个数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>