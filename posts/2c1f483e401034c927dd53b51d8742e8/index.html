<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>情感分析学习笔记（6）——PolarityRank算法python代码实现 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="情感分析学习笔记（6）——PolarityRank算法python代码实现" />
<meta property="og:description" content="本文紧接上一篇理论文章《情感分析学习笔记（5）——PolarityRank算法原理讲解》，本文是代码实现。
参考的是两篇论文（Fernández-Gavilanes et al., 2016; Cruz et al., 2011）以及PageRank算法（Page et al., 1998）
由于找了一圈没有找到相关的代码，所以是我参考pagerank的实现过程以及论文自己手撸的代码，所以不一定保证效率与正确率，而且我测试也只用了positive的一条语句进行测试，没有测试过negative的和混合的，所以如果有问题，属实正常。
本文与SO-PMI算法一样，不会公开任何数据集，但是我会留下数据集的获取方式。
对了宝贝儿们，卑微小李的公众号【野指针小李】已开通，期待与你一起探讨学术哟~摸摸大！
代码我已上传至github，链接在这里：https://github.com/Balding-Lee/polarityrank/tree/master，如有需要，请自行提取
目录 1 准备工作1.1 stanford coreNLP1.2 数据集获取1.3 POS标签 2 代码讲解2.1 预处理2.1.1 stanford coreNLP2.1.2 清洗数据 2.2 生成句法图2.2.1 句法图创建2.2.2 词语初始PR值确定2.2.3 词语之间边权判定 2.3 生成矩阵2.3.1 生成PR向量2.3.2 生成e向量2.3.3 生成 f u T fu^T fuT矩阵2.3.4 生成邻接矩阵 2.4 PolarityRank2.4.1 计算每个节点PR值2.4.2 计算SO值 3 总结4 参考 1 准备工作 1.1 stanford coreNLP 我用的POS和NER的工具都是stanford coreNLP，这里不多阐述具体的安装配置方法，如有需要参考这篇文章。
这里帮大家排个坑，最新版的stanford coreNLP的中文版jar包下载下来名字是这样的：
如果就这样直接导入的话，会报错，具体报错的理由也很简单，就是你这个jar文件名字有问题。反正这是我编码5年多以来遇到的最离谱的一个错。要把jar包名字改为这样，就不会有问题了：
中间的年月日不重要，只需要是yyyy-MM-dd格式就行。
至于这个东西加载速度有点慢，我这里查了查相关资料，如果有需要的，参考这篇文章。不过我没用，也不知道效果怎么样。
1.2 数据集获取 数据集我一共使用了两个数据集，分别如下：
搜狗实验室的新闻数据，我使用的是迷你版的，链接如下：https://www.sogou.com/labs/resource/t.php情感词汇表，我采用的清华大学整理的情感词汇表（带有情感极性的）。 1.3 POS标签 POS标签我是直接参考的stanford句法分析的标签，链接如下：https://blog." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/2c1f483e401034c927dd53b51d8742e8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-11-19T16:55:54+08:00" />
<meta property="article:modified_time" content="2020-11-19T16:55:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">情感分析学习笔记（6）——PolarityRank算法python代码实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>本文紧接上一篇理论文章《<a href="https://blog.csdn.net/qq_35357274/article/details/109788540">情感分析学习笔记（5）——PolarityRank算法原理讲解</a>》，本文是代码实现。<br> 参考的是两篇论文（Fernández-Gavilanes et al., 2016; Cruz et al., 2011）以及PageRank算法（Page et al., 1998）<br> 由于找了一圈没有找到相关的代码，所以是我参考pagerank的实现过程以及论文自己手撸的代码，所以不一定保证效率与正确率，而且我测试也只用了positive的一条语句进行测试，没有测试过negative的和混合的，所以如果有问题，属实正常。<br> 本文与SO-PMI算法一样，不会公开任何数据集，但是我会留下数据集的获取方式。</p> 
</blockquote> 
<p><font color="gray">对了宝贝儿们，卑微小李的公众号【野指针小李】已开通，期待与你一起探讨学术哟~摸摸大！</font></p> 
<p>代码我已上传至github，链接在这里：<a href="https://github.com/Balding-Lee/polarityrank/tree/master">https://github.com/Balding-Lee/polarityrank/tree/master</a>，如有需要，请自行提取<br> </p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#1__9" rel="nofollow">1 准备工作</a></li><li><ul><li><a href="#11_stanford_coreNLP_10" rel="nofollow">1.1 stanford coreNLP</a></li><li><a href="#12__21" rel="nofollow">1.2 数据集获取</a></li><li><a href="#13_POS_27" rel="nofollow">1.3 POS标签</a></li></ul> 
  </li><li><a href="#2__32" rel="nofollow">2 代码讲解</a></li><li><ul><li><a href="#21__39" rel="nofollow">2.1 预处理</a></li><li><ul><li><a href="#211_stanford_coreNLP_44" rel="nofollow">2.1.1 stanford coreNLP</a></li><li><a href="#212__80" rel="nofollow">2.1.2 清洗数据</a></li></ul> 
   </li><li><a href="#22__121" rel="nofollow">2.2 生成句法图</a></li><li><ul><li><a href="#221__124" rel="nofollow">2.2.1 句法图创建</a></li><li><a href="#222_PR_157" rel="nofollow">2.2.2 词语初始PR值确定</a></li><li><a href="#223__206" rel="nofollow">2.2.3 词语之间边权判定</a></li></ul> 
   </li><li><a href="#23__321" rel="nofollow">2.3 生成矩阵</a></li><li><ul><li><a href="#231_PR_324" rel="nofollow">2.3.1 生成PR向量</a></li><li><a href="#232_e_360" rel="nofollow">2.3.2 生成e向量</a></li><li><a href="#233_fuT_420" rel="nofollow">2.3.3 生成<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
          
           
            
            
              f 
             
             
             
               u 
              
             
               T 
              
             
            
           
             fu^T 
            
           
         </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.03577em; vertical-align: -0.19444em;"></span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.841331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span>矩阵</a></li><li><a href="#234__465" rel="nofollow">2.3.4 生成邻接矩阵</a></li></ul> 
   </li><li><a href="#24_PolarityRank_562" rel="nofollow">2.4 PolarityRank</a></li><li><ul><li><a href="#241_PR_564" rel="nofollow">2.4.1 计算每个节点PR值</a></li><li><a href="#242_SO_624" rel="nofollow">2.4.2 计算SO值</a></li></ul> 
  </li></ul> 
  </li><li><a href="#3__659" rel="nofollow">3 总结</a></li><li><a href="#4__662" rel="nofollow">4 参考</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1__9"></a>1 准备工作</h2> 
<h3><a id="11_stanford_coreNLP_10"></a>1.1 stanford coreNLP</h3> 
<p>我用的POS和NER的工具都是stanford coreNLP，这里不多阐述具体的安装配置方法，如有需要参考<a href="https://zhuanlan.zhihu.com/p/137226095" rel="nofollow">这篇文章</a>。</p> 
<p>这里帮大家排个坑，最新版的stanford coreNLP的中文版jar包下载下来名字是这样的：<br> <img src="https://images2.imgbox.com/5d/3e/7wRup1vp_o.png" alt="原始jar包"><br> 如果就这样直接导入的话，会报错，具体报错的理由也很简单，就是你这个jar文件<strong>名字有问题</strong>。反正这是我编码5年多以来遇到的最离谱的一个错。要把jar包名字改为这样，就不会有问题了：<br> <img src="https://images2.imgbox.com/8e/b2/dvbmsztL_o.png" alt="改名字后的jar包"><br> 中间的年月日不重要，只需要是yyyy-MM-dd格式就行。</p> 
<p>至于这个东西加载速度有点慢，我这里查了查相关资料，如果有需要的，参考<a href="https://blog.csdn.net/zy4321234zx/article/details/88913771">这篇文章</a>。不过我没用，也不知道效果怎么样。</p> 
<h3><a id="12__21"></a>1.2 数据集获取</h3> 
<p>数据集我一共使用了两个数据集，分别如下：</p> 
<ol><li>搜狗实验室的新闻数据，我使用的是迷你版的，链接如下：<a href="https://www.sogou.com/labs/resource/t.php" rel="nofollow">https://www.sogou.com/labs/resource/t.php</a></li><li>情感词汇表，我采用的清华大学整理的情感词汇表（带有情感极性的）。</li></ol> 
<h3><a id="13_POS_27"></a>1.3 POS标签</h3> 
<p>POS标签我是直接参考的stanford句法分析的标签，链接如下：<a href="https://blog.csdn.net/u011847043/article/details/79595225">https://blog.csdn.net/u011847043/article/details/79595225</a></p> 
<p>这个POS标签我用来主要是提取出<strong>名词、动词、形容词</strong>，具体理由下面解释。</p> 
<h2><a id="2__32"></a>2 代码讲解</h2> 
<p>本代码没有用语料数据集，只用了一条语句进行测试，语句如下：</p> 
<pre><code class="prism language-python">text <span class="token operator">=</span> <span class="token string">'阿龙在成都吃的炸鸡不仅香，而且价格便宜'</span>
</code></pre> 
<h3><a id="21__39"></a>2.1 预处理</h3> 
<p>预处理环节我们需要处理的有以下2部分：</p> 
<ol><li>加载stanford coreNLP，并进行POS和NER；</li><li>清洗数据。</li></ol> 
<h4><a id="211_stanford_coreNLP_44"></a>2.1.1 stanford coreNLP</h4> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_init_attr</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    获得初始属性, 包括:
        1. 使用stanford coreNLP进行句法树分析, 得到的结果为str
        2. 使用stanford coreNLP进行POS, 得到的结果为list
        3. 使用stanford coreNLP进行NER, 得到的结果为list
    :param text: 需要进行初始处理的文本
    :return: 数据清洗后的结果, i.e. 清洗了命名实体后的所有名词、动词、形容词
    """</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"开始加载stanford coreNLP"</span><span class="token punctuation">)</span>
    nlp <span class="token operator">=</span> StanfordCoreNLP<span class="token punctuation">(</span>r<span class="token string">'D:\pycharm\workspace\polarityrank\stanford-corenlp-4.2.0'</span><span class="token punctuation">,</span> lang<span class="token operator">=</span><span class="token string">'zh'</span><span class="token punctuation">)</span>
    <span class="token comment"># words_with_tags = nlp.parse(text)  # 句法树分析</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"开始pos"</span><span class="token punctuation">)</span>
    pos <span class="token operator">=</span> nlp<span class="token punctuation">.</span>pos_tag<span class="token punctuation">(</span>text<span class="token punctuation">)</span>  <span class="token comment"># POS</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"pos结束"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"开始ner"</span><span class="token punctuation">)</span>
    ner <span class="token operator">=</span> nlp<span class="token punctuation">.</span>ner<span class="token punctuation">(</span>text<span class="token punctuation">)</span>  <span class="token comment"># NER</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"ner结束"</span><span class="token punctuation">)</span>
    <span class="token comment"># draw_tree(words_with_tags)</span>
    <span class="token keyword">return</span> clean_data<span class="token punctuation">(</span>pos<span class="token punctuation">,</span> ner<span class="token punctuation">)</span>
</code></pre> 
<p>虽然我吐槽了很多次这个stanford coreNLP加载速度极慢，但是不得不说一行代码出一串结果的感觉贼爽。</p> 
<p>但是这一个代码是有问题的，主要出现在加载stanford coreNLP这里，如果你有多个数据，那么每次运行都会加载一次stanford coreNLP，我估计运行不了两三个数据你的java虚拟机就会崩盘，所以如果各位要跑大量数据集，一定要把这行代码改为静态加载的：</p> 
<pre><code class="prism language-python">nlp <span class="token operator">=</span> StanfordCoreNLP<span class="token punctuation">(</span>r<span class="token string">'D:\pycharm\workspace\polarityrank\stanford-corenlp-4.2.0'</span><span class="token punctuation">,</span> lang<span class="token operator">=</span><span class="token string">'zh'</span><span class="token punctuation">)</span>
</code></pre> 
<p>将上面获得的POS结果绘制出来，结果如下：<br> <img src="https://images2.imgbox.com/ac/f6/05InIgwr_o.png" alt="句法树"><br> 至于为何需要NER，我们来看下面一步，清洗数据。</p> 
<h4><a id="212__80"></a>2.1.2 清洗数据</h4> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">clean_data</span><span class="token punctuation">(</span>pos<span class="token punctuation">,</span> ner<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    清洗数据, 步骤共2步:
        1. 先对句子进行NER, 清洗掉所有命名实体, 因为命名实体不带有任何情感。
           由于不清楚stanford coreNLP里面的标签, 所以只提取标签为'o'的词语
        2. 提取出除了命名实体之外的所有名词、动词、形容词

    :param pos: pos后的结果(list)
    :param ner: ner后的结果(list)
    :return nodes: (list)数据清洗后的结果, i.e. 清洗了命名实体后的所有名词、动词、形容词
    """</span>
    n_v_adj <span class="token operator">=</span> pos_e<span class="token punctuation">.</span>n_v_adj

    nodes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 存储句法图的词语</span>
    not_ne <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 存储非命名实体的词语</span>
    <span class="token keyword">for</span> n <span class="token keyword">in</span> ner<span class="token punctuation">:</span>
        <span class="token keyword">if</span> n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'O'</span><span class="token punctuation">:</span>
            not_ne<span class="token punctuation">.</span>append<span class="token punctuation">(</span>n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> p <span class="token keyword">in</span> pos<span class="token punctuation">:</span>
        <span class="token keyword">if</span> p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">in</span> not_ne <span class="token operator">and</span> p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">in</span> n_v_adj<span class="token punctuation">:</span>
            nodes<span class="token punctuation">.</span>append<span class="token punctuation">(</span>p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> nodes
</code></pre> 
<p>首先根据 Fernández-Gavilanes et al. 老哥们的理论，一个句子中可能携带情感的词有：<strong>名词，动词，形容词</strong>。但是名词中有可能会有命名实体，这些就能带来更高的维度以及更低的准确率，比如“阿龙”的标签为Person，而我们也知道“阿龙”是不带有任何情感的。</p> 
<p>但是由于我不知道NER有哪些标签，所以就直接清洗掉“<strong>O</strong>”以外的所有标签，同时设置一个列表，用于记录所有的名词、动词、形容词的<strong>POS标签</strong>：</p> 
<pre><code class="prism language-python">n_v_adj <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'NN'</span><span class="token punctuation">,</span> <span class="token string">'NR'</span><span class="token punctuation">,</span> <span class="token string">'NT'</span><span class="token punctuation">,</span> <span class="token string">'MD'</span><span class="token punctuation">,</span> <span class="token string">'VV'</span><span class="token punctuation">,</span> <span class="token string">'JJ'</span><span class="token punctuation">,</span> <span class="token string">'JJR'</span><span class="token punctuation">,</span> <span class="token string">'JJS'</span><span class="token punctuation">,</span> <span class="token string">'VA'</span><span class="token punctuation">]</span>
</code></pre> 
<p>清洗出来的词语有：</p> 
<pre><code class="prism language-python"><span class="token punctuation">[</span><span class="token string">'吃'</span><span class="token punctuation">,</span> <span class="token string">'炸鸡'</span><span class="token punctuation">,</span> <span class="token string">'香'</span><span class="token punctuation">,</span> <span class="token string">'价格'</span><span class="token punctuation">,</span> <span class="token string">'便宜'</span><span class="token punctuation">]</span>
</code></pre> 
<h3><a id="22__121"></a>2.2 生成句法图</h3> 
<p>当有了句法树，并且提取出所有的名词、动词、形容词节点后，就可以开始生成句法图了。</p> 
<h4><a id="221__124"></a>2.2.1 句法图创建</h4> 
<p>还是Fernández-Gavilanes et al. 老哥们提出，句法图的创建方式为：</p> 
<blockquote> 
 <p>边的生成是依据节点之间的依赖关系，每个节点会与其所有的后代节点相连，但是为了使整棵树的左右都有边相连（因为情感传播不是针对于某棵子树），所以每个节点还会与自己的兄弟节点相连。作者考虑到系动词不带有任何情感极性，所以作者剔除了系动词，同时将系动词的孩子节点向上提一级。</p> 
</blockquote> 
<p>反正这个我是敲代码敲不出来的，尤其是我一个连英语语法都不会的人，所以我就强行解释（狡辩），根据SO-PMI理论，只要共现的词语，那么必然有关联性，所以我直接把提取出来的节点构成了一个强连接图。</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">create_network</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    创建强连接图(每条边都是双向连接)
    :param nodes: 节点
    :return dg: 有向图
    """</span>
    dg <span class="token operator">=</span> nx<span class="token punctuation">.</span>DiGraph<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        dg<span class="token punctuation">.</span>add_nodes_from<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span>nodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'pos'</span><span class="token punctuation">:</span> i<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 创建节点</span>

    <span class="token comment"># 创建双向边</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> nodes<span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> nodes<span class="token punctuation">:</span>
            <span class="token keyword">if</span> i <span class="token operator">!=</span> j<span class="token punctuation">:</span>
                dg<span class="token punctuation">.</span>add_edge<span class="token punctuation">(</span>i<span class="token punctuation">,</span> j<span class="token punctuation">)</span>

    <span class="token comment"># draw_network(dg)</span>
    get_words_sentiment<span class="token punctuation">(</span>dg<span class="token punctuation">,</span> nodes<span class="token punctuation">)</span>
    get_edges_weight<span class="token punctuation">(</span>dg<span class="token punctuation">)</span>

    <span class="token keyword">return</span> dg
</code></pre> 
<p>这里给每个节点赋值一个位置信息<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         i 
        
       
      
        i 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.65952em; vertical-align: 0em;"></span><span class="mord mathdefault">i</span></span></span></span></span>主要是方便后面处理，构成的图如下：<br> <img src="https://images2.imgbox.com/2b/f4/MPdzeFG1_o.png" alt="强连接图"></p> 
<h4><a id="222_PR_157"></a>2.2.2 词语初始PR值确定</h4> 
<p>有了图后，我们需要对每个节点赋予初始的情感值<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         P 
        
        
        
          R 
         
        
          + 
         
        
       
         , 
        
       
         P 
        
        
        
          R 
         
        
          − 
         
        
       
      
        PR^+,PR^- 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.965771em; vertical-align: -0.19444em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.771331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.771331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span></span></span></span></span></span></span></span></span>，赋值语句如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_words_sentiment</span><span class="token punctuation">(</span>dg<span class="token punctuation">,</span> nodes<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    从清华大学情感词语数据集中获取节点的初始情感极性
    :param dg: 有向图, 用于更新节点的PR值
    :param nodes: 节点
    """</span>
    sentiment_words <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 存储情感词典数据的列表</span>
    node_attribute <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>  <span class="token comment"># 存储节点属性的字典</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./data/sentiment_words/chinese_sentiment_words_with_polarity.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        <span class="token comment"># print(f.read())</span>
        <span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            sentiment_words<span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 如果词语在情感词典中, 将情感值赋值给该词语, 否则情感值为0</span>
    <span class="token keyword">for</span> node <span class="token keyword">in</span> nodes<span class="token punctuation">:</span>
        <span class="token keyword">for</span> sentiment_word <span class="token keyword">in</span> sentiment_words<span class="token punctuation">:</span>
            <span class="token keyword">if</span> node <span class="token operator">==</span> sentiment_word<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token builtin">float</span><span class="token punctuation">(</span>sentiment_word<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token comment"># 词典中情感值 &gt; 0, 则pr+为情感值, pr-为0</span>
                    node_attribute<span class="token punctuation">[</span>node<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">float</span><span class="token punctuation">(</span>sentiment_word<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
                    <span class="token keyword">break</span>
                <span class="token keyword">elif</span> <span class="token builtin">float</span><span class="token punctuation">(</span>sentiment_word<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    <span class="token comment"># 词典中情感值 &gt; 0, 则pr+为0, pr-为情感值</span>
                    node_attribute<span class="token punctuation">[</span>node<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">(</span>sentiment_word<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
                    <span class="token keyword">break</span>
            <span class="token comment"># 词语不在情感词典中, 则pr+与pr-都为0</span>
            node_attribute<span class="token punctuation">[</span>node<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>

    <span class="token comment"># 更新有向图节点</span>
    <span class="token keyword">for</span> node <span class="token keyword">in</span> node_attribute<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        dg<span class="token punctuation">.</span>add_nodes_from<span class="token punctuation">(</span><span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">,</span> pr_plus<span class="token operator">=</span>node_attribute<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> pr_minus<span class="token operator">=</span>node_attribute<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre> 
<p>我这里对情感值的判定条件是，如果<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         s 
        
       
         &gt; 
        
       
         0 
        
       
      
        s&gt;0 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.5782em; vertical-align: -0.0391em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">&gt;</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span></span></span></span></span>（<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         s 
        
       
      
        s 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">s</span></span></span></span></span>是每个词语的情感值），那么<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         P 
        
        
        
          R 
         
        
          + 
         
        
       
         = 
        
       
         s 
        
       
         , 
        
       
         P 
        
        
        
          R 
         
        
          − 
         
        
       
         = 
        
       
         0 
        
       
      
        PR^+=s,PR^-=0 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.771331em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.771331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.965771em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.771331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span></span></span></span></span>，反之亦然，如果<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         s 
        
       
         = 
        
       
         0 
        
       
      
        s=0 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span></span></span></span></span>，那么<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         P 
        
        
        
          R 
         
        
          + 
         
        
       
         = 
        
       
         0 
        
       
         , 
        
       
         P 
        
        
        
          R 
         
        
          − 
         
        
       
         = 
        
       
         0 
        
       
      
        PR^+=0,PR^-=0 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.771331em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.771331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.965771em; vertical-align: -0.19444em;"></span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.771331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span></span></span></span></span>。</p> 
<p>所获得的的图的PR值为：</p> 
<pre><code class="prism language-python">吃 <span class="token punctuation">{<!-- --></span><span class="token string">'pos'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'pr_plus'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'pr_minus'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
炸鸡 <span class="token punctuation">{<!-- --></span><span class="token string">'pos'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'pr_plus'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'pr_minus'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
香 <span class="token punctuation">{<!-- --></span><span class="token string">'pos'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'pr_plus'</span><span class="token punctuation">:</span> <span class="token number">1.1513888888888888</span><span class="token punctuation">,</span> <span class="token string">'pr_minus'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
价格 <span class="token punctuation">{<!-- --></span><span class="token string">'pos'</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'pr_plus'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">'pr_minus'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
便宜 <span class="token punctuation">{<!-- --></span><span class="token string">'pos'</span><span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'pr_plus'</span><span class="token punctuation">:</span> <span class="token number">1.0333333333333332</span><span class="token punctuation">,</span> <span class="token string">'pr_minus'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
</code></pre> 
<h4><a id="223__206"></a>2.2.3 词语之间边权判定</h4> 
<p>边权我并没有按照 Cruz et al. 等老哥的方法，分配<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          w 
         
         
         
           i 
          
         
           j 
          
         
        
          + 
         
        
       
         , 
        
        
        
          w 
         
         
         
           i 
          
         
           j 
          
         
        
          − 
         
        
       
      
        w_{ij}^+,w_{ij}^- 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.22443em; vertical-align: -0.412972em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.811462em;"><span class="" style="top: -2.42314em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="" style="top: -3.10313em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.412972em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.811462em;"><span class="" style="top: -2.42314em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="" style="top: -3.10313em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.412972em;"><span class=""></span></span></span></span></span></span></span></span></span></span>（因为我代码写的是weight，所以我这里用<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         w 
        
       
      
        w 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span></span></span></span></span>表达权重，与上篇文章的<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         p 
        
       
      
        p 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">p</span></span></span></span></span>等价）（主要是我不知道这群老哥怎么算出来的这两个值），我采用的是Fernández-Gavilanes et al. 老哥们的方法，每条边只有一个权重，即双向边来回的权重相同。</p> 
<p>Fernández-Gavilanes et al. 老哥们没有在论文里面提出怎么算权重的，但是提到了一句记录两个词语共现的频率，然后我就懂了。</p> 
<p>首先我获取搜狗新闻数据，这里没有用微博是考虑到如下两个原因：</p> 
<ol><li>微博十分稀疏（一条微博评论可能只有两三个词），这样会导致分母特别大，会造成干扰；</li><li>微博是非正式文本包含了许多的错别字、流行语、表情符号等，也会导致分母特别大，造成干扰。</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_sogou_news</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    获取搜狗新闻语料

    :return news: 新闻列表
    """</span>
    news <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token comment"># 该文件是用gbk编码的, 但是文件中一些特殊字符超出了gbk编码范围, 所以采用gb18030,</span>
    <span class="token comment"># 为了避免无法编码字符, 添加errors='ignore'忽略</span>
    <span class="token comment"># 解决方案来源: https://blog.csdn.net/lqzdreamer/article/details/76549256</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./data/corpus/news_tensite_xml.smarty.dat'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'gb18030'</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        <span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">:</span>
            <span class="token keyword">if</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">'&lt;content&gt;'</span><span class="token punctuation">,</span> line<span class="token punctuation">)</span><span class="token punctuation">:</span>
                line <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lstrip<span class="token punctuation">(</span><span class="token string">'&lt;content&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rstrip<span class="token punctuation">(</span><span class="token string">'&lt;/content&gt;'</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> line<span class="token punctuation">:</span>
                    news<span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">)</span>

    <span class="token keyword">return</span> news
</code></pre> 
<p>获得了新闻数据后，将两个词放入，计算共现频率。</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_edges_weight</span><span class="token punctuation">(</span>dg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    获得每条边的权重
    权重计算方法: n(word1, word2) / N
        其中: n(word1, word2)为word1和word2在所有语料中共现的次数; N为语料的条数
    :param dg: 有向图
    """</span>
    news <span class="token operator">=</span> get_sogou_news<span class="token punctuation">(</span><span class="token punctuation">)</span>
    nodes <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>dg<span class="token punctuation">.</span>nodes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    N <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>news<span class="token punctuation">)</span>
    weights <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    temp_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 双向边只用计算一次权重</span>

    <span class="token keyword">for</span> node_1 <span class="token keyword">in</span> nodes<span class="token punctuation">:</span>
        temp_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>node_1<span class="token punctuation">)</span>
        <span class="token comment"># weight = 0</span>
        <span class="token keyword">for</span> node_2 <span class="token keyword">in</span> nodes<span class="token punctuation">:</span>
            <span class="token keyword">if</span> node_1 <span class="token operator">!=</span> node_2<span class="token punctuation">:</span>
                <span class="token keyword">if</span> node_2 <span class="token operator">not</span> <span class="token keyword">in</span> temp_list<span class="token punctuation">:</span>
                    <span class="token comment"># 如果节点不同, 且未曾出现, 则计算在语料中产生的频率</span>
                    <span class="token comment"># 判断是否出现过, 主要是因为双向图, 权重是相同的,</span>
                    <span class="token comment"># 且如果不处理, 后续会重复遍历语料, 减少运行速度</span>
                    count <span class="token operator">=</span> <span class="token number">0</span>
                    <span class="token keyword">for</span> new <span class="token keyword">in</span> news<span class="token punctuation">:</span>
                        <span class="token comment"># 判断是否共现</span>
                        <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>node_1<span class="token punctuation">,</span> new<span class="token punctuation">)</span> <span class="token operator">and</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>node_2<span class="token punctuation">,</span> new<span class="token punctuation">)</span><span class="token punctuation">:</span>
                            count <span class="token operator">+=</span> <span class="token number">1</span>
                    weight <span class="token operator">=</span> count <span class="token operator">/</span> N
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                weight <span class="token operator">=</span> <span class="token number">0</span>
            weights<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>node_1<span class="token punctuation">,</span> node_2<span class="token punctuation">,</span> weight<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># 虽然双向边的权重只用计算一次, 但是在更新图中的权重的时候要更新两条边</span>
    <span class="token keyword">for</span> weight <span class="token keyword">in</span> weights<span class="token punctuation">:</span>
        dg<span class="token punctuation">.</span>add_edges_from<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span>weight<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> weight<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> weight<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        dg<span class="token punctuation">.</span>add_edges_from<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span>weight<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> weight<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> weight<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>由于是双向图，且来回权重相同，所以我判断节点是否曾经出现过，这样主要是为了少遍历一半的新闻数据，减少时间浪费。</p> 
<p>我也设定一个节点（词）不能与自己有边。</p> 
<p>虽然权重只用计算一次，但是给边权赋值的时候要赋值两次哈。</p> 
<p>这里的代码和之前的一样有问题，不可能每次都加载一遍新闻数据，所以如果要跑多条（<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ≥ 
        
       
         2 
        
       
      
        \geq2 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.77194em; vertical-align: -0.13597em;"></span><span class="mrel">≥</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span></span></span></span></span>）数据，这行代码也要改成静态加载：</p> 
<pre><code class="prism language-python">news <span class="token operator">=</span> get_sogou_news<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>得到的边权为：</p> 
<pre><code class="prism language-python">吃 炸鸡 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0.006024096385542169</span><span class="token punctuation">}</span>
吃 香 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">}</span>
吃 价格 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0.006024096385542169</span><span class="token punctuation">}</span>
吃 便宜 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">}</span>
吃 吃 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
炸鸡 吃 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0.006024096385542169</span><span class="token punctuation">}</span>
炸鸡 香 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">}</span>
炸鸡 价格 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">}</span>
炸鸡 便宜 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">}</span>
炸鸡 炸鸡 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
香 吃 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">}</span>
香 炸鸡 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">}</span>
香 价格 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0.006024096385542169</span><span class="token punctuation">}</span>
香 便宜 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">}</span>
香 香 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
价格 吃 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0.006024096385542169</span><span class="token punctuation">}</span>
价格 炸鸡 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">}</span>
价格 香 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0.006024096385542169</span><span class="token punctuation">}</span>
价格 便宜 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0.006024096385542169</span><span class="token punctuation">}</span>
价格 价格 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
便宜 吃 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">}</span>
便宜 炸鸡 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">}</span>
便宜 香 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0.0</span><span class="token punctuation">}</span>
便宜 价格 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0.006024096385542169</span><span class="token punctuation">}</span>
便宜 便宜 <span class="token punctuation">{<!-- --></span><span class="token string">'weight'</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span>
</code></pre> 
<p>这里全部为0.006024096385542169，并非是出错了，而是在数据集中所有的内容只出现过一次，导致了值都相同，如下图所示：<br> <img src="https://images2.imgbox.com/28/96/urXMarnd_o.png" alt="权重说明"></p> 
<h3><a id="23__321"></a>2.3 生成矩阵</h3> 
<p>矩阵生成就对应了上篇文章的所有公式推导过程。</p> 
<h4><a id="231_PR_324"></a>2.3.1 生成PR向量</h4> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">create_pr_vec</span><span class="token punctuation">(</span>dg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    创建PR向量
    :param dg: 有向图
    :return pr_vec: PR+与PR-组合在一起的向量, ndarray
    :return pr_plus: PR+的向量, 用于求0范数, ndarray
    :return pr_minus: PR-的向量, 用于求0范数, ndarray
    """</span>
    pr_plus <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    pr_minus <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    nodes <span class="token operator">=</span> dg<span class="token punctuation">.</span>nodes<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> node <span class="token keyword">in</span> nodes<span class="token punctuation">:</span>
        pr_plus<span class="token punctuation">.</span>append<span class="token punctuation">(</span>dg<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'pr_plus'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        pr_minus<span class="token punctuation">.</span>append<span class="token punctuation">(</span>dg<span class="token punctuation">.</span>nodes<span class="token punctuation">[</span>node<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'pr_minus'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    temp_list <span class="token operator">=</span> pr_plus <span class="token operator">+</span> pr_minus  <span class="token comment"># 合并两个列表</span>

    <span class="token comment"># 将list转为ndarray对象</span>
    pr_plus <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>pr_plus<span class="token punctuation">)</span>
    pr_minus <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>pr_minus<span class="token punctuation">)</span>
    pr_vec <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>temp_list<span class="token punctuation">)</span>

    <span class="token keyword">return</span> pr_vec<span class="token punctuation">,</span> pr_plus<span class="token punctuation">,</span> pr_minus
</code></pre> 
<p>这里多传回了2个列表，pr_plus和pr_minus，即<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         P 
        
        
        
          R 
         
        
          + 
         
        
       
      
        PR^+ 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.771331em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.771331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span></span></span></span></span>和<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         P 
        
        
        
          R 
         
        
          − 
         
        
       
      
        PR^- 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.771331em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.771331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span></span></span></span></span></span></span></span></span>分别组成的列表，主要是方便后面计算<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         e 
        
       
      
        e 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">e</span></span></span></span></span>。</p> 
<p>pr_vec结果如下：</p> 
<pre><code class="prism language-python">array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">1.15138889</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">1.03333333</span><span class="token punctuation">,</span>
       <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="232_e_360"></a>2.3.2 生成e向量</h4> 
<p>这里考虑到向量<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          e 
         
        
          ⃗ 
         
        
       
      
        \vec e 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.714em; vertical-align: 0em;"></span><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.714em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathdefault">e</span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.17994em;"><span class="overlay" style="height: 0.714em; width: 0.471em;"> 
            <svg width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"> 
             <path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path> 
            </svg></span></span></span></span></span></span></span></span></span></span></span>的计算方法是：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          ∑ 
         
         
         
           i 
          
         
           = 
          
         
           1 
          
         
        
          n 
         
        
        
        
          e 
         
        
          i 
         
        
          + 
         
        
       
         = 
        
        
        
          ∑ 
         
         
         
           i 
          
         
           = 
          
         
           1 
          
         
        
          n 
         
        
        
        
          e 
         
        
          i 
         
        
          − 
         
        
       
         = 
        
       
         n 
        
       
      
        \sum_{i=1}^n e_i^+ = \sum_{i=1}^n e_i^- = n 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.11117em; vertical-align: -0.29971em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: -5e-06em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.804292em;"><span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.29971em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.811462em;"><span class="" style="top: -2.42314em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="" style="top: -3.10313em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.11117em; vertical-align: -0.29971em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: -5e-06em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.804292em;"><span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.29971em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.811462em;"><span class="" style="top: -2.42314em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="" style="top: -3.10313em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">n</span></span></span></span></span>，所以我在计算这个的时候，采用了归一化的方法处理：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">calc_e</span><span class="token punctuation">(</span>sum_pr<span class="token punctuation">,</span> pr<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    计算e的值

    计算方法：
        1. 获得PR+与PR-的向量
        2. 判断向量的第0范数, 如果0范数为0, 则这n个e为0; 如果0范数不为0, 则归一化不为0的数,
           再乘以n
           归一化方法: e_i = \frac{pr_i}{\sum_{j=1}^n pr_j}
        3. 将所获得的结果组成向量

    :param sum_pr: 传入的PR向量的总和
    :param pr: 传入的PR向量
    :param n: PR值的个数
    :return e: e向量
    """</span>
    <span class="token keyword">if</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>pr<span class="token punctuation">,</span> <span class="token builtin">ord</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        e <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> pr<span class="token punctuation">:</span>
            e<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>i <span class="token operator">/</span> sum_pr<span class="token punctuation">)</span> <span class="token operator">*</span> n<span class="token punctuation">)</span>
        e <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        e <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span>n<span class="token punctuation">)</span>

    <span class="token keyword">return</span> e


<span class="token keyword">def</span> <span class="token function">create_e_vec</span><span class="token punctuation">(</span>pr_plus<span class="token punctuation">,</span> pr_minus<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    创建e_i^+和e_i^-构成的向量
    通过调用calc_e(sum_pr, pr)计算

    e的要求: e(e+和e-组合的向量)的第一范数为2n

    :param pr_plus: PR+构成的向量
    :param pr_minus: PR-构成的向量
    :return:
    """</span>
    n <span class="token operator">=</span> pr_plus<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># 获取向量中元素的个数</span>

    sum_pr_plus <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>pr_plus<span class="token punctuation">)</span>
    sum_pr_minus <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span>pr_minus<span class="token punctuation">)</span>

    e_plus <span class="token operator">=</span> calc_e<span class="token punctuation">(</span>sum_pr_plus<span class="token punctuation">,</span> pr_plus<span class="token punctuation">,</span> n<span class="token punctuation">)</span>
    e_minus <span class="token operator">=</span> calc_e<span class="token punctuation">(</span>sum_pr_minus<span class="token punctuation">,</span> pr_minus<span class="token punctuation">,</span> n<span class="token punctuation">)</span>

    e_vec <span class="token operator">=</span> np<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">[</span>e_plus<span class="token punctuation">,</span> e_minus<span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> e_vec
</code></pre> 
<p>calc_e这个方法是我为了提高代码复用性加的。得到的结果如下：</p> 
<pre><code class="prism language-python">array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">2.63509218</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">2.36490782</span><span class="token punctuation">,</span>
       <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="233_fuT_420"></a>2.3.3 生成<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         f 
        
        
        
          u 
         
        
          T 
         
        
       
      
        fu^T 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.03577em; vertical-align: -0.19444em;"></span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mord"><span class="mord mathdefault">u</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.841331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span>矩阵</h4> 
<p>这个没啥好说的，就是矩阵乘法：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">create_fu_mat</span><span class="token punctuation">(</span>e_vec<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    创建fu^T矩阵
    计算方法:
        f = e / m, m = 2n
        u: 单位向量
    :param e_vec: e+和e-构成的向量, 大小为2n×1
    :return fu^T: 将e_vec复制了2n列向量构成的矩阵, 每一列的向量一模一样, 大小为2n×2n
    """</span>
    m <span class="token operator">=</span> e_vec<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

    f <span class="token operator">=</span> <span class="token punctuation">(</span>e_vec <span class="token operator">/</span> m<span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    u <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>f<span class="token punctuation">,</span> u<span class="token punctuation">)</span>
</code></pre> 
<p>结果如下：</p> 
<pre><code class="prism language-python">array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">0.26350922</span><span class="token punctuation">,</span> <span class="token number">0.26350922</span><span class="token punctuation">,</span> <span class="token number">0.26350922</span><span class="token punctuation">,</span> <span class="token number">0.26350922</span><span class="token punctuation">,</span> <span class="token number">0.26350922</span><span class="token punctuation">,</span>
        <span class="token number">0.26350922</span><span class="token punctuation">,</span> <span class="token number">0.26350922</span><span class="token punctuation">,</span> <span class="token number">0.26350922</span><span class="token punctuation">,</span> <span class="token number">0.26350922</span><span class="token punctuation">,</span> <span class="token number">0.26350922</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">0.23649078</span><span class="token punctuation">,</span> <span class="token number">0.23649078</span><span class="token punctuation">,</span> <span class="token number">0.23649078</span><span class="token punctuation">,</span> <span class="token number">0.23649078</span><span class="token punctuation">,</span> <span class="token number">0.23649078</span><span class="token punctuation">,</span>
        <span class="token number">0.23649078</span><span class="token punctuation">,</span> <span class="token number">0.23649078</span><span class="token punctuation">,</span> <span class="token number">0.23649078</span><span class="token punctuation">,</span> <span class="token number">0.23649078</span><span class="token punctuation">,</span> <span class="token number">0.23649078</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="234__465"></a>2.3.4 生成邻接矩阵</h4> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_sum_weights</span><span class="token punctuation">(</span>dg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    获得邻接矩阵每一行的数据的和并乘2, i.e. 2 * \sum_{i=1}^n\sum_{j=1}^n w_{ij}

    因为原论文中的公式是q_j^+ 加 q_j^-, 和为2
    由于没有A+和A-之分, i.e. 没有q_j^+ 和q_j^- 之分
    但是矩阵是合并了的, 为了保证矩阵第一范数为1, 所以需要乘2
    :param dg: 有向图
    :return sum_weights: dict, {node: sum_weight}, 每一行的总权重,
                         i.e. /sum_{k \in out(v_j)}|p_{jk}|
    """</span>
    sum_weights <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> node_1 <span class="token keyword">in</span> dg<span class="token punctuation">.</span>nodes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        weight <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> node_2 <span class="token keyword">in</span> dg<span class="token punctuation">.</span>nodes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            weight <span class="token operator">+=</span> dg<span class="token punctuation">.</span>edges<span class="token punctuation">[</span>node_1<span class="token punctuation">,</span> node_2<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'weight'</span><span class="token punctuation">]</span>
        sum_weights<span class="token punctuation">[</span>node_1<span class="token punctuation">]</span> <span class="token operator">=</span> weight <span class="token operator">*</span> <span class="token number">2</span>

    <span class="token keyword">return</span> sum_weights


<span class="token keyword">def</span> <span class="token function">create_adj_mat</span><span class="token punctuation">(</span>dg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    生成邻接矩阵
        邻接矩阵权重计算方式: a_{ij} = w{ij} / w{j}
        w{j}是j列的权重和, 但是由于邻接矩阵是上下对称的, 所以也是第j行的权重和

    该过程实际上是一个归一化的过程
    :param dg: 有向图
    :return A_mat: 2n×2n大小的邻接矩阵, 由4个n×n的邻接矩阵拼接而成
    """</span>
    n <span class="token operator">=</span> dg<span class="token punctuation">.</span>number_of_nodes<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sum_weights <span class="token operator">=</span> get_sum_weights<span class="token punctuation">(</span>dg<span class="token punctuation">)</span>  <span class="token comment"># 获得每一行的权重总和</span>

    adj_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token keyword">for</span> node_1 <span class="token keyword">in</span> dg<span class="token punctuation">.</span>nodes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        sum_weight <span class="token operator">=</span> sum_weights<span class="token punctuation">[</span>node_1<span class="token punctuation">]</span>
        <span class="token keyword">for</span> node_2 <span class="token keyword">in</span> dg<span class="token punctuation">.</span>nodes<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            a <span class="token operator">=</span> dg<span class="token punctuation">.</span>edges<span class="token punctuation">[</span>node_1<span class="token punctuation">,</span> node_2<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'weight'</span><span class="token punctuation">]</span> <span class="token operator">/</span> sum_weight
            adj_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>a<span class="token punctuation">)</span>

    adj_mat <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>adj_list<span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>n<span class="token punctuation">,</span> n<span class="token punctuation">)</span>

    A_mat <span class="token operator">=</span> np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span><span class="token punctuation">(</span>adj_mat<span class="token punctuation">,</span> adj_mat<span class="token punctuation">)</span><span class="token punctuation">)</span>
    A_mat <span class="token operator">=</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">(</span>A_mat<span class="token punctuation">,</span> A_mat<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> A_mat<span class="token punctuation">.</span>T
</code></pre> 
<p>这个邻接矩阵是我觉得最复杂的部分，因为我没有用<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          w 
         
        
          + 
         
        
       
         , 
        
        
        
          w 
         
        
          − 
         
        
       
      
        w^+,w^- 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.965771em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.771331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.771331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span></span></span></span></span></span></span></span></span>，我只有一个权重，所以我的矩阵<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         A 
        
       
      
        \bold A 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68611em; vertical-align: 0em;"></span><span class="mord mathbf">A</span></span></span></span></span>是如下构造：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          A 
         
        
          = 
         
         
         
           [ 
          
          
           
            
             
             
               A 
              
             
            
            
             
              
             
            
            
             
             
               A 
              
             
            
           
           
            
             
             
               A 
              
             
            
            
             
              
             
            
            
             
             
               A 
              
             
            
           
          
         
           ] 
          
         
        
       
         \bold A=\left[ \begin{array}{ccc} \bold A &amp; &amp; \bold A \\ \bold A &amp; &amp; \bold A \end{array} \right] 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68611em; vertical-align: 0em;"></span><span class="mord mathbf">A</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.40003em; vertical-align: -0.95003em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathbf">A</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathbf">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.45em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span><span class="" style="top: -2.25em;"><span class="pstrut" style="height: 2.84em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.61em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathbf">A</span></span></span><span class="" style="top: -2.41em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathbf">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"><span class=""></span></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span></span></span><span class="mclose delimcenter" style="top: 0em;"><span class="delimsizing size3">]</span></span></span></span></span></span></span></span></p> 
<p>但是这样带来了一个问题，就是转置后的第一范数不为1，是大于1的，这是因为上面的<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
         
         
           ∥ 
          
         
           A 
          
         
           ∥ 
          
         
        
          1 
         
        
       
         = 
        
       
         1 
        
       
      
        \left\| \bold A \right\|_1=1 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0497em; vertical-align: -0.2997em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top: 0em;">∥</span><span class="mord mathbf">A</span><span class="mclose delimcenter" style="top: 0em;">∥</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151408em;"><span class="" style="top: -2.4003em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2997em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span></span></span></span></span>下面的也是等于1，再求和之后为2，那么就会导致最后的结果是发散的，而不是收敛的。那么问题我后来发现是出在这个公式上面：</p> 
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           a 
          
          
          
            i 
           
          
            j 
           
          
         
           + 
          
         
        
          = 
         
         
          
          
            q 
           
           
           
             i 
            
           
             j 
            
           
          
            + 
           
          
          
           
           
             ∑ 
            
            
            
              k 
             
            
              = 
             
            
              1 
             
            
           
             n 
            
           
           
           
             q 
            
            
            
              k 
             
            
              j 
             
            
           
             + 
            
           
          
            + 
           
           
           
             ∑ 
            
            
            
              k 
             
            
              = 
             
            
              1 
             
            
           
             n 
            
           
           
           
             q 
            
            
            
              k 
             
            
              j 
             
            
           
             − 
            
           
          
         
        
       
         a_{ij}^+=\frac{q_{ij}^+}{\sum_{k=1}^n q_{kj}^+ + \sum_{k=1}^n q_{kj}^-} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.22443em; vertical-align: -0.403103em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.821331em;"><span class="" style="top: -2.43301em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.403103em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.75331em; vertical-align: -1.13888em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.61443em;"><span class="" style="top: -2.29854em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: -5e-06em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.804292em;"><span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.29971em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.811462em;"><span class="" style="top: -2.39869em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03148em;">k</span><span class="mord mathdefault mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="" style="top: -3.10313em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.437416em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mop"><span class="mop op-symbol small-op" style="position: relative; top: -5e-06em;">∑</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.804292em;"><span class="" style="top: -2.40029em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03148em;">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.2029em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.29971em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.811462em;"><span class="" style="top: -2.39869em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03148em;">k</span><span class="mord mathdefault mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="" style="top: -3.10313em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">−</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.437416em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.80297em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">q</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.811462em;"><span class="" style="top: -2.42314em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight" style="margin-right: 0.05724em;">j</span></span></span></span><span class="" style="top: -3.10313em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mbin mtight">+</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.412972em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.13888em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p> 
<p>我没有正负之分，所以分母就小了一倍，所以我用这行代码，把权重翻倍，使得最后能够保证<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
         
         
           ∥ 
          
         
           A 
          
         
           ∥ 
          
         
        
          1 
         
        
       
         = 
        
       
         1 
        
       
      
        \left\| \bold A \right\|_1=1 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0497em; vertical-align: -0.2997em;"></span><span class="minner"><span class="minner"><span class="mopen delimcenter" style="top: 0em;">∥</span><span class="mord mathbf">A</span><span class="mclose delimcenter" style="top: 0em;">∥</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151408em;"><span class="" style="top: -2.4003em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2997em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span></span></span></span></span>：</p> 
<pre><code class="prism language-python">sum_weights<span class="token punctuation">[</span>node_1<span class="token punctuation">]</span> <span class="token operator">=</span> weight <span class="token operator">*</span> <span class="token number">2</span>
</code></pre> 
<p>接着第二个问题就是记得返回值的时候<strong>要转置，要转置，要转置</strong>！因为毕竟公式里面是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         Q 
        
       
         = 
        
        
        
          P 
         
        
          T 
         
        
       
      
        Q=P^T 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">Q</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.841331em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.841331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span></span></span></span></span>，我最开始搞成了这个邻接矩阵是对称的，可惜我后来才想起来不是对称的。</p> 
<p>运行结果如下：</p> 
<pre><code class="prism language-python">array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.5</span>       <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.16666667</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.5</span>       <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.16666667</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">0.25</span>      <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span>
        <span class="token number">0.25</span>      <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.16666667</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.16666667</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">0.25</span>      <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.5</span>       <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.5</span>       <span class="token punctuation">,</span>
        <span class="token number">0.25</span>      <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.5</span>       <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.5</span>       <span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.16666667</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.16666667</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.5</span>       <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.16666667</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.5</span>       <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.16666667</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">0.25</span>      <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span>
        <span class="token number">0.25</span>      <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.16666667</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.16666667</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">0.25</span>      <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.5</span>       <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.5</span>       <span class="token punctuation">,</span>
        <span class="token number">0.25</span>      <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.5</span>       <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.5</span>       <span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.16666667</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span>
        <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">,</span> <span class="token number">0.16666667</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">.</span>        <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="24_PolarityRank_562"></a>2.4 PolarityRank</h3> 
<p>有了矩阵后，我们就可以开始计算了。</p> 
<h4><a id="241_PR_564"></a>2.4.1 计算每个节点PR值</h4> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">calc_polarityrank</span><span class="token punctuation">(</span>pr_vec<span class="token punctuation">,</span> fu_mat<span class="token punctuation">,</span> A_mat<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    polarityrank算法
    计算方法:
        pr_vec := B * pr_vec
        B = ((1 - d)fu^T + dA)
        f = e / m, u: 单位向量

    使用论文中的计算方法, 可以减少一次矩阵与矩阵的乘法

    收敛判断:
        1. ||PR_{k+1} - PR_{k}|| &lt;= 1e-10
        2. 迭代200次
    :param pr_vec: PR+和PR-构成的向量, 大小2n×1
    :param fu_mat: 将e_vec复制了2n列向量构成的矩阵, 每一列的向量一模一样, 大小为2n×2n
    :param A_mat: 由4个归一化权重构成的邻接矩阵拼接而成的大邻接矩阵, 用于矩阵运算, 大小为2n×2n
    :return pr_vec: 迭代结束后的每个节点的PR值
    """</span>
    d <span class="token operator">=</span> <span class="token number">0.85</span>
    epsilon <span class="token operator">=</span> <span class="token number">1e</span><span class="token operator">-</span><span class="token number">5</span>

    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        pr_new <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> d<span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>fu_mat<span class="token punctuation">,</span> pr_vec<span class="token punctuation">)</span> <span class="token operator">+</span> d <span class="token operator">*</span> np<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>A_mat<span class="token punctuation">,</span> pr_vec<span class="token punctuation">)</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>pr_new <span class="token operator">-</span> pr_vec<span class="token punctuation">,</span> <span class="token builtin">ord</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>pr_new <span class="token operator">-</span> pr_vec<span class="token punctuation">,</span> <span class="token builtin">ord</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> epsilon<span class="token punctuation">:</span>
            pr_vec <span class="token operator">=</span> pr_new
            <span class="token keyword">break</span>

        pr_vec <span class="token operator">=</span> pr_new

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"运行结束!"</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"最终收敛的PR值:"</span><span class="token punctuation">,</span> pr_vec<span class="token punctuation">)</span>
    <span class="token keyword">return</span> pr_vec
</code></pre> 
<p>由于之前证明过，在<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         n 
        
       
         → 
        
       
         ∞ 
        
       
      
        n \rightarrow \infty 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord">∞</span></span></span></span></span>时，最终会趋近于0，但是我们也没有那么多资源来跑到无穷对吧，所以我这里参考了Fernández-Gavilanes et al. 老哥们的方法，并自己设定了一个<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ϵ 
        
       
         = 
        
       
         1 
        
        
        
          0 
         
         
         
           − 
          
         
           5 
          
         
        
       
      
        \epsilon=10^{-5} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">ϵ</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.814108em; vertical-align: 0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">5</span></span></span></span></span></span></span></span></span></span></span></span></span>，我的收敛条件给定的是：</p> 
<ol><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           ∥ 
          
          
           
           
             x 
            
           
             ⃗ 
            
           
           
           
             k 
            
           
             + 
            
           
             1 
            
           
          
         
           − 
          
          
           
           
             x 
            
           
             ⃗ 
            
           
          
            k 
           
          
         
           ∥ 
          
         
        
          ≤ 
         
        
          ϵ 
         
        
       
         \left\| \vec x_{k+1} - \vec x_k \right\| \le \epsilon 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="minner"><span class="mopen delimcenter" style="top: 0em;">∥</span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.714em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathdefault">x</span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.20772em;"><span class="overlay" style="height: 0.714em; width: 0.471em;"> 
               <svg width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"> 
                <path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path> 
               </svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03148em;">k</span><span class="mbin mtight">+</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.208331em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.714em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord mathdefault">x</span></span><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.20772em;"><span class="overlay" style="height: 0.714em; width: 0.471em;"> 
               <svg width="0.471em" height="0.714em" style="width:0.471em" viewbox="0 0 471 714" preserveaspectratio="xMinYMin"> 
                <path d="M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z"></path> 
               </svg></span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.336108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03148em;">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose delimcenter" style="top: 0em;">∥</span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault">ϵ</span></span></span></span></span>；</li><li>迭代200次。</li></ol> 
<p>运行结果：</p> 
<pre><code class="prism language-python"><span class="token number">0</span> <span class="token number">1.9422066348391442</span>
<span class="token number">1</span> <span class="token number">1.372653777753172</span>
<span class="token number">2</span> <span class="token number">0.999663462218954</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">110</span> <span class="token number">1.0971141479105944e-05</span>
<span class="token number">111</span> <span class="token number">1.0159208470470569e-05</span>
<span class="token number">112</span> <span class="token number">9.387995084108366e-06</span>
运行结束!
最终收敛的PR值<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">3.32872517e-05</span> <span class="token number">1.52967968e-05</span> <span class="token number">3.31700068e-05</span> <span class="token number">6.28000260e-05</span>
 <span class="token number">3.17410413e-05</span> <span class="token number">3.32872517e-05</span> <span class="token number">1.52967968e-05</span> <span class="token number">1.92333899e-05</span>
 <span class="token number">6.28000260e-05</span> <span class="token number">1.92333899e-05</span><span class="token punctuation">]</span>
</code></pre> 
<p>大家发现这个收敛的<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         P 
        
       
         R 
        
       
      
        PR 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">P</span><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span></span></span></span></span>值小的离谱对吧，但是当我们计算<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         S 
        
       
         O 
        
       
      
        SO 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.05764em;">S</span><span class="mord mathdefault" style="margin-right: 0.02778em;">O</span></span></span></span></span>之后大家会发现新大陆。</p> 
<h4><a id="242_SO_624"></a>2.4.2 计算SO值</h4> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">calc_so</span><span class="token punctuation">(</span>pr_vec<span class="token punctuation">,</span> nodes<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    计算每个节点的情感极性
    计算方法:
        SO(n) = (PR+(n) - PR-(n)) / (PR+(n) + PR-(n))
    :param pr_vec: 收敛后的PR值
    :param nodes: 节点
    """</span>
    <span class="token comment"># so_dict = {}</span>
    n <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>nodes<span class="token punctuation">)</span>  <span class="token comment"># 记录节点数</span>

    i <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> node <span class="token keyword">in</span> nodes<span class="token punctuation">:</span>
        pr_plus <span class="token operator">=</span> pr_vec<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        pr_minus <span class="token operator">=</span> pr_vec<span class="token punctuation">[</span>i <span class="token operator">+</span> n<span class="token punctuation">]</span>

        <span class="token comment"># so_dict[node] = (pr_plus - pr_minus) / (pr_plus + pr_minus)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> <span class="token string">" 的情感值为: "</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>pr_plus <span class="token operator">-</span> pr_minus<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>pr_plus <span class="token operator">+</span> pr_minus<span class="token punctuation">)</span><span class="token punctuation">)</span>

        i <span class="token operator">+=</span> <span class="token number">1</span>
</code></pre> 
<p>运行结果如下：</p> 
<pre><code class="prism language-python">吃  的情感值为<span class="token punctuation">:</span>  <span class="token number">0.0</span>
炸鸡  的情感值为<span class="token punctuation">:</span>  <span class="token number">0.0</span>
香  的情感值为<span class="token punctuation">:</span>  <span class="token number">0.26594873331317725</span>
价格  的情感值为<span class="token punctuation">:</span>  <span class="token number">0.0</span>
便宜  的情感值为<span class="token punctuation">:</span>  <span class="token number">0.2453710838914052</span>
</code></pre> 
<p>最后得出一个结论，该你有情感，你就得有情感。</p> 
<h2><a id="3__659"></a>3 总结</h2> 
<p>本文配合上文《<a href="https://blog.csdn.net/qq_35357274/article/details/109788540">情感分析学习笔记（5）——PolarityRank算法原理讲解</a>》，讲解了如何通过python代码实现PolarityRank算法，其总体思维导图如下：<br> <img src="https://images2.imgbox.com/fa/6e/EaKlam2i_o.png" alt="PolarityRank算法思维导图"></p> 
<h2><a id="4__662"></a>4 参考</h2> 
<p>[1] Cruz F L , Vallejo C G , Enriquez F , et al. PolarityRank: Finding an equilibrium between followers and contraries in a network[J]. Information Processing &amp; Management, 2012, 48(2):p.271-282.<br> [2] Fernandez-Gavilanes M , Alvarez-Lopez T , Juncal-Martinez J , et al. Unsupervised method for sentiment analysis in online texts[J]. Expert Systems with Applications, 2016, 58(Oct.):57-75.<br> [3]羽毛的笔.Stanford CoreNLP 入门指南[EB/OL].<a href="https://zhuanlan.zhihu.com/p/137226095" rel="nofollow">https://zhuanlan.zhihu.com/p/137226095</a>,2020-5-5.<br> [4]闰土不用叉.利用nltk可视化stanford coreNLP构建的中文句法树[EB/OL].<a href="https://blog.csdn.net/xyz1584172808/article/details/81951846">https://blog.csdn.net/xyz1584172808/article/details/81951846</a>,2018-8-22.<br> [5]云水禅心_心一.Python中读取txt文本出现“ ‘gbk’ codec can’t decode byte 0xbf in position 2: illegal multibyte sequence”的解决办法[EB/OL].<a href="https://blog.csdn.net/lqzdreamer/article/details/76549256">https://blog.csdn.net/lqzdreamer/article/details/76549256</a>,2017-8-1.<br> [6]zy4321234zx.StanfordCoreNLP 运行缓慢（python）[EB/OL].<a href="https://blog.csdn.net/zy4321234zx/article/details/88913771">https://blog.csdn.net/zy4321234zx/article/details/88913771</a>,2019-3-30.<br> [7]张士超你到底把我家代码藏哪了.Stanford Parser 标签说明[EB/OL].<a href="https://blog.csdn.net/u011847043/article/details/79595225">https://blog.csdn.net/u011847043/article/details/79595225</a>,2018-3-1.</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f56d38da723fbe8d781bf1d8bd1ae2df/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">高斯投影坐标转换（c语言）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/607ac396d6bbda5b6b4ef88e1d7e9bd7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java 远程执行linux命令_Pikachu-RCE远程命令执行漏洞</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>