<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>云卷云舒：：云原生数据库系列-分布式KV事务数据库TiKV - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="云卷云舒：：云原生数据库系列-分布式KV事务数据库TiKV" />
<meta property="og:description" content="一、简介：
TiKV 是一个开源的分布式事务 Key-Value 数据库，支持跨行 ACID 事务，同时实现了自动水平伸缩、数据强一致性、跨数据中心高可用和云原生等重要特性。作为一个基础组件，TiKV 可作为构建其它系统的基石。目前最主要的chang，TiKV 已用于支持分布式 HTAP 数据库—— TiDB 中，负责存储数据，并已被多个行业的领先企业应用在实际生产环境。
二、发展：
发展很快，不到一年成为孵化项目
2018 年 8 月 29 日，称 CNCF宣布接纳 TiKV 作为 CNCF Sandbox 的云原生项目。2019 年 5 月，CNCF 的 TOC（技术监督委员会）投票决定接受 TiKV 晋级为孵化项目。 三、特性：
跨数据中心高可用：使用 Raft 协议和 PD（Placement Driver）来实现跨地域、跨数据中心的高可用。水平扩展：通过 PD 和精心实现的 Multi-Raft ，TiKV 在水平扩展性方面的表现出色，可以轻松扩展到 200&#43;TB 的数据。一致的分布式事务 ：与 Google Spanner 类似，TiKV 支持外部一致的分布式事务。协处理器（Coprocessor）支持：与 HBase 类似，TiKV 实现了支持分布式计算的协处理器框架，用于支持计算下推操作。与 TiDB 无缝协同 ：TiKV 和 TiDB 强强联合，构建了一个具有高水平扩展能力、支持一致性事务、融合传统关系型数据库和 NoSQL 优势特性的 NewSQL 数据库解决方案。 四、架构
1. 设计目标
a. 高性能KV存储引擎" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/53ba0d724ef5490e39410a1d16a73d83/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-14T09:39:49+08:00" />
<meta property="article:modified_time" content="2023-12-14T09:39:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">云卷云舒：：云原生数据库系列-分布式KV事务数据库TiKV</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>一、简介：</strong></p> 
<p>TiKV 是一个开源的分布式事务 Key-Value 数据库，支持跨行 ACID 事务，同时实现了自动水平伸缩、数据强一致性、跨数据中心高可用和云原生等重要特性。作为一个基础组件，TiKV 可作为构建其它系统的基石。目前最主要的chang，TiKV 已用于支持分布式 HTAP 数据库—— TiDB 中，负责存储数据，并已被多个行业的领先企业应用在实际生产环境。</p> 
<p><strong>二、发展：</strong></p> 
<p>发展很快，不到一年成为孵化项目</p> 
<ul><li>2018 年 8 月 29 日，称 CNCF宣布接纳 TiKV 作为 CNCF Sandbox 的云原生项</li><li>目。</li><li>2019 年 5 月，CNCF 的 TOC（技术监督委员会）投票决定接受 TiKV 晋级为孵</li><li>化项目。</li></ul> 
<p><strong>三、特性：</strong></p> 
<ul><li>跨数据中心高可用：使用 Raft 协议和 PD（Placement Driver）来实现跨地域、跨数据中心的高可用。</li><li>水平扩展：通过 PD 和精心实现的 Multi-Raft ，TiKV 在水平扩展性方面的表现出色，可以轻松扩展到 200+TB 的数据。</li><li>一致的分布式事务 ：与 Google Spanner 类似，TiKV 支持外部一致的分布式事务。</li><li>协处理器（Coprocessor）支持：与 HBase 类似，TiKV 实现了支持分布式计算的协处理器框架，用于支持计算下推操作。</li><li>与 TiDB 无缝协同 ：TiKV 和 TiDB 强强联合，构建了一个具有高水平扩展能力、支持一致性事务、融合传统关系型数据库和 NoSQL 优势特性的 NewSQL 数据库解决方案。</li></ul> 
<p><strong>四、架构</strong></p> 
<p><img alt="" height="520" src="https://images2.imgbox.com/d6/e4/DNROLWOf_o.png" width="810"></p> 
<p></p> 
<p><strong>1. 设计目标</strong><br> a. 高性能KV存储引擎<br> b. 保证多个机器之间的数据一致性<br> c. 支持ACID事务<br> d. 可以实现自定义数据分布和负载均衡</p> 
<p><br><strong>2. 存储引擎，RocksDB</strong><br> a. LSM­tree：顺序写，优化写性能<br> b. 分层存储，多级缓存，提高数据读取效率: 热数据在上层<br> c. 关键特性</p> 
<ul><li> Column Family</li><li>  精细的compaction，配置线程数，手动触发，rate limiter</li><li>  ingest external sst file:快速插入数据，快速balance</li><li>  prefix bloom filter/iterator upper bound：特殊场景下加速scan</li></ul> 
<p>d. Raft</p> 
<ul><li> 选举：follower­candidate­Leader</li><li> 日志复制：leader复制给follower</li><li> 关键特性 
  <ul><li>Leader lease本地读，优化读请求（注：每个心跳会重新续Lease）</li><li>Follower reader分担leader压力动态副本变更，方便调度</li><li>Batch合并多个region的写入（注：raft支持的Batch操作）</li></ul></li></ul> 
<p>e. Milti­Raft</p> 
<ul><li> 负载均衡balance</li><li> 分裂split</li><li> 合并merge</li></ul> 
<p><br><strong>3. 分布式事务</strong><br> a. 基于percolator模型</p> 
<ul><li>PD集成授时服务，保证全局时序</li><li>两阶段提交</li><li>乐观事务并发:客户端缓存数据（unionstore），提交时才检测冲突</li><li>可选悲观事务</li><li>客户端作为事事务的协调者（tidb）</li><li>不适用单点事务管理器（primary key）</li></ul> 
<p>b. 2pc</p> 
<ul><li>prewrite:同步写primarykey&amp;secondarykey</li><li>commit:提交primary key就表示成功，异步提交secondary key</li></ul> 
<p>4. Coprocessor</p> 
<ul><li>下推函数到Tikv执行</li><li>TiKV独立组件，低耦合</li><li>向量化执行（每次处理多行，聚合表达式按列计算）</li></ul> 
<p><strong>五、应用</strong></p> 
<p>TIKV+REDIS分布式缓存系统<br> redis的集群不支持分布式事务，codis支持了redis'的集群，但是仍然不支持分布式事务（后续可能会支持），所有可以基于TiKV来实现分布式事务。</p> 
<p></p> 
<p><em>注：数据库的学习笔记，部分内容来自网络，如涉及侵权请您留言，我会立刻处置。</em></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ec64b6097a58d5d6857603fd3638cc16/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">2023最新版Android studio安装入门教程（非常详细）从零基础入门到精通，看完这一篇就够了</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9567413ecebe78c1d590153cffe8c2ef/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Django和ECharts异步请求示例</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>