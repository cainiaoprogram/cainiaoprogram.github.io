<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>安卓图片裁剪——使用自定义View - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="安卓图片裁剪——使用自定义View" />
<meta property="og:description" content="目录 前言设计思路源码 前言 在图片操作中裁剪最为常见，安卓中常用的裁剪方式是通过调用 Bitmap.createBitmap(@NonNull Bitmap source, int x, int y, int width, int height) 等实现的，本文所展示的View便是以此为核心设计。
设计思路 在一个图片裁剪的过程中，我们可以看到其主要由以下两部分组成：
裁剪区域（裁剪框）图片区域（裁剪目标） 因此，我们可以将其抽象为两个矩形，裁剪结果即两个矩形取交集，即：
代表裁剪区域的矩形（下称cropRectF）代表图片区域的矩形（下称picRectF) 下面是对这两个矩形的几种设计思路：
对cropRectF：
使用固定尺寸比例设置cropRectF的大小，简单易行，且方便裁剪出固定比例的图片通过拖动边界自由变化cropRectF，这可以通过判断触点坐标是否在其边界或边界附近来判断拖动，从而改变cropRectF的大小 最终鉴于简单选择了前者，同时也加入了通过单指触摸拖动裁剪框，以缓解不能修正裁剪位置的缺陷；
对picRectF则添加了常用手势操作，双指平移图片和缩放图片，由此牵扯出两种方案：
可随意移动缩放图片，裁剪时通过取交集的方式获取结果，适用于裁剪结果可以包含透明区域同样可随意移动缩放图片，但其picRectF应当始终包含cropRectF，则裁剪结果取cropRectF的全集即可，适用于裁剪结果不应包含透明区域 最终采用了第二种方案，同时出于实践的目的也尝试了下在第一种方案中如何获取裁剪结果，部分代码如下：
public Bitmap getCroppingResult() { if (picture != null) {// picture为Bitmap对象，即裁剪目标 // 构建裁剪框对应的区域 Region resultRegion = new Region((int) cropRectF.left, (int) cropRectF.top, (int) cropRectF.right, (int) cropRectF.bottom); // 与图片区域相交 resultRegion.op((int) picRectF.left, (int) picRectF.top, (int) picRectF.right, (int) picRectF.bottom, Region.Op.INTERSECT); Rect resultRect = resultRegion.getBounds();// 获取取交集后相交区域的矩形 if (!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/fbcff8d9e82c3df1f6398d1565208c8c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-25T23:46:12+08:00" />
<meta property="article:modified_time" content="2021-03-25T23:46:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">安卓图片裁剪——使用自定义View</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_2" rel="nofollow">前言</a></li><li><a href="#_4" rel="nofollow">设计思路</a></li><li><a href="#_277" rel="nofollow">源码</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>前言</h2> 
<p>在图片操作中裁剪最为常见，安卓中常用的裁剪方式是通过调用 <code>Bitmap.createBitmap(@NonNull Bitmap source, int x, int y, int width, int height)</code> 等实现的，本文所展示的View便是以此为核心设计。</p> 
<h2><a id="_4"></a>设计思路</h2> 
<p>在一个图片裁剪的过程中，我们可以看到其主要由以下两部分组成：</p> 
<ol><li>裁剪区域（裁剪框）</li><li>图片区域（裁剪目标）</li></ol> 
<p>因此，我们可以将其抽象为两个矩形，裁剪结果即两个矩形取交集，即：</p> 
<ol><li>代表裁剪区域的矩形（下称cropRectF）</li><li>代表图片区域的矩形（下称picRectF)</li></ol> 
<p>下面是对这两个矩形的几种设计思路：</p> 
<p>对cropRectF：</p> 
<ul><li>使用固定尺寸比例设置cropRectF的大小，简单易行，且方便裁剪出固定比例的图片</li><li>通过拖动边界自由变化cropRectF，这可以通过判断触点坐标是否在其边界或边界附近来判断拖动，从而改变cropRectF的大小</li></ul> 
<p>最终鉴于简单选择了前者，同时也加入了通过单指触摸拖动裁剪框，以缓解不能修正裁剪位置的缺陷；</p> 
<p>对picRectF则添加了常用手势操作，双指平移图片和缩放图片，由此牵扯出两种方案：</p> 
<ul><li>可随意移动缩放图片，裁剪时通过取交集的方式获取结果，适用于裁剪结果可以包含透明区域</li><li>同样可随意移动缩放图片，但其picRectF应当始终包含cropRectF，则裁剪结果取cropRectF的全集即可，适用于裁剪结果不应包含透明区域</li></ul> 
<p>最终采用了第二种方案，同时出于实践的目的也尝试了下在第一种方案中如何获取裁剪结果，部分代码如下：</p> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> Bitmap <span class="token function">getCroppingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>picture <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// picture为Bitmap对象，即裁剪目标</span>
            <span class="token comment">// 构建裁剪框对应的区域</span>
            Region resultRegion <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Region</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> cropRectF<span class="token punctuation">.</span>left<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> cropRectF<span class="token punctuation">.</span>top<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> cropRectF<span class="token punctuation">.</span>right<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> cropRectF<span class="token punctuation">.</span>bottom<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 与图片区域相交</span>
            resultRegion<span class="token punctuation">.</span><span class="token function">op</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> picRectF<span class="token punctuation">.</span>left<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> picRectF<span class="token punctuation">.</span>top<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> picRectF<span class="token punctuation">.</span>right<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> picRectF<span class="token punctuation">.</span>bottom<span class="token punctuation">,</span> Region<span class="token punctuation">.</span>Op<span class="token punctuation">.</span>INTERSECT<span class="token punctuation">)</span><span class="token punctuation">;</span>
            Rect resultRect <span class="token operator">=</span> resultRegion<span class="token punctuation">.</span><span class="token function">getBounds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 获取取交集后相交区域的矩形</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>resultRect<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 图片与裁剪框有相交区域</span>
                <span class="token keyword">float</span> cropWidth <span class="token operator">=</span> cropRectF<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">float</span> cropHeight <span class="token operator">=</span> cropRectF<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">float</span> picWidth <span class="token operator">=</span> picRectF<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">float</span> picHeight <span class="token operator">=</span> picRectF<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> pictureWidth <span class="token operator">=</span> picture<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> pictureHeight <span class="token operator">=</span> picture<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 计算相交区域的左上角坐标分别在裁剪框和图片中的位置比例</span>
                <span class="token comment">// 因该相交区域必为裁剪区域或图片的一部分，所以下面4个比例值一定属于 [0, 1]</span>
                <span class="token comment">// 使用PointF仅仅只是为了同时存储两个维度的比例</span>
                PointF scaleAtCrop <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resultRect<span class="token punctuation">.</span>left <span class="token operator">-</span> cropRectF<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token operator">/</span> cropWidth<span class="token punctuation">,</span> <span class="token punctuation">(</span>resultRect<span class="token punctuation">.</span>top <span class="token operator">-</span> cropRectF<span class="token punctuation">.</span>top<span class="token punctuation">)</span> <span class="token operator">/</span> cropHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
                PointF scaleAtPic <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resultRect<span class="token punctuation">.</span>left <span class="token operator">-</span> picRectF<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token operator">/</span> picWidth<span class="token punctuation">,</span> <span class="token punctuation">(</span>resultRect<span class="token punctuation">.</span>top <span class="token operator">-</span> picRectF<span class="token punctuation">.</span>top<span class="token punctuation">)</span> <span class="token operator">/</span> picHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">float</span> unitWidth <span class="token operator">=</span> pictureWidth <span class="token operator">/</span> picWidth<span class="token punctuation">;</span>
                <span class="token keyword">float</span> unitHeight <span class="token operator">=</span> pictureHeight <span class="token operator">/</span> picHeight<span class="token punctuation">;</span>
                <span class="token comment">// 计算裁剪框的宽高在与picture同密度下的宽高，即裁剪结果的宽高</span>
                <span class="token keyword">int</span> resultWidth <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>cropWidth <span class="token operator">*</span> unitWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> resultHeight <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>cropHeight <span class="token operator">*</span> unitHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 计算相交区域的宽高在与picture同密度下的宽高</span>
                <span class="token keyword">int</span> picPartWidth <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>resultRect<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> unitWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> picPartHeight <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>resultRect<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> unitHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
                Bitmap result <span class="token operator">=</span> Bitmap<span class="token punctuation">.</span><span class="token function">createBitmap</span><span class="token punctuation">(</span>resultWidth<span class="token punctuation">,</span> resultHeight<span class="token punctuation">,</span> picture<span class="token punctuation">.</span><span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Canvas canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Canvas</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 目的为将相交区域图片画在指定位置</span>
                BitmapDrawable picPart <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BitmapDrawable</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Bitmap<span class="token punctuation">.</span><span class="token function">createBitmap</span><span class="token punctuation">(</span>
                        picture<span class="token punctuation">,</span>
                        <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>pictureWidth <span class="token operator">*</span> scaleAtPic<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>pictureHeight <span class="token operator">*</span> scaleAtPic<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span>
                        picPartWidth<span class="token punctuation">,</span>
                        picPartHeight
                <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 计算相交部分图片绘制在结果中的位置</span>
                <span class="token keyword">int</span> drawLeft <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>resultWidth <span class="token operator">*</span> scaleAtCrop<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">int</span> drawTop <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>resultHeight <span class="token operator">*</span> scaleAtCrop<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
                picPart<span class="token punctuation">.</span><span class="token function">setBounds</span><span class="token punctuation">(</span>drawLeft<span class="token punctuation">,</span> drawTop<span class="token punctuation">,</span> drawLeft <span class="token operator">+</span> picPartWidth<span class="token punctuation">,</span> drawTop <span class="token operator">+</span> picPartHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
                picPart<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 将相交部分图片绘制在结果中</span>
                <span class="token keyword">return</span> result<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>回归正文，最终选取的方案确定为：</p> 
<ul><li>cropRectF使用固定比例</li><li>cropRectF可通过单指拖动以平移变化</li><li>picRectF可通过双指操作以平移、缩放</li><li>picRectF必须始终包含cropRectF</li></ul> 
<p>但在继续之前，我们应当先确定两个矩形的大小。<br> 因<code>picRectF必须始终包含cropRectF</code>，所以先规划cropRectF的大小。出于视觉上的考量，最终我选择使用View宽或是高的2/3作为cropRectF的宽或是高。但在直接设置之前，有两个问题应当先行解决：</p> 
<ul><li>View是较宽还是较高？</li><li>裁剪区域是较宽还是较高？</li></ul> 
<p>不难想到：</p> 
<ul><li>View较宽 &amp;&amp; 裁剪区域较高 ⇒ 使用View的高做基准（即以View高的2/3作为cropRectF的高），cropRectF的宽必定不大于View的宽</li><li>View较高 &amp;&amp; 裁剪区域较宽 ⇒ 使用View的宽做基准（即以View宽的2/3作为cropRectF的宽），cropRectF的高必定不大于View的高</li></ul> 
<p>但若View与裁剪区域都较宽或是都较高时，便不能简单的确定cropRectF的宽高了。比如说，如果都较宽，我们可以先以View的宽为基准，在按裁剪区域比例计算出cropRectF的高后，应当先比较它是否要比View的高大，如若确实如此，那我们则应当改使用View的高为基准了，不过这时我们可以确定，计算出的cropRectF的宽必定不大于View的宽。同理，我们可以得出它们都较高时的值了。</p> 
<p>确定了cropRectF的值后，便可确定picRectF的值了。实际上，这与上述相似，它们都是包含关系，把cropRectF类比为View，把picRectF类比为cropRectF即可，便不赘述。</p> 
<p>然后接下来便是如何通过触摸控制cropRectF和picRectF的位置或大小，此时就轮到View类中的<code>onTouchEvent(MotionEvent event)</code>方法出场了。</p> 
<p>顾名思义，这个方法的处理对象正是触摸事件，它是一个触摸事件的消费者，其返回值为布朗值，true表示其已经消费了该触摸事件<code>(MotionEvent event)</code>，反之则表示它没有消费该事件。在这里，我所用到的触摸事件有以下三种：</p> 
<ul><li>ACTION_DOWN：当第一个手指按下屏幕时</li><li>ACTION_POINTER_DOWN：除第一个手指以外，如果有其它的手指按下屏幕时</li><li>ACTION_MOVE：当任意手指在屏幕上移动或多个手指同时在屏幕上移动时</li></ul> 
<p>为判断单指操控裁剪框及双指操控图片，我用两个boolean变量来确定在ACTION_MOVE事件中操控的对象：<code>isMovingCrop（操控裁剪框）</code>、<code>isMovingPic（操控图片）</code>。</p> 
<p>当ACTION_DOWN事件发生时，其必然不会是要操控图片，此时令<code>isMovingPic = false</code>，是否为操控裁剪框则取决于其触点是否在cropRectF的范围内，因此令<code>isMovingCrop = cropRectF.contains(event.getX(), event.getY())</code>，与此同时，用了一个PointF对象记录下了此时的坐标。</p> 
<pre><code class="prism language-java"><span class="token keyword">case</span> MotionEvent<span class="token punctuation">.</span>ACTION_DOWN<span class="token operator">:</span>
    isMovingCrop <span class="token operator">=</span> cropRectF<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>x0<span class="token punctuation">,</span> y0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    isMovingPic <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    fingerPoint0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x0<span class="token punctuation">,</span> y0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
</code></pre> 
<p>当ACTION_POINTER_DOWN事件发生时，其必然不会是要操控裁剪框，此时令<code>isMovingCrop = false</code>，是否为操控图片则取决于此时是否为双指，且若为双指，则其中是否至少有一个触点在picRectF的范围内，因此令<code>isMovingPic = event.getPointerCount() == 2 &amp;&amp; (picRectF.contains(fingerPoint0.x, fingerPoint0.y) || picRectF.contains(event.getX(1), event.getY(1)))</code>，若确为操控图片，则记录下此时第二个触点的坐标，然后计算双指的中心点坐标及双指的距离。</p> 
<pre><code class="prism language-java"><span class="token keyword">case</span> MotionEvent<span class="token punctuation">.</span>ACTION_POINTER_DOWN<span class="token operator">:</span>
    isMovingCrop <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isMovingPic <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getPointerCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span> <span class="token comment">// 双指操作</span>
            <span class="token comment">// 至少有一点在图片范围内</span>
            <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>picRectF<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>fingerPoint0<span class="token punctuation">.</span>x<span class="token punctuation">,</span> fingerPoint0<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">||</span> picRectF<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        fingerPoint1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">updateCenterPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        lastDistance <span class="token operator">=</span> <span class="token function">computeDistance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
</code></pre> 
<p>因此，为避免发生其它触摸事件导致isMovingCrop或isMovingPic标记错误，在默认分支中将其全部归为false。</p> 
<pre><code class="prism language-java"><span class="token keyword">default</span><span class="token operator">:</span>
    isMovingCrop <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    isMovingPic <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
</code></pre> 
<p>最后，我们所希望的触摸操控便在ACTION_MOVE事件中执行，在发生ACTION_MOVE事件时：</p> 
<p>当操控裁剪框时，我们只需要计算当前事件发生坐标相对于ACTION_DOWN事件发生时的坐标的偏移量，然后平移cropRectF，同时更新ACTION_DOWN事件坐标为当前事件坐标<code>（以便下一个ACTION_MOVE事件的坐标偏移量计算是以相对于本次坐标计算的）</code>即可，但需要注意的是，cropRectF的平移有以下两个限制：</p> 
<ul><li>必须含于picRectF（请注意，picRectF并非要含于View）</li><li>必须含于View</li></ul> 
<p>对此，只需在偏移cropRectF之前，判断它在偏移后是否会超出限制，然后对偏移量进行修正即可。</p> 
<pre><code class="prism language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>isMovingCrop<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">float</span> xDiff <span class="token operator">=</span> x0 <span class="token operator">-</span> fingerPoint0<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
    <span class="token keyword">float</span> yDiff <span class="token operator">=</span> y0 <span class="token operator">-</span> fingerPoint0<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
    fingerPoint0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x0<span class="token punctuation">,</span> y0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 限制不能滑出图片的范围</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>left <span class="token operator">+</span> xDiff <span class="token operator">&lt;</span> picRectF<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 左移</span>
        xDiff <span class="token operator">=</span> picRectF<span class="token punctuation">.</span>left <span class="token operator">-</span> cropRectF<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>right <span class="token operator">+</span> xDiff <span class="token operator">&gt;</span> picRectF<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 右移</span>
        xDiff <span class="token operator">=</span> picRectF<span class="token punctuation">.</span>right <span class="token operator">-</span> cropRectF<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>top <span class="token operator">+</span> yDiff <span class="token operator">&lt;</span> picRectF<span class="token punctuation">.</span>top<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 上移</span>
        yDiff <span class="token operator">=</span> picRectF<span class="token punctuation">.</span>top <span class="token operator">-</span> cropRectF<span class="token punctuation">.</span>top<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>bottom <span class="token operator">+</span> yDiff <span class="token operator">&gt;</span> picRectF<span class="token punctuation">.</span>bottom<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 下移</span>
        yDiff <span class="token operator">=</span> picRectF<span class="token punctuation">.</span>bottom <span class="token operator">-</span> cropRectF<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 限制不能滑出整个视图的范围</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>left <span class="token operator">+</span> xDiff <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 左移</span>
        xDiff <span class="token operator">=</span> <span class="token operator">-</span> cropRectF<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>right <span class="token operator">+</span> xDiff <span class="token operator">&gt;</span> <span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 右移</span>
        xDiff <span class="token operator">=</span> <span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> cropRectF<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>top <span class="token operator">+</span> yDiff <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 上移</span>
        yDiff <span class="token operator">=</span> <span class="token operator">-</span> cropRectF<span class="token punctuation">.</span>top<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>bottom <span class="token operator">+</span> yDiff <span class="token operator">&gt;</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 下移</span>
        yDiff <span class="token operator">=</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> cropRectF<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    cropRectF<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span>xDiff<span class="token punctuation">,</span> yDiff<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>当操控图片时，其目的可能为以下三种之一：</p> 
<ul><li>平移图片 ⇒ 双指距离基本保持不变</li><li>放大图片 ⇒ 双指距离增大</li><li>缩小图片 ⇒ 双指距离减小</li></ul> 
<p>因此，我们可以通过判断双指距离变化的方式来做出相应的操作：</p> 
<ul><li> <p>当双指距离相比上一次变化不大时<code>（注意应当使用绝对值）</code>，将其视为无变化，此时即为平行移动，通过对中心点的偏移量计算，从而得出picRectF的偏移量。同样，我们应当注意，<code>picRectF必须始终包含cropRectF</code>，处理方式与平移裁剪框类似。</p> </li><li> <p>当双指距离相比上一次增大或减小时，此时即为缩放图片。对图片的缩放我们应当确定缩放的中心点，且其应当在图片上。因此我们需要对双指中心点进行处理<code>（其可能不在图片上）</code>。例如其x轴坐标，若大于<code>picRectF.right</code>，则让它等于<code>picRectF.right</code>即可，若小于<code>picRectF.left</code>，则让它等于<code>picRectF,left</code>即可，对其y轴坐标的处理类似。<br> 确定缩放中心后，让缩放中心的坐标保持不变，而只变化坐标点各方向两边<code>（x轴方向及y轴方向）</code>的长度，即可达到图片按缩放中心缩放的效果。对此，我们可以先计算缩放中心在图片各方向上的位置比例，然后计算缩放后图片的宽高，让缩放点仍处于图片缩放后同样的位置比例，同时保存坐标不变即可。同样，我们需要注意以下两点：</p> 
  <ul><li>缩放后图片的宽高应至少比cropRectF的宽高大，否则不可能包含cropRectF</li><li>picRectF必须始终包含cropRectF</li></ul> <p>对于第一条，我们可以在图片的宽高缩放前，先判断缩放后的宽高是否要不小于cropRectF的宽高，然后对缩放比例修正即可。<br> 对于第二条，则可以对picRectF添加偏移量修正即可。</p> </li></ul> 
<pre><code class="prism language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span>isMovingPic<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">double</span> distance <span class="token operator">=</span> <span class="token function">computeDistance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fingerPoint0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x0<span class="token punctuation">,</span> y0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fingerPoint1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>distance <span class="token operator">-</span> lastDistance<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">20</span><span class="token comment">/*临界值*/</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 平行移动</span>
        <span class="token comment">// 考虑到滑动过程中的轻微抖动，因此设定临界值，</span>
        <span class="token comment">// 两点距离的变动值在该值以内均视为平行移动</span>
        <span class="token keyword">float</span> centerX <span class="token operator">=</span> centerPoint<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
        <span class="token keyword">float</span> centerY <span class="token operator">=</span> centerPoint<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
        <span class="token function">updateCenterPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> xDiff <span class="token operator">=</span> centerPoint<span class="token punctuation">.</span>x <span class="token operator">-</span> centerX<span class="token punctuation">;</span>
        <span class="token keyword">float</span> yDiff <span class="token operator">=</span> centerPoint<span class="token punctuation">.</span>y <span class="token operator">-</span> centerY<span class="token punctuation">;</span>
        <span class="token comment">// 限制必须包含裁剪区域</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>picRectF<span class="token punctuation">.</span>left <span class="token operator">+</span> xDiff <span class="token operator">&gt;</span> cropRectF<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 右移</span>
            xDiff <span class="token operator">=</span> cropRectF<span class="token punctuation">.</span>left <span class="token operator">-</span> picRectF<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>picRectF<span class="token punctuation">.</span>right <span class="token operator">+</span> xDiff <span class="token operator">&lt;</span> cropRectF<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 左移</span>
            xDiff <span class="token operator">=</span> picRectF<span class="token punctuation">.</span>right <span class="token operator">-</span> cropRectF<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>picRectF<span class="token punctuation">.</span>top <span class="token operator">+</span> yDiff <span class="token operator">&gt;</span> cropRectF<span class="token punctuation">.</span>top<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 下移</span>
            yDiff <span class="token operator">=</span> cropRectF<span class="token punctuation">.</span>top <span class="token operator">-</span> picRectF<span class="token punctuation">.</span>top<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>picRectF<span class="token punctuation">.</span>bottom <span class="token operator">+</span> yDiff <span class="token operator">&lt;</span> cropRectF<span class="token punctuation">.</span>bottom<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 上移</span>
            yDiff <span class="token operator">=</span> picRectF<span class="token punctuation">.</span>bottom <span class="token operator">-</span> cropRectF<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        picRectF<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span>xDiff<span class="token punctuation">,</span> yDiff<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 缩放</span>
        <span class="token comment">// 将双指中心点转化为缩放中心点</span>
        <span class="token keyword">float</span> zoomCenterX <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>picRectF<span class="token punctuation">.</span>left<span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>centerPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span> picRectF<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> zoomCenterY <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>picRectF<span class="token punctuation">.</span>top<span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>centerPoint<span class="token punctuation">.</span>y<span class="token punctuation">,</span> picRectF<span class="token punctuation">.</span>bottom<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">updateCenterPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> picWidth <span class="token operator">=</span> picRectF<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> picHeight <span class="token operator">=</span> picRectF<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 计算缩放中心点在图片中x、y方向上的位置比例</span>
        <span class="token keyword">float</span> xScale <span class="token operator">=</span> <span class="token punctuation">(</span>zoomCenterX <span class="token operator">-</span> picRectF<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token operator">/</span> picWidth<span class="token punctuation">;</span><span class="token comment">// 缩放中心x方向位置比例</span>
        <span class="token keyword">float</span> yScale <span class="token operator">=</span> <span class="token punctuation">(</span>zoomCenterY <span class="token operator">-</span> picRectF<span class="token punctuation">.</span>top<span class="token punctuation">)</span> <span class="token operator">/</span> picHeight<span class="token punctuation">;</span><span class="token comment">// 缩放中心y方向位置比例</span>
        <span class="token keyword">float</span> zoomScale <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>distance <span class="token operator">/</span> lastDistance<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 图片的缩放比例</span>
        <span class="token comment">// 限制至少要包含裁剪区域</span>
        <span class="token keyword">float</span> newPicWidth <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>picWidth <span class="token operator">*</span> zoomScale<span class="token punctuation">,</span> cropRectF<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 缩放后图片的宽度</span>
        <span class="token keyword">float</span> newPicHeight <span class="token operator">=</span> newPicWidth <span class="token operator">*</span> picHeight <span class="token operator">/</span> picWidth<span class="token punctuation">;</span><span class="token comment">// 缩放后图片的高度</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newPicHeight <span class="token operator">&lt;</span> cropRectF<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 需要放大，放大后的图片宽度一定大于裁剪区域的宽度</span>
            newPicHeight <span class="token operator">*=</span> <span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> newPicHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
            newPicWidth <span class="token operator">=</span> newPicHeight <span class="token operator">*</span> picWidth <span class="token operator">/</span> picHeight<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 根据缩放中心的位置比例计算图片的矩阵位置</span>
        <span class="token keyword">float</span> newPicLeft <span class="token operator">=</span> zoomCenterX <span class="token operator">-</span> newPicWidth <span class="token operator">*</span> xScale<span class="token punctuation">;</span>
        <span class="token keyword">float</span> newPicTop <span class="token operator">=</span> zoomCenterY <span class="token operator">-</span> newPicHeight <span class="token operator">*</span> yScale<span class="token punctuation">;</span>
        picRectF<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>newPicLeft<span class="token punctuation">,</span> newPicTop<span class="token punctuation">,</span> newPicLeft <span class="token operator">+</span> newPicWidth<span class="token punctuation">,</span> newPicTop <span class="token operator">+</span> newPicHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 校正图片位置</span>
        <span class="token comment">// 此时图片的宽高一定大于裁剪区域的宽高</span>
        <span class="token keyword">float</span> xDiff <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> yDiff <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>picRectF<span class="token punctuation">.</span>left <span class="token operator">&gt;</span> cropRectF<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            xDiff <span class="token operator">=</span> cropRectF<span class="token punctuation">.</span>left <span class="token operator">-</span> picRectF<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>picRectF<span class="token punctuation">.</span>right <span class="token operator">&lt;</span> cropRectF<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            xDiff <span class="token operator">=</span> cropRectF<span class="token punctuation">.</span>right <span class="token operator">-</span> picRectF<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>picRectF<span class="token punctuation">.</span>top <span class="token operator">&gt;</span> cropRectF<span class="token punctuation">.</span>top<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            yDiff <span class="token operator">=</span> cropRectF<span class="token punctuation">.</span>top <span class="token operator">-</span> picRectF<span class="token punctuation">.</span>top<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>picRectF<span class="token punctuation">.</span>bottom <span class="token operator">&lt;</span> cropRectF<span class="token punctuation">.</span>bottom<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            yDiff <span class="token operator">=</span> cropRectF<span class="token punctuation">.</span>bottom <span class="token operator">-</span> picRectF<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
            picRectF<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span>xDiff<span class="token punctuation">,</span> yDiff<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        lastDistance <span class="token operator">=</span> distance<span class="token punctuation">;</span>
        <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>最后，便是获取裁剪的结果。<br> 因cropRectF必定含于PicRectF，因此裁剪结果即为cropRectF的全集，所以只需计算cropRectF的<code>left</code>、<code>top</code>值在picRectF上的比例，然后等比例换算为裁剪目标bitmap上的裁剪起始位的<code>x</code>、<code>y</code>，然后再将cropRectF的宽高同样等比例的换算为裁剪目标bitmap上的裁剪宽度和高度，使用<code>Bitmap.createBitmap(@NonNull Bitmap source, int x, int y, int width, int height)</code>即可获得裁剪结果。</p> 
<h2><a id="_277"></a>源码</h2> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- attrs.xml --&gt;</span>
<span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>declare-styleable</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>ImageCroppingView<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 设置裁剪区域宽高比. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>sizeScale<span class="token punctuation">"</span></span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>enum<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enum</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>use_weight<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enum</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>device_size<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enum</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>device_size_invert<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attr</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 设置裁剪区域宽度所占分量，仅在sizeScale设置为use_weight时有效. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>widthWeight<span class="token punctuation">"</span></span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>integer<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!-- 设置裁剪区域高度所占分量，仅在sizeScale设置为use_weight时有效. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>heightWeight<span class="token punctuation">"</span></span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>integer<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!-- 设置背景颜色. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>backgroundColor<span class="token punctuation">"</span></span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>color<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!-- 设置阴影层颜色（建议补充颜色的透明度）. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>shadowColor<span class="token punctuation">"</span></span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>color<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!-- 设置是否显示四个范围示意角. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>showFourAngle<span class="token punctuation">"</span></span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>boolean<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!-- 设置裁剪区域内部的填充样式. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fillStyle<span class="token punctuation">"</span></span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>enum<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- 不使用任何样式. --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enum</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>none<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token comment">&lt;!-- 画一个内切椭圆. --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enum</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>circle<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token comment">&lt;!-- 用九宫格划分. --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enum</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>nineGrid<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attr</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 设置填充样式是否使用虚线绘制. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>styleUseDashed<span class="token punctuation">"</span></span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>boolean<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!-- 设置裁剪区域内的描线宽度，四个角的描线宽度为其2倍. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>divideLineWidth<span class="token punctuation">"</span></span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dimension<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token comment">&lt;!-- 设置裁剪区域内的描线颜色. --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>divideLineColor<span class="token punctuation">"</span></span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>color<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>declare-styleable</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<pre><code class="prism language-java"><span class="token comment">// ImageCroppingView.java</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ImageCroppingView</span> <span class="token keyword">extends</span> <span class="token class-name">View</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> Context context<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> DisplayMetrics dm<span class="token punctuation">;</span><span class="token comment">// 设备显示器信息</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> Path path<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> Paint paint<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> DashPathEffect dashPathEffect<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> RectF picRectF<span class="token punctuation">;</span><span class="token comment">// 图片区域矩形</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> RectF cropRectF<span class="token punctuation">;</span><span class="token comment">// 裁剪区域矩形</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> PointF fingerPoint0<span class="token punctuation">;</span><span class="token comment">// 第一个手指触摸点的坐标</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> PointF fingerPoint1<span class="token punctuation">;</span><span class="token comment">// 第二个手指触摸点的坐标</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> PointF centerPoint<span class="token punctuation">;</span><span class="token comment">// 两个手指触点的中心点</span>
    <span class="token keyword">private</span> BitmapDrawable picture <span class="token operator">=</span> null<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> scale<span class="token punctuation">;</span><span class="token comment">// 裁剪区域高度对宽度的比例</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> isMovingCrop <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">// 操作目标为裁剪区域</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> isMovingPic <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token comment">// 操作目标为图片</span>
    <span class="token keyword">private</span> <span class="token keyword">double</span> lastDistance<span class="token punctuation">;</span><span class="token comment">// 上一次双指操作时两触点的距离</span>

    <span class="token comment">// *****************属性值*****************</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> sizeScale<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> widthWeight<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> heightWeight<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> backgroundColor<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> shadowColor<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> showFourAngle<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> fillStyle<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> styleUseDashed<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> divideLineWidth<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> divideLineColor<span class="token punctuation">;</span>

    <span class="token comment">// ****************枚举常量****************</span>
    <span class="token comment">/**
     * 使用设置的宽高权重来指定裁剪区域的比例.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> SCALE_USE_WEIGHT <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 使用当前设备的尺寸来指定裁剪区域的比例.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> SCALE_DEVICE_SIZE <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 使用当前设备尺寸的反转比例来指定裁剪区域的比例.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> SCALE_DEVICE_SIZE_INVERT <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@IntDef</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>SCALE_USE_WEIGHT<span class="token punctuation">,</span> SCALE_DEVICE_SIZE<span class="token punctuation">,</span> SCALE_DEVICE_SIZE_INVERT<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RetentionPolicy<span class="token punctuation">.</span>SOURCE<span class="token punctuation">)</span>
    <span class="token keyword">private</span> @<span class="token keyword">interface</span> <span class="token class-name">SizeScale</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token comment">/**
     * 裁剪区域内部不填充样式.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> STYLE_NONE <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 裁剪区域内部将绘制一个内切椭圆.&lt;br&gt;
     * &lt;font color="#F57C00"&gt;仅在API 21及以上设置有效&lt;/font&gt;.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> STYLE_CIRCLE <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 裁剪区域内部将绘制九宫格.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> STYLE_NINE_GRID <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@IntDef</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>STYLE_NONE<span class="token punctuation">,</span> STYLE_CIRCLE<span class="token punctuation">,</span> STYLE_NINE_GRID<span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RetentionPolicy<span class="token punctuation">.</span>SOURCE<span class="token punctuation">)</span>
    <span class="token keyword">private</span> @<span class="token keyword">interface</span> <span class="token class-name">FillStyle</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">ImageCroppingView</span><span class="token punctuation">(</span>Context context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">ImageCroppingView</span><span class="token punctuation">(</span>Context context<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> AttributeSet attrs<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>context <span class="token operator">=</span> context<span class="token punctuation">;</span>
        dm <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDisplayMetrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1dp转换为像素单位的大小</span>
        <span class="token keyword">float</span> oneDp <span class="token operator">=</span> TypedValue<span class="token punctuation">.</span><span class="token function">applyDimension</span><span class="token punctuation">(</span>TypedValue<span class="token punctuation">.</span>COMPLEX_UNIT_DIP<span class="token punctuation">,</span> <span class="token number">1.0f</span><span class="token punctuation">,</span> dm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        path <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        paint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Paint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dashPathEffect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DashPathEffect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">float</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        picRectF <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RectF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        cropRectF <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RectF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fingerPoint0 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        fingerPoint1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        centerPoint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        TypedArray typedArray <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">obtainStyledAttributes</span><span class="token punctuation">(</span>attrs<span class="token punctuation">,</span> R<span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>ImageCroppingView<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            sizeScale <span class="token operator">=</span> typedArray<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>ImageCroppingView_sizeScale<span class="token punctuation">,</span> SCALE_USE_WEIGHT<span class="token punctuation">)</span><span class="token punctuation">;</span>
            widthWeight <span class="token operator">=</span> typedArray<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>ImageCroppingView_widthWeight<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>widthWeight <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                widthWeight <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            heightWeight <span class="token operator">=</span> typedArray<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>ImageCroppingView_heightWeight<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>heightWeight <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                heightWeight <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            backgroundColor <span class="token operator">=</span> typedArray<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>ImageCroppingView_backgroundColor<span class="token punctuation">,</span> Color<span class="token punctuation">.</span><span class="token function">rgb</span><span class="token punctuation">(</span><span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            shadowColor <span class="token operator">=</span> typedArray<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>ImageCroppingView_shadowColor<span class="token punctuation">,</span> Color<span class="token punctuation">.</span><span class="token function">argb</span><span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            showFourAngle <span class="token operator">=</span> typedArray<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>ImageCroppingView_showFourAngle<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fillStyle <span class="token operator">=</span> typedArray<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>ImageCroppingView_fillStyle<span class="token punctuation">,</span> STYLE_NONE<span class="token punctuation">)</span><span class="token punctuation">;</span>
            styleUseDashed <span class="token operator">=</span> typedArray<span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>ImageCroppingView_styleUseDashed<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            divideLineWidth <span class="token operator">=</span> typedArray<span class="token punctuation">.</span><span class="token function">getDimension</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>ImageCroppingView_divideLineWidth<span class="token punctuation">,</span> oneDp<span class="token punctuation">)</span><span class="token punctuation">;</span>
            divideLineColor <span class="token operator">=</span> typedArray<span class="token punctuation">.</span><span class="token function">getColor</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>ImageCroppingView_divideLineColor<span class="token punctuation">,</span> Color<span class="token punctuation">.</span>WHITE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            typedArray<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">setSizeScale</span><span class="token punctuation">(</span>sizeScale<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initScale</span><span class="token punctuation">(</span><span class="token keyword">int</span> wWeight<span class="token punctuation">,</span> <span class="token keyword">int</span> hWeight<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        scale <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> hWeight <span class="token operator">/</span> wWeight<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onMeasure</span><span class="token punctuation">(</span><span class="token keyword">int</span> widthMeasureSpec<span class="token punctuation">,</span> <span class="token keyword">int</span> heightMeasureSpec<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>MeasureSpec<span class="token punctuation">.</span><span class="token function">getMode</span><span class="token punctuation">(</span>widthMeasureSpec<span class="token punctuation">)</span> <span class="token operator">!=</span> MeasureSpec<span class="token punctuation">.</span>EXACTLY<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            widthMeasureSpec <span class="token operator">=</span> MeasureSpec<span class="token punctuation">.</span><span class="token function">makeMeasureSpec</span><span class="token punctuation">(</span>dm<span class="token punctuation">.</span>widthPixels<span class="token punctuation">,</span> MeasureSpec<span class="token punctuation">.</span>AT_MOST<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>MeasureSpec<span class="token punctuation">.</span><span class="token function">getMode</span><span class="token punctuation">(</span>heightMeasureSpec<span class="token punctuation">)</span> <span class="token operator">!=</span> MeasureSpec<span class="token punctuation">.</span>EXACTLY<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            heightMeasureSpec <span class="token operator">=</span> MeasureSpec<span class="token punctuation">.</span><span class="token function">makeMeasureSpec</span><span class="token punctuation">(</span>dm<span class="token punctuation">.</span>heightPixels<span class="token punctuation">,</span> MeasureSpec<span class="token punctuation">.</span>AT_MOST<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onMeasure</span><span class="token punctuation">(</span>widthMeasureSpec<span class="token punctuation">,</span> heightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onDraw</span><span class="token punctuation">(</span>Canvas canvas<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">measureCropArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawColor</span><span class="token punctuation">(</span>backgroundColor<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 填充背景色</span>
        <span class="token comment">// 绘制图片</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>picture <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            picture<span class="token punctuation">.</span><span class="token function">setBounds</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> picRectF<span class="token punctuation">.</span>left<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> picRectF<span class="token punctuation">.</span>top<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> picRectF<span class="token punctuation">.</span>right<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> picRectF<span class="token punctuation">.</span>bottom<span class="token punctuation">)</span><span class="token punctuation">;</span>
            picture<span class="token punctuation">.</span><span class="token function">draw</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 避免因直接使用drawBitmap方法带来的可能的内存不足的问题</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 绘制裁剪区域</span>
        <span class="token function">drawCropArea</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 通过合理计算得出裁剪区域.
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">measureCropArea</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">float</span> width <span class="token operator">=</span> <span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> height <span class="token operator">=</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">boolean</span> wideView <span class="token operator">=</span> width <span class="token operator">&gt;</span> height<span class="token punctuation">;</span><span class="token comment">// 视图偏宽</span>
            <span class="token keyword">boolean</span> wideCrop <span class="token operator">=</span> scale <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">// 裁剪区域偏宽</span>
            <span class="token keyword">float</span> cropWidth<span class="token punctuation">;</span>
            <span class="token keyword">float</span> cropHeight<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>wideView<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>wideCrop<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 判断视图的高是否足够容纳的下裁剪区域需要的高度</span>
                    <span class="token comment">// 若直接使用视图高度为基准可能使得裁剪区域过于细长</span>
                    <span class="token keyword">float</span> cropWidthTemp <span class="token operator">=</span> width <span class="token operator">*</span> <span class="token number">2.0f</span> <span class="token operator">/</span> <span class="token number">3.0f</span><span class="token punctuation">;</span>
                    <span class="token keyword">float</span> cropHeightTemp <span class="token operator">=</span> cropWidthTemp <span class="token operator">*</span> scale<span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>cropHeightTemp <span class="token operator">&gt;</span> height<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        cropHeight <span class="token operator">=</span> height <span class="token operator">*</span> <span class="token number">2.0f</span> <span class="token operator">/</span> <span class="token number">3.0f</span><span class="token punctuation">;</span>
                        cropWidth <span class="token operator">=</span> cropHeight <span class="token operator">/</span> scale<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        cropWidth <span class="token operator">=</span> cropWidthTemp<span class="token punctuation">;</span>
                        cropHeight <span class="token operator">=</span> cropHeightTemp<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 以高度的2/3作为裁剪区域高度</span>
                    <span class="token comment">// 宽度按设定比例得出</span>
                    cropHeight <span class="token operator">=</span> height <span class="token operator">*</span> <span class="token number">2.0f</span> <span class="token operator">/</span> <span class="token number">3.0f</span><span class="token punctuation">;</span>
                    cropWidth <span class="token operator">=</span> cropHeight <span class="token operator">/</span> scale<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>wideCrop<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 以宽度的2/3作为裁剪区域宽度</span>
                    <span class="token comment">// 高度按设定比例得出</span>
                    cropWidth <span class="token operator">=</span> width <span class="token operator">*</span> <span class="token number">2.0f</span> <span class="token operator">/</span> <span class="token number">3.0f</span><span class="token punctuation">;</span>
                    cropHeight <span class="token operator">=</span> cropWidth <span class="token operator">*</span> scale<span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 判断视图的宽是否足够容纳的下裁剪区域需要的宽度</span>
                    <span class="token comment">// 若直接使用视图宽度为基准可能使得裁剪区域过细高</span>
                    <span class="token keyword">float</span> cropHeightTemp <span class="token operator">=</span> height <span class="token operator">*</span> <span class="token number">2.0f</span> <span class="token operator">/</span> <span class="token number">3.0f</span><span class="token punctuation">;</span>
                    <span class="token keyword">float</span> cropWidthTemp <span class="token operator">=</span> cropHeightTemp <span class="token operator">/</span> scale<span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>cropWidthTemp <span class="token operator">&gt;</span> width<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        cropWidth <span class="token operator">=</span> width <span class="token operator">*</span> <span class="token number">2.0f</span> <span class="token operator">/</span> <span class="token number">3.0f</span><span class="token punctuation">;</span>
                        cropHeight <span class="token operator">=</span> cropWidth <span class="token operator">*</span> scale<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        cropWidth <span class="token operator">=</span> cropWidthTemp<span class="token punctuation">;</span>
                        cropHeight <span class="token operator">=</span> cropHeightTemp<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">float</span> cropLeft <span class="token operator">=</span> <span class="token punctuation">(</span>width <span class="token operator">-</span> cropWidth<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> cropTop <span class="token operator">=</span> <span class="token punctuation">(</span>height <span class="token operator">-</span> cropHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>
            cropRectF<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>cropLeft<span class="token punctuation">,</span> cropTop<span class="token punctuation">,</span> cropLeft <span class="token operator">+</span> cropWidth<span class="token punctuation">,</span> cropTop <span class="token operator">+</span> cropHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">measurePicture</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 计算图片的矩形区域.
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">measurePicture</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>picture <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">float</span> picWidth <span class="token operator">=</span> picture<span class="token punctuation">.</span><span class="token function">getIntrinsicWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> picHeight <span class="token operator">=</span> picture<span class="token punctuation">.</span><span class="token function">getIntrinsicHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> cropHeight <span class="token operator">=</span> cropRectF<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> cropWidth <span class="token operator">=</span> cropRectF<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>picWidth <span class="token operator">&gt;</span> picHeight<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 宽图，按图片高度缩放到裁剪区域高度</span>
                picWidth <span class="token operator">=</span> picWidth <span class="token operator">*</span> cropHeight <span class="token operator">/</span> picHeight<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>picWidth <span class="token operator">&lt;</span> cropWidth<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 缩放后宽度不够，则放大宽度</span>
                    picHeight <span class="token operator">=</span> cropHeight <span class="token operator">*</span> cropWidth <span class="token operator">/</span> picWidth<span class="token punctuation">;</span>
                    picWidth <span class="token operator">=</span> cropWidth<span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    picHeight <span class="token operator">=</span> cropHeight<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 高图，按图片宽度缩放到裁剪区域宽度</span>
                picHeight <span class="token operator">=</span> picHeight <span class="token operator">*</span> cropWidth <span class="token operator">/</span> picWidth<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>picHeight <span class="token operator">&lt;</span> cropHeight<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 缩放后高度不够，则放大高度</span>
                    picWidth <span class="token operator">=</span> cropWidth <span class="token operator">*</span> cropHeight <span class="token operator">/</span> picHeight<span class="token punctuation">;</span>
                    picHeight <span class="token operator">=</span> cropHeight<span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    picWidth <span class="token operator">=</span> cropWidth<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 将图片居中放置</span>
            <span class="token keyword">float</span> picLeft <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> picWidth<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> picTop <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> picHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>
            picRectF<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>picLeft<span class="token punctuation">,</span> picTop<span class="token punctuation">,</span> picLeft <span class="token operator">+</span> picWidth<span class="token punctuation">,</span> picTop <span class="token operator">+</span> picHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 绘制裁剪区域.
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">drawCropArea</span><span class="token punctuation">(</span>Canvas canvas<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 绘制阴影层</span>
        canvas<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span><span class="token function">clipRect</span><span class="token punctuation">(</span>cropRectF<span class="token punctuation">,</span> Region<span class="token punctuation">.</span>Op<span class="token punctuation">.</span>DIFFERENCE<span class="token punctuation">)</span><span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawColor</span><span class="token punctuation">(</span>shadowColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 绘制四个角</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>showFourAngle<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            path<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> lineLength <span class="token operator">=</span> <span class="token number">0.1f</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cropRectF<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 左上角</span>
            path<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>left <span class="token operator">-</span> divideLineWidth<span class="token punctuation">,</span> cropRectF<span class="token punctuation">.</span>top <span class="token operator">+</span> lineLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
            path<span class="token punctuation">.</span><span class="token function">rLineTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span> lineLength <span class="token operator">-</span> divideLineWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
            path<span class="token punctuation">.</span><span class="token function">rLineTo</span><span class="token punctuation">(</span>divideLineWidth <span class="token operator">+</span> lineLength<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 右上角</span>
            path<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>right <span class="token operator">-</span> lineLength<span class="token punctuation">,</span> cropRectF<span class="token punctuation">.</span>top <span class="token operator">-</span> divideLineWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
            path<span class="token punctuation">.</span><span class="token function">rLineTo</span><span class="token punctuation">(</span>lineLength <span class="token operator">+</span> divideLineWidth<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            path<span class="token punctuation">.</span><span class="token function">rLineTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> divideLineWidth <span class="token operator">+</span> lineLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 右下角</span>
            path<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>right <span class="token operator">+</span> divideLineWidth<span class="token punctuation">,</span> cropRectF<span class="token punctuation">.</span>bottom <span class="token operator">-</span> lineLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
            path<span class="token punctuation">.</span><span class="token function">rLineTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> lineLength <span class="token operator">+</span> divideLineWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
            path<span class="token punctuation">.</span><span class="token function">rLineTo</span><span class="token punctuation">(</span><span class="token operator">-</span> divideLineWidth <span class="token operator">-</span> lineLength<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 左下角</span>
            path<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>left <span class="token operator">+</span> lineLength<span class="token punctuation">,</span> cropRectF<span class="token punctuation">.</span>bottom <span class="token operator">+</span> divideLineWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
            path<span class="token punctuation">.</span><span class="token function">rLineTo</span><span class="token punctuation">(</span><span class="token operator">-</span> lineLength <span class="token operator">-</span> divideLineWidth<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            path<span class="token punctuation">.</span><span class="token function">rLineTo</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span> divideLineWidth <span class="token operator">-</span> lineLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
            paint<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            paint<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>divideLineColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            paint<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span>Paint<span class="token punctuation">.</span>Style<span class="token punctuation">.</span>STROKE<span class="token punctuation">)</span><span class="token punctuation">;</span>
            paint<span class="token punctuation">.</span><span class="token function">setStrokeWidth</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> divideLineWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
            canvas<span class="token punctuation">.</span><span class="token function">drawPath</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> paint<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 绘制区域内样式</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fillStyle <span class="token operator">!=</span> STYLE_NONE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>showFourAngle<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                paint<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                paint<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>divideLineColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
                paint<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span>Paint<span class="token punctuation">.</span>Style<span class="token punctuation">.</span>STROKE<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            paint<span class="token punctuation">.</span><span class="token function">setStrokeWidth</span><span class="token punctuation">(</span>divideLineWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>styleUseDashed<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                paint<span class="token punctuation">.</span><span class="token function">setPathEffect</span><span class="token punctuation">(</span>dashPathEffect<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            path<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> strokeHalf <span class="token operator">=</span> divideLineWidth <span class="token operator">/</span> <span class="token number">2.0f</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>fillStyle <span class="token operator">==</span> STYLE_CIRCLE<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>Build<span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">&gt;=</span> Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>LOLLIPOP<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    paint<span class="token punctuation">.</span><span class="token function">setAntiAlias</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 抗锯齿</span>
                    path<span class="token punctuation">.</span><span class="token function">addOval</span><span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>left <span class="token operator">+</span> strokeHalf<span class="token punctuation">,</span> cropRectF<span class="token punctuation">.</span>top <span class="token operator">+</span> strokeHalf<span class="token punctuation">,</span>
                            cropRectF<span class="token punctuation">.</span>right <span class="token operator">-</span> strokeHalf<span class="token punctuation">,</span> cropRectF<span class="token punctuation">.</span>bottom <span class="token operator">-</span> strokeHalf<span class="token punctuation">,</span> Path<span class="token punctuation">.</span>Direction<span class="token punctuation">.</span>CW<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>fillStyle <span class="token operator">==</span> STYLE_NINE_GRID<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">float</span> cropWidth <span class="token operator">=</span> cropRectF<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">float</span> cropHeight <span class="token operator">=</span> cropRectF<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 上横</span>
                path<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>left <span class="token operator">+</span> strokeHalf<span class="token punctuation">,</span> cropRectF<span class="token punctuation">.</span>top <span class="token operator">+</span> cropHeight <span class="token operator">/</span> <span class="token number">3.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                path<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>right <span class="token operator">-</span> strokeHalf<span class="token punctuation">,</span> cropRectF<span class="token punctuation">.</span>top <span class="token operator">+</span> cropHeight <span class="token operator">/</span> <span class="token number">3.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 下横</span>
                path<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>left <span class="token operator">+</span> strokeHalf<span class="token punctuation">,</span> cropRectF<span class="token punctuation">.</span>top <span class="token operator">+</span> cropHeight <span class="token operator">*</span> <span class="token number">2.0f</span> <span class="token operator">/</span> <span class="token number">3.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                path<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>right <span class="token operator">-</span> strokeHalf<span class="token punctuation">,</span> cropRectF<span class="token punctuation">.</span>top <span class="token operator">+</span> cropHeight <span class="token operator">*</span> <span class="token number">2.0f</span> <span class="token operator">/</span> <span class="token number">3.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 左竖</span>
                path<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>left <span class="token operator">+</span> cropWidth <span class="token operator">/</span> <span class="token number">3.0f</span><span class="token punctuation">,</span> cropRectF<span class="token punctuation">.</span>top <span class="token operator">+</span> strokeHalf<span class="token punctuation">)</span><span class="token punctuation">;</span>
                path<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>left <span class="token operator">+</span> cropWidth <span class="token operator">/</span> <span class="token number">3.0f</span><span class="token punctuation">,</span> cropRectF<span class="token punctuation">.</span>bottom <span class="token operator">-</span> strokeHalf<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// 右竖</span>
                path<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>left <span class="token operator">+</span> cropWidth <span class="token operator">*</span> <span class="token number">2.0f</span> <span class="token operator">/</span> <span class="token number">3.0f</span><span class="token punctuation">,</span> cropRectF<span class="token punctuation">.</span>top <span class="token operator">+</span> strokeHalf<span class="token punctuation">)</span><span class="token punctuation">;</span>
                path<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>left <span class="token operator">+</span> cropWidth <span class="token operator">*</span> <span class="token number">2.0f</span> <span class="token operator">/</span> <span class="token number">3.0f</span><span class="token punctuation">,</span> cropRectF<span class="token punctuation">.</span>bottom <span class="token operator">-</span> strokeHalf<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            canvas<span class="token punctuation">.</span><span class="token function">drawPath</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> paint<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@SuppressLint</span><span class="token punctuation">(</span><span class="token string">"ClickableViewAccessibility"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">onTouchEvent</span><span class="token punctuation">(</span>MotionEvent event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>picture <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">float</span> x0 <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> y0 <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> x1 <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> y1 <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getPointerCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 双指</span>
                x1 <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                y1 <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> MotionEvent<span class="token punctuation">.</span>ACTION_MASK<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">case</span> MotionEvent<span class="token punctuation">.</span>ACTION_DOWN<span class="token operator">:</span>
                    isMovingCrop <span class="token operator">=</span> cropRectF<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>x0<span class="token punctuation">,</span> y0<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    isMovingPic <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    fingerPoint0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x0<span class="token punctuation">,</span> y0<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> MotionEvent<span class="token punctuation">.</span>ACTION_POINTER_DOWN<span class="token operator">:</span>
                    isMovingCrop <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>isMovingPic <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token function">getPointerCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span> <span class="token comment">// 双指操作</span>
                            <span class="token comment">// 至少有一点在图片范围内</span>
                            <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>picRectF<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>fingerPoint0<span class="token punctuation">.</span>x<span class="token punctuation">,</span> fingerPoint0<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">||</span> picRectF<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        fingerPoint1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">updateCenterPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        lastDistance <span class="token operator">=</span> <span class="token function">computeDistance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> MotionEvent<span class="token punctuation">.</span>ACTION_MOVE<span class="token operator">:</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>isMovingCrop<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">float</span> xDiff <span class="token operator">=</span> x0 <span class="token operator">-</span> fingerPoint0<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
                        <span class="token keyword">float</span> yDiff <span class="token operator">=</span> y0 <span class="token operator">-</span> fingerPoint0<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
                        fingerPoint0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x0<span class="token punctuation">,</span> y0<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 限制不能滑出图片的范围</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>left <span class="token operator">+</span> xDiff <span class="token operator">&lt;</span> picRectF<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 左移</span>
                            xDiff <span class="token operator">=</span> picRectF<span class="token punctuation">.</span>left <span class="token operator">-</span> cropRectF<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>right <span class="token operator">+</span> xDiff <span class="token operator">&gt;</span> picRectF<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 右移</span>
                            xDiff <span class="token operator">=</span> picRectF<span class="token punctuation">.</span>right <span class="token operator">-</span> cropRectF<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>top <span class="token operator">+</span> yDiff <span class="token operator">&lt;</span> picRectF<span class="token punctuation">.</span>top<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 上移</span>
                            yDiff <span class="token operator">=</span> picRectF<span class="token punctuation">.</span>top <span class="token operator">-</span> cropRectF<span class="token punctuation">.</span>top<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>bottom <span class="token operator">+</span> yDiff <span class="token operator">&gt;</span> picRectF<span class="token punctuation">.</span>bottom<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 下移</span>
                            yDiff <span class="token operator">=</span> picRectF<span class="token punctuation">.</span>bottom <span class="token operator">-</span> cropRectF<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token comment">// 限制不能滑出整个视图的范围</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>left <span class="token operator">+</span> xDiff <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 左移</span>
                            xDiff <span class="token operator">=</span> <span class="token operator">-</span> cropRectF<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>right <span class="token operator">+</span> xDiff <span class="token operator">&gt;</span> <span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 右移</span>
                            xDiff <span class="token operator">=</span> <span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> cropRectF<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>top <span class="token operator">+</span> yDiff <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 上移</span>
                            yDiff <span class="token operator">=</span> <span class="token operator">-</span> cropRectF<span class="token punctuation">.</span>top<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>bottom <span class="token operator">+</span> yDiff <span class="token operator">&gt;</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 下移</span>
                            yDiff <span class="token operator">=</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> cropRectF<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        cropRectF<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span>xDiff<span class="token punctuation">,</span> yDiff<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>isMovingPic<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">double</span> distance <span class="token operator">=</span> <span class="token function">computeDistance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        fingerPoint0<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x0<span class="token punctuation">,</span> y0<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        fingerPoint1<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y1<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>distance <span class="token operator">-</span> lastDistance<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">20</span><span class="token comment">/*临界值*/</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 平行移动</span>
                            <span class="token comment">// 考虑到滑动过程中的轻微抖动，因此设定临界值，</span>
                            <span class="token comment">// 两点距离的变动值在该值以内均视为平行移动</span>
                            <span class="token keyword">float</span> centerX <span class="token operator">=</span> centerPoint<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
                            <span class="token keyword">float</span> centerY <span class="token operator">=</span> centerPoint<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
                            <span class="token function">updateCenterPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">float</span> xDiff <span class="token operator">=</span> centerPoint<span class="token punctuation">.</span>x <span class="token operator">-</span> centerX<span class="token punctuation">;</span>
                            <span class="token keyword">float</span> yDiff <span class="token operator">=</span> centerPoint<span class="token punctuation">.</span>y <span class="token operator">-</span> centerY<span class="token punctuation">;</span>
                            <span class="token comment">// 限制必须包含裁剪区域</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>picRectF<span class="token punctuation">.</span>left <span class="token operator">+</span> xDiff <span class="token operator">&gt;</span> cropRectF<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 右移</span>
                                xDiff <span class="token operator">=</span> cropRectF<span class="token punctuation">.</span>left <span class="token operator">-</span> picRectF<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
                            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>picRectF<span class="token punctuation">.</span>right <span class="token operator">+</span> xDiff <span class="token operator">&lt;</span> cropRectF<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 左移</span>
                                xDiff <span class="token operator">=</span> picRectF<span class="token punctuation">.</span>right <span class="token operator">-</span> cropRectF<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>picRectF<span class="token punctuation">.</span>top <span class="token operator">+</span> yDiff <span class="token operator">&gt;</span> cropRectF<span class="token punctuation">.</span>top<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 下移</span>
                                yDiff <span class="token operator">=</span> cropRectF<span class="token punctuation">.</span>top <span class="token operator">-</span> picRectF<span class="token punctuation">.</span>top<span class="token punctuation">;</span>
                            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>picRectF<span class="token punctuation">.</span>bottom <span class="token operator">+</span> yDiff <span class="token operator">&lt;</span> cropRectF<span class="token punctuation">.</span>bottom<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 上移</span>
                                yDiff <span class="token operator">=</span> picRectF<span class="token punctuation">.</span>bottom <span class="token operator">-</span> cropRectF<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            picRectF<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span>xDiff<span class="token punctuation">,</span> yDiff<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 缩放</span>
                            <span class="token comment">// 将双指中心点转化为缩放中心点</span>
                            <span class="token keyword">float</span> zoomCenterX <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>picRectF<span class="token punctuation">.</span>left<span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>centerPoint<span class="token punctuation">.</span>x<span class="token punctuation">,</span> picRectF<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">float</span> zoomCenterY <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>picRectF<span class="token punctuation">.</span>top<span class="token punctuation">,</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>centerPoint<span class="token punctuation">.</span>y<span class="token punctuation">,</span> picRectF<span class="token punctuation">.</span>bottom<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token function">updateCenterPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">float</span> picWidth <span class="token operator">=</span> picRectF<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">float</span> picHeight <span class="token operator">=</span> picRectF<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">// 计算缩放中心点在图片中x、y方向上的位置比例</span>
                            <span class="token keyword">float</span> xScale <span class="token operator">=</span> <span class="token punctuation">(</span>zoomCenterX <span class="token operator">-</span> picRectF<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token operator">/</span> picWidth<span class="token punctuation">;</span><span class="token comment">// 缩放中心x方向位置比例</span>
                            <span class="token keyword">float</span> yScale <span class="token operator">=</span> <span class="token punctuation">(</span>zoomCenterY <span class="token operator">-</span> picRectF<span class="token punctuation">.</span>top<span class="token punctuation">)</span> <span class="token operator">/</span> picHeight<span class="token punctuation">;</span><span class="token comment">// 缩放中心y方向位置比例</span>
                            <span class="token keyword">float</span> zoomScale <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>distance <span class="token operator">/</span> lastDistance<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 图片的缩放比例</span>
                            <span class="token comment">// 限制至少要包含裁剪区域</span>
                            <span class="token keyword">float</span> newPicWidth <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>picWidth <span class="token operator">*</span> zoomScale<span class="token punctuation">,</span> cropRectF<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 缩放后图片的宽度</span>
                            <span class="token keyword">float</span> newPicHeight <span class="token operator">=</span> newPicWidth <span class="token operator">*</span> picHeight <span class="token operator">/</span> picWidth<span class="token punctuation">;</span><span class="token comment">// 缩放后图片的高度</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>newPicHeight <span class="token operator">&lt;</span> cropRectF<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">// 需要放大，放大后的图片宽度一定大于裁剪区域的宽度</span>
                                newPicHeight <span class="token operator">*=</span> <span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> newPicHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                newPicWidth <span class="token operator">=</span> newPicHeight <span class="token operator">*</span> picWidth <span class="token operator">/</span> picHeight<span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            <span class="token comment">// 根据缩放中心的位置比例计算图片的矩阵位置</span>
                            <span class="token keyword">float</span> newPicLeft <span class="token operator">=</span> zoomCenterX <span class="token operator">-</span> newPicWidth <span class="token operator">*</span> xScale<span class="token punctuation">;</span>
                            <span class="token keyword">float</span> newPicTop <span class="token operator">=</span> zoomCenterY <span class="token operator">-</span> newPicHeight <span class="token operator">*</span> yScale<span class="token punctuation">;</span>
                            picRectF<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>newPicLeft<span class="token punctuation">,</span> newPicTop<span class="token punctuation">,</span> newPicLeft <span class="token operator">+</span> newPicWidth<span class="token punctuation">,</span> newPicTop <span class="token operator">+</span> newPicHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">// 校正图片位置</span>
                            <span class="token comment">// 此时图片的宽高一定大于裁剪区域的宽高</span>
                            <span class="token keyword">float</span> xDiff <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
                            <span class="token keyword">float</span> yDiff <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>picRectF<span class="token punctuation">.</span>left <span class="token operator">&gt;</span> cropRectF<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                xDiff <span class="token operator">=</span> cropRectF<span class="token punctuation">.</span>left <span class="token operator">-</span> picRectF<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
                            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>picRectF<span class="token punctuation">.</span>right <span class="token operator">&lt;</span> cropRectF<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                xDiff <span class="token operator">=</span> cropRectF<span class="token punctuation">.</span>right <span class="token operator">-</span> picRectF<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>picRectF<span class="token punctuation">.</span>top <span class="token operator">&gt;</span> cropRectF<span class="token punctuation">.</span>top<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                yDiff <span class="token operator">=</span> cropRectF<span class="token punctuation">.</span>top <span class="token operator">-</span> picRectF<span class="token punctuation">.</span>top<span class="token punctuation">;</span>
                            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>picRectF<span class="token punctuation">.</span>bottom <span class="token operator">&lt;</span> cropRectF<span class="token punctuation">.</span>bottom<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                yDiff <span class="token operator">=</span> cropRectF<span class="token punctuation">.</span>bottom <span class="token operator">-</span> picRectF<span class="token punctuation">.</span>bottom<span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            picRectF<span class="token punctuation">.</span><span class="token function">offset</span><span class="token punctuation">(</span>xDiff<span class="token punctuation">,</span> yDiff<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        lastDistance <span class="token operator">=</span> distance<span class="token punctuation">;</span>
                        <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    isMovingCrop <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    isMovingPic <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onTouchEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">updateCenterPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        centerPoint<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">(</span>fingerPoint0<span class="token punctuation">.</span>x <span class="token operator">+</span> fingerPoint1<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0f</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>fingerPoint0<span class="token punctuation">.</span>y <span class="token operator">+</span> fingerPoint1<span class="token punctuation">.</span>y<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2.0f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">double</span> <span class="token function">computeDistance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>fingerPoint0<span class="token punctuation">.</span>x <span class="token operator">-</span> fingerPoint1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span>fingerPoint0<span class="token punctuation">.</span>y <span class="token operator">-</span> fingerPoint1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ****************获得数据****************</span>
    <span class="token comment">/**
     * 获得裁剪结果.
     *
     * @return 裁剪结果，若未设置裁剪目标则返回null
     */</span>
    <span class="token annotation punctuation">@Nullable</span>
    <span class="token keyword">public</span> Bitmap <span class="token function">getCroppingResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>picture <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            Bitmap bitmap <span class="token operator">=</span> picture<span class="token punctuation">.</span><span class="token function">getBitmap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> pictureWidth <span class="token operator">=</span> bitmap<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> pictureHeight <span class="token operator">=</span> bitmap<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> picWidth <span class="token operator">=</span> picRectF<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">float</span> picHeight <span class="token operator">=</span> picRectF<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> Bitmap<span class="token punctuation">.</span><span class="token function">createBitmap</span><span class="token punctuation">(</span>
                    bitmap<span class="token punctuation">,</span>
                    <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>pictureWidth <span class="token operator">*</span> <span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>left <span class="token operator">-</span> picRectF<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token operator">/</span> picWidth<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">// 截取的起始x</span>
                    <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>pictureHeight <span class="token operator">*</span> <span class="token punctuation">(</span>cropRectF<span class="token punctuation">.</span>top <span class="token operator">-</span> picRectF<span class="token punctuation">.</span>top<span class="token punctuation">)</span> <span class="token operator">/</span> picHeight<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">// 截取的起始y</span>
                    <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>pictureWidth <span class="token operator">*</span> cropRectF<span class="token punctuation">.</span><span class="token function">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> picWidth<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">// 截取的宽度</span>
                    <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>pictureHeight <span class="token operator">*</span> cropRectF<span class="token punctuation">.</span><span class="token function">height</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> picHeight<span class="token punctuation">)</span><span class="token comment">// 截取的高度</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获得裁剪的原始图片.
     *
     * @return 原始图片，若未设置裁剪目标则返回null
     */</span>
    <span class="token annotation punctuation">@Nullable</span>
    <span class="token keyword">public</span> Bitmap <span class="token function">getPicture</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> picture <span class="token operator">!=</span> null <span class="token operator">?</span> picture<span class="token punctuation">.</span><span class="token function">getBitmap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取裁剪区域高度对宽度的比例.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">float</span> <span class="token function">getWeightScale</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> scale<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取背景颜色.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getBackgroundColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> backgroundColor<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取阴影层颜色.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getShadowColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> shadowColor<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 裁剪区域是否展示四个区域范围示意角.
     *
     * @return 若展示则返回true，否则返回false
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isShowFourAngle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> showFourAngle<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 裁剪区域内部样式是否使用虚线绘制.
     *
     * @return 若使用虚线绘制则返回true，否则返回false
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isStyleUseDashed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> styleUseDashed<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取绘制裁剪区域内部样式的颜色.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getDivideLineColor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> divideLineColor<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取裁剪区域内部样式的描线宽度.&lt;br&gt;
     * 以像素为单位.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">float</span> <span class="token function">getDivideLineWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> divideLineWidth<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取裁剪区域内部的绘制样式.
     *
     * @see #STYLE_NONE
     * @see #STYLE_CIRCLE
     * @see #STYLE_NINE_GRID
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getFillStyle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> fillStyle<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ****************更新数据****************</span>
    <span class="token comment">/**
     * 设置目标裁剪图片.
     *
     * @param picture 目标图片
     * @return 当前对象的引用
     * @see #refresh()
     */</span>
    <span class="token keyword">public</span> ImageCroppingView <span class="token function">setPicture</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> BitmapDrawable picture<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>picture <span class="token operator">=</span> picture<span class="token punctuation">;</span>
        cropRectF<span class="token punctuation">.</span><span class="token function">setEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 设置目标裁剪图片.
     *
     * @param picture 目标图片
     * @return 当前对象的引用
     * @see #refresh()
     */</span>
    <span class="token keyword">public</span> ImageCroppingView <span class="token function">setPicture</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> Bitmap picture<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">setPicture</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BitmapDrawable</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> picture<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 使用图片的URI设置目标裁剪图片.
     *
     * @param pictureUri 目标图片的URI
     * @return 当前对象的引用
     * @throws FileNotFoundException 如果无法打开提供的URI
     * @throws RuntimeException 如果传入的URI文件不是图片
     * @see #refresh()
     */</span>
    <span class="token keyword">public</span> ImageCroppingView <span class="token function">setPicture</span><span class="token punctuation">(</span><span class="token annotation punctuation">@NonNull</span> Uri pictureUri<span class="token punctuation">)</span> <span class="token keyword">throws</span> FileNotFoundException<span class="token punctuation">,</span> RuntimeException <span class="token punctuation">{<!-- --></span>
        Drawable drawable <span class="token operator">=</span> Drawable<span class="token punctuation">.</span><span class="token function">createFromStream</span><span class="token punctuation">(</span>
                context<span class="token punctuation">.</span><span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">openInputStream</span><span class="token punctuation">(</span>pictureUri<span class="token punctuation">)</span><span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>drawable <span class="token keyword">instanceof</span> <span class="token class-name">BitmapDrawable</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"错误的图片类型"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token function">setPicture</span><span class="token punctuation">(</span><span class="token punctuation">(</span>BitmapDrawable<span class="token punctuation">)</span> drawable<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 设置裁剪区域尺寸比例的类型.
     *
     * @param sizeScale 类型值
     * @return 当前对象的引用
     * @see #SCALE_USE_WEIGHT
     * @see #SCALE_DEVICE_SIZE
     * @see #SCALE_DEVICE_SIZE_INVERT
     * @see #refresh()
     */</span>
    <span class="token keyword">public</span> ImageCroppingView <span class="token function">setSizeScale</span><span class="token punctuation">(</span><span class="token annotation punctuation">@SizeScale</span> <span class="token keyword">int</span> sizeScale<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sizeScale <span class="token operator">=</span> sizeScale<span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>sizeScale<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> SCALE_USE_WEIGHT<span class="token operator">:</span>
                <span class="token function">initScale</span><span class="token punctuation">(</span>widthWeight<span class="token punctuation">,</span> heightWeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> SCALE_DEVICE_SIZE<span class="token operator">:</span>
                <span class="token function">initScale</span><span class="token punctuation">(</span>dm<span class="token punctuation">.</span>widthPixels<span class="token punctuation">,</span> dm<span class="token punctuation">.</span>heightPixels<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> SCALE_DEVICE_SIZE_INVERT<span class="token operator">:</span>
                <span class="token function">initScale</span><span class="token punctuation">(</span>dm<span class="token punctuation">.</span>heightPixels<span class="token punctuation">,</span> dm<span class="token punctuation">.</span>widthPixels<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                scale <span class="token operator">=</span> <span class="token number">1.0f</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        cropRectF<span class="token punctuation">.</span><span class="token function">setEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 设置新的裁剪区域宽高比例.&lt;br&gt;
     * sizeScale的值将同时设为{@link #SCALE_USE_WEIGHT}.
     *
     * @param widthWeight 宽度所占分量
     * @param heightWeight 高度所占分量
     * @return 当前对象的引用
     * @see #refresh()
     */</span>
    <span class="token keyword">public</span> ImageCroppingView <span class="token function">setWeightScale</span><span class="token punctuation">(</span><span class="token annotation punctuation">@IntRange</span><span class="token punctuation">(</span>from <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">int</span> widthWeight<span class="token punctuation">,</span> <span class="token annotation punctuation">@IntRange</span><span class="token punctuation">(</span>from <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">int</span> heightWeight<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>widthWeight <span class="token operator">=</span> widthWeight<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>heightWeight <span class="token operator">=</span> heightWeight<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>sizeScale <span class="token operator">=</span> SCALE_USE_WEIGHT<span class="token punctuation">;</span>
        <span class="token function">initScale</span><span class="token punctuation">(</span>widthWeight<span class="token punctuation">,</span> heightWeight<span class="token punctuation">)</span><span class="token punctuation">;</span>
        cropRectF<span class="token punctuation">.</span><span class="token function">setEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 设置背景颜色.
     *
     * @param backgroundColor 新的背景颜色
     * @return 当前对象的引用
     * @see #refresh()
     */</span>
    <span class="token keyword">public</span> ImageCroppingView <span class="token function">setCroppingBackgroundColor</span><span class="token punctuation">(</span><span class="token annotation punctuation">@ColorInt</span> <span class="token keyword">int</span> backgroundColor<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> backgroundColor<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 设置阴影层颜色.&lt;br&gt;
     * 建议附加透明度.
     *
     * @param shadowColor 新的阴影层颜色
     * @return 当前对象的引用
     * @see #refresh()
     */</span>
    <span class="token keyword">public</span> ImageCroppingView <span class="token function">setShadowColor</span><span class="token punctuation">(</span><span class="token annotation punctuation">@ColorInt</span> <span class="token keyword">int</span> shadowColor<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>shadowColor <span class="token operator">=</span> shadowColor<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 设置裁剪区域是否展示四个区域范围示意角.
     *
     * @param showFourAngle true表示展示，false表示不展示
     * @return 当前对象的引用
     * @see #refresh()
     */</span>
    <span class="token keyword">public</span> ImageCroppingView <span class="token function">setShowFourAngle</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> showFourAngle<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>showFourAngle <span class="token operator">=</span> showFourAngle<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 设置裁剪区域内部样式是否使用虚线绘制.
     *
     * @param styleUseDashed true表示使用虚线，false表示使用直线
     * @return 当前对象的引用
     * @see #refresh()
     */</span>
    <span class="token keyword">public</span> ImageCroppingView <span class="token function">setStyleUseDashed</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> styleUseDashed<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>styleUseDashed <span class="token operator">=</span> styleUseDashed<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 设置裁剪区域内部样式的绘制颜色.&lt;br&gt;
     * 四个范围示意角将使用同样的颜色绘制.
     *
     * @param divideLineColor 新的绘制颜色
     * @return 当前对象的引用
     * @see #refresh()
     */</span>
    <span class="token keyword">public</span> ImageCroppingView <span class="token function">setDivideLineColor</span><span class="token punctuation">(</span><span class="token annotation punctuation">@ColorInt</span> <span class="token keyword">int</span> divideLineColor<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>divideLineColor <span class="token operator">=</span> divideLineColor<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 设置裁剪区域内部样式的描线宽度.&lt;br&gt;
     * 四个范围示意角的描线宽度为其二倍.
     *
     * @param divideLineWidthDpValue 新的描线宽度（以dp为单位）
     * @return 当前对象的引用
     * @see #refresh()
     */</span>
    <span class="token keyword">public</span> ImageCroppingView <span class="token function">setDivideLineWidth</span><span class="token punctuation">(</span><span class="token annotation punctuation">@FloatRange</span><span class="token punctuation">(</span>from <span class="token operator">=</span> <span class="token number">0.0f</span><span class="token punctuation">)</span> <span class="token keyword">float</span> divideLineWidthDpValue<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>divideLineWidth <span class="token operator">=</span> TypedValue<span class="token punctuation">.</span><span class="token function">applyDimension</span><span class="token punctuation">(</span>TypedValue<span class="token punctuation">.</span>COMPLEX_UNIT_DIP<span class="token punctuation">,</span> divideLineWidthDpValue<span class="token punctuation">,</span> dm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 设置裁剪区域的内部样式.
     *
     * @param fillStyle 样式值
     * @return 当前对象的引用
     * @see #STYLE_NONE
     * @see #STYLE_CIRCLE
     * @see #STYLE_NINE_GRID
     * @see #refresh()
     */</span>
    <span class="token keyword">public</span> ImageCroppingView <span class="token function">setFillStyle</span><span class="token punctuation">(</span><span class="token annotation punctuation">@FillStyle</span> <span class="token keyword">int</span> fillStyle<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>fillStyle <span class="token operator">=</span> fillStyle<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 刷新所有的设置以显示在视图上.
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">requestLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>才疏学浅，不足之处烦请多多指教。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/220b2d38a59102b04b69e32666128b2e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">华为设备的安全配置console及telnet</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1efb4ebaf2b06a6dc4f95a3ba098e57c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">php通过js加载数据,ajax实现加载数据的步骤详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>