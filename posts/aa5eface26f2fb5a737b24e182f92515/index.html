<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>我开源了一个基于Vue的组织架构树组件 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="我开源了一个基于Vue的组织架构树组件" />
<meta property="og:description" content="点赞再看，养成习惯
本文 GitHub https://github.com/qq449245884/xiaozhi 上已经收录，更多往期高赞文章的分类，也整理了很多我的文档，和教程资料。欢迎Star和完善，大家面试可以参照考点复习，希望我们一起有点东西。
大家都说简历没项目写，我就帮大家找了一个项目，还附赠【搭建教程】。
开门见山 Demo 演示地址：http://www.longstudy.club/vue-okr-tree-doc/index.html
github 地址：https://github.com/qq449245884/vue-okr-tree
项目背景 因为最近公司需要做一个OKR，OKR 里面有个对齐视图，是一个数型结构，如下图所示：
就拿我 小智 来说，如果有人对齐我的 KR 就放到我的右边，如果是我对齐了谁的 KR，就放到我的左边，类似一个上下级的关系，所以这里我用两棵树来表示左边与右边的关系。
在GitHub上找了半天，这类组件不多，也没有符合业务需求的组件，所以决定自己造轮子！
分析 既然是树，那么每个节点都应该是相同的组件节点下面套节点，所以节点组件应该是一个递归组件整棵树应该有一个全局的状态，用来管理从外部传入的值以及向外部提供的属性和方法。每相树节点应该也要有一个对应的节点状态，来管理节点自身属性和方法。 实现思路 递归组件 对于递归组件，Vue 官方文档是这样说的：
组件在它的模板内可以递归地调用自己。不过，只有当它有 name 选项时才可以这么做。
这里我用 OkrTreeNode.vue 来表示树的节点，里面是这样用递归，下面是该组件简定：
&lt;template&gt; &lt;OkrTreeNode v-for=&#34;child in leftChildNodes&#34; :node=&#34;child&#34; &gt;&lt;/OkrTreeNode&gt; &lt;/template&gt; export default { name: &#39;OkrTreeNode&#39; } 递归组件的使用需要注意的两点是组件里面要有组件name 以及结束递归的条件。
树的状态 对于树的状态，我用一个 TreeStore 类来表示，该实现方式主要是参考 ElementUI 中的 tree 组件。TreeStore 中的属性就表示我外部传入的 pros 或者 attr 或者 事件和方法，都在这个对象里面管理，具体的代码可以看这里：
https://github.com/qq449245884/vue-okr-tree/blob/main/src/lib/vue-okr-tree/model/tree-store.js
节点的状态 对于节点的状态，我用一个 Node 对象来表示，具体的代码可以看下面这个地址，这里就不展开说了：
https://github.com/qq449245884/vue-okr-tree/blob/main/src/lib/vue-okr-tree/model/node.js" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/aa5eface26f2fb5a737b24e182f92515/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-11-09T08:59:57+08:00" />
<meta property="article:modified_time" content="2020-11-09T08:59:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">我开源了一个基于Vue的组织架构树组件</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p><strong>点赞再看，养成习惯</strong></p> 
 <p><strong>本文 <code>GitHub</code> <a href="https://github.com/qq449245884/xiaozhi">https://github.com/qq449245884/xiaozhi</a> 上已经收录，更多往期高赞文章的分类，也整理了很多我的文档，和教程资料。欢迎Star和完善，大家面试可以参照考点复习，希望我们一起有点东西。</strong></p> 
</blockquote> 
<p><strong>大家都说简历没项目写，我就帮大家找了一个项目，还附赠<a href="http://www.longstudy.club/tuiguan/t1/index.html" rel="nofollow">【搭建教程】</a>。</strong></p> 
<h3><a id="_7"></a>开门见山</h3> 
<p>Demo 演示地址：<a href="http://www.longstudy.club/vue-okr-tree-doc/index.html" rel="nofollow">http://www.longstudy.club/vue-okr-tree-doc/index.html</a></p> 
<p>github 地址：https://github.com/qq449245884/vue-okr-tree</p> 
<h3><a id="_14"></a>项目背景</h3> 
<p>因为最近公司需要做一个OKR，OKR 里面有个对齐视图，是一个数型结构，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/3d/7f/dNFD0s3O_o.png" alt=""></p> 
<p>就拿我 小智 来说，如果有人对齐我的 KR 就放到我的右边，如果是我对齐了谁的 KR，就放到我的左边，类似一个上下级的关系，所以这里我用两棵树来表示左边与右边的关系。</p> 
<p>在GitHub上找了半天，这类组件不多，也没有符合业务需求的组件，所以决定自己造轮子！</p> 
<h3><a id="_26"></a>分析</h3> 
<ul><li>既然是树，那么每个节点都应该是相同的组件</li><li>节点下面套节点，所以节点组件应该是一个递归组件</li><li>整棵树应该有一个全局的状态，用来管理从外部传入的值以及向外部提供的属性和方法。</li><li>每相树节点应该也要有一个对应的节点状态，来管理节点自身属性和方法。</li></ul> 
<h3><a id="_33"></a>实现思路</h3> 
<h5><a id="_35"></a>递归组件</h5> 
<p>对于递归组件，<a href="https://cn.vuejs.org/v2/guide/components-edge-cases.html#%E9%80%92%E5%BD%92%E7%BB%84%E4%BB%B6" rel="nofollow">Vue 官方文档</a>是这样说的：</p> 
<blockquote> 
 <p>组件在它的模板内可以递归地调用自己。不过，只有当它有 name 选项时才可以这么做。</p> 
</blockquote> 
<p>这里我用 <a href="https://github.com/qq449245884/vue-okr-tree/blob/main/src/lib/vue-okr-tree/OkrTreeNode.vue">OkrTreeNode.vue</a> 来表示树的节点，里面是这样用递归，下面是该组件简定：</p> 
<pre><code>&lt;template&gt;
  &lt;OkrTreeNode
    v-for="child in leftChildNodes"
    :node="child"
  &gt;&lt;/OkrTreeNode&gt;
&lt;/template&gt;

export default {
  name: 'OkrTreeNode'
}
</code></pre> 
<p>递归组件的使用需要注意的两点是组件里面要有组件<code>name</code> 以及结束递归的条件。</p> 
<h5><a id="_61"></a>树的状态</h5> 
<p>对于树的状态，我用一个 TreeStore 类来表示，该实现方式主要是参考 ElementUI 中的 tree 组件。TreeStore 中的属性就表示我外部传入的 pros 或者 attr 或者 事件和方法，都在这个对象里面管理，具体的代码可以看这里：</p> 
<p><a href="https://github.com/qq449245884/vue-okr-tree/blob/main/src/lib/vue-okr-tree/model/tree-store.js">https://github.com/qq449245884/vue-okr-tree/blob/main/src/lib/vue-okr-tree/model/tree-store.js</a></p> 
<h3><a id="_68"></a>节点的状态</h3> 
<p>对于节点的状态，我用一个 Node 对象来表示，具体的代码可以看下面这个地址，这里就不展开说了：</p> 
<p><a href="https://github.com/qq449245884/vue-okr-tree/blob/main/src/lib/vue-okr-tree/model/node.js">https://github.com/qq449245884/vue-okr-tree/blob/main/src/lib/vue-okr-tree/model/node.js</a></p> 
<h3><a id="Demo__74"></a>Demo 演示</h3> 
<h5><a id="_77"></a>基础用法</h5> 
<p>基础的树形结构展示，默认方式垂直方向。</p> 
<p><img src="https://images2.imgbox.com/ab/8a/rz7MRzJe_o.png" alt=""></p> 
<h5><a id="_86"></a>水平方向</h5> 
<p>将 <code>direction</code> 属性设置为 <code>horizontal</code> 就可以展示水平方向。</p> 
<p><img src="https://images2.imgbox.com/08/a6/PD3z5mmY_o.png" alt=""></p> 
<h5><a id="_94"></a>节点是否可被展开</h5> 
<p>节点可被展开,默认是不展开，通过<code>show-collapsable</code>设置节点可被展开。</p> 
<p><img src="https://images2.imgbox.com/b8/8b/JnPjHCOB_o.png" alt=""></p> 
<h5><a id="_104"></a>节点默认全部展开</h5> 
<p>通过设置 <code>default-expand-all</code> 默认展开所有节点，该参数只有在 <code>show-collapsable</code> 为<code>true</code> 时有效</p> 
<p><img src="https://images2.imgbox.com/f5/1f/xDKiY7zN_o.png" alt=""></p> 
<h5><a id="_Tree__113"></a>可将 Tree 的某些节点设置为默认展开</h5> 
<p><img src="https://images2.imgbox.com/fe/23/POOTbnBz_o.png" alt=""></p> 
<p>通过 <code>default-expanded-keys</code> 设置默认展开的节点。需要注意的是，此时必须设置 <code>node-key</code> ，其值为节点数据中的一个字段名，该字段在整棵树中是唯一的。</p> 
<h3><a id="_121"></a>节点的样式</h3> 
<p>可自行设置节点的默认样式和选中的样式。</p> 
<p>通过 <code>label-class-name</code> 设置节点的样式，支持字符和函数方式。通过 <code>current-lable-class-name</code> 设置当前节点选中的样式，支持字符和函数方式。</p> 
<p><img src="https://images2.imgbox.com/aa/7d/MeWN2toO_o.png" alt=""></p> 
<h5><a id="_130"></a>节点自定义内容</h5> 
<p>可自行设置节点内容。通过 <code>render-content</code> 渲染节点内容。</p> 
<p><img src="https://images2.imgbox.com/47/27/ZIH8e7j5_o.png" alt=""></p> 
<h5><a id="OKR__139"></a>OKR 展示模式</h5> 
<p>该模式的出现，是为了实现跟飞书OKR 展示的视图一样效果，所以在 Tree 的模式下，扩展成左右两棵子树。<br> 该模式必须设置 <code>onlyBothTree</code> ，以及通过 <code>leftData</code>表示左子数的结构。</p> 
<p><img src="https://images2.imgbox.com/4f/af/t6cK8mWc_o.png" alt=""></p> 
<h5><a id="OKR__150"></a>OKR 展示模式之自定义节点内容</h5> 
<p>与上常规 Tree 一样，我们也可以通过自定义渲染函数来制定节点的内容。</p> 
<p>通过 <code>render-content</code> 渲染节点内容，通过返回 node 中的 <code>isLeftChild</code> 判断是否是左边的树。</p> 
<p><img src="https://images2.imgbox.com/ed/30/IanFx40T_o.png" alt=""></p> 
<h5><a id="_162"></a>节点过滤(不可展开)及支持的方法</h5> 
<p>通过关键字过滤树节点，在需要对节点进行过滤时，调用 Tree 实例的 filter 方法，参数为关键字。需要注意的是，此时需要设置 <code>filter-node-method</code> ，值为过滤函数。</p> 
<p><img src="https://images2.imgbox.com/7a/73/CT9FzDkG_o.png" alt=""></p> 
<h5><a id="_172"></a>节点过滤(可被展开)</h5> 
<p>通过关键字过滤树节点，在需要对节点进行过滤时，调用 Tree 实例的 <code>filter</code> 方法，参数为关键字。需要注意的是，此时需要设置 <code>filter-node-method</code> ，值为过滤函数。</p> 
<p><img src="https://images2.imgbox.com/73/8b/Y3xjkEg2_o.png" alt=""></p> 
<h5><a id="_179"></a>支持的事件(不可展开)</h5> 
<p>不可展开时支持的事件有 节点点击 和 鼠标右键点击。</p> 
<p><img src="https://images2.imgbox.com/c8/8c/FqgL2mlb_o.png" alt=""></p> 
<h5><a id="_187"></a>支持的事件(可被展开)</h5> 
<p>可展开时支持的事件有 节点点击、鼠标右键点击，节点的展开以及节点的关闭。</p> 
<p><img src="https://images2.imgbox.com/bf/2c/qYEoeNKk_o.png" alt=""></p> 
<h3><a id="Attributes_195"></a>Attributes</h3> 
<table><thead><tr><th align="left">参数</th><th>说明</th><th align="center">类型</th><th align="center">可选值</th><th align="center">默认值</th></tr></thead><tbody><tr><td align="left">data</td><td>展示数据</td><td align="center">array</td><td align="center">—</td><td align="center">—</td></tr><tr><td align="left">direction</td><td>树的展开方向</td><td align="center">String</td><td align="center">horizontal / vertical</td><td align="center">vertical</td></tr><tr><td align="left">onlyBothTree</td><td>子树在根节点左右两边展开，该模式只有在 direction 为 horizontal 有效，且必须提供 leftData 数据</td><td align="center">Boolean</td><td align="center">—</td><td align="center">false</td></tr><tr><td align="left">leftData</td><td>展示左子数的数据，该属性于在 onlyBothTree 模式启用</td><td align="center">array</td><td align="center">—</td><td align="center">—</td></tr><tr><td align="left">label-width</td><td>节点的宽度，默认为自动宽度。如果 label-width 为 number 类型，单位 px；如果 label-width 为 string 类型，则这个宽度会设置为 节点 的 style.width 的值，节点的宽度会受控于外部样式</td><td align="center">string/number</td><td align="center">—</td><td align="center">—</td></tr><tr><td align="left">label-height</td><td>节点的高度，默认为自动高度。如果 label-height 为 number 类型，单位 px；如果 label-height 为 string 类型，则这个高度会设置为 节点 的 style.height 的值，节点的高度会受控于外部样式</td><td align="center">string/number</td><td align="center">—</td><td align="center">—</td></tr><tr><td align="left">label-class-name</td><td>节点 className 的回调方法，也可以使用字符串为所有的节点设置一个固定的 className</td><td align="center">Function(node)/String</td><td align="center">—</td><td align="center">—</td></tr><tr><td align="left">current-lable-class-name</td><td>当前选中节点的样式</td><td align="center">Function(node)/String</td><td align="center">—</td><td align="center">—</td></tr><tr><td align="left">show-collapsable</td><td>节点是否可被展开</td><td align="center">Boolean</td><td align="center">—</td><td align="center">false</td></tr><tr><td align="left">default-expand-all</td><td>是否默认展开所有节点，该参数只有在 show-collapsable 为 true 时有效</td><td align="center">Boolean</td><td align="center">—</td><td align="center">false</td></tr><tr><td align="left">render-content</td><td>树节点的内容区的渲染 Function</td><td align="center">Function(h, node)</td><td align="center">—</td><td align="center">—</td></tr><tr><td align="left">props</td><td>配置选项，具体看下表</td><td align="center">object</td><td align="center">—</td><td align="center">—</td></tr><tr><td align="left">node-key</td><td>每个树节点用来作为唯一标识的属性，整棵树应该是唯一的</td><td align="center">String</td><td align="center">—</td><td align="center">—</td></tr><tr><td align="left">default-expanded-keys</td><td>默认展开的节点的 key 的数组(需要注意的是，此时必须设置node-key，其值为节点数据中的一个字段名，该字段在整棵树中是唯一的。)</td><td align="center">array</td><td align="center">—</td><td align="center">—</td></tr><tr><td align="left">filter-node-method</td><td>对树节点进行筛选时执行的方法，返回 true 表示这个节点可以显示，返回 false 则表示这个节点会被隐藏</td><td align="center">Function(value, data, node)</td><td align="center">—</td><td align="center">—</td></tr></tbody></table> 
<h3><a id="props_216"></a>props</h3> 
<table><thead><tr><th align="left">参数</th><th>说明</th><th align="center">类型</th><th align="center">可选值</th><th align="center">默认值</th></tr></thead><tbody><tr><td align="left">label</td><td>指定节点标签为节点对象的某个属性值</td><td align="center">string, function(data, node)</td><td align="center">—</td><td align="center">—</td></tr><tr><td align="left">children</td><td>指定节点标签为节点对象的某个属性值</td><td align="center">string</td><td align="center">—</td><td align="center">—</td></tr></tbody></table> 
<h3><a id="_Events_223"></a>## Events</h3> 
<table><thead><tr><th>事件名称</th><th>说明</th><th align="left">回调参数</th></tr></thead><tbody><tr><td>node-click</td><td>节点被点击时的回调</td><td align="left">共三个参数，依次为：传递给 data 属性的数组中该节点所对应的对象、节点对应的 Node、节点组件本身。</td></tr><tr><td>node-expand</td><td>节点被展开时触发的事件</td><td align="left">共三个参数，依次为：传递给 data 属性的数组中该节点所对应的对象、节点对应的 Node、节点组件本身</td></tr><tr><td>node-collapse</td><td>节点被关闭时触发的事件</td><td align="left">共三个参数，依次为：传递给 data 属性的数组中该节点所对应的对象、节点对应的 Node、节点组件本身</td></tr><tr><td>node-contextmenu</td><td>当某一节点被鼠标右键点击时会触发该事件</td><td align="left">共四个参数，依次为：event、传递给 data 属性的数组中该节点所对应的对象、节点对应的 Node、节点组件本身。</td></tr></tbody></table> 
<h3><a id="_234"></a>方法</h3> 
<table><thead><tr><th>方法名</th><th>说明</th><th align="left">回调参数</th></tr></thead><tbody><tr><td>filter</td><td>对树节点进行筛选操作</td><td align="left">接收一个任意类型的参数，该参数会在 filter-node-method 中作为第一个参数</td></tr><tr><td>getNode</td><td>根据 data 或者 key 拿到 Tree 组件中的 node,使用此方法必须设置 node-key 属性</td><td align="left">(data) 要获得 node 的 key 或者 data</td></tr><tr><td>setCurrentNode</td><td>通过 node 设置某个节点的当前选中状态，使用此方法必须设置 node-key 属性</td><td align="left">(node) 待被选节点的 node</td></tr><tr><td>setCurrentKey</td><td>通过 key 设置某个节点的当前选中状态，使用此方法必须设置 node-key 属性</td><td align="left">(key) 待被选节点的 key，若为 null 则取消当前高亮的节点</td></tr><tr><td>getCurrentKey</td><td>获取当前被选中节点的 key，使用此方法必须设置 node-key 属性，若没有节点被选中则返回 null</td><td align="left">—</td></tr><tr><td>getCurrentNode</td><td>获取当前被选中节点的 data，若没有节点被选中则返回 null</td><td align="left">—</td></tr><tr><td>remove</td><td>删除 Tree 中的一个节点，使用此方法必须设置 node-key 属性</td><td align="left">(data) 要删除的节点的 id 或者 data 或者 node</td></tr><tr><td>append</td><td>为 Tree 中的一个节点追加一个子节点</td><td align="left">(data, parentNode) 接收两个参数，1. 要追加的子节点的 data 2. 子节点的 parent 的 data、key 或者 node</td></tr><tr><td>insertBefore</td><td>为 Tree 的一个节点的前面增加一个节点</td><td align="left">(data, refNode) 接收两个参数，1. 要增加的节点的 data 2. 要增加的节点的后一个节点的 data、key 或者 node</td></tr><tr><td>insertAfter</td><td>为 Tree 的一个节点的后面增加一个节点</td><td align="left">(data, refNode) 接收两个参数，1. 要增加的节点的 data 2. 要增加的节点的前一个节点的 data、key 或者 node</td></tr></tbody></table> 
<h3><a id="_251"></a>浏览器支持情况</h3> 
<p>Modern browsers and Internet Explorer 10+.</p> 
<p>如果你觉得还不错的话，还请帮忙在 github 上给个 star，如果你觉得哪些需要优化的可以到 github 上提个 PR。</p> 
<p><strong>代码部署后可能存在的BUG没法实时知道，事后为了解决这些BUG，花了大量的时间进行log 调试，这边顺便给大家推荐一个好用的BUG监控工具 <a href="https://www.fundebug.com/?utm_source=xiaozhi" rel="nofollow">Fundebug</a>。</strong></p> 
<h3><a id="_262"></a>交流</h3> 
<p>文章每周持续更新，可以微信搜索「 大迁世界 」第一时间阅读和催更（比博客早一到两篇哟），本文 GitHub <a href="https://github.com/qq449245884/xiaozhi">https://github.com/qq449245884/xiaozhi</a> 已经收录，整理了很多我的文档，欢迎Star和完善，大家面试可以参照考点复习，另外关注公众号，后台回复<strong>福利</strong>，即可看到福利，你懂的。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/135cb31a9d256ddc2b78992487383a09/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">我用英语了结你的一生1</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/adfb017f693b8b644fdb09531c73f4c8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【ros学习】14.urdf、xacro机器人建模与rviz、gazebo仿真详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>