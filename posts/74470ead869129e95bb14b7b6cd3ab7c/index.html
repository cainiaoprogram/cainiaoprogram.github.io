<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>各红外线通信协议解码(通用型)【NEC、Sony SIRC、RC-5、RC-6、Samsung】 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="各红外线通信协议解码(通用型)【NEC、Sony SIRC、RC-5、RC-6、Samsung】" />
<meta property="og:description" content="文章目录 一、通信协议1. NEC2. Sony SIRC3. RC-5、RC-6、Samsung 二、数据抓取分析三、程序设计实现 红外线通信协议解码 是指将接收到的红外线信号转换为可理解的数字数据，以便对其进行进一步处理和操作的过程。红外线通信协议解码通常用于遥控器接收器等设备中。
在红外线通信中，遥控器发送器使用特定的红外线协议来编码命令和数据，并通过红外线发射器将这些信息转换为红外线信号。接收器捕获这些红外线信号，并通过解码过程将其还原为原始的命令和数据。
一、通信协议 1. NEC NEC红外协议是一种最常见的红外遥控协议，通常用于电视遥控器、空调遥控器等。NEC协议通过调制红外载频信号来表示数字信号。每个数字信号由9ms的起始位和4.5ms的起始位隔开，然后由16位地址码、16位数据码和8位反码构成。地址码用于区分不同的遥控器设备，数据码表示遥控器键值。接收设备在解码后，通过判断地址码和数据码来判断是哪个键被按下。
传输的数据帧格式为引导码 &#43; 8位用户码 &#43; 8位用户反码 &#43; 8位数据码 &#43; 8位数据反码
如下所示：
位定义：
在引导码之后，通过各位值去计算用户码与数据码，当检测到0.56ms的低电平&#43;0.56ms的高电平时记为该位为0，当检测到0.56ms的低电平&#43;1.68ms的高电平时记为该位为1。
由上可知：
引导码： 红外接收口(空闲时低电平)接收到上升沿的跳变，即9ms的上升沿随即4.5ms的低电平；32位数据： 每八位组成一个字节用于记录用户码与数据码 2. Sony SIRC Sony SIRC使用双向编码（又称曼彻斯特编码），使用40K载波对编码后的波形进行调制，位时间长度 1.2ms 或 0.6ms，有12 位，15 位和 20 位三个版本，这里介绍12位。
位定义： 1.2ms 的 40K 载波脉冲重现逻辑“1”，0.6ms 重现逻辑“0”。脉冲间隔均位 0.6ms。
数据帧格式：
（1） 帧定时基于600µS脉冲宽度T的倍数。
（2）帧以4T开始标记脉冲开始。
（3）帧中的每个位由1T空格表示，如果该位是“0”，则后跟1T标记；如果该位是“1”，则后跟2T标记
（4）若遥控器按键一直按下，命令码会每 45ms 重复发送一次。
3. RC-5、RC-6、Samsung RC-5红外协议也是一种常见的红外遥控协议，常用于DVD遥控器、音响遥控器等家电设备中。RC-5协议将每个红外信号分为两个连续的半周期。每个半周期由1.778ms的载频信号和1.778ms的无载频信号组成。一个完整的信号由13位二进制数据构成，其中1位为起始位，5位为地址码，6位为命令码，1位为反码。接收设备通过解码操作,根据地址码和命令码执行相应的功能。
RC-6红外协议是RC-5的升级版，具有更高的功能扩展性和更低的误码率。RC-6协议将红外信号延长到2.667ms的载频信号和2.667ms的无载频信号。一个完整的信号由20位二进制数据构成，其中1位为起始位，2位为系统码，5位为地址码，8位为命令码，1位为反码，3位为扩展码。接收设备在解码后，根据地址码和命令码进行区分和执行命令。
Samsung红外发射协议是一种红外通讯协议，常用于家电控制等领域。该协议使用38kHz的载波信号进行通讯，并采用了脉冲宽度编码(PulseWidth Modulation，PWM)技术。具体来说，每个数据位通过一系列的载波事件来表示，其中高电平载波事件表示0，低电平载波事件表示1。每个数据位的载波事件数量和载波事件持续时间的长短均不相同，这种编码方式可以有效地减少数据传输时的冗余信息，提高传输效率。在三星红外发射协议中，载波时间是指将38kHz载波信号分成若干个时间片段，每个时间片段的持续时间称为载波时间。具体来说，每个数据位由一组高低电平的载波事件组成，其中高电平载波事件表示0，低电平载波事件表示1。每个数据位的载波事件数量和载波事件持续时间的长短均不相同，但是每个时间片段的持续时间是固定的，通常为1.125ms或2.25ms。在使用三星红外发射协议进行通讯时，发送方需要按照协议规定的载波时间序列来发送数据，接收方则需要根据协议规定的载波时间序列来解码数据。
二、数据抓取分析 这里我抓取一种自定义红外传输协议数据，具体操作如下：
将红外发射器上电，持续发送数据 准备红外接收器，将示波器通道接上输出口，对准发射器，随机抓取一针数据分析 如下：
选取某一帧数据具体分析：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/74470ead869129e95bb14b7b6cd3ab7c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-09T21:20:43+08:00" />
<meta property="article:modified_time" content="2024-01-09T21:20:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">各红外线通信协议解码(通用型)【NEC、Sony SIRC、RC-5、RC-6、Samsung】</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_9" rel="nofollow">一、通信协议</a></li><li><ul><li><a href="#1_NEC_11" rel="nofollow">1. NEC</a></li><li><a href="#2_Sony_SIRC_26" rel="nofollow">2. Sony SIRC</a></li><li><a href="#3_RC5RC6Samsung_37" rel="nofollow">3. RC-5、RC-6、Samsung</a></li></ul> 
  </li><li><a href="#_45" rel="nofollow">二、数据抓取分析</a></li><li><a href="#_61" rel="nofollow">三、程序设计实现</a></li></ul> 
</div> 
<p></p> 
<hr> 
<p><strong>红外线通信协议解码</strong> 是指将接收到的红外线信号转换为可理解的数字数据，以便对其进行进一步处理和操作的过程。红外线通信协议解码通常用于遥控器接收器等设备中。</p> 
<p>在红外线通信中，遥控器发送器使用特定的红外线协议来编码命令和数据，并通过红外线发射器将这些信息转换为红外线信号。接收器捕获这些红外线信号，并通过解码过程将其还原为原始的命令和数据。</p> 
<h2><a id="_9"></a>一、通信协议</h2> 
<h3><a id="1_NEC_11"></a>1. NEC</h3> 
<p><strong>NEC</strong>红外协议是一种最常见的红外遥控协议，通常用于电视遥控器、空调遥控器等。NEC协议通过调制红外载频信号来表示数字信号。每个数字信号由9ms的起始位和4.5ms的起始位隔开，然后由16位地址码、16位数据码和8位反码构成。地址码用于区分不同的遥控器设备，数据码表示遥控器键值。接收设备在解码后，通过判断地址码和数据码来判断是哪个键被按下。</p> 
<p>传输的数据帧格式为<code>引导码 + 8位用户码 + 8位用户反码 + 8位数据码 + 8位数据反码</code><br> 如下所示：<br> <img src="https://images2.imgbox.com/82/15/Nzlm0wn2_o.png" alt="在这里插入图片描述"><br> 位定义：<br> <img src="https://images2.imgbox.com/30/c6/07mjSWrS_o.png" alt="在这里插入图片描述"><br> 在引导码之后，通过各位值去计算用户码与数据码，当检测到<code>0.56ms的低电平+0.56ms的高电平</code>时记为该位为0，当检测到<code>0.56ms的低电平+1.68ms的高电平</code>时记为该位为1。</p> 
<p>由上可知：</p> 
<ul><li><strong>引导码：</strong> 红外接收口(空闲时低电平)接收到上升沿的跳变，即9ms的上升沿随即4.5ms的低电平；</li><li><strong>32位数据：</strong> 每八位组成一个字节用于记录用户码与数据码</li></ul> 
<h3><a id="2_Sony_SIRC_26"></a>2. Sony SIRC</h3> 
<p><strong>Sony SIRC</strong>使用双向编码（又称曼彻斯特编码），使用40K载波对编码后的波形进行调制，位时间长度 1.2ms 或 0.6ms，有12 位，15 位和 20 位三个版本，这里介绍12位。</p> 
<p><strong>位定义：</strong> 1.2ms 的 40K 载波脉冲重现逻辑“1”，0.6ms 重现逻辑“0”。脉冲间隔均位 0.6ms。</p> 
<p>数据帧格式：<br> （1） 帧定时基于600µS脉冲宽度T的倍数。<br> （2）帧以4T开始标记脉冲开始。<br> （3）帧中的每个位由1T空格表示，如果该位是“0”，则后跟1T标记；如果该位是“1”，则后跟2T标记<br> （4）若遥控器按键一直按下，命令码会每 45ms 重复发送一次。<br> <img src="https://images2.imgbox.com/05/69/cPPVi5qI_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_RC5RC6Samsung_37"></a>3. RC-5、RC-6、Samsung</h3> 
<p><strong>RC-5</strong>红外协议也是一种常见的红外遥控协议，常用于DVD遥控器、音响遥控器等家电设备中。RC-5协议将每个红外信号分为两个连续的半周期。每个半周期由1.778ms的载频信号和1.778ms的无载频信号组成。一个完整的信号由13位二进制数据构成，其中1位为起始位，5位为地址码，6位为命令码，1位为反码。接收设备通过解码操作,根据地址码和命令码执行相应的功能。</p> 
<p><strong>RC-6</strong>红外协议是RC-5的升级版，具有更高的功能扩展性和更低的误码率。RC-6协议将红外信号延长到2.667ms的载频信号和2.667ms的无载频信号。一个完整的信号由20位二进制数据构成，其中1位为起始位，2位为系统码，5位为地址码，8位为命令码，1位为反码，3位为扩展码。接收设备在解码后，根据地址码和命令码进行区分和执行命令。</p> 
<p><strong>Samsung</strong>红外发射协议是一种红外通讯协议，常用于家电控制等领域。该协议使用38kHz的载波信号进行通讯，并采用了脉冲宽度编码(PulseWidth Modulation，PWM)技术。具体来说，每个数据位通过一系列的载波事件来表示，其中高电平载波事件表示0，低电平载波事件表示1。每个数据位的载波事件数量和载波事件持续时间的长短均不相同，这种编码方式可以有效地减少数据传输时的冗余信息，提高传输效率。在三星红外发射协议中，载波时间是指将38kHz载波信号分成若干个时间片段，每个时间片段的持续时间称为载波时间。具体来说，每个数据位由一组高低电平的载波事件组成，其中高电平载波事件表示0，低电平载波事件表示1。每个数据位的载波事件数量和载波事件持续时间的长短均不相同，但是每个时间片段的持续时间是固定的，通常为1.125ms或2.25ms。在使用三星红外发射协议进行通讯时，发送方需要按照协议规定的载波时间序列来发送数据，接收方则需要根据协议规定的载波时间序列来解码数据。</p> 
<h2><a id="_45"></a>二、数据抓取分析</h2> 
<p>这里我抓取一种自定义红外传输协议数据，具体操作如下：</p> 
<ul><li> 
  <ol><li>将红外发射器上电，持续发送数据</li></ol> </li><li> 
  <ol start="2"><li>准备红外接收器，将示波器通道接上输出口，对准发射器，随机抓取一针数据分析</li></ol> </li></ul> 
<p>如下：<br> <img src="https://images2.imgbox.com/b4/8a/TovkLEOW_o.png" alt="在这里插入图片描述"><br> 选取某一帧数据具体分析：<br> <img src="https://images2.imgbox.com/34/97/mgwSFYvq_o.png" alt="在这里插入图片描述"><br> 我直接将我的分析结果写出来，大家可自行分析哈：</p> 
<ul><li><strong>引导位：</strong> 2.8ms的低电平突变<br> <img src="https://images2.imgbox.com/b9/24/eTmgB2eO_o.png" alt="在这里插入图片描述"></li><li><strong>数据位：</strong> 八位数据。其中位定义 我以<code>0.56ms高电平+0.56ms低电平为数据0</code>，<code>0.56ms高电平+1.68ms低电平为数据1</code><br> <img src="https://images2.imgbox.com/2a/60/0wwflzBP_o.png" alt="在这里插入图片描述"></li><li><strong>结束位：</strong> <code>2.8ms高电平+2.8ms低电平</code><br> <img src="https://images2.imgbox.com/0e/e8/IynCEytC_o.png" alt="在这里插入图片描述"></li></ul> 
<h2><a id="_61"></a>三、程序设计实现</h2> 
<p>这里我用<strong>外部中断</strong>去检测信号突变，<strong>定时器</strong>去计算电平持续时间。</p> 
<p>具体如下：<br> <strong>1. 外部中断初始化</strong></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">IR_PIN</span>    <span class="token expression"><span class="token function">GET_PIN</span><span class="token punctuation">(</span>E<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span></span></span>

<span class="token function">rt_pin_mode</span><span class="token punctuation">(</span>IR_PIN<span class="token punctuation">,</span> PIN_MODE_INPUT_PULLUP<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">rt_pin_attach_irq</span><span class="token punctuation">(</span>IR_PIN<span class="token punctuation">,</span> PIN_IRQ_MODE_FALLING <span class="token punctuation">,</span> External_IR<span class="token punctuation">,</span> RT_NULL<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* 绑定中断，下降沿模式，回调函数名为External_IR */</span>
<span class="token function">rt_pin_irq_enable</span><span class="token punctuation">(</span>IR_PIN<span class="token punctuation">,</span> PIN_IRQ_ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* 使能中断 */</span>
</code></pre> 
<p><strong>2. 定时器初始化</strong></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BSP_USING_TIM</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">BSP_USING_TIM</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">BSP_USING_TIM3</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">HWTIMER_DEV_NAME</span>   <span class="token string">"timer3"</span>     <span class="token comment">/* 定时器名称 */</span></span>
<span class="token class-name">rt_hwtimerval_t</span> timeout_s<span class="token punctuation">;</span>      <span class="token comment">/* 定时器超时值 */</span>
<span class="token class-name">rt_device_t</span> hw_dev <span class="token operator">=</span> RT_NULL<span class="token punctuation">;</span>   <span class="token comment">/* 定时器设备句柄 */</span>
<span class="token class-name">rt_hwtimer_mode_t</span> mode<span class="token punctuation">;</span>         <span class="token comment">/* 定时器模式 */</span>
<span class="token class-name">rt_uint32_t</span> freq <span class="token operator">=</span> <span class="token number">1000000</span><span class="token punctuation">;</span>               <span class="token comment">/* 计数频率 */</span>

<span class="token keyword">void</span> <span class="token function">Timer_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">/* 查找定时器设备 */</span>
    hw_dev <span class="token operator">=</span> <span class="token function">rt_device_find</span><span class="token punctuation">(</span>HWTIMER_DEV_NAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hw_dev <span class="token operator">==</span> RT_NULL<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token function">rt_kprintf</span><span class="token punctuation">(</span><span class="token string">"hwtimer sample run failed! can't find %s device!\n"</span><span class="token punctuation">,</span> HWTIMER_DEV_NAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* 以读写方式打开设备 */</span>
    ret <span class="token operator">=</span> <span class="token function">rt_device_open</span><span class="token punctuation">(</span>hw_dev<span class="token punctuation">,</span> RT_DEVICE_OFLAG_RDWR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">!=</span> RT_EOK<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token function">rt_kprintf</span><span class="token punctuation">(</span><span class="token string">"open %s device failed!\n"</span><span class="token punctuation">,</span> HWTIMER_DEV_NAME<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* 设置超时回调函数 */</span>
    <span class="token function">rt_device_set_rx_indicate</span><span class="token punctuation">(</span>hw_dev<span class="token punctuation">,</span> timeout_cb<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">/* 设置计数频率(若未设置该项，默认为1Mhz 或 支持的最小计数频率) */</span>
    <span class="token function">rt_device_control</span><span class="token punctuation">(</span>hw_dev<span class="token punctuation">,</span> HWTIMER_CTRL_FREQ_SET<span class="token punctuation">,</span> <span class="token operator">&amp;</span>freq<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* 设置模式为周期性定时器（若未设置，默认是HWTIMER_MODE_ONESHOT）*/</span>
    mode <span class="token operator">=</span> HWTIMER_MODE_PERIOD<span class="token punctuation">;</span>
    ret <span class="token operator">=</span> <span class="token function">rt_device_control</span><span class="token punctuation">(</span>hw_dev<span class="token punctuation">,</span> HWTIMER_CTRL_MODE_SET<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ret <span class="token operator">!=</span> RT_EOK<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
      <span class="token function">rt_kprintf</span><span class="token punctuation">(</span><span class="token string">"set mode failed! ret is :%d\n"</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/* 设置定时器超时值为5s并启动定时器 */</span>
    timeout_s<span class="token punctuation">.</span>sec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token comment">/* 秒 */</span>
    timeout_s<span class="token punctuation">.</span>usec <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>     <span class="token comment">/* 微秒 */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">rt_device_write</span><span class="token punctuation">(</span>hw_dev<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>timeout_s<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>timeout_s<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>timeout_s<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">rt_kprintf</span><span class="token punctuation">(</span><span class="token string">"set timeout value failed\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 定时器超时回调函数 */</span>
<span class="token class-name">rt_err_t</span> <span class="token function">timeout_cb</span><span class="token punctuation">(</span><span class="token class-name">rt_device_t</span> dev<span class="token punctuation">,</span> <span class="token class-name">rt_size_t</span> size<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    n<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>3. 获取电平持续时间</strong></p> 
<pre><code class="prism language-c"><span class="token keyword">int</span> <span class="token function">get_H_Value</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    n<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">rt_pin_read</span><span class="token punctuation">(</span>IR_PIN<span class="token punctuation">)</span><span class="token operator">==</span>RESET<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">get_L_Value</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    n<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">rt_pin_read</span><span class="token punctuation">(</span>IR_PIN<span class="token punctuation">)</span><span class="token operator">==</span>SET<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> n<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>4. 解码</strong></p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">External_IR</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>args<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    m<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token class-name">rt_uint32_t</span> time<span class="token punctuation">;</span>
    <span class="token class-name">rt_uint8_t</span> j<span class="token punctuation">,</span>data<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

    time<span class="token operator">=</span><span class="token function">get_L_Value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>time<span class="token operator">&lt;</span><span class="token number">265</span><span class="token operator">||</span>time<span class="token operator">&gt;</span><span class="token number">300</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span><span class="token punctuation">(</span>j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">8</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
         time<span class="token operator">=</span><span class="token function">get_H_Value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">//得到低电平时间</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>time<span class="token operator">&lt;</span><span class="token number">40</span><span class="token operator">||</span>time<span class="token operator">&gt;</span><span class="token number">70</span><span class="token punctuation">)</span><span class="token keyword">return</span><span class="token punctuation">;</span>    <span class="token comment">//标准时间: 560us</span>

         time<span class="token operator">=</span><span class="token function">get_L_Value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">//得到高电平时间</span>
         <span class="token keyword">if</span><span class="token punctuation">(</span>time<span class="token operator">&gt;</span><span class="token number">150</span><span class="token operator">&amp;&amp;</span>time<span class="token operator">&lt;</span><span class="token number">180</span><span class="token punctuation">)</span>         <span class="token comment">//数据1 1680us</span>
         <span class="token punctuation">{<!-- --></span>
            data<span class="token operator">&gt;&gt;=</span><span class="token number">1</span><span class="token punctuation">;</span>
            data<span class="token operator">|=</span><span class="token number">0x80</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>time<span class="token operator">&gt;</span><span class="token number">40</span><span class="token operator">&amp;&amp;</span>time<span class="token operator">&lt;</span><span class="token number">70</span><span class="token punctuation">)</span>     <span class="token comment">//数据0 560us</span>
         <span class="token punctuation">{<!-- --></span>
            data<span class="token operator">&gt;&gt;=</span><span class="token number">1</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">else</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
         InfraredRecvData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>data<span class="token punctuation">;</span> <span class="token comment">//存放解码成功的值</span>
    <span class="token punctuation">}</span>
      <span class="token comment">//解码成功</span>
    InfraredRecvState<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>5. main.c</strong></p> 
<pre><code class="prism language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">oled_func</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">rt_pin_mode</span><span class="token punctuation">(</span>IR_PIN<span class="token punctuation">,</span> PIN_MODE_INPUT_PULLUP<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">rt_pin_attach_irq</span><span class="token punctuation">(</span>IR_PIN<span class="token punctuation">,</span> PIN_IRQ_MODE_FALLING <span class="token punctuation">,</span> External_IR<span class="token punctuation">,</span> RT_NULL<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* 绑定中断，上升沿模式，回调函数名为External_IR */</span>
    <span class="token function">rt_pin_irq_enable</span><span class="token punctuation">(</span>IR_PIN<span class="token punctuation">,</span> PIN_IRQ_ENABLE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">/* 使能中断 */</span>
    <span class="token function">uart2_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Timer_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">rt_device_write</span><span class="token punctuation">(</span>serial<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>InfraredRecvData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">rt_thread_mdelay</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>InfraredRecvState<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            InfraredRecvState<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token function">rt_device_write</span><span class="token punctuation">(</span>serial<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>InfraredRecvData<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">rt_thread_mdelay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> RT_EOK<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/17/b9/ywj0GqPQ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/13/88/KtEnHteA_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7353254df796ff512a08d8f6ab259fc2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Python实战】一个星期练完这30个精心整理的Python项目案例，成功逆袭：靠接单月入W＋轻轻松松，拿走就用~（大家冲鸭）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ff4a6bac92bf35afc6ae44e0e39b75d4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">NE555学习笔记-2024</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>