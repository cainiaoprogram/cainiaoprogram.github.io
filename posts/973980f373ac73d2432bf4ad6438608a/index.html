<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用python操作mysql数据库 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用python操作mysql数据库" />
<meta property="og:description" content="PyMySQL的安装 python3:pip install Pymysql
python连接数据库 一：
import pymysql db = pymysql.connect(&#34;数据库ip&#34;,&#34;用户&#34;,&#34;密码&#34;,&#34;数据库&#34; ) # 打开数据库连接 cursor.execute(&#34;SELECT VERSION()&#34;) # 使用 execute() 方法执行 SQL 查询 data = cursor.fetchone() # 使用 fetchone() 方法获取单条数据 print (&#34;Database version : %s &#34; % data) db.close() 二：
import pymysql
#打开数据库连接 主机地址 端口号3306 用户名 密码 数据库名
db = pymysql.Connect(host=&#34;localhost&#34;,port=3306,user=&#34;root&#34;,password=&#34;wzc27229&#34;,db=&#34;test&#34;,charset=&#34;utf-8&#34;) #创建一个游标对象
cursor=db.cursor()
print(db)
更多参数：
import pymysql conn = pymysql.connect( host=&#39;localhost&#39;, user=&#39;root&#39;, password=&#34;root&#34;, database=&#39;db&#39;, port=3306, charset=&#39;utf-8&#39;, ) cur = conn.cursor(cursor=pymysql.cursors.DictCursor) 创建表操作 import pymysql # 打开数据库连接 db = pymysql." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/973980f373ac73d2432bf4ad6438608a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-07-31T16:33:00+08:00" />
<meta property="article:modified_time" content="2019-07-31T16:33:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用python操作mysql数据库</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body"> 
 <h4>PyMySQL的安装</h4> 
 <p>python3:pip install Pymysql</p> 
 <h4>python连接数据库</h4> 
 <p>一：</p> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#000000;">import pymysql

db </span>= pymysql.connect(<span style="color:#800000;">"</span><span style="color:#800000;">数据库ip</span><span style="color:#800000;">"</span>,<span style="color:#800000;">"</span><span style="color:#800000;">用户</span><span style="color:#800000;">"</span>,<span style="color:#800000;">"</span><span style="color:#800000;">密码</span><span style="color:#800000;">"</span>,<span style="color:#800000;">"</span><span style="color:#800000;">数据库</span><span style="color:#800000;">"</span><span style="color:#000000;"> ) # 打开数据库连接
cursor.execute(</span><span style="color:#800000;">"</span><span style="color:#800000;">SELECT VERSION()</span><span style="color:#800000;">"</span><span style="color:#000000;">)                    # 使用 execute() 方法执行 SQL 查询
data </span>=<span style="color:#000000;"> cursor.fetchone()                              # 使用 fetchone() 方法获取单条数据
print (</span><span style="color:#800000;">"</span><span style="color:#800000;">Database version : %s </span><span style="color:#800000;">"</span> %<span style="color:#000000;"> data)
db.close() </span></pre> 
 </div> 
 <p>二：</p> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#000000;">import pymysql<br>#打开数据库连接 主机地址 端口号3306 用户名 密码 数据库名</span><span style="color:#000000;"><br>db = pymysql.Connect(host="localhost",port=3306,user="root",password="wzc27229",db="test",charset="utf-8")
</span><span style="color:#000000;">#创建一个游标对象<br>cursor=db.cursor()<br>print(db)<br></span></pre> 
 </div> 
 <p>更多参数：</p> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#000000;">import pymysql

conn </span>=<span style="color:#000000;"> pymysql.connect(
        host</span>=<span style="color:#800000;">'</span><span style="color:#800000;">localhost</span><span style="color:#800000;">'</span>, user=<span style="color:#800000;">'</span><span style="color:#800000;">root</span><span style="color:#800000;">'</span>, password=<span style="color:#800000;">"</span><span style="color:#800000;">root</span><span style="color:#800000;">"</span><span style="color:#000000;">,
        database</span>=<span style="color:#800000;">'</span><span style="color:#800000;">db</span><span style="color:#800000;">'</span>, port=<span style="color:#800080;">3306</span>, charset=<span style="color:#800000;">'</span><span style="color:#800000;">utf-8</span><span style="color:#800000;">'</span><span style="color:#000000;">,
)

cur </span>= conn.cursor(cursor=pymysql.cursors.DictCursor)</pre> 
 </div> 
 <h3>创建表操作</h3> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#000000;">import pymysql
 
# 打开数据库连接
db </span>= pymysql.connect(<span style="color:#800000;">"</span><span style="color:#800000;">localhost</span><span style="color:#800000;">"</span>,<span style="color:#800000;">"</span><span style="color:#800000;">testuser</span><span style="color:#800000;">"</span>,<span style="color:#800000;">"</span><span style="color:#800000;">test123</span><span style="color:#800000;">"</span>,<span style="color:#800000;">"</span><span style="color:#800000;">TESTDB</span><span style="color:#800000;">"</span><span style="color:#000000;"> )
 
# 使用 cursor() 方法创建一个游标对象 cursor
cursor </span>=<span style="color:#000000;"> db.cursor()
 
# 使用 execute() 方法执行 SQL，如果表存在则删除
cursor.execute(</span><span style="color:#800000;">"</span><span style="color:#800000;">DROP TABLE IF EXISTS EMPLOYEE</span><span style="color:#800000;">"</span><span style="color:#000000;">)
 
# 使用预处理语句创建表
sql </span>= <span style="color:#800000;">"""</span><span style="color:#800000;">CREATE TABLE EMPLOYEE (</span>
         FIRST_NAME  CHAR(<span style="color:#800080;">20</span><span style="color:#000000;">) NOT NULL,
         LAST_NAME  CHAR(</span><span style="color:#800080;">20</span><span style="color:#000000;">),
         AGE INT,  
         SEX CHAR(</span><span style="color:#800080;">1</span><span style="color:#000000;">),
         INCOME FLOAT )</span><span style="color:#800000;">"""
</span><span style="color:#000000;"> 
cursor.execute(sql)
 
# 关闭数据库连接
db.close()</span></pre> 
 </div> 
 <h3>操作数据</h3> 
 <h4>插入操作</h4> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#000000;">import pymysql
 
# 打开数据库连接
db </span>= pymysql.connect(<span style="color:#800000;">"</span><span style="color:#800000;">localhost</span><span style="color:#800000;">"</span>,<span style="color:#800000;">"</span><span style="color:#800000;">testuser</span><span style="color:#800000;">"</span>,<span style="color:#800000;">"</span><span style="color:#800000;">test123</span><span style="color:#800000;">"</span>,<span style="color:#800000;">"</span><span style="color:#800000;">TESTDB</span><span style="color:#800000;">"</span><span style="color:#000000;"> )
 
# 使用cursor()方法获取操作游标 
cursor </span>=<span style="color:#000000;"> db.cursor()
 
# SQL 插入语句
sql </span>= <span style="color:#800000;">"""</span><span style="color:#800000;">INSERT INTO EMPLOYEE(FIRST_NAME,</span>
<span style="color:#000000;">         LAST_NAME, AGE, SEX, INCOME)
         VALUES (</span><span style="color:#800000;">'</span><span style="color:#800000;">Mac</span><span style="color:#800000;">'</span>, <span style="color:#800000;">'</span><span style="color:#800000;">Mohan</span><span style="color:#800000;">'</span>, <span style="color:#800080;">20</span>, <span style="color:#800000;">'</span><span style="color:#800000;">M</span><span style="color:#800000;">'</span>, <span style="color:#800080;">2000</span>)<span style="color:#800000;">"""
</span><span style="color:#0000ff;">try</span><span style="color:#000000;">:
   cursor.execute(sql) # 执行sql语句
   db.commit()         # 提交到数据库执行
except:
   db.rollback()       # 如果发生错误则回滚
 
# 关闭数据库连接
db.close()</span></pre> 
 </div> 
 <h4>查询操作</h4> 
 <p>Python查询Mysql使用 fetchone() 方法获取单条数据, 使用fetchall() 方法获取多条数据。</p> 
 <ul><li><strong>fetchone():</strong> 该方法获取下一个查询结果集。结果集是一个对象</li><li><strong>fetchall(): </strong>接收全部的返回结果行.</li><li><strong>rowcount:</strong> 这是一个只读属性，并返回执行execute()方法后影响的行数。</li></ul> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#000000;">import pymysql
 
# 打开数据库连接
db </span>= pymysql.connect(<span style="color:#800000;">"</span><span style="color:#800000;">localhost</span><span style="color:#800000;">"</span>,<span style="color:#800000;">"</span><span style="color:#800000;">testuser</span><span style="color:#800000;">"</span>,<span style="color:#800000;">"</span><span style="color:#800000;">test123</span><span style="color:#800000;">"</span>,<span style="color:#800000;">"</span><span style="color:#800000;">TESTDB</span><span style="color:#800000;">"</span><span style="color:#000000;"> )
 
# 使用cursor()方法获取操作游标 
cursor </span>=<span style="color:#000000;"> db.cursor()
 
# SQL 查询语句
sql </span>= <span style="color:#800000;">"</span><span style="color:#800000;">SELECT * FROM EMPLOYEE \</span>
       WHERE INCOME &gt; %s<span style="color:#800000;">"</span><span style="color:#800000;"> % (1000)</span>
<span style="color:#0000ff;">try</span><span style="color:#000000;">:
   
   cursor.execute(sql)# 执行SQL语句
   results </span>=<span style="color:#000000;"> cursor.fetchall()# 获取所有记录列表
   </span><span style="color:#0000ff;">for</span> row <span style="color:#0000ff;">in</span><span style="color:#000000;"> results:
      fname </span>= row[<span style="color:#800080;">0</span><span style="color:#000000;">]
      lname </span>= row[<span style="color:#800080;">1</span><span style="color:#000000;">]
      age </span>= row[<span style="color:#800080;">2</span><span style="color:#000000;">]
      sex </span>= row[<span style="color:#800080;">3</span><span style="color:#000000;">]
      income </span>= row[<span style="color:#800080;">4</span><span style="color:#000000;">]
       # 打印结果
      print (</span><span style="color:#800000;">"</span><span style="color:#800000;">fname=%s,lname=%s,age=%s,sex=%s,income=%s</span><span style="color:#800000;">"</span> %<span style="color:#000000;"> \
             (fname, lname, age, sex, income ))
except:
   print (</span><span style="color:#800000;">"</span><span style="color:#800000;">Error: unable to fetch data</span><span style="color:#800000;">"</span><span style="color:#000000;">)
 
# 关闭数据库连接
db.close()</span></pre> 
 </div> 
 <h4>更新操作</h4> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#000000;">import pymysql
 
# 打开数据库连接
db </span>= pymysql.connect(<span style="color:#800000;">"</span><span style="color:#800000;">localhost</span><span style="color:#800000;">"</span>,<span style="color:#800000;">"</span><span style="color:#800000;">testuser</span><span style="color:#800000;">"</span>,<span style="color:#800000;">"</span><span style="color:#800000;">test123</span><span style="color:#800000;">"</span>,<span style="color:#800000;">"</span><span style="color:#800000;">TESTDB</span><span style="color:#800000;">"</span><span style="color:#000000;"> )
 
# 使用cursor()方法获取操作游标 
cursor </span>=<span style="color:#000000;"> db.cursor()
 
# SQL 更新语句
sql </span>= <span style="color:#800000;">"</span><span style="color:#800000;">UPDATE EMPLOYEE SET AGE = AGE + 1 WHERE SEX = '%c'</span><span style="color:#800000;">"</span> % (<span style="color:#800000;">'</span><span style="color:#800000;">M</span><span style="color:#800000;">'</span><span style="color:#000000;">)
</span><span style="color:#0000ff;">try</span><span style="color:#000000;">:
   cursor.execute(sql)  # 执行SQL语句
   db.commit()          # 提交到数据库执行
except
   db.rollback()        # 发生错误时回滚
 
# 关闭数据库连接
db.close()</span></pre> 
 </div> 
 <h4>删除操作</h4> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#000000;">import pymysql
 
# 打开数据库连接
db </span>= pymysql.connect(<span style="color:#800000;">"</span><span style="color:#800000;">localhost</span><span style="color:#800000;">"</span>,<span style="color:#800000;">"</span><span style="color:#800000;">testuser</span><span style="color:#800000;">"</span>,<span style="color:#800000;">"</span><span style="color:#800000;">test123</span><span style="color:#800000;">"</span>,<span style="color:#800000;">"</span><span style="color:#800000;">TESTDB</span><span style="color:#800000;">"</span><span style="color:#000000;"> )
 
# 使用cursor()方法获取操作游标 
cursor </span>=<span style="color:#000000;"> db.cursor()
 
# SQL 删除语句
sql </span>= <span style="color:#800000;">"</span><span style="color:#800000;">DELETE FROM EMPLOYEE WHERE AGE &gt; %s</span><span style="color:#800000;">"</span> % (<span style="color:#800080;">20</span><span style="color:#000000;">)
</span><span style="color:#0000ff;">try</span><span style="color:#000000;">
   cursor.execute(sql)  # 执行SQL语句
   db.commit()          # 提交修改
except
   db.rollback()        # 发生错误时回滚# 关闭连接
db.close()</span></pre> 
 </div> 
 <h3>数据备份</h3> 
 <h5>数据库的逻辑备份（adb中执行也可以）</h5> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#000000;">#语法：
# mysqldump </span>-h 服务器 -u用户名 -p密码 数据库名 &gt;<span style="color:#000000;"> 备份文件.sql

#示例：
#单库备份
mysqldump </span>-uroot -p123 db1 &gt;<span style="color:#000000;"> db1.sql
mysqldump </span>-uroot -p123 db1 table1 table2 &gt; db1-table1-<span style="color:#000000;">table2.sql

#多库备份
mysqldump </span>-uroot -p123 --databases db1 db2 mysql db3 &gt;<span style="color:#000000;"> db1_db2_mysql_db3.sql

#备份所有库
mysqldump </span>-uroot -p123 --all-databases &gt; all.sql </pre> 
 </div> 
 <h5>数据恢复</h5> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#000000;">#方法一：
[root@egon backup]# mysql </span>-uroot -p123 &lt; /backup/<span style="color:#000000;">all.sql

#方法二：
mysql</span>&gt;<span style="color:#000000;"> use db1;
mysql</span>&gt; SET SQL_LOG_BIN=<span style="color:#800080;">0</span><span style="color:#000000;">;   #关闭二进制日志，只对当前session生效
mysql</span>&gt; source /root/db1.sql</pre> 
 </div> 
 <h3>事务和锁</h3> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#000000;">begin;  # 开启事务
</span><span style="color:#0000ff;">select</span> * <span style="color:#0000ff;">from</span> emp <span style="color:#0000ff;">where</span> id = <span style="color:#800080;">1</span> <span style="color:#0000ff;">for</span> update;  # 查询id值，<span style="color:#0000ff;">for</span><span style="color:#000000;"> update添加行锁；
update emp </span><span style="color:#0000ff;">set</span> salary=<span style="color:#800080;">10000</span> <span style="color:#0000ff;">where</span> id = <span style="color:#800080;">1</span><span style="color:#000000;">; # 完成更新
commit; # 提交事务</span></pre> 
 </div> 
 <p> </p> 
</div> 
<p>转载于:https://www.cnblogs.com/wzc27229/p/11277295.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/78f469ff7307e923c08c5dc8d4396785/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">我的小车调试进度之：实现超声波测距并显示</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c1207ed375b49a9c593ddfbafe0cebf7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">CBAM: Convolutional Block Attention Module—— channel attention &#43; spatial attention</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>