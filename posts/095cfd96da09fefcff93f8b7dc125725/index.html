<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CentOS基础系列五 ：搭建FTP服务（详细图解） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="CentOS基础系列五 ：搭建FTP服务（详细图解）" />
<meta property="og:description" content="一、FTP服务介绍 FTP ( File Transfer Protocol，文件传输服务）服务是一种专门用于文件传输的服务，该服务使用的是文件传输协议，使用该服务将极大地方便文件的传输与管理。其最主要的功能是在服务器端与客户端之间进行文件的传输。FTP是以TCP封包的模式来进行服务器与客户端之间的连接的，当连接建立后，用户便可以在客户端连接FTP服务器来进行文件的上传与下载，同时也可以直接管理用户在FTP服务器上的文件。
1. 工作原理
FTP是基于客户端/服务器模式的，其工作原理如下
（1）客户端向服务器发出连接请求，同时客户端系统动态打开一个大于1024的端口（比如 2888 ）等候服务器连接。
（2）当FTP服务器在端口21侦听到该请求后，会在客户端1031端口和服务器的21端口之间建立起一个FTP会话连接。
（3）要传输数据时，FTP客户端再动态打开一个大于1024的端口（比如2889）连接到服务器的20端口，并在这两个端口之间进行数据的传输。
（4）数据传输完毕后，FTP客户端将断开与FTP服务器的连接，客户端上动态分配的端口将自动释放掉。
二、安装FTP服务 在使用ftp服务之前一定要记得关闭防火墙和selinux
[root@centos7-108 etc]# systemctl stop firewalld [root@centos7-108 etc]# setenforce 0 setenforce: SELinux is disabled 1. 安装ftp软件包
[root@centos8-106 home]# rpm -qa | grep vsftpd vsftpd-3.0.3-32.el8.x86_64 若没有发现则没有安装软件包，此时我们使用yum安装软件包
sudo 表示已管理员的身份执行
[rion@centos7-108 ~]# yum install vsftpd -y 2. FTP服务启动
systemctl start vsftpd.service 3. FTP开机启动
systemctl enable vsftpd.service 三、FTP配置文件 1. 配置文件介绍 [root@centos7-108 ~]# tree /etc/vsftpd/ /etc/vsftpd/ ├── ftpusers	# 所有位于此文件内的用户都不能访问vsFTPd服务。 ├── user_list	# ftp 用户名单，可以设置白名单或黑名单 ├── vsftpd." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/095cfd96da09fefcff93f8b7dc125725/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-22T19:34:27+08:00" />
<meta property="article:modified_time" content="2021-04-22T19:34:27+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">CentOS基础系列五 ：搭建FTP服务（详细图解）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="FTP_0"></a>一、FTP服务介绍</h2> 
<p>FTP ( File Transfer Protocol，文件传输服务）服务是一种专门用于文件传输的服务，该服务使用的是文件传输协议，使用该服务将极大地方便文件的传输与管理。其最主要的功能是在服务器端与客户端之间进行文件的传输。FTP是以TCP封包的模式来进行服务器与客户端之间的连接的，当连接建立后，用户便可以在客户端连接FTP服务器来进行文件的上传与下载，同时也可以直接管理用户在FTP服务器上的文件。</p> 
<p><strong>1. 工作原理</strong><br> FTP是基于客户端/服务器模式的，其工作原理如下<br> （1）客户端向服务器发出连接请求，同时客户端系统动态打开一个大于1024的端口（比如 2888 ）等候服务器连接。<br> <img src="https://images2.imgbox.com/19/77/vMxnCoVV_o.png" alt="在这里插入图片描述"><br> （2）当FTP服务器在端口21侦听到该请求后，会在客户端1031端口和服务器的21端口之间建立起一个FTP会话连接。<br> <img src="https://images2.imgbox.com/ad/84/Q6QkzTe4_o.png" alt="在这里插入图片描述"><br> （3）要传输数据时，FTP客户端再动态打开一个大于1024的端口（比如2889）连接到服务器的20端口，并在这两个端口之间进行数据的传输。<br> <img src="https://images2.imgbox.com/02/1d/Isfe1naK_o.png" alt="在这里插入图片描述"><br> （4）数据传输完毕后，FTP客户端将断开与FTP服务器的连接，客户端上动态分配的端口将自动释放掉。</p> 
<h2><a id="FTP_13"></a>二、安装FTP服务</h2> 
<p>在使用ftp服务之前一定要记得关闭<code>防火墙</code>和<code>selinux</code></p> 
<pre><code>[root@centos7-108 etc]# systemctl stop firewalld
[root@centos7-108 etc]# setenforce 0
setenforce: SELinux is disabled
</code></pre> 
<p><strong>1. 安装ftp软件包</strong></p> 
<pre><code>[root@centos8-106 home]# rpm -qa | grep vsftpd
vsftpd-3.0.3-32.el8.x86_64
</code></pre> 
<p>若没有发现则没有安装软件包，此时我们使用yum安装软件包<br> sudo 表示已管理员的身份执行</p> 
<pre><code>[rion@centos7-108 ~]# yum install vsftpd -y
</code></pre> 
<p><strong>2. FTP服务启动</strong></p> 
<pre><code>systemctl start vsftpd.service
</code></pre> 
<p><strong>3. FTP开机启动</strong></p> 
<pre><code>systemctl enable vsftpd.service
</code></pre> 
<h2><a id="FTP_39"></a>三、FTP配置文件</h2> 
<h3><a id="1__40"></a>1. 配置文件介绍</h3> 
<pre><code>[root@centos7-108 ~]# tree /etc/vsftpd/
/etc/vsftpd/
├── ftpusers						# 所有位于此文件内的用户都不能访问vsFTPd服务。
├── user_list						# ftp 用户名单，可以设置白名单或黑名单
├── vsftpd.conf						# ftp配置文件
└── vsftpd_conf_migrate.sh	

/etc/pam.d/vsftpd		
# vsFTPd的The Pluggable Authentication Module配置文件，它主要用来加强vsFTPd服务器的用户认证。

</code></pre> 
<p>先备份原来的vsftpd配置文件，然后去掉里面的注释行，剩下的就是默认配置</p> 
<pre><code>[root@centos7-108 ~]# cd /etc/vsftpd/
[root@centos7-108 vsftpd]# cp vsftpd.conf vsftpd.conf.bak
[root@centos7-108 vsftpd]# grep -v "#" vsftpd.conf.bak &gt; vsftpd.conf
[root@centos7-108 vsftpd]# cat vsftpd.conf
anonymous_enable=YES			# 匿名用户是否运行登录
local_enable=YES				# 允许本地用户登录 FTP
write_enable=YES				# 运行用户在 FTP 目录有写入的权限
local_umask=022					# 设置本地用户的文件生成掩码为 022， 默认是 077
dirmessage_enable=YES			# 激活目录信息,当远程用户更改目录时,将出现提示信息
xferlog_enable=YES				# 启用上传和下载日志功能
connect_from_port_20=YES		# 启用 FTP 数据端口的连接请求
xferlog_std_format=YES			# 是否使用标准的 ftpd xferlog 日志文件格式
listen=NO					    # 使 vsftpd 处于独立启动监听端口模式
listen_ipv6=YES

pam_service_name=vsftpd			# 设置PAM认证服务配置文件名称， 文件存放在/etc/pam.d/目录
userlist_enable=YES				# 用户列表中的用户是否允许登录 FTP 服务器,默认是不允许
tcp_wrappers=YES				# 户列表中的用户是否允许登录 FTP 服务器,默认是不允许
[root@centos7-108 vsftpd]# 
</code></pre> 
<h3><a id="2__76"></a>2. 实现匿名登录管理</h3> 
<p><strong>匿名用户登录</strong><br> 查看ftp配置文件<code>/etc/vsftpd/vsftpd.conf</code></p> 
<pre><code>[root@centos7-108 etc]# vim /etc/vsftpd/vsftpd.conf
anonymous_enable=YES			# 设置是否运行匿名用户登录
</code></pre> 
<p>此时我们使用匿名用户登录ftp服务，匿名用户的账号名默认为<code>anonymous</code> ，密码为空<br> <img src="https://images2.imgbox.com/8f/d3/LvQmjHwF_o.png" alt="在这里插入图片描述"><br> 也可以通过文件管理器访问ftp服务<br> <img src="https://images2.imgbox.com/79/ce/1iLrDW1x_o.png" alt="在这里插入图片描述"><br> <strong>匿名用户配置参数</strong><br> 在配置文件中加入参数，给予上传文件夹777权限。</p> 
<pre><code># 基于pub文件777权限
[root@centos7-108 ftp]# chmod 777 pub
[root@centos7-108 ftp]# ll
总用量 0
drwxrwxrwx 2 root root 21 4月  22 17:54 pub

# 实现匿名用户上传文件，创建文件夹，删除权限等
[root@centos7-108 ftp]# cat /etc/vsftpd/vsftpd.conf
anon_root=/var/ftp/pub			# 定义上传文件开关
anon_upload_enable=YES			# 匿名用户创建文件夹权限
anon_mkdir_write_enable=YES		# 匿名用户写入权限
anon_other_write_enable=NO		# 匿名用户带宽限制，字节为单位。50000=5KB
anon_max_rate=50000				# 匿名用户上传速率

</code></pre> 
<p><img src="https://images2.imgbox.com/1b/9b/udcWWahT_o.png" alt=""><br> 测试，我们登录ftp，上传文件试试，成功上传了文件<br> <img src="https://images2.imgbox.com/d5/09/OUpGcm44_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3__109"></a>3. 实现本地用户登录</h3> 
<p><strong>本地用户创建及配置参数</strong></p> 
<ul><li>创建本地用户</li><li>添加配置文件参数</li></ul> 
<p>（1）创建用户 jack</p> 
<pre><code>useradd jack		# 创建用户Jack
passwd jack			# 设置 jack 的登录密码 
useradd tom		
passwd tom	

# 创建用户，但是不能登录终端，可以登录FTP
useradd -s /sbin/nologin mark				# 创建用户，当不能登录终端
sed -i '$a /sbin/nologin' /etc/shells 		# 用户登录登录FTP
</code></pre> 
<p><img src="https://images2.imgbox.com/59/66/mxa6Fm9T_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/85/d8/fD5Vy7Dx_o.png" alt="在这里插入图片描述"><br> （2）本地用户配置参数</p> 
<pre><code>local_enable=YES							# 运行本地用户登录，只有在此选项为YES 时，下面的选项才生效
chroot_list_enable=YES						# 设置用户不能离开主目录
chroot_list_file=/etc/vsftpd/chroot_list	# 设置不能离开主目录的用户表
userlist_enable=YES							# 启动用户列表
userlist_deny=NO							# NO，为白名单，表示用户列表中的用户可以登录，为YES则表示列表中的用户不能登录
userlist_file=/etc/vsftpd/user_list			# 设置用户列表
allow_writeable_chroot=yes			# 运行用户上传文件
local_root=/home					# 指定本地用户登录时切换的目录
</code></pre> 
<p>（3）测试，先只打开<code>local_enable=YES</code> ，运行本地用户登录<br> <img src="https://images2.imgbox.com/5d/98/CJP0ylQM_o.png" alt="在这里插入图片描述"><br> 匿名用户登录失败<br> <img src="https://images2.imgbox.com/21/4e/dwB6vIjp_o.png" alt="在这里插入图片描述"><br> jack用户登录成功<br> <img src="https://images2.imgbox.com/18/ab/UdPn9PJQ_o.png" alt="在这里插入图片描述"><br> <strong>小案例</strong><br> 实现jack用户可以访问同级目录下的文件，tom用户不能离开主目录。用户登录默认切换到home下面</p> 
<p>实现：<br> 配置文件</p> 
<pre><code>#====== 本地用户配置 =====#
local_enable=YES
chroot_list_enable=yes
chroot_list_file=/etc/vsftpd/chroot_list
userlist_enable=YES
userlist_deny=NO
userlist_file=/etc/vsftpd/user_list
local_root=/home
</code></pre> 
<p><img src="https://images2.imgbox.com/7e/82/eweP8FJR_o.png" alt="在这里插入图片描述"></p> 
<ul><li>chroot_list 文件</li></ul> 
<pre><code>[root@centos7-108 vsftpd]# cat /etc/vsftpd/chroot_list 
# 设置不能离开主目录
tom
</code></pre> 
<ul><li>user_list 文件</li></ul> 
<pre><code>[root@centos7-108 vsftpd]# cat /etc/vsftpd/user_list
jack
tom
</code></pre> 
<ul><li>测试tom<br> <img src="https://images2.imgbox.com/44/ed/Ge5Dc0yh_o.png" alt="在这里插入图片描述"></li><li>测试jack<br> <img src="https://images2.imgbox.com/08/57/rsqSVk1Q_o.png" alt="在这里插入图片描述"></li></ul> 
<h3><a id="4__178"></a>4. 连接配置</h3> 
<pre><code>## ============ 自定义连接配置  =============== ##
max_clients=100			 # 最多允许100个客户端连接
max_per_ip=5			 # 同时在线最多5个
idle_session_timeout=15	 # 设置连接超时时间
</code></pre> 
<blockquote> 
 <p>好了，这是些简单的FTP配置，更深入的配置我也不会，哈哈。希望大家能学有所成，天天开心哈。</p> 
</blockquote> 
<h2><a id="_189"></a>四、工具介绍</h2> 
<p>FTP连接工具很多，比如常见的有winscp，可以实现文件传输，还有filezilla，xftp等等。<br> 使用工具可以很方便传输文件。</p> 
<ul><li>filezilla<br> 我使用的是这个，之前有用过winscp，后面不知道为啥不用了。这是软件截图，用着还可以。<br> <img src="https://images2.imgbox.com/bc/2d/M3fw4ejV_o.png" alt="在这里插入图片描述"></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ae7ec3a0cc66a6aace4ef9e536990d61/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">VS code 报错“检测到 #include 错误，请更新 includepath”</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a6eae1509836eedd21bba5634146fc0a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Github访问量破百万！原来是美团大牛的分布式架构实战笔记上线了</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>