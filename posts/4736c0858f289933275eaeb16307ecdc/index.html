<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android 时区使用和总结 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android 时区使用和总结" />
<meta property="og:description" content="最近负责的车机项目是海外项目，涉及到全球多个地区。应用开发人员在使用时区时遇到一些问题，故本人做了一点学习；本文基于android9；
可以使用这些网址查询城市的时间时区等信息：
https://time.bmcx.com/Chatham_Islands__localtime/ 使用过程中发现在这个夏令时不准
http://www.timeofdate.com/city
目录 模块架构基本方法使用主要方法代码流程 一、模块架构 主要分为三个部分，API层AlarmManager，framework层AlarmManagerService，以及Native层com_android_server_AlarmManagerService;
AlarmManager：封装在framework.jar中，提供给APP调用的接口，会用到一些工具类zoneInfo、TzData等；
AlarmManagerService：service层，时区、时间等相关的逻辑处理，也会用到工具类zoneInfo、TimeZone等；
com_android_server_AlarmManagerService：Native层，通过JNI被服务层调用；
二、时区基本方法使用 使用比较简单，通过AlarmManager完成对alarm服务的一系列操作。基本的操作主要包括设置时区、监听时区变化、主动查询时区，基本满足应用开发的使用。主要demo代码如下：
2.1 设置系统默认时区 在系统层编译时，在mk文件中设置系统属性如下，调试时也可以根据查询这个属性确定当前得时区是哪里；
PRODUCT_DEFAULT_PROPERTY_OVERRIDES &#43;= persist.sys.timezone=Asia/Shanghai //设置系统默认时区为上海时区 2.2 查询系统支持的时区 不是所有得城市都支持直接的城市时区设置。当前系统大体支持两种方式设置时区，一种是通过设置城市得到相应得时区，另一种是设置GMT时区获得到对应时区；如下方法可以获得当前支持设置得时区参数；
String[] availableIDs = TimeZone.getAvailableIDs(); Log.i(&#34;luyao&#34;, &#34;onClick: bt_setzone可用zoneId总数 =&#34;&#43;availableIDs.length); for (String zoneId : availableIDs) { Log.i(&#34;luyao&#34;, &#34;onClick: bt_setzone= &#34;&#43;zoneId); } 对应的打印如下
2020-08-15 00:37:26.957 12555-12555/com.example.mtktest I/luyao: onClick: bt_setzone可用zoneId总数 =591 2020-08-15 00:37:26.957 12555-12555/com.example.mtktest I/luyao: onClick: bt_setzone= Africa/Abidjan 2020-08-15 00:37:26.957 12555-12555/com.example.mtktest I/luyao: onClick: bt_setzone= Africa/Accra 2020-08-15 00:37:26.957 12555-12555/com.example.mtktest I/luyao: onClick: bt_setzone= Africa/Addis_Ababa 2020-08-15 00:37:26." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/4736c0858f289933275eaeb16307ecdc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-23T17:19:52+08:00" />
<meta property="article:modified_time" content="2023-09-23T17:19:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android 时区使用和总结</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>最近负责的车机项目是海外项目，涉及到全球多个地区。应用开发人员在使用时区时遇到一些问题，故本人做了一点学习；本文基于android9；<br> 可以使用这些网址查询城市的时间时区等信息：<br> https://time.bmcx.com/Chatham_Islands__localtime/ 使用过程中发现在这个夏令时不准<br> http://www.timeofdate.com/city</p> 
<h3><a id="_4"></a>目录</h3> 
<ul><li>模块架构</li><li>基本方法使用</li><li>主要方法代码流程</li></ul> 
<h3><a id="_9"></a>一、模块架构</h3> 
<p>主要分为三个部分，API层AlarmManager，framework层AlarmManagerService，以及Native层com_android_server_AlarmManagerService;</p> 
<p><img src="https://images2.imgbox.com/9b/f0/bKC0WW4x_o.png" alt="在这里插入图片描述"><br> AlarmManager：封装在framework.jar中，提供给APP调用的接口，会用到一些工具类zoneInfo、TzData等；<br> AlarmManagerService：service层，时区、时间等相关的逻辑处理，也会用到工具类zoneInfo、TimeZone等；<br> com_android_server_AlarmManagerService：Native层，通过JNI被服务层调用；</p> 
<h3><a id="_16"></a>二、时区基本方法使用</h3> 
<p>使用比较简单，通过AlarmManager完成对alarm服务的一系列操作。基本的操作主要包括设置时区、监听时区变化、主动查询时区，基本满足应用开发的使用。主要demo代码如下：</p> 
<h4><a id="21__18"></a>2.1 设置系统默认时区</h4> 
<p>在系统层编译时，在mk文件中设置系统属性如下，调试时也可以根据查询这个属性确定当前得时区是哪里；</p> 
<pre><code class="prism language-java"> <span class="token constant">PRODUCT_DEFAULT_PROPERTY_OVERRIDES</span> <span class="token operator">+=</span> persist<span class="token punctuation">.</span>sys<span class="token punctuation">.</span>timezone<span class="token operator">=</span><span class="token class-name">Asia</span><span class="token operator">/</span><span class="token class-name">Shanghai</span>   <span class="token comment">//设置系统默认时区为上海时区</span>
</code></pre> 
<h4><a id="22__24"></a>2.2 查询系统支持的时区</h4> 
<p>不是所有得城市都支持直接的城市时区设置。当前系统大体支持两种方式设置时区，一种是通过设置城市得到相应得时区，另一种是设置GMT时区获得到对应时区；如下方法可以获得当前支持设置得时区参数；</p> 
<pre><code class="prism language-java">	<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> availableIDs <span class="token operator">=</span> <span class="token class-name">TimeZone</span><span class="token punctuation">.</span><span class="token function">getAvailableIDs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token string">"luyao"</span><span class="token punctuation">,</span> <span class="token string">"onClick: bt_setzone可用zoneId总数 ="</span><span class="token operator">+</span>availableIDs<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> zoneId <span class="token operator">:</span> availableIDs<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token string">"luyao"</span><span class="token punctuation">,</span> <span class="token string">"onClick: bt_setzone= "</span><span class="token operator">+</span>zoneId<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> 
<p>对应的打印如下</p> 
<pre><code class="prism language-java"><span class="token number">2020</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">26.957</span> <span class="token number">12555</span><span class="token operator">-</span><span class="token number">12555</span><span class="token operator">/</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mtktest <span class="token class-name">I</span><span class="token operator">/</span>luyao<span class="token operator">:</span> onClick<span class="token operator">:</span> bt_setzone可用zoneId总数 <span class="token operator">=</span><span class="token number">591</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">26.957</span> <span class="token number">12555</span><span class="token operator">-</span><span class="token number">12555</span><span class="token operator">/</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mtktest <span class="token class-name">I</span><span class="token operator">/</span>luyao<span class="token operator">:</span> onClick<span class="token operator">:</span> bt_setzone<span class="token operator">=</span> <span class="token class-name">Africa</span><span class="token operator">/</span><span class="token class-name">Abidjan</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">26.957</span> <span class="token number">12555</span><span class="token operator">-</span><span class="token number">12555</span><span class="token operator">/</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mtktest <span class="token class-name">I</span><span class="token operator">/</span>luyao<span class="token operator">:</span> onClick<span class="token operator">:</span> bt_setzone<span class="token operator">=</span> <span class="token class-name">Africa</span><span class="token operator">/</span><span class="token class-name">Accra</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">26.957</span> <span class="token number">12555</span><span class="token operator">-</span><span class="token number">12555</span><span class="token operator">/</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mtktest <span class="token class-name">I</span><span class="token operator">/</span>luyao<span class="token operator">:</span> onClick<span class="token operator">:</span> bt_setzone<span class="token operator">=</span> <span class="token class-name">Africa</span><span class="token operator">/</span><span class="token class-name">Addis_Ababa</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">26.957</span> <span class="token number">12555</span><span class="token operator">-</span><span class="token number">12555</span><span class="token operator">/</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mtktest <span class="token class-name">I</span><span class="token operator">/</span>luyao<span class="token operator">:</span> onClick<span class="token operator">:</span> bt_setzone<span class="token operator">=</span> <span class="token class-name">Africa</span><span class="token operator">/</span><span class="token class-name">Algiers</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">26.957</span> <span class="token number">12555</span><span class="token operator">-</span><span class="token number">12555</span><span class="token operator">/</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mtktest <span class="token class-name">I</span><span class="token operator">/</span>luyao<span class="token operator">:</span> onClick<span class="token operator">:</span> bt_setzone<span class="token operator">=</span> <span class="token class-name">Africa</span><span class="token operator">/</span><span class="token class-name">Asmara</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">26.957</span> <span class="token number">12555</span><span class="token operator">-</span><span class="token number">12555</span><span class="token operator">/</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mtktest <span class="token class-name">I</span><span class="token operator">/</span>luyao<span class="token operator">:</span> onClick<span class="token operator">:</span> bt_setzone<span class="token operator">=</span> <span class="token class-name">Africa</span><span class="token operator">/</span><span class="token class-name">Asmera</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">26.987</span> <span class="token number">12555</span><span class="token operator">-</span><span class="token number">12555</span><span class="token operator">/</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mtktest <span class="token class-name">I</span><span class="token operator">/</span>luyao<span class="token operator">:</span> onClick<span class="token operator">:</span> bt_setzone<span class="token operator">=</span> <span class="token class-name">Etc</span><span class="token operator">/</span><span class="token constant">GMT</span><span class="token operator">+</span><span class="token number">0</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">26.988</span> <span class="token number">12555</span><span class="token operator">-</span><span class="token number">12555</span><span class="token operator">/</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mtktest <span class="token class-name">I</span><span class="token operator">/</span>luyao<span class="token operator">:</span> onClick<span class="token operator">:</span> bt_setzone<span class="token operator">=</span> <span class="token class-name">Etc</span><span class="token operator">/</span><span class="token constant">GMT</span><span class="token operator">+</span><span class="token number">1</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">26.988</span> <span class="token number">12555</span><span class="token operator">-</span><span class="token number">12555</span><span class="token operator">/</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mtktest <span class="token class-name">I</span><span class="token operator">/</span>luyao<span class="token operator">:</span> onClick<span class="token operator">:</span> bt_setzone<span class="token operator">=</span> <span class="token class-name">Etc</span><span class="token operator">/</span><span class="token constant">GMT</span><span class="token operator">+</span><span class="token number">10</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">26.988</span> <span class="token number">12555</span><span class="token operator">-</span><span class="token number">12555</span><span class="token operator">/</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mtktest <span class="token class-name">I</span><span class="token operator">/</span>luyao<span class="token operator">:</span> onClick<span class="token operator">:</span> bt_setzone<span class="token operator">=</span> <span class="token class-name">Etc</span><span class="token operator">/</span><span class="token constant">GMT</span><span class="token operator">+</span><span class="token number">11</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<h4><a id="23__50"></a>2.3 设置时区</h4> 
<p>主要可以通过设置城市或者设置GMT的方式设置时区</p> 
<pre><code class="prism language-java"><span class="token class-name">AlarmManager</span> alarm<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
alarm<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">AlarmManager</span><span class="token punctuation">)</span> mContext<span class="token punctuation">.</span><span class="token function">getSystemService</span><span class="token punctuation">(</span><span class="token class-name">Context</span><span class="token punctuation">.</span><span class="token constant">ALARM_SERVICE</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获得AlarmManager服务对象</span>

alarm<span class="token punctuation">.</span><span class="token function">setTimeZone</span><span class="token punctuation">(</span><span class="token string">"Asia/Shanghai"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置上海时区</span>
alarm<span class="token punctuation">.</span><span class="token function">setTimeZone</span><span class="token punctuation">(</span><span class="token string">"GMT"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//0时区时间，可以去除夏令时</span>
alarm<span class="token punctuation">.</span><span class="token function">setTimeZone</span><span class="token punctuation">(</span><span class="token string">"Etc/GMT-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置东八区的时区</span>

</code></pre> 
<h4><a id="24__62"></a>2.4 接收时区变化</h4> 
<p>通过广播的方式，系统层通过广播发送，应用层接收：</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token class-name">TimeZoneChangeReceiver</span> timeZoneChangeReceiver<span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
timeZoneChangeReceiver <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TimeZoneChangeReceiver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">IntentFilter</span> filter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntentFilter</span><span class="token punctuation">(</span><span class="token constant">ACTION_TIMEZONE_CHANGED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">registerReceiver</span><span class="token punctuation">(</span>timeZoneChangeReceiver<span class="token punctuation">,</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//注册广播接收器</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">//创建广播接收器</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TimeZoneChangeReceiver</span> <span class="token keyword">extends</span> <span class="token class-name">BroadcastReceiver</span> <span class="token punctuation">{<!-- --></span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onReceive</span><span class="token punctuation">(</span><span class="token class-name">Context</span> context<span class="token punctuation">,</span> <span class="token class-name">Intent</span> intent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>intent<span class="token punctuation">.</span><span class="token function">getAction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token constant">ACTION_TIMEZONE_CHANGED</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 处理时区变化的逻辑</span>
                <span class="token class-name">String</span> newTimeZone <span class="token operator">=</span> intent<span class="token punctuation">.</span><span class="token function">getStringExtra</span><span class="token punctuation">(</span><span class="token string">"time-zone"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"luyao"</span><span class="token punctuation">,</span> <span class="token string">"时区变化："</span> <span class="token operator">+</span> newTimeZone<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h4><a id="25__84"></a>2.5 查询当前时区</h4> 
<pre><code class="prism language-java"><span class="token class-name">TimeZone</span> timeZone2 <span class="token operator">=</span> <span class="token class-name">TimeZone</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获得当前时区对象</span>
<span class="token class-name">String</span> timeZoneName <span class="token operator">=</span> timeZone2<span class="token punctuation">.</span><span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//时区名字</span>
<span class="token class-name">String</span> timeZoneutc <span class="token operator">=</span> timeZone2<span class="token punctuation">.</span><span class="token function">getDisplayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//时区对应的称呼，比如格林尼治时区，中国标准时区</span>

<span class="token class-name">TimeZone</span> timeZone <span class="token operator">=</span> <span class="token class-name">TimeZone</span><span class="token punctuation">.</span><span class="token function">getTimeZone</span><span class="token punctuation">(</span><span class="token string">"Asia/Shanghai"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取上海时区对象</span>
<span class="token keyword">boolean</span> usesDaylightTime <span class="token operator">=</span> timeZone<span class="token punctuation">.</span><span class="token function">useDaylightTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//查询当前的城市时区是否使用夏令时</span>
</code></pre> 
<h3><a id="_95"></a>三、主要方法代码流程</h3> 
<h4><a id="setTimeZone_96"></a>setTimeZone</h4> 
<p>设置时区方法，接口时序图如下；<br> 源码路径：<br> frameworks/base/core/java/android/app/AlarmManager.java<br> frameworks/base/services/core/java/com/android/server/AlarmManagerService.java<br> frameworks/base/services/core/jni/com_android_server_AlarmManagerService.cpp<br> libcore/luni/src/main/java/libcore/util/ZoneInfo.java<br> libcore/luni/src/main/java/libcore/util/ZoneInfoDB.java<br> libcore/ojluni/src/main/java/java/time/ZoneId.java<br> <img src="https://images2.imgbox.com/e1/c3/fCrf4PRN_o.png" alt="在这里插入图片描述"></p> 
<p>首先暴露给到应用使用的接口setTimeZone(String timeZone) ，参数timeZone的格式为：大洲/城市名，例如Asia/Shanghai；<br> 源码路径：<br> frameworks/base/core/java/android/app/AlarmManager.java</p> 
<pre><code class="prism language-java">    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTimeZone</span><span class="token punctuation">(</span><span class="token class-name">String</span> timeZone<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">TextUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>timeZone<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Reject this timezone if it isn't an Olson zone we recognize.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mTargetSdkVersion <span class="token operator">&gt;=</span> <span class="token class-name">Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>M</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">boolean</span> hasTimeZone <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
                hasTimeZone <span class="token operator">=</span> <span class="token class-name">ZoneInfoDB</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasTimeZone</span><span class="token punctuation">(</span>timeZone<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//判断设置的城市是否在时区数据库中，是否支持设置</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ignored<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hasTimeZone<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">"Timezone: "</span> <span class="token operator">+</span> timeZone <span class="token operator">+</span> <span class="token string">" is not an Olson ID"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            mService<span class="token punctuation">.</span><span class="token function">setTimeZone</span><span class="token punctuation">(</span>timeZone<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">RemoteException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> ex<span class="token punctuation">.</span><span class="token function">rethrowFromSystemServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>关键方法，判断是否是支持的城市：ZoneInfoDB.getInstance().hasTimeZone(timeZone)，如果是支持的城市继续调用AlarmManagerService的setTimeZone方法；<br> ZoneInfoDB源码路径：<br> libcore/luni/src/main/java/libcore/util/ZoneInfo.java</p> 
<pre><code class="prism language-java">   <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasTimeZone</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function">checkNotClosed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">//返回是否对应城市是否存在TimeZone对象</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>AlarmManagerService源码路径：<br> frameworks/base/services/core/java/com/android/server/AlarmManagerService.java</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTimeZone</span><span class="token punctuation">(</span><span class="token class-name">String</span> tz<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
                <span class="token function">setTimeZoneImpl</span><span class="token punctuation">(</span>tz<span class="token punctuation">)</span><span class="token punctuation">;</span>
 				<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
   
   <span class="token keyword">void</span> <span class="token function">setTimeZoneImpl</span><span class="token punctuation">(</span><span class="token class-name">String</span> tz<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token class-name">TimeZone</span> zone <span class="token operator">=</span> <span class="token class-name">TimeZone</span><span class="token punctuation">.</span><span class="token function">getTimeZone</span><span class="token punctuation">(</span>tz<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获得对应timezone对象</span>
        <span class="token comment">// Prevent reentrant calls from stepping on each other when writing</span>
        <span class="token comment">// the time zone property</span>
        <span class="token keyword">boolean</span> timeZoneWasChanged <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">String</span> current <span class="token operator">=</span> <span class="token class-name">SystemProperties</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token constant">TIMEZONE_PROPERTY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>current <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token operator">!</span>current<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>zone<span class="token punctuation">.</span><span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//if (localLOGV) {<!-- --></span>
                    <span class="token class-name">Slog</span><span class="token punctuation">.</span><span class="token function">i</span><span class="token punctuation">(</span><span class="token constant">TAG</span><span class="token punctuation">,</span> <span class="token string">"timezone changed: "</span> <span class="token operator">+</span> current <span class="token operator">+</span> <span class="token string">", new="</span> <span class="token operator">+</span> zone<span class="token punctuation">.</span><span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//}</span>
                timeZoneWasChanged <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                <span class="token class-name">SystemProperties</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token constant">TIMEZONE_PROPERTY</span><span class="token punctuation">,</span> zone<span class="token punctuation">.</span><span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// Update the kernel timezone information</span>
            <span class="token comment">// Kernel tracks time offsets as 'minutes west of GMT'</span>
            <span class="token keyword">int</span> gmtOffset <span class="token operator">=</span> zone<span class="token punctuation">.</span><span class="token function">getOffset</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//查询当前时间和对应时区的时间的偏差值，是个时间戳，单位是毫秒 1000*60*60*24</span>

            <span class="token function">setKernelTimezone</span><span class="token punctuation">(</span>mNativeData<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token punctuation">(</span>gmtOffset <span class="token operator">/</span> <span class="token number">60000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//把需要修改的时间设置给到内核</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">TimeZone</span><span class="token punctuation">.</span><span class="token function">setDefault</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>timeZoneWasChanged<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//时区如果变化，广播出去</span>
            <span class="token class-name">Intent</span> intent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Intent</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">ACTION_TIMEZONE_CHANGED</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            intent<span class="token punctuation">.</span><span class="token function">addFlags</span><span class="token punctuation">(</span><span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">FLAG_RECEIVER_REPLACE_PENDING</span>
                    <span class="token operator">|</span> <span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">FLAG_RECEIVER_INCLUDE_BACKGROUND</span>
                    <span class="token operator">|</span> <span class="token class-name">Intent</span><span class="token punctuation">.</span><span class="token constant">FLAG_RECEIVER_VISIBLE_TO_INSTANT_APPS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            intent<span class="token punctuation">.</span><span class="token function">putExtra</span><span class="token punctuation">(</span><span class="token string">"time-zone"</span><span class="token punctuation">,</span> zone<span class="token punctuation">.</span><span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sendBroadcastAsUser</span><span class="token punctuation">(</span>intent<span class="token punctuation">,</span> <span class="token class-name">UserHandle</span><span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

</code></pre> 
<p>上面方法实现中主要调用了两个方法，TimeZone.getOffset(System.currentTimeMillis())和setKernelTimezone(mNativeData, -(gmtOffset / 60000)); 其中getoffset用于查询当前时间和对应时区的时间的偏差值，而setKernelTimezone是将需要修改的时间设置给到系统内核，完成系统时间的修改；<br> Timezone源码路径：<br> libcore/ojluni/src/main/java/java/util/TimeZone.java</p> 
<pre><code class="prism language-java">   <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOffset</span><span class="token punctuation">(</span><span class="token keyword">long</span> date<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">inDaylightTime</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//判断是否是夏令时，如果是加上夏令时的时间</span>
            <span class="token keyword">return</span> <span class="token function">getRawOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">getDSTSavings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token function">getRawOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>inDaylightTime、getDSTSavings方法源码目录：<br> libcore/luni/src/main/java/libcore/util/ZoneInfo.java</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Override</span> <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">inDaylightTime</span><span class="token punctuation">(</span><span class="token class-name">Date</span> time<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">long</span> when <span class="token operator">=</span> time<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> offsetIndex <span class="token operator">=</span> <span class="token function">findOffsetIndexForTimeInMilliseconds</span><span class="token punctuation">(</span>when<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//查找此时间在数组中的index</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>offsetIndex <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">//未查到，说明无夏令时</span>
            <span class="token comment">// Assume that all times before our first transition are non-daylight.</span>
            <span class="token comment">// Transition data tends to start with a transition to daylight, so just</span>
            <span class="token comment">// copying the first transition would assume the opposite.</span>
            <span class="token comment">// http://code.google.com/p/android/issues/detail?id=14395</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> mIsDsts<span class="token punctuation">[</span>offsetIndex<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//此数据库保存是否支持夏令时</span>
    <span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getDSTSavings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">useDaylightTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token number">3600000</span><span class="token punctuation">;</span><span class="token comment">//一个小时</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="DST_228"></a>四、夏令时DST</h3> 
<p>夏令时又称夏季时间（没有冬令时概念）。它是为节约能源而人为规定地方时间的制度（鼓励人们早睡早起，不要浪费电，夏天日照时间长尽量多用自然资源），全球约40%的国家在夏季使用夏令时，其他国家则全年只使用标准时间。正在使用夏令时的代表国家：美国、欧盟、俄罗斯等等。<br> <strong>夏令时设置的原理：</strong><br> 通过改变时区和时间偏移来实现的。当夏令时开始时，系统会自动将时间偏移增加一小时；当夏令时结束时，系统会自动将时间偏移减少一小时。这样，系统的时钟就会自动调整为夏令时或标准时间。每年的夏令时时间段还不一样（一般在3月的第2个周日开始），比如美国2020年夏令时时间是：2020年3月8日 - 2020年11月1日。具体做法是：在3.8号这天将时钟往前拨拨1个小时，11.1号这天还原回来。<br> 夏令时相关的方法使用如下所示：</p> 
<pre><code class="prism language-java">
alarm<span class="token punctuation">.</span><span class="token function">setTimeZone</span><span class="token punctuation">(</span><span class="token string">"Australia/Sydney"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置悉尼时区</span>

<span class="token class-name">TimeZone</span> timeZone2 <span class="token operator">=</span> <span class="token class-name">TimeZone</span><span class="token punctuation">.</span><span class="token function">getDefault</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> timeZoneName <span class="token operator">=</span> timeZone2<span class="token punctuation">.</span><span class="token function">getID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"luyao2"</span><span class="token punctuation">,</span> <span class="token string">"当前data："</span> <span class="token operator">+</span>date<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">boolean</span> isdayligt <span class="token operator">=</span> timeZone2<span class="token punctuation">.</span><span class="token function">inDaylightTime</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//查询当前时间，悉尼是否在使用夏令时</span>
<span class="token keyword">boolean</span> usesDaylightTime <span class="token operator">=</span> timeZone<span class="token punctuation">.</span><span class="token function">useDaylightTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//查询当前的城市时区是否支持使用夏令时</span>
timeZone2<span class="token punctuation">.</span><span class="token function">getDSTSavings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//夏令时的时间偏差是多少</span>
timeZone2<span class="token punctuation">.</span><span class="token function">getRawOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//UTC的时间偏差是多少</span>
<span class="token class-name">Log</span><span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"luyao2"</span><span class="token punctuation">,</span> <span class="token string">"当前时区："</span> <span class="token operator">+</span> timeZoneName<span class="token operator">+</span>  <span class="token string">"  timeZone2.getDisplayName() "</span><span class="token operator">+</span>timeZone2<span class="token punctuation">.</span><span class="token function">getDisplayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token string">"  isdayligt="</span><span class="token operator">+</span>isdayligt <span class="token operator">+</span><span class="token string">"  useDaylightTime():"</span> <span class="token operator">+</span> timeZone2<span class="token punctuation">.</span><span class="token function">useDaylightTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">" getDSTSavings()"</span><span class="token operator">+</span>timeZone2<span class="token punctuation">.</span><span class="token function">getDSTSavings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token string">" "</span><span class="token operator">+</span>timeZone2<span class="token punctuation">.</span><span class="token function">getRawOffset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-java">上面的打印日志如下：
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">42</span><span class="token operator">:</span><span class="token number">47.125</span> <span class="token number">13157</span><span class="token operator">-</span><span class="token number">13157</span><span class="token operator">/</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mtktest <span class="token class-name">D</span><span class="token operator">/</span>luyao<span class="token operator">:</span> 时区变化：<span class="token class-name">Australia</span><span class="token operator">/</span><span class="token class-name">Sydney</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">42</span><span class="token operator">:</span><span class="token number">48.274</span> <span class="token number">13157</span><span class="token operator">-</span><span class="token number">13157</span><span class="token operator">/</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mtktest <span class="token class-name">D</span><span class="token operator">/</span>luyao2<span class="token operator">:</span> 当前data：<span class="token class-name">Sat</span> <span class="token class-name">Aug</span> <span class="token number">15</span> <span class="token number">02</span><span class="token operator">:</span><span class="token number">42</span><span class="token operator">:</span><span class="token number">48</span> <span class="token constant">GMT</span><span class="token operator">+</span><span class="token number">10</span><span class="token operator">:</span><span class="token number">00</span> <span class="token number">2020</span>
<span class="token number">2020</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">15</span> <span class="token number">00</span><span class="token operator">:</span><span class="token number">42</span><span class="token operator">:</span><span class="token number">48.275</span> <span class="token number">13157</span><span class="token operator">-</span><span class="token number">13157</span><span class="token operator">/</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mtktest <span class="token class-name">D</span><span class="token operator">/</span>luyao2<span class="token operator">:</span> 当前时区：<span class="token class-name">Australia</span><span class="token operator">/</span><span class="token class-name">Sydney</span>  timeZone2<span class="token punctuation">.</span><span class="token function">getDisplayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token class-name">Australian</span> <span class="token class-name">Eastern</span> <span class="token class-name">Standard</span> <span class="token class-name">Time</span>  isdayligt<span class="token operator">=</span><span class="token boolean">false</span>  <span class="token function">useDaylightTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token boolean">true</span> <span class="token function">getDSTSavings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token number">3600000</span> <span class="token number">36000000</span>
</code></pre> 
<p>Android系统默认支持夏令时策略，所以在做国际多国项目时需要对夏令时做充足的了解。在应用使用setTimeZone(“Asia/Shanghai”);的方式设置时区时，会默认存在夏令时。而使用setTimeZone(“Etc/GMT-8”)的方式设置时区时不会有夏令时的策略存在。夏令时的策略是由android集成的一个数据库tzdata里定义。若发生某城市夏令时不准确时，可以考虑是否时这个数据库太老导致，可以尝试更新这个库。</p> 
<h3><a id="_258"></a>五、常见问题</h3> 
<p><strong>城市不支持设置时区</strong><br> UE团队出的设计图中，需要在设置里提供很多城市的时区设置。但是当前系统的tzdata数据库中仅支持部分城市时区设置，比如需要设置北京时区，但是无法通过setTimeZone(“Asia/Beijing”)这种方式设置，因为数据库中没有这个城市；<br> <strong>部分夏令时不准确</strong><br> 由于数据库太老，可以尝试更新tzdata数据库。在不方便更新数据库时，可以考虑对这个城市的夏令时时间做二次加工。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/937adfd6eabbc95e84bd461370b0449a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">LNK1120 8 个无法解析的外部命令 E:\C&#43;&#43;\ziji\x64\Debug\ziji.exe 1</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/91e4b8c37d2ce5da3d2607e3a0ddfd03/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于QT实现发送http的get和post请求（post还可以实现上传文件），同时实现接收返回json数据，并对其进行解析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>