<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>图像二值化代码实现 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="图像二值化代码实现" />
<meta property="og:description" content="图像二值化代码实现 固定阈值二值化Otsu 阈值二值化自适应阈值二值化 固定阈值二值化 opencv实现：
ret, th = cv2.threshold(gray, 127, 255, cv2.THRESH_BINARY) cv2.imshow(&#39;opencv&#39;, th) python实现：
thresh = 127 new_img = np.zeros((h,w),np.uint8) for i in range(h): for j in range(w): if gray[i,j]&gt;thresh: new_img[i,j] = 255 else: new_img[i, j] = 0 cv2.imshow(&#34;threshold&#34;,new_img) Otsu 阈值二值化 日本人Nobuyuki Otsu (大津展之）发明，故名大津法、Otsu法，其实是一种最大类间方差法。
opencv实现：
ret, th = cv2.threshold(gray,0,255,cv2.THRESH_BINARY&#43;cv2.THRESH_OTSU) cv2.imshow(&#39;opencv&#39;, th) python实现：
h,w = img.shape[:2] sum = h*w #统计各灰度级数量 histogram = np.zeros(256, np.int32) for i in range(h): for j in range(w): p = gray[i,j] histogram[p] &#43;=1 #统计各灰度级所占比例 probability = np." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0737e09ce774cb94873d425c3cf59431/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-18T20:54:13+08:00" />
<meta property="article:modified_time" content="2021-01-18T20:54:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">图像二值化代码实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>图像二值化代码实现</h4> 
 <ul><li><a href="#_1" rel="nofollow">固定阈值二值化</a></li><li><a href="#Otsu__20" rel="nofollow">Otsu 阈值二值化</a></li><li><a href="#_81" rel="nofollow">自适应阈值二值化</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>固定阈值二值化</h2> 
<p>opencv实现：</p> 
<pre><code class="prism language-javascript">ret<span class="token punctuation">,</span> th <span class="token operator">=</span> cv2<span class="token punctuation">.</span><span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span><span class="token constant">THRESH_BINARY</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">'opencv'</span><span class="token punctuation">,</span> th<span class="token punctuation">)</span>
</code></pre> 
<p>python实现：</p> 
<pre><code class="prism language-javascript">thresh <span class="token operator">=</span> <span class="token number">127</span>
new_img <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span>w<span class="token punctuation">)</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> gray<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">&gt;</span>thresh<span class="token punctuation">:</span>
            new_img<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            new_img<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
cv2<span class="token punctuation">.</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"threshold"</span><span class="token punctuation">,</span>new_img<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f0/c8/eUhQ5iVc_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Otsu__20"></a>Otsu 阈值二值化</h2> 
<p>日本人Nobuyuki Otsu (大津展之）发明，故名大津法、Otsu法，其实是一种最大类间方差法。<br> <img src="https://images2.imgbox.com/51/2a/EY8RlRfO_o.png" alt="在这里插入图片描述"><br> opencv实现：</p> 
<pre><code class="prism language-javascript">ret<span class="token punctuation">,</span> th <span class="token operator">=</span> cv2<span class="token punctuation">.</span><span class="token function">threshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span><span class="token constant">THRESH_BINARY</span><span class="token operator">+</span>cv2<span class="token punctuation">.</span><span class="token constant">THRESH_OTSU</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">'opencv'</span><span class="token punctuation">,</span> th<span class="token punctuation">)</span>
</code></pre> 
<p>python实现：</p> 
<pre><code class="prism language-javascript">h<span class="token punctuation">,</span>w <span class="token operator">=</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
sum <span class="token operator">=</span> h<span class="token operator">*</span>w

#统计各灰度级数量
histogram <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">:</span>
        p <span class="token operator">=</span> gray<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span>
        histogram<span class="token punctuation">[</span>p<span class="token punctuation">]</span> <span class="token operator">+=</span><span class="token number">1</span>

#统计各灰度级所占比例
probability <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    probability<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> histogram<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">/</span>sum

#计算平均灰度值
ma <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    ma <span class="token operator">+=</span> i<span class="token operator">*</span>probability<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

maxcov <span class="token operator">=</span> <span class="token number">0</span>
maxthresh <span class="token operator">=</span> <span class="token number">0</span>
#统计前景和背景的平均灰度值
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p1<span class="token punctuation">,</span>p2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span> #前景和背景灰度概率
    mk <span class="token operator">=</span> <span class="token number">0</span>  #灰度级总和
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
        p1 <span class="token operator">+=</span> probability<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
        mk <span class="token operator">+=</span> j<span class="token operator">*</span>probability<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
    m1 <span class="token operator">=</span> mk<span class="token operator">/</span>p1
    p2 <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> p1
    m2 <span class="token operator">=</span> <span class="token punctuation">(</span>ma<span class="token operator">-</span>mk<span class="token punctuation">)</span><span class="token operator">/</span>p2

    #计算类间方差
    cov <span class="token operator">=</span> p1<span class="token operator">*</span>p2<span class="token operator">*</span><span class="token punctuation">(</span>m1<span class="token operator">-</span>m2<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span>
    <span class="token keyword">if</span> cov<span class="token operator">&gt;</span>maxcov<span class="token punctuation">:</span>
        maxcov <span class="token operator">=</span> cov
        maxthresh <span class="token operator">=</span> i

<span class="token function">print</span><span class="token punctuation">(</span>maxthresh<span class="token punctuation">)</span>
new_img <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span>w<span class="token punctuation">)</span><span class="token punctuation">,</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> gray<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span><span class="token operator">&gt;</span>maxthresh<span class="token punctuation">:</span>
            new_img<span class="token punctuation">[</span>i<span class="token punctuation">,</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            new_img<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>

cv2<span class="token punctuation">.</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"otsu"</span><span class="token punctuation">,</span>new_img<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/7a/10/MBpbDrRQ_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_81"></a>自适应阈值二值化</h2> 
<p>自适应阈值二值化会每次取图片的一个区域计算阈值，针对不同区域设置不同阈值，该方法主要为了应对在不同的光照条件下导致的差异。</p> 
<p>opencv两种实现：<br> cv2.ADAPTIVE_THRESH_MEAN_C:阈值取邻域的平均值<br> cv2.ADAPTIVE_THRESH_GAUSSIAN_C:阈值取邻域值的加权和，权重是高斯核</p> 
<p>参数1：原图<br> 参数2：最大阈值，一般为255<br> 参数3：小区域阈值的两种计算方式<br> 参数4：阈值的方式（5种）<br> 参数5：小区域的面积<br> 参数6：最终阈值为小区域计算出的阈值再减去此值</p> 
<pre><code class="prism language-javascript">th<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">adaptiveThreshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span><span class="token constant">ADAPTIVE_THRESH_MEAN_C</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span><span class="token constant">THRESH_BINARY</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
# th<span class="token operator">=</span>cv2<span class="token punctuation">.</span><span class="token function">adaptiveThreshold</span><span class="token punctuation">(</span>gray<span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span><span class="token constant">ADAPTIVE_THRESH_GAUSSIAN_C</span><span class="token punctuation">,</span>cv2<span class="token punctuation">.</span><span class="token constant">THRESH_BINARY</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
cv2<span class="token punctuation">.</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">'opencv'</span><span class="token punctuation">,</span> th<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d3/12/QQsBGq5X_o.png" alt="在这里插入图片描述"><br> python实现：</p> 
<pre><code class="prism language-javascript">#计算积分图
integralimage <span class="token operator">=</span> cv2<span class="token punctuation">.</span><span class="token function">integral</span><span class="token punctuation">(</span>gray_image<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span><span class="token constant">CV_32F</span><span class="token punctuation">)</span>
width <span class="token operator">=</span> gray_image<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
height <span class="token operator">=</span> gray_image<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
win_length <span class="token operator">=</span> <span class="token number">5</span>
image_thresh <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token punctuation">(</span>height<span class="token punctuation">,</span> width<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>

<span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span>height<span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span>width<span class="token punctuation">)</span><span class="token punctuation">:</span>
       x1 <span class="token operator">=</span> i <span class="token operator">-</span> win_length
       x2 <span class="token operator">=</span> i <span class="token operator">+</span> win_length
       y1 <span class="token operator">=</span> j <span class="token operator">-</span> win_length
       y2 <span class="token operator">=</span> j <span class="token operator">+</span> win_length

       #check the border
       <span class="token keyword">if</span> <span class="token punctuation">(</span>x1 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
           x1 <span class="token operator">=</span> <span class="token number">0</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>y1 <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
           y1 <span class="token operator">=</span> <span class="token number">0</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>x2 <span class="token operator">&gt;</span> width<span class="token punctuation">)</span><span class="token punctuation">:</span>
           x2 <span class="token operator">=</span> width <span class="token operator">-</span> <span class="token number">1</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>y2 <span class="token operator">&gt;</span> height<span class="token punctuation">)</span><span class="token punctuation">:</span>
           y2 <span class="token operator">=</span> height <span class="token operator">-</span> <span class="token number">1</span>
       count <span class="token operator">=</span> <span class="token punctuation">(</span>x2 <span class="token operator">-</span> x1<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>y2 <span class="token operator">-</span> y1<span class="token punctuation">)</span>

       sum <span class="token operator">=</span> integralimage<span class="token punctuation">[</span>y2<span class="token punctuation">,</span> x2<span class="token punctuation">]</span> <span class="token operator">-</span> integralimage<span class="token punctuation">[</span>y1<span class="token punctuation">,</span> x2<span class="token punctuation">]</span> <span class="token operator">-</span> integralimage<span class="token punctuation">[</span>y2<span class="token punctuation">,</span> x1<span class="token punctuation">]</span> <span class="token operator">+</span> integralimage<span class="token punctuation">[</span>y1<span class="token punctuation">,</span> x1<span class="token punctuation">]</span>
       <span class="token keyword">if</span> gray_image<span class="token punctuation">[</span>j<span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> sum<span class="token operator">/</span>count<span class="token punctuation">:</span>
           image_thresh<span class="token punctuation">[</span>j<span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
       <span class="token keyword">else</span><span class="token punctuation">:</span>
           image_thresh<span class="token punctuation">[</span>j<span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">255</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/14/ef/e9vHPFQP_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4e90c67cad8b9da6cfe4d62083613355/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mysql模糊连接查询_mysql连接like模糊查询</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b4809bded4eba96405213bceb8e6a506/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">mysql解析text_详解MySQL中的TEXT、BLOB</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>