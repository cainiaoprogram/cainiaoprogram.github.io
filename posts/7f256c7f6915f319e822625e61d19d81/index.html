<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>OpenCV快速入门：彩蛋——小游戏制作 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="OpenCV快速入门：彩蛋——小游戏制作" />
<meta property="og:description" content="文章目录 前言一、游戏玩法1.1 核心玩法1.2 特殊事件 二、功能模块划分2.1 主游戏文件 (`main.py`)2.2 游戏对象 (`game_objects.py`)2.3 游戏逻辑 (`game_logic.py`)2.4 事件和奖励 (`events_and_rewards.py`)2.5. 游戏界面 (`game_ui.py`) 三、完整代码3.1 主游戏文件 (`main.py`)3.1.1 游戏初始化3.1.2 主游戏循环3.1.3 游戏结束 3.2 游戏对象 (`game_objects.py`)3.2.1 `GameObject` 类3.2.2 `Player` 类3.2.3 `Monster` 类3.2.4 `Bullet` 类 3.3 游戏逻辑 (`game_logic.py`)3.3.1 `GameLogic` 类3.3.2 方法 3.4 事件和奖励 (`events_and_rewards.py`)3.4.1 `EventsAndRewards` 类3.4.2 方法 3.5 游戏界面 (`game_ui.py`)3.5.1 `GameUI` 类3.5.2 绘制UI的方法3.5.3 升级菜单 总结 前言 在这篇博客是一个小彩蛋，我们将探索如何使用Python和OpenCV库来制作一个简单的塔防小游戏（虽然OpenCV的设计初衷并不是用来做游戏的）。我们将详细介绍游戏的玩法以及其功能模块的划分。
一、游戏玩法 这个游戏是一个垂直滚动的射击游戏。玩家培养一个位于屏幕底部的可以向上射击的角色，目的是击败出现在屏幕上部的各种怪物。游戏随着时间的推移，难度会逐渐增加。
1.1 核心玩法 怪物生成：游戏会定期生成不同类型的怪物，随着时间增长，怪物出现的频率会加快。射击机制：玩家角色会向上射击，击中怪物后可以获得分数、金钱和经验值。升级系统：玩家可以使用金钱来升级子弹，例如增加子弹速度、穿透能力或添加追踪功能。 1.2 特殊事件 游戏中还包含只有在特定条件下才会触发的特殊事件，如“bonus_coin”, “sudden_attack”, “treasure_chest”，为游戏增添额外的乐趣和挑战。 二、功能模块划分 游戏的代码被划分为几个主要的模块，每个模块都承担着特定的功能。
2.1 主游戏文件 (main.py) 初始化游戏窗口和实体：设置窗口大小并创建玩家、怪物等游戏实体。游戏循环：包含游戏的主要循环，控制怪物的生成和子弹的射击，处理游戏逻辑和UI更新。 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/7f256c7f6915f319e822625e61d19d81/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-30T12:15:27+08:00" />
<meta property="article:modified_time" content="2023-11-30T12:15:27+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">OpenCV快速入门：彩蛋——小游戏制作</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_3" rel="nofollow">前言</a></li><li><a href="#_11" rel="nofollow">一、游戏玩法</a></li><li><ul><li><a href="#11__15" rel="nofollow">1.1 核心玩法</a></li><li><a href="#12__20" rel="nofollow">1.2 特殊事件</a></li></ul> 
  </li><li><a href="#_23" rel="nofollow">二、功能模块划分</a></li><li><ul><li><a href="#21__mainpy_27" rel="nofollow">2.1 主游戏文件 (`main.py`)</a></li><li><a href="#22__game_objectspy_31" rel="nofollow">2.2 游戏对象 (`game_objects.py`)</a></li><li><a href="#23__game_logicpy_37" rel="nofollow">2.3 游戏逻辑 (`game_logic.py`)</a></li><li><a href="#24__events_and_rewardspy_40" rel="nofollow">2.4 事件和奖励 (`events_and_rewards.py`)</a></li><li><a href="#25__game_uipy_43" rel="nofollow">2.5. 游戏界面 (`game_ui.py`)</a></li></ul> 
  </li><li><a href="#_47" rel="nofollow">三、完整代码</a></li><li><ul><li><a href="#31__mainpy_50" rel="nofollow">3.1 主游戏文件 (`main.py`)</a></li><li><ul><li><a href="#311__144" rel="nofollow">3.1.1 游戏初始化</a></li><li><a href="#312__149" rel="nofollow">3.1.2 主游戏循环</a></li><li><a href="#313__158" rel="nofollow">3.1.3 游戏结束</a></li></ul> 
   </li><li><a href="#32__game_objectspy_162" rel="nofollow">3.2 游戏对象 (`game_objects.py`)</a></li><li><ul><li><a href="#321_GameObject__321" rel="nofollow">3.2.1 `GameObject` 类</a></li><li><a href="#322_Player__327" rel="nofollow">3.2.2 `Player` 类</a></li><li><a href="#323_Monster__336" rel="nofollow">3.2.3 `Monster` 类</a></li><li><a href="#324_Bullet__343" rel="nofollow">3.2.4 `Bullet` 类</a></li></ul> 
   </li><li><a href="#33__game_logicpy_353" rel="nofollow">3.3 游戏逻辑 (`game_logic.py`)</a></li><li><ul><li><a href="#331_GameLogic__459" rel="nofollow">3.3.1 `GameLogic` 类</a></li><li><a href="#332__468" rel="nofollow">3.3.2 方法</a></li></ul> 
   </li><li><a href="#34__events_and_rewardspy_481" rel="nofollow">3.4 事件和奖励 (`events_and_rewards.py`)</a></li><li><ul><li><a href="#341_EventsAndRewards__525" rel="nofollow">3.4.1 `EventsAndRewards` 类</a></li><li><a href="#342__533" rel="nofollow">3.4.2 方法</a></li></ul> 
   </li><li><a href="#35__game_uipy_541" rel="nofollow">3.5 游戏界面 (`game_ui.py`)</a></li><li><ul><li><a href="#351_GameUI__651" rel="nofollow">3.5.1 `GameUI` 类</a></li><li><a href="#352_UI_657" rel="nofollow">3.5.2 绘制UI的方法</a></li><li><a href="#353__664" rel="nofollow">3.5.3 升级菜单</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_673" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_3"></a>前言</h2> 
<p>在这篇博客是一个小彩蛋，我们将探索如何使用Python和OpenCV库来制作一个简单的塔防小游戏（虽然OpenCV的设计初衷并不是用来做游戏的）。我们将详细介绍游戏的玩法以及其功能模块的划分。</p> 
<p><img src="https://images2.imgbox.com/09/63/t6cB6lYG_o.png" alt="Game"></p> 
<hr> 
<h2><a id="_11"></a>一、游戏玩法</h2> 
<p>这个游戏是一个垂直滚动的射击游戏。玩家培养一个位于屏幕底部的可以向上射击的角色，目的是击败出现在屏幕上部的各种怪物。游戏随着时间的推移，难度会逐渐增加。</p> 
<h3><a id="11__15"></a>1.1 核心玩法</h3> 
<ul><li><strong>怪物生成</strong>：游戏会定期生成不同类型的怪物，随着时间增长，怪物出现的频率会加快。</li><li><strong>射击机制</strong>：玩家角色会向上射击，击中怪物后可以获得分数、金钱和经验值。</li><li><strong>升级系统</strong>：玩家可以使用金钱来升级子弹，例如增加子弹速度、穿透能力或添加追踪功能。</li></ul> 
<h3><a id="12__20"></a>1.2 特殊事件</h3> 
<ul><li>游戏中还包含只有在特定条件下才会触发的特殊事件，如“bonus_coin”, “sudden_attack”, “treasure_chest”，为游戏增添额外的乐趣和挑战。</li></ul> 
<h2><a id="_23"></a>二、功能模块划分</h2> 
<p>游戏的代码被划分为几个主要的模块，每个模块都承担着特定的功能。</p> 
<h3><a id="21__mainpy_27"></a>2.1 主游戏文件 (<code>main.py</code>)</h3> 
<ul><li><strong>初始化游戏窗口和实体</strong>：设置窗口大小并创建玩家、怪物等游戏实体。</li><li><strong>游戏循环</strong>：包含游戏的主要循环，控制怪物的生成和子弹的射击，处理游戏逻辑和UI更新。</li></ul> 
<h3><a id="22__game_objectspy_31"></a>2.2 游戏对象 (<code>game_objects.py</code>)</h3> 
<ul><li><strong>GameObject类</strong>：基类，定义了游戏中所有对象共有的属性和方法。</li><li><strong>Player类</strong>：定义玩家的属性和行为，如绘制、射击和升级。</li><li><strong>Monster类</strong>：定义怪物的属性和行为，包括不同怪物的外观和移动方式。</li><li><strong>Bullet类</strong>：定义子弹的属性和行为，包括移动、绘制和碰撞检测。</li></ul> 
<h3><a id="23__game_logicpy_37"></a>2.3 游戏逻辑 (<code>game_logic.py</code>)</h3> 
<ul><li><strong>GameLogic类</strong>：处理游戏的核心逻辑，如移动子弹、检测碰撞和更新游戏状态。</li></ul> 
<h3><a id="24__events_and_rewardspy_40"></a>2.4 事件和奖励 (<code>events_and_rewards.py</code>)</h3> 
<ul><li><strong>EventsAndRewards类</strong>：管理游戏中的特殊事件和奖励，如随机触发事件和处理其效果。</li></ul> 
<h3><a id="25__game_uipy_43"></a>2.5. 游戏界面 (<code>game_ui.py</code>)</h3> 
<ul><li><strong>GameUI类</strong>：负责游戏界面的绘制，如显示分数、生命值和经验值。</li></ul> 
<h2><a id="_47"></a>三、完整代码</h2> 
<h3><a id="31__mainpy_50"></a>3.1 主游戏文件 (<code>main.py</code>)</h3> 
<p>这段代码展示了如何将不同的游戏组件整合到一个主循环中，以创建一个基本的2D射击游戏。它使用了 OpenCV 来处理图形显示和键盘输入，展示了如何在 Python 中使用 OpenCV 创建简单的游戏。通过这个示例，可以看到如何结合面向对象的设计来构建游戏逻辑，以及如何处理游戏中的不同事件和状态。这个游戏可以进一步扩展，例如增加更多的怪物类型、升级选项、关卡设计等，以提升游戏体验和复杂度。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> random
<span class="token keyword">import</span> time
<span class="token keyword">from</span> game_objects <span class="token keyword">import</span> Player<span class="token punctuation">,</span> Monster
<span class="token keyword">from</span> game_ui <span class="token keyword">import</span> GameUI
<span class="token keyword">from</span> game_logic <span class="token keyword">import</span> GameLogic
<span class="token keyword">from</span> events_and_rewards <span class="token keyword">import</span> EventsAndRewards

<span class="token comment"># 设置窗口大小</span>
window_width<span class="token punctuation">,</span> window_height <span class="token operator">=</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">800</span>

<span class="token comment"># 初始化游戏窗口</span>
window <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>window_height<span class="token punctuation">,</span> window_width<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span>np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>

<span class="token comment"># 创建游戏实体</span>
player <span class="token operator">=</span> Player<span class="token punctuation">(</span><span class="token number">185</span><span class="token punctuation">,</span> <span class="token number">750</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span>  <span class="token comment"># 位置</span>
<span class="token comment"># 创建游戏逻辑、界面和事件管理器 初始时没有怪物 没有子弹</span>
game_logic <span class="token operator">=</span> GameLogic<span class="token punctuation">(</span>player<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> window_width<span class="token punctuation">,</span> window_height<span class="token punctuation">)</span>
game_ui <span class="token operator">=</span> GameUI<span class="token punctuation">(</span><span class="token punctuation">(</span>window_width<span class="token punctuation">,</span> window_height<span class="token punctuation">)</span><span class="token punctuation">)</span>
events_and_rewards <span class="token operator">=</span> EventsAndRewards<span class="token punctuation">(</span>game_logic<span class="token punctuation">)</span>

<span class="token comment"># 用于控制怪物生成和子弹射击的时间</span>
last_monster_spawn_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
last_bullet_shoot_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>

monster_spawn_interval <span class="token operator">=</span> <span class="token number">1.0</span>  <span class="token comment"># 每秒生成一个怪物</span>
bullet_shoot_interval <span class="token operator">=</span> <span class="token number">1.0</span>  <span class="token comment"># 每秒射击一次</span>
game_logic<span class="token punctuation">.</span>paused <span class="token operator">=</span> <span class="token boolean">False</span>  <span class="token comment"># 游戏状态</span>

<span class="token comment"># 主游戏循环</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    game_logic<span class="token punctuation">.</span>check_for_upgrade<span class="token punctuation">(</span>player<span class="token punctuation">,</span> window<span class="token punctuation">,</span> game_ui<span class="token punctuation">)</span>

    <span class="token keyword">if</span> <span class="token keyword">not</span> game_logic<span class="token punctuation">.</span>paused<span class="token punctuation">:</span>
        current_time <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 更新怪物生成间隔</span>
        monster_spawn_interval <span class="token operator">=</span> game_logic<span class="token punctuation">.</span>get_monster_spawn_interval<span class="token punctuation">(</span><span class="token punctuation">)</span>
        bullet_shoot_interval <span class="token operator">=</span> game_logic<span class="token punctuation">.</span>bullet_shoot_interval<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 每秒生成一个怪物</span>
        <span class="token keyword">if</span> current_time <span class="token operator">-</span> last_monster_spawn_time <span class="token operator">&gt;</span> monster_spawn_interval<span class="token punctuation">:</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>player<span class="token punctuation">.</span>level <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                size <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span>  <span class="token comment"># 假设怪物宽度</span>
                x <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> window_width <span class="token operator">-</span> size<span class="token punctuation">)</span>  <span class="token comment"># 假设怪物宽度为30</span>
                game_logic<span class="token punctuation">.</span>monsters<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Monster<span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"random_type"</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 使用随机类型或其他逻辑</span>

            last_monster_spawn_time <span class="token operator">=</span> current_time

        <span class="token comment"># 每秒射击一次</span>
        <span class="token keyword">if</span> current_time <span class="token operator">-</span> last_bullet_shoot_time <span class="token operator">&gt;</span> bullet_shoot_interval<span class="token punctuation">:</span>
            player<span class="token punctuation">.</span>shoot<span class="token punctuation">(</span>game_logic<span class="token punctuation">.</span>bullets<span class="token punctuation">,</span> game_logic<span class="token punctuation">.</span>monsters<span class="token punctuation">)</span>
            last_bullet_shoot_time <span class="token operator">=</span> current_time

        <span class="token comment"># 清空窗口</span>
        game_ui<span class="token punctuation">.</span>clear_window<span class="token punctuation">(</span>window<span class="token punctuation">,</span> player<span class="token punctuation">)</span>
        <span class="token comment"># 绘制玩家</span>
        player<span class="token punctuation">.</span>draw<span class="token punctuation">(</span>window<span class="token punctuation">)</span>

        <span class="token comment"># 更新和绘制子弹</span>
        <span class="token keyword">for</span> bullet <span class="token keyword">in</span> game_logic<span class="token punctuation">.</span>bullets<span class="token punctuation">:</span>
            bullet<span class="token punctuation">.</span>move<span class="token punctuation">(</span>monsters<span class="token operator">=</span>game_logic<span class="token punctuation">.</span>monsters<span class="token punctuation">)</span>
            bullet<span class="token punctuation">.</span>draw<span class="token punctuation">(</span>window<span class="token punctuation">)</span>

        <span class="token comment"># 更新和绘制怪物</span>
        <span class="token keyword">for</span> monster <span class="token keyword">in</span> game_logic<span class="token punctuation">.</span>monsters<span class="token punctuation">:</span>
            monster<span class="token punctuation">.</span>move<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> player<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment"># 假设怪物每次下移1像素</span>
            monster<span class="token punctuation">.</span>draw<span class="token punctuation">(</span>window<span class="token punctuation">)</span>

        <span class="token comment"># 处理游戏逻辑</span>
        game_logic<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>game_logic<span class="token punctuation">.</span>monsters<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">50</span><span class="token punctuation">:</span>
            <span class="token comment"># 处理事件和奖励</span>
            event <span class="token operator">=</span> events_and_rewards<span class="token punctuation">.</span>trigger_random_event<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> event<span class="token punctuation">:</span>
                <span class="token comment"># 如果有事件被触发，处理该事件</span>
                events_and_rewards<span class="token punctuation">.</span>apply_event_effects<span class="token punctuation">(</span>event<span class="token punctuation">)</span>

        <span class="token comment"># 显示窗口内容</span>
        cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Game Window"</span><span class="token punctuation">,</span> window<span class="token punctuation">)</span>

        <span class="token comment"># 检查是否按下了退出键（例如Esc键）</span>
        key <span class="token operator">=</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> key <span class="token operator">==</span> <span class="token number">27</span><span class="token punctuation">:</span>  <span class="token comment"># Esc键的ASCII码</span>
            <span class="token keyword">break</span>

<span class="token comment"># 游戏结束，关闭窗口</span>
cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>这段代码集成了下面定义的 <code>Player</code>, <code>Monster</code>, <code>GameUI</code>, <code>GameLogic</code>, 和 <code>EventsAndRewards</code> 类，以创建一个完整的游戏环境。以下是对代码的主要部分的解析：</p> 
<h4><a id="311__144"></a>3.1.1 游戏初始化</h4> 
<ul><li><strong>窗口设置</strong>: 设定游戏窗口的大小（400x800像素），并初始化一个全黑的画布。</li><li><strong>游戏实体创建</strong>: 创建玩家、游戏逻辑处理器、用户界面管理器和事件与奖励处理器的实例。</li><li><strong>时间控制变量</strong>: 用于控制怪物生成和子弹射击的时间间隔。</li></ul> 
<h4><a id="312__149"></a>3.1.2 主游戏循环</h4> 
<ul><li><strong>升级检查</strong>: 在每次循环开始时，检查玩家是否满足升级条件。</li><li><strong>怪物生成</strong>: 根据设定的间隔和玩家等级，定期在游戏窗口的顶部随机位置生成怪物。</li><li><strong>子弹射击</strong>: 根据玩家的射击间隔定期发射子弹。</li><li><strong>绘制游戏元素</strong>: 包括清空窗口、绘制玩家、子弹和怪物。</li><li><strong>游戏逻辑更新</strong>: 调用 <code>GameLogic</code> 的 <code>update</code> 方法来处理子弹移动、子弹和怪物的碰撞以及怪物和墙的碰撞。</li><li><strong>事件和奖励处理</strong>: 当怪物数量超过50时，触发随机事件，并应用相应的效果。</li><li><strong>显示和键盘输入</strong>: 使用 OpenCV 显示游戏窗口，并检测是否按下退出键（如Esc键）。</li></ul> 
<h4><a id="313__158"></a>3.1.3 游戏结束</h4> 
<ul><li><strong>关闭窗口</strong>: 当玩家按下退出键时，跳出循环并关闭游戏窗口。</li></ul> 
<h3><a id="32__game_objectspy_162"></a>3.2 游戏对象 (<code>game_objects.py</code>)</h3> 
<p>这段代码提供了一个2D游戏的基本结构，包含玩家、怪物和子弹的互动。玩家可以升级子弹，而怪物具有不同的形状和行为。代码还包括子弹的追踪和穿透功能，为游戏增加了更多策略性。通过对这些类和方法的进一步扩展和定制，可以创建更复杂和有趣的游戏体验。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np


<span class="token keyword">class</span> <span class="token class-name">GameObject</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> x
        self<span class="token punctuation">.</span>y <span class="token operator">=</span> y

    <span class="token keyword">def</span> <span class="token function">draw</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> window<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">pass</span>  <span class="token comment"># To be implemented in subclasses</span>

    <span class="token keyword">def</span> <span class="token function">move</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>x <span class="token operator">+=</span> dx
        self<span class="token punctuation">.</span>y <span class="token operator">+=</span> dy


<span class="token keyword">class</span> <span class="token class-name">Player</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> x
        self<span class="token punctuation">.</span>y <span class="token operator">=</span> y
        self<span class="token punctuation">.</span>size <span class="token operator">=</span> size
        self<span class="token punctuation">.</span>health <span class="token operator">=</span> <span class="token number">3000</span>  <span class="token comment"># 初始生命值</span>
        self<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 初始分数</span>
        self<span class="token punctuation">.</span>money <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 初始金钱</span>
        self<span class="token punctuation">.</span>experience <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 初始经验值</span>
        self<span class="token punctuation">.</span>level <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># 初始等级</span>
        self<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>  <span class="token comment"># 玩家颜色</span>

        self<span class="token punctuation">.</span>bullet_speed <span class="token operator">=</span> <span class="token number">5</span>  <span class="token comment"># 子弹速度</span>
        self<span class="token punctuation">.</span>bullet_size <span class="token operator">=</span> <span class="token number">5</span>  <span class="token comment"># 子弹大小</span>
        self<span class="token punctuation">.</span>shoot_interval <span class="token operator">=</span> <span class="token number">1.0</span>  <span class="token comment"># 发射间隔，初始为1秒</span>
        self<span class="token punctuation">.</span>tracking_bullet <span class="token operator">=</span> <span class="token boolean">False</span>  <span class="token comment"># 是否发射跟踪弹</span>
        self<span class="token punctuation">.</span>piercing_bullet <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 是否发射贯穿弹 穿透怪物次数</span>

        self<span class="token punctuation">.</span>shoot_interval_multiplier <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># 发射间隔，升级成本乘数</span>
        self<span class="token punctuation">.</span>piercing_bullet_multiplier <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># 贯穿弹，升级成本乘数</span>

    <span class="token keyword">def</span> <span class="token function">draw</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> window<span class="token punctuation">)</span><span class="token punctuation">:</span>
        top_left <span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
        bottom_right <span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>x <span class="token operator">+</span> self<span class="token punctuation">.</span>size<span class="token punctuation">,</span> self<span class="token punctuation">.</span>y <span class="token operator">+</span> self<span class="token punctuation">.</span>size<span class="token punctuation">)</span>
        cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>window<span class="token punctuation">,</span> top_left<span class="token punctuation">,</span> bottom_right<span class="token punctuation">,</span> self<span class="token punctuation">.</span>color<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> lineType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>
        wall_height <span class="token operator">=</span> <span class="token number">5</span>  <span class="token comment"># 假设墙的高度为5像素</span>
        wall_color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">)</span>  <span class="token comment"># 灰色</span>
        cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token number">10</span> <span class="token operator">+</span> wall_height<span class="token punctuation">)</span><span class="token punctuation">,</span> wall_color<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">shoot</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> bullets<span class="token punctuation">,</span> monsters<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 发射子弹</span>
        bullet_x <span class="token operator">=</span> self<span class="token punctuation">.</span>x <span class="token operator">+</span> self<span class="token punctuation">.</span>size <span class="token operator">//</span> <span class="token number">2</span>
        bullet_y <span class="token operator">=</span> self<span class="token punctuation">.</span>y
        bullet_direction <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 向上射击</span>
        bullets<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Bullet<span class="token punctuation">(</span>bullet_x<span class="token punctuation">,</span> bullet_y<span class="token punctuation">,</span> bullet_direction<span class="token punctuation">,</span>
                              self<span class="token punctuation">.</span>bullet_speed<span class="token punctuation">,</span> self<span class="token punctuation">.</span>bullet_size<span class="token punctuation">,</span>
                              monsters<span class="token punctuation">,</span> self<span class="token punctuation">.</span>tracking_bullet<span class="token punctuation">,</span> self<span class="token punctuation">.</span>piercing_bullet<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">upgrade_bullet</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> upgrade_type<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 实现升级子弹的逻辑</span>
        <span class="token keyword">if</span> upgrade_type <span class="token operator">==</span> <span class="token string">"Increase Bullet"</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>shoot_interval <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>shoot_interval <span class="token operator">-</span> <span class="token number">0.1</span><span class="token punctuation">)</span>  <span class="token comment"># 减少发射间隔，最小为0.1秒</span>
            self<span class="token punctuation">.</span>money <span class="token operator">=</span> self<span class="token punctuation">.</span>money <span class="token operator">-</span> <span class="token number">10</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>shoot_interval_multiplier  <span class="token comment"># 扣减金币</span>
            self<span class="token punctuation">.</span>shoot_interval_multiplier <span class="token operator">=</span> self<span class="token punctuation">.</span>shoot_interval_multiplier <span class="token operator">+</span> <span class="token number">0.5</span>

        <span class="token keyword">elif</span> upgrade_type <span class="token operator">==</span> <span class="token string">"Piercing Bullet"</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>piercing_bullet <span class="token operator">=</span> self<span class="token punctuation">.</span>piercing_bullet <span class="token operator">+</span> <span class="token number">1</span>  <span class="token comment"># 穿透怪物次数+1</span>
            self<span class="token punctuation">.</span>money <span class="token operator">=</span> self<span class="token punctuation">.</span>money <span class="token operator">-</span> <span class="token number">20</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>piercing_bullet_multiplier  <span class="token comment"># 扣减金币</span>
            self<span class="token punctuation">.</span>piercing_bullet_multiplier <span class="token operator">=</span> self<span class="token punctuation">.</span>piercing_bullet_multiplier <span class="token operator">+</span> <span class="token number">0.5</span>

        <span class="token keyword">elif</span> upgrade_type <span class="token operator">==</span> <span class="token string">"Tracking Bullet"</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>tracking_bullet <span class="token operator">=</span> <span class="token boolean">True</span>  <span class="token comment"># 启用跟踪弹</span>
            self<span class="token punctuation">.</span>money <span class="token operator">=</span> self<span class="token punctuation">.</span>money <span class="token operator">-</span> <span class="token number">500</span>  <span class="token comment"># 扣减金币</span>

    <span class="token keyword">def</span> <span class="token function">upgrade</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>experience <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 重置经验值</span>
        self<span class="token punctuation">.</span>level <span class="token operator">+=</span> <span class="token number">1</span>  <span class="token comment"># 提升等级</span>


<span class="token keyword">class</span> <span class="token class-name">Monster</span><span class="token punctuation">(</span>GameObject<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> monster_type<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>monster_type <span class="token operator">=</span> monster_type
        self<span class="token punctuation">.</span>size <span class="token operator">=</span> size  <span class="token comment"># 添加怪物的尺寸属性</span>

    <span class="token keyword">def</span> <span class="token function">draw</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> window<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>monster_type <span class="token operator">==</span> <span class="token string">"random_type"</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>monster_type <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"triangle"</span><span class="token punctuation">,</span> <span class="token string">"ellipse"</span><span class="token punctuation">,</span> <span class="token string">"diamond"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

        half_size <span class="token operator">=</span> self<span class="token punctuation">.</span>size <span class="token operator">//</span> <span class="token number">2</span>

        <span class="token keyword">if</span> self<span class="token punctuation">.</span>monster_type <span class="token operator">==</span> <span class="token string">"triangle"</span><span class="token punctuation">:</span>
            points <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>
                <span class="token punctuation">[</span>self<span class="token punctuation">.</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>y <span class="token operator">-</span> half_size<span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span>self<span class="token punctuation">.</span>x <span class="token operator">+</span> half_size<span class="token punctuation">,</span> self<span class="token punctuation">.</span>y <span class="token operator">+</span> half_size<span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span>self<span class="token punctuation">.</span>x <span class="token operator">-</span> half_size<span class="token punctuation">,</span> self<span class="token punctuation">.</span>y <span class="token operator">+</span> half_size<span class="token punctuation">]</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span>
            cv2<span class="token punctuation">.</span>polylines<span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token punctuation">[</span>points<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> lineType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>

        <span class="token keyword">elif</span> self<span class="token punctuation">.</span>monster_type <span class="token operator">==</span> <span class="token string">"ellipse"</span><span class="token punctuation">:</span>
            cv2<span class="token punctuation">.</span>ellipse<span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>half_size<span class="token punctuation">,</span> half_size <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">360</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
                        lineType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>

        <span class="token keyword">elif</span> self<span class="token punctuation">.</span>monster_type <span class="token operator">==</span> <span class="token string">"diamond"</span><span class="token punctuation">:</span>
            points <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>
                <span class="token punctuation">[</span>self<span class="token punctuation">.</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>y <span class="token operator">-</span> half_size<span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span>self<span class="token punctuation">.</span>x <span class="token operator">+</span> half_size<span class="token punctuation">,</span> self<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span>self<span class="token punctuation">.</span>x<span class="token punctuation">,</span> self<span class="token punctuation">.</span>y <span class="token operator">+</span> half_size<span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token punctuation">[</span>self<span class="token punctuation">.</span>x <span class="token operator">-</span> half_size<span class="token punctuation">,</span> self<span class="token punctuation">.</span>y<span class="token punctuation">]</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span>
            cv2<span class="token punctuation">.</span>polylines<span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token punctuation">[</span>points<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> thickness<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> lineType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">move</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dx<span class="token punctuation">,</span> dy<span class="token punctuation">,</span> wall_y<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>y <span class="token operator">+</span> dy <span class="token operator">+</span> self<span class="token punctuation">.</span>size <span class="token operator">&lt;=</span> wall_y<span class="token punctuation">:</span>  <span class="token comment"># 确保怪物不会移动到墙的位置</span>
            <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>move<span class="token punctuation">(</span>dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span>


<span class="token keyword">class</span> <span class="token class-name">Bullet</span><span class="token punctuation">(</span>GameObject<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> direction<span class="token punctuation">,</span> speed<span class="token punctuation">,</span> size<span class="token punctuation">,</span> monsters<span class="token punctuation">,</span> tracking<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> piercing_count<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>direction <span class="token operator">=</span> direction  <span class="token comment"># 射击方向</span>
        self<span class="token punctuation">.</span>speed <span class="token operator">=</span> speed
        self<span class="token punctuation">.</span>size <span class="token operator">=</span> size
        self<span class="token punctuation">.</span>tracking <span class="token operator">=</span> tracking  <span class="token comment"># 是否追踪敌人</span>
        self<span class="token punctuation">.</span>piercing_count <span class="token operator">=</span> piercing_count  <span class="token comment"># 穿透怪物次数</span>
        <span class="token comment"># 初始化时确定方向</span>
        <span class="token keyword">if</span> monsters<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>direction <span class="token operator">=</span> self<span class="token punctuation">.</span>calculate_direction_to_closest_monster<span class="token punctuation">(</span>monsters<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>direction <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 如果没有怪物，默认向上</span>

    <span class="token keyword">def</span> <span class="token function">draw</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> window<span class="token punctuation">)</span><span class="token punctuation">:</span>
        cv2<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>size<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> lineType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">move</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> dx<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> dy<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> monsters<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>tracking <span class="token keyword">and</span> monsters<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>update_direction_to_closest_monster<span class="token punctuation">(</span>monsters<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 如果不追踪或没有怪物，继续向原始方向移动</span>
            dx<span class="token punctuation">,</span> dy <span class="token operator">=</span> self<span class="token punctuation">.</span>direction<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>speed<span class="token punctuation">,</span> self<span class="token punctuation">.</span>direction<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>speed
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>move<span class="token punctuation">(</span>dx<span class="token punctuation">,</span> dy<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">update_direction_to_closest_monster</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> monsters<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> monsters<span class="token punctuation">:</span>
            closest_monster <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>monsters<span class="token punctuation">,</span>
                                  key<span class="token operator">=</span><span class="token keyword">lambda</span> monster<span class="token punctuation">:</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span><span class="token punctuation">[</span>monster<span class="token punctuation">.</span>x <span class="token operator">-</span> self<span class="token punctuation">.</span>x<span class="token punctuation">,</span> monster<span class="token punctuation">.</span>y <span class="token operator">-</span> self<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            dx<span class="token punctuation">,</span> dy <span class="token operator">=</span> closest_monster<span class="token punctuation">.</span>x <span class="token operator">-</span> self<span class="token punctuation">.</span>x<span class="token punctuation">,</span> closest_monster<span class="token punctuation">.</span>y <span class="token operator">-</span> self<span class="token punctuation">.</span>y
            distance <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>dx <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">+</span> dy <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>direction <span class="token operator">=</span> <span class="token punctuation">(</span>dx <span class="token operator">/</span> distance<span class="token punctuation">,</span> dy <span class="token operator">/</span> distance<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">calculate_direction_to_closest_monster</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> monsters<span class="token punctuation">)</span><span class="token punctuation">:</span>
        shoot_offset <span class="token operator">=</span> <span class="token number">15</span>  <span class="token comment"># 射击提前量</span>
        closest_monster <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>monsters<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> monster<span class="token punctuation">:</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>norm<span class="token punctuation">(</span><span class="token punctuation">[</span>monster<span class="token punctuation">.</span>x <span class="token operator">-</span> self<span class="token punctuation">.</span>x<span class="token punctuation">,</span> monster<span class="token punctuation">.</span>y <span class="token operator">-</span> self<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        dx<span class="token punctuation">,</span> dy <span class="token operator">=</span> closest_monster<span class="token punctuation">.</span>x <span class="token operator">-</span> self<span class="token punctuation">.</span>x<span class="token punctuation">,</span> closest_monster<span class="token punctuation">.</span>y <span class="token operator">-</span> self<span class="token punctuation">.</span>y <span class="token operator">+</span> shoot_offset
        distance <span class="token operator">=</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>dx <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">+</span> dy <span class="token operator">**</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> dx <span class="token operator">/</span> distance<span class="token punctuation">,</span> dy <span class="token operator">/</span> distance
</code></pre> 
<h4><a id="321_GameObject__321"></a>3.2.1 <code>GameObject</code> 类</h4> 
<ul><li><strong>基础类</strong>：所有游戏对象的基类，包含基本属性如坐标 (<code>x</code>, <code>y</code>)。</li><li><strong>方法</strong>： 
  <ul><li><code>draw(window)</code>: 在游戏窗口中绘制对象，具体实现在子类中。</li><li><code>move(dx, dy)</code>: 移动对象，改变其坐标。</li></ul> </li></ul> 
<h4><a id="322_Player__327"></a>3.2.2 <code>Player</code> 类</h4> 
<ul><li><strong>功能</strong>：表示游戏中的玩家。</li><li><strong>属性</strong>：包括位置 (<code>x</code>, <code>y</code>), 大小 (<code>size</code>), 生命值 (<code>health</code>), 分数 (<code>score</code>), 金钱 (<code>money</code>), 经验 (<code>experience</code>), 等级 (<code>level</code>), 玩家颜色 (<code>color</code>)，以及与子弹相关的属性。</li><li><strong>方法</strong>： 
  <ul><li><code>draw(window)</code>: 在游戏窗口中绘制玩家。</li><li><code>shoot(bullets, monsters)</code>: 发射子弹。</li><li><code>upgrade_bullet(upgrade_type)</code>: 升级子弹的类型。</li><li><code>upgrade()</code>: 提升玩家等级。</li></ul> </li></ul> 
<h4><a id="323_Monster__336"></a>3.2.3 <code>Monster</code> 类</h4> 
<ul><li><strong>功能</strong>：代表游戏中的怪物。</li><li><strong>属性</strong>：除了 <code>GameObject</code> 的基本属性外，还包括怪物类型 (<code>monster_type</code>) 和大小 (<code>size</code>)。</li><li><strong>方法</strong>： 
  <ul><li><code>draw(window)</code>: 根据怪物类型在游戏窗口中绘制不同的图形。</li><li><code>move(dx, dy, wall_y)</code>: 移动怪物，但不允许它们穿过墙。</li></ul> </li></ul> 
<h4><a id="324_Bullet__343"></a>3.2.4 <code>Bullet</code> 类</h4> 
<ul><li><strong>功能</strong>：代表游戏中的子弹。</li><li><strong>属性</strong>：包括方向 (<code>direction</code>), 速度 (<code>speed</code>), 大小 (<code>size</code>), 是否追踪 (<code>tracking</code>), 穿透次数 (<code>piercing_count</code>)。</li><li><strong>方法</strong>： 
  <ul><li><code>draw(window)</code>: 在游戏窗口中绘制子弹。</li><li><code>move(dx, dy, monsters)</code>: 根据是否追踪怪物来更新子弹的方向和位置。</li><li><code>update_direction_to_closest_monster(monsters)</code>: 更新子弹的方向，使其指向最近的怪物。</li><li><code>calculate_direction_to_closest_monster(monsters)</code>: 计算并返回指向最近怪物的方向。</li></ul> </li></ul> 
<h3><a id="33__game_logicpy_353"></a>3.3 游戏逻辑 (<code>game_logic.py</code>)</h3> 
<p><code>GameLogic</code> 类是游戏的核心，负责管理游戏中的动态元素，如玩家、子弹和怪物的行为。它通过更新游戏状态、处理碰撞和升级逻辑来保持游戏的连贯性。这个类可以被进一步扩展，以增加更多的游戏特性和复杂性。通过这种方式，可以创建一个更丰富、更引人入胜的游戏体验。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np


<span class="token keyword">class</span> <span class="token class-name">GameLogic</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> player<span class="token punctuation">,</span> monsters<span class="token punctuation">,</span> bullets<span class="token punctuation">,</span> window_width<span class="token punctuation">,</span> window_height<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>paused <span class="token operator">=</span> <span class="token boolean">False</span>
        self<span class="token punctuation">.</span>player <span class="token operator">=</span> player
        self<span class="token punctuation">.</span>monsters <span class="token operator">=</span> monsters
        self<span class="token punctuation">.</span>bullets <span class="token operator">=</span> bullets
        self<span class="token punctuation">.</span>window_width <span class="token operator">=</span> window_width
        self<span class="token punctuation">.</span>window_height <span class="token operator">=</span> window_height

    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>move_bullets<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>check_bullet_monster_collision<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>check_monster_wall_collision<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>remove_offscreen_objects<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">move_bullets</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> bullet <span class="token keyword">in</span> self<span class="token punctuation">.</span>bullets<span class="token punctuation">:</span>
            bullet<span class="token punctuation">.</span>move<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">check_bullet_monster_collision</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> bullet <span class="token keyword">in</span> self<span class="token punctuation">.</span>bullets<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> monster <span class="token keyword">in</span> self<span class="token punctuation">.</span>monsters<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>is_collision<span class="token punctuation">(</span>bullet<span class="token punctuation">,</span> monster<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>player<span class="token punctuation">.</span>score <span class="token operator">+=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>monster<span class="token punctuation">.</span>size <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment"># 加分</span>
                    self<span class="token punctuation">.</span>player<span class="token punctuation">.</span>money <span class="token operator">+=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>monster<span class="token punctuation">.</span>size <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 加金币</span>
                    self<span class="token punctuation">.</span>player<span class="token punctuation">.</span>experience <span class="token operator">+=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>monster<span class="token punctuation">.</span>size <span class="token operator">/</span> self<span class="token punctuation">.</span>player<span class="token punctuation">.</span>level<span class="token punctuation">)</span>  <span class="token comment"># 加经验</span>
                    self<span class="token punctuation">.</span>monsters<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>monster<span class="token punctuation">)</span>
                    <span class="token keyword">if</span> bullet<span class="token punctuation">.</span>piercing_count <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                        self<span class="token punctuation">.</span>bullets<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>bullet<span class="token punctuation">)</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        bullet<span class="token punctuation">.</span>piercing_count <span class="token operator">=</span> bullet<span class="token punctuation">.</span>piercing_count <span class="token operator">-</span> <span class="token number">1</span>
                    <span class="token keyword">break</span>  <span class="token comment"># 退出内层循环，避免迭代已移除的子弹</span>

    <span class="token keyword">def</span> <span class="token function">check_monster_wall_collision</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> monster <span class="token keyword">in</span> self<span class="token punctuation">.</span>monsters<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> monster<span class="token punctuation">.</span>y <span class="token operator">+</span> monster<span class="token punctuation">.</span>size <span class="token operator">&gt;=</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>player<span class="token punctuation">.</span>y<span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 假设怪物底部触碰到墙</span>
                self<span class="token punctuation">.</span>player<span class="token punctuation">.</span>health <span class="token operator">-=</span> <span class="token number">1</span>  <span class="token comment"># 每个怪物每秒减少1点生命值</span>

    <span class="token keyword">def</span> <span class="token function">remove_offscreen_objects</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>bullets <span class="token operator">=</span> <span class="token punctuation">[</span>bullet <span class="token keyword">for</span> bullet <span class="token keyword">in</span> self<span class="token punctuation">.</span>bullets <span class="token keyword">if</span> self<span class="token punctuation">.</span>is_on_screen<span class="token punctuation">(</span>bullet<span class="token punctuation">)</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>monsters <span class="token operator">=</span> <span class="token punctuation">[</span>monster <span class="token keyword">for</span> monster <span class="token keyword">in</span> self<span class="token punctuation">.</span>monsters <span class="token keyword">if</span> self<span class="token punctuation">.</span>is_on_screen<span class="token punctuation">(</span>monster<span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token keyword">def</span> <span class="token function">is_collision</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj1<span class="token punctuation">,</span> obj2<span class="token punctuation">)</span><span class="token punctuation">:</span>
        collision_size <span class="token operator">=</span> obj2<span class="token punctuation">.</span>size <span class="token keyword">if</span> obj2<span class="token punctuation">.</span>size <span class="token operator">&gt;</span> <span class="token number">20</span> <span class="token keyword">else</span> <span class="token number">20</span>
        <span class="token comment"># 简单的碰撞检测逻辑</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>obj1<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> obj2<span class="token punctuation">.</span>x <span class="token operator">+</span> collision_size <span class="token keyword">and</span>
                obj1<span class="token punctuation">.</span>x <span class="token operator">+</span> collision_size <span class="token operator">&gt;</span> obj2<span class="token punctuation">.</span>x <span class="token keyword">and</span>
                obj1<span class="token punctuation">.</span>y <span class="token operator">&lt;</span> obj2<span class="token punctuation">.</span>y <span class="token operator">+</span> obj2<span class="token punctuation">.</span>size <span class="token keyword">and</span>
                obj1<span class="token punctuation">.</span>y <span class="token operator">+</span> collision_size <span class="token operator">&gt;</span> obj2<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">True</span>
        <span class="token keyword">return</span> <span class="token boolean">False</span>

    <span class="token keyword">def</span> <span class="token function">is_on_screen</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 检查物体是否还在屏幕中</span>
        <span class="token keyword">return</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> obj<span class="token punctuation">.</span>x <span class="token operator">&lt;=</span> self<span class="token punctuation">.</span>window_width <span class="token keyword">and</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> obj<span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> self<span class="token punctuation">.</span>window_height

    <span class="token keyword">def</span> <span class="token function">get_monster_spawn_interval</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 随着等级增加，生成怪物的间隔时间减少</span>
        <span class="token comment"># 例如，每提升一级，时间减少3%</span>
        interval_decrease <span class="token operator">=</span> <span class="token number">0.03</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>player<span class="token punctuation">.</span>level
        base_interval <span class="token operator">=</span> <span class="token number">1.0</span>
        new_interval <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> base_interval <span class="token operator">-</span> interval_decrease<span class="token punctuation">)</span>  <span class="token comment"># 设置一个最小间隔时间</span>
        <span class="token keyword">return</span> new_interval

    <span class="token keyword">def</span> <span class="token function">bullet_shoot_interval</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>player<span class="token punctuation">.</span>shoot_interval

    <span class="token keyword">def</span> <span class="token function">check_for_upgrade</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> player<span class="token punctuation">,</span> window<span class="token punctuation">,</span> game_ui<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> player<span class="token punctuation">.</span>experience <span class="token operator">&gt;=</span> <span class="token number">100</span> <span class="token keyword">and</span> player<span class="token punctuation">.</span>level <span class="token operator">&lt;</span> <span class="token number">20</span><span class="token punctuation">:</span>
            player<span class="token punctuation">.</span>upgrade<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> player<span class="token punctuation">.</span>level <span class="token operator">&gt;=</span> <span class="token number">20</span><span class="token punctuation">:</span>
                <span class="token comment"># 清空窗口</span>
                window<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

                cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string">"Victory!!!"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span>
                            <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> lineType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>
                <span class="token comment"># 更新窗口</span>
                cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Game Window"</span><span class="token punctuation">,</span> window<span class="token punctuation">)</span>

                <span class="token comment"># 等待按下Esc键</span>
                <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">27</span><span class="token punctuation">:</span>  <span class="token comment"># Esc键的ASCII码</span>
                        <span class="token keyword">break</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 绘制UI</span>
                game_ui<span class="token punctuation">.</span>clear_window<span class="token punctuation">(</span>window<span class="token punctuation">,</span> player<span class="token punctuation">)</span>
                <span class="token keyword">while</span> player<span class="token punctuation">.</span>money <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                    self<span class="token punctuation">.</span>paused <span class="token operator">=</span> <span class="token boolean">True</span>
                    selected_option <span class="token operator">=</span> game_ui<span class="token punctuation">.</span>show_upgrade_menu<span class="token punctuation">(</span>window<span class="token punctuation">,</span> player<span class="token punctuation">)</span>
                    <span class="token comment"># 根据选择的升级选项进行升级</span>
                    player<span class="token punctuation">.</span>upgrade_bullet<span class="token punctuation">(</span>selected_option<span class="token punctuation">)</span>
                    <span class="token comment"># 绘制UI</span>
                    game_ui<span class="token punctuation">.</span>clear_window<span class="token punctuation">(</span>window<span class="token punctuation">,</span> player<span class="token punctuation">)</span>
                    <span class="token keyword">if</span> selected_option <span class="token operator">==</span> <span class="token string">"Cancel"</span><span class="token punctuation">:</span>
                        <span class="token keyword">break</span>
                self<span class="token punctuation">.</span>paused <span class="token operator">=</span> <span class="token boolean">False</span>
</code></pre> 
<p>该类的主要作用是控制游戏的流程，包括移动子弹、检测碰撞、移除屏幕外的对象、生成怪物和处理玩家升级。以下是对关键功能的解析：</p> 
<h4><a id="331_GameLogic__459"></a>3.3.1 <code>GameLogic</code> 类</h4> 
<ul><li><strong>构造函数 (<code>__init__</code>)</strong>: 初始化游戏逻辑，包括玩家、怪物、子弹以及窗口的宽度和高度。</li><li><strong>属性</strong>: 
  <ul><li><code>paused</code>: 游戏是否暂停。</li><li><code>player</code>: 玩家对象。</li><li><code>monsters</code>: 怪物列表。</li><li><code>bullets</code>: 子弹列表。</li><li><code>window_width</code>, <code>window_height</code>: 游戏窗口的尺寸。</li></ul> </li></ul> 
<h4><a id="332__468"></a>3.3.2 方法</h4> 
<ul><li><strong><code>update</code></strong>: 更新游戏逻辑，包括移动子弹、检查子弹与怪物的碰撞、检查怪物与墙的碰撞和移除屏幕外的对象。</li><li><strong><code>move_bullets</code></strong>: 移动游戏中的所有子弹。</li><li><strong><code>check_bullet_monster_collision</code></strong>: 检测子弹与怪物之间的碰撞。如果发生碰撞，增加玩家的得分、金币和经验值。若子弹具有穿透能力，减少其穿透次数。</li><li><strong><code>check_monster_wall_collision</code></strong>: 检测怪物是否碰撞到墙。如果碰撞到墙，减少玩家的生命值。</li><li><strong><code>remove_offscreen_objects</code></strong>: 移除屏幕外的子弹和怪物。</li><li><strong><code>is_collision</code></strong>: 简单的碰撞检测逻辑，用于判断两个对象是否碰撞。</li><li><strong><code>is_on_screen</code></strong>: 检查对象是否还在屏幕内。</li><li><strong><code>get_monster_spawn_interval</code></strong>: 计算怪物生成的间隔时间，随玩家等级提高而减少。</li><li><strong><code>bullet_shoot_interval</code></strong>: 返回玩家当前的子弹发射间隔。</li><li><strong><code>check_for_upgrade</code></strong>: 检查玩家是否满足升级条件。如果满足，允许玩家进行升级，并处理游戏胜利逻辑。</li></ul> 
<h3><a id="34__events_and_rewardspy_481"></a>3.4 事件和奖励 (<code>events_and_rewards.py</code>)</h3> 
<p><code>EventsAndRewards</code> 类通过随机事件为游戏增加了不可预测性和多样性。这些事件不仅增加了游戏的趣味性，还为玩家提供了额外的挑战和奖励。这种机制可以进一步扩展，比如增加更多的事件类型、调整奖励规则或修改触发概率，以创造更丰富的游戏体验。通过与 <code>GameLogic</code> 类的交互，<code>EventsAndRewards</code> 类能够有效地融入游戏的总体框架中。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> random


<span class="token keyword">class</span> <span class="token class-name">EventsAndRewards</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> game_logic<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>events <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"bonus_coin"</span><span class="token punctuation">,</span> <span class="token string">"sudden_attack"</span><span class="token punctuation">,</span> <span class="token string">"treasure_chest"</span><span class="token punctuation">]</span>
        self<span class="token punctuation">.</span>rewards <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"bonus_coin"</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">"sudden_attack"</span><span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">"treasure_chest"</span><span class="token punctuation">:</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token punctuation">}</span>
        self<span class="token punctuation">.</span>trigger_probability <span class="token operator">=</span> <span class="token number">0.1</span>  <span class="token comment"># 设置触发概率为10%</span>
        self<span class="token punctuation">.</span>game_logic <span class="token operator">=</span> game_logic

    <span class="token keyword">def</span> <span class="token function">trigger_random_event</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 使用随机数决定是否触发事件</span>
        <span class="token keyword">if</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>trigger_probability<span class="token punctuation">:</span>
            <span class="token comment"># 如果触发，随机选择一个事件</span>
            event <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>self<span class="token punctuation">.</span>events<span class="token punctuation">)</span>
            <span class="token keyword">return</span> event
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 如果不触发，返回None或其他标记</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>

    <span class="token keyword">def</span> <span class="token function">apply_event_effects</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> event <span class="token operator">==</span> <span class="token string">"bonus_coin"</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>handle_bonus_coin<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> event <span class="token operator">==</span> <span class="token string">"sudden_attack"</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>handle_sudden_attack<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> event <span class="token operator">==</span> <span class="token string">"treasure_chest"</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>handle_treasure_chest<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">handle_bonus_coin</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>game_logic<span class="token punctuation">.</span>player<span class="token punctuation">.</span>money <span class="token operator">=</span> self<span class="token punctuation">.</span>game_logic<span class="token punctuation">.</span>player<span class="token punctuation">.</span>money <span class="token operator">+</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>rewards<span class="token punctuation">[</span><span class="token string">"bonus_coin"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">handle_sudden_attack</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        shoot_count <span class="token operator">=</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>rewards<span class="token punctuation">[</span><span class="token string">"sudden_attack"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>shoot_count<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>game_logic<span class="token punctuation">.</span>player<span class="token punctuation">.</span>shoot<span class="token punctuation">(</span>self<span class="token punctuation">.</span>game_logic<span class="token punctuation">.</span>bullets<span class="token punctuation">,</span> self<span class="token punctuation">.</span>game_logic<span class="token punctuation">.</span>monsters<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">handle_treasure_chest</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>game_logic<span class="token punctuation">.</span>player<span class="token punctuation">.</span>money <span class="token operator">=</span> self<span class="token punctuation">.</span>game_logic<span class="token punctuation">.</span>player<span class="token punctuation">.</span>money <span class="token operator">+</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>rewards<span class="token punctuation">[</span><span class="token string">"treasure_chest"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>这段代码负责在游戏中触发和处理各种随机事件以及给予相应的奖励。以下是对其主要组成部分的解析：</p> 
<h4><a id="341_EventsAndRewards__525"></a>3.4.1 <code>EventsAndRewards</code> 类</h4> 
<ul><li><strong>构造函数 (<code>__init__</code>)</strong>: 初始化事件处理器，设置事件类型、对应奖励和触发概率。</li><li><strong>属性</strong>: 
  <ul><li><code>events</code>: 可能发生的事件列表（如 “bonus_coin”, “sudden_attack”, “treasure_chest”）。</li><li><code>rewards</code>: 每个事件对应的奖励。</li><li><code>trigger_probability</code>: 事件触发的概率。</li><li><code>game_logic</code>: 游戏逻辑对象，用于访问和修改游戏状态。</li></ul> </li></ul> 
<h4><a id="342__533"></a>3.4.2 方法</h4> 
<ul><li><strong><code>trigger_random_event</code></strong>: 根据设定的概率随机决定是否触发一个事件。如果触发，随机选择并返回一个事件；否则返回 <code>None</code>。</li><li><strong><code>apply_event_effects</code></strong>: 根据触发的事件类型，调用相应的处理方法。</li><li><strong><code>handle_bonus_coin</code></strong>: 处理“bonus_coin”事件，随机增加玩家的金币数量。</li><li><strong><code>handle_sudden_attack</code></strong>: 处理“sudden_attack”事件，使玩家自动发射一定数量的子弹。</li><li><strong><code>handle_treasure_chest</code></strong>: 处理“treasure_chest”事件，随机增加玩家的金币数量。</li></ul> 
<h3><a id="35__game_uipy_541"></a>3.5 游戏界面 (<code>game_ui.py</code>)</h3> 
<p><code>GameUI</code> 类负责游戏中所有与用户界面相关的视觉元素的显示，包括分数、生命值、金钱等。它还处理玩家与升级菜单的交互，允许玩家使用金币来选择不同的升级选项。这个类将游戏逻辑与用户界面清晰地分离开来，使得游戏的代码更加模块化和易于管理。通过这种方式，可以更容易地进行UI的更新和改进，以提供更好的玩家体验。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np


<span class="token keyword">class</span> <span class="token class-name">GameUI</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> window_size<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>window_size <span class="token operator">=</span> window_size
        self<span class="token punctuation">.</span>font <span class="token operator">=</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX
        self<span class="token punctuation">.</span>font_scale <span class="token operator">=</span> <span class="token number">0.5</span>
        self<span class="token punctuation">.</span>font_color <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>line_type <span class="token operator">=</span> <span class="token number">1</span>

    <span class="token keyword">def</span> <span class="token function">draw_score</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> window<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span>
        cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'Score: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>score<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>font<span class="token punctuation">,</span> self<span class="token punctuation">.</span>font_scale<span class="token punctuation">,</span> self<span class="token punctuation">.</span>font_color<span class="token punctuation">,</span> self<span class="token punctuation">.</span>line_type<span class="token punctuation">,</span>
                    lineType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">draw_health</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> window<span class="token punctuation">,</span> health<span class="token punctuation">)</span><span class="token punctuation">:</span>
        cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'Health: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>health<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>font<span class="token punctuation">,</span> self<span class="token punctuation">.</span>font_scale<span class="token punctuation">,</span> self<span class="token punctuation">.</span>font_color<span class="token punctuation">,</span> self<span class="token punctuation">.</span>line_type<span class="token punctuation">,</span>
                    lineType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">draw_money</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> window<span class="token punctuation">,</span> money<span class="token punctuation">)</span><span class="token punctuation">:</span>
        cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'Coins: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">int</span><span class="token punctuation">(</span>money<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>font<span class="token punctuation">,</span> self<span class="token punctuation">.</span>font_scale<span class="token punctuation">,</span> self<span class="token punctuation">.</span>font_color<span class="token punctuation">,</span> self<span class="token punctuation">.</span>line_type<span class="token punctuation">,</span>
                    lineType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">draw_experience</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> window<span class="token punctuation">,</span> experience<span class="token punctuation">)</span><span class="token punctuation">:</span>
        cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'EXP: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>experience<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>font<span class="token punctuation">,</span> self<span class="token punctuation">.</span>font_scale<span class="token punctuation">,</span> self<span class="token punctuation">.</span>font_color<span class="token punctuation">,</span> self<span class="token punctuation">.</span>line_type<span class="token punctuation">,</span>
                    lineType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">draw_level</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> window<span class="token punctuation">,</span> level<span class="token punctuation">)</span><span class="token punctuation">:</span>
        cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'Level: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>level<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>font<span class="token punctuation">,</span> self<span class="token punctuation">.</span>font_scale<span class="token punctuation">,</span> self<span class="token punctuation">.</span>font_color<span class="token punctuation">,</span> self<span class="token punctuation">.</span>line_type<span class="token punctuation">,</span>
                    lineType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">draw_upgrade_menu</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> window<span class="token punctuation">,</span> upgrades<span class="token punctuation">)</span><span class="token punctuation">:</span>
        start_y <span class="token operator">=</span> <span class="token number">100</span>
        cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string">'Upgrades:'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> start_y<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>font<span class="token punctuation">,</span> self<span class="token punctuation">.</span>font_scale<span class="token punctuation">,</span> self<span class="token punctuation">.</span>font_color<span class="token punctuation">,</span> self<span class="token punctuation">.</span>line_type<span class="token punctuation">,</span>
                    lineType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> upgrade <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>upgrades<span class="token punctuation">)</span><span class="token punctuation">:</span>
            text <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">}</span></span><span class="token string">. </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>upgrade<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string"> - Cost: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>upgrade<span class="token punctuation">[</span><span class="token string">'cost'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
            cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>window<span class="token punctuation">,</span> text<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> start_y <span class="token operator">+</span> <span class="token number">20</span> <span class="token operator">*</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>font<span class="token punctuation">,</span> self<span class="token punctuation">.</span>font_scale<span class="token punctuation">,</span> self<span class="token punctuation">.</span>font_color<span class="token punctuation">,</span>
                        self<span class="token punctuation">.</span>line_type<span class="token punctuation">,</span> lineType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">clear_window</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> window<span class="token punctuation">,</span> player<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 清空窗口</span>
        window<span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token comment"># 绘制UI</span>
        self<span class="token punctuation">.</span>draw_score<span class="token punctuation">(</span>window<span class="token punctuation">,</span> player<span class="token punctuation">.</span>score<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>draw_health<span class="token punctuation">(</span>window<span class="token punctuation">,</span> player<span class="token punctuation">.</span>health<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>draw_money<span class="token punctuation">(</span>window<span class="token punctuation">,</span> player<span class="token punctuation">.</span>money<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>draw_experience<span class="token punctuation">(</span>window<span class="token punctuation">,</span> player<span class="token punctuation">.</span>experience<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>draw_level<span class="token punctuation">(</span>window<span class="token punctuation">,</span> player<span class="token punctuation">.</span>level<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">show_upgrade_menu</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> window<span class="token punctuation">,</span> player<span class="token punctuation">)</span><span class="token punctuation">:</span>
        upgrade_options <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Increase Bullet"</span><span class="token punctuation">,</span> <span class="token string">"Piercing Bullet"</span><span class="token punctuation">,</span> <span class="token string">"Tracking Bullet"</span><span class="token punctuation">]</span>
        upgrade_costs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">10</span> <span class="token operator">*</span> player<span class="token punctuation">.</span>shoot_interval_multiplier<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token number">20</span> <span class="token operator">*</span> player<span class="token punctuation">.</span>piercing_bullet_multiplier<span class="token punctuation">)</span><span class="token punctuation">,</span>
                         <span class="token number">500</span><span class="token punctuation">]</span>  <span class="token comment"># 升级成本</span>
        return_option <span class="token operator">=</span> <span class="token boolean">None</span>
        text_cord <span class="token operator">=</span> <span class="token number">200</span>

        <span class="token keyword">def</span> <span class="token function">mouse_callback</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> flags<span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">nonlocal</span> return_option
            <span class="token keyword">if</span> event <span class="token operator">==</span> cv2<span class="token punctuation">.</span>EVENT_LBUTTONDOWN<span class="token punctuation">:</span>
                <span class="token keyword">for</span> i<span class="token punctuation">,</span> option <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>upgrade_options<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> text_cord <span class="token operator">-</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token punctuation">(</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">30</span> <span class="token operator">&lt;=</span> y <span class="token operator">&lt;=</span> text_cord <span class="token operator">+</span> <span class="token number">10</span> <span class="token operator">+</span> i <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">:</span>  <span class="token comment"># 按钮位置</span>
                        <span class="token keyword">if</span> player<span class="token punctuation">.</span>money <span class="token operator">&gt;=</span> upgrade_costs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">:</span>
                            <span class="token keyword">if</span> option <span class="token operator">==</span> <span class="token string">"Tracking Bullet"</span> <span class="token keyword">and</span> player<span class="token punctuation">.</span>tracking_bullet <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                                return_option <span class="token operator">=</span> option
                            <span class="token keyword">elif</span> option <span class="token operator">!=</span> <span class="token string">"Tracking Bullet"</span><span class="token punctuation">:</span>
                                return_option <span class="token operator">=</span> option
                        <span class="token keyword">else</span><span class="token punctuation">:</span>
                            cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string">"Not Enough Coins"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> text_cord <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>upgrade_options<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                        cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span>
                                        <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> lineType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>
                        <span class="token keyword">break</span>
                <span class="token comment"># Cancel位置</span>
                <span class="token keyword">if</span> text_cord <span class="token operator">-</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>upgrade_options<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">30</span> <span class="token operator">&lt;=</span> y <span class="token operator">&lt;=</span> text_cord <span class="token operator">+</span> <span class="token number">10</span> <span class="token operator">+</span> <span class="token punctuation">(</span>
                        <span class="token builtin">len</span><span class="token punctuation">(</span>upgrade_options<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">:</span>
                    return_option <span class="token operator">=</span> <span class="token string">"Cancel"</span>
                    <span class="token keyword">return</span> return_option

        cv2<span class="token punctuation">.</span>setMouseCallback<span class="token punctuation">(</span><span class="token string">"Game Window"</span><span class="token punctuation">,</span> mouse_callback<span class="token punctuation">)</span>

        <span class="token keyword">while</span> return_option <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            cv2<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> text_cord <span class="token operator">-</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token punctuation">(</span>window<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">,</span> text_cord <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>upgrade_options<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> lineType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>
            <span class="token comment"># 显示升级选项</span>
            <span class="token keyword">for</span> i<span class="token punctuation">,</span> option <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>upgrade_options<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> player<span class="token punctuation">.</span>tracking_bullet <span class="token keyword">is</span> <span class="token boolean">True</span> <span class="token keyword">and</span> option <span class="token operator">==</span> <span class="token string">"Tracking Bullet"</span><span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                text <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>option<span class="token punctuation">}</span></span><span class="token string"> - Coins: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>upgrade_costs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">"</span></span>
                cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>window<span class="token punctuation">,</span> text<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> text_cord <span class="token operator">+</span> i <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span>
                            lineType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>

            cv2<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>window<span class="token punctuation">,</span> <span class="token string">"Cancel"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> text_cord <span class="token operator">+</span> <span class="token builtin">len</span><span class="token punctuation">(</span>upgrade_options<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX<span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">,</span>
                        <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> lineType<span class="token operator">=</span>cv2<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span>

            cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">"Game Window"</span><span class="token punctuation">,</span> window<span class="token punctuation">)</span>
            cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

        cv2<span class="token punctuation">.</span>setMouseCallback<span class="token punctuation">(</span><span class="token string">"Game Window"</span><span class="token punctuation">,</span> <span class="token keyword">lambda</span> <span class="token operator">*</span>args<span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">)</span>  <span class="token comment"># 移除鼠标事件</span>
        <span class="token keyword">return</span> return_option

</code></pre> 
<p>这段代码定义了一个名为 <code>GameUI</code> 的类，用于在游戏中显示用户界面（UI），包括得分、生命值、金币、经验值和等级，以及处理升级菜单的显示和交互。以下是对其主要组成部分的解析：</p> 
<h4><a id="351_GameUI__651"></a>3.5.1 <code>GameUI</code> 类</h4> 
<ul><li><strong>构造函数 (<code>__init__</code>)</strong>: 初始化UI的一些基础设置，如窗口大小、字体、字体大小、字体颜色和线型。</li><li><strong>属性</strong>: 
  <ul><li><code>window_size</code>: 游戏窗口的大小。</li><li><code>font</code>, <code>font_scale</code>, <code>font_color</code>, <code>line_type</code>: 用于绘制文本的字体设置。</li></ul> </li></ul> 
<h4><a id="352_UI_657"></a>3.5.2 绘制UI的方法</h4> 
<ul><li><strong><code>draw_score</code></strong>: 在窗口上绘制玩家的得分。</li><li><strong><code>draw_health</code></strong>: 在窗口上绘制玩家的生命值。</li><li><strong><code>draw_money</code></strong>: 在窗口上绘制玩家的金币数量。</li><li><strong><code>draw_experience</code></strong>: 在窗口上绘制玩家的经验值。</li><li><strong><code>draw_level</code></strong>: 在窗口上绘制玩家的等级。</li></ul> 
<h4><a id="353__664"></a>3.5.3 升级菜单</h4> 
<ul><li><strong><code>draw_upgrade_menu</code></strong>: 绘制升级选项的菜单。</li><li><strong><code>clear_window</code></strong>: 清空窗口并重新绘制所有UI元素。</li><li><strong><code>show_upgrade_menu</code></strong>: 显示升级菜单，并处理玩家的升级选择。这个方法包含了一个鼠标回调函数 <code>mouse_callback</code>，用于处理玩家点击升级选项时的交互。</li></ul> 
<hr> 
<h2><a id="_673"></a>总结</h2> 
<p>这个游戏在玩法流程上还不够完善，但是也展示了如何使用Python和OpenCV来创建有趣的游戏体验。通过将游戏代码模块化，我们不仅使代码更加清晰易懂，也方便了未来的维护和扩展。这个项目是理解游戏开发基础和练习编程技能的绝佳途径。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7fe21ff95eb17a9ce4025a4b0e10a0b0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SQL语法实践（三）：一些问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7f3fb5eeb59cf59766aa773a21062486/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">rest_framework_django学习笔记一(序列化器)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>