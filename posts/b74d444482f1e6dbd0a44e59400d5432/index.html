<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>学会正确地二次封装组件，让同事抱着你的大腿喊大神！ - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="学会正确地二次封装组件，让同事抱着你的大腿喊大神！" />
<meta property="og:description" content="highlight: a11y-dark 一、二次封装的需求场景 二次封装，是指因为业务上的需要，对element-ui、antd、e-chart等其他组件库，做二次封装。以下是常见的二次封装场景：
1.封装UI样式 说个我做项目遇到的情况，项目里用到组件库的是antd，antd的搜索框长这样
但是ui图长这样：
如果要实现和ui图一样的效果，你就需要利用前缀和后缀的插槽，加上搜索图标和清空图标：
&lt;a-input :placeholder=&#34;placeholder&#34; :style=&#34;inputStyle&#34; @keydown.enter=handleEnter v-model=&#34;searchValue&#34; @change=&#34;searchValueChange&#34;&gt; &lt;a-icon slot=&#34;prefix&#34; type=&#34;search&#34;/&gt; &lt;a-icon slot=&#34;suffix&#34; v-show=&#34;searchValue!=&#39;&#39; || manualHide&#34; type=&#34;close&#34; style=&#34;cursor: pointer&#34; @click=&#34;clearSearchValue&#34;/&gt; &lt;/a-input&gt; 有时还需要改改样式：
&lt;style lang=&#34;less&#34; scoped&gt; /deep/ .ant-input:hover { border-color: #f5222d; } /deep/ .ant-input:focus { border-color: #ff4d4f; box-shadow: 0 0 0 2px rgba(245, 34, 45, 0.2); } &lt;/style&gt; 那么这样就带来一个问题，要知道搜索框可是复用频率很高的，如果每次都需要粘贴同样的插槽和样式代码，那不是很憨憨吗？
而且后期维护，如果要改搜索框的样式，那就得改好几处地方，所以这一段组件是一定要封装的。
2.封装业务逻辑 在真实的项目中，我们需要封装一些与业务数据绑定的选择器。
比如下面这个表格选择器，在文件夹里面选择用户上传的表。基本项目所有业务都是需要选表的，所以这个组件复用频率很高。
这种业务组件的特点是，组件会带有很多业务数据请求的方法，比如下面这种请求后台数据，然后把数据绑定在表格组件上。
loadData(arg) { let params = this.getQueryParams()//查询条件 this.loading = true queryFolderList(params).then((res) =&gt; { if (!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b74d444482f1e6dbd0a44e59400d5432/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-06T12:54:02+08:00" />
<meta property="article:modified_time" content="2022-06-06T12:54:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">学会正确地二次封装组件，让同事抱着你的大腿喊大神！</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <hr> 
<h3><a id="highlight_a11ydark_2"></a>highlight: a11y-dark</h3> 
<h2><a id="_4"></a>一、二次封装的需求场景</h2> 
<p>二次封装，是指因为业务上的需要，对element-ui、antd、e-chart等其他组件库，做二次封装。以下是常见的二次封装场景：</p> 
<h3><a id="1UI_6"></a>1.封装UI样式</h3> 
<p>说个我做项目遇到的情况，项目里用到组件库的是antd，antd的搜索框长这样<br> <img src="https://images2.imgbox.com/01/7d/Wl13ptzA_o.png" alt=""></p> 
<p>但是ui图长这样：<br> <img src="https://images2.imgbox.com/e7/bc/w98YcvxJ_o.png" alt=""><br> 如果要实现和ui图一样的效果，你就需要利用前缀和后缀的插槽，加上搜索图标和清空图标：</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-input</span> <span class="token attr-name">:placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>placeholder<span class="token punctuation">"</span></span> <span class="token attr-name">:style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>inputStyle<span class="token punctuation">"</span></span> <span class="token attr-name">@keydown.enter</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>handleEnter</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>searchValue<span class="token punctuation">"</span></span>
           <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>searchValueChange<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-icon</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>prefix<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>search<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-icon</span> <span class="token attr-name">slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>suffix<span class="token punctuation">"</span></span> <span class="token attr-name">v-show</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>searchValue!=<span class="token punctuation">'</span><span class="token punctuation">'</span> || manualHide<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>close<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">cursor</span><span class="token punctuation">:</span> pointer</span><span class="token punctuation">"</span></span></span>
            <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>clearSearchValue<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-input</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>有时还需要改改样式：</p> 
<pre><code class="prism language-css"><span class="token selector">&lt;style lang="less" scoped&gt;
/deep/ .ant-input:hover</span> <span class="token punctuation">{<!-- --></span>
  <span class="token property">border-color</span><span class="token punctuation">:</span> #f5222d<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">/deep/ .ant-input:focus</span> <span class="token punctuation">{<!-- --></span>
  <span class="token property">border-color</span><span class="token punctuation">:</span> #ff4d4f<span class="token punctuation">;</span>
  <span class="token property">box-shadow</span><span class="token punctuation">:</span> 0 0 0 2px <span class="token function">rgba</span><span class="token punctuation">(</span>245<span class="token punctuation">,</span> 34<span class="token punctuation">,</span> 45<span class="token punctuation">,</span> 0.2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
&lt;/style&gt;
</code></pre> 
<p>那么这样就带来一个问题，要知道搜索框可是复用频率很高的，如果每次都需要粘贴同样的插槽和样式代码，那不是很憨憨吗？</p> 
<p>而且后期维护，如果要改搜索框的样式，那就得改好几处地方，所以这一段组件是一定要封装的。</p> 
<h3><a id="2_42"></a>2.封装业务逻辑</h3> 
<p>在真实的项目中，我们需要封装一些与业务数据绑定的选择器。<br> 比如下面这个表格选择器，在文件夹里面选择用户上传的表。基本项目所有业务都是需要选表的，所以这个组件复用频率很高。<br> <img src="https://images2.imgbox.com/fe/0e/556C7kAb_o.png" alt=""><br> 这种业务组件的特点是，组件会带有很多业务数据请求的方法，比如下面这种请求后台数据，然后把数据绑定在表格组件上。</p> 
<pre><code class="prism language-javascript"><span class="token function">loadData</span><span class="token punctuation">(</span><span class="token parameter">arg</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> params <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getQueryParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//查询条件</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token function">queryFolderList</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>res<span class="token punctuation">.</span>success<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>$notify<span class="token punctuation">[</span><span class="token string">'error'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
              key<span class="token operator">:</span> <span class="token string">'ErrorNotificationKey'</span><span class="token punctuation">,</span>
              message<span class="token operator">:</span> <span class="token string">'操作信息提示'</span><span class="token punctuation">,</span>
              description<span class="token operator">:</span> res<span class="token punctuation">.</span>message
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>dataSource <span class="token operator">=</span> res<span class="token punctuation">.</span>list
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">finally</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token punctuation">,</span> 
</code></pre> 
<p>这种业务组件是需要封装的，因为如果不封装，每次遇到同样的场景，就要把这些数据接口请求再粘贴一次，这种操作属实有点憨憨，所以一定要封装。</p> 
<h3><a id="3_68"></a>3.补充功能</h3> 
<p>有时候我们的组件还需要拓展功能，这种场景也是需要封装的，比如antd表格的基础表格是没有筛选的，<br> <img src="https://images2.imgbox.com/2d/a9/ZmKiMVJ0_o.png" alt=""><br> 要实现列筛选功能，是需要我们自己手写逻辑的，那么我们就应该把这段补充的逻辑封装在组件里。</p> 
<h2><a id="_74"></a>二、二次封装的原则事项</h2> 
<h3><a id="1props_75"></a>1.必须暴露组件的所有props、事件、插槽和方法</h3> 
<p>如果做二次封装，没有暴露组件库本身的属性和方法。那说实话，你这不叫封装组件，你这叫“坐牢”，只有封没有装那能叫封装吗？</p> 
<p>还是以封装antd的输入框为例，我只是对样式做了一些更改，那么antd输入框中的props、事件、插槽和方法，是应该暴露出来给父组件的，否则封装的组件压根就没法用。<br> <img src="https://images2.imgbox.com/6f/ed/rQGGudYu_o.png" alt=""></p> 
<p>那我这里怎么绑定呢？不可能一个个照着文档把props全绑上去吧？</p> 
<pre><code>&lt;a-input placeholder="placeholder" :defaultValue="defaultValue"
         :disabled="disabled" @change="onChange" :maxLength="maxLength" /&gt;
</code></pre> 
<pre><code class="prism language-javascript"><span class="token comment">//憨憨的做法：照着文档一个个地绑定props</span>
<span class="token literal-property property">props</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">placeholder</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">defaultValue</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">''</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">//把所有的props一个个填上去......</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>真当程序员是码农啊？别干这些“重复”的体力活了，具体怎么做呢？这里讲一下封装技巧：</p> 
<h4><a id="1attrsprops_105"></a>1）绑定$attrs暴露props</h4> 
<p>实现思路：用计算属性获取this.$attrs的值，然后用v-bind绑定，下面antd的弹窗组件为例：<br> HTML</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-modal</span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_attrs<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>将一些未处理的参数或特殊处理的参数绑定到 a-modal 上</p> 
<pre><code class="prism language-js"><span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">_attrs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">let</span> attrs <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token operator">...</span><span class="token keyword">this</span><span class="token punctuation">.</span>$attrs <span class="token punctuation">}</span>
      <span class="token keyword">return</span> attrs
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="2listeners_126"></a>2）绑定$listeners暴露事件</h4> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-modal</span>
    <span class="token attr-name">@ok</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleOk<span class="token punctuation">"</span></span>
    <span class="token attr-name">@cancel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleCancel<span class="token punctuation">"</span></span>
  <span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>其实这里我们需要抛change等事件给父组件，如果一个一个事件的写emit太憨了，有十个emit难道手动写十次emit吗？</p> 
<p>下面推荐一个简单的方法：<code>v-on="$listeners"</code></p> 
<p>这段代码可以动态捕捉到emit事件</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-modal</span>
    <span class="token attr-name">v-on</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>$listeners<span class="token punctuation">"</span></span>
  <span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>这样就不用手动再抛事件，给a-modal的组件了。<br> 但是在开发中，我们有时需要覆写组件的@change等方法，那么这里需要就注意一个问题：</p> 
<p><strong>v-on=“$listeners“与重写事件有冲突，会执行两次。</strong></p> 
<p>说直白点就是，如果你手动写了v-on=“$listeners”，然后你又自己重写了其中的事件，那么这个事件就会执行两次。</p> 
<p>比如 element 组件 el-select，change 事件重写，返回更多的参数：</p> 
<pre><code>&lt;el-select @change="changeSelect" v-on="$listeners"&gt;xxx&lt;/el-select&gt;

method: {
	changeSelect(val) {
		this.$emit('change', val) 
	}
}
</code></pre> 
<p>使用：</p> 
<pre><code>&lt;EccSelect @change="selectChange"&gt;&lt;/EccSelect&gt;
</code></pre> 
<p>结果： 执行2次 , 多一个 undefined<br> 第一个是v-on=“$listeners”，第二个是@change="onSelectChange</p> 
<p><img src="https://images2.imgbox.com/1d/d4/gV2Y6mfE_o.png" alt=""></p> 
<p>解决：<br> <strong>去掉 @change=“changeSelect”， 使用 new$listeners 继承原有属性，并覆盖原有事件</strong></p> 
<pre><code>&lt;el-select v-on="new$listeners"&gt;xxx&lt;/el-select&gt;
computed: {
    new$listeners() {
      return Object.assign(this.$listeners, {
       //在这里覆盖原有的change事件
        change: this.changeSelect
      })
    }
  },
  method: {
	changeSelect(val) {
         //你自己的业务逻辑
         //...
	      this.$emit('change', val) 
	}
  }
</code></pre> 
<h4><a id="3slotsscopedSlots_200"></a>3）绑定<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         s 
        
       
         l 
        
       
         o 
        
       
         t 
        
       
         s 
        
       
         和 
        
       
      
        slots和 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span><span class="mord mathdefault">s</span><span class="mord cjk_fallback">和</span></span></span></span></span>scopedSlots暴露插槽</h4> 
<p>同样的道理，插槽也是必须要暴露给父组件的，主要靠Vue提供的<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         s 
        
       
         l 
        
       
         o 
        
       
         t 
        
       
         s 
        
       
         和 
        
       
      
        slots和 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault">s</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">t</span><span class="mord mathdefault">s</span><span class="mord cjk_fallback">和</span></span></span></span></span>scopedSlots，具体方法如下：</p> 
<pre><code class="prism language-html">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-modal</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 处理 scopedSlots --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>slotName of scopedSlotsKeys<span class="token punctuation">"</span></span> <span class="token attr-name">:slot</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>slotName<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">:name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>slotName<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- 处理 slots --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>slotName of slotsKeys<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">v-slot:</span>[slotName]</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slot</span> <span class="token attr-name">:name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>slotName<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slot</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-modal</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>计算属性拿到父组件注册的插槽：</p> 
<pre><code class="prism language-javascript"><span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">slotsKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>usedSlots<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">scopedSlotsKeys</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$scopedSlots<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>usedSlots<span class="token punctuation">.</span><span class="token function">includes</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<h4><a id="4_229"></a>4）暴露实例的方法</h4> 
<p>拿element-ui的 <strong>「Cascader级联选择器」</strong> 来说吧，我有一个需求，需要用到getCheckedNodes()这个方法<br> <img src="https://images2.imgbox.com/b4/b6/n2PuFqVn_o.png" alt=""></p> 
<p>这里是我的父组件要调用这个方法，如果手动的注册事件，一层层的传递也挺麻烦。</p> 
<pre><code class="prism language-javascript"><span class="token comment">//二次封装组件</span>
<span class="token literal-property property">methods</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">getCheckedNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>cascader<span class="token punctuation">.</span><span class="token function">getCheckedNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">toggleDropDownVisible</span><span class="token punctuation">(</span><span class="token parameter">visible</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>cascader<span class="token punctuation">.</span><span class="token function">toggleDropDownVisible</span><span class="token punctuation">(</span>visible<span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>具体调用方法如下，二次封装的组件暴露出实例，利用实例再调用element内部的方法：</p> 
<pre><code class="prism language-javascript"><span class="token comment">//二次封装组件</span>
<span class="token literal-property property">methods</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">getCascader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>cascader
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>父组件要调用实例方法，可以先获取实例，再调用方法（即链式调用）：</p> 
<pre><code class="prism language-javascript"><span class="token comment">//引入上面封装组件的父组件</span>
<span class="token literal-property property">methods</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">loadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>child<span class="token punctuation">.</span><span class="token function">getCascader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCheckedNodes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>child<span class="token punctuation">.</span><span class="token function">getCascader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toggleDropDownVisible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
            <span class="token comment">//只要拿到这个实例，this.$refs.child.getCascader()，想调方法后面跟链式调用即可</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>讲完了具体的方法，我们再来讲一些封装的原则，遵守这些规范，你能少加很多班~<br> PS：别问我是怎么总结出来的，都是实战中的血与泪╮(╯﹏╰）╭</p> 
<h3><a id="2_279"></a>2.二次封装的原则</h3> 
<h4><a id="1propsprops_280"></a>1）搞清楚哪些是props，不要修改props的数据</h4> 
<p>慎重封装跟业务有关的代码，你可以根据一个原则来判断，如果业务接口更新的是<code>props</code>中的数据，那就不要这段业务代码，放到父组件去做更好。因为这样会破坏vue的单向数据流，带来维护上的困难。<br> 举个我自己遇到的坑，下面这个表格组件，写了一个业务接口，是更新表格的dataSource。</p> 
<pre><code>methods:{
    loadData(){
        getData().then((res) =&gt; {
           this.dataSource = res.simpleDataList
        })
       }
    }
}

</code></pre> 
<p>而这个属性是实际上是antd表格组件的<code>props</code>。<br> <img src="https://images2.imgbox.com/7d/6d/ea7nyGok_o.png" alt=""><br> 我这里犯得错误是，我没有把它定义为<code>props</code>，而是放在了<code>data</code>里：</p> 
<pre><code>data() {
    return {
        dataSource:[]
    }
}
</code></pre> 
<p>这就违背我上面说的第一条原则，一定要暴露封装组件的所有<code>props</code>，所以这个属性不应该是<code>data</code>，而是<code>props</code>。而我这里更新了本该是props的数据，这就是组件封装上很严重的问题，我的父组件想改变dataSource变得很困难，这给我后面的维护带来了无尽的折磨…</p> 
<p>不要修改<code>props</code>的数据（这样写控制台会报错）<br> 更不要修改<strong>本该是props</strong>的数据。</p> 
<h4><a id="2vue_311"></a>2）不要在vue文件里封装多个数据入口</h4> 
<p><strong>不要在一个vue文件内，封装多个数据的入口处理，你应该遵守“单一职责”。</strong></p> 
<p>这次的反面教材，还是上面说的数据表组件。</p> 
<p>由于加载数据表有很多个接口，每个接口的参数又不一样，当时就把很多个接口分别做成多个入口方法，但这样后期维护很难受，因为这个接口是应该我父组件去请求的，每次后台更新接口参数，放在子组件我就很难维护，因为跟业务耦合的太死了。<br> <img src="https://images2.imgbox.com/02/7b/UFO1EKni_o.png" alt=""><br> 所以后面这个组件我直接重写了，定位为纯展示的组件，只加了样式的优化，还有添加筛选功能。所有的数据，都由父组件来传props控制。<br> 所以，当你发现一个组件要耦合多个数据入口时，就不要把请求写在子组件里面，而是把这个组件改造为纯展示组件，跟业务解耦，把业务请求交给父组件。</p> 
<p>要不然随着后期业务的变化，你的维护成本会变得越来越高。</p> 
<h4><a id="3_323"></a>3）载体分离原则</h4> 
<p>内容和载体要分两个vue文件，内容是页面的主要内容，载体是展示的方式，例如弹窗、抽屉等等。</p> 
<p>比如说一个表单填写的弹窗的页面，应该分为：表单vue文件，和弹窗vue文件两种。<br> 还是以代码为例：</p> 
<pre><code class="prism language-html"><span class="token comment">&lt;!--错误的封装：内容和载体写在一起--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bar-title-modal</span> <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">:width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width<span class="token punctuation">"</span></span> <span class="token attr-name">:visible</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>visible<span class="token punctuation">"</span></span><span class="token attr-name">@ok</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleOk<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-form</span> <span class="token attr-name">:form</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>form<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>用户选择<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 500px</span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>j-select-multi-user</span> <span class="token attr-name">v-decorator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>[<span class="token punctuation">'</span>users<span class="token punctuation">'</span>]<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
      {<!-- -->{ getFormFieldValue('users') }}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-form-item</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-form-item</span> <span class="token attr-name">label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>用户选择<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">width</span><span class="token punctuation">:</span> 500px</span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>j-select-multi-user</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>users<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>j-select-multi-user</span><span class="token punctuation">&gt;</span></span>
      {<!-- -->{ users }}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-form-item</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-form</span> <span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bar-title-modal</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--注：bar-title-modal是一个弹窗组件--&gt;</span>
</code></pre> 
<p>正确的做法是把是表单内容单独封装为data-form组件，而弹窗组件作为载体的组件，</p> 
<pre><code class="prism language-html"><span class="token comment">&lt;!--正确的封装：内容和载体分开解耦--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bar-title-modal</span> <span class="token attr-name">:title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>title<span class="token punctuation">"</span></span> <span class="token attr-name">:width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width<span class="token punctuation">"</span></span> <span class="token attr-name">:visible</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>visible<span class="token punctuation">"</span></span><span class="token attr-name">@ok</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>handleOk<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>data-form</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>realForm<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>data-form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bar-title-modal</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>这样就能保证表单内容组件的复用。比如你下一次不需要在弹窗里放表单了，而是直接在页面上展示，或者换成抽屉其他载体，<strong>你就不需要单独把表单这段代码复制来复制去了。</strong></p> 
<p>遵守<strong>载体分离原则</strong>，解耦内容和载体，就能方便后期的拓展开发。</p> 
<h2><a id="_360"></a>三、二次封装的其他实操技巧</h2> 
<h3><a id="1_361"></a>1.实现双向绑定，简化事件处理</h3> 
<p>我们封装输入框、复选框这种组件的时候，还需要保留他们的<code>v-model</code>，这样父组件在调用的时候也能保持数据的双向绑定，使用得更加丝滑!</p> 
<p>以封装antd的单选框、复选框等类型的输入控件</p> 
<pre><code class="prism language-html">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-radio-group</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>value<span class="token punctuation">"</span></span> <span class="token attr-name">@change</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>onChange<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-radio</span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        A
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-radio</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-radio</span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        B
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-radio</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a-radio</span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>3<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        C
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-radio</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a-radio-group</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>接下来我们写好model、props和change事件即可</p> 
<pre><code class="prism language-js"><span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">model</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">prop</span><span class="token operator">:</span> <span class="token string">'value'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">event</span><span class="token operator">:</span> <span class="token string">'change'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">value</span><span class="token operator">:</span> String
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">methods</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
      <span class="token function">onChange</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'change'</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>现在在这个组件上使用<code>v-model</code>的时候：</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>base-checkbox</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myValue<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>base-checkbox</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>这里的 myValue 的值将会传入这个名为 <code>value</code> 的 prop。<br> 同时当  触发一个 <code>change</code> 事件并附带一个新的值的时候，这个 <code>myValue</code> 的 property 将会被更新。</p> 
<p>注意：你仍然需要在组件的 <code>props</code> 选项里声明 <code>value</code> 这个 prop。</p> 
<h3><a id="2_409"></a>2.修改组件库的样式</h3> 
<p>当修改单个文件的样式时，以 <code>less</code> 为例，如果你想要修改组件的样式，可以使用 /deep/ 或 &gt;&gt;&gt; 来深度选择到你要修改的样式（这能够帮你省去一大串的类名）。</p> 
<pre><code class="prism language-css"><span class="token selector">.dialog-wrapper</span> <span class="token punctuation">{<!-- --></span>
    <span class="token selector">/deep/.el-dialog__body</span><span class="token punctuation">{<!-- --></span>
     border<span class="token punctuation">:</span> solid 1px #999<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>如果你要修改全局的样式，第一种方法，你可以在全局样式文件中写样式覆盖，引入到 main.js 中即可全局生效。如下：<br> <code>import "./assets/css/index.css";</code></p> 
<p>参考文章：<br> https://www.h5w3.com/112064.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ef62d4805647ed2381dd0268d2e833db/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">品牌定位个性六种形态及结论的重大意义</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4234f73a2dde8d5b5d13030dc87df51c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">GNN（图神经网络）基本概念</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>