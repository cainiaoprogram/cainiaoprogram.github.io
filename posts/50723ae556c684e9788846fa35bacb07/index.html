<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spring Boot学习之旅：（六）springboot 整合 redis 以及 redis 通用工具类 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Spring Boot学习之旅：（六）springboot 整合 redis 以及 redis 通用工具类" />
<meta property="og:description" content="这编文章主要介绍了springboot整合redis，以及redis配置和一些redis操作数据的工具类。 首先倒入redis依赖
一.依赖 &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt; &lt;/dependency&gt; 二.配置文件 创建一个redis.properties配置redis redis.host=localhost redis.port=6379 redis.password= redis.database=1 redis.maxActive=8 redis.maxWait=-1 redis.maxIdle=8 redis.minIdle=1 redis.timeOut=0 创建一个与redis.properties的配置类方便直接使用配置的参数。
@Configuration @PropertySource(value = &#34;classpath:redis.properties&#34;) @ConfigurationProperties(prefix = &#34;redis&#34;) public class RedisConfigProperties { // 主机地址 public String host; //端口 public int port; //密码没有不填写 public String password; // Redis数据库索引（默认为0） public int database; //最大活跃连接 public int maxActive; //连接池最大阻塞等待时间（使用负值表示没有限制） public int maxWait; //连接池中的最大空闲连接 public int maxIdle; //连接池中的最小空闲连接 public int minIdle; //连接超时时间（毫秒） public int timeOut; public String getHost() { return host; } public void setHost(String host) { this." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/50723ae556c684e9788846fa35bacb07/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-10-08T08:27:20+08:00" />
<meta property="article:modified_time" content="2017-10-08T08:27:20+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spring Boot学习之旅：（六）springboot 整合 redis 以及 redis 通用工具类</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>这编文章主要介绍了springboot整合redis，以及redis配置和一些redis操作数据的工具类。 <br> 首先倒入redis依赖</p> 
<h3 id="一依赖">一.依赖</h3> 
<pre class="prettyprint"><code class=" hljs xml"><span class="hljs-tag">&lt;<span class="hljs-title">dependency</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-title">groupId</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-title">artifactId</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">dependency</span>&gt;</span></code></pre> 
<h3 id="二配置文件">二.配置文件</h3> 
<p>创建一个redis.properties配置redis <br> redis.host=localhost <br> redis.port=6379 <br> redis.password= <br> redis.database=1 <br> redis.maxActive=8 <br> redis.maxWait=-1 <br> redis.maxIdle=8 <br> redis.minIdle=1 <br> redis.timeOut=0 <br> 创建一个与redis.properties的配置类方便直接使用配置的参数。</p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-annotation">@Configuration</span>
<span class="hljs-annotation">@PropertySource</span>(value = <span class="hljs-string">"classpath:redis.properties"</span>)
<span class="hljs-annotation">@ConfigurationProperties</span>(prefix = <span class="hljs-string">"redis"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisConfigProperties</span> {<!-- --></span>
    <span class="hljs-comment">//   主机地址  </span>
    <span class="hljs-keyword">public</span> String host;
    <span class="hljs-comment">//端口</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> port;
    <span class="hljs-comment">//密码没有不填写</span>
    <span class="hljs-keyword">public</span> String password;
   <span class="hljs-comment">// Redis数据库索引（默认为0）</span>

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> database;
    <span class="hljs-comment">//最大活跃连接</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> maxActive;
    <span class="hljs-comment">//连接池最大阻塞等待时间（使用负值表示没有限制）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> maxWait;
    <span class="hljs-comment">//连接池中的最大空闲连接</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> maxIdle;
    <span class="hljs-comment">//连接池中的最小空闲连接</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> minIdle;
    <span class="hljs-comment">//连接超时时间（毫秒）</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> timeOut;
    <span class="hljs-keyword">public</span> String <span class="hljs-title">getHost</span>() {
        <span class="hljs-keyword">return</span> host;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setHost</span>(String host) {
        <span class="hljs-keyword">this</span>.host = host;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getPort</span>() {
        <span class="hljs-keyword">return</span> port;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPort</span>(<span class="hljs-keyword">int</span> port) {
        <span class="hljs-keyword">this</span>.port = port;
    }
    <span class="hljs-keyword">public</span> String <span class="hljs-title">getPassword</span>() {
        <span class="hljs-keyword">return</span> password;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPassword</span>(String password) {
        <span class="hljs-keyword">this</span>.password = password;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getDatabase</span>() {
        <span class="hljs-keyword">return</span> database;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setDatabase</span>(<span class="hljs-keyword">int</span> database) {
        <span class="hljs-keyword">this</span>.database = database;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getMaxActive</span>() {
        <span class="hljs-keyword">return</span> maxActive;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setMaxActive</span>(<span class="hljs-keyword">int</span> maxActive) {
        <span class="hljs-keyword">this</span>.maxActive = maxActive;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getMaxWait</span>() {
        <span class="hljs-keyword">return</span> maxWait;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setMaxWait</span>(<span class="hljs-keyword">int</span> maxWait) {
        <span class="hljs-keyword">this</span>.maxWait = maxWait;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getMaxIdle</span>() {
        <span class="hljs-keyword">return</span> maxIdle;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setMaxIdle</span>(<span class="hljs-keyword">int</span> maxIdle) {
        <span class="hljs-keyword">this</span>.maxIdle = maxIdle;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getMinIdle</span>() {
        <span class="hljs-keyword">return</span> minIdle;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setMinIdle</span>(<span class="hljs-keyword">int</span> minIdle) {
        <span class="hljs-keyword">this</span>.minIdle = minIdle;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getTimeOut</span>() {
        <span class="hljs-keyword">return</span> timeOut;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setTimeOut</span>(<span class="hljs-keyword">int</span> timeOut) {
        <span class="hljs-keyword">this</span>.timeOut = timeOut;
    }

}</code></pre> 
<h3 id="三整合配置">三.整合配置</h3> 
<p>听说某宝的fastjson的json和序列化性能很好这里的序列化我们使用fastjson的序列化。 <br> 创建一个自定义序列化配置类</p> 
<pre class="prettyprint"><code class=" hljs axapta"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FastJson2JsonRedisSerializer</span>&lt;<span class="hljs-title">T</span>&gt; <span class="hljs-inheritance"><span class="hljs-keyword">implements</span></span> <span class="hljs-title">RedisSerializer</span>&lt;<span class="hljs-title">T</span>&gt; {<!-- --></span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Charset DEFAULT_CHARSET = Charset.forName(<span class="hljs-string">"UTF-8"</span>);
    <span class="hljs-keyword">private</span> Class&lt;T&gt; clazz;
    <span class="hljs-keyword">public</span> FastJson2JsonRedisSerializer(Class&lt;T&gt; clazz) {
        <span class="hljs-keyword">super</span>();
        <span class="hljs-keyword">this</span>.clazz = clazz;
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">byte</span>[] serialize(T t) throws SerializationException {
        <span class="hljs-keyword">if</span> (t == <span class="hljs-keyword">null</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">0</span>];
        }
        <span class="hljs-keyword">return</span> JSON.toJSONString(t, SerializerFeature.WriteClassName).getBytes(DEFAULT_CHARSET);
    }
    <span class="hljs-keyword">public</span> T deserialize(<span class="hljs-keyword">byte</span>[] bytes) throws SerializationException {
        <span class="hljs-keyword">if</span> (bytes == <span class="hljs-keyword">null</span> || bytes.length &lt;= <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
        }
        String <span class="hljs-keyword">str</span> = <span class="hljs-keyword">new</span> String(bytes, DEFAULT_CHARSET);
        <span class="hljs-keyword">return</span> (T) JSON.parseObject(<span class="hljs-keyword">str</span>, clazz);
    }
}</code></pre> 
<p>将项目进行整合</p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-annotation">@Configuration</span>
<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisConfig</span> {<!-- --></span>
    <span class="hljs-annotation">@Autowired</span>
    <span class="hljs-keyword">private</span> RedisConfigProperties redis;
    <span class="hljs-annotation">@Bean</span>
    <span class="hljs-keyword">public</span> RedisSerializer <span class="hljs-title">fastJson2JsonRedisSerializer</span>() {     ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="hljs-keyword">true</span>); 
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FastJson2JsonRedisSerializer&lt;Object&gt;(Object.class);
    }
    <span class="hljs-annotation">@Bean</span>
    <span class="hljs-keyword">public</span> RedisConnectionFactory <span class="hljs-title">redisConnectionFactory</span>() {
        JedisPoolConfig jedisPoolConfig = <span class="hljs-keyword">new</span> JedisPoolConfig();
        <span class="hljs-comment">//最大空闲接连</span>
        jedisPoolConfig.setMaxIdle(redis.getMaxIdle());
        <span class="hljs-comment">//最小空闲连接</span>
        jedisPoolConfig.setMinIdle(redis.getMinIdle());
        <span class="hljs-comment">//连接池最大阻塞等待时间</span>
        jedisPoolConfig.setMaxWaitMillis(redis.getMaxWait());
        JedisConnectionFactory jedisConnectionFactory = <span class="hljs-keyword">new</span> JedisConnectionFactory();
        <span class="hljs-comment">//主机地址</span>
        jedisConnectionFactory.setHostName(redis.getHost())
        <span class="hljs-comment">//端口</span>
        jedisConnectionFactory.setPort(redis.getPort());
        <span class="hljs-comment">//密码</span>
        jedisConnectionFactory.setPassword(redis.getPassword());
        <span class="hljs-comment">//索引</span>
        jedisConnectionFactory.setDatabase(redis.getDatabase());
        <span class="hljs-comment">//超时时间</span>
        jedisConnectionFactory.setTimeout(redis.getTimeOut());
        jedisConnectionFactory.setUsePool(<span class="hljs-keyword">true</span>);    
        jedisConnectionFactory.setPoolConfig(jedisPoolConfig);
        <span class="hljs-keyword">return</span> jedisConnectionFactory;
    }
    <span class="hljs-annotation">@Bean</span>
    <span class="hljs-keyword">public</span> RedisTemplate&lt;String, String&gt; <span class="hljs-title">redisTemplate</span>(RedisConnectionFactory factory, RedisSerializer fastJson2JsonRedisSerializer) {
        StringRedisTemplate redisTemplate = <span class="hljs-keyword">new</span> StringRedisTemplate(factory);        redisTemplate.setConnectionFactory(redisConnectionFactory());
        <span class="hljs-comment">//redis   开启事务</span>
        redisTemplate.setEnableTransactionSupport(<span class="hljs-keyword">true</span>);
        <span class="hljs-comment">//hash  使用jdk  的序列化</span>
        redisTemplate.setHashValueSerializer(fastJson2JsonRedisSerializer<span class="hljs-comment">/*new JdkSerializationRedisSerializer()*/</span>);
        <span class="hljs-comment">//StringRedisSerializer  key  序列化</span>
        redisTemplate.setHashKeySerializer(<span class="hljs-keyword">new</span> StringRedisSerializer());
        <span class="hljs-comment">//keySerializer  对key的默认序列化器。默认值是StringSerializer</span>
        redisTemplate.setKeySerializer(<span class="hljs-keyword">new</span> StringRedisSerializer());
        <span class="hljs-comment">//  valueSerializer</span>
        redisTemplate.setValueSerializer(fastJson2JsonRedisSerializer);
        redisTemplate.afterPropertiesSet();
        <span class="hljs-keyword">return</span> redisTemplate;
    }
}</code></pre> 
<h3 id="四操作数据工具类">四.操作数据工具类</h3> 
<p>接口：</p> 
<pre class="prettyprint"><code class=" hljs scala">public interface BaseRedisDao&lt;K, V&gt; {
    <span class="hljs-javadoc">/**
     * 用户排序通过注册时间的 权重值
     * <span class="hljs-javadoctag">@param</span> date
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    double getCreateTimeScore(long date);
    <span class="hljs-javadoc">/**
     * 获取Redis中所有的键的key
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Set&lt;K&gt; getAllKeys();

    <span class="hljs-javadoc">/**
     * 获取所有的普通key-value
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Map&lt;K,V&gt; getAllString();
    <span class="hljs-javadoc">/**
     * 获取所有的Set -key-value
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Map&lt;K,Set&lt;V&gt;&gt; getAllSet();
    <span class="hljs-javadoc">/**
     * 获取所有的ZSet正序  -key-value 不获取权重值
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Map&lt;K,Set&lt;V&gt;&gt; getAllZSetReverseRange();
    <span class="hljs-javadoc">/**
     * 获取所有的ZSet倒序  -key-value 不获取权重值
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Map&lt;K,Set&lt;V&gt;&gt; getAllZSetRange();

    <span class="hljs-javadoc">/**
     * 获取所有的List -key-value
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Map&lt;K,List&lt;V&gt;&gt; getAllList();
    <span class="hljs-javadoc">/**
     * 获取所有的Map -key-value
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Map&lt;K,Map&lt;K,V&gt;&gt; getAllMap();
    <span class="hljs-javadoc">/**
     * 添加一个list
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> objectList
     */</span>
    void addList(K key, List&lt;V&gt; objectList);
    <span class="hljs-javadoc">/**
     * 向list中增加值
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> obj
     * <span class="hljs-javadoctag">@return</span> 返回在list中的下标
     */</span>
    long addList(K key,V obj);
    <span class="hljs-javadoc">/**
     * 向list中增加值
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> obj
     * <span class="hljs-javadoctag">@return</span> 返回在list中的下标
     */</span>
    long addList(K key,V ...obj);
    <span class="hljs-javadoc">/**
     *
     * 输出list
     * <span class="hljs-javadoctag">@param</span> key List的key
     * <span class="hljs-javadoctag">@param</span> s 开始下标
     * <span class="hljs-javadoctag">@param</span> e 结束的下标
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    List&lt;V&gt; getList(K key, long s, long e);
    <span class="hljs-javadoc">/**
     * 输出完整的list
     * <span class="hljs-javadoctag">@param</span> key
     */</span>
    List&lt;V&gt; getList(K key);
    <span class="hljs-javadoc">/**
     * 获取list集合中元素的个数
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    long getListSize(K key);
    <span class="hljs-javadoc">/**
     * 移除list中某值
     * 移除list中 count个value为object的值,并且返回移除的数量,
     * 如果count为0,或者大于list中为value为object数量的总和,
     * 那么移除所有value为object的值,并且返回移除数量
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> object
     * <span class="hljs-javadoctag">@return</span> 返回移除数量
     */</span>
    long removeListValue(K key,V <span class="hljs-keyword">object</span>);
    <span class="hljs-javadoc">/**
     * 移除list中某值
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> object
     * <span class="hljs-javadoctag">@return</span> 返回移除数量
     */</span>
    long removeListValue(K key,V... <span class="hljs-keyword">object</span>);
    <span class="hljs-javadoc">/**
     * 批量删除key对应的value
     * <span class="hljs-javadoctag">@param</span> keys
     */</span>
    void remove(<span class="hljs-keyword">final</span> K... keys);
    <span class="hljs-javadoc">/**
     * 删除缓存
     * 根据key精确匹配删除
     * <span class="hljs-javadoctag">@param</span> key
     */</span>
    void remove(<span class="hljs-keyword">final</span> K key);
    <span class="hljs-javadoc">/**
     * 通过分数删除ZSet中的值
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> s
     * <span class="hljs-javadoctag">@param</span> e
     */</span>
    void removeZSetRangeByScore(String key,double s , double e);
    <span class="hljs-javadoc">/**
     * 设置Set的过期时间
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> time
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Boolean setSetExpireTime(String key,Long time);
    <span class="hljs-javadoc">/**
     * 设置ZSet的过期时间
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> time
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Boolean setZSetExpireTime(String key,Long time);
    <span class="hljs-javadoc">/**
     * 判断缓存中是否有key对应的value
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    boolean exists(<span class="hljs-keyword">final</span> K key);
    <span class="hljs-javadoc">/**
     * 读取String缓存 可以是对象
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    V get(<span class="hljs-keyword">final</span> K key);
    <span class="hljs-javadoc">/**
     * 读取String缓存 可以是对象
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    List&lt;V&gt; get(<span class="hljs-keyword">final</span> K... key);
    <span class="hljs-javadoc">/**
     * 读取缓存 可以是对象 根据正则表达式匹配
     * <span class="hljs-javadoctag">@param</span> regKey
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    List&lt;Object&gt; getByRegular(<span class="hljs-keyword">final</span> K regKey);
    <span class="hljs-javadoc">/**
     * 写入缓存 可以是对象
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> value
     */</span>
    void set(<span class="hljs-keyword">final</span> K key, V value);
    <span class="hljs-javadoc">/**
     * 写入缓存
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> value
     * <span class="hljs-javadoctag">@param</span> expireTime 过期时间 -单位s
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    void set(<span class="hljs-keyword">final</span> K key, V value, Long expireTime);

    <span class="hljs-javadoc">/**
     * 设置一个key的过期时间（单位：秒）
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> expireTime
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    boolean setExpireTime(K key, Long expireTime);

    <span class="hljs-javadoc">/**
     * 获取key的类型
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    DataType getType(K key);

    <span class="hljs-javadoc">/**
     * 删除map中的某个对象
     * <span class="hljs-javadoctag">@param</span> key   map对应的key
     * <span class="hljs-javadoctag">@param</span> field map中该对象的key
     */</span>
    void removeMapField(K key, V... field);
    <span class="hljs-comment">/*
     * 获取map对象
     * @param key map对应的key
     * @return
     */</span>
    Map&lt;K,V&gt; getMap(K key);
    <span class="hljs-comment">/*
     * 获取map对象
     * @param key map对应的key
     * @return
     */</span>
    Long getMapSize(K key);
    <span class="hljs-javadoc">/**
     * 获取map缓存中的某个对象
     * <span class="hljs-javadoctag">@param</span> key map对应的key
     * <span class="hljs-javadoctag">@param</span> field map中该对象的key
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    &lt;T&gt; T getMapField(K key, K field);
    <span class="hljs-javadoc">/**
     * 判断map中对应key的key是否存在
     * <span class="hljs-javadoctag">@param</span> key map对应的key
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Boolean hasMapKey(K key,K field);

    <span class="hljs-javadoc">/**
     * 获取map对应key的value
     * <span class="hljs-javadoctag">@param</span> key map对应的key
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    List&lt;V&gt; getMapFieldValue(K key);
    <span class="hljs-javadoc">/**
     * 获取map的key
     * <span class="hljs-javadoctag">@param</span> key map对应的key
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Set&lt;V&gt; getMapFieldKey(K key);
    <span class="hljs-javadoc">/**
     * 添加map
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> map
     */</span>
    void addMap(K key, Map&lt;K,V&gt; map);
    <span class="hljs-javadoc">/**
     * 向key对应的map中添加缓存对象
     * <span class="hljs-javadoctag">@param</span> key   cache对象key
     * <span class="hljs-javadoctag">@param</span> field map对应的key
     * <span class="hljs-javadoctag">@param</span> value     值
     */</span>
    void addMap(K key, K field, Object value);
    <span class="hljs-javadoc">/**
     * 向key对应的map中添加缓存对象
     * <span class="hljs-javadoctag">@param</span> key   cache对象key
     * <span class="hljs-javadoctag">@param</span> field map对应的key
     * <span class="hljs-javadoctag">@param</span> time 过期时间-整个MAP的过期时间
     * <span class="hljs-javadoctag">@param</span> value     值
     */</span>
    void addMap(K key, K field, V value,long time);

    <span class="hljs-javadoc">/**
     * 向set中加入对象
     * <span class="hljs-javadoctag">@param</span> key  对象key
     * <span class="hljs-javadoctag">@param</span> obj  值
     */</span>
    void addSet(K key, V... obj);

    <span class="hljs-javadoc">/**
     * 处理事务时锁定key
     * <span class="hljs-javadoctag">@param</span> key
     */</span>
    void watch(String key);

    <span class="hljs-javadoc">/**
     * 移除set中的某些值
     * <span class="hljs-javadoctag">@param</span> key  对象key
     * <span class="hljs-javadoctag">@param</span> obj  值
     */</span>
    long removeSetValue(K key, V obj);
    <span class="hljs-javadoc">/**
     * 移除set中的某些值
     * <span class="hljs-javadoctag">@param</span> key  对象key
     * <span class="hljs-javadoctag">@param</span> obj  值
     */</span>
    long removeSetValue(K key, V... obj);

    <span class="hljs-javadoc">/**
     * 获取set的对象数
     * <span class="hljs-javadoctag">@param</span> key  对象key
     */</span>
    long getSetSize(K key);

    <span class="hljs-javadoc">/**
     * 判断set中是否存在这个值
     * <span class="hljs-javadoctag">@param</span> key  对象key
     */</span>
    Boolean hasSetValue(K key,V obj);
    <span class="hljs-javadoc">/**
     * 获得整个set
     * <span class="hljs-javadoctag">@param</span> key  对象key
     */</span>
    Set&lt;V&gt; getSet(K key);

    <span class="hljs-javadoc">/**
     * 获得set 并集
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> otherKey
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Set&lt;V&gt; getSetUnion(K key,K otherKey);

    <span class="hljs-javadoc">/**
     * 获得set 并集
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> set
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Set&lt;V&gt; getSetUnion(K key,Set&lt;Object&gt; set);

    <span class="hljs-javadoc">/**
     * 获得set 交集
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> otherKey
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Set&lt;V&gt; getSetIntersect(K key,K otherKey);

    <span class="hljs-javadoc">/**
     * 获得set 交集
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> set
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Set&lt;V&gt; getSetIntersect(K key,Set&lt;Object&gt; set);

    <span class="hljs-javadoc">/**
     * 模糊移除 支持*号等匹配移除
     * <span class="hljs-javadoctag">@param</span> blears
     */</span>
    void removeBlear(K... blears);

    <span class="hljs-javadoc">/**
     * 修改key名 如果不存在该key或者没有修改成功返回false
     * <span class="hljs-javadoctag">@param</span> oldKey
     * <span class="hljs-javadoctag">@param</span> newKey
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Boolean renameIfAbsent(String oldKey,String newKey);
    <span class="hljs-javadoc">/**
     * 模糊移除 支持*号等匹配移除
     * <span class="hljs-javadoctag">@param</span> blear
     */</span>
    void removeBlear(K blear);

    <span class="hljs-javadoc">/**
     * 根据正则表达式来移除key-value
     * <span class="hljs-javadoctag">@param</span> blears
     */</span>
    void removeByRegular(String... blears);

    <span class="hljs-javadoc">/**
     * 根据正则表达式来移除key-value
     * <span class="hljs-javadoctag">@param</span> blears
     */</span>
    void removeByRegular(String blears);

    <span class="hljs-javadoc">/**
     * 根据正则表达式来移除 Map中的key-value
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> blears
     */</span>
    void removeMapFieldByRegular(K key,K... blears);

    <span class="hljs-javadoc">/**
     * 根据正则表达式来移除 Map中的key-value
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> blear
     */</span>
    void removeMapFieldByRegular(K key,K blear);

    <span class="hljs-javadoc">/**
     * 移除key 对应的value
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> value
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Long removeZSetValue(K key, V... value);
    <span class="hljs-javadoc">/**
     * 移除key ZSet
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    void removeZSet(K key);
    <span class="hljs-javadoc">/**
     *删除，键为K的集合，索引start&lt;=index&lt;=end的元素子集
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> start
     * <span class="hljs-javadoctag">@param</span> end
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    void removeZSetRange(K key,Long start,Long end);

    <span class="hljs-javadoc">/**
     * 并集 将key对应的集合和key1对应的集合合并到key2中
     * 如果分数相同的值，都会保留
     * 原来key2的值会被覆盖
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> key1
     * <span class="hljs-javadoctag">@param</span> key2
     */</span>
    void setZSetUnionAndStore(String key,String key1, String key2);

    <span class="hljs-javadoc">/**
     * 获取整个有序集合ZSET，正序
     * <span class="hljs-javadoctag">@param</span> key
     */</span>
    &lt;T&gt; T getZSetRange(K key);

    <span class="hljs-javadoc">/**
     * 获取有序集合ZSET
     * 键为K的集合，索引start&lt;=index&lt;=end的元素子集，正序
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> start 开始位置
     * <span class="hljs-javadoctag">@param</span> end 结束位置
     */</span>
    &lt;T&gt; T getZSetRange(K key,long start,long end);
    <span class="hljs-javadoc">/**
     * 获取整个有序集合ZSET，倒序
     * <span class="hljs-javadoctag">@param</span> key
     */</span>
    Set&lt;Object&gt; getZSetReverseRange(K key);

    <span class="hljs-javadoc">/**
     * 获取有序集合ZSET
     * 键为K的集合，索引start&lt;=index&lt;=end的元素子集，倒序
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> start 开始位置
     * <span class="hljs-javadoctag">@param</span> end 结束位置
     */</span>
    Set&lt;V&gt; getZSetReverseRange(K key,long start,long end);

    <span class="hljs-javadoc">/**
     * 通过分数(权值)获取ZSET集合 正序 -从小到大
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> start
     * <span class="hljs-javadoctag">@param</span> end
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Set&lt;V&gt; getZSetRangeByScore(String key, double start, double end);

    <span class="hljs-javadoc">/**
     * 通过分数(权值)获取ZSET集合 倒序 -从大到小
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> start
     * <span class="hljs-javadoctag">@param</span> end
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Set&lt;V&gt; getZSetReverseRangeByScore(String key, double start, double end);

    <span class="hljs-javadoc">/**
     * 键为K的集合，索引start&lt;=index&lt;=end的元素子集
     * 返回泛型接口（包括score和value），正序
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> start
     * <span class="hljs-javadoctag">@param</span> end
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Set&lt;ZSetOperations.TypedTuple&lt;V&gt;&gt; getZSetRangeWithScores(K key, long start, long end);
    <span class="hljs-javadoc">/**
     * 键为K的集合，索引start&lt;=index&lt;=end的元素子集
     * 返回泛型接口（包括score和value），倒序
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> start
     * <span class="hljs-javadoctag">@param</span> end
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Set&lt;ZSetOperations.TypedTuple&lt;V&gt;&gt; getZSetReverseRangeWithScores(K key, long start, long end);

    <span class="hljs-javadoc">/**
     * 键为K的集合
     * 返回泛型接口（包括score和value），正序
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Set&lt;ZSetOperations.TypedTuple&lt;V&gt;&gt; getZSetRangeWithScores(K key);
    <span class="hljs-javadoc">/**
     * 键为K的集合
     * 返回泛型接口（包括score和value），倒序
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Set&lt;ZSetOperations.TypedTuple&lt;V&gt;&gt; getZSetReverseRangeWithScores(K key);

    <span class="hljs-javadoc">/**
     * 键为K的集合，sMin&lt;=score&lt;=sMax的元素个数
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> sMin
     * <span class="hljs-javadoctag">@param</span> sMax
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    long getZSetCountSize(K key,double sMin,double sMax);
    <span class="hljs-javadoc">/**
     * 获取Zset 键为K的集合元素个数
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    long getZSetSize(K key);
    <span class="hljs-javadoc">/**
     * 获取键为K的集合，value为obj的元素分数
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> value
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    double getZSetScore(K key,V value);
    <span class="hljs-javadoc">/**
     * 元素分数增加，delta是增量
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> value
     * <span class="hljs-javadoctag">@param</span> delta
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    double incrementZSetScore(K key,V value,double delta);
    <span class="hljs-javadoc">/**
     * 添加有序集合ZSET
     * 默认按照score升序排列，存储格式K(1)==V(n)，V(1)=S(1)
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> score
     * <span class="hljs-javadoctag">@param</span> value
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Boolean addZSet(String key ,double score, Object value);
    <span class="hljs-javadoc">/**
     * 添加有序集合ZSET
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> value
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Long addZSet(K key,TreeSet&lt;V&gt; value);
    <span class="hljs-javadoc">/**
     * 添加有序集合ZSET
     * <span class="hljs-javadoctag">@param</span> key
     * <span class="hljs-javadoctag">@param</span> score
     * <span class="hljs-javadoctag">@param</span> value
     * <span class="hljs-javadoctag">@return</span>
     */</span>
    Boolean addZSet(K key,double[] score, Object[] value);
}</code></pre> 
<p>实现类</p> 
<pre class="prettyprint"><code class=" hljs cs">@Repository(<span class="hljs-string">"redisHandle"</span>)
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> RedisHandle implements BaseRedisDao&lt;String, Object&gt; {
    <span class="hljs-keyword">private</span> Logger logger = LoggerFactory.getLogger(<span class="hljs-keyword">this</span>.getClass());
    @Resource(name=<span class="hljs-string">"redisTemplate"</span>)
    <span class="hljs-keyword">protected</span> RedisTemplate redisTemplate;
    <span class="hljs-comment">/**
     * 出异常，重复操作的次数
     */</span>
    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Integer times = <span class="hljs-number">5</span>;


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getCreateTimeScore</span>(<span class="hljs-keyword">long</span> date) {
        <span class="hljs-keyword">return</span> date/ <span class="hljs-number">100000.0</span>;
    }


    <span class="hljs-keyword">public</span> Set&lt;String&gt; <span class="hljs-title">getAllKeys</span>() {
        <span class="hljs-keyword">return</span> redisTemplate.keys(<span class="hljs-string">"*"</span>);
    }


    <span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">getAllString</span>() {
        Set&lt;String&gt; stringSet = getAllKeys();
        Map&lt;String, Object&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;String, Object&gt;();
        Iterator&lt;String&gt; iterator = stringSet.iterator();
        <span class="hljs-keyword">while</span> (iterator.hasNext()) {
            String k = iterator.next();
            <span class="hljs-keyword">if</span> (getType(k) == DataType.STRING) {
                map.put(k, <span class="hljs-keyword">get</span>(k));
            }
        }
        <span class="hljs-keyword">return</span> map;
    }


    <span class="hljs-keyword">public</span> Map&lt;String, Set&lt;Object&gt;&gt; <span class="hljs-title">getAllSet</span>() {
        Set&lt;String&gt; stringSet = getAllKeys();
        Map&lt;String, Set&lt;Object&gt;&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;String, Set&lt;Object&gt;&gt;();
        Iterator&lt;String&gt; iterator = stringSet.iterator();
        <span class="hljs-keyword">while</span> (iterator.hasNext()) {
            String k = iterator.next();
            <span class="hljs-keyword">if</span> (getType(k) == DataType.SET) {
                map.put(k, getSet(k));
            }
        }
        <span class="hljs-keyword">return</span> map;
    }


    <span class="hljs-keyword">public</span> Map&lt;String, Set&lt;Object&gt;&gt; <span class="hljs-title">getAllZSetRange</span>() {
        Set&lt;String&gt; stringSet = getAllKeys();
        Map&lt;String, Set&lt;Object&gt;&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;String, Set&lt;Object&gt;&gt;();
        Iterator&lt;String&gt; iterator = stringSet.iterator();
        <span class="hljs-keyword">while</span> (iterator.hasNext()) {
            String k = iterator.next();
            <span class="hljs-keyword">if</span> (getType(k) == DataType.ZSET) {
                logger.debug(<span class="hljs-string">"k:"</span>+k);
                map.put(k, getZSetRange(k));
            }
        }
        <span class="hljs-keyword">return</span> map;
    }


    <span class="hljs-keyword">public</span> Map&lt;String, Set&lt;Object&gt;&gt; <span class="hljs-title">getAllZSetReverseRange</span>() {
        Set&lt;String&gt; stringSet = getAllKeys();
        Map&lt;String, Set&lt;Object&gt;&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;String, Set&lt;Object&gt;&gt;();
        Iterator&lt;String&gt; iterator = stringSet.iterator();
        <span class="hljs-keyword">while</span> (iterator.hasNext()) {
            String k = iterator.next();
            <span class="hljs-keyword">if</span> (getType(k) == DataType.ZSET) {
                map.put(k, getZSetReverseRange(k));
            }
        }
        <span class="hljs-keyword">return</span> map;
    }


    <span class="hljs-keyword">public</span> Map&lt;String, List&lt;Object&gt;&gt; <span class="hljs-title">getAllList</span>() {
        Set&lt;String&gt; stringSet = getAllKeys();
        Map&lt;String, List&lt;Object&gt;&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;String, List&lt;Object&gt;&gt;();
        Iterator&lt;String&gt; iterator = stringSet.iterator();
        <span class="hljs-keyword">while</span> (iterator.hasNext()) {
            String k = iterator.next();
            <span class="hljs-keyword">if</span> (getType(k) == DataType.LIST) {
                map.put(k, getList(k));
            }
        }
        <span class="hljs-keyword">return</span> map;
    }


    <span class="hljs-keyword">public</span> Map&lt;String, Map&lt;String, Object&gt;&gt; <span class="hljs-title">getAllMap</span>() {
        Set&lt;String&gt; stringSet = getAllKeys();
        Map&lt;String, Map&lt;String, Object&gt;&gt; map = <span class="hljs-keyword">new</span> HashMap&lt;String, Map&lt;String, Object&gt;&gt;();
        Iterator&lt;String&gt; iterator = stringSet.iterator();
        <span class="hljs-keyword">while</span> (iterator.hasNext()) {
            String k = iterator.next();
            <span class="hljs-keyword">if</span> (getType(k) == DataType.HASH) {
                map.put(k, getMap(k));
            }
        }
        <span class="hljs-keyword">return</span> map;
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addList</span>(String key, List&lt;Object&gt; objectList) {
        <span class="hljs-keyword">for</span> (Object obj : objectList) {
            addList(key, obj);
        }
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">addList</span>(String key, Object obj) {
        <span class="hljs-keyword">return</span> redisTemplate.boundListOps(key).rightPush(obj);
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">addList</span>(String key, Object... obj) {
        <span class="hljs-keyword">return</span> redisTemplate.boundListOps(key).rightPushAll(obj);
    }


    <span class="hljs-keyword">public</span> List&lt;Object&gt; <span class="hljs-title">getList</span>(String key, <span class="hljs-keyword">long</span> s, <span class="hljs-keyword">long</span> e) {
        <span class="hljs-keyword">return</span> redisTemplate.boundListOps(key).range(s, e);
    }


    <span class="hljs-keyword">public</span> List&lt;Object&gt; <span class="hljs-title">getList</span>(String key) {
        <span class="hljs-keyword">return</span> redisTemplate.boundListOps(key).range(<span class="hljs-number">0</span>, getListSize(key));
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getListSize</span>(String key) {
        <span class="hljs-keyword">return</span> redisTemplate.boundListOps(key).size();
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">removeListValue</span>(String key, Object <span class="hljs-keyword">object</span>) {
        <span class="hljs-keyword">return</span> redisTemplate.boundListOps(key).remove(<span class="hljs-number">0</span>, <span class="hljs-keyword">object</span>);
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">removeListValue</span>(String key, Object... objects) {
        <span class="hljs-keyword">long</span> r = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (Object <span class="hljs-keyword">object</span> : objects) {
            r += removeListValue(key, <span class="hljs-keyword">object</span>);
        }
        <span class="hljs-keyword">return</span> r;
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">remove</span>(String... key) {
        <span class="hljs-keyword">if</span> (key != <span class="hljs-keyword">null</span> &amp;&amp; key.length &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">if</span> (key.length == <span class="hljs-number">1</span>) {
                remove(key[<span class="hljs-number">0</span>]);
            } <span class="hljs-keyword">else</span> {
                redisTemplate.delete(CollectionUtils.arrayToList(key));
            }
        }
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">removeBlear</span>(String... blears) {
        <span class="hljs-keyword">for</span> (String blear : blears) {
            removeBlear(blear);
        }
    }


    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title">renameIfAbsent</span>(String oldKey, String newKey) {
        <span class="hljs-keyword">return</span> redisTemplate.renameIfAbsent(oldKey, newKey);
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">removeBlear</span>(String blear) {
        redisTemplate.delete(redisTemplate.keys(blear));
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">removeByRegular</span>(String... blears) {
        <span class="hljs-keyword">for</span> (String blear : blears) {
            removeBlear(blear);
        }
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">removeByRegular</span>(String blear) {
        Set&lt;String&gt; stringSet = getAllKeys();
        <span class="hljs-keyword">for</span> (String s : stringSet) {
            <span class="hljs-keyword">if</span> (Pattern.compile(blear).matcher(s).matches()) {
                redisTemplate.delete(s);
            }
        }
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">removeMapFieldByRegular</span>(String key, String... blears) {
        <span class="hljs-keyword">for</span> (String blear : blears) {
            removeMapFieldByRegular(key, blear);
        }
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">removeMapFieldByRegular</span>(String key, String blear) {
        Map&lt;String, Object&gt; map = getMap(key);
        Set&lt;String&gt; stringSet = map.keySet();
        <span class="hljs-keyword">for</span> (String s : stringSet) {
            <span class="hljs-keyword">if</span> (Pattern.compile(blear).matcher(s).matches()) {
                redisTemplate.boundHashOps(key).delete(s);
            }
        }
    }


    <span class="hljs-keyword">public</span> Long <span class="hljs-title">removeZSetValue</span>(String key, Object... <span class="hljs-keyword">value</span>) {
        <span class="hljs-keyword">return</span> redisTemplate.boundZSetOps(key).remove(<span class="hljs-keyword">value</span>);
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">removeZSet</span>(String key) {
        removeZSetRange(key, <span class="hljs-number">0</span>L, getZSetSize(key));
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">removeZSetRange</span>(String key, Long start, Long end) {
        redisTemplate.boundZSetOps(key).removeRange(start, end);
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setZSetUnionAndStore</span>(String key,String key1, String key2) {
        redisTemplate.boundZSetOps(key).unionAndStore(key1,key2);
    }


    <span class="hljs-keyword">public</span> Set&lt;Object&gt; <span class="hljs-title">getZSetRange</span>(String key) {
        <span class="hljs-keyword">return</span> getZSetRange(key, <span class="hljs-number">0</span>, getZSetSize(key));
    }


    <span class="hljs-keyword">public</span> Set&lt;Object&gt; <span class="hljs-title">getZSetRange</span>(String key, <span class="hljs-keyword">long</span> s, <span class="hljs-keyword">long</span> e) {
        <span class="hljs-keyword">return</span> redisTemplate.boundZSetOps(key).range(s, e);
    }


    <span class="hljs-keyword">public</span> Set&lt;Object&gt; <span class="hljs-title">getZSetReverseRange</span>(String key) {
        <span class="hljs-keyword">return</span> getZSetReverseRange(key, <span class="hljs-number">0</span>, getZSetSize(key));
    }


    <span class="hljs-keyword">public</span> Set&lt;Object&gt; <span class="hljs-title">getZSetReverseRange</span>(String key, <span class="hljs-keyword">long</span> start, <span class="hljs-keyword">long</span> end) {
        <span class="hljs-keyword">return</span> redisTemplate.boundZSetOps(key).reverseRange(start, end);
    }


    <span class="hljs-keyword">public</span> Set&lt;Object&gt; <span class="hljs-title">getZSetRangeByScore</span>(String key, <span class="hljs-keyword">double</span> start, <span class="hljs-keyword">double</span> end) {
        <span class="hljs-keyword">return</span> redisTemplate.boundZSetOps(key).rangeByScore(start, end);
    }

    <span class="hljs-keyword">public</span> Set&lt;Object&gt; <span class="hljs-title">getZSetReverseRangeByScore</span>(String key, <span class="hljs-keyword">double</span> start, <span class="hljs-keyword">double</span> end) {
        <span class="hljs-keyword">return</span> redisTemplate.boundZSetOps(key).reverseRangeByScore(start, end);
    }


    <span class="hljs-keyword">public</span> Set&lt;ZSetOperations.TypedTuple&lt;Object&gt;&gt; <span class="hljs-title">getZSetRangeWithScores</span>(String key, <span class="hljs-keyword">long</span> start, <span class="hljs-keyword">long</span> end) {
        <span class="hljs-keyword">return</span> redisTemplate.boundZSetOps(key).rangeWithScores(start, end);
    }


    <span class="hljs-keyword">public</span> Set&lt;ZSetOperations.TypedTuple&lt;Object&gt;&gt; <span class="hljs-title">getZSetReverseRangeWithScores</span>(String key, <span class="hljs-keyword">long</span> start, <span class="hljs-keyword">long</span> end) {
        <span class="hljs-keyword">return</span> redisTemplate.boundZSetOps(key).reverseRangeWithScores(start, end);
    }


    <span class="hljs-keyword">public</span> Set&lt;ZSetOperations.TypedTuple&lt;Object&gt;&gt; <span class="hljs-title">getZSetRangeWithScores</span>(String key) {
        <span class="hljs-keyword">return</span> getZSetRangeWithScores(key, <span class="hljs-number">0</span>, getZSetSize(key));
    }


    <span class="hljs-keyword">public</span> Set&lt;ZSetOperations.TypedTuple&lt;Object&gt;&gt; <span class="hljs-title">getZSetReverseRangeWithScores</span>(String key) {
        <span class="hljs-keyword">return</span> getZSetReverseRangeWithScores(key, <span class="hljs-number">0</span>, getZSetSize(key));
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getZSetCountSize</span>(String key, <span class="hljs-keyword">double</span> sMin, <span class="hljs-keyword">double</span> sMax) {
        <span class="hljs-keyword">return</span> redisTemplate.boundZSetOps(key).count(sMin, sMax);
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getZSetSize</span>(String key) {
        <span class="hljs-keyword">return</span> redisTemplate.boundZSetOps(key).size();
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">getZSetScore</span>(String key, Object <span class="hljs-keyword">value</span>) {
        <span class="hljs-keyword">return</span> redisTemplate.boundZSetOps(key).score(<span class="hljs-keyword">value</span>);
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">double</span> <span class="hljs-title">incrementZSetScore</span>(String key, Object <span class="hljs-keyword">value</span>, <span class="hljs-keyword">double</span> delta) {
        <span class="hljs-keyword">return</span> redisTemplate.boundZSetOps(key).incrementScore(<span class="hljs-keyword">value</span>, delta);
    }


    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title">addZSet</span>(String key, <span class="hljs-keyword">double</span> score, Object <span class="hljs-keyword">value</span>) {
        <span class="hljs-keyword">return</span> redisTemplate.boundZSetOps(key).add(<span class="hljs-keyword">value</span>, score);
    }


    <span class="hljs-keyword">public</span> Long <span class="hljs-title">addZSet</span>(String key, TreeSet&lt;Object&gt; <span class="hljs-keyword">value</span>) {
        <span class="hljs-keyword">return</span> redisTemplate.boundZSetOps(key).add(<span class="hljs-keyword">value</span>);
    }


    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title">addZSet</span>(String key, <span class="hljs-keyword">double</span>[] score, Object[] <span class="hljs-keyword">value</span>) {
        <span class="hljs-keyword">if</span> (score.length != <span class="hljs-keyword">value</span>.length) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
        }
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; score.length; i++) {
            <span class="hljs-keyword">if</span> (addZSet(key, score[i], <span class="hljs-keyword">value</span>[i]) == <span class="hljs-keyword">false</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">remove</span>(String key) {
        <span class="hljs-keyword">if</span> (exists(key)) {
            redisTemplate.delete(key);
        }
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">removeZSetRangeByScore</span>(String key,<span class="hljs-keyword">double</span> s , <span class="hljs-keyword">double</span> e) {
        redisTemplate.boundZSetOps(key).removeRangeByScore(s,e);
    }


    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title">setSetExpireTime</span>(String key, Long time) {
        <span class="hljs-keyword">return</span> redisTemplate.boundSetOps(key).expire(time, TimeUnit.SECONDS);
    }


    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title">setZSetExpireTime</span>(String key, Long time) {
        <span class="hljs-keyword">return</span> redisTemplate.boundZSetOps(key).expire(time, TimeUnit.SECONDS);
    }


    <span class="hljs-keyword">public</span> boolean <span class="hljs-title">exists</span>(String key) {
        <span class="hljs-keyword">return</span> redisTemplate.hasKey(key);
    }
    <span class="hljs-keyword">public</span> Object <span class="hljs-title">get</span>(<span class="hljs-keyword">int</span> key) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.<span class="hljs-keyword">get</span>(String.valueOf(key));
    }
    <span class="hljs-keyword">public</span> Object <span class="hljs-title">get</span>(<span class="hljs-keyword">long</span> key) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.<span class="hljs-keyword">get</span>(String.valueOf(key));
    }
    <span class="hljs-keyword">public</span> Object <span class="hljs-title">get</span>(String key) {
        <span class="hljs-keyword">return</span> redisTemplate.boundValueOps(key).<span class="hljs-keyword">get</span>();
    }


    <span class="hljs-keyword">public</span> List&lt;Object&gt; <span class="hljs-title">get</span>(String... keys) {
        List&lt;Object&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;Object&gt;();
        <span class="hljs-keyword">for</span> (String key : keys) {
            list.add(<span class="hljs-keyword">get</span>(key));
        }
        <span class="hljs-keyword">return</span> list;
    }


    <span class="hljs-keyword">public</span> List&lt;Object&gt; <span class="hljs-title">getByRegular</span>(String regKey) {
        Set&lt;String&gt; stringSet = getAllKeys();
        List&lt;Object&gt; objectList = <span class="hljs-keyword">new</span> ArrayList&lt;Object&gt;();
        <span class="hljs-keyword">for</span> (String s : stringSet) {
            <span class="hljs-keyword">if</span> (Pattern.compile(regKey).matcher(s).matches() &amp;&amp; getType(s) == DataType.STRING) {
                objectList.add(<span class="hljs-keyword">get</span>(s));
            }
        }
        <span class="hljs-keyword">return</span> objectList;
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">set</span>(<span class="hljs-keyword">long</span> key, Object <span class="hljs-keyword">value</span>) {
       <span class="hljs-keyword">this</span>.<span class="hljs-keyword">set</span>(String.valueOf(key) ,<span class="hljs-keyword">value</span>);
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">set</span>(<span class="hljs-keyword">int</span> key, Object <span class="hljs-keyword">value</span>) {
        <span class="hljs-keyword">this</span>.<span class="hljs-keyword">set</span>(String.valueOf(key) ,<span class="hljs-keyword">value</span>);
     }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">set</span>(String key, Object <span class="hljs-keyword">value</span>) {
        redisTemplate.boundValueOps(key).<span class="hljs-keyword">set</span>(<span class="hljs-keyword">value</span>);
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">set</span>(String key, Object <span class="hljs-keyword">value</span>, Long expireTime) {
        redisTemplate.boundValueOps(key).<span class="hljs-keyword">set</span>(<span class="hljs-keyword">value</span>, expireTime, TimeUnit.SECONDS);
    }


    <span class="hljs-keyword">public</span> boolean <span class="hljs-title">setExpireTime</span>(String key, Long expireTime) {
        <span class="hljs-keyword">return</span> redisTemplate.expire(key, expireTime, TimeUnit.SECONDS);
    }



    <span class="hljs-keyword">public</span> DataType <span class="hljs-title">getType</span>(String key) {
        <span class="hljs-keyword">return</span> redisTemplate.type(key);
    }



    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">removeMapField</span>(String key, Object... field) {
        redisTemplate.boundHashOps(key).delete(field);
    }


    <span class="hljs-keyword">public</span> Long <span class="hljs-title">getMapSize</span>(String key) {
        <span class="hljs-keyword">return</span> redisTemplate.boundHashOps(key).size();
    }


    <span class="hljs-keyword">public</span> Map&lt;String, Object&gt; <span class="hljs-title">getMap</span>(String key) {
        <span class="hljs-keyword">return</span> redisTemplate.boundHashOps(key).entries();
    }


    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title">getMapField</span>(String key, String field) {
        <span class="hljs-keyword">return</span> (T) redisTemplate.boundHashOps(key).<span class="hljs-keyword">get</span>(field);
    }


    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title">hasMapKey</span>(String key, String field) {
        <span class="hljs-keyword">return</span> redisTemplate.boundHashOps(key).hasKey(field);
    }


    <span class="hljs-keyword">public</span> List&lt;Object&gt; <span class="hljs-title">getMapFieldValue</span>(String key) {
        <span class="hljs-keyword">return</span> redisTemplate.boundHashOps(key).values();
    }


    <span class="hljs-keyword">public</span> Set&lt;Object&gt; <span class="hljs-title">getMapFieldKey</span>(String key) {
        <span class="hljs-keyword">return</span> redisTemplate.boundHashOps(key).keys();
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addMap</span>(String key, Map&lt;String, Object&gt; map) {
        redisTemplate.boundHashOps(key).putAll(map);
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addMap</span>(String key, String field, Object <span class="hljs-keyword">value</span>) {
        redisTemplate.boundHashOps(key).put(field, <span class="hljs-keyword">value</span>);
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addMap</span>(String key, String field, Object <span class="hljs-keyword">value</span>, <span class="hljs-keyword">long</span> time) {
        redisTemplate.boundHashOps(key).put(field, <span class="hljs-keyword">value</span>);
        redisTemplate.boundHashOps(key).expire(time, TimeUnit.SECONDS);
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">watch</span>(String key) {
        redisTemplate.watch(key);
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addSet</span>(String key, Object... obj) {
        redisTemplate.boundSetOps(key).add(obj);
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">removeSetValue</span>(String key, Object obj) {
        <span class="hljs-keyword">return</span> redisTemplate.boundSetOps(key).remove(obj);
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">removeSetValue</span>(String key, Object... obj) {
        <span class="hljs-keyword">if</span> (obj != <span class="hljs-keyword">null</span> &amp;&amp; obj.length &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">return</span> redisTemplate.boundSetOps(key).remove(obj);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>L;
    }


    <span class="hljs-keyword">public</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getSetSize</span>(String key) {
        <span class="hljs-keyword">return</span> redisTemplate.boundSetOps(key).size();
    }


    <span class="hljs-keyword">public</span> Boolean <span class="hljs-title">hasSetValue</span>(String key, Object obj) {
        Boolean boo = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">int</span> t =<span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>){
            <span class="hljs-keyword">try</span> {
                boo = redisTemplate.boundSetOps(key).isMember(obj);
                <span class="hljs-keyword">break</span>;
            } <span class="hljs-keyword">catch</span> (Exception e) {
                logger.error(<span class="hljs-string">"key["</span> + key + <span class="hljs-string">"],obj["</span> + obj + <span class="hljs-string">"]判断Set中的值是否存在失败,异常信息:"</span> + e.getMessage());
                t++;
            }
            <span class="hljs-keyword">if</span>(t&gt;times){
                <span class="hljs-keyword">break</span>;
            }
        }
        logger.info(<span class="hljs-string">"key["</span> + key + <span class="hljs-string">"],obj["</span> + obj + <span class="hljs-string">"]是否存在,boo:"</span> + boo);
        <span class="hljs-keyword">return</span> boo;
    }


    <span class="hljs-keyword">public</span> Set&lt;Object&gt; <span class="hljs-title">getSet</span>(String key) {
        <span class="hljs-keyword">return</span> redisTemplate.boundSetOps(key).members();
    }


    <span class="hljs-keyword">public</span> Set&lt;Object&gt; <span class="hljs-title">getSetUnion</span>(String key, String otherKey) {
        <span class="hljs-keyword">return</span> redisTemplate.boundSetOps(key).union(otherKey);
    }


    <span class="hljs-keyword">public</span> Set&lt;Object&gt; <span class="hljs-title">getSetUnion</span>(String key, Set&lt;Object&gt; <span class="hljs-keyword">set</span>) {
        <span class="hljs-keyword">return</span> redisTemplate.boundSetOps(key).union(<span class="hljs-keyword">set</span>);
    }


    <span class="hljs-keyword">public</span> Set&lt;Object&gt; <span class="hljs-title">getSetIntersect</span>(String key, String otherKey) {
        <span class="hljs-keyword">return</span> redisTemplate.boundSetOps(key).intersect(otherKey);
    }


    <span class="hljs-keyword">public</span> Set&lt;Object&gt; <span class="hljs-title">getSetIntersect</span>(String key, Set&lt;Object&gt; <span class="hljs-keyword">set</span>) {
        <span class="hljs-keyword">return</span> redisTemplate.boundSetOps(key).intersect(<span class="hljs-keyword">set</span>);
    }
}</code></pre> 
<p>五.单元测试 <br> 创建一个测试的base了后面的类只需要继承这个父类即可</p> 
<pre class="prettyprint"><code class=" hljs ruby"><span class="hljs-variable">@RunWith</span>(<span class="hljs-constant">SpringJUnit4ClassRunner</span>.<span class="hljs-keyword">class</span>)
<span class="hljs-variable">@SpringBootTest</span>(classes=<span class="hljs-constant">App</span>.<span class="hljs-keyword">class</span>)
<span class="hljs-variable">@WebAppConfiguration</span>
public <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">BaseTest</span> {<!-- --></span>
}</code></pre> 
<p>测试：</p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RedisTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">BaseTest</span> {<!-- --></span>

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">final</span> Logger logger = LoggerFactory.getLogger(<span class="hljs-keyword">this</span>.getClass());
    <span class="hljs-annotation">@Resource</span>
     RedisHandle rs;

    <span class="hljs-annotation">@Test</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">RedisTest</span>() <span class="hljs-keyword">throws</span> Exception {
         rs.set(<span class="hljs-number">1</span>, <span class="hljs-string">"11"</span>);
            System.out.println(rs.get(<span class="hljs-number">1</span>));  
    }


}</code></pre> 
<p>文章来源： <a href="http://www.haha174.top/article/details/251216" rel="nofollow">http://www.haha174.top/article/details/251216</a> <br> 项目源码： <a href="https://github.com/haha174/boot.git">https://github.com/haha174/boot.git</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bdda2c9004cefb731e02c1aad9b85c54/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">try catch 执行原理及顺序</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/232798dfd9f2d6866023a701ca3b446b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python opencv入门 SIFT算法（33）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>