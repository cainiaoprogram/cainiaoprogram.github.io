<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>接入alipay-sdk - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="接入alipay-sdk" />
<meta property="og:description" content="沙箱环境申请地址：https://open.alipay.com/platform/appDaily.htm?tab=info
所需参数：
//支付宝网关地址:https://openapi.alipay.com/gateway.do //支付宝申请的APPID //商户应用私钥(与支付宝数据交互时,保证数据安全，防止数据被篡改) //支付宝公钥(与支付宝数据交互时，保证数据安全,防止数据被篡改) //签名算法类型(RSA2或者RSA,支付宝推荐使用RSA2) //编码格式(utf-8,gb2312,gbk) 各接口详细参数地址：https://opendocs.alipay.com/apis
沙箱app下载地址（注意沙箱APP只有安卓版本的）：https://open.alipay.com/platform/appDaily.htm?tab=tool
maven包地址：
&lt;dependency&gt; &lt;groupId&gt;com.alipay.sdk&lt;/groupId&gt; &lt;artifactId&gt;alipay-sdk-java&lt;/artifactId&gt; &lt;version&gt;4.22.57.ALL&lt;/version&gt; &lt;/dependency&gt; SDK所需初始化参数类：
app: pay: ali: app_id: 你的appId mch_id: 你的沙箱商户id server_url: https://openapi.alipaydev.com/gateway.do #这里是沙箱版本的地址 alipay_private_key: 你的应用私钥 alipay_public_key: 你的支付宝公钥 charset: UTF-8 sign_type: RSA2 format: json notify_url: http://localhost:8080/api/pay/ali/notify return_url: http://localhost:8080/api refund_url: http://localhost:8080/api /** * @author zhangyujie * @since 2022-04-05 **/ @Data public class AliProperties { /** * 应用id */ public String appId; /** * 应用私钥 */ public String alipayPrivateKey; /** * 支付宝公钥 */ public String alipayPublicKey; /** * 字符编码 */ public String charset; /** * 签名方式 */ public String signType; /** * 数据格式 */ public String format; /** * 商家id */ private String mchId; /** * 调用接口的url */ private String serverUrl; /** * 支付回调url */ private String notifyUrl; /** * pc支付前台通知 */ private String returnUrl; /** * 退款url */ private String refundUrl; } /** * @author zhangyujie * @since 2022-04-05 **/ @Configuration @ConfigurationProperties(prefix = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/bb2f6da072af6476f9d2d25013615685/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-05T22:17:12+08:00" />
<meta property="article:modified_time" content="2022-04-05T22:17:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">接入alipay-sdk</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>沙箱环境申请地址：<a href="https://open.alipay.com/platform/appDaily.htm?tab=info" rel="nofollow">https://open.alipay.com/platform/appDaily.htm?tab=info</a><br> 所需参数：</p> 
<pre><code class="prism language-text">//支付宝网关地址:https://openapi.alipay.com/gateway.do 
//支付宝申请的APPID 
//商户应用私钥(与支付宝数据交互时,保证数据安全，防止数据被篡改) 
//支付宝公钥(与支付宝数据交互时，保证数据安全,防止数据被篡改) 
//签名算法类型(RSA2或者RSA,支付宝推荐使用RSA2) 
//编码格式(utf-8,gb2312,gbk) 

</code></pre> 
<p>各接口详细参数地址：<a href="https://opendocs.alipay.com/apis" rel="nofollow">https://opendocs.alipay.com/apis</a><br> 沙箱app下载地址（注意沙箱APP只有安卓版本的）：<a href="https://open.alipay.com/platform/appDaily.htm?tab=tool" rel="nofollow">https://open.alipay.com/platform/appDaily.htm?tab=tool</a></p> 
<p>maven包地址：</p> 
<pre><code class="prism language-pom">  &lt;dependency&gt;
            &lt;groupId&gt;com.alipay.sdk&lt;/groupId&gt;
            &lt;artifactId&gt;alipay-sdk-java&lt;/artifactId&gt;
            &lt;version&gt;4.22.57.ALL&lt;/version&gt;
        &lt;/dependency&gt;
</code></pre> 
<p><strong>SDK所需初始化参数类</strong>：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">app</span><span class="token punctuation">:</span>
  <span class="token key atrule">pay</span><span class="token punctuation">:</span>
    <span class="token key atrule">ali</span><span class="token punctuation">:</span>
      <span class="token key atrule">app_id</span><span class="token punctuation">:</span> 你的appId
      <span class="token key atrule">mch_id</span><span class="token punctuation">:</span> 你的沙箱商户id
      <span class="token key atrule">server_url</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//openapi.alipaydev.com/gateway.do <span class="token comment">#这里是沙箱版本的地址</span>
      <span class="token key atrule">alipay_private_key</span><span class="token punctuation">:</span> 你的应用私钥
      <span class="token key atrule">alipay_public_key</span><span class="token punctuation">:</span> 你的支付宝公钥
      <span class="token key atrule">charset</span><span class="token punctuation">:</span> UTF<span class="token punctuation">-</span><span class="token number">8</span>
      <span class="token key atrule">sign_type</span><span class="token punctuation">:</span> RSA2
      <span class="token key atrule">format</span><span class="token punctuation">:</span> json
      <span class="token key atrule">notify_url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/api/pay/ali/notify
      <span class="token key atrule">return_url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/api
      <span class="token key atrule">refund_url</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/api
</code></pre> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @author zhangyujie
 * @since 2022-04-05
 **/</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AliProperties</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 应用id
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> appId<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 应用私钥
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> alipayPrivateKey<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 支付宝公钥
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> alipayPublicKey<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 字符编码
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> charset<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 签名方式
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> signType<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 数据格式
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> format<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 商家id
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> mchId<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 调用接口的url
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> serverUrl<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 支付回调url
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> notifyUrl<span class="token punctuation">;</span>

    <span class="token comment">/**
     * pc支付前台通知
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> returnUrl<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 退款url
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> refundUrl<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token comment">/**
 * @author zhangyujie
 * @since 2022-04-05
 **/</span>
<span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"app.pay"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppProperties</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">AliProperties</span> ali <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AliProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">AliProperties</span> <span class="token function">getAli</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> ali<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAli</span><span class="token punctuation">(</span><span class="token class-name">AliProperties</span> ali<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ali <span class="token operator">=</span> ali<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p><strong>创建AlipayClient</strong>：</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AppProperties</span> appProperties<span class="token punctuation">;</span>
 <span class="token comment">/**
     * 阿里 sdk 封装
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">AlipayClient</span> alipayClient<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@PostConstruct</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        alipayClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultAlipayClient</span><span class="token punctuation">(</span>
                appProperties<span class="token punctuation">.</span><span class="token function">getAli</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServerUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                appProperties<span class="token punctuation">.</span><span class="token function">getAli</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAppId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                appProperties<span class="token punctuation">.</span><span class="token function">getAli</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAlipayPrivateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                appProperties<span class="token punctuation">.</span><span class="token function">getAli</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                appProperties<span class="token punctuation">.</span><span class="token function">getAli</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getCharset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                appProperties<span class="token punctuation">.</span><span class="token function">getAli</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAlipayPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                appProperties<span class="token punctuation">.</span><span class="token function">getAli</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSignType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><strong>获取支付二维码</strong>：</p> 
<pre><code class="prism language-java"> <span class="token comment">/**
     * 支付宝扫码支付生成二维码响应到浏览器
     *
     * @param amount
     * @param response
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">aliQrCodePay</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> amount<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">AlipayTradePrecreateRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayTradePrecreateRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"out_trade_no"</span><span class="token punctuation">,</span> <span class="token class-name">RandomUtil</span><span class="token punctuation">.</span><span class="token function">randomNumbers</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"total_amount"</span><span class="token punctuation">,</span> amount<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"subject"</span><span class="token punctuation">,</span> <span class="token string">"备注"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"body"</span><span class="token punctuation">,</span> <span class="token string">"详情"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"store_id"</span><span class="token punctuation">,</span> <span class="token string">"NJ_2031"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"timeout_express"</span><span class="token punctuation">,</span> <span class="token string">"90m"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setBizContent</span><span class="token punctuation">(</span>objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setNotifyUrl</span><span class="token punctuation">(</span>appProperties<span class="token punctuation">.</span><span class="token function">getAli</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getNotifyUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">AlipayTradePrecreateResponse</span> responseData <span class="token operator">=</span> alipayClient<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"response:{}"</span><span class="token punctuation">,</span> responseData<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> qrCode <span class="token operator">=</span> responseData<span class="token punctuation">.</span><span class="token function">getQrCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">ObjectUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>qrCode<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 这里工具类是根据支付宝返回的qrCode利用谷歌的zxing包生成的二维码放进response</span>
            <span class="token class-name">PaymentUtils</span><span class="token punctuation">.</span><span class="token function">createQRCode</span><span class="token punctuation">(</span>qrCode<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>测试生成二维码：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @author zhangyujie
 * @since 2022-04-05
 **/</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/api/pay/ali"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AliPayController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">AliPayService</span> aliPayService<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 支付宝扫码支付预下单
     *
     * @param amount
     * @param response
     * @return
     * @throws Exception
     */</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/qrcode"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">qrCodePay</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> amount<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        aliPayService<span class="token punctuation">.</span><span class="token function">aliQrCodePay</span><span class="token punctuation">(</span>amount<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>可以看到我们的sdk客户端创建的没问题，参数一切正常：这是调用返回的二维码字符串：<br> <img src="https://images2.imgbox.com/9e/84/Yo17IJ8b_o.png" alt="在这里插入图片描述"><br> 根据支付宝返回的qrCode利用谷歌的zxing包生成的二维码放进response</p> 
<pre><code class="prism language-java"> <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createQRCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> content<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">,</span> height <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> format <span class="token operator">=</span> <span class="token string">"png"</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">EncodeHintType</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> hashMap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">EncodeHintType</span><span class="token punctuation">.</span>CHARACTER_SET<span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">;</span>
        hashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">EncodeHintType</span><span class="token punctuation">.</span>ERROR_CORRECTION<span class="token punctuation">,</span> <span class="token class-name">ErrorCorrectionLevel<span class="token punctuation">.</span>M</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hashMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">EncodeHintType</span><span class="token punctuation">.</span>MARGIN<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Cache-control"</span><span class="token punctuation">,</span> <span class="token string">"no-cache"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Pragma"</span><span class="token punctuation">,</span> <span class="token string">"no-cache"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"content-type"</span><span class="token punctuation">,</span> <span class="token string">"image/png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setCharacterEncoding</span><span class="token punctuation">(</span><span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">.</span><span class="token function">displayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            response<span class="token punctuation">.</span><span class="token function">setDateHeader</span><span class="token punctuation">(</span><span class="token string">"Expires"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BitMatrix</span> bitMatrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MultiFormatWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token class-name">BarcodeFormat</span><span class="token punctuation">.</span>QR_CODE<span class="token punctuation">,</span> width<span class="token punctuation">,</span> height<span class="token punctuation">,</span> hashMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">BufferedImage</span> img <span class="token operator">=</span> <span class="token class-name">MatrixToImageWriter</span><span class="token punctuation">.</span><span class="token function">toBufferedImage</span><span class="token punctuation">(</span>bitMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">ImageIO</span><span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> format<span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"create QRCode error message:{}"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>postmain返回结果：<br> <img src="https://images2.imgbox.com/01/7c/zavGjInO_o.png" alt="在这里插入图片描述"><br> 可以看到二维码是正常出来的，接下来我们使用沙箱APP扫码支付出现问题，咨询了支付宝开发组客服得知沙箱APP在升级，正常情况下是可以看到沙箱app的余额的，现在查看余额也是提示网络不给力请稍后重试<br> <img src="https://images2.imgbox.com/72/56/RxWZtr3I_o.jpg" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/30/7c/B5aMICu5_o.jpg" alt="在这里插入图片描述"></p> 
<p><strong>支付宝提现</strong>：</p> 
<pre><code class="prism language-java"> <span class="token comment">/**
     * 支付宝提现
     *
     * @param amount
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">deposit</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> amount<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">AlipayFundTransToaccountTransferModel</span> transferModel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayFundTransToaccountTransferModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        transferModel<span class="token punctuation">.</span><span class="token function">setOutBizNo</span><span class="token punctuation">(</span><span class="token class-name">RandomUtil</span><span class="token punctuation">.</span><span class="token function">randomNumbers</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        transferModel<span class="token punctuation">.</span><span class="token function">setAmount</span><span class="token punctuation">(</span><span class="token string">"0.01"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        transferModel<span class="token punctuation">.</span><span class="token function">setPayeeAccount</span><span class="token punctuation">(</span><span class="token string">"收款方账户"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        transferModel<span class="token punctuation">.</span><span class="token function">setPayeeRealName</span><span class="token punctuation">(</span><span class="token string">"收款方真实姓名"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        transferModel<span class="token punctuation">.</span><span class="token function">setPayerShowName</span><span class="token punctuation">(</span><span class="token string">"付款方姓名"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        transferModel<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span><span class="token string">"remark"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ALIPAY_LOGONID：支付宝登录号，支持邮箱和手机号格式</span>
        transferModel<span class="token punctuation">.</span><span class="token function">setPayeeType</span><span class="token punctuation">(</span><span class="token string">"ALIPAY_LOGONID"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">AlipayFundTransToaccountTransferRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayFundTransToaccountTransferRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            request<span class="token punctuation">.</span><span class="token function">setBizModel</span><span class="token punctuation">(</span>transferModel<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">AlipayFundTransToaccountTransferResponse</span> response <span class="token operator">=</span> alipayClient<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AlipayApiException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ali deposit error message:{}"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token class-name">CommonMessage</span><span class="token punctuation">.</span>ALI_DEPOSIT_SUCCESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">CommonMessage</span><span class="token punctuation">.</span>ALI_DEPOSIT_FAILED<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><strong>PC支付</strong>：</p> 
<pre><code class="prism language-java"> <span class="token comment">/**
     * 阿里pc支付
     *
     * @param amount
     * @param servletRequest
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">aliPcPay</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> amount<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> servletRequest<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">AlipayTradePagePayRequest</span> payRequest <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayTradePagePayRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 前台通知</span>
        payRequest<span class="token punctuation">.</span><span class="token function">setReturnUrl</span><span class="token punctuation">(</span>appProperties<span class="token punctuation">.</span><span class="token function">getAli</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getReturnUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 后台回调</span>
        payRequest<span class="token punctuation">.</span><span class="token function">setNotifyUrl</span><span class="token punctuation">(</span>appProperties<span class="token punctuation">.</span><span class="token function">getAli</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getNotifyUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"out_trade_no"</span><span class="token punctuation">,</span> <span class="token string">"订单号"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 订单金额:元</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"total_amount"</span><span class="token punctuation">,</span> amount<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"subject"</span><span class="token punctuation">,</span> <span class="token string">"订单标题"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 实际收款账号，一般填写商户PID即可</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"seller_id"</span><span class="token punctuation">,</span> appProperties<span class="token punctuation">.</span><span class="token function">getAli</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMchId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 电脑网站支付</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"product_code"</span><span class="token punctuation">,</span> <span class="token string">"FAST_INSTANT_TRADE_PAY"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"body"</span><span class="token punctuation">,</span> <span class="token string">"两个橘子"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        payRequest<span class="token punctuation">.</span><span class="token function">setBizContent</span><span class="token punctuation">(</span>objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"业务参数:"</span> <span class="token operator">+</span> payRequest<span class="token punctuation">.</span><span class="token function">getBizContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token class-name">CommonMessage</span><span class="token punctuation">.</span>ERROR<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            result <span class="token operator">=</span> alipayClient<span class="token punctuation">.</span><span class="token function">pageExecute</span><span class="token punctuation">(</span>payRequest<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AlipayApiException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"ali pay error message:{}"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><strong>支付宝退款</strong>：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
     * 支付宝退款
     * @param outTradeNo
     * @param tradeNo
     * @param amount
     * @param servletRequest
     * @return
     * @throws Exception
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span> <span class="token function">aliRefund</span><span class="token punctuation">(</span><span class="token class-name">String</span> outTradeNo<span class="token punctuation">,</span><span class="token class-name">String</span> tradeNo<span class="token punctuation">,</span><span class="token class-name">Integer</span> amount<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> servletRequest<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 创建退款请求builder，设置请求参数</span>
        <span class="token class-name">AlipayTradeRefundRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayTradeRefundRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TreeMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 必须 商户订单号</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"out_trade_no"</span><span class="token punctuation">,</span> outTradeNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 必须 支付宝交易号</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"trade_no"</span><span class="token punctuation">,</span> tradeNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 必须 退款金额</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"refund_amount"</span><span class="token punctuation">,</span> amount<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 可选 代表 退款的原因说明</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"refund_reason"</span><span class="token punctuation">,</span> <span class="token string">"退款的原因说明"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 可选 标识一次退款请求，同一笔交易多次退款需要保证唯一（就是out_request_no在2次退款一笔交易时，要不一样），如需部分退款，则此参数必传</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"out_request_no"</span><span class="token punctuation">,</span> <span class="token class-name">RandomUtil</span><span class="token punctuation">.</span><span class="token function">randomNumbers</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 可选 代表 商户的门店编号</span>
        params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"store_id"</span><span class="token punctuation">,</span> <span class="token string">"90m"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setBizContent</span><span class="token punctuation">(</span>objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AlipayTradeRefundResponse</span> responseData <span class="token operator">=</span> alipayClient<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>responseData<span class="token punctuation">.</span><span class="token function">isSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ali refund success tradeNo:{}"</span><span class="token punctuation">,</span> <span class="token string">"订单号"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token class-name">CommonMessage</span><span class="token punctuation">.</span>SUCCESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"ali refund failed tradeNo:{}"</span><span class="token punctuation">,</span> <span class="token string">"订单号"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token class-name">CommonMessage</span><span class="token punctuation">.</span>ALI_PAY_REFUND_FAILED<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><strong>APP支付</strong>：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
     * 支付宝App支付
     *
     * @param amount
     * @param servletRequest
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">appPay</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> amount<span class="token punctuation">,</span> <span class="token class-name">HttpServletRequest</span> servletRequest<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">AlipayTradeAppPayRequest</span> request <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayTradeAppPayRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// SDK已经封装掉了公共参数，这里只需要传入业务参数。以下方法为sdk的model入参方式(model和biz_content同时存在的情况下取biz_content)。</span>
        <span class="token class-name">AlipayTradeAppPayModel</span> model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AlipayTradeAppPayModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setBody</span><span class="token punctuation">(</span><span class="token string">"购买手机"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span><span class="token string">"iPhone 13 pro max"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setOutTradeNo</span><span class="token punctuation">(</span><span class="token class-name">RandomUtil</span><span class="token punctuation">.</span><span class="token function">randomNumbers</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setTimeoutExpress</span><span class="token punctuation">(</span><span class="token string">"30m"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setTotalAmount</span><span class="token punctuation">(</span>amount<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        model<span class="token punctuation">.</span><span class="token function">setProductCode</span><span class="token punctuation">(</span><span class="token string">"QUICK_MSECURITY_PAY"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setBizModel</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">setNotifyUrl</span><span class="token punctuation">(</span>appProperties<span class="token punctuation">.</span><span class="token function">getAli</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getNotifyUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 这里和普通的接口调用不同，使用的是sdkExecute</span>
            <span class="token class-name">AlipayTradeAppPayResponse</span> response <span class="token operator">=</span> alipayClient<span class="token punctuation">.</span><span class="token function">sdkExecute</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//就是orderString 可以直接给客户端请求，无需再做处理。</span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"orderString:{}"</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> response<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">AlipayApiException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><strong>支付宝回调地址</strong>：</p> 
<pre><code class="prism language-java"> <span class="token comment">/**
     * 支付回调通知
     *
     * @param request
     * @param response
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">aliNotify</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> requestXml <span class="token operator">=</span> <span class="token class-name">PaymentUtils</span><span class="token punctuation">.</span><span class="token function">getRequestData</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span> requestMap <span class="token operator">=</span> <span class="token class-name">PaymentUtils</span><span class="token punctuation">.</span><span class="token function">xmlToMap</span><span class="token punctuation">(</span>requestXml<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>requestMap<span class="token punctuation">,</span> <span class="token class-name">CommonMessage</span><span class="token punctuation">.</span>XML_DATA_INCORRECTNESS<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 当返回的return_code为SUCCESS则回调成功</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>requestMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"notify success"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"notify failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p><a href="https://github.com/ZhangYuJie-88/pay.git">详细代码地址（由于appid为个人的，示例中已改为xxx，请替换自己的appid和公私钥）</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/26afbea4569d17579173b935d1e4eb30/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">轻量化神经网络整理</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5bd3074e76254bbdc61e9da567bf5040/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">动手学深度学习-线性回归的简单实现</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>