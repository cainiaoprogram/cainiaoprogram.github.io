<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Eventbus3.0入（踩）门（坑）之旅 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Eventbus3.0入（踩）门（坑）之旅" />
<meta property="og:description" content="首先祭出eventbus gayhub地址！
第一步： 导包：compile ‘org.greenrobot:eventbus:3.0.0’ 第二步： 需要一个class,它的作用就是接受传过来的信息，你可以理解成调用接口返回封装了数据的类
public class FirstEvent { private String mMsg; public FirstEvent(String msg) { mMsg = msg; } public String getMsg(){ return mMsg; } } 第三步： 在你需要接受消息的地方来一个这个（其实就是订阅），这个地方sticky = true暂可忽略，后面说。
@Subscribe(sticky = true,threadMode = ThreadMode.MAIN) public void postingME(FirstEvent event){ Log.i(&#34;robin1&#34;, &#34;postingME222: &#34;&#43;event.getMsg()); } 然后注册eventbus，比如在activity里面（这个地方可以抽取到baseactivity里面去，但是有坑，之后再说）
@Override public void onStart() { super.onStart(); EventBus.getDefault().register(this); } @Override public void onStop() { super.onStop(); EventBus.getDefault().unregister(this); } 第四步： 发送！注意，发送的数据类型要和Subscribe的方法的参数保持一致。
EventBus.getDefault().post(new FirstEvent(&#34;这是发送的文本111&#34;)); 上面就是官方介绍，说说使用场景吧，用过MVP模式的同学都知道，presenter拿到model的数据（其实就是接口返回的数据）之后，可以post出去，然后再view（activity）中接收，做一些UI的改变。 对，这是一般的情况，我突发奇想，两个activity之间传值可不可以？既然叫，事件总线，那么肯定是可以的，于是乎！ 在activity1中post数据，在activity2中注册eventbus,解注册eventbus，然后，订阅方法。一气呵成，跑起来：wtf?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/f6a76d9d9ca1291f10b0a7477e563db9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-10-26T13:24:16+08:00" />
<meta property="article:modified_time" content="2017-10-26T13:24:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Eventbus3.0入（踩）门（坑）之旅</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong><a href="https://github.com/greenrobot/EventBus" target="_blank" rel="noopener noreferrer">首先祭出eventbus gayhub地址！</a></strong></p> 
<p>第一步： <br> 导包：compile ‘org.greenrobot:eventbus:3.0.0’ <br> 第二步： <br> 需要一个class,它的作用就是接受传过来的信息，你可以理解成调用接口返回封装了数据的类</p> 
<pre class="prettyprint"><code class=" hljs cs">
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> FirstEvent {

    <span class="hljs-keyword">private</span> String mMsg;
    <span class="hljs-keyword">public</span> <span class="hljs-title">FirstEvent</span>(String msg) {
        mMsg = msg;
    }
    <span class="hljs-keyword">public</span> String <span class="hljs-title">getMsg</span>(){
        <span class="hljs-keyword">return</span> mMsg;
    }
}  </code></pre> 
<p>第三步： <br> 在你需要接受消息的地方来一个这个（其实就是订阅），这个地方sticky = true暂可忽略，后面说。</p> 
<pre class="prettyprint"><code class=" hljs cs"> @Subscribe(sticky = <span class="hljs-keyword">true</span>,threadMode = ThreadMode.MAIN)
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">postingME</span>(FirstEvent <span class="hljs-keyword">event</span>){
        Log.i(<span class="hljs-string">"robin1"</span>, <span class="hljs-string">"postingME222: "</span>+<span class="hljs-keyword">event</span>.getMsg());
    }</code></pre> 
<p>然后注册eventbus，比如在activity里面（这个地方可以抽取到baseactivity里面去，<strong>但是有坑</strong>，之后再说）</p> 
<pre class="prettyprint"><code class=" hljs java"><span class="hljs-annotation">@Override</span>
 <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onStart</span>() {
     <span class="hljs-keyword">super</span>.onStart();
     EventBus.getDefault().register(<span class="hljs-keyword">this</span>);
 }

 <span class="hljs-annotation">@Override</span>
 <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onStop</span>() {
     <span class="hljs-keyword">super</span>.onStop();
     EventBus.getDefault().unregister(<span class="hljs-keyword">this</span>);
 }</code></pre> 
<p>第四步： <br> 发送！<strong>注意，发送的数据类型要和Subscribe的方法的参数保持一致。</strong></p> 
<pre class="prettyprint"><code class=" hljs avrasm">EventBus<span class="hljs-preprocessor">.getDefault</span>()<span class="hljs-preprocessor">.post</span>(new FirstEvent(<span class="hljs-string">"这是发送的文本111"</span>))<span class="hljs-comment">;</span></code></pre> 
<p>上面就是官方介绍，说说使用场景吧，用过MVP模式的同学都知道，presenter拿到model的数据（其实就是接口返回的数据）之后，可以post出去，然后再view（activity）中接收，做一些UI的改变。 <br> 对，这是一般的情况，我突发奇想，两个activity之间传值可不可以？既然叫，事件总线，那么肯定是可以的，于是乎！ <br> 在activity1中post数据，在activity2中注册eventbus,解注册eventbus，然后，订阅方法。一气呵成，跑起来：wtf????怎么啥反应都没有？狂点，没用。</p> 
<p>原来你post的时候，activity2还没加载，eventbus还没有注册，所以订阅也没用。解决方案就是：使用postSticky发送，然后把订阅的方法上面的注解加上sticky = true就行了。其实，这样还不如sratactivityforresult。</p> 
<p>好了，开始踩坑： <br> 坑1：Subscriber class com.android.myapplication.login.MainActivity and its super classes have no public methods with the @Subscribe annotation</p> 
<p>可能你会碰到这样的一个bug.</p> 
<p><img src="https://images2.imgbox.com/68/52/jrRVvxgY_o.png" alt="看不清的有点，在新标签中查看" title=""></p> 
<p>bug原因：你注册eventbus的地方，没有订阅的方法。 <br> 解决方案：加上订阅的方法。 <br> 其实你不加，这就违背了eventbus的设计，发送了，但是没有接受，那有啥用呢？</p> 
<p>坑2： Subscriber class com.android.myapplication.login.MainActivity and its super classes have no public methods with the @Subscribe annotation <br> 有人骂我了，这不是第一个坑吗？确实，错误信息一样。我们看一下原因 <br> bug原因：这是因为你写了订阅方法，但是你的参数没写，也就是没有参数 <br> 解决方案：写上参数。 <br> 其实你想想，你不写参数，这是个啥？啥都不是。所以设计的时候还是给你报个错让你知道比较好。</p> 
<p>坑3：Subscriber class com.android.myapplication.login.MainActivity already registered to event class com.android.myapplication.FirstEvent <br> bug原因：多次注册eventbus <br> 解决方案：只能注册一次。 <br> 有人看到这，又要骂我了，玩呢？？你傻逼写两句EventBus.getDefault().register(this); <br> 大爷别急，确实任何人都不会连着写两句注册，除非马虎。但是，有一种情况，你们有baseactivity，你们的activity都继承于他，然后你又没仔细看baseactivity，然后你在activity里面注册了，也会导致这个问题，这个比较常见，尤其是新的项目二次开发的时候，这里我只是提一嘴，给大家提个醒。</p> 
<p>好了现总结到这吧，后期用的过程中有bug的话，我会再更新。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/12e037ac7d03f227a358c63c4aa699b6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">TMS320C6748_UART_EDMA</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2d7904ec2f7587b14e95beaefec74b28/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IOS下Libevent编译步骤，及引入Xcode备忘</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>