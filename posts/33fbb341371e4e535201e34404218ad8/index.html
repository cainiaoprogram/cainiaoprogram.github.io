<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>php  钉钉 免登,钉钉免登陆前端操作详解 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="php  钉钉 免登,钉钉免登陆前端操作详解" />
<meta property="og:description" content="在钉钉免登陆中，前端操作是很重要的，因为在前端我们需要调用钉钉的jsapi来获取code，而这个code值是至关重要的。所以我
再次清清楚楚的解析一遍前端的操作。下面的是我写的demo，我讲以这个demo为例进行讲解。
先是demo的主页代码：
[html]
html&gt;
dingding-1 var _config = ;
//调用jquery需要的库，手机版和电脑版的不同
//手机版钉钉免登引入的jsapi,和电脑版引入的不同
//获取code码值的js文件
钉钉test
未知
然后是调用jsapi前端的js代码文件demo.js(我放在项目的javascripts文件夹下)
代码如下：
[html]
dd.config({ //实现验证
agentId : _config.agentId,
corpId : _config.corpId,
timeStamp : _config.timeStamp,
nonceStr : _config.nonceStr,
signature : _config.signature,
jsApiList : [
&#34;runtime.info&#34;,
&#34;biz.contact.choose&#34;,
&#34;device.notification.confirm&#34;,
&#34;device.notification.alert&#34;,
&#34;device.notification.prompt&#34;,
&#34;biz.ding.post&#34;,
&#34;biz.util.openLink&#34; ]
});
dd.ready(function() { //验证成功
dd.runtime.permission.requestAuthCode({ //获取code码值
corpId : _config.corpId,
onSuccess : function(info) {
alert(&#34;authcode: &#34; &#43; info.code);
$.ajax({
url : &#34;userinfo?code=&#34; &#43; info.code &#43; &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/33fbb341371e4e535201e34404218ad8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-21T17:49:20+08:00" />
<meta property="article:modified_time" content="2021-03-21T17:49:20+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">php  钉钉 免登,钉钉免登陆前端操作详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>在钉钉免登陆中，前端操作是很重要的，因为在前端我们需要调用钉钉的jsapi来获取code，而这个code值是至关重要的。所以我</p> 
 <p>再次清清楚楚的解析一遍前端的操作。下面的是我写的demo，我讲以这个demo为例进行讲解。</p> 
 <p>先是demo的主页代码：</p> 
 <p>[html]</p> 
 <p>html&gt;</p>dingding-1 
 <p>var _config = ;</p> 
 <p>//调用jquery需要的库，手机版和电脑版的不同</p> 
 <p>//手机版钉钉免登引入的jsapi,和电脑版引入的不同</p> 
 <p>//获取code码值的js文件</p> 
 <p>钉钉test</p> 
 <p>未知</p> 
 <p>然后是调用jsapi前端的js代码文件demo.js(我放在项目的javascripts文件夹下)</p> 
 <p>代码如下：</p> 
 <p>[html]</p> 
 <p>dd.config({                                                          //实现验证</p> 
 <p>agentId : _config.agentId,</p> 
 <p>corpId : _config.corpId,</p> 
 <p>timeStamp : _config.timeStamp,</p> 
 <p>nonceStr : _config.nonceStr,</p> 
 <p>signature : _config.signature,</p> 
 <p>jsApiList : [</p> 
 <p>"runtime.info",</p> 
 <p>"biz.contact.choose",</p> 
 <p>"device.notification.confirm",</p> 
 <p>"device.notification.alert",</p> 
 <p>"device.notification.prompt",</p> 
 <p>"biz.ding.post",</p> 
 <p>"biz.util.openLink" ]</p> 
 <p>});</p> 
 <p>dd.ready(function() {                                               //验证成功</p> 
 <p>dd.runtime.permission.requestAuthCode({                         //获取code码值</p> 
 <p>corpId : _config.corpId,</p> 
 <p>onSuccess : function(info) {<!-- --></p> 
 <p>alert("authcode: " + info.code);</p> 
 <p>$.ajax({<!-- --></p> 
 <p>url : "userinfo?code=" + info.code + "&amp;corpid="     //请求后台通过code值获得userId</p> 
 <p>+ _config.corpId,</p> 
 <p>type : "GET",</p> 
 <p>success : function(data, status, xhr) {<!-- --></p> 
 <p>var info = JSON.parse(data);</p> 
 <p>document.getElementById("userName").innerHTML = info.name;</p> 
 <p>document.getElementById("userId").innerHTML = info.userid;</p> 
 <p>},</p> 
 <p>error : function(xhr, errorType, error) {<!-- --></p> 
 <p>logger.e("yinyien:" + _config.corpId);</p> 
 <p>alert(errorType + ", " + error);</p> 
 <p>}</p> 
 <p>});</p> 
 <p>},</p> 
 <p>onFail : function(err) {<!-- --></p> 
 <p>alert("fail: " + JSON.stringify(err));</p> 
 <p>}</p> 
 <p>});</p> 
 <p>});</p> 
 <p>dd.error(function(err) {                                             //验证失败</p> 
 <p>alert("进入到error中");</p> 
 <p>document.getElementById("userName").innerHTML = "验证出错";</p> 
 <p>alert("dd error: " + JSON.stringify(err));</p> 
 <p>});</p> 
 <p>当我们在钉钉手机版点击微应用时，微应用就访问我的demo的主页，在主页里定义了一个变量_config，这个变量是用来接收后台计算出来的验证需要的参数(详见我的博客钉钉免登详解)。然后便会去执行我们引入的demo.js文件，这个文件中所有调用的接口函数在jsapi中都有定义(在主页的代码中我们也引入了jsapi)，然后我们钉钉手机版就相当于一个对象，这个对象名就是dd,我们再demo.js中调用这个对象执行了一些操作。</p> 
 <p>首先得操作是验证信息，通过调用函数config()来实现，验证成功就会去执行dd.ready()这个函数中定义的函数，如果验证失败，就执行error()函数。注意，ready和error都是回调函数，要先执行config()，才会执行回调函数。并且所有的验证成功后的操作都要放在ready()中才会被执行。</p> 
 <p>最后我再总结一下常见的错误:</p> 
 <p>1.config(),ready()等接口得不到执行：</p> 
 <p>有几种原因会造成这种情况，最常见的就是你没有在手机上访问demo主页，而是随便找了一个电脑做测试访问。因为dd对象</p> 
 <p>是钉钉应用，只要在钉钉手机版访问时，才会有dd对象，相应的接口方法才会得到执行。另外一种常见的原因是你写的js文件有错误，错误就会导致js文件执行不下去，所以建议你用PC版的钉钉去调试，先下载一个PC版的钉钉RC版(RC版就是调试版)，然后在RC版钉钉上找一个空白的地方右键，就能看到show DevTools,点击进去，然后你再RC版中访问一下你的微应用，相应的错误信息会在devtools的控制台中显示(你可以在devtool右上角看到红色的叉号，那就是错误)，然后根据错误改正就好。</p> 
 <p>2.$ is not define:</p> 
 <p>因为我们在获得code之后想再获得userId，所以要通过$.ajax请求后台处理程序，所以调用了jquery的$.ajax方法，用这个方法需要</p> 
 <p>引入jquery库，手机版和PC版引入的库不一样，手机版引入的是zepto.min.js，电脑版需要引入的是jquery-1.4.4.min.js，自己先下好，放到本地，然后导入到相应的主页。</p> 
 <p>至此，钉钉免登陆问题就基本解决了。</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/00f73da3a464de9b1a8fcf767f0b76b2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">v-bind——Class 与 Style 绑定</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/227446ea5d85a5912ed9503304df1217/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Windows常用运行命令</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>