<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MyBatis映射（一对多查询） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MyBatis映射（一对多查询）" />
<meta property="og:description" content="目录
1.一对多查询
2.1 数据库准备
2.2 实体类
2.2.1 Orders.java
2.2.2 Users.java
2.3 用户配置接口
2.3.1 OrdersMapper.java
2.3.2 UsersMapper.java
2.4 用户配置文件
2.4.1 OrdersMapper.xml
2.4.2 UsersMapper.xml
2.5 解决办法
2.5.1 嵌套查询方式
1.一对多查询 2.1 数据库准备 代码：
USE mybatis; # 创建一个名称为tb_user的表 CREATE TABLE tb_user ( id int(32) PRIMARY KEY AUTO_INCREMENT, username varchar(32), address varchar(256) ); # 插入3条数据 INSERT INTO tb_user VALUES (&#39;1&#39;, &#39;小明&#39;, &#39;北京&#39;); INSERT INTO tb_user VALUES (&#39;2&#39;, &#39;李华&#39;, &#39;上海&#39;); INSERT INTO tb_user VALUES (&#39;3&#39;, &#39;李刚&#39;, &#39;上海&#39;); # 创建一个名称为tb_orders的表 CREATE TABLE tb_orders ( id int(32) PRIMARY KEY AUTO_INCREMENT, number varchar(32) NOT NULL, user_id int(32) NOT NULL, FOREIGN KEY(user_id) REFERENCES tb_user(id) ); # 插入3条数据 INSERT INTO tb_orders VALUES (&#39;1&#39;, &#39;1000011&#39;, &#39;1&#39;); INSERT INTO tb_orders VALUES (&#39;2&#39;, &#39;1000012&#39;, &#39;1&#39;); INSERT INTO tb_orders VALUES (&#39;3&#39;, &#39;1000013&#39;, &#39;2&#39;); 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/101fc9c38b899a213ffcccc9278d4a12/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-20T17:04:35+08:00" />
<meta property="article:modified_time" content="2023-05-20T17:04:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MyBatis映射（一对多查询）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="1.%E4%B8%80%E5%AF%B9%E5%A4%9A%E6%9F%A5%E8%AF%A2-toc" style="margin-left:0px;"><a href="#1.%E4%B8%80%E5%AF%B9%E5%A4%9A%E6%9F%A5%E8%AF%A2" rel="nofollow">1.一对多查询</a></p> 
<p id="2.1%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%86%E5%A4%87-toc" style="margin-left:40px;"><a href="#2.1%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%86%E5%A4%87" rel="nofollow">2.1 数据库准备</a></p> 
<p id="2.2%20%E5%AE%9E%E4%BD%93%E7%B1%BB-toc" style="margin-left:40px;"><a href="#2.2%20%E5%AE%9E%E4%BD%93%E7%B1%BB" rel="nofollow">2.2 实体类</a></p> 
<p id="2.2.1%20Orders.java-toc" style="margin-left:80px;"><a href="#2.2.1%20Orders.java" rel="nofollow">2.2.1 Orders.java</a></p> 
<p id="2.2.2%20Users.java-toc" style="margin-left:80px;"><a href="#2.2.2%20Users.java" rel="nofollow">2.2.2 Users.java</a></p> 
<p id="2.3%20%E7%94%A8%E6%88%B7%E9%85%8D%E7%BD%AE%E6%8E%A5%E5%8F%A3-toc" style="margin-left:40px;"><a href="#2.3%20%E7%94%A8%E6%88%B7%E9%85%8D%E7%BD%AE%E6%8E%A5%E5%8F%A3" rel="nofollow">2.3 用户配置接口</a></p> 
<p id="2.3.1%20OrdersMapper.java-toc" style="margin-left:80px;"><a href="#2.3.1%20OrdersMapper.java" rel="nofollow">2.3.1 OrdersMapper.java</a></p> 
<p id="2.3.2%20UsersMapper.java-toc" style="margin-left:80px;"><a href="#2.3.2%20UsersMapper.java" rel="nofollow">2.3.2 UsersMapper.java</a></p> 
<p id="2.4%20%E7%94%A8%E6%88%B7%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-toc" style="margin-left:40px;"><a href="#2.4%20%E7%94%A8%E6%88%B7%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" rel="nofollow">2.4 用户配置文件</a></p> 
<p id="2.4.1%20OrdersMapper.xml-toc" style="margin-left:80px;"><a href="#2.4.1%20OrdersMapper.xml" rel="nofollow">2.4.1 OrdersMapper.xml</a></p> 
<p id="2.4.2%20UsersMapper.xml-toc" style="margin-left:80px;"><a href="#2.4.2%20UsersMapper.xml" rel="nofollow">2.4.2 UsersMapper.xml</a></p> 
<p id="2.5%20%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95-toc" style="margin-left:40px;"><a href="#2.5%20%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95" rel="nofollow">2.5 解决办法</a></p> 
<p id="2.5.1%20%E5%B5%8C%E5%A5%97%E6%9F%A5%E8%AF%A2%E6%96%B9%E5%BC%8F-toc" style="margin-left:80px;"><a href="#2.5.1%20%E5%B5%8C%E5%A5%97%E6%9F%A5%E8%AF%A2%E6%96%B9%E5%BC%8F" rel="nofollow">2.5.1 嵌套查询方式</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="1.%E4%B8%80%E5%AF%B9%E5%A4%9A%E6%9F%A5%E8%AF%A2">1.一对多查询</h2> 
<h3 id="2.1%20%E6%95%B0%E6%8D%AE%E5%BA%93%E5%87%86%E5%A4%87">2.1 数据库准备</h3> 
<p><img alt="" height="1027" src="https://images2.imgbox.com/9c/5b/KCjVj3sk_o.png" width="1200"></p> 
<p> </p> 
<p>代码：</p> 
<pre><code class="language-sql">USE mybatis;
# 创建一个名称为tb_user的表
CREATE TABLE tb_user (
  id int(32) PRIMARY KEY AUTO_INCREMENT,
  username varchar(32),
  address varchar(256)
 );
# 插入3条数据
INSERT INTO tb_user VALUES ('1', '小明', '北京');
INSERT INTO tb_user VALUES ('2', '李华', '上海');
INSERT INTO tb_user VALUES ('3', '李刚', '上海');
# 创建一个名称为tb_orders的表
CREATE TABLE tb_orders (
  id int(32) PRIMARY KEY AUTO_INCREMENT,
  number varchar(32) NOT NULL,
  user_id int(32) NOT NULL,
  FOREIGN KEY(user_id) REFERENCES tb_user(id)
);
# 插入3条数据
INSERT INTO tb_orders VALUES ('1', '1000011', '1');
INSERT INTO tb_orders VALUES ('2', '1000012', '1');
INSERT INTO tb_orders VALUES ('3', '1000013', '2');
</code></pre> 
<h3 id="2.2%20%E5%AE%9E%E4%BD%93%E7%B1%BB">2.2 实体类</h3> 
<h4 id="2.2.1%20Orders.java">2.2.1 Orders.java</h4> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/67/af/S3Df36nU_o.png" width="1200"></p> 
<p> 代码：</p> 
<pre><code class="language-java">package com.biem.pojo;

import lombok.*;

@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@ToString
public class Orders {
    private Integer id;
    private String number;
    private Integer userId;
}
</code></pre> 
<h4 id="2.2.2%20Users.java">2.2.2 Users.java</h4> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/5f/e9/f4wJYfkl_o.png" width="1200"></p> 
<p> </p> 
<p>代码：</p> 
<pre><code class="language-java">package com.biem.pojo;

import lombok.*;

import java.util.List;

@Getter
@Setter
@NoArgsConstructor
@AllArgsConstructor
@ToString
public class Users {
    private Integer id;
    private String username;
    private String address;
    private List&lt;Orders&gt; ordersList;
}
</code></pre> 
<h3 id="2.3%20%E7%94%A8%E6%88%B7%E9%85%8D%E7%BD%AE%E6%8E%A5%E5%8F%A3">2.3 用户配置接口</h3> 
<h4 id="2.3.1%20OrdersMapper.java">2.3.1 OrdersMapper.java</h4> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/ee/0b/v4Rl5Z0q_o.png" width="1200"> </p> 
<p>代码：</p> 
<pre><code class="language-java">package com.biem.mapper;

public interface OrdersMapper {
}
</code></pre> 
<h4 id="2.3.2%20UsersMapper.java">2.3.2 UsersMapper.java</h4> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/f2/4e/xUi3m5uF_o.png" width="1200"></p> 
<p> </p> 
<p>代码：</p> 
<pre><code class="language-java">package com.biem.mapper;

public interface UsersMapper {
}
</code></pre> 
<h3 id="2.4%20%E7%94%A8%E6%88%B7%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">2.4 用户配置文件</h3> 
<h4 id="2.4.1%20OrdersMapper.xml">2.4.1 OrdersMapper.xml</h4> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/cc/8f/mDOvtOuc_o.png" width="1200"></p> 
<p> </p> 
<p>代码：</p> 
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;
&lt;mapper namespace="com.biem.mapper.OrdersMapper"&gt;
&lt;/mapper&gt;
</code></pre> 
<h4 id="2.4.2%20UsersMapper.xml">2.4.2 UsersMapper.xml</h4> 
<p><img alt="" height="1080" src="https://images2.imgbox.com/57/d1/SQB6IhWa_o.png" width="1200"></p> 
<p> </p> 
<p>代码：</p> 
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;
&lt;mapper namespace="com.biem.mapper.UsersMapper"&gt;
&lt;/mapper&gt;
</code></pre> 
<h3 id="2.5%20%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95">2.5 解决办法</h3> 
<h4 id="2.5.1%20%E5%B5%8C%E5%A5%97%E6%9F%A5%E8%AF%A2%E6%96%B9%E5%BC%8F">2.5.1 嵌套查询方式</h4> 
<p>2.5.1.1 OrdersMapper.java</p> 
<p>代码：</p> 
<pre><code class="language-java">package com.biem.mapper;

public interface OrdersMapper {
	public List&lt;Orders&gt; selectOrders(Integer uid);
}

</code></pre> 
<p>2.5.1.2 UsersMapper.java</p> 
<p>代码：</p> 
<pre><code class="language-java">package com.biem.mapper;

import com.biem.pojo.User;

public interface UserMapper {
    public User findUserById(int id);
}

</code></pre> 
<p>2.5.1.3 OrdersMapper.xml（见上图）</p> 
<p>代码：</p> 
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;
&lt;mapper namespace="com.biem.mapper.OrdersMapper"&gt;
    &lt;!-- public List&lt;Orders&gt; selectOrders(Integer user_id); --&gt;
    &lt;select id="selectOrders" parameterType="Integer" resultType="Orders"&gt;
        select * from tb_orders where user_id=#{userId}
    &lt;/select&gt;
&lt;/mapper&gt;
</code></pre> 
<p>2.5.1.4 UsersMapper.xml（见上图）</p> 
<p>代码：</p> 
<pre><code class="language-XML">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;
&lt;mapper namespace="com.biem.mapper.UsersMapper"&gt;
    &lt;resultMap id="usersWithOrders1" type="Users"&gt;
        &lt;id property="id" column="id"&gt;&lt;/id&gt;
        &lt;result property="username" column="username"/&gt;
        &lt;result property="address" column="address"/&gt;
        &lt;!--由于查询老师中有一个属性为所有学生对象集合，所一使用collection标签进行嵌套，
		方法的返回值是List，所以javaType使用ArrayList来接收，而list中泛型约束类型放的
		是orders对象所以使用ofType为orderst来进行映射，使用select进行子查询，并用column
		将查询出的id字段传给子查询需要的id--&gt;
        &lt;!--此处javaType可以省略--&gt;
        &lt;collection property="ordersList" javaType="ArrayList" ofType="orders" select="com.biem.mapper.OrdersMapper.selectOrders" column="id"/&gt;
    &lt;/resultMap&gt;

    &lt;!-- public Users findUserById(Integer id); --&gt;
    &lt;select id="findUserById" parameterType="Integer" resultMap="usersWithOrders1"&gt;
        select * from tb_user where id = #{id}
    &lt;/select&gt;
&lt;/mapper&gt;
</code></pre> 
<p>2.5.1.5 UsersTest.java</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/91/99/TOxMpmXc_o.png" width="1200"></p> 
<p>代码：</p> 
<pre><code class="language-java">import org.junit.Test;

public class UsersTest {

    @Test
    public void testFindUserById(){
        SqlSession session = MyBatisUtil.openSession();
        UsersMapper mapper = session.getMapper(UsersMapper.class);
        Users user = mapper.findUserById(1);
        System.out.println("user = " + user);
        session.close();
    }
}
</code></pre> 
<p>2.5.1.6 测试结果</p> 
<p><img alt="" height="525" src="https://images2.imgbox.com/d4/f0/xAo4ylOg_o.png" width="1200"></p> 
<p> </p> 
<p> 2.5.2 嵌套结果方式</p> 
<p>2.5.2.1 UsersMapper.java添加</p> 
<p>代码：</p> 
<pre><code class="language-java">public Users findUserByIdWithNestedResults(Integer id);
</code></pre> 
<p>2.5.2.2 UsersMapper.xml添加</p> 
<p><img alt="" height="934" src="https://images2.imgbox.com/f2/5a/dz3HUs83_o.png" width="1200"></p> 
<p> </p> 
<p>代码：</p> 
<pre><code class="language-java">    &lt;!-- public Users findUserByIdWithNestedResults(Integer id); --&gt;
    &lt;!-- 一对多：查看某一个用户及关联的订单信息，
        注意：当关联查询出来的列名相同时，则需要使用别名区分  --&gt;
    &lt;select id="findUserByIdWithNestedResults" parameterType="Integer" resultMap="UsersWithOrdersResult" &gt;
        select u.*, o.id as orders_id , o.number, o.user_id
        from tb_user u, tb_orders o
        where u.id = o.user_id and u.id=#{id}
    &lt;/select&gt;
    &lt;resultMap id="UsersWithOrdersResult" type="Users"&gt;
        &lt;id property="id" column="id"&gt;&lt;/id&gt;
        &lt;result property="username" column="username"/&gt;
        &lt;result property="address" column="address"/&gt;
        &lt;collection property="ordersList" ofType="Orders"&gt;
            &lt;id property="id" column="orders_id"&gt;&lt;/id&gt;
            &lt;result property="number" column="number"/&gt;
            &lt;result property="userId" column="user_id"/&gt;
        &lt;/collection&gt;
    &lt;/resultMap&gt;
</code></pre> 
<p>2.5.2.3 UsersTest.java添加</p> 
<p><img alt="" height="951" src="https://images2.imgbox.com/4a/98/u57OwYsy_o.png" width="1200"></p> 
<p> </p> 
<p>代码：</p> 
<pre><code class="language-java">    @Test
    public void testFindUserByIdWithNestedResults(){
        SqlSession session = MyBatisUtil.openSession();
        UsersMapper mapper = session.getMapper(UsersMapper.class);
        Users user = mapper.findUserByIdWithNestedResults(1);
        System.out.println("user = " + user);
        session.close();
    }
</code></pre> 
<p>2.5.2.4 测试结果</p> 
<p><img alt="" height="544" src="https://images2.imgbox.com/3b/87/CNZaVqKq_o.png" width="1200"></p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6bd3ff08542a2aab5df8ceaa3a3f7656/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">我的CSDN文章</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0db263db42ff428e6311cb48a7fa7b4a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C&#43;&#43;游戏开发——坦克大战</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>