<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于opencv（c&#43;&#43;）和matlab的usb双目相机标定 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="基于opencv（c&#43;&#43;）和matlab的usb双目相机标定" />
<meta property="og:description" content="本人由于实际需要入手了一款双目免驱usb摄像头，因为需要做深度估计，故需要标定内参，双目相机标定主要是为了获得摄像头的内参(f,1/dx,1/dy,cx,cy)、畸变参数(k1,k2,k3,p1,p1)和外参(R,t)，用于接下来的双目校正和深度图生成。
具体标定步骤如下：
一、获得棋盘格图像
大多数双目标定都是用棋盘格进行标定，如下所示：
这里有一段c&#43;&#43;代码，用于生成棋盘格图像：
//双目采集图像程序 #include&lt;opencv2/opencv.hpp&gt; #include&lt;stdlib.h&gt; using namespace cv; using namespace std; #define WIDTH 1280 //双目分辨率，根据自己摄像头型号选择数值 #define HEIGHT 480 //双目分辨率，根据自己摄像头型号选择数值 int main(int argc, char *argv[]) { VideoCapture capture(0); if (!capture.isOpened()) { cout&lt;&lt;&#34;can not open the camera&#34;&lt;&lt;endl; cin.get(); exit(1); } capture.set(CV_CAP_PROP_FRAME_WIDTH, WIDTH); capture.set(CV_CAP_PROP_FRAME_HEIGHT, HEIGHT); string left_road; string right_road; int num = 0; int count = 0; Rect leftRect(0, 0, WIDTH/2, HEIGHT); //创建一个Rect框，属于cv中的类，四个参数代表x,y,width,height Rect rightRect(WIDTH/2, 0, WIDTH/2, HEIGHT); while (1) { Mat frame; capture&gt;&gt;frame; //载入图像 if (frame." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9e82a6422a1da4042b74fe0754aec658/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-12T21:14:00+08:00" />
<meta property="article:modified_time" content="2023-02-12T21:14:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于opencv（c&#43;&#43;）和matlab的usb双目相机标定</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <p style="">本人由于实际需要入手了一款双目免驱usb摄像头，因为需要做深度估计，故需要标定内参，双目<a class="kdocs-link" style="color:#0A6CFF;" href="https://so.csdn.net/so/search?q=%E7%9B%B8%E6%9C%BA%E6%A0%87%E5%AE%9A&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">相机标定</a>主要是为了获得摄像头的内参(f,1/dx,1/dy,cx,cy)、畸变参数(k1,k2,k3,p1,p1)和外参(R,t)，用于接下来的双目校正和深度图生成。</p> 
 <p style=""><span class="kdocs-bold" style="font-weight:bold;">具体标定步骤如下：</span></p> 
 <p style=""><span class="kdocs-bold" style="font-weight:bold;">一、获得棋盘格图像</span></p> 
 <p style="">大多数<a class="kdocs-link" style="color:#0A6CFF;" href="https://so.csdn.net/so/search?q=%E5%8F%8C%E7%9B%AE%E6%A0%87%E5%AE%9A&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">双目标定</a>都是用棋盘格进行标定，如下所示：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:421px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:142.99287%;height:0;"> 
    <img src="https://images2.imgbox.com/2b/72/q3t7Q21b_o.jpg" style="margin-left:;display:block;width:421px;margin-top:-142.99287%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">这里有一段c++代码，用于生成棋盘格图像：</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">//双目采集图像程序
#include&lt;opencv2/opencv.hpp&gt;
#include&lt;stdlib.h&gt;

using namespace cv;
using namespace std;

#define WIDTH 1280  //双目分辨率，根据自己摄像头型号选择数值
#define HEIGHT 480  //双目分辨率，根据自己摄像头型号选择数值
 
int main(int argc, char  *argv[])
{
    VideoCapture capture(0);
    if (!capture.isOpened())
    {
        cout&lt;&lt;"can not open the camera"&lt;&lt;endl; cin.get(); exit(1);
    }
    capture.set(CV_CAP_PROP_FRAME_WIDTH, WIDTH);
    capture.set(CV_CAP_PROP_FRAME_HEIGHT, HEIGHT);
    string left_road;
    string right_road;
    int num = 0;
    int count = 0;

    Rect leftRect(0, 0, WIDTH/2, HEIGHT);   //创建一个Rect框，属于cv中的类，四个参数代表x,y,width,height
    Rect rightRect(WIDTH/2, 0, WIDTH/2, HEIGHT);
    while (1) {
        Mat frame; capture&gt;&gt;frame; //载入图像
        if (frame.empty())
        {
            //判断图像是否载入 cout&lt;&lt;"can not load the frame"&lt;&lt;endl;
        } else {
            count++;
            if (count == 1) {
                cout&lt;&lt;frame.cols&lt;&lt;" "&lt;&lt;frame.rows&lt;&lt;endl;
            }
            Mat leftImg,rightImg;
            frame(leftRect).copyTo(leftImg);     //将一幅图分割成单独的左目图像
            frame(rightRect).copyTo(rightImg);   //将一幅图分割成单独的右目图像
            imshow("left",leftImg);
            imshow("right",rightImg);
            char q=waitKey(30);
            if (q == 27) {    //按esc退出
                break;
            }
            if (q == 32)     //按空格保存,保存到项目的build文件夹下
            {
                num++;
                cout &lt;&lt; num;
                left_road = "F:\\graph\\left\\" + to_string(num) + ".png";
                right_road = "F:\\graph\\right\\"+to_string(num) + ".png";
                imwrite(left_road, leftImg);
                imwrite(right_road, rightImg);
            }


        }
    }

}

</code></pre> 
 <p style="">dd对应的CMakeLists.txx文件为</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">cmake_minimum_required( VERSION 2.8)
project(biaoding)

# set( CMAKE_CXX_FLAGS "-std=c++11 -03")
find_package(OpenCV)
include_directories(${OpenCV})

add_executable(main src/main.cpp)
target_link_libraries(main ${OpenCV_LIBS})</code></pre> 
 <p style="">代码执行后，点击空格即可保存图像，大概采集50张左右。</p> 
 <p style="">生成棋盘格后，拿双目相机对棋盘格进行<span class="kdocs-bold" style="font-weight:bold;">不同位姿</span>的多次拍照采样，一般在60张左右即可(因为后期标定时需要舍弃掉不合格的图像，因此越多素材越好)。分别将左目和右目的图像存在两个文件夹中。图像如下：</p> 
 <p style="">左目图：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:631px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:78.92235%;height:0;"> 
    <img src="https://images2.imgbox.com/f1/6f/P2rG2paW_o.png" style="margin-left:;display:block;width:631px;margin-top:-78.92235%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">右目图：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:570px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:92.2807%;height:0;"> 
    <img src="https://images2.imgbox.com/58/ce/4Ct860rT_o.png" style="margin-left:;display:block;width:570px;margin-top:-92.2807%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""><span class="kdocs-bold" style="font-weight:bold;">二、matlab标定工具箱</span></p> 
 <p style=""><span class="kdocs-bold" style="font-weight:bold;">1、打开标定工具箱</span></p> 
 <p style="">在命令行输入stereoCameraCalibrator，出现如下界面：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:740px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:53.51351%;height:0;"> 
    <img src="https://images2.imgbox.com/1f/b5/LiVmlATX_o.png" style="margin-left:;display:block;width:740px;margin-top:-53.51351%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">将上面的“Skew”、“Tangential Distortion”以及“3 Coefficients”等选项选上，将“2 Coefficients”选项去掉，如下：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:740px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:15.945946%;height:0;"> 
    <img src="https://images2.imgbox.com/f9/e8/joPnpi2L_o.png" style="margin-left:;display:block;width:740px;margin-top:-15.945946%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""><span class="kdocs-bold" style="font-weight:bold;">2、载入图像</span></p> 
 <p style="">点击添加图像</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:51px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:150.9804%;height:0;"> 
    <img src="https://images2.imgbox.com/71/18/uqIUQJVe_o.jpg" style="margin-left:;display:block;width:51px;margin-top:-150.9804%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">出现如下界面：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:503px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:66.20278%;height:0;"> 
    <img src="https://images2.imgbox.com/b5/ac/UwddUa9n_o.png" style="margin-left:;display:block;width:503px;margin-top:-66.20278%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">Camera1代表左摄像头，Camera2代表右摄像头，分别选择存放着左右图像的文件夹，需要特别注意的是棋盘格的边长应该根据打印的实际大小填写，单位可以选择，然后点击OK，程序会自动检测采集的图像到底有多少可以使用，可以说MATLAB2015的这个工具十分挑剔，如果角度不好的话，将使用不了，因此在采集图像时，最好多的采集一些。</p> 
 <p style=""><span class="kdocs-bold" style="font-weight:bold;">3.标定</span></p> 
 <p style="">点击</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:81px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:123.45679%;height:0;"> 
    <img src="https://images2.imgbox.com/30/5d/X2tXZxqJ_o.png" style="margin-left:;display:block;width:81px;margin-top:-123.45679%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">按钮，开始标定：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1429px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:53.60392%;height:0;"> 
    <img src="https://images2.imgbox.com/8f/70/6lG0VsNK_o.png" style="margin-left:;display:block;width:1429px;margin-top:-53.60392%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">左下方的直方图为左右图像的标定误差，点击误差较大的直方图，可以直接在左边的图像对中找到对应的图像，右键选择“Remove and Recalibrate”，可以重复上述步骤，直到认为误差满足标定需求为止。一般Overall Mean Error小于0.3就可以了。</p> 
 <p style="">4、导出参数</p> 
 <p style="">点击</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:111px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:106.30631%;height:0;"> 
    <img src="https://images2.imgbox.com/09/95/IpJKQKmS_o.png" style="margin-left:;display:block;width:111px;margin-top:-106.30631%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style="">在这里插入图片描述选择Export camera parameters，并点击“OK”。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:495px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:51.31313%;height:0;"> 
    <img src="https://images2.imgbox.com/38/e3/ugcUxyDu_o.png" style="margin-left:;display:block;width:495px;margin-top:-51.31313%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">在这里插入图片描述</p> 
 <p style="">三、读取参数</p> 
 <p style="">标定结束后，会得到如下标定参数：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:562px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:80.60498%;height:0;"> 
    <img src="https://images2.imgbox.com/d1/eb/m8Ri4IGs_o.png" style="margin-left:;display:block;width:562px;margin-top:-80.60498%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">TranslationOfCamera2：相机2相对于相机1的偏移矩阵，可以直接使用。</p> 
 <p style="">RotationOfCamera2：相机2相对于相机1的旋转矩阵，需要转置之后才能使用。</p> 
 <p style="">CameraParameters1与CameraParameters2为左右摄像头的单独标定参数。CameraParameters1与CameraParameters2中包含如下文件：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:740px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:37.297295%;height:0;"> 
    <img src="https://images2.imgbox.com/ae/ce/K9oai6ss_o.png" style="margin-left:;display:block;width:740px;margin-top:-37.297295%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">IntrinsicMatrix存放的是摄像头的内参，只与摄像机的内部结构有关，需要先转置再使用。</p> 
 <p style="">RadialDistortion：径向畸变，摄像头由于光学透镜的特性使得成像存在着径向畸变，可由K1，K2，K3确定。</p> 
 <p style="">TangentialDistortion：切向畸变，由于装配方面的误差，传感器与光学镜头之间并非完全平行，因此成像存在切向畸变，可由两个参数P1，P2确定。</p> 
 <p style=""></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/97244e4e2501d5cf911a0c7e465b383d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数学建模拓展内容：卡方检验和Fisher精确性检验（附有SPSS使用步骤）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2548531048579abfbfe6db16540a3c51/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C#获取文件夹下的所有文件</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>