<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SkeyeVSS综合安防监控录像回放控制之自定义可拖动时间轴组件 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SkeyeVSS综合安防监控录像回放控制之自定义可拖动时间轴组件" />
<meta property="og:description" content="SkeyeVSS综合安防视频云服务通过接入SkeyeRMS录像服务器实现对系统里的摄像机等设备录像，通过自定义的时间轴组件对录像记录进行加载渲染,播放器回调时间与下面时间轴相互联动，集拖动、点击、缩放、无限加载等于一体的时间轴组件。
通过接口获取录像回放记录的列表，数据结构中包含每段录像的开始与结束时间，把每段记录绘制到时间轴上，左右拖动会自动触发日期的改变回调，再通过接口去获取对应日期的数据，方便我们整体查看，点击有录像的时间段区域或拖动指针（三角形）返回当前时间戳，再配合拉流进行播放，通过滚轮缩放最小精确到秒，最终效果如图所示：
时间轴组件基本功能 时间轴初始化代码及录像时间段的数据格式，如下： &lt;div class=&#34;timeline-group&#34; id=&#34;timeline&#34;&gt;&lt;/div&gt; let times = [ { begin: new Date(new Date(&#39;2022-04-14 11:30:00&#39;)).getTime(), end: new Date(new Date(&#39;2022-04-14 17:00:00&#39;)).getTime() }, { begin: new Date(new Date(&#39;2022-04-14 17:01:00&#39;)).getTime(), end: new Date(new Date(&#39;2022-04-14 19:00:00&#39;)).getTime() } ] let TimeAxis = new TimeLine({ dom: document.getElementById(&#39;timeline&#39;), bg: &#39;#000&#39;, date: new Date(new Date(&#39;2022-04-14&#39;).toLocaleDateString()).getTime(), cellStyle: { background: &#39;rgba(24,208,217,0.5)&#39; }, timecell: [...times], callback: (data) =&gt; { // {mode: 触发方式 timestamp: 时间戳 valid: 是否有效} console.log(data) this.$emit(&#39;changeTime&#39;, data) } }) 1、时间轴组件是使用canvas技术绘制，组件的宽高是自动根据外层div的宽高来自适应，通过设置外层div的宽高来控制即可。 创建canvas注册事件初始化边框渲染时间轴初始化刻度线渲染播放指针有效时间区域填充时间段 this." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a234644246901fb259e3aa3ada596ff0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-30T10:05:02+08:00" />
<meta property="article:modified_time" content="2022-04-30T10:05:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SkeyeVSS综合安防监控录像回放控制之自定义可拖动时间轴组件</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>SkeyeVSS综合安防视频云服务通过接入SkeyeRMS录像服务器实现对系统里的摄像机等设备录像，通过自定义的时间轴组件对录像记录进行加载渲染,播放器回调时间与下面时间轴相互联动，集拖动、点击、缩放、无限加载等于一体的时间轴组件。</p> 
<p>通过接口获取录像回放记录的列表，数据结构中包含每段录像的开始与结束时间，把每段记录绘制到时间轴上，左右拖动会自动触发日期的改变回调，再通过接口去获取对应日期的数据，方便我们整体查看，点击有录像的时间段区域或拖动指针（三角形）返回当前时间戳，再配合拉流进行播放，通过滚轮缩放最小精确到秒，最终效果如图所示：</p> 
<p><img src="https://images2.imgbox.com/af/88/NstC5VK4_o.gif" alt="在这里插入图片描述"></p> 
<h5><a id="__8"></a>时间轴组件基本功能 时间轴初始化代码及录像时间段的数据格式，如下：</h5> 
<pre><code>&lt;div class="timeline-group" id="timeline"&gt;&lt;/div&gt;

let times = [
  {
    begin: new Date(new Date('2022-04-14 11:30:00')).getTime(),
    end: new Date(new Date('2022-04-14 17:00:00')).getTime()
  },
  {
    begin: new Date(new Date('2022-04-14 17:01:00')).getTime(),
    end: new Date(new Date('2022-04-14 19:00:00')).getTime()
  }
]

let TimeAxis = new TimeLine({
  dom: document.getElementById('timeline'),
  bg: '#000',
  date: new Date(new Date('2022-04-14').toLocaleDateString()).getTime(),
  cellStyle: {
    background: 'rgba(24,208,217,0.5)'
  },
  timecell: [...times],
  callback: (data) =&gt; {
    // {mode: 触发方式 timestamp: 时间戳 valid: 是否有效}
    console.log(data)
    this.$emit('changeTime', data)
  }
})
</code></pre> 
<h6><a id="1canvasdivdiv_38"></a>1、时间轴组件是使用canvas技术绘制，组件的宽高是自动根据外层div的宽高来自适应，通过设置外层div的宽高来控制即可。</h6> 
<ul><li>创建canvas</li><li>注册事件</li><li>初始化边框</li><li>渲染时间轴</li><li>初始化刻度线</li><li>渲染播放指针</li><li>有效时间区域填充时间段</li></ul> 
<h2><a id="_49"></a></h2> 
<pre><code>this.canvas.addEventListener('contextmenu', (e) =&gt; {
    e.preventDefault();
});
this.canvas.addEventListener('mousemove', this.canvasMousemoveFunc.bind(this));
  // 滚轮事件
this.canvas.addEventListener('mousewheel', this.mousewheelFunc.bind(this));
this.canvas.addEventListener('mousedown', this.mousedownFunc.bind(this));
this.canvas.addEventListener('mouseup', this.mouseupFunc.bind(this));
this.canvas.addEventListener('mouseout', this.mouseoutFunc.bind(this));

this.canvas.addEventListener('click', this.clickFunc.bind(this));
</code></pre> 
<p><img src="https://images2.imgbox.com/50/fa/LY31EWMx_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="2___stylestylestylestylecellStylecellStyle_68"></a>2、设置时间段默认填充色, 背景填充色, 时间段还可设置不同的填充色，来区分不同的时间段,在数据结构中添加 style字段参数即可，如果在数据结构中添加了style字段，则优先使用style，没有style参数时再使用cellStyle参数，如果cellStyle参数不存在，则使用内置的默认填充色，如下图：</h6> 
<pre><code>let times = [
  {
    begin: new Date(new Date('2022-04-14 11:30:00')).getTime(),
    end: new Date(new Date('2022-04-14 17:00:00')).getTime(),
	style: {
    	background: 'rgba(172,17,189,0.5)'
	}
  }
]	


cellStyle: {
  background: 'rgba(24,208,217,0.5)'
},
bg: '#000',
</code></pre> 
<p><img src="https://images2.imgbox.com/93/eb/8Pk5wxKt_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="3__90"></a>3、左右拖动，拖动时间轴时组件会自动监听日期的变化，实现无限加载每天的录像回放记录，将记录的时间段渲染到时间轴上，滚轮缩放 ，通过绑定滚轮事件来控制时间轴的放大与缩小,</h6> 
<p><img src="https://images2.imgbox.com/cc/db/KWIsp04H_o.gif" alt="在这里插入图片描述"></p> 
<pre><code>this.canvas.addEventListener('mousewheel', this.mousewheelFunc.bind(this));

mousewheelFunc(event) {
    if (event &amp;&amp; event.preventDefault) {
      event.preventDefault()
    } else {
      window.event.returnValue = false;
      return false;
    }
    let e = window.event || event;
    let delta = Math.max(-1, Math.min(1, (e.wheelDelta || -e.detail)));
    let posX = this.getCursorPositionX(e);
    let middle_time = this.date + posX * (this.zoomHours * 3600 * 1000) / (this.canvasWidth); //ms 记住当前中间的时间
    if (delta &lt; 0) {
      this.zoomHours = this.zoomHours - delta;
      if (this.zoomHours &gt;= 24) {
        this.zoomHours = 24;//放大最大24小时
      }
    } else if (delta &gt; 0) {// 放大
      this.zoomHours = this.zoomHours - delta;
      if (this.zoomHours &lt;= 1) {
        this.zoomHours = 1;//缩小最小1小时
      }
    }
    this.clearCanvas();
    this.date = middle_time - posX * (this.zoomHours * 3600 * 1000) / (this.canvasWidth);
    this.initCanvasCtx()
}
</code></pre> 
<h6><a id="4SkeyeWebPlayercallbackFuncTimeAxisupdateTime_123"></a>4、配合SkeyeWebPlayer网页播放器，实现回放，在播放器callbackFunc回调中获取到当前播放的时间，通过TimeAxis.updateTime(时间戳)方法更新时间轴上面的播放指针位置，达到联动效果。</h6> 
<h6><a id="5____callbackmodevalid__125"></a>5、时间轴上单击右键 和 拖动指针结束后都会返回当前位置 获取当前点击位置 计算出时间戳，通过callback返回，拿到时间可生成播放地址或拉取播放信息，传到播放器中播放，在返回的参数中已经判断好当前时间是否为有效时间。mode判断是点击或拖动，valid判断时间是否在有效区域 如图：</h6> 
<p><img src="https://images2.imgbox.com/83/ed/GIWaadNC_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_129"></a>获取更多信息</h3> 
<p>邮件：<a href="mailto:support@openskeye.cn" rel="nofollow">support@openskeye.cn</a></p> 
<p>QQ交流群：102644504</p> 
<p><strong>SkeyeVSS</strong><a href="http://www.openskeye.cn/web/product/vss?id=c24a0a06-6d38-45a5-8623-a1fa3f406ab1" rel="nofollow">综合安防互联网无插件播放解决方案</a></p> 
<p><strong>SkeyeARS</strong><a href="http://www.openskeye.cn/web/product/ars?id=0df9217e-da11-4fdf-a83c-3afcc16ca01b" rel="nofollow">全景AR增强监视系统解决方案</a></p> 
<p><strong>SkeyeIVMS</strong><a href="http://www.openskeye.cn/web/product/ivms?id=8c2d5507-08f1-48a8-a91b-1c15f6e7cc15" rel="nofollow">集群式视频云管控平台解决方案</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5a1de01a5218187b3b5e666791e26835/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MCAN论文进阶——MoVie: Revisting Modulated Convolutions for Visual Counting and Beyond 论文笔记</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4020cd3999e895f5a32ff7140e1d8a31/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python ddddocr实现验证码签到、登录、点击、按顺序点击，通过验证码识别</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>