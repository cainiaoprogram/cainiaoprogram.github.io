<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ubuntu系统安装完显卡驱动出现黑屏和登录死循环的解决方法（新增惠普暗夜精灵7-3070显卡解决方法） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ubuntu系统安装完显卡驱动出现黑屏和登录死循环的解决方法（新增惠普暗夜精灵7-3070显卡解决方法）" />
<meta property="og:description" content="ubuntu系统三种安装显卡驱动的方式 1. 第一种下载驱动程序安装 下载链接NVIDIA 驱动程序下载
说明:根据自己电脑显卡的型号，下载相匹配的显卡驱动
2. 通过软件和更新界面安装 系统设置-&gt;软件更新-&gt;附加驱动-&gt;选择nvidia最新驱动-&gt;应用更改。在“软件和更新”界面选择对应的驱动程序，进行安装。如下图所示：
3. 通过安装cuda进行安装 通过.run的方式进行安装 以3060显卡举例，目前比较新的3060显卡只支持cuda11（cuda_11.4.0_470.42.01_linux.run） 以上的版本。
.run格式的cuda安装过程会提示是否安装nvida显卡驱动。如果已经安装了显卡驱动，这里输入n。如下图：
如果没有安装显卡驱动。上图输入y
通过.deb的方式安装 cuda-repo-ubuntu1804-11-4-local_11.4.0-470.42.01-1_amd64.deb，通过.deb的方式安装cuda，安装过程中会自动匹配与机器显卡相对应的显卡驱动，自动进行安装。
安装前的准备工作 CUDA Toolkit | NVIDIA Developer下载所需要的cuda版本 卸载所有默认安装的显卡驱动，卸载所有默认安装的显卡驱动，使用命令： sudo apt-get remove --purge nvidia*
禁用自动的nouveau nvidia驱动 编辑文件blacklist.conf，所在目录/etc/modprobe.d/blacklist.conf在blacklist.conf中最后一行添加： blacklist nouveau
blacklist vga16fb
blacklist nouveau
blacklist rivafb
blacklist rivatv
blacklist nvidiafb
options nouveau modeset=0
保存后关闭文件，并执行以下命令更新系统，使禁用 nouveau 真正生效 sudo update-initramfs -u
lsmod | grep nouveau。重启电脑，无任何输出的话说明屏成功了。
安装 .run格式安装，以cuda_11.4.0_470.42.01_linux.run为例。命令如下： ctrl&#43;alt&#43;F1 #进入命令行界面#
sudo service lightdm stop #关闭图形界面#
sudo ./ cuda_11." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ce164dff8586f4b5bd80b58ea69c598b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-04T14:50:18+08:00" />
<meta property="article:modified_time" content="2021-08-04T14:50:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ubuntu系统安装完显卡驱动出现黑屏和登录死循环的解决方法（新增惠普暗夜精灵7-3070显卡解决方法）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 style="text-align:justify;"><span style="color:#0d0016;"><strong>ubuntu系统三种安装显卡驱动的方式</strong></span></h2> 
<h3 style="text-align:justify;"><strong><span style="color:#0d0016;">1. 第一种下载驱动程序安装</span></strong></h3> 
<p style="margin-left:0;text-align:justify;"><span style="color:#0d0016;">下载链接</span><a href="https://www.nvidia.cn/Download/index.aspx?lang=cn" rel="nofollow" title="NVIDIA 驱动程序下载">NVIDIA 驱动程序下载</a></p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#0d0016;"><strong>说明:根据自己电脑显卡的型号，下载相匹配的显卡驱动</strong></span></p> 
<h3><span style="color:#0d0016;"><strong>2. 通过软件和更新界面安装</strong></span></h3> 
<p style="margin-left:0;text-align:justify;"><span style="color:#0d0016;"><span style="background-color:#ffffff;">系统设置-&gt;软件更新-&gt;附加驱动-&gt;选择nvidia最新驱动-&gt;应用更改。</span>在“软件和更新”界面选择对应的驱动程序，进行安装。如下图所示：</span></p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="465" src="https://images2.imgbox.com/42/5c/BCWgKPED_o.png" width="581"></p> 
<h3><strong>3. 通过安装cuda进行安装</strong></h3> 
<ul><li>通过.run的方式进行安装</li></ul> 
<p style="margin-left:0;text-align:justify;">以3060显卡举例，目前比较新的3060显卡只支持cuda11（cuda_11.4.0_470.42.01_linux.run）  以上的版本。</p> 
<p style="margin-left:0;text-align:justify;">.run格式的cuda安装过程会提示是否安装nvida显卡驱动。如果已经安装了显卡驱动，这里<strong>输入n</strong>。如下图：</p> 
<p><img alt="" height="102" src="https://images2.imgbox.com/94/2c/KbJj3CWA_o.png" width="570"></p> 
<p> 如果没有安装显卡驱动。上图<strong>输入y</strong></p> 
<ul><li>通过.deb的方式安装</li></ul> 
<p>cuda-repo-ubuntu1804-11-4-local_11.4.0-470.42.01-1_amd64.deb，通过.deb的方式安装cuda，安装过程中会自动匹配与机器显卡相对应的显卡驱动，自动进行安装。</p> 
<h2>安装前的准备工作</h2> 
<ul><li style="text-align:justify;"><a href="https://developer.nvidia.com/cuda-toolkit" rel="nofollow" title="CUDA Toolkit | NVIDIA Developer">CUDA Toolkit | NVIDIA Developer</a>下载所需要的cuda版本</li></ul> 
<ul><li style="text-align:justify;"><strong>卸载所有默认安装的显卡驱动，卸载所有默认安装的显卡驱动，使用命令：</strong></li></ul> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#fafafc;"><span style="color:#000000;">sudo apt-get remove --purge nvidia*</span></span></p> 
<ul><li style="text-align:justify;"><strong>禁用自动的nouveau nvidia驱动</strong></li></ul> 
<ol><li style="text-align:justify;">编辑文件blacklist.conf，所在目录/etc/modprobe.d/blacklist.conf</li><li style="text-align:justify;">在blacklist.conf中最后一行添加：</li></ol> 
<p style="margin-left:0;text-align:justify;">        <span style="background-color:#ffffff;"><span style="color:#000000;">blacklist nouveau</span></span></p> 
<p style="margin-left:0;text-align:justify;">        blacklist vga16fb</p> 
<p style="margin-left:0;text-align:justify;">        blacklist nouveau</p> 
<p style="margin-left:0;text-align:justify;">        blacklist rivafb</p> 
<p style="margin-left:0;text-align:justify;">        blacklist rivatv</p> 
<p style="margin-left:0;text-align:justify;">        blacklist nvidiafb</p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#000000;">        options nouveau modeset=0</span></span></p> 
<p style="margin-left:0;text-align:justify;">       保存后关闭文件，并执行以下命令更新系统，使禁用 nouveau 真正生效    </p> 
<p style="margin-left:0;text-align:justify;"><code><span style="background-color:#ffffff;"><span style="color:#000000;">  sudo update</span></span></code><span style="background-color:#ffffff;"><span style="color:#000000;">-initramfs</span></span><code> </code><span style="background-color:#ffffff;"><span style="color:#000000;">-u</span></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#000000;">       lsmod | grep nouveau</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">。重启电脑，无任何输出的话说明屏成功了。</span></span></p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="67" src="https://images2.imgbox.com/8b/a6/ktVInUGz_o.png" width="640"></p> 
<h2> 安装</h2> 
<ul><li style="text-align:left;">.run格式安装，以cuda_11.4.0_470.42.01_linux.run为例。命令如下：</li></ul> 
<p style="margin-left:21pt;"><span style="background-color:#ffffff;"><span style="color:#000000;">   ctrl+alt+F1        #</span><span style="color:#000000;">进入命令行界面#</span></span></p> 
<p style="margin-left:21pt;"><span style="background-color:#ffffff;"><span style="color:#000000;">   sudo service lightdm stop      #</span><span style="color:#000000;">关闭图形界面#</span></span></p> 
<p style="margin-left:0;"><span style="background-color:#ffffff;"><span style="color:#000000;">         sudo ./</span></span> cuda_11.4.0_470.42.01_linux.run <span style="background-color:#ffffff;"><span style="color:#ff0000;">-no-x-check -no-nouveau-check -no-opengl-files</span></span></p> 
<p style="margin-left:0cm;"><span style="background-color:#ffffff;"><span style="color:#000000;">        只有禁用opengl这样安装才不会出现循环登陆的问题</span></span></p> 
<p><span style="background-color:#ffffff;"><span style="color:#000000;">          -no-x-check</span><span style="color:#000000;">：安装驱动时关闭X服务</span></span></p> 
<p><span style="background-color:#ffffff;"><span style="color:#000000;">          -no-nouveau-check</span><span style="color:#000000;">：安装驱动时禁用nouveau</span></span></p> 
<p><span style="background-color:#ffffff;"><span style="color:#000000;">          -no-opengl-files：只安装驱动文件，不安装OpenGL文件</span></span></p> 
<p style="margin-left:0;"><span style="background-color:#ffffff;"><span style="color:#000000;">  安装过程中的选项：（这是</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">copy</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">别人的，</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">.run</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">格式的，自己只安装过一次）</span></span></p> 
<p style="margin-left:0;"><img alt="" height="382" src="https://images2.imgbox.com/fd/27/RCAj73mq_o.png" width="736"></p> 
<p style="margin-left:0;"><span style="color:#511b78;"><strong><span style="background-color:#ffffff;">这些选项如果选择错误可能会导致安装失败，没关系，只要前面不出错，多尝试几次就好。</span></strong></span></p> 
<p style="margin-left:0cm;"><span style="background-color:#ffffff;"><span style="color:#000000;">（说明：ctrl+alt+F7        #退出命令行界面#）</span></span></p> 
<ul><li> .deb格式安装</li></ul> 
<p><span style="color:#0d0016;">      以下是官网提供的安装命令：（可以去官网自行查询安装命令）</span></p> 
<p><img alt="" height="259" src="https://images2.imgbox.com/8e/3b/WO2djBDG_o.png" width="731"></p> 
<h2>黑屏/无线循环登陆解决方法汇总</h2> 
<p> 查看显卡信息常用命令汇总：</p> 
<ul><li style="text-align:left;">查看显卡型号</li></ul> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#f6f8fa;"><span style="color:#000000;">lspci </span></span>| grep -i nvidia</p> 
<ul><li style="text-align:left;">查看驱动版本</li></ul> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#f6f8fa;"><span style="color:#000000;">sudo dpkg --list </span></span>| grep nvidia</p> 
<ul><li style="text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">显示所有GPU的当前信息状态</span></span></li></ul> 
<p><img alt="" height="324" src="https://images2.imgbox.com/ab/e8/Rx2dblW0_o.png" width="625"></p> 
<h3>1. 解决方法1</h3> 
<p style="margin-left:0;text-align:justify;"><span style="color:#0d0016;">显卡驱动安装成功后，为避免重启系统以后出现黑屏，循环登陆的问题，可以进行以下操作：</span></p> 
<ol><li style="text-align:justify;"><span style="color:#0d0016;">打开终端，输入以下命令行</span></li><li style="text-align:justify;"><span style="color:#0d0016;">cd /etc/default/</span></li><li style="text-align:justify;"><span style="color:#0d0016;">sudo gedit grub</span></li><li style="text-align:justify;"><span style="color:#0d0016;"><strong>修改内容如下图所示：</strong></span></li></ol> 
<p style="margin-left:0;text-align:justify;"><span style="color:#0d0016;">      把GRUB_CMDLINE_LINUX_DEFAULT="quiet splash"   </span></p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#0d0016;"><strong>      改为：</strong></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#0d0016;">    GRUB_CMDLINE_LINUX_DEFAULT="quiet splash acpi_osi=linux"</span></p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#0d0016;"><strong>    也有改成：</strong></span></p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#0d0016;">    GRUB_CMDLINE_LINUX_DEFAULT="quiet splash acpi_osi=linux nomodeset"</span></p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#0d0016;">以上两种修改方法，都可以试一下，自己使用的神舟笔记本是用的第一种方法</span>。</p> 
<p><img alt="" height="367" src="https://images2.imgbox.com/83/3e/uuqrqrpK_o.png" width="702"></p> 
<p style="text-align:justify;"><span style="color:#0d0016;">5. sudo update-grub</span></p> 
<p style="text-align:justify;"><span style="color:#0d0016;">6. 重启系统，按“e”进入指令编辑模式，修改成功后的显示如下图：（自己的神舟笔记本）</span></p> 
<p style="text-align:justify;"><img alt="" height="408" src="https://images2.imgbox.com/a4/de/1lcOZz9Q_o.png" width="809"></p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#0d0016;">不同品牌的笔记本操作上可能有所不同，应该修改的内容差不太多。如果过程中遇到文档中没有提到的问题。大家可以自行百度，多查找资料。</span></p> 
<p style="margin-left:0;text-align:justify;"><span style="color:#fe2c24;"><strong>最近新买的惠普暗夜精灵7（3070的显卡）发现改完上述配置以后，还得进行以下配置：</strong></span></p> 
<p style="margin-left:0;"><span style="color:#fe2c24;"><strong>1.安装lightdm，一定要换， 上面的参数设置好后，gdm3的启动还是有问题，一定要更换。</strong></span></p> 
<p style="margin-left:0;"><span style="color:#fe2c24;"><strong>2.sudo apt-get install lightdm</strong></span></p> 
<p style="margin-left:0;"><span style="color:#fe2c24;"><strong>3.把启动管理器切换为lightdm，安装时有提示，选择正常的结果后回车即可。</strong></span></p> 
<h3>2. 解决方法2</h3> 
<p style="margin-left:0;text-align:justify;"><span style="color:#0d0016;">     原因<span style="background-color:#ffffff;">Ubuntu内核bug导致gdm3和nvidia驱动冲突，使得gdm3无法正常启动图形界面，而gdm不 断尝试启动的后果就是屏幕的闪烁。</span></span></p> 
<p style="text-align:justify;"><span style="color:#0d0016;">解决方法：</span></p> 
<p style="text-align:justify;"><span style="color:#0d0016;">sudo apt-get remove --purge nvidia-*          # 卸载nvidia相关组</span></p> 
<p style="text-align:justify;"><span style="color:#0d0016;">sudo apt purge gdm gdm3                    # 卸载gdm和gdm3</span></p> 
<p style="text-align:justify;"><span style="color:#0d0016;">sudo apt install gdm3 ubuntu-desktop          # 重新安装gdm3</span></p> 
<p style="text-align:justify;"><span style="color:#0d0016;">systemctl restart gdm                        # 重新启动gdm3服务</span></p> 
<p style="margin-left:0;text-align:justify;"><strong>解决方法参考：</strong></p> 
<p style="text-align:justify;"><span style="color:#fe2c24;">1. </span><a href="https://bugs.launchpad.net/ubuntu/+source/gdm3/+bug/1779476" rel="nofollow" title="Bug #1779476 “Ubuntu 18.04: gdm3 does not switch to graphics aft...” : Bugs : gdm3 package : Ubuntu">Bug #1779476 “Ubuntu 18.04: gdm3 does not switch to graphics aft...” : Bugs : gdm3 package : Ubuntu</a></p> 
<p style="text-align:justify;"><span style="color:#fe2c24;">2.</span><a href="https://askubuntu.com/questions/1032639/ubuntu-18-04-stuck-in-boot-after-starting-gnome-display-manager-on-intel-graphic?newreg=dcc13fba301b4bb8a07e8a1d254a4aca" rel="nofollow" title="nvidia - Ubuntu 18.04 stuck in boot after starting Gnome Display Manager on Intel Graphics - Ask Ubuntu">nvidia - Ubuntu 18.04 stuck in boot after starting Gnome Display Manager on Intel Graphics - Ask Ubuntu</a></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b26e76e1ce4331fbb28afe6b7d0553c7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">服务器系统上1068错误,错误1068,详细教您启动网络服务错误1068怎么解决</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ef8aafacbb2fb27cbdb2d698be7b563e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">bluetooth 流程梳理-1</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>