<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Activiti7äº‹ä»¶ç›‘å¬ - èœé¸Ÿç¨‹åºå‘˜åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Activiti7äº‹ä»¶ç›‘å¬" />
<meta property="og:description" content="æœ¬æ–‡ä¸ªäººåšå®¢åœ°å€ï¼šActiviti7äº‹ä»¶ç›‘å¬ (leafage.top)
å¥½ä¹…æ²¡æœ‰è®°å½•ç¬”è®°äº†ï¼Œæœ€è¿‘åšäº†ä¸€äº›å…³äºå·¥ä½œæµçš„äº‹æƒ…ï¼Œè®°å½•ä¸€ä¸‹ä½¿ç”¨activiti 7çš„ä¸€äº›ç»éªŒã€‚
éœ€æ±‚ï¼š
åœ¨æµç¨‹å‘èµ·å’Œæµç¨‹æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œç»™ç›¸å…³äººå‘˜å‘é€æµç¨‹å®¡æ‰¹çš„é€šçŸ¥æé†’ï¼›ä¸è¦åœ¨é…ç½®æµç¨‹æ—¶æ‰‹åŠ¨æ·»åŠ ï¼Œä¸èƒ½ä¾µå…¥åˆ°æµç¨‹æ“ä½œçš„è¿‡ç¨‹ï¼Œå½±å“æµç¨‹æ‰§è¡Œï¼› è¿™ä¸ªæ€ä¹ˆå…¥æ‰‹å‘¢ï¼Ÿæ²¡æè¿‡activitiï¼Œactiviti7 çš„å®˜æ–¹æ–‡æ¡£å†™çš„è·Ÿå±ä¸€æ ·çƒ‚ï¼Œæ„Ÿè§‰å¥½éš¾å‘€ğŸ˜”â€¦
æ–‡æ¡£å‚è€ƒæ€§ä¸é«˜ï¼Œé‚£å°±è¯•è¯•çœ‹å®˜æ–¹çš„ç¤ºä¾‹ï¼Œæ‰¾åˆ° activiti çš„ repository ï¼Œæœ‰ä¸€ä¸ªç¤ºä¾‹ module å« activiti-examplesï¼Œè¿™é‡Œçš„ç¤ºä¾‹ä¸èƒ½ç›´æ¥è·‘ï¼Œåªèƒ½çœ‹ï¼Œè¦æƒ³è·‘èµ·æ¥ï¼Œå°±å¤åˆ¶ï¼Œç²˜è´´ï¼Œæ”¾åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­ã€‚è·‘é¢˜äº†ï¼Œè¯´ä¼šä¸»é¢˜ã€‚ã€‚ã€‚
activitiä¸­çš„å‡ ä¸ªå…³è”çš„é‡è¦çš„ç±»æˆ–æ¥å£ï¼š
activiti ä¸­æ¯ä¸ªæµç¨‹ä¿¡æ¯æ˜¯é€šè¿‡ ProcessInstance æè¿°ï¼Œå®ƒæœ‰è¿™ä¹ˆå‡ ä¸ªçŠ¶æ€ï¼šcreatedã€startedã€completedã€cancelledã€resumedã€updatedã€suspendedï¼Œä¸ä¹‹å¯¹åº”çš„ç›¸å…³äº‹ä»¶æè¿°ç±»æ˜¯ï¼šProcessCreatedEventã€ProcessStartedEventã€ProcessCompletedEventã€ProcessCancelledEventã€ProcessResumedEventã€ProcessUpdatedEventã€ProcessSuspendedEventç­‰ã€‚
æ¯ä¸ªæµç¨‹èŠ‚ç‚¹åœ¨ activiti ä¸­ é€šè¿‡ Task æ¥æè¿°ï¼Œå®ƒæœ‰è¿™ä¹ˆå‡ ä¸ªä¸ªçŠ¶æ€ï¼šcreatedã€assignedã€completedã€updatedã€cancelledã€suspendedç­‰ï¼Œä¸ä¹‹å¯¹åº”çš„ç›¸å…³äº‹ä»¶æè¿°ç±»æ˜¯ï¼šTaskCreatedEventã€TaskAssignedEventã€TaskCompletedEventã€TaskUpdatedEventã€TaskCancelledEventã€TaskSuspendedEventç­‰ã€‚
å¦‚ä½•é…ç½®ç›‘å¬å™¨ï¼Ÿ 1. å…¨å±€äº‹ä»¶ç›‘å¬å™¨ï¼š æ¶‰åŠåˆ°ä¸¤ä¸ªç±»\æ¥å£ï¼Œå…¨å±€äº‹ä»¶ç›‘å¬å™¨ ActivitiEventListener å’Œ ProcessEngineConfigurationConfigurerï¼ˆæœ‰ä¸€ä¸ªé»˜è®¤çš„å®ç°ç±»ï¼šDefaultActivityBehaviorFactoryMappingConfigurerï¼‰
ActitiviEventListener æ¥å£æœ‰ä¸€ä¸ª void onEvent(ActivitiEvent activitiEvent) æ–¹æ³•ï¼Œå³åœ¨äº‹ä»¶çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¯ä»¥å‘ç”Ÿçš„åŠ¨ä½œéƒ½ä¼šåœ¨è¿™ä¸ªæ–¹æ³•ä¸­è¿›è¡Œã€‚å…¶æºç å¦‚ä¸‹ï¼š
/** * Describes a class that listens for {@link ActivitiEvent}s dispatched by the engine. * */ public interface ActivitiEventListener { void onEvent(ActivitiEvent event); boolean isFailOnException(); } ActivitiEvent åŒ…å«äº†æµç¨‹çš„å®šä¹‰IDï¼Œç¤ºä¾‹IDï¼Œæ‰§è¡ŒIDï¼Œå’Œäº‹ä»¶ç±»å‹ä¿¡æ¯ï¼Œæºç å¦‚ä¸‹ï¼š
public interface ActivitiEvent { ActivitiEventType getType(); String getExecutionId(); String getProcessInstanceId(); String getProcessDefinitionId(); } å…¶äº‹ä»¶ç±»å‹åŒ…æ‹¬å¾ˆå¤šï¼Œæºç å¦‚ä¸‹ï¼š" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b36b262270bb897d891c9073757e6210/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-13T10:03:32+08:00" />
<meta property="article:modified_time" content="2021-08-13T10:03:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="èœé¸Ÿç¨‹åºå‘˜åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">èœé¸Ÿç¨‹åºå‘˜åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Activiti7äº‹ä»¶ç›‘å¬</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>æœ¬æ–‡ä¸ªäººåšå®¢åœ°å€ï¼š<a href="https://www.leafage.top/posts/detail/21811W1F6" rel="nofollow">Activiti7äº‹ä»¶ç›‘å¬ (leafage.top)</a></p> 
<blockquote> 
 <p>å¥½ä¹…æ²¡æœ‰è®°å½•ç¬”è®°äº†ï¼Œæœ€è¿‘åšäº†ä¸€äº›å…³äºå·¥ä½œæµçš„äº‹æƒ…ï¼Œè®°å½•ä¸€ä¸‹ä½¿ç”¨activiti 7çš„ä¸€äº›ç»éªŒã€‚</p> 
</blockquote> 
<p><strong>éœ€æ±‚ï¼š</strong></p> 
<ol><li>åœ¨æµç¨‹å‘èµ·å’Œæµç¨‹æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œç»™ç›¸å…³äººå‘˜å‘é€æµç¨‹å®¡æ‰¹çš„é€šçŸ¥æé†’ï¼›</li><li>ä¸è¦åœ¨é…ç½®æµç¨‹æ—¶æ‰‹åŠ¨æ·»åŠ ï¼Œä¸èƒ½ä¾µå…¥åˆ°æµç¨‹æ“ä½œçš„è¿‡ç¨‹ï¼Œå½±å“æµç¨‹æ‰§è¡Œï¼›</li></ol> 
<p><mark><em>è¿™ä¸ªæ€ä¹ˆå…¥æ‰‹å‘¢ï¼Ÿæ²¡æè¿‡activitiï¼Œactiviti7 çš„å®˜æ–¹æ–‡æ¡£å†™çš„è·Ÿå±ä¸€æ ·çƒ‚ï¼Œæ„Ÿè§‰å¥½éš¾å‘€</em></mark>ğŸ˜”â€¦</p> 
<p>æ–‡æ¡£å‚è€ƒæ€§ä¸é«˜ï¼Œé‚£å°±è¯•è¯•çœ‹å®˜æ–¹çš„ç¤ºä¾‹ï¼Œæ‰¾åˆ° activiti çš„ repository ï¼Œæœ‰ä¸€ä¸ªç¤ºä¾‹ module å« activiti-examplesï¼Œ<mark>è¿™é‡Œçš„ç¤ºä¾‹ä¸èƒ½ç›´æ¥è·‘ï¼Œåªèƒ½çœ‹</mark>ï¼Œè¦æƒ³è·‘èµ·æ¥ï¼Œå°±å¤åˆ¶ï¼Œç²˜è´´ï¼Œæ”¾åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­ã€‚<s>è·‘é¢˜äº†ï¼Œè¯´ä¼šä¸»é¢˜ã€‚ã€‚ã€‚</s></p> 
<p><strong>activitiä¸­çš„å‡ ä¸ªå…³è”çš„é‡è¦çš„ç±»æˆ–æ¥å£ï¼š</strong></p> 
<ol><li> <p>activiti ä¸­æ¯ä¸ªæµç¨‹ä¿¡æ¯æ˜¯é€šè¿‡ ProcessInstance æè¿°ï¼Œå®ƒæœ‰è¿™ä¹ˆå‡ ä¸ªçŠ¶æ€ï¼šcreatedã€startedã€completedã€cancelledã€resumedã€updatedã€suspendedï¼Œä¸ä¹‹å¯¹åº”çš„ç›¸å…³äº‹ä»¶æè¿°ç±»æ˜¯ï¼šProcessCreatedEventã€ProcessStartedEventã€ProcessCompletedEventã€ProcessCancelledEventã€ProcessResumedEventã€ProcessUpdatedEventã€ProcessSuspendedEventç­‰ã€‚</p> <p><img src="https://images2.imgbox.com/29/93/n1Xj0YGX_o.png" alt="image.png"></p> </li><li> <p>æ¯ä¸ªæµç¨‹èŠ‚ç‚¹åœ¨ activiti ä¸­ é€šè¿‡ Task æ¥æè¿°ï¼Œå®ƒæœ‰è¿™ä¹ˆå‡ ä¸ªä¸ªçŠ¶æ€ï¼šcreatedã€assignedã€completedã€updatedã€cancelledã€suspendedç­‰ï¼Œä¸ä¹‹å¯¹åº”çš„ç›¸å…³äº‹ä»¶æè¿°ç±»æ˜¯ï¼šTaskCreatedEventã€TaskAssignedEventã€TaskCompletedEventã€TaskUpdatedEventã€TaskCancelledEventã€TaskSuspendedEventç­‰ã€‚</p> <p><img src="https://images2.imgbox.com/18/2d/YH5ZwuZZ_o.png" alt="image.png"></p> </li></ol> 
<h4><a id="_22"></a>å¦‚ä½•é…ç½®ç›‘å¬å™¨ï¼Ÿ</h4> 
<h5><a id="1__23"></a>1. å…¨å±€äº‹ä»¶ç›‘å¬å™¨ï¼š</h5> 
<p>æ¶‰åŠåˆ°ä¸¤ä¸ªç±»\æ¥å£ï¼Œå…¨å±€äº‹ä»¶ç›‘å¬å™¨ ActivitiEventListener å’Œ ProcessEngineConfigurationConfigurerï¼ˆæœ‰ä¸€ä¸ªé»˜è®¤çš„å®ç°ç±»ï¼šDefaultActivityBehaviorFactoryMappingConfigurerï¼‰</p> 
<p><img src="https://images2.imgbox.com/a4/44/4GvLAkJW_o.png" alt="image.png"></p> 
<p>ActitiviEventListener æ¥å£æœ‰ä¸€ä¸ª void onEvent(ActivitiEvent activitiEvent) æ–¹æ³•ï¼Œå³åœ¨äº‹ä»¶çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå¯ä»¥å‘ç”Ÿçš„åŠ¨ä½œéƒ½ä¼šåœ¨è¿™ä¸ªæ–¹æ³•ä¸­è¿›è¡Œã€‚å…¶æºç å¦‚ä¸‹ï¼š</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * Describes a class that listens for {@link ActivitiEvent}s dispatched by the engine.
 * 

 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ActivitiEventListener</span> <span class="token punctuation">{<!-- --></span>

  <span class="token keyword">void</span> <span class="token function">onEvent</span><span class="token punctuation">(</span><span class="token class-name">ActivitiEvent</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">boolean</span> <span class="token function">isFailOnException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>ActivitiEvent åŒ…å«äº†æµç¨‹çš„å®šä¹‰IDï¼Œç¤ºä¾‹IDï¼Œæ‰§è¡ŒIDï¼Œå’Œäº‹ä»¶ç±»å‹ä¿¡æ¯ï¼Œæºç å¦‚ä¸‹ï¼š</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ActivitiEvent</span> <span class="token punctuation">{<!-- --></span>

  <span class="token class-name">ActivitiEventType</span> <span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">String</span> <span class="token function">getExecutionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">String</span> <span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token class-name">String</span> <span class="token function">getProcessDefinitionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>å…¶äº‹ä»¶ç±»å‹åŒ…æ‹¬å¾ˆå¤šï¼Œæºç å¦‚ä¸‹ï¼š</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">ActivitiEventType</span> <span class="token punctuation">{<!-- --></span>

  <span class="token comment">// ENTITY ï¼šæµç¨‹å®ä¾‹ï¼Œå‘èµ·æµç¨‹æ—¶ï¼Œä»æµç¨‹æ¨¡æ¿ä¸­åˆ›å»ºå®ä¾‹</span>
  ENTITY_CREATED<span class="token punctuation">,</span>  <span class="token comment">// åˆ›å»º</span>

  ENTITY_INITIALIZED<span class="token punctuation">,</span>  <span class="token comment">// åˆå§‹åŒ–å®Œæˆï¼ˆå¦‚æœè¿™ä¸ªå®ä½“çš„åˆ›å»ºä¼šåŒ…å«å­å®ä½“çš„åˆ›å»ºï¼Œè¿™ä¸ªäº‹ä»¶ä¼šåœ¨å­å®ä½“éƒ½åˆ›å»º/åˆå§‹åŒ–å®Œæˆåè¢«è§¦å‘ï¼Œè¿™æ˜¯ä¸ENTITY_CREATEDçš„åŒºåˆ«ï¼‰</span>

  ENTITY_UPDATED<span class="token punctuation">,</span>  <span class="token comment">// æ›´æ–°</span>

  ENTITY_DELETED<span class="token punctuation">,</span>  <span class="token comment">// åˆ é™¤</span>

  ENTITY_SUSPENDED<span class="token punctuation">,</span>  <span class="token comment">// æš‚åœï¼ˆä¼šè¢«ProcessDefinitions, ProcessInstances å’Œ TasksæŠ›å‡ºï¼‰</span>

  ENTITY_ACTIVATED<span class="token punctuation">,</span>  <span class="token comment">// æ¿€æ´»ï¼ˆä¼šè¢«ProcessDefinitions, ProcessInstances å’Œ TasksæŠ›å‡ºï¼‰</span>

  <span class="token comment">// å®šæ—¶å™¨</span>
  TIMER_SCHEDULED<span class="token punctuation">,</span>  <span class="token comment">// åˆ›å»º</span>

  TIMER_FIRED<span class="token punctuation">,</span>  <span class="token comment">// è§¦å‘</span>

  <span class="token comment">// ä½œä¸š</span>
  JOB_CANCELED<span class="token punctuation">,</span>  <span class="token comment">// å–æ¶ˆ</span>

  JOB_EXECUTION_SUCCESS<span class="token punctuation">,</span>  <span class="token comment">// æ‰§è¡ŒæˆåŠŸ</span>

  JOB_EXECUTION_FAILURE<span class="token punctuation">,</span>  <span class="token comment">// æ‰§è¡Œå¤±è´¥</span>

  JOB_RETRIES_DECREMENTED<span class="token punctuation">,</span>  <span class="token comment">// é‡è¯•å‡å°‘ï¼ˆå› ä¸ºä½œä¸šæ‰§è¡Œå¤±è´¥ï¼Œå¯¼è‡´é‡è¯•æ¬¡æ•°å‡å°‘ï¼‰</span>

  CUSTOM<span class="token punctuation">,</span>  <span class="token comment">// è‡ªå®šä¹‰</span>
  
  <span class="token comment">// å¼•æ“</span>
  ENGINE_CREATED<span class="token punctuation">,</span>  <span class="token comment">// åˆ›å»º</span>

  ENGINE_CLOSED<span class="token punctuation">,</span>  <span class="token comment">// å…³é—­</span>

  <span class="token comment">// æµç¨‹èŠ‚ç‚¹</span>
  ACTIVITY_STARTED<span class="token punctuation">,</span>  <span class="token comment">// å¼€å§‹</span>

  ACTIVITY_COMPLETED<span class="token punctuation">,</span>  <span class="token comment">// å®Œæˆ</span>

  ACTIVITY_CANCELLED<span class="token punctuation">,</span>  <span class="token comment">// å–æ¶ˆ</span>

  ACTIVITY_SIGNALED<span class="token punctuation">,</span>  <span class="token comment">// æ”¶åˆ°äº†ä¸€ä¸ªä¿¡å·</span>

  ACTIVITY_COMPENSATE<span class="token punctuation">,</span>  <span class="token comment">// å°†è¦è¢«è¡¥å¿</span>
  
  ACTIVITY_MESSAGE_SENT<span class="token punctuation">,</span>  <span class="token comment">// æ¶ˆæ¯å‘é€</span>
 
  ACTIVITY_MESSAGE_WAITING<span class="token punctuation">,</span>  <span class="token comment">// æ¶ˆæ¯ç­‰å¾…</span>

  ACTIVITY_MESSAGE_RECEIVED<span class="token punctuation">,</span>  <span class="token comment">// æ¶ˆæ¯æ¥æ”¶</span>

  ACTIVITY_ERROR_RECEIVED<span class="token punctuation">,</span>  <span class="token comment">// æ¥æ”¶å¤±è´¥</span>
  
  <span class="token comment">// æµç¨‹å†å²</span>
  HISTORIC_ACTIVITY_INSTANCE_CREATED<span class="token punctuation">,</span>  <span class="token comment">// åˆ›å»º</span>
  
  HISTORIC_ACTIVITY_INSTANCE_ENDED<span class="token punctuation">,</span>  <span class="token comment">// ç»“æŸ</span>

  <span class="token comment">// é˜Ÿåˆ—æµç¨‹</span>
  SEQUENCEFLOW_TAKEN<span class="token punctuation">,</span>  <span class="token comment">// å·²é‡‡å–</span>

  UNCAUGHT_BPMN_ERROR<span class="token punctuation">,</span>  <span class="token comment">// æœªè·å–åˆ°bpmn å¼‚å¸¸</span>

  <span class="token comment">// å˜é‡</span>
  VARIABLE_CREATED<span class="token punctuation">,</span>  <span class="token comment">// åˆ›å»º</span>

  VARIABLE_UPDATED<span class="token punctuation">,</span>  <span class="token comment">// æ›´æ–°</span>

  VARIABLE_DELETED<span class="token punctuation">,</span>  <span class="token comment">// åˆ é™¤</span>

  <span class="token comment">// ä»»åŠ¡</span>
  TASK_CREATED<span class="token punctuation">,</span>  <span class="token comment">// åˆ›å»ºï¼ˆå®ƒä½äºENTITY_CREATEäº‹ä»¶ä¹‹åã€‚å½“ä»»åŠ¡æ˜¯ç”±æµç¨‹åˆ›å»ºæ—¶ï¼Œè¿™ä¸ªäº‹ä»¶ä¼šåœ¨TaskListeneræ‰§è¡Œä¹‹å‰è¢«æ‰§è¡Œï¼‰</span>

  TASK_ASSIGNED<span class="token punctuation">,</span>  <span class="token comment">// åˆ†é…</span>

  TASK_COMPLETED<span class="token punctuation">,</span>  <span class="token comment">// å®Œæˆï¼ˆå®ƒä¼šåœ¨ENTITY_DELETEäº‹ä»¶ä¹‹å‰è§¦å‘ã€‚å½“ä»»åŠ¡æ˜¯æµç¨‹ä¸€éƒ¨åˆ†æ—¶ï¼Œäº‹ä»¶ä¼šåœ¨æµç¨‹ç»§ç»­è¿è¡Œä¹‹å‰ï¼Œ   åç»­äº‹ä»¶å°†æ˜¯ACTIVITY_COMPLETEï¼Œå¯¹åº”ç€å®Œæˆä»»åŠ¡çš„èŠ‚ç‚¹ï¼‰</span>

  <span class="token comment">// è¿›ç¨‹</span>
  PROCESS_STARTED<span class="token punctuation">,</span>  <span class="token comment">// å¼€å§‹</span>

  PROCESS_COMPLETED<span class="token punctuation">,</span>  <span class="token comment">// å®Œæˆï¼ˆåœ¨æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„ACTIVITY_COMPLETEDäº‹ä»¶ä¹‹åè§¦å‘ã€‚ å½“æµç¨‹åˆ°è¾¾çš„çŠ¶æ€ï¼Œæ²¡æœ‰ä»»ä½•åç»­è¿çº¿æ—¶ï¼Œ æµç¨‹å°±ä¼šç»“æŸã€‚ï¼‰</span>
 
  PROCESS_COMPLETED_WITH_ERROR_END_EVENT<span class="token punctuation">,</span>  <span class="token comment">// å¼‚å¸¸ç»“æŸ</span>

  PROCESS_CANCELLED<span class="token punctuation">,</span>  <span class="token comment">// å–æ¶ˆ</span>

  HISTORIC_PROCESS_INSTANCE_CREATED<span class="token punctuation">,</span>  <span class="token comment">// æµç¨‹å®ä¾‹åˆ›å»º</span>

  HISTORIC_PROCESS_INSTANCE_ENDED<span class="token punctuation">,</span>  <span class="token comment">// æµç¨‹å®ä¾‹åˆ›å»º</span>

  <span class="token comment">// æˆå‘˜</span>
  MEMBERSHIP_CREATED<span class="token punctuation">,</span>  <span class="token comment">// ç”¨æˆ·è¢«æ·»åŠ åˆ°ä¸€ä¸ªç»„é‡Œ</span>

  MEMBERSHIP_DELETED<span class="token punctuation">,</span>  <span class="token comment">// ç”¨æˆ·è¢«ä»ä¸€ä¸ªç»„ä¸­åˆ é™¤</span>

  MEMBERSHIPS_DELETED<span class="token punctuation">;</span>  <span class="token comment">// æ‰€æœ‰æˆå‘˜è¢«ä»ä¸€ä¸ªç»„ä¸­åˆ é™¤</span>
  
  <span class="token comment">// other code ...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>ProcessEngineConfigurationConfigurer ä¸­çš„ void configure(SpringProcessEngineConfiguration springProcessEngineConfiguration) æ–¹æ³•å¯ä»¥æ·»åŠ è‡ªå®šä¹‰çš„äº‹ä»¶ç›‘å¬å™¨ï¼Œè¿™ä¸ªç›‘å¬å™¨ä½œç”¨åŸŸä¸ºæ•´ä¸ªæµç¨‹è¿‡ç¨‹ã€‚å…¶æºç å¦‚ä¸‹ï¼š</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultActivityBehaviorFactoryMappingConfigurer</span> <span class="token keyword">implements</span> <span class="token class-name">ProcessEngineConfigurationConfigurer</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token class-name">VariablesMappingProvider</span> variablesMappingProvider<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">ProcessVariablesInitiator</span> processVariablesInitiator<span class="token punctuation">;</span>
    
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">EventSubscriptionPayloadMappingProvider</span> eventSubscriptionPayloadMappingProvider<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">DefaultActivityBehaviorFactoryMappingConfigurer</span><span class="token punctuation">(</span><span class="token class-name">VariablesMappingProvider</span> variablesMappingProvider<span class="token punctuation">,</span>
                                                           <span class="token class-name">ProcessVariablesInitiator</span> processVariablesInitiator<span class="token punctuation">,</span>
                                                           <span class="token class-name">EventSubscriptionPayloadMappingProvider</span> eventSubscriptionPayloadMappingProvider<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>variablesMappingProvider <span class="token operator">=</span> variablesMappingProvider<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>processVariablesInitiator <span class="token operator">=</span> processVariablesInitiator<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>eventSubscriptionPayloadMappingProvider <span class="token operator">=</span> eventSubscriptionPayloadMappingProvider<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">SpringProcessEngineConfiguration</span> processEngineConfiguration<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        processEngineConfiguration<span class="token punctuation">.</span><span class="token function">setEventSubscriptionPayloadMappingProvider</span><span class="token punctuation">(</span>eventSubscriptionPayloadMappingProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>

        processEngineConfiguration<span class="token punctuation">.</span><span class="token function">setActivityBehaviorFactory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MappingAwareActivityBehaviorFactory</span><span class="token punctuation">(</span>variablesMappingProvider<span class="token punctuation">,</span>
                                                                                                      processVariablesInitiator<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>å¦‚ä½•æ¥ç›‘å¬äº‹ä»¶ï¼Ÿ</strong></p> 
<ol><li>å®ç° ActivitiEventListener æ¥å£ï¼Œé‡å†™ void onEvent(ActivitiEvent event) æ–¹æ³•ï¼›</li><li>æ–°å¢é…ç½®ç±»ï¼Œç»§æ‰¿ DefaultActivityBehaviorFactoryMappingConfigurer ç±»ï¼ˆæˆ–å®ç° ProcessEngineConfigurationConfigurer æ¥å£ï¼‰å¹¶é‡å†™ configura() æ–¹æ³•, ç»™ SpringProcessEngineConfiguration å±æ€§æ·»åŠ è‡ªå®šä¹‰çš„ç›‘å¬å™¨å®ç°ç±»ï¼›</li></ol> 
<p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActivitiConfiguration</span> <span class="token keyword">extends</span> <span class="token class-name">DefaultActivityBehaviorFactoryMappingConfigurer</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">ActivitiTaskLogService</span> activitiTaskLogService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">UserService</span> userService<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ActivitiConfiguration</span><span class="token punctuation">(</span><span class="token class-name">VariablesMappingProvider</span> variablesMappingProvider<span class="token punctuation">,</span> <span class="token class-name">ProcessVariablesInitiator</span> processVariablesInitiator<span class="token punctuation">,</span>
                                 <span class="token class-name">EventSubscriptionPayloadMappingProvider</span> eventSubscriptionPayloadMappingProvider<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>variablesMappingProvider<span class="token punctuation">,</span> processVariablesInitiator<span class="token punctuation">,</span> eventSubscriptionPayloadMappingProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">configure</span><span class="token punctuation">(</span><span class="token class-name">SpringProcessEngineConfiguration</span> springProcessEngineConfiguration<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">configure</span><span class="token punctuation">(</span>springProcessEngineConfiguration<span class="token punctuation">)</span><span class="token punctuation">;</span>

        springProcessEngineConfiguration<span class="token punctuation">.</span><span class="token function">setEventListeners</span><span class="token punctuation">(</span>
                <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ActivitiTaskEventListener</span><span class="token punctuation">(</span>activitiTaskLogService<span class="token punctuation">,</span> userService<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActivitiTaskEventListener</span> <span class="token keyword">implements</span> <span class="token class-name">ActivitiEventListener</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onEvent</span><span class="token punctuation">(</span><span class="token class-name">ActivitiEvent</span> activitiEvent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>activitiEvent<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        processEngine <span class="token operator">=</span> <span class="token class-name">ProcessEngines</span><span class="token punctuation">.</span><span class="token function">getDefaultProcessEngine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// æµç¨‹å®ä¾‹</span>
        <span class="token class-name">ProcessInstance</span> processInstance <span class="token operator">=</span> processEngine<span class="token punctuation">.</span><span class="token function">getRuntimeService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createProcessInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">processInstanceId</span><span class="token punctuation">(</span>activitiEvent<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>processInstance <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ActivitiTaskLog</span><span class="token punctuation">&gt;</span></span> taskLogList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>activitiEvent<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// ä»»åŠ¡æ‰§è¡Œå</span>
            <span class="token keyword">case</span> TASK_COMPLETED<span class="token operator">:</span>
                <span class="token comment">// ä»»åŠ¡è¢«å¤„ç†ï¼Œç»™åˆ›å»ºäºº, ä¸‹ä¸€ä¸ªä»»åŠ¡çš„å€™é€‰äºº</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ActivitiTaskLog</span><span class="token punctuation">&gt;</span></span> taskCompletedLogs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">taskCompleted</span><span class="token punctuation">(</span>processInstance<span class="token punctuation">,</span> activitiEvent<span class="token punctuation">.</span><span class="token function">getExecutionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>taskCompletedLogs<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    taskLogList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>taskCompletedLogs<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> PROCESS_COMPLETED<span class="token operator">:</span>
                <span class="token comment">// æµç¨‹å®Œæˆï¼Œç»™åˆ›å»ºäººï¼ŒååŠ©äººï¼ŒæŠ„é€äººå‘é€šçŸ¥</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ActivitiTaskLog</span><span class="token punctuation">&gt;</span></span> processCompletedLogs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">processCompleted</span><span class="token punctuation">(</span>processInstance<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>processCompletedLogs<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    taskLogList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>processCompletedLogs<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//æ‰§è¡Œæ—¥å¿—æ“ä½œ</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">CollectionUtils</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>taskLogList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            activitiTaskLogService<span class="token punctuation">.</span><span class="token function">createBatch</span><span class="token punctuation">(</span>taskLogList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="2__262"></a>2. è¿è¡Œæ—¶çŠ¶æ€ç›‘å¬å™¨ï¼š</h5> 
<p>åœ¨å®ä¾‹ä¸­æœ‰ä¸€ä¸ª activiti-api-basic-process-example å’Œ activiti-api-basic-task-example ä¸¤ä¸ªç¤ºä¾‹å·¥ç¨‹ï¼Œå±•ç¤ºäº†å¦‚ä½•è¿›è¡Œé…ç½®è¿è¡Œæ—¶çš„processå’Œtaskçš„ç›‘å¬ã€‚</p> 
<p>activiti-api-basic-process-example ä¸­ï¼Œæµç¨‹ç›‘å¬ç¤ºä¾‹ï¼š</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">ProcessRuntimeEventListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessCompletedEvent</span><span class="token punctuation">&gt;</span></span> <span class="token function">processCompletedListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> processCompleted <span class="token operator">-&gt;</span> logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt; Process Completed: '"</span>
            <span class="token operator">+</span> processCompleted<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
            <span class="token string">"' We can send a notification to the initiator: "</span> <span class="token operator">+</span> processCompleted<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInitiator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>activiti-api-basic-task-example ä¸­ï¼Œä»»åŠ¡ç›‘å¬ç¤ºä¾‹ï¼š</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">TaskRuntimeEventListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TaskAssignedEvent</span><span class="token punctuation">&gt;</span></span> <span class="token function">taskAssignedListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> taskAssigned <span class="token operator">-&gt;</span> logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt; Task Assigned: '"</span>
            <span class="token operator">+</span> taskAssigned<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
            <span class="token string">"' We can send a notification to the assginee: "</span> <span class="token operator">+</span> taskAssigned<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAssignee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">TaskRuntimeEventListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TaskCompletedEvent</span><span class="token punctuation">&gt;</span></span> <span class="token function">taskCompletedListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> taskCompleted <span class="token operator">-&gt;</span> logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt; Task Completed: '"</span>
            <span class="token operator">+</span> taskCompleted<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>
            <span class="token string">"' We can send a notification to the owner: "</span> <span class="token operator">+</span> taskCompleted<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOwner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>å‚ç…§ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œè‡ªå®šä¹‰çš„æµç¨‹ä¸­äº‹ä»¶ç›‘å¬çš„é…ç½®ï¼Œè¿™ç§æ–¹å¼ï¼Œä¸éœ€è¦å®ç° ActivitiEventlistener æ¥å£ï¼Œä¹Ÿä¸éœ€è¦ç»§æ‰¿ DefaultActivityBehaviorFactoryMappingConfigurer ç±»æˆ–å®ç° ProcessEngineConfigurationConfigurer æ¥å£ï¼Œåªéœ€è¦æ³¨å†Œç›¸å…³äº‹ä»¶çš„ç›‘å¬å™¨å³å¯ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ActivitiConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">RuntimeService</span> runtimeService<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ActRuTaskLogService</span> actRuTaskLogService<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ActivitiConfiguration</span><span class="token punctuation">(</span><span class="token class-name">RuntimeService</span> runtimeService<span class="token punctuation">,</span> <span class="token class-name">ActRuTaskLogService</span> actRuTaskLogService<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>runtimeService <span class="token operator">=</span> runtimeService<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>actRuTaskLogService <span class="token operator">=</span> actRuTaskLogService<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">TaskRuntimeEventListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TaskAssignedEvent</span><span class="token punctuation">&gt;</span></span> <span class="token function">taskAssignedListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> taskAssigned <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>

            <span class="token class-name">ExecutionEntity</span> execution <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ExecutionEntity</span><span class="token punctuation">)</span> runtimeService<span class="token punctuation">.</span><span class="token function">createProcessInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">processInstanceId</span><span class="token punctuation">(</span>taskAssigned<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> startUserId <span class="token operator">=</span> execution<span class="token punctuation">.</span><span class="token function">getStartUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> fileProcInstId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fileProcInstId</span><span class="token punctuation">(</span>execution<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// æ’é™¤å‘èµ·ç”³è¯·çš„ä»»åŠ¡ï¼Œç»™ assignee å‘æ¶ˆæ¯</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>taskAssigned<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAssignee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>startUserId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">Task</span> task <span class="token operator">=</span> taskAssigned<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">ActRuTaskLog</span> taskLog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActRuTaskLog</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        taskAssigned<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAssignee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">NotifyConstants</span><span class="token punctuation">.</span>PENDING_WARN<span class="token punctuation">,</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">userName</span><span class="token punctuation">(</span>startUserId<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">processType</span><span class="token punctuation">(</span>fileProcInstId<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">projName</span><span class="token punctuation">(</span>execution<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token class-name">NotifyTypeConstants</span><span class="token punctuation">.</span>CANDIDATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
                actRuTaskLogService<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>taskLog<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">TaskRuntimeEventListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TaskCompletedEvent</span><span class="token punctuation">&gt;</span></span> <span class="token function">taskCompletedListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> taskCompleted <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>

            <span class="token class-name">ExecutionEntity</span> execution <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ExecutionEntity</span><span class="token punctuation">)</span> runtimeService<span class="token punctuation">.</span><span class="token function">createProcessInstanceQuery</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">processInstanceId</span><span class="token punctuation">(</span>taskCompleted<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">singleResult</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> startUserId <span class="token operator">=</span> execution<span class="token punctuation">.</span><span class="token function">getStartUserId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> fileProcInstId <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">fileProcInstId</span><span class="token punctuation">(</span>execution<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Task</span> task <span class="token operator">=</span> taskCompleted<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// å‘èµ·å®¡æ‰¹ï¼Œç»™æŠ„é€äººã€ååŠ©äººå‘æ¶ˆæ¯</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>taskCompleted<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAssignee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>startUserId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// ä»»åŠ¡æ‰€æœ‰äºº</span>
                <span class="token class-name">String</span> owner <span class="token operator">=</span> taskCompleted<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOwner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">ActRuTaskLog</span> taskLog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActRuTaskLog</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">userName</span><span class="token punctuation">(</span>owner<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">NotifyConstants</span><span class="token punctuation">.</span>PENDING_WARN<span class="token punctuation">,</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">userName</span><span class="token punctuation">(</span>startUserId<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">processType</span><span class="token punctuation">(</span>fileProcInstId<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">projName</span><span class="token punctuation">(</span>execution<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token class-name">NotifyTypeConstants</span><span class="token punctuation">.</span>CANDIDATE<span class="token punctuation">)</span><span class="token punctuation">;</span>
                actRuTaskLogService<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>taskLog<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// ç»™å‘èµ·äººå‘é€ä»»åŠ¡å¤„ç†ç»“æœçš„é€šçŸ¥</span>
                <span class="token class-name">ActRuTaskLog</span> taskLog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ActRuTaskLog</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getProcessInstanceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        taskCompleted<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAssignee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">NotifyConstants</span><span class="token punctuation">.</span>PENDING<span class="token punctuation">,</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">userName</span><span class="token punctuation">(</span>startUserId<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">processType</span><span class="token punctuation">(</span>fileProcInstId<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">projName</span><span class="token punctuation">(</span>execution<span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">userName</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getAssignee</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">NotifyTypeConstants</span><span class="token punctuation">.</span>PENDING<span class="token punctuation">)</span><span class="token punctuation">;</span>
                actRuTaskLogService<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>taskLog<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">TaskCandidateEventListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TaskCandidateUserAddedEvent</span><span class="token punctuation">&gt;</span></span> <span class="token function">taskCandidateUserEventListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> taskCandidateEvent <span class="token operator">-&gt;</span> log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt; Task Candidate User Add: '"</span>
                <span class="token operator">+</span> taskCandidateEvent<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">TaskCandidateEventListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TaskCandidateGroupAddedEvent</span><span class="token punctuation">&gt;</span></span> <span class="token function">taskCandidateGroupEventListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> taskCandidateEvent <span class="token operator">-&gt;</span> log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt; Task Candidate Group Add: '"</span>
                <span class="token operator">+</span> taskCandidateEvent<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">ProcessRuntimeEventListener</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ProcessCompletedEvent</span><span class="token punctuation">&gt;</span></span> <span class="token function">processCompletedEventListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> processCompletedEvent <span class="token operator">-&gt;</span> log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"===&gt;&gt;&gt; Process Completed: '"</span>
                <span class="token operator">+</span> processCompletedEvent<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * è·å–æµç¨‹è¡¨å•å
     *
     * @param executionEntity æ‰§è¡Œå¯¹è±¡
     * @return è¡¨å•å
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">projName</span><span class="token punctuation">(</span><span class="token class-name">ExecutionEntity</span> executionEntity<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Object</span> processInstanceName <span class="token operator">=</span> executionEntity<span class="token punctuation">.</span><span class="token function">getVariable</span><span class="token punctuation">(</span><span class="token string">"projName"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span> <span class="token operator">==</span> processInstanceName <span class="token operator">?</span> <span class="token string">""</span> <span class="token operator">:</span> processInstanceName<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * è·å–æµç¨‹æ–‡ä»¶ID
     *
     * @param executionEntity æ‰§è¡Œå¯¹è±¡
     * @return æ–‡ä»¶ID
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">fileProcInstId</span><span class="token punctuation">(</span><span class="token class-name">ExecutionEntity</span> executionEntity<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Object</span> fileProcInstId <span class="token operator">=</span> executionEntity<span class="token punctuation">.</span><span class="token function">getVariable</span><span class="token punctuation">(</span><span class="token string">"fileProcInstId"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> fileProcInstId <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token string">""</span> <span class="token operator">:</span> fileProcInstId<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * å®¡æ‰¹ç±»å‹
     *
     * @param fileProcInstId æ–‡ä»¶ID
     * @return ç±»å‹
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">processType</span><span class="token punctuation">(</span><span class="token class-name">String</span> fileProcInstId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasText</span><span class="token punctuation">(</span>fileProcInstId<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">"ç”¨å°"</span> <span class="token operator">:</span> <span class="token string">"åˆåŒ"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * è·å–å§“å
     *
     * @param userId ç”¨æˆ·ID
     * @return ç”¨æˆ·å§“å
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">userName</span><span class="token punctuation">(</span><span class="token class-name">String</span> userId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> userId <span class="token operator">+</span> <span class="token string">"æ“ä½œäºº"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>ä¸Šé¢ä¸¤ç§æ–¹å¼ï¼Œæ›´æ¨èä½¿ç”¨ç¬¬äºŒç§ï¼Œå› ä¸ºç¬¬ä¸€ç§æ–¹æ¡ˆä¸­ï¼ŒActivitiEvent æ˜¯è¶…ç±»ï¼Œè€Œä¸€äº›å±æ€§æ˜¯ç›´æ¥è·å–ä¸åˆ°çš„ï¼Œå¦‚æœè¦è·å–ï¼Œå°±éœ€è¦è¿›è¡Œå‘ä¸‹å¼ºè½¬ï¼Œè€Œæ¯ç§äº‹ä»¶çš„ç±»å‹ï¼Œå®ç°å­ç±»åˆæ˜¯ä¸åŒçš„ï¼Œéœ€è¦åšå¾ˆå¤šçš„åˆ¤æ–­ï¼Œä½†æ˜¯ç¬¬äºŒç§æ–¹æ³•å°±ä¸ç”¨ï¼Œå› ä¸ºå½“å‰ç›‘å¬å™¨ä¸­çš„å¯¹è±¡å°±æ˜¯æ”¹ç±»å‹å¯¹åº”çš„äº‹ä»¶çš„ç›¸å…³å¯¹è±¡ï¼Œèƒ½å¤Ÿç›´æ¥è·å–åˆ°ç›¸å…³çš„å˜é‡å’Œä¿¡æ¯ã€‚</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2e4e3eedb6d17bafeba8d3ba3f0e2098/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">å…¨æ°‘çªå‡»æœåŠ¡å™¨ç»´æŠ¤å¤šä¹…,å…¨æ°‘çªå‡»æ‚¨çš„æˆæƒå·²å¤±æ•ˆè¯·é‡æ–°ç™»å½•æ€ä¹ˆåŠ æˆæƒå¤±æ•ˆè§£å†³æ–¹æ³•ä»‹ç»...</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2c9eb8a8173df99a6246c3c37cb24116/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">fs2410å¼€å‘æ¿æ­å»ºç½‘ç«™æœåŠ¡å™¨,FS2410å¼€å‘æ¿ä½¿ç”¨æ­¥éª¤</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 èœé¸Ÿç¨‹åºå‘˜åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>