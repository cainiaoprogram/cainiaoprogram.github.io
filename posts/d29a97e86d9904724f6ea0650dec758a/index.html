<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Paper】PDFormer - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Paper】PDFormer" />
<meta property="og:description" content="PDFormer: Propagation Delay-Aware Dynamic Long-Range Transformer for Traffic Flow Prediction Abstract As a core technology of Inteligent Transportation System, traffic flow prediction has a wide range of application. The fundamental challenge in traffic flow prediction is to effictely model the complex spatial-temporal dependencies in traffic data.
Spatial-temporal Graph Neural Network(GNN) models have emerged as one of the most promising methods to solve this problem.
However, GNN-based models have three major limitations for traffic predication:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/d29a97e86d9904724f6ea0650dec758a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-25T16:49:48+08:00" />
<meta property="article:modified_time" content="2023-11-25T16:49:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Paper】PDFormer</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="PDFormer_Propagation_DelayAware_Dynamic_LongRange_Transformer_for_Traffic_Flow_Prediction_0"></a>PDFormer: Propagation Delay-Aware Dynamic Long-Range Transformer for Traffic Flow Prediction</h2> 
<h2><a id="Abstract_2"></a>Abstract</h2> 
<p>As a core technology of Inteligent Transportation System, traffic flow prediction has a wide range of application. The fundamental challenge in traffic flow prediction is to effictely model the complex spatial-temporal dependencies in traffic data.</p> 
<p>Spatial-temporal Graph Neural Network(GNN) models have emerged as one of the most promising methods to solve this problem.</p> 
<p>However, GNN-based models have three major limitations for traffic predication:</p> 
<ol><li>Most methods model spatial dependencies in a static manner, which limits the ablility to learn dynamic urban traffiic pattern;</li></ol> 
<ul><li>“Static manner”： 静态建模指的是一种静态的方式或方法，即假设在一个特定的时间点内空间上的依赖关系是固定不变的。</li><li>这些图卷积类的方法依赖与静态的图结构，“静态建模”则表示这些方法认为这些关系是不变的，也就是说，在时间上没有任何变化或者演化。因此，这些方法不能捕捉到空间依赖性关系的动态变化，可能不适合需要考虑空间关系的动态变化的应用场景。</li><li>所以限制了动态的城市交通模式的学习。</li></ul> 
<ol start="2"><li>Most methods only consider short-range spatial infermation and are unable to capture long-range spatial dependencis;</li></ol> 
<ul><li>大部分方法只考虑 短范围的空间关系，无法获取较长范围的的空间依赖关系。</li></ul> 
<ol start="3"><li>These methods ignore the fact that the propagation of traffic conditions between locations has a time delay in traffice systems.</li></ol> 
<ul><li> <p>propagation ： 传播</p> </li><li> <p>traffice condition: 交通状况</p> </li><li> <p>这些方法忽略了这样一个事实：在交通系统中，不同地点之间交通状况的传播具有一定的延时性。<br> To this end, we propose a novel Propagation Delay-aware dynamic long-range transFormer, namely PDFormer, for accurate traffice long-range prediction. Specifically, we design a spatial self-attention module to capture the dynamic spatial dependencies. Then, two graph masking matrices are introduced to hignlight spatial dependencies from short-and long-range views.</p> </li><li> <p>我们提出了一个 新的 Delay-aware, dynamic long-range Transformer, 叫做PDFormer.</p> </li><li> <p>我们设计了自注意力机制来捕获动态的空间依赖</p> </li><li> <p>使用两个图 masking metrices 来强调 短距离和长距离的空间依赖，<s>猜测可能是对长距离和短距离的节点进行加权处理，后面回来验证。</s></p> </li></ul> 
<p>Moreover, a traffic delay-aware feature transformation module is proposed to empower PDFormer with the capability of explicity.</p> 
<ul><li>delay-aware feature transformation 可以显示增强 PDFormer的性能</li></ul> 
<p>Extensive experimental results on six real-world public traffic datasets show that our method can not only archive state-of-the-art perfermance but also exhibit competitive computational efficiency.Moreover, we visualize the learned spatial-temporal attention map to make our model highly interprtable.</p> 
<ul><li>在 6个交通数据上达到了sota</li><li>表现出较好的计算效率</li><li>可视化了时空注意力图，来使得模型具有较好的解释性。</li></ul> 
<h2><a id="Introduction_34"></a>Introduction</h2> 
<p>In recent years, rapid urbanization has posed great challenges to modern urban traffic management. As an indispensable part of model smart cities. 应用场景后面回来看</p> 
<p>For traffic flow prediction, the fundamental challenge is to effiecively caputure and model the complex and dynamic spatial-temporal dependencies of traffic data.</p> 
<p>Many attenpts have been made in the literature to develop various deep learning models for this task. As early solutions, convolutional neural networks(CNNs) were applied to grid-based traffic data to capture spatial dependencies, and recurrent neural networks(RNNs) were used to learn temporal dyanamic.</p> 
<p>graph neural networks(GNNs) were shown to be more suited to model the underlying graph structure of traffic data, and thus GNN-based methods have been widely explored in traffic prediction.</p> 
<p>Despite the effectiveness, GNN-based models still have three major limitations for traffic prediction.</p> 
<p>First, the spatial dependecies between locations in a traffic system are highly dynamic instead of being static,which are time-varying as they are affected by travel patterns and unexpected events. For example, as shown in Fig.1(b), the correlation between nodes A and B becomes stronger during the morning peek and weaker during other periods. While, existing methods model spatial dependencies mainly in a static manner(either perdefine or self-learned), which limits the ablility to learn dynamic urban traffic patterns.Secondly, due to the function division of the city, two distant locations, such as nodes A and C in Fig.1©, may reflect similar traffic pattens, implying the spatial dependencies between locaions as long-range.<br> <img src="https://images2.imgbox.com/f8/3e/RxNifzJz_o.png" alt="在这里插入图片描述"></p> 
<ul><li>在交通系统中，不同地点的空间依赖是十分动态的而不是静态的， 这些依赖变化是随时间变化的。 这是由于受出行模式（应该是早高峰，晚高峰类似的）以及其他特定事件的影响。</li><li>从图1(a) 可以看出 A和B节点在地图上较近，但是在某些特定的时间上，相关性不一定强。一个在上班的主干道，一个是商业街的路？</li><li>从图1( c )可以看出， A和较远的C有较强的相关性，比如A和C都在上班的路上。A和C的模式较为接近。</li><li>从图1(d)可以看出， D和E是同一条路上的两个节点，但是发现同一个节点的相邻交通节点的交通情况具有传播延时性。比如车祸导致堵车，堵车这个会沿着相应的节点进行传播。</li></ul> 
<p>Existing methods are often designed locally and unabel to capture long-range dependencies. For example, GNN-based models suffer from over-smothing, making it difficult to capture long-range spatial dependencies. Thirdly, the effect of time delay might occur in the spatial information propagation between locations in a traffic system. For example, when a traffic accident occurs in one location, it will take several minutes(a delay) to affect the traffic condition in neighboring locations, such as nodes D and E in Fig. 1(d). However, such a feature has been ignored in the immediate message passing mechanism of typicl GNN-based models.</p> 
<p>To address the above issues, in this paper, we propose a Propagation Delay-aware dynamic long-range trransFormer model, namly PDFormer, for traffic flow prediction. As the core technical contribution, we design a noval spatial self-attention module to capture the dynamic spatial dependencies. This module incorporates local geographic neighborhood and global semantic neighborhood information into the self-attention ineraction via different graph masking methods , which can simulataneously capture the short-and long- range spatial dependencies in traffic data.</p> 
<ul><li>为了解决以上的问题，设计了PDFormer。</li><li>设计了空间自注意力模块来捕获动态空间依赖。 这个模块通过不同的图掩码方法将局部的领接图和全局语义领接信息嵌入到自注意力中， 这样在交通数据中，可以同时捕捉到长短距离的空间依赖。</li></ul> 
<p>Based on this module, we further design a delay-aware feature transformation module to integrate historical traffic patterns into spatial self-attention and explicity model the time delay of spatial information propagation.</p> 
<ul><li>基于以上的模块，进一步设计了延迟感知特征转化模块来集成历史交通数据模式到空间自注意力 并且显式建模了空间信息传播。</li></ul> 
<h2><a id="Notation_and_Definitions_65"></a>Notation and Definitions</h2> 
<h3><a id="Definition_1_Road_Network_66"></a>Definition 1 Road Network.</h3> 
<p>将道路网络表示为图 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         G 
        
       
         = 
        
       
         ( 
        
       
         V 
        
       
         , 
        
       
         ε 
        
       
         , 
        
       
         A 
        
       
         ) 
        
       
      
        G = (V, \varepsilon, A) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal">G</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.2222em;">V</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">ε</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">A</span><span class="mclose">)</span></span></span></span></span></p> 
<ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          V 
         
        
          = 
         
        
          { 
         
        
          v 
         
        
          1 
         
        
          , 
         
        
          … 
         
        
          , 
         
         
         
           v 
          
         
           N 
          
         
        
          } 
         
        
       
         V = \{v1, \dots, v_N\} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.2222em;">V</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">{<!-- --></span><span class="mord mathnormal" style="margin-right: 0.0359em;">v</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0359em;">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: -0.0359em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.109em;">N</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">}</span></span></span></span></span> 表示N个节点</li><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          ε 
         
        
          ⊆ 
         
        
          V 
         
        
          × 
         
        
          V 
         
        
       
         \varepsilon \subseteq V \times V 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.7719em; vertical-align: -0.136em;"></span><span class="mord mathnormal">ε</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">⊆</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.7667em; vertical-align: -0.0833em;"></span><span class="mord mathnormal" style="margin-right: 0.2222em;">V</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.2222em;">V</span></span></span></span></span> 表示边</li><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          A 
         
        
       
         A 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span></span>表示邻接矩阵</li></ul> 
<h3><a id="Definition_2_Traffic_Flow_Tensor_72"></a>Definition 2 Traffic Flow Tensor</h3> 
<p>使用 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          X 
         
        
          t 
         
        
       
         ∈ 
        
        
        
          R 
         
         
         
           N 
          
         
           × 
          
         
           C 
          
         
        
       
      
        X_t \in \mathbb R^{N \times C} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span class="" style="top: -2.55em; margin-left: -0.0785em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8413em;"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8413em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.109em;">N</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight" style="margin-right: 0.0715em;">C</span></span></span></span></span></span></span></span></span></span></span></span></span> 表示N个节点的交通流</p> 
<ul><li>N表示N个节点</li><li>C 表示交通流的维度。如C = 2 表示交通流的数据维度。比如可以表示驶入流量和驶出流量</li><li>使用 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          X 
         
        
          = 
         
        
          ( 
         
         
         
           X 
          
         
           1 
          
         
        
          , 
         
         
         
           X 
          
         
           2 
          
         
        
          , 
         
        
          … 
         
        
          , 
         
         
         
           X 
          
         
           T 
          
         
        
          ) 
         
        
          ∈ 
         
         
         
           R 
          
          
          
            T 
           
          
            × 
           
          
            N 
           
          
            × 
           
          
            C 
           
          
         
        
       
         X = (X_1, X_2, \dots, X_T) \in \mathbb R^{T\times N \times C} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0785em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0785em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="minner">…</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: -0.0785em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1389em;">T</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8413em;"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8413em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1389em;">T</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight" style="margin-right: 0.109em;">N</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight" style="margin-right: 0.0715em;">C</span></span></span></span></span></span></span></span></span></span></span></span></span> 表示T时间片段的交通流</li></ul> 
<h3><a id="Problem_Formalization_78"></a>Problem Formalization</h3> 
<p>交通流预测旨在预测交通系统中的通过历史观察数据来获取未来时间的流量。可以将问题描述为：</p> 
<ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          X 
         
        
       
         X 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span></span></span></span></span> 表示观测数据</li><li>通过学习得到一个函数 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          f 
         
        
       
         f 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span></span></span></span></span> 来预测将来的交通流量数据</li></ul> 
<p><img src="https://images2.imgbox.com/c8/0e/Bp863FXE_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Methods_85"></a>Methods</h2> 
<p>图2 展示了PDFormer的框架，包括数据嵌入层，L 层堆叠的 时空 编码器层，以及一个输出层。</p> 
<h3><a id="Data_Embedding_Layer_88"></a>Data Embedding Layer</h3> 
<p>数据嵌入层将输入转化到高维度的表征。</p> 
<ul><li>首先，原始的输入数据 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          X 
         
        
       
         X 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span></span></span></span></span> 将转化到最终的输入数据 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           X 
          
          
          
            d 
           
          
            a 
           
          
            t 
           
          
            a 
           
          
         
        
          ∈ 
         
         
         
           R 
          
          
          
            T 
           
          
            × 
           
          
            N 
           
          
            × 
           
          
            d 
           
          
         
        
       
         X_{data} \in \mathbb R^{T \times N \times d} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: -0.0785em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">a</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8491em;"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8491em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1389em;">T</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight" style="margin-right: 0.109em;">N</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span></span></span></span></span></span> 通过一个全连接层。<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          d 
         
        
       
         d 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord mathnormal">d</span></span></span></span></span>是嵌入维度。</li><li>然后通过设计的时空嵌入机制来提取必要的知识，并输入网络，包括： 
  <ul><li>空间图拉普拉斯嵌入来表示道路网络结构</li><li>时间周期嵌入</li></ul> </li></ul> 
<h4><a id="graph_Laplacian_embeding_95"></a>graph Laplacian embeding</h4> 
<p>为了表征道路网络结构，使用图像拉普拉斯谱分解。</p> 
<ul><li>首先得到归一化拉普拉斯矩阵通过公式： <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          Δ 
         
        
          = 
         
        
          I 
         
        
          − 
         
         
         
           D 
          
          
          
            − 
           
          
            1 
           
          
            / 
           
          
            2 
           
          
         
        
          A 
         
         
         
           D 
          
          
          
            1 
           
          
            / 
           
          
            2 
           
          
         
        
       
         \Delta = I - D^{-1/2}A D^{1/2} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord">Δ</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.7667em; vertical-align: -0.0833em;"></span><span class="mord mathnormal" style="margin-right: 0.0785em;">I</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.888em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.888em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1/2</span></span></span></span></span></span></span></span></span><span class="mord mathnormal">A</span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.888em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1/2</span></span></span></span></span></span></span></span></span></span></span></span></span>。其中 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          A 
         
        
       
         A 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal">A</span></span></span></span></span> 是邻接矩阵， <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          D 
         
        
       
         D 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span></span></span></span></span>是度矩阵， <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          I 
         
        
       
         I 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0785em;">I</span></span></span></span></span> 是单位矩阵。</li><li>使用特征值分解： <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          Δ 
         
        
          = 
         
         
         
           U 
          
         
           T 
          
         
        
          Λ 
         
        
          U 
         
        
       
         \Delta = U^T \Lambda U 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord">Δ</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8413em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em;">U</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8413em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right: 0.1389em;">T</span></span></span></span></span></span></span></span><span class="mord">Λ</span><span class="mord mathnormal" style="margin-right: 0.109em;">U</span></span></span></span></span> 得到特征值矩阵 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          Λ 
         
        
       
         \Lambda 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord">Λ</span></span></span></span></span> 和特征向量矩阵<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          U 
         
        
       
         U 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.109em;">U</span></span></span></span></span>。</li><li>此时 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          U 
         
        
          ∈ 
         
         
         
           R 
          
          
          
            N 
           
          
            × 
           
          
            d 
           
          
         
        
       
         U \in \mathbb R^{N \times d} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.7224em; vertical-align: -0.0391em;"></span><span class="mord mathnormal" style="margin-right: 0.109em;">U</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8491em;"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8491em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.109em;">N</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span></span></span></span></span></span> 根据特征值的大小挑选出 d 个最小的特征相关组成 拉普拉斯特征向量图嵌入。<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           X 
          
          
          
            s 
           
          
            p 
           
          
            e 
           
          
         
        
          ∈ 
         
         
         
           R 
          
          
          
            N 
           
          
            × 
           
          
            d 
           
          
         
        
       
         X_{spe}\in \mathbb R^{N \times d} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9694em; vertical-align: -0.2861em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em;">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.0785em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">s</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">∈</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8491em;"></span><span class="mord"><span class="mord mathbb">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8491em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.109em;">N</span><span class="mbin mtight">×</span><span class="mord mathnormal mtight">d</span></span></span></span></span></span></span></span></span></span></span></span></span></li></ul> 
<p>代码实现：</p> 
<pre><code class="prism language-python">    <span class="token keyword">def</span> <span class="token function">_cal_lape</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> adj_mx<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 归一化拉普拉斯矩阵</span>
        L<span class="token punctuation">,</span> isolated_point_num <span class="token operator">=</span> self<span class="token punctuation">.</span>_calculate_normalized_laplacian<span class="token punctuation">(</span>adj_mx<span class="token punctuation">)</span>
        <span class="token comment"># 特征值分解</span>
        EigVal<span class="token punctuation">,</span> EigVec <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>eig<span class="token punctuation">(</span>L<span class="token punctuation">.</span>toarray<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 特征值排序，得到排序索引</span>
        idx <span class="token operator">=</span> EigVal<span class="token punctuation">.</span>argsort<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 利用特征值得排序索引对特征值和特征向量排序</span>
        EigVal<span class="token punctuation">,</span> EigVec <span class="token operator">=</span> EigVal<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>real<span class="token punctuation">(</span>EigVec<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> idx<span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token comment"># 去前 self.lape_dim个特征向量组成道路网络的嵌入 $X_{spe}$</span>
        laplacian_pe <span class="token operator">=</span> torch<span class="token punctuation">.</span>from_numpy<span class="token punctuation">(</span>EigVec<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> isolated_point_num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>lape_dim <span class="token operator">+</span> isolated_point_num <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        laplacian_pe<span class="token punctuation">.</span>require_grad <span class="token operator">=</span> <span class="token boolean">False</span>
        <span class="token keyword">return</span> laplacian_pe
</code></pre> 
<p>调用</p> 
<pre><code class="prism language-python"><span class="token comment"># size: （307, 8） </span>
 self<span class="token punctuation">.</span>lap_mx <span class="token operator">=</span> self<span class="token punctuation">.</span>_cal_lape<span class="token punctuation">(</span>self<span class="token punctuation">.</span>adj_mx<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span>self<span class="token punctuation">.</span>device<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_123"></a>时间周期嵌入</h4> 
<p>城市交通流也受人们出行模式和生活习惯影响，具有明显的周期性，比如早高峰和晚高峰。因此设计了两个时间周期嵌入：</p> 
<ul><li>以周为周期的表征 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           t 
          
          
          
            w 
           
          
            ( 
           
          
            t 
           
          
            ) 
           
          
         
        
       
         t_{w(t)} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9703em; vertical-align: -0.3552em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3448em;"><span class="" style="top: -2.5198em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0269em;">w</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.3552em;"><span class=""></span></span></span></span></span></span></span></span></span></span></li><li>以天为周期的表征 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           t 
          
          
          
            d 
           
          
            ( 
           
          
            t 
           
          
            ) 
           
          
         
        
       
         t_{d(t)} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9703em; vertical-align: -0.3552em;"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3448em;"><span class="" style="top: -2.5198em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">d</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">t</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.3552em;"><span class=""></span></span></span></span></span></span></span></span></span></span></li></ul> 
<p>代码实现：</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">DataEmbedding</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>
        self<span class="token punctuation">,</span> feature_dim<span class="token punctuation">,</span> embed_dim<span class="token punctuation">,</span> lape_dim<span class="token punctuation">,</span> adj_mx<span class="token punctuation">,</span> drop<span class="token operator">=</span><span class="token number">0.</span><span class="token punctuation">,</span>
        add_time_in_day<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> add_day_in_week<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> device<span class="token operator">=</span>torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cpu'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>add_time_in_day <span class="token operator">=</span> add_time_in_day
        self<span class="token punctuation">.</span>add_day_in_week <span class="token operator">=</span> add_day_in_week

        self<span class="token punctuation">.</span>device <span class="token operator">=</span> device
        self<span class="token punctuation">.</span>embed_dim <span class="token operator">=</span> embed_dim
        self<span class="token punctuation">.</span>feature_dim <span class="token operator">=</span> feature_dim
        self<span class="token punctuation">.</span>value_embedding <span class="token operator">=</span> TokenEmbedding<span class="token punctuation">(</span>feature_dim<span class="token punctuation">,</span> embed_dim<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>position_encoding <span class="token operator">=</span> PositionalEncoding<span class="token punctuation">(</span>embed_dim<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>add_time_in_day<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>minute_size <span class="token operator">=</span> <span class="token number">1440</span>
            self<span class="token punctuation">.</span>daytime_embedding <span class="token operator">=</span> nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span>self<span class="token punctuation">.</span>minute_size<span class="token punctuation">,</span> embed_dim<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>add_day_in_week<span class="token punctuation">:</span>
            weekday_size <span class="token operator">=</span> <span class="token number">7</span>
            self<span class="token punctuation">.</span>weekday_embedding <span class="token operator">=</span> nn<span class="token punctuation">.</span>Embedding<span class="token punctuation">(</span>weekday_size<span class="token punctuation">,</span> embed_dim<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>spatial_embedding <span class="token operator">=</span> LaplacianPE<span class="token punctuation">(</span>lape_dim<span class="token punctuation">,</span> embed_dim<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>dropout <span class="token operator">=</span> nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>drop<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> lap_mx<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># x shape: [16, 12, 307, 9]</span>
        origin_x <span class="token operator">=</span> x
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>value_embedding<span class="token punctuation">(</span>origin_x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span>self<span class="token punctuation">.</span>feature_dim<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># self.feature_dim = 1         # x shape: [16, 12, 307, 64] </span>
        x <span class="token operator">+=</span> self<span class="token punctuation">.</span>position_encoding<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>add_time_in_day<span class="token punctuation">:</span>
            x <span class="token operator">+=</span> self<span class="token punctuation">.</span>daytime_embedding<span class="token punctuation">(</span><span class="token punctuation">(</span>origin_x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>feature_dim<span class="token punctuation">]</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>minute_size<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">round</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">long</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>add_day_in_week<span class="token punctuation">:</span>
            x <span class="token operator">+=</span> self<span class="token punctuation">.</span>weekday_embedding<span class="token punctuation">(</span>origin_x<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>feature_dim <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span> self<span class="token punctuation">.</span>feature_dim <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">.</span>argmax<span class="token punctuation">(</span>dim<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">+=</span> self<span class="token punctuation">.</span>spatial_embedding<span class="token punctuation">(</span>lap_mx<span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>dropout<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> x
</code></pre> 
<h2><a id="LibCity_169"></a>LibCity</h2> 
<h3><a id="1_PEMS04PEMS08_170"></a>1. 数据集介绍PEMS04和PEMS08</h3> 
<h4><a id="11_PEM_171"></a>1.1 PEM数据集</h4> 
<p>这里以PEMS04说明，其他数据集也类似</p> 
<ul><li>PEMS04是2018年1月1日开始采集的连续59天的307的探测器获得的流量数据。</li><li>每5分钟采集一次</li><li>原始流量数据 data.npz 的shape 是 (307, 16992,3)</li><li>307 表示 307 个摄像头</li><li>16992 表示 59天 x 24 x 12 个数据。</li><li>3 表示数据包括 流量、速度、车道占用率。</li><li>邻接矩阵数据是一个distance.csv文件，它包含是from,to,distance的格式。</li></ul> 
<table><thead><tr><th>DataSets</th><th>Nodes</th><th>Time steps</th><th>Time range</th><th>samples(per hour)</th></tr></thead><tbody><tr><td>PEMS03</td><td>358</td><td>26208</td><td>9/1/2018 - 11/30/2018</td><td>12</td></tr><tr><td>PEMS04</td><td>307</td><td>16992</td><td>1/1/2018 - 2/28/2018</td><td>12</td></tr><tr><td>PEMS07</td><td>883</td><td>28224</td><td>5/1/2017 - 8/31/2017</td><td>12</td></tr><tr><td>PEMS08</td><td>180</td><td>17856</td><td>7/1/2016 - 8/31/2016</td><td>12</td></tr></tbody></table> 
<h3><a id="Case_Study__188"></a>Case Study 案例分析</h3> 
<p>在这一部分中，分析了PDFormer的时空编码器学到的动态时空注意力权重图，以提高其可解释性，并展示同时关注短程和长程时空依赖性的有效性。</p> 
<p>我们比较并可视化了两种情况下的注意力图，即带有或不带有两个空间掩码矩阵Mgeo和Msem。在这里，为简单起见，我们合并了GeoSAH和SemSAH的注意力图。如图5(a),(d)所示，没有掩码矩阵时，模型集中在主要的城市环路（或高速公路），交通量很大，或者注意力分布是扩散的，几乎整个城市都共享模型的关注点。然而，低交通量的地点应该关注具有相似模式的地点，而不是热门地点。此外，距离太远的地点对当前位置的影响较小。如果模型在所有位置上都模糊地聚焦，性能将会减弱。相反，当引入Mgeo和Msem时，注意力集中在周围的位置。</p> 
<blockquote> 
 <p>引入了动态注意力权重图之后，让Attention 权重 更加关注具有相似模式的区域。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/d8/d2/VJL2pOr0_o.png" alt="在这里插入图片描述"></p> 
<ul><li>a, d 是没有加的， Attention 更加关注流量大的区域(a)，或者关注整张图(d)。</li><li>加了之后，Attention 更加关注相邻区域，以及具有相同交通流量模式的区域。</li><li>图cf 的平均流量也验证了，这些节点具有相似的交通流量模式。</li></ul> 
<h3><a id="Model_Efficiency_Study_202"></a>Model Efficiency Study</h3> 
<p>由于基于注意力的模型性能更好，我们在PeMS04和NYTaxi数据集上比较了PDFormer与其他基于自注意力的基线的计算成本。表3报告了每个周期的平均训练和推理时间。我们发现，在短期和长期交通预测中，PDFormer实现了具有竞争力的计算效率。与在PeMS04上性能最佳的基线ASTGNN相比，PDFormer分别减少了超过35%和80%的训练和推理时间。GMAN和ASTGNN保留了耗时的编码器-解码器结构，这是其性能相对较低的原因。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d8035a98deb8beba1e2158a465118283/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">rabbitMq确认机制之ConfirmType</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/22480fa30c5ab9a04a3404c216b52fed/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MyBatis--03-- 一级缓存和二级缓存</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>