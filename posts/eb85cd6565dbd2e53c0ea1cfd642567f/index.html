<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>数据挖掘——决策树和K近邻 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="数据挖掘——决策树和K近邻" />
<meta property="og:description" content="决策树和K近邻 一、线性回归（房价预测）第1关：线性回归算法思想（一）相关知识1&gt;简单线性回归2&gt;多元线性回归 （二）编程要求（三）参考答案 第2关：动手实现线性回归（一）相关知识1&gt;数据集介绍2&gt;线性回归算法原理模型训练流程正规方程解 3&gt;线性回归算法流程 （二）编程要求（三）参考代码 第3关：衡量线性回归的性能指标（一）相关知识1&gt;前言2&gt;MSE3&gt;RMSE4&gt;MAE5&gt;R-Squared （二）编程要求（三）参考代码 二、决策树第1关：决策树算法思想（一）相关知识1&gt;引例2&gt;决策树的相关概念 （二）编程要求（三）参考答案 第2关：决策树算法原理（一）相关知识1&gt;信息熵2&gt;条件熵3&gt;信息增益 （二）编程要求（三）参考代码 第3关：线性回归算法思想（一）相关知识1&gt;ID3算法2&gt;使用决策树进行预测 （二）编程要求（三）参考代码 三、k-近邻第1关：knn算法概述（一）相关知识1&gt;knn算法思想2&gt;距离度量 （二）编程要求（三）参考代码 第2关：动手实现knn算法（一）相关知识1&gt;数据集介绍2&gt;加权投票3&gt;knn算法流程 （二）编程要求（三）参考代码 一、线性回归（房价预测） 第1关：线性回归算法思想 （一）相关知识 为了完成本关任务，你需要掌握：1.简单线性回归，2.多元线性回归。
1&gt;简单线性回归 在生活中，我们常常能碰到这么一种情况，一个变量会跟着另一个变量的变化而变化，如圆的周长与半径的关系，当圆的半径确定了，那么周长也就确定了。还有一种情况就是，两个变量之间看似存在某种关系，但又没那么确定，如青少年的身高与体重，他们存在一种近似的线性关系：身高/cm = 体重/kg &#43;105。
但是，并不是每个青少年都符合这个公式，只能说每个青少年的身高体重都存在这么一种近似的线性关系。这就是其实就是简单的线性回归，那么，到底什么是线性回归呢？假如我们将青少年的身高和体重值作为坐标，不同人的身高体重就会在平面上构成不同的坐标点，然后用一条直线，尽可能的去拟合这些点，这就是简单的线性回归。
简单的线性回归模型如下：
y = w x &#43; b y=wx&#43;b y=wx&#43;b 其中x表示特征值(如：体重值)，w表示权重，b表示偏置，y表示标签(如：身高值)。
2&gt;多元线性回归 简单线性回归中，一个变量跟另一个变量的变化而变化，但是生活中，还有很多变量，可能由多个变量的变化决定着它的变化，比如房价，影响它的因素可能有：房屋面积、地理位置等等。如果我们要给它们建立出近似的线性关系，这就是多元线性回归，多元线性回归模型如下：
y = b &#43; w 1 x 1 &#43; w 2 x 2 &#43; . . . &#43; w n x n y=b&#43;w1x1&#43;w2x2&#43;...&#43;wnxn y=b&#43;w1x1&#43;w2x2&#43;...&#43;wnxn 其中xi表示第i个特征值，wi表示第i个特征对应的权重，b表示偏置，y表示标签。
（二）编程要求 根据相关知识，按照要求完成选择题任务，包含单选题和多选题。
（三）参考答案 第2关：动手实现线性回归 （一）相关知识 为了完成本关任务，你需要掌握：1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/eb85cd6565dbd2e53c0ea1cfd642567f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-21T17:31:36+08:00" />
<meta property="article:modified_time" content="2022-02-21T17:31:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">数据挖掘——决策树和K近邻</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>决策树和K近邻</h4> 
 <ul><li><a href="#_1" rel="nofollow">一、线性回归（房价预测）</a></li><li><ul><li><a href="#1_2" rel="nofollow">第1关：线性回归算法思想</a></li><li><ul><li><a href="#_3" rel="nofollow">（一）相关知识</a></li><li><ul><li><a href="#1_5" rel="nofollow">1&gt;简单线性回归</a></li><li><a href="#2_14" rel="nofollow">2&gt;多元线性回归</a></li></ul> 
    </li><li><a href="#_19" rel="nofollow">（二）编程要求</a></li><li><a href="#_21" rel="nofollow">（三）参考答案</a></li></ul> 
   </li><li><a href="#2_24" rel="nofollow">第2关：动手实现线性回归</a></li><li><ul><li><a href="#_25" rel="nofollow">（一）相关知识</a></li><li><ul><li><a href="#1_27" rel="nofollow">1&gt;数据集介绍</a></li><li><a href="#2_47" rel="nofollow">2&gt;线性回归算法原理</a></li><li><ul><li><a href="#_48" rel="nofollow">模型训练流程</a></li><li><a href="#_68" rel="nofollow">正规方程解</a></li></ul> 
     </li><li><a href="#3_79" rel="nofollow">3&gt;线性回归算法流程</a></li></ul> 
    </li><li><a href="#_87" rel="nofollow">（二）编程要求</a></li><li><a href="#_89" rel="nofollow">（三）参考代码</a></li></ul> 
   </li><li><a href="#3_126" rel="nofollow">第3关：衡量线性回归的性能指标</a></li><li><ul><li><a href="#_127" rel="nofollow">（一）相关知识</a></li><li><ul><li><a href="#1_133" rel="nofollow">1&gt;前言</a></li><li><a href="#2MSE_137" rel="nofollow">2&gt;MSE</a></li><li><a href="#3RMSE_142" rel="nofollow">3&gt;RMSE</a></li><li><a href="#4MAE_149" rel="nofollow">4&gt;MAE</a></li><li><a href="#5RSquared_154" rel="nofollow">5&gt;R-Squared</a></li></ul> 
    </li><li><a href="#_165" rel="nofollow">（二）编程要求</a></li><li><a href="#_167" rel="nofollow">（三）参考代码</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_193" rel="nofollow">二、决策树</a></li><li><ul><li><a href="#1_194" rel="nofollow">第1关：决策树算法思想</a></li><li><ul><li><a href="#_195" rel="nofollow">（一）相关知识</a></li><li><ul><li><a href="#1_197" rel="nofollow">1&gt;引例</a></li><li><a href="#2_205" rel="nofollow">2&gt;决策树的相关概念</a></li></ul> 
    </li><li><a href="#_228" rel="nofollow">（二）编程要求</a></li><li><a href="#_230" rel="nofollow">（三）参考答案</a></li></ul> 
   </li><li><a href="#2_232" rel="nofollow">第2关：决策树算法原理</a></li><li><ul><li><a href="#_233" rel="nofollow">（一）相关知识</a></li><li><ul><li><a href="#1_238" rel="nofollow">1&gt;信息熵</a></li><li><a href="#2_249" rel="nofollow">2&gt;条件熵</a></li><li><a href="#3_254" rel="nofollow">3&gt;信息增益</a></li></ul> 
    </li><li><a href="#_300" rel="nofollow">（二）编程要求</a></li><li><a href="#_311" rel="nofollow">（三）参考代码</a></li></ul> 
   </li><li><a href="#3_385" rel="nofollow">第3关：线性回归算法思想</a></li><li><ul><li><a href="#_386" rel="nofollow">（一）相关知识</a></li><li><ul><li><a href="#1ID3_390" rel="nofollow">1&gt;ID3算法</a></li><li><a href="#2_413" rel="nofollow">2&gt;使用决策树进行预测</a></li></ul> 
    </li><li><a href="#_431" rel="nofollow">（二）编程要求</a></li><li><a href="#_441" rel="nofollow">（三）参考代码</a></li></ul> 
  </li></ul> 
  </li><li><a href="#k_597" rel="nofollow">三、k-近邻</a></li><li><ul><li><a href="#1knn_598" rel="nofollow">第1关：knn算法概述</a></li><li><ul><li><a href="#_599" rel="nofollow">（一）相关知识</a></li><li><ul><li><a href="#1knn_601" rel="nofollow">1&gt;knn算法思想</a></li><li><a href="#2_607" rel="nofollow">2&gt;距离度量</a></li></ul> 
    </li><li><a href="#_625" rel="nofollow">（二）编程要求</a></li><li><a href="#_627" rel="nofollow">（三）参考代码</a></li></ul> 
   </li><li><a href="#2knn_667" rel="nofollow">第2关：动手实现knn算法</a></li><li><ul><li><a href="#_668" rel="nofollow">（一）相关知识</a></li><li><ul><li><a href="#1_670" rel="nofollow">1&gt;数据集介绍</a></li><li><a href="#2_694" rel="nofollow">2&gt;加权投票</a></li><li><a href="#3knn_700" rel="nofollow">3&gt;knn算法流程</a></li></ul> 
    </li><li><a href="#_707" rel="nofollow">（二）编程要求</a></li><li><a href="#_709" rel="nofollow">（三）参考代码</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>一、线性回归（房价预测）</h2> 
<h3><a id="1_2"></a>第1关：线性回归算法思想</h3> 
<h4><a id="_3"></a>（一）相关知识</h4> 
<p>为了完成本关任务，你需要掌握：1.简单线性回归，2.多元线性回归。</p> 
<h5><a id="1_5"></a>1&gt;简单线性回归</h5> 
<p>    在生活中，我们常常能碰到这么一种情况，一个变量会跟着另一个变量的变化而变化，如圆的周长与半径的关系，当圆的半径确定了，那么周长也就确定了。还有一种情况就是，两个变量之间看似存在某种关系，但又没那么确定，如青少年的身高与体重，他们存在一种近似的<strong>线性</strong>关系：身高/cm = 体重/kg +105。</p> 
<p>    但是，并不是每个青少年都符合这个公式，只能说每个青少年的身高体重都存在这么一种近似的线性关系。这就是其实就是简单的<strong>线性回归</strong>，那么，到底什么是线性回归呢？假如我们将青少年的身高和体重值作为坐标，不同人的身高体重就会在平面上构成不同的坐标点，然后用一条直线，尽可能的去拟合这些点，这就是简单的线性回归。<br> <img src="https://images2.imgbox.com/77/96/StZ5uEmZ_o.png" alt="在这里插入图片描述"><br> 简单的线性回归模型如下：</p> 
<ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          y 
         
        
          = 
         
        
          w 
         
        
          x 
         
        
          + 
         
        
          b 
         
        
       
         y=wx+b 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;"></span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault">x</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault">b</span></span></span></span></span></li></ul> 
<p>其中x表示特征值(如：体重值)，<code>w</code>表示权重，<code>b</code>表示偏置，<code>y</code>表示标签(如：身高值)。</p> 
<h5><a id="2_14"></a>2&gt;多元线性回归</h5> 
<p>    简单线性回归中，一个变量跟另一个变量的变化而变化，但是生活中，还有很多变量，可能由多个变量的变化决定着它的变化，比如房价，影响它的因素可能有：房屋面积、地理位置等等。如果我们要给它们建立出近似的线性关系，这就是多元线性回归，多元线性回归模型如下：</p> 
<ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          y 
         
        
          = 
         
        
          b 
         
        
          + 
         
        
          w 
         
        
          1 
         
        
          x 
         
        
          1 
         
        
          + 
         
        
          w 
         
        
          2 
         
        
          x 
         
        
          2 
         
        
          + 
         
        
          . 
         
        
          . 
         
        
          . 
         
        
          + 
         
        
          w 
         
        
          n 
         
        
          x 
         
        
          n 
         
        
       
         y=b+w1x1+w2x2+...+wnxn 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.77777em; vertical-align: -0.08333em;"></span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord">1</span><span class="mord mathdefault">x</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord">2</span><span class="mord mathdefault">x</span><span class="mord">2</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault">n</span><span class="mord mathdefault">x</span><span class="mord mathdefault">n</span></span></span></span></span></li></ul> 
<p>其中<code>xi</code>表示第i个特征值，<code>wi</code>表示第i个特征对应的权重，<code>b</code>表示偏置，<code>y</code>表示标签。</p> 
<h4><a id="_19"></a>（二）编程要求</h4> 
<p>根据相关知识，按照要求完成选择题任务，包含单选题和多选题。</p> 
<h4><a id="_21"></a>（三）参考答案</h4> 
<p><img src="https://images2.imgbox.com/71/c7/SF6lvWui_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_24"></a>第2关：动手实现线性回归</h3> 
<h4><a id="_25"></a>（一）相关知识</h4> 
<p>为了完成本关任务，你需要掌握：1.线性回归算法原理，2.线性回归算法流程。</p> 
<h5><a id="1_27"></a>1&gt;数据集介绍</h5> 
<p>    波士顿房价数据集共有506条波斯顿房价的数据，每条数据包括对指定房屋的13项数值型特征和目标房价组成。我们需要通过数据特征来对目标房价进行预测。<br> 数据集中部分数据与标签如下图所示：<br> <img src="https://images2.imgbox.com/4e/ad/D41I4fSG_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ab/b5/eytKBwTY_o.png" alt="在这里插入图片描述"><br> <code>sklearn</code>中已经提供了波士顿房价数据集的相关接口，想要使用该数据集可以使用如下代码：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn <span class="token keyword">import</span> datasets
<span class="token comment">#加载波斯顿房价数据集</span>
boston <span class="token operator">=</span> datasets<span class="token punctuation">.</span>load_boston<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#X表示特征，y表示目标房价</span>
x <span class="token operator">=</span> boston<span class="token punctuation">.</span>data
y <span class="token operator">=</span> boston<span class="token punctuation">.</span>target
</code></pre> 
<p>然后再对数据集进行划分：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token comment">#划分训练集测试集，所有样本的20%作为测试集</span>
train_feature<span class="token punctuation">,</span>test_feature<span class="token punctuation">,</span>train_label<span class="token punctuation">,</span>test_label <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">666</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="2_47"></a>2&gt;线性回归算法原理</h5> 
<h6><a id="_48"></a>模型训练流程</h6> 
<p>由数据集可以知道，每一个样本有13个特征与目标房价，而我们要做的事就是通过这13个特征来预测房价，我们可以构建一个多元线性回归模型，来对房价进行预测。模型如下：</p> 
<ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          y 
         
        
          = 
         
        
          b 
         
        
          + 
         
        
          w 
         
        
          1 
         
        
          x 
         
        
          1 
         
        
          + 
         
        
          w 
         
        
          2 
         
        
          x 
         
        
          2 
         
        
          + 
         
        
          . 
         
        
          . 
         
        
          . 
         
        
          + 
         
        
          w 
         
        
          n 
         
        
          x 
         
        
          n 
         
        
       
         y=b+w1x1+w2x2+...+wnxn 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.77777em; vertical-align: -0.08333em;"></span><span class="mord mathdefault">b</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord">1</span><span class="mord mathdefault">x</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord">2</span><span class="mord mathdefault">x</span><span class="mord">2</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault">n</span><span class="mord mathdefault">x</span><span class="mord mathdefault">n</span></span></span></span></span></li></ul> 
<p>其中<code>xi</code>表示第i个特征值，<code>wi</code>​表示第i个特征对应的权重，<code>b</code>表示偏置，<code>y</code>表示目标房价。<br> 为了方便，我们稍微将模型进行变换:</p> 
<ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          y 
         
        
          = 
         
        
          w 
         
        
          0 
         
        
          x 
         
        
          0 
         
        
          + 
         
        
          w 
         
        
          1 
         
        
          x 
         
        
          1 
         
        
          + 
         
        
          w 
         
        
          2 
         
        
          x 
         
        
          2 
         
        
          + 
         
        
          . 
         
        
          . 
         
        
          . 
         
        
          + 
         
        
          w 
         
        
          n 
         
        
          x 
         
        
          n 
         
        
       
         y=w0x0+w1x1+w2x2+...+wnxn 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord">0</span><span class="mord mathdefault">x</span><span class="mord">0</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord">1</span><span class="mord mathdefault">x</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord">2</span><span class="mord mathdefault">x</span><span class="mord">2</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.66666em; vertical-align: -0.08333em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault">n</span><span class="mord mathdefault">x</span><span class="mord mathdefault">n</span></span></span></span></span></li></ul> 
<p>其中<code>x0=1</code>。</p> 
<ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          Y 
         
        
          = 
         
        
          θ 
         
        
          . 
         
        
          X 
         
        
       
         Y=θ.X 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.22222em;">Y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.02778em;">θ</span><span class="mord">.</span><span class="mord mathdefault" style="margin-right: 0.07847em;">X</span></span></span></span></span></li><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          θ 
         
        
          = 
         
        
          ( 
         
        
          w 
         
        
          0 
         
        
          , 
         
        
          w 
         
        
          1 
         
        
          , 
         
        
          . 
         
        
          . 
         
        
          . 
         
        
          , 
         
        
          w 
         
        
          n 
         
        
          ) 
         
        
       
         θ=(w0,w1,...,wn) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.02778em;">θ</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span></span></li><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          X 
         
        
          = 
         
        
          ( 
         
        
          1 
         
        
          , 
         
        
          x 
         
        
          1 
         
        
          , 
         
        
          . 
         
        
          . 
         
        
          . 
         
        
          , 
         
        
          x 
         
        
          n 
         
        
          ) 
         
        
       
         X=(1,x1,...,xn) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.07847em;">X</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">x</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">x</span><span class="mord mathdefault">n</span><span class="mclose">)</span></span></span></span></span></li></ul> 
<p>而我们的目的就是<mark>找出能够正确预测的多元线性回归模型，即找出正确的参数θ</mark>。那么如何寻找呢？通常在监督学习里面都会使用这么一个套路，<mark>构造一个损失函数，用来衡量真实值与预测值之间的差异，然后将问题转化为最优化损失函数</mark>。既然损失函数是用来衡量真实值与预测值之间的差异那么很多人自然而然的想到了用所有真实值与预测值的差的绝对值来表示损失函数。不过带绝对值的函数不容易求导，所以采用<code>MSE(均方误差)</code>作为损失函数，公式如下：</p> 
<ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          l 
         
        
          o 
         
        
          s 
         
        
          s 
         
        
          = 
         
         
          
          
            1 
           
          
            m 
           
          
         
         
          
          
            ∑ 
           
           
           
             i 
            
           
             = 
            
           
             1 
            
           
          
            n 
           
          
         
           ( 
          
          
          
            y 
           
          
            i 
           
          
         
           − 
          
          
          
            p 
           
          
            i 
           
          
          
          
            ) 
           
          
            2 
           
          
         
        
       
         loss=\dfrac{1}{m}\displaystyle\sum_{i=1}^n(y^i-p^i)^2 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">s</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.92907em; vertical-align: -1.27767em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">m</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.874664em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.12466em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.874664em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></li></ul> 
<p>其中<code>p</code>表示预测值，<code>y</code>表示真实值，<code>m</code>为样本总个数，<code>i</code>表示第i个样本。最后，我们再使用<strong>正规方程解</strong>来求得我们所需要的参数。</p> 
<p>线性回归模型训练流程图如下：<br> <img src="https://images2.imgbox.com/02/a3/XZ9eo2oQ_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="_68"></a>正规方程解</h6> 
<p>对线性回归模型，假设训练集中m个训练样本，每个训练样本中有n个特征，可以使用矩阵的表示方法，预测函数可以写为：</p> 
<ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          Y 
         
        
          = 
         
        
          θ 
         
        
          X 
         
        
       
         Y=\theta X 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.68333em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.22222em;">Y</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.02778em;">θ</span><span class="mord mathdefault" style="margin-right: 0.07847em;">X</span></span></span></span></span></li></ul> 
<p>其损失函数可以表示为</p> 
<ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          ( 
         
        
          Y 
         
        
          − 
         
        
          θ 
         
        
          X 
         
         
         
           ) 
          
         
           T 
          
         
        
          ( 
         
        
          Y 
         
        
          − 
         
        
          θ 
         
        
          X 
         
        
          ) 
         
        
       
         (Y-\theta X)^T(Y-\theta X) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.22222em;">Y</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.09133em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.02778em;">θ</span><span class="mord mathdefault" style="margin-right: 0.07847em;">X</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.841331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.22222em;">Y</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.02778em;">θ</span><span class="mord mathdefault" style="margin-right: 0.07847em;">X</span><span class="mclose">)</span></span></span></span></span></li></ul> 
<p>其中，标签Y为<code>mx1</code>的矩阵，训练特征X为<code>mx(n+1)</code>的矩阵，回归系数<code>θ</code>为<code>(n+1)x1</code>的矩阵，对θ求导，并令其导数等于0，可以得到<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          X 
         
        
          T 
         
        
       
         ( 
        
       
         Y 
        
       
         − 
        
       
         θ 
        
       
         X 
        
       
         ) 
        
       
         = 
        
       
         0 
        
       
      
        X^T(Y−\theta X)=0 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.09133em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.841331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.22222em;">Y</span><span class="mord">−</span><span class="mord mathdefault" style="margin-right: 0.02778em;">θ</span><span class="mord mathdefault" style="margin-right: 0.07847em;">X</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">0</span></span></span></span></span>。所以，最优解为:</p> 
<ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          θ 
         
        
          = 
         
        
          ( 
         
         
         
           X 
          
         
           T 
          
         
        
          X 
         
         
         
           ) 
          
          
          
            − 
           
          
            1 
           
          
         
         
         
           X 
          
         
           T 
          
         
        
          Y 
         
        
       
         \theta=(X^TX)^{-1}X^TY 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.02778em;">θ</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.09133em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.841331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right: 0.07847em;">X</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.07847em;">X</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.841331em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord mathdefault" style="margin-right: 0.22222em;">Y</span></span></span></span></span></li></ul> 
<p>这个就是正规方程解，我们可以通过最优方程解直接求得我们所需要的参数。</p> 
<h5><a id="3_79"></a>3&gt;线性回归算法流程</h5> 
<p>我们最终的目的是通过训练出来的线性回归模型对测试集数据进行预测，算法实现流程如下：</p> 
<pre><code>1.将x0=1加入训练数据
2.使用正规方程解求得参数
3.将x0=1加入测试数据
4.对测试集数据进行预测
</code></pre> 
<h4><a id="_87"></a>（二）编程要求</h4> 
<p>根据提示，在编辑器<code>Begin-End</code>处补充<code>Python</code>代码，实现线性回归算法与<code>MSE</code>损失函数计算方法，并利用房价数据对模型进行训练，然后对未知的房价数据进行预测。只需返回预测结果即可，程序内部会检测您的代码，<code>MSE</code>低于30则视为过关。</p> 
<h4><a id="_89"></a>（三）参考代码</h4> 
<pre><code class="prism language-python"><span class="token comment"># encoding=utf8</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token comment"># mse</span>


<span class="token keyword">def</span> <span class="token function">mse_score</span><span class="token punctuation">(</span>y_predict<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#********* Begin *********#</span>
    mse <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">(</span>y_predict<span class="token operator">-</span>y_test<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token comment">#********* End *********#</span>
    <span class="token keyword">return</span> mse


<span class="token keyword">def</span> <span class="token function">lr</span><span class="token punctuation">(</span>train_feature<span class="token punctuation">,</span> train_label<span class="token punctuation">,</span> test_feature<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    input:
        train_feature(ndarray):训练样本特征
        train_label(ndarray):训练样本标签
        test_feature(ndarray):测试样本特征
    output:
        predict(ndarray):测试样本预测标签
    '''</span>
    <span class="token comment">#********* Begin *********#</span>
    <span class="token comment"># 将x0=1加入训练数据</span>
    x <span class="token operator">=</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>train_feature<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> train_feature<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># 使用正规方程解求得参数</span>
    theta <span class="token operator">=</span> np<span class="token punctuation">.</span>linalg<span class="token punctuation">.</span>inv<span class="token punctuation">(</span>x<span class="token punctuation">.</span>T@x<span class="token punctuation">)</span>@x<span class="token punctuation">.</span>T@train_label
    <span class="token comment"># 将x0=1加入测试数据</span>
    y <span class="token operator">=</span> np<span class="token punctuation">.</span>hstack<span class="token punctuation">(</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>test_feature<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> test_feature<span class="token punctuation">]</span><span class="token punctuation">)</span>
    predict <span class="token operator">=</span> y@theta
    <span class="token comment"># 求得测试集预测标签</span>
    <span class="token comment">#********* End *********#</span>
    <span class="token keyword">return</span> predict

</code></pre> 
<h3><a id="3_126"></a>第3关：衡量线性回归的性能指标</h3> 
<h4><a id="_127"></a>（一）相关知识</h4> 
<p>为了完成本关任务，你需要掌握：<br> <mark>1.均方误差(MSE)<br> 2.均方根误差(RMSE)<br> 3.平均绝对误差(MAE)<br> 4.R-Squared</mark></p> 
<h5><a id="1_133"></a>1&gt;前言</h5> 
<p>大家知道已经，机器学习通常都是将训练集上的数据对模型进行训练，然后再将测试集上的数据给训练好的模型进行预测，最后根据模型性能的好坏选择模型，对于分类问题，大家很容易想到，可以使用正确率来评估模型的性能，那么回归问题可以使用哪些指标用来评估呢？<br> <img src="https://images2.imgbox.com/79/cf/Ynnnp7Ls_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2MSE_137"></a>2&gt;MSE</h5> 
<p><code>MSE （Mean Squared Error）</code>叫做均方误差,公式如下：</p> 
<ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
          
            1 
           
          
            m 
           
          
         
         
          
          
            ∑ 
           
           
           
             i 
            
           
             = 
            
           
             1 
            
           
          
            m 
           
          
         
           ( 
          
          
          
            y 
           
          
            i 
           
          
         
           − 
          
          
          
            p 
           
          
            i 
           
          
          
          
            ) 
           
          
            2 
           
          
         
        
       
         \dfrac{1}{m}\displaystyle\sum_{i=1}^m(y^i-p^i)^2 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 2.92907em; vertical-align: -1.27767em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">m</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.874664em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.12466em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.874664em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span></span></li></ul> 
<p><mark>其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           y 
          
         
           i 
          
         
        
       
         y^i 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0191em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.824664em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span></span></span></span></span>表示第i个样本的真实标签，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           p 
          
         
           i 
          
         
        
       
         p^i 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0191em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.824664em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span></span></span></span></span>表示模型对第i个样本的预测标签。线性回归的目的就是让损失函数最小</mark>。那么模型训练出来了，我们在测试集上用损失函数来评估模型就行了。</p> 
<h5><a id="3RMSE_142"></a>3&gt;RMSE</h5> 
<p><code>RMSE（Root Mean Squard Error）</code>均方根误差，公式如下：</p> 
<ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
           
            
            
              1 
             
            
              m 
             
            
           
           
            
            
              ∑ 
             
             
             
               i 
              
             
               = 
              
             
               1 
              
             
            
              m 
             
            
           
             ( 
            
            
            
              y 
             
            
              i 
             
            
           
             − 
            
            
            
              p 
             
            
              i 
             
            
            
            
              ) 
             
            
              2 
             
            
           
          
         
        
       
         \sqrt{\dfrac{1}{m}\displaystyle\sum_{i=1}^m(y^i-p^i)^2} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 3.05907em; vertical-align: -1.27767em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.7814em;"><span class="svg-align" style="top: -5.01907em;"><span class="pstrut" style="height: 5.01907em;"></span><span class="mord" style="padding-left: 1.056em;"><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">m</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.874664em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.874664em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.7414em;"><span class="pstrut" style="height: 5.01907em;"></span><span class="hide-tail" style="min-width: 0.742em; height: 3.09907em;"> 
            <svg width="400em" height="3.099066em" viewbox="0 0 400000 3099" preserveaspectratio="xMinYMin slice"> 
             <path d="M702 80H400000v40H742v2965l-4 4-4 4c-.667.7
-2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1h-12l-28-84c-16.667-52-96.667
-294.333-240-727l-212 -643 -85 170c-4-3.333-8.333-7.667-13 -13l-13-13l77-155
 77-156c66 199.333 139 419.667 219 661 l218 661zM702 80H400000v40H742z"></path> 
            </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span></span></span></span></span></li></ul> 
<p><code>RMSE</code>其实就是<code>MSE</code>开个根号。有什么意义呢？其实实质是一样的。只不过用于数据更好的描述。</p> 
<p>例如：要做房价预测，每平方是万元，我们预测结果也是万元。那么差值的平方单位应该是千万级别的。那我们不太好描述自己做的模型效果。怎么说呢？我们的模型误差是多少千万？于是干脆就开个根号就好了。我们误差的结果就跟我们数据是一个级别的了，在描述模型的时候就说，我们模型的误差是多少万元。</p> 
<h5><a id="4MAE_149"></a>4&gt;MAE</h5> 
<p><code>MAE(平均绝对误差)</code>，公式如下：</p> 
<ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
          
            1 
           
          
            m 
           
          
         
         
          
          
            ∑ 
           
           
           
             i 
            
           
             = 
            
           
             1 
            
           
          
            m 
           
          
         
           ∣ 
          
          
          
            y 
           
          
            i 
           
          
         
           − 
          
          
          
            p 
           
          
            i 
           
          
         
           ∣ 
          
         
        
       
         \dfrac{1}{m}\displaystyle\sum_{i=1}^m|y^i-p^i| 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 2.92907em; vertical-align: -1.27767em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.32144em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathdefault">m</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">m</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.874664em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.12466em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.874664em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mord">∣</span></span></span></span></span></li></ul> 
<p><code>MAE</code>虽然不作为损失函数，确是一个非常直观的评估指标，它表示每个样本的预测标签值与真实标签值的<code>L1</code>距离。</p> 
<h5><a id="5RSquared_154"></a>5&gt;R-Squared</h5> 
<p>上面的几种衡量标准针对不同的模型会有不同的值。比如说预测房价 那么误差单位就是万元。数子可能是3，4，5之类的。那么预测身高就可能是0.1，0.6之类的。没有什么可读性，到底多少才算好呢？不知道，那要根据模型的应用场景来。 看看分类算法的衡量标准就是正确率，而正确率又在0～1之间，最高百分之百。最低0。那么线性回归有没有这样的衡量标准呢？<br> <code>R-Squared</code>就是这么一个指标，公式如下：</p> 
<ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           R 
          
         
           2 
          
         
        
          = 
         
        
          1 
         
        
          − 
         
         
          
           
            
            
              ∑ 
             
            
              i 
             
            
           
             ( 
            
            
            
              p 
             
            
              i 
             
            
           
             − 
            
            
            
              y 
             
            
              i 
             
            
            
            
              ) 
             
            
              2 
             
            
           
           
            
            
              ∑ 
             
            
              i 
             
            
           
             ( 
            
            
            
              y 
             
             
             
               m 
              
             
               e 
              
             
               a 
              
             
               n 
              
             
               s 
              
             
            
              i 
             
            
           
             − 
            
            
            
              y 
             
            
              i 
             
            
            
            
              ) 
             
            
              2 
             
            
           
          
         
        
       
         R^2=1-\dfrac{\displaystyle\sum_{i}(p^i-y^i)^2}{\displaystyle\sum_{i}(y_{means}^i-y^i)^2} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.814108em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord">1</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 4.93535em; vertical-align: -2.21767em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.71767em;"><span class="" style="top: -2.11em;"><span class="pstrut" style="height: 3.05001em;"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.874664em;"><span class="" style="top: -2.453em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">s</span></span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.874664em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.28001em;"><span class="pstrut" style="height: 3.05001em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -4.71767em;"><span class="pstrut" style="height: 3.05001em;"></span><span class="mord"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05001em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.874664em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.874664em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.21767em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></li></ul> 
<p><mark>其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           y 
          
          
          
            m 
           
          
            e 
           
          
            a 
           
          
            n 
           
          
            s 
           
          
         
        
       
         y_{means} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">m</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">a</span><span class="mord mathdefault mtight">n</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>表示所有测试样本标签值的均值</mark>。为什么这个指标会有刚刚我们提到的性能呢？我们分析下公式：<br> <img src="https://images2.imgbox.com/57/1e/iawtumUO_o.png" alt="在这里插入图片描述"><br> <mark>其实分子表示的是模型预测时产生的误差，分母表示的是对任意样本都预测为所有标签均值时产生的误差</mark>，由此可知：</p> 
<ol><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           R 
          
         
           2 
          
         
        
          ≤ 
         
        
          1 
         
        
       
         R^2≤1 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.950078em; vertical-align: -0.13597em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.00773em;">R</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span></span></span></span></span>,当我们的模型不犯任何错误时，取最大值1。</li><li>当我们的模型性能跟基模型性能相同时，取0。</li><li>如果为负数，则说明我们训练出来的模型还不如基准模型，此时，很有可能我们的数据不存在任何线性关系。<em>ps:(基准模型指的随机瞎猜。)</em></li></ol> 
<h4><a id="_165"></a>（二）编程要求</h4> 
<p>根据提示，在编辑器<code>Begin-End</code>处补充代码，用<code>Python</code>实现<code>R-Squared</code>指标，并用实现的<code>R-Squared</code>指标来评估上一关的线性回归模型。只需返回预测结果即可，程序内部会检测您的代码，<code>R-Squared</code>指标高于0.6视为过关。</p> 
<h4><a id="_167"></a>（三）参考代码</h4> 
<pre><code class="prism language-python"><span class="token comment"># encoding=utf8</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token comment"># mse</span>


<span class="token keyword">def</span> <span class="token function">mse_score</span><span class="token punctuation">(</span>y_predict<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span><span class="token punctuation">:</span>
    mse <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">(</span>y_predict<span class="token operator">-</span>y_test<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> mse


<span class="token comment"># r2</span>
<span class="token keyword">def</span> <span class="token function">r2_score</span><span class="token punctuation">(</span>y_predict<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    input:y_predict(ndarray):预测值
          y_test(ndarray):真实值
    output:r2(float):r2值
    '''</span>
    <span class="token comment">#********* Begin *********#</span>
    r2 <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">-</span>mse_score<span class="token punctuation">(</span>y_predict<span class="token punctuation">,</span> y_test<span class="token punctuation">)</span><span class="token operator">/</span>np<span class="token punctuation">.</span>var<span class="token punctuation">(</span>y_test<span class="token punctuation">)</span>
    <span class="token comment">#********* End *********#</span>
    <span class="token keyword">return</span> r2

</code></pre> 
<h2><a id="_193"></a>二、决策树</h2> 
<h3><a id="1_194"></a>第1关：决策树算法思想</h3> 
<h4><a id="_195"></a>（一）相关知识</h4> 
<p>为了完成本关任务，你需要掌握决策树的相关基础知识。</p> 
<h5><a id="1_197"></a>1&gt;引例</h5> 
<p>在炎热的夏天，没有什么比冰镇后的西瓜更能令人感到心旷神怡的了。现在我要去水果店买西瓜，但什么样的西瓜能入我法眼呢？那根据我的个人习惯，在挑西瓜时可能就有这样的脑回路。<br> <img src="https://images2.imgbox.com/18/cf/6PDYidgo_o.png" alt="在这里插入图片描述"><br> 假设现在水果店里有3个西瓜，它们的属性如下：<br> <img src="https://images2.imgbox.com/62/52/M7D7QcFG_o.png" alt="在这里插入图片描述"><br> 那么根据我的脑回路我会买1和2号西瓜。</p> 
<p>其实我的脑回路可以看成一棵树，并且这颗树能够帮助我对买不买西瓜这件事做决策，所以它就是一棵<strong>决策树</strong>。</p> 
<h5><a id="2_205"></a>2&gt;决策树的相关概念</h5> 
<p>决策树是一种可以用于分类与回归的机器学习算法，但主要用于分类。用于分类的决策树是一种描述对实例进行分类的树形结构。决策树由<strong>结点和边</strong>组成，其中结点分为<strong>内部结点</strong>和<strong>叶子结点</strong>，<strong>内部结点表示一个特征或者属性，叶子结点表示标签（脑回路图中黄色的是内部结点，蓝色的是叶子结点）</strong>。<br> 从代码角度来看，决策树其实可以看成是一堆<code>if-else</code>语句的集合，例如引例中的决策树完全可以看成是如下代码：</p> 
<pre><code class="prism language-python"><span class="token keyword">if</span> isRed<span class="token punctuation">:</span>
    <span class="token keyword">if</span> isCold<span class="token punctuation">:</span>
        <span class="token keyword">if</span> hasSeed<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"buy"</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"don't buy"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> isCheap<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"buy"</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"don't buy"</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"don't buy"</span><span class="token punctuation">)</span>
</code></pre> 
<p>因此决策树的一个非常大的优势就是模型的可理解性非常高，甚至可以用来挖掘数据中比较重要的信息。</p> 
<p>那么如何构造出一棵好的决策树呢？其实构造决策树时会遵循一个指标，有的是按照信息增益来构建，如<strong>ID3算法</strong>；有的是信息增益率来构建，如<strong>C4.5算法</strong>；有的是按照基尼系数来构建的，如<strong>CART算法</strong>。但不管是使用哪种构建算法，决策树的构建过程通常都是一个递归选择最优特征，并根据特征对训练集进行分割，使得对各个子数据集有一个最好的分类的过程。</p> 
<p>这一过程对应着对特征空间的划分，也对应着决策树的构建。一开始，构建决策树的根结点，将所有训练数据都放在根结点。选择一个最优特征，并按照这一特征将训练数据集分割成子集，使得各个子集有一个在当前条件下最好的分类。如果这些子集已经能够被基本正确分类，那么构建叶子结点，并将这些子集分到所对应的叶结点中去；如果还有子集不能被基本正确分类，那么就对这些子集选择新的最优特征，继续对其进行分割，并构建相应的结点。如此递归进行下去，直至所有训练数据子集被基本正确分类，或者没有合适的特征为止。最后每个子集都被分到叶子结点上，即都有了明确的类别。这就构建出了一棵决策树。</p> 
<h4><a id="_228"></a>（二）编程要求</h4> 
<p>根据相关知识，按照要求完成选择题任务，包含单选题和多选题。</p> 
<h4><a id="_230"></a>（三）参考答案</h4> 
<p><img src="https://images2.imgbox.com/b5/84/t4AcL6cX_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_232"></a>第2关：决策树算法原理</h3> 
<h4><a id="_233"></a>（一）相关知识</h4> 
<p>为了完成本关任务，你需要掌握：</p> 
<ul><li>信息熵</li><li>条件熵</li><li>信息增益</li></ul> 
<h5><a id="1_238"></a>1&gt;信息熵</h5> 
<p>信息是个很抽象的概念。人们常常说信息很多，或者信息较少，但却很难说清楚信息到底有多少。比如一本五十万字的中文书到底有多少信息量。</p> 
<p>直到1948年，<strong>香农提出了“信息熵”的概念</strong>，才解决了对信息的量化度量问题。信息熵这个词是香农从热力学中借用过来的。热力学中的热熵是表示分子状态混乱程度的物理量。香农用信息熵的概念来<strong>描述信源的不确定度。信源的不确定性越大，信息熵也越大</strong>。<br> 从机器学习的角度来看，信息熵表示的是信息量的期望值。如果数据集中的数据需要被分成多个类别，则信息量<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         I 
        
       
         ( 
        
        
        
          x 
         
        
          i 
         
        
       
         ) 
        
       
      
        I(x_i) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.07847em;">I</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>的定义如下(<mark>其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           x 
          
         
           i 
          
         
        
       
         x_i 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>表示多个类别中的第<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          i 
         
        
       
         i 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.65952em; vertical-align: 0em;"></span><span class="mord mathdefault">i</span></span></span></span></span>个类别，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          p 
         
        
          ( 
         
         
         
           x 
          
         
           i 
          
         
        
          ) 
         
        
       
         p(x_i) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span>数据集中类别为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           x 
          
         
           i 
          
         
        
       
         x_i 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>的数据在数据集中出现的概率表示</mark>)：</p> 
<ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          I 
         
        
          ( 
         
         
         
           x 
          
         
           i 
          
         
        
          ) 
         
        
          = 
         
        
          − 
         
        
          l 
         
        
          o 
         
         
         
           g 
          
         
           2 
          
         
        
          p 
         
        
          ( 
         
         
         
           x 
          
         
           i 
          
         
        
          ) 
         
        
       
         I(x_i)=-log_2p(x_i) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.07847em;">I</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">−</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></li></ul> 
<p>由于信息熵是信息量的期望值，所以信息熵<code>H(X)</code>的定义如下(其中n为数据集中类别的数量)：</p> 
<ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          H 
         
        
          ( 
         
        
          X 
         
        
          ) 
         
        
          = 
         
        
          − 
         
         
          
          
            ∑ 
           
           
           
             i 
            
           
             = 
            
           
             1 
            
           
          
            n 
           
          
         
           p 
          
         
           ( 
          
          
          
            x 
           
          
            i 
           
          
         
           ) 
          
         
           l 
          
         
           o 
          
          
          
            g 
           
          
            2 
           
          
         
           p 
          
         
           ( 
          
          
          
            x 
           
          
            i 
           
          
         
           ) 
          
         
        
       
         H(X)=-\displaystyle\sum_{i=1}^np(x_i)log_2p(x_i) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.08125em;">H</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.07847em;">X</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.92907em; vertical-align: -1.27767em;"></span><span class="mord">−</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">o</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></li></ul> 
<p>从这个公式也可以看出，如果概率是0或者是1的时候，熵就是0。（因为这种情况下随机变量的不确定性是最低的），那如果概率是0.5也就是五五开的时候，此时熵达到最大，也就是1。（就像扔硬币，你永远都猜不透你下次扔到的是正面还是反面，所以它的不确定性非常高）。所以呢，<strong>熵越大，不确定性就越高。</strong></p> 
<h5><a id="2_249"></a>2&gt;条件熵</h5> 
<p>在实际的场景中，我们可能需要研究数据集中某个特征等于某个值时的信息熵等于多少，这个时候就需要用到条件熵。<mark>条件熵<code>H(Y|X)</code>表示特征X为某个值的条件下，类别为Y的熵</mark>。条件熵的计算公式如下：</p> 
<ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          H 
         
        
          ( 
         
        
          Y 
         
        
          ∣ 
         
        
          X 
         
        
          ) 
         
        
          = 
         
         
          
          
            ∑ 
           
           
           
             i 
            
           
             = 
            
           
             1 
            
           
          
            n 
           
          
         
           p 
          
         
           ( 
          
          
          
            x 
           
          
            i 
           
          
         
           ) 
          
         
           H 
          
         
           ( 
          
         
           Y 
          
         
           ∣ 
          
         
           X 
          
         
           = 
          
          
          
            x 
           
          
            i 
           
          
         
           ) 
          
         
        
       
         H(Y|X)=\displaystyle\sum_{i=1}^np(x_i)H(Y|X=x_i) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.08125em;">H</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.22222em;">Y</span><span class="mord">∣</span><span class="mord mathdefault" style="margin-right: 0.07847em;">X</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.92907em; vertical-align: -1.27767em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mord mathdefault" style="margin-right: 0.08125em;">H</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.22222em;">Y</span><span class="mord">∣</span><span class="mord mathdefault" style="margin-right: 0.07847em;">X</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.311664em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></li></ul> 
<p>当然条件熵的一个性质也熵的性质一样，<strong>概率越确定，条件熵就越小，概率越五五开，条件熵就越大</strong>。</p> 
<h5><a id="3_254"></a>3&gt;信息增益</h5> 
<p>现在已经知道了什么是熵，什么是条件熵。接下来就可以看看什么是信息增益了。所谓的信息增益就是表示我已知条件X后能得到信息Y的不确定性的减少程度。</p> 
<p>就好比，我在玩读心术。你心里想一件东西，我来猜。我已开始什么都没问你，我要猜的话，肯定是瞎猜。这个时候我的熵就非常高。然后我接下来我会去试着问你是非题，当我问了是非题之后，我就能减小猜测你心中想到的东西的范围，这样其实就是减小了我的熵。那么我熵的减小程度就是我的信息增益。</p> 
<p>所以信息增益如果套上机器学习的话就是，如果把特征A对训练集D的信息增益记为<code>g(D, A)</code>的话，那么<code>g(D, A)</code>的计算公式就是：</p> 
<ul><li><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          g 
         
        
          ( 
         
        
          D 
         
        
          , 
         
        
          A 
         
        
          ) 
         
        
          = 
         
        
          H 
         
        
          ( 
         
        
          D 
         
        
          ) 
         
        
          − 
         
        
          H 
         
        
          ( 
         
        
          D 
         
        
          , 
         
        
          A 
         
        
          ) 
         
        
       
         g(D,A)=H(D)-H(D,A) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">g</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.02778em;">D</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">A</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.08125em;">H</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.02778em;">D</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.08125em;">H</span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.02778em;">D</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord mathdefault">A</span><span class="mclose">)</span></span></span></span></span></li></ul> 
<p>为了更好的解释熵，条件熵，信息增益的计算过程，下面通过示例来描述。<mark>假设我现在有这一个数据集，第一列是编号，第二列是性别，第三列是活跃度，第四列是客户是否流失的标签（0:表示未流失，1:表示流失）</mark>。<br> <img src="https://images2.imgbox.com/25/48/HXB4VyAG_o.png" alt="在这里插入图片描述"><br> 假如要算性别和活跃度这两个特征的信息增益的话，首先要先算总的熵和条件熵。总的熵其实非常好算，就是把标签作为随机变量X。上表中标签只有两种（0和1）因此随机变量X的取值只有0或者1。所以要计算熵就需要先分别计算标签为0的概率和标签为1的概率。从表中能看出标签为0的数据有10条，所以标签为0的概率等于2/3。标签为1的概率为1/3。所以熵为：</p> 
<ul><li>−(1/3)∗log(1/3)−(2/3)∗log(2/3)=0.9182</li></ul> 
<p>接下来就是条件熵的计算，以性别为男的熵为例。表格中性别为男的数据有8条，这8条数据中有3条数据的标签为1，有5条数据的标签为0。所以根据条件熵的计算公式能够得出该条件熵为：</p> 
<ul><li>−(3/8)∗log(3/8)−(5/8)∗log(5/8)=0.9543</li></ul> 
<p>根据上述的计算方法可知，总熵为：</p> 
<ul><li>−(5/15)∗log(5/15)−(10/15)∗log(10/15)=0.9182</li></ul> 
<p>性别为男的熵为：</p> 
<ul><li>−(3/8)∗log(3/8)−(5/8)∗log(5/8)=0.9543</li></ul> 
<p>性别为女的熵为：</p> 
<ul><li>−(2/7)∗log(2/7)−(5/7)∗log(5/7)=0.8631</li></ul> 
<p>活跃度为低的熵为：</p> 
<ul><li>−(4/4)∗log(4/4)−0=0</li></ul> 
<p>活跃度为中的熵为：</p> 
<ul><li>−(1/5)∗log(1/5)−(4/5)∗log(4/5)=0.7219</li></ul> 
<p>活跃度为高的熵为：</p> 
<ul><li>−0−(6/6)∗log(6/6)=0</li></ul> 
<p>现在有了总的熵和条件熵之后就能算出性别和活跃度这两个特征的信息增益了。<br> **性别的信息增益=总的熵-(8/15)<em>性别为男的熵-(7/15)<em>性别为女的熵=0.0064</em></em><br> <em>活跃度的信息增益=总的熵-(6/15)活跃度为高的熵-(5/15)</em><br> 活跃度为中的熵-(4/15)*活跃度为低的熵=0.6776</p> 
<p>那信息增益算出来之后有什么意义呢？回到读心术的问题，为了我能更加准确的猜出你心中所想，我肯定是问的问题越好就能猜得越准！换句话来说我肯定是要想出一个信息增益最大（<strong>减少不确定性程度最高</strong>）的问题来问你。其实<code>ID3</code>算法也是这么想的。<code>ID3</code>算法的思想是从训练集D中计算每个特征的信息增益，然后看哪个最大就选哪个作为当前结点。然后继续重复刚刚的步骤来构建决策树。</p> 
<h4><a id="_300"></a>（二）编程要求</h4> 
<p>根据提示，在右侧编辑器<code>Begin-End</code>处补充代码，完成<code>calcInfoGain</code>函数实现计算信息增益。<br> <code>calcInfoGain</code>函数中的参数:</p> 
<ul><li>feature：测试用例中字典里的feature，类型为ndarray</li><li>label：测试用例中字典里的label，类型为ndarray</li><li>index：测试用例中字典里的index，即feature部分特征列的索引。该索引指的是feature中第几个特征，如index:0表示使用第一个特征来计算信息增益。</li></ul> 
<p><mark>提示：<br> 计算log可以使用NumPy中的log2函数</mark></p> 
<h4><a id="_311"></a>（三）参考代码</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np


<span class="token keyword">def</span> <span class="token function">calcInfoGain</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    计算信息增益
    :param feature:测试用例中字典里的feature，类型为ndarray
    :param label:测试用例中字典里的label，类型为ndarray
    :param index:测试用例中字典里的index，即feature部分特征列的索引。该索引指的是feature中第几个特征，如index:0表示使用第一个特征来计算信息增益。
    :return:信息增益，类型float
    '''</span>

    <span class="token comment">#*********** Begin ***********#</span>

    <span class="token comment"># 计算熵</span>
    <span class="token keyword">def</span> <span class="token function">calcInfoEntropy</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        计算信息熵
        :param feature:数据集中的特征，类型为ndarray
        :param label:数据集中的标签，类型为ndarray
        :return:信息熵，类型float
        '''</span>

        label_set <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span>
        result <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> l <span class="token keyword">in</span> label_set<span class="token punctuation">:</span>
            count <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> label<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> l<span class="token punctuation">:</span>
                    count <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token comment"># 计算标签在数据集中出现的概率</span>
            p <span class="token operator">=</span> count <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span>
            <span class="token comment"># 计算熵</span>
            result <span class="token operator">-=</span> p <span class="token operator">*</span> np<span class="token punctuation">.</span>log2<span class="token punctuation">(</span>p<span class="token punctuation">)</span>
        <span class="token keyword">return</span> result

    <span class="token comment"># 计算条件熵</span>
    <span class="token keyword">def</span> <span class="token function">calcHDA</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> index<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        计算信息熵
        :param feature:数据集中的特征，类型为ndarray
        :param label:数据集中的标签，类型为ndarray
        :param index:需要使用的特征列索引，类型为int
        :param value:index所表示的特征列中需要考察的特征值，类型为int
        :return:信息熵，类型float
        '''</span>
        count <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token comment"># sub_feature和sub_label表示根据特征列和特征值分割出的子数据集中的特征和标签</span>
        sub_feature <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        sub_label <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> feature<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">==</span> value<span class="token punctuation">:</span>
                count <span class="token operator">+=</span> <span class="token number">1</span>
                sub_feature<span class="token punctuation">.</span>append<span class="token punctuation">(</span>feature<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                sub_label<span class="token punctuation">.</span>append<span class="token punctuation">(</span>label<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        pHA <span class="token operator">=</span> count <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
        e <span class="token operator">=</span> calcInfoEntropy<span class="token punctuation">(</span>sub_feature<span class="token punctuation">,</span> sub_label<span class="token punctuation">)</span>
        <span class="token keyword">return</span> pHA <span class="token operator">*</span> e

    base_e <span class="token operator">=</span> calcInfoEntropy<span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">)</span>
    f <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
    <span class="token comment"># 得到指定特征列的值的集合</span>
    f_set <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> index<span class="token punctuation">]</span><span class="token punctuation">)</span>
    sum_HDA <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment"># 计算条件熵</span>
    <span class="token keyword">for</span> value <span class="token keyword">in</span> f_set<span class="token punctuation">:</span>
        sum_HDA <span class="token operator">+=</span> calcHDA<span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> index<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
    <span class="token comment"># 计算信息增益</span>
    <span class="token keyword">return</span> base_e <span class="token operator">-</span> sum_HDA
    <span class="token comment">#*********** End *************#</span>

</code></pre> 
<h3><a id="3_385"></a>第3关：线性回归算法思想</h3> 
<h4><a id="_386"></a>（一）相关知识</h4> 
<p>为了完成本关任务，你需要掌握：</p> 
<ul><li>ID3算法构造决策树的流程</li><li>如何使用构造好的决策树进行预测</li></ul> 
<h5><a id="1ID3_390"></a>1&gt;ID3算法</h5> 
<p>ID3算法其实就是依据特征的信息增益来构建树的。其大致步骤就是从根结点开始，对结点计算所有可能的特征的信息增益，然后选择信息增益<strong>最大</strong>的特征作为结点的特征，由该特征的不同取值建立子结点，然后对子结点递归执行上述的步骤直到信息增益很小或者没有特征可以继续选择为止。</p> 
<p>因此，ID3算法伪代码如下：</p> 
<pre><code class="prism language-python"><span class="token comment">#假设数据集为D，标签集为A，需要构造的决策树为tree</span>
<span class="token keyword">def</span> <span class="token function">ID3</span><span class="token punctuation">(</span>D<span class="token punctuation">,</span> A<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> D中所有的标签都相同<span class="token punctuation">:</span>
        <span class="token keyword">return</span> 标签
    <span class="token keyword">if</span> 样本中只有一个特征或者所有样本的特征都一样<span class="token punctuation">:</span>
        对D中所有的标签进行计数
        <span class="token keyword">return</span> 计数最高的标签
    计算所有特征的信息增益
    选出增益最大的特征作为最佳特征<span class="token punctuation">(</span>best_feature<span class="token punctuation">)</span>
    将best_feature作为tree的根结点
    得到best_feature在数据集中所有出现过的值的集合<span class="token punctuation">(</span>value_set<span class="token punctuation">)</span>
    <span class="token keyword">for</span> value <span class="token keyword">in</span> value_set<span class="token punctuation">:</span>
        从D中筛选出best_feature<span class="token operator">=</span>value的子数据集<span class="token punctuation">(</span>sub_feature<span class="token punctuation">)</span>
        从A中筛选出best_feature<span class="token operator">=</span>value的子标签集<span class="token punctuation">(</span>sub_label<span class="token punctuation">)</span>
        <span class="token comment">#递归构造tree</span>
        tree<span class="token punctuation">[</span>best_feature<span class="token punctuation">]</span><span class="token punctuation">[</span>value<span class="token punctuation">]</span> <span class="token operator">=</span> ID3<span class="token punctuation">(</span>sub_feature<span class="token punctuation">,</span> sub_label<span class="token punctuation">)</span>
    <span class="token keyword">return</span> tree
</code></pre> 
<h5><a id="2_413"></a>2&gt;使用决策树进行预测</h5> 
<p>决策树的预测思想非常简单，假设现在已经构建出了一棵用来决策是否买西瓜的决策树。<br> <img src="https://images2.imgbox.com/04/94/xBA3cFHf_o.png" alt="在这里插入图片描述"><br> 并假设现在在水果店里有这样一个西瓜，其属性如下：<br> <img src="https://images2.imgbox.com/f8/94/8iqWyBgF_o.png" alt="在这里插入图片描述"><br> 那买不买这个西瓜呢？只需把西瓜的属性代入决策树即可。决策树的根结点是瓤是否够红，所以就看西瓜的属性，经查看发现够红，因此接下来就看够不够冰。而西瓜不够冰，那么看是否便宜。发现西瓜是便宜的，所以这个西瓜是可以买的。</p> 
<p>因此使用决策树进行预测的伪代码也比较简单，伪代码如下:</p> 
<pre><code class="prism language-python"><span class="token comment">#tree表示决策树，feature表示测试数据</span>
<span class="token keyword">def</span> <span class="token function">predict</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> feature<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> tree是叶子结点<span class="token punctuation">:</span>
        <span class="token keyword">return</span> tree
    根据feature中的特征值走入tree中对应的分支
    <span class="token keyword">if</span> 分支依然是课树<span class="token punctuation">:</span>
        result <span class="token operator">=</span> predict<span class="token punctuation">(</span>分支<span class="token punctuation">,</span> feature<span class="token punctuation">)</span>
    <span class="token keyword">return</span> result
</code></pre> 
<h4><a id="_431"></a>（二）编程要求</h4> 
<p>填写<code>fit(self, feature, label)</code>函数，实现<code>ID3</code>算法，要求决策树保存在<code>self.tree</code>中。其中：</p> 
<ul><li><code>feature</code>：训练集数据，类型为<code>ndarray</code>，数值全为整数</li><li><code>label</code>：训练集标签，类型为<code>ndarray</code>，数值全为整数</li></ul> 
<p>填写<code>predict(self, feature)</code>函数，实现预测功能，并将标签返回，其中：</p> 
<ul><li><code>feature</code>：测试集数据，类型为<code>ndarray</code>，数值全为整数。（<strong>PS：feature中有多条数据</strong>）</li></ul> 
<p>只需完成<code>fit与predict</code>函数即可，程序内部会调用您所完成的<code>fit</code>函数构建模型并调用<code>predict</code>函数来对数据进行预测。预测的准确率高于<code>0.92</code>视为过关。(PS:若<code>self.tree is None</code>则会打印<strong>决策树构建失败</strong>)</p> 
<h4><a id="_441"></a>（三）参考代码</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token comment"># 计算熵</span>


<span class="token keyword">def</span> <span class="token function">calcInfoEntropy</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    input:
        label(narray):样本标签
    output:
        InfoEntropy(float):熵
    '''</span>
    sv <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> v <span class="token keyword">in</span> label<span class="token punctuation">:</span>
        <span class="token keyword">if</span> v <span class="token keyword">in</span> sv<span class="token punctuation">:</span>
            sv<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            sv<span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
    InfoEntropy <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> v <span class="token keyword">in</span> sv<span class="token punctuation">:</span>
        InfoEntropy <span class="token operator">-=</span> <span class="token punctuation">(</span>sv<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token operator">/</span><span class="token builtin">len</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>log2<span class="token punctuation">(</span>sv<span class="token punctuation">[</span>v<span class="token punctuation">]</span><span class="token operator">/</span><span class="token builtin">len</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> InfoEntropy

<span class="token comment"># 计算条件熵</span>


<span class="token keyword">def</span> <span class="token function">calcHDA</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> index<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    input:
        feature(ndarray):样本特征
        label(ndarray):样本标签
        index(int):需要使用的特征列索引
        value(int):index所表示的特征列中需要考察的特征值
    output:
        HDA(float):信息熵
    '''</span>
    count <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment"># sub_feature和sub_label表示根据特征列和特征值分割出的子数据集中的特征和标签</span>
    sub_feature <span class="token operator">=</span> feature<span class="token punctuation">[</span>feature<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> index<span class="token punctuation">]</span> <span class="token operator">==</span> value<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>
    sub_label <span class="token operator">=</span> label<span class="token punctuation">[</span>feature<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> index<span class="token punctuation">]</span> <span class="token operator">==</span> value<span class="token punctuation">]</span>
    count <span class="token operator">=</span> feature<span class="token punctuation">[</span>feature<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> index<span class="token punctuation">]</span> <span class="token operator">==</span> value<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    pHA <span class="token operator">=</span> count <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
    e <span class="token operator">=</span> calcInfoEntropy<span class="token punctuation">(</span>sub_label<span class="token punctuation">)</span>
    HDA <span class="token operator">=</span> pHA <span class="token operator">*</span> e
    <span class="token keyword">return</span> HDA


<span class="token comment"># 计算信息增益</span>
<span class="token keyword">def</span> <span class="token function">calcInfoGain</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    input:
        feature(ndarry):测试用例中字典里的feature
        label(ndarray):测试用例中字典里的label
        index(int):测试用例中字典里的index，即feature部分特征列的索引。该索引指的是feature中第几个特征，如index:0表示使用第一个特征来计算信息增益。
    output:
        InfoGain(float):信息增益
    '''</span>
    base_e <span class="token operator">=</span> calcInfoEntropy<span class="token punctuation">(</span>label<span class="token punctuation">)</span>
    f <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
    <span class="token comment"># 得到指定特征列的值的集合</span>
    f_set <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> index<span class="token punctuation">]</span><span class="token punctuation">)</span>
    sum_HDA <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment"># 计算条件熵</span>
    <span class="token keyword">for</span> value <span class="token keyword">in</span> f_set<span class="token punctuation">:</span>
        sum_HDA <span class="token operator">+=</span> calcHDA<span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> index<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
    <span class="token comment"># 计算信息增益</span>
    InfoGain <span class="token operator">=</span> base_e <span class="token operator">-</span> sum_HDA
    <span class="token keyword">return</span> InfoGain

<span class="token comment"># 获得信息增益最高的特征</span>


<span class="token keyword">def</span> <span class="token function">getBestFeature</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    input:
        feature(ndarray):样本特征
        label(ndarray):样本标签
    output:
        best_feature(int):信息增益最高的特征
    '''</span>
    t <span class="token operator">=</span> <span class="token string">""</span>
    maxn <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">100</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>feature<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        tmp <span class="token operator">=</span> calcInfoGain<span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
        <span class="token keyword">if</span> tmp <span class="token operator">&gt;</span> maxn<span class="token punctuation">:</span>
            t <span class="token operator">=</span> i
            maxn <span class="token operator">=</span> tmp
    best_feature <span class="token operator">=</span> t
    <span class="token keyword">return</span> best_feature

<span class="token comment"># 创建决策树</span>


<span class="token keyword">def</span> <span class="token function">createTree</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    input:
        feature(ndarray):训练样本特征
        label(ndarray):训练样本标签
    output:
        tree(dict):决策树模型    
    '''</span>
    <span class="token comment"># 样本里都是同一个label没必要继续分叉了</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> label<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token comment"># 样本s中只有一个特征或者所有样本的特征都一样的话就看哪个label的票数高</span>
    equ <span class="token operator">=</span> <span class="token boolean">False</span>
    tmps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> feature<span class="token punctuation">:</span>
        tmps<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    tmps <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>tmps<span class="token punctuation">)</span>

    <span class="token keyword">if</span> feature<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">or</span> tmps<span class="token punctuation">[</span>tmps <span class="token operator">==</span> tmps<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape <span class="token operator">==</span> tmps<span class="token punctuation">.</span>shape<span class="token punctuation">:</span>
        <span class="token keyword">return</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>np<span class="token punctuation">.</span>bincount<span class="token punctuation">(</span>label<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">max</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>bincount<span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token comment"># 根据信息增益拿到特征的索引</span>
    bf <span class="token operator">=</span> getBestFeature<span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">)</span>
    tree <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>bf<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token comment"># 拿到bestfeature的所有特征值</span>
    fvalue <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>feature<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> bf<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 构建对应特征值的子样本集sub_feature, sub_label</span>
    <span class="token keyword">for</span> v <span class="token keyword">in</span> fvalue<span class="token punctuation">:</span>
        sub_feature <span class="token operator">=</span> feature<span class="token punctuation">[</span>feature<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> bf<span class="token punctuation">]</span> <span class="token operator">==</span> v<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>
        sub_label <span class="token operator">=</span> label<span class="token punctuation">[</span>feature<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> bf<span class="token punctuation">]</span> <span class="token operator">==</span> v<span class="token punctuation">]</span>
        <span class="token comment"># 递归</span>
        tree<span class="token punctuation">[</span>bf<span class="token punctuation">]</span><span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> createTree<span class="token punctuation">(</span>sub_feature<span class="token punctuation">,</span> sub_label<span class="token punctuation">)</span>
    <span class="token keyword">return</span> tree


<span class="token keyword">def</span> <span class="token function">pred</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> feature<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> tree
    f <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>tree<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> pred<span class="token punctuation">(</span>tree<span class="token punctuation">[</span>f<span class="token punctuation">]</span><span class="token punctuation">[</span>feature<span class="token punctuation">[</span>f<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> feature<span class="token punctuation">)</span>

<span class="token comment"># 决策树分类</span>


<span class="token keyword">def</span> <span class="token function">dt_clf</span><span class="token punctuation">(</span>train_feature<span class="token punctuation">,</span> train_label<span class="token punctuation">,</span> test_feature<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    input:
        train_feature(ndarray):训练样本特征
        train_label(ndarray):训练样本标签
        test_feature(ndarray):测试样本特征
    output:
        predict(ndarray):测试样本预测标签     
    '''</span>
    <span class="token comment"># 创建决策树</span>
    tree <span class="token operator">=</span> createTree<span class="token punctuation">(</span>train_feature<span class="token punctuation">,</span> train_label<span class="token punctuation">)</span>
    <span class="token comment"># 根据tree与特征进行分类</span>
    predict <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> f <span class="token keyword">in</span> test_feature<span class="token punctuation">:</span>
        predict<span class="token punctuation">.</span>append<span class="token punctuation">(</span>pred<span class="token punctuation">(</span>tree<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> predict

</code></pre> 
<h2><a id="k_597"></a>三、k-近邻</h2> 
<h3><a id="1knn_598"></a>第1关：knn算法概述</h3> 
<h4><a id="_599"></a>（一）相关知识</h4> 
<p>为了完成本关任务，你需要掌握：1.knn算法思想，2.距离度量。</p> 
<h5><a id="1knn_601"></a>1&gt;knn算法思想</h5> 
<p><code>k-近邻（k-nearest neighbor ,knn）</code>是一种分类与回归的方法。我们这里只讨论用来分类的knn。所谓k最近邻，就是k个最近的邻居的意思，说的是每个样本都可以用它最近的k个邻居来代表。</p> 
<p><code>knn</code><mark>算法的核心思想是如果一个样本在特征空间中的k个最相邻的样本中的大多数属于某一个类别，则该样本也属于这个类别，并具有这个类别上样本的特性</mark>。该方法在确定分类决策上只依据最邻近的一个或者几个样本的类别来决定待分样本所属的类别。<mark>knn方法在类别决策时，只与极少量的相邻样本有关</mark>。<br> <img src="https://images2.imgbox.com/bb/73/gOgaIDfi_o.png" alt="在这里插入图片描述"><br> 如上图，当<code>k=3</code>时离绿色的圆最近的三个样本中，有两个红色的三角形，一个蓝色的正方形，则此时绿色的圆应该分为红色的三角形这一类。而当<code>k=5</code>时，离绿色的圆最近的五个样本中，有两个红色的三角形，三个蓝色的正方形，则此时绿色的圆应该分为蓝色的正方形这一类。</p> 
<h5><a id="2_607"></a>2&gt;距离度量</h5> 
<p>我们已经知道，如何判别一个样本属于哪个类型，主要是看离它最近的几个样本中哪个类型的数量最多，则该样本属于数量最多的类型。这里，有一个问题：何为最近？</p> 
<p>关于何为最近，大家应该自然而然就会想到可以用两个样本之间的距离大小来衡量，我们常用的有两种距离：</p> 
<ul><li><strong>欧氏距离</strong>：欧氏距离是最容易直观理解的距离度量方法，我们小学、初中和高中接触到的两个点在空间中的距离一般都是指欧氏距离。<br> <img src="https://images2.imgbox.com/00/d6/LzbYzE7H_o.png" alt="在这里插入图片描述"><br> 二维平面上欧式距离计算公式：<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           d 
          
         
           12 
          
         
        
          = 
         
         
          
          
            ( 
           
           
           
             x 
            
           
             1 
            
            
            
              ( 
             
            
              1 
             
            
              ) 
             
            
           
          
            − 
           
           
           
             x 
            
           
             1 
            
            
            
              ( 
             
            
              2 
             
            
              ) 
             
            
           
           
           
             ) 
            
           
             2 
            
           
          
            + 
           
          
            ( 
           
           
           
             x 
            
           
             2 
            
            
            
              ( 
             
            
              1 
             
            
              ) 
             
            
           
          
            − 
           
           
           
             x 
            
           
             2 
            
            
            
              ( 
             
            
              2 
             
            
              ) 
             
            
           
           
           
             ) 
            
           
             2 
            
           
          
         
        
       
         d_{12}=\sqrt{(x_1^{(1)}-x_1^{(2)})^2+(x_2^{(1)}-x_2^{(2)})^2} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.84em; vertical-align: -0.465754em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.37425em;"><span class="svg-align" style="top: -3.8em;"><span class="pstrut" style="height: 3.8em;"></span><span class="mord" style="padding-left: 1em;"><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.43369em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.266308em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.43369em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">2</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.266308em;"><span class=""></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.740108em;"><span class="" style="top: -2.989em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.43369em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.266308em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.43369em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">2</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.266308em;"><span class=""></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.740108em;"><span class="" style="top: -2.989em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.33425em;"><span class="pstrut" style="height: 3.8em;"></span><span class="hide-tail" style="min-width: 1.02em; height: 1.88em;"> 
            <svg width="400em" height="1.8800000000000001em" viewbox="0 0 400000 1944" preserveaspectratio="xMinYMin slice"> 
             <path d="M1001,80H400000v40H1013.1s-83.4,268,-264.1,840c-180.7,
572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,
-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744c-10,12,-21,25,-33,39s-32,39,-32,39
c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30c26.7,-32.7,52,-63,76,-91s52,-60,52,-60
s208,722,208,722c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,
-658.5c53.7,-170.3,84.5,-266.8,92.5,-289.5c4,-6.7,10,-10,18,-10z
M1001 80H400000v40H1013z"></path> 
            </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.465754em;"><span class=""></span></span></span></span></span></span></span></span></span><br> <code>n</code>维平面上欧氏距离计算公式：<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           d 
          
         
           12 
          
         
        
          = 
         
         
          
           
           
             ∑ 
            
            
            
              i 
             
            
              = 
             
            
              1 
             
            
           
             n 
            
           
          
            ( 
           
           
           
             x 
            
           
             i 
            
            
            
              ( 
             
            
              1 
             
            
              ) 
             
            
           
          
            − 
           
           
           
             x 
            
           
             i 
            
            
            
              ( 
             
            
              2 
             
            
              ) 
             
            
           
           
           
             ) 
            
           
             2 
            
           
          
         
        
       
         d_{12}=\sqrt{\displaystyle\sum_{i=1}^n(x_i^{(1)}-x_i^{(2)})^2} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 3.05907em; vertical-align: -1.27767em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.7814em;"><span class="svg-align" style="top: -5.01907em;"><span class="pstrut" style="height: 5.01907em;"></span><span class="mord" style="padding-left: 1.056em;"><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.42314em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.42314em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">2</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.864108em;"><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.7414em;"><span class="pstrut" style="height: 5.01907em;"></span><span class="hide-tail" style="min-width: 0.742em; height: 3.09907em;"> 
            <svg width="400em" height="3.099066em" viewbox="0 0 400000 3099" preserveaspectratio="xMinYMin slice"> 
             <path d="M702 80H400000v40H742v2965l-4 4-4 4c-.667.7
-2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1h-12l-28-84c-16.667-52-96.667
-294.333-240-727l-212 -643 -85 170c-4-3.333-8.333-7.667-13 -13l-13-13l77-155
 77-156c66 199.333 139 419.667 219 661 l218 661zM702 80H400000v40H742z"></path> 
            </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span></span></span></span></span></li><li><strong>曼哈顿距离</strong>：顾名思义，在曼哈顿街区要从一个十字路口开车到另一个十字路口，驾驶距离显然不是两点间的直线距离。这个实际驾驶距离就是“曼哈顿距离”。曼哈顿距离也称为“城市街区距离”。<br> <img src="https://images2.imgbox.com/01/25/957JcYEm_o.png" alt="在这里插入图片描述"><br> 二维平面上曼哈顿距离计算公式：<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           d 
          
         
           12 
          
         
        
          = 
         
        
          ∣ 
         
         
         
           x 
          
         
           1 
          
          
          
            ( 
           
          
            1 
           
          
            ) 
           
          
         
        
          − 
         
         
         
           x 
          
         
           1 
          
          
          
            ( 
           
          
            2 
           
          
            ) 
           
          
         
        
          ∣ 
         
        
          + 
         
        
          ∣ 
         
         
         
           x 
          
         
           2 
          
          
          
            ( 
           
          
            1 
           
          
            ) 
           
          
         
        
          − 
         
         
         
           x 
          
         
           2 
          
          
          
            ( 
           
          
            2 
           
          
            ) 
           
          
         
        
          ∣ 
         
        
       
         d_{12}=|x_1^{(1)}-x_1^{(2)}|+|x_2^{(1)}-x_2^{(2)}| 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.31111em; vertical-align: -0.266308em;"></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.43369em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.266308em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.31111em; vertical-align: -0.266308em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.43369em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">2</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.266308em;"><span class=""></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.31111em; vertical-align: -0.266308em;"></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.43369em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.266308em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.31111em; vertical-align: -0.266308em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.43369em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">2</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.266308em;"><span class=""></span></span></span></span></span></span><span class="mord">∣</span></span></span></span></span><br> <code>n</code>维平面上曼哈顿计算公式：<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           d 
          
         
           12 
          
         
        
          = 
         
         
          
          
            ∑ 
           
           
           
             i 
            
           
             = 
            
           
             1 
            
           
          
            n 
           
          
         
           ∣ 
          
          
          
            x 
           
          
            i 
           
           
           
             ( 
            
           
             1 
            
           
             ) 
            
           
          
         
           − 
          
          
          
            x 
           
          
            i 
           
           
           
             ( 
            
           
             2 
            
           
             ) 
            
           
          
         
           ∣ 
          
         
        
       
         d_{12}=\displaystyle\sum_{i=1}^n|x_i^{(1)}-x_i^{(2)}| 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.301108em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">2</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 2.92907em; vertical-align: -1.27767em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.6514em;"><span class="" style="top: -1.87233em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05001em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.30001em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.27767em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.166667em;"></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.42314em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">1</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.32166em; vertical-align: -0.276864em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.42314em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mtight">2</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span><span class="mord">∣</span></span></span></span></span><br> 其中，上标圆括号内数字代表第几个样本，下标数字代表样本的第几个特征。</li></ul> 
<h4><a id="_625"></a>（二）编程要求</h4> 
<p>根据提示，在编辑器<code>Begin-End</code>处补充代码，实现<code>topK</code>方法。程序会调用你实现的方法，找出目标样本最近的k个样本的标签。如目标样本最近的5个样本为<code>0，0，1，1，1</code>则返回列表<code>[0,0,1,1,1]</code>。若返回结果与真实结果一致则视为通关。</p> 
<h4><a id="_627"></a>（三）参考代码</h4> 
<pre><code class="prism language-python"><span class="token comment"># encoding=utf8</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np


<span class="token keyword">def</span> <span class="token function">topK</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> k<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    input:
        i(int):第i个样本
        k(int):最近邻样本个数
        x(ndarray):数据特征
        y(ndarray):数据标签
    output:
        topK(list):样本i的最近k个样本标签
    '''</span>
    <span class="token comment">#*********Begin*********#</span>
    topK <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token comment"># 计算样本到所有样本的距离</span>
    <span class="token comment"># dis = []</span>
    <span class="token comment"># topK = []</span>
    <span class="token comment"># length = len(x)</span>
    <span class="token comment"># s = 0</span>
    <span class="token comment"># for i in range(length):</span>
    <span class="token comment">#     for s in range(1, length-s):</span>
    <span class="token comment">#         dis.append(np.linalg.norm(x[i]-x[i+s]))</span>
    <span class="token comment"># # 除样本本身外的最近的k个样本的索引</span>
    <span class="token comment"># Lst = dis[:]  # 对列表进行浅复制，避免后面更改原列表数据</span>
    <span class="token comment"># index_k = []</span>
    <span class="token comment"># for i in range(k):</span>
    <span class="token comment">#     index_i = Lst.index(max(Lst))  # 得到列表的最da值，并得到该最da值的索引</span>
    <span class="token comment">#     index_k.append(index_i)  # 记录最da值索引</span>
    <span class="token comment">#     Lst[index_i] = -9999  # 将遍历过的列表最da值改为0，下次不再选择</span>
    <span class="token comment"># for i in index_k:</span>
    <span class="token comment">#     topK.append(y[i])</span>
    <span class="token comment"># # 除样本本身外的最近的k个样本的标签</span>
    <span class="token comment">#*********End*********#</span>
    <span class="token keyword">return</span> topK

</code></pre> 
<h3><a id="2knn_667"></a>第2关：动手实现knn算法</h3> 
<h4><a id="_668"></a>（一）相关知识</h4> 
<p>为了完成本关任务，你需要掌握：1.加权投票，2.knn算法流程。</p> 
<h5><a id="1_670"></a>1&gt;数据集介绍</h5> 
<p>手写数字数据集一共有1797个样本，每个样本有64个特征。每个特征的值为0-255之间的像素，我们的任务就是根据这64个特征值识别出该数字属于0-9十个类别中的哪一个。</p> 
<p>我们可以使用<code>sklearn</code>直接对数据进行加载，代码如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> load_digits
<span class="token comment">#加载手写数字数据集</span>
digits <span class="token operator">=</span> load_digits<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#获取数据特征与标签</span>
x<span class="token punctuation">,</span>y <span class="token operator">=</span> digits <span class="token punctuation">.</span>data<span class="token punctuation">,</span>digits <span class="token punctuation">.</span>target
</code></pre> 
<p>当然，每一个样本就是一个数字，我们可以把它还原为8x8的大小进行查看：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
img <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/05/5d/CjDCj0xg_o.png" alt="在这里插入图片描述"><br> 然后我们划分出训练集与测试集，训练集用来训练模型，测试集用来检测模型性能。代码如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
<span class="token comment">#划分训练集测试集，其中测试集样本数为整个数据集的20%</span>
train_feature<span class="token punctuation">,</span>test_feature<span class="token punctuation">,</span>train_label<span class="token punctuation">,</span>test_label <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>test_size<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span>random_state<span class="token operator">=</span><span class="token number">666</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="2_694"></a>2&gt;加权投票</h5> 
<p>通过上一关，我们已经知道如何找出最近的k个样本，但是，现在还有一个问题要我们来解决：如果有两个类型的样本数一样且最多，那么最终该样本应该属于哪个类型？</p> 
<p>其实，<code>knn</code>算法最后决定样本属于哪个类别，其实好比就是在投票，哪个类别票数多，则该样本属于哪个类别。而如果出现票数相同的情况，我们可以给每一票加上一个权重，用来表示每一票的重要性，这样就可以解决票数相同的问题了。很明显，距离越近的样本所投的一票应该越重要，此时我们可以将距离的倒数作为权重赋予每一票。<br> <img src="https://images2.imgbox.com/32/09/R4RLEsiU_o.png" alt="在这里插入图片描述"><br> 如上图，虽然蓝色正方形与红色三角形数量一样，但是根据加权投票的规则，绿色的圆应该属于蓝色正方形这个类别。</p> 
<h5><a id="3knn_700"></a>3&gt;knn算法流程</h5> 
<p><code>knn</code>算法不需要训练模型，只是根据离样本最近的几个样本类型来判别该样本类型，所以流程非常简单：</p> 
<pre><code>1.计算出新样本与每一个样本的距离
2.找出距离最近的k个样本
3.根据加权投票规则得到新样本的类别
</code></pre> 
<h4><a id="_707"></a>（二）编程要求</h4> 
<p>根据提示，在编辑器<code>Begin-End</code>处补充代码，实现<code>knn</code>算法。程序会调用你的实现的方法对手写数字进行识别，正确率大于0.95则视为通关。</p> 
<h4><a id="_709"></a>（三）参考代码</h4> 
<pre><code class="prism language-python"><span class="token comment"># encoding=utf8</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np


<span class="token keyword">def</span> <span class="token function">knn_clf</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> train_feature<span class="token punctuation">,</span> train_label<span class="token punctuation">,</span> test_feature<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    input:
        k(int):最近邻样本个数
        train_feature(ndarray):训练样本特征
        train_label(ndarray):训练样本标签
        test_feature(ndarray):测试样本特征
    output:
        predict(ndarray):测试样本预测标签
    '''</span>
    <span class="token comment">#*********Begin*********#</span>
    <span class="token keyword">def</span> <span class="token function">topK</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> k<span class="token punctuation">,</span> sam<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        input:
            i(int):第i个样本
            k(int):最近邻样本个数
            x(ndarray):数据特征
            y(ndarray):数据标签
        output:
            topK(list):样本i的最近k个样本标签
        '''</span>
        <span class="token comment"># 计算样本到所有样本的距离</span>
        dis <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> s <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            tmp <span class="token operator">=</span> sam <span class="token operator">-</span> x<span class="token punctuation">[</span>s<span class="token punctuation">]</span>
            S <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">for</span> t <span class="token keyword">in</span> tmp<span class="token punctuation">:</span>
                S <span class="token operator">+=</span> <span class="token builtin">abs</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span>
            dis<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>S<span class="token punctuation">,</span> s<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment"># 除样本本身外的最近的k个样本的索引</span>
        dis <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>dis<span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment"># 除样本本身外的最近的k个样本的标签</span>
        <span class="token keyword">for</span> a <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">:</span>
            dis<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>y<span class="token punctuation">[</span>dis<span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token triple-quoted-string string">'''
            output:
            dis中每一项是个三元组，具体为：(样本的距离，样本的索引，样本的标签)
        '''</span>
        <span class="token keyword">return</span> dis<span class="token punctuation">[</span><span class="token punctuation">:</span>k<span class="token punctuation">]</span>

    predict <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment"># 对测试集每一个样本进行遍历</span>
    <span class="token keyword">for</span> ti <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>test_feature<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 测试集第i个样本到训练集每一个样本的距离</span>
        dis <span class="token operator">=</span> topK<span class="token punctuation">(</span>ti<span class="token punctuation">,</span> k<span class="token punctuation">,</span> test_feature<span class="token punctuation">[</span>ti<span class="token punctuation">]</span><span class="token punctuation">,</span> train_feature<span class="token punctuation">,</span> train_label<span class="token punctuation">)</span>
        <span class="token comment"># 初始化进行投票的字典，字典的键为标签，值为投票分数</span>
        dic <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> d <span class="token keyword">in</span> dis<span class="token punctuation">:</span>
            <span class="token comment"># 进行投票</span>
            <span class="token keyword">if</span> d<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token keyword">not</span> <span class="token keyword">in</span> dic<span class="token punctuation">:</span>
                <span class="token comment"># 如果标签不在字典中则将标签加入字典的键，同时计入相应的分数</span>
                dic<span class="token punctuation">[</span>d<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1.0</span><span class="token operator">/</span>d<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token comment"># 如果标签在字典的键中则投票计分</span>
                dic<span class="token punctuation">[</span>d<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1.0</span><span class="token operator">/</span>d<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token comment"># 计入投票评分最高的类别最为预测结果</span>
        predict<span class="token punctuation">.</span>append<span class="token punctuation">(</span>
            <span class="token builtin">sorted</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>dic<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment">#*********End*********#</span>
    <span class="token keyword">return</span> predict

</code></pre> 
<p>原文链接：<a href="https://blog.csdn.net/weixin_43246400/article/details/116134655">https://blog.csdn.net/weixin_43246400/article/details/116134655</a><br> <em>@date: 2021.04.25<br> @author: zkinglin</em><br> （完）</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d1178b5c4981376704a61fed5aeba9a8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据挖掘——数据采集和数据清洗</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0b3103e03a749f68649b584d6c0422ef/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于FPGA的MobileNet V2卷积神经网络加速器</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>