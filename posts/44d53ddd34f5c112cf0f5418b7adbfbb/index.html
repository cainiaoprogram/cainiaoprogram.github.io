<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Struts 2详细工作流程及原理 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Struts 2详细工作流程及原理" />
<meta property="og:description" content="Struts 2详细工作流程 Struts2工作原理及流程
Struts2框架的基本思想是采用MVC设计模式，即将应用设计成模型(Model)、视图(View)和控制器(Control)三个部分；
那么Struts2框架中是如何实现MVC模式的呢？控制部分由DispatchFilter承担，模型部分是由一系列的拦截器(Interceptors)、Action组件和ActionContext组件组成，视图组件则是由Result组件组成；
那么Struts2框架是怎么工作的呢？
如当我们在浏览器的地址栏中输入：http://localhost:8080/Struts/TestMvc/add.action，浏览器就会把这个请求发送给tomcat，tomcat接收到这个请求后，会检查一下应该交给哪个web程序处理，现在是交给Struts去处理，然后Struts会去参考此程序下的配置文件web.xml，在web.xml中找到过滤器（Filter）,如（ActionContextCleanUp、其他过滤器（SiteMesh等）、 FilterDispatcher）,注意这里是有顺序的，先ActionContextCleanUp，再其他过滤器（SiteMesh等）、最后到FilterDispatcher;
FilterDispatcher是控制器的核心，就是mvc中c控制层的核心，FilterDispatcher进行初始化并启用核心 doFilter。FilterDispatcher询问ActionMapper来决定这个请是否需要调用某个Action， 如果 ActionMapper决定需要调用某个Action，FilterDispatcher把请求的处理交给 ActionProxy ，ActionProxy通过struts.xml询问框架的配置文件，找到需要调用的Action类和方法来处理这请求;
Action执行完毕，根据struts.xml中的配置找到对应的返回结果result，并跳转到相应页面，最后返回HTTP响应到客户端浏览器；
其实用最简单的七个步骤：
1：客户端在浏览器中输入一个url地址；
2：这个url请求通过http协议发送给tomcat；
3：tomcat根据url找到对应项目里面的web.xml文件；
4：在web.xml里面会发现有struts2的配置；
5：然后会找到struts2对应的struts.xml配置文件；
6：根据url解析struts.xml配置文件就会找到对应的class；
7：调用完class返回一个结果result，根据struts.xml返回到对应的jsp；
Struts2框架由三部分构成：核心控制器、业务控制器和用户实现的业务逻辑组件。在这三部分中，struts2框架提供了核心控制器StrutsPrepareAndExecuteFilter，而用户需要实现业务控制层和业务逻辑层。
一、核心控制器 StrutsPrepareAndExecuteFilter
StrutsPrepareAndExecuteFilter与struts2以前版本中的FilterDispatcher一样。它是struts2框架的核心控制器，该控制器作为一个Filter运行在web应用中，它负责拦截所有的用户请求，当用户请求到达时，该Filter会过滤用户请求，如果用户请求以action结尾，该请求就会被转入struts2框架来处理。
Struts2框架获取*.action请求后，将根据*.action请求的前面部分决定调用那个业务逻辑组件，例如：对于login.action请求，Struts2调用名为login的Action来处理该请求。
Struts2用户处理请求的Action实例，并不是用户实现的业务控制器，而是Action代理--因为用户实现的业务控制器并没有与ServletAPI耦合，显示无法处理用户请求，而struts2框架提供了系列拦截器，该系列拦截器负责将HttpServletRequest请求中的桉树解析出来，传入Action中，并huidiaoAction的execute方法来处理用户请求。
上面的处理过程是典型的AOP（面向切面编程）处理方式，如图所示的处理模型：
从图看出，用户实现的Action仅仅是struts2的Action代理的代理目标，用户实现的业务控制器Action则包含了对用户请求的处理，用户的请求数据包含在HttpServletRequest对象中， 而用户Action类无需访问HttpServletRequest对象，拦截器会将请求数据解析出来并传给业务逻辑组件Action实例
二、业务控制器
简述：左右项目开发中action控制层，用户接受数据，封装数据，调用业务逻辑层
业务控制器组件就是用户Action类的实例，Action类通常包含了一个excute方法，该方法返回一个字符串-----该字符串就是一个逻辑视图名，当业务控制器处理完用户请求后，根据处理结果不同，excute方法返回不同字符串。
每个字符串对应一个视图名
在写完控业务制器后，需要配置Action的如下三个部分定义
●Action所处理的URL
●Action组件所对应的实现类
●Action里包含的逻辑视图和物理资源之间的对应关系
每个Action都要处理一个用户请求，而用户请求总是包含了指定URL，当StrutsPrepareAndExecuteFilter拦截到用户请求后，根据请求的URL和Action处理URL之间的对应关系来处理转发
三、struts2的模型组件
Java EE 应用里的模型组件，通常指系统的业务逻辑组件，而隐藏在系统逻辑组件下面的，可能还包含了DAO，领域对象等组件。
MVC框架里的业务控制器会调用模型组件的方法来处理用户请求，也就是说，业务控制器不会对用户请求进行实际处理，用户请求最终由模型组件负责处理，业务控制器只是中间负责调度器，这也是称Action为控制器的原因
四、Struts2的视图组件
Struts2已经改变了struts1只能使用JSP作为视图技术的现状，允许使用其他模版技术。
当struts2的控制器返回逻辑视图名时，逻辑视图并未与任何的视图技术关联，仅仅是返回一个字符串，该字符串作为逻辑视图名。
当我们在struts.xml文件中配置Action时，要为Action元素指定系列result子元素，每个result子元素定义一个逻辑视图和物理视图之间的映射，如果没有指定type属性，默认使用JSP左右视图资源。也可以指定很多类型 chain 转发到指定action中，redircter，重定向。
五、运行流程
Struts2框架的运行流程非常相似于WebWork框架的流程，struts2其实就是WebWork2.2的升级版，因此，struts2的运行流程与WebWork运行流程完全相同，如图WebWork的运行流程：
当用户向Web应用发送请求时，该请求经过ActionContextCleanUp、SiteMesh等过滤器过滤。由WebWork的核心控制器拦截，如果用户请求需要WebWWork的业务逻辑控制器处理，该控制器则调用Action映射器，该映射器将用户请求转发到对应的业务逻辑控制器。值得注意的是，测试的业务逻辑控制器并不是开发者实现的控制器，而是WebWork创建的控制器代理，创建控制器代理时，WebWork需要得到开着定义的xwork,xml配置文件，控制器代理以用户实现的控制器作为目标，以拦截器链中的拦截器作为处理。
业务逻辑控制器只是WebWork控制器的目标-----这就是为什么开发者自己实现的Action可以与servletAPI分离的原因，当Action处理完HTTP请求后，该结果只是一个普通的字符串，该字符串将对应到指定的视图资源。 指定的视图资源经过拦截器链处理后，生成对客户端的响应输出
Struts2是Struts社区和WebWork社区的共同成果，我们甚至可以说，Struts2是WebWork的升级版，他采用的正是WebWork的核心，所以，Struts2并不是一个不成熟的产品，相反，构建在WebWork基础之上的Struts2是一个运行稳定、性能优异、设计成熟的WEB框架。
本章主要对Struts的源代码进行分析，因为Struts2与WebWork的关系如此密不可分，因此，读者需要下载xwork的源代码，访问http://www.opensymphony.com/xwork/download.action即可自行下载。
下载的Struts2源代码文件是一个名叫struts-2.1.0-src.zip的压缩包，里面的目录和文件非常多，读者可以定位到struts-2.1.0-src&#34;struts-2.0.10&#34;src&#34;core&#34;src&#34;main&#34;java目录下查看Struts2的源文件，如图14所示。
（图14）
主要的包和类 Struts2框架的正常运行，除了占核心地位的xwork的支持以外，Struts2本身也提供了许多类，这些类被分门别类组织到不同的包中。从源代码中发现，基本上每一个Struts2类都访问了WebWork提供的功能，从而也可以看出Struts2与WebWork千丝万缕的联系。但无论如何，Struts2的核心功能比如将请求委托给哪个Action处理都是由xwork完成的，Struts2只是在WebWork的基础上做了适当的简化、加强和封装，并少量保留Struts1.x中的习惯。
以下是对各包的简要说明：
包名
说明
org.apache.struts2. components
该包封装视图组件，Struts2在视图组件上有了很大加强，不仅增加了组件的属性个数，更新增了几个非常有用的组件，如updownselect、doubleselect、datetimepicker、token、tree等。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/44d53ddd34f5c112cf0f5418b7adbfbb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-09-08T14:31:46+08:00" />
<meta property="article:modified_time" content="2015-09-08T14:31:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Struts 2详细工作流程及原理</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-family:Arial; font-size:14px; line-height:26px">
    
 <h4 style="margin:0px; padding:0px"><a target="_blank" name="t0" style="color:rgb(202,0,0)"></a><a target="_blank" href="http://blog.csdn.net/yezi77321660/article/details/3960779" style="color:rgb(0,0,0); text-decoration:none" rel="noopener noreferrer">Struts 2详细工作流程</a></h4> 
</div> 
<div> 
 <span style="font-family:Arial; color:#999999"><span style="font-size:14px; line-height:26px">    </span></span> 
 <p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px"> <span style="padding:0px; margin:0px">Struts2工作原理及流程</span></p> 
 <p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px"> <span style="padding:0px; margin:0px">     Struts2框架的基本思想是采用MVC设计模式，即将应用设计成模型(Model)、视图(View)和控制器(Control)三个部分；</span></p> 
 <p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px"> <span style="padding:0px; margin:0px">     那么Struts2框架中是如何实现MVC模式的呢？控制部分由DispatchFilter承担，模型部分是由一系列的拦截器(Interceptors)、Action组件和ActionContext组件组成，视图组件则是由Result组件组成；</span></p> 
 <p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px"> <span style="padding:0px; margin:0px">那么Struts2框架是怎么工作的呢？</span></p> 
 <p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px"> <span style="padding:0px; margin:0px">     如当我们在浏览器的地址栏中输入：http://localhost:8080/Struts/TestMvc/add.action，浏览器就会把这个请求发送给tomcat，tomcat接收到这个请求后，会检查一下应该交给哪个web程序处理，现在是交给Struts去处理，然后Struts会去参考此程序下的配置文件web.xml，在web.xml中找到过滤器（Filter）,如（ActionContextCleanUp、其他过滤器（SiteMesh等）、 FilterDispatcher）,注意这里是有顺序的，先ActionContextCleanUp，再其他过滤器（SiteMesh等）、最后到FilterDispatcher;</span></p> 
 <p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px"> <span style="padding:0px; margin:0px">     FilterDispatcher是控制器的核心，就是mvc中c控制层的核心，FilterDispatcher进行初始化并启用核心 doFilter。FilterDispatcher询问ActionMapper来决定这个请是否需要调用某个Action， 如果 ActionMapper决定需要调用某个Action，FilterDispatcher把请求的处理交给 ActionProxy ，ActionProxy通过struts.xml询问框架的配置文件，找到需要调用的Action类和方法来处理这请求;</span></p> 
 <p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px"> <span style="padding:0px; margin:0px"> <span style="padding:0px; margin:0px">   </span><span style="padding:0px; margin:0px">Action执行完毕，根据struts.xml中的配置找到对应的返回结果result，并跳转到相应页面</span><span style="padding:0px; margin:0px">，最后</span><span style="padding:0px; margin:0px">返回HTTP响应到客户端浏览器</span><span style="padding:0px; margin:0px">；</span></span></p> 
 <p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px"> <span style="padding:0px; margin:0px"> </span></p> 
 <p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px"> <span style="padding:0px; margin:0px">  其实用最简单的七个步骤：</span></p> 
 <p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px"> <span style="padding:0px; margin:0px">  1：客户端在浏览器中输入一个url地址</span><span style="padding:0px; margin:0px">；</span></p> 
 <p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px"> <span style="padding:0px; margin:0px">  2：这个url请求通过http协议发送给tomcat</span><span style="padding:0px; margin:0px">；</span></p> 
 <p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px"> <span style="padding:0px; margin:0px">  3：tomcat根据url找到对应项目里面的web.xml文件</span><span style="padding:0px; margin:0px">；</span></p> 
 <p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px"> <span style="padding:0px; margin:0px">  4：在web.xml里面会发现有struts2的配置</span><span style="padding:0px; margin:0px">；</span></p> 
 <p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px"> <span style="padding:0px; margin:0px">  5：然后会找到struts2对应的struts.xml配置文件</span><span style="padding:0px; margin:0px">；</span></p> 
 <p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px"> <span style="padding:0px; margin:0px">  6：根据url解析struts.xml配置文件就会找到对应的class</span><span style="padding:0px; margin:0px">；</span></p> 
 <p style="padding-top:0px; padding-bottom:0px; margin-top:10px; margin-bottom:10px"> <span style="padding:0px; margin:0px">  7：调用完class返回一个</span><span style="padding:0px; margin:0px">结果</span><span style="padding:0px; margin:0px">result</span><span style="padding:0px; margin:0px">，根据struts.xml返回到对应的jsp</span><span style="padding:0px; margin:0px">；</span></p> 
</div> 
<div> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <br> </p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> </p> 
 <p align="left">Struts2框架由三部分构成：核心控制器、业务控制器和用户实现的业务逻辑组件。在这三部分中，struts2框架提供了核心控制器StrutsPrepareAndExecuteFilter，而用户需要实现业务控制层和业务逻辑层。</p> 
 <p align="left">一、核心控制器 StrutsPrepareAndExecuteFilter</p> 
 <p align="left"> StrutsPrepareAndExecuteFilter与struts2以前版本中的FilterDispatcher一样。它是struts2框架的核心控制器，该控制器作为一个Filter运行在web应用中，它负责拦截所有的用户请求，当用户请求到达时，该Filter会过滤用户请求，如果用户请求以action结尾，该请求就会被转入struts2框架来处理。</p> 
 <p align="left">Struts2框架获取*.action请求后，将根据*.action请求的前面部分决定调用那个业务逻辑组件，例如：对于login.action请求，Struts2调用名为login的Action来处理该请求。</p> 
 <p align="left">Struts2用户处理请求的Action实例，并不是用户实现的业务控制器，而是Action代理--因为用户实现的业务控制器并没有与ServletAPI耦合，显示无法处理用户请求，而struts2框架提供了系列拦截器，该系列拦截器负责将HttpServletRequest请求中的桉树解析出来，传入Action中，并huidiaoAction的execute方法来处理用户请求。</p> 
 <p align="left">上面的处理过程是典型的AOP（面向切面编程）处理方式，如图所示的处理模型：</p> 
 <p align="left"><img alt="" src="https://images2.imgbox.com/a4/a6/6Kw2LTv8_o.gif" style="border:none; max-width:100%"></p> 
 <p align="left">从图看出，用户实现的Action仅仅是struts2的Action代理的代理目标，用户实现的业务控制器Action则包含了对用户请求的处理，用户的请求数据包含在HttpServletRequest对象中， 而用户Action类无需访问HttpServletRequest对象，拦截器会将请求数据解析出来并传给业务逻辑组件Action实例</p> 
 <p align="left">二、业务控制器</p> 
 <p align="left">简述：左右项目开发中action控制层，用户接受数据，封装数据，调用业务逻辑层</p> 
 <p align="left">业务控制器组件就是用户Action类的实例，Action类通常包含了一个excute方法，该方法返回一个字符串-----该字符串就是一个逻辑视图名，当业务控制器处理完用户请求后，根据处理结果不同，excute方法返回不同字符串。</p> 
 <p align="left">每个字符串对应一个视图名</p> 
 <p align="left">在写完控业务制器后，需要配置Action的如下三个部分定义</p> 
 <p align="left">●Action所处理的URL</p> 
 <p align="left">●Action组件所对应的实现类</p> 
 <p align="left">●Action里包含的逻辑视图和物理资源之间的对应关系</p> 
 <p align="left">每个Action都要处理一个用户请求，而用户请求总是包含了指定URL，当StrutsPrepareAndExecuteFilter拦截到用户请求后，根据请求的URL和Action处理URL之间的对应关系来处理转发</p> 
 <p align="left">三、struts2的模型组件</p> 
 <p align="left">Java EE 应用里的模型组件，通常指系统的业务逻辑组件，而隐藏在系统逻辑组件下面的，可能还包含了DAO，领域对象等组件。</p> 
 <p align="left">MVC框架里的业务控制器会调用模型组件的方法来处理用户请求，也就是说，业务控制器不会对用户请求进行实际处理，用户请求最终由模型组件负责处理，业务控制器只是中间负责调度器，这也是称Action为控制器的原因</p> 
 <p align="left"><img alt="" src="https://images2.imgbox.com/fc/71/S0J8031T_o.gif" style="border:none; max-width:100%"></p> 
 <p align="left">四、Struts2的视图组件</p> 
 <p align="left">Struts2已经改变了struts1只能使用JSP作为视图技术的现状，允许使用其他模版技术。</p> 
 <p align="left">当struts2的控制器返回逻辑视图名时，逻辑视图并未与任何的视图技术关联，仅仅是返回一个字符串，该字符串作为逻辑视图名。</p> 
 <p align="left">当我们在struts.xml文件中配置Action时，要为Action元素指定系列result子元素，每个result子元素定义一个逻辑视图和物理视图之间的映射，如果没有指定type属性，默认使用JSP左右视图资源。也可以指定很多类型 chain 转发到指定action中，redircter，重定向。</p> 
 <p align="left">五、运行流程</p> 
 <p align="left">Struts2框架的运行流程非常相似于WebWork框架的流程，struts2其实就是WebWork2.2的升级版，因此，struts2的运行流程与WebWork运行流程完全相同，如图WebWork的运行流程：</p> 
 <p align="left"><img alt="" src="https://images2.imgbox.com/b9/56/guQBiSpJ_o.gif" style="border:none; max-width:100%"></p> 
 <p align="left">当用户向Web应用发送请求时，该请求经过ActionContextCleanUp、SiteMesh等过滤器过滤。由WebWork的核心控制器拦截，如果用户请求需要WebWWork的业务逻辑控制器处理，该控制器则调用Action映射器，该映射器将用户请求转发到对应的业务逻辑控制器。值得注意的是，测试的业务逻辑控制器并不是开发者实现的控制器，而是WebWork创建的控制器代理，创建控制器代理时，WebWork需要得到开着定义的xwork,xml配置文件，控制器代理以用户实现的控制器作为目标，以拦截器链中的拦截器作为处理。</p> 
 <p align="left">业务逻辑控制器只是WebWork控制器的目标-----这就是为什么开发者自己实现的Action可以与servletAPI分离的原因，当Action处理完HTTP请求后，该结果只是一个普通的字符串，该字符串将对应到指定的视图资源。 指定的视图资源经过拦截器链处理后，生成对客户端的响应输出</p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; text-indent:21pt"> <br> </p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; text-indent:21pt"> Struts2<span style="font-family:宋体">是</span>Struts<span style="font-family:宋体">社区和</span>WebWork<span style="font-family:宋体">社区的共同成果，我们甚至可以说，</span>Struts2<span style="font-family:宋体">是</span>WebWork<span style="font-family:宋体">的升级版，他采用的正是</span>WebWork<span style="font-family:宋体">的核心，所以，</span>Struts2<span style="font-family:宋体">并不是一个不成熟的产品，相反，构建在</span>WebWork<span style="font-family:宋体">基础之上的</span>Struts2<span style="font-family:宋体">是一个运行稳定、性能优异、设计成熟的</span><a target="_blank" style="color:rgb(51,102,153)"><span style="text-decoration:underline"><strong>WEB</strong></span></a><span style="font-family:宋体">框架。</span></p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; text-indent:21pt"> <span style="font-family:宋体">本章主要对</span>Struts<span style="font-family:宋体">的源代码进行分析，因为</span>Struts2<span style="font-family:宋体">与</span>WebWork<span style="font-family:宋体">的关系如此密不可分，因此，读者需要下载</span>xwork<span style="font-family:宋体">的源代码，访问</span><a target="_blank" href="http://www.opensymphony.com/xwork/download.action" rel="nofollow noopener noreferrer" style="color:rgb(51,102,153); text-decoration:none"><span style="color:rgb(0,102,204)">http://www.opensymphony.com/xwork/download.action</span></a><span style="font-family:宋体">即可自行下载。</span></p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; text-indent:21pt"> <span style="font-family:宋体">下载的</span>Struts2<span style="font-family:宋体">源代码文件是一个名叫</span>struts-2.1.0-src.zip<span style="font-family:宋体">的压缩包，里面的目录和文件非常多，读者可以定位到</span>struts-2.1.0-src"struts-2.0.10"src"core"src"main"<a target="_blank" style="color:rgb(51,102,153)"><span style="text-decoration:underline"><strong>java</strong></span></a><span style="font-family:宋体">目录下查看</span>Struts2<span style="font-family:宋体">的源文件，如图</span>14<span style="font-family:宋体">所示。</span></p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <img title="点击图片可在新窗口打开" src="https://images2.imgbox.com/37/ba/qhpnbb9x_o.png" alt="" width="407" height="344" style="border:none; max-width:100%"></p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; text-indent:21pt">  </p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; text-indent:21pt"> <span style="font-family:宋体">（图</span>14<span style="font-family:宋体">）</span></p> 
 <h3 style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin:0px; padding:0px"> <a target="_blank" name="t1" style="color:rgb(202,0,0)"></a><a target="_blank" name="t0" style="color:rgb(51,102,153)"></a><span style="font-family:黑体">主要的包和类</span></h3> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; text-indent:21pt"> Struts2<span style="font-family:宋体">框架的正常运行，除了占核心地位的</span>xwork<span style="font-family:宋体">的支持以外，</span>Struts2<span style="font-family:宋体">本身也提供了许多类，这些类被分门别类组织到不同的包中。从源代码中发现，基本上每一个</span>Struts2<span style="font-family:宋体">类都访问了</span>WebWork<span style="font-family:宋体">提供的功能，从而也可以看出</span>Struts2<span style="font-family:宋体">与</span>WebWork<span style="font-family:宋体">千丝万缕的联系。但无论如何，</span>Struts2<span style="font-family:宋体">的核心功能比如将请求委托给哪个</span>Action<span style="font-family:宋体">处理都是由</span>xwork<span style="font-family:宋体">完成的，</span>Struts2<span style="font-family:宋体">只是在</span>WebWork<span style="font-family:宋体">的基础上做了适当的简化、加强和封装，并少量保留</span>Struts1.x<span style="font-family:宋体">中的习惯。</span></p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; text-indent:21pt"> <span style="font-family:宋体">以下是对各包的简要说明：</span></p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> </p> 
 <table border="1" cellspacing="0" cellpadding="0" style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-left:23.4pt; border-collapse:collapse"><tbody><tr><td width="216" style="padding:0cm 5.4pt; background-color:rgb(230,230,230); width:162pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <strong><span style="font-family:宋体">包名</span></strong></p> </td><td width="417" style="padding:0cm 5.4pt; background-color:rgb(230,230,230); width:313pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <strong><span style="font-family:宋体">说明</span></strong></p> </td></tr><tr><td width="216" style="padding:0cm 5.4pt; width:162pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> org.apache.struts2. components</p> </td><td width="417" style="padding:0cm 5.4pt; width:313pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <span style="font-family:宋体">该包封装视图组件，</span>Struts2<span style="font-family:宋体">在视图组件上有了很大加强，不仅增加了组件的属性个数，更新增了几个非常有用的组件，如</span>updownselect<span style="font-family:宋体">、</span>doubleselect<span style="font-family:宋体">、</span>datetimepicker<span style="font-family:宋体">、</span>token<span style="font-family:宋体">、</span>tree<span style="font-family:宋体">等。</span></p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <span style="font-family:宋体">另外，</span>Struts2<span style="font-family:宋体">可视化视图组件开始支持主题</span>(theme)<span style="font-family:宋体">，缺省情况下，使用自带的缺省主题，如果要自定义页面效果，需要将组件的</span>theme<span style="font-family:宋体">属性设置为</span>simple<span style="font-family:宋体">。</span></p> </td></tr><tr><td width="216" style="padding:0cm 5.4pt; width:162pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> org.apache.struts2. config</p> </td><td width="417" style="padding:0cm 5.4pt; width:313pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <span style="font-family:宋体">该包定义与配置相关的接口和类。实际上，工程中的</span>xml<span style="font-family:宋体">和</span>properties<span style="font-family:宋体">文件的读取和解析都是由</span>WebWork<span style="font-family:宋体">完成的，</span>Struts<span style="font-family:宋体">只做了少量的工作。</span></p> </td></tr><tr><td width="216" style="padding:0cm 5.4pt; width:162pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> org.apache.struts2.dispatcher</p> </td><td width="417" style="padding:0cm 5.4pt; width:313pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> Struts2<span style="font-family:宋体">的核心包，最重要的类都放在该包中。</span></p> </td></tr><tr><td width="216" style="padding:0cm 5.4pt; width:162pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> org.apache.struts2.impl</p> </td><td width="417" style="padding:0cm 5.4pt; width:313pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <span style="font-family:宋体">该包只定义了</span>3<span style="font-family:宋体">个类，他们是</span>StrutsActionProxy<span style="font-family:宋体">、</span>StrutsActionProxyFactory<span style="font-family:宋体">、</span>StrutsObjectFactory<span style="font-family:宋体">，这三个类都是对</span>xwork<span style="font-family:宋体">的扩展。</span></p> </td></tr><tr><td width="216" style="padding:0cm 5.4pt; width:162pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> org.apache.struts2.interceptor</p> </td><td width="417" style="padding:0cm 5.4pt; width:313pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <span style="font-family:宋体">定义内置的截拦器。</span></p> </td></tr><tr><td width="216" style="padding:0cm 5.4pt; width:162pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> org.apache.struts2.util</p> </td><td width="417" style="padding:0cm 5.4pt; width:313pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <span style="font-family:宋体">实用包。</span></p> </td></tr><tr><td width="216" style="padding:0cm 5.4pt; width:162pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> org.apache.struts2.validators</p> </td><td width="417" style="padding:0cm 5.4pt; width:313pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <span style="font-family:宋体">只定义了一个类：</span>DWRValidator<span style="font-family:宋体">。</span></p> </td></tr><tr><td width="216" style="padding:0cm 5.4pt; width:162pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> org.apache.struts2.views</p> </td><td width="417" style="padding:0cm 5.4pt; width:313pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <span style="font-family:宋体">提供</span>freemarker<span style="font-family:宋体">、</span>jsp<span style="font-family:宋体">、</span>velocity<span style="font-family:宋体">等不同类型的页面呈现。</span></p> </td></tr></tbody></table> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> </p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; text-indent:21pt"> <span style="font-family:宋体">下表是对一些重要类的说明：</span></p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> </p> 
 <table border="1" cellspacing="0" cellpadding="0" style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-left:23.4pt; border-collapse:collapse"><tbody><tr><td width="288" style="padding:0cm 5.4pt; background-color:rgb(230,230,230); width:216pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <strong><span style="font-family:宋体">类名</span></strong></p> </td><td width="345" style="padding:0cm 5.4pt; background-color:rgb(230,230,230); width:259pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <strong><span style="font-family:宋体">说明</span></strong></p> </td></tr><tr><td width="288" style="padding:0cm 5.4pt; width:216pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> org.apache.struts2.dispatcher. Dispatcher</p> </td><td width="345" style="padding:0cm 5.4pt; width:259pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">       <span style="font-family:宋体">该类有两个作用：</span></p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">        1<span style="font-family:宋体">、初始化</span></p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">        2<span style="font-family:宋体">、调用指定的</span>Action<span style="font-family:宋体">的</span>execute()<span style="font-family:宋体">方法。</span></p> </td></tr><tr><td width="288" style="padding:0cm 5.4pt; width:216pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> org.apache.struts2.dispatcher. FilterDispatcher</p> </td><td width="345" style="padding:0cm 5.4pt; width:259pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">       <span style="font-family:宋体">这是一个过滤器。文档中已明确说明，如果没有经验，配置时请将</span>url-pattern<span style="font-family:宋体">的值设成</span>/*<span style="font-family:宋体">。</span></p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">       <span style="font-family:宋体">该类有四个作用：</span></p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">        1<span style="font-family:宋体">、执行</span>Action</p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">        2<span style="font-family:宋体">、清理</span>ActionContext<span style="font-family:宋体">，避免内存泄漏</span></p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">        3<span style="font-family:宋体">、处理静态内容（</span>Serving static content<span style="font-family:宋体">）</span></p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">        4<span style="font-family:宋体">、为请求启动</span>xwork’s<span style="font-family:宋体">的截拦器链。</span></p> </td></tr><tr><td width="288" style="padding:0cm 5.4pt; width:216pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> com.opensymphony.xwork2. ActionProxy</p> </td><td width="345" style="padding:0cm 5.4pt; width:259pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">        Action<span style="font-family:宋体">的代理接口。</span></p> </td></tr><tr><td width="288" style="padding:0cm 5.4pt; width:216pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> com.opensymphony.xwork2. ctionProxyFactory</p> </td><td width="345" style="padding:0cm 5.4pt; width:259pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">       <span style="font-family:宋体">生产</span>ActionProxy<span style="font-family:宋体">的工厂。</span></p> </td></tr><tr><td width="288" style="padding:0cm 5.4pt; width:216pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> com.opensymphony.xwork2.ActionInvocation</p> </td><td width="345" style="padding:0cm 5.4pt; width:259pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">       <span style="font-family:宋体">负责调用</span>Action<span style="font-family:宋体">和截拦器。</span></p> </td></tr><tr><td width="288" style="padding:0cm 5.4pt; width:216pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> com.opensymphony.xwork2.config.providers. XmlConfigurationProvider</p> </td><td width="345" style="padding:0cm 5.4pt; width:259pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">       <span style="font-family:宋体">负责</span>Struts2<span style="font-family:宋体">的配置文件的解析。</span></p> </td></tr></tbody></table> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> </p> 
 <h3 style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin:0px; padding:0px"> <a target="_blank" name="t2" style="color:rgb(202,0,0)"></a><a target="_blank" name="t1" style="color:rgb(51,102,153)"></a>Struts2<span style="font-family:黑体">的工作机制</span></h3> 
 <h4 style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin:0px; padding:0px"> <a target="_blank" name="t3" style="color:rgb(202,0,0)"></a><a target="_blank" name="t2" style="color:rgb(51,102,153)"></a>3.1Struts2<span style="font-family:宋体">体系结构图</span></h4> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">        Strut2<span style="font-family:宋体">的体系结构如图</span>15<span style="font-family:宋体">所示：</span></p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <img title="点击图片可在新窗口打开" src="https://images2.imgbox.com/04/04/oW9IqHf2_o.png" alt="" width="640" height="750" style="border:none; max-width:100%"></p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; text-indent:21pt">  </p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">       <span style="font-family:宋体">（图</span>15<span style="font-family:宋体">）</span></p> 
 <h4 style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin:0px; padding:0px"> <a target="_blank" name="t4" style="color:rgb(202,0,0)"></a><a target="_blank" name="t3" style="color:rgb(51,102,153)"></a>3.2Struts2<span style="font-family:宋体">的工作机制</span></h4> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">       <span style="font-family:宋体">从图</span>15<span style="font-family:宋体">可以看出，一个请求在</span>Struts2<span style="font-family:宋体">框架中的处理大概分为以下几个步骤：</span></p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; text-indent:21pt"> 1<span style="font-family:宋体">、客户端初始化一个指向</span>Servlet<span style="font-family:宋体">容器（例如</span>Tomcat<span style="font-family:宋体">）的请求；</span></p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; text-indent:21pt"> 2<span style="font-family:宋体">、这个请求经过一系列的过滤器（</span>Filter<span style="font-family:宋体">）（这些过滤器中有一个叫做</span>ActionContextCleanUp<span style="font-family:宋体">的可选过滤器，这个过滤器对于</span>Struts2<span style="font-family:宋体">和其他框架的集成很有帮助，例如：</span>SiteMesh Plugin<span style="font-family:宋体">）；</span></p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; text-indent:21pt"> 3<span style="font-family:宋体">、接着</span>FilterDispatcher<span style="font-family:宋体">被调用，</span>FilterDispatcher<span style="font-family:宋体">询问</span>ActionMapper<span style="font-family:宋体">来决定这个请求是否需要调用某个</span>Action<span style="font-family:宋体">；</span></p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; text-indent:21pt"> 4<span style="font-family:宋体">、如果</span>ActionMapper<span style="font-family:宋体">决定需要调用某个</span>Action<span style="font-family:宋体">，</span>FilterDispatcher<span style="font-family:宋体">把请求的处理交给</span>ActionProxy<span style="font-family:宋体">；</span></p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; text-indent:21pt"> 5<span style="font-family:宋体">、</span>ActionProxy<span style="font-family:宋体">通过</span>Configuration Manager<span style="font-family:宋体">询问框架的配置文件，找到需要调用的</span>Action<span style="font-family:宋体">类；</span></p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; text-indent:21pt"> 6<span style="font-family:宋体">、</span>ActionProxy<span style="font-family:宋体">创建一个</span>ActionInvocation<span style="font-family:宋体">的实例。</span></p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; text-indent:21pt"> 7<span style="font-family:宋体">、</span>ActionInvocation<span style="font-family:宋体">实例使用命名模式来调用，在调用</span>Action<span style="font-family:宋体">的过程前后，涉及到相关拦截器（</span>Intercepter<span style="font-family:宋体">）的调用。</span></p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; text-indent:21pt"> 8<span style="font-family:宋体">、一旦</span>Action<span style="font-family:宋体">执行完毕，</span>ActionInvocation<span style="font-family:宋体">负责根据</span>struts.xml<span style="font-family:宋体">中的配置找到对应的返回结果。返回结果通常是（但不总是，也可能是另外的一个</span>Action<span style="font-family:宋体">链）一个需要被表示的</span>JSP<span style="font-family:宋体">或者</span>FreeMarker<span style="font-family:宋体">的模版。在表示的过程中可以使用</span>Struts2<span style="font-family:宋体">框架中继承的标签。在这个过程中需要涉及到</span>ActionMapper<span style="font-family:宋体">。</span></p> 
 <div style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; padding:1pt 4pt; background-color:rgb(255,255,153); border:1pt solid windowtext"> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="font-family:宋体">注：以上步骤参考至网上，具体网址已忘记。在此表示感谢！</span></p> 
 </div> 
 <h4 style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin:0px; padding:0px"> <a target="_blank" name="t5" style="color:rgb(202,0,0)"></a><a target="_blank" name="t4" style="color:rgb(51,102,153)"></a>3.3Struts2<span style="font-family:宋体">源代码分析</span></h4> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">       <span style="font-family:宋体">和</span>Struts1.x<span style="font-family:宋体">不同，</span>Struts2<span style="font-family:宋体">的启动是通过</span>FilterDispatcher<span style="font-family:宋体">过滤器实现的。下面是该过滤器在</span>web.xml<span style="font-family:宋体">文件中的配置：</span></p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <strong><em><span style="font-family:宋体">代码清单</span>6<span style="font-family:宋体">：</span>web.xml<span style="font-family:宋体">（截取）</span></em></strong></p> 
 <div style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; padding:1pt 4pt; border:1pt solid windowtext"> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><span style="color:teal; font-family:'Courier New'">&lt;</span><span style="color:rgb(63,127,127); font-family:'Courier New'">filter</span><span style="color:teal; font-family:'Courier New'">&gt;</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">      </span><span style="color:teal; font-family:'Courier New'">&lt;</span><span style="color:rgb(63,127,127); font-family:'Courier New'">filter-name</span><span style="color:teal; font-family:'Courier New'">&gt;</span><span style="color:black; font-family:'Courier New'">struts2</span><span style="color:teal; font-family:'Courier New'">&lt;/</span><span style="color:rgb(63,127,127); font-family:'Courier New'">filter-name</span><span style="color:teal; font-family:'Courier New'">&gt;</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">      </span><span style="color:teal; font-family:'Courier New'">&lt;</span><span style="color:rgb(63,127,127); font-family:'Courier New'">filter-class</span><span style="color:teal; font-family:'Courier New'">&gt;</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">           org.apache.struts2.dispatcher.FilterDispatcher</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">      </span><span style="color:teal; font-family:'Courier New'">&lt;/</span><span style="color:rgb(63,127,127); font-family:'Courier New'">filter-class</span><span style="color:teal; font-family:'Courier New'">&gt;</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><span style="color:teal; font-family:'Courier New'">&lt;/</span><span style="color:rgb(63,127,127); font-family:'Courier New'">filter</span><span style="color:teal; font-family:'Courier New'">&gt;</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><span style="color:teal; font-family:'Courier New'">&lt;</span><span style="color:rgb(63,127,127); font-family:'Courier New'">filter-mapping</span><span style="color:teal; font-family:'Courier New'">&gt;</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">      </span><span style="color:teal; font-family:'Courier New'">&lt;</span><span style="color:rgb(63,127,127); font-family:'Courier New'">filter-name</span><span style="color:teal; font-family:'Courier New'">&gt;</span><span style="color:black; font-family:'Courier New'">struts2</span><span style="color:teal; font-family:'Courier New'">&lt;/</span><span style="color:rgb(63,127,127); font-family:'Courier New'">filter-name</span><span style="color:teal; font-family:'Courier New'">&gt;</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">      </span><span style="color:teal; font-family:'Courier New'">&lt;</span><span style="color:rgb(63,127,127); font-family:'Courier New'">url-pattern</span><span style="color:teal; font-family:'Courier New'">&gt;</span><span style="color:black; font-family:'Courier New'">/*</span><span style="color:teal; font-family:'Courier New'">&lt;/</span><span style="color:rgb(63,127,127); font-family:'Courier New'">url-pattern</span><span style="color:teal; font-family:'Courier New'">&gt;</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><span style="color:teal; font-family:'Courier New'">&lt;/</span><span style="color:rgb(63,127,127); font-family:'Courier New'">filter-mapping</span><span style="color:teal; font-family:'Courier New'">&gt;</span></p> 
 </div> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">        Struts2<span style="font-family:宋体">建议，在对</span>Struts2<span style="font-family:宋体">的配置尚不熟悉的情况下，将</span>url-pattern<span style="font-family:宋体">配置为</span>/*<span style="font-family:宋体">，这样该过滤器将截拦所有请求。</span></p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">       <span style="font-family:宋体">实际上，</span><span style="color:black; font-family:'Courier New'">FilterDispatcher</span><span style="color:black; font-family:宋体">除了实现</span><span style="color:black; font-family:'Courier New'">Filter</span><span style="color:black; font-family:宋体">接口以外，还实现了</span><span style="color:black; font-family:'Courier New'">StrutsStatics</span><span style="color:black; font-family:宋体">接口，继承代码如下：</span></p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <strong><em><span style="color:black; font-family:宋体">代码清单</span><span style="color:black; font-family:'Courier New'">7</span><span style="color:black; font-family:宋体">：</span><span style="color:black; font-family:'Courier New'">FilterDispatcher</span><span style="color:black; font-family:宋体">结构</span></em></strong></p> 
 <div style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; padding:1pt 4pt; border:1pt solid windowtext"> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">public</span><span style="color:rgb(127,0,85); font-family:'Courier New'">class</span></strong><span style="color:black; font-family:'Courier New'">FilterDispatcher</span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">implements</span></strong><span style="color:black; font-family:'Courier New'">StrutsStatics, Filter {<!-- --></span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">}</span></p> 
 </div> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <span style="color:black; font-family:'Courier New'">StrutsStatics</span><span style="color:black; font-family:宋体">并没有定义业务方法，只定义了若干个常量。</span><span style="color:black; font-family:'Courier New'">Struts2</span><span style="color:black; font-family:宋体">对常用的接口进行了重新封装，比如</span><span style="color:black; font-family:'Courier New'">HttpServletRequest</span><span style="color:black; font-family:宋体">、</span><span style="color:black; font-family:'Courier New'">HttpServletResponse</span><span style="color:black; font-family:宋体">、</span><span style="color:black; font-family:'Courier New'">HttpServletContext</span><span style="color:black; font-family:宋体">等。　以下是</span><span style="color:black; font-family:'Courier New'">StrutsStatics</span><span style="color:black; font-family:宋体">的定义：</span></p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <strong><em><span style="color:black; font-family:宋体">代码清单</span><span style="color:black; font-family:'Courier New'">8</span><span style="color:black; font-family:宋体">：</span><span style="color:black; font-family:'Courier New'">StrutsStatics.java</span></em></strong></p> 
 <div style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; padding:1pt 4pt; border:1pt solid windowtext"> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">public</span><span style="color:rgb(127,0,85); font-family:'Courier New'">interface</span></strong><span style="color:black; font-family:'Courier New'">StrutsStatics {<!-- --></span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><span style="color:rgb(63,95,191); font-family:'Courier New'">/**</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">    </span><span style="color:rgb(63,95,191); font-family:'Courier New'">*</span><span style="color:rgb(63,95,191); font-family:'Courier New'">Constant</span><span style="color:rgb(63,95,191); font-family:'Courier New'">for</span><span style="color:rgb(63,95,191); font-family:'Courier New'">the</span><span style="color:rgb(63,95,191); font-family:'Courier New'">HTTP</span><span style="color:rgb(63,95,191); font-family:'Courier New'">request</span><span style="color:rgb(63,95,191); font-family:'Courier New'">object.</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">    </span><span style="color:rgb(63,95,191); font-family:'Courier New'">*/</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">public</span><span style="color:rgb(127,0,85); font-family:'Courier New'">static</span><span style="color:rgb(127,0,85); font-family:'Courier New'">final</span></strong><span style="color:black; font-family:'Courier New'">String</span><em><span style="color:rgb(0,0,192); font-family:'Courier New'">HTTP_REQUEST</span></em><span style="color:black; font-family:'Courier New'">=</span><span style="color:rgb(42,0,255); font-family:'Courier New'">"com.opensymphony.xwork2.dispatcher.HttpServletRequest"</span><span style="color:black; font-family:'Courier New'">;</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><span style="color:rgb(63,95,191); font-family:'Courier New'">/**</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">    </span><span style="color:rgb(63,95,191); font-family:'Courier New'">*</span><span style="color:rgb(63,95,191); font-family:'Courier New'">Constant</span><span style="color:rgb(63,95,191); font-family:'Courier New'">for</span><span style="color:rgb(63,95,191); font-family:'Courier New'">the</span><span style="color:rgb(63,95,191); font-family:'Courier New'">HTTP</span><span style="color:rgb(63,95,191); font-family:'Courier New'">response</span><span style="color:rgb(63,95,191); font-family:'Courier New'">object.</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">    </span><span style="color:rgb(63,95,191); font-family:'Courier New'">*/</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">public</span><span style="color:rgb(127,0,85); font-family:'Courier New'">static</span><span style="color:rgb(127,0,85); font-family:'Courier New'">final</span></strong><span style="color:black; font-family:'Courier New'">String</span><em><span style="color:rgb(0,0,192); font-family:'Courier New'">HTTP_RESPONSE</span></em><span style="color:black; font-family:'Courier New'">=</span><span style="color:rgb(42,0,255); font-family:'Courier New'">"com.opensymphony.xwork2.dispatcher.HttpServletResponse"</span><span style="color:black; font-family:'Courier New'">;</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><span style="color:rgb(63,95,191); font-family:'Courier New'">/**</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">    </span><span style="color:rgb(63,95,191); font-family:'Courier New'">*</span><span style="color:rgb(63,95,191); font-family:'Courier New'">Constant</span><span style="color:rgb(63,95,191); font-family:'Courier New'">for</span><span style="color:rgb(63,95,191); font-family:'Courier New'">an</span><span style="color:rgb(63,95,191); font-family:'Courier New'">HTTP</span><span style="color:rgb(63,63,191); font-family:'Courier New'">request dispatcher}</span><span style="color:rgb(63,95,191); font-family:'Courier New'">.</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">    </span><span style="color:rgb(63,95,191); font-family:'Courier New'">*/</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">public</span><span style="color:rgb(127,0,85); font-family:'Courier New'">static</span><span style="color:rgb(127,0,85); font-family:'Courier New'">final</span></strong><span style="color:black; font-family:'Courier New'">String</span><em><span style="color:rgb(0,0,192); font-family:'Courier New'">SERVLET_DISPATCHER</span></em><span style="color:black; font-family:'Courier New'">=</span><span style="color:rgb(42,0,255); font-family:'Courier New'">"com.opensymphony.xwork2.dispatcher.ServletDispatcher"</span><span style="color:black; font-family:'Courier New'">;</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><span style="color:rgb(63,95,191); font-family:'Courier New'">/**</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">    </span><span style="color:rgb(63,95,191); font-family:'Courier New'">*</span><span style="color:rgb(63,95,191); font-family:'Courier New'">Constant</span><span style="color:rgb(63,95,191); font-family:'Courier New'">for</span><span style="color:rgb(63,95,191); font-family:'Courier New'">the</span><span style="color:rgb(63,63,191); font-family:'Courier New'">servlet context}</span><span style="color:rgb(63,95,191); font-family:'Courier New'">object.</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">    </span><span style="color:rgb(63,95,191); font-family:'Courier New'">*/</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">public</span><span style="color:rgb(127,0,85); font-family:'Courier New'">static</span><span style="color:rgb(127,0,85); font-family:'Courier New'">final</span></strong><span style="color:black; font-family:'Courier New'">String</span><em><span style="color:rgb(0,0,192); font-family:'Courier New'">SERVLET_CONTEXT</span></em><span style="color:black; font-family:'Courier New'">=</span><span style="color:rgb(42,0,255); font-family:'Courier New'">"com.opensymphony.xwork2.dispatcher.ServletContext"</span><span style="color:black; font-family:'Courier New'">;</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><span style="color:rgb(63,95,191); font-family:'Courier New'">/**</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">    </span><span style="color:rgb(63,95,191); font-family:'Courier New'">*</span><span style="color:rgb(63,95,191); font-family:'Courier New'">Constant</span><span style="color:rgb(63,95,191); font-family:'Courier New'">for</span><span style="color:rgb(63,95,191); font-family:'Courier New'">the</span><span style="color:rgb(63,95,191); font-family:'Courier New'">JSP</span><span style="color:rgb(63,63,191); font-family:'Courier New'">page context}</span><span style="color:rgb(63,95,191); font-family:'Courier New'">.</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">    </span><span style="color:rgb(63,95,191); font-family:'Courier New'">*/</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm; text-indent:21pt"> <strong><span style="color:rgb(127,0,85); font-family:'Courier New'">public</span><span style="color:rgb(127,0,85); font-family:'Courier New'">static</span><span style="color:rgb(127,0,85); font-family:'Courier New'">final</span></strong><span style="color:black; font-family:'Courier New'">String</span><em><span style="color:rgb(0,0,192); font-family:'Courier New'">PAGE_CONTEXT</span></em><span style="color:black; font-family:'Courier New'">=</span><span style="color:rgb(42,0,255); font-family:'Courier New'">"com.opensymphony.xwork2.dispatcher.PageContext"</span><span style="color:black; font-family:'Courier New'">;</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><span style="color:rgb(63,95,191); font-family:'Courier New'">/**</span><span style="color:rgb(63,95,191); font-family:'Courier New'">Constant</span><span style="color:rgb(63,95,191); font-family:'Courier New'">for</span><span style="color:rgb(63,95,191); font-family:'Courier New'">the</span><span style="color:rgb(63,95,191); font-family:'Courier New'">PortletContext</span><span style="color:rgb(63,95,191); font-family:'Courier New'">object</span><span style="color:rgb(63,95,191); font-family:'Courier New'">*/</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">public</span><span style="color:rgb(127,0,85); font-family:'Courier New'">static</span><span style="color:rgb(127,0,85); font-family:'Courier New'">final</span></strong><span style="color:black; font-family:'Courier New'">String</span><em><span style="color:rgb(0,0,192); font-family:'Courier New'">STRUTS_PORTLET_CONTEXT</span></em><span style="color:black; font-family:'Courier New'">=</span><span style="color:rgb(42,0,255); font-family:'Courier New'">"struts.portlet.context"</span><span style="color:black; font-family:'Courier New'">;</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">}</span></p> 
 </div> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <span style="color:black; font-family:'Courier New'">   </span><span style="color:black; font-family:宋体">容器启动后，</span><span style="color:black; font-family:'Courier New'">FilterDispatcher</span><span style="color:black; font-family:宋体">被实例化，调用</span><span style="color:black; font-family:'Courier New'">init(FilterConfig filterConfig)</span><span style="color:black; font-family:宋体">方法。该方法创建</span><span style="color:black; font-family:'Courier New'">Dispatcher</span><span style="color:black; font-family:宋体">类的对象，并且将</span><span style="color:black; font-family:'Courier New'">FilterDispatcher</span><span style="color:black; font-family:宋体">配置的初始化参数传到对象中（详情请参考代码清单</span><span style="color:black; font-family:'Courier New'">10</span><span style="color:black; font-family:宋体">），并负责</span><span style="color:black; font-family:'Courier New'">Action</span><span style="color:black; font-family:宋体">的执行。然后得到参数</span><span style="color:black; font-family:'Courier New'">packages</span><span style="color:black; font-family:宋体">，值得注意的是，还有另外三个固定的包和该参数进行拼接，分别是</span><span style="color:black; font-family:'Courier New'">org.apache.struts2.static</span><span style="color:black; font-family:宋体">、</span><span style="color:black; font-family:'Courier New'">template</span><span style="color:black; font-family:宋体">、和</span><span style="color:black; font-family:'Courier New'">org.apache.struts2.interceptor.debugging</span><span style="color:black; font-family:宋体">，中间用空格隔开，经过解析将包名变成路径后存储到一个名叫</span><span style="color:black; font-family:'Courier New'">pathPrefixes</span><span style="color:black; font-family:宋体">的数组中，这些目录中的文件会被自动搜寻。</span></p> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <strong><em><span style="color:black; font-family:宋体">代码清单</span><span style="color:black; font-family:'Courier New'">9</span><span style="color:black; font-family:宋体">：</span><span style="color:black; font-family:'Courier New'">FilterDispatcher.init()</span><span style="color:black; font-family:宋体">方法</span></em></strong></p> 
 <div style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; padding:1pt 4pt; border:1pt solid windowtext"> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">public</span><span style="color:rgb(127,0,85); font-family:'Courier New'">void</span></strong><span style="color:black; font-family:'Courier New'">init(FilterConfig filterConfig)</span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">throws</span></strong><span style="color:black; font-family:'Courier New'">ServletException {<!-- --></span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">this</span></strong><span style="color:black; font-family:'Courier New'">.filterConfig = filterConfig;      </span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       dispatcher = createDispatcher(filterConfig);</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       dispatcher.init();      </span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       String param = filterConfig.getInitParameter(</span><span style="color:rgb(42,0,255); font-family:'Courier New'">"packages"</span><span style="color:black; font-family:'Courier New'">);</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       String packages =</span><span style="color:rgb(42,0,255); font-family:'Courier New'">"org.apache.struts2.static template org.apache.struts2.interceptor.debugging"</span><span style="color:black; font-family:'Courier New'">;</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">if</span></strong><span style="color:black; font-family:'Courier New'">(param !=</span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">null</span></strong><span style="color:black; font-family:'Courier New'">) {<!-- --></span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">            packages = param +</span><span style="color:rgb(42,0,255); font-family:'Courier New'">" "</span><span style="color:black; font-family:'Courier New'">+ packages;</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       }</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">this</span></strong><span style="color:black; font-family:'Courier New'">.</span><span style="color:rgb(0,0,192); font-family:'Courier New'">pathPrefixes</span><span style="color:black; font-family:'Courier New'">= parse(packages);</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm; text-indent:21pt"><span style="color:black; font-family:'Courier New'">}</span></p> 
 </div> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <strong><em><span style="color:black; font-family:宋体">代码清单</span><span style="color:black; font-family:'Courier New'">10</span><span style="color:black; font-family:宋体">：</span><span style="color:black; font-family:'Courier New'">FilterDispatcher.createDispatcher()</span><span style="color:black; font-family:宋体">方法</span></em></strong></p> 
 <div style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; padding:1pt 4pt; border:1pt solid windowtext"> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">protected</span></strong><span style="color:black; font-family:'Courier New'">Dispatcher createDispatcher(FilterConfig filterConfig) {<!-- --></span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       Map&lt;String,String&gt; params =</span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">new</span></strong><span style="color:black; font-family:'Courier New'">HashMap&lt;String,String&gt;();</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">for</span></strong><span style="color:black; font-family:'Courier New'">(Enumeration e = filterConfig.getInitParameterNames(); e.hasMoreElements(); ) {<!-- --></span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">           String name = (String) e.nextElement();</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">           String value = filterConfig.getInitParameter(name);</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">           params.put(name, value);</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       }</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">return</span><span style="color:rgb(127,0,85); font-family:'Courier New'">new</span></strong><span style="color:black; font-family:'Courier New'">Dispatcher(filterConfig.getServletContext(), params);</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   }</span></p> 
 </div> 
 <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px; margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <span style="color:black; font-family:'Courier New'">   </span><span style="color:black; font-family:宋体">当用户向</span><span style="color:black; font-family:'Courier New'">Struts2</span><span style="color:black; font-family:宋体">发送请求时，</span><span style="color:black; font-family:'Courier New'">FilterDispatcher</span><span style="color:black; font-family:宋体">的</span><span style="color:black; font-family:'Courier New'">doFilter()</span><span style="color:black; font-family:宋体">方法自动调用，这个方法非常关键。首先，</span><span style="color:black; font-family:'Courier New'">Struts2</span><span style="color:black; font-family:宋体">对请求对象进行重新包装，此次包装根据请求内容的类型不同，返回不同的对象，如果为</span><span style="color:black; font-family:'Courier New'">multipart/form-data</span><span style="color:black; font-family:宋体">类型，则返回</span><span style="color:black; font-family:'Courier New'">MultiPartRequestWrapper</span><span style="color:black; font-family:宋体">类型的对象，该对象服务于文件上传，否则返回</span><span style="color:black; font-family:'Courier New'">StrutsRequestWrapper</span><span style="color:black; font-family:宋体">类型的对象，</span><span style="color:black; font-family:'Courier New'">MultiPartRequestWrapper</span><span style="color:black; font-family:宋体">是</span><span style="color:black; font-family:'Courier New'">StrutsRequestWrapper</span><span style="color:black; font-family:宋体">的子类，而这两个类都是</span><span style="color:black; font-family:'Courier New'">HttpServletRequest</span><span style="color:black; font-family:宋体">接口的实现。包装请求对象如代码清单</span><span style="color:black; font-family:'Courier New'">11</span><span style="color:black; font-family:宋体">所示：</span></p> 
 <br> 
</div> 
<div id="article_content" style="font-family:Arial; font-size:14px; line-height:26px; color:rgb(51,51,51)"> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">  Struts 2框架本身大致可以分为3个部分：核心控制器FilterDispatcher、业务控制器Action和用户实现的企业业务逻辑组件。</p> 
 <h4 style="margin:0px; padding:0px"><a target="_blank" name="t6" style="color:rgb(202,0,0)"></a><a target="_blank" name="t0" style="color:rgb(51,102,153)"></a><a target="_blank" name="_Toc186012770" style="color:rgb(51,102,153)"></a><a target="_blank" name="_Toc144629395" style="color:rgb(51,102,153)"></a><a target="_blank" name="_Toc114154735" style="color:rgb(51,102,153)"></a><a target="_blank" name="_Toc189040216" style="color:rgb(51,102,153)"></a>3.1.1  核心控制器FilterDispatcher</h4> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">  </p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> 核心控制器FilterDispatcher是Struts 2框架的基础，包含了框架内部的控制流程和处理机制。业务控制器Action和业务逻辑组件是需要用户来自己实现的。用户在开发Action和业务逻辑组件的同时，还需要编写相关的配置文件，供核心控制器FilterDispatcher来使用。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> Struts 2的工作流程相对于Struts 1要简单，与WebWork框架基本相同，所以说Struts 2是WebWork的升级版本。Struts 2框架按照模块来划分，可以分为Servlet Filters、Struts核心模块、拦截器和用户实现部分。Struts 2框架结构图如图3.1所示。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <img src="https://images2.imgbox.com/83/2b/kD8Pm6Ie_o.jpg" alt="" style="border:none; max-width:100%"></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> </p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> 图3.1  Struts 2框架结构图</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> 一个请求在Struts 2框架中的处理大概分为以下几个步骤。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">  客户端提交一个（HttpServletRequest）请求，如上文在浏览器中输入http://localhost: 8080/bookcode/ch2/Reg.action就是提交一个（HttpServletRequest）请求。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">  请求被提交到一系列（主要是3层）的过滤器（Filter），如（ActionContextCleanUp、其他过滤器（SiteMesh等）、FilterDispatcher）。注意：这里是有顺序的，先ActionContext CleanUp，再其他过滤器（Othter Filters、SiteMesh等），最后到FilterDispatcher。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">   FilterDispatcher是控制器的核心，就是MVC的Struts 2实现中控制层（Controller）的核心。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">   FilterDispatcher询问ActionMapper是否需要调用某个Action来处理这个（HttpServlet Request）请求，如果ActionMapper决定需要调用某个Action，FilterDispatcher则把请求的处理交给ActionProxy。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">   ActionProxy通过Configuration Manager（struts.xml）询问框架的配置文件，找到需要调用的Action类。例如，用户注册示例将找到UserReg类。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">   ActionProxy创建一个ActionInvocation实例，同时ActionInvocation通过代理模式调用Action。但在调用之前，ActionInvocation会根据配置加载Action相关的所有Interceptor（拦截器）。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">  一旦Action执行完毕，ActionInvocation负责根据struts.xml中的配置找到对应的返回结果result。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> Struts 2的核心控制器是FilterDispatcher，有3个重要的方法：destroy()、doFilter()和Init()，可以在Struts 2的下载文件夹中找到源代码，如代码3.1所示。</p> 
 <div> 
  <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> 代码3.1  核心控制器FilterDispatcher</p> 
 </div> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">  </p> 
 <div> 
  <img id="_63_3613_Open_Image" src="https://images2.imgbox.com/17/0d/DAfklaUE_o.gif" alt="" align="top" style="border:none; max-width:100%"> 
  <span style="color:rgb(0,0,255)">public</span> 
  <span style="color:rgb(0,0,0)"> </span> 
  <span style="color:rgb(0,0,255)">class</span> 
  <span style="color:rgb(0,0,0)"> FilterDispatcher </span> 
  <span style="color:rgb(0,0,255)">implements</span> 
  <span style="color:rgb(0,0,0)"> StrutsStatics, Filter </span> 
  <span id="_63_3613_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/16/b5/ovTvWOTL_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_70_99_Open_Image" src="https://images2.imgbox.com/91/15/M4ViRs0D_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span id="_70_99_Open_Text"><span style="color:rgb(0,128,0)">/**</span><span style="color:rgb(0,128,0)"><br> <img src="https://images2.imgbox.com/dd/a0/G66v6CyF_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/07/c3/jYdzFVM1_o.gif" alt="" align="top" style="border:none; max-width:100%">     * 定义一个Log实例<br> <img src="https://images2.imgbox.com/3d/87/7w44fbu1_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/e3/0c/CLP9zldG_o.gif" alt="" align="top" style="border:none; max-width:100%">     </span><span style="color:rgb(0,128,0)">*/</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/94/f6/VRH44de2_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/64/8d/cRrQWeJ1_o.gif" alt="" align="top" style="border:none; max-width:100%"></span><span style="color:rgb(0,0,255)">private</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">static</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">final</span><span style="color:rgb(0,0,0)"> Log LOG </span><span style="color:rgb(0,0,0)">=</span><span style="color:rgb(0,0,0)"> LogFactory.getLog(FilterDispatcher.</span><span style="color:rgb(0,0,255)">class</span><span style="color:rgb(0,0,0)">);<br> <img src="https://images2.imgbox.com/9e/68/oYyfP4Op_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/f6/ba/Hvw4dwD2_o.gif" alt="" align="top" style="border:none; max-width:100%">… ...<br> <img src="https://images2.imgbox.com/f6/d6/h2d97oxK_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_188_238_Open_Image" src="https://images2.imgbox.com/e2/68/IJ0IRIKl_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span id="_188_238_Open_Text"><span style="color:rgb(0,128,0)">/**</span><span style="color:rgb(0,128,0)"><br> <img src="https://images2.imgbox.com/71/bb/MiVuR5jq_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/ec/0b/7wK5GATI_o.gif" alt="" align="top" style="border:none; max-width:100%">     * 存放属性文件中的.STRUTS_I18N_ENCODING值<br> <img src="https://images2.imgbox.com/91/5e/I78aGKvf_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/46/43/uTXLzYNU_o.gif" alt="" align="top" style="border:none; max-width:100%">     </span><span style="color:rgb(0,128,0)">*/</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/7a/c3/wrcTzooh_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/70/48/wYDDZkfD_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,0,255)">private</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">static</span><span style="color:rgb(0,0,0)"> String encoding;<br> <img src="https://images2.imgbox.com/7d/46/5QfdW75E_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_282_318_Open_Image" src="https://images2.imgbox.com/06/b7/Vpi3EelX_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span id="_282_318_Open_Text"><span style="color:rgb(0,128,0)">/**</span><span style="color:rgb(0,128,0)"><br> <img src="https://images2.imgbox.com/52/87/LtOJTUOP_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/49/79/NOZ2yuPe_o.gif" alt="" align="top" style="border:none; max-width:100%">     * 定义ActionMapper实例<br> <img src="https://images2.imgbox.com/27/34/vuc4lw7v_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/e5/f4/jYJ8p0nI_o.gif" alt="" align="top" style="border:none; max-width:100%">     </span><span style="color:rgb(0,128,0)">*/</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/1f/2c/izdxncvA_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/19/7f/L9ISWVrk_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,0,255)">private</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">static</span><span style="color:rgb(0,0,0)"> ActionMapper actionMapper;<br> <img src="https://images2.imgbox.com/4b/86/TI75IYA2_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_372_408_Open_Image" src="https://images2.imgbox.com/f5/7f/OWswharR_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span id="_372_408_Open_Text"><span style="color:rgb(0,128,0)">/**</span><span style="color:rgb(0,128,0)"><br> <img src="https://images2.imgbox.com/07/78/AY5uycpP_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/c9/d4/KIyrEIIX_o.gif" alt="" align="top" style="border:none; max-width:100%">     * 定义FilterConfig实例<br> <img src="https://images2.imgbox.com/e5/db/XxGpgGGu_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/b8/4e/EP8H6iQx_o.gif" alt="" align="top" style="border:none; max-width:100%">     </span><span style="color:rgb(0,128,0)">*/</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/ab/20/yVhud5L1_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/2f/b0/muc6GvCX_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,0,255)">private</span><span style="color:rgb(0,0,0)"> FilterConfig filterConfig;<br> <img src="https://images2.imgbox.com/4f/24/E50DSkA2_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/23/fc/1jpqweXe_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,0,255)">protected</span><span style="color:rgb(0,0,0)"> Dispatcher dispatcher;<br> <img src="https://images2.imgbox.com/8a/73/FuWftI31_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_493_568_Open_Image" src="https://images2.imgbox.com/95/df/t2RVicAZ_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span id="_493_568_Open_Text"><span style="color:rgb(0,128,0)">/**</span><span style="color:rgb(0,128,0)"><br> <img src="https://images2.imgbox.com/d5/4e/Qts4qez0_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/f2/d9/QHjxtFYD_o.gif" alt="" align="top" style="border:none; max-width:100%">     * 创建一个默认的dispatcher，初始化filter<br> <img src="https://images2.imgbox.com/42/cf/oj7mAYwc_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/1e/be/bpks3OxB_o.gif" alt="" align="top" style="border:none; max-width:100%">     * 设置默认的packages     *<br> <img src="https://images2.imgbox.com/7c/39/Clxm3mqJ_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/7e/c6/6O0C0ex2_o.gif" alt="" align="top" style="border:none; max-width:100%">     </span><span style="color:rgb(0,128,0)">*/</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/89/3b/s3eC37w5_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_643_1079_Open_Image" src="https://images2.imgbox.com/cd/b5/GucaIMoe_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,0,255)">public</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">void</span><span style="color:rgb(0,0,0)"> init(FilterConfig filterConfig) </span><span style="color:rgb(0,0,255)">throws</span><span style="color:rgb(0,0,0)"> ServletException </span><span id="_643_1079_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/ca/04/KiJhBtHX_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/f2/d1/M3X4y4s5_o.gif" alt="" align="top" style="border:none; max-width:100%">     </span><span style="color:rgb(0,0,255)">this</span><span style="color:rgb(0,0,0)">.filterConfig </span><span style="color:rgb(0,0,0)">=</span><span style="color:rgb(0,0,0)"> filterConfig;<br> <img src="https://images2.imgbox.com/b7/f2/P7goPoJK_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/ee/c0/OYZIn7LQ_o.gif" alt="" align="top" style="border:none; max-width:100%">       dispatcher </span><span style="color:rgb(0,0,0)">=</span><span style="color:rgb(0,0,0)"> createDispatcher(filterConfig);<br> <img src="https://images2.imgbox.com/fd/e8/SGD2Olbo_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/05/39/AuVTH8Ir_o.gif" alt="" align="top" style="border:none; max-width:100%">        dispatcher.init();<br> <img src="https://images2.imgbox.com/0c/34/15cxfBOC_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/c8/2b/DpXhyBwc_o.gif" alt="" align="top" style="border:none; max-width:100%">        String param </span><span style="color:rgb(0,0,0)">=</span><span style="color:rgb(0,0,0)"> filterConfig.getInitParameter(</span><span style="color:rgb(0,0,0)">"</span><span style="color:rgb(0,0,0)">packages</span><span style="color:rgb(0,0,0)">"</span><span style="color:rgb(0,0,0)">);<br> <img src="https://images2.imgbox.com/86/83/sGaIHEBT_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/d8/68/SWpRNHZz_o.gif" alt="" align="top" style="border:none; max-width:100%">        String packages </span><span style="color:rgb(0,0,0)">=</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,0)">"</span><span style="color:rgb(0,0,0)">org.apache.struts2.static template org.apache.struts2.interceptor.debugging</span><span style="color:rgb(0,0,0)">"</span><span style="color:rgb(0,0,0)">;<br> <img src="https://images2.imgbox.com/a0/dc/sEyCDEog_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_967_1026_Open_Image" src="https://images2.imgbox.com/f8/f8/gTuAnsON_o.gif" alt="" align="top" style="border:none; max-width:100%">        </span><span style="color:rgb(0,0,255)">if</span><span style="color:rgb(0,0,0)"> (param </span><span style="color:rgb(0,0,0)">!=</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">null</span><span style="color:rgb(0,0,0)">) </span><span id="_967_1026_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/40/e2/yzdAsAzI_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/ab/46/BLm2rMM8_o.gif" alt="" align="top" style="border:none; max-width:100%">            packages </span><span style="color:rgb(0,0,0)">=</span><span style="color:rgb(0,0,0)"> param </span><span style="color:rgb(0,0,0)">+</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,0)">"</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,0)">"</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,0)">+</span><span style="color:rgb(0,0,0)"> packages;<br> <img src="https://images2.imgbox.com/57/98/j7HcN7kW_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/ce/92/WYgdymlC_o.gif" alt="" align="top" style="border:none; max-width:100%">        }</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/e3/4b/UyMTGKcR_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/5b/a1/oHH3YX2j_o.gif" alt="" align="top" style="border:none; max-width:100%">        </span><span style="color:rgb(0,0,255)">this</span><span style="color:rgb(0,0,0)">.pathPrefixes </span><span style="color:rgb(0,0,0)">=</span><span style="color:rgb(0,0,0)"> parse(packages);<br> <img src="https://images2.imgbox.com/70/89/dtyyEYAe_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/99/9b/hQVwfpT4_o.gif" alt="" align="top" style="border:none; max-width:100%">    }</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/44/11/488oe1N7_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/27/7c/YdLqNkBN_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,128,0)">//</span><span style="color:rgb(0,128,0)">销毁filter方法</span><span style="color:rgb(0,128,0)"><br> <img src="https://images2.imgbox.com/bb/cf/tflrZ8yf_o.gif" alt="" align="top" style="border:none; max-width:100%"></span><span style="color:rgb(0,0,0)"><br> <img id="_1125_1325_Open_Image" src="https://images2.imgbox.com/5f/a3/0LQqa1bb_o.gif" alt="" align="top" style="border:none; max-width:100%">   </span><span style="color:rgb(0,0,255)">public</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">void</span><span style="color:rgb(0,0,0)"> destroy() </span><span id="_1125_1325_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/38/cb/Xfj4pf9m_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_1160_1265_Open_Image" src="https://images2.imgbox.com/b6/30/r4OKwLV5_o.gif" alt="" align="top" style="border:none; max-width:100%">        </span><span style="color:rgb(0,0,255)">if</span><span style="color:rgb(0,0,0)"> (dispatcher </span><span style="color:rgb(0,0,0)">==</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">null</span><span style="color:rgb(0,0,0)">) </span><span id="_1160_1265_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/a6/7d/nNHoe662_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/fc/cb/rN2pFbwA_o.gif" alt="" align="top" style="border:none; max-width:100%">            LOG.warn(</span><span style="color:rgb(0,0,0)">"</span><span style="color:rgb(0,0,0)">something is seriously wrong, Dispatcher is not initialized (null) </span><span style="color:rgb(0,0,0)">"</span><span style="color:rgb(0,0,0)">);<br> <img src="https://images2.imgbox.com/d8/13/cIrUhFkF_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_1272_1318_Open_Image" src="https://images2.imgbox.com/45/14/71QRzmwh_o.gif" alt="" align="top" style="border:none; max-width:100%">        }</span></span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">else</span><span style="color:rgb(0,0,0)"> </span><span id="_1272_1318_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/c8/ea/VeT7Z6Ox_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/ab/5c/wWdYRXmK_o.gif" alt="" align="top" style="border:none; max-width:100%">            dispatcher.cleanup();<br> <img src="https://images2.imgbox.com/9d/fe/x3yZYQSK_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/d2/6b/iivGfWve_o.gif" alt="" align="top" style="border:none; max-width:100%">        }</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/93/67/666ZJqwp_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/de/7c/HiyqYQHc_o.gif" alt="" align="top" style="border:none; max-width:100%">    }</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/68/aa/o8zLvkZU_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_1332_3613_Open_Image" src="https://images2.imgbox.com/28/e4/LozADAJW_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span id="_1332_3613_Open_Text"><span style="color:rgb(0,128,0)">/**</span><span style="color:rgb(0,128,0)"><br> <img src="https://images2.imgbox.com/06/29/b5EKw0VW_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/75/15/BSbLa9dM_o.gif" alt="" align="top" style="border:none; max-width:100%">     * 处理一个Action或者资源请求<br> <img src="https://images2.imgbox.com/d2/bc/7aYYbe6S_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/e0/41/bKiB4Y4O_o.gif" alt="" align="top" style="border:none; max-width:100%">     * &lt;p/&gt;<br> <img src="https://images2.imgbox.com/53/5d/qivC50mb_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/d6/99/Xaey5cZO_o.gif" alt="" align="top" style="border:none; max-width:100%">     * filter尝试将请求同action mapping相匹配<br> <img src="https://images2.imgbox.com/fd/88/B8U259x2_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/96/83/VwvTgdk6_o.gif" alt="" align="top" style="border:none; max-width:100%">     * 如果找到，将执行dispatcher的serviceAction方法<br> <img src="https://images2.imgbox.com/f0/15/f1cA8cRk_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/c5/63/JIyKUigo_o.gif" alt="" align="top" style="border:none; max-width:100%">     * 如果Action处理失败, doFilter将建立一个异常<br> <img src="https://images2.imgbox.com/39/d8/66kVS2s2_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/00/5e/qzkoTaRi_o.gif" alt="" align="top" style="border:none; max-width:100%">     * &lt;p/&gt;<br> <img src="https://images2.imgbox.com/c5/8b/ApjW1KUY_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/58/41/h7zfTCXa_o.gif" alt="" align="top" style="border:none; max-width:100%">     * 如果请求静态资源<br> <img src="https://images2.imgbox.com/65/69/HnQQpfGA_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/4d/1d/Qogp52sX_o.gif" alt="" align="top" style="border:none; max-width:100%">     * 资源将被直接复制给 response<br> <img src="https://images2.imgbox.com/87/b1/CmtAOXAW_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/5f/ad/UcPDOg5w_o.gif" alt="" align="top" style="border:none; max-width:100%">     * &lt;p/&gt;<br> <img src="https://images2.imgbox.com/b4/ac/c8jDG2BI_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/8d/0d/PEigBXAG_o.gif" alt="" align="top" style="border:none; max-width:100%">     * 如果找不到匹配Action 或者静态资源，则直接跳出<br> <img src="https://images2.imgbox.com/8b/09/Z7VibPWl_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/2e/c8/4K3oXYNm_o.gif" alt="" align="top" style="border:none; max-width:100%">     public void doFilter(ServletRequest req, ServletResponse res, FilterChain chain) throws IOException, ServletException {<!-- --><br> <img src="https://images2.imgbox.com/65/5a/IKc6Pkoj_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/a9/49/ek4RnYbO_o.gif" alt="" align="top" style="border:none; max-width:100%">        HttpServletRequest request = (HttpServletRequest) req;<br> <img src="https://images2.imgbox.com/ba/bc/G5jtw17o_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/be/c8/BSUzfvsl_o.gif" alt="" align="top" style="border:none; max-width:100%">        HttpServletResponse response = (HttpServletResponse) res;<br> <img src="https://images2.imgbox.com/42/45/GlB1JmU8_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/44/71/CeiRnVDB_o.gif" alt="" align="top" style="border:none; max-width:100%">        ServletContext servletContext = getServletContext();<br> <img src="https://images2.imgbox.com/8d/8d/UYP8dZXa_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/ba/51/LOlSDHM3_o.gif" alt="" align="top" style="border:none; max-width:100%">        String timerKey = "FilterDispatcher_doFilter: ";<br> <img src="https://images2.imgbox.com/b2/54/MtFn3yZA_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/d1/88/HyHkMrJY_o.gif" alt="" align="top" style="border:none; max-width:100%">        try {<!-- --><br> <img src="https://images2.imgbox.com/19/32/SVtHXhXo_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/02/de/OQsSirqd_o.gif" alt="" align="top" style="border:none; max-width:100%">            UtilTimerStack.push(timerKey);<br> <img src="https://images2.imgbox.com/a1/ac/8Od3b4sG_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/e5/a8/gj7NhIvr_o.gif" alt="" align="top" style="border:none; max-width:100%">            request = prepareDispatcherAndWrapRequest(request, response);<br> <img src="https://images2.imgbox.com/5c/9e/jXNfsHrQ_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/eb/07/vzncYLRI_o.gif" alt="" align="top" style="border:none; max-width:100%">            ActionMapping mapping;<br> <img src="https://images2.imgbox.com/76/57/72S4kGw9_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/30/98/e1VjjUzc_o.gif" alt="" align="top" style="border:none; max-width:100%">            try {<!-- --><br> <img src="https://images2.imgbox.com/c4/fa/vsNxp6mv_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/d3/a0/l78IVqvY_o.gif" alt="" align="top" style="border:none; max-width:100%">                mapping=actionMapper.getMapping(request, dispatcher.getConfigurationManager());<br> <img src="https://images2.imgbox.com/84/62/NzKCsSD1_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/b5/b1/jkbX7Jem_o.gif" alt="" align="top" style="border:none; max-width:100%">            } catch (Exception ex) {<!-- --><br> <img src="https://images2.imgbox.com/87/fe/irsSGYUf_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/b5/e9/KbF9upb9_o.gif" alt="" align="top" style="border:none; max-width:100%">                LOG.error("error getting ActionMapping", ex);<br> <img src="https://images2.imgbox.com/71/49/tDCeljJb_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/da/e4/IyzwRqIM_o.gif" alt="" align="top" style="border:none; max-width:100%">                dispatcher.sendError(request, response, servletContext, HttpServletResponse.SC_INTERNAL_SERVER_ERROR, ex);<br> <img src="https://images2.imgbox.com/af/c5/GDBOnXCN_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/d5/cd/yynJckYA_o.gif" alt="" align="top" style="border:none; max-width:100%">                return;<br> <img src="https://images2.imgbox.com/b9/89/AI4jycyU_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/cf/1d/18hD44dZ_o.gif" alt="" align="top" style="border:none; max-width:100%">            }<br> <img src="https://images2.imgbox.com/f8/52/5TsGUNty_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/ae/ba/0IurNUzL_o.gif" alt="" align="top" style="border:none; max-width:100%">            if (mapping == null) {<!-- --><br> <img src="https://images2.imgbox.com/b6/65/UiEvWv7A_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/73/1c/Lqht6Fto_o.gif" alt="" align="top" style="border:none; max-width:100%">                String resourcePath = RequestUtils.getServletPath(request);<br> <img src="https://images2.imgbox.com/19/07/kJ21MTGo_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/48/5d/ZpKzATnX_o.gif" alt="" align="top" style="border:none; max-width:100%">                if ("".equals(resourcePath) &amp;&amp; null != request.getPathInfo()) {<!-- --><br> <img src="https://images2.imgbox.com/35/95/pMRCLosJ_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/3e/58/uCmb2Fax_o.gif" alt="" align="top" style="border:none; max-width:100%">                    resourcePath = request.getPathInfo();<br> <img src="https://images2.imgbox.com/5b/ac/RKdvvrEB_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/fe/78/hnQvNbKq_o.gif" alt="" align="top" style="border:none; max-width:100%">                }<br> <img src="https://images2.imgbox.com/c6/4e/J8F9SIZw_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/64/b7/QKQm3Z4M_o.gif" alt="" align="top" style="border:none; max-width:100%">                if (serveStatic &amp;&amp; resourcePath.startsWith("/struts")) {<!-- --><br> <img src="https://images2.imgbox.com/9d/6e/mhcOwkoG_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/72/24/6GcdrE95_o.gif" alt="" align="top" style="border:none; max-width:100%">                    String name = resourcePath.substring("/struts".length());<br> <img src="https://images2.imgbox.com/c2/ca/fHhNmts1_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/dc/4f/T1HyBFti_o.gif" alt="" align="top" style="border:none; max-width:100%">                    findStaticResource(name, request, response);<br> <img src="https://images2.imgbox.com/17/76/C5cStMnB_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/3d/ac/Xq9kjspS_o.gif" alt="" align="top" style="border:none; max-width:100%">                } else {<!-- --><br> <img src="https://images2.imgbox.com/04/f7/y3da3RXB_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/d9/9c/NeBK1AKO_o.gif" alt="" align="top" style="border:none; max-width:100%">                    //为一个普通的request, 则通过<br> <img src="https://images2.imgbox.com/50/40/MmGDY6P9_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/d0/bb/RET3e312_o.gif" alt="" align="top" style="border:none; max-width:100%">                    chain.doFilter(request, response);<br> <img src="https://images2.imgbox.com/cd/44/TFkyUn6K_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/b9/80/ZuBJ0cFm_o.gif" alt="" align="top" style="border:none; max-width:100%">                }<br> <img src="https://images2.imgbox.com/ea/69/9IOmOkLt_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/45/53/ZoNxz0cm_o.gif" alt="" align="top" style="border:none; max-width:100%">                return;<br> <img src="https://images2.imgbox.com/a7/4a/SZM2KFQl_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/84/63/teYLzcIc_o.gif" alt="" align="top" style="border:none; max-width:100%">            }<br> <img src="https://images2.imgbox.com/14/b2/qFXBWOFP_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/75/98/AZkYePCR_o.gif" alt="" align="top" style="border:none; max-width:100%">/**<br> <img src="https://images2.imgbox.com/d1/8f/EEX3tt9m_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/60/9d/l19Y5xIK_o.gif" alt="" align="top" style="border:none; max-width:100%">*这个方法询问ActionMapper是否需要调用某个Action来处理这个（request）请求，<br> <img src="https://images2.imgbox.com/8e/b8/F7UlH9V6_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/26/fa/LUfZggVx_o.gif" alt="" align="top" style="border:none; max-width:100%">*如果ActionMapper决定需要调用某个Action，<br> <img src="https://images2.imgbox.com/e3/e3/A2AG1sMo_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/17/b3/IyST873p_o.gif" alt="" align="top" style="border:none; max-width:100%">*FilterDispatcher则把请求的处理交给ActionProxy<br> <img src="https://images2.imgbox.com/93/ed/OIb5VKY8_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/c9/db/9J9Bfezd_o.gif" alt="" align="top" style="border:none; max-width:100%">            dispatcher.serviceAction(request, response, servletContext, mapping);<br> <img src="https://images2.imgbox.com/9d/61/PJ4Udvx0_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/bb/99/9UW3NjfV_o.gif" alt="" align="top" style="border:none; max-width:100%">        } finally {<!-- --><br> <img src="https://images2.imgbox.com/a1/75/UVE4eLJf_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/76/75/glZM03YK_o.gif" alt="" align="top" style="border:none; max-width:100%">            try {<!-- --><br> <img src="https://images2.imgbox.com/32/a7/13P2RHeA_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/9e/f6/v6D0hpJV_o.gif" alt="" align="top" style="border:none; max-width:100%">                ActionContextCleanUp.cleanUp(req);<br> <img src="https://images2.imgbox.com/78/3c/92q0kZcD_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/78/d8/1X15v2ue_o.gif" alt="" align="top" style="border:none; max-width:100%">            } finally {<!-- --><br> <img src="https://images2.imgbox.com/d2/c3/PD0EA6JX_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/94/83/ZScdgi9s_o.gif" alt="" align="top" style="border:none; max-width:100%">                UtilTimerStack.pop(timerKey);<br> <img src="https://images2.imgbox.com/5d/65/9OiBPgt9_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/1f/e4/c0Aq1Zd0_o.gif" alt="" align="top" style="border:none; max-width:100%">            }<br> <img src="https://images2.imgbox.com/25/74/V7hvq9sj_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/5e/37/mQpr91sx_o.gif" alt="" align="top" style="border:none; max-width:100%">        }<br> <img src="https://images2.imgbox.com/4f/2b/dddQHLWG_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/d4/ff/ulzon7LG_o.gif" alt="" align="top" style="border:none; max-width:100%">}<br> <img src="https://images2.imgbox.com/a6/24/GP4BPqbj_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/ab/33/3hMlR5ti_o.gif" alt="" align="top" style="border:none; max-width:100%">… …<br> <img src="https://images2.imgbox.com/8b/af/qaMcm3Pr_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/91/98/ZHvj574N_o.gif" alt="" align="top" style="border:none; max-width:100%">}<br> <img src="https://images2.imgbox.com/f3/b5/587MZGbp_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/ab/4d/6TYaDsr3_o.gif" alt="" align="top" style="border:none; max-width:100%"></span></span></span> 
 </div> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">  </p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> 在doFilter()方法中，将调用dispatcher.serviceAction，该方法如果找到相应的Action，将把用户请求交给ActionProxy。serviceAction()代码在Dispatcher.java中，如代码3.2所示。</p> 
 <div> 
  <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> 代码3.2  Dispatcher类</p> 
 </div> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">  </p> 
 <div> 
  <img id="_24_2265_Open_Image" src="https://images2.imgbox.com/f1/46/lAl7pX0a_o.gif" alt="" align="top" style="border:none; max-width:100%"> 
  <span style="color:rgb(0,0,255)">public</span> 
  <span style="color:rgb(0,0,0)"> </span> 
  <span style="color:rgb(0,0,255)">class</span> 
  <span style="color:rgb(0,0,0)"> Dispatcher </span> 
  <span id="_24_2265_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/ab/80/ZXnx9jSV_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/35/f6/ZjTN6MLX_o.gif" alt="" align="top" style="border:none; max-width:100%">...<br> <img src="https://images2.imgbox.com/2f/73/l2NCxvJt_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_32_218_Open_Image" src="https://images2.imgbox.com/0f/a4/www7KRBB_o.gif" alt="" align="top" style="border:none; max-width:100%"></span><span id="_32_218_Open_Text"><span style="color:rgb(0,128,0)">/**</span><span style="color:rgb(0,128,0)"><br> <img src="https://images2.imgbox.com/cc/93/0gawotjS_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/b0/eb/nfpg1otf_o.gif" alt="" align="top" style="border:none; max-width:100%">     * 为mapping加载类，并调用相应的方法或者直接返回result<br> <img src="https://images2.imgbox.com/53/67/I4AcTR81_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/8f/1f/1C6YDS5a_o.gif" alt="" align="top" style="border:none; max-width:100%">     * &lt;p/&gt;<br> <img src="https://images2.imgbox.com/7d/c9/zw1fXqWl_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/b1/c7/s2z6n1Am_o.gif" alt="" align="top" style="border:none; max-width:100%">     * 根据用户请求的参数，建立Action上下文<br> <img src="https://images2.imgbox.com/86/36/GLfACmTm_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/02/30/itDVo4BK_o.gif" alt="" align="top" style="border:none; max-width:100%">     * 根据指定的Action’名称和包空间名称，加载一个Action代理 &lt;tt&gt;ActionProxy&lt;/tt&gt; <br> <img src="https://images2.imgbox.com/54/d6/qu7Kj26D_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/53/95/dyzwua4O_o.gif" alt="" align="top" style="border:none; max-width:100%">     * 然后Action的相应方法将被执行，<br> <img src="https://images2.imgbox.com/39/fe/uwvYSL9T_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/0c/9a/O1Nv1Drc_o.gif" alt="" align="top" style="border:none; max-width:100%">     </span><span style="color:rgb(0,128,0)">*/</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/28/74/RKbQJNO0_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_380_2256_Open_Image" src="https://images2.imgbox.com/73/fa/SCYUzskb_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,0,255)">public</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">void</span><span style="color:rgb(0,0,0)"> serviceAction(HttpServletRequest request, HttpServletResponse response, ServletContext context, ActionMapping mapping) </span><span style="color:rgb(0,0,255)">throws</span><span style="color:rgb(0,0,0)"> ServletException </span><span id="_380_2256_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/18/98/xY2JvahV_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/d7/38/rAAm6XAn_o.gif" alt="" align="top" style="border:none; max-width:100%">        Map</span><span style="color:rgb(0,0,0)">&lt;</span><span style="color:rgb(0,0,0)">String, Object</span><span style="color:rgb(0,0,0)">&gt;</span><span style="color:rgb(0,0,0)"> extraContext </span><span style="color:rgb(0,0,0)">=</span><span style="color:rgb(0,0,0)"> createContextMap(request, response, mapping, context);<br> <img src="https://images2.imgbox.com/65/17/8CsAFEtf_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/9d/5b/Wmfh3yJB_o.gif" alt="" align="top" style="border:none; max-width:100%">        </span><span style="color:rgb(0,128,0)">//</span><span style="color:rgb(0,128,0)">如果存在一个值栈，则建立一个新的并复制以备Action使用</span><span style="color:rgb(0,128,0)"><br> <img src="https://images2.imgbox.com/c9/07/oVbaBiSC_o.gif" alt="" align="top" style="border:none; max-width:100%"></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/6c/8e/OI1lhAXm_o.gif" alt="" align="top" style="border:none; max-width:100%">        ValueStack stack </span><span style="color:rgb(0,0,0)">=</span><span style="color:rgb(0,0,0)"> (ValueStack) request.getAttribute(ServletActionContext.STRUTS_VALUESTACK_KEY);<br> <img src="https://images2.imgbox.com/52/3a/26sLqsds_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_656_781_Open_Image" src="https://images2.imgbox.com/13/4c/gMWSTwof_o.gif" alt="" align="top" style="border:none; max-width:100%">        </span><span style="color:rgb(0,0,255)">if</span><span style="color:rgb(0,0,0)"> (stack</span><span style="color:rgb(0,0,0)">!=</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">null</span><span style="color:rgb(0,0,0)">) </span><span id="_656_781_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/26/26/vy7JIrtE_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/8f/0c/tikAC8gO_o.gif" alt="" align="top" style="border:none; max-width:100%">            extraContext.put(ActionContext.VALUE_STACK, ValueStackFactory.getFactory().createValueStack(stack));<br> <img src="https://images2.imgbox.com/53/8d/CnFvx3rc_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/22/f0/74PkkVuo_o.gif" alt="" align="top" style="border:none; max-width:100%">        }</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/4a/5d/29FHSnMr_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/06/18/PeH0Zlkx_o.gif" alt="" align="top" style="border:none; max-width:100%">        String timerKey </span><span style="color:rgb(0,0,0)">=</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,0)">"</span><span style="color:rgb(0,0,0)">Handling request from Dispatcher</span><span style="color:rgb(0,0,0)">"</span><span style="color:rgb(0,0,0)">;<br> <img src="https://images2.imgbox.com/7c/df/vjQR3zIH_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_859_1911_Open_Image" src="https://images2.imgbox.com/4a/e7/lvqJlsUH_o.gif" alt="" align="top" style="border:none; max-width:100%">        </span><span style="color:rgb(0,0,255)">try</span><span style="color:rgb(0,0,0)"> </span><span id="_859_1911_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/97/1c/wh5VhVee_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/d2/61/9wgWweIv_o.gif" alt="" align="top" style="border:none; max-width:100%">            UtilTimerStack.push(timerKey);<br> <img src="https://images2.imgbox.com/48/bb/AWNzlqk0_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/88/c6/i0Nejk7X_o.gif" alt="" align="top" style="border:none; max-width:100%">            String namespace </span><span style="color:rgb(0,0,0)">=</span><span style="color:rgb(0,0,0)"> mapping.getNamespace();<br> <img src="https://images2.imgbox.com/10/4e/82ne6XJ2_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/bb/95/tefrlETY_o.gif" alt="" align="top" style="border:none; max-width:100%">            String name </span><span style="color:rgb(0,0,0)">=</span><span style="color:rgb(0,0,0)"> mapping.getName();<br> <img src="https://images2.imgbox.com/e3/90/de7UShKL_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/fd/cd/UNOAM46w_o.gif" alt="" align="top" style="border:none; max-width:100%">            String method </span><span style="color:rgb(0,0,0)">=</span><span style="color:rgb(0,0,0)"> mapping.getMethod();<br> <img src="https://images2.imgbox.com/b6/d5/8ycXPMJQ_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/53/90/dwo0SmRd_o.gif" alt="" align="top" style="border:none; max-width:100%">            Configuration config </span><span style="color:rgb(0,0,0)">=</span><span style="color:rgb(0,0,0)"> configurationManager.getConfiguration();<br> <img src="https://images2.imgbox.com/ab/d3/O1LKk5VR_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/a4/f0/umrQaI3M_o.gif" alt="" align="top" style="border:none; max-width:100%">            </span><span style="color:rgb(0,128,0)">//</span><span style="color:rgb(0,128,0)">FilterDispatcher把请求的处理交给ActionProxy</span><span style="color:rgb(0,128,0)"><br> <img src="https://images2.imgbox.com/da/47/yERKwvng_o.gif" alt="" align="top" style="border:none; max-width:100%"></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/b1/29/fbcEbCbF_o.gif" alt="" align="top" style="border:none; max-width:100%">            ActionProxy proxy </span><span style="color:rgb(0,0,0)">=</span><span style="color:rgb(0,0,0)"> config.getContainer().getInstance(ActionProxyFactory.</span><span style="color:rgb(0,0,255)">class</span><span style="color:rgb(0,0,0)">).createActionProxy(namespace, name, extraContext, </span><span style="color:rgb(0,0,255)">true</span><span style="color:rgb(0,0,0)">, </span><span style="color:rgb(0,0,255)">false</span><span style="color:rgb(0,0,0)">);<br> <img src="https://images2.imgbox.com/e6/32/7kLVLc6Z_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/2c/8e/pYeshiru_o.gif" alt="" align="top" style="border:none; max-width:100%">            proxy.setMethod(method);<br> <img src="https://images2.imgbox.com/ce/8b/B5OtS7Nx_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/03/48/6aOCT5M3_o.gif" alt="" align="top" style="border:none; max-width:100%">            request.setAttribute(ServletActionContext.STRUTS_VALUESTACK_KEY, proxy.getInvocation().getStack());<br> <img src="https://images2.imgbox.com/d2/0b/3qLPrvjz_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/a8/da/tp37P1VU_o.gif" alt="" align="top" style="border:none; max-width:100%">            </span><span style="color:rgb(0,128,0)">//</span><span style="color:rgb(0,128,0)">ActionMapping 直接返回一个result</span><span style="color:rgb(0,128,0)"><br> <img src="https://images2.imgbox.com/ff/da/24tPDNtF_o.gif" alt="" align="top" style="border:none; max-width:100%"></span><span style="color:rgb(0,0,0)"><br> <img id="_1580_1705_Open_Image" src="https://images2.imgbox.com/98/1e/qOGz1tSj_o.gif" alt="" align="top" style="border:none; max-width:100%">            </span><span style="color:rgb(0,0,255)">if</span><span style="color:rgb(0,0,0)"> (mapping.getResult() </span><span style="color:rgb(0,0,0)">!=</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">null</span><span style="color:rgb(0,0,0)">) </span><span id="_1580_1705_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/96/21/Rz4PcD0f_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/30/12/r5WmYHyB_o.gif" alt="" align="top" style="border:none; max-width:100%">                Result result </span><span style="color:rgb(0,0,0)">=</span><span style="color:rgb(0,0,0)"> mapping.getResult();<br> <img src="https://images2.imgbox.com/10/7e/9jM15QGY_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/3b/82/5K3AK1aA_o.gif" alt="" align="top" style="border:none; max-width:100%">                result.execute(proxy.getInvocation());<br> <img src="https://images2.imgbox.com/22/09/5JlLQMgu_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_1712_1761_Open_Image" src="https://images2.imgbox.com/77/17/qzEdcHau_o.gif" alt="" align="top" style="border:none; max-width:100%">            }</span></span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">else</span><span style="color:rgb(0,0,0)"> </span><span id="_1712_1761_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/7d/c5/yIDr1w6V_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/b3/3b/D07FDtSf_o.gif" alt="" align="top" style="border:none; max-width:100%">                proxy.execute();<br> <img src="https://images2.imgbox.com/40/1f/DlaepG86_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/e7/8b/jZ7Fa8pa_o.gif" alt="" align="top" style="border:none; max-width:100%">            }</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/15/93/wPUP5HyW_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_1795_1900_Open_Image" src="https://images2.imgbox.com/40/8e/9vJdfaFW_o.gif" alt="" align="top" style="border:none; max-width:100%">            </span><span style="color:rgb(0,0,255)">if</span><span style="color:rgb(0,0,0)"> (stack </span><span style="color:rgb(0,0,0)">!=</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">null</span><span style="color:rgb(0,0,0)">) </span><span id="_1795_1900_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/ff/65/k5w1YZpt_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/9c/a7/YRG3g7wp_o.gif" alt="" align="top" style="border:none; max-width:100%">                request.setAttribute(ServletActionContext.STRUTS_VALUESTACK_KEY, stack);<br> <img src="https://images2.imgbox.com/cb/a1/BlQE7zJ8_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/4b/6a/Xinyyeke_o.gif" alt="" align="top" style="border:none; max-width:100%">            }</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/0e/74/tp9Hzec0_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_1946_2108_Open_Image" src="https://images2.imgbox.com/7f/c4/spwVsZRn_o.gif" alt="" align="top" style="border:none; max-width:100%">        }</span></span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">catch</span><span style="color:rgb(0,0,0)"> (ConfigurationException e) </span><span id="_1946_2108_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/36/d3/JS27sIXI_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/1e/3d/uNyEPwoE_o.gif" alt="" align="top" style="border:none; max-width:100%">            LOG.error(</span><span style="color:rgb(0,0,0)">"</span><span style="color:rgb(0,0,0)">Could not find action or result</span><span style="color:rgb(0,0,0)">"</span><span style="color:rgb(0,0,0)">, e);<br> <img src="https://images2.imgbox.com/57/d5/sQqd7RA7_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/72/05/MFL9B9HX_o.gif" alt="" align="top" style="border:none; max-width:100%">            sendError(request, response, context, HttpServletResponse.SC_NOT_FOUND, e);<br> <img src="https://images2.imgbox.com/b6/ba/LmMq4mLf_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_2130_2185_Open_Image" src="https://images2.imgbox.com/ca/8e/rebHWPku_o.gif" alt="" align="top" style="border:none; max-width:100%">        }</span></span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">catch</span><span style="color:rgb(0,0,0)"> (Exception e) </span><span id="_2130_2185_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/39/b1/39o51kB6_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/b3/06/yjrYL6FX_o.gif" alt="" align="top" style="border:none; max-width:100%">            </span><span style="color:rgb(0,0,255)">throw</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">new</span><span style="color:rgb(0,0,0)"> ServletException(e);<br> <img src="https://images2.imgbox.com/92/00/aPWK8QYf_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_2195_2249_Open_Image" src="https://images2.imgbox.com/fe/a9/oTn8e6pf_o.gif" alt="" align="top" style="border:none; max-width:100%">        }</span></span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">finally</span><span style="color:rgb(0,0,0)"> </span><span id="_2195_2249_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/8e/70/WVCIO5TA_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/8a/35/a2AKmEo0_o.gif" alt="" align="top" style="border:none; max-width:100%">            UtilTimerStack.pop(timerKey);<br> <img src="https://images2.imgbox.com/6c/e0/odZLzdfq_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/50/8e/t2VTusaG_o.gif" alt="" align="top" style="border:none; max-width:100%">        }</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/cc/7a/6VVS5EMy_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/1c/cc/oUeCkZ5O_o.gif" alt="" align="top" style="border:none; max-width:100%">    }</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/75/f9/x9nJ7k1K_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/68/b7/FgfjeR2l_o.gif" alt="" align="top" style="border:none; max-width:100%">…<br> <img src="https://images2.imgbox.com/8c/16/BS3lhPyo_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/0a/7a/gVAjx5Wy_o.gif" alt="" align="top" style="border:none; max-width:100%">｝<br> <img src="https://images2.imgbox.com/a5/88/yLtu31ma_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/5e/9a/XXbLUDVa_o.gif" alt="" align="top" style="border:none; max-width:100%"></span></span> 
 </div> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">  </p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> 从上面代码中可以看出来，Struts 2用于处理用户请求的Action实例，并不是用户实现的业务控制器，而是Action代理。关于Action代理相关内容，读者可以参考拦截器章节的介绍。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> ★ 提示 ★</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> 前面一直在说Action可以是一个普通的Java类，与Servlet API完全分离，但是为了实现业务逻辑，Action需要使用HttpServletRequest内容。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">  </p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> Struts 2设计的精巧之处就是使用了Action代理，Action代理可以根据系统的配置，加载一系列的拦截器，由拦截器将HttpServletRequest参数解析出来，传入Action。同样，Action处理的结果也是通过拦截器传入HttpServletResponse，然后由HttpServletRequest传给用户。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> 其实，该处理过程是典型的AOP（面向切面编程）的方式，读者可以在后面详细了解到。Struts 2处理过程模型如图3.2所示。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <img src="https://images2.imgbox.com/39/09/gjhILMnb_o.jpg" alt="" style="border:none; max-width:100%"></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> </p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> 图3.2  Struts 2处理过程模型</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> ★ 说明 ★</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> 拦截器是Struts 2框架的核心，通过拦截器，实现了AOP（面向切面编程）。使用拦截器，可以简化Web开发中的某些应用，例如，权限拦截器可以简化Web应用中的权限检查。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">  </p> 
 <h4 style="margin:0px; padding:0px"><a target="_blank" name="t7" style="color:rgb(202,0,0)"></a><a target="_blank" name="t1" style="color:rgb(51,102,153)"></a><a target="_blank" name="_Toc189040217" style="color:rgb(51,102,153)"></a>3.1.2  业务控制器Action</h4> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">  </p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> 业务控制器Action是由开发者自己编写实现的，Action类可以是一个简单的Java类，与Servlet API完全分离。Action一般都有一个execute()方法，也可以定义其他业务控制方法，详细内容将在后面介绍。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> Action的execute()返回一个String类型值，这与Struts 1返回的ActionForward相比，简单易懂。Struts 2提供了一个ActionSupport工具类，该类实现了Action接口和validate()方法，一般开发者编写Action可以直接继承ActionSupport类。编写Action类后，开发者还必须在配置文件中配置Action。一个Action的配置应该包含下面几个元素：</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> — 该Action的name，即用户请求所指向的URL。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> — Action所对应的class元素，对应Action类的位置。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> — 指定result逻辑名称和实际资源的定位。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> Action是业务控制器，笔者建议在编写Action的时候，尽量避免将业务逻辑放到其中，尽量减少Action与业务逻辑模块或者组件的耦合程度。</p> 
 <h4 style="margin:0px; padding:0px"><a target="_blank" name="t8" style="color:rgb(202,0,0)"></a><a target="_blank" name="t2" style="color:rgb(51,102,153)"></a><a target="_blank" name="_Toc189040218" style="color:rgb(51,102,153)"></a>3.1.3  业务模型组件</h4> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">  </p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> 业务模型组件可以是实现业务逻辑的模块，可以是EJB、POJO或者JavaBean，在实际开发中，对业务模型组件的区分和定义也是比较模糊的，实际上也超出了Struts 2框架的范围。不同的开发者或者团队，都有自己的方式来实现业务逻辑模块，Struts 2框架的目的就是使用Action来调用业务逻辑模块。例如一个银行存款的业务逻辑模块，如代码3.3所示。</p> 
 <div> 
  <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> 代码3.3  模拟一个银行业务的实现模块</p> 
 </div> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">  </p> 
 <div> 
  <img src="https://images2.imgbox.com/7c/e2/zknaP0fA_o.gif" alt="" align="top" style="border:none; max-width:100%"> 
  <span style="color:rgb(0,0,255)">package</span> 
  <span style="color:rgb(0,0,0)"> ch3;<br> <img src="https://images2.imgbox.com/73/fb/77HK3GTJ_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_32_584_Open_Image" src="https://images2.imgbox.com/63/80/5wFTFVNz_o.gif" alt="" align="top" style="border:none; max-width:100%"></span> 
  <span style="color:rgb(0,0,255)">public</span> 
  <span style="color:rgb(0,0,0)"> </span> 
  <span style="color:rgb(0,0,255)">class</span> 
  <span style="color:rgb(0,0,0)"> Bank </span> 
  <span id="_32_584_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/21/31/UxAwAjRJ_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/53/38/KAYF6eIA_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,128,0)">//</span><span style="color:rgb(0,128,0)">定义银行账户</span><span style="color:rgb(0,128,0)"><br> <img src="https://images2.imgbox.com/d0/93/tX2Nx6JB_o.gif" alt="" align="top" style="border:none; max-width:100%"></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/a8/0c/8Xsdg2ty_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,0,255)">private</span><span style="color:rgb(0,0,0)"> String accounts;<br> <img src="https://images2.imgbox.com/a5/b0/CloAfAxr_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/8c/ff/BKPLPNUP_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,128,0)">//</span><span style="color:rgb(0,128,0)">定义操作金额</span><span style="color:rgb(0,128,0)"><br> <img src="https://images2.imgbox.com/18/08/PJrbTjT5_o.gif" alt="" align="top" style="border:none; max-width:100%"></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/a5/f7/vqAUl5W8_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,0,255)">private</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">double</span><span style="color:rgb(0,0,0)"> money;<br> <img src="https://images2.imgbox.com/56/e6/5QWpa6xf_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/49/04/0Dfh7hyf_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,128,0)">//</span><span style="color:rgb(0,128,0)">属性的getter和setter方法</span><span style="color:rgb(0,128,0)"><br> <img src="https://images2.imgbox.com/2a/b3/BhpFOXke_o.gif" alt="" align="top" style="border:none; max-width:100%"></span><span style="color:rgb(0,0,0)"><br> <img id="_178_211_Open_Image" src="https://images2.imgbox.com/fb/6e/cRqoBjaV_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,0,255)">public</span><span style="color:rgb(0,0,0)"> String getAccounts() </span><span id="_178_211_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/c9/6c/d1N1SjhC_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/f1/eb/1nRyUjYu_o.gif" alt="" align="top" style="border:none; max-width:100%">        </span><span style="color:rgb(0,0,255)">return</span><span style="color:rgb(0,0,0)"> accounts;<br> <img src="https://images2.imgbox.com/d1/62/pFUCsXZ9_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/09/1e/xQMnLnyk_o.gif" alt="" align="top" style="border:none; max-width:100%">    }</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/f0/07/3W4rTYsj_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_259_301_Open_Image" src="https://images2.imgbox.com/09/fc/8If3Appf_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,0,255)">public</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">void</span><span style="color:rgb(0,0,0)"> setAccounts(String accounts) </span><span id="_259_301_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/e1/c4/ej1QYZvF_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/ac/6b/pdypXT8o_o.gif" alt="" align="top" style="border:none; max-width:100%">        </span><span style="color:rgb(0,0,255)">this</span><span style="color:rgb(0,0,0)">.accounts </span><span style="color:rgb(0,0,0)">=</span><span style="color:rgb(0,0,0)"> accounts;<br> <img src="https://images2.imgbox.com/bf/6f/HAq4ZgPA_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/5d/c0/1EEEXrIK_o.gif" alt="" align="top" style="border:none; max-width:100%">    }</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/32/71/6WmItoju_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_333_363_Open_Image" src="https://images2.imgbox.com/fd/ba/ecbfREqb_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,0,255)">public</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">double</span><span style="color:rgb(0,0,0)"> getMoney() </span><span id="_333_363_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/c9/45/Yu6eXIJO_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/eb/19/JGfVUFi6_o.gif" alt="" align="top" style="border:none; max-width:100%">        </span><span style="color:rgb(0,0,255)">return</span><span style="color:rgb(0,0,0)"> money;<br> <img src="https://images2.imgbox.com/e9/c6/o3G9pvAQ_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/01/d8/sNfaEiKs_o.gif" alt="" align="top" style="border:none; max-width:100%">    }</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/e4/7f/Z7qC5wZC_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_405_441_Open_Image" src="https://images2.imgbox.com/57/8a/snFbXG1n_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,0,255)">public</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">void</span><span style="color:rgb(0,0,0)"> setMoney(</span><span style="color:rgb(0,0,255)">double</span><span style="color:rgb(0,0,0)"> money) </span><span id="_405_441_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/fe/45/yECIXE4H_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/d1/21/YukLTwny_o.gif" alt="" align="top" style="border:none; max-width:100%">        </span><span style="color:rgb(0,0,255)">this</span><span style="color:rgb(0,0,0)">.money </span><span style="color:rgb(0,0,0)">=</span><span style="color:rgb(0,0,0)"> money;<br> <img src="https://images2.imgbox.com/a5/46/oJKZRwPN_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/ce/69/M1VUte5l_o.gif" alt="" align="top" style="border:none; max-width:100%">    }</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/b8/a6/3eFWpH2o_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/6f/10/77r8npvH_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,128,0)">//</span><span style="color:rgb(0,128,0)">模拟银行存款方法</span><span style="color:rgb(0,128,0)"><br> <img src="https://images2.imgbox.com/50/c1/WSWGuwz1_o.gif" alt="" align="top" style="border:none; max-width:100%"></span><span style="color:rgb(0,0,0)"><br> <img id="_517_578_Open_Image" src="https://images2.imgbox.com/3f/14/XPsaEJq1_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,0,255)">public</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">boolean</span><span style="color:rgb(0,0,0)"> saving(String accounts, </span><span style="color:rgb(0,0,255)">double</span><span style="color:rgb(0,0,0)"> money) </span><span id="_517_578_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/61/b2/kmLDtCRo_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/05/65/XS4JoE5w_o.gif" alt="" align="top" style="border:none; max-width:100%">        </span><span style="color:rgb(0,128,0)">//</span><span style="color:rgb(0,128,0)">调用DAO等模块读写数据库</span><span style="color:rgb(0,128,0)"><br> <img src="https://images2.imgbox.com/e2/b6/mwjUVCL8_o.gif" alt="" align="top" style="border:none; max-width:100%"></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/96/55/56mwN8yZ_o.gif" alt="" align="top" style="border:none; max-width:100%">        </span><span style="color:rgb(0,0,255)">return</span><span style="color:rgb(0,0,0)"> dosomeing();<br> <img src="https://images2.imgbox.com/5e/c6/k4OVtCeD_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/fe/35/cNFYVFfN_o.gif" alt="" align="top" style="border:none; max-width:100%">    }</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/33/fe/QejqIf7v_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/7d/d3/Pp8QpBqz_o.gif" alt="" align="top" style="border:none; max-width:100%"> <br> <img src="https://images2.imgbox.com/a2/75/ELlhhUiF_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/10/07/qbrJ7xD6_o.gif" alt="" align="top" style="border:none; max-width:100%">}</span></span> 
  <span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/9a/b6/pWFEVmNR_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/ee/56/xYS9gtTE_o.gif" alt="" align="top" style="border:none; max-width:100%"></span> 
 </div> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">  </p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> 上面实例在实际开发中没有任何意义，这里只是作为业务逻辑模块来说明，在执行saving(String accounts,double money)方法时，可以调用相应的数据库访问其他组件，来实现存款操作。使用Action调用该业务逻辑组件可以在execute()方法中实现，如代码3.4所示。</p> 
 <div> 
  <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> 代码3.4  业务控制器Bank_Saving_Action</p> 
 </div> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> </p> 
 <div> 
  <img src="https://images2.imgbox.com/01/37/X4SlaZxn_o.gif" alt="" align="top" style="border:none; max-width:100%"> 
  <span style="color:rgb(0,0,255)">package</span> 
  <span style="color:rgb(0,0,0)"> ch3;<br> <img src="https://images2.imgbox.com/d0/53/9pbZe1Hi_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/95/5f/eVN2uzxd_o.gif" alt="" align="top" style="border:none; max-width:100%"></span> 
  <span style="color:rgb(0,0,255)">import</span> 
  <span style="color:rgb(0,0,0)"> java.util.Map;<br> <img src="https://images2.imgbox.com/a7/53/LyV1Cpeq_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/be/c9/k0wAlula_o.gif" alt="" align="top" style="border:none; max-width:100%"></span> 
  <span style="color:rgb(0,0,255)">import</span> 
  <span style="color:rgb(0,0,0)"> com.opensymphony.xwork2.ActionContext;<br> <img src="https://images2.imgbox.com/0d/0d/mVM7q8Vk_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/5e/26/nyUt4u5m_o.gif" alt="" align="top" style="border:none; max-width:100%"></span> 
  <span style="color:rgb(0,0,255)">import</span> 
  <span style="color:rgb(0,0,0)"> com.opensymphony.xwork2.ActionSupport;<br> <img src="https://images2.imgbox.com/0d/97/3Ls21Asf_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/91/bb/tdZtZdrL_o.gif" alt="" align="top" style="border:none; max-width:100%"> <br> <img src="https://images2.imgbox.com/03/5f/wOXRjGmY_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_188_850_Open_Image" src="https://images2.imgbox.com/8e/87/F6Hi3Eij_o.gif" alt="" align="top" style="border:none; max-width:100%"></span> 
  <span style="color:rgb(0,0,255)">public</span> 
  <span style="color:rgb(0,0,0)"> </span> 
  <span style="color:rgb(0,0,255)">class</span> 
  <span style="color:rgb(0,0,0)"> Bank_Saving_Action </span> 
  <span style="color:rgb(0,0,255)">extends</span> 
  <span style="color:rgb(0,0,0)"> ActionSupport </span> 
  <span id="_188_850_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/3a/74/b67wmFkf_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/46/80/hIQRGxYS_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,128,0)">//</span><span style="color:rgb(0,128,0)">定义银行账户</span><span style="color:rgb(0,128,0)"><br> <img src="https://images2.imgbox.com/52/da/kIRV6gaI_o.gif" alt="" align="top" style="border:none; max-width:100%"></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/e6/23/I54ySwdK_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,0,255)">private</span><span style="color:rgb(0,0,0)"> String accounts;<br> <img src="https://images2.imgbox.com/a2/bf/55oYFgIs_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/e2/0d/Di73hpJR_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,128,0)">//</span><span style="color:rgb(0,128,0)">定义操作金额</span><span style="color:rgb(0,128,0)"><br> <img src="https://images2.imgbox.com/26/65/ouNGRd1J_o.gif" alt="" align="top" style="border:none; max-width:100%"></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/17/56/djGRHGEK_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,0,255)">private</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">double</span><span style="color:rgb(0,0,0)"> money;<br> <img src="https://images2.imgbox.com/0f/c7/IDYANf9g_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/c6/7d/8NkXfxCu_o.gif" alt="" align="top" style="border:none; max-width:100%">    <br> <img src="https://images2.imgbox.com/6d/60/SZmyIoiF_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_327_514_Open_Image" src="https://images2.imgbox.com/86/a1/nBShXb9U_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,0,255)">public</span><span style="color:rgb(0,0,0)"> String execute() </span><span style="color:rgb(0,0,255)">throws</span><span style="color:rgb(0,0,0)"> Exception </span><span id="_327_514_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/a1/30/E4gmkkfn_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/04/a8/oPhjVWEM_o.gif" alt="" align="top" style="border:none; max-width:100%">        </span><span style="color:rgb(0,128,0)">//</span><span style="color:rgb(0,128,0)">创建Bank实例</span><span style="color:rgb(0,128,0)"><br> <img src="https://images2.imgbox.com/49/8b/e4c89tN6_o.gif" alt="" align="top" style="border:none; max-width:100%"></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/c9/fc/pKphpbf8_o.gif" alt="" align="top" style="border:none; max-width:100%">        Bank bk</span><span style="color:rgb(0,0,0)">=</span><span style="color:rgb(0,0,255)">new</span><span style="color:rgb(0,0,0)"> Bank();<br> <img src="https://images2.imgbox.com/a7/5b/OAlx958j_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/90/d8/Vz8FKJGl_o.gif" alt="" align="top" style="border:none; max-width:100%">        </span><span style="color:rgb(0,128,0)">//</span><span style="color:rgb(0,128,0)">调用存款方法</span><span style="color:rgb(0,128,0)"><br> <img src="https://images2.imgbox.com/e0/c4/ocOfErR6_o.gif" alt="" align="top" style="border:none; max-width:100%"></span><span style="color:rgb(0,0,0)"><br> <img id="_436_472_Open_Image" src="https://images2.imgbox.com/62/4f/tOgwzcbL_o.gif" alt="" align="top" style="border:none; max-width:100%">        </span><span style="color:rgb(0,0,255)">if</span><span style="color:rgb(0,0,0)"> (bk.saving(accounts, money))</span><span id="_436_472_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/52/67/UdrW1KIr_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/75/98/NkdOXOXb_o.gif" alt="" align="top" style="border:none; max-width:100%">        </span><span style="color:rgb(0,0,255)">return</span><span style="color:rgb(0,0,0)"> SUCCESS;<br> <img src="https://images2.imgbox.com/af/16/uZVdXLM9_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_477_511_Open_Image" src="https://images2.imgbox.com/c8/ea/yoeNfF7C_o.gif" alt="" align="top" style="border:none; max-width:100%">        }</span></span><span style="color:rgb(0,0,255)">else</span><span id="_477_511_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/c8/d1/tYWabODW_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/39/63/DAX0vzDX_o.gif" alt="" align="top" style="border:none; max-width:100%">        </span><span style="color:rgb(0,0,255)">return</span><span style="color:rgb(0,0,0)"> ERROR;<br> <img src="https://images2.imgbox.com/79/e7/81pQxuhy_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/ba/a7/pEmQipB6_o.gif" alt="" align="top" style="border:none; max-width:100%">        }</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/92/00/Fm8YMsMy_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/67/c8/KCrCfVbI_o.gif" alt="" align="top" style="border:none; max-width:100%">}</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/c2/a9/fbQk5jzI_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/f9/46/R5uCYHuS_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,128,0)">//</span><span style="color:rgb(0,128,0)">属性的getter和setter方法</span><span style="color:rgb(0,128,0)"><br> <img src="https://images2.imgbox.com/73/09/9IrbQrrQ_o.gif" alt="" align="top" style="border:none; max-width:100%"></span><span style="color:rgb(0,0,0)"><br> <img id="_575_608_Open_Image" src="https://images2.imgbox.com/3c/36/sudtqNKi_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,0,255)">public</span><span style="color:rgb(0,0,0)"> String getAccounts() </span><span id="_575_608_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/14/fd/XpTys0x3_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/1e/53/gVM6nXIT_o.gif" alt="" align="top" style="border:none; max-width:100%">        </span><span style="color:rgb(0,0,255)">return</span><span style="color:rgb(0,0,0)"> accounts;<br> <img src="https://images2.imgbox.com/5e/b0/CW46WgAQ_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/b3/e7/5SCTOQIZ_o.gif" alt="" align="top" style="border:none; max-width:100%">    }</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/d4/2a/cAOcG3mM_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/3b/11/ircs4F3T_o.gif" alt="" align="top" style="border:none; max-width:100%"> <br> <img src="https://images2.imgbox.com/93/1a/HyPp7mej_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_659_701_Open_Image" src="https://images2.imgbox.com/0d/63/ItgRu88u_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,0,255)">public</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">void</span><span style="color:rgb(0,0,0)"> setAccounts(String accounts) </span><span id="_659_701_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/e7/b9/h98hGUz5_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/4d/3e/Ez8agRXH_o.gif" alt="" align="top" style="border:none; max-width:100%">        </span><span style="color:rgb(0,0,255)">this</span><span style="color:rgb(0,0,0)">.accounts </span><span style="color:rgb(0,0,0)">=</span><span style="color:rgb(0,0,0)"> accounts;<br> <img src="https://images2.imgbox.com/5f/24/FX32ISaT_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/99/0f/M0kZKSzB_o.gif" alt="" align="top" style="border:none; max-width:100%">    }</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/76/b1/Rhk183x0_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/a2/52/yEWxSP2v_o.gif" alt="" align="top" style="border:none; max-width:100%"> <br> <img src="https://images2.imgbox.com/0c/ec/5yOeF1nD_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_736_766_Open_Image" src="https://images2.imgbox.com/8c/f6/mAzfLNji_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,0,255)">public</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">double</span><span style="color:rgb(0,0,0)"> getMoney() </span><span id="_736_766_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/ab/3b/11LZgfIv_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/69/9b/G0arH2Fv_o.gif" alt="" align="top" style="border:none; max-width:100%">        </span><span style="color:rgb(0,0,255)">return</span><span style="color:rgb(0,0,0)"> money;<br> <img src="https://images2.imgbox.com/4e/9c/mKR45Udt_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/e3/2f/RaSWZAR0_o.gif" alt="" align="top" style="border:none; max-width:100%">    }</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/6a/1b/UHLYo9pr_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/eb/a0/zdFdgMUG_o.gif" alt="" align="top" style="border:none; max-width:100%"> <br> <img src="https://images2.imgbox.com/a0/7c/ouCoRQ3T_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img id="_811_847_Open_Image" src="https://images2.imgbox.com/ec/37/jUh5ky17_o.gif" alt="" align="top" style="border:none; max-width:100%">    </span><span style="color:rgb(0,0,255)">public</span><span style="color:rgb(0,0,0)"> </span><span style="color:rgb(0,0,255)">void</span><span style="color:rgb(0,0,0)"> setMoney(</span><span style="color:rgb(0,0,255)">double</span><span style="color:rgb(0,0,0)"> money) </span><span id="_811_847_Open_Text"><span style="color:rgb(0,0,0)">{<!-- --><br> <img src="https://images2.imgbox.com/ac/b3/9VfnVt1p_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/29/e6/k5fPnKFf_o.gif" alt="" align="top" style="border:none; max-width:100%">        </span><span style="color:rgb(0,0,255)">this</span><span style="color:rgb(0,0,0)">.money </span><span style="color:rgb(0,0,0)">=</span><span style="color:rgb(0,0,0)"> money;<br> <img src="https://images2.imgbox.com/ec/15/ejkuSJ3c_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/74/86/wOiB3pIL_o.gif" alt="" align="top" style="border:none; max-width:100%">    }</span></span><span style="color:rgb(0,0,0)"><br> <img src="https://images2.imgbox.com/2c/3d/O91WTXV2_o.gif" alt="" align="top" style="border:none; max-width:100%"><br> <img src="https://images2.imgbox.com/10/17/mndEshbY_o.gif" alt="" align="top" style="border:none; max-width:100%"></span></span> 
 </div> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">  </p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> Bank_Saving_Action演示了对银行存款业务逻辑组件的调用，这里是通过在Action中创建业务逻辑组件实例的方式实现的。在实际开发中，可以使用静态工厂获得业务逻辑组件的实例或者使用IoC容器来管理。Action中不实现任何业务逻辑，只是负责组织调度业务逻辑组件。调用关系如图3.3所示。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <img src="https://images2.imgbox.com/a5/d0/vpeoFSAl_o.jpg" alt="" style="border:none; max-width:100%"></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> </p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> 图3.3  调用业务逻辑组件</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> ★ 说明 ★</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> 业务控制器Action一般情况下不是直接创建业务逻辑组件实例，而是使用工厂模式或者是从Spring容器中获得业务逻辑组件实例，这样可以提高系统的性能。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">  </p> 
 <h4 style="margin:0px; padding:0px"><a target="_blank" name="t9" style="color:rgb(202,0,0)"></a><a target="_blank" name="t3" style="color:rgb(51,102,153)"></a><a target="_blank" name="_Toc189040219" style="color:rgb(51,102,153)"></a>3.1.4  视图组件</h4> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">  </p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> Struts 1只能支持JSP作为视图资源，而Struts 2的进步之处就是可以使用其他视图技术，如FreeMarker、Velocity等。通过前面的学习和示例，读者会知道Action的返回结果只是一个简单的字符串，也就是一个逻辑上的视图名称，要与实际视图资源对应，必须通过配置文件来实现。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> 在struts.xml配置文件中，每一个Aciton定义都有name和class属性，同时还要指定result元素。result元素指定了逻辑视图名称和实际视图的对应关系。每个result都有一个type属性，前面介绍的struts.xml中并没有显式指定type值，即使用了默认的type类型：dispatcher，该结果类型支持JSP所谓视图资源。</p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> 对于Struts 2的视图技术和result返回类型，后面将详细介绍。总结Strurs 2的框架工作流程，发现与WebWork基本相同，可以参考第1章关于WebWork框架的介绍和流程图（如图1.8所示）。</p> 
</div> 
<div style="font-family:Arial; font-size:14px; line-height:26px; top:0px"> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:21pt"> <span style="font-family:宋体">读者如果曾经<a target="_blank" style="color:rgb(51,102,153)"><span style="text-decoration:underline"><strong>学习</strong></span></a>过</span>Struts1.x<span style="font-family:宋体">或者有过</span>Struts1.x<span style="font-family:宋体">的开发经验，那么千万不要想当然地以为这一章可以跳过。实际上</span>Struts1.x<span style="font-family:宋体">与</span>Struts2<span style="font-family:宋体">并无我们想象的血缘关系。虽然</span>Struts2<span style="font-family:宋体">的开发小组极力保留</span>Struts1.x<span style="font-family:宋体">的习惯，但因为</span>Struts2<span style="font-family:宋体">的核心<a target="_blank" style="color:rgb(51,102,153)"><span style="text-decoration:underline"><strong>设计</strong></span></a>完全改变，从思想到设计到工作流程，都有了很大的不同。</span></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:21pt"> Struts2<span style="font-family:宋体">是</span>Struts<span style="font-family:宋体">社区和</span>WebWork<span style="font-family:宋体">社区的共同成果，我们甚至可以说，</span>Struts2<span style="font-family:宋体">是</span>WebWork<span style="font-family:宋体">的升级版，他采用的正是</span>WebWork<span style="font-family:宋体">的核心，所以，</span>Struts2<span style="font-family:宋体">并不是一个不成熟的产品，相反，构建在</span>WebWork<span style="font-family:宋体">基础之上的</span>Struts2<span style="font-family:宋体">是一个运行稳定、性能优异、设计成熟的</span><a target="_blank" style="color:rgb(51,102,153)"><span style="text-decoration:underline"><strong>WEB</strong></span></a><span style="font-family:宋体">框架。</span></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:21pt"> <span style="font-family:宋体">本章主要对</span>Struts<span style="font-family:宋体">的源代码进行分析，因为</span>Struts2<span style="font-family:宋体">与</span>WebWork<span style="font-family:宋体">的关系如此密不可分，因此，读者需要下载</span>xwork<span style="font-family:宋体">的源代码，访问</span><a target="_blank" href="http://www.opensymphony.com/xwork/download.action" rel="nofollow noopener noreferrer" style="color:rgb(51,102,153); text-decoration:none"><span style="color:rgb(0,102,204)">http://www.opensymphony.com/xwork/download.action</span></a><span style="font-family:宋体">即可自行下载。</span></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:21pt"> <span style="font-family:宋体">下载的</span>Struts2<span style="font-family:宋体">源代码文件是一个名叫</span>struts-2.1.0-src.zip<span style="font-family:宋体">的压缩包，里面的目录和文件非常多，读者可以定位到</span>struts-2.1.0-src"struts-2.0.10"src"core"src"main"<a target="_blank" style="color:rgb(51,102,153)"><span style="text-decoration:underline"><strong>java</strong></span></a><span style="font-family:宋体">目录下查看</span>Struts2<span style="font-family:宋体">的源文件，如图</span>14<span style="font-family:宋体">所示。</span></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51)"> <img title="点击图片可在新窗口打开" src="https://images2.imgbox.com/25/16/1mifkbUv_o.png" alt="" width="407" height="344" style="border:none; max-width:100%"></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:21pt">  </p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:21pt"> <span style="font-family:宋体">（图</span>14<span style="font-family:宋体">）</span></p> 
 <h3 style="margin:0px; padding:0px; color:rgb(51,51,51)"><a target="_blank" name="t10" style="color:rgb(202,0,0)"></a><a target="_blank" name="t0" style="color:rgb(51,102,153)"></a><span style="font-family:黑体">主要的包和类</span></h3> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:21pt"> Struts2<span style="font-family:宋体">框架的正常运行，除了占核心地位的</span>xwork<span style="font-family:宋体">的支持以外，</span>Struts2<span style="font-family:宋体">本身也提供了许多类，这些类被分门别类组织到不同的包中。从源代码中发现，基本上每一个</span>Struts2<span style="font-family:宋体">类都访问了</span>WebWork<span style="font-family:宋体">提供的功能，从而也可以看出</span>Struts2<span style="font-family:宋体">与</span>WebWork<span style="font-family:宋体">千丝万缕的联系。但无论如何，</span>Struts2<span style="font-family:宋体">的核心功能比如将请求委托给哪个</span>Action<span style="font-family:宋体">处理都是由</span>xwork<span style="font-family:宋体">完成的，</span>Struts2<span style="font-family:宋体">只是在</span>WebWork<span style="font-family:宋体">的基础上做了适当的简化、加强和封装，并少量保留</span>Struts1.x<span style="font-family:宋体">中的习惯。</span></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:21pt"> <span style="font-family:宋体">以下是对各包的简要说明：</span></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51)"> </p> 
 <table border="1" cellspacing="0" cellpadding="0" style="color:rgb(51,51,51); font-size:14px; line-height:26px; margin-left:23.4pt; border-collapse:collapse"><tbody><tr><td width="216" style="padding:0cm 5.4pt; background-color:rgb(230,230,230); width:162pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <strong><span style="font-family:宋体">包名</span></strong></p> </td><td width="417" style="padding:0cm 5.4pt; background-color:rgb(230,230,230); width:313pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <strong><span style="font-family:宋体">说明</span></strong></p> </td></tr><tr><td width="216" style="padding:0cm 5.4pt; width:162pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> org.apache.struts2. components</p> </td><td width="417" style="padding:0cm 5.4pt; width:313pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <span style="font-family:宋体">该包封装视图组件，</span>Struts2<span style="font-family:宋体">在视图组件上有了很大加强，不仅增加了组件的属性个数，更新增了几个非常有用的组件，如</span>updownselect<span style="font-family:宋体">、</span>doubleselect<span style="font-family:宋体">、</span>datetimepicker<span style="font-family:宋体">、</span>token<span style="font-family:宋体">、</span>tree<span style="font-family:宋体">等。</span></p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <span style="font-family:宋体">另外，</span>Struts2<span style="font-family:宋体">可视化视图组件开始支持主题</span>(theme)<span style="font-family:宋体">，缺省情况下，使用自带的缺省主题，如果要自定义页面效果，需要将组件的</span>theme<span style="font-family:宋体">属性设置为</span>simple<span style="font-family:宋体">。</span></p> </td></tr><tr><td width="216" style="padding:0cm 5.4pt; width:162pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> org.apache.struts2. config</p> </td><td width="417" style="padding:0cm 5.4pt; width:313pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <span style="font-family:宋体">该包定义与配置相关的接口和类。实际上，工程中的</span>xml<span style="font-family:宋体">和</span>properties<span style="font-family:宋体">文件的读取和解析都是由</span>WebWork<span style="font-family:宋体">完成的，</span>Struts<span style="font-family:宋体">只做了少量的工作。</span></p> </td></tr><tr><td width="216" style="padding:0cm 5.4pt; width:162pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> org.apache.struts2.dispatcher</p> </td><td width="417" style="padding:0cm 5.4pt; width:313pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> Struts2<span style="font-family:宋体">的核心包，最重要的类都放在该包中。</span></p> </td></tr><tr><td width="216" style="padding:0cm 5.4pt; width:162pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> org.apache.struts2.impl</p> </td><td width="417" style="padding:0cm 5.4pt; width:313pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <span style="font-family:宋体">该包只定义了</span>3<span style="font-family:宋体">个类，他们是</span>StrutsActionProxy<span style="font-family:宋体">、</span>StrutsActionProxyFactory<span style="font-family:宋体">、</span>StrutsObjectFactory<span style="font-family:宋体">，这三个类都是对</span>xwork<span style="font-family:宋体">的扩展。</span></p> </td></tr><tr><td width="216" style="padding:0cm 5.4pt; width:162pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> org.apache.struts2.interceptor</p> </td><td width="417" style="padding:0cm 5.4pt; width:313pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <span style="font-family:宋体">定义内置的截拦器。</span></p> </td></tr><tr><td width="216" style="padding:0cm 5.4pt; width:162pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> org.apache.struts2.util</p> </td><td width="417" style="padding:0cm 5.4pt; width:313pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <span style="font-family:宋体">实用包。</span></p> </td></tr><tr><td width="216" style="padding:0cm 5.4pt; width:162pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> org.apache.struts2.validators</p> </td><td width="417" style="padding:0cm 5.4pt; width:313pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <span style="font-family:宋体">只定义了一个类：</span>DWRValidator<span style="font-family:宋体">。</span></p> </td></tr><tr><td width="216" style="padding:0cm 5.4pt; width:162pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> org.apache.struts2.views</p> </td><td width="417" style="padding:0cm 5.4pt; width:313pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <span style="font-family:宋体">提供</span>freemarker<span style="font-family:宋体">、</span>jsp<span style="font-family:宋体">、</span>velocity<span style="font-family:宋体">等不同类型的页面呈现。</span></p> </td></tr></tbody></table> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51)"> </p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:21pt"> <span style="font-family:宋体">下表是对一些重要类的说明：</span></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51)"> </p> 
 <table border="1" cellspacing="0" cellpadding="0" style="color:rgb(51,51,51); font-size:14px; line-height:26px; margin-left:23.4pt; border-collapse:collapse"><tbody><tr><td width="288" style="padding:0cm 5.4pt; background-color:rgb(230,230,230); width:216pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <strong><span style="font-family:宋体">类名</span></strong></p> </td><td width="345" style="padding:0cm 5.4pt; background-color:rgb(230,230,230); width:259pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> <strong><span style="font-family:宋体">说明</span></strong></p> </td></tr><tr><td width="288" style="padding:0cm 5.4pt; width:216pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> org.apache.struts2.dispatcher. Dispatcher</p> </td><td width="345" style="padding:0cm 5.4pt; width:259pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">       <span style="font-family:宋体">该类有两个作用：</span></p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">        1<span style="font-family:宋体">、初始化</span></p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">        2<span style="font-family:宋体">、调用指定的</span>Action<span style="font-family:宋体">的</span>execute()<span style="font-family:宋体">方法。</span></p> </td></tr><tr><td width="288" style="padding:0cm 5.4pt; width:216pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> org.apache.struts2.dispatcher. FilterDispatcher</p> </td><td width="345" style="padding:0cm 5.4pt; width:259pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">       <span style="font-family:宋体">这是一个过滤器。文档中已明确说明，如果没有经验，配置时请将</span>url-pattern<span style="font-family:宋体">的值设成</span>/*<span style="font-family:宋体">。</span></p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">       <span style="font-family:宋体">该类有四个作用：</span></p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">        1<span style="font-family:宋体">、执行</span>Action</p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">        2<span style="font-family:宋体">、清理</span>ActionContext<span style="font-family:宋体">，避免内存泄漏</span></p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">        3<span style="font-family:宋体">、处理静态内容（</span>Serving static content<span style="font-family:宋体">）</span></p> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">        4<span style="font-family:宋体">、为请求启动</span>xwork’s<span style="font-family:宋体">的截拦器链。</span></p> </td></tr><tr><td width="288" style="padding:0cm 5.4pt; width:216pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> com.opensymphony.xwork2. ActionProxy</p> </td><td width="345" style="padding:0cm 5.4pt; width:259pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">        Action<span style="font-family:宋体">的代理接口。</span></p> </td></tr><tr><td width="288" style="padding:0cm 5.4pt; width:216pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> com.opensymphony.xwork2. ctionProxyFactory</p> </td><td width="345" style="padding:0cm 5.4pt; width:259pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">       <span style="font-family:宋体">生产</span>ActionProxy<span style="font-family:宋体">的工厂。</span></p> </td></tr><tr><td width="288" style="padding:0cm 5.4pt; width:216pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> com.opensymphony.xwork2.ActionInvocation</p> </td><td width="345" style="padding:0cm 5.4pt; width:259pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">       <span style="font-family:宋体">负责调用</span>Action<span style="font-family:宋体">和截拦器。</span></p> </td></tr><tr><td width="288" style="padding:0cm 5.4pt; width:216pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px"> com.opensymphony.xwork2.config.providers. XmlConfigurationProvider</p> </td><td width="345" style="padding:0cm 5.4pt; width:259pt"> <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px">       <span style="font-family:宋体">负责</span>Struts2<span style="font-family:宋体">的配置文件的解析。</span></p> </td></tr></tbody></table> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51)"> </p> 
 <h3 style="margin:0px; padding:0px; color:rgb(51,51,51)"><a target="_blank" name="t11" style="color:rgb(202,0,0)"></a><a target="_blank" name="t1" style="color:rgb(51,102,153)"></a>Struts2<span style="font-family:黑体">的工作机制</span></h3> 
 <h4 style="margin:0px; padding:0px; color:rgb(51,51,51)"><a target="_blank" name="t12" style="color:rgb(202,0,0)"></a><a target="_blank" name="t2" style="color:rgb(51,102,153)"></a>3.1Struts2<span style="font-family:宋体">体系结构图</span></h4> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51)">        Strut2<span style="font-family:宋体">的体系结构如图</span>15<span style="font-family:宋体">所示：</span></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51)"> <img title="点击图片可在新窗口打开" src="https://images2.imgbox.com/01/19/Z7QkNMsC_o.png" alt="" width="640" height="750" style="border:none; max-width:100%"></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:21pt">  </p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51)">       <span style="font-family:宋体">（图</span>15<span style="font-family:宋体">）</span></p> 
 <h4 style="margin:0px; padding:0px; color:rgb(51,51,51)"><a target="_blank" name="t13" style="color:rgb(202,0,0)"></a><a target="_blank" name="t3" style="color:rgb(51,102,153)"></a>3.2Struts2<span style="font-family:宋体">的工作机制</span></h4> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51)">       <span style="font-family:宋体">从图</span>15<span style="font-family:宋体">可以看出，一个请求在</span>Struts2<span style="font-family:宋体">框架中的处理大概分为以下几个步骤：</span></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:21pt"> 1<span style="font-family:宋体">、客户端初始化一个指向</span>Servlet<span style="font-family:宋体">容器（例如</span>Tomcat<span style="font-family:宋体">）的请求；</span></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:21pt"> 2<span style="font-family:宋体">、这个请求经过一系列的过滤器（</span>Filter<span style="font-family:宋体">）（这些过滤器中有一个叫做</span>ActionContextCleanUp<span style="font-family:宋体">的可选过滤器，这个过滤器对于</span>Struts2<span style="font-family:宋体">和其他框架的集成很有帮助，例如：</span>SiteMesh Plugin<span style="font-family:宋体">）；</span></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:21pt"> 3<span style="font-family:宋体">、接着</span>FilterDispatcher<span style="font-family:宋体">被调用，</span>FilterDispatcher<span style="font-family:宋体">询问</span>ActionMapper<span style="font-family:宋体">来决定这个请求是否需要调用某个</span>Action<span style="font-family:宋体">；</span></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:21pt"> 4<span style="font-family:宋体">、如果</span>ActionMapper<span style="font-family:宋体">决定需要调用某个</span>Action<span style="font-family:宋体">，</span>FilterDispatcher<span style="font-family:宋体">把请求的处理交给</span>ActionProxy<span style="font-family:宋体">；</span></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:21pt"> 5<span style="font-family:宋体">、</span>ActionProxy<span style="font-family:宋体">通过</span>Configuration Manager<span style="font-family:宋体">询问框架的配置文件，找到需要调用的</span>Action<span style="font-family:宋体">类；</span></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:21pt"> 6<span style="font-family:宋体">、</span>ActionProxy<span style="font-family:宋体">创建一个</span>ActionInvocation<span style="font-family:宋体">的实例。</span></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:21pt"> 7<span style="font-family:宋体">、</span>ActionInvocation<span style="font-family:宋体">实例使用命名模式来调用，在调用</span>Action<span style="font-family:宋体">的过程前后，涉及到相关拦截器（</span>Intercepter<span style="font-family:宋体">）的调用。</span></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); text-indent:21pt"> 8<span style="font-family:宋体">、一旦</span>Action<span style="font-family:宋体">执行完毕，</span>ActionInvocation<span style="font-family:宋体">负责根据</span>struts.xml<span style="font-family:宋体">中的配置找到对应的返回结果。返回结果通常是（但不总是，也可能是另外的一个</span>Action<span style="font-family:宋体">链）一个需要被表示的</span>JSP<span style="font-family:宋体">或者</span>FreeMarker<span style="font-family:宋体">的模版。在表示的过程中可以使用</span>Struts2<span style="font-family:宋体">框架中继承的标签。在这个过程中需要涉及到</span>ActionMapper<span style="font-family:宋体">。</span></p> 
 <div style="color:rgb(51,51,51); padding:1pt 4pt; background-color:rgb(255,255,153); border:1pt solid windowtext"> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="font-family:宋体">注：以上步骤参考至网上，具体网址已忘记。在此表示感谢！</span></p> 
 </div> 
 <h4 style="margin:0px; padding:0px; color:rgb(51,51,51)"><a target="_blank" name="t14" style="color:rgb(202,0,0)"></a><a target="_blank" name="t4" style="color:rgb(51,102,153)"></a>3.3Struts2<span style="font-family:宋体">源代码分析</span></h4> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51)">       <span style="font-family:宋体">和</span>Struts1.x<span style="font-family:宋体">不同，</span>Struts2<span style="font-family:宋体">的启动是通过</span>FilterDispatcher<span style="font-family:宋体">过滤器实现的。下面是该过滤器在</span>web.xml<span style="font-family:宋体">文件中的配置：</span></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51)"> <strong><em><span style="font-family:宋体">代码清单</span>6<span style="font-family:宋体">：</span>web.xml<span style="font-family:宋体">（截取）</span></em></strong></p> 
 <div style="color:rgb(51,51,51); padding:1pt 4pt; border:1pt solid windowtext"> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><span style="color:teal; font-family:'Courier New'">&lt;</span><span style="color:rgb(63,127,127); font-family:'Courier New'">filter</span><span style="color:teal; font-family:'Courier New'">&gt;</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">      </span><span style="color:teal; font-family:'Courier New'">&lt;</span><span style="color:rgb(63,127,127); font-family:'Courier New'">filter-name</span><span style="color:teal; font-family:'Courier New'">&gt;</span><span style="color:black; font-family:'Courier New'">struts2</span><span style="color:teal; font-family:'Courier New'">&lt;/</span><span style="color:rgb(63,127,127); font-family:'Courier New'">filter-name</span><span style="color:teal; font-family:'Courier New'">&gt;</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">      </span><span style="color:teal; font-family:'Courier New'">&lt;</span><span style="color:rgb(63,127,127); font-family:'Courier New'">filter-class</span><span style="color:teal; font-family:'Courier New'">&gt;</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">           org.apache.struts2.dispatcher.FilterDispatcher</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">      </span><span style="color:teal; font-family:'Courier New'">&lt;/</span><span style="color:rgb(63,127,127); font-family:'Courier New'">filter-class</span><span style="color:teal; font-family:'Courier New'">&gt;</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><span style="color:teal; font-family:'Courier New'">&lt;/</span><span style="color:rgb(63,127,127); font-family:'Courier New'">filter</span><span style="color:teal; font-family:'Courier New'">&gt;</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><span style="color:teal; font-family:'Courier New'">&lt;</span><span style="color:rgb(63,127,127); font-family:'Courier New'">filter-mapping</span><span style="color:teal; font-family:'Courier New'">&gt;</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">      </span><span style="color:teal; font-family:'Courier New'">&lt;</span><span style="color:rgb(63,127,127); font-family:'Courier New'">filter-name</span><span style="color:teal; font-family:'Courier New'">&gt;</span><span style="color:black; font-family:'Courier New'">struts2</span><span style="color:teal; font-family:'Courier New'">&lt;/</span><span style="color:rgb(63,127,127); font-family:'Courier New'">filter-name</span><span style="color:teal; font-family:'Courier New'">&gt;</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">      </span><span style="color:teal; font-family:'Courier New'">&lt;</span><span style="color:rgb(63,127,127); font-family:'Courier New'">url-pattern</span><span style="color:teal; font-family:'Courier New'">&gt;</span><span style="color:black; font-family:'Courier New'">/*</span><span style="color:teal; font-family:'Courier New'">&lt;/</span><span style="color:rgb(63,127,127); font-family:'Courier New'">url-pattern</span><span style="color:teal; font-family:'Courier New'">&gt;</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><span style="color:teal; font-family:'Courier New'">&lt;/</span><span style="color:rgb(63,127,127); font-family:'Courier New'">filter-mapping</span><span style="color:teal; font-family:'Courier New'">&gt;</span></p> 
 </div> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51)">        Struts2<span style="font-family:宋体">建议，在对</span>Struts2<span style="font-family:宋体">的配置尚不熟悉的情况下，将</span>url-pattern<span style="font-family:宋体">配置为</span>/*<span style="font-family:宋体">，这样该过滤器将截拦所有请求。</span></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51)">       <span style="font-family:宋体">实际上，</span><span style="color:black; font-family:'Courier New'">FilterDispatcher</span><span style="color:black; font-family:宋体">除了实现</span><span style="color:black; font-family:'Courier New'">Filter</span><span style="color:black; font-family:宋体">接口以外，还实现了</span><span style="color:black; font-family:'Courier New'">StrutsStatics</span><span style="color:black; font-family:宋体">接口，继承代码如下：</span></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51)"> <strong><em><span style="color:black; font-family:宋体">代码清单</span><span style="color:black; font-family:'Courier New'">7</span><span style="color:black; font-family:宋体">：</span><span style="color:black; font-family:'Courier New'">FilterDispatcher</span><span style="color:black; font-family:宋体">结构</span></em></strong></p> 
 <div style="color:rgb(51,51,51); padding:1pt 4pt; border:1pt solid windowtext"> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">public</span><span style="color:rgb(127,0,85); font-family:'Courier New'">class</span></strong><span style="color:black; font-family:'Courier New'">FilterDispatcher</span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">implements</span></strong><span style="color:black; font-family:'Courier New'">StrutsStatics, Filter {<!-- --></span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">}</span></p> 
 </div> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51)"> <span style="color:black; font-family:'Courier New'">StrutsStatics</span><span style="color:black; font-family:宋体">并没有定义业务方法，只定义了若干个常量。</span><span style="color:black; font-family:'Courier New'">Struts2</span><span style="color:black; font-family:宋体">对常用的接口进行了重新封装，比如</span><span style="color:black; font-family:'Courier New'">HttpServletRequest</span><span style="color:black; font-family:宋体">、</span><span style="color:black; font-family:'Courier New'">HttpServletResponse</span><span style="color:black; font-family:宋体">、</span><span style="color:black; font-family:'Courier New'">HttpServletContext</span><span style="color:black; font-family:宋体">等。　以下是</span><span style="color:black; font-family:'Courier New'">StrutsStatics</span><span style="color:black; font-family:宋体">的定义：</span></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51)"> <strong><em><span style="color:black; font-family:宋体">代码清单</span><span style="color:black; font-family:'Courier New'">8</span><span style="color:black; font-family:宋体">：</span><span style="color:black; font-family:'Courier New'">StrutsStatics.java</span></em></strong></p> 
 <div style="color:rgb(51,51,51); padding:1pt 4pt; border:1pt solid windowtext"> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">public</span><span style="color:rgb(127,0,85); font-family:'Courier New'">interface</span></strong><span style="color:black; font-family:'Courier New'">StrutsStatics {<!-- --></span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><span style="color:rgb(63,95,191); font-family:'Courier New'">/**</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">    </span><span style="color:rgb(63,95,191); font-family:'Courier New'">*</span><span style="color:rgb(63,95,191); font-family:'Courier New'">Constant</span><span style="color:rgb(63,95,191); font-family:'Courier New'">for</span><span style="color:rgb(63,95,191); font-family:'Courier New'">the</span><span style="color:rgb(63,95,191); font-family:'Courier New'">HTTP</span><span style="color:rgb(63,95,191); font-family:'Courier New'">request</span><span style="color:rgb(63,95,191); font-family:'Courier New'">object.</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">    </span><span style="color:rgb(63,95,191); font-family:'Courier New'">*/</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">public</span><span style="color:rgb(127,0,85); font-family:'Courier New'">static</span><span style="color:rgb(127,0,85); font-family:'Courier New'">final</span></strong><span style="color:black; font-family:'Courier New'">String</span><em><span style="color:rgb(0,0,192); font-family:'Courier New'">HTTP_REQUEST</span></em><span style="color:black; font-family:'Courier New'">=</span><span style="color:rgb(42,0,255); font-family:'Courier New'">"com.opensymphony.xwork2.dispatcher.HttpServletRequest"</span><span style="color:black; font-family:'Courier New'">;</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><span style="color:rgb(63,95,191); font-family:'Courier New'">/**</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">    </span><span style="color:rgb(63,95,191); font-family:'Courier New'">*</span><span style="color:rgb(63,95,191); font-family:'Courier New'">Constant</span><span style="color:rgb(63,95,191); font-family:'Courier New'">for</span><span style="color:rgb(63,95,191); font-family:'Courier New'">the</span><span style="color:rgb(63,95,191); font-family:'Courier New'">HTTP</span><span style="color:rgb(63,95,191); font-family:'Courier New'">response</span><span style="color:rgb(63,95,191); font-family:'Courier New'">object.</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">    </span><span style="color:rgb(63,95,191); font-family:'Courier New'">*/</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">public</span><span style="color:rgb(127,0,85); font-family:'Courier New'">static</span><span style="color:rgb(127,0,85); font-family:'Courier New'">final</span></strong><span style="color:black; font-family:'Courier New'">String</span><em><span style="color:rgb(0,0,192); font-family:'Courier New'">HTTP_RESPONSE</span></em><span style="color:black; font-family:'Courier New'">=</span><span style="color:rgb(42,0,255); font-family:'Courier New'">"com.opensymphony.xwork2.dispatcher.HttpServletResponse"</span><span style="color:black; font-family:'Courier New'">;</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><span style="color:rgb(63,95,191); font-family:'Courier New'">/**</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">    </span><span style="color:rgb(63,95,191); font-family:'Courier New'">*</span><span style="color:rgb(63,95,191); font-family:'Courier New'">Constant</span><span style="color:rgb(63,95,191); font-family:'Courier New'">for</span><span style="color:rgb(63,95,191); font-family:'Courier New'">an</span><span style="color:rgb(63,95,191); font-family:'Courier New'">HTTP</span><span style="color:rgb(63,63,191); font-family:'Courier New'">request dispatcher}</span><span style="color:rgb(63,95,191); font-family:'Courier New'">.</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">    </span><span style="color:rgb(63,95,191); font-family:'Courier New'">*/</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">public</span><span style="color:rgb(127,0,85); font-family:'Courier New'">static</span><span style="color:rgb(127,0,85); font-family:'Courier New'">final</span></strong><span style="color:black; font-family:'Courier New'">String</span><em><span style="color:rgb(0,0,192); font-family:'Courier New'">SERVLET_DISPATCHER</span></em><span style="color:black; font-family:'Courier New'">=</span><span style="color:rgb(42,0,255); font-family:'Courier New'">"com.opensymphony.xwork2.dispatcher.ServletDispatcher"</span><span style="color:black; font-family:'Courier New'">;</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><span style="color:rgb(63,95,191); font-family:'Courier New'">/**</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">    </span><span style="color:rgb(63,95,191); font-family:'Courier New'">*</span><span style="color:rgb(63,95,191); font-family:'Courier New'">Constant</span><span style="color:rgb(63,95,191); font-family:'Courier New'">for</span><span style="color:rgb(63,95,191); font-family:'Courier New'">the</span><span style="color:rgb(63,63,191); font-family:'Courier New'">servlet context}</span><span style="color:rgb(63,95,191); font-family:'Courier New'">object.</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">    </span><span style="color:rgb(63,95,191); font-family:'Courier New'">*/</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">public</span><span style="color:rgb(127,0,85); font-family:'Courier New'">static</span><span style="color:rgb(127,0,85); font-family:'Courier New'">final</span></strong><span style="color:black; font-family:'Courier New'">String</span><em><span style="color:rgb(0,0,192); font-family:'Courier New'">SERVLET_CONTEXT</span></em><span style="color:black; font-family:'Courier New'">=</span><span style="color:rgb(42,0,255); font-family:'Courier New'">"com.opensymphony.xwork2.dispatcher.ServletContext"</span><span style="color:black; font-family:'Courier New'">;</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><span style="color:rgb(63,95,191); font-family:'Courier New'">/**</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">    </span><span style="color:rgb(63,95,191); font-family:'Courier New'">*</span><span style="color:rgb(63,95,191); font-family:'Courier New'">Constant</span><span style="color:rgb(63,95,191); font-family:'Courier New'">for</span><span style="color:rgb(63,95,191); font-family:'Courier New'">the</span><span style="color:rgb(63,95,191); font-family:'Courier New'">JSP</span><span style="color:rgb(63,63,191); font-family:'Courier New'">page context}</span><span style="color:rgb(63,95,191); font-family:'Courier New'">.</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">    </span><span style="color:rgb(63,95,191); font-family:'Courier New'">*/</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm; text-indent:21pt"> <strong><span style="color:rgb(127,0,85); font-family:'Courier New'">public</span><span style="color:rgb(127,0,85); font-family:'Courier New'">static</span><span style="color:rgb(127,0,85); font-family:'Courier New'">final</span></strong><span style="color:black; font-family:'Courier New'">String</span><em><span style="color:rgb(0,0,192); font-family:'Courier New'">PAGE_CONTEXT</span></em><span style="color:black; font-family:'Courier New'">=</span><span style="color:rgb(42,0,255); font-family:'Courier New'">"com.opensymphony.xwork2.dispatcher.PageContext"</span><span style="color:black; font-family:'Courier New'">;</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><span style="color:rgb(63,95,191); font-family:'Courier New'">/**</span><span style="color:rgb(63,95,191); font-family:'Courier New'">Constant</span><span style="color:rgb(63,95,191); font-family:'Courier New'">for</span><span style="color:rgb(63,95,191); font-family:'Courier New'">the</span><span style="color:rgb(63,95,191); font-family:'Courier New'">PortletContext</span><span style="color:rgb(63,95,191); font-family:'Courier New'">object</span><span style="color:rgb(63,95,191); font-family:'Courier New'">*/</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">public</span><span style="color:rgb(127,0,85); font-family:'Courier New'">static</span><span style="color:rgb(127,0,85); font-family:'Courier New'">final</span></strong><span style="color:black; font-family:'Courier New'">String</span><em><span style="color:rgb(0,0,192); font-family:'Courier New'">STRUTS_PORTLET_CONTEXT</span></em><span style="color:black; font-family:'Courier New'">=</span><span style="color:rgb(42,0,255); font-family:'Courier New'">"struts.portlet.context"</span><span style="color:black; font-family:'Courier New'">;</span></p> 
  <p align="left" style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">}</span></p> 
 </div> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51)"> <span style="color:black; font-family:'Courier New'">   </span><span style="color:black; font-family:宋体">容器启动后，</span><span style="color:black; font-family:'Courier New'">FilterDispatcher</span><span style="color:black; font-family:宋体">被实例化，调用</span><span style="color:black; font-family:'Courier New'">init(FilterConfig filterConfig)</span><span style="color:black; font-family:宋体">方法。该方法创建</span><span style="color:black; font-family:'Courier New'">Dispatcher</span><span style="color:black; font-family:宋体">类的对象，并且将</span><span style="color:black; font-family:'Courier New'">FilterDispatcher</span><span style="color:black; font-family:宋体">配置的初始化参数传到对象中（详情请参考代码清单</span><span style="color:black; font-family:'Courier New'">10</span><span style="color:black; font-family:宋体">），并负责</span><span style="color:black; font-family:'Courier New'">Action</span><span style="color:black; font-family:宋体">的执行。然后得到参数</span><span style="color:black; font-family:'Courier New'">packages</span><span style="color:black; font-family:宋体">，值得注意的是，还有另外三个固定的包和该参数进行拼接，分别是</span><span style="color:black; font-family:'Courier New'">org.apache.struts2.static</span><span style="color:black; font-family:宋体">、</span><span style="color:black; font-family:'Courier New'">template</span><span style="color:black; font-family:宋体">、和</span><span style="color:black; font-family:'Courier New'">org.apache.struts2.interceptor.debugging</span><span style="color:black; font-family:宋体">，中间用空格隔开，经过解析将包名变成路径后存储到一个名叫</span><span style="color:black; font-family:'Courier New'">pathPrefixes</span><span style="color:black; font-family:宋体">的数组中，这些目录中的文件会被自动搜寻。</span></p> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51)"> <strong><em><span style="color:black; font-family:宋体">代码清单</span><span style="color:black; font-family:'Courier New'">9</span><span style="color:black; font-family:宋体">：</span><span style="color:black; font-family:'Courier New'">FilterDispatcher.init()</span><span style="color:black; font-family:宋体">方法</span></em></strong></p> 
 <div style="color:rgb(51,51,51); padding:1pt 4pt; border:1pt solid windowtext"> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">public</span><span style="color:rgb(127,0,85); font-family:'Courier New'">void</span></strong><span style="color:black; font-family:'Courier New'">init(FilterConfig filterConfig)</span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">throws</span></strong><span style="color:black; font-family:'Courier New'">ServletException {<!-- --></span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">this</span></strong><span style="color:black; font-family:'Courier New'">.filterConfig = filterConfig;      </span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       dispatcher = createDispatcher(filterConfig);</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       dispatcher.init();      </span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       String param = filterConfig.getInitParameter(</span><span style="color:rgb(42,0,255); font-family:'Courier New'">"packages"</span><span style="color:black; font-family:'Courier New'">);</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       String packages =</span><span style="color:rgb(42,0,255); font-family:'Courier New'">"org.apache.struts2.static template org.apache.struts2.interceptor.debugging"</span><span style="color:black; font-family:'Courier New'">;</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">if</span></strong><span style="color:black; font-family:'Courier New'">(param !=</span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">null</span></strong><span style="color:black; font-family:'Courier New'">) {<!-- --></span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">            packages = param +</span><span style="color:rgb(42,0,255); font-family:'Courier New'">" "</span><span style="color:black; font-family:'Courier New'">+ packages;</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       }</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">this</span></strong><span style="color:black; font-family:'Courier New'">.</span><span style="color:rgb(0,0,192); font-family:'Courier New'">pathPrefixes</span><span style="color:black; font-family:'Courier New'">= parse(packages);</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm; text-indent:21pt"><span style="color:black; font-family:'Courier New'">}</span></p> 
 </div> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51)"> <strong><em><span style="color:black; font-family:宋体">代码清单</span><span style="color:black; font-family:'Courier New'">10</span><span style="color:black; font-family:宋体">：</span><span style="color:black; font-family:'Courier New'">FilterDispatcher.createDispatcher()</span><span style="color:black; font-family:宋体">方法</span></em></strong></p> 
 <div style="color:rgb(51,51,51); padding:1pt 4pt; border:1pt solid windowtext"> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">protected</span></strong><span style="color:black; font-family:'Courier New'">Dispatcher createDispatcher(FilterConfig filterConfig) {<!-- --></span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       Map&lt;String,String&gt; params =</span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">new</span></strong><span style="color:black; font-family:'Courier New'">HashMap&lt;String,String&gt;();</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">for</span></strong><span style="color:black; font-family:'Courier New'">(Enumeration e = filterConfig.getInitParameterNames(); e.hasMoreElements(); ) {<!-- --></span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">           String name = (String) e.nextElement();</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">           String value = filterConfig.getInitParameter(name);</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">           params.put(name, value);</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       }</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">       </span><strong><span style="color:rgb(127,0,85); font-family:'Courier New'">return</span><span style="color:rgb(127,0,85); font-family:'Courier New'">new</span></strong><span style="color:black; font-family:'Courier New'">Dispatcher(filterConfig.getServletContext(), params);</span></p> 
  <p style="margin-top:0px; margin-bottom:0px; padding:0cm"><span style="color:black; font-family:'Courier New'">   }</span></p> 
 </div> 
 <p style="margin-top:0px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51)"> <span style="color:black; font-family:'Courier New'">   </span><span style="color:black; font-family:宋体">当用户向</span><span style="color:black; font-family:'Courier New'">Struts2</span><span style="color:black; font-family:宋体">发送请求时，</span><span style="color:black; font-family:'Courier New'">FilterDispatcher</span><span style="color:black; font-family:宋体">的</span><span style="color:black; font-family:'Courier New'">doFilter()</span><span style="color:black; font-family:宋体">方法自动调用，这个方法非常关键。首先，</span><span style="color:black; font-family:'Courier New'">Struts2</span><span style="color:black; font-family:宋体">对请求对象进行重新包装，此次包装根据请求内容的类型不同，返回不同的对象，如果为</span><span style="color:black; font-family:'Courier New'">multipart/form-data</span><span style="color:black; font-family:宋体">类型，则返回</span><span style="color:black; font-family:'Courier New'">MultiPartRequestWrapper</span><span style="color:black; font-family:宋体">类型的对象，该对象服务于文件上传，否则返回</span><span style="color:black; font-family:'Courier New'">StrutsRequestWrapper</span><span style="color:black; font-family:宋体">类型的对象，</span><span style="color:black; font-family:'Courier New'">MultiPartRequestWrapper</span><span style="color:black; font-family:宋体">是</span><span style="color:black; font-family:'Courier New'">StrutsRequestWrapper</span><span style="color:black; font-family:宋体">的子类，而这两个类都是</span><span style="color:black; font-family:'Courier New'">HttpServletRequest</span><span style="color:black; font-family:宋体">接口的实现。包装请求对象如代码清单</span><span style="color:black; font-family:'Courier New'">11</span><span style="color:black; font-family:宋体">所示：</span></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c3653e6666eddb234dae3b260e9eb55e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Callable接口与Runnable接口的区别</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c5e0f3f81d124a4b88341baee5651955/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Mac 死机后导致 PostgreSQL 无法连接</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>