<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>大数据-之LibrA数据库系统告警处理（ALM-37018 数据库用户连接数超限） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="大数据-之LibrA数据库系统告警处理（ALM-37018 数据库用户连接数超限）" />
<meta property="og:description" content="告警解释 当集群中单个CN实例上某个用户的连接数超过限制时，产生该告警。
告警属性 告警ID
告警级别
可自动清除
37018
严重
是
告警参数 参数名称
参数含义
ServiceName
产生告警的服务名称
RoleName
产生告警的角色名称
HostName
产生告警的主机名
Instance
产生告警的实例
databaseName
连接的数据库名称
dbUserName
连接数据库的用户名
对系统的影响 发生数据库用户连接数超限时，该CN实例无法再以该用户访问。
可能原因 当前CN实例上该数据库用户的连接数超过限制。
处理步骤 以数据库管理员用户(该用户有权限创建其他数据库用户，比如omm)访问上报告警的CN实例。具体操作如下所示。 gsql -d postgres -p 25308 postgres=# 检查当前CN实例上所有用户的连接数限制。可以看到在该CN实例上gaussdba用户的连接数被限制为3。 postgres=# select * from pg_authid; rolname | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcatupdate | rolcanlogin | rolreplication | rolauditadmin | rolsystemadmin | rolconnlimit | rolpassword | rolvaliduntil -------------&#43;----------&#43;------------&#43;---------------&#43;-------------&#43;--------------&#43;-------------&#43;----------------&#43;---------------&#43;----------------&#43;--------------&#43;-------------------------------------------------------------------------- ------------------------------------------------------------------------------------------------------------------------------&#43;--------------- gaussdba | t | t | t | t | t | t | t | t | t | 3 | sha2567cee5d311c1e21e84671a2f2e1d8023f1990b4fa7c5656e44277acd3087e2c7fc74 224dbb26375c88c91c9007af78fb1e5212656ec482957bf8fe8ce383b0f59d3ae6152aa0009ee46271d0446eb8cd0d0e461b09c17f93449c14d4c75238b3d | (1 row) 可以选择关闭部分连接或者增加连接数限制，来处理该告警。增加连接数限制操作示例如下。 postgres=# alter role gaussdba CONNECTION LIMIT 9; ALTER ROLE postgres=# select * from pg_authid; rolname | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcatupdate | rolcanlogin | rolreplication | rolauditadmin | rolsystemadmin | rolconnlimit | rolpassword | rolvaliduntil -------------&#43;----------&#43;------------&#43;---------------&#43;-------------&#43;--------------&#43;-------------&#43;----------------&#43;---------------&#43;----------------&#43;--------------&#43;-------------------------------------------------------------------------- ------------------------------------------------------------------------------------------------------------------------------&#43;--------------- gaussdba | t | t | t | t | t | t | t | t | t | 9 | sha2567cee5d311c1e21e84671a2f2e1d8023f1990b4fa7c5656e44277acd3087e2c7fc74 224dbb26375c88c91c9007af78fb1e5212656ec482957bf8fe8ce383b0f59d3ae6152aa0009ee46271d0446eb8cd0d0e461b09c17f93449c14d4c75238b3d | (1 row) 再用gaussdba的用户连接数据库，查看告警是否仍然存在。 是，执行5。否，处理完毕。收集故障信息。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c999eac99c19957d86d1f887cc5f12b8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-30T22:00:00+08:00" />
<meta property="article:modified_time" content="2023-11-30T22:00:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">大数据-之LibrA数据库系统告警处理（ALM-37018 数据库用户连接数超限）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h5>告警解释</h5> 
<p id="ZH-CN_TOPIC_0085587314__a2212b5f74cea4d1188e4beac39084b96">当集群中单个CN实例上某个用户的连接数超过限制时，产生该告警。</p> 
<h5>告警属性</h5> 
<table border="1" cellpadding="4" cellspacing="0" id="ZH-CN_TOPIC_0085587314__tfed2b90cde95453caa16f447751d6558"><thead><tr id="ZH-CN_TOPIC_0085587314__r7437454e47f94c07b6f9a4bc07a9be23"><th id="mcps1.3.2.2.1.4.1.1"> <p id="ZH-CN_TOPIC_0085587314__adf5369f411cb4ec9b6ea52a81f5df4ce">告警ID</p> </th><th id="mcps1.3.2.2.1.4.1.2"> <p id="ZH-CN_TOPIC_0085587314__a1250f9f1dc324f64a5a1e5dd1f7a7d22">告警级别</p> </th><th id="mcps1.3.2.2.1.4.1.3"> <p id="ZH-CN_TOPIC_0085587314__a47c2d9f361414958b73c1c4950bab1f9">可自动清除</p> </th></tr></thead><tbody><tr id="ZH-CN_TOPIC_0085587314__r2982d82a953f4535bb9f2a5d6d21de2f"><td style="vertical-align:top;"> <p id="ZH-CN_TOPIC_0085587314__a8f4d243732e445e9bb21842191e8e9b8">37018</p> </td><td style="vertical-align:top;"> <p id="ZH-CN_TOPIC_0085587314__a91069d1063a34c1d85142bdc351420a9">严重</p> </td><td style="vertical-align:top;"> <p id="ZH-CN_TOPIC_0085587314__a5b6ba193b7fd48c9a8cc95f013ba5396">是</p> </td></tr></tbody></table> 
<h5>告警参数</h5> 
<table border="1" cellpadding="4" cellspacing="0" id="ZH-CN_TOPIC_0085587314__t349daf6aac79452ba3fb385448472e39"><thead><tr id="ZH-CN_TOPIC_0085587314__rbb28c8cd320d4dc6983f284fbdeb178d"><th id="mcps1.3.3.2.1.3.1.1"> <p id="ZH-CN_TOPIC_0085587314__a4f290ff7d34d434e958b12d84320db59">参数名称</p> </th><th id="mcps1.3.3.2.1.3.1.2"> <p id="ZH-CN_TOPIC_0085587314__aa8ff53476b5e49c2ad013d8c08979f56">参数含义</p> </th></tr></thead><tbody><tr id="ZH-CN_TOPIC_0085587314__r4722589e7c5947f6b511102d0888aec7"><td style="vertical-align:top;"> <p id="ZH-CN_TOPIC_0085587314__a618c8c268ccf44fbb40efc7f00b4262c">ServiceName</p> </td><td style="vertical-align:top;"> <p id="ZH-CN_TOPIC_0085587314__aa03820dfd0ca44f0930d441df529b10f">产生告警的服务名称</p> </td></tr><tr id="ZH-CN_TOPIC_0085587314__r8698e8d60ee14d3b91d21cdcaf0501a9"><td style="vertical-align:top;"> <p id="ZH-CN_TOPIC_0085587314__a7d94f94d29014ec9adae437c84d8612c">RoleName</p> </td><td style="vertical-align:top;"> <p id="ZH-CN_TOPIC_0085587314__af8b7638376c74c4cb9f0a05a242c6b58">产生告警的角色名称</p> </td></tr><tr id="ZH-CN_TOPIC_0085587314__r544a5cd1afb14c84b07e800fab30ae79"><td style="vertical-align:top;"> <p id="ZH-CN_TOPIC_0085587314__acd1c7344a4c7418fb282646c70370102">HostName</p> </td><td style="vertical-align:top;"> <p id="ZH-CN_TOPIC_0085587314__abad340ad8f20423ea45a328a6b79204d">产生告警的主机名</p> </td></tr><tr id="ZH-CN_TOPIC_0085587314__rd443503f8ddb41bb91e7b4f657ad0213"><td style="vertical-align:top;"> <p id="ZH-CN_TOPIC_0085587314__aa1a978e9e9b5414c90679fc0d0492cea">Instance</p> </td><td style="vertical-align:top;"> <p id="ZH-CN_TOPIC_0085587314__afb9d547c2282430abfc48f9667049eda">产生告警的实例</p> </td></tr><tr id="ZH-CN_TOPIC_0085587314__r653b24f12cf44ae5960dfe207b85a538"><td style="vertical-align:top;"> <p id="ZH-CN_TOPIC_0085587314__a8ed5d534ec2144e386a5eb9db7389f48">databaseName</p> </td><td style="vertical-align:top;"> <p id="ZH-CN_TOPIC_0085587314__a9e94ea104e704164863b78cc3c95302e">连接的数据库名称</p> </td></tr><tr id="ZH-CN_TOPIC_0085587314__r9ff39f7e1ba84189ac8f96a42c28f3d8"><td style="vertical-align:top;"> <p id="ZH-CN_TOPIC_0085587314__ad1cfbfafe64d4065bd8def869b92fdb8">dbUserName</p> </td><td style="vertical-align:top;"> <p id="ZH-CN_TOPIC_0085587314__a42db7c52e4da47b48af0beae18c2f492">连接数据库的用户名</p> </td></tr></tbody></table> 
<h5>对系统的影响</h5> 
<p id="ZH-CN_TOPIC_0085587314__a4020cbf2b85a41fab6dc3d2beea8598e">发生数据库用户连接数超限时，该CN实例无法再以该用户访问。</p> 
<h5>可能原因</h5> 
<p id="ZH-CN_TOPIC_0085587314__a7068df97865f4013ac421c27fa9bf08b">当前CN实例上该数据库用户的连接数超过限制。</p> 
<h5>处理步骤</h5> 
<ol id="ZH-CN_TOPIC_0085587314__oc166af8a41504df4ba9d6ee93a91afb7"><li id="ZH-CN_TOPIC_0085587314__lff9e285057ce41dbb7326445cc128af3">以数据库管理员用户(该用户有权限创建其他数据库用户，比如<strong id="ZH-CN_TOPIC_0085587314__a0290b84a36314d09977456fa96c72e48">omm</strong>)访问上报告警的CN实例。具体操作如下所示。 <pre id="ZH-CN_TOPIC_0085587314__sfdce220059e5436d8577d80d4a081bdb">gsql -d postgres -p 25308
postgres=#</pre> </li><li id="ZH-CN_TOPIC_0085587314__l54c9263f04f94f04bf1eb8374a7990b8">检查当前CN实例上所有用户的连接数限制。可以看到在该CN实例上gaussdba用户的连接数被限制为3。 <pre id="ZH-CN_TOPIC_0085587314__s5e15d25050ff42fb84f7e97e49840b5c">postgres=# select * from pg_authid;
   rolname   | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcatupdate | rolcanlogin | rolreplication | rolauditadmin | rolsystemadmin | rolconnlimit |                                                                          
                    rolpassword                                                                                               | rolvaliduntil 
-------------+----------+------------+---------------+-------------+--------------+-------------+----------------+---------------+----------------+--------------+--------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------+---------------
 gaussdba | t        | t          | t             | t           | t            | t           | t              | t             | t              |            3 | sha2567cee5d311c1e21e84671a2f2e1d8023f1990b4fa7c5656e44277acd3087e2c7fc74
224dbb26375c88c91c9007af78fb1e5212656ec482957bf8fe8ce383b0f59d3ae6152aa0009ee46271d0446eb8cd0d0e461b09c17f93449c14d4c75238b3d | 
(1 row)</pre> </li><li id="ZH-CN_TOPIC_0085587314__l5a184779cb8c461c8f841e0d6dd409dc">可以选择关闭部分连接或者增加连接数限制，来处理该告警。增加连接数限制操作示例如下。 <pre id="ZH-CN_TOPIC_0085587314__s55cf01f6cf0f473c86882e28ce36562e">postgres=# alter role gaussdba CONNECTION LIMIT 9;
ALTER ROLE
postgres=# select * from pg_authid;
   rolname   | rolsuper | rolinherit | rolcreaterole | rolcreatedb | rolcatupdate | rolcanlogin | rolreplication | rolauditadmin | rolsystemadmin | rolconnlimit |                                                                          
                    rolpassword                                                                                               | rolvaliduntil 
-------------+----------+------------+---------------+-------------+--------------+-------------+----------------+---------------+----------------+--------------+--------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------------------+---------------
 gaussdba | t        | t          | t             | t           | t            | t           | t              | t             | t              |            9 | sha2567cee5d311c1e21e84671a2f2e1d8023f1990b4fa7c5656e44277acd3087e2c7fc74
224dbb26375c88c91c9007af78fb1e5212656ec482957bf8fe8ce383b0f59d3ae6152aa0009ee46271d0446eb8cd0d0e461b09c17f93449c14d4c75238b3d | 
(1 row)</pre> </li><li id="ZH-CN_TOPIC_0085587314__l28561c3f065c4ed68c6d12bf2b3cbb0d">再用gaussdba的用户连接数据库，查看告警是否仍然存在。 
  <ul id="ZH-CN_TOPIC_0085587314__ua58dd031776148c99170ccc6e4d7b523"><li id="ZH-CN_TOPIC_0085587314__l8515b944bfd341db91402cb6b68efbbe">是，执行<a href="#ZH-CN_TOPIC_0085587314__l07cfdca40222450baabc63ed50a35732" rel="nofollow">5</a>。</li><li id="ZH-CN_TOPIC_0085587314__ld962b0576be94669a24eca0c0a747f35">否，处理完毕。</li></ul><p id="ZH-CN_TOPIC_0085587314__a0852ba5450f64aa9a67c79691d8ff7ec">收集故障信息。</p> </li><li id="ZH-CN_TOPIC_0085587314__l07cfdca40222450baabc63ed50a35732"><a name="l07cfdca40222450baabc63ed50a35732"></a>在FusionInsight Manager界面，单击“系统设置 &gt; 日志下载”。</li><li id="ZH-CN_TOPIC_0085587314__l7975b4ececc8491d9657d142536febdd">在“服务”下拉框中勾选“MPPDB”，单击“确定”。</li><li id="ZH-CN_TOPIC_0085587314__l50223e97e6f64ca89a72f25ecbd166f1">设置日志收集的“开始时间”和“结束时间”分别为告警产生时间的前后1小时，单击“下载”。</li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5616643428fdf3221269b6bae812a5b1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【栈与队列】栈与队列的相互转换OJ题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a1dc83d6a144093773015a023621da9c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MATLAB--控制语句--数组操作--符号运算--绘图--文件和数据的处理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>