<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Geometry空间几何数据的处理应用（全） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Geometry空间几何数据的处理应用（全）" />
<meta property="og:description" content="学前小故事
学前必备基础知识
WTK格式的Geomotry
GeoJSON格式的Geomotry
JTS(Java Topology Suite) Java拓扑套件
JTS(Java Topology Suite) 可视化界面
泰森多边形
向空间数据库插入数据
栅格
GDAL GeoTools QGIS
快速导航
学前小故事
项目需求是跟用户当前位置判断是否在给定的地理位置范围内，符合位置限制才可以打卡，其中的位置范围是一个或多个不规则的多边形。如下图，判断用户是在清华还是北大。
图形获取区域坐标
因为项目前端使用微信小程序的wx.getLocation获取地理位置，为了坐标的一致性，后台选取区域范围采用了腾讯地图的地理位置服务，在应用工具-&gt;绘制几何图形里，提供了点、线、多边形和圆形可以方便的选取看这里
在官方提供的示例上稍加改动即可获取选定的位置坐标。
存储位置
取到坐标位置后，接着就是怎么存储？
开放地理空间联盟(OGC)是一个由 250多家公司，机构和大学组成的国际联盟，参与开发公开可用的空间解决方案，这些解决方案可用于管理空间数据的各种应用程序。OGC发布了地理信息的 OpenGIS®Implementation 标准，该规范可从 OGC 网站http://www.opengeospatial.org/standards/sfs获得。
为了遵循 OGC 规范，MySQL 将空间 extensions 实现为具有 Geometry Types 环境的 SQL 的子集，提供生成、存储、分析空间的功能。总之，MySQL可以满足我们的需求。
MySQL提供单个的存储类型 POINT、LINESTRING、POLYGON 对应几何图形点、线、多边形，GEOMETRY 可以存储三种中的任何一种。
同时拥有存储多种类型的能力， MULTIPOINT、MULTILINESTRING、MULTIPOLYGON、GEOMETRYCOLLECTION依次对应单个图形的复数。
回到项目中，我们用到的是 POLYGON ，建表语句 如下：
CREATE TABLE `polygon` ( `id` int(10) unsigned NOT NULL AUTO_INCREMENT, `name` varchar(255) DEFAULT NULL, `polygon` polygon NOT NULL, PRIMARY KEY (`id`), SPATIAL KEY `d` (`polygon`) ) DEFAULT CHARSET=utf8; 插入数据" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0cf52e9d4cbf69f335471c2c7c5b2d6e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-23T16:23:44+08:00" />
<meta property="article:modified_time" content="2023-04-23T16:23:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Geometry空间几何数据的处理应用（全）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><a href="#changj" rel="nofollow"><font size="2" face="宋体">学前小故事</font></a></p> 
<p><a href="#bb" rel="nofollow"><font size="2" face="宋体">学前必备基础知识</font></a></p> 
<p><a href="#xz" rel="nofollow"><font size="2" face="宋体">WTK格式的Geomotry</font></a></p> 
<p><a href="#geojson" rel="nofollow"><font size="2" face="宋体">GeoJSON格式的Geomotry</font></a></p> 
<p><a href="#JTS" rel="nofollow"><font size="2" face="宋体">JTS(Java Topology Suite) Java拓扑套件</font></a></p> 
<p><a href="#keshihua" rel="nofollow"><font size="2" face="宋体">JTS(Java Topology Suite) 可视化界面</font></a></p> 
<p><a href="#tsdbx" rel="nofollow"><font size="2" face="宋体">泰森多边形</font></a></p> 
<p><a href="#crsj" rel="nofollow"><font size="2" face="宋体">向空间数据库插入数据</font></a></p> 
<p><a href="#zhage" rel="nofollow"><font size="2" face="宋体">栅格</font></a></p> 
<p><a href="#gdal" rel="nofollow"><font size="2" face="宋体">GDAL </font></a></p> 
<p><a href="#geo" rel="nofollow"><font size="2" face="宋体">GeoTools </font></a></p> 
<p><a href="#qgis" rel="nofollow"><font size="2" face="宋体">QGIS</font></a></p> 
<p><a href="#kuaisudaoh" rel="nofollow"><font size="2" face="宋体">快速导航</font></a></p> 
<blockquote> 
 <p><font size="3" face="宋体" color="black"><span id="changj">学前小故事</span></font></p> 
</blockquote> 
<p><font size="2" face="宋体">项目需求是跟用户当前位置判断是否在给定的地理位置范围内，符合位置限制才可以打卡，其中的位置范围是一个或多个不规则的多边形。如下图，判断用户是在清华还是北大。</font></p> 
<p><img src="https://images2.imgbox.com/d8/7c/W1E5WYTn_o.png" alt="在这里插入图片描述"><br> <font size="2" face="宋体" color="黑体">图形获取区域坐标</font></p> 
<p><font size="2" face="宋体">因为项目前端使用微信小程序的wx.getLocation获取地理位置，为了坐标的一致性，后台选取区域范围采用了腾讯地图的地理位置服务，在应用工具-&gt;绘制几何图形里，提供了点、线、多边形和圆形可以方便的选取<a href="https://lbs.qq.com/webDemoCenter/glAPI/glEditor/toolDraw" rel="nofollow">看这里</a></font></p> 
<p><font size="2" face="宋体">在官方提供的示例上稍加改动即可获取选定的位置坐标。</font></p> 
<p><img src="https://images2.imgbox.com/ff/b0/ysBJZKE5_o.png" alt="在这里插入图片描述"></p> 
<p><font size="2" face="宋体" color="黑体">存储位置</font></p> 
<p><font size="2" face="宋体">取到坐标位置后，接着就是怎么存储？</font></p> 
<p><font size="2" face="宋体">开放地理空间联盟(OGC)是一个由 250多家公司，机构和大学组成的国际联盟，参与开发公开可用的空间解决方案，这些解决方案可用于管理空间数据的各种应用程序。OGC发布了地理信息的 OpenGIS®Implementation 标准，该规范可从 OGC 网站http://www.opengeospatial.org/standards/sfs获得。</font></p> 
<p><font size="2" face="宋体">为了遵循 OGC 规范，MySQL 将空间 extensions 实现为具有 Geometry Types 环境的 SQL 的子集，提供生成、存储、分析空间的功能。总之，MySQL可以满足我们的需求。</font></p> 
<p><font size="2" face="宋体">MySQL提供单个的存储类型 POINT、LINESTRING、POLYGON 对应几何图形点、线、多边形，GEOMETRY 可以存储三种中的任何一种。<br> 同时拥有存储多种类型的能力， MULTIPOINT、MULTILINESTRING、MULTIPOLYGON、GEOMETRYCOLLECTION依次对应单个图形的复数。</font></p> 
<p><font size="2" face="宋体">回到项目中，我们用到的是 POLYGON ，建表语句 如下：</font></p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>polygon<span class="token punctuation">`</span></span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">unsigned</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>name<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token identifier"><span class="token punctuation">`</span>polygon<span class="token punctuation">`</span></span> <span class="token keyword">polygon</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span>
  <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  SPATIAL <span class="token keyword">KEY</span> <span class="token identifier"><span class="token punctuation">`</span>d<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>polygon<span class="token punctuation">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
</code></pre> 
<p><font size="2" face="宋体" color="黑体">插入数据</font></p> 
<p><font size="2" face="宋体">MySQL 支持将Well-Known 文本(WKT)格式和Well-Known 二进制(WKB)格式两种格式转换为object类型存储起来，我们使用更易于理解的WKT格式。</font></p> 
<p><font size="2" face="宋体">插入语句如下：</font></p> 
<pre><code class="prism language-sql"><span class="token comment">//GeomFromTextt()函数接受一个字符串，并且返回一个几何对象。</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>polygon<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'清华大学'</span><span class="token punctuation">,</span> GeomFromText<span class="token punctuation">(</span><span class="token string">'POLYGON((
40.01169924229143 116.31565081888039,39.99304082299905 116.31616541796757,39.99343506780591 116.33297565023167,40.00237067000859 116.33743550702275,40.01340715321479 116.33057418815224,40.01169924229143 116.31565081888039))'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>polygon<span class="token punctuation">`</span></span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'北京大学'</span><span class="token punctuation">,</span> GeomFromText<span class="token punctuation">(</span><span class="token string">'POLYGON((39.99711457525893 116.30450117461078,39.98673259872773 116.30535884106575,39.98673259872773 116.31702308311287,39.99963848242885 116.31598375134854,39.99711457525893 116.30450117461078))'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><font size="2" face="宋体">需要注意的是腾讯地图返回的多边形的点不是闭合的，而polygon函数需要为了确定多边形是否闭合要求第一个点和最后一个点是一样的。如果不是闭合的polygon返回的结果将是NULL，插入语句就会执行失败。</font></p> 
<p><font size="2" face="宋体">如果几何满足诸如此(非穷举)列表中的条件，则它在语法上是 well-formed：</font></p> 
<p><font size="2" face="宋体">• 线串至少有两个点<br> <font size="2" face="宋体">• 多边形至少有一个环<br> <font size="2" face="宋体">• 多边形环关闭(第一个和最后一个点相同)<br> <font size="2" face="宋体">• 多边形环至少有 4 个点(最小多边形是一个三角形，第一个和最后一个点相同)<br> <font size="2" face="宋体">• 集合不为空(除了GeometryCollection)</font></font></font></font></font></p> 
<p><font size="2" face="宋体" color="黑体">查询判断</font></p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">polygon</span> <span class="token keyword">WHERE</span>
	MBRWithin <span class="token punctuation">(</span>ST_GeomFromText<span class="token punctuation">(</span><span class="token string">'POINT(39.991333490218544 116.30964748487895)'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">polygon</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 在北京大学</span>

<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token keyword">polygon</span> <span class="token keyword">WHERE</span>
	MBRWithin <span class="token punctuation">(</span>ST_GeomFromText<span class="token punctuation">(</span><span class="token string">'POINT(39.988967560246685 116.3286905102832)'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">polygon</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># 不在北大</span>
</code></pre> 
<p><font size="2" face="宋体">细心的同学可能发现了这里的查询语句里用的是函数，在以往的SQL里如果存在查询字段上使用函数必然导致索引失效、全表扫描，但是在空间数据上不会，先看 EXPLAIN 语句和结果：</font></p> 
<p><img src="https://images2.imgbox.com/94/17/MA6mgT0W_o.png" alt="在这里插入图片描述"><br> <font size="2" face="宋体">可见MySQL空间类型的数据同样可以建立索引，使用的关键词是 SPATIAL ，用法如下：</font></p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> geom <span class="token punctuation">(</span>g <span class="token keyword">GEOMETRY</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">CREATE</span> SPATIAL <span class="token keyword">INDEX</span> g <span class="token keyword">ON</span> geom <span class="token punctuation">(</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><font size="2" face="宋体" color="黑体">常用的空间计算函数</font></p> 
<p><font size="2" face="宋体">1、判断两点之间的距离<br>   ST_Distance(g1，g2)，返回g1和g2之间的距离。如果任一参数是NULL或空几何，则 return value 为NULL。<br> 2、图形1是否完全包含图形2<br>   ST_Contains(g1，g2)，返回 1 或 0 以指示g1是否完全包含g2。还可以用ST_Within(g2,g1)达到相同的效果。<br> 3、不相交<br>   ST_Disjoint(g1，g2)，返回 1 或 0 以指示g1是否在空间上与(不相交)g2不相交。</font></p> 
<font size="2" face="宋体"> </font> 
<blockquote> 
 <p><font size="3" face="宋体" color="black"><span id="bb">学前必备基础知识</span></font></p> 
</blockquote> 
<ol><li> <p><font size="2" face="宋体">地理信息系统GIS</font></p> <p><font size="2" face="宋体">地理信息系统（Geographic Information System或 Geo－Information system，GIS）有时又称为“地学信息系统”。它是一种特定的十分重要的空间信息系统。</font></p> <p><font size="2" face="宋体">它是在计算机硬、软件系统支持下，对整个或部分地球表层（包括大气层）空间中的有关地理分布数据进行采集、储存、管理、运算、分析、显示和描述的技术系统。</font></p> </li><li> <p><font size="2" face="宋体">ArcGIS平台</font></p> <p><font size="2" face="宋体">ArcGIS产品线为用户提供一个可伸缩的，全面的GIS平台。ArcObjects包含了许多的可编程组件，从细粒度的对象（例如单个的几何对象）到粗粒度的对象（例如与现有ArcMap文档交互的地图对象）涉及面极广，这些对象为开发者集成了全面的GIS功能。</font></p> </li><li> <p><font size="2" face="宋体">矢量化数据</font></p> <p><font size="2" face="宋体">矢量数据是在直角坐标中，用x、y坐标表示地图图形或地理实体的位置和形状的数据。矢量数据一般通过记录坐标的方式来尽可能地将地理实体的空间位置表现得准确无误。在arcgis中数据矢量化就是将栅格数据转为矢量数据。</font></p> <p><font size="2" face="宋体">arcgis作为地理信息行业的功能之一数据矢量化的详细步骤：</font></p> <p><font size="2" face="宋体">• 添加数据按钮打开栅格数据和待矢量用的GDB数据或者shp数据或者mdb数据（用于存矢量化后的独迅称数据）<br> <font size="2" face="宋体">• 编辑矢量数据，右键点击数据——编辑要素——开始编辑<br> <font size="2" face="宋体">• 使用鼠标根据栅格影像中的地物形状进行描绘，一般就是在拐点处添加节点（点击鼠标左键即添加节点），描绘完成后，双击即可<br> <font size="2" face="宋体">• 再对刚刚完成的数据进行赋属性，也就是在属性表中输入描绘的类型，如这里是“房子”。<br> <font size="2" face="宋体">• 再使用鼠标对下一个地物进行描绘，如图中的公路。以此循环对影像中各种地物进行描绘，这便是矢量化的过程</font></font></font></font></font></p> </li><li> <p><font size="2" face="宋体">Geometry数据类型</font></p> <p><font size="2" face="宋体">Geometry是一种空间几何数据类型，常用于描述空间几何信息，例如坐标点、线、面、三维信息等。</font></p> <p><font size="2" face="宋体">也就是说，GIS一般使用Geometry数据类型来存储及展示地理信息。</font></p> <p><font size="2" face="宋体">常见的支持Geometry的数据库有Oracle、SqlServer、Mysql、PostgreSQL</font></p> </li><li> <p><font size="2" face="宋体">实际运用特殊性</font></p> <p><font size="2" face="宋体">数据库中有geometry类型，但是很多语言中没有直接的geometry类型。<br> <font size="2" face="宋体">以java为例，如果想要存储geometry字段，需要增加SET @g1 = geomFromText(geometry) ，也就是将字符串转换成几何对象存储；</font></font></p> <p><font size="2" face="宋体">同样，从数据库中直接取出的geometry类型字段，java无法使用，需要在数据库中查询的时候，做个几何类型转字符串类型的处理<code>st_AsText(geom) as geom</code></font></p> </li><li> <p><font size="2" face="宋体">Geometry之间的关系</font></p> 
  <table><thead><tr><th><font size="2" face="宋体">关系</font></th><th><font size="2" face="宋体">说明</font></th></tr></thead><tbody><tr><td><font size="2" face="宋体"> 相等（Equals）</font></td><td><font size="2" face="宋体">几何形状拓扑上相等</font></td></tr><tr><td><font size="2" face="宋体"> 脱节（Disjoint）</font></td><td><font size="2" face="宋体"> 几何形状没有共有的点</font></td></tr><tr><td><font size="2" face="宋体">相交（Intersects）</font></td><td><font size="2" face="宋体">几何形状至少有一个共有点（区别于脱节）</font></td></tr><tr><td><font size="2" face="宋体">接触（Touches）</font></td><td><font size="2" face="宋体">几何形状有至少一个公共的边界点，但是没有内部点</font></td></tr><tr><td><font size="2" face="宋体">交叉（Crosses）</font></td><td><font size="2" face="宋体">几何形状共享一些但不是所有的内部点</font></td></tr><tr><td><font size="2" face="宋体">内含（Within）</font></td><td><font size="2" face="宋体">几何形状A的线都在几何形状B内部</font></td></tr><tr><td><font size="2" face="宋体">包含（Contains）</font></td><td><font size="2" face="宋体">几何形状B的线都在几何形状A的内部（区别于内含）</font></td></tr><tr><td><font size="2" face="宋体"> 重叠（Overlaps）</font></td><td><font size="2" face="宋体"> 几何形状共享一部分但不是所有的公共点，而且相交处有他们自己相同的区域</font></td></tr></tbody></table></li><li> <p><font size="2" face="宋体">关系分析</font></p> 
  <table><thead><tr><th><font size="2" face="宋体">分析</font></th><th><font size="2" face="宋体">说明</font></th></tr></thead><tbody><tr><td><font size="2" face="宋体">缓冲区分析（Buffer）</font></td><td><font size="2" face="宋体">包含所有的点在一个指定距离内的多边形和多多边形</font></td></tr><tr><td><font size="2" face="宋体">凸壳分析（ConvexHull）</font></td><td><font size="2" face="宋体">包含几何形体的所有点的最小凸壳多边形（外包多边形）</font></td></tr><tr><td><font size="2" face="宋体">交叉分析（Intersection）</font></td><td><font size="2" face="宋体">A∩B 交叉操作就是多边形AB中所有共同点的集合</font></td></tr><tr><td><font size="2" face="宋体">联合分析（Union）</font></td><td><font size="2" face="宋体">两个图形取交集</font></td></tr><tr><td><font size="2" face="宋体">差异分析（Difference）</font></td><td><font size="2" face="宋体">两个图形取差集</font></td></tr><tr><td><font size="2" face="宋体">对称差异分析（SymDifference）</font></td><td><font size="2" face="宋体">(AUB-A∩B) AB形状的对称差异分析就是位于A中或者B中但不同时在AB中的所有点的集合</font></td></tr></tbody></table></li></ol> 
<blockquote> 
 <p><font size="3" face="宋体" color="black"><span id="xz">新增空间数据</span></font></p> 
</blockquote> 
<p><font size="2" face="宋体">当我们有了数据库，也有了arcgis提供的服务，现在该如何新增空间数据呢？</font></p> 
<p><font size="2" face="宋体">先通过WKT了解下空间数据Geometry大概长什么样</font></p> 
<p><font size="2" face="宋体" color="grey">WKT，是一种文本标记语言，用于表示矢量几何对象、空间参照系统及空间参照系统之间的转换。<br> 它的二进制表示方式，亦即WKB(well-known binary)则胜于在传输和在数据库中存储相同的信息。该格式由开放地理空间联盟(OGC)制定。</font></p> 
<p><font size="2" face="宋体" color="grey">WKT可以表示的几何对象包括：点，线，多边形，TIN（不规则三角网）及多面体。可以通过几何集合的方式来表示不同维度的几何对象。<font size="2" face="宋体" color="grey">几何物体的坐标可以是2D(x,y),3D(x,y,z),4D(x,y,z,m),加上一个属于线性参照系统的m值。</font></font></p> 
<p><font size="2" face="宋体" color="grey">以下为几何WKT字串样例：<br> ◈ POINT(6 10)<br> ◈ LINESTRING(3 4,10 50,20 25)<br> ◈ POLYGON((1 1,5 1,5 5,1 5,1 1),(2 2,2 3,3 3,3 2,2 2))<br> ◈ MULTIPOINT(3.5 5.6, 4.8 10.5)<br> ◈ MULTILINESTRING((3 4,10 50,20 25),(-5 -8,-10 -8,-15 -4))<br> ◈ MULTIPOLYGON(((1 1,5 1,5 5,1 5,1 1),(2 2,2 3,3 3,3 2,2 2)),((6 3,9 2,9 4,6 3)))<br> ◈ GEOMETRYCOLLECTION(POINT(4 6),LINESTRING(4 6,7 10))<br> ◈ POINT ZM (1 1 5 60)<br> ◈ POINT M (1 1 80)<br> ◈ POINT EMPTY<br> ◈ MULTIPOLYGON EMPTY</font></p> 
<p><font size="2" face="宋体">到这里我们清楚了，所谓空间数据就是一个或一组坐标，这个坐标或坐标组有类型（POINT点LINESTRING线POLYGON面），通过这些坐标，GIS系统可以完整地定位查询绘制这些坐标信息</font></p> 
<p><font size="2" face="宋体">Java可以将WKT格式的Geomotry转换成GeoJSON</font></p> 
<ol><li> <p><font size="2" face="宋体">Meven添加依赖</font></p> <pre><code class="prism language-xml"><span class="token comment">&lt;!-- 引入json处理包 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.47<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- jts处理Geometry --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.vividsolutions<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jts<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.13<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.geotools/gt-geojson --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.geotools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>gt-geojson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>9.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.googlecode.json-simple<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>json-simple<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <p><font size="2" face="宋体">如添加依赖遇到not fount，可手动配置maven repository解决</font></p> <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>OSGeo Repository<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>http://download.osgeo.org/webdav/geotools/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li><li> <p><font size="2" face="宋体">解析方法源码</font></p> <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>bret<span class="token punctuation">.</span>utils</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>vividsolutions<span class="token punctuation">.</span>jts<span class="token punctuation">.</span>geom<span class="token punctuation">.</span></span><span class="token class-name">Geometry</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>vividsolutions<span class="token punctuation">.</span>jts<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">WKTReader</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>geotools<span class="token punctuation">.</span>geojson<span class="token punctuation">.</span>geom<span class="token punctuation">.</span></span><span class="token class-name">GeometryJSON</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">StringWriter</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WKTUtil</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 由wkt格式的geometry生成geojson
     * @param wkt
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">wktToJson</span><span class="token punctuation">(</span><span class="token class-name">String</span> wkt<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> json <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">WKTReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WKTReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Geometry</span> geometry <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>wkt<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">StringWriter</span> writer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringWriter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">GeometryJSON</span> g <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeometryJSON</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            g<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>geometry<span class="token punctuation">,</span> writer<span class="token punctuation">)</span><span class="token punctuation">;</span>
            json <span class="token operator">=</span> writer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> json<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <p><font size="2" face="宋体">POINT(6 10) --&gt; {“type”:“Point”,“coordinates”:[6,10]}<br> <font size="2" face="宋体">LINESTRING(3 4,10 50,20 25) --&gt; {“type”:“LineString”,“coordinates”:[[3,4],[10,50],[20,25]]}</font></font></p> </li></ol> 
<blockquote> 
 <p><font size="3" face="宋体" color="black"><span id="geojson">GeoJSON格式的Geomotry</span></font></p> 
</blockquote> 
<p><font size="2" face="宋体">GeoJSON是一种对各种地理数据结构进行编码的格式。GeoJSON对象可以表示几何、特征或者特征集合。<br> GeoJSON支持下面几何类型：点、线、面、多点、多线、多面和几何集合。GeoJSON里的特征包含一个几何对象和其他属性，特征集合表示一系列特征。</font></p> 
<p><font size="2" face="宋体">GeoJSON 可以转 shp格式，GeoTools提供封装方法，详情可自行查询。(GeoJSON --&gt; .shp --&gt; .nc)</font></p> 
<p><font size="2" face="宋体" color="黑体">geojson格式规定</font></p> 
<p><font size="2" face="宋体">• 一个完整的GeoJSON数据结构总是一个（JSON术语里的）对象。</font></p> 
<p><font size="2" face="宋体">• geojson必须有一个名字为"type"的成员。这个成员的值是由GeoJSON对象的类型所确定的字符串。<br>  即必须是下面之一：“Point”, “MultiPoint”, “LineString”, “MultiLineString”, “Polygon”, “MultiPolygon”, “GeometryCollection”, “Feature”, 或者 “FeatureCollection”。这些值分别对应：点、多点、线、多线、面、多面、几何集合、特征、特征集合。</font></p> 
<p><font size="2" face="宋体">• 一个features下的Feature要素，包括图形(geometry)和属性(type)在一起的，该属性是必须的</font></p> 
<p><font size="2" face="宋体">• 一个features下的Feature要素里，geometry里面也是一个对象，对象里面的type就是点线面、多点、多线、多面六种</font></p> 
<p><font size="2" face="宋体">• 一个features下的Feature要素里，properties表示该对象的属性，该属性不是必须的</font></p> 
<p><font size="2" face="宋体" color="黑体">geojson示例</font></p> 
<ol><li> <p><font size="2" face="宋体">点坐标</font></p> <pre><code class="prism language-javascript"><span class="token comment">//点坐标是按照x,y顺序的(投影坐标的东向、北向，地理坐标的长度、高度）</span>
<span class="token punctuation">{<!-- --></span> <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"Point"</span><span class="token punctuation">,</span> <span class="token string-property property">"coordinates"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
</code></pre> </li><li> <p><font size="2" face="宋体">线坐标</font></p> <pre><code class="prism language-javascript"><span class="token comment">//线的坐标是位置数组，二维数组，两点确定一条直线</span>
<span class="token punctuation">{<!-- --></span> <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"LineString"</span><span class="token punctuation">,</span><span class="token string-property property">"coordinates"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token punctuation">[</span><span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">101.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">}</span>
</code></pre> </li><li> <p><font size="2" face="宋体">面坐标（没有孔）</font></p> <pre><code class="prism language-javascript"><span class="token comment">//面的坐标是线性环坐标数组的数组。这个数组的第一个元素表示的是外部环。其他后续的元素表示的内部环（或者孔）</span>
<span class="token punctuation">{<!-- --></span> <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"Polygon"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"coordinates"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">[</span> <span class="token punctuation">[</span><span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">101.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">101.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span> <span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><font size="2" face="宋体">面坐标（有孔）</font></p> <pre><code class="prism language-javascript"><span class="token comment">//一个洞的面是三维数组</span>
<span class="token punctuation">{<!-- --></span> <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"Polygon"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"coordinates"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// 最大的面</span>
    <span class="token punctuation">[</span> <span class="token punctuation">[</span><span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">101.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">101.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// 面里面的洞</span>
    <span class="token punctuation">[</span> <span class="token punctuation">[</span><span class="token number">100.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100.8</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100.8</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100.2</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span> <span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><font size="2" face="宋体">多面的坐标</font></p> <pre><code class="prism language-javascript"><span class="token comment">//多面的坐标是面坐标数组的数组</span>
<span class="token punctuation">{<!-- --></span> <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"MultiPolygon"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"coordinates"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token comment">// 无孔面</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">102.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">103.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">103.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">102.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">102.0</span><span class="token punctuation">,</span> <span class="token number">2.0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// 有孔面</span>
    <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">101.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">101.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
     <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">100.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100.8</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100.8</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100.2</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100.2</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><font size="2" face="宋体">几何集合</font></p> <pre><code class="prism language-javascript"><span class="token punctuation">{<!-- --></span>
  <span class="token comment">//type是由GeoJSON对象的类型所确定的字符串，类型有："Point", "MultiPoint", "LineString", "MultiLineString", "Polygon", "MultiPolygon",   	     "GeometryCollection", "Feature", "FeatureCollection"</span>
  <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"FeatureCollection"</span><span class="token punctuation">,</span> 
  <span class="token comment">//特征对象的结合数组</span>
  <span class="token string-property property">"features"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span> <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"Feature"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"geometry"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"Point"</span><span class="token punctuation">,</span> <span class="token string-property property">"coordinates"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">102.0</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token string-property property">"prop0"</span><span class="token operator">:</span> <span class="token string">"value0"</span><span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span> <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"Feature"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"geometry"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"LineString"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"coordinates"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">[</span><span class="token number">102.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">103.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">104.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">105.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token string-property property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"prop0"</span><span class="token operator">:</span> <span class="token string">"value0"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"prop1"</span><span class="token operator">:</span> <span class="token number">0.0</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{<!-- --></span> <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"Feature"</span><span class="token punctuation">,</span>
       <span class="token string-property property">"geometry"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
         <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"Polygon"</span><span class="token punctuation">,</span>
         <span class="token string-property property">"coordinates"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
           <span class="token punctuation">[</span> <span class="token punctuation">[</span><span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">101.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">101.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
             <span class="token punctuation">[</span><span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">100.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">]</span> <span class="token punctuation">]</span>
           <span class="token punctuation">]</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
       <span class="token string-property property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
         <span class="token string-property property">"prop0"</span><span class="token operator">:</span> <span class="token string">"value0"</span><span class="token punctuation">,</span>
         <span class="token string-property property">"prop1"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token string-property property">"this"</span><span class="token operator">:</span> <span class="token string">"that"</span><span class="token punctuation">}</span>
         <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">]</span>
   <span class="token punctuation">}</span>
</code></pre> </li></ol> 
<blockquote> 
 <p><font size="3" face="宋体" color="black"><span id="JTS">JTS(Java Topology Suite) Java拓扑套件</span></font></p> 
</blockquote> 
<p><a href="#qianyand" rel="nofollow"><font size="2" face="宋体">前言</font></a></p> 
<p><a href="#baojiegou" rel="nofollow"><font size="2" face="宋体">JTS包结构</font></a></p> 
<p><a href="#shujuleiix" rel="nofollow"><font size="2" face="宋体">JTS数据类型</font></a></p> 
<p><a href="#kongjiantuopu" rel="nofollow"><font size="2" face="宋体">JTS空间拓扑关系</font></a></p> 
<p><a href="#jihediejiaguanxi" rel="nofollow"><font size="2" face="宋体">JTS几何叠加关系</font></a></p> 
<p><a href="#jtsjichu" rel="nofollow"><font size="2" face="宋体">JTS运用（基础）基础</font></a></p> 
<p><a href="#jtsdian" rel="nofollow"><font size="2" face="宋体">JTS运用（点）</font></a></p> 
<p><a href="#jtsxian" rel="nofollow"><font size="2" face="宋体">JTS运用（线）</font></a></p> 
<p><a href="#jtsmians" rel="nofollow"><font size="2" face="宋体">JTS运用（面）</font></a></p> 
<p><font size="2" face="宋体" color="黑体"><span id="qianyand">前言</span></font></p> 
<p><font size="2" face="宋体">wkt文本仅仅是一个字符串而已，直接将坐标点拼接成符合WKT格式的字符串不就可以了吗？道理是这个道理，要做好可就难了。难点如下:<br> <font size="2" face="宋体">• 拼接工作量巨大<br> <font size="2" face="宋体">• 拼接过程容易出错<br> <font size="2" face="宋体">• 拼接的结果不一定合法可用</font></font></font></font></p> 
<p><font size="2" face="宋体">对此我们需要一套JAVA API对数据进行处理，该API能够方便的创建Geometry对象，进行地理信息的绘制、创建、验证等等功能，市面上常见的GeometryApi有：<font size="2" face="宋体">① Esri/geometry-api-java <font size="2" face="宋体">② locationtech/jts（推荐）</font></font></font></p> 
<p><font size="2" face="宋体">Esri是Arcgis官方提供的javaSDK，可惜功能不多，甚至不能提供基本的空间计算功能。<font size="2" face="宋体">jts功能较为齐全，资料也相对丰富一点。<font size="2" face="宋体">这里我们就已JTS为重点进行讲解。</font></font></font></p> 
<p><font size="2" face="宋体">JTS(Java Topology Suite) Java拓扑套件，是Java的处理地理数据的API。它的API文档地址：<font size="2" face="宋体"><a href="https://locationtech.github.io/jts/javadoc/" rel="nofollow">https://locationtech.github.io/jts/javadoc/</a></font></font></p> 
<p><font size="2" face="宋体" color="黑体"><span id="baojiegou">JTS包结构</span></font></p> 
<p><font size="2" face="宋体">• 系（linearref包）<br> • 计算交点（noding包）<br> • 几何图形操作（operation包）<br> • 平面图（planargraph包）<br> • 多边形化（polygnize包）<br> • 精度（precision）<br> • 工具（util包）</font></p> 
<p><font size="2" face="宋体" color="黑体"><span id="shujuleiix">JTS数据类型</span></font></p> 
<table><thead><tr><th><font size="2" face="宋体">数据类型</font></th><th><font size="2" face="宋体"> 内容</font></th></tr></thead><tbody><tr><td><font size="2" face="宋体"> Point</font></td><td><font size="2" face="宋体"> 点</font></td></tr><tr><td><font size="2" face="宋体">MultiPoint</font></td><td><font size="2" face="宋体"> 多点</font></td></tr><tr><td><font size="2" face="宋体"> LineString</font></td><td><font size="2" face="宋体"> 线</font></td></tr><tr><td><font size="2" face="宋体"> LinearRing</font></td><td><font size="2" face="宋体"> 封闭的线条</font></td></tr><tr><td><font size="2" face="宋体"> MultiLineString</font></td><td><font size="2" face="宋体"> 多条线条</font></td></tr><tr><td><font size="2" face="宋体"> Polygon</font></td><td><font size="2" face="宋体"> 多边形</font></td></tr><tr><td><font size="2" face="宋体"> MultiPolygon</font></td><td><font size="2" face="宋体"> 多个多边形</font></td></tr><tr><td><font size="2" face="宋体"> GeometryCollection</font></td><td><font size="2" face="宋体"> 包括点，线，面</font></td></tr></tbody></table> 
<p><img src="https://images2.imgbox.com/bd/30/RYRz4gcE_o.png" alt="在这里插入图片描述"></p> 
<p><font size="2" face="宋体" color="黑体"><span id="kongjiantuopu">JTS空间拓扑关系</span></font></p> 
<table><thead><tr><th><font size="2" face="宋体">空间关系</font></th><th><font size="2" face="宋体"> 中文名称</font></th><th><font size="2" face="宋体"> OGC标准</font></th><th><font size="2" face="宋体"> 解释</font></th></tr></thead><tbody><tr><td><font size="2" face="宋体">Contains</font></td><td><font size="2" face="宋体">包含</font></td><td><font size="2" face="宋体">是</font></td><td><font size="2" face="宋体"> 一个几何图形的内容完全包含了另一个几个图形的内部和边界</font></td></tr><tr><td><font size="2" face="宋体">CoveredBy</font></td><td><font size="2" face="宋体">覆盖</font></td><td><font size="2" face="宋体">否</font></td><td><font size="2" face="宋体">一个几何图形被另一个几何图形所包含，并且它们的边界相交。Point和MultiPoint不支持此空间关系,因为它们没有边界</font></td></tr><tr><td><font size="2" face="宋体">Crosses</font></td><td><font size="2" face="宋体"> 交叉</font></td><td><font size="2" face="宋体"> 是</font></td><td><font size="2" face="宋体"> 一个几何图形的内部和另一个几何图形的边界和内部相交，但它们的边界不相交.（两条线相交于一点，一条线和一个面相交）</font></td></tr><tr><td><font size="2" face="宋体">Disjoint</font></td><td><font size="2" face="宋体"> 分离</font></td><td><font size="2" face="宋体"> 是</font></td><td><font size="2" face="宋体"> 两个几何图形的边界和内部不相交</font></td></tr><tr><td><font size="2" face="宋体"> EnvelopeIntersects</font></td><td><font size="2" face="宋体"> 封套相交</font></td><td><font size="2" face="宋体"> 否</font></td><td><font size="2" face="宋体"> 两个几个图形的外接矩形相交</font></td></tr><tr><td><font size="2" face="宋体"> Equal</font></td><td><font size="2" face="宋体"> 相等</font></td><td><font size="2" face="宋体">是</font></td><td><font size="2" face="宋体"> 两个几何图形具有相同的边界和内部</font></td></tr><tr><td><font size="2" face="宋体"> Inside</font></td><td><font size="2" face="宋体"> 内部</font></td><td><font size="2" face="宋体"> 否</font></td><td><font size="2" face="宋体"> 一个几何图形在另一个几何图形的内部，但是和它的边界不接触</font></td></tr><tr><td><font size="2" face="宋体">Intersects</font></td><td><font size="2" face="宋体"> 相交</font></td><td><font size="2" face="宋体"> 是</font></td><td><font size="2" face="宋体"> 两个几何图形没有分离（Non-DisJoint）</font></td></tr><tr><td><font size="2" face="宋体"> Overlaps</font></td><td><font size="2" face="宋体"> 重叠</font></td><td><font size="2" face="宋体"> 是</font></td><td><font size="2" face="宋体"> 两个几何图形的边界和内部相交（Intersect）</font></td></tr><tr><td><font size="2" face="宋体"> Touch</font></td><td><font size="2" face="宋体"> 接触</font></td><td><font size="2" face="宋体"> 是</font></td><td><font size="2" face="宋体">两个几何图形的边界相交,但是内部不相交</font></td></tr><tr><td><font size="2" face="宋体"> Within</font></td><td><font size="2" face="宋体">包含于</font></td><td><font size="2" face="宋体"> 是</font></td><td><font size="2" face="宋体">一个几何图形的内部和边界完全在另一个几何图形的内部</font></td></tr></tbody></table> 
<p><font size="2" face="宋体" color="黑体"><span id="jihediejiaguanxi">JTS几何叠加关系</span></font></p> 
<table><thead><tr><th><font size="2" face="宋体">空间关系</font></th><th><font size="2" face="宋体"> 中文名称</font></th><th><font size="2" face="宋体"> OGC标准</font></th><th><font size="2" face="宋体"> 解释</font></th></tr></thead><tbody><tr><td><font size="2" face="宋体"> Buffer</font></td><td><font size="2" face="宋体">缓冲区分析</font></td><td><font size="2" face="宋体"> 是</font></td><td><font size="2" face="宋体">几何图形指定距离（扩大或者缩小）后的几何图形</font></td></tr><tr><td><font size="2" face="宋体">ConvexHull</font></td><td><font size="2" face="宋体">凸壳分析</font></td><td><font size="2" face="宋体"> 是</font></td><td><font size="2" face="宋体"> 包含几何形体的所有点的最小凸壳多边形（外包多边形）</font></td></tr><tr><td><font size="2" face="宋体"> Intersection</font></td><td><font size="2" face="宋体">交叉分析</font></td><td><font size="2" face="宋体"> 是</font></td><td><font size="2" face="宋体">两个图形取交集</font></td></tr><tr><td><font size="2" face="宋体">Union</font></td><td><font size="2" face="宋体">联合分析</font></td><td><font size="2" face="宋体"> 是</font></td><td><font size="2" face="宋体"> 两个图形取交集</font></td></tr><tr><td><font size="2" face="宋体">Difference</font></td><td><font size="2" face="宋体">差异分析</font></td><td><font size="2" face="宋体"> 是</font></td><td><font size="2" face="宋体"> 两个图形取差集</font></td></tr><tr><td><font size="2" face="宋体"> SymDifference</font></td><td><font size="2" face="宋体">对称差异分析</font></td><td><font size="2" face="宋体"> 是</font></td><td><font size="2" face="宋体"> AB形状的对称差异分析就是位于A中或者B中但不同时在AB中的所有点的集合</font></td></tr></tbody></table> 
<p><img src="https://images2.imgbox.com/91/ce/iDBHM7nj_o.png" alt="在这里插入图片描述"></p> 
<p><font size="2" face="宋体" color="黑体"><span id="jtsjichu">JTS运用（基础）</span></font></p> 
<p><font size="2" face="宋体">我们在使用JTS前首先需要引入JTS的Maven坐标：</font></p> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.locationtech.jts/jts-core --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.locationtech.jts<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jts-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.18.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><font size="2" face="宋体">使用JTS前先了解下Geometry类常用工具方法</font></p> 
<table><thead><tr><th><font size="2" face="宋体"> 基础方法</font></th><th><font size="2" face="宋体"> 内容</font></th></tr></thead><tbody><tr><td><font size="2" face="宋体">toText</font></td><td><font size="2" face="宋体">返回WKT格式数据</font></td></tr><tr><td><font size="2" face="宋体">getEnvelope</font></td><td><font size="2" face="宋体">获取边界</font></td></tr><tr><td><font size="2" face="宋体">getCoordinates</font></td><td><font size="2" face="宋体">获取coordinate数据</font></td></tr><tr><td><font size="2" face="宋体">getCentroid</font></td><td><font size="2" face="宋体"> 获取中心点</font></td></tr><tr><td><font size="2" face="宋体"> isValid</font></td><td><font size="2" face="宋体">判断几何是否符合OGC SFS规格(OGC SFS specification)，例如：Polygon是否自相交等</font></td></tr><tr><td><font size="2" face="宋体">isRectangle</font></td><td><font size="2" face="宋体">判断几何是否是Polygon</font></td></tr><tr><td><font size="2" face="宋体"> isEmpty</font></td><td><font size="2" face="宋体">判读几何是否是空，判断几何的 point.size == 0 ; 或者几何包含 empty: reader.read(“POINT EMPTY”)</font></td></tr><tr><td><font size="2" face="宋体"> getSRID</font></td><td><font size="2" face="宋体"> 获取srid</font></td></tr><tr><td><font size="2" face="宋体"> getLength</font></td><td><font size="2" face="宋体"> 获取长度，线几何返回点与点之间的长度之和；闭合几何返回周长；其它返回0</font></td></tr></tbody></table> 
<ol><li> <p><font size="2" face="宋体">GeometryFactory</font></p> <p><font size="2" face="宋体">GeometryFactory是geometry的工厂类，提供了Geometry子类的创建方法的统一入口。在创建Geometry的时候建议用GeometryFactory去创建，不要单独自己去new一个子类。</font></p> <p><font size="2" face="宋体">数据结构:<br> private PrecisionModel precisionModel : 精度模式，默认为FLOAT<br> private CoordinateSequenceFactory coordinateSequenceFactory : 坐标序列工厂类，创CoordinateList</font></p> </li><li> <p><font size="2" face="宋体">PrecisionModel</font></p> <p><font size="2" face="宋体">创建Geometry的时候通过PrecisionModel可以控制geometry坐标的精度。<br> <font size="2" face="宋体">三种模式:<br> FLOATING: 等同于Java的双精度double类型<br> FLOATING_SINGLE: 等同于Java的单精度float类型<br> FIXED: 固定精度模式(固定小数点后几位)。通过public PrecisionModel(double scale)构造方法构造。<br> FIXED去固定精度并不会改变geometry里的点的真实坐标，只会去改变toString出来的wkt格式的坐标精度。慎用。</font></font></p> </li><li> <p><font size="2" face="宋体">LinearRing</font></p> </li><li> <p><font size="2" face="宋体">GeometryCollection</font></p> <p><font size="2" face="宋体">数据结构：<br> Geometry[] geometries: geometry的集合。子类有MultiPoint MultiLineString MultiPolygon.<br> 实现了所有的Geometry的抽象方法，只是改成了对集合整体的操作</font></p> </li></ol> 
<p><font size="2" face="宋体" color="黑体"><span id="jtsdian">JTS运用（点）</span></font></p> 
<ol><li> <p><font size="2" face="宋体">示例：创建点</font></p> <pre><code class="prism language-java">
<span class="token keyword">private</span> <span class="token class-name">GeometryFactory</span> geometryFactory <span class="token operator">=</span> <span class="token class-name">JTSFactoryFinder</span><span class="token punctuation">.</span><span class="token function">getGeometryFactory</span><span class="token punctuation">(</span> <span class="token keyword">null</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 创建点
 * @return
 */</span>
<span class="token keyword">public</span> <span class="token class-name">Point</span> <span class="token function">createPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>

	<span class="token class-name">Coordinate</span> coord <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Coordinate</span><span class="token punctuation">(</span><span class="token number">109.013388</span><span class="token punctuation">,</span> <span class="token number">32.715519</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Point</span> point <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeometryFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createPoint</span><span class="token punctuation">(</span>coord<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> point<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 创建点（通过WKT）
 * @return
 */</span>
<span class="token keyword">public</span> <span class="token class-name">Point</span> <span class="token function">createPointByWKT</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ParseException</span><span class="token punctuation">{<!-- --></span>

	<span class="token class-name">WKTReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WKTReader</span><span class="token punctuation">(</span> geometryFactory <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Point</span> point <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Point</span><span class="token punctuation">)</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"POINT (109.013388 32.715519)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> point<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> </li></ol> 
<p><font size="2" face="宋体" color="黑体"><span id="jtsxian">JTS运用（线）</span></font></p> 
<ol><li> <p><font size="2" face="宋体">LineString</font></p> <p><font size="2" face="宋体">数据结构：CoordinateSequence coordinates，即一堆点的集合。</font></p> 
  <table><thead><tr><th><font size="2" face="宋体">method</font></th><th><font size="2" face="宋体"> description</font></th></tr></thead><tbody><tr><td><font size="2" face="宋体"> boolean isClosed()</font></td><td><font size="2" face="宋体"> 判断LineString是否闭合,第一个点和最后一个点是否相等</font></td></tr><tr><td><font size="2" face="宋体"> boolean isRing()</font></td><td><font size="2" face="宋体"> 在判断isClosed()的同时判断是否是简单图形</font></td></tr><tr><td><font size="2" face="宋体"> LineString copyInternal()</font></td><td><font size="2" face="宋体"> 深拷贝一个LineString</font></td></tr></tbody></table></li><li> <p><font size="2" face="宋体">示例：创建线</font></p> <pre><code class="prism language-java">
<span class="token keyword">private</span> <span class="token class-name">GeometryFactory</span> geometryFactory <span class="token operator">=</span> <span class="token class-name">JTSFactoryFinder</span><span class="token punctuation">.</span><span class="token function">getGeometryFactory</span><span class="token punctuation">(</span> <span class="token keyword">null</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 创建线
 * @return
 */</span>
<span class="token keyword">public</span> <span class="token class-name">LineString</span> <span class="token function">createLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>

	<span class="token class-name">Coordinate</span><span class="token punctuation">[</span><span class="token punctuation">]</span> coords  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Coordinate</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span><span class="token keyword">new</span> <span class="token class-name">Coordinate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Coordinate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token class-name">LineString</span> line <span class="token operator">=</span> geometryFactory<span class="token punctuation">.</span><span class="token function">createLineString</span><span class="token punctuation">(</span>coords<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> line<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 创建线（通过WKT）
 * @return
 */</span>
<span class="token keyword">public</span> <span class="token class-name">LineString</span> <span class="token function">createLineByWKT</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ParseException</span><span class="token punctuation">{<!-- --></span>

	<span class="token class-name">WKTReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WKTReader</span><span class="token punctuation">(</span> geometryFactory <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">LineString</span> line <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LineString</span><span class="token punctuation">)</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"LINESTRING(0 0, 2 0)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> line<span class="token punctuation">;</span>
<span class="token punctuation">}</span>	
</code></pre> </li><li> <p><font size="2" face="宋体">创建多条线</font></p> <pre><code class="prism language-java">
<span class="token keyword">private</span> <span class="token class-name">GeometryFactory</span> geometryFactory <span class="token operator">=</span> <span class="token class-name">JTSFactoryFinder</span><span class="token punctuation">.</span><span class="token function">getGeometryFactory</span><span class="token punctuation">(</span> <span class="token keyword">null</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 创建多条线
 * @return
 */</span>
<span class="token keyword">public</span> <span class="token class-name">MultiLineString</span> <span class="token function">createMLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>

    <span class="token class-name">Coordinate</span><span class="token punctuation">[</span><span class="token punctuation">]</span> coords1  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Coordinate</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span><span class="token keyword">new</span> <span class="token class-name">Coordinate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Coordinate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name">LineString</span> line1 <span class="token operator">=</span> geometryFactory<span class="token punctuation">.</span><span class="token function">createLineString</span><span class="token punctuation">(</span>coords1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">Coordinate</span><span class="token punctuation">[</span><span class="token punctuation">]</span> coords2  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Coordinate</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span><span class="token keyword">new</span> <span class="token class-name">Coordinate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Coordinate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name">LineString</span> line2 <span class="token operator">=</span> geometryFactory<span class="token punctuation">.</span><span class="token function">createLineString</span><span class="token punctuation">(</span>coords2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">LineString</span><span class="token punctuation">[</span><span class="token punctuation">]</span> lineStrings <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LineString</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    lineStrings<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span> line1<span class="token punctuation">;</span>
    lineStrings<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> line2<span class="token punctuation">;</span>
    
    <span class="token class-name">MultiLineString</span> ms <span class="token operator">=</span> geometryFactory<span class="token punctuation">.</span><span class="token function">createMultiLineString</span><span class="token punctuation">(</span>lineStrings<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ms<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">/**
 * 创建多条线（通过WKT）
 * @return
 * @throws ParseException
 */</span>
<span class="token keyword">public</span> <span class="token class-name">MultiLineString</span> <span class="token function">createMLineByWKT</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">throws</span> <span class="token class-name">ParseException</span><span class="token punctuation">{<!-- --></span>

    <span class="token class-name">WKTReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WKTReader</span><span class="token punctuation">(</span> geometryFactory <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">MultiLineString</span> line <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MultiLineString</span><span class="token punctuation">)</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"MULTILINESTRING((0 0, 2 0),(1 1,2 2))"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> line<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> </li></ol> 
<p><font size="2" face="宋体" color="黑体"><span id="jtsmians">JTS运用（面）</span></font></p> 
<ol start="3"><li> <p><font size="2" face="宋体">Polygon</font></p> <p><font size="2" face="宋体">数据结构：<br> LinearRing shell : 表示外轮廓。一个Polygon只能有一个shell。<br> <font size="2" face="宋体">LinearRing[] holes: 表示洞。一个Polygon可有多个hole。</font></font></p> 
  <table><thead><tr><th><font size="2" face="宋体">method</font></th><th><font size="2" face="宋体"> description</font></th></tr></thead><tbody><tr><td><font size="2" face="宋体"> Coordinate[] getCoordinates()</font></td><td><font size="2" face="宋体"> 获取Polygon所有的点，polygon中洞的点会排在外轮廓的点之后</font></td></tr><tr><td><font size="2" face="宋体"> boolean isRectangle()</font></td><td><font size="2" face="宋体"> 判断polygon是不是矩形</font></td></tr><tr><td><font size="2" face="宋体"> LinearRing getExteriorRing()</font></td><td><font size="2" face="宋体"> 获取polygon外轮廓</font></td></tr><tr><td><font size="2" face="宋体"> LinearRing getInteriorRingN(int n)</font></td><td><font size="2" face="宋体"> 获取某一个洞</font></td></tr><tr><td><font size="2" face="宋体"> void apply(CoordinateFilter filter)</font></td><td><font size="2" face="宋体"> 直接修改一个polygon的值(比如精度修改，放大缩小之类的操作)</font></td></tr><tr><td><font size="2" face="宋体"> Polygon copyInternal()</font></td><td><font size="2" face="宋体"> 等同于深拷贝</font></td></tr><tr><td><font size="2" face="宋体"> Geometry convexHull()</font></td><td><font size="2" face="宋体"> 拿到Polygon的凸包</font></td></tr><tr><td><font size="2" face="宋体"> void normalize()</font></td><td><font size="2" face="宋体"> 将polygon格式化为逆时针构建,一般equal之前会先normalize一下</font></td></tr><tr><td><font size="2" face="宋体"> Geometry normalize()</font></td><td><font size="2" face="宋体"> 同上，只是返回结果为一个Polygon</font></td></tr></tbody></table></li><li> <p><font size="2" face="宋体">创建多边形</font></p> <pre><code class="prism language-java">
<span class="token keyword">private</span> <span class="token class-name">GeometryFactory</span> geometryFactory <span class="token operator">=</span> <span class="token class-name">JTSFactoryFinder</span><span class="token punctuation">.</span><span class="token function">getGeometryFactory</span><span class="token punctuation">(</span> <span class="token keyword">null</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 创建多边形（通过WKT）
 * @return
 * @throws ParseException
 */</span>
<span class="token keyword">public</span> <span class="token class-name">Polygon</span> <span class="token function">createPolygonByWKT</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ParseException</span><span class="token punctuation">{<!-- --></span>
    <span class="token class-name">WKTReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WKTReader</span><span class="token punctuation">(</span> geometryFactory <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Polygon</span> polygon <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Polygon</span><span class="token punctuation">)</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"POLYGON((20 10, 30 0, 40 10, 30 20, 20 10))"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> polygon<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 创建多个多边形（通过WKT）
 * @return
 * @throws ParseException
 */</span>
<span class="token keyword">public</span> <span class="token class-name">MultiPolygon</span> <span class="token function">createMulPolygonByWKT</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ParseException</span><span class="token punctuation">{<!-- --></span>
    <span class="token class-name">WKTReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WKTReader</span><span class="token punctuation">(</span> geometryFactory <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">MultiPolygon</span> mpolygon <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">MultiPolygon</span><span class="token punctuation">)</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"MULTIPOLYGON(((40 10, 30 0, 40 10, 30 20, 40 10),(30 10, 30 0, 40 10, 30 20, 30 10)))"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> mpolygon<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> </li></ol> 
<p><font size="2" face="宋体">现在展示一下几何图形之间的拓扑关系：</font></p> 
<ol><li> <p><font size="2" face="宋体">相等（Eequals）</font></p> <pre><code class="prism language-java"><span class="token comment">/**
 *  两个几何对象是否是重叠的
 * @return
 * @throws ParseException
 */</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">equalsGeo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ParseException</span><span class="token punctuation">{<!-- --></span>
    <span class="token class-name">WKTReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WKTReader</span><span class="token punctuation">(</span> geometryFactory <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">LineString</span> geometry1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LineString</span><span class="token punctuation">)</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"LINESTRING(0 0, 2 0, 5 0)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">LineString</span> geometry2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LineString</span><span class="token punctuation">)</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"LINESTRING(5 0, 0 0)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> geometry1<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>geometry2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//true</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><font size="2" face="宋体">脱节（Disjoint）</font></p> <pre><code class="prism language-java"><span class="token comment">/**
 * 几何对象没有交点(相邻)
 * @return
 * @throws ParseException
 */</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">disjointGeo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ParseException</span><span class="token punctuation">{<!-- --></span>
    <span class="token class-name">WKTReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WKTReader</span><span class="token punctuation">(</span> geometryFactory <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">LineString</span> geometry1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LineString</span><span class="token punctuation">)</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"LINESTRING(0 0, 2 0, 5 0)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">LineString</span> geometry2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LineString</span><span class="token punctuation">)</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"LINESTRING(0 1, 0 2)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> geometry1<span class="token punctuation">.</span><span class="token function">disjoint</span><span class="token punctuation">(</span>geometry2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> </li><li> <p><font size="2" face="宋体">内含（within）</font></p> <pre><code class="prism language-java"><span class="token comment">/**
 * 判断以x,y为坐标的点point(x,y)是否在geometry表示的Polygon中
 * @param x
 * @param y
 * @param geometry wkt格式
 * @return
 */</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">withinGeo</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">,</span><span class="token keyword">double</span> y<span class="token punctuation">,</span><span class="token class-name">String</span> geometry<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ParseException</span> <span class="token punctuation">{<!-- --></span>

    <span class="token class-name">Coordinate</span> coord <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Coordinate</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Point</span> point <span class="token operator">=</span> geometryFactory<span class="token punctuation">.</span><span class="token function">createPoint</span><span class="token punctuation">(</span> coord <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">WKTReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WKTReader</span><span class="token punctuation">(</span> geometryFactory <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Polygon</span> polygon <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Polygon</span><span class="token punctuation">)</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>geometry<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> point<span class="token punctuation">.</span><span class="token function">within</span><span class="token punctuation">(</span>polygon<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><font size="2" face="宋体">包含（Contains）</font></p> <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">containsGeo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ParseException</span> <span class="token punctuation">{<!-- --></span>

	<span class="token class-name">Point</span> point <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeometryFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createPoint</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Coordinate</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> geometry1<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>geometry2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> </li></ol> 
<p><font size="2" face="宋体">现在展示一下几何图形的叠加操作：</font></p> 
<ol><li> <p><font size="2" face="宋体"><span id="pandaun">缓冲区分析（Buffer）</span></font></p> <p><font size="2" face="宋体">一条linestring经过buffer之后某种意义上变成一个ploygon，下面蓝色的线经过buffer之后成为了这个样子，如此就可以判断两条在一定阈值内重合的线，实质上是扩大了一条线的范围，然后再求buffer这个ploygon与另外一条linestring有无交集。</font></p> <p><img src="https://images2.imgbox.com/58/25/CWcJGR8w_o.png" alt="在这里插入图片描述"></p> <pre><code class="prism language-java"><span class="token comment">/**
 * 返回a指定距离内的多边形和多多边形
 *
 * @param a
 * @param distance
 * @return
 */</span>
<span class="token keyword">public</span> <span class="token class-name">Geometry</span> <span class="token function">bufferGeo</span><span class="token punctuation">(</span><span class="token class-name">Geometry</span> a<span class="token punctuation">,</span> <span class="token keyword">double</span> distance<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> a<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span>distance<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><font size="2" face="宋体"><span id="pandaun">交叉分析（intersection）</span></font></p> <p><font size="2" face="宋体">计算出预测线与实际线再阈值为1的情况下重合的部分：<br> <img src="https://images2.imgbox.com/32/cd/fE5hVBup_o.png" alt="在这里插入图片描述"></font></p> <pre><code class="prism language-java"><span class="token comment">/**
 * 创建g1-预测值
 *
 * @param a
 * @param b
 * @return
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ParseException</span> <span class="token punctuation">{<!-- --></span>

	<span class="token class-name">Geometry</span> g1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WKTReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"LINESTRING (0 0, 2 3, 3 2.5, 5 4, 6 3)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Geometry 1: "</span> <span class="token operator">+</span> g1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">// 创建g2-实际值</span>
	<span class="token class-name">Geometry</span> g2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WKTReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"LINESTRING (1 1, 2 2, 3 1, 5 3, 6 2, 8 3)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Geometry 2: "</span> <span class="token operator">+</span> g2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token class-name">Geometry</span> buffer <span class="token operator">=</span> g1<span class="token punctuation">.</span><span class="token function">buffer</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// 重合的部分</span>
	<span class="token class-name">Geometry</span> g1_g2 <span class="token operator">=</span> buffer<span class="token punctuation">.</span><span class="token function">intersection</span><span class="token punctuation">(</span>g2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"G1 intersection G2: "</span> <span class="token operator">+</span> g1_g2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <p><img src="https://images2.imgbox.com/ad/d8/i0HoIfZB_o.png" alt="在这里插入图片描述"></p> </li><li> <p><font size="2" face="宋体">支持接口</font></p> <p><font size="2" face="宋体">• Coordinate</font></p> <p><font size="2" face="宋体">  Coordinate（坐标）是用来存储坐标的轻便的类。它不同于点，点是Geometry的子类。不像模范Point的对象（包含额外的信息，例如一个信包，一个精确度模型和空间参考系统信息），Coordinate只包含纵坐标值和存取方法。</font></p> <p><font size="2" face="宋体">• Envelope(矩形)</font></p> <p><font size="2" face="宋体">  一个具体的类，包含一个最大和最小的x 值和y 值。</font></p> <p><font size="2" face="宋体">• GeometryFactory</font></p> <p><font size="2" face="宋体">  GeometryFactory提供一系列的有效方法用来构造来自Coordinate类的Geometry对象。支持接口</font></p> </li></ol> 
<blockquote> 
 <p><font size="3" face="宋体" color="black"><span id="keshihua">JTS(Java Topology Suite) 可视化界面</span></font></p> 
</blockquote> 
<p><font size="2" face="宋体">JTS提供了一个界面工具JTS TestBuilder，可以在上面绘制图形，验证各种算法。</font></p> 
<p><font size="2" face="宋体">链接：https://pan.baidu.com/s/1cui-yyGeHRG6bW6EovVb9g<br> 提取码：pmr7</font></p> 
<p><font size="2" face="宋体">下载后将压缩包解压，在jts-1.14文件夹下的bin文件夹中，双击testbuilder.bat，既可启动JTS TestBuilder。</font></p> 
<p><img src="https://images2.imgbox.com/3f/ec/URtvs7LU_o.png" alt="在这里插入图片描述"></p> 
<p><font size="2" face="宋体" color="黑体">侧边工具栏里的内容概览：</font></p> 
<p><font size="2" face="宋体">• Valid/Mark用于判断几何图形是否合法简单<br> <font size="2" face="宋体">• Predicates获取DE-9IM模型结果；<br> <font size="2" face="宋体">• Scalar Function查验几何图形的空间关系；<br> <font size="2" face="宋体">• Geometry Functions对几何对象进行仿射、缓冲等操作，并获取结果</font></font></font></font></p> 
<p><img src="https://images2.imgbox.com/da/6a/GYVV3X6Y_o.png" alt="在这里插入图片描述"><br> <font size="2" face="宋体" color="黑体">底部工具栏里的内容概览：</font></p> 
<p><font size="2" face="宋体">• Cases：测试用例界面<br> <font size="2" face="宋体">• Input：用来输入图形参数的，目前只有A和B两个参数，默认测试函数都是用参数A<br> <font size="2" face="宋体">• Result：计算的结果<br> <font size="2" face="宋体">• Inspect：可以参看geometry的具体vetex数据，方向(在Input的Inspect按钮点击进行查看当前高亮的编辑框的对象)<br> <font size="2" face="宋体">• Layers：可以控制输入图形和结果图层的显示，方便查看结果</font></font></font></font></font></p> 
<p><img src="https://images2.imgbox.com/73/97/xAtY1G9A_o.png" alt="在这里插入图片描述"></p> 
<p><font size="2" face="宋体">JTS TestBuilder的使用方法</font></p> 
<ol><li> <p><font size="2" face="宋体">判断两个面是否相交</font></p> <p><font size="2" face="宋体">点击工具条上的Draw Polygon</font></p> <p><img src="https://images2.imgbox.com/16/0c/amHECk7w_o.png" alt="在这里插入图片描述"></p> <p><font size="2" face="宋体">进入侧边栏，点击input，点击A输入框，在图板上绘制图形，双击结束绘制</font></p> <p><img src="https://images2.imgbox.com/56/ec/i0Hp5ZNS_o.png" alt="在这里插入图片描述"><br> <font size="2" face="宋体">点击input的B输入框，切换到绘制图形B，绘制完成后，双击结束</font></p> <p><img src="https://images2.imgbox.com/3b/50/lhg58UhU_o.png" alt="在这里插入图片描述"><br> <font size="2" face="宋体">在Scalar Functions中，选择Intersects，点击compute，下面控制台中输出结果</font></p> <p><img src="https://images2.imgbox.com/ea/39/K3tmAvBv_o.png" alt="在这里插入图片描述"></p> </li></ol> 
<blockquote> 
 <p><font size="3" face="宋体" color="black"><span id="tsdbx">泰森多边形</span></font></p> 
</blockquote> 
<p><a href="#tsdxs" rel="nofollow"><font size="2" face="宋体">泰森多边形的构造</font></a></p> 
<p><a href="#scts" rel="nofollow"><font size="2" face="宋体">Geotools生成泰森多边形</font></a></p> 
<ol><li> <p><font size="2" face="宋体"><span id="tsdxs">泰森多边形的构造</span></font></p> <p><font size="2" face="宋体">假如我在一片空地上，空地上有两个厕所</font></p> <p><img src="https://images2.imgbox.com/82/6d/fKx71hrH_o.png" alt="在这里插入图片描述"></p> <p><font size="2" face="宋体">此时我突然内急，为了赶时间我肯定要去离自己近的那个，我们把厕所视作控制点，然后用个控制点连线的中垂线把整个区域一分为二</font></p> <p><img src="https://images2.imgbox.com/9c/fb/OcGLffsk_o.png" alt="在这里插入图片描述"><br> <font size="2" face="宋体">然后根据自己所处的位置选择离自己更近的那一个，当再增加一个控制点，上面的问题会变得稍微复杂一些</font></p> <p><img src="https://images2.imgbox.com/25/0b/EsIcalvo_o.png" alt="在这里插入图片描述"><br> <font size="2" face="宋体">我们通过三条中垂线把区域分成3份，每块区域内都有对应的最佳选择，当控制点发生变化，3块区域也会随之调整变化。</font></p> <p><font size="2" face="宋体">这样的图形被称为3控制点沃罗诺伊图，图中的每一个单元称为沃罗诺伊单元，或者也可以被称为泰森多边形</font></p> <p><font size="2" face="宋体">沃罗诺伊图满足下面三个特征：<br> <font size="2" face="宋体">• 每个泰森多边形内仅含有一个控制点<br> <font size="2" face="宋体">• 泰森多边形内的点到相应控制点的距离最近<br> <font size="2" face="宋体">• 位于泰森多边形边上的点到其两边的控制点的距离相等</font></font></font></font></p> <p><font size="2" face="宋体">沃罗诺伊图有非常多的实际应用案例：</font></p> <p><font size="2" face="宋体">• 基于全球机场的沃罗诺伊图，每座机场都是一个控制点，把地球分割成多个泰森多边形，这样飞机能够时刻知晓离自己最近的机场</font></p> <p><font size="2" face="宋体">• 基站的建设</font></p> </li><li> <p><font size="2" face="宋体"><span id="scts">Geotools生成泰森多边形</span></font></p> <p><font size="2" face="宋体">首先导入相关依赖：</font></p> <pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>geotools.version</span><span class="token punctuation">&gt;</span></span>19.4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>geotools.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- Geotools --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.geotools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>gt-shapefile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${geotools.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.geotools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>gt-geojson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${geotools.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.geotools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>gt-main<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${geotools.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.geotools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>gt-epsg-hsql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${geotools.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.geotools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>gt-geotiff<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${geotools.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.geotools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>gt-process-raster<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${geotools.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
	<span class="token comment">&lt;!-- https://mvnrepository.com/artifact/org.geotools/gt-image --&gt;</span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
	    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.geotools<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
	    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>gt-image<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
	    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${geotools.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <p><font size="2" face="宋体">创建测试点：</font></p> <p><img src="https://images2.imgbox.com/a3/a0/cz2a6ehb_o.png" alt="在这里插入图片描述"></p> <pre><code class="prism language-java"><span class="token keyword">int</span> xmin <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> xmax<span class="token operator">=</span><span class="token number">180</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> ymin <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> ymax<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">;</span>
<span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Geometry</span><span class="token punctuation">&gt;</span></span> geomsPoints <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Geometry</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	<span class="token comment">//生成0-100之间随机数（制作模拟点）</span>
	<span class="token keyword">int</span> x <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>xmax<span class="token punctuation">)</span><span class="token operator">%</span><span class="token punctuation">(</span>xmax<span class="token operator">-</span>xmin<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> xmin<span class="token punctuation">,</span>
        y <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>ymax<span class="token punctuation">)</span><span class="token operator">%</span><span class="token punctuation">(</span>ymax<span class="token operator">-</span>ymin<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> ymin<span class="token punctuation">;</span>
    <span class="token class-name">Coordinate</span> coord <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Coordinate</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    coords<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>coord<span class="token punctuation">)</span><span class="token punctuation">;</span>
    clipEnvelpoe<span class="token punctuation">.</span><span class="token function">expandToInclude</span><span class="token punctuation">(</span>coord<span class="token punctuation">)</span><span class="token punctuation">;</span>
    geomsPoints<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GeometryFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createPoint</span><span class="token punctuation">(</span>coord<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <p><font size="2" face="宋体">生成泰森多边形：</font></p> <p><img src="https://images2.imgbox.com/82/64/RbborvFQ_o.png" alt="在这里插入图片描述"></p> <pre><code class="prism language-java">voronoiDiagramBuilder<span class="token punctuation">.</span><span class="token function">setSites</span><span class="token punctuation">(</span>coords<span class="token punctuation">)</span><span class="token punctuation">;</span>
voronoiDiagramBuilder<span class="token punctuation">.</span><span class="token function">setClipEnvelope</span><span class="token punctuation">(</span>clipEnvelpoe<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Geometry</span> geom <span class="token operator">=</span> voronoiDiagramBuilder<span class="token punctuation">.</span><span class="token function">getDiagram</span><span class="token punctuation">(</span><span class="token class-name">JTSFactoryFinder</span><span class="token punctuation">.</span><span class="token function">getGeometryFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Geometry</span><span class="token punctuation">&gt;</span></span> geoms <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Geometry</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>geom<span class="token punctuation">.</span><span class="token function">getNumGeometries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    geoms<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>geom<span class="token punctuation">.</span><span class="token function">getGeometryN</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <p><font size="2" face="宋体">完整代码如下：</font></p> <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>lzugis<span class="token punctuation">.</span>geotools</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">Charset</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Random</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>geotools<span class="token punctuation">.</span>data<span class="token punctuation">.</span></span><span class="token class-name">FeatureWriter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>geotools<span class="token punctuation">.</span>data<span class="token punctuation">.</span></span><span class="token class-name">Transaction</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>geotools<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shapefile<span class="token punctuation">.</span></span><span class="token class-name">ShapefileDataStore</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>geotools<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shapefile<span class="token punctuation">.</span></span><span class="token class-name">ShapefileDataStoreFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>geotools<span class="token punctuation">.</span>feature<span class="token punctuation">.</span>simple<span class="token punctuation">.</span></span><span class="token class-name">SimpleFeatureTypeBuilder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>geotools<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>jts<span class="token punctuation">.</span></span><span class="token class-name">JTSFactoryFinder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>geotools<span class="token punctuation">.</span>referencing<span class="token punctuation">.</span>crs<span class="token punctuation">.</span></span><span class="token class-name">DefaultGeographicCRS</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>opengis<span class="token punctuation">.</span>feature<span class="token punctuation">.</span>simple<span class="token punctuation">.</span></span><span class="token class-name">SimpleFeature</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>opengis<span class="token punctuation">.</span>feature<span class="token punctuation">.</span>simple<span class="token punctuation">.</span></span><span class="token class-name">SimpleFeatureType</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>vividsolutions<span class="token punctuation">.</span>jts<span class="token punctuation">.</span>geom<span class="token punctuation">.</span></span><span class="token class-name">Coordinate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>vividsolutions<span class="token punctuation">.</span>jts<span class="token punctuation">.</span>geom<span class="token punctuation">.</span></span><span class="token class-name">Envelope</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>vividsolutions<span class="token punctuation">.</span>jts<span class="token punctuation">.</span>geom<span class="token punctuation">.</span></span><span class="token class-name">Geometry</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>vividsolutions<span class="token punctuation">.</span>jts<span class="token punctuation">.</span>geom<span class="token punctuation">.</span></span><span class="token class-name">GeometryFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>vividsolutions<span class="token punctuation">.</span>jts<span class="token punctuation">.</span>geom<span class="token punctuation">.</span></span><span class="token class-name">Point</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>vividsolutions<span class="token punctuation">.</span>jts<span class="token punctuation">.</span>geom<span class="token punctuation">.</span></span><span class="token class-name">Polygon</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>vividsolutions<span class="token punctuation">.</span>jts<span class="token punctuation">.</span>triangulate<span class="token punctuation">.</span></span><span class="token class-name">VoronoiDiagramBuilder</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TsdbxTest</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">static</span> <span class="token class-name">TsdbxTest</span> tsdbx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TsdbxTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">voronoiTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	    <span class="token class-name">VoronoiDiagramBuilder</span> voronoiDiagramBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VoronoiDiagramBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Coordinate</span><span class="token punctuation">&gt;</span></span> coords <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Coordinate</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token class-name">Envelope</span> clipEnvelpoe <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Envelope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token keyword">int</span> xmin <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> xmax<span class="token operator">=</span><span class="token number">180</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> ymin <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> ymax<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">;</span>
        <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Geometry</span><span class="token punctuation">&gt;</span></span> geomsPoints <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Geometry</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">100</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	    	<span class="token keyword">int</span> x <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>xmax<span class="token punctuation">)</span><span class="token operator">%</span><span class="token punctuation">(</span>xmax<span class="token operator">-</span>xmin<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> xmin<span class="token punctuation">,</span>
	            y <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>ymax<span class="token punctuation">)</span><span class="token operator">%</span><span class="token punctuation">(</span>ymax<span class="token operator">-</span>ymin<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> ymin<span class="token punctuation">;</span>
	        <span class="token class-name">Coordinate</span> coord <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Coordinate</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
	        coords<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>coord<span class="token punctuation">)</span><span class="token punctuation">;</span>
	        clipEnvelpoe<span class="token punctuation">.</span><span class="token function">expandToInclude</span><span class="token punctuation">(</span>coord<span class="token punctuation">)</span><span class="token punctuation">;</span>
	        geomsPoints<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GeometryFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createPoint</span><span class="token punctuation">(</span>coord<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	    <span class="token class-name">String</span> pointpath <span class="token operator">=</span> <span class="token string">"d:/data/tsdbxpt.shp"</span><span class="token punctuation">;</span>
	    tsdbx<span class="token punctuation">.</span><span class="token function">writeShape</span><span class="token punctuation">(</span>pointpath<span class="token punctuation">,</span><span class="token string">"Point"</span><span class="token punctuation">,</span> geomsPoints<span class="token punctuation">)</span><span class="token punctuation">;</span>

	    voronoiDiagramBuilder<span class="token punctuation">.</span><span class="token function">setSites</span><span class="token punctuation">(</span>coords<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    voronoiDiagramBuilder<span class="token punctuation">.</span><span class="token function">setClipEnvelope</span><span class="token punctuation">(</span>clipEnvelpoe<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token class-name">Geometry</span> geom <span class="token operator">=</span> voronoiDiagramBuilder<span class="token punctuation">.</span><span class="token function">getDiagram</span><span class="token punctuation">(</span><span class="token class-name">JTSFactoryFinder</span><span class="token punctuation">.</span><span class="token function">getGeometryFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Geometry</span><span class="token punctuation">&gt;</span></span> geoms <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Geometry</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>geom<span class="token punctuation">.</span><span class="token function">getNumGeometries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	        geoms<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>geom<span class="token punctuation">.</span><span class="token function">getGeometryN</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	    
	    <span class="token class-name">String</span> polygonpath <span class="token operator">=</span> <span class="token string">"d:/data/tsdbx.shp"</span><span class="token punctuation">;</span>
	    tsdbx<span class="token punctuation">.</span><span class="token function">writeShape</span><span class="token punctuation">(</span>polygonpath<span class="token punctuation">,</span><span class="token string">"Polygon"</span><span class="token punctuation">,</span> geoms<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">/**
	 * 
	 * @param filepath
	 * @param geoType
	 * @param geoms
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writeShape</span><span class="token punctuation">(</span><span class="token class-name">String</span> filepath<span class="token punctuation">,</span> <span class="token class-name">String</span> geoType<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Geometry</span><span class="token punctuation">&gt;</span></span> geoms<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">//创建shape文件对象</span>
			<span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span><span class="token punctuation">&gt;</span></span> params <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Serializable</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			params<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span> <span class="token class-name">ShapefileDataStoreFactory</span><span class="token punctuation">.</span>URLP<span class="token punctuation">.</span>key<span class="token punctuation">,</span> file<span class="token punctuation">.</span><span class="token function">toURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">ShapefileDataStore</span> ds <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ShapefileDataStore</span><span class="token punctuation">)</span> <span class="token keyword">new</span> <span class="token class-name">ShapefileDataStoreFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">createNewDataStore</span><span class="token punctuation">(</span>params<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//定义图形信息和属性信息</span>
			<span class="token class-name">SimpleFeatureTypeBuilder</span> tb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleFeatureTypeBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			tb<span class="token punctuation">.</span><span class="token function">setCRS</span><span class="token punctuation">(</span><span class="token class-name">DefaultGeographicCRS</span><span class="token punctuation">.</span>WGS84<span class="token punctuation">)</span><span class="token punctuation">;</span>
			tb<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"shapefile"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>geoType<span class="token operator">==</span><span class="token string">"Point"</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
				tb<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"the_geom"</span><span class="token punctuation">,</span> <span class="token class-name">Point</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
				tb<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"the_geom"</span><span class="token punctuation">,</span> <span class="token class-name">Polygon</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			
			ds<span class="token punctuation">.</span><span class="token function">createSchema</span><span class="token punctuation">(</span>tb<span class="token punctuation">.</span><span class="token function">buildFeatureType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//设置编码</span>
            <span class="token class-name">Charset</span> charset <span class="token operator">=</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"GBK"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ds<span class="token punctuation">.</span><span class="token function">setCharset</span><span class="token punctuation">(</span>charset<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//设置Writer</span>
			<span class="token class-name">FeatureWriter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SimpleFeatureType</span><span class="token punctuation">,</span> <span class="token class-name">SimpleFeature</span><span class="token punctuation">&gt;</span></span> writer <span class="token operator">=</span> ds<span class="token punctuation">.</span><span class="token function">getFeatureWriter</span><span class="token punctuation">(</span>ds<span class="token punctuation">.</span><span class="token function">getTypeNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token class-name">Transaction</span><span class="token punctuation">.</span>AUTO_COMMIT<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>len<span class="token operator">=</span>geoms<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>len<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
				<span class="token comment">//写下一条</span>
				<span class="token class-name">SimpleFeature</span> feature <span class="token operator">=</span> writer<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token class-name">Geometry</span> geom <span class="token operator">=</span> geoms<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
				feature<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"the_geom"</span><span class="token punctuation">,</span> geom<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			writer<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			ds<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> 
		<span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		tsdbx<span class="token punctuation">.</span><span class="token function">voronoiTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"共耗时"</span><span class="token operator">+</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"ms"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <p><font size="2" face="宋体">在geotools中是内置了泰森多边形的算法的，主要依赖于 VoronoiDiagramBuilder 类 利用如下的方式就完成了泰森多边形的计算：</font></p> <pre><code class="prism language-java"><span class="token class-name">VoronoiDiagramBuilder</span> voronoiDiagramBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VoronoiDiagramBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Coordinate</span><span class="token punctuation">&gt;</span></span> coords <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Coordinate</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//这是读取了包含elevation字段的点数据</span>
		<span class="token class-name">SimpleFeatureIterator</span> simpleFeatureIterator <span class="token operator">=</span> featureCollection<span class="token punctuation">.</span><span class="token function">features</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span><span class="token punctuation">(</span>simpleFeatureIterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		    <span class="token class-name">SimpleFeature</span> simpleFeauture <span class="token operator">=</span> simpleFeatureIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		    <span class="token class-name">Point</span> point <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Point</span><span class="token punctuation">)</span>simpleFeauture<span class="token punctuation">.</span><span class="token function">getDefaultGeometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		    <span class="token keyword">double</span> elevation <span class="token operator">=</span> <span class="token class-name">Double</span><span class="token punctuation">.</span><span class="token function">parseDouble</span><span class="token punctuation">(</span>simpleFeauture<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"elevation"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">Coordinate</span> coord <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Coordinate</span><span class="token punctuation">(</span>point<span class="token punctuation">.</span><span class="token function">getX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>point<span class="token punctuation">.</span><span class="token function">getY</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>elevation<span class="token punctuation">)</span><span class="token punctuation">;</span>
			coords<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>coord<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
        simpleFeatureIterator<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//输入坐标点</span>
        voronoiDiagramBuilder<span class="token punctuation">.</span><span class="token function">setSites</span><span class="token punctuation">(</span>coords<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置泰森多边形的边界（一个com.vividsolutions.jts.geom.Polygon）</span>
        voronoiDiagramBuilder<span class="token punctuation">.</span><span class="token function">setClipEnvelope</span><span class="token punctuation">(</span>boundary<span class="token punctuation">.</span><span class="token function">getEnvelopeInternal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//输出成果</span>
        <span class="token class-name">Geometry</span> geom <span class="token operator">=</span> voronoiDiagramBuilder<span class="token punctuation">.</span><span class="token function">getDiagram</span><span class="token punctuation">(</span>gf<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> </li></ol> 
<blockquote> 
 <p><font size="3" face="宋体" color="black"><span id="crsj">向空间数据库插入数据</span></font></p> 
</blockquote> 
<p><font size="2" face="宋体">数据库如何新增这些空间数据呢？</font></p> 
<p><font size="2" face="宋体">先了解一下SQLSERVER空间数据的插入语句长啥样</font></p> 
<pre><code class="prism language-sql"><span class="token comment">--GEOM是类型为Geometry的字段--</span>
<span class="token comment">--我们向该字段新增了一条3D的多边形数据--</span>
<span class="token comment">--geometry :: STGeomFromText () 是由SQLSERVER提供的函数，它能将WKT文本转换为数据库geometry类型的数据--</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">[</span>dbo<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>TEST_GEO_TABLE<span class="token punctuation">]</span> <span class="token punctuation">(</span> <span class="token punctuation">[</span>GEOM<span class="token punctuation">]</span> <span class="token punctuation">)</span>
<span class="token keyword">VALUES</span>
    <span class="token punctuation">(</span> <span class="token keyword">geometry</span> :: STGeomFromText <span class="token punctuation">(</span> 
    <span class="token string">'POLYGON ((
        113.507259000000005 22.24814946 8, 
        113.507188600000006 22.248088559999999 9, 
        113.507117399999998 22.24802743 10, 
        113.507046099999997 22.24796624 11, 
        113.507017300000001 22.247888209999999 12
        ))'</span><span class="token punctuation">,</span><span class="token number">4326</span> <span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><font size="2" face="宋体">也就是说，将坐标转化为WKT文本，我们就可以插入空间数据。接下来我们要考虑的是如何产生WKT文本</font></p> 
<blockquote> 
 <p><font size="3" face="宋体" color="black"><span id="zhage">栅格</span></font></p> 
</blockquote> 
<p><font size="2" face="宋体">ArcGIS栅格数据集通过将世界分割成在格网上布局的离散方形或矩形像元来表示地理要素。每个像元都具有一个值，用于表示该位置的某个特征，例如温度、高程或光谱值。可以抽象为数学上的“矩阵”，这一点与数字图像类似，与其不同的是栅格数据往往带有空间信息（地理坐标、投影坐标）。</font></p> 
<p><img src="https://images2.imgbox.com/dd/1e/19125k1R_o.png" alt="在这里插入图片描述"></p> 
<p><font size="2" face="宋体" color="grey">像元即栅格所表示的内容的详细程度（要素/现象）通常取决于像元（像素）大小或空间分辨率。像元必须足够小，这样才可以捕获到所需的详细信息；而像元又必须足够大，这样才可以提高计算机存储和分析的执行效率。栅格可以使用更小的像元大小在要素的范围内表示更多的特征、更小的要素或更详细的内容。不过，更多通常未必更好。像元大小如果较小，则在表示整个表面时会造成栅格数据集较大；因此，会需要更大的储存空间，而且通常会使处理时间更长。</font></p> 
<p><img src="https://images2.imgbox.com/94/c5/knrv9xF8_o.png" alt="在这里插入图片描述"></p> 
<p><font size="2" face="宋体">栅格数据集常用于表示和管理影像、数字高程模型及许多其他现象。通常，栅格是用于表示点、线和多边形要素的一种方法。在下面的示例中，可以看到如何将一系列多边形表示为栅格数据集。</font></p> 
<p><font size="2" face="宋体">为何将数据存储为栅格呢？有时只能将数据存储为栅格；例如，影像仅以栅格形式提供。然而，许多其他要素（例如点要素）和测量值（例如降雨量）既可以存储为栅格数据类型也可以存储为要素（矢量）数据类型。</font></p> 
<p><img src="https://images2.imgbox.com/95/4a/Jjd3rCVE_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p><font size="3" face="宋体" color="black"><span id="gdal">GDAL </span></font></p> 
</blockquote> 
<p><font size="2" face="宋体">GDAL是栅格和矢量地理空间数据格式的转换器库，由开源地理空间基金会根据X / MIT样式的开源许可证发布。作为一个库，它为调用的应用程序提供了所有支持格式的单个栅格抽象数据模型和单个矢量抽象数据模型。它还带有用于数据转换和处理的各种有用的命令行实用程序。</font></p> 
<p><font size="2" face="宋体">栅格矢量化的流程：</font></p> 
<ol><li> <p><font size="2" face="宋体">载入栅格</font></p> <p><font size="2" face="宋体">首先加载需要矢量化的栅格数据集，读取栅格数据集的波段信息和空间信息。<br> • 波段信息是矢量化的依据<br> • 读取空间信息则是为了保证创建的矢量数据集和栅格数据集的坐标系保持一致</font></p> <p><font size="2" face="宋体">栅格数据集如果没有空间信息，则矢量化的结果会出现上下反转的现象。</font></p> <pre><code class="prism language-java"><span class="token class-name">Dataset</span> dataset <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">gdal<span class="token punctuation">.</span></span>Open</span><span class="token punctuation">(</span>inRaster<span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">gdalconstConstants<span class="token punctuation">.</span></span>GA_ReadOnly</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Band</span> band <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">dataset<span class="token punctuation">.</span></span>GetRasterBand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//栅格转矢量需要的波段信息</span>
<span class="token class-name">SpatialReference</span> prj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpatialReference</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name"><span class="token namespace">dataset<span class="token punctuation">.</span></span>GetProjectionRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name"><span class="token namespace">prj<span class="token punctuation">.</span></span>ImportFromWkt</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">dataset<span class="token punctuation">.</span></span>GetProjectionRef</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//栅格数据的坐标系作为矢量化后的坐标系</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><font size="2" face="宋体">创建矢量</font></p> <p><font size="2" face="宋体">创建一个新的、空的矢量数据集来接收栅格矢量化后的数据</font></p> <pre><code class="prism language-java"><span class="token class-name">String</span> fileName <span class="token operator">=</span> outShp<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>outShp<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"\\"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//带后缀的文件名</span>
<span class="token class-name">String</span> name <span class="token operator">=</span> fileName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> fileName<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//不带后缀</span>
<span class="token class-name">Layer</span> layer <span class="token operator">=</span> <span class="token class-name">ShpProcessing</span><span class="token punctuation">.</span><span class="token function">createLayer</span><span class="token punctuation">(</span><span class="token string">"ESRI Shapefile"</span><span class="token punctuation">,</span> outShp<span class="token punctuation">,</span> name<span class="token punctuation">,</span> prj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">FieldDefn</span> field <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FieldDefn</span><span class="token punctuation">(</span><span class="token string">"value"</span><span class="token punctuation">,</span> <span class="token class-name"><span class="token namespace">ogr<span class="token punctuation">.</span></span>OFTInteger</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//创建一个字段用来存储栅格的像素值</span>
<span class="token class-name"><span class="token namespace">layer<span class="token punctuation">.</span></span>CreateField</span><span class="token punctuation">(</span>field<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> </li><li> <p><font size="2" face="宋体">矢量化</font></p> <p><font size="2" face="宋体">执行gdal内置的的矢量化方法：gdal.Polygonize()</font></p> <pre><code class="prism language-java"><span class="token class-name"><span class="token namespace">gdal<span class="token punctuation">.</span></span>Polygonize</span><span class="token punctuation">(</span>band<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> layer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token namespace">layer<span class="token punctuation">.</span></span>SyncToDisk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> </li></ol> 
<p><font size="2" face="宋体">根据指定坐标点读取栅格数据像元值：</font></p> 
<p><font size="2" face="宋体">• 根据文件路径获取到对应的DataSet类<br> <font size="2" face="宋体">• 从DataSet类获取Band类<br> <font size="2" face="宋体">• 调用Band类的ReadRaster获取一个一维数组(这个一维数组就是该栅格数据的某一区域的值。当ReadRaster的参数范围足够小时，就可以获取到一个像元的值，即一维数组只有一个值)</font></font></font></p> 
<p><font size="2" face="宋体" color="grey">由于ReadRaster的参数需要像素坐标来定位，所以需要先使用DataSet类的GetGeoTransform方法获取像素坐标转地图坐标的参数，然后根据像素坐标转地图坐标的公式和指定的地图坐标点，解二元一次方程组，得到像素坐标。从而调用ReadRaster方法</font></p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>myself<span class="token punctuation">.</span>raster</span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>gdal<span class="token punctuation">.</span>gdal<span class="token punctuation">.</span></span><span class="token class-name">Band</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>gdal<span class="token punctuation">.</span>gdal<span class="token punctuation">.</span></span><span class="token class-name">Dataset</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>gdal<span class="token punctuation">.</span>gdal<span class="token punctuation">.</span></span><span class="token class-name">Driver</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>gdal<span class="token punctuation">.</span>gdal<span class="token punctuation">.</span>gdal</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>gdal<span class="token punctuation">.</span>gdalconst<span class="token punctuation">.</span>gdalconstConstants</span><span class="token punctuation">;</span>
 
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span><span class="token punctuation">;</span>
 
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RasterDemo</span> <span class="token punctuation">{<!-- --></span>
 
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> filepath <span class="token operator">=</span> <span class="token string">"F:\\raster\\Demo.tif"</span><span class="token punctuation">;</span>
        <span class="token comment">//注册</span>
        <span class="token class-name"><span class="token namespace">gdal<span class="token punctuation">.</span></span>AllRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//打开文件获取数据集</span>
        <span class="token class-name">Dataset</span> dataset <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">gdal<span class="token punctuation">.</span></span>Open</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span>
                <span class="token class-name"><span class="token namespace">gdalconstConstants<span class="token punctuation">.</span></span>GA_ReadOnly</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dataset <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"打开"</span><span class="token operator">+</span>filepath<span class="token operator">+</span><span class="token string">"失败"</span><span class="token operator">+</span><span class="token class-name"><span class="token namespace">gdal<span class="token punctuation">.</span></span>GetLastErrorMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//获取驱动</span>
        <span class="token class-name">Driver</span> driver <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">dataset<span class="token punctuation">.</span></span>GetDriver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取驱动信息</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"driver long name: "</span> <span class="token operator">+</span> driver<span class="token punctuation">.</span><span class="token function">getLongName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取栅格数量</span>
        <span class="token keyword">int</span> bandCount <span class="token operator">=</span> dataset<span class="token punctuation">.</span><span class="token function">getRasterCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"RasterCount: "</span> <span class="token operator">+</span> bandCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//构造仿射变换参数数组，并获取数据</span>
        <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span> gt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token namespace">dataset<span class="token punctuation">.</span></span>GetGeoTransform</span><span class="token punctuation">(</span>gt<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"仿射变换参数"</span><span class="token operator">+</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>gt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token comment">//指定经纬度</span>
        <span class="token keyword">double</span> <span class="token class-name">Latitude</span>  <span class="token operator">=</span> <span class="token number">86.053</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span> longitude <span class="token operator">=</span> <span class="token number">16.529</span><span class="token punctuation">;</span>
 
        <span class="token comment">//经纬度转换为栅格像素坐标</span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token class-name">ColRow</span><span class="token operator">=</span><span class="token class-name">Coordinates2ColRow</span><span class="token punctuation">(</span>gt<span class="token punctuation">,</span><span class="token class-name">Latitude</span><span class="token punctuation">,</span>longitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
        <span class="token comment">//判断是否坐标超出范围</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">ColRow</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">||</span><span class="token class-name">ColRow</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">||</span><span class="token class-name">ColRow</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>dataset<span class="token punctuation">.</span><span class="token function">getRasterXSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token class-name">ColRow</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">&gt;</span>dataset<span class="token punctuation">.</span><span class="token function">getRasterYSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">ColRow</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"坐标值超出栅格范围！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
 
        <span class="token comment">//遍历波段，获取该点对应的每个波段的值并打印到屏幕</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>bandCount<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Band</span> band <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">dataset<span class="token punctuation">.</span></span>GetRasterBand</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span> values <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">double</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token namespace">band<span class="token punctuation">.</span></span>ReadRaster</span><span class="token punctuation">(</span><span class="token class-name">ColRow</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token class-name">ColRow</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">double</span> value <span class="token operator">=</span> values<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"横坐标："</span><span class="token operator">+</span><span class="token class-name">Latitude</span> <span class="token operator">+</span><span class="token string">","</span><span class="token operator">+</span><span class="token string">"纵坐标:"</span><span class="token operator">+</span>longitude<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"Band"</span><span class="token operator">+</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">": %s"</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//释放资源</span>
        dataset<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
    <span class="token punctuation">}</span>
 
    <span class="token comment">/**
     * 将地图坐标转换为栅格像素坐标
     * @param gt 仿射变换参数
     * @param X 横坐标
     * @param Y 纵坐标
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token class-name">Coordinates2ColRow</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">[</span><span class="token punctuation">]</span> gt<span class="token punctuation">,</span> <span class="token keyword">double</span> <span class="token class-name">X</span><span class="token punctuation">,</span> <span class="token keyword">double</span> <span class="token class-name">Y</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> ints <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//        X = gt[0] + Xpixel*gt[1] + Yline*gt[2];</span>
<span class="token comment">//        Y = gt[3] + Xpixel*gt[4] + Yline*gt[5];</span>
<span class="token comment">//        消元法解二元一次方程组</span>
<span class="token comment">//        X-gt[0]=Xpixel*gt[1] + Yline*gt[2]</span>
<span class="token comment">//        Xpixel = (X-gt[0] - Yline*gt[2])/gt[1]</span>
<span class="token comment">//        Y - gt[3] = ((X-gt[0] - Yline*gt[2])/gt[1])gt[4] + Yline*gt[5]</span>
<span class="token comment">//        (Y - gt[3])*gt[1] = ((X-gt[0] - Yline*gt[2]))*gt[4] + Yline*gt[5]*gt[1]</span>
<span class="token comment">//        (Y - gt[3])*gt[1] =(X-gt[0])*gt[4] - Yline*gt[2]*gt[4] + Yline*gt[5]*gt[1]</span>
<span class="token comment">//        (Y - gt[3])*gt[1] - (X-gt[0])*gt[4] = Yline(gt[5]*gt[1]-gt[2]*gt[4])</span>
 
        <span class="token comment">//向下取整,如果向上取整会导致计算结果偏大，从而在后面读取到邻近像元的数据</span>
        <span class="token keyword">double</span>  <span class="token class-name">Yline</span> <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Y</span> <span class="token operator">-</span> gt<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span>gt<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token class-name">X</span><span class="token operator">-</span>gt<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">*</span>gt<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>gt<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">*</span>gt<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">-</span>gt<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">*</span>gt<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">double</span>  <span class="token class-name">Xpixel</span> <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">X</span><span class="token operator">-</span>gt<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token class-name">Yline</span><span class="token operator">*</span>gt<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">/</span>gt<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ints<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Double</span><span class="token punctuation">(</span><span class="token class-name">Xpixel</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ints<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Double</span><span class="token punctuation">(</span><span class="token class-name">Yline</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ints<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
 
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p><font size="2" face="宋体">示例：</font></p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>gdal<span class="token punctuation">.</span>gdal<span class="token punctuation">.</span></span><span class="token class-name">Band</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>gdal<span class="token punctuation">.</span>gdal<span class="token punctuation">.</span></span><span class="token class-name">Dataset</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>gdal<span class="token punctuation">.</span>gdal<span class="token punctuation">.</span></span><span class="token class-name">Driver</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>gdal<span class="token punctuation">.</span>gdal<span class="token punctuation">.</span>gdal</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>gdal<span class="token punctuation">.</span>gdalconst<span class="token punctuation">.</span>gdalconstConstants</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> gdaltest <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name"><span class="token namespace">gdal<span class="token punctuation">.</span></span>AllRegister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> rasterFilePath <span class="token operator">=</span><span class="token string">"F:\\倾斜摄影\\正射影像\\01可见光\\map\\result.tif"</span><span class="token punctuation">;</span><span class="token comment">//测试用文件路径</span>
    <span class="token class-name">Dataset</span> dataset <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">gdal<span class="token punctuation">.</span></span>Open</span><span class="token punctuation">(</span>rasterFilePath<span class="token punctuation">,</span>
      <span class="token class-name"><span class="token namespace">gdalconstConstants<span class="token punctuation">.</span></span>GA_ReadOnly</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>dataset <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">gdal<span class="token punctuation">.</span></span>GetLastErrorMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">Driver</span> driver <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">dataset<span class="token punctuation">.</span></span>GetDriver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"driver short name: "</span> <span class="token operator">+</span> driver<span class="token punctuation">.</span><span class="token function">getShortName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"driver long name: "</span> <span class="token operator">+</span> driver<span class="token punctuation">.</span><span class="token function">getLongName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"metadata list: "</span> <span class="token operator">+</span> <span class="token class-name"><span class="token namespace">driver<span class="token punctuation">.</span></span>GetMetadata_List</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">String</span> proj <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">dataset<span class="token punctuation">.</span></span>GetProjection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Band</span> band <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">dataset<span class="token punctuation">.</span></span>GetRasterBand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>proj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>band<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    gdaltest test <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">gdaltest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    test<span class="token punctuation">.</span><span class="token function">dog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p><font size="3" face="宋体" color="black"><span id="geo">GeoTools </span></font></p> 
</blockquote> 
<p><font size="2" face="宋体">在地理信息系统的世界里有一类很重要的数据类型，那便是栅格数据。GeoTools对于栅格数据的支持并没有gdal强大，但既然他作为GeoTools的一部分，我们还是又必要了解一下它。</font></p> 
<p><font size="2" face="宋体">GeoTools支持的栅格数据有： arcgrid、geotiff、 grassraster、 image ( JPEG TIFF GIF PNG)、 imageio-ext-gdal、 imagemosaic、 imagepyramid、 JP2K、matlab</font></p> 
<p><font size="2" face="宋体">GeoTools支持的矢量数据有： wkt、csv、wkb、geojson、shapefile</font></p> 
<p><font size="2" face="宋体">GeoTools对于栅格数据的支持主要又由GridCoverage实现的。作为一名程序员，我们习惯于处理诸如JPEG、GIF或者PNG等格式的栅格数据。在地理空间方面，有一个Coverage个概念，他是空间定位要素的集合。非正式地，我们将地图和Coverage视为等同，当然，这是相对于地理意思而非编程思维上。</font></p> 
<ol><li> <p><font size="2" face="宋体">栅格数据的读取（TIFF）</font></p> <pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Coverage</span> <span class="token function">readTiff</span><span class="token punctuation">(</span><span class="token class-name">String</span> tiffPath<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
     <span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>tiffPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">ParameterValue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OverviewPolicy</span><span class="token punctuation">&gt;</span></span> policy <span class="token operator">=</span> <span class="token class-name">AbstractGridFormat</span><span class="token punctuation">.</span>OVERVIEW_POLICY<span class="token punctuation">.</span><span class="token function">createValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     policy<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token class-name">OverviewPolicy</span><span class="token punctuation">.</span>IGNORE<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">ParameterValue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> gridsize <span class="token operator">=</span> <span class="token class-name">AbstractGridFormat</span><span class="token punctuation">.</span>SUGGESTED_TILE_SIZE<span class="token punctuation">.</span><span class="token function">createValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">ParameterValue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> useJaiRead <span class="token operator">=</span> <span class="token class-name">AbstractGridFormat</span><span class="token punctuation">.</span>USE_JAI_IMAGEREAD<span class="token punctuation">.</span><span class="token function">createValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     useJaiRead<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token class-name">GridCoverage2D</span> image <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeoTiffReader</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GeneralParameterValue</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span>policy<span class="token punctuation">,</span> gridsize<span class="token punctuation">,</span> useJaiRead<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">return</span> image<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> </li><li> <p><font size="2" face="宋体">栅格数据的生成（TIFF）</font></p> <pre><code class="prism language-java"><span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>outTiffPath<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">GeoTiffWriter</span> geoTiffWriter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeoTiffWriter</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token class-name">GeoTiffFormat</span> format <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeoTiffFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token class-name">GeoTiffWriteParams</span> wp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeoTiffWriteParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 设置写出参数</span>
wp<span class="token punctuation">.</span><span class="token function">setCompressionMode</span><span class="token punctuation">(</span><span class="token class-name">GeoTiffWriteParams</span><span class="token punctuation">.</span>MODE_DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
wp<span class="token punctuation">.</span><span class="token function">setTilingMode</span><span class="token punctuation">(</span><span class="token class-name">GeoToolsWriteParams</span><span class="token punctuation">.</span>MODE_DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ParameterValueGroup</span> paramWrite <span class="token operator">=</span> format<span class="token punctuation">.</span><span class="token function">getWriteParameters</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
paramWrite<span class="token punctuation">.</span><span class="token function">parameter</span><span class="token punctuation">(</span><span class="token class-name">AbstractGridFormat</span><span class="token punctuation">.</span>GEOTOOLS_WRITE_PARAMS<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>wp<span class="token punctuation">)</span><span class="token punctuation">;</span>
geoTiffWriter<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">GridCoverage</span><span class="token punctuation">)</span> coverage<span class="token punctuation">,</span> paramWrite<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">GeneralParameterValue</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
geoTiffWriter<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> </li><li> <p><font size="2" face="宋体">栅格数据的加载</font></p> <pre><code class="prism language-java"><span class="token class-name">AbstractGridFormat</span> format <span class="token operator">=</span> <span class="token class-name">GridFormatFinder</span><span class="token punctuation">.</span><span class="token function">findFormat</span><span class="token punctuation">(</span>rasterFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// this is a bit hacky but does make more geotiffs work</span>
<span class="token class-name">Hints</span> hints <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>format <span class="token keyword">instanceof</span> <span class="token class-name">GeoTiffFormat</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    hints <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Hints</span><span class="token punctuation">(</span><span class="token class-name">Hints</span><span class="token punctuation">.</span>FORCE_LONGITUDE_FIRST_AXIS_ORDER<span class="token punctuation">,</span> <span class="token class-name">Boolean</span><span class="token punctuation">.</span>TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
reader <span class="token operator">=</span> format<span class="token punctuation">.</span><span class="token function">getReader</span><span class="token punctuation">(</span>rasterFile<span class="token punctuation">,</span> hints<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> </li><li> <p><font size="2" face="宋体">波段提取</font></p> <pre><code class="prism language-java"><span class="token class-name">GridCoverage2D</span> cov <span class="token operator">=</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> numBands <span class="token operator">=</span> cov<span class="token punctuation">.</span><span class="token function">getNumSampleDimensions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> numBands<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">GridSampleDimension</span> dim <span class="token operator">=</span> cov<span class="token punctuation">.</span><span class="token function">getSampleDimension</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//这里依次输出 RED_BAND  GREEN_BANK BLUE_BANK</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>dim<span class="token punctuation">.</span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><font size="2" face="宋体">样式创建</font></p> </li><li> <p><font size="2" face="宋体">读取tiff</font></p> <p><font size="2" face="宋体">Java中如果要解析tiff，其实很多时候，我们都选择gdal的Java库来实现，毫无疑问，gdal确实在GIS数据处理方面非常的强悍，其实Geotools中很多有关栅格数据的解析，也是基于Gdal进行的封装，今天就简单了解使用GeoTools来解析Tiff数据。</font></p> <pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>dudu<span class="token punctuation">.</span>gis</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>geotools<span class="token punctuation">.</span>gce<span class="token punctuation">.</span>geotiff<span class="token punctuation">.</span></span><span class="token class-name">GeoTiffReader</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>geotools<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span></span><span class="token class-name">GeneralEnvelope</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>opengis<span class="token punctuation">.</span>coverage<span class="token punctuation">.</span>grid<span class="token punctuation">.</span></span><span class="token class-name">GridEnvelope</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>opengis<span class="token punctuation">.</span>referencing<span class="token punctuation">.</span>crs<span class="token punctuation">.</span></span><span class="token class-name">CoordinateReferenceSystem</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>media<span class="token punctuation">.</span>jai<span class="token punctuation">.</span></span><span class="token class-name">ImageLayout</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span>color<span class="token punctuation">.</span></span><span class="token class-name">ColorSpace</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span>image<span class="token punctuation">.</span></span><span class="token class-name">ColorModel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span>image<span class="token punctuation">.</span></span><span class="token class-name">SampleModel</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 一般对于tiff数据的读取，都会借助于gdal
 * Java API库，但其实Java的geotools也
 * 封装了读取tiff文件的API
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GeoTiffReaderTest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> TIF_PATH <span class="token operator">=</span> <span class="token string">"D:\\Gis开发\\数据\\影像数据\\tiff\\china.tif"</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">readTiffFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/**
         * 使用GeoTiffReader
         */</span>
        <span class="token class-name">GeoTiffReader</span> geoTiffReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GeoTiffReader</span><span class="token punctuation">(</span>TIF_PATH<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取到其bbox</span>
        <span class="token class-name">GeneralEnvelope</span> envelope <span class="token operator">=</span> geoTiffReader<span class="token punctuation">.</span><span class="token function">getOriginalEnvelope</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取到投影信息</span>
        <span class="token class-name">CoordinateReferenceSystem</span> crs <span class="token operator">=</span> geoTiffReader<span class="token punctuation">.</span><span class="token function">getCoordinateReferenceSystem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取tiff的gridrange(网格范围，按像素说就是像素数量，也就是是tiff的rectangle)</span>
        <span class="token class-name">GridEnvelope</span> gridEnvelope <span class="token operator">=</span> geoTiffReader<span class="token punctuation">.</span><span class="token function">getOriginalGridRange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取其图像相关信息</span>
        <span class="token class-name">ImageLayout</span> imageLayout <span class="token operator">=</span> geoTiffReader<span class="token punctuation">.</span><span class="token function">getImageLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取colormodel</span>
        <span class="token class-name">ColorModel</span> colorModel <span class="token operator">=</span> imageLayout<span class="token punctuation">.</span><span class="token function">getColorModel</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//查看其通道数量</span>
        <span class="token keyword">int</span> num <span class="token operator">=</span> colorModel<span class="token punctuation">.</span><span class="token function">getNumComponents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//是否支持透明</span>
        <span class="token keyword">boolean</span> isAlpha <span class="token operator">=</span> colorModel<span class="token punctuation">.</span><span class="token function">hasAlpha</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取颜色空间</span>
        <span class="token class-name">ColorSpace</span> clorspace <span class="token operator">=</span> colorModel<span class="token punctuation">.</span><span class="token function">getColorSpace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取samplemodel</span>
        <span class="token class-name">SampleModel</span> sampleModel <span class="token operator">=</span> imageLayout<span class="token punctuation">.</span><span class="token function">getSampleModel</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//数据类型</span>
        <span class="token keyword">int</span> datatype <span class="token operator">=</span> sampleModel<span class="token punctuation">.</span><span class="token function">getDataType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li></ol> 
<blockquote> 
 <p><font size="3" face="宋体" color="black"><span id="qgis">QGIS</span></font></p> 
</blockquote> 
<p><font size="2" face="宋体"><a href="https://www.qgis.org/zh-Hans/site/forusers/download.html" rel="nofollow">QGIS下载地址：https://www.qgis.org/zh-Hans/site/forusers/download.html</a></font></p> 
<blockquote> 
 <p><font size="3" face="宋体" color="black"><span id="kuaisudaoh">快速导航</span></font></p> 
</blockquote> 
<ol><li> <p><font size="2" face="宋体">Geometry 两个图形取交集 （Intersects）</font></p> <pre><code class="prism language-java"><span class="token comment">/**
 * 至少一个公共点(相交)
 * @return
 * @throws ParseException
 */</span>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">intersectsGeo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ParseException</span><span class="token punctuation">{<!-- --></span>
    <span class="token class-name">WKTReader</span> reader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WKTReader</span><span class="token punctuation">(</span> geometryFactory <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">LineString</span> geometry1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LineString</span><span class="token punctuation">)</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"LINESTRING(0 0, 2 0, 5 0)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">LineString</span> geometry2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">LineString</span><span class="token punctuation">)</span> reader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"LINESTRING(0 0, 0 2)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Geometry</span> interPoint <span class="token operator">=</span> geometry1<span class="token punctuation">.</span><span class="token function">intersection</span><span class="token punctuation">(</span>geometry2<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//相交点</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>interPoint<span class="token punctuation">.</span><span class="token function">toText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//输出 POINT (0 0)</span>
    <span class="token keyword">return</span> geometry1<span class="token punctuation">.</span><span class="token function">intersects</span><span class="token punctuation">(</span>geometry2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><font size="2" face="宋体">Geometry 两个图形取并集（union）</font></p> <pre><code class="prism language-java"><span class="token comment">/**
 * 几何对象合并
 *
 * @param a
 * @param b
 * @return
 */</span>
<span class="token keyword">public</span> <span class="token class-name">Geometry</span> <span class="token function">unionGeo</span><span class="token punctuation">(</span><span class="token class-name">Geometry</span> a<span class="token punctuation">,</span> <span class="token class-name">Geometry</span> b<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> a<span class="token punctuation">.</span><span class="token function">union</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><font size="2" face="宋体">Geometry 两个图形取差集（difference）</font></p> <pre><code class="prism language-java"><span class="token comment">/**
 * 几何对象差集
 *
 * @param a
 * @param b
 * @return
 */</span>
<span class="token keyword">public</span> <span class="token class-name">Geometry</span> <span class="token function">differenceGeo</span><span class="token punctuation">(</span><span class="token class-name">Geometry</span> a<span class="token punctuation">,</span> <span class="token class-name">Geometry</span> b<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

	<span class="token class-name">Geometry</span> g1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WKTReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"LINESTRING (0 0, 2 3, 3 2.5, 5 4, 6 3)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Geometry</span> g2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WKTReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token string">"LINESTRING (1 1, 2 2, 3 1, 5 3, 6 2, 8 3)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Geometry</span> difference_addLine <span class="token operator">=</span> g2<span class="token punctuation">.</span><span class="token function">difference</span><span class="token punctuation">(</span>g1_g2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"G2 difference g1_g2: "</span> <span class="token operator">+</span> difference_addLine<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> </li></ol>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7b794f7b08088444dd1ef3154d48dea7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Python_Matplotlib学习笔记（一）】pyplot模块的基本用法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1d4dc88fc3891d91a4e85eb1b34067d2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java学习日记（四）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>