<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>《给java开发者的实操避坑指南》学习笔记——空指针和异常 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="《给java开发者的实操避坑指南》学习笔记——空指针和异常" />
<meta property="og:description" content="JAVA空指针和异常 什么是空指针？
我们都知道java是没有指针的，这里说的java指针指的就是java的引用,我们不在这里讨论叫指针究竟合不合适，而只是针对这个异常本身进行分析。java中的空指针就是空引用，java空指针异常就是引用本身为空，却调用了方法，这个时候就会出现空指针异常。可以理解，成员变量和方法是属于对象的（除去静态），在对象中才存在相对应的成员变量和方法，然后需要通过对象去调用这些成员变量和方法。对于空指针来说，它不指向任何对象，也就没有所谓的成员变量和方法，这个时候用它去调用某些属性和方法，当然会出现空指针异常。
1、如何从根源避免空指针 首先我们来看一个代码实例，看看空指针会出现在哪些情况中
先构建一个静态的对象类User，对象属性包括name和address，对象方法有print()和readBook两个 public static class User{ private String name; private String[] address; public void print(){ System.out.println(&#34;这是User类&#34;); } public String readBook(){ System.out.println(&#34;User在读书！&#34;); return null; } } 再构建一个main方法，此处演示的是第一种空指针情况，即：调用了空对象的实例方法(未进行实例化) public static void main(String[] args) { User user = null; user.print(); } 来看看上面方法的运行结果如何
Exception in thread &#34;main&#34; java.lang.NullPointerException at com.wyf.escape.WhatIsNpe.main(WhatIsNpe.java:24) Process finished with exit code 1 可以看出，抛出了NullPointerException也就是我们通常所说的NPE空指针异常，且定位在java的24行也就是我们代码中的user.print();代码，因为user对象的引用都不存在，是为null 的，所以此处的null当然无法去调用print()方法。
第二种空指针情况：访问了空对象的属性 public static void main(String[] args) { User user = null; System." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/f19a8ed118d801a99717f63efc0d4a5e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-03T11:44:16+08:00" />
<meta property="article:modified_time" content="2021-06-03T11:44:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">《给java开发者的实操避坑指南》学习笔记——空指针和异常</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="JAVA_0"></a>JAVA空指针和异常</h2> 
<blockquote> 
 <p><strong>什么是空指针？</strong></p> 
</blockquote> 
<p>我们都知道<strong>java是没有指针</strong>的，这里说的<em>java指针</em>指的就是<strong>java的引用</strong>,我们不在这里讨论叫指针究竟合不合适，而只是针对这个异常本身进行分析。<strong>java中的空指针就是空引用，java空指针异常就是引用本身为空，却调用了方法，这个时候就会出现空指针异常</strong>。可以理解，<strong>成员变量和方法是属于对象的（除去静态）</strong>，在对象中才存在相对应的成员变量和方法，然后需要通过对象去调用这些成员变量和方法。<strong>对于空指针来说，它不指向任何对象，也就没有所谓的成员变量和方法，这个时候用它去调用某些属性和方法，当然会出现空指针异常。</strong></p> 
<h3><a id="1_6"></a>1、如何从根源避免空指针</h3> 
<p>首先我们来看一个代码实例，看看空指针会出现在哪些情况中</p> 
<ul><li>先构建一个静态的对象类<em>User</em>，对象属性包括<code>name</code>和<code>address</code>，对象方法有<code>print()</code>和<code>readBook</code>两个</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
        <span class="token keyword">private</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> address<span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"这是User类"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">readBook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"User在读书！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>再构建一个<em>main</em>方法，此处演示的是第一种空指针情况，即：<strong>调用了空对象的实例方法(未进行实例化)</strong></li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>来看看上面方法的运行结果如何</p> 
<pre><code class="prism language-java"><span class="token class-name">Exception</span> in thread <span class="token string">"main"</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NullPointerException</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>WhatIsNpe</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">WhatIsNpe</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">24</span><span class="token punctuation">)</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">1</span>
</code></pre> 
<p>可以看出，抛出了<code>NullPointerException</code>也就是我们通常所说的<strong>NPE空指针异常</strong>，且定位在java的24行也就是我们代码中的<code>user.print();</code>代码，因为user对象的引用都不存在，是为null 的，所以此处的null当然无法去调用<code>print()</code>方法。</p> 
<ul><li><strong>第二种空指针情况：访问了空对象的属性</strong></li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token class-name">Exception</span> in thread <span class="token string">"main"</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NullPointerException</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>WhatIsNpe</span>$<span class="token class-name">User</span><span class="token punctuation">.</span>access$<span class="token function">000</span><span class="token punctuation">(</span><span class="token class-name">WhatIsNpe</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>WhatIsNpe</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">WhatIsNpe</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">28</span><span class="token punctuation">)</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">1</span>
</code></pre> 
<p>结果与之前的是一样，其原因也是一样的，这里就不过多赘述。</p> 
<ul><li><strong>第三种情况：当数组是一个空对象时，取它的长度</strong></li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>address<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token class-name">Exception</span> in thread <span class="token string">"main"</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NullPointerException</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>WhatIsNpe</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">WhatIsNpe</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">37</span><span class="token punctuation">)</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">1</span>
</code></pre> 
<p>其原因与之前两种类似，是因为User对象中的数组对象<code>address</code>并未进行初始化导致其数组对象的方法无法调用</p> 
<ul><li><strong>第四种情况：thow一个为进行初始化的自定义异常</strong></li></ul> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 自定义运行时异常
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CustomException</span> <span class="token keyword">extends</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">CustomException</span> exception <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">throw</span>  exception<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token class-name">Exception</span> in thread <span class="token string">"main"</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NullPointerException</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>WhatIsNpe</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">WhatIsNpe</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">41</span><span class="token punctuation">)</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">1</span>
</code></pre> 
<p>异常的参数<code>Throwable</code>是不接受null值的，所有抛出的异常都需要进行初始化操作</p> 
<ul><li><strong>第五种情况：方法的返回值为null，未做校验直接使用</strong></li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">readBook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token class-name">User</span>在读书！
<span class="token class-name">Exception</span> in thread <span class="token string">"main"</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NullPointerException</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>WhatIsNpe</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">WhatIsNpe</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">45</span><span class="token punctuation">)</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">1</span>
</code></pre> 
<p>此处的<code>readBook()</code>方法返回的是一个null值，故而在调用时还是正常运行的，输出了<code>User在读书！</code>，但是其返回值null被直接拿来当做一个<code>String</code>对象进行<code>equals</code>比较，故而抛出空指针异常</p> 
<p>以上的五个案例，都是空指针经常出现的案例，<strong>究其根本就是调用的对象可能并未初始化</strong>，所以为了从根源避免NPE空指针异常，这里给出以下几个可行的方法：</p> 
<ul><li>使用对象前一定要进行初始化，或者对其继续校验是否已经初始化</li><li>尽可能的避免我们编写的函数有返回null 的情况，如无法避免，最好写出详细的注释信息来提示开发者</li><li>接收外部传值时，如果没有特别说明某个属性一定非空，则一定要及时判断</li></ul> 
<h3><a id="2_134"></a>2、赋值时自动拆箱出现空指针</h3> 
<p>首先我们要知道，需要装箱拆箱的类型有哪些，具体如下<br> <img src="https://images2.imgbox.com/90/29/OeLK2Nfi_o.png" alt="在这里插入图片描述"></p> 
<table><thead><tr><th align="center">基本类型</th><th align="center">包装类型</th></tr></thead><tbody><tr><td align="center">int (4字节)</td><td align="center">Integer</td></tr><tr><td align="center">byte (1字节)</td><td align="center">Byte</td></tr><tr><td align="center">short (2字节)</td><td align="center">Short</td></tr><tr><td align="center">long (8字节)</td><td align="center">Long</td></tr><tr><td align="center">float (4字节)</td><td align="center">Float</td></tr><tr><td align="center">double (8字节)</td><td align="center">Double</td></tr><tr><td align="center">char (2字节)</td><td align="center">Character</td></tr><tr><td align="center">boolean(1字节)</td><td align="center">Boolean</td></tr></tbody></table> 
<p>除此之外，我们还得了解包装器类型也就是我们所说的<strong>包装类型</strong>和<strong>基本类型</strong>之间有什么区别呢？<br> <img src="https://images2.imgbox.com/5a/0a/FYCTQ65W_o.png" alt="在这里插入图片描述"><br> 从上面的图我们可以看出来，在日常开发中，咱们去new的一个对象，都是存储在java堆中，然后通过堆栈中的应用来获得期望的对象，但对于经常用到的基础类型来说，这种做法并不是那么有效，一些包装器对象的属性通常是用不到的，白白占用内存空间，所以就出现了基本类型，这些类型直接将变量值存储在堆栈中，以此来提高存取的效率，所以这些基本类型是不具有对象性质的，而包装类型才是对应着面向对象的类型与特征。</p> 
<p>知道了基本的概念，接下来我们就要了解一下为何自动拆箱会出现空指针，主要来源有两个：</p> 
<ul><li><strong>变量赋值自动拆箱出现的空指针</strong></li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 变量赋值自动拆箱出现空指针</span>
        <span class="token class-name">Long</span> count <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> count_<span class="token operator">=</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token class-name">Exception</span> in thread <span class="token string">"main"</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NullPointerException</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>UnBoxingNpe</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">UnBoxingNpe</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">1</span>
</code></pre> 
<p>因为我们将一个包装类型的对象赋值给了一个基本类型对象，但实则该包装类型对象并未初始化，而包装类型赋值给基本类型需要进行一个拆箱操作，但它并未初始化又何来拆箱一说？所以导致了空指针异常！</p> 
<ul><li><strong>方法传参时自动拆箱出现的空指针</strong></li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  	<span class="token comment">// 方法传值时自动拆箱引发的空指针</span>
    <span class="token class-name">Integer</span> x <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">Integer</span> y <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span><span class="token keyword">int</span> y<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> x<span class="token operator">+</span>y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token class-name">Exception</span> in thread <span class="token string">"main"</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NullPointerException</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>UnBoxingNpe</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">UnBoxingNpe</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">1</span>
</code></pre> 
<p>此处的空指针异常，是因为方法传参的参数在拆箱过程中，因拆箱目标对象为null从而导致空指针异常。</p> 
<p>找到了自动拆箱出现空指针异常的两个场景，也看了实例，但是为什么自动拆箱会出现空指针呢？什么是自动拆箱？这就涉及到java的编译了，让我们以第一个例子来看看，自动拆箱到底是个啥</p> 
<p>首先我们需要将之前写好的案例通过<code>javac UnBoxingNpe.java</code>命令来进行编译生成其对应的<code>UnBoxingNpe.class</code>文件，或者直接在你项目的target目录底下找一找对应class文件，如图<br> <img src="https://images2.imgbox.com/42/07/iTYeoPfZ_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-5vJCS0zd-1622691294847)(C:\Users\wangyifan\AppData\Roaming\Typora\typora-user-images\image-20210528145938829.png)]"><br> 然后用<code>javap -c UnBoxingNpe.class</code>来分析字节码<br> <img src="https://images2.imgbox.com/6e/33/TKmpsVTU_o.png" alt="在这里插入图片描述"></p> 
<p>编译分析出来的结果如上图所示，值得注意的一个点就是我们用红色框框框出来的，在赋值的过程中调用了<code>Long.longValue:()</code>方法，也就是将包装类对象中的值取出来，而取出来的就是java 的基本类型对象了，所以此时我们就不难理解，一个为null未进行初始化的对象在调用方法时，自然会抛出空指针异常。</p> 
<p>那么如何避免自动拆箱引发的空指针异常呢？有以下几个建议：</p> 
<ul><li>基本数据类型的使用优于包装器类型，优先考使用基本类型。</li><li>对于不确定的包装器类型，一定要校验是否是NULL</li><li>对于值为NULL的包装器类型，复值为 0</li></ul> 
<h3><a id="3_214"></a>3、字符串、数组、集合在使用时出现空指针怎么办？</h3> 
<p>咱们在开发中最常使用的几个东西：<strong>字符串、数组、集合</strong>，正因为其用的多，所以也经常遇到相关的问题，空指针就是其中之一，话不多说，直接上案例</p> 
<ul><li><strong>字符串使用时报空指针异常</strong></li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">stringEquals</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">stringEquals</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">stringEquals</span><span class="token punctuation">(</span><span class="token class-name">String</span> x<span class="token punctuation">,</span><span class="token class-name">String</span> y<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> x<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token boolean">false</span>
<span class="token class-name">Exception</span> in thread <span class="token string">"main"</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NullPointerException</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>BasicUsageNpe</span><span class="token punctuation">.</span><span class="token function">stringEquals</span><span class="token punctuation">(</span><span class="token class-name">BasicUsageNpe</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">14</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>BasicUsageNpe</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">BasicUsageNpe</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">1</span>
</code></pre> 
<p>从输出结果可以看出，第一个比较的调用时成功了的，但第二个却报了空指针异常，究其原因还是在于null的传递，在java的<code>equals()</code>方法中，是可以接收NULL作为参数来进行比较的，但是，第一个调用中，NULL并不是作为参数，而是作为对象来调用<code>equals()</code>方法，这就与之前未初始化的对象调用其内部方法导致空指针异常的逻辑是一样的。</p> 
<ul><li><strong>对象数组new出来了，但元素未进行初始化</strong></li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token class-name">User</span><span class="token punctuation">[</span><span class="token punctuation">]</span> users <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">User</span> user <span class="token operator">:</span> users<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        user<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"wyf"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token class-name">Exception</span> in thread <span class="token string">"main"</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NullPointerException</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>BasicUsageNpe</span>$<span class="token class-name">User</span><span class="token punctuation">.</span>access$<span class="token function">002</span><span class="token punctuation">(</span><span class="token class-name">BasicUsageNpe</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>BasicUsageNpe</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">BasicUsageNpe</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">1</span>
</code></pre> 
<p>此处我们已经初始化了一个容量为10的User数组，并对其进行遍历，在遍历的过程中向他的<code>name</code>属性进行赋值，但运行时却报了空指针异常，这也是开发中常见的一个问题，原因是User数组确实初始化了，但其初始化的知识数组的容量，让该数组可以存放10个User对象，实际上数组中是没有任何User对象的，此时对他的遍历，遍历出来的自然都是NULL，而Null自然也无法去给<code>name</code>属性赋值。</p> 
<ul><li><strong>List对象add一个null是不报错的，但addAll会报空指针异常</strong></li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users_ <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    
    users<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>
    users<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>users_<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token punctuation">[</span><span class="token keyword">null</span><span class="token punctuation">]</span>
<span class="token class-name">Exception</span> in thread <span class="token string">"main"</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NullPointerException</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>ArrayList</span><span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">583</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>BasicUsageNpe</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">BasicUsageNpe</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">29</span><span class="token punctuation">)</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">1</span>
</code></pre> 
<p>这个案例也是一隐藏很深的坑，我们通过控制台输出的结果不难发现，第一个为null的user成功的add进了我们的users对象中，但在<code>addAll()</code>方法的调用时却抛了空指针异常，而其对象同样是一个为null的User集合，让我们来看看<code>addAll()</code>方法的源码</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">addAll</span><span class="token punctuation">(</span><span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> c<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> a <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> numNew <span class="token operator">=</span> a<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token function">ensureCapacityInternal</span><span class="token punctuation">(</span>size <span class="token operator">+</span> numNew<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Increments modCount</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">arraycopy</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> elementData<span class="token punctuation">,</span> size<span class="token punctuation">,</span> numNew<span class="token punctuation">)</span><span class="token punctuation">;</span>
    size <span class="token operator">+=</span> numNew<span class="token punctuation">;</span>
    <span class="token keyword">return</span> numNew <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>从源码中我们可以发现，<code>addAll()</code>的参数是作为一个集合对象传过来的，在其方法体的第一步，就是调用形参<em>c</em>的<code>toArray()</code>方法，而当传过来的集合对象是NULL时，那么就会出现空指针异常了！</p> 
<p>以上三个案例分别对应<strong>字符串、数组、集合</strong>的使用过程中容易碰到的空指针案例，那么我们该如何避免呢？</p> 
<ul><li>字符串在调用<code>equals</code>方法时，尽量以常量作为调用对象，以变量作为比较参数</li><li>数组的遍历赋值，需判断数组内有无已经实例化的对象，若没有实例化，则在遍历过程中进行实例化后再操作其属性或调用其方法</li><li>集合的接口的调用需了解其原理，知其然知其所以然。</li></ul> 
<h3><a id="4Optional_316"></a>4、如何使用Optional规避空指针</h3> 
<blockquote> 
 <p><strong>什么是Optional？</strong></p> 
</blockquote> 
<p>**Optional**是java8新增的一个对象，<strong>它可以用来判断一个值的存在与否，其设计初衷就是用来规避空指针异常</strong>，并未考虑其作为类的字段使用，也并未实现数列化接口，故而在领域模型中要小心使用。</p> 
<blockquote> 
 <p><strong>Optional的方法</strong></p> 
</blockquote> 
<p>Optional作为java8中的新对象，那么他具有哪些方法呢，以及如何正确使用呢？先让我们一起看看，如何获得一个Optional对象，获取方法有三：</p> 
<ul><li>通过<code>Optional.empty()</code>获取一个空对象</li></ul> 
<pre><code class="prism language-java"><span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> optional <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>源码如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> EMPTY <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">static</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"unchecked"</span><span class="token punctuation">)</span>
    <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> EMPTY<span class="token punctuation">;</span>
    <span class="token keyword">return</span> t<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>通过<code>Optional.of()</code>生成一个对象</li></ul> 
<pre><code class="prism language-java"><span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> user1 <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>但此方法需要注意，其<code>of()</code>方法中的对象不可为null，不然就会抛出空指针异常，其底层源码如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//调用Optional构造方法</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">Optional</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//调用Objects.requireNonNull()方法</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">requireNonNull</span><span class="token punctuation">(</span><span class="token class-name">T</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
       <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> obj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>通过源码我们就可以很清楚的看到为啥<code>of()</code>方法的对象必须不为null了</p> 
<ul><li>通过<code>Optional.ofNullable()</code>生成一个对象</li></ul> 
<pre><code class="prism language-java"><span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> user2 <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>该方法相比于<code>of()</code>方法，它可以接受为null的参数，如果有值则根据具体的值来创建，如果为null则创建一个空对象，源码如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">ofNullable</span><span class="token punctuation">(</span><span class="token class-name">T</span> value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> value <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">of</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><code>ofNullable()</code>方法通过三元运算符对传入的参数进行判断，如果为空，直接调用<code>empty()</code>创建空对象，如果不为空则调用<code>of()</code>创建对象。</p> 
<blockquote> 
 <p><strong>Optional的正确使用</strong></p> 
</blockquote> 
<p>先看一个错误示例：</p> 
<pre><code class="prism language-java"><span class="token comment">//判断是否为空</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">isUserEqualNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 获取一个空的Optional实例</span>
    <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> optional <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>optional<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"User is not Null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"User is Null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//调用判断方法</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">isUserEqualNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>如果以上述的方法使用<code>Optional</code>来进行单纯的非空判断，那<em>Optional</em>的作用于<code>equals()</code>方法的作用没有差异，是一种没有意义的使用方式，下面看看<code>Optional</code>的正确打开方式：</p> 
<ul><li><code>.orElse()</code>方法：</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 创建空对象</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">//创建Optional对象</span>
    <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> optional <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 存在则返回，为空则返回默认值</span>
    optional<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>上述方法描述的是，先对<code>optional</code>对象进行判断是否为空，不为空直接返回当前<code>optional</code>中的值，若为空的话则为<code>optional</code>赋值<code>orElse()</code>方法中的指定对象，其源码如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">orElse</span><span class="token punctuation">(</span><span class="token class-name">T</span> other<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> value <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> value <span class="token operator">:</span> other<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><code>.orElseGet()</code>方法：</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 创建空对象</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">//创建Optional对象</span>
    <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> optional <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 存在则返回，为空则使用Supplier函数生成一个对象</span>
    optional<span class="token punctuation">.</span><span class="token function">orElseGet</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token class-name">SupplierUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>与上面的<code>orElse()</code>方法相比，<code>orElseGet()</code>方法则是会按照提供的<em>Supplier</em>函数来提供相应的参数，其优点也很明显，复用性强，使用起来更加灵活,但如果对象本身不存在且提供的<em>Supplier</em>函数也为NULL，则会抛出空指针异常，具体源码如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token class-name">T</span> <span class="token function">orElseGet</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> other<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> value <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> value <span class="token operator">:</span> other<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><code>.orElseThrow()</code>方法:</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 创建空对象</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">//创建Optional对象</span>
    <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> optional <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 存在则返回，为空则抛出异常,具体异常类型可自定义</span>
    optional<span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token class-name">RuntimeException</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>该方法对<code>Optional</code>对象进行判断，若为NULL则会抛出自定义的异常，如果不存在任何值且<em>exceptionSupplier</em>为Null的话，会抛出空指针异常，源码如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">X</span> <span class="token keyword">extends</span> <span class="token class-name">Throwable</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">T</span> <span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token class-name">Supplier</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">X</span><span class="token punctuation">&gt;</span></span> exceptionSupplier<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">X</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">throw</span> exceptionSupplier<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><code>.ifPresent()</code> 方法：</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 创建空对象</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">//创建Optional对象</span>
    <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> optional <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 存在就去进行相应的处理，为空则不执行操作</span>
	optional<span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token operator">::</span><span class="token function">getName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>此方法对<code>Optional</code>对象进行非空判断，若不为空，则根据提供的<em>Consumer</em>函数进行操作，如果值存在且consumer为空，则会抛出空指针异常：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">ifPresent</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> consumer<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        consumer<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><code>.map()</code>方法：</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 创建空对象</span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token comment">//创建Optional对象</span>
    <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> optional <span class="token operator">=</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// map可以对Optional中的对象进行某种操作，其返回结果仍然是一个Optional对象</span>
	optional<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>u <span class="token operator">-&gt;</span> u<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">"WYF"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">// map可以无限的进行级联操作</span>
	optional<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>u <span class="token operator">-&gt;</span> u<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>n <span class="token operator">-&gt;</span> n<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>该方法在<code>Optional</code>中是一个非常特殊的方法，他与*Stream()*操作中的<code>map()</code>方法类似，用于映射某个操作，如获取字段，获取某个字段进行加工等操作，此处的<code>map()</code>方法也是如此，<strong>如果存在值，则对其应用提供的映射函数，如果结果非空，则返回描述结果的Optional ， 否则返回一个空的Optional</strong> ，所以他是可以无限制的进行级联操作的：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token punctuation">&gt;</span></span> mapper<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>mapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">Optional</span><span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>mapper<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="5trycatch_532"></a>5、明明try…catch了却没解决好异常</h3> 
<blockquote> 
 <p><strong>什么是异常？</strong></p> 
</blockquote> 
<p>异常分很多种情况，如用户输入了非法格式数据、打开不存在的文件、网络通信中断、JVM内存溢出等等，异常引起的原因有多个方面，可能是程序引起的，也可能是用户错误引起的，甚至有些是因为硬件的问题引起的。<br> <img src="https://images2.imgbox.com/a2/59/nLqg2N7d_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-PXKj9leV-1622691294851)(C:\Users\wangyifan\AppData\Roaming\Typora\typora-user-images\image-20210602140859498.png)]"><br> 那么在java中的异常体系结构又是怎样的呢？看看下图：<br> <img src="https://images2.imgbox.com/a4/f6/g2LgBESS_o.png" alt="[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-fcz6g17o-1622691294853)(C:\Users\wangyifan\AppData\Roaming\Typora\typora-user-images\image-20210602141000529.png)]"><br> 在java中，所有的异常情况都是内置在<code>Throwable</code>中，是所有异常最顶层的超类，而且接下来的两个分支就很重要了</p> 
<ul><li><strong>Error分支：java中不希望被程序捕获或者程序无法处理的异常</strong></li><li><strong>Exception分支：java中希望被捕获，或者程序可以进行处理的异常</strong> 
  <ul><li><strong>CheckedException:非运行时异常</strong></li><li><strong>RuntimeException:运行时异常</strong></li></ul> </li></ul> 
<blockquote> 
 <p><strong>ERROR异常</strong></p> 
</blockquote> 
<p>Error类对象由java虚拟机生成并抛出</p> 
<blockquote> 
 <p><strong>Excepton异常</strong></p> 
</blockquote> 
<p>Exception是java开发过程中最常见的，其子类<code>RuntimeException</code>，为我们定义了许多可以直接抛出的异常，如常见的空指针异常<code>NullPointException</code>、数组下标越界异常<code>IndexOutOfBoundsException</code>等等，对于这些运行时异常，我们可以选择进行捕获处理，也可以选择不进行处理；<code>CheckedException</code>被称之为检查性异常，这种异常在一定程度上可以预测它的发生，大多数情况下我们都会通过<code>try...catch</code>对其捕获进行处理，下面我们来看个例子：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExceptionProcess</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 异常的一个本质就是抛出异常
     * 另一个本质便是方法抛出异常，运行时系统将寻找潜在的异常处理器，当异常处理器所能处理的异常类型与方法相符，则视为找到合适的异常处理器，
     * 然后运行时系统会遍历方法调用栈中的方法来进行处理，若没有找到合适的异常处理器，则运行时系统终止，java程序终止
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">throwException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token comment">// 想要执行某个逻辑程序，但由于某个参数或者当前情况不允许继续向下执行，则抛出异常</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 不能捕获异常
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">canNotCatchNpeException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">throwException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassCastException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//将捕获异常类型改为类型转换异常，就捕获不到NullPointerException</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"捕获："</span><span class="token operator">+</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"捕获："</span><span class="token operator">+</span>e<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 能捕获异常
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">canCatchNpeException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">throwException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassCastException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//将捕获异常类型改为类型转换异常，就捕获不到NullPointerException</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"捕获："</span><span class="token operator">+</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"捕获："</span><span class="token operator">+</span>e<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">NullPointerException</span> npe<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"捕获："</span><span class="token operator">+</span>npe<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"捕获："</span><span class="token operator">+</span>npe<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ExceptionProcess</span> exceptionProcess <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExceptionProcess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//先调用可捕获的异常</span>
        exceptionProcess<span class="token punctuation">.</span><span class="token function">canCatchNpeException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//再调用不可捕获的异常，程序终止</span>
        exceptionProcess<span class="token punctuation">.</span><span class="token function">canNotCatchNpeException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java">捕获：<span class="token keyword">null</span>
捕获：<span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NullPointerException</span>
<span class="token class-name">Exception</span> in thread <span class="token string">"main"</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>NullPointerException</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>ExceptionProcess</span><span class="token punctuation">.</span><span class="token function">throwException</span><span class="token punctuation">(</span><span class="token class-name">ExceptionProcess</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">22</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>ExceptionProcess</span><span class="token punctuation">.</span><span class="token function">canNotCatchNpeException</span><span class="token punctuation">(</span><span class="token class-name">ExceptionProcess</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">31</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>ExceptionProcess</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">ExceptionProcess</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">57</span><span class="token punctuation">)</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">1</span>
</code></pre> 
<p>从上面的案例中咱们可以明显的看出来，调用可捕获的方法，捕获到的也只是与异常处理器对应上类型的异常，而类型不对应的异常是无法捕获的，所以在第一个方法中输出了异常信息与异常的名称，而第二个方法调用因为无法匹配到合适的异常处理器，导致运行时程序停止。</p> 
<p>下面咱们来列举一下java异常处理的实践原则：</p> 
<ul><li>使用异常，而不是返回码（或类似返回码的东西），因为通常来说异常里包含的信息更加详细</li><li>主动捕获检查性异常，并对异常的信息进行反馈（存日志或者标记）</li><li>保持代码的整洁，一个方法中尽量不要有多个<code>try...catch</code>或者嵌套的<code>try...catch</code></li><li>捕获更加具体的异常，而不是通用的Exception，具体的异常也有利于开发者有效的识别错误信息</li><li>合理的设计自定义的异常类型</li></ul> 
<h3><a id="6_635"></a>6、编码中的常见异常</h3> 
<blockquote> 
 <p><strong>常见的案例有哪些？</strong></p> 
</blockquote> 
<ul><li>可迭代对象在遍历的同时做修改，则会抛出<strong>并发修改异常</strong></li><li>类型转换不符合JAVA的继承关系，则会抛出<strong>类型转换异常</strong></li><li>枚举在查找时，如果枚举值不存在，不会返回空，而是直接抛出异常</li></ul> 
<blockquote> 
 <p><strong>并发修改异常：</strong></p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GeneralException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span><span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> name<span class="token punctuation">;</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 并发修改异常
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">concurrentModificationException</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">User</span> user <span class="token operator">:</span> users<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                users<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>
                <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">concurrentModificationException</span><span class="token punctuation">(</span>users<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token class-name">Exception</span> in thread <span class="token string">"main"</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>ConcurrentModificationException</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>ArrayList</span>$<span class="token class-name">Itr</span><span class="token punctuation">.</span><span class="token function">checkForComodification</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">911</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span>ArrayList</span>$<span class="token class-name">Itr</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">861</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>GeneralException</span><span class="token punctuation">.</span><span class="token function">concurrentModificationException</span><span class="token punctuation">(</span><span class="token class-name">GeneralException</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">33</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>GeneralException</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">GeneralException</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">54</span><span class="token punctuation">)</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">1</span>
</code></pre> 
<p>直接使用for循环对集合元素进行删除，会触发快速失败机制，其底层逻辑是，当集合遍历时，会生成一个迭代器，迭代器会生成一个专门用于指向原集合数据的索引表，且迭代器的线程是独立出来的，当主线程中的集合对其中的元素进行删除，改变了集合大小，因为迭代器的索引表在另一个线程中，无法同步主线程的改变，从而导致并发修改异常，若要避免在迭代的过程中因为删除元素等操作而抛出异常，可以使用迭代器本身的方法来进行删除，具体如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">concurrentModificationException</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
   <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> iterator <span class="token operator">=</span> users<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">while</span> <span class="token punctuation">(</span>iterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> next <span class="token operator">=</span> iterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>next<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            iterator<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>通过迭代器本身来进行删除，就可以避免因为索引表不对等而导致的异常</strong>，但需要注意，<code>iterator.next()</code>需要在<code>iterator.remove()</code>之后，否则仍然会报<strong>并发修改异常</strong>，此方法可行，但如果真需要删除，建议使用java8的<code>stream().filter()</code>进行过滤操作，安全性更高，效率高。</p> 
<blockquote> 
 <p><strong>强制类型转换异常</strong></p> 
</blockquote> 
<p>在上面的例子中继续操作，我们新增<code>Worker</code>与<code>Manager</code>两个对象且都继承自<code>User</code>对象</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Manager</span> <span class="token keyword">extends</span> <span class="token class-name">User</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Worker</span> <span class="token keyword">extends</span> <span class="token class-name">User</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<p>随后我们开始构建案例，各创建一个<code>Worker</code>与<code>Manager</code>对象，但其接收的对象类型为<code>User</code>，在java中父类型对象是可以接收子类型对象的转型的，然后我们做一个操作，将<code>user1</code>与<code>user2</code>都转换成<code>Manager</code>对象，此处我们可以很清楚的看出来两个user的初始化类型其实是不一样的，但接收的对象类型一样，所以有时候我们就会忽略其原本的初始化类型</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 类型转换异常</span>
    <span class="token class-name">User</span> user1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Manager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">User</span> user2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//强制类型转换</span>
    <span class="token class-name">Manager</span> m1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Manager</span><span class="token punctuation">)</span> user1<span class="token punctuation">;</span>
    <span class="token class-name">Manager</span> m2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Manager</span><span class="token punctuation">)</span> user2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token class-name">Exception</span> in thread <span class="token string">"main"</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>ClassCastException</span><span class="token operator">:</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>GeneralException</span>$<span class="token class-name">Worker</span> cannot be cast <span class="token keyword">to</span> <span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span><span class="token class-name">GeneralException</span>$<span class="token class-name">Manager</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>GeneralException</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">GeneralException</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">67</span><span class="token punctuation">)</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">1</span>
</code></pre> 
<p>最终结果如上，会报出<code>ClassCastException</code>类型转换异常，那么对于这种情况我们怎么处理呢？来看看下面的两种方式：</p> 
<ul><li>通过<code>.getClass().getName()</code>来获得其初始化类型的名称，进而判断能否转换</li><li>通过<code>instanceof</code>关键字来判断当前类型是否属于被转化的类型值</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 类型转换异常</span>
    <span class="token class-name">User</span> user1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Manager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">User</span> user2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Worker</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user2<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user2 <span class="token keyword">instanceof</span> <span class="token class-name">Manager</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>GeneralException</span>$<span class="token class-name">Worker</span>
<span class="token boolean">false</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">0</span>
</code></pre> 
<blockquote> 
 <p><strong>枚举查找异常</strong></p> 
</blockquote> 
<p>首先我们创建一个枚举类</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">StaffType</span> <span class="token punctuation">{<!-- --></span>
    RD<span class="token punctuation">,</span>
    QA<span class="token punctuation">,</span>
    PM<span class="token punctuation">,</span>
    OP<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>然后在刚才的类中构建一个枚举查找方法：</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">StaffType</span> <span class="token function">enumFind</span><span class="token punctuation">(</span><span class="token class-name">String</span> type<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token class-name">StaffType</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>通过上述方法，将要查找的值传进去即可获取对应的枚举值，然后来写一下测试方法看看效果</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 3枚举查找异常</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">enumFind</span><span class="token punctuation">(</span><span class="token string">"PM"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">enumFind</span><span class="token punctuation">(</span><span class="token string">"abc"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java">PM
<span class="token class-name">Exception</span> in thread <span class="token string">"main"</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>IllegalArgumentException</span><span class="token operator">:</span> <span class="token class-name">No</span> <span class="token keyword">enum</span> constant <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>StaffType</span><span class="token punctuation">.</span>abc
	at <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>Enum</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">Enum</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">238</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>StaffType</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token class-name">StaffType</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>GeneralException</span><span class="token punctuation">.</span><span class="token function">enumFind</span><span class="token punctuation">(</span><span class="token class-name">GeneralException</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">55</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span></span>GeneralException</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">GeneralException</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">77</span><span class="token punctuation">)</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">1</span>
</code></pre> 
<p>可以看到，第一个<strong>PM</strong>是正常输出的，但第二个<strong>abc</strong>却找不着，故而抛出了<code>IllegalArgumentException</code>非法参数异常，那么我们如何避免呢，有四种方法可以解决：</p> 
<ul><li>捕获异常</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token class-name">StaffType</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IllegalArgumentException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>循环判断</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">StaffType</span> value <span class="token operator">:</span> <span class="token class-name">StaffType</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>静态map索引</li></ul> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 构建了一个枚举索引
 */</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">StaffType</span><span class="token punctuation">&gt;</span></span> typeIndex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span> <span class="token class-name">StaffType</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">static</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">StaffType</span> value <span class="token operator">:</span> <span class="token class-name">StaffType</span><span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        typeIndex<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">StaffType</span> <span class="token function">enumFind</span><span class="token punctuation">(</span><span class="token class-name">String</span> type<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 静态map索引，只有一次遍历过程,其缺点是map中没有对应索引时可能返回null从而导致空指针异常</span>
    <span class="token keyword">return</span> typeIndex<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>使用开源工具 Google Guava Enums</li></ul> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">StaffType</span> <span class="token function">enumFind</span><span class="token punctuation">(</span><span class="token class-name">String</span> type<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token class-name">Enums</span><span class="token punctuation">.</span><span class="token function">getIfPresent</span><span class="token punctuation">(</span><span class="token class-name">StaffType</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>type<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>以上四种方式均可解决枚举值的获取中可能出现的异常，具体使用那种方案因地适宜。</p> 
<h3><a id="7tryfinally_852"></a>7、解决try…finally的资源泄露隐患</h3> 
<blockquote> 
 <p><strong>什么是资源泄露?</strong></p> 
</blockquote> 
<ul><li>资源释放：打开了资源，使用完之后手动释放（正常关闭了资源，不会泄露）</li><li>资源泄露：打开了资源，是用完之后由于某种原因（忘记，或者出现异常等）没有手动释放资源</li></ul> 
<p>如果发生了资源泄露，会影响到程序的运行效率与内存空间的浪费。那我们的开发中如何保证资源的关闭呢？先来看几个常见案例</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">traditionalTryCatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1、 单一资源的关闭</span>
    <span class="token class-name">String</span> line <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">BufferedReader</span> bufferedReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileReader</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        line <span class="token operator">=</span> bufferedReader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//对于单一资源</span>
        bufferedReader<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> line<span class="token punctuation">;</span>
    
    <span class="token comment">// 2、 多个资源的关闭</span>
    <span class="token comment">// 第一个资源</span>
    <span class="token class-name">FileInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span><span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 第二个资源</span>
        <span class="token class-name">FileOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> n<span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 关闭第二个资源</span>
            out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 关闭第一个资源，顺序不能错，若顺序有错会导致IO异常，需要按照资源打开顺序的逆序进行关闭</span>
        in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>上面这个案例中咱们做了两个小demo，分别是关闭单一资源与关闭多资源的demo，从案例中就可以看出，在单一资源的关闭案例中，由于<code>finally</code>的存在，在系统不出错的前提下，我们使用的资源会被确保关闭，但在多资源情况下，我们还额外的需要注意资源关闭的顺序，且多资源情况下的<code>try...finally</code>多层嵌套，会显得代码非常的冗余，阅读体验极差，而且此处还有**一个需要注意的问题，就是在try中可能会发生异常，但finally中也可能因为某些原因发生异常，此时finally中的异常就会覆盖掉之前try中的异常，导致异常在排查的过程中十分困难。**咱们看看如何覆盖的</p> 
<p>先自定义一个咱们自己的异常<code>MyException</code></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyException</span> <span class="token keyword">extends</span> <span class="token class-name">Exception</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">MyException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token class-name">MyException</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>再定义一个自动关闭的类来抛出异常</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AutoClose</span> <span class="token keyword">implements</span> <span class="token class-name">AutoCloseable</span><span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt;&gt;调用close()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"close()方法异常"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MyException</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"&gt;&gt;&gt;&gt;调用work()"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">MyException</span><span class="token punctuation">(</span><span class="token string">"work()方法异常"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>最后使用main方法调用一下看看结果</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MyException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">AutoClose</span> autoClose <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AutoClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//先运行work让他抛出异常</span>
        autoClose<span class="token punctuation">.</span><span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//再运行close让他抛出异常</span>
        autoClose<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token operator">&gt;&gt;&gt;</span><span class="token operator">&gt;</span>调用<span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;&gt;</span><span class="token operator">&gt;</span>调用<span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token class-name">Exception</span> in thread <span class="token string">"main"</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>RuntimeException</span><span class="token operator">:</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>方法异常
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span>ty_with_resources<span class="token punctuation">.</span></span>AutoClose</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">AutoClose</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">11</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span>ty_with_resources<span class="token punctuation">.</span></span>Main</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">Main</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">78</span><span class="token punctuation">)</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">1</span>
</code></pre> 
<p>根据上述案例与结果我们可以看出，方法正常启动并按顺序调用了<code>work()</code>与<code>close()</code>两个方法，但最终抛出的异常只有close的异常，而work的异常就被覆盖掉了。对于<code>try...finally</code>我们做出如下总结：</p> 
<ul><li>对单个资源的操作基本不会用问题，出现异常的概率较低</li><li>当多个资源同时被操作的时候，代码会变得冗长，且存在资源泄露的风险</li><li>多个异常情况下可能存在异常的覆盖，导致我们的调试工作变得更加困难</li></ul> 
<p><strong>改进方案：使用<code>tyr-with-resources</code>语法来代替<code>try-finally</code>,更加方便且更不容易出错，具体案例如下：</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">newTryWithResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 1、 单个资源的使用与关闭</span>
    <span class="token comment">/*try(BufferedReader bufferedReader = new BufferedReader(new FileReader(""))){
        return bufferedReader.readLine();
    }*/</span>
    
    <span class="token comment">// 2、 多个资源的使用与关闭</span>
    <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">FileInputStream</span> in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//第一个资源</span>
         <span class="token class-name">FileOutputStream</span> out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token comment">//第二个资源</span>
    <span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> n<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>n <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>将代码改造成上面的样子后，我们可以发现，我么将资源的开启放在的<code>tyr()</code>的括号中，而资源的使用放在了大括号中，这样在资源使用完毕后，程序会自动的将资源关闭，不需要我们手动关闭，这样避免了代码的冗余，也避免了资源关闭顺序错误而导致异常，此外对于异常覆盖的问题，我们看看下面的案例：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">MyException</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span><span class="token punctuation">(</span><span class="token class-name">AutoClose</span> autoClose <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AutoClose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        autoClose<span class="token punctuation">.</span><span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token operator">&gt;&gt;&gt;</span><span class="token operator">&gt;</span>调用<span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;&gt;</span><span class="token operator">&gt;</span>调用<span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token class-name">Exception</span> in thread <span class="token string">"main"</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span>ty_with_resources<span class="token punctuation">.</span></span>MyException</span><span class="token operator">:</span> <span class="token function">work</span><span class="token punctuation">(</span><span class="token punctuation">)</span>方法异常
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span>ty_with_resources<span class="token punctuation">.</span></span>AutoClose</span><span class="token punctuation">.</span><span class="token function">work</span><span class="token punctuation">(</span><span class="token class-name">AutoClose</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">16</span><span class="token punctuation">)</span>
	at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span>ty_with_resources<span class="token punctuation">.</span></span>Main</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">Main</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">81</span><span class="token punctuation">)</span>
	<span class="token class-name">Suppressed</span><span class="token operator">:</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>RuntimeException</span><span class="token operator">:</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>方法异常
		at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span>ty_with_resources<span class="token punctuation">.</span></span>AutoClose</span><span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token class-name">AutoClose</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">11</span><span class="token punctuation">)</span>
		at <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>wyf<span class="token punctuation">.</span>escape<span class="token punctuation">.</span>ty_with_resources<span class="token punctuation">.</span></span>Main</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">Main</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">82</span><span class="token punctuation">)</span>

<span class="token class-name">Process</span> finished <span class="token keyword">with</span> <span class="token namespace">exit</span> code <span class="token number">1</span>
</code></pre> 
<p>很明显的，我们的代码调用变得更加简洁，且调用的顺序也不曾改变，符合我们的预期，最主要的是，我们的方法主体<code>work()</code>抛出的异常没有被自动调用的<code>close()</code>方法抛出的异常给覆盖掉，这让我们在代码的debug过程中可以更加准确的定位到问题所在！</p> 
<p>PS:以上笔记根据慕课网《给java开发者的实操避坑指南》课程学习记录，图片是从自己的代码案例与视频中截取，如有侵权请联系作者删除，如需转载使用请标明出处，<img src="https://images2.imgbox.com/86/6d/cvYNHtlc_o.jpg" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a4d5dda53ccc030df54cca8ab8eb71d0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">[C&#43;&#43;&amp;Rust]LeetCode No.525 连续数组(每日一题)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2d3d23b02f01c9fdcdbc2367bf346ff3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">KVM虚拟化技术（二）之创建虚拟机（命令行方式）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>