<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>邮件收发原理及部署postfix邮件系统 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="邮件收发原理及部署postfix邮件系统" />
<meta property="og:description" content="目录
一、邮件收发原理
1、原理图及名词解释
2、MTA功能介绍
3、POP和IMAP获取邮件介绍
二、部署postfix邮件系统
1、环境准备
2、DNS服务器部署
3、部署Postfix
4、部署Dovecot
三、使用Foxmail测试
1、修改DNS服务器
2、Foxmail登录测试账户
3、发送测试邮件 4、 服务端查看邮件
一、邮件收发原理 1、原理图及名词解释 MUA(Mail User Agent)：邮件用户代理，例如常见的Foxmail、网易客户端等。
MTA(Mail Transfer Agent)：英特网邮件传输代理，转发来自MUA的信件给指定的用户的程序。
MX(Mail Exchanger)：DNS中的邮件交换记录指向一个邮件服务器。
POP(Post Office Protocol)：邮局协议，即用户从SMTP存储中将邮件下载到本地。
IMAP(Internet Mail Access Protocol)：邮件访问协议，用户在线在SMTP存储中查看邮件等信息。
sent/receive：表示发送和收件的用户
2、MTA功能介绍 ①邮件传输：MTA邮件服务器负责接收、传输和投递电子邮件。
②邮件路由：MTA邮件服务器通过设置邮件传输规则和路由策略，将电子邮件从发送方传递到接收方。
③邮件排队和重试：MTA邮件服务器会将电子邮件放入队列中进行排队，以便在传输过程中遇到问题时重新尝试投递。
④邮件安全：MTA邮件服务器可以应用各种邮件安全机制，如加密、验证和防垃圾邮件（SPAM）过滤等。它可以使用加密协议（如TLS/SSL）来保护邮件的传输安全性。
⑤邮件管理和监控：MTA邮件服务器提供管理和监控功能，使管理员能够监视邮件传输状态、调整服务器配置和策略，管理用户帐户和邮件存储等。管理员可以跟踪邮件传递的流程，检查错误日志和排查故障，确保邮件系统的正常运行。
3、POP和IMAP获取邮件介绍 ①邮件存储位置：使用POP时邮件通常会从邮件服务器上下载到本地并在服务器上删除、而使用IMAP时邮件保留在服务器上本地设备只保留邮件的副本。
②邮件同步：由于POP将邮件下载到本地所以设备查看时不会同步状态(已读/未读)、IMAP可以与服务器保持同步，无论那个设备上查看邮件都会同步状态。
③邮件使用：POP下载到本地后无需网络即可查看邮件、IMAP需要网络连接访问服务器上的邮件。
④邮件管理：POP管理邮件的功能相对较少、IMAP可以在服务器创建删除移动文件夹管理邮件。
二、部署postfix邮件系统 1、环境准备 主机名操作系统IP地址安装程序作用mail-servercentos7.6192.168.30.20named、postfix、dovecotDNS服务器及邮件服务器windows10windows10192.168.30.200Foxmail客户端测试邮件功能 2、DNS服务器部署 mail-server执行： hostnamectl set-hostname mail-server #修改主机名 systemctl stop firewalld setenforce 0 iptables -F #关闭firewalld、selinux清空iptables规则 yum install bind -y #安装bind服务器提供DNS服务 vim /etc/name.conf options{ listen-on port 53 { any; }; ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/7bc25d590e988dd6ab5a1d102e09d0cd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-07T14:45:45+08:00" />
<meta property="article:modified_time" content="2023-07-07T14:45:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">邮件收发原理及部署postfix邮件系统</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80%E3%80%81%E9%82%AE%E4%BB%B6%E6%94%B6%E5%8F%91%E5%8E%9F%E7%90%86-toc" style="margin-left:40px;"><a href="#%E4%B8%80%E3%80%81%E9%82%AE%E4%BB%B6%E6%94%B6%E5%8F%91%E5%8E%9F%E7%90%86" rel="nofollow">一、邮件收发原理</a></p> 
<p id="1%E3%80%81%E5%8E%9F%E7%90%86%E5%9B%BE%E5%8F%8A%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E5%8E%9F%E7%90%86%E5%9B%BE%E5%8F%8A%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A" rel="nofollow">1、原理图及名词解释</a></p> 
<p id="2%E3%80%81MTA%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D-toc" style="margin-left:80px;"><a href="#2%E3%80%81MTA%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D" rel="nofollow">2、MTA功能介绍</a></p> 
<p id="3%E3%80%81POP%E5%92%8CIMAP%E8%8E%B7%E5%8F%96%E9%82%AE%E4%BB%B6%E4%BB%8B%E7%BB%8D-toc" style="margin-left:80px;"><a href="#3%E3%80%81POP%E5%92%8CIMAP%E8%8E%B7%E5%8F%96%E9%82%AE%E4%BB%B6%E4%BB%8B%E7%BB%8D" rel="nofollow">3、POP和IMAP获取邮件介绍</a></p> 
<p id="%E4%BA%8C%E3%80%81%E9%83%A8%E7%BD%B2postfix%E9%82%AE%E4%BB%B6%E7%B3%BB%E7%BB%9F-toc" style="margin-left:40px;"><a href="#%E4%BA%8C%E3%80%81%E9%83%A8%E7%BD%B2postfix%E9%82%AE%E4%BB%B6%E7%B3%BB%E7%BB%9F" rel="nofollow">二、部署postfix邮件系统</a></p> 
<p id="1%E3%80%81%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87" rel="nofollow">1、环境准备</a></p> 
<p id="2%E3%80%81DNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2-toc" style="margin-left:80px;"><a href="#2%E3%80%81DNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2" rel="nofollow">2、DNS服务器部署</a></p> 
<p id="3%E3%80%81%E9%83%A8%E7%BD%B2Postfix-toc" style="margin-left:80px;"><a href="#3%E3%80%81%E9%83%A8%E7%BD%B2Postfix" rel="nofollow">3、部署Postfix</a></p> 
<p id="4%E3%80%81%E9%83%A8%E7%BD%B2Dovecot-toc" style="margin-left:80px;"><a href="#4%E3%80%81%E9%83%A8%E7%BD%B2Dovecot" rel="nofollow">4、部署Dovecot</a></p> 
<p id="5%E3%80%81%E4%BD%BF%E7%94%A8Foxmail%E6%B5%8B%E8%AF%95-toc" style="margin-left:40px;"><a href="#5%E3%80%81%E4%BD%BF%E7%94%A8Foxmail%E6%B5%8B%E8%AF%95" rel="nofollow">三、使用Foxmail测试</a></p> 
<p id="1%E3%80%81%E4%BF%AE%E6%94%B9DNS%E6%9C%8D%E5%8A%A1%E5%99%A8-toc" style="margin-left:80px;"><a href="#1%E3%80%81%E4%BF%AE%E6%94%B9DNS%E6%9C%8D%E5%8A%A1%E5%99%A8" rel="nofollow">1、修改DNS服务器</a></p> 
<p id="2%E3%80%81Foxmail%E7%99%BB%E5%BD%95%E6%B5%8B%E8%AF%95%E8%B4%A6%E6%88%B7-toc" style="margin-left:80px;"><a href="#2%E3%80%81Foxmail%E7%99%BB%E5%BD%95%E6%B5%8B%E8%AF%95%E8%B4%A6%E6%88%B7" rel="nofollow">2、Foxmail登录测试账户</a></p> 
<p id="3%E3%80%81%E5%8F%91%E9%80%81%E6%B5%8B%E8%AF%95%E9%82%AE%E4%BB%B6%C2%A0-toc" style="margin-left:80px;"><a href="#3%E3%80%81%E5%8F%91%E9%80%81%E6%B5%8B%E8%AF%95%E9%82%AE%E4%BB%B6%C2%A0" rel="nofollow">3、发送测试邮件 </a></p> 
<p id="4%E3%80%81%20%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%9F%A5%E7%9C%8B%E9%82%AE%E4%BB%B6-toc" style="margin-left:80px;"><a href="#4%E3%80%81%20%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%9F%A5%E7%9C%8B%E9%82%AE%E4%BB%B6" rel="nofollow">4、 服务端查看邮件</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h3 id="%E4%B8%80%E3%80%81%E9%82%AE%E4%BB%B6%E6%94%B6%E5%8F%91%E5%8E%9F%E7%90%86">一、邮件收发原理</h3> 
<h4 id="1%E3%80%81%E5%8E%9F%E7%90%86%E5%9B%BE%E5%8F%8A%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A">1、原理图及名词解释</h4> 
<p><img alt="" height="681" src="https://images2.imgbox.com/c9/41/MYMx4dSH_o.png" width="1016"></p> 
<p>MUA(Mail User Agent)：邮件用户代理，例如常见的Foxmail、网易客户端等。</p> 
<p>MTA(Mail Transfer Agent)：英特网邮件传输代理，转发来自MUA的信件给指定的用户的程序。</p> 
<p>MX(Mail Exchanger)：DNS中的邮件交换记录指向一个邮件服务器。</p> 
<p>POP(Post Office Protocol)：邮局协议，即用户从SMTP存储中将邮件下载到本地。</p> 
<p>IMAP(Internet Mail Access Protocol)：邮件访问协议，用户在线在SMTP存储中查看邮件等信息。</p> 
<p>sent/receive：表示发送和收件的用户</p> 
<h4 id="2%E3%80%81MTA%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D">2、MTA功能介绍</h4> 
<p>①邮件传输：MTA邮件服务器负责接收、传输和投递电子邮件。</p> 
<p>②邮件路由：MTA邮件服务器通过设置邮件传输规则和路由策略，将电子邮件从发送方传递到接收方。</p> 
<p>③邮件排队和重试：MTA邮件服务器会将电子邮件放入队列中进行排队，以便在传输过程中遇到问题时重新尝试投递。</p> 
<p>④邮件安全：MTA邮件服务器可以应用各种邮件安全机制，如加密、验证和防垃圾邮件（SPAM）过滤等。它可以使用加密协议（如TLS/SSL）来保护邮件的传输安全性。</p> 
<p>⑤邮件管理和监控：MTA邮件服务器提供管理和监控功能，使管理员能够监视邮件传输状态、调整服务器配置和策略，管理用户帐户和邮件存储等。管理员可以跟踪邮件传递的流程，检查错误日志和排查故障，确保邮件系统的正常运行。</p> 
<h4 id="3%E3%80%81POP%E5%92%8CIMAP%E8%8E%B7%E5%8F%96%E9%82%AE%E4%BB%B6%E4%BB%8B%E7%BB%8D">3、POP和IMAP获取邮件介绍</h4> 
<p>①邮件存储位置：使用POP时邮件通常会从邮件服务器上下载到本地并在服务器上删除、而使用IMAP时邮件保留在服务器上本地设备只保留邮件的副本。</p> 
<p>②邮件同步：由于POP将邮件下载到本地所以设备查看时不会同步状态(已读/未读)、IMAP可以与服务器保持同步，无论那个设备上查看邮件都会同步状态。</p> 
<p>③邮件使用：POP下载到本地后无需网络即可查看邮件、IMAP需要网络连接访问服务器上的邮件。</p> 
<p>④邮件管理：POP管理邮件的功能相对较少、IMAP可以在服务器创建删除移动文件夹管理邮件。</p> 
<h3 id="%E4%BA%8C%E3%80%81%E9%83%A8%E7%BD%B2postfix%E9%82%AE%E4%BB%B6%E7%B3%BB%E7%BB%9F">二、部署postfix邮件系统</h3> 
<h4 id="1%E3%80%81%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87">1、环境准备</h4> 
<table cellspacing="0" style="width:451.23pt;"><tbody><tr><td style="background-color:#4f81bd;vertical-align:middle;width:70.2pt;"><span style="color:#ffffff;"><strong>主机名</strong></span></td><td style="background-color:#4f81bd;vertical-align:middle;width:58.2pt;"><span style="color:#ffffff;"><strong>操作系统</strong></span></td><td style="background-color:#4f81bd;vertical-align:middle;width:78.6pt;"><span style="color:#ffffff;"><strong>IP地址</strong></span></td><td style="background-color:#4f81bd;vertical-align:middle;width:127.2pt;"><span style="color:#ffffff;"><strong>安装程序</strong></span></td><td style="background-color:#4f81bd;vertical-align:middle;width:117pt;"><span style="color:#ffffff;"><strong>作用</strong></span></td></tr><tr><td style="vertical-align:middle;"><span style="color:#000000;">mail-server</span></td><td style="vertical-align:middle;"><span style="color:#000000;">centos7.6</span></td><td style="vertical-align:middle;"><span style="color:#000000;">192.168.30.20</span></td><td style="vertical-align:middle;"><span style="color:#000000;">named、postfix、dovecot</span></td><td style="vertical-align:middle;"><span style="color:#000000;">DNS服务器及邮件服务器</span></td></tr><tr><td style="vertical-align:middle;"><span style="color:#000000;">windows10</span></td><td style="vertical-align:middle;"><span style="color:#000000;">windows10</span></td><td style="vertical-align:middle;"><span style="color:#000000;">192.168.30.200</span></td><td style="vertical-align:middle;"><span style="color:#000000;">Foxmail客户端</span></td><td style="vertical-align:middle;"><span style="color:#000000;">测试邮件功能</span></td></tr></tbody></table> 
<h4 id="2%E3%80%81DNS%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%83%A8%E7%BD%B2">2、DNS服务器部署</h4> 
<pre><code>mail-server执行：
hostnamectl set-hostname mail-server
#修改主机名
systemctl stop firewalld
setenforce 0
iptables -F
#关闭firewalld、selinux清空iptables规则
yum  install bind  -y
#安装bind服务器提供DNS服务
vim /etc/name.conf
options{
listen-on port 53 { any; };
....
allow-query     { any; };
}
#修改DNS服务器配置文件，地址为any和修改允许所有人查询,修改内容如上保存退出
vim  /etc/name.named.rfc1912.zones
zone "lhj.com" IN {
        type master;
        file "lhj.com.zone";
        allow-update { none; };
};
#修改区域配置文件，在末尾添加以上内容。lhj.com为域名，lhj.com.zone为指定的域名数据文件
cd /var/named/
cp -a name.localhost  lhj.com.zone
#拷贝域名数据文件模板并命名为区域配置文件指定的名称进行修改
vim  lhj.com.zone

$TTL 1D
@       IN SOA  lhj.com. rname.invalid. (
                                        0       ; serial
                                        1D      ; refresh
                                        1H      ; retry
                                        1W      ; expire
                                        3H )    ; minimum
        NS      ns.lhj.com.
ns   IN A 192.168.30.20
@    IN MX 10 mail.lhj.com.
mail IN A 192.168.30.20
www  IN A 192.168.30.102
        A       127.0.0.1
        AAAA    ::1
#修改内容如上，mail地址指向postfixip地址、MX指向postfix域名、www测试地址
systemctl restart named
#重启named服务
vim  /etc/resolv.conf
#添加本机DNS服务器地址到resolv.conf文件首行
nameserver  192.168.30.20

nslookup  mail.lhj.com
#测试解析mail.lhj.com域名地址是否为192.168.30.20搭建DNS服务器完成
</code></pre> 
<p><img alt="" height="733" src="https://images2.imgbox.com/67/0c/soIGT8X7_o.png" width="1022"></p> 
<h4 id="3%E3%80%81%E9%83%A8%E7%BD%B2Postfix">3、部署Postfix</h4> 
<pre><code>mail-server执行：
yum -y install postfix
#安装postfix服务
vim /etc/postfix/main.cf
#编辑主配置文件搜索关键字修改以下内容
myhostname = mail.lhj.com 
#用来保存服务器的主机名称
mydomain = lhj.com 
#用来保存邮件域的名称
myorigin = $mydomain 
#定义发出邮件的域
inet_interfaces = all 
#定义网卡监听地址
mydestination = $myhostname, $mydomain 
#定义可接收邮件的主机名或域名列表
systemctl restart postfix
#重启postfix服务器使得配置生效
useradd test1
useradd test2
echo "123456" | passwd --stdin test1
echo "123456" | passwd --stdin test2
#创建2个测试用户并设置密码为123456
</code></pre> 
<h4 id="4%E3%80%81%E9%83%A8%E7%BD%B2Dovecot">4、部署Dovecot</h4> 
<pre><code>mail-server执行：
dovecot：开源的pop、imap邮件服务器
yum -y install dovecot
#安装 Dovecot 服务程序软件包
vim /etc/dovecot/dovecot.conf
#修改dovecot主配置文件
protocols = imap pop3 lmtp
#支持的协议包括：imap pop3 lmtp三种
disable_plaintext_auth = no
#关闭认证
vim /etc/dovecot/conf.d/10-mail.conf
#配置邮件格式及存储位置
mail_location = mbox:~/mail:INBOX=/var/mail/%u
#此行去掉注释，存储位置为用户家目录下home/test2/mail/.imap/INBOX下为日志和cache，以及/var/mail/用户名下为邮件内容
mkdir -p /home/test1/mail/.imap/INBOX
mkdir -p /home/test2/mail/.imap/INBOX
#为test1和test2用户创建保存邮件的目录</code></pre> 
<h3 id="5%E3%80%81%E4%BD%BF%E7%94%A8Foxmail%E6%B5%8B%E8%AF%95">三、使用Foxmail测试</h3> 
<h4 id="1%E3%80%81%E4%BF%AE%E6%94%B9DNS%E6%9C%8D%E5%8A%A1%E5%99%A8">1、修改DNS服务器</h4> 
<p>修改windows的DNS为本次部署的DNS服务器地址即192.168.30.20 </p> 
<p class="img-center"><img alt="" height="561" src="https://images2.imgbox.com/a5/fd/tnVd9xOg_o.png" width="427"></p> 
<h4 id="2%E3%80%81Foxmail%E7%99%BB%E5%BD%95%E6%B5%8B%E8%AF%95%E8%B4%A6%E6%88%B7">2、Foxmail登录测试账户</h4> 
<p class="img-center"><img alt="" height="609" src="https://images2.imgbox.com/79/ca/nylWLQ79_o.png" width="462"></p> 
<p class="img-center"><img alt="" height="462" src="https://images2.imgbox.com/bd/88/YBxcl0tF_o.png" width="472"></p> 
<p class="img-center"><img alt="" height="466" src="https://images2.imgbox.com/89/3a/EH6ksWF0_o.png" width="469"></p> 
<p class="img-center"><img alt="" height="467" src="https://images2.imgbox.com/97/b7/YPfEiNEW_o.png" width="469"></p> 
<h4 id="3%E3%80%81%E5%8F%91%E9%80%81%E6%B5%8B%E8%AF%95%E9%82%AE%E4%BB%B6%C2%A0">3、发送测试邮件 </h4> 
<p><img alt="" height="618" src="https://images2.imgbox.com/d1/c5/7QRiPoAi_o.png" width="1080"></p> 
<p><img alt="" height="383" src="https://images2.imgbox.com/71/ea/7xVdZgR6_o.png" width="1084"></p> 
<h4 id="4%E3%80%81%20%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%9F%A5%E7%9C%8B%E9%82%AE%E4%BB%B6">4、 服务端查看邮件</h4> 
<p><img alt="" height="576" src="https://images2.imgbox.com/78/9d/wilEi8gc_o.png" width="908"></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cf789744590610cc02c25cc526fa77b8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Flutter最强大的图表库fl_chart的使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/00061030b2b4ec79c51d218ed195150f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">在工作表中调用Python自定义函数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>