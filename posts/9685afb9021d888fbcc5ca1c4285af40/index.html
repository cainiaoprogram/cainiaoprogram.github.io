<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>8.1、网络地址转换 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="8.1、网络地址转换" />
<meta property="og:description" content=" 8.1、网络地址转换 前言 随着Internet的发展和网络应用的增多，IPv4地址枯竭已经成为制约网络发展的瓶颈。尽快IPv6可以从根本上解决IPv4地址空间不足的问题，但目前众多的网络设备和网络应用仍是基于IPv4的，因此在IPv6广泛应用之前，一些过渡技术的使用是解决这个问题的主要技术手段。网络地址转换技术NAT（Network Address Translation）主要用于实现位于内部网络的主机访问外部网络的功能。当局域网内的主机需要访问外部网络时，通过NAT技术可以将其私网地址转换为公网地址，并且多个私网用户可以共用一个公网地址，这样既可保证网络互通，又节省了公网地址NAT应用场景 企业或家庭所使用的的网络为私有网络，使用的是私有地址；运营商维护的网络为公共网络，使用的是公有地址。私有地址不能在公网中路由NAT一般部署在连接内网和外网的网关设备上静态NAT 静态NAT实现了私有地址和公有地址的一对一映射一个公网IP只会分配给唯一且固定的内网主机静态NAT数据访问步骤 主机A→主机C 主机A想要访问位于公网的100.1.1.1/24的地址主机A发送报文 源地址：192.168.1.1目的地址：100.1.1.1由于192.168.1.1是一个私网地址，是不能访问公网的。私网地址不能在公网中进行路由RTA收到主机A的数据包，RTA对私有地址和公有地址进行一对一的映射，并且在RTA中形成一个映射表。 原地址：192.168.1.1映射地址：200.10.10.1RTA通过映射表将私有地址映射成公网地址，然后进行路由到达主机C主机C→主机A 主机C的数据包到达RTA时，也通过映射将公网地址转换成私网地址，然后去访问主机A动态NAT 动态NAT基于地址池来实现私有地址和公有地址的转换动态NAT转换步骤 动态NAT会在RTA上，在NAT服务器上配置一个地址池当内网主机去访问外网主机时，网关RTA会从公网地址池中选择一个没有使用的公网地址，与收到的数据包完成映射地址池 地址池选择地址的方式是随机的，只要是未使用的，空闲状态下的地址即可当对应的地址不需要此链接时，对应的地址映射就会被删除，公网地址就会回到地址池中待定当地址池中的地址用尽以后，我们只能去进行等待，等待公有的地址被释放以后，才能再次使用该地址去访问公网NAPT 网络地址端口转换NAPT允许多个内部地址映射到同一个公有地址的不同端口 主要通过端口进行区分访问步骤 内网主机向外网主机发送一个报文 源IP地址：192.16.1.1：1025目的IP地址：200.10.10.1：2843RTA收到数据包以后，通过内网地址池选择一个空闲的公网地址加端口号来建立表项，然后即可访问外网地址外网地址访问内网地址时，通过RTA中的NAT列表重新将公网地址映射成私网地址，然后发送给主机AEasy IP Easy IP允许将多个内部地址映射到网关出接口地址上的不同端口Easy IP主要是适用于小规模的局域网当中NAPT和EasyIP 因为NAPT是通过设置地址池Easy IP是通过向公网申请获取一个临时的公网地址，然后进行分配访问步骤 内网地址想要访问外网地址 报文 源IP地址：192.168.1.1：1025目的IP地址：100.1.1.1：80RTA收到数据包后，会建立一个Easy IP的表项，表项中源IP地址和端口号和出接口的公网IP地址形成映射，然后将报文的源IP地址和端口号转换成出接口的源IP地址和端口号。RTA将映射后的报文转发到公网上公网地址访问内网地址时，路由器收到回复报文也会查找Easy IP表项，路由表通过该表项将报文的目的地址和端口号转换成私网的源地址和端口号NAT服务器 通过配置NAT服务器，可以使外网用户访问内网服务器使用NAT技术时，内网用户是可以访问公网用户的。但是默认屏蔽了公网用户不能访问内网用户的需求 公网访问内网也是我们的一种需求，而NAT服务器可以实现这个需求。 实际过程中，上网时我们可以访问运营商，运营商其实也可以访问我们。如果不能访问我们，我们就无法进行下载数据但是我们需要将配置服务器的私网IP地址和端口号，转换成公网IP地址发布出去访问步骤 外网主机想要访问私网服务器，发送一个数据包 目的IP地址：200.10.10.1：80源IP地址：100.1.1.1：2844RTA收到此报文会查找地址转换表项，然后将目的地址进行转换 因为我们已经配置好私网IP地址转换为公网IP地址。回复报文时直接转换即可RTA转换完成后将数据转发到服务器上静态NAT配置 1、进入接口，配置地址。保证底层的连通性2、进入串口配置地址 1、配置IP地址2、手动配置外部公网地址和内部地址的映射表配置验证 可以看到公网地址和私网地址分别的映射关系动态NAT配置 配置步骤 1、首先配置一个NAT组 NAT组的名字是1地址池是200.10.10.1~200.10.10.2002、配置一个ACL 允许通过的地址是192.168.1.0网段3、进入RTA外部接口配置NAT 只要是被ACL匹配的网段的IP地址都会被映射成地址池的地址，然后转发出去配置验证 可以查看到地址池和ACL匹配的规则Easy IP配置 Easy IP也是通过ACL匹配来进行的配置步骤 1、创建一个ACL 规则是可以匹配到192.168.1.0网段2、RTA的外部接口配置NAT 只要是符合ACL允许的网段的就可以进行地址转换配置验证 可以查看到匹配规则和地址池 NAT服务器配置 配置步骤 1、RTA内部接口和外部接口配置IP地址2、手动指定NAT服务器协议 TCP的公网地址和私网地址的映射关系配置完成后外部用户就可以通过公网地址和端口来访问内部服务器配置验证 可以查看到公网和私网IP地址的映射关系本章总结 那种NAT转换允许服务器既能被内部访问又能被外部访问? 通过内部访问外部，我们现在学习的方法都可以通过外部访问内部 配置NAT服务器NAPT有什么功能和特点？ NAPT主要是基于端口的转换，允许多个内部地址映射到同一个公有地址不同端口上 实际上不是基于IP地址的转换，是基于端口的转换 " />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9685afb9021d888fbcc5ca1c4285af40/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-09T09:47:11+08:00" />
<meta property="article:modified_time" content="2020-07-09T09:47:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">8.1、网络地址转换</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div> 
 <div style="margin-left:0in;"> 
  <div style="margin-left:0in;"> 
   <h2 style="margin-left:0in;"><span style="color:#1e4e79;">8.1、网络地址转换</span></h2> 
   <ul style="margin-left:.375in;"><li>前言 
     <ul style="margin-left:.375in;"><li>随着Internet的发展和网络应用的增多，IPv4地址枯竭已经成为制约网络发展的瓶颈。尽快IPv6可以从根本上解决IPv4地址空间不足的问题，但目前众多的网络设备和网络应用仍是基于IPv4的，因此在IPv6广泛应用之前，一些过渡技术的使用是解决这个问题的主要技术手段。</li><li>网络地址转换技术NAT（Network Address Translation）主要用于实现位于内部网络的主机访问外部网络的功能。当局域网内的主机需要访问外部网络时，通过NAT技术可以将其私网地址转换为公网地址，并且多个私网用户可以共用一个公网地址，这样既可保证网络互通，又节省了公网地址</li></ul></li><li>NAT应用场景 
     <ul style="margin-left:.375in;"><li><img alt="" height="533" src="https://images2.imgbox.com/f2/38/feKjUUs4_o.png" width="1200"></li><li>企业或家庭所使用的的网络为私有网络，使用的是私有地址；运营商维护的网络为公共网络，使用的是公有地址。私有地址不能在公网中路由</li><li>NAT一般部署在连接内网和外网的网关设备上</li></ul></li><li>静态NAT 
     <ul style="margin-left:.375in;"><li><img alt="" height="579" src="https://images2.imgbox.com/21/a9/EDdifUJU_o.png" width="1200"></li><li>静态NAT实现了私有地址和公有地址的一对一映射</li><li>一个公网IP只会分配给唯一且固定的内网主机</li><li>静态NAT数据访问步骤 
       <ul style="margin-left:.375in;"><li>主机A→主机C 
         <ul style="margin-left:.375in;"><li>主机A想要访问位于公网的100.1.1.1/24的地址</li><li>主机A发送报文 
           <ul style="margin-left:.375in;"><li>源地址：192.168.1.1</li><li>目的地址：100.1.1.1</li></ul></li><li>由于192.168.1.1是一个私网地址，是不能访问公网的。私网地址不能在公网中进行路由</li><li>RTA收到主机A的数据包，RTA对私有地址和公有地址进行一对一的映射，并且在RTA中形成一个映射表。 
           <ul style="margin-left:.375in;"><li>原地址：192.168.1.1</li><li>映射地址：200.10.10.1</li></ul></li><li>RTA通过映射表将私有地址映射成公网地址，然后进行路由到达主机C</li></ul></li><li>主机C→主机A 
         <ul style="margin-left:.375in;"><li>主机C的数据包到达RTA时，也通过映射将公网地址转换成私网地址，然后去访问主机A</li></ul></li></ul></li></ul></li><li>动态NAT 
     <ul style="margin-left:.375in;"><li><img alt="" height="649" src="https://images2.imgbox.com/72/aa/Cslzrbgm_o.png" width="1200"></li><li>动态NAT基于地址池来实现私有地址和公有地址的转换</li><li>动态NAT转换步骤 
       <ul style="margin-left:.375in;"><li>动态NAT会在RTA上，在NAT服务器上配置一个地址池</li><li>当内网主机去访问外网主机时，网关RTA会从公网地址池中选择一个没有使用的公网地址，与收到的数据包完成映射</li></ul></li><li>地址池 
       <ul style="margin-left:.375in;"><li>地址池选择地址的方式是随机的，只要是未使用的，空闲状态下的地址即可</li><li>当对应的地址不需要此链接时，对应的地址映射就会被删除，公网地址就会回到地址池中待定</li><li>当地址池中的地址用尽以后，我们只能去进行等待，等待公有的地址被释放以后，才能再次使用该地址去访问公网</li></ul></li></ul></li><li>NAPT 
     <ul style="margin-left:.375in;"><li><img alt="" height="653" src="https://images2.imgbox.com/6f/55/DDOpISjh_o.png" width="1200"></li><li>网络地址端口转换NAPT允许多个内部地址映射到同一个公有地址的不同端口 
       <ul style="margin-left:.375in;"><li>主要通过端口进行区分</li></ul></li><li>访问步骤 
       <ul style="margin-left:.375in;"><li>内网主机向外网主机发送一个报文 
         <ul style="margin-left:.375in;"><li>源IP地址：192.16.1.1：1025</li><li>目的IP地址：200.10.10.1：2843</li></ul></li><li>RTA收到数据包以后，通过内网地址池选择一个空闲的公网地址加端口号来建立表项，然后即可访问外网地址</li><li>外网地址访问内网地址时，通过RTA中的NAT列表重新将公网地址映射成私网地址，然后发送给主机A</li></ul></li></ul></li><li>Easy IP 
     <ul style="margin-left:.375in;"><li><img alt="" height="556" src="https://images2.imgbox.com/66/d2/CGoAZKVV_o.png" width="1200"></li><li>Easy IP允许将多个内部地址映射到网关出接口地址上的不同端口</li><li>Easy IP主要是适用于小规模的局域网当中</li><li>NAPT和EasyIP 
       <ul style="margin-left:.375in;"><li>因为NAPT是通过设置地址池</li><li>Easy IP是通过向公网申请获取一个临时的公网地址，然后进行分配</li></ul></li><li>访问步骤 
       <ul style="margin-left:.375in;"><li>内网地址想要访问外网地址 
         <ul style="margin-left:.375in;"><li>报文 
           <ul style="margin-left:.375in;"><li>源IP地址：192.168.1.1：1025</li><li>目的IP地址：100.1.1.1：80</li></ul></li></ul></li><li>RTA收到数据包后，会建立一个Easy IP的表项，表项中源IP地址和端口号和出接口的公网IP地址形成映射，然后将报文的源IP地址和端口号转换成出接口的源IP地址和端口号。</li><li>RTA将映射后的报文转发到公网上</li><li>公网地址访问内网地址时，路由器收到回复报文也会查找Easy IP表项，路由表通过该表项将报文的目的地址和端口号转换成私网的源地址和端口号</li></ul></li></ul></li><li>NAT服务器 
     <ul style="margin-left:.375in;"><li><img alt="" height="507" src="https://images2.imgbox.com/f3/ee/mVgPkyq6_o.png" width="1192"></li><li>通过配置NAT服务器，可以使外网用户访问内网服务器</li><li>使用NAT技术时，内网用户是可以访问公网用户的。但是默认屏蔽了公网用户不能访问内网用户的需求 
       <ul style="margin-left:.375in;"><li>公网访问内网也是我们的一种需求，而NAT服务器可以实现这个需求。 
         <ul style="margin-left:.375in;"><li>实际过程中，上网时我们可以访问运营商，运营商其实也可以访问我们。如果不能访问我们，我们就无法进行下载数据</li></ul></li><li>但是我们需要将配置服务器的私网IP地址和端口号，转换成公网IP地址发布出去</li></ul></li><li>访问步骤 
       <ul style="margin-left:.375in;"><li>外网主机想要访问私网服务器，发送一个数据包 
         <ul style="margin-left:.375in;"><li>目的IP地址：200.10.10.1：80</li><li>源IP地址：100.1.1.1：2844</li></ul></li><li>RTA收到此报文会查找地址转换表项，然后将目的地址进行转换 
         <ul style="margin-left:.375in;"><li>因为我们已经配置好私网IP地址转换为公网IP地址。回复报文时直接转换即可</li></ul></li><li>RTA转换完成后将数据转发到服务器上</li></ul></li></ul></li><li>静态NAT配置 
     <ul style="margin-left:.375in;"><li><img alt="" height="812" src="https://images2.imgbox.com/02/06/Wn4ApA0E_o.png" width="1200"></li><li>1、进入接口，配置地址。保证底层的连通性</li><li>2、进入串口配置地址 
       <ul style="margin-left:.375in;"><li>1、配置IP地址</li><li>2、手动配置外部公网地址和内部地址的映射表</li></ul></li></ul></li><li>配置验证 
     <ul style="margin-left:.375in;"><li><img alt="" height="602" src="https://images2.imgbox.com/d2/84/ZyeTYjkv_o.png" width="1200"></li><li>可以看到公网地址和私网地址分别的映射关系</li></ul></li><li>动态NAT配置 
     <ul style="margin-left:.375in;"><li><img alt="" height="790" src="https://images2.imgbox.com/ee/3c/KZ8ZEk4R_o.png" width="1200"></li><li>配置步骤 
       <ul style="margin-left:.375in;"><li>1、首先配置一个NAT组 
         <ul style="margin-left:.375in;"><li>NAT组的名字是1</li><li>地址池是200.10.10.1~200.10.10.200</li></ul></li><li>2、配置一个ACL 
         <ul style="margin-left:.375in;"><li>允许通过的地址是192.168.1.0网段</li></ul></li><li>3、进入RTA外部接口配置NAT 
         <ul style="margin-left:.375in;"><li>只要是被ACL匹配的网段的IP地址都会被映射成地址池的地址，然后转发出去</li></ul></li></ul></li></ul></li><li>配置验证 
     <ul style="margin-left:.375in;"><li><img alt="" height="728" src="https://images2.imgbox.com/4c/3a/iRDZZJKM_o.png" width="1171"></li><li>可以查看到地址池和ACL匹配的规则</li></ul></li><li>Easy IP配置 
     <ul style="margin-left:.375in;"><li><img alt="" height="739" src="https://images2.imgbox.com/31/dd/Yadwcywq_o.png" width="1200"></li><li>Easy IP也是通过ACL匹配来进行的</li><li>配置步骤 
       <ul style="margin-left:.375in;"><li>1、创建一个ACL 
         <ul style="margin-left:.375in;"><li>规则是可以匹配到192.168.1.0网段</li></ul></li><li>2、RTA的外部接口配置NAT 
         <ul style="margin-left:.375in;"><li>只要是符合ACL允许的网段的就可以进行地址转换</li></ul></li></ul></li></ul></li><li>配置验证 
     <ul style="margin-left:.375in;"><li><img alt="" height="426" src="https://images2.imgbox.com/e5/8f/CWkS33kk_o.png" width="1195"></li><li>可以查看到匹配规则和地址池</li></ul></li></ul> 
   <p style="margin-left:0in;"> </p> 
   <ul style="margin-left:.375in;"><li>NAT服务器配置 
     <ul style="margin-left:.375in;"><li><img alt="" height="703" src="https://images2.imgbox.com/55/86/LDXrkoG2_o.png" width="1200"></li><li>配置步骤 
       <ul style="margin-left:.375in;"><li>1、RTA内部接口和外部接口配置IP地址</li><li>2、手动指定NAT服务器协议 
         <ul style="margin-left:.375in;"><li>TCP的公网地址和私网地址的映射关系</li></ul></li><li>配置完成后外部用户就可以通过公网地址和端口来访问内部服务器</li></ul></li></ul></li><li>配置验证 
     <ul style="margin-left:.375in;"><li><img alt="" height="584" src="https://images2.imgbox.com/ed/fe/ajrD33m9_o.png" width="1195"></li><li>可以查看到公网和私网IP地址的映射关系</li></ul></li><li>本章总结 
     <ul style="margin-left:.375in;"><li>那种NAT转换允许服务器既能被内部访问又能被外部访问? 
       <ul style="margin-left:.375in;"><li>通过内部访问外部，我们现在学习的方法都可以</li><li>通过外部访问内部 
         <ul style="margin-left:.375in;"><li>配置NAT服务器</li></ul></li></ul></li><li>NAPT有什么功能和特点？ 
       <ul style="margin-left:.375in;"><li>NAPT主要是基于端口的转换，允许多个内部地址映射到同一个公有地址不同端口上 
         <ul style="margin-left:.375in;"><li>实际上不是基于IP地址的转换，是基于端口的转换</li></ul></li></ul></li></ul></li></ul> 
  </div> 
 </div> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/11143eb995c37fed62c8a0e88921c9ba/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">销售需求丨购物篮分析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5b22bb9d602aa5d0c60b4ad26408a4d1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C#文本框中KeyPress事件触发回车事件调用相关函数。</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>