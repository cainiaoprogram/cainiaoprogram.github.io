<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>深度学习中有关网络中的参数量(param)计算。附录有浮点计算量(FLOPs)的链接。 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="深度学习中有关网络中的参数量(param)计算。附录有浮点计算量(FLOPs)的链接。" />
<meta property="og:description" content="文章目录 网络中的参数量(param)和浮点计算量(FLOPs)的计算一、网络中的参数量(param)是什么？浮点计算量(FLOPs)是什么？二、如何计算网络中的参数量(param)网络中的参数量(param)的计算卷积层：计算公式： 池化层:全连接层:CONV-&gt;FC 及计算公式FC-&gt;FC 及计算公式 代码展示 附加：参数和模型显存\模型尺寸的关系总结及浮点计算量FLOPs的指引 网络中的参数量(param)和浮点计算量(FLOPs)的计算 可以在我都模板仓库的Utils文件夹中查看具体有关参数量(param)和浮点计算量(FLOPs)的计算代码。
一、网络中的参数量(param)是什么？浮点计算量(FLOPs)是什么？ 网络中的参数量（param）对应与空间Space概念，及空间复杂度。浮点计算量(FLOPs)对应与时间Time概念，对应于时间复杂度。 即，网络参数量（param）和显存密切相关；浮点计算量(FLOPs)和GPU的计算速度相关。
二、如何计算网络中的参数量(param) 网络中的参数量(param)的计算 网络中参数计算需要分为
卷积层： 需要关注的参数为(kernel_size,in_channel,out_channel)
计算公式： 完全版： c o n v _ p a r a m = ( k e r n e l _ s i z e ∗ i n _ c h a n n e l &#43; b i a s ) ∗ o u t _ c h a n n e l conv\_param = (kernel\_size*in\_channel&#43;bias)*out\_channel conv_param=(kernel_size∗in_channel&#43;bias)∗out_channel，默认 b i a s = 1 bias=1 bias=1，out_channel是filter(代表卷积核个数)，且每个卷积核都有对应的bias。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/116cac6d66624feb6037d2a8822255f9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-10T21:50:35+08:00" />
<meta property="article:modified_time" content="2022-12-10T21:50:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">深度学习中有关网络中的参数量(param)计算。附录有浮点计算量(FLOPs)的链接。</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#paramFLOPs_6" rel="nofollow">网络中的参数量(param)和浮点计算量(FLOPs)的计算</a></li><li><a href="#paramFLOPs_10" rel="nofollow">一、网络中的参数量(param)是什么？浮点计算量(FLOPs)是什么？</a></li><li><a href="#param_19" rel="nofollow">二、如何计算网络中的参数量(param)</a></li><li><ul><li><a href="#param_20" rel="nofollow">网络中的参数量(param)的计算</a></li><li><a href="#_22" rel="nofollow">卷积层：</a></li><li><ul><li><a href="#_24" rel="nofollow">计算公式：</a></li></ul> 
   </li><li><a href="#_42" rel="nofollow">池化层:</a></li><li><a href="#_44" rel="nofollow">全连接层:</a></li><li><ul><li><a href="#CONVFC__46" rel="nofollow">CONV-&gt;FC 及计算公式</a></li><li><a href="#FCFC__51" rel="nofollow">FC-&gt;FC 及计算公式</a></li></ul> 
   </li><li><a href="#_55" rel="nofollow">代码展示</a></li></ul> 
  </li><li><a href="#_179" rel="nofollow">附加：参数和模型显存\模型尺寸的关系</a></li><li><a href="#FLOPs_197" rel="nofollow">总结及浮点计算量FLOPs的指引</a></li></ul> 
</div> 
<p></p> 
<h2><a id="paramFLOPs_6"></a>网络中的参数量(param)和浮点计算量(FLOPs)的计算</h2> 
<p>可以在我都<a href="https://gitee.com/yann_qi/templete" rel="nofollow">模板仓库</a>的Utils文件夹中查看具体有关参数量(param)和浮点计算量(FLOPs)的计算代码。</p> 
<h2><a id="paramFLOPs_10"></a>一、网络中的参数量(param)是什么？浮点计算量(FLOPs)是什么？</h2> 
<ol><li>网络中的参数量（param）对应与<strong>空间Space</strong>概念，及空间复杂度。</li><li>浮点计算量(FLOPs)对应与<strong>时间Time</strong>概念，对应于时间复杂度。</li></ol> 
<p>即，网络参数量（param）和显存密切相关；浮点计算量(FLOPs)和GPU的计算速度相关。</p> 
<h2><a id="param_19"></a>二、如何计算网络中的参数量(param)</h2> 
<h3><a id="param_20"></a>网络中的参数量(param)的计算</h3> 
<p>网络中参数计算需要分为</p> 
<h3><a id="_22"></a>卷积层：</h3> 
<p>需要关注的参数为(kernel_size,in_channel,out_channel)</p> 
<h4><a id="_24"></a>计算公式：</h4> 
<p><em>完全版</em>：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         c 
        
       
         o 
        
       
         n 
        
       
         v 
        
       
         _ 
        
       
         p 
        
       
         a 
        
       
         r 
        
       
         a 
        
       
         m 
        
       
         = 
        
       
         ( 
        
       
         k 
        
       
         e 
        
       
         r 
        
       
         n 
        
       
         e 
        
       
         l 
        
       
         _ 
        
       
         s 
        
       
         i 
        
       
         z 
        
       
         e 
        
       
         ∗ 
        
       
         i 
        
       
         n 
        
       
         _ 
        
       
         c 
        
       
         h 
        
       
         a 
        
       
         n 
        
       
         n 
        
       
         e 
        
       
         l 
        
       
         + 
        
       
         b 
        
       
         i 
        
       
         a 
        
       
         s 
        
       
         ) 
        
       
         ∗ 
        
       
         o 
        
       
         u 
        
       
         t 
        
       
         _ 
        
       
         c 
        
       
         h 
        
       
         a 
        
       
         n 
        
       
         n 
        
       
         e 
        
       
         l 
        
       
      
        conv\_param = (kernel\_size*in\_channel+bias)*out\_channel 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.74056em; vertical-align: -0.31em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right: 0.03588em;">v</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault">p</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">a</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right: 0.04398em;">z</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault">c</span><span class="mord mathdefault">h</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">b</span><span class="mord mathdefault">i</span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault">c</span><span class="mord mathdefault">h</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span></span></span></span></span>，默认<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         b 
        
       
         i 
        
       
         a 
        
       
         s 
        
       
         = 
        
       
         1 
        
       
      
        bias=1 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault">b</span><span class="mord mathdefault">i</span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">1</span></span></span></span></span>，out_channel是filter(代表卷积核个数)，且每个卷积核都有对应的bias。</p> 
<p><em>简略版</em>：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         c 
        
       
         o 
        
       
         n 
        
       
         v 
        
       
         _ 
        
       
         p 
        
       
         a 
        
       
         r 
        
       
         a 
        
       
         m 
        
       
         = 
        
       
         k 
        
       
         e 
        
       
         r 
        
       
         n 
        
       
         e 
        
       
         l 
        
       
         _ 
        
       
         s 
        
       
         i 
        
       
         z 
        
       
         e 
        
       
         ∗ 
        
       
         i 
        
       
         n 
        
       
         _ 
        
       
         c 
        
       
         h 
        
       
         a 
        
       
         n 
        
       
         n 
        
       
         e 
        
       
         l 
        
       
         ∗ 
        
       
         o 
        
       
         u 
        
       
         t 
        
       
         _ 
        
       
         c 
        
       
         h 
        
       
         a 
        
       
         n 
        
       
         n 
        
       
         e 
        
       
         l 
        
       
      
        conv\_param = kernel\_size*in\_channel*out\_channel 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.74056em; vertical-align: -0.31em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right: 0.03588em;">v</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault">p</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">a</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right: 0.04398em;">z</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault">c</span><span class="mord mathdefault">h</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault">c</span><span class="mord mathdefault">h</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span></span></span></span></span>，因为bias不会影响数量级的变化，一般可省略。</p> 
<p><strong>举个例子</strong>：<br> 如下图所示：<br> image_size = 5x5x3<br> kernel_size = 3x3<br> in_channel = 3 （图像channel）<br> out_channel = 2 (卷积核数目\filter数目)<br> 则该卷积层的<strong>参数个数</strong>为:<br> 完全版：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         c 
        
       
         o 
        
       
         n 
        
       
         v 
        
       
         _ 
        
       
         p 
        
       
         a 
        
       
         r 
        
       
         a 
        
       
         m 
        
       
         = 
        
       
         ( 
        
       
         k 
        
       
         e 
        
       
         r 
        
       
         n 
        
       
         e 
        
       
         l 
        
       
         _ 
        
       
         s 
        
       
         i 
        
       
         z 
        
       
         e 
        
       
         ∗ 
        
       
         i 
        
       
         n 
        
       
         _ 
        
       
         c 
        
       
         h 
        
       
         a 
        
       
         n 
        
       
         n 
        
       
         e 
        
       
         l 
        
       
         + 
        
       
         b 
        
       
         i 
        
       
         a 
        
       
         s 
        
       
         ) 
        
       
         ∗ 
        
       
         o 
        
       
         u 
        
       
         t 
        
       
         _ 
        
       
         c 
        
       
         h 
        
       
         a 
        
       
         n 
        
       
         n 
        
       
         e 
        
       
         l 
        
       
         = 
        
       
         = 
        
       
         ( 
        
       
         3 
        
       
         ∗ 
        
       
         3 
        
       
         ∗ 
        
       
         3 
        
       
         + 
        
       
         1 
        
       
         ) 
        
       
         ∗ 
        
       
         2 
        
       
         = 
        
       
         56 
        
       
      
        conv\_param = (kernel\_size*in\_channel+bias)*out\_channel==(3*3*3+1)*2 = 56 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.74056em; vertical-align: -0.31em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right: 0.03588em;">v</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault">p</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">a</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.06em; vertical-align: -0.31em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right: 0.04398em;">z</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault">c</span><span class="mord mathdefault">h</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault">b</span><span class="mord mathdefault">i</span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault">c</span><span class="mord mathdefault">h</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span></span><span class="base"><span class="strut" style="height: 0.36687em; vertical-align: 0em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">3</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">3</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.72777em; vertical-align: -0.08333em;"></span><span class="mord">3</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">5</span><span class="mord">6</span></span></span></span></span><br> 简略版：<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         c 
        
       
         o 
        
       
         n 
        
       
         v 
        
       
         _ 
        
       
         p 
        
       
         a 
        
       
         r 
        
       
         a 
        
       
         m 
        
       
         = 
        
       
         k 
        
       
         e 
        
       
         r 
        
       
         n 
        
       
         e 
        
       
         l 
        
       
         _ 
        
       
         s 
        
       
         i 
        
       
         z 
        
       
         e 
        
       
         ∗ 
        
       
         i 
        
       
         n 
        
       
         _ 
        
       
         c 
        
       
         h 
        
       
         a 
        
       
         n 
        
       
         n 
        
       
         e 
        
       
         l 
        
       
         ∗ 
        
       
         o 
        
       
         u 
        
       
         t 
        
       
         _ 
        
       
         c 
        
       
         h 
        
       
         a 
        
       
         n 
        
       
         n 
        
       
         e 
        
       
         l 
        
       
         = 
        
       
         3 
        
       
         ∗ 
        
       
         3 
        
       
         ∗ 
        
       
         3 
        
       
         ∗ 
        
       
         2 
        
       
         = 
        
       
         54 
        
       
      
        conv\_param = kernel\_size*in\_channel*out\_channel =3*3*3*2 = 54 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.74056em; vertical-align: -0.31em;"></span><span class="mord mathdefault">c</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right: 0.03588em;">v</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault">p</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">a</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathdefault" style="margin-right: 0.03148em;">k</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right: 0.04398em;">z</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault">c</span><span class="mord mathdefault">h</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault">c</span><span class="mord mathdefault">h</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">3</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">3</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">3</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">2</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.64444em; vertical-align: 0em;"></span><span class="mord">5</span><span class="mord">4</span></span></span></span></span><br> <img src="https://images2.imgbox.com/43/fe/jzoFwhBD_o.gif" alt="1"></p> 
<h3><a id="_42"></a>池化层:</h3> 
<p>池化层不需要参数。例如 max_pooling：直接最大化池化就可以，无需参数。</p> 
<h3><a id="_44"></a>全连接层:</h3> 
<p>全连接层有两种情况，一种是卷积层到全连接层，一种是全连接层到全连接层，因此需要分情况来讨论：</p> 
<h4><a id="CONVFC__46"></a>CONV-&gt;FC 及计算公式</h4> 
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         C 
        
       
         o 
        
       
         n 
        
       
         v 
        
       
         _ 
        
       
         F 
        
       
         C 
        
       
         _ 
        
       
         p 
        
       
         a 
        
       
         r 
        
       
         a 
        
       
         m 
        
       
         = 
        
       
         f 
        
       
         e 
        
       
         t 
        
       
         u 
        
       
         r 
        
       
         e 
        
       
         m 
        
       
         a 
        
       
         p 
        
       
         _ 
        
       
         s 
        
       
         i 
        
       
         z 
        
       
         e 
        
       
         ∗ 
        
       
         i 
        
       
         n 
        
       
         _ 
        
       
         c 
        
       
         h 
        
       
         a 
        
       
         n 
        
       
         n 
        
       
         e 
        
       
         l 
        
       
         ∗ 
        
       
         o 
        
       
         u 
        
       
         t 
        
       
         _ 
        
       
         n 
        
       
         e 
        
       
         u 
        
       
         r 
        
       
         a 
        
       
         l 
        
       
      
        Conv\_FC\_param = feturemap\_size*in\_channel*out\_neural 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.99333em; vertical-align: -0.31em;"></span><span class="mord mathdefault" style="margin-right: 0.07153em;">C</span><span class="mord mathdefault">o</span><span class="mord mathdefault">n</span><span class="mord mathdefault" style="margin-right: 0.03588em;">v</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault" style="margin-right: 0.13889em;">F</span><span class="mord mathdefault" style="margin-right: 0.07153em;">C</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault">p</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">a</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="mord mathdefault">e</span><span class="mord mathdefault">t</span><span class="mord mathdefault">u</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord mathdefault">p</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault">s</span><span class="mord mathdefault">i</span><span class="mord mathdefault" style="margin-right: 0.04398em;">z</span><span class="mord mathdefault">e</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault">c</span><span class="mord mathdefault">h</span><span class="mord mathdefault">a</span><span class="mord mathdefault">n</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord mathdefault">o</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault">u</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span></span></span></span></span><br> feturemap_size : 前一层特征图尺寸<br> in_channel : 前一层卷积核个数<br> out_neural : 全连接层神经元个数</p> 
<h4><a id="FCFC__51"></a>FC-&gt;FC 及计算公式</h4> 
<p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         F 
        
       
         C 
        
       
         _ 
        
       
         F 
        
       
         C 
        
       
         _ 
        
       
         p 
        
       
         a 
        
       
         r 
        
       
         a 
        
       
         m 
        
       
         = 
        
       
         i 
        
       
         n 
        
       
         _ 
        
       
         n 
        
       
         e 
        
       
         u 
        
       
         r 
        
       
         a 
        
       
         ∗ 
        
       
         ∗ 
        
       
         o 
        
       
         u 
        
       
         t 
        
       
         _ 
        
       
         n 
        
       
         e 
        
       
         u 
        
       
         r 
        
       
         a 
        
       
         l 
        
       
         − 
        
       
         b 
        
       
         i 
        
       
         a 
        
       
         s 
        
       
      
        FC\_FC\_param = in\_neura**out\_neural-bias 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.99333em; vertical-align: -0.31em;"></span><span class="mord mathdefault" style="margin-right: 0.13889em;">F</span><span class="mord mathdefault" style="margin-right: 0.07153em;">C</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault" style="margin-right: 0.13889em;">F</span><span class="mord mathdefault" style="margin-right: 0.07153em;">C</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault">p</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">a</span><span class="mord mathdefault">m</span><span class="mspace" style="margin-right: 0.277778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.277778em;"></span></span><span class="base"><span class="strut" style="height: 0.96952em; vertical-align: -0.31em;"></span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault">u</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 1.00444em; vertical-align: -0.31em;"></span><span class="mord">∗</span><span class="mord mathdefault">o</span><span class="mord mathdefault">u</span><span class="mord mathdefault">t</span><span class="mord" style="margin-right: 0.02778em;">_</span><span class="mord mathdefault">n</span><span class="mord mathdefault">e</span><span class="mord mathdefault">u</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mspace" style="margin-right: 0.222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.222222em;"></span></span><span class="base"><span class="strut" style="height: 0.69444em; vertical-align: 0em;"></span><span class="mord mathdefault">b</span><span class="mord mathdefault">i</span><span class="mord mathdefault">a</span><span class="mord mathdefault">s</span></span></span></span></span><br> bias = out_neural，每个神经元都有一个bias。一般可忽略bias。</p> 
<h3><a id="_55"></a>代码展示</h3> 
<p>Pytorch中计算网络中的参数量的包有很多，例如torchstat、thop、ptflops、torchsummary等等，这里将选取部分进行展示。</p> 
<ol><li>首先搭建一个简单的CNN网络：</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> torch 
<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn
<span class="token keyword">class</span> <span class="token class-name">CNN</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>CNN<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>         <span class="token comment"># input shape (1, 28, 28)</span>
                nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>
                in_channels<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>              <span class="token comment"># input height  gray just have one level</span>
                out_channels<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">,</span>            <span class="token comment"># n_filters</span>
                kernel_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span>              <span class="token comment"># filter size</span>
                stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>                   <span class="token comment"># filter movement/step</span>
                padding<span class="token operator">=</span><span class="token number">2</span> 
                <span class="token punctuation">)</span><span class="token punctuation">,</span>                          <span class="token comment"># output shape (16, 28, 28)                                   </span>
            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      <span class="token comment"># activation</span>
            nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment"># choose max value in 2x2 area, output shape (16, 14, 14)</span>
        <span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>        <span class="token comment"># input shape (16, 14, 14)</span>
           nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>     <span class="token comment"># output shape (32, 14, 14)</span>
            nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                      <span class="token comment"># activation</span>
           nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                <span class="token comment"># output shape (32, 7, 7)</span>
        <span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>out <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">32</span> <span class="token operator">*</span> <span class="token number">7</span> <span class="token operator">*</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>   <span class="token comment"># fully connected layer, output 10 classes</span>
 
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        x <span class="token operator">=</span> x<span class="token punctuation">.</span>view<span class="token punctuation">(</span>x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>           <span class="token comment"># flatten the output of conv2 to (batch_size, 32 * 7 * 7)</span>
        output <span class="token operator">=</span> self<span class="token punctuation">.</span>out<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> output<span class="token punctuation">,</span> x    <span class="token comment"># return x for visualization</span>

cnn <span class="token operator">=</span> CNN<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>cnn<span class="token punctuation">)</span>  <span class="token comment"># net architecture</span>
</code></pre> 
<ol start="2"><li>计算参数量</li></ol> 
<p>Torchstat包的使用</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> torchstat <span class="token keyword">import</span> stat

<span class="token comment"># 导入模型，输入一张输入图片的尺寸</span>
stat<span class="token punctuation">(</span>cnn<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出结果：</p> 
<pre><code class="prism language-bash">      module name  input shape output shape   params memory<span class="token punctuation">(</span>MB<span class="token punctuation">)</span>         MAdd        Flops  MemRead<span class="token punctuation">(</span>B<span class="token punctuation">)</span>  MemWrite<span class="token punctuation">(</span>B<span class="token punctuation">)</span> duration<span class="token punctuation">[</span>%<span class="token punctuation">]</span>  MemR+W<span class="token punctuation">(</span>B<span class="token punctuation">)</span>
<span class="token number">0</span>         conv1.0    <span class="token number">1</span>  <span class="token number">28</span>  <span class="token number">28</span>   <span class="token number">16</span>  <span class="token number">28</span>  <span class="token number">28</span>    <span class="token number">416.0</span>       <span class="token number">0.05</span>    <span class="token number">627,200</span>.0    <span class="token number">326,144</span>.0      <span class="token number">4800.0</span>      <span class="token number">50176.0</span>      <span class="token number">46.17</span>%    <span class="token number">54976.0</span>
<span class="token number">1</span>         conv1.1   <span class="token number">16</span>  <span class="token number">28</span>  <span class="token number">28</span>   <span class="token number">16</span>  <span class="token number">28</span>  <span class="token number">28</span>      <span class="token number">0.0</span>       <span class="token number">0.05</span>     <span class="token number">12,544</span>.0     <span class="token number">12,544</span>.0     <span class="token number">50176.0</span>      <span class="token number">50176.0</span>       <span class="token number">0.22</span>%   <span class="token number">100352.0</span>
<span class="token number">2</span>         conv1.2   <span class="token number">16</span>  <span class="token number">28</span>  <span class="token number">28</span>   <span class="token number">16</span>  <span class="token number">14</span>  <span class="token number">14</span>      <span class="token number">0.0</span>       <span class="token number">0.01</span>      <span class="token number">9,408</span>.0     <span class="token number">12,544</span>.0     <span class="token number">50176.0</span>      <span class="token number">12544.0</span>      <span class="token number">12.20</span>%    <span class="token number">62720.0</span>
<span class="token number">3</span>         conv2.0   <span class="token number">16</span>  <span class="token number">14</span>  <span class="token number">14</span>   <span class="token number">32</span>  <span class="token number">14</span>  <span class="token number">14</span>  <span class="token number">12832.0</span>       <span class="token number">0.02</span>  <span class="token number">5,017</span>,600.0  <span class="token number">2,515</span>,072.0     <span class="token number">63872.0</span>      <span class="token number">25088.0</span>      <span class="token number">35.98</span>%    <span class="token number">88960.0</span>
<span class="token number">4</span>         conv2.1   <span class="token number">32</span>  <span class="token number">14</span>  <span class="token number">14</span>   <span class="token number">32</span>  <span class="token number">14</span>  <span class="token number">14</span>      <span class="token number">0.0</span>       <span class="token number">0.02</span>      <span class="token number">6,272</span>.0      <span class="token number">6,272</span>.0     <span class="token number">25088.0</span>      <span class="token number">25088.0</span>       <span class="token number">0.05</span>%    <span class="token number">50176.0</span>
<span class="token number">5</span>         conv2.2   <span class="token number">32</span>  <span class="token number">14</span>  <span class="token number">14</span>   <span class="token number">32</span>   <span class="token number">7</span>   <span class="token number">7</span>      <span class="token number">0.0</span>       <span class="token number">0.01</span>      <span class="token number">4,704</span>.0      <span class="token number">6,272</span>.0     <span class="token number">25088.0</span>       <span class="token number">6272.0</span>       <span class="token number">5.03</span>%    <span class="token number">31360.0</span>
<span class="token number">6</span>             out         <span class="token number">1568</span>           <span class="token number">10</span>  <span class="token number">15690.0</span>       <span class="token number">0.00</span>     <span class="token number">31,350</span>.0     <span class="token number">15,680</span>.0     <span class="token number">69032.0</span>         <span class="token number">40.0</span>       <span class="token number">0.35</span>%    <span class="token number">69072.0</span>
total                                        <span class="token number">28938.0</span>       <span class="token number">0.16</span>  <span class="token number">5,709</span>,078.0  <span class="token number">2,894</span>,528.0     <span class="token number">69032.0</span>         <span class="token number">40.0</span>     <span class="token number">100.00</span>%   <span class="token number">457616.0</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
Total params: <span class="token number">28,938</span>
-----------------------------------------------------------------------------------------------------------------------------------------
Total memory: <span class="token number">0</span>.16MB
Total MAdd: <span class="token number">5</span>.71MMAdd
Total Flops: <span class="token number">2</span>.89MFlops
Total MemR+W: <span class="token number">446</span>.89KB
</code></pre> 
<p>Torchinfo包的使用： （刚刚写完，发现torchsummary 更名为 torchinfo了，用这个）<br> pip install torchinfo</p> 
<pre><code class="prism language-python"><span class="token comment">#from torchsummary import summary</span>
<span class="token keyword">from</span> torchinfo <span class="token keyword">import</span> summary

<span class="token comment"># 导入模型，输入一张输入图片的尺寸</span>
<span class="token comment">#summary(cnn.cuda(), input_size=(1, 28, 28), batch_size=-1)</span>
batch_size <span class="token operator">=</span> <span class="token number">1</span>
summary<span class="token punctuation">(</span>model<span class="token punctuation">,</span> input_size<span class="token operator">=</span><span class="token punctuation">(</span>batch_size<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>输出结果：</p> 
<pre><code class="prism language-bash">----------------------------------------------------------------
        Layer <span class="token punctuation">(</span>type<span class="token punctuation">)</span>               Output Shape         Param <span class="token comment">#</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
            Conv2d-1           <span class="token punctuation">[</span>-1, <span class="token number">16</span>, <span class="token number">28</span>, <span class="token number">28</span><span class="token punctuation">]</span>             <span class="token number">416</span>
              ReLU-2           <span class="token punctuation">[</span>-1, <span class="token number">16</span>, <span class="token number">28</span>, <span class="token number">28</span><span class="token punctuation">]</span>               <span class="token number">0</span>
         MaxPool2d-3           <span class="token punctuation">[</span>-1, <span class="token number">16</span>, <span class="token number">14</span>, <span class="token number">14</span><span class="token punctuation">]</span>               <span class="token number">0</span>
            Conv2d-4           <span class="token punctuation">[</span>-1, <span class="token number">32</span>, <span class="token number">14</span>, <span class="token number">14</span><span class="token punctuation">]</span>          <span class="token number">12,832</span>
              ReLU-5           <span class="token punctuation">[</span>-1, <span class="token number">32</span>, <span class="token number">14</span>, <span class="token number">14</span><span class="token punctuation">]</span>               <span class="token number">0</span>
         MaxPool2d-6             <span class="token punctuation">[</span>-1, <span class="token number">32</span>, <span class="token number">7</span>, <span class="token number">7</span><span class="token punctuation">]</span>               <span class="token number">0</span>
            Linear-7                   <span class="token punctuation">[</span>-1, <span class="token number">10</span><span class="token punctuation">]</span>          <span class="token number">15,690</span>
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
Total params: <span class="token number">28,938</span>
Trainable params: <span class="token number">28,938</span>
Non-trainable params: <span class="token number">0</span>
----------------------------------------------------------------
Input size <span class="token punctuation">(</span>MB<span class="token punctuation">)</span>: <span class="token number">0.00</span>
Forward/backward pass size <span class="token punctuation">(</span>MB<span class="token punctuation">)</span>: <span class="token number">0.32</span>
Params size <span class="token punctuation">(</span>MB<span class="token punctuation">)</span>: <span class="token number">0.11</span>
Estimated Total Size <span class="token punctuation">(</span>MB<span class="token punctuation">)</span>: <span class="token number">0.44</span>
----------------------------------------------------------------
</code></pre> 
<p>两种包的显示结果各有优劣，可以依据需求来使用。</p> 
<p>Thop包的使用及Pytorch自带参数计算的使用：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> thop <span class="token keyword">import</span> profile
model <span class="token operator">=</span> build_detection_model<span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span>
 <span class="token comment"># 导入模型，输入一张输入图片的尺寸</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span>
<span class="token builtin">input</span> <span class="token operator">=</span> torch<span class="token punctuation">.</span>randn<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cuda<span class="token punctuation">(</span><span class="token punctuation">)</span>
flop<span class="token punctuation">,</span> para <span class="token operator">=</span> profile<span class="token punctuation">(</span>model<span class="token punctuation">,</span> inputs<span class="token operator">=</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Flops:'</span><span class="token punctuation">,</span><span class="token string">"%.2fM"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>flop<span class="token operator">/</span><span class="token number">1e6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'Params:'</span><span class="token punctuation">,</span><span class="token string">"%.2fM"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>para<span class="token operator">/</span><span class="token number">1e6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
total <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">[</span>param<span class="token punctuation">.</span>nelement<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> param <span class="token keyword">in</span> model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Number of parameter: %.2fM'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>total<span class="token operator">/</span><span class="token number">1e6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="_179"></a>附加：参数和模型显存\模型尺寸的关系</h2> 
<p>参数占用显存=参数数目×n</p> 
<p>n=4：float32</p> 
<p>n=2：float16</p> 
<p>n=8：double64</p> 
<p>除此之外，batch_size输入的图片占据大部分显存。</p> 
<p><strong>模型尺寸</strong>就是模型的大小，我们一般使用参数量parameter来衡量，注意，它的单位是个。但是由于很多模型参数量太大，所以一般取一个更方便的单位：兆(M) 来衡量。比如ResNet-152的参数量可以达到60 million = 0.0006M。有些时候，model size在实际计算时除了包含参数量以外，还包括网络架构信息和优化器信息等。比如存储一个一般的CNN模型(ImageNet训练)需要大于300MB。</p> 
<p><strong>M和MB的换算关系：</strong></p> 
<p>比如说我有一个模型参数量是1M，在一般的深度学习框架中(比如说PyTorch)，一般是32位存储。32位存储的意思就是1个参数用32个bit来存储。那么这个拥有1M参数量的模型所需要的存储空间的大小即为：1M * 32 bit = 32Mb = 4MB。因为1 Byte = 8 bit。现在的quantization技术就是减少参数量所占的位数：比如我用8位存储，那么：所需要的存储空间的大小即为：1M * 8 bit = 8Mb = 1MB。</p> 
<h2><a id="FLOPs_197"></a>总结及浮点计算量FLOPs的指引</h2> 
<p>浮点计算量：<br> <a href="https://zhuanlan.zhihu.com/p/137719986" rel="nofollow">FLOPs如何计算</a></p> 
<p>参考：<br> <a href="https://blog.csdn.net/m0_51004308/article/details/118048504">https://blog.csdn.net/m0_51004308/article/details/118048504</a><br> <a href="https://blog.csdn.net/weixin_45292794/article/details/108227437">https://blog.csdn.net/weixin_45292794/article/details/108227437</a><br> <a href="https://blog.csdn.net/Leo_whj/article/details/109636819">https://blog.csdn.net/Leo_whj/article/details/109636819</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/02e28afa996c144da6a34b7dd4e00463/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MySOL(狂殴26K字只为博君一赞)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f1f028c537a65777d4e1daa5b343654e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">chrome浏览器必备5款插件--各个都好使--chrome基础</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>