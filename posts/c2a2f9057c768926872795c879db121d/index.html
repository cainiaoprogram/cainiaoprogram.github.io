<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>linux shell 编程 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="linux shell 编程" />
<meta property="og:description" content="文章目录 接收用户参数判断用户参数流程控制if 语句for 语句while 语句 常用指令shell 编程注意事项shell 编程案例 接收用户参数 #!/bin/bash echo &#34;当前脚本名称为$0&#34; echo &#34;总共有$#个参数，分别是$*&#34; echo &#34;第 1 个参数为$1，第 5 个为$5&#34; $# 参数个数；$* 所有位置参数；$? 上一次命令执行返回值；$1 第一个位置参数
执行 sh example.sh one two three four five six, 输出：
当前脚本名称为 example.sh 总共有 6 个参数，分别是 one two three four five six 第 1 个参数为 one，第 5 个为 five 判断用户参数 Shell 脚本中的条件测试语法可以判断表达式是否成立，若条件成立则返回数字 0，否则便返回其他随机数值。例如，在创建文件之前，首先判断文件是否存在。
语法：[ Expression ] 注：括号两侧有空格
区别 shell 命令的返回值与输出值，返回值通过 $? 获取，而 var=echo hhh 是将输出结果赋值给 var 而不是返回值，管道命令也是如此。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c2a2f9057c768926872795c879db121d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-13T22:34:58+08:00" />
<meta property="article:modified_time" content="2021-01-13T22:34:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">linux shell 编程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_2" rel="nofollow">接收用户参数</a></li><li><a href="#_21" rel="nofollow">判断用户参数</a></li><li><a href="#_62" rel="nofollow">流程控制</a></li><li><ul><li><a href="#if__64" rel="nofollow">if 语句</a></li><li><a href="#for__97" rel="nofollow">for 语句</a></li><li><a href="#while__145" rel="nofollow">while 语句</a></li></ul> 
   </li><li><a href="#_184" rel="nofollow">常用指令</a></li><li><a href="#shell__204" rel="nofollow">shell 编程注意事项</a></li><li><a href="#shell__221" rel="nofollow">shell 编程案例</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_2"></a>接收用户参数</h3> 
<pre><code class="prism language-sh">#!/bin/bash
echo "当前脚本名称为$0"
echo "总共有$#个参数，分别是$*"
echo "第 1 个参数为$1，第 5 个为$5"
</code></pre> 
<p><code>$#</code> 参数个数；<code>$*</code> 所有位置参数；<code>$?</code> 上一次命令执行返回值；<code>$1</code> 第一个位置参数</p> 
<p>执行 <code>sh example.sh one two three four five six</code>, 输出：</p> 
<pre><code>当前脚本名称为 example.sh
总共有 6 个参数，分别是 one two three four five six
第 1 个参数为 one，第 5 个为 five
</code></pre> 
<h3><a id="_21"></a>判断用户参数</h3> 
<p>Shell 脚本中的条件测试语法可以判断表达式是否成立，<strong>若条件成立则返回数字 0</strong>，否则便返回其他随机数值。例如，在创建文件之前，首先判断文件是否存在。</p> 
<p>语法：<code>[ Expression ]</code> 注：括号两侧有空格</p> 
<blockquote> 
 <p>区别 shell 命令的返回值与输出值，返回值通过 $? 获取，而 var=<code>echo hhh</code> 是将输出结果赋值给 var 而不是返回值，管道命令也是如此。</p> 
</blockquote> 
<p>条件测试语句分为</p> 
<ul><li>文件测试语句 （文件是否存在，权限是否满足等）</li><li>逻辑测试</li><li>整数比较</li><li>字符串比较</li></ul> 
<p><img src="https://images2.imgbox.com/f8/83/3JLza3EF_o.png" alt="在这里插入图片描述"></p> 
<p>例如，终端执行 <code>[ -d /dev ] &amp;&amp; echo "is dir"</code> , 则输出 “is dir”</p> 
<p>整数比较</p> 
<p><img src="https://images2.imgbox.com/1f/ba/X08OQ93G_o.png" alt="在这里插入图片描述"></p> 
<p>一个例子：</p> 
<pre><code class="prism language-sh">[ 100 -gt 99 ]
echo $?
</code></pre> 
<p>输出 0</p> 
<p>另一个较为综合的例子：</p> 
<pre><code class="prism language-sh">FreeMem=`free -m | grep Mem: | awk '{print $4}'`
[ $FreeMem -lt 1024 ] &amp;&amp; echo "Insufficient Memory"
</code></pre> 
<p>用于判断系统剩余内存是否小于 1024 M ，这条语句用到了管道命令 <code>|</code>和 <code>awk</code> 命令（处理文本）</p> 
<h3><a id="_62"></a>流程控制</h3> 
<h4><a id="if__64"></a>if 语句</h4> 
<p>单分支</p> 
<pre><code class="prism language-sh">DIR="tmp"
if [ ! -e $DIR ]
then mkdir -p $DIR
fi
</code></pre> 
<p>双分支</p> 
<pre><code class="prism language-sh">DIR="tmp"
if [ ! -e $DIR ]
then mkdir -p $DIR
else echo "tmp exists!"
fi
</code></pre> 
<p>多分支</p> 
<pre><code class="prism language-sh">if xxx
	then xxx
elif xxx
	then xxx
else 
	xxx
fi
</code></pre> 
<h4><a id="for__97"></a>for 语句</h4> 
<p>语法：</p> 
<pre><code class="prism language-sh">for var in value_list
do 
	xxx
done
</code></pre> 
<p>给出一个批量建用户名的例子：</p> 
<pre><code class="prism language-sh">read -p "Enter The Users Password : " PASSWD   # read 接收用户输入
for UNAME in `cat users.txt`  # 反引号，当作命令执行，并返回结果
do
id $UNAME &amp;&gt; /dev/null
if [ $? -eq 0 ]  # 判断上一条指令是否成功执行
then
echo "Already exists"
else
useradd $UNAME &amp;&gt; /dev/null
echo "$PASSWD" | passwd --stdin $UNAME &amp;&gt; /dev/null   # 管道命令，将前一条命令的输出，作为后面命令的输入参数
if [ $? -eq 0 ]
then
echo "$UNAME , Create success"
else
echo "$UNAME , Create failure"
fi
fi
done
</code></pre> 
<p>在脚本中使用 read 命令读取用户输入的密码值，然后赋值给 PASSWD 变量，并通过 -p 参数向用户显示一段提示信息，告诉用户正在输入的内容即将作为账户密码。在执行该脚本后，会自动使用从列表文件 users.txt 中获取到所有的用户<br> 名称，然后逐一使用“id 用户名”命令查看用户的信息，并使用 <code>$?</code> 判断这条命令是否执行成功，也就是判断该用户是否已经存在。需要多说一句， /dev/null 是一个被称作 Linux 黑洞的文件，把输出信息重定向到这个文件等同于删除数据（类似于没有回收功能的垃圾箱），可以让用户的屏幕窗口保持简洁</p> 
<p>注：shell 中的重定向</p> 
<pre><code>0表示标准输入
1表示标准输出
2表示标准错误输出
&gt; 默认为标准输出重定向，与 1&gt; 相同
2&gt;&amp;1 意思是把 标准错误输出 重定向到 标准输出.
&amp;&gt;file 意思是把 标准输出 和 标准错误输出 都重定向到文件 file 中
</code></pre> 
<h4><a id="while__145"></a>while 语句</h4> 
<p>语法：</p> 
<pre><code class="prism language-sh">while xxx
do xxx
done
</code></pre> 
<p>例子</p> 
<pre><code class="prism language-sh">PRICE=$(expr $RANDOM % 1000)  # expr 表达式求值，常用于数学运算
TIMES=0  # 等号两侧不能有空格
echo "商品实际价格为 0-999 之间，猜猜看是多少？ "
while true
do
read -p "请输入您猜测的价格数目： " INT
let TIMES++  # let 用于数学计算
if [ $INT -eq $PRICE ] ; then
echo "恭喜您答对了，实际价格是 $PRICE"
echo "您总共猜测了 $TIMES 次"
exit 0
elif [ $INT -gt $PRICE ] ; then
echo "太高了！ "
else
echo "太低了！ "
fi
done
</code></pre> 
<p>注：</p> 
<ul><li>等号两侧不能有空格</li><li>原生bash不支持简单的数学运算，但是可以通过其他命令来实现，例如 awk 和 expr，expr 最常用</li><li><code>PRICE=$(expr $RANDOM % 1000)</code> 等价于 <code>PRICE=`expr $RANDOM % 1000`</code>, 使用 <code>expr</code> 表达式和运算符之间要有空格，例如 2+2 是不对的，必须写成 2 + 2</li><li>let 也可用于运算，<code>let s=(2+3)*4</code> , <code>let no++</code>, <code>let no+=10</code> let 不需要空格隔开表达式的各个字符</li></ul> 
<h3><a id="_184"></a>常用指令</h3> 
<ul><li>文本编辑指令<pre><code class="prism language-sh">cat xxx
more xxx
head/tail -n 10 xxx  # 最前或最后 10 行
cat anaconda-ks.cfg | tr [a-z] [A-Z]  # tr 替换字符
wc -l/w/c xxx  # wc 命令用于统计指定文本的行数、字数、字节数
stat xxx  # 命令用于查看文件的具体存储信息和时间等信息
cut -d: -f1 /etc/passwd  # 命令用于按“列”提取文本字符，格式为“ cut [参数] 文本”
diff a.txt b.txt  # 比较不同
tr -s 替换字符
   -d 删除字符
sort 按行排序
    -r 反向排序
uniq -c 统计每行词频
awk 动作 文件名 # 实施动作到每一行
</code></pre> </li></ul> 
<h3><a id="shell__204"></a>shell 编程注意事项</h3> 
<ul><li>变量引用必加 “$”</li><li>echo 自动换行</li><li>printf fmt args,… 类似 C 语言</li><li>区分某个命令的行为 
  <ul><li>对参数操作 echo/pringf</li><li>对输入流操作 cat/read</li><li>是否操作输出流 cat/echo</li></ul> </li></ul> 
<pre><code>args == echo ==&gt; stdout
args == printf ==&gt; stdout
stdin == cat ==&gt; stdout
stdin == read ==&gt; args
</code></pre> 
<h3><a id="shell__221"></a>shell 编程案例</h3> 
<ul><li>for 循环 1</li></ul> 
<pre><code class="prism language-sh">for x in {1..100..2}
do
   echo $x
done
</code></pre> 
<ul><li>for 循环 2</li></ul> 
<pre><code class="prism language-sh">
for ((i=1; i&lt;10; ++i)) 
do
    echo $i
done
</code></pre> 
<blockquote> 
 <p>“(())” 内部可以不加 ‘$’</p> 
</blockquote> 
<ul><li>条件判断 1</li></ul> 
<pre><code class="prism language-sh">read x
read y
if ((x&lt;y))
   then echo X is less than Y
elif ((x==y))
   then echo X is equal to Y
else
   echo X is greater than Y
fi
</code></pre> 
<ul><li>条件判断 2</li></ul> 
<pre><code class="prism language-sh">read c
if [ $c = "Y" ] || [ $c = "y" ]
   then echo YES
else 
   echo NO
fi
</code></pre> 
<ul><li>实现 eval 函数</li></ul> 
<pre><code class="prism language-sh">read e
echo $e | bc -l | xargs printf "%.3f" 
# 以上等价于
printf "%.3f\n" $(echo $(cat) | bc -l)
</code></pre> 
<ul><li>函数定义</li></ul> 
<pre><code class="prism language-sh"># 定义
sum() {
    echo $* | tr ' ' '+' | bc -l | xargs echo 
}

# 调用
sum 1.544 4.7 8.7777
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a7910b4b00606ef9d6f8026cfa41f6d1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">6-10 统计字符串各类字符的个数</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/986b3d9363a0b737ffdceea32986b3bc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">工字型钢弹性截面模量计算公式_型钢计算公式2</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>