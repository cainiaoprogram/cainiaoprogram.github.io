<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Apache Doris (四) ：Doris分布式部署（一） FE部署及启动 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Apache Doris (四) ：Doris分布式部署（一） FE部署及启动" />
<meta property="og:description" content="目录
1.Apache Doris下载
2.节点划分
3. 节点配置
​​​​​​​4. FE部署及启动
​​​​​
进入正文之前，欢迎订阅专题、对博文点赞、评论、收藏，关注IT贫道，获取高质量博客内容！
部署Apache Doris时需要分别部署FE、BE、Broker。然后再建立FE，BE两者关系。
Apache Doris 中部署多FE的思路为先在一台节点上配置部署一个FE并启动，相当于是启动Doris服务，然后配置更多的FE节点，添加到Doris服务中给该Doris的FE进行扩容，最终形成多节点FE。FE又分为Leader、Follwer和Observer三种角色，多节点FE中首先启动的FE节点自动为Leader，部署完成一个FE节点后，按照集群划分将其他Follower和Observer节点加入到FE中即可。
部署BE时我们也需要部署FE完成后，然后配置BE各个节点并启动，通过对应命令将多个BE节点添加到Apache Doris集群中即可，即创建了FE、BE两者关系。
Broker的部署是可选的，如果需要从第三方存储系统导入数据，需要部署相应的 Broker，默认提供了读取 HDFS 、对象存储的 fs_broker。Borker以插件的形成独立于Doris集群，部署时也需部署完成FE和BE后，将各个Broker节点添加到 Doris集群中。
1.Apache Doris下载 先前Apache Doris需要自己手动编译源码进行部署安装，现在Apache Doris官方提供了对应编译好的安装包，可以直接下载进行部署。Apache Doris 下载地址为:https://doris.apache.org/zh-CN/download/。这里我们下载最新1.2.1版本。
由于 Apache 服务器文件大小限制，1.2 版本的二进制程序被分为三个包：
apache-doris-fe-1.2.1-bin-x86_64.tar.xz apache-doris-be-1.2.1-bin-x86_64.tar.xz apache-doris-dependencies-1.2.1-bin-x86_64.tar.xz 其中新增的 apache-doris-dependencies 包含用于支持 JDBC 外表和 JAVA UDF 的jar包，以及 Broker 和 AuditLoader。下载后，需要将其中的 java-udf-jar-with-dependencies.jar 放到 be/lib 目录下。
2.节点划分 根据Doris官方建议，部署Doris时FE和BE分开部署，这里我们部署Doris集群时部署3个Follower（Leader和Follow统称为Follower）、2个Observer、3个BE、5个Broker，共使用5台节点完成，每个节点的使用4core和4G内存，角色和节点分布如下：
节点IP
节点名称
FE(Follower)
FE(Observer)
BE
Broker（可选）
192.168.179.4
node1
★
★
192.168.179.5
node2
★
★
192.168.179.6" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/460b127518ee4457265ea815ffba1280/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-24T18:15:00+08:00" />
<meta property="article:modified_time" content="2023-06-24T18:15:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Apache Doris (四) ：Doris分布式部署（一） FE部署及启动</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="1.Apache%20Doris%E4%B8%8B%E8%BD%BD-toc" style="margin-left:0px;"><a href="#1.Apache%20Doris%E4%B8%8B%E8%BD%BD" rel="nofollow">1.Apache Doris下载</a></p> 
<p id="2.%E8%8A%82%E7%82%B9%E5%88%92%E5%88%86-toc" style="margin-left:0px;"><a href="#2.%E8%8A%82%E7%82%B9%E5%88%92%E5%88%86" rel="nofollow">2.节点划分</a></p> 
<p id="3.%C2%A0%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AE-toc" style="margin-left:0px;"><a href="#3.%C2%A0%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AE" rel="nofollow">3. 节点配置</a></p> 
<p id="%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B4.%C2%A0FE%E9%83%A8%E7%BD%B2%E5%8F%8A%E5%90%AF%E5%8A%A8-toc" style="margin-left:0px;"><a href="#%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B4.%C2%A0FE%E9%83%A8%E7%BD%B2%E5%8F%8A%E5%90%AF%E5%8A%A8" rel="nofollow">​​​​​​​4. FE部署及启动</a></p> 
<p id="%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B-toc" style="margin-left:0px;"><a href="#%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B" rel="nofollow">​​​​​</a></p> 
<hr id="hr-toc"> 
<p style="text-align:center;"><span style="color:#98c091;"><strong><u><em>进入正文之前，欢迎订阅专题、对博文点赞、评论、收藏，关注IT贫道，获取高质量博客内容！</em></u></strong></span></p> 
<hr> 
<p style="text-align:justify;">部署Apache Doris时需要分别部署FE、BE、Broker。然后再建立FE，BE两者关系。</p> 
<p style="text-align:justify;">Apache Doris 中部署多FE的思路为先在一台节点上配置部署一个FE并启动，相当于是启动Doris服务，然后配置更多的FE节点，添加到Doris服务中给该Doris的FE进行扩容，最终形成多节点FE。FE又分为<strong><strong>Leader、Follwer和Observer三种角色</strong></strong>，多节点FE中首先启动的FE节点自动为Leader，部署完成一个FE节点后，按照集群划分将其他Follower和Observer节点加入到FE中即可。</p> 
<p style="text-align:justify;">部署BE时我们也需要部署FE完成后，然后配置BE各个节点并启动，通过对应命令将多个BE节点添加到Apache Doris集群中即可，即创建了FE、BE两者关系。</p> 
<p style="text-align:justify;">Broker的部署是可选的，如果需要从第三方存储系统导入数据，需要部署相应的 Broker，默认提供了读取 HDFS 、对象存储的 fs_broker。Borker以插件的形成独立于Doris集群，部署时也需部署完成FE和BE后，将各个Broker节点添加到 Doris集群中。</p> 
<h2 id="1.Apache%20Doris%E4%B8%8B%E8%BD%BD" style="text-align:justify;"><strong>1.Apache Doris下载</strong></h2> 
<p style="text-align:justify;">先前Apache Doris需要自己手动编译源码进行部署安装，现在Apache Doris官方提供了对应编译好的安装包，可以直接下载进行部署。Apache Doris 下载地址为:https://doris.apache.org/zh-CN/download/。这里我们下载最新1.2.1版本。</p> 
<p style="text-align:justify;"><img alt="" height="649" src="https://images2.imgbox.com/1a/a8/r01f9BiU_o.png" width="1200"></p> 
<p style="text-align:justify;"><img alt="" height="351" src="https://images2.imgbox.com/e5/63/7M8ieJFa_o.png" width="719"></p> 
<p style="text-align:justify;">由于 Apache 服务器文件大小限制，1.2 版本的二进制程序被分为三个包：</p> 
<p> </p> 
<pre><code class="hljs">apache-doris-fe-1.2.1-bin-x86_64.tar.xz
apache-doris-be-1.2.1-bin-x86_64.tar.xz
apache-doris-dependencies-1.2.1-bin-x86_64.tar.xz</code></pre> 
<p> 其中新增的 apache-doris-dependencies 包含用于支持 JDBC 外表和 JAVA UDF 的jar包，以及 Broker 和 AuditLoader。下载后，需要将其中的 java-udf-jar-with-dependencies.jar 放到 be/lib 目录下。</p> 
<h2 id="2.%E8%8A%82%E7%82%B9%E5%88%92%E5%88%86"><strong>2.节点划分</strong></h2> 
<p style="text-align:justify;">根据Doris官方建议，部署Doris时FE和BE分开部署，这里我们部署Doris集群时部署3个Follower（Leader和Follow统称为Follower）、2个Observer、3个BE、5个Broker，共使用5台节点完成，每个节点的使用4core和4G内存，角色和节点分布如下：</p> 
<table border="1" cellspacing="0" style="margin-left:6.75pt;width:423.85pt;"><tbody><tr><td style="background-color:#b8cce4;width:79.75pt;"> <p style="margin-left:0pt;text-align:center;"><strong><strong>节点IP</strong></strong></p> </td><td style="background-color:#b8cce4;width:60pt;"> <p style="margin-left:0pt;text-align:center;"><strong><strong>节点名称</strong></strong></p> </td><td style="background-color:#b8cce4;width:79.6pt;"> <p style="margin-left:0pt;text-align:center;"><strong><strong>FE(Follower)</strong></strong></p> </td><td style="background-color:#b8cce4;width:83.05pt;"> <p style="margin-left:0pt;text-align:center;"><strong><strong>FE(Observer)</strong></strong></p> </td><td style="background-color:#b8cce4;width:34.65pt;"> <p style="margin-left:0pt;text-align:center;"><strong><strong>BE</strong></strong></p> </td><td style="background-color:#b8cce4;width:86.8pt;"> <p style="margin-left:0pt;text-align:center;"><strong><strong>Broker（可选）</strong></strong></p> </td></tr><tr><td style="width:79.75pt;"> <p style="margin-left:0pt;text-align:center;">192.168.179.4</p> </td><td style="width:60pt;"> <p style="margin-left:0pt;text-align:center;">node1</p> </td><td style="width:79.6pt;"> <p style="margin-left:0pt;text-align:center;">★</p> </td><td style="width:83.05pt;"> <p style="margin-left:0pt;text-align:center;"></p> </td><td style="width:34.65pt;"> <p style="margin-left:0pt;text-align:center;"></p> </td><td style="width:86.8pt;"> <p style="margin-left:0pt;text-align:center;">★</p> </td></tr><tr><td style="width:79.75pt;"> <p style="margin-left:0pt;text-align:center;">192.168.179.5</p> </td><td style="width:60pt;"> <p style="margin-left:0pt;text-align:center;">node2</p> </td><td style="width:79.6pt;"> <p style="margin-left:0pt;text-align:center;">★</p> </td><td style="width:83.05pt;"> <p style="margin-left:0pt;text-align:center;"></p> </td><td style="width:34.65pt;"> <p style="margin-left:0pt;text-align:center;"></p> </td><td style="width:86.8pt;"> <p style="margin-left:0pt;text-align:center;">★</p> </td></tr><tr><td style="width:79.75pt;"> <p style="margin-left:0pt;text-align:center;">192.168.179.6</p> </td><td style="width:60pt;"> <p style="margin-left:0pt;text-align:center;">node3</p> </td><td style="width:79.6pt;"> <p style="margin-left:0pt;text-align:center;">★</p> </td><td style="width:83.05pt;"> <p style="margin-left:0pt;text-align:justify;"></p> </td><td style="width:34.65pt;"> <p style="margin-left:0pt;text-align:center;">★</p> </td><td style="width:86.8pt;"> <p style="margin-left:0pt;text-align:center;">★</p> </td></tr><tr><td style="width:79.75pt;"> <p style="margin-left:0pt;text-align:center;">192.168.179.7</p> </td><td style="width:60pt;"> <p style="margin-left:0pt;text-align:center;">node4</p> </td><td style="width:79.6pt;"> <p style="margin-left:0pt;text-align:center;"></p> </td><td style="width:83.05pt;"> <p style="margin-left:0pt;text-align:center;">★</p> </td><td style="width:34.65pt;"> <p style="margin-left:0pt;text-align:center;">★</p> </td><td style="width:86.8pt;"> <p style="margin-left:0pt;text-align:center;">★</p> </td></tr><tr><td style="width:79.75pt;"> <p style="margin-left:0pt;text-align:center;">192.168.179.8</p> </td><td style="width:60pt;"> <p style="margin-left:0pt;text-align:center;">node5</p> </td><td style="width:79.6pt;"> <p style="margin-left:0pt;text-align:center;"></p> </td><td style="width:83.05pt;"> <p style="margin-left:0pt;text-align:center;">★</p> </td><td style="width:34.65pt;"> <p style="margin-left:0pt;text-align:center;">★</p> </td><td style="width:86.8pt;"> <p style="margin-left:0pt;text-align:center;">★</p> </td></tr></tbody></table> 
<h2 id="3.%C2%A0%E8%8A%82%E7%82%B9%E9%85%8D%E7%BD%AE"><strong>3. 节点配置</strong></h2> 
<p style="text-align:justify;">首先在部署Doris各个节点上按照如下步骤进行设置。</p> 
<p style="text-align:justify;"><strong><strong>1. 设置文件句柄数</strong></strong></p> 
<p style="text-align:justify;">在node1~node5各个节点上配置/etc/security/limits.conf文件如下内容，设置系统最大打开文件句柄数：</p> 
<pre><code class="language-bash"># 打开limits.conf文件，vim /etc/security/limits.conf 
* soft nofile 65536
* hard nofile 65536</code></pre> 
<p style="text-align:justify;">注意各个节点配置完成后，如果是ssh连接到各个节点需要重新打开新的ssh窗口生效或者重新启动机器生效。查看生效命令如下：</p> 
<pre><code class="language-bash">#查看可以打开最大文件描述符的数量，默认是1024
ulimit -n</code></pre> 
<p style="text-align:justify;"><strong>2. 时间同步</strong></p> 
<p style="text-align:justify;">在node1~node5各节点上进行时间同步。首选在各个节点上修改本地时区及安装ntp服务：</p> 
<pre><code class="language-bash">yum -y install ntp
rm -rf /etc/localtime
ln -s /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
/usr/sbin/ntpdate -u pool.ntp.org</code></pre> 
<p style="text-align:justify;">然后设置定时任务自动同步时间，设置定时任务，每10分钟同步一次，配置/etc/crontab文件，实现自动执行任务。建议直接crontab -e 来写入定时任务。使用crontab -l 查看当前用户定时任务。</p> 
<pre><code class="language-bash">#各个节点执行 crontab -e 写入以下内容
*/10 * * * *  /usr/sbin/ntpdate -u pool.ntp.org &gt;/dev/null 2&gt;&amp;1

#重启定时任务   
service crond restart

#查看日期
date</code></pre> 
<p style="text-align:justify;"><strong>​​​​​​​​​​​​​​3. 关闭Swap分区</strong></p> 
<p style="text-align:justify;">在node1~node5各个节点上关闭Swap分区。各个节点上修改/etc/fstab文件，注释掉带有swap的行。如下：</p> 
<pre><code class="language-bash">#注释掉swap 行 ，vim /etc/fstab
...
#/dev/mapper/centos-swap swap swap    defaults        0 0
...</code></pre> 
<p style="text-align:justify;">以上配置完成后，需要重启机器生效，如果不想重启机器可以在各个节点上执行“swapoff  -a”临时关闭swap分区。执行后，可以通过“free -m”命令查看swap是否已经关闭。</p> 
<p style="text-align:justify;"><img alt="" height="105" src="https://images2.imgbox.com/9e/48/kYPSaprw_o.png" width="1058"></p> 
<p style="text-align:justify;"><strong><strong>4. 调大单个进程的虚拟内存区域数量</strong></strong></p> 
<p style="text-align:justify;">BE 启动脚本会通过 /proc/sys/vm/max_map_count 检查数值是否大于200W，否则启动失败。只需要在部署BE的节点上设置“sysctl -w vm.max_map_count=2000000”调大即可，这里在node1~node5节点上都做设置。</p> 
<pre><code class="language-bash">#限制单个进程的虚拟内存区域数量(临时设置)
sysctl -w vm.max_map_count=2000000</code></pre> 
<p> 以上是临时设置，当节点重启后会失效，可以在/etc/sysctl.conf中加入vm.max_map_count=2000000做永久设置。在node1~node5节点上配置/etc/sysctl.conf进行永久设置：</p> 
<pre><code class="language-bash">#vim /etc/sysctl.conf （追加参数，永久设置）
...
vm.max_map_count=2000000
...</code></pre> 
<p style="text-align:justify;">设置成功后，重启机器，可以通过cat /proc/sys/vm/max_map_count 命令检查此值为200W。</p> 
<h2 id="%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B4.%C2%A0FE%E9%83%A8%E7%BD%B2%E5%8F%8A%E5%90%AF%E5%8A%A8"><strong>​​​​​​​​​​​​​​4. FE部署及启动</strong></h2> 
<p style="text-align:justify;">下面我们首先在node1节点上部署Doris FE，然后再对Doris进行FE扩容，最终形成3台节点的FE。</p> 
<p style="text-align:justify;"><strong><strong>1. 创建doris部署目录</strong></strong></p> 
<p style="text-align:justify;">在node1~node5节点上创建“/software/doris-1.2.1”方便后续操作。</p> 
<pre><code class="language-bash">#各个节点创建目录/software/doris-1.2.1
mkdir -p /software/doris-1.2.1</code></pre> 
<p style="text-align:justify;"><strong>​​​​​​​2.上传安装包并解压</strong></p> 
<p style="text-align:justify;">在node1节点上传“apache-doris-fe-1.2.1-bin-x86_64.tar.xz”安装包到doris-1.2.1目录并解压。</p> 
<pre><code class="language-bash">#在node1节点上进行解压
[root@node1 ~]# tar -xvf /software/doris-1.2.1/apache-doris-fe-1.2.1-bin-x86_64.tar.xz 

#node1节点上对解压的文件进行改名
[root@node1 ~]# cd /software/doris-1.2.1/&amp;&amp;mv apache-doris-fe-1.2.1-bin-x86_64 apache-doris-fe</code></pre> 
<p style="text-align:justify;"><strong>​​​​​​​​​​​​​​3. 修改fe.conf配置文件</strong></p> 
<p style="text-align:justify;">在node1节点上修改/software/doris-1.2.1/apache-doris-fe/conf/fe.conf配置文件，这里我们主要修改两个参数：priority_networks 及 meta_dir。</p> 
<ul><li style="text-align:justify;"><strong><strong>priority_networks:</strong></strong>指定FE唯一的IP地址，必须配置，尤其当节点有多个网卡时要配置正确。</li><li style="text-align:justify;"><strong><strong>meta_dir:</strong></strong>元数据目录，可以不配置，默认是Doris FE安装目录下的doris-meta目录，如果指定其他目录需要提前创建好目录。在生成环境中建议目录放在单独的磁盘上。</li></ul> 
<pre><code class="language-bash"># vim /software/doris-1.2.1/apache-doris-fe/conf/fe.conf
...
meta_dir = /software/doris-1.2.1/apache-doris-fe/doris-meta
priority_networks = 192.168.179.4/24 #注意不同节点IP配置不同
...</code></pre> 
<p style="text-align:justify;"><strong>​​​​​​​​​​​​​​4. 启动FE</strong></p> 
<p style="text-align:justify;">在node1节点FE安装目录下执行如下命令，完成FE的启动。</p> 
<pre><code class="language-bash">#启动FE 
[root@node1 ~]# cd /software/doris-1.2.1/apache-doris-fe/bin
[root@node1 ~]# ./start_fe.sh --daemon</code></pre> 
<p style="text-align:justify;">FE进程启动进入后台执行，日志默认存放在 FE解压目录log/ 下。如启动失败，可以通过查看 log/fe.log 或者 log/fe.out 查看错误信息。</p> 
<p style="text-align:justify;">​​​​​​​5. <strong><strong>访问 FE</strong></strong></p> 
<p style="text-align:justify;">启动Doris FE后，我们可以通过Doris FE 提供的Web UI 来检查是否启动成功，在浏览器中输入：<a href="http://node1:8030" rel="nofollow" title="http://node1:8030，看到如下页面代表FE启动成功。用户名为root，密码为空。">http://node1:8030，看到如下页面代表FE启动成功。用户名为root，密码为空。</a>登录FE后可以查看frontends来查看FOLLOWER信息：</p> 
<p style="text-align:justify;"><img alt="" height="599" src="https://images2.imgbox.com/f5/3c/CP0eTpaC_o.png" width="767"></p> 
<p> <img alt="" height="325" src="https://images2.imgbox.com/7f/cb/t1L0KitM_o.png" width="1200"></p> 
<p> </p> 
<p style="text-align:justify;">通过以上可以看到在node1上启动的Follower成为Leader。</p> 
<p style="text-align:justify;"><strong><strong>6.停止FE</strong></strong></p> 
<p style="text-align:justify;">如果想要停止FE，可以指定如下命令，这里不再进行演示。</p> 
<pre><code class="language-bash">#进入/software/doris-1.2.1/apache-doris-fe/bin目录，执行如下命令：
./stop_fe.sh</code></pre> 
<h2 id="%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B%E2%80%8B"><strong>​​​​​</strong></h2>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fb24d66730fca27704d0d86d4f8c4d44/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">javascript高阶函数的使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b540b0df0a9f46803b4dd6bcd49636c2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">opencv imread图像读取不成功</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>