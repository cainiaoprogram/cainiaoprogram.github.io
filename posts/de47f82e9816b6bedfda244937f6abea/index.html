<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>httpUtil封装工具类 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="httpUtil封装工具类" />
<meta property="og:description" content="import org.apache.commons.io.IOUtils;
import org.apache.http.HttpEntity;
import org.apache.http.HttpResponse;
import org.apache.http.HttpStatus;
import org.apache.http.NameValuePair;
import org.apache.http.client.HttpClient;
import org.apache.http.client.config.RequestConfig;
import org.apache.http.client.entity.UrlEncodedFormEntity;
import org.apache.http.client.methods.CloseableHttpResponse;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.conn.ssl.SSLConnectionSocketFactory;
import org.apache.http.conn.ssl.SSLContextBuilder;
import org.apache.http.conn.ssl.TrustStrategy;
import org.apache.http.conn.ssl.X509HostnameVerifier;
import org.apache.http.entity.StringEntity;
import org.apache.http.impl.client.CloseableHttpClient;
import org.apache.http.impl.client.DefaultHttpClient;
import org.apache.http.impl.client.HttpClients;
import org.apache.http.impl.conn.PoolingHttpClientConnectionManager;
import org.apache.http.message.BasicNameValuePair;
import org.apache.http.util.EntityUtils;
import javax.net.ssl.SSLContext;
import javax.net.ssl.SSLException;
import javax.net.ssl.SSLSession;
import javax.net.ssl.SSLSocket;
import java.io.IOException;
import java.io.InputStream;
import java.nio.charset.Charset;
import java.security.GeneralSecurityException;
import java.security.cert.CertificateException;
import java.security.cert.X509Certificate;
import java.util.ArrayList;
import java.util.HashMap;
import java." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/de47f82e9816b6bedfda244937f6abea/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-08-05T13:04:00+08:00" />
<meta property="article:modified_time" content="2017-08-05T13:04:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">httpUtil封装工具类</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="content" id="articleContent"> 
 <p>import org.apache.commons.io.IOUtils;</p> 
 <p>import org.apache.http.HttpEntity;</p> 
 <p>import org.apache.http.HttpResponse;</p> 
 <p>import org.apache.http.HttpStatus;</p> 
 <p>import org.apache.http.NameValuePair;</p> 
 <p>import org.apache.http.client.HttpClient;</p> 
 <p>import org.apache.http.client.config.RequestConfig;</p> 
 <p>import org.apache.http.client.entity.UrlEncodedFormEntity;</p> 
 <p>import org.apache.http.client.methods.CloseableHttpResponse;</p> 
 <p>import org.apache.http.client.methods.HttpGet;</p> 
 <p>import org.apache.http.client.methods.HttpPost;</p> 
 <p>import org.apache.http.conn.ssl.SSLConnectionSocketFactory;</p> 
 <p>import org.apache.http.conn.ssl.SSLContextBuilder;</p> 
 <p>import org.apache.http.conn.ssl.TrustStrategy;</p> 
 <p>import org.apache.http.conn.ssl.X509HostnameVerifier;</p> 
 <p>import org.apache.http.entity.StringEntity;</p> 
 <p>import org.apache.http.impl.client.CloseableHttpClient;</p> 
 <p>import org.apache.http.impl.client.DefaultHttpClient;</p> 
 <p>import org.apache.http.impl.client.HttpClients;</p> 
 <p>import org.apache.http.impl.conn.PoolingHttpClientConnectionManager;</p> 
 <p>import org.apache.http.message.BasicNameValuePair;</p> 
 <p>import org.apache.http.util.EntityUtils;</p> 
 <p>import javax.net.ssl.SSLContext;</p> 
 <p>import javax.net.ssl.SSLException;</p> 
 <p>import javax.net.ssl.SSLSession;</p> 
 <p>import javax.net.ssl.SSLSocket;</p> 
 <p>import java.io.IOException;</p> 
 <p>import java.io.InputStream;</p> 
 <p>import java.nio.charset.Charset;</p> 
 <p>import java.security.GeneralSecurityException;</p> 
 <p>import java.security.cert.CertificateException;</p> 
 <p>import java.security.cert.X509Certificate;</p> 
 <p>import java.util.ArrayList;</p> 
 <p>import java.util.HashMap;</p> 
 <p>import java.util.List;</p> 
 <p>import java.util.Map;</p> 
 <p>/**</p> 
 <p>* HTTP 请求工具类</p> 
 <p>*</p> 
 <p>* <a href="https://my.oschina.net/arthor" rel="nofollow" class="referer">@author</a> : liii</p> 
 <p>* <a href="https://my.oschina.net/u/931210" rel="nofollow" class="referer">@version</a> : 1.0.0</p> 
 <p>* <a href="https://my.oschina.net/u/2504391" rel="nofollow" class="referer">@date</a> : 2015/7/21</p> 
 <p>* <a href="https://my.oschina.net/weimingwei" rel="nofollow" class="referer">@see</a> : TODO</p> 
 <p>*/</p> 
 <p>public class HttpUtil {<!-- --></p> 
 <p>private static PoolingHttpClientConnectionManager connMgr;</p> 
 <p>private static RequestConfig requestConfig;</p> 
 <p>private static final int MAX_TIMEOUT = 7000;</p> 
 <p>static {<!-- --></p> 
 <p>// 设置连接池</p> 
 <p>connMgr = new PoolingHttpClientConnectionManager();</p> 
 <p>// 设置连接池大小</p> 
 <p>connMgr.setMaxTotal(100);</p> 
 <p>connMgr.setDefaultMaxPerRoute(connMgr.getMaxTotal());</p> 
 <p>RequestConfig.Builder configBuilder = RequestConfig.custom();</p> 
 <p>// 设置连接超时</p> 
 <p>configBuilder.setConnectTimeout(MAX_TIMEOUT);</p> 
 <p>// 设置读取超时</p> 
 <p>configBuilder.setSocketTimeout(MAX_TIMEOUT);</p> 
 <p>// 设置从连接池获取连接实例的超时</p> 
 <p>configBuilder.setConnectionRequestTimeout(MAX_TIMEOUT);</p> 
 <p>// 在提交请求之前 测试连接是否可用</p> 
 <p>configBuilder.setStaleConnectionCheckEnabled(true);</p> 
 <p>requestConfig = configBuilder.build();</p> 
 <p>}</p> 
 <p>/**</p> 
 <p>* 发送 GET 请求（HTTP），不带输入数据</p> 
 <p>* <a href="https://my.oschina.net/u/2303379" rel="nofollow" class="referer">@param</a> url</p> 
 <p>* @return</p> 
 <p>*/</p> 
 <p>public static String doGet(String url) {<!-- --></p> 
 <p>return doGet(url, new HashMap&lt;String, Object&gt;());</p> 
 <p>}</p> 
 <p>/**</p> 
 <p>* 发送 GET 请求（HTTP），K-V形式</p> 
 <p>* @param url</p> 
 <p>* @param params</p> 
 <p>* @return</p> 
 <p>*/</p> 
 <p>public static String doGet(String url, Map&lt;String, Object&gt; params) {<!-- --></p> 
 <p>String apiUrl = url;</p> 
 <p>StringBuffer param = new StringBuffer();</p> 
 <p>int i = 0;</p> 
 <p>for (String key : params.keySet()) {<!-- --></p> 
 <p>if (i == 0)</p> 
 <p>param.append("?");</p> 
 <p>else</p> 
 <p>param.append("&amp;");</p> 
 <p>param.append(key).append("=").append(params.get(key));</p> 
 <p>i++;</p> 
 <p>}</p> 
 <p>apiUrl += param;</p> 
 <p>String result = null;</p> 
 <p>HttpClient httpclient = new DefaultHttpClient();</p> 
 <p>try {<!-- --></p> 
 <p>HttpGet httpPost = new HttpGet(apiUrl);</p> 
 <p>HttpResponse response = httpclient.execute(httpPost);</p> 
 <p>int statusCode = response.getStatusLine().getStatusCode();</p> 
 <p>System.out.println("执行状态码 : " + statusCode);</p> 
 <p>HttpEntity entity = response.getEntity();</p> 
 <p>if (entity != null) {<!-- --></p> 
 <p>InputStream instream = entity.getContent();</p> 
 <p>result = IOUtils.toString(instream, "UTF-8");</p> 
 <p>}</p> 
 <p>} catch (IOException e) {<!-- --></p> 
 <p>e.printStackTrace();</p> 
 <p>}</p> 
 <p>return result;</p> 
 <p>}</p> 
 <p>/**</p> 
 <p>* 发送 POST 请求（HTTP），不带输入数据</p> 
 <p>* @param apiUrl</p> 
 <p>* @return</p> 
 <p>*/</p> 
 <p>public static String doPost(String apiUrl) {<!-- --></p> 
 <p>return doPost(apiUrl, new HashMap&lt;String, Object&gt;());</p> 
 <p>}</p> 
 <p>/**</p> 
 <p>* 发送 POST 请求（HTTP），K-V形式</p> 
 <p>* @param apiUrl API接口URL</p> 
 <p>* @param params 参数map</p> 
 <p>* @return</p> 
 <p>*/</p> 
 <p>public static String doPost(String apiUrl, Map&lt;String, Object&gt; params) {<!-- --></p> 
 <p>CloseableHttpClient httpClient = HttpClients.createDefault();</p> 
 <p>String httpStr = null;</p> 
 <p>HttpPost httpPost = new HttpPost(apiUrl);</p> 
 <p>CloseableHttpResponse response = null;</p> 
 <p>try {<!-- --></p> 
 <p>httpPost.setConfig(requestConfig);</p> 
 <p>List&lt;NameValuePair&gt; pairList = new ArrayList(params.size());</p> 
 <p>for (Map.Entry&lt;String, Object&gt; entry : params.entrySet()) {<!-- --></p> 
 <p>NameValuePair pair = new BasicNameValuePair(entry.getKey(), entry</p> 
 <p>.getValue().toString());</p> 
 <p>pairList.add(pair);</p> 
 <p>}</p> 
 <p>httpPost.setEntity(new UrlEncodedFormEntity(pairList, Charset.forName("UTF-8")));</p> 
 <p>response = httpClient.execute(httpPost);</p> 
 <p>System.out.println(response.toString());</p> 
 <p>HttpEntity entity = response.getEntity();</p> 
 <p>httpStr = EntityUtils.toString(entity, "UTF-8");</p> 
 <p>} catch (IOException e) {<!-- --></p> 
 <p>e.printStackTrace();</p> 
 <p>} finally {<!-- --></p> 
 <p>if (response != null) {<!-- --></p> 
 <p>try {<!-- --></p> 
 <p>EntityUtils.consume(response.getEntity());</p> 
 <p>} catch (IOException e) {<!-- --></p> 
 <p>e.printStackTrace();</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}</p> 
 <p>return httpStr;</p> 
 <p>}</p> 
 <p>/**</p> 
 <p>* 发送 POST 请求（HTTP），JSON形式</p> 
 <p>* @param apiUrl</p> 
 <p>* @param json json对象</p> 
 <p>* @return</p> 
 <p>*/</p> 
 <p>public static String doPost(String apiUrl, Object json) {<!-- --></p> 
 <p>CloseableHttpClient httpClient = HttpClients.createDefault();</p> 
 <p>String httpStr = null;</p> 
 <p>HttpPost httpPost = new HttpPost(apiUrl);</p> 
 <p>CloseableHttpResponse response = null;</p> 
 <p>try {<!-- --></p> 
 <p>httpPost.setConfig(requestConfig);</p> 
 <p>StringEntity stringEntity = new StringEntity(json.toString(),"UTF-8");//解决中文乱码问题</p> 
 <p>stringEntity.setContentEncoding("UTF-8");</p> 
 <p>stringEntity.setContentType("application/json");</p> 
 <p>httpPost.setEntity(stringEntity);</p> 
 <p>response = httpClient.execute(httpPost);</p> 
 <p>HttpEntity entity = response.getEntity();</p> 
 <p>System.out.println(response.getStatusLine().getStatusCode());</p> 
 <p>httpStr = EntityUtils.toString(entity, "UTF-8");</p> 
 <p>} catch (IOException e) {<!-- --></p> 
 <p>e.printStackTrace();</p> 
 <p>} finally {<!-- --></p> 
 <p>if (response != null) {<!-- --></p> 
 <p>try {<!-- --></p> 
 <p>EntityUtils.consume(response.getEntity());</p> 
 <p>} catch (IOException e) {<!-- --></p> 
 <p>e.printStackTrace();</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}</p> 
 <p>return httpStr;</p> 
 <p>}</p> 
 <p>/**</p> 
 <p>* 发送 SSL POST 请求（HTTPS），K-V形式</p> 
 <p>* @param apiUrl API接口URL</p> 
 <p>* @param params 参数map</p> 
 <p>* @return</p> 
 <p>*/</p> 
 <p>public static String doPostSSL(String apiUrl, Map&lt;String, Object&gt; params) {<!-- --></p> 
 <p>CloseableHttpClient httpClient = HttpClients.custom().setSSLSocketFactory(createSSLConnSocketFactory()).setConnectionManager(connMgr).setDefaultRequestConfig(requestConfig).build();</p> 
 <p>HttpPost httpPost = new HttpPost(apiUrl);</p> 
 <p>CloseableHttpResponse response = null;</p> 
 <p>String httpStr = null;</p> 
 <p>try {<!-- --></p> 
 <p>httpPost.setConfig(requestConfig);</p> 
 <p>List&lt;NameValuePair&gt; pairList = new ArrayList&lt;NameValuePair&gt;(params.size());</p> 
 <p>for (Map.Entry&lt;String, Object&gt; entry : params.entrySet()) {<!-- --></p> 
 <p>NameValuePair pair = new BasicNameValuePair(entry.getKey(), entry</p> 
 <p>.getValue().toString());</p> 
 <p>pairList.add(pair);</p> 
 <p>}</p> 
 <p>httpPost.setEntity(new UrlEncodedFormEntity(pairList, Charset.forName("utf-8")));</p> 
 <p>response = httpClient.execute(httpPost);</p> 
 <p>int statusCode = response.getStatusLine().getStatusCode();</p> 
 <p>if (statusCode != HttpStatus.SC_OK) {<!-- --></p> 
 <p>return null;</p> 
 <p>}</p> 
 <p>HttpEntity entity = response.getEntity();</p> 
 <p>if (entity == null) {<!-- --></p> 
 <p>return null;</p> 
 <p>}</p> 
 <p>httpStr = EntityUtils.toString(entity, "utf-8");</p> 
 <p>} catch (Exception e) {<!-- --></p> 
 <p>e.printStackTrace();</p> 
 <p>} finally {<!-- --></p> 
 <p>if (response != null) {<!-- --></p> 
 <p>try {<!-- --></p> 
 <p>EntityUtils.consume(response.getEntity());</p> 
 <p>} catch (IOException e) {<!-- --></p> 
 <p>e.printStackTrace();</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}</p> 
 <p>return httpStr;</p> 
 <p>}</p> 
 <p>/**</p> 
 <p>* 发送 SSL POST 请求（HTTPS），JSON形式</p> 
 <p>* @param apiUrl API接口URL</p> 
 <p>* @param json JSON对象</p> 
 <p>* @return</p> 
 <p>*/</p> 
 <p>public static String doPostSSL(String apiUrl, Object json) {<!-- --></p> 
 <p>CloseableHttpClient httpClient = HttpClients.custom().setSSLSocketFactory(createSSLConnSocketFactory()).setConnectionManager(connMgr).setDefaultRequestConfig(requestConfig).build();</p> 
 <p>HttpPost httpPost = new HttpPost(apiUrl);</p> 
 <p>CloseableHttpResponse response = null;</p> 
 <p>String httpStr = null;</p> 
 <p>try {<!-- --></p> 
 <p>httpPost.setConfig(requestConfig);</p> 
 <p>StringEntity stringEntity = new StringEntity(json.toString(),"UTF-8");//解决中文乱码问题</p> 
 <p>stringEntity.setContentEncoding("UTF-8");</p> 
 <p>stringEntity.setContentType("application/json");</p> 
 <p>httpPost.setEntity(stringEntity);</p> 
 <p>response = httpClient.execute(httpPost);</p> 
 <p>int statusCode = response.getStatusLine().getStatusCode();</p> 
 <p>if (statusCode != HttpStatus.SC_OK) {<!-- --></p> 
 <p>return null;</p> 
 <p>}</p> 
 <p>HttpEntity entity = response.getEntity();</p> 
 <p>if (entity == null) {<!-- --></p> 
 <p>return null;</p> 
 <p>}</p> 
 <p>httpStr = EntityUtils.toString(entity, "utf-8");</p> 
 <p>} catch (Exception e) {<!-- --></p> 
 <p>e.printStackTrace();</p> 
 <p>} finally {<!-- --></p> 
 <p>if (response != null) {<!-- --></p> 
 <p>try {<!-- --></p> 
 <p>EntityUtils.consume(response.getEntity());</p> 
 <p>} catch (IOException e) {<!-- --></p> 
 <p>e.printStackTrace();</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}</p> 
 <p>return httpStr;</p> 
 <p>}</p> 
 <p>/**</p> 
 <p>* 创建SSL安全连接</p> 
 <p>*</p> 
 <p>* @return</p> 
 <p>*/</p> 
 <p>private static SSLConnectionSocketFactory createSSLConnSocketFactory() {<!-- --></p> 
 <p>SSLConnectionSocketFactory sslsf = null;</p> 
 <p>try {<!-- --></p> 
 <p>SSLContext sslContext = new SSLContextBuilder().loadTrustMaterial(null, new TrustStrategy() {<!-- --></p> 
 <p>public boolean isTrusted(X509Certificate[] chain, String authType) throws CertificateException {<!-- --></p> 
 <p>return true;</p> 
 <p>}</p> 
 <p>}).build();</p> 
 <p>sslsf = new SSLConnectionSocketFactory(sslContext, new X509HostnameVerifier() {<!-- --></p> 
 <p>@Override</p> 
 <p>public boolean verify(String arg0, SSLSession arg1) {<!-- --></p> 
 <p>return true;</p> 
 <p>}</p> 
 <p>@Override</p> 
 <p>public void verify(String host, SSLSocket ssl) throws IOException {<!-- --></p> 
 <p>}</p> 
 <p>@Override</p> 
 <p>public void verify(String host, X509Certificate cert) throws SSLException {<!-- --></p> 
 <p>}</p> 
 <p>@Override</p> 
 <p>public void verify(String host, String[] cns, String[] subjectAlts) throws SSLException {<!-- --></p> 
 <p>}</p> 
 <p>});</p> 
 <p>} catch (GeneralSecurityException e) {<!-- --></p> 
 <p>e.printStackTrace();</p> 
 <p>}</p> 
 <p>return sslsf;</p> 
 <p>}</p> 
 <p>/**</p> 
 <p>* 测试方法</p> 
 <p>* @param args</p> 
 <p>*/</p> 
 <p>public static void main(String[] args) throws Exception {<!-- --></p> 
 <p>String doPost = HttpUtil.doPost("https://api.it120.cc/mingyuan/shop/goods/fav/list", "");</p> 
 <p>System.out.println(doPost);</p> 
 <p>}</p> 
 <p>}</p> 
</div> 
<p>转载于:https://my.oschina.net/u/728148/blog/1503221</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/83c60a48159b9e968aa5a787dc980869/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">一个移植十分方便的malloc函数族的实现</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f9f5fd3fe3e489f2e704d69617b7be6a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">时间数据统计~获得当前24小时时间段</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>