<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux中jsoncpp的编译使用 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux中jsoncpp的编译使用" />
<meta property="og:description" content="旧版jsoncpp编译 1、预备条件：
JsonCPP类库http://sourceforge.net/projects/jsoncpp/?source=dlp SCONS编译器http://sourceforge.net/projects/scons/?source=dlp Pythonhttp://www.python.org/ JsonCPP类库需要Scons编译器来编译，而Scons需要Python安装了才能使用。具体安装步骤请参见文件夹下的ReadMe文件。
2、
安装scons:
sudo apt-get install scons
解包jsoncpp:
tar -zxf jsoncpp-src-0.5.0.tar.gz
jsoncpp安装：
解包后进入其目录。输入以下命令：
scons platform=linux-gcc 就会安装成功
3、
上述已经完成jsoncpp的编译，在解压目录jsoncpp-src-0.5.0/libs/linux-gcc-7/下可以看到生成了两个文件：
libjson_linux-gcc-7_libmt.a libjson_linux-gcc-7_libmt.so 把.a 和.so 文件拷贝到/usrl/lib 目录下（参考了不同资料，说法并不统一，有的是拷贝到/lib下，有的则是/usr/local/lib），可以为了方便编译给它改个名字libjsoncpp.a
同样，将解包目录下的（jsoncpp-src-0.5.0）的include拷贝到/usr/lib下面。
sudo mv include/json/ /usr/include/
代码测试：
#include&lt;json/json.h&gt; #include&lt;iostream&gt; using namespace std; int main(int argc, char** argv) { Json::Value root; Json::FastWriter fast; root[&#34;ModuleType&#34;]= Json::Value(&#34;你好&#34;); root[&#34;ModuleCode&#34;]= Json::Value(&#34;22&#34;); root[&#34;ModuleDesc&#34;]= Json::Value(&#34;33&#34;); root[&#34;DateTime&#34;]= Json::Value(&#34;44&#34;); root[&#34;LogType&#34;]= Json::Value(&#34;55&#34;); cout&lt;&lt;fast.write(root)&lt;&lt;endl; return 0; } 编译的语句：
huqin@ubuntu:~/bstr/json$ g&#43;&#43; main.cpp -o main -L/home/huqin/bstr/json/Deps/lib32/libjsoncpp." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/068ed1c644137cc1772661ea5e87633c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-15T14:44:38+08:00" />
<meta property="article:modified_time" content="2022-08-15T14:44:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux中jsoncpp的编译使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>旧版jsoncpp编译</h4> 
<p>1、预备条件：</p> 
<pre><code class="language-cpp">JsonCPP类库http://sourceforge.net/projects/jsoncpp/?source=dlp
SCONS编译器http://sourceforge.net/projects/scons/?source=dlp
Pythonhttp://www.python.org/</code></pre> 
<p>JsonCPP类库需要Scons编译器来编译，而Scons需要Python安装了才能使用。具体安装步骤请参见文件夹下的ReadMe文件。</p> 
<p>2、</p> 
<p>安装scons:</p> 
<blockquote> 
 <p>sudo apt-get install scons</p> 
</blockquote> 
<p>解包jsoncpp:</p> 
<blockquote> 
 <p>tar -zxf jsoncpp-src-0.5.0.tar.gz</p> 
</blockquote> 
<p>jsoncpp安装：</p> 
<p>解包后进入其目录。输入以下命令：</p> 
<blockquote> 
 <p>scons platform=linux-gcc 就会安装成功</p> 
</blockquote> 
<p></p> 
<p>3、</p> 
<p>上述已经完成jsoncpp的编译，在解压目录jsoncpp-src-0.5.0/libs/linux-gcc-7/下可以看到生成了两个文件：</p> 
<pre><code class="language-cpp">libjson_linux-gcc-7_libmt.a

libjson_linux-gcc-7_libmt.so</code></pre> 
<p>把.a 和.so 文件拷贝到/usrl/lib 目录下（参考了不同资料，说法并不统一，有的是拷贝到/lib下，有的则是/usr/local/lib），可以为了方便编译给它改个名字libjsoncpp.a</p> 
<p>同样，将解包目录下的（jsoncpp-src-0.5.0）的include拷贝到/usr/lib下面。</p> 
<blockquote> 
 <p>sudo mv include/json/ /usr/include/</p> 
</blockquote> 
<p>代码测试：</p> 
<pre><code class="language-cpp">#include&lt;json/json.h&gt;
#include&lt;iostream&gt;
using namespace std;
 
int main(int argc, char** argv)
{
 
Json::Value root;
Json::FastWriter fast;
root["ModuleType"]= Json::Value("你好");
root["ModuleCode"]= Json::Value("22");
root["ModuleDesc"]= Json::Value("33");
root["DateTime"]= Json::Value("44");
root["LogType"]= Json::Value("55");
cout&lt;&lt;fast.write(root)&lt;&lt;endl;
return 0;
}</code></pre> 
<p>编译的语句：</p> 
<pre><code class="language-cpp">huqin@ubuntu:~/bstr/json$ g++ main.cpp -o main -L/home/huqin/bstr/json/Deps/lib32/libjsoncpp.a /home/huqin/bstr/json/Deps/lib32/libjsoncpp.a</code></pre> 
<p>运行结果：</p> 
<pre><code class="language-cpp">huqin@ubuntu:~/bstr/json$ ./main
{"DateTime":"44","LogType":"55","ModuleCode":"22","ModuleDesc":"33","ModuleType":"▒▒▒"}

huqin@ubuntu:~/bstr/json$</code></pre> 
<h4>新版jsoncpp编译</h4> 
<p> github地址：<a href="https://github.com/open-source-parsers/jsoncpp" title="GitHub - open-source-parsers/jsoncpp: A C++ library for interacting with JSON.">GitHub - open-source-parsers/jsoncpp: A C++ library for interacting with JSON.</a></p> 
<p><strong>## 使用源文件编译未编库</strong></p> 
<p>在github上下载好以后，在命令行下进入该项目所在的地址，直接执行python amalgamate.py命令，会在dist目录下生成两个头文件和一个源文件json-forwards.h 、json.h和jsoncpp.cpp。因为jsoncpp源码就四五千行，直接放在jsconcpp.cpp中和工程中其他代码一起编译也比较方便。</p> 
<pre><code class="language-cpp">huqin@ubuntu:~/bstr/json/jsoncpp-master$ ./amalgamate.py</code></pre> 
<pre><code class="language-cpp">#include &lt;iostream&gt;
#include "json/json.h"
using namespace std;

//封装json类
class JsonParse
{
public:
    JsonParse(Json::Value J)
    :m_json(J)
    {};
    JsonParse(const void *V)
    :m_str(V ? (const char*)V : "")
    {};
    JsonParse(const char *S)
    :m_str(S ? S : "")
    {};
    JsonParse(const char *S, int L)
    :m_str(S ? S : "", S ? L : 0)
    {};
    JsonParse(std::string S)
    :m_str(S)
    {};
    virtual ~JsonParse(){};

public:
    std::string toString(const char* indent="")
    {
        if(m_json.isObject() &amp;&amp; m_json.getMemberNames().size() == 0)
            return "";
        else if(m_json.isString())
            return m_json.asString();

        Json::StreamWriterBuilder builder;
        if(indent)
            builder["indentation"] = indent; //The JSON document is written in a single line if indent == ""
        return Json::writeString(builder, m_json);
    };
    const char* toCString(const char* indent="")
    {
        m_str = toString(indent);
        return m_str.c_str();
    };

    bool toJson(Json::Value &amp;J)
    {
        bool ret = false;
        JSONCPP_STRING errs;
        Json::CharReaderBuilder builder;
        Json::CharReaderBuilder::strictMode(&amp;builder.settings_);
        //builder["collectComments"] = false; // true = 允许在反序列化的时候保存注释，然后在序列化的时候写回注释
        Json::CharReader* reader = builder.newCharReader();
        ret = reader-&gt;parse(m_str.data(), m_str.data() + m_str.size(), &amp;J, &amp;errs);
        if(!ret || !errs.empty())
            cout&lt;&lt;"error、"&lt;&lt;endl;
        if(reader){delete reader;reader = NULL;}
        return ret;
    }

    std::string formatMinSize()
    {
        /*
         * 仅支持构造入参为字符串的形式
         * 如果是Json::Value的构造形式，可以直接格式化成指定的indent
        */
        if(!m_str.empty())
            toJson(m_json);
        return toString();
    }

private:
    std::string m_str;
    Json::Value m_json;
};

int main(int argc, char *argv[])
{

    Json::Value boot;
    /* const char* / std::string -&gt; JSON (除了首尾的分号其他分号必须加转义字符否则格式错误)*/
    JsonParse("{ \"datatype\":1,\"sessionId\" : 55,\"streamId\" : 55 ,\"string\" : \"sting recv\" }").toJson(boot);
    cout&lt;&lt;"string:" &lt;&lt;boot["string"].asCString() &lt;&lt;endl;

    return 0;
}
//运行结果：
huqin@ubuntu:~/bstr/json$ g++ main.cpp jsoncpp.cpp -o newmain
huqin@ubuntu:~/bstr/json$ ./newmain
string:sting recv</code></pre> 
<p><strong>## 使用源码编译库使用</strong></p> 
<p>准备工作下载cmake编译工具</p> 
<pre><code class="language-cpp">卸载旧版cmake: $ sudo apt-get autoremove cmake
文件下载：$ wget https://cmake.org/files/v3.12/cmake-3.12.2-Linux-x86_64.tar.gz
解压：$ tar zxvf cmake-3.12.2-Linux-x86_64.tar.gz
创建软连接：先检查解压后的cmake文件路径，我的在/home/huqin/bstr/json/下:
sudo ln -sf /home/huqin/bstr/json/cmake-3.12.2-Linux-x86_64/bin/*  /usr/bin/
能检查出cmake --version说明cmake安装成功: $ cmake --version</code></pre> 
<p>下载camke可以编译版本： <a href="https://github.com/open-source-parsers/jsoncpp/tree/00.11.z" title="GitHub - open-source-parsers/jsoncpp at 00.11.z">GitHub - open-source-parsers/jsoncpp at 00.11.z</a></p> 
<pre><code class="language-cpp">//解压
unzip jsoncpp-00.11.z.zip
//进入目录使用cmake生成Makefile
cd jsoncpp-00.11.z/
cmake CMakeLists.txt
//编译生成库
make</code></pre> 
<p><img alt="" height="175" src="https://images2.imgbox.com/66/11/KuMALwpe_o.png" width="398"></p> 
<p>编译上面测试用例：</p> 
<pre><code class="language-cpp">使用静态库直接连接动态库路径
g++ main.cpp -o libmain /home/huqin/bstr/json/jsoncpp-00.11.z/lib/libjsoncpp_static.a
使用动态库首先将动态库拷贝到可检测目录
sudo cp /home/huqin/bstr/json/jsoncpp-00.11.z/lib/libjsoncpp.so /usr/local/lib/
g++ main.cpp -o libmain -ljsoncpp
huqin@ubuntu:~/bstr/json$ ./libmain
string:sting recv</code></pre> 
<p>整体测试demo包含生成的库及jsoncpp、cmake源码:</p> 
<p>链接：https://pan.baidu.com/s/1xeS4OTGfvDKsTrqkmraJgg</p> 
<p>提取码：ykju</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6c9e03efee6f102d82b1c4fdd4951a03/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">linux文件结构浅析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4242ada434a025dcf1bbf6adec5fa9ca/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">使用 virtualBox 安装 ubuntu</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>