<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>coverage代码覆盖率测试介绍 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="coverage代码覆盖率测试介绍" />
<meta property="og:description" content="coverage代码覆盖率测试介绍 背景知识补充 1、什么是覆盖率
测试过程中提到的覆盖率，指的是已测试的内容，占待测内容的百分比，在一定程度上反应测试的完整程度。
覆盖率有可以根据要衡量的对象细分很多种，比如接口覆盖率、分支覆盖率、行覆盖率等等
2、做覆盖率有什么用处
覆盖率的好处是可以将测试的完整性量化，可以作为补充测试的手段，也可以在一定程度上佐证测试结果的可靠性。
简介 代码覆盖率测量通常用于衡量测试的有效性。它可以显示你的代码的哪些部分正在被测试执行，哪些没有被执行。
coverage是一个测量 Python 程序代码覆盖率的工具。它监视你的程序，并分析源码生成代码覆盖率报告。
安装 coverage依赖python环境
python环境安装：https://computingforgeeks.com/install-latest-python-on-centos-linux/
安装coverage
python3 -m pip install coverage or pip3 install coverage 安装完成
coverage --version Coverage.py, version 7.2.5 with C extension Full documentation is at https://coverage.readthedocs.io/en/7.2.5 命令概览 coverage支持命令如下
[yhgao@localhost ~]$ coverage --help Coverage.py, version 7.2.5 with C extension Measure, collect, and report on code coverage in Python programs. usage: coverage &lt;command&gt; [options] [args] Commands: annotate Annotate source files with execution information." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/698580151a6ba5c3e66118ba2a7303a0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-19T17:07:13+08:00" />
<meta property="article:modified_time" content="2023-06-19T17:07:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">coverage代码覆盖率测试介绍</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="coverage_0"></a>coverage代码覆盖率测试介绍</h2> 
<h4><a id="_2"></a>背景知识补充</h4> 
<p>1、什么是覆盖率</p> 
<p>测试过程中提到的覆盖率，指的是已测试的内容，占待测内容的百分比，在一定程度上反应测试的完整程度。</p> 
<p>覆盖率有可以根据要衡量的对象细分很多种，比如接口覆盖率、分支覆盖率、行覆盖率等等</p> 
<p>2、做覆盖率有什么用处</p> 
<p>覆盖率的好处是可以将测试的完整性量化，可以作为补充测试的手段，也可以在一定程度上佐证测试结果的可靠性。</p> 
<hr> 
<h4><a id="_16"></a>简介</h4> 
<p>代码覆盖率测量通常用于衡量测试的有效性。它可以显示你的代码的哪些部分正在被测试执行，哪些没有被执行。</p> 
<p>coverage是一个测量 Python 程序代码覆盖率的工具。它监视你的程序，并分析源码生成代码覆盖率报告。</p> 
<hr> 
<h4><a id="_24"></a>安装</h4> 
<p>coverage依赖python环境</p> 
<p>python环境安装：https://computingforgeeks.com/install-latest-python-on-centos-linux/</p> 
<p>安装coverage</p> 
<pre><code>python3 -m pip install coverage
or
pip3 install coverage
</code></pre> 
<p>安装完成</p> 
<pre><code>coverage --version
Coverage.py, version 7.2.5 with C extension
Full documentation is at https://coverage.readthedocs.io/en/7.2.5
</code></pre> 
<hr> 
<h4><a id="_50"></a>命令概览</h4> 
<p>coverage支持命令如下</p> 
<pre><code>[yhgao@localhost ~]$ coverage --help
Coverage.py, version 7.2.5 with C extension
Measure, collect, and report on code coverage in Python programs.

usage: coverage &lt;command&gt; [options] [args]

Commands:
    annotate    Annotate source files with execution information.
    combine     Combine a number of data files.
    debug       Display information about the internals of coverage.py
    erase       Erase previously collected coverage data.
    help        Get help on using coverage.py.
    html        Create an HTML report.
    json        Create a JSON report of coverage results.
    lcov        Create an LCOV report of coverage results.
    report      Report coverage stats on modules.
    run         Run a Python program and measure code execution.
    xml         Create an XML report of coverage results.

Use "coverage help &lt;command&gt;" for detailed help on any command.
Full documentation is at https://coverage.readthedocs.io/en/7.2.5
</code></pre> 
<p>其中每个小命令后面可以查看更详细的帮助， 以run命令举例</p> 
<pre><code>[yhgao@localhost ~]$ coverage run --help
Usage: coverage run [options] &lt;pyfile&gt; [program options]

Run a Python program, measuring code execution.

Options:
  -a, --append          Append coverage data to .coverage, otherwise it starts
                        clean each time.
  --branch              Measure branch coverage in addition to statement
                        coverage.
  --concurrency=LIBS    Properly measure code using a concurrency library.
                        Valid values are: eventlet, gevent, greenlet,
                        multiprocessing, thread, or a comma-list of them.
  --context=LABEL       The context label to record for this coverage run.
  --data-file=OUTFILE   Write the recorded coverage data to this file.
                        Defaults to '.coverage'. [env: COVERAGE_FILE]
  --include=PAT1,PAT2,...
                        Include only files whose paths match one of these
                        patterns. Accepts shell-style wildcards, which must be
                        quoted.
  -m, --module          &lt;pyfile&gt; is an importable Python module, not a script
                        path, to be run as 'python -m' would run it.
  --omit=PAT1,PAT2,...  Omit files whose paths match one of these patterns.
                        Accepts shell-style wildcards, which must be quoted.
  -L, --pylib           Measure coverage even inside the Python installed
                        library, which isn't done by default.
  -p, --parallel-mode   Append the machine name, process id and random number
                        to the data file name to simplify collecting data from
                        many processes.
  --source=SRC1,SRC2,...
                        A list of directories or importable names of code to
                        measure.
  --timid               Use a simpler but slower trace method. Try this if you
                        get seemingly impossible results!
  --debug=OPTS          Debug options, separated by commas. [env:
                        COVERAGE_DEBUG]
  -h, --help            Get help on this command.
  --rcfile=RCFILE       Specify configuration file. By default '.coveragerc',
                        'setup.cfg', 'tox.ini', and 'pyproject.toml' are
                        tried. [env: COVERAGE_RCFILE]

Full documentation is at https://coverage.readthedocs.io/en/7.2.5
</code></pre> 
<hr> 
<h4><a id="_127"></a>快速使用</h4> 
<p>如果你的测试运行程序命令以“python”开头，只需将初始的“python”替换为“coverage run”即可。</p> 
<pre><code>python something.py --&gt;&gt; becomes --&gt;&gt; coverage run something.py

python -m amodule --&gt;&gt; becomes --&gt;&gt; coverage run -m amodule
</code></pre> 
<p>python其他单元测试框架</p> 
<pre><code>pytest
pytest arg1 arg2 arg3 --&gt;&gt; becomes --&gt;&gt; coverage run -m pytest arg1 arg2 arg3

unittest
python -m unittest discover --&gt;&gt; becomes --&gt;&gt;  coverage run -m unittest discover

nosetest
nosetests arg1 arg2 --&gt;&gt; becomes --&gt;&gt; coverage run -m nose arg1 arg2
</code></pre> 
<p><strong>测试完成后会在当前目录下默认生成一个<code>.coverage</code>文件，这里面保存了代码覆盖率结果，也可以通过–data-file生成指定名称的文件</strong></p> 
<p><strong>直接查看</strong></p> 
<p><code>coverage report</code></p> 
<pre><code>$ coverage report -m
Name                      Stmts   Miss  Cover   Missing
-------------------------------------------------------
my_program.py                20      4    80%   33-35, 39
my_other_module.py           56      6    89%   17-23
-------------------------------------------------------
TOTAL                        76     10    87%
</code></pre> 
<p><strong>其他查看方式</strong></p> 
<p>使用其他格式查看，例如html，会生成html文件，使用浏览器打开index.html即可查看</p> 
<pre><code>coverage html

[yhgao@localhost coverage]$ coverage html
Wrote HTML report to htmlcov/index.html
[yhgao@localhost coverage]$ ll
总用量 4
-rw-rw-r-- 1 yhgao yhgao 679 6月  15 16:49 demo.py
drwxrwxr-x 2 yhgao yhgao 190 6月  15 16:51 htmlcov

[yhgao@localhost coverage]$ cd htmlcov/
[yhgao@localhost htmlcov]$ ls -al
总用量 92
drwxrwxr-x 2 yhgao yhgao   190 6月  15 16:51 .
drwxrwxr-x 3 yhgao yhgao    53 6月  15 16:51 ..
-rw-rw-r-- 1 yhgao yhgao 21359 6月  15 16:51 coverage_html.js
-rw-rw-r-- 1 yhgao yhgao 11790 6月  15 16:51 demo_py.html
-rw-rw-r-- 1 yhgao yhgao  1732 6月  15 16:51 favicon_32.png
-rw-rw-r-- 1 yhgao yhgao    27 6月  15 16:51 .gitignore
-rw-rw-r-- 1 yhgao yhgao  3816 6月  15 16:51 index.html  //浏览器打开该文件
-rw-rw-r-- 1 yhgao yhgao  9004 6月  15 16:51 keybd_closed.png
-rw-rw-r-- 1 yhgao yhgao  9003 6月  15 16:51 keybd_open.png
-rw-rw-r-- 1 yhgao yhgao   236 6月  15 16:51 status.json
-rw-rw-r-- 1 yhgao yhgao 12387 6月  15 16:51 style.css
</code></pre> 
<hr> 
<h4><a id="Demo_202"></a>Demo</h4> 
<p>下面以一个demo.py举例</p> 
<p>测试目标（%）：100</p> 
<p>测试case数量（个）：3</p> 
<pre><code>//查看demo文件
[yhgao@bogon coverage]$ cat demo.py
import sys

num = int(sys.argv[1])
if num == 1:
        print('output num: 1')
else:
        if num == 2:
                print('output num: 2')
        elif (num &gt; 2 or num &lt; 1):
                print('error input num')
                
//python执行结果
[yhgao@bogon coverage]$ python demo.py 1
output num: 1
[yhgao@bogon coverage]$ python demo.py 2
output num: 2
[yhgao@bogon coverage]$ python demo.py 3
error input num

//coverage执行代码覆盖率（区分单个case情况）
[yhgao@bogon coverage]$ coverage run --data-file=c1 demo.py 1
output num: 1
[yhgao@bogon coverage]$ coverage run --data-file=c2 demo.py 2
output num: 2
[yhgao@bogon coverage]$ coverage run --data-file=c3 demo.py 3
error input num

//查看每个代码覆盖率文件
[yhgao@bogon coverage]$ coverage report --data-file=c1
Name      Stmts   Miss  Cover
-----------------------------
demo.py       8      4    50%
-----------------------------
TOTAL         8      4    50%
[yhgao@bogon coverage]$ coverage report --data-file=c2
Name      Stmts   Miss  Cover
-----------------------------
demo.py       8      3    62%
-----------------------------
TOTAL         8      3    62%
[yhgao@bogon coverage]$ coverage report --data-file=c3
Name      Stmts   Miss  Cover
-----------------------------
demo.py       8      2    75%
-----------------------------
TOTAL         8      2    75%

//合并代码覆盖率文件
[yhgao@bogon coverage]$ coverage combine --data-file=cc c1 c2 c3
Combined data file c1
Combined data file c2
Combined data file c3

//查看合并后的代码覆盖率文件
[yhgao@bogon coverage]$ coverage report --data-file=cc
Name      Stmts   Miss  Cover
-----------------------------
demo.py       8      0   100%
-----------------------------
TOTAL         8      0   100%

可以看到整合之后的代码覆盖率达到100%，我们也就可以据此判断我们的3个测试case是符合要求的。

//coverage执行代码覆盖率（不区分单个case情况）
未指定-a的情况：
[yhgao@bogon coverage]$ coverage run --data-file=cc2 demo.py 1
output num: 1
[yhgao@bogon coverage]$ coverage run --data-file=cc2 demo.py 2
output num: 2
[yhgao@bogon coverage]$ coverage run --data-file=cc2 demo.py 3
error input num
[yhgao@bogon coverage]$ coverage report --data-file=cc2
Name      Stmts   Miss  Cover
-----------------------------
demo.py       8      2    75%
-----------------------------
TOTAL         8      2    75%

代码覆盖率是会被覆盖的，所以只保留最后一个case的代码覆盖率

指定-a的情况：
[yhgao@bogon coverage]$ coverage run -a --data-file=cc2 demo.py 1
output num: 1
[yhgao@bogon coverage]$ coverage run -a --data-file=cc2 demo.py 2
output num: 2
[yhgao@bogon coverage]$ coverage run -a --data-file=cc2 demo.py 3
error input num
[yhgao@bogon coverage]$ coverage report --data-file=cc2
Name      Stmts   Miss  Cover
-----------------------------
demo.py       8      0   100%
-----------------------------
TOTAL         8      0   100%

指定-a和同一个data-file即可不用执行coverage combine，直接得到一份儿完整的代码覆盖率文件
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9776e05b8bdf977843d8330e6933ad75/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">k8s部署redis集群</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e089e724f86940b8bf64bfc5260174fb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IP地址与Mac地址的关系与区别 - 学习/实践</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>