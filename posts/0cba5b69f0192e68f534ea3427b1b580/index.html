<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>neo4j-Py2neo使用 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="neo4j-Py2neo使用" />
<meta property="og:description" content="neo4j-Py2neo(一)：基本库介绍使用 py2neo的文档地址：https://neo4j-contrib.github.io/py2neo/
py2neo的本质是可以采用两种方式进行操作，一种是利用cypher语句，一种是使用库提供的DataTypes，Data类的实例需要和远程的数据库中一一对应。
类说明Core Graph API直接可以直接从py2neo引用的几个核心类。负责具体执行提交的类。Data Typesneo4j的核心，节点关系等。也就是py2neo.data，这个类下面的所有成员都可以直接从py2neo引用。Cyphercypher语言执行后的结果如何访问，在这个类中。Bulk批量执行cypher语句。Object-Graph Mapping将图谱映射到python类中，比如整个数据库，已知节点。 from py2neo import Graph graph = Graph(&#34;bolt://localhost:7687&#34;, auth=(&#34;neo4j&#34;, &#34;password&#34;)) # 不指定name, 就用默认数据库 graph.run(&#34;UNWIND range(1, 3) AS n RETURN n, n * n as n_sq&#34;) Node 1, 创建节点 ,Node(*labels, **properties)。节点就是两个部分组成：标签、属性。
from py2neo import Node # 或者 from py2neo.data import Node a = Node(&#39;Person&#39;, name=&#39;alice&#39;) b = Node(*[&#39;Person&#39;, &#39;Man&#39;, &#39;Manager&#39;], **{&#39;name&#39;:&#39;Joey&#39;}) # 查看标签 list(a.labels) # 是否具有标签 a.has_label() # 添加标签 a.add_label(&#39;Woman&#39;) # 删除标签 a.remove_label(&#39;Person&#39;) # 删除所有标签 a." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0cba5b69f0192e68f534ea3427b1b580/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-19T20:54:57+08:00" />
<meta property="article:modified_time" content="2023-12-19T20:54:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">neo4j-Py2neo使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h5><a id="neo4jPy2neo_0"></a>neo4j-Py2neo(一)：基本库介绍使用</h5> 
<p>py2neo的文档地址：https://neo4j-contrib.github.io/py2neo/</p> 
<p>py2neo的本质是可以采用两种方式进行操作，一种是利用cypher语句，一种是使用库提供的DataTypes，Data类的实例需要和远程的数据库中一一对应。</p> 
<table><thead><tr><th align="left">类</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">Core Graph API</td><td align="left">直接可以直接从py2neo引用的几个核心类。负责具体执行提交的类。</td></tr><tr><td align="left">Data Types</td><td align="left">neo4j的核心，节点关系等。也就是py2neo.data，这个类下面的所有成员都可以直接从py2neo引用。</td></tr><tr><td align="left">Cypher</td><td align="left">cypher语言执行后的结果如何访问，在这个类中。</td></tr><tr><td align="left">Bulk</td><td align="left">批量执行cypher语句。</td></tr><tr><td align="left">Object-Graph Mapping</td><td align="left">将图谱映射到python类中，比如整个数据库，已知节点。</td></tr></tbody></table> 
<pre><code class="prism language-python"><span class="token keyword">from</span> py2neo <span class="token keyword">import</span> Graph
graph <span class="token operator">=</span> Graph<span class="token punctuation">(</span><span class="token string">"bolt://localhost:7687"</span><span class="token punctuation">,</span> auth<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">"neo4j"</span><span class="token punctuation">,</span> <span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 不指定name, 就用默认数据库</span>
graph<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">"UNWIND range(1, 3) AS n RETURN n, n * n as n_sq"</span><span class="token punctuation">)</span>
</code></pre> 
<h6><a id="Node_22"></a>Node</h6> 
<p>1, 创建节点 ,Node(*labels, **properties)。节点就是两个部分组成：标签、属性。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> py2neo <span class="token keyword">import</span> Node <span class="token comment"># 或者 from py2neo.data import Node</span>
a <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'alice'</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">[</span><span class="token string">'Person'</span><span class="token punctuation">,</span> <span class="token string">'Man'</span><span class="token punctuation">,</span> <span class="token string">'Manager'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">**</span><span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'Joey'</span><span class="token punctuation">}</span><span class="token punctuation">)</span> 

<span class="token comment"># 查看标签</span>
<span class="token builtin">list</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>labels<span class="token punctuation">)</span>

<span class="token comment"># 是否具有标签</span>
a<span class="token punctuation">.</span>has_label<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 添加标签</span>
a<span class="token punctuation">.</span>add_label<span class="token punctuation">(</span><span class="token string">'Woman'</span><span class="token punctuation">)</span>

<span class="token comment"># 删除标签</span>
a<span class="token punctuation">.</span>remove_label<span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">)</span>

<span class="token comment"># 删除所有标签</span>
a<span class="token punctuation">.</span>clear_labels<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 添加多个标签</span>
a<span class="token punctuation">.</span>update_labels<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'Coder'</span><span class="token punctuation">,</span> <span class="token string">'Mother'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


<span class="token comment"># 查看属性</span>
a<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span>
a<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'John'</span><span class="token punctuation">)</span>
<span class="token comment"># 属性赋值</span>
a<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Pheebe'</span>

<span class="token comment"># 如果没有属性，就赋予属性默认值。如果有保持原属性值。</span>
a<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'john'</span><span class="token punctuation">)</span>

<span class="token comment"># 添加属性,如果存在更新属性</span>
a<span class="token punctuation">.</span>update<span class="token punctuation">(</span>age<span class="token operator">=</span><span class="token number">29</span><span class="token punctuation">,</span> love<span class="token operator">=</span><span class="token string">'football'</span><span class="token punctuation">)</span> <span class="token comment"># 或者 a.update(**{'age':29, 'love':'football'})</span>

<span class="token comment"># 删除属性</span>
<span class="token keyword">del</span> a<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span>

<span class="token comment"># 属性数量</span>
<span class="token builtin">len</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>

<span class="token comment"># 字典形式返回属性，以及具有字典类似的属性</span>
<span class="token builtin">dict</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>
a<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span>
a<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span>
a<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 删除所有属性</span>
a<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 查看对应的数据库</span>
a<span class="token punctuation">.</span>graph <span class="token comment"># 如果时None表示a还没有和远程数据库有链接。</span>

<span class="token comment"># 查看节点对应数据库中的唯一身份</span>
a<span class="token punctuation">.</span>identity
</code></pre> 
<h6><a id="RelationShip_86"></a>RelationShip</h6> 
<p>创建关系：</p> 
<p><em>class</em> py2neo.data.<strong>Relationship</strong>(<em>start_node</em>, <em>type</em>, <em>end_node</em>, **<em>properties</em>)[<a href="https://neo4j-contrib.github.io/py2neo/_modules/py2neo/data.html#Relationship" rel="nofollow">source]</a></p> 
<p><em>class</em> py2neo.data.<strong>Relationship</strong>(<em>start_node</em>, <em>end_node</em>, **<em>properties</em>)</p> 
<p><em>class</em> py2neo.data.<strong>Relationship</strong>(<em>node</em>, <em>type</em>, **<em>properties</em>)</p> 
<p><em>class</em> py2neo.data.<strong>Relationship</strong>(<em>node</em>, **<em>properties</em>)</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> py2neo <span class="token keyword">import</span> Relationship<span class="token punctuation">,</span> Node
<span class="token comment"># 创建三种方式</span>
start <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token string">'Man'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'Ross'</span><span class="token punctuation">)</span>
end <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token string">'Woman'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'Richiel'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Love</span><span class="token punctuation">(</span>Relationship<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">pass</span> <span class="token comment"># 先指定是啥关系</span>
rl_1 <span class="token operator">=</span> Love<span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">)</span>

love <span class="token operator">=</span> Relationship<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token punctuation">(</span><span class="token string">'Love'</span><span class="token punctuation">)</span> <span class="token comment"># 先制定是啥关系</span>
rl_2 <span class="token operator">=</span> love<span class="token punctuation">(</span>start<span class="token punctuation">,</span> end<span class="token punctuation">,</span> <span class="token punctuation">)</span>

<span class="token comment"># 一般常用的就是这个。</span>
rl_3 <span class="token operator">=</span> Relationship<span class="token punctuation">(</span>start<span class="token punctuation">,</span> <span class="token string">'Love'</span><span class="token punctuation">,</span> end<span class="token punctuation">,</span>  <span class="token operator">**</span><span class="token punctuation">{<!-- --></span><span class="token string">'retain'</span><span class="token operator">=</span><span class="token string">'two season'</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment"># 如果不指定type，类型就是''</span>

<span class="token comment"># 查看关系的名称</span>
rl_1<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token punctuation">.</span>__name__

<span class="token comment"># 查看关系开始结</span>
rl_1<span class="token punctuation">.</span>nodes
rl_1<span class="token punctuation">.</span>start_node
rl_1<span class="token punctuation">.</span>end_node

<span class="token comment"># 关系的属性,和节点一样</span>
<span class="token builtin">dict</span><span class="token punctuation">(</span>rl_1<span class="token punctuation">)</span>
rl_1<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span>
rl_1<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span>
rl_1<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 添加、更新</span>
rl_1<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token operator">**</span><span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'love'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment"># 删除</span>
<span class="token keyword">del</span> rl_1<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span>

<span class="token comment"># 以及其他的get, setdefault</span>
rl_1<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>

rl_1<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'john'</span><span class="token punctuation">)</span>
</code></pre> 
<h6><a id="Path_139"></a>Path</h6> 
<p>Path特点是相邻必须连接。本质上就是相邻节点必须连接的几段关系。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> py2neo <span class="token keyword">import</span> Path<span class="token punctuation">,</span> Relationship

a <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'a'</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">)</span>
c <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'c'</span><span class="token punctuation">)</span>
d <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'d'</span><span class="token punctuation">)</span>
e <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'e'</span><span class="token punctuation">)</span>


<span class="token comment"># 连接节点与节点</span>
ab <span class="token operator">=</span> Path<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">'love'</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>
de <span class="token operator">=</span> Path<span class="token punctuation">(</span>d<span class="token punctuation">,</span> <span class="token string">'love'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>

<span class="token comment"># 连接节点与节点与节点。。。</span>
abc <span class="token operator">=</span> Path<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">'love'</span><span class="token punctuation">,</span> b<span class="token punctuation">,</span> Relationship<span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token string">'love'</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>

<span class="token comment"># 相邻必须连接</span>
abc <span class="token operator">=</span> Path<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">'love'</span><span class="token punctuation">,</span> b<span class="token punctuation">,</span> Relationship<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">'love'</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token comment"># 报错ValueError: Cannot append walkable love(Node('Person', name='a'), Node('Person', name='c')) to node Node('Person', name='b')</span>

<span class="token comment"># 连接节点与关系</span>
ab <span class="token operator">=</span> Relationship<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">'love'</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>
abc <span class="token operator">=</span> Path<span class="token punctuation">(</span>ab<span class="token punctuation">,</span> <span class="token string">'love'</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>

<span class="token comment"># 连接关系与关系</span>
ca <span class="token operator">=</span> Relationship<span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">'love'</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span>
abca <span class="token operator">=</span> abcd <span class="token operator">=</span> Path<span class="token punctuation">(</span>ab<span class="token punctuation">,</span> <span class="token string">'love'</span><span class="token punctuation">,</span> ca<span class="token punctuation">)</span>

<span class="token comment"># 连接节点与Path</span>
cde <span class="token operator">=</span> Path<span class="token punctuation">(</span>c<span class="token punctuation">,</span> <span class="token string">'love'</span><span class="token punctuation">,</span> de<span class="token punctuation">)</span>

<span class="token comment"># 连接Path与Path</span>
abcde <span class="token operator">=</span> Path<span class="token punctuation">(</span>abc<span class="token punctuation">,</span> <span class="token string">'love'</span><span class="token punctuation">,</span> de<span class="token punctuation">)</span>

<span class="token comment"># 查看开始结束的节点</span>
abcde<span class="token punctuation">.</span>start_node
abcde<span class="token punctuation">.</span>end_node

<span class="token comment"># 按照顺序查看所有节点</span>
abcde<span class="token punctuation">.</span>nodes

<span class="token comment"># 按照关系查看所有关系</span>
abcde<span class="token punctuation">.</span>relationships
</code></pre> 
<h6><a id="Subgraph_188"></a>Subgraph</h6> 
<p>就是图。通过逻辑的方式进行创建 | &amp; - ^</p> 
<pre><code class="prism language-python"><span class="token comment"># 节点、关系、Path、subgraph之间通过逻辑进行连接就是subgraph</span>
sub1 <span class="token operator">=</span> abc <span class="token operator">|</span> abca 
sub2 <span class="token operator">=</span> abc <span class="token operator">&amp;</span> abca  <span class="token comment"># 节点与关系都必须在两边都存在</span>
sub3 <span class="token operator">=</span> abc <span class="token operator">-</span> abca <span class="token comment"># 节点关系在前者存在，在后者不存在</span>
sub4 <span class="token operator">=</span> abc <span class="token operator">^</span> abca <span class="token comment"># 各自独特的部分，sub1|sub2 - sub1&amp;sub2</span>

<span class="token comment"># 查看所有节点，关系</span>
sub4<span class="token punctuation">.</span>nodes
sub4<span class="token punctuation">.</span>relationships

<span class="token comment"># 查看图中所有关系的type</span>
sub4<span class="token punctuation">.</span>types<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 查看图中所有节点的属性key以及标签的集合</span>
sub4<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span>
sub4<span class="token punctuation">.</span>labels<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="Data_Typesrecord_211"></a>Data Types就完事了，剩下就是增删改查事务提交等数据库通用性的东西。数据库的操作都是以事务为单位，所以先从事务执行返回的结果record看起。</h4> 
<h6><a id="class_py2neocypherRecord_215"></a>class* py2neo.cypher.Record</h6> 
<p>执行语句后返回的结果是cursor，是一堆结果。record是其中一个结果，本质上就是一个字典。</p> 
<pre><code class="prism language-python">cursor <span class="token operator">=</span> graph<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'match (n) return n'</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> cursor<span class="token punctuation">.</span>forward<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    record <span class="token operator">=</span> cursor<span class="token punctuation">.</span>current
    
<span class="token comment"># 转换为字典</span>
<span class="token builtin">dict</span><span class="token punctuation">(</span>record<span class="token punctuation">)</span> <span class="token comment"># {'n': Node('Symtom', name='脱水')}</span>
record<span class="token punctuation">.</span>data<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># {'n': Node('Symtom', name='脱水')}</span>

<span class="token comment"># 所有键</span>
record<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># ['n']</span>

<span class="token comment"># 所有值</span>
record<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># [Node('Symtom', name='脱水')]</span>

<span class="token comment"># 将record里的所有节点，关系形成一个子图</span>
record<span class="token punctuation">.</span>to_subgraph<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>nodes <span class="token comment"># (Node('Symtom', name='脱水'),)</span>
</code></pre> 
<h6><a id="py2neocypherCursorresult_hydrantNone_sample_size3_240"></a>py2neo.cypher.<strong>Cursor</strong>(<em>result</em>, <em>hydrant=None</em>, <em>sample_size=3</em>)</h6> 
<p>cursor是执行语句返回的是cursor，通过cursor来查询一个个record。</p> 
<pre><code class="prism language-python">cursor <span class="token operator">=</span> graph<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'match (n) return n'</span><span class="token punctuation">)</span>

<span class="token comment"># 基本使用就是，结合forward()以及current使用</span>
<span class="token keyword">while</span> cursor<span class="token punctuation">.</span>forward<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    record <span class="token operator">=</span> cursor<span class="token punctuation">.</span>current
    
<span class="token comment"># 一次性返回所有结果</span>
record_list <span class="token operator">=</span> cursor<span class="token punctuation">.</span>data<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 转换为dataframe</span>
cursor<span class="token punctuation">.</span>to_data_frame<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 转换为ndarray	</span>
cursor<span class="token punctuation">.</span>to_ndarray<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 转换为子图</span>
cursor<span class="token punctuation">.</span>to_subgraph<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h6><a id="Transaction_266"></a>Transaction</h6> 
<p>py2neo的用法就是分成两种，一种是使用cypher语句，一种是使用自己的数据类,这些类是要和远程的实际的节点一一对应。</p> 
<p>cypher语句的使用遵循的规则是，利用$标志语句中的变量，例如match (n) where n.name=$name。输入变量值有两种方式，一种是name=‘biden’， 一种是**{‘name’:‘biden’}</p> 
<pre><code class="prism language-python"><span class="token comment"># 建立一个事务</span>
tx <span class="token operator">=</span> Graph<span class="token punctuation">.</span>auto<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 自动提交的事务，操作之后默认执行graph.commit(tx)</span>
tx <span class="token operator">=</span> Graph<span class="token punctuation">.</span>begin<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 非自动提交的事务</span>

<span class="token comment"># 结束一个事务</span>
Graph<span class="token punctuation">.</span>commit<span class="token punctuation">(</span>tx<span class="token punctuation">)</span> <span class="token comment"># 提交</span>
Graph<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span>tx<span class="token punctuation">)</span> <span class="token comment"># 回滚</span>

<span class="token comment"># 属性</span>
tx<span class="token punctuation">.</span>graph <span class="token comment"># Graph('bolt://localhost:7687', name='neo4j')</span>
tx<span class="token punctuation">.</span>readonly <span class="token comment"># False表示可以写入。</span>

<span class="token comment"># 使用cypher语句，只用一个run就可以，evaluate就是只返回第一个结果，udpate是不用返回结果</span>
record <span class="token operator">=</span> tx<span class="token punctuation">.</span>evaluate<span class="token punctuation">(</span><span class="token string">'match (n) return n'</span><span class="token punctuation">)</span> <span class="token comment">#  返回一个数据类型，节点，关系或者子图。</span>

cursor <span class="token operator">=</span> tx<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'match (n) return n'</span><span class="token punctuation">)</span> <span class="token comment"># 返回多个结果，是一个cursor</span>

tx<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">"match (n:boss) where n.name='biden' set n.name=$newname"</span><span class="token punctuation">,</span> <span class="token operator">**</span><span class="token punctuation">{<!-- --></span><span class="token string">'newname'</span><span class="token punctuation">:</span><span class="token string">'aoguanhai'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
tx<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">"match (n:boss) where n.name='biden' set n.name=$newname"</span><span class="token punctuation">,</span> newname<span class="token operator">=</span><span class="token string">'auguanhai'</span><span class="token punctuation">)</span>


<span class="token comment"># create(subgraph) 创建一个本地，create函数会在远程创建一个同样的节点/关系/子图，并和本地对应。</span>
a <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">,</span> <span class="token operator">**</span><span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
a<span class="token punctuation">.</span>graph <span class="token comment"># None,说明</span>
tx<span class="token punctuation">.</span>create<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
a<span class="token punctuation">.</span>graph <span class="token comment"># Graph('bolt://localhost:7687', name='neo4j') ,说明和远程一一对应了。</span>

<span class="token comment"># delete(subgraph) 删除远程对应的节点关系子图</span>
tx<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
a<span class="token punctuation">.</span>graph <span class="token comment"># None，说明远程已经删除。</span>

<span class="token comment"># exists(subgraph) 检测是否有远程对应</span>
tx<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token comment"># False 已经无对应</span>

<span class="token comment"># merge(subgraph, primary_label=None, primary_key=None) </span>

<span class="token comment"># pull 更新本地,针对已经连接的</span>
tx<span class="token punctuation">.</span>pull<span class="token punctuation">(</span>a<span class="token punctuation">)</span>

<span class="token comment"># 更新远程，针对已经连接的</span>
a<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'bob'</span>
tx<span class="token punctuation">.</span>push<span class="token punctuation">(</span>a<span class="token punctuation">)</span>

<span class="token comment"># separate(subgraph),删除远程中的子图中的所有关系，本地不受影响</span>
tx <span class="token operator">=</span> graph<span class="token punctuation">.</span>begin<span class="token punctuation">(</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'Alice'</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token string">'Person'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'bob'</span><span class="token punctuation">)</span>
ab <span class="token operator">=</span> Relationship<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">'love'</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span>
sub <span class="token operator">=</span>  a <span class="token operator">|</span> b <span class="token operator">|</span> ab
tx<span class="token punctuation">.</span>create<span class="token punctuation">(</span>sub<span class="token punctuation">)</span> <span class="token comment"># 创建</span>
tx<span class="token punctuation">.</span>separate<span class="token punctuation">(</span>sub<span class="token punctuation">)</span> <span class="token comment"># 删除其中的关系</span>
graph<span class="token punctuation">.</span>commit<span class="token punctuation">(</span>tx<span class="token punctuation">)</span>
</code></pre> 
<h6><a id="GraphServer_329"></a>GraphServer</h6> 
<pre><code class="prism language-python"><span class="token keyword">from</span> py2neo <span class="token keyword">import</span> GraphService<span class="token punctuation">,</span> Graph

url <span class="token operator">=</span> <span class="token string">"bolt://localhost"</span>
auth <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'neo4j'</span><span class="token punctuation">,</span> <span class="token string">'123456'</span><span class="token punctuation">)</span>

gs <span class="token operator">=</span> GraphService<span class="token punctuation">(</span>url<span class="token punctuation">,</span> auth<span class="token operator">=</span>auth<span class="token punctuation">)</span>

<span class="token comment"># 查看所有数据库名称</span>
<span class="token builtin">list</span><span class="token punctuation">(</span>gs<span class="token punctuation">)</span>  <span class="token comment"># ['neo4j', 'system']</span>
gs<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># ['neo4j', 'system']</span>

<span class="token comment"># 建立一个Graph</span>
graph <span class="token operator">=</span> gs<span class="token punctuation">[</span><span class="token string">'neo4j'</span><span class="token punctuation">]</span>
graph <span class="token operator">=</span> gs<span class="token punctuation">.</span>default_graph 
graph <span class="token operator">=</span> gs<span class="token punctuation">.</span>system_graph

<span class="token comment"># 查看gs的属性值，和字典使用方法一致。</span>
gs<span class="token punctuation">.</span>config<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span>
gs<span class="token punctuation">.</span>config<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span>
gs<span class="token punctuation">.</span>config<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 查看连接地址信息</span>
gs<span class="token punctuation">.</span>connector
gs<span class="token punctuation">.</span>profile
gs<span class="token punctuation">.</span>uri

<span class="token comment"># 查看neo4j版本</span>
gs<span class="token punctuation">.</span>kernel_version <span class="token comment"># &lt;Version('5.14.0')&gt;</span>
gs<span class="token punctuation">.</span>product <span class="token comment"># 'Neo4j Kernel 5.14.0 (Community)'</span>

</code></pre> 
<h6><a id="Graph_366"></a>Graph</h6> 
<pre><code class="prism language-python"><span class="token comment"># 建立一个Graph，也从GraphServer建立</span>
graph <span class="token operator">=</span> Graph<span class="token punctuation">(</span>uri<span class="token operator">=</span>url<span class="token punctuation">,</span> auth<span class="token operator">=</span>auth<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'neo4j'</span><span class="token punctuation">)</span> 

<span class="token comment"># 创建事务，在事务已经介绍过了</span>
tx_auto <span class="token operator">=</span> graph<span class="token punctuation">.</span>auto<span class="token punctuation">(</span><span class="token punctuation">)</span>
tx <span class="token operator">=</span> graph<span class="token punctuation">.</span>begin<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 提交事务</span>
graph<span class="token punctuation">.</span>commit<span class="token punctuation">(</span>tx<span class="token punctuation">)</span>

<span class="token comment"># create(subgraph)，创建一个自动提交事务进行create,注意tx_auto并不支持create。</span>
<span class="token keyword">from</span> py2neo <span class="token keyword">import</span> <span class="token operator">*</span>

a <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'ali'</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'bli'</span><span class="token punctuation">)</span>
c <span class="token operator">=</span> Node<span class="token punctuation">(</span><span class="token string">'person'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'cli'</span><span class="token punctuation">)</span>

ac <span class="token operator">=</span> Relationship<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token string">'fr'</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>
bc <span class="token operator">=</span> Relationship<span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token string">'fr'</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span>

sub <span class="token operator">=</span> ac<span class="token operator">|</span>bc
graph<span class="token punctuation">.</span>create<span class="token punctuation">(</span>sub<span class="token punctuation">)</span>

<span class="token comment"># delete(subgraph)，也是自动提交</span>
graph<span class="token punctuation">.</span>delete<span class="token punctuation">(</span>a<span class="token punctuation">)</span>

<span class="token comment"># delete_all(),删除全部</span>
graph<span class="token punctuation">.</span>delete_all<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># evaluate(cypher, parameters=None, **kwparameters),执行cypher语句，按照cypher语句规则进行就可以。</span>
record <span class="token operator">=</span> graph<span class="token punctuation">.</span>evaluate<span class="token punctuation">(</span><span class="token string">'match (n) return n'</span><span class="token punctuation">)</span> <span class="token comment"># 返回一个record</span>

<span class="token comment"># exists(subgraph) 查看是否存在</span>
graph<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>sub<span class="token punctuation">)</span>

<span class="token comment"># match(nodes=None, r_type=None, limit=None)，用来匹配关系。nodes是(start_node, end_node)，r_type是关系类型，如果nodes=(Node, c)，表示所有end_node是c的关系。</span>
<span class="token builtin">list</span><span class="token punctuation">(</span>graph<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token punctuation">,</span>r_type<span class="token operator">=</span><span class="token string">'fr'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 查找所有以c为朋友的人</span>
<span class="token triple-quoted-string string">'''
[fr(Node('person', name='ali'), Node('person', name='cli')),
 fr(Node('person', name='bli'), Node('person', name='cli'))]
'''</span>

<span class="token comment"># match_one(nodes, r_type), 值匹配一个关系。</span>
graph<span class="token punctuation">.</span>match_one<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token punctuation">,</span>r_type<span class="token operator">=</span><span class="token string">'fr'</span><span class="token punctuation">)</span> <span class="token comment"># fr(Node('person', name='ali'), Node('person', name='cli'))</span>


<span class="token comment"># nodes, relationships,获取所有节点关系到本地，可以使用match进行匹配。</span>
<span class="token builtin">list</span><span class="token punctuation">(</span>graph<span class="token punctuation">.</span>nodes<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token string">"person"</span><span class="token punctuation">,</span> <span class="token operator">**</span><span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'cli'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># [Node('person', name='cli')]</span>

<span class="token builtin">list</span><span class="token punctuation">(</span>graph<span class="token punctuation">.</span>relationships<span class="token punctuation">.</span><span class="token keyword">match</span><span class="token punctuation">(</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'fr'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># [fr(Node('person', name='ali'), Node('person', name='cli'))]</span>


<span class="token comment"># pull(subgraph)，将已经连接的子图从远程更新</span>
graph<span class="token punctuation">.</span>pull<span class="token punctuation">(</span>sub<span class="token punctuation">)</span>

<span class="token comment"># push(subgraph),从本地已经连接到的子图更新到远程</span>
graph<span class="token punctuation">.</span>push<span class="token punctuation">(</span>sub<span class="token punctuation">)</span>

<span class="token comment"># separate(subgraph) ，从已经连接的子图删除关系</span>
graph<span class="token punctuation">.</span>separate<span class="token punctuation">(</span>sub<span class="token punctuation">)</span>

<span class="token comment"># cypher操作，run，update（无返回结果）, query（只能查）,使用方法就是使用cypher的规则</span>
graph<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token string">'match (n) where n.name=$name return n'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'cli'</span><span class="token punctuation">)</span>
graph<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'match (n) where n.name=$name return n'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'cli'</span><span class="token punctuation">)</span>
graph<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token string">'match (n) where n.name=$name set n.name=$newname'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'cli'</span><span class="token punctuation">,</span> newname<span class="token operator">=</span><span class="token string">'ccli'</span><span class="token punctuation">)</span>



</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/434e26311d7f613e8ae4c4ce19fe86a0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据结构：图文详解 队列 | 循环队列 的各种操作（出队，入队，获取队列元素，判断队列状态）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2bb1b834122ad648cd598c87c153c199/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">jdk 线程池与 tomcat 线程池对比</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>