<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SQL 中GUID的使用 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SQL 中GUID的使用" />
<meta property="og:description" content="一、什么是GUID GUID是16字节的二进制SQL Server数据类型，在表，数据库和服务器之间全局唯一。 GUID代表全局唯一标识符，可与UNIQUEIDENTIFIER互换使用。
二、GUID的使用 要在SQL Server中创建GUID，将使用NEWID（）函数，如下所示：
SELECT NEWID() 多次执行上面SQL行，您每次都会看到一个不同的值。 这是因为NEWID（）函数每执行一次都会生成一个唯一值。
要声明类型为GUID的变量，使用的关键字是UNIQUEIDENTIFIER，如以下脚本中所述：
DECLARE @UNI UNIQUEIDENTIFIER SET @UNI = NEWID() SELECT @UNI 如前所述，GUID值在表，数据库和服务器之间是唯一的。 GUID可以视为全局主键。 本地主键用于唯一标识表中的记录。 另一方面，GUID可用于唯一地标识跨表，数据库和服务器的记录。
三、GUID解决了什么问题 让我们看看如果我们在不同数据库的表中有冗余记录会遇到什么问题，以及GUID如何解决这些问题。
执行以下脚本：
CREATE DATABASE EngDB GO USE EngDB GO CREATE TABLE EnglishStudents ( Id INT PRIMARY KEY IDENTITY, StudentName VARCHAR (50) ) GO INSERT INTO EnglishStudents VALUES (&#39;谢恩&#39;) INSERT INTO EnglishStudents VALUES (&#39;强尼&#39;) 在上面的脚本中，我们创建一个名为“ EngDB”的数据库。
然后，我们在此数据库中创建一个表“ EnglishStudents”。
该表有两列：Id和StudentName。 Id列是主键列，我们使用Identity作为约束将其设置为自动递增。
最后，我们将两个名为“ Shane”和“ Jonny”的学生记录插入“ EnglishStudents”表中。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/2f0f3dfe9bd3d229b3cdbb2bcd09c0c4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-07T11:29:49+08:00" />
<meta property="article:modified_time" content="2023-02-07T11:29:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SQL 中GUID的使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一、什么是GUID</h2> 
<p>GUID是16字节的二进制SQL Server数据类型，在表，数据库和服务器之间全局唯一。 GUID代表全局唯一标识符，可与UNIQUEIDENTIFIER互换使用。</p> 
<h2>二、GUID的使用</h2> 
<p>要在SQL Server中创建GUID，将使用NEWID（）函数，如下所示：</p> 
<pre><code class="language-sql">SELECT NEWID()</code></pre> 
<p>多次执行上面SQL行，您每次都会看到一个不同的值。 这是因为NEWID（）函数每执行一次都会生成一个唯一值。</p> 
<p>要声明类型为GUID的变量，使用的关键字是UNIQUEIDENTIFIER，如以下脚本中所述：</p> 
<pre><code class="language-sql">DECLARE @UNI UNIQUEIDENTIFIER
SET @UNI = NEWID()
 
SELECT @UNI</code></pre> 
<p>如前所述，GUID值在表，数据库和服务器之间是唯一的。 GUID可以视为全局<a href="https://so.csdn.net/so/search?q=%E4%B8%BB%E9%94%AE&amp;spm=1001.2101.3001.7020" title="主键">主键</a>。 本地主键用于唯一标识表中的记录。 另一方面，GUID可用于唯一地标识跨表，数据库和服务器的记录。</p> 
<h2>三、GUID解决了什么问题</h2> 
<p>让我们看看如果我们在不同数据库的表中有冗余记录会遇到什么问题，以及GUID如何解决这些问题。</p> 
<p>执行以下脚本：</p> 
<pre><code class="language-sql">CREATE DATABASE EngDB
GO

USE EngDB
GO
 
CREATE TABLE EnglishStudents
(
	Id INT PRIMARY KEY IDENTITY,
	StudentName VARCHAR (50)
)
GO
 
INSERT INTO EnglishStudents VALUES ('谢恩')
INSERT INTO EnglishStudents VALUES ('强尼')</code></pre> 
<p>在上面的脚本中，我们创建一个名为“ EngDB”的数据库。</p> 
<p>然后，我们在此数据库中创建一个表“ EnglishStudents”。</p> 
<p>该表有两列：Id和StudentName。 Id列是主键列，我们使用Identity作为约束将其设置为自动递增。</p> 
<p>最后，我们将两个名为“ Shane”和“ Jonny”的学生记录插入“ EnglishStudents”表中。</p> 
<p>现在，如果您从“ EnglishStudents”表中选择所有记录，您将看到以下输出：</p> 
<p><img alt="" height="114" src="https://images2.imgbox.com/73/b5/hSZGOKCU_o.png" width="614"></p> 
<p> 现在，让我们创建另一个数据库“ MathDB”，在数据库中创建表“ MathStudents”，并将一些记录插入表中。 执行以下脚本。</p> 
<pre><code class="language-sql">CREATE DATABASE MathDB
GO
USE MathDB
GO
CREATE TABLE MathStudents
(
	Id INT PRIMARY KEY IDENTITY,
	StudentName VARCHAR (50)
)
GO
 
INSERT INTO MathStudents VALUES ('莎莉')
INSERT INTO MathStudents VALUES ('爱德华')</code></pre> 
<p>现在，让我们创建另一个数据库“ MathDB”，在数据库中创建表“ MathStudents”，并将一些记录插入表中。 执行以下脚本。</p> 
<p><img alt="" height="117" src="https://images2.imgbox.com/00/1f/l7Iaznyf_o.png" width="620"></p> 
<p>现在，如果您从EngDB的EnglishStudents表和MathDB的MathStudents表中选择所有记录，您将看到两个表中的记录将具有相同的主键列ID值。 执行以下脚本以查看此结果：</p> 
<pre><code class="language-sql">SELECT * FROM EngDB.dbo.EnglishStudents
SELECT * FROM MathDB.dbo.MathStudents</code></pre> 
<p>您将在SQL Server Management Studio中看到以下输出：</p> 
<p><img alt="" height="194" src="https://images2.imgbox.com/37/b9/an8NrQk6_o.png" width="381"></p> 
<p></p> 
<p>来自两个不同数据库中不同表的学生记录的Id列具有相同的值。 这是SQL Server的默认行为。</p> 
<p>现在，我们创建一个新表“ Student”，其中包含MathStudents表和EnglishStudents表中所有记录的并集。 执行以下脚本：</p> 
<pre><code class="language-sql">USE EngDB
GO
CREATE TABLE Students
(
	Id INT PRIMARY KEY,
	StudentName NVARCHAR (50)
)
GO
 
INSERT INTO Students
SELECT * FROM EngDB.dbo.EnglishStudents
UNION ALL
SELECT * FROM MathDB.dbo.MathStudents</code></pre> 
<p>在上面的脚本中，我们在EngDB中创建一个新表“ Students”。 该表包含Id和StudentName列。</p> 
<p>如果尝试运行上述脚本，则会看到错误：</p> 
<p><img alt="" height="78" src="https://images2.imgbox.com/ef/e9/dy7fvzhf_o.png" width="633"></p> 
<p>此错误是由于MathStudents和EnglishStudents表的Id列（也是新创建的Students表的主键列）具有相同的值。</p> 
<p>因此，当我们尝试从MathStudents和EnglishStudents表中插入记录的并集时，会发生“违反PRIMARY KEY约束”错误。 执行以下脚本，以查看我们实际尝试在“学生”表中插入的内容。</p> 
<pre><code class="language-sql">SELECT * FROM EngDB.dbo.EnglishStudents
UNION ALL
SELECT * FROM MathDB.dbo.MathStudents</code></pre> 
<p>但是，如果我们希望记录在多个数据库中具有唯一值怎么办？ 例如，我们希望EnglishStudents表和MathStudents表的Id列具有唯一的值，即使它们属于不同的数据库也是如此。 这是我们需要使用GUID数据类型的时候。</p> 
<p>您会看到学生Shane和Sally的ID均为1，而Jonny和Edward的ID均为2。这导致违反了Student表的主键约束。</p> 
<h2>四、GUID解决方案</h2> 
<p>现在，让我们看看如何使用GUID解决此问题</p> 
<p>让我们在EngDB中创建一个表EngStudents1，但是这次我们将Id列的数据类型从INT更改为UNIQUEIDENTIFIER。 要为该列设置默认值，我们将使用default关键字，并将默认值设置为'NEWID（）'函数返回的值。</p> 
<p>这将确保每当在EngStudents1表中插入新记录时，默认情况下，NEWID（）函数都会为Id列生成唯一值。 插入记录时，我们只需指定“默认”作为第一列的值。 这会将默认唯一值插入Id列。 执行以下脚本来创建EngStudents1表：</p> 
<pre><code class="language-sql">USE EngDB
GO
 
CREATE TABLE EnglishStudents1
(
	Id UNIQUEIDENTIFIER PRIMARY KEY default NEWID(),
	StudentName VARCHAR (50)
 
)
GO
 
INSERT INTO EnglishStudents1 VALUES (default,'强尼')
INSERT INTO EnglishStudents1 VALUES (default,'谢恩')</code></pre> 
<p>现在，如果您从EnglishStudents1表中选择所有记录，则结果将如下所示：</p> 
<p><img alt="" height="136" src="https://images2.imgbox.com/4c/c2/RnQGSAO0_o.png" width="623"></p> 
<p> 注意： “ Id”列的值将不同于上表中显示的值，因为它们是即时生成的。 但是，它们应该是全局唯一的。</p> 
<p>以相同的方式，在MathDB数据库中创建另一个表MathStudents1。 执行以下脚本：</p> 
<pre><code class="language-sql">USE MathDB
GO
 
CREATE TABLE MathStudents1
(
	Id UNIQUEIDENTIFIER PRIMARY KEY default NEWID(),
	StudentName VARCHAR (50)
 
)
GO
 
INSERT INTO MathStudents1 VALUES (default,'莎莉')
INSERT INTO MathStudents1 VALUES (default,'爱德华')</code></pre> 
<p>再次，如果您尝试从MathDB数据库的MathStudents1表中检索所有记录，您将看到类似于以下结果：</p> 
<p><img alt="" height="138" src="https://images2.imgbox.com/99/2d/zZxsQUyU_o.png" width="619"></p> 
<p> 现在，我们在EnglishStudents1和MathStudents1表的Id列中具有全局唯一值。 让我们创建一个名为Student1s的新表，就像以前一样，尝试插入EnglishStudents1和MathStudents1中记录的并集。 这次，我们将看到不会出现“违反PRIMARY KEY约束”错误，因为EnglishStudents1和MathStudents1的Id列中的值在EngDB和MathDB数据库中都是唯一的。</p> 
<pre><code class="language-sql">USE EngDB
GO
 
CREATE TABLE Students1
(
	Id UNIQUEIDENTIFIER PRIMARY KEY,
	StudentName NVARCHAR (50)
)
GO
 
INSERT INTO Students1
SELECT * FROM EngDB.dbo.EnglishStudents1
UNION ALL
SELECT * FROM MathDB.dbo.MathStudents1</code></pre> 
<p>您可以在上面的脚本中看到，Id列的类型为UNIQUEIDENTIFIER。 运行上面的脚本，然后尝试从Students1表中检索所有记录，您应该看到与以下内容类似的结果：</p> 
<p><img alt="" height="224" src="https://images2.imgbox.com/a5/8e/AEPyIe8h_o.png" width="621"></p> 
<p> 您可以看到，使用GUID，我们可以将两个不同数据库中的记录并集插入到新表中，而不会出现“违反PRIMARY KEY约束”错误。</p> 
<h2>作者有话说</h2> 
<p>该文档希望能解决你的问题，不能解决你的问题的话，请问“度娘”，走上编程这条路，“度娘”永远是你的法宝。</p> 
<p>有些废话的东西你懂的话，完全可以不看；我其实也不喜欢理论上的知识；看看也是涨涨见识，可以在面试的时候，装那什么。</p> 
<p>当然很多的理论知识也是借鉴了各位大神的，或者去官网找的。如有冒犯，还请见谅。</p> 
<p>坚持日拱一卒、相信复利效应、不断践行践修，让我们活在成长中</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/39c88d2c1843e5beff44e72d7f1b37cb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SQL 将数据库生成脚本</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2da2113ce7701bc80f64b8411c0d9b54/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SQL 数据库复制</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>