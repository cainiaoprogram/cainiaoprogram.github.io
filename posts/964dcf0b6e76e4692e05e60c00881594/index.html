<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vs2015编译ffmpeg 配置开发环境 (坑多) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vs2015编译ffmpeg 配置开发环境 (坑多)" />
<meta property="og:description" content="心得 在刚开始学ffmpeg的时候，遇到的最大麻烦就是配置开发环境，ffmpeg我在使用的时候明显感觉linux下面配置比windows下面配置简单多了。但是在win环境下工作也有很多方便的地方。在配置这个环境的过程中，并没有像网上找到的那些配置资料那样，很顺利，我遇到的麻烦主要有几点：
①网上搜索的资料提供的老ffmpeg build版本网址，已经关闭了。想要得到旧版本ffmpeg，可能要自己编译。
②编译环境的问题，到底是选MINGW还是MSVC
③vs编译环境导致一系列问题下面就是配置环境的过程，希望能帮助被配置环境卡住的人。 一、开发环境 用的是vs2015 ffmpeg版本 3.4.2 二、编译 先去github上面下载源码，然后再编译成库文件和程序，才能使用。
编译过程会因为系统环境和vs方面的配置，出现各种各样的问题。可以直接去下build好的。
以下为理想中的vs ffmpeg编译过程：
先安装mys2库，官网为https://www.msys2.org/。下载后安装，我选择安装在D盘，感觉安装包比较大。到msys2窗口执行，安装编译程序： pacman -S make gcc diffutils重命名D:\Program Files\msys2\usr\bin\link.exe 为link.bak, 避免和MSVC 的link.exe冲突起来。安装YASM,官网为http://yasm.tortall.net/Download.html，下载后，将下载回来的yasm-1.3.0-win64.exe 改名为yaml.exe，并放置于 MSYS2 安装目录中。就是放置到D:\Program Files\msys2\usr\bin 中。把ffmpeg放msys2目录下面，然后
./configure --toolchain=msvc --arch=x86 --enable-yasm --enable-asm --enable-shared --disable-static
这一步我失败了。make后 make install 总结：我编译失败了，提示是cl问题，估计是环境变量的问题。下面给出解决办法。 错误解决过程 提示找不到cl，尝试找到vs的cl路径，并添加到环境变量，但是依然报错，并且vs创建不了新的项目，去系统的卸载程序面板，修复vs，修复之后再去configue ffmpeg依然找不到cl。重新安装了vs2015，没有提示cl问题了
但是编译报错，是nasm的问题
nasm/yasm not found or too old. Use --disable-x86asm for a crippled build.
在msys2里面执行
pacman -Su nasm安装编译环境。
之后再configure
编译过程很慢，等了很长时间make 之后，msys2界面中大量报错，命令行 error D8000 :cl:。可能是vs用的是中文版。
(1)那么需要切换到其他语言包，去vs的选项-&gt;工具-&gt;区域里面，获取其他语言。跳到微软的网站，下载了一个英语语言包安装程序，运行结果vs2015提示安装不起来，提示已经安装语言（并没有安装）。那么就需要卸载该语言包，然后再重新安装语言包。
(2)卸载方法为，给语言包安装程序添加快捷方式，打开属性，在最后添加-Uninstall，卸载过程非常慢。卸载完再重新安装英文语言包，之后就可以make和makeinstall了。 编译输出的位置 在我的mysy2安装路径 D:\Program Files\msys2\usr\local下面，出现了几个文件夹，其中include和lib文件夹包含了我所需要的库和头文件。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/964dcf0b6e76e4692e05e60c00881594/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-26T16:31:46+08:00" />
<meta property="article:modified_time" content="2021-01-26T16:31:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vs2015编译ffmpeg 配置开发环境 (坑多)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>心得</h2> 
<ol><li>在刚开始学ffmpeg的时候，遇到的最大麻烦就是配置开发环境，ffmpeg我在使用的时候明显感觉linux下面配置比windows下面配置简单多了。但是在win环境下工作也有很多方便的地方。</li><li>在配置这个环境的过程中，并没有像网上找到的那些配置资料那样，很顺利，我遇到的麻烦主要有几点：<br> ①网上搜索的资料提供的老ffmpeg build版本网址，已经关闭了。想要得到旧版本ffmpeg，可能要自己编译。<br> ②编译环境的问题，到底是选MINGW还是MSVC<br> ③vs编译环境导致一系列问题</li><li>下面就是配置环境的过程，希望能帮助被配置环境卡住的人。</li></ol> 
<h2><a id="_8"></a>一、开发环境</h2> 
<ol><li>用的是vs2015 ffmpeg版本 3.4.2</li></ol> 
<h2><a id="_10"></a>二、编译</h2> 
<p>先去github上面下载源码，然后再编译成库文件和程序，才能使用。<br> 编译过程会因为系统环境和vs方面的配置，出现各种各样的问题。可以直接去下build好的。<br> 以下为理想中的vs ffmpeg编译过程：</p> 
<ol><li>先安装mys2库，官网为https://www.msys2.org/。下载后安装，我选择安装在D盘，感觉安装包比较大。</li><li>到msys2窗口执行，安装编译程序： <code>pacman -S make gcc diffutils</code></li><li>重命名D:\Program Files\msys2\usr\bin\link.exe 为link.bak, 避免和MSVC 的link.exe冲突起来。</li><li>安装YASM,官网为http://yasm.tortall.net/Download.html，下载后，将下载回来的yasm-1.3.0-win64.exe 改名为yaml.exe，并放置于 MSYS2 安装目录中。就是放置到D:\Program Files\msys2\usr\bin 中。</li><li>把ffmpeg放msys2目录下面，然后<br> <code>./configure --toolchain=msvc --arch=x86 --enable-yasm --enable-asm --enable-shared --disable-static</code><br> 这一步我失败了。</li><li><code>make</code>后 <code>make install</code></li></ol> 
<ul><li>总结：我编译失败了，提示是cl问题，估计是环境变量的问题。下面给出解决办法。</li></ul> 
<hr> 
<h3><a id="_24"></a>错误解决过程</h3> 
<ol><li>提示找不到cl，尝试找到vs的cl路径，并添加到环境变量，但是依然报错，并且vs创建不了新的项目，去系统的卸载程序面板，修复vs，修复之后再去configue ffmpeg依然找不到cl。</li><li>重新安装了vs2015，没有提示cl问题了<br> 但是编译报错，是nasm的问题<br> <code>nasm/yasm not found or too old. Use --disable-x86asm for a crippled build.</code><br> 在msys2里面执行<br> <code>pacman -Su nasm</code>安装编译环境。<br> 之后再configure<br> 编译过程很慢，等了很长时间</li><li>make 之后，msys2界面中大量报错，<code>命令行 error D8000 :cl:</code>。可能是vs用的是中文版。<br> (1)那么需要切换到其他语言包，去vs的选项-&gt;工具-&gt;区域里面，获取其他语言。跳到微软的网站，下载了一个英语语言包安装程序，运行结果vs2015提示安装不起来，提示已经安装语言（并没有安装）。那么就需要卸载该语言包，然后再重新安装语言包。<br> (2)卸载方法为，给语言包安装程序添加快捷方式，打开属性，在最后添加<code>-Uninstall</code>，卸载过程非常慢。卸载完再重新安装英文语言包，之后就可以make和makeinstall了。</li></ol> 
<h3><a id="_36"></a>编译输出的位置</h3> 
<p>在我的mysy2安装路径 D:\Program Files\msys2\usr\local下面，出现了几个文件夹，其中include和lib文件夹包含了我所需要的库和头文件。</p> 
<h3><a id="_39"></a>注意</h3> 
<p>按照网络搜索的资料，可以直接去ffmpeg build版本的网站上面下载（但是那个网站关闭了）<br> 下载的时候，有几个版本：</p> 
<ul><li>static：打包好的文件，可以认为是FFmpeg的release版本，提供的是ffmpeg、ffplay、ffprobe三个命令行工具。(只学习命令行的同学可以将此配置到环境变量上)</li><li>shared：这个包包含static的文件，但是相比较多了链接文件DLL，这些DLL文件在后面开发环境配置配置中会用到。</li><li>dev：这个是纯开发版本的文件，不包含ffmpeg、ffplay、ffprobe这些命令行工具，但是包含我们开发时使用的头文件(位于include目录)，及liib文件(位于lib目录)，以及example文件（用于学习和使用）。</li></ul> 
<blockquote> 
 <p>来源： https://www.cnblogs.com/renhui/p/10387764.html</p> 
</blockquote> 
<p>那么从上面的描述可以看的出来，需要下载的是shared和dev版本。</p> 
<p>原来有个下载ffmpeg build版本的网站倒了，现在用新的网站</p> 
<blockquote> 
 <p>https://www.gyan.dev/ffmpeg/builds/</p> 
</blockquote> 
<p>我 之前下了个ffmpeg-4.3.1-2021-01-01-full_build-shared.7z版本，但是在使用这个版本的时候，开发出错了找不到解决办法，所以用回了3.4.2版本，这个版本资料多点。</p> 
<h2><a id="vs_ffmpeg_54"></a>三、配置vs ffmpeg环境</h2> 
<h3><a id="_55"></a>注意的点</h3> 
<p>需要区分x86版本和x64版本。我之前编译的是x86版本，所以就用x86版本。<br> 配置过程</p> 
<ol><li>在vs里面选择x86调试器</li><li>把include和lib文件夹复制到项目路径下面，然后把bin目录下面的dll文件复制到项目。</li><li>在项目属性里面：<br> c/c++ -&gt; 附加包含目录添加 $(ProjectDir)include<br> 链接器-&gt;常规-&gt;附加库目录 $(ProjectDir)lib<br> 链接器-&gt;常规-&gt;附加依赖项 添加刚才添加的lib文件下面八个lib文件。</li></ol> 
<h3><a id="_65"></a>测试</h3> 
<p>看看配置是否起了作用：<br> 测试代码如下(参考了雷神的文章)：<br> 值得注意的是：<br> 在c++里面调用c语言，需要用<code>extern "C"{}</code>来包含，不然报错<br> 调用ffmpeg需要加<code>#define __STDC_CONSTANT_MACROS</code></p> 
<pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"stdafx.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">define</span> __STDC_CONSTANT_MACROS</span>
<span class="token keyword">extern</span> <span class="token string">"C"</span>
<span class="token punctuation">{<!-- --></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"libavcodec\avcodec.h"</span></span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> <span class="token function">avcodec_configuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>打印出结果为：<br> –enable-gpl --enable-version3 --enable-shared --disable-w32threads --disable-autodetect --enable-fontconfig --enable-iconv --enable-gnutls --enable-libxml2 --enable-gmp --enable-lzma --enable-libsnappy --enable-zlib --enable-libsrt --enable-libssh --enable-libzmq --enable-avisynth --enable-libbluray --enable-libcaca --enable-sdl2 --enable-libdav1d --enable-libzvbi --enable-librav1e --enable-libwebp --enable-libx264 --enable-libx265 --enable-libxvid --enable-libaom --enable-libopenjpeg --enable-libvpx --enable-libass --enable-frei0r --enable-libfreetype --enable-libfribidi --enable-libvidstab --enable-libvmaf --enable-libzimg --enable-amf --enable-cuda-llvm --enable-cuvid --enable-ffnvcodec --enable-nvdec --enable-nvenc --enable-d3d11va --enable-dxva2 --enable-libmfx --enable-libcdio --enable-libgme --enable-libmodplug --enable-libopenmpt --enable-libopencore-amrwb --enable-libmp3lame --enable-libshine --enable-libtheora --enable-libtwolame --enable-libvo-amrwbenc --enable-libilbc --enable-libgsm --enable-libopencore-amrnb --enable-libopus --enable-libspeex --enable-libvorbis --enable-ladspa --enable-libbs2b --enable-libflite --enable-libmysofa --enable-librubberband --enable-libsoxr --enable-chromaprint</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5bc7933c963a59ea4e919aa74b0f4cb0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">eggjs session传递不成功</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a5bfe9aefcefa225b8cd347b41ed8776/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">au人声处理_人声效果的精细处理详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>