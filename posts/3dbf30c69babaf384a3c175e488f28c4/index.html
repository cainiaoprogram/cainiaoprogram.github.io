<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>nginx安装SSL证书以及反向代理tomcat问题汇总 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="nginx安装SSL证书以及反向代理tomcat问题汇总" />
<meta property="og:description" content="前情提要 nginx开启SSL模块教程：Nginx安装SSL证书前需要开启SSL模块
nginx安装SSL证书教程：腾讯云Nginx服务器SSL证书安装部署
一、tomcat没有安装SSL证书，但是想通过Https协议访问tomcat 此处使用的就是nginx的反向代理，本质上我们访问tomcat还是使用http协议，但我们通过nginx的反向代理，会先通过Https协议访问nginx，然后再通过nginx将Https请求转发为http请求发送给tomcat服务器。相当于加了一层请求转发，这也让我们可以不在tomcat上安装ssl证书就可以通过https协议访问tomcat。多集群下，nginx也支持负载均衡，所以我们通常是在nginx上安装SSL证书。
反向代理看着复杂，但其实只需要在nginx.conf上配置以下，具体看以下配置：
假定你的服务器地址为127.0.0.1；看到127.0.0.1就填你自己服务器的ip地址，看到8080就填你tomcat服务器的端口号。
【地理路径地址】:例如你想让 https://127.0.0.1/test 这个路径代理tomcat服务器，那么此处就填写/test。
【tomcat项目地址】：首先你要确定你所要代理的tomcat项目，然后在此处填写 https://127.0.0.1:8080/项目名 server { 。。。。。。。 location [代理路径地址] { proxy_pass [tomcat项目地址]; proxy_http_version 1.1; proxy_set_header X-Forwarded-Proto https; #配置报文转发协议为https proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header Host $http_host; proxy_set_header Cookie $http_cookie; proxy_connect_timeout 30; proxy_set_header Referer $http_referer; proxy_cookie_path [/项目名] [代理路径地址]; #保证https和http的cookie一致 } } proxy_cookie_path介绍：proxy_cookie_path详细介绍
二、nginx安装SSL证书后，反向代理https请求不携带cookie的问题 首先这个问题，有好几个方面的影响，其中一个环节出问题，就都会出问题，所以请耐心看下去，我会尽量讲清楚。
1.nginx安装SSL证书后，其中的项目如果ajax或axios发送http请求会出现(已屏蔽:mixed-content)的情况，F12控制台会显示 解决办法：通过nginx反向代理tomcat，使所有请求都变成https请求，就不会出现此错误。
2.反向代理配置问题 如果你是按照我上面的反向代理的配置，那就不会出现问题，主要是要配置
proxy_set_header Cookie $http_cookie; proxy_cookie_path [/项目名] [代理路径地址]; #保证https和http的cookie一致
这两项。
3.例：前后端分离，前端Vue，后端SSM（所以推荐前后端分离项目使用token） Vue中axios是默认不带cookie的，所以要在main.js中添加代码如下：
import axios from &#39;axios&#39;;#如果有就不要加了 axios." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/3dbf30c69babaf384a3c175e488f28c4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-27T11:30:12+08:00" />
<meta property="article:modified_time" content="2022-03-27T11:30:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">nginx安装SSL证书以及反向代理tomcat问题汇总</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>前情提要</h2> 
<p>nginx开启SSL模块教程：<a class="link-info" href="https://www.cnblogs.com/grimm/p/14189153.html" rel="nofollow" title="Nginx安装SSL证书前需要开启SSL模块">Nginx安装SSL证书前需要开启SSL模块</a></p> 
<p>nginx安装SSL证书教程：<a class="link-info" href="https://cloud.tencent.com/document/product/400/35244" rel="nofollow" title="腾讯云Nginx服务器SSL证书安装部署">腾讯云Nginx服务器SSL证书安装部署</a></p> 
<h2>一、tomcat没有安装SSL证书，但是想通过Https协议访问tomcat</h2> 
<p>此处使用的就是nginx的反向代理，本质上我们访问tomcat还是使用http协议，但我们通过nginx的反向代理，会先通过Https协议访问nginx，然后再通过nginx将Https请求转发为http请求发送给tomcat服务器。相当于加了一层请求转发，这也让我们可以不在tomcat上安装ssl证书就可以通过https协议访问tomcat。多集群下，nginx也支持负载均衡，所以我们通常是在nginx上安装SSL证书。</p> 
<p>反向代理看着复杂，但其实只需要在nginx.conf上配置以下，具体看以下配置：</p> 
<p>假定你的服务器地址为127.0.0.1；看到127.0.0.1就填你自己服务器的ip地址，看到8080就填你tomcat服务器的端口号。</p> 
<p>【地理路径地址】:例如你想让 <strong>https://127.0.0.1/test</strong> 这个路径代理tomcat服务器，那么此处就填写/test。</p> 
<p>【tomcat项目地址】：首先你要确定你所要代理的tomcat项目，然后在此处填写 https://127.0.0.1:8080/项目名 </p> 
<pre><code class="language-XML">server {
    。。。。。。。
    
    location [代理路径地址] {
            proxy_pass [tomcat项目地址];
            proxy_http_version 1.1;
            proxy_set_header  X-Forwarded-Proto https; #配置报文转发协议为https
            proxy_set_header  X-Real-IP  $remote_addr;
            proxy_set_header  X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header  Host $http_host;
            proxy_set_header Cookie $http_cookie;
            proxy_connect_timeout 30; 
            proxy_set_header Referer $http_referer;
            proxy_cookie_path [/项目名] [代理路径地址]; #保证https和http的cookie一致
        }
}</code></pre> 
<p>proxy_cookie_path介绍：<a class="link-info" href="https://blog.csdn.net/m0_37564426/article/details/106438204" title="proxy_cookie_path详细介绍">proxy_cookie_path详细介绍</a></p> 
<h2>二、nginx安装SSL证书后，反向代理https请求不携带cookie的问题</h2> 
<p>首先这个问题，有好几个方面的影响，其中一个环节出问题，就都会出问题，所以请耐心看下去，我会尽量讲清楚。</p> 
<h3>1.nginx安装SSL证书后，其中的项目如果ajax或axios发送http请求会出现(已屏蔽:mixed-content)的情况，F12控制台会显示</h3> 
<p>解决办法：通过nginx反向代理tomcat，使所有请求都变成https请求，就不会出现此错误。</p> 
<h3>2.反向代理配置问题</h3> 
<p>如果你是按照我上面的反向代理的配置，那就不会出现问题，主要是要配置</p> 
<p>proxy_set_header Cookie $http_cookie; </p> 
<p> proxy_cookie_path [/项目名] [代理路径地址]; #保证https和http的cookie一致</p> 
<p>这两项。</p> 
<h3>3.例：前后端分离，前端Vue，后端SSM（所以推荐前后端分离项目使用token）</h3> 
<p>Vue中axios是默认不带cookie的，所以要在main.js中添加代码如下：</p> 
<pre><code>import axios from 'axios';#如果有就不要加了
axios.defaults.headers['Content-Type'] = 'application/x-www-form-urlencoded';
axios.defaults.withCredentials = true;</code></pre> 
<p>后端SSM中，我们要配置允许跨域，此处会有一点坑（本菜逼改了一天才找到）</p> 
<p>首先，可以看一下这篇文章：<a class="link-info" href="https://www.jianshu.com/p/0bc30d522244" rel="nofollow" title="前后端分离中本地调试和部署远端Cookie的不同">前后端分离中本地调试和部署远端Cookie的不同</a></p> 
<p>看完上面这一篇文章，就会明白，本地调试为什么没有cookie。</p> 
<p>然后，我们在后端配置允许跨域时（SSM，Spring Boot本质一样都是Spring MVC）</p> 
<p>通常会将'Access-Control-Allow-Origin' = "*",这样在同ip同协议下是可以的，但在Https、http请求转换下，我们就需要将'Access-Control-Allow-Origin' 设置为我们axios所请求的协议加ip，如我的axios请求为https://127.0.0.1/test,那么'Access-Control-Allow-Origin'就要设置为"https://127.0.0.1"。在SSM中的MVC.xml配置如下：</p> 
<pre><code class="language-XML">&lt;!--前后端分离，允许跨域--&gt;
    &lt;!--  重中之重，反复观看  --&gt;
    &lt;mvc:cors&gt;
        &lt;mvc:mapping path="/**"
                     allowed-origins="axios所请求的协议加ip"
                     allowed-methods="POST, GET, OPTIONS, DELETE, PUT"
                     allowed-headers="Content-Type, Access-Control-Allow-Headers, Authorization, X-Requested-With"
                     allow-credentials="true" /&gt;
    &lt;/mvc:cors&gt;</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2dc9d40ecd0f175361706b91932f87a7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">傲软下载地址</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/98de6cdef0a7abad62865466401ac8f5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">CSS复合选择器</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>