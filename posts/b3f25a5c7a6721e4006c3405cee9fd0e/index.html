<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>大数据-ClickHouse技术一（安装部署） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="大数据-ClickHouse技术一（安装部署）" />
<meta property="og:description" content="零、大数据-ClickHouse做为列式数据库，是2016年由俄罗斯人开源，独立于Hoodop生态
研究一番使用如下
docker安装
一、安装
官网安装 | ClickHouse Docs
可以安装到linux服务器，与通过docker安装，方便简单。按照官方文档即可
后续文章使用的是docker方式
二、docker安装文档-服务端
Docker Hub
初始化docker文件见百度网盘：
链接：https://pan.baidu.com/s/12OiRnQhAQiRfb2hnIFXw2A 提取码：netx
文件介绍：docker文件-
ch_data初始化数据文件
ch_initdb数据库初始脚本，用于存放sql、sh脚本。在初始数据化前置同步，比如可以初始化一些数据，或者建基础表、基础库等等
ch_logs用于同步数据库的日志
通过使用docker执行启动命令：
docker run -d -p 18123:8123 -p 19000:9000 -v &#34;$(pwd)/ch_data:/var/lib/clickhouse/&#34; -v &#34;$(pwd)/ch_logs:/var/log/clickhouse-server/&#34; -v &#34;$(pwd)/ch_initdb:/docker-entrypoint-initdb.d/&#34; --name some-clickhouse-server --ulimit nofile=262144:262144 clickhouse/clickhouse-server 三、连接数据库-客户端
可以通过docke自带client服务来启动客户端，也可以通过常用的数据库连接工具
比如Dbeaver-也可以无缝连接ClickHouse数据库
四、初始化数据
docker环境可以初始化一批数据 1000W&#43; 或者几十亿数据，只需要在docker文件中加入数据文件即可。参考官方文档：示例数据集 | ClickHouse Docs
docker文件配置在：
ch_initdb文件夹中的 data.sh 来初始化库、表、数据 将附带数据文件下载放到同级文件夹中，同步数据库实例的时候将数据加载进去即可
五、数据库查询
支持常用的Mysql语法
比如：SLEECT、 CREATE、ALTER、
尤其对于GROUP BY、SUM、分组计算尤为擅长
linux tar文件安装 分片副本安装
一、按照官网安装
安装 | ClickHouse Docs
二、安装zooker集群" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b3f25a5c7a6721e4006c3405cee9fd0e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-11T19:47:26+08:00" />
<meta property="article:modified_time" content="2022-10-11T19:47:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">大数据-ClickHouse技术一（安装部署）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>零、大数据-ClickHouse做为列式数据库，是2016年由俄罗斯人开源，独立于Hoodop生态</p> 
<p>研究一番使用如下</p> 
<p>docker安装</p> 
<p>一、安装</p> 
<p>官网<a href="https://clickhouse.com/docs/zh/getting-started/install/" rel="nofollow" title="安装 | ClickHouse Docs">安装 | ClickHouse Docs</a></p> 
<p>可以安装到linux服务器，与通过docker安装，方便简单。按照官方文档即可</p> 
<p>后续文章使用的是docker方式</p> 
<p>二、docker安装文档-服务端</p> 
<p><a href="https://hub.docker.com/r/clickhouse/clickhouse-server/" rel="nofollow" title="Docker Hub">Docker Hub</a></p> 
<p>初始化docker文件见百度网盘：</p> 
<p>链接：https://pan.baidu.com/s/12OiRnQhAQiRfb2hnIFXw2A <br> 提取码：netx</p> 
<p>文件介绍：docker文件-</p> 
<p>ch_data初始化数据文件</p> 
<p>ch_initdb数据库初始脚本，用于存放sql、sh脚本。在初始数据化前置同步，比如可以初始化一些数据，或者建基础表、基础库等等</p> 
<p>ch_logs用于同步数据库的日志</p> 
<p>通过使用docker执行启动命令：</p> 
<pre><code>docker run -d -p 18123:8123 -p 19000:9000 -v "$(pwd)/ch_data:/var/lib/clickhouse/" -v "$(pwd)/ch_logs:/var/log/clickhouse-server/" -v "$(pwd)/ch_initdb:/docker-entrypoint-initdb.d/" --name some-clickhouse-server --ulimit nofile=262144:262144 clickhouse/clickhouse-server
</code></pre> 
<p>三、连接数据库-客户端</p> 
<p>可以通过docke自带client服务来启动客户端，也可以通过常用的数据库连接工具</p> 
<p>比如Dbeaver-也可以无缝连接ClickHouse数据库</p> 
<p>四、初始化数据</p> 
<p>docker环境可以初始化一批数据 1000W+ 或者几十亿数据，只需要在docker文件中加入数据文件即可。参考官方文档：<a href="https://clickhouse.com/docs/zh/getting-started/example-datasets/" rel="nofollow" title="示例数据集 | ClickHouse Docs">示例数据集 | ClickHouse Docs</a></p> 
<p>docker文件配置在：</p> 
<p>ch_initdb文件夹中的 data.sh 来初始化库、表、数据  将附带数据文件下载放到同级文件夹中，同步数据库实例的时候将数据加载进去即可</p> 
<p>五、数据库查询</p> 
<p>支持常用的Mysql语法</p> 
<p>比如：SLEECT、 CREATE、ALTER、</p> 
<p>尤其对于GROUP BY、SUM、分组计算尤为擅长</p> 
<p></p> 
<p>linux tar文件安装 分片副本安装</p> 
<p>一、按照官网安装</p> 
<p><a href="https://clickhouse.com/docs/zh/getting-started/install" rel="nofollow" title="安装 | ClickHouse Docs">安装 | ClickHouse Docs</a></p> 
<p></p> 
<p>二、安装zooker集群</p> 
<p><a href="https://blog.csdn.net/qq_36602951/article/details/127208505" title="zookeeper集群安装_无敌小田田的博客-CSDN博客">zookeeper集群安装_无敌小田田的博客-CSDN博客</a></p> 
<p>三、在clickhouse配置zookeeper地址</p> 
<p>安装启动好zookeeper后,我们需要在clickhouse中配置zookeeper<br> clickhouse两种配置zookeeper方式,一种是直接在config.xml中配置,另外一种是在外部文件中配置好了,在config.xml中进行引用</p> 
<p>1、内部配置方式</p> 
<pre><code>vim /etc/clickhouse-server/config.xml
</code></pre> 
<p>添加如下配置：</p> 
<pre><code>  &lt;zookeeper&gt;
    &lt;node index="1"&gt;  #index是连接zk的顺序
        &lt;host&gt;node01&lt;/host&gt; #znode地址
        &lt;port&gt;2181&lt;/port&gt;   #znode端口
    &lt;/node&gt;
    &lt;node index="2"&gt;
        &lt;host&gt;10.20.30.40&lt;/host&gt;
        &lt;port&gt;2181&lt;/port&gt;
    &lt;/node&gt;
    &lt;node index="3"&gt;
        &lt;host&gt;10.20.30.45&lt;/host&gt;
        &lt;port&gt;2181&lt;/port&gt;
    &lt;/node&gt;
  &lt;/zookeeper&gt;
</code></pre> 
<p>2、zookeeper配置不支持热更改，必须重启clickhouse服务，重启之前使用sql查询</p> 
<pre><code> select * from system.zookeeper where path = '/';
</code></pre> 
<p>显示表不存在，证明不在zookeeper注册</p> 
<p>重启完服务，就可以查看到该zookeeper表，说明zookeeper配置好了</p> 
<p>四、副本的实现</p> 
<p>1、通过clickhouse的cluster分片设置副本</p> 
<p>首先配置cluster</p> 
<pre><code>vim /etc/clickhouse-server/config.xml
</code></pre> 
<p>在vim模式下输入<code>:/remote_servers</code>快速查找到配置cluster的标签</p> 
<p> <img alt="在这里插入图片描述" src="https://images2.imgbox.com/00/a9/iwqp9i6U_o.png"></p> 
<p> 在&lt;remote_servers&gt;标签之中就是我们配置shard与replica的地方<br> 先看下面配置,说明</p> 
<pre><code> &lt;remote_servers incl="clickhouse_remote_servers" &gt;
   &lt;my_shard&gt;
               &lt;shard&gt;
	&lt;internal_replication&gt;true&lt;/internal_replication&gt;
	&lt;weight&gt;1&lt;/weight&gt;
                     &lt;replica&gt;
                            &lt;host&gt;node01&lt;/host&gt;
                            &lt;port&gt;9000&lt;/port&gt;
                            &lt;user&gt;default&lt;/user&gt;
                            &lt;password&gt;default&lt;/password&gt;
                     &lt;/replica&gt;
                     &lt;replica&gt;
                            &lt;host&gt;node02&lt;/host&gt;
                            &lt;port&gt;9000&lt;/port&gt;
                             &lt;user&gt;default&lt;/user&gt;
                            &lt;password&gt;default&lt;/password&gt;
                     &lt;/replica&gt;
              &lt;/shard&gt;
              &lt;shard&gt;
&lt;internal_replication&gt;true&lt;/internal_replication&gt;
	&lt;weight&gt;1&lt;/weight&gt;
                     &lt;replica&gt;
                            &lt;host&gt;node03&lt;/host&gt;
                            &lt;port&gt;9000&lt;/port&gt;
                             &lt;user&gt;default&lt;/user&gt;
                            &lt;password&gt;default&lt;/password&gt;
                     &lt;/replica&gt;
                     &lt;replica&gt;
                            &lt;host&gt;node04&lt;/host&gt;
                            &lt;port&gt;9000&lt;/port&gt;
                             &lt;user&gt;default&lt;/user&gt;
                            &lt;password&gt;default&lt;/password&gt;
                     &lt;/replica&gt;
              &lt;/shard&gt;
      &lt;/my_shard&gt;
 &lt;/remote_servers&gt;
</code></pre> 
<p>&lt;my_shard&gt;是cluster名称,任意填写,在后面通过这个名字引用如 on cluster my_shard<br> &lt;shard&gt;指分片,有几个分片就配置几个&lt;shard&gt;标签<br> &lt;replica&gt;指副本,有几个副本就有几个&lt;replica&gt;标签.<br> 上方的配置是有两个分片,每个分片两个副本.这里理解也可以是有两个分片,每个分片一个副本.<br> 打个比方说,一张test表基于以上配置,共有id 1,2,3,4 四条数据,那么node01中有1,2两条,node02中有1,2两条,node03中有3,4两条,node04中有3,4两条,这样子举例比较好理解<br> 注意：&lt;internal_replication&gt;true&lt;/internal_replication&gt;属性，在有zookeeper情况下写true。如果没有zookeeper一定设置为false。false是通过click内部机制实现副本的数据同步，true是通过zookeeper实现数据同步。<br>  &lt;weight&gt;1&lt;/weight&gt; 设置各个分片的数据比重 </p> 
<p>2、配置好了之后校验</p> 
<p>cluster可以热加载,所以不需要重启服务,通过系统表可以查看cluster</p> 
<pre><code>select * from system.clusters where cluster='my_shard';
</code></pre> 
<p><img alt="" height="168" src="https://images2.imgbox.com/6c/d2/2J7nBIyQ_o.png" width="834"></p> 
<p>五、其他配置项</p> 
<p>1、打开配置cluster</p> 
<pre><code>vim /etc/clickhouse-server/config.xml
</code></pre> 
<p>2、指定IP</p> 
<p>指定自己所在节点IP，如不指定，默认会读电脑名称，可能导致在数据副本同步时候连接不上，建议指定为自身电脑的IP</p> 
<p>&lt;interserver_http_host&gt;10.20.30.40&lt;/interserver_http_host&gt;<br> 3、指定集群分片配置 &amp;&amp; 默认副本表配置项，后续新建会省事</p> 
<p>&lt;macros&gt;<br>         &lt;shard&gt;s01&lt;/shard&gt;<br>         &lt;replica&gt;r02&lt;/replica&gt;<br>     &lt;/macros&gt;<br> &lt;default_replica_path&gt;/clickhouse/tables/{shard}/{database}/{table}&lt;/default_replica_path&gt;<br> &lt;default_replica_name&gt;{replica}&lt;/default_replica_name&gt;</p> 
<p>如上，即搭建好了分布式的数据库以及zookeeper配置。后续可以建分布式数据库表了</p> 
<p></p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0e55b1936d5c0b0605267b270dbbf9cd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何计算维吉尼亚密码？Java实现维吉尼亚密码的加密解密算法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/da234d29333e728d082f818260c2fee8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">小白burp Suite超详细安装</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>