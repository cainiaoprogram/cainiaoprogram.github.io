<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>重新启动postgre报错时，解决方案   ( 由备份文件占用空间太大造成 ) (linux 命令 df -h 查看磁盘空间) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="重新启动postgre报错时，解决方案   ( 由备份文件占用空间太大造成 ) (linux 命令 df -h 查看磁盘空间)" />
<meta property="og:description" content="在这里使用了一个liunx下的命令查看磁盘空间
df: disk free http://www.cnblogs.com/chenwenbiao/archive/2011/08/07/2129831.html
常用参数:df -h
-------------------------------------
1.在Linux下重新启动postgre
pg_ctl restart (postgres 用户)
今天遇到的问题
由于导入数据，造成数据库不断生成备份文件，占满了空间
无法继续启动。
解决方法:
备份文件所在目录结构
root
databases
archieves
data
pg_xlog
archive_status
(archieves 档案;文件;记录)
删除这些目录下面的数据备份文件
-------------------------------------------------------------------------------
错误现象
执行pg_ctl restart命令
报错
could not change directory to &#34;/root&#34;
pg_ctl:PID file &#34;/database/data/postmaster.pid&#34; does not exist
出现这种问题的原因
不是因为目录下没有这个文件，而是因为磁盘空间太小
进程执行时，没有足够的空间来读取这个文件。
使用postgres用户执行以下命令
df -h可以查看数据库的空间的使用状况
FIlesystem size used avail Use% Mounted on /dev/sda3 70 70 0 100 / 进程没有足够的空间来运行，所以出现了上面的错误
----------------------------------------------------
问题产生
使用存储过程对postgre插入数据
每次插入10万条数据，由此在上面的那些目录产生了n多的备份文件
这些备份文件占用了大量的磁盘空间" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/e8e2c791fe68922e5d8b360ee5a4e26c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-04-23T15:52:56+08:00" />
<meta property="article:modified_time" content="2012-04-23T15:52:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">重新启动postgre报错时，解决方案   ( 由备份文件占用空间太大造成 ) (linux 命令 df -h 查看磁盘空间)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="font-size:18px; color:#993399">在这里使用了一个liunx下的命令查看磁盘空间</span></p> 
<p><span style="font-size:18px; color:#ff0000">df: disk free  <a href="http://www.cnblogs.com/chenwenbiao/archive/2011/08/07/2129831.html" rel="nofollow"> <span style="font-size:12px">http://www.cnblogs.com/chenwenbiao/archive/2011/08/07/2129831.html</span></a></span></p> 
<p><span style="font-size:18px; color:#009900"><span style="color:#993399; background-color:rgb(255,255,255)">常用参数:</span><span style="color:#ff0000">df -h</span></span></p> 
<p><span style="font-size:18px; color:#3366ff">-------------------------------------</span></p> 
<p><span style="font-size:18px; color:#3366ff">1.在Linux下重新启动postgre</span></p> 
<p><span style="font-size:18px; color:#3366ff">pg_ctl restart (postgres 用户)</span></p> 
<p><span style="font-size:18px; color:#3366ff"></span></p> 
<p><span style="font-size:18px; color:#3366ff">今天遇到的问题</span></p> 
<p><span style="font-size:18px; color:#3366ff">由于导入数据，造成数据库不断生成备份文件，占满了空间</span></p> 
<p><span style="font-size:18px; color:#3366ff">无法继续启动。</span></p> 
<p><span style="font-size:18px"></span></p> 
<p><strong><span style="font-size:18px; color:#3366ff">解决方法:</span></strong></p> 
<p><span style="font-size:18px">备份文件所在目录结构</span></p> 
<p><span style="font-size:18px">root</span></p> 
<p><span style="font-size:18px">   databases</span></p> 
<p><span style="font-size:18px">       <span style="color:#ff0000">archieves</span></span></p> 
<p><span style="font-size:18px">       data</span></p> 
<p><span style="font-size:18px">       pg_xlog</span></p> 
<p><span style="font-size:18px">           <span style="color:#ff0000">archive_status</span></span></p> 
<p><span style="font-size:16px; color:#33cc00">(archieves 档案<span class="enfont"><span style="font-family:Arial">;</span></span>文件<span class="enfont"><span style="font-family:Arial">;</span></span>记录)</span></p> 
<p><span style="font-size:18px; color:#3366ff">删除这些目录下面的数据备份文件</span></p> 
<p><span style="font-size:18px; color:#cc66cc">-------------------------------------------------------------------------------</span></p> 
<p><span style="font-size:18px; color:#3333ff"><strong>错误现象</strong></span></p> 
<p><span style="font-size:18px; color:#3366ff">执行pg_ctl restart命令</span></p> 
<p><span style="font-size:18px; color:#ff6666">报错</span></p> 
<p><span style="font-size:18px; color:#ff6666">could not change directory to "/root"</span></p> 
<p><span style="font-size:18px; color:#ff6666">pg_ctl:PID file "/database/data/postmaster.pid" does not exist</span></p> 
<p><span style="font-size:18px; color:#cc66cc"></span></p> 
<p><span style="font-size:18px; color:#cc66cc"><strong>出现这种问题的原因</strong></span></p> 
<p><span style="font-size:18px; color:#cc66cc">不是因为目录下没有这个文件，而是因为磁盘空间太小</span></p> 
<p><span style="font-size:18px; color:#cc66cc">进程执行时，没有足够的空间来读取这个文件。</span></p> 
<p><span style="font-size:18px; color:#cc66cc"></span></p> 
<p><span style="font-size:18px; color:#3366ff">使用postgres用户执行以下命令</span></p> 
<p><span style="font-size:18px; color:#3366ff">df -h可以查看数据库的空间的使用状况</span></p> 
<p><span style="font-size:18px; color:#ffffff; background-color:rgb(0,0,0)">FIlesystem     size   used   avail    Use%   Mounted on                     </span></p> 
<p><span style="font-size:18px; color:#ffffff; background-color:rgb(0,0,0)">/dev/sda3        70     70         0       100         /                                    </span></p> 
<p><span style="font-size:18px; color:#3366ff">进程没有足够的空间来运行，所以出现了上面的错误</span></p> 
<p><span style="color:#cc66cc"></span></p> 
<p><span style="color:#3366ff"></span></p> 
<p>----------------------------------------------------</p> 
<p><span style="font-size:18px; color:#009900"><strong>问题产生</strong></span></p> 
<p><span style="font-size:18px; color:#009900">使用存储过程对postgre插入数据</span></p> 
<p><span style="font-size:18px; color:#009900">每次插入10万条数据，由此在上面的那些目录产生了n多的备份文件</span></p> 
<p><span style="font-size:18px; color:#009900">这些备份文件占用了大量的磁盘空间</span></p> 
<p><span style="font-size:18px; color:#009900">当最后一次执行这个批处理命令时</span></p> 
<p><span style="font-size:18px; color:#009900">控制台报错，说磁盘空间不足，紧接着这边就再也连接不上数据库了</span></p> 
<p><span style="font-size:18px; color:#009900">查看进程，发现postgre的进程已经停掉</span></p> 
<p><span style="font-size:18px; color:#009900"></span></p> 
<p><span style="font-size:18px; color:#009900">重新启动时，就报了上面的那个错误</span></p> 
<p><span style="font-size:18px; color:#009900">could not change directory to "/root"</span></p> 
<p><span style="font-size:18px; color:#009900">pg_ctl:PID file "/database/data/postmaster.pid" does not exist</span></p> 
<p><span style="font-size:18px; color:#009900"></span></p> 
<p><span style="font-size:18px; color:#009900">----------------------------------------</span></p> 
<p><span style="font-size:18px; color:#ff0000"><strong>注意:</strong></span></p> 
<p><span style="font-size:18px; color:#ff0000">是什么吃掉了磁盘空间</span></p> 
<p><span style="font-size:18px; color:#ff0000">是备份文件吃掉的巨大的磁盘空间</span></p> 
<p><span style="font-size:18px; color:#ff0000">其实，那几百万条数据并没有占用多少磁盘空间</span></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/72f1bee555a8d7cd6a5838f39fbf4708/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">FileZilla Server 中文乱码问题解决</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a783f998dfd5627e0e36f13957c9b9e4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">android中的左右滑动</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>