<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>è§£æC&#43;&#43;ä¸­std::ref - èœé¸Ÿç¨‹åºå‘˜åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="è§£æC&#43;&#43;ä¸­std::ref" />
<meta property="og:description" content="1. å‰è¨€ å…³äºc&#43;&#43;ä¸­çš„std::refï¼Œstd::refåœ¨c&#43;&#43;11å¼•å…¥ã€‚æœ¬æ–‡é€šè¿‡è®²è§£std::refçš„å¸¸ç”¨æ–¹å¼ï¼ŒåŠå‰–æä¸‹std::refå†…éƒ¨å®ç°ï¼Œè¿›è€Œå†æ¥è®²è§£ä¸‹std::reference_wrapperï¼Œç„¶åæˆ‘ä»¬å†è¿›ä¸€æ­¥åˆ†æä¸ºä»€ä¹ˆä½¿ç”¨std::refã€‚
2. std::ref ç”¨æ³• ç®€å•ä¸¾ä¾‹æ¥è¯´ï¼š
int n1 = 0; auto n2 = std::ref(n1); n2&#43;&#43;; n1&#43;&#43;; std::cout &lt;&lt; n1 &lt;&lt; std::endl; // 2 std::cout &lt;&lt; n2 &lt;&lt; std::endl; // 2 å¯ä»¥çœ‹åˆ° æ˜¯æŠŠn1çš„å¼•ç”¨ä¼ é€’ç»™äº†n2ï¼Œåˆ†åˆ«è¿›è¡ŒåŠ æ³•ï¼Œå¯ä»¥çœ‹åˆ°n2æ˜¯n1çš„å¼•ç”¨ï¼Œæœ€ç»ˆå¾—åˆ°çš„å€¼éƒ½æ˜¯2
é‚£ä¹ˆå¤§å®¶å¯èƒ½ä¼šæƒ³ï¼Œæˆ‘éƒ½å·²ç»æœ‰äº†â€™int&amp; a = bâ€™çš„è¿™ç§å¼•ç”¨èµ‹å€¼çš„è¯­æ³•äº†ï¼Œä¸ºä»€ä¹ˆc&#43;&#43;11åˆå‡ºç°äº†ä¸€ä¸ªstd::refï¼Œæˆ‘ä»¬ç»§ç»­æ¥çœ‹ä¾‹å­ï¼š
#include &lt;iostream&gt; #include &lt;thread&gt; void thread_func(int&amp; n2) { // error, &gt;&gt; int n2 n2&#43;&#43;; } int main() { int n1 = 0; std::thread t1(thread_func, n1); t1.join(); std::cout &lt;&lt; n1 &lt;&lt; std::endl; } æˆ‘ä»¬å¦‚æœå†™æˆè¿™æ ·æ˜¯ç¼–è¯‘ä¸è¿‡çš„ï¼Œé™¤éæ˜¯å»æ‰å¼•ç”¨ç¬¦å·ï¼Œé‚£ä¹ˆæˆ‘å¦‚æœéè¦ä¼ å¼•ç”¨æ€ä¹ˆåŠå‘¢ï¼Ÿ" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/38b75ed2b429ebb2a62422c7ce1352f8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-26T19:15:40+08:00" />
<meta property="article:modified_time" content="2022-01-26T19:15:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="èœé¸Ÿç¨‹åºå‘˜åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">èœé¸Ÿç¨‹åºå‘˜åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">è§£æC&#43;&#43;ä¸­std::ref</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="1__0"></a>1. å‰è¨€</h4> 
<p>å…³äºc++ä¸­çš„std::refï¼Œstd::refåœ¨c++11å¼•å…¥ã€‚æœ¬æ–‡é€šè¿‡è®²è§£std::refçš„å¸¸ç”¨æ–¹å¼ï¼ŒåŠå‰–æä¸‹std::refå†…éƒ¨å®ç°ï¼Œè¿›è€Œå†æ¥è®²è§£ä¸‹std::reference_wrapperï¼Œç„¶åæˆ‘ä»¬å†è¿›ä¸€æ­¥åˆ†æä¸ºä»€ä¹ˆä½¿ç”¨std::refã€‚</p> 
<h4><a id="2_stdref__4"></a>2. std::ref ç”¨æ³•</h4> 
<p>ç®€å•ä¸¾ä¾‹æ¥è¯´ï¼š</p> 
<pre><code class="prism language-C++">int n1 = 0;
auto n2 = std::ref(n1);

n2++;
n1++;

std::cout &lt;&lt; n1 &lt;&lt; std::endl;  // 2
std::cout &lt;&lt; n2 &lt;&lt; std::endl;  // 2
</code></pre> 
<p>å¯ä»¥çœ‹åˆ° æ˜¯æŠŠn1çš„å¼•ç”¨ä¼ é€’ç»™äº†n2ï¼Œåˆ†åˆ«è¿›è¡ŒåŠ æ³•ï¼Œå¯ä»¥çœ‹åˆ°n2æ˜¯n1çš„å¼•ç”¨ï¼Œæœ€ç»ˆå¾—åˆ°çš„å€¼éƒ½æ˜¯2</p> 
<p>é‚£ä¹ˆå¤§å®¶å¯èƒ½ä¼šæƒ³ï¼Œæˆ‘éƒ½å·²ç»æœ‰äº†â€™int&amp; a = bâ€™çš„è¿™ç§å¼•ç”¨èµ‹å€¼çš„è¯­æ³•äº†ï¼Œä¸ºä»€ä¹ˆc++11åˆå‡ºç°äº†ä¸€ä¸ªstd::refï¼Œæˆ‘ä»¬ç»§ç»­æ¥çœ‹ä¾‹å­ï¼š</p> 
<pre><code class="prism language-c++">#include &lt;iostream&gt;
#include &lt;thread&gt;

void thread_func(int&amp; n2) { // error, &gt;&gt; int n2
    n2++;
}

int main() {
    int n1 = 0;
    std::thread t1(thread_func, n1);

    t1.join();
    std::cout &lt;&lt; n1 &lt;&lt; std::endl;
}
</code></pre> 
<p>æˆ‘ä»¬å¦‚æœå†™æˆè¿™æ ·æ˜¯ç¼–è¯‘ä¸è¿‡çš„ï¼Œé™¤éæ˜¯å»æ‰å¼•ç”¨ç¬¦å·ï¼Œé‚£ä¹ˆæˆ‘å¦‚æœéè¦ä¼ å¼•ç”¨æ€ä¹ˆåŠå‘¢ï¼Ÿ</p> 
<pre><code class="prism language-c++">// snap ...

int main() {
    int n1 = 0;
    std::thread t1(thread_func, std::ref(n1));

    t1.join();
    std::cout &lt;&lt; n1 &lt;&lt; std::endl; // 1
}
</code></pre> 
<p>è¿™æ ·å¯ä»¥çœ‹åˆ°å¼•ç”¨ä¼ é€’æˆåŠŸï¼Œå¹¶ä¸”èƒ½å¤Ÿè¾¾åˆ°æˆ‘ä»¬æ•ˆæœï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸ªä¾‹å­ï¼š</p> 
<pre><code class="prism language-c++">#include &lt;iostream&gt;
#include &lt;functional&gt;

void func(int&amp; n2) {
    n2++;
}

int main() {
    int n1 = 0;
    auto bind_fn = std::bind(&amp;func, std::ref(n1));

    bind_fn();
    std::cout &lt;&lt; n1 &lt;&lt; std::endl; // 1
}
</code></pre> 
<p>è¿™é‡Œæˆ‘ä»¬ä¹Ÿå‘ç°std::bindè¿™æ ·ä¹Ÿæ˜¯éœ€è¦é€šè¿‡std::refæ¥å®ç°bindå¼•ç”¨ã€‚</p> 
<p>é‚£ä¹ˆæˆ‘ä»¬å…¶å®å¯ä»¥çœ‹çš„å‡ºæ¥ï¼Œstd::bindæˆ–è€…std::threadé‡Œæ˜¯åšäº†ä»€ä¹ˆå¯¼è‡´æˆ‘ä»¬åŸæ¥çš„é€šè¿‡&amp;ä¼ é€’å¼•ç”¨çš„æ–¹å¼å¤±æ•ˆï¼Œæˆ–è€…è¯´std::refæ˜¯åšäº†ä»€ä¹ˆæ‰èƒ½ä½¿å¾—æˆ‘ä»¬ä½¿ç”¨std::bindå’Œstd::threadèƒ½å¤Ÿä¼ é€’å¼•ç”¨ã€‚</p> 
<p>é‚£ä¹ˆæˆ‘ä»¬å±•å¼€std::refçœ‹çœ‹ä»–çš„çœŸé¢ç›®ï¼Œå¤§è‡´å†…å®¹å¦‚ä¸‹ï¼š</p> 
<pre><code class="prism language-c++">template &lt;class _Ty&gt;
reference_wrapper&lt;_Ty&gt; ref(_Ty&amp; _Val) noexcept {
    return reference_wrapper&lt;_Ty&gt;(_Val);
}
</code></pre> 
<p>è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°std::refæœ€ç»ˆåªæ˜¯è¢«åŒ…è£…æˆreference_wrapperè¿”å›ï¼Œæ‰€ä»¥å…³é”®ç‚¹è¿˜æ˜¯std::reference_wrapper</p> 
<h4><a id="3_stdreference_wrapper_88"></a>3. std::reference_wrapper</h4> 
<p>å…³äºè¿™ä¸ªç±»ï¼Œæˆ‘ä»¬çœ‹ä¸‹cppreferenceä¸Šçš„å®ç°å½¢å¼ä¸ºï¼š</p> 
<pre><code class="prism language-c++">namespace detail {
template &lt;class T&gt; constexpr T&amp; FUN(T&amp; t) noexcept { return t; }
template &lt;class T&gt; void FUN(T&amp;&amp;) = delete;
}
 
template &lt;class T&gt;
class reference_wrapper {
public:
  // types
  typedef T type;
 
  // construct/copy/destroy
  template &lt;class U, class = decltype(
    detail::FUN&lt;T&gt;(std::declval&lt;U&gt;()),
    std::enable_if_t&lt;!std::is_same_v&lt;reference_wrapper, std::remove_cvref_t&lt;U&gt;&gt;&gt;()
  )&gt;
  constexpr reference_wrapper(U&amp;&amp; u) noexcept(noexcept(detail::FUN&lt;T&gt;(std::forward&lt;U&gt;(u))))
    : _ptr(std::addressof(detail::FUN&lt;T&gt;(std::forward&lt;U&gt;(u)))) {}
  reference_wrapper(const reference_wrapper&amp;) noexcept = default;
 
  // èµ‹å€¼
  reference_wrapper&amp; operator=(const reference_wrapper&amp; x) noexcept = default;
 
  // è®¿é—®
  constexpr operator T&amp; () const noexcept { return *_ptr; }
  constexpr T&amp; get() const noexcept { return *_ptr; }
 
  template&lt; class... ArgTypes &gt;
  constexpr std::invoke_result_t&lt;T&amp;, ArgTypes...&gt;
    operator() ( ArgTypes&amp;&amp;... args ) const {
    return std::invoke(get(), std::forward&lt;ArgTypes&gt;(args)...);
  }
 
private:
  T* _ptr;
};
 
// deduction guides
template&lt;class T&gt;
reference_wrapper(T&amp;) -&gt; reference_wrapper&lt;T&gt;;
</code></pre> 
<p>é‡Œè¾¹æœ‰ä¸€äº›è¯­æ³•æ¯”è¾ƒæ™¦æ¶©ï¼Œæˆ‘ä»¬ä¸€ç‚¹ä¸€ç‚¹çš„æ¥çœ‹</p> 
<p>æœ€å¼€å§‹æ˜¯ä¸€ä¸ªdetailçš„<strong>namespace</strong>ï¼Œé‡Œè¾¹æœ‰ä¸¤ä¸ªå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ¥æ”¶å·¦å€¼å¼•ç”¨çš„ï¼Œç¬¬äºŒä¸ªæ˜¯æ¥æ”¶å³å€¼å¼•ç”¨çš„ï¼Œæ¥æ”¶å³å€¼å¼•ç”¨çš„è¢«deleteï¼Œä¸èƒ½è°ƒç”¨ã€‚è¿™é‡Œdetailæ˜¯ä¸ºåè¾¹åšæ ¡éªŒçš„ï¼Œå¤§å®¶å¯èƒ½ä¼šåƒï¼Œä¸ç”¨å³å€¼å¼•ç”¨ä¸å†™å°±å¯ä»¥äº†ï¼Œä¸ºå•¥å†™äº†è¿™ä¸ªå‡½æ•°è¿˜è¦æ ‡è®°ä¸ºdeleteã€‚è¿™æ˜¯å› ä¸ºå¦‚æœæ²¡æœ‰ç¬¬äºŒä¸ªå‡½æ•°å³å€¼å‚æ•°æ˜¯å¯ä»¥ä¼ é€’ç»™ç¬¬ä¸€ä¸ªå‡½æ•°çš„ï¼Œå¦‚æœå†™äº†å°±ä¼šä¼˜å…ˆåŒ¹é…åˆ°åˆ°ç¬¬äºŒä¸ªå‡½æ•°ï¼Œå‘ç°è¿™ä¸ªå‡½æ•°æ˜¯deleteï¼Œä¸èƒ½ç¼–è¯‘é€šè¿‡ï¼Œæ˜ç™½äº†è¿™ä¸ªæˆ‘ä»¬ç»§ç»­ã€‚<br></p> 
<p>æ¥ç€æˆ‘ä»¬çœ‹åˆ°reference_wrapperï¼Œé¦–å…ˆæ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œçœ‹åˆ°å¾ˆé•¿çš„ä¸€ä¸ª<strong>æ„é€ å‡½æ•°</strong>ï¼Œæˆ‘ä»¬æ‹†å¼€æ¥çœ‹ï¼Œtemplate &lt;class U, class = xxx&gt;è¿™ç§å†™æ³•ï¼Œåè¾¹é‚£ä¸ªclass=ä¹Ÿæ˜¯åœ¨ç¼–è¯‘æœŸåšæ ¡éªŒä½¿ç”¨ï¼ŒSFINEAçš„ä¸€ç§å®ç°å½¢å¼å§ï¼Œå¦‚æœclass=åè¾¹é‚£ä¸ªç¼–è¯‘ä¸è¿‡ï¼Œé‚£ä¹ˆä½ å°±ä¸å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ„é€ å‡½æ•°ã€‚</p> 
<p>class=åè¾¹è¿™æ®µå¾ˆé•¿çš„ä»£ç ï¼š</p> 
<pre><code class="prism language-c++">template &lt;class U, class = decltype(
    detail::FUN&lt;T&gt;(std::declval&lt;U&gt;()),
    std::enable_if_t&lt;!std::is_same_v&lt;reference_wrapper, std::remove_cvref_t&lt;U&gt;&gt;&gt;()
  )&gt;
</code></pre> 
<p>é¦–å…ˆæ˜¯ä¸€ä¸ªdecltypeå…³é”®å­—ï¼Œå¾—åˆ°çš„æ˜¯ä¸€ä¸ªç±»å‹ã€‚decltypeå†…éƒ¨æ˜¯ä½¿ç”¨é€—å·è¡¨è¾¾å¼è¿æ¥ä¸¤éƒ¨åˆ†ï¼Œé€—å·å·¦è¾¹éƒ¨åˆ†è°ƒç”¨detailçš„FUNæ¥æ ¡éªŒï¼Œstd::declvalæ˜¯ä¸ç”¨è°ƒç”¨æ„é€ å‡½æ•°ä¾¿å¯ä»¥ä½¿ç”¨ç±»çš„æˆå‘˜å‡½æ•°ï¼Œä¸è¿‡åªèƒ½ç”¨äºä¸æ±‚å€¼è¯­å¢ƒã€‚è·å–Uçš„å¯¹è±¡çœ‹ä¸‹æ˜¯å¦æ˜¯å³å€¼ï¼Œä¸Šè¾¹ä¹Ÿè¯´åˆ°å¦‚æœå³å€¼åˆ™ç¼–è¯‘ä¸è¿‡ã€‚å¦‚æœæ˜¯å·¦å€¼çš„è¯çœ‹é€—å·å³è¾¹çš„éƒ¨åˆ†ï¼Œstd::enable_if_t&lt;&gt;, è¿™é‡Œ&lt;&gt;ä¸­çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ¡ä»¶ï¼Œå¦‚æœæ¡ä»¶æ»¡è¶³è¿”å›ç¬¬äºŒä¸ªå‚æ•°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ç±»å‹ï¼Œ è¿™é‡Œæ²¡æœ‰ç¬¬äºŒä¸ªå‚æ•°ï¼Œé»˜è®¤æ˜¯voidï¼Œå³å¦‚æœæ»¡è¶³æ¡ä»¶å¯ä»¥ç¼–è¯‘é€šè¿‡ï¼Œå¦åˆ™ç¼–è¯‘ä¸é€šè¿‡ã€‚æ¡ä»¶æ˜¯std::is_same_vå–åï¼Œstd::is_same_v&lt;&gt;æ˜¯å¦‚æœä¸¤ä¸ªæ¨¡æ¿å‚æ•°ç›¸åŒç±»å‹åˆ™æ˜¯trueï¼Œå¦åˆ™falseã€‚æ‰€ä»¥reference_wrapperå’Œstd::remove_cvref_t&lt;U&gt;ä¸ç›¸åŒåˆ™å¯ä»¥é€šè¿‡ç¼–è¯‘ï¼Œstd::remove_cvref_tè¿™ä¸ªæ¨¡æ¿åˆæ˜¯å»æ‰Uè¿™ä¸ªç±»å‹çš„const,volatileå’Œå¼•ç”¨çš„å±æ€§ï¼Œå•çº¯ä¸¤ä¸ªç±»å‹æ¯”è¾ƒã€‚</p> 
<p>ä¸Šè¾¹æ€»ç»“å°±æ˜¯åœ¨è°ƒç”¨æ„é€ å‡½æ•°æ—¶ï¼Œé¦–å…ˆè¿›è¡Œæ ¡éªŒï¼Œä¼ å…¥å‚æ•°æ—¶å³å€¼å’Œreference_wrapperç±»å‹å°±ä¸èƒ½ç¼–è¯‘é€šè¿‡ã€‚</p> 
<p>ç„¶åæ˜¯æ„é€ å‡½æ•°çš„æ­£æ–‡ï¼š</p> 
<pre><code class="prism language-C++">constexpr reference_wrapper(U&amp;&amp; u) noexcept(noexcept(detail::FUN&lt;T&gt;(std::forward&lt;U&gt;(u))))
    : _ptr(std::addressof(detail::FUN&lt;T&gt;(std::forward&lt;U&gt;(u)))) {}
</code></pre> 
<p>è¿™é‡Œå…ˆçœ‹ä¸‹â€œnoexcept(noexcept(detail::FUN(std::forward&lt;U&gt;(u))))â€è¿™æ®µä»£ç ï¼Œä¸äº†è§£noexceptæˆ‘è¿™é‡Œå¤§æ¦‚è®²è§£ä¸‹ã€‚</p> 
<blockquote> 
 <p>è¯­æ³•ä¸Šæ¥è¯´noexceptåˆ†ä¸ºä¿®é¥°ç¬¦å’Œæ“ä½œç¬¦ä¸¤ç§åˆ†ç±»å§ã€‚</p> 
 <p>ä¿®é¥°ç¬¦å†™æ³•æ˜¯noexcept(expression)ï¼Œexpressionæ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼Œexpressionè¿™ä¸ªå€¼è¿”å›trueåˆ™ç¼–è¯‘å™¨è®¤ä¸ºä¿®é¥°çš„å‡½æ•°ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œè¿™æ—¶å¦‚æœè¯¥å‡½æ•°å†æŠ›å‡ºå¼‚å¸¸åˆ™è°ƒç”¨std::abortç»ˆæ­¢ç¨‹åºï¼Œå¦‚æœå€¼è¿”å›falseåˆ™è®¤ä¸ºè¯¥å‡½æ•°å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚è€Œæˆ‘ä»¬å¸¸çœ‹åˆ°å‡½æ•°å£°æ˜åè¾¹åªå†™ä¸€ä¸ªnoexceptï¼Œå…¶å®ä¹Ÿæ˜¯ç›¸å½“äºnoexcept(true)ã€‚</p> 
 <p>æ“ä½œç¬¦å¤§éƒ½ç”¨äºæ¨¡æ¿ä¸­ï¼Œå†™æ³•å°±æ˜¯æˆ‘ä»¬è¿™é‡Œç¼©å†™çš„é‚£æ ·noexcept(noexcept(T()))ï¼Œé‚£ä¹ˆè¿™é‡ŒT()å†³å®šè¯¥å‡½æ•°æ˜¯å¦æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœT()ä¼šæŠ›å‡ºå¼‚å¸¸é‚£ä¹ˆç¬¬äºŒä¸ªnoexceptå°±ä¼šè¿”å›falseï¼Œå¦åˆ™è¿”å›trueã€‚</p> 
</blockquote> 
<p>é‚£ä¹ˆè¿™é‡Œæ„é€ å‡½æ•°å°±æ˜¯è¯´å¦‚æœæ‰§è¡Œâ€œdetail::FUN(std::forward&lt;U&gt;(u))â€ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆå°±ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè¿™æ ·ä¹Ÿæ˜¯æ›´å¥½çš„å‘ŠçŸ¥ç¼–è¯‘å™¨ä¸€ä¸ªæ¡ä»¶å§ã€‚</p> 
<p>ç»§ç»­çš„å°±æ˜¯_ptrå­˜æ”¾çš„æ˜¯ä¼ è¿›æ¥å‚æ•°çš„åœ°å€ï¼Œè¿™é‡Œä¹Ÿæ˜¯æ¯”è¾ƒå…³é”®ï¼Œç›¸å½“äºæ˜¯reference_wrapperçš„å®ç°å°±æ˜¯é€šè¿‡ä¿å­˜ä¼ è¿›æ¥å‚æ•°çš„åœ°å€æ¥è¾¾åˆ°å¼•ç”¨çš„åŒ…è£…ï¼ˆref wrapperï¼‰æ•ˆæœã€‚</p> 
<p>æ„é€ å‡½æ•°ç»ˆäºè®²å®Œäº†ï¼Œæ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼è¿ç®—ç¬¦åº”è¯¥ä¸ç”¨è®²äº†</p> 
<p>å†ç„¶åå°±æ˜¯çœ‹ä¸‹å¦‚ä½•è®¿é—®äº†</p> 
<pre><code class="prism language-c++">constexpr operator T&amp; () const noexcept { return *_ptr; }
constexpr T&amp; get() const noexcept { return *_ptr; }
</code></pre> 
<p>è¿™ä¸¤ä¸ªä¹Ÿæ¯”è¾ƒç®€å•ï¼Œæä¾›äº†ä¸€ä¸ªgetå‡½æ•°å’Œ()çš„é‡è½½ï¼Œå®ç°å°±æ˜¯è·å–_ptrå­˜æ”¾åœ°å€æ‰€æŒ‡å‘çš„å€¼ã€‚</p> 
<pre><code class="prism language-c++">template&lt; class... ArgTypes &gt;
  constexpr std::invoke_result_t&lt;T&amp;, ArgTypes...&gt;
    operator() ( ArgTypes&amp;&amp;... args ) const {
    return std::invoke(get(), std::forward&lt;ArgTypes&gt;(args)...);
  }
</code></pre> 
<p>è¿˜æœ‰ä¸€ä¸ªå®ç°æ˜¯ç»™å­˜æ”¾çš„å‚æ•°æ˜¯å‡½æ•°ç±»å‹ä½¿ç”¨çš„ï¼Œä¹Ÿå°±æ˜¯é‡è½½"()()"ï¼Œå¯ä»¥è°ƒç”¨è¿™ä¸ªå‡½æ•°å¹¶ä¼ å‚è¿‡å»ã€‚</p> 
<p>æœ€åå°±æ˜¯C++17å¼•å…¥çš„æ¨å¯¼æŒ‡å¼•ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯å¸®åŠ©æ¨¡æ¿ç±»å‹æ¨å¯¼ä½¿ç”¨çš„</p> 
<pre><code class="prism language-c++"> æ¨å¯¼æŒ‡å¼•
template&lt;class T&gt;
reference_wrapper(T&amp;) -&gt; reference_wrapper&lt;T&gt;;
</code></pre> 
<p>å¦‚æœæ²¡æœ‰è¿™å¥è¯ï¼Œæˆ‘ä»¬æ„é€ reference_wraperæ—¶ï¼Œéœ€è¦è¿™ä¹ˆå†™reference_wraper&lt;int&gt;(n1)ï¼Œé‚£ä¹ˆæœ‰äº†è¿™å¥æ¨å¯¼æŒ‡å¼•ï¼Œæˆ‘ä»¬å¯ä»¥å†™æˆè¿™æ ·reference_wraper(n1)ï¼Œæ–¹ä¾¿å¾ˆå¤šï¼Œä¸ç”¨å†™æ¨¡æ¿å‚æ•°ç±»å‹ã€‚</p> 
<p>é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬è°ƒç”¨è¯•è¯•çœ‹ï¼ˆå› ä¸ºcppreferenceä¸­å®ç°æœ‰äº›è¯­æ³•ç”¨åˆ°äº†C++17æˆ–è€…æ›´é«˜ï¼Œä½¿ç”¨ç¼–è¯‘å™¨è¦æ›´é«˜ç‰ˆæœ¬æˆ–è€…æ›¿æ¢ä¸€äº›è¯­æ³•å³å¯ï¼‰:</p> 
<pre><code class="prism language-c++">void func(int&amp; n2) {
    n2++;
}

int main() {
    int n1 = 0;
    auto bind_fn = std::bind(&amp;func, reference_wrapper(n1));

    bind_fn();
    std::cout &lt;&lt; n1 &lt;&lt; std::endl;  // 1
}
</code></pre> 
<p>å®Œç¾ï¼å¯ä»¥é€šè¿‡, æ‰€ä»¥reference_wrapperæœ¬è´¨æ˜¯æŠŠå¯¹è±¡çš„åœ°å€ä¿å­˜, è®¿é—®æ˜¯å–å‡ºåœ°å€çš„å€¼ã€‚</p> 
<p>è¿™é‡Œæˆ‘ä»¬å€ŸåŠ©çš„æ˜¯cppreferenceä¸­å®ç°æ¥è®²è§£çš„ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥å‚è€ƒè‡ªå·±æœ¬åœ°ç¼–è¯‘å™¨çš„å®ç°ã€‚</p> 
<h4><a id="4__224"></a>4. ä¸ºä»€ä¹ˆä½¿ç”¨</h4> 
<p>æˆ‘ä»¬çœ‹ä¸‹ä¸ºä»€ä¹ˆstd::bindæˆ–è€…std::threadä¸ºä»€ä¹ˆè¦ä½¿ç”¨reference_wrapperï¼Œæˆ‘ä»¬ä»¥std::bindä¸ºä¾‹å­å§ï¼Œæˆ‘ä»¬å¤§è‡´å»è·Ÿè¸ªä¸‹std::bindï¼Œè·Ÿè¸ªçš„ç›®çš„æ˜¯çœ‹ä¼ é€’boundå‚æ•°(å³æˆ‘ä»¬ä¼ ç»™bindå‡½æ•°çš„å‚æ•°)çš„ç”Ÿå‘½å‘¨æœŸï¼Œä»¥vs2019çš„å®ç°ä¸ºä¾‹ï¼š</p> 
<pre><code class="prism language-c++">template &lt;class _Fx, class... _Types&gt;
_NODISCARD _CONSTEXPR20 _Binder&lt;_Unforced, _Fx, _Types...&gt; bind(_Fx&amp;&amp; _Func, _Types&amp;&amp;... _Args) {
    return _Binder&lt;_Unforced, _Fx, _Types...&gt;(_STD forward&lt;_Fx&gt;(_Func), _STD forward&lt;_Types&gt;(_Args)...);
}
</code></pre> 
<p>çœ‹åˆ°æ˜¯æ„é€ äº†ä¸€ä¸ª_Binderçš„å¯¹è±¡è¿”å›ï¼Œboundå‚æ•°ä½œä¸ºæ„é€ å‡½æ•°çš„å‚æ•°ä¼ å…¥,</p> 
<pre><code class="prism language-c++">using _Second = tuple&lt;decay_t&lt;_Types&gt;...&gt;; //std::decay_tä¼šç§»é™¤æ‰å¼•ç”¨å±æ€§
_Compressed_pair&lt;_First, _Second&gt; _Mypair;

constexpr explicit _Binder(_Fx&amp;&amp; _Func, _Types&amp;&amp;... _Args)
        : _Mypair(_One_then_variadic_args_t{}, _STD forward&lt;_Fx&gt;(_Func), _STD forward&lt;_Types&gt;(_Args)...) {}
</code></pre> 
<p>ä¹Ÿå¯ä»¥çœ‹åˆ°æ„é€ å‡½æ•°ä¸­ï¼Œå‚æ•°ä¼ é€’ç»™_Mypairæˆå‘˜ã€‚åˆ°è¿™é‡Œç»“æŸã€‚</p> 
<p>æˆ‘ä»¬å†çœ‹ä¸‹è°ƒç”¨æ—¶ï¼š</p> 
<pre><code class="prism language-c++">#define _CALL_BINDER                                                                  \
    _Call_binder(_Invoker_ret&lt;_Ret&gt;{}, _Seq{}, _Mypair._Get_first(), _Mypair._Myval2, \
        _STD forward_as_tuple(_STD forward&lt;_Unbound&gt;(_Unbargs)...))

template &lt;class... _Unbound&gt;
    _CONSTEXPR20 auto operator()(_Unbound&amp;&amp;... _Unbargs) noexcept(noexcept(_CALL_BINDER)) -&gt; decltype(_CALL_BINDER) {
    return _CALL_BINDER;
}
</code></pre> 
<p>çœ‹åˆ°è°ƒç”¨æ—¶ä¼šç”¨åˆ°_CALL_BINDERå®ï¼Œè¿™é‡Œè°ƒç”¨_Call_binderå‡½æ•°ï¼Œå¹¶æŠŠ_Mypairä¼ å…¥ï¼Œå†æ¥ä¸‹æ¥å°±ä¼šè°ƒç”¨åˆ°æˆ‘ä»¬çš„å‡½æ•°å¹¶ä¼ å…¥boundçš„å‚æ•°äº†ã€‚</p> 
<p>æ€»ç»“ä¸‹å°±æ˜¯std::bindé¦–å…ˆå°†ä¼ å…¥çš„å‚æ•°å­˜æ”¾èµ·æ¥ï¼Œç­‰åˆ°è¦è°ƒç”¨bindçš„å‡½æ•°å°±å°†å‚æ•°ä¼ å…¥ï¼Œè€Œè¿™é‡Œæ²¡æœ‰ä¿å­˜ä¼ å…¥å‚æ•°çš„å¼•ç”¨ï¼Œåªèƒ½ä¿å­˜ä¸€ä»½å‚æ•°çš„æ‹·è´ï¼Œå¦‚æœä½¿ç”¨æˆ‘ä»¬ä¸Šè¾¹è¯´çš„â€œint&amp; a = bâ€è¯­æ³•ï¼Œ_Binderç±»ä¸­æ— æ³•ä¿å­˜bçš„å¼•ç”¨ï¼Œè‡ªç„¶è°ƒç”¨æ—¶ä¼ å…¥çš„å°±ä¸æ˜¯bçš„å¼•ç”¨ï¼Œæ‰€ä»¥å€ŸåŠ©reference_wrapperå°†ä¼ å…¥å‚æ•°çš„åœ°å€ä¿å­˜ï¼Œä½¿ç”¨æ˜¯é€šè¿‡åœ°å€å–å‡ºæ¥å€¼è¿›è€Œè°ƒç”¨å‡½æ•°ã€‚</p> 
<h4><a id="5__264"></a>5. æ€»ç»“</h4> 
<p>æˆ‘æ¥ç»™æ€»ç»“ä¸‹ï¼Œé¦–å…ˆæˆ‘ä»¬è®²è§£äº†std::refçš„ä¸€äº›ç”¨æ³•ï¼Œç„¶åæˆ‘ä»¬è®²è§£std::refæ˜¯é€šè¿‡std::reference_wrapperå®ç°ï¼Œç„¶åæˆ‘ä»¬å€ŸåŠ©äº†cppreferenceä¸Šçš„å®ç°æ¥ç»™å¤§å®¶å‰–æäº†ä»–æœ¬è´¨å°±æ˜¯å­˜æ”¾äº†å¯¹è±¡çš„åœ°å€(ç±»ä¼¼æŒ‡é’ˆçš„ç”¨æ³•ğŸ˜)ï¼Œè¿˜è®²è§£äº†noexceptç­‰è¯­æ³•ï¼Œæœ€åæˆ‘ä»¬è®²è§£äº†ä¸‹std::bindä¸ºä»€ä¹ˆè¦ä½¿ç”¨åˆ°reference_wrapper.</p> 
<h4><a id="6__268"></a>6. å‚è€ƒ</h4> 
<ul><li>https://en.cppreference.com</li><li>ã€Šæ·±å…¥ç†è§£C++11ã€‹</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/22510bd3afc6bd8162c888f52d70ef29/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">ä¸ƒå¤©ç©è½¬Redis | Day6ã€SpringBooté›†æˆRedis</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e9c0b57cdebe64e7b89cdaec0abc5ac7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">ï¼ˆå°šç¡…è°·ï¼‰Vueç¬”è®°------22</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 èœé¸Ÿç¨‹åºå‘˜åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>