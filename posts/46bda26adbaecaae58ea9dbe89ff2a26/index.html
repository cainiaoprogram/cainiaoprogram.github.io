<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>JS快速获取图片宽高的方法 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="JS快速获取图片宽高的方法" />
<meta property="og:description" content="快速获取图片的宽高其实是为了预先做好排版样式布局做准备，通过快速获取图片宽高的方法比onload方法要节省很多时间，甚至一分钟以上都有可能，并且这种方法适用主流浏览器包括IE低版本浏览器。
我们一步一步进入这个过程。
一、简陋的获取图片方式 // 图片地址 后面加时间戳是为了避免缓存var img_url = &#39;http://www.qttc.net/static/upload/2013/13643608813441.jpg?&#39;&#43;Date.parse(new Date());// 创建对象var img = new Image();// 改变图片的srcimg.src = img_url;// 打印alert(&#39;width:&#39;&#43;img.width&#43;&#39;,height:&#39;&#43;img.height); 执行：
宽高都是0的这个结果很正常，因为图片的相关数据都没有被加载前它的宽高默认就是0
于是可以这么优化！
二、onload后在打印 // 图片地址 后面加时间戳是为了避免缓存 var img_url = &#39;http://www.qttc.net/static/upload/2013/13643608813441.jpg?&#39;&#43;Date.parse(new Date());
// 创建对象
var img = new Image();
// 改变图片的src
img.src = img_url;
// 加载完成执行
img.onload = function(){
// 打印
alert(&#39;width:&#39;&#43;img.width&#43;&#39;,height:&#39;&#43;img.height);
}; 执行：
通过onload就能获取到图片的宽高了。但onload大一点的图通常都比较慢，不实用，但只要图片被浏览器缓存，那么图片加载几乎就不用等待即可触发onload，我们要的是占位符。所以有些人通过缓存获取也可以这么写。
三、通过complete与onload一起混合使用 为了测试缓存效果，注意以下测试图片的url都不加时间戳
// 图片地址
var img_url = &#39;http://www.qttc.net/static/upload/2013/13643608813441.jpg&#39;;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/46bda26adbaecaae58ea9dbe89ff2a26/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-03-18T16:25:57+08:00" />
<meta property="article:modified_time" content="2014-03-18T16:25:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">JS快速获取图片宽高的方法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> 快速获取图片的宽高其实是为了预先做好排版样式布局做准备，通过快速获取图片宽高的方法比onload方法要节省很多时间，甚至一分钟以上都有可能，并且这种方法适用主流浏览器包括IE低版本浏览器。</p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> 我们一步一步进入这个过程。</p> 
<h4 style="margin:20px 0px 0px; padding:0px; font-family:'Lucida Grande',宋体; line-height:28.799999237060547px; font-size:16px!important; color:rgb(34,119,0)!important"> 一、简陋的获取图片方式</h4> 
<div style="margin:0px; padding:0px; font-family:'Lucida Grande',宋体; line-height:28.799999237060547px"> 
 <div id="highlighter_999643" class="syntaxhighlighter  jscript" style="padding:0px; width:628px; margin:20px 0px!important; position:relative!important; overflow:auto!important"> 
  <pre class="brush:jscript;" style="margin-top:10px; margin-bottom:0px; padding:0px; line-height:12px; background-color:rgb(255,255,255)"><span style="font-size:14px; color:#009900">// 图片地址 后面加时间戳是为了避免缓存
var img_url = 'http://www.qttc.net/static/upload/2013/13643608813441.jpg?'+Date.parse(new Date());
 
// 创建对象
var img = new Image();
 
// 改变图片的src
img.src = img_url;
 
// 打印
alert('width:'+img.width+',height:'+img.height);</span></pre> 
  <br> 
 </div> 
</div> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> 执行：</p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> <img alt="" src="https://images2.imgbox.com/26/8b/IcuH0NuL_o.jpg" style="margin:0px; padding:0px; border:1px solid rgb(204,204,204); vertical-align:middle; max-width:100%; width:286px; height:197px"></p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> 宽高都是0的这个结果很正常，因为图片的相关数据都没有被加载前它的宽高默认就是0</p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> 于是可以这么优化！</p> 
<h4 style="margin:20px 0px 0px; padding:0px; font-family:'Lucida Grande',宋体; line-height:28.799999237060547px; font-size:16px!important; color:rgb(34,119,0)!important"> 二、onload后在打印</h4> 
<div style="margin:0px; padding:0px; font-family:'Lucida Grande',宋体; line-height:28.799999237060547px"> 
 <div id="highlighter_449631" class="syntaxhighlighter  jscript" style="padding:0px; width:628px; margin:20px 0px!important; position:relative!important; overflow:auto!important"> 
  <span style="color:rgb(51,51,51); font-size:1em!important">// 图片地址 后面加时间戳是为了避免缓存</span> 
  <br> 
  <span style="font-size:14px; color:#009900">var img_url = 'http://www.qttc.net/static/upload/2013/13643608813441.jpg?'+Date.parse(new Date());<br>  <br> // 创建对象<br> var img = new Image();<br>  <br> // 改变图片的src<br> img.src = img_url;<br>  <br> // 加载完成执行<br> img.onload = function(){<!-- --><br>     // 打印<br>     alert('width:'+img.width+',height:'+img.height);<br> };</span> 
  <br> 
 </div> 
</div> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> 执行：</p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> <img alt="" src="https://images2.imgbox.com/96/ee/nL40zSuM_o.jpg" style="margin:0px; padding:0px; border:1px solid rgb(204,204,204); vertical-align:middle; max-width:100%; width:281px; height:184px"></p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> 通过onload就能获取到图片的宽高了。但onload大一点的图通常都比较慢，不实用，但只要图片被浏览器缓存，那么图片加载几乎就不用等待即可触发onload，我们要的是占位符。所以有些人通过缓存获取也可以这么写。</p> 
<h4 style="margin:20px 0px 0px; padding:0px; font-family:'Lucida Grande',宋体; line-height:28.799999237060547px; font-size:16px!important; color:rgb(34,119,0)!important"> 三、通过complete与onload一起混合使用</h4> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> 为了测试缓存效果，注意以下测试图片的url都不加时间戳</p> 
<div style="margin:0px; padding:0px; font-family:'Lucida Grande',宋体; line-height:28.799999237060547px"> 
 <div id="highlighter_381185" class="syntaxhighlighter  jscript" style="padding:0px; width:628px; margin:20px 0px!important; position:relative!important; overflow:auto!important"> 
  <span style="font-size:14px; color:#009900">// 图片地址<br> var img_url = 'http://www.qttc.net/static/upload/2013/13643608813441.jpg';<br>  <br> // 创建对象<br> var img = new Image();<br>  <br> // 改变图片的src<br> img.src = img_url;<br>  <br> // 判断是否有缓存<br> if(img.complete){<!-- --><br>     // 打印<br>     alert('from:complete : width:'+img.width+',height:'+img.height);<br> }else{<!-- --><br>     // 加载完成执行<br>     img.onload = function(){<!-- --><br>         // 打印<br>         alert('from:onload : width:'+img.width+',height:'+img.height);<br>     };<br> }<br> </span> 
  <br> 
  <br> 
 </div> 
</div> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> 第一次执行，永远是onload触发</p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> <img alt="" src="https://images2.imgbox.com/c8/b5/KMOJLKMV_o.jpg" style="margin:0px; padding:0px; border:1px solid rgb(204,204,204); vertical-align:middle; max-width:100%; width:278px; height:191px"></p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> 你再刷新，几乎都是缓存触发了</p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> <img alt="" src="https://images2.imgbox.com/aa/af/tu0HS6tu_o.jpg" style="margin:0px; padding:0px; border:1px solid rgb(204,204,204); vertical-align:middle; max-width:100%; width:298px; height:189px"></p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> <span style="margin:0px; padding:0px; color:rgb(0,128,0)">从缓存里读取图片的宽高不用说，非常方便快捷，今天我们要解决的是没有缓存而又快速的相比onload更快的方式去获取图片的宽高</span>。我们常常知道有些图片虽然没有完全down下来，但是已经先有占位符，然后一点一点的加载。既然有占位符那应该是请求图片资源服务器响应后返回的。可服务器什么时候响应并返回宽高的数据没有触发事件，比如onload事件。于是催生了第四种方法</p> 
<h4 style="margin:20px 0px 0px; padding:0px; font-family:'Lucida Grande',宋体; line-height:28.799999237060547px; font-size:16px!important; color:rgb(34,119,0)!important"> 四、通过定时循环检测获取</h4> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> 看看以下例子，为了避免从缓存里读取数据，每一次请求都带时间戳：</p> 
<div style="margin:0px; padding:0px; font-family:'Lucida Grande',宋体; line-height:28.799999237060547px"> 
 <div id="highlighter_424035" class="syntaxhighlighter  jscript" style="padding:0px; width:628px; margin:20px 0px!important; position:relative!important; overflow:auto!important"> 
  <span style="font-size:14px; color:#009900">// 图片地址<br> var img_url = 'http://www.qttc.net/static/upload/2013/13643608813441.jpg?'+Date.parse(new Date());<br>  <br> // 创建对象<br> var img = new Image();<br>  <br> // 改变图片的src<br> img.src = img_url;<br>  <br> // 定时执行获取宽高<br> var check = function(){<!-- --><br>     document.body.innerHTML += '&lt;div&gt;from:&lt;span style="color:red;"&gt;check&lt;/span&gt; : width:'+img.width+',height:'+img.height+'&lt;/div&gt;';<br> };<br>  <br> var set = setInterval(check,40);<br>  <br> // 加载完成获取宽高<br> img.onload = function(){<!-- --><br>     document.body.innerHTML += '&lt;div&gt;from:&lt;span style="color:blue"&gt;onload&lt;/span&gt; : width:'+img.width+',height:'+img.height+'&lt;/div&gt;';<br>  <br>     // 取消定时获取宽高<br>     clearInterval(set);<br> };</span> 
  <br> 
 </div> 
</div> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> FireFox</p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> <img alt="" src="https://images2.imgbox.com/a5/0b/7705otb3_o.jpg" style="margin:0px; padding:0px; border:1px solid rgb(204,204,204); vertical-align:middle; max-width:100%; width:376px; height:398px"></p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> IE7 8 9 10</p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> <img alt="" src="https://images2.imgbox.com/16/5e/HK62Zy7p_o.jpg" style="margin:0px; padding:0px; border:1px solid rgb(204,204,204); vertical-align:middle; max-width:100%; width:292px; height:456px"></p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> Chrome</p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> <img alt="" src="https://images2.imgbox.com/aa/c2/hpDH3P4J_o.jpg" style="margin:0px; padding:0px; border:1px solid rgb(204,204,204); vertical-align:middle; max-width:100%; width:403px; height:351px"></p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> 通过以上测试，我们发现定时检测图片宽高的方式要比onload快多了，打印的行数越多表示onload时间越长，40毫秒执行一次，基本100毫秒内就能获取图片的宽高，chrome甚至在第一次循环的时候就已经获得数据。从以上数据来分析，其实我们可以在定时函数里判断只要图片的宽高都大于0就表示已经获得正确的图片宽高。我们把时间打上，来看看通过定时获取宽高或者onload获取宽高所需要多少时间。</p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> 代码：</p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; font-family:'Lucida Grande',宋体; line-height:28.799999237060547px"> <span style="font-size:14px; color:#009900">// 记录当前时间戳<br> var start_time = new Date().getTime();<br>  <br> // 图片地址<br> var img_url = 'http://b.zol-img.com.cn/desk/bizhi/image/2/2560x1600/1365477614755.jpg?'+start_time;<br>  <br> // 创建对象<br> var img = new Image();<br>  <br> // 改变图片的src<br> img.src = img_url;<br>  <br> // 定时执行获取宽高<br> var check = function(){<!-- --><br>     // 只要任何一方大于0<br>     // 表示已经服务器已经返回宽高<br>     if(img.width&gt;0 || img.height&gt;0){<!-- --><br>         var diff = new Date().getTime() - start_time;<br>         document.body.innerHTML += '&lt;div&gt;from:&lt;span style="color:red;"&gt;check&lt;/span&gt; : width:'+img.width+',height:'+img.height+', time:'+diff+'ms&lt;/div&gt;';<br>         clearInterval(set);<br>     }<br> };<br>  <br> var set = setInterval(check,40);<br>  <br> // 加载完成获取宽高<br> img.onload = function(){<!-- --><br>     var diff = new Date().getTime() - start_time;<br>     document.body.innerHTML += '&lt;div&gt;from:&lt;span style="color:blue"&gt;onload&lt;/span&gt; : width:'+img.width+',height:'+img.height+', time:'+diff+'ms&lt;/div&gt;';<br> };</span><br> </p> 
<div style="margin:0px; padding:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> 
 <div id="highlighter_342330" class="syntaxhighlighter  jscript" style="padding:0px; width:628px; margin:20px 0px!important; position:relative!important; overflow:auto!important; font-size:1em!important"> 
 </div> 
</div> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> FireFox：</p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> <img alt="" src="https://images2.imgbox.com/3b/5a/VO0fqmGg_o.jpg" style="margin:0px; padding:0px; border:1px solid rgb(204,204,204); vertical-align:middle; max-width:100%; width:409px; height:141px"></p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> IE</p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> <img alt="" src="https://images2.imgbox.com/2e/4b/x7jX47VK_o.jpg" style="margin:0px; padding:0px; border:1px solid rgb(204,204,204); vertical-align:middle; max-width:100%; width:336px; height:170px"></p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> Chrome</p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> <img alt="" src="https://images2.imgbox.com/22/b4/LnuTHPXK_o.jpg" style="margin:0px; padding:0px; border:1px solid rgb(204,204,204); vertical-align:middle; max-width:100%; width:422px; height:138px"></p> 
<p style="margin-top:20px; margin-bottom:0px; padding-top:0px; padding-bottom:0px; color:rgb(51,51,51); font-family:'Lucida Grande',宋体; font-size:16px; line-height:28.799999237060547px"> 这是一张2560 * 1600大小的图片，各浏览器执行结果都能看到通过快速获取图片大小的方法几乎都在200毫秒以内，而onload至少五秒以上，这差别之大说明快速获取图片宽高非常实用。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c6f38653d7e237ec9dc15b486c07e8ba/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">c&#43;&#43;如何取出string中的第一个字符…</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d2064885770e5c2412c72c92f72ab4fe/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java.lang.ClassCastException: android.app.Application cannot be cast to serialport_api.sample.App问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>