<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>华为交换机PVID与VLAN ID及TAG 、UNTAG学习记录 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="华为交换机PVID与VLAN ID及TAG 、UNTAG学习记录" />
<meta property="og:description" content="一、PVID和VLAN ID
1、PVID是端口的属性，端口的标识，具有唯一性，交换机默认未配置Vlan的情况下，因为全局vlan1的原因，所有端口的PVID都是1。如下图：
2、交换机里面display port vlan命令可以查看未配置状态下的pvid，运行display vlan 可以查看缺省vlan 1的情况。如下图：
可见，缺省状态下，所有的端口都在vlan 1中，所有的端口的PVID标识缺省都为1
3、下面看下配置了vlan情况下，PVID的变化及vlan ID的变化，配置命令为
vlan batch 20 30 40
interface GigabitEthernet0/0/1
port link-type trunk
port trunk pvid vlan 20
port trunk allow-pass vlan 20 30 40
interface GigabitEthernet0/0/2
port link-type access
port default vlan 20
interface GigabitEthernet0/0/3
port link-type access
port default vlan 30
interface GigabitEthernet0/0/4
port link-type access
port default vlan 40
可见配置完access类型的接口后,该端口缺省PVID由原来的1变成了配置的所属vlan的Vlan ID，注意标红的命令port trunk pvid vlan 20，配置完Trunk类型的接口，如果手动指定该端口的PVID，则trunk端口的PVID将由原来的PVID=1变成手动配置指定的PVID=20.
另外，通过display port vlan命令可以看出，端口的PVID属性一直存在，不管配置或者未配置PVID都存在，trunk类型的接口下，端口可以有多个vlan，如上面截图中，Trunk link list 列表是1、20、30、40这几个VLan，PVID通过配置可以改变,但是一个端口有且仅有一个PVID。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/89ff25f2c71159f919caca2ea4291951/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-12T17:27:03+08:00" />
<meta property="article:modified_time" content="2022-12-12T17:27:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">华为交换机PVID与VLAN ID及TAG 、UNTAG学习记录</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="text-align:center;"><strong>一、PVID和VLAN ID</strong></p> 
<p>1、PVID是端口的属性，端口的标识，具有唯一性，交换机默认未配置Vlan的情况下，因为全局vlan1的原因，所有端口的PVID都是1。如下图：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/b0/4a/7ks8kMfu_o.png"></p> 
<p>2、交换机里面display port vlan命令可以查看未配置状态下的pvid，运行display vlan 可以查看缺省vlan 1的情况。如下图：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/22/15/xbjICOgJ_o.png"></p> 
<p>可见，缺省状态下，所有的端口都在vlan 1中，所有的端口的PVID标识缺省都为1</p> 
<p>3、下面看下配置了vlan情况下，PVID的变化及vlan ID的变化，配置命令为</p> 
<p>vlan batch 20 30 40</p> 
<p>interface GigabitEthernet0/0/1<br>  port link-type trunk<br><em><strong> <span style="color:#fe2c24;">port trunk pvid vlan 20</span></strong></em><br>  port trunk allow-pass vlan 20 30 40<br><br> interface GigabitEthernet0/0/2<br>  port link-type access<br>  port default vlan 20<br><br> interface GigabitEthernet0/0/3<br>  port link-type access<br>  port default vlan 30</p> 
<p>interface GigabitEthernet0/0/4<br>  port link-type access<br>  port default vlan 40</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/2b/b1/ZSA3mJWp_o.png"></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/5a/8f/HdqEbMUR_o.png"></p> 
<p>可见配置完access类型的接口后,该端口缺省PVID由原来的1变成了配置的所属vlan的Vlan ID，注意标红的命令<em><strong><span style="color:#fe2c24;">port trunk pvid vlan 20，配置完Trunk类型的接口，如果手动指定该端口的PVID，则trunk端口的PVID将由原来的PVID=1变成手动配置指定的PVID=20.</span></strong></em></p> 
<p></p> 
<p> 另外，通过display port vlan命令可以看出，端口的PVID属性一直存在，不管配置或者未配置PVID都存在，trunk类型的接口下，端口可以有多个vlan，如上面截图中，Trunk link list 列表是1、20、30、40这几个VLan，PVID通过配置可以改变,但是一个端口有且仅有一个PVID。</p> 
<p>特别需要注意这个全局vlan 1，默认情况下，trunk端口都是允许vlan 1通过的，除非禁止vlan 1通过，配置命令如下：<span style="color:#fe2c24;"> <strong>undo port trunk allow-pass vlan1</strong></span>，查看vlan  和port vlan相应的变化如下两图.</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/06/e1/8tZmn1ka_o.png"></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/54/68/sHhtYLHr_o.png"> </p> 
<p style="text-align:center;">二、关于交换机的vlan帧的TAG 和  UNTAG</p> 
<p>1、通过以上图中vlan的比较，发现vlan30里面g0/0/3（access类型）里面是untag的，我的猜想是这个access接口收到数据时候添加vlan帧标签，vid=pvid即30，</p> 
<p>2、g0/0/1这个是tag的，vlan 30在trunk允许通过的列表中，这里g0/0/1中我设置的pvid=20，vlan 30的帧vid=pvid=30，和该端口pvid比较，<span style="color:#fe2c24;"><strong>不相同</strong></span>，所以直接通过该端口<span style="color:#fe2c24;">转发不进行帧剥离</span>。</p> 
<p>3、再看vlan 20，g0/0/2是access类型，在接收数据时候添加vlan帧标签，vid=pvid=20，打上tag；</p> 
<p>同时g0/0/1trunk接口手动设置端口属性的pvid=20，当vlan20的数据帧通过该trunk端口时候，由于该端口的pvid=20，和vlan20的数据帧中的标签vid比较，<span style="color:#fe2c24;"><strong>相同，根据机制，将该vlan帧进行剥离后再转发。</strong></span></p> 
<p><span style="color:#fe2c24;"><strong>这里需要注意，g0/0/1接口类型是trunk，手动修改了pvid=20。如果没有修改的情况下，pvid为缺省的值即pvid=1，其他vlan的数据帧再进入该端口时候，vlan帧的vid=相应的vlan号，和pvid=1不相同，所以不进行剥离直接通过该端口进行转发。</strong></span></p> 
<p>4、</p> 
<p>端口类型Access<br> Access端口在收到数据后会添加Vlan Tag，VlanId 和端口的PVID相同，access端口缺省的PVID即为该端口所在的vlan的ID。<br> Access端口在转发数据前会移除Vlan Tag</p> 
<p><br> 端口类型 trunk<br> Trunk端口在收到数据帧时候，如果该帧不包含Vlan Tag，将添加上端口的Pvid，如果该帧带有Vlan Tag,则不变<br> Trunk端口在发送数据帧时候，如果该帧的Vlan Id在trunk的允许通过的列表中，且Vlan Tag和改端口的PVid相同，则剥离Tag发送。若该帧的<br> Vlan Tag和该端口的PVID不同，则直接发送。</p> 
<p style="text-align:center;"></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/210536f0559848c020aa461df87e3d91/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">微信扫码登陆在chrome浏览器失败,浏览器禁止重定向</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f161040ea381e2035c36072fcf917f67/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">年底了还没入门？分享下我的自动驾驶与CV算法工程师成长路线图</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>