<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>aardio嵌入外部窗口（以scrcpy手机投屏窗口为例） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="aardio嵌入外部窗口（以scrcpy手机投屏窗口为例）" />
<meta property="og:description" content="scrcpy是一个安卓手机投屏到电脑的开源组件。手机在开发者选项中打开USB调试开关，使用数据线连接到电脑，运行scrcpy.exe，就可以在电脑上查看手机屏幕，可以使用鼠标、键盘进行操作，并且提供了一系列命令行和快捷键，方便二次开发。我下载的是scrcpy-win32-v1.25，你也可以到github下载其他版本。
嵌入外部窗口并不是一个值得推荐的开发方式，但这个方法还是要掌握，有时候可以作为应急之选。下面是个小练习。
import win.ui; /*DSG{{*/ var winform = win.form(text=&#34;未连接&#34;;right=759;bottom=469;bgcolor=12639424) winform.add( btnConnect={cls=&#34;button&#34;;text=&#34;连接手机&#34;;left=473;top=59;right=614;bottom=101;dr=1;dt=1;z=1}; btnDisconnect={cls=&#34;button&#34;;text=&#34;断开连接&#34;;left=472;top=127;right=613;bottom=169;dr=1;dt=1;z=2} ) /*}}*/ import process.popen import winex import winex.key winform.btnConnect.oncommand = function(id,event){ if pp return ; pp=process.popen(&#34;\scrcpy\scrcpy.exe&#34;) device=pp.expect(&#34;Device\:(.&#43;?)\r&#34;,5000) if (!device ){ pp.terminate() pp=null hwnd=null return win.msgbox(&#34;连接失败&#34;); } winform.text=device hwnd=winex.wait(,,&#34;@SDL_app&#34;,,,pp.process.id) win.modifyStyle(hwnd,0x800000/*_WS_BORDER*/|0x40000/*_WS_THICKFRAME*/) winex.attach(hwnd,true) winex.key.combine(hwnd,&#34;ALT&#34;,&#34;W&#34;) winex.attach(hwnd,false) _,_,w0,h0=win.getPos(hwnd) win.setParent(hwnd,winform.hwnd) adjust(hwnd) win.show(hwnd) } winform.btnDisconnect.oncommand = function(id,event){ if pp pp.terminate(); pp=null hwnd=null winform.text=&#34;未连接&#34; } winform.onClose = function(hwnd,message,wParam,lParam){ if pp pp.terminate() } winform.adjust = function( cx,cy,wParam ) {	adjust(hwnd) }; adjust=function(hwnd){ if !" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b372df5d7d6f3f3135cae673879ae2bb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-26T22:04:00+08:00" />
<meta property="article:modified_time" content="2022-12-26T22:04:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">aardio嵌入外部窗口（以scrcpy手机投屏窗口为例）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>scrcpy是一个安卓手机投屏到电脑的开源组件。手机在开发者选项中打开USB调试开关，使用数据线连接到电脑，运行scrcpy.exe，就可以在电脑上查看手机屏幕，可以使用鼠标、键盘进行操作，并且提供了一系列命令行和快捷键，方便二次开发。我下载的是<a class="link-info" href="https://pan.baidu.com/s/1H7atS6kxGHKP8G9lDOOvJg?pwd=csdn" rel="nofollow" title="scrcpy-win32-v1.25">scrcpy-win32-v1.25</a>，你也可以到github下载其他版本。</p> 
<p>嵌入外部窗口并不是一个值得推荐的开发方式，但这个方法还是要掌握，有时候可以作为应急之选。下面是个小练习。</p> 
<pre><code class="hljs">import win.ui;
/*DSG{<!-- -->{*/
var winform = win.form(text="未连接";right=759;bottom=469;bgcolor=12639424)
winform.add(
btnConnect={cls="button";text="连接手机";left=473;top=59;right=614;bottom=101;dr=1;dt=1;z=1};
btnDisconnect={cls="button";text="断开连接";left=472;top=127;right=613;bottom=169;dr=1;dt=1;z=2}
)
/*}}*/

import process.popen
import winex
import winex.key

winform.btnConnect.oncommand = function(id,event){
	if pp return ; 
	pp=process.popen("\scrcpy\scrcpy.exe")
	device=pp.expect("Device\:(.+?)\r",5000)
	if (!device ){
		pp.terminate()
		pp=null
		hwnd=null
		return win.msgbox("连接失败"); 
	}
	winform.text=device
	hwnd=winex.wait(,,"@SDL_app",,,pp.process.id)
	win.modifyStyle(hwnd,0x800000/*_WS_BORDER*/|0x40000/*_WS_THICKFRAME*/)
	winex.attach(hwnd,true) 
	winex.key.combine(hwnd,"ALT","W")
	winex.attach(hwnd,false)
	_,_,w0,h0=win.getPos(hwnd)
	win.setParent(hwnd,winform.hwnd)
	adjust(hwnd) 
	win.show(hwnd)
}

winform.btnDisconnect.oncommand = function(id,event){
	if pp pp.terminate();
	pp=null
	hwnd=null
	winform.text="未连接"
}

winform.onClose = function(hwnd,message,wParam,lParam){
    if pp pp.terminate()
}

winform.adjust = function( cx,cy,wParam ) {	 
	adjust(hwnd)  
};

adjust=function(hwnd){
	if !hwnd return ; 
	var rc=winform.getClientRect()	
	var height=rc.height()
	var h1=height-20
	var w1=h1*w0/h0
	win.setPos(hwnd,rc.left+50,rc.top+10,w1,h1)
}

winform.show();
win.loopMessage();
return winform;</code></pre> 
<p><img alt="" height="480" src="https://images2.imgbox.com/9d/53/XiUm8rJ4_o.gif" width="720"></p> 
<p> 这里用的是设置父窗口的办法，有时候也可以用悬浮窗口。窗口样式需要改一下，位置和大小需要调一调，感觉不算复杂。</p> 
<p>scrcpy有个默认控制台，为了屏蔽它，使用了管道。有时候，嵌套的程序在打开瞬间来不及调整，也可以用管道调用，调整好了再显示。</p> 
<p>第一次使用嵌入窗口，可能理解得不透彻，欢迎指正。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/de2119a4f77ed4a61a7bd0215be616e9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Merry Christmas！一起用C语言绘制一个动态的圣诞树吧</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ab1cdb75de26960b645903233aade5ea/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">spring cloud gateway网关转发websocket请求</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>