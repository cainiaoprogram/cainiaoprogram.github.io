<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python socket编程（传输字符、文件、图片） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python socket编程（传输字符、文件、图片）" />
<meta property="og:description" content="socket官方文档：https://docs.python.org/2/library/socket.html
socket中文详细介绍：http://blog.csdn.net/rebelqsp/article/details/22109925
查看某端口是否被占用(如6666端口)：sudo netstat -nap | grep 6666 如果没有查找到6666端口则说明没有被占用（额，有点废话了~~）
环境说明 python2.7ubuntu 客户端 创建 socket连接到远程服务器发送数据接收数据关闭 socket #!/usr/bin/env python # -*- coding=utf-8 -*- &#34;&#34;&#34; file: client.py socket client &#34;&#34;&#34; import socket import sys def socket_client(): try: s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((&#39;127.0.0.1&#39;, 6666)) except socket.error as msg: print msg sys.exit(1) print s.recv(1024) while 1: data = raw_input(&#39;please input work: &#39;) s.send(data) print s.recv(1024) if data == &#39;exit&#39;: break s.close() if __name__ == &#39;__main__&#39;: socket_client() 服务器端 打开 socket绑定到特定的地址以及端口上监听连接建立连接接收/发送数据 #!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/bd486a57994fd1942a02462d6ce2ae8f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-12-06T19:37:18+08:00" />
<meta property="article:modified_time" content="2016-12-06T19:37:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python socket编程（传输字符、文件、图片）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>socket官方文档：https://docs.python.org/2/library/socket.html</p> 
<p>socket中文详细介绍：http://blog.csdn.net/rebelqsp/article/details/22109925</p> 
<p>查看某端口是否被占用(如6666端口)：<code>sudo netstat -nap | grep 6666</code> 如果没有查找到6666端口则说明没有被占用（额，有点废话了~~）</p> 
<h4><a id="_6"></a>环境说明</h4> 
<ul><li>python2.7</li><li>ubuntu</li></ul> 
<h4><a id="_10"></a>客户端</h4> 
<ul><li>创建 socket</li><li>连接到远程服务器</li><li>发送数据</li><li>接收数据</li><li>关闭 socket</li></ul> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding=utf-8 -*-</span>


<span class="token triple-quoted-string string">"""
file: client.py
socket client
"""</span>

<span class="token keyword">import</span> socket
<span class="token keyword">import</span> sys


<span class="token keyword">def</span> <span class="token function">socket_client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
        s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">6666</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> socket<span class="token punctuation">.</span>error <span class="token keyword">as</span> msg<span class="token punctuation">:</span>
        <span class="token keyword">print</span> msg
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> <span class="token builtin">raw_input</span><span class="token punctuation">(</span><span class="token string">'please input work: '</span><span class="token punctuation">)</span>
        s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        <span class="token keyword">print</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> data <span class="token operator">==</span> <span class="token string">'exit'</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>
    s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    socket_client<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<h4><a id="_53"></a>服务器端</h4> 
<ul><li>打开 socket</li><li>绑定到特定的地址以及端口上</li><li>监听连接</li><li>建立连接</li><li>接收/发送数据</li></ul> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding=utf-8 -*-</span>


<span class="token triple-quoted-string string">"""
file: service.py
socket service
"""</span>


<span class="token keyword">import</span> socket
<span class="token keyword">import</span> threading
<span class="token keyword">import</span> time
<span class="token keyword">import</span> sys


<span class="token keyword">def</span> <span class="token function">socket_service</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
        <span class="token comment"># 防止socket server重启后端口被占用（socket.error: [Errno 98] Address already in use）</span>
        s<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>SOL_SOCKET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SO_REUSEADDR<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        s<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">6666</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        s<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> socket<span class="token punctuation">.</span>error <span class="token keyword">as</span> msg<span class="token punctuation">:</span>
        <span class="token keyword">print</span> msg
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token string">'Waiting connection...'</span>

    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
        conn<span class="token punctuation">,</span> addr <span class="token operator">=</span> s<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
        t <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>deal_data<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
        t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">deal_data</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> <span class="token string">'Accept new connection from {0}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span>
    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'Hi, Welcome to the server!'</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span> <span class="token string">'{0} client send data is {1}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
        <span class="token comment">#time.sleep(1)</span>
        <span class="token keyword">if</span> data<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'exit'</span> <span class="token operator">or</span> <span class="token operator">not</span> data<span class="token punctuation">:</span>
            <span class="token keyword">print</span> <span class="token string">'{0} connection close'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span>
            conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'Connection closed!'</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'Hello, {0}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    socket_service<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>copy以上两个脚本代码后，如果你想在本地测试，直接运行这两个脚本便是（<strong>注：先运行服务端<code>service.py</code>脚本</strong>）,下图左边是运行服务端脚本，右边打开两个终端与服务端socket进行通信。</p> 
<p><img src="https://images2.imgbox.com/e5/ce/EkbYRh6t_o.png" alt="socket"></p> 
<p>一屏开多个终端是不是很屌（强烈建议安装此工具，非常方便好用）</p> 
<blockquote> 
 <p>终端增强工具Terminator<br> sudo apt-get install terminator # Ubuntu<br> yum -y install terminator # Centos</p> 
</blockquote> 
<p>如果你想在两台不同机器上测试，把<code>service.py</code>脚本上传到服务器(假设服务器ip是：192.168.1.2)，然后把<code>client.py</code>连接ip改为：192.168.1.2，<code>service.py</code>监听的ip改为：192.168.1.2，接着运行这两个脚本即可</p> 
<pre><code># client.py
s.connect(('192.168.1.2', 6666))

# service.py
s.bind(('192.168.1.2', 6666))
</code></pre> 
<h4><a id="socket_133"></a>利用socket进行文件、图片等传输</h4> 
<p>传输文件主要分以下两步：</p> 
<ul><li>将要传输的文件的基本信息发送到接收端（文件名、大小等其他信息）</li><li>发送端读取文件内容并发送过去,接受端将缓存里面的内容写入文件</li></ul> 
<blockquote> 
 <p>注：以下发送文件代码参考：http://www.mamicode.com/info-detail-1346172.html</p> 
</blockquote> 
<p>发送端代码</p> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding=utf-8 -*-</span>


<span class="token triple-quoted-string string">"""
file: send.py
socket client
"""</span>

<span class="token keyword">import</span> socket
<span class="token keyword">import</span> os
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> struct


<span class="token keyword">def</span> <span class="token function">socket_client</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
        s<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">6666</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> socket<span class="token punctuation">.</span>error <span class="token keyword">as</span> msg<span class="token punctuation">:</span>
        <span class="token keyword">print</span> msg
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span> s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>

    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
        filepath <span class="token operator">=</span> <span class="token builtin">raw_input</span><span class="token punctuation">(</span><span class="token string">'please input file path: '</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isfile<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># 定义定义文件信息。128s表示文件名为128bytes长，l表示一个int或log文件类型，在此为文件大小</span>
            fileinfo_size <span class="token operator">=</span> struct<span class="token punctuation">.</span>calcsize<span class="token punctuation">(</span><span class="token string">'128sl'</span><span class="token punctuation">)</span>
            <span class="token comment"># 定义文件头信息，包含文件名和文件大小</span>
            fhead <span class="token operator">=</span> struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">'128sl'</span><span class="token punctuation">,</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                os<span class="token punctuation">.</span>stat<span class="token punctuation">(</span>filepath<span class="token punctuation">)</span><span class="token punctuation">.</span>st_size<span class="token punctuation">)</span>
            s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>fhead<span class="token punctuation">)</span>
            <span class="token keyword">print</span> <span class="token string">'client filepath: {0}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>

            fp <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filepath<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span>
            <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
                data <span class="token operator">=</span> fp<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token operator">not</span> data<span class="token punctuation">:</span>
                    <span class="token keyword">print</span> <span class="token string">'{0} file send over...'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>filepath<span class="token punctuation">)</span>
                    <span class="token keyword">break</span>
                s<span class="token punctuation">.</span>send<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
        s<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    socket_client<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>接收端代码</p> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding=utf-8 -*-</span>


<span class="token triple-quoted-string string">"""
file: recv.py
socket service
"""</span>


<span class="token keyword">import</span> socket
<span class="token keyword">import</span> threading
<span class="token keyword">import</span> time
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> os
<span class="token keyword">import</span> struct


<span class="token keyword">def</span> <span class="token function">socket_service</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        s <span class="token operator">=</span> socket<span class="token punctuation">.</span>socket<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>AF_INET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SOCK_STREAM<span class="token punctuation">)</span>
        s<span class="token punctuation">.</span>setsockopt<span class="token punctuation">(</span>socket<span class="token punctuation">.</span>SOL_SOCKET<span class="token punctuation">,</span> socket<span class="token punctuation">.</span>SO_REUSEADDR<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
        s<span class="token punctuation">.</span>bind<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">6666</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        s<span class="token punctuation">.</span>listen<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> socket<span class="token punctuation">.</span>error <span class="token keyword">as</span> msg<span class="token punctuation">:</span>
        <span class="token keyword">print</span> msg
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token string">'Waiting connection...'</span>

    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
        conn<span class="token punctuation">,</span> addr <span class="token operator">=</span> s<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>
        t <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>deal_data<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">)</span>
        t<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">deal_data</span><span class="token punctuation">(</span>conn<span class="token punctuation">,</span> addr<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> <span class="token string">'Accept new connection from {0}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span>
    <span class="token comment">#conn.settimeout(500)</span>
    conn<span class="token punctuation">.</span>send<span class="token punctuation">(</span><span class="token string">'Hi, Welcome to the server!'</span><span class="token punctuation">)</span>

    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
        fileinfo_size <span class="token operator">=</span> struct<span class="token punctuation">.</span>calcsize<span class="token punctuation">(</span><span class="token string">'128sl'</span><span class="token punctuation">)</span>
        buf <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>fileinfo_size<span class="token punctuation">)</span>
        <span class="token keyword">if</span> buf<span class="token punctuation">:</span>
            filename<span class="token punctuation">,</span> filesize <span class="token operator">=</span> struct<span class="token punctuation">.</span>unpack<span class="token punctuation">(</span><span class="token string">'128sl'</span><span class="token punctuation">,</span> buf<span class="token punctuation">)</span>
            fn <span class="token operator">=</span> filename<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token string">'\00'</span><span class="token punctuation">)</span>
            new_filename <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">,</span> <span class="token string">'new_'</span> <span class="token operator">+</span> fn<span class="token punctuation">)</span>
            <span class="token keyword">print</span> <span class="token string">'file new name is {0}, filesize if {1}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>new_filename<span class="token punctuation">,</span>
                                                                 filesize<span class="token punctuation">)</span>

            recvd_size <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># 定义已接收文件的大小</span>
            fp <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>new_filename<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span> <span class="token string">'start receiving...'</span>

            <span class="token keyword">while</span> <span class="token operator">not</span> recvd_size <span class="token operator">==</span> filesize<span class="token punctuation">:</span>
                <span class="token keyword">if</span> filesize <span class="token operator">-</span> recvd_size <span class="token operator">&gt;</span> <span class="token number">1024</span><span class="token punctuation">:</span>
                    data <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">)</span>
                    recvd_size <span class="token operator">+=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    data <span class="token operator">=</span> conn<span class="token punctuation">.</span>recv<span class="token punctuation">(</span>filesize <span class="token operator">-</span> recvd_size<span class="token punctuation">)</span>
                    recvd_size <span class="token operator">=</span> filesize
                fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
            fp<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span> <span class="token string">'end receive...'</span>
        conn<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    socket_service<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>打开两个终端，分别运行<code>recv.py</code>和<code>send.py</code>脚本，输入待传输文件的全路径和文件名（如：/home/test.txt），你就会在<code>recv.py</code>脚本路径下看到刚输入的传输文件，且文件名为<code>new_****</code>。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ff44e57ec82d6095c524b3bf3954e4fe/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">关于 eclipse 中R类文件报错</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4e1e759fbaf482632592a6346f1a9b07/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">springMVC项目访问静态资源时遇到的两个坑</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>