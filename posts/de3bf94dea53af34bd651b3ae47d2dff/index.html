<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>sql注入及mybatis防止sql注入 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="sql注入及mybatis防止sql注入" />
<meta property="og:description" content="一、Sql 注入漏洞详解 Sql 注入产生原因及威胁： 当我们访问动态网页时, Web 服务器会向数据访问层发起 Sql 查询请求，如果权限验证通过就会执行 Sql 语句。这种网站内部直接发送的Sql请求一般不会有危险，但实际情况是很多时候需要结合用户的输入数据动态构造 Sql 语句，如果用户输入的数据被构造成恶意 Sql 代码，Web 应用又未对动态构造的 Sql 语句使用的参数进行审查，则会带来意想不到的危险。
Sql 注入带来的威胁主要有如下几点
猜解后台数据库，这是利用最多的方式，盗取网站的敏感信息。绕过认证，列如绕过验证登录网站后台。注入可以借助数据库的存储过程进行提权等操作 Sql 注入示例一.猜解数据库 接下来我们通过一个实例，让你更加清楚的理解 Sql 注入猜解数据库是如何发生的。使用DVWA渗透测试平台，作为攻击测试的目标：
先输入 1 ，查看回显 (URL中ID=1，说明php页面通过get方法传递参数)：
那实际上后台执行了什么样的Sql语句呢？ ，其中的SQL查询代码为：
可以看到，实际执行的Sql语句是：
SELECT first_name, last_name FROM users WHERE user_id = &#39;1&#39;; 我们是通过控制参数Id的值来返回我们需要的信息。
如果我们不按常理出牌，比如在输入框中输入 1&#39; order by 1#
实际执行的Sql语句就会变成:
SELECT first_name, last_name FROM users WHERE user_id = &#39;1&#39; order by 1#`;(按照Mysql语法，#后面会被注释掉，使用这种方法屏蔽掉后面的单引号，避免语法错误) 这条语句的意思是查询users表中user_id为1的数据并按第一字段排行。
输入 1’ order by 1#和 1’ order by 2#时都返回正常：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/de3bf94dea53af34bd651b3ae47d2dff/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-25T03:53:44+08:00" />
<meta property="article:modified_time" content="2022-03-25T03:53:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">sql注入及mybatis防止sql注入</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="Sql__0"></a>一、Sql 注入漏洞详解</h3> 
<ol><li>Sql 注入产生原因及威胁：</li></ol> 
<p>当我们访问动态网页时, Web 服务器会向数据访问层发起 Sql 查询请求，如果权限验证通过就会执行 Sql 语句。这<code>种网站内部直接发送的Sql请求一般不会有危险，但实际情况是很多时候需要结合用户的输入数据动态构造 Sql 语句，</code>如果用户输入的数据被构造成恶意 Sql 代码，Web 应用又未对动态构造的 Sql 语句使用的参数进行审查，则会带来意想不到的危险。</p> 
<p>Sql 注入带来的威胁主要有如下几点</p> 
<blockquote> 
 <ol><li>猜解后台数据库，这是利用最多的方式，盗取网站的敏感信息。</li><li>绕过认证，列如绕过验证登录网站后台。</li><li>注入可以借助数据库的存储过程进行提权等操作</li></ol> 
</blockquote> 
<ol start="2"><li>Sql 注入示例一.猜解数据库</li></ol> 
<p>接下来我们通过一个实例，让你更加清楚的理解 Sql 注入猜解数据库是如何发生的。使用DVWA渗透测试平台，作为攻击测试的目标：<br> <img src="https://images2.imgbox.com/89/7d/mcIhyFHM_o.png" alt="在这里插入图片描述"></p> 
<p>先输入 1 ，查看回显 (URL中ID=1，说明php页面通过get方法传递参数)：<br> <img src="https://images2.imgbox.com/5c/1c/tnvzhZE4_o.png" alt="在这里插入图片描述"></p> 
<p>那实际上后台执行了什么样的Sql语句呢？ ，其中的SQL查询代码为：</p> 
<p><img src="https://images2.imgbox.com/c7/f4/FXsuZtIQ_o.png" alt="在这里插入图片描述"></p> 
<p>可以看到，实际执行的Sql语句是：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> first_name<span class="token punctuation">,</span> last_name <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> user_id <span class="token operator">=</span> <span class="token string">'1'</span><span class="token punctuation">;</span>
</code></pre> 
<p>我们是通过控制参数Id的值来返回我们需要的信息。<br> 如果我们不按常理出牌，比如在输入框中输入 <code>1' order by 1#</code><br> 实际执行的Sql语句就会变成:</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> first_name<span class="token punctuation">,</span> last_name <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> user_id <span class="token operator">=</span> <span class="token string">'1'</span> <span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token number">1</span><span class="token comment">#`;(按照Mysql语法，#后面会被注释掉，使用这种方法屏蔽掉后面的单引号，避免语法错误)</span>
</code></pre> 
<p>这条语句的意思是<code>查询users表中user_id为1的数据并按第一字段排行</code>。</p> 
<p>输入 1’ order by 1#和 1’ order by 2#时都返回正常：<br> <img src="https://images2.imgbox.com/6e/f8/IPM76TYq_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a4/71/P0yQg4FI_o.png" alt="在这里插入图片描述"><br> 当输入 1’ order by 3#时，返回错误：<br> <img src="https://images2.imgbox.com/ed/60/RdpSBYb4_o.png" alt="在这里插入图片描述"><br> 由此可知，<code>users表中只有两个字段，数据为两列</code>。</p> 
<p>接下来我们使用 <code>union select</code>联合查询继续获取信息。<br> union 运算符可以将两个或两个以上 select 语句的查询结果集合合并成一个结果集合显示，即执行联合查询。需要注意在使用 union 查询的时候需要和主查询的列数相同，而我们之前已经知道了主查询列数为 2，接下来就好办了。<br> 输入1’ union select database(),user()#进行查询 ：</p> 
<blockquote> 
 <ul><li>database()将会返回当前网站所使用的数据库名字.</li><li>user()将会返回执行当前查询的用户名.</li></ul> 
</blockquote> 
<p>实际执行的Sql语句是 :</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> first_name<span class="token punctuation">,</span> last_name <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> user_id <span class="token operator">=</span> <span class="token string">'1'</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token keyword">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#`;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c2/10/oZt0eqCs_o.png" alt="在这里插入图片描述"></p> 
<p>通过上图返回信息，我们成功获取到：</p> 
<blockquote> 
 <ul><li>当前网站使用数据库为 dvwa .</li><li>当前执行查询用户名为 root@localhost .</li></ul> 
</blockquote> 
<p>同理我们再输入 <code>1' union select version(),@@version_compile_os#</code>进行查询：</p> 
<blockquote> 
 <ul><li>version() 获取当前数据库版本.</li><li>@@version_compile_os 获取当前操作系统。</li></ul> 
</blockquote> 
<p>实际执行的Sql语句是:</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> first_name<span class="token punctuation">,</span> last_name <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> user_id <span class="token operator">=</span> <span class="token string">'1'</span> <span class="token keyword">union</span> <span class="token keyword">select</span> version<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>@<span class="token variable">@version_compile_os</span><span class="token comment">#`;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f9/58/iUXWlEKY_o.png" alt="在这里插入图片描述"></p> 
<p>通过上图返回信息，我们又成功获取到：</p> 
<blockquote> 
 <ul><li>当前数据库版本为 : 5.6.31-0ubuntu0.15.10.1.</li><li>当前操作系统为 : debian-linux-gnu</li></ul> 
</blockquote> 
<p>接下来我们尝试获取 dvwa 数据库中的表名。<br> <code>information_schema 是 mysql 自带的一张表，这张数据表保存了 Mysql 服务器所有数据库的信息,如数据库名，数据库的表，表栏的数据类型与访问权限等。</code>该数据库拥有一个名为 tables 的数据表，该表包含两个字段 table_name 和 table_schema，分别记录 DBMS 中的存储的表名和表名所在的数据库。</p> 
<p>我们输入1’ union select table_name,table_schema from information_schema.tables where table_schema= ‘dvwa’#进行查询：<br> 实际执行的Sql语句是：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> first_name<span class="token punctuation">,</span> last_name <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> user_id <span class="token operator">=</span> <span class="token string">'1'</span> <span class="token keyword">union</span> <span class="token keyword">select</span> table_name<span class="token punctuation">,</span>table_schema <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span> <span class="token keyword">where</span> table_schema<span class="token operator">=</span> <span class="token string">'dvwa'</span><span class="token comment">#`;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d3/8d/2xiuGeS0_o.png" alt="在这里插入图片描述"></p> 
<p>通过上图返回信息，我们再获取到：</p> 
<blockquote> 
 <ul><li>dvwa 数据库有两个数据表，分别是 guestbook 和 users .</li></ul> 
</blockquote> 
<p>有些同学肯定还不满足目前获取到的信息，那么我们接下来尝试获取重量级的用户名、密码。由经验我们可以大胆猜测users表的字段为 user 和 password ，所以输入：<code>1' union select user,password from users#</code>进行查询：<br> 实际执行的 Sql 语句是：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> first_name<span class="token punctuation">,</span> last_name <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> user_id <span class="token operator">=</span> <span class="token string">'1'</span> <span class="token keyword">union</span> <span class="token keyword">select</span> <span class="token keyword">user</span><span class="token punctuation">,</span>password <span class="token keyword">from</span> users<span class="token comment">#`;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/3e/d2/rXERHo57_o.png" alt="在这里插入图片描述"></p> 
<p>可以看到成功爆出用户名、密码，密码采用 md5 进行加密，可以到www.cmd5.com进行解密。直此，同学们应该已经对 Sql 注入有了一个大概得了解，也清楚了 Sql 注入的强大。</p> 
<ol start="3"><li>Sql 注入实例二.验证绕过</li></ol> 
<p>接下来我们再试试另一个利用 Sql 漏洞绕过登录验证的实例。<br> 使用事先编写好的页面，这是一个普通的登录页面，只要输入正确的用户名和密码就能登录成功。<br> <img src="https://images2.imgbox.com/d6/38/U9IjGoJs_o.png" alt="在这里插入图片描述"><br> 我们先尝试随意输入用户名 123 和密码 123 登录：<br> <img src="https://images2.imgbox.com/b1/08/pTtuPlFr_o.png" alt="在这里插入图片描述"><br> 从错误页面中我们无法获取到任何信息。<br> 看看后台代码如何做验证的：</p> 
<p><img src="https://images2.imgbox.com/4f/1c/BFDXT7c3_o.png" alt="s"></p> 
<p>实际执行的操作时：</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">'123'</span> <span class="token operator">and</span> password<span class="token operator">=</span><span class="token string">'123'</span>
</code></pre> 
<p>当查询到数据表中存在同时满足 username 和 password 字段时，会返回登录成功。按照第一个实例的思路，我们尝试在用户名中输入 <code>123' or 1=1 #</code>, 密码同样输入 <code>123' or 1=1 #</code> ：<br> <img src="https://images2.imgbox.com/32/b0/xCgcS54a_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/93/67/4KjTzOFP_o.png" alt="在这里插入图片描述"><br> 为什么能够成功登陆呢？因为实际执行的语句是：</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">'123'</span> <span class="token operator">or</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span> <span class="token comment">#' and password='123' or 1=1 #'</span>
</code></pre> 
<p>按照 Mysql 语法，# 后面的内容会被忽略，所以以上语句等同于（实际上密码框里不输入任何东西也一样）：</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">'123'</span> <span class="token operator">or</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span> 
</code></pre> 
<p>由于判断语句 or 1=1 恒成立，所以结果当然返回真，成功登录。<br> 我们再尝试不使用 # 屏蔽单引号，采用手动闭合的方式：<br> 我们尝试在用户名中输入 123’ or ‘1’=‘1, 密码同样输入 123’ or ‘1’='1 （不能少了单引号，否则会有语法错误）：</p> 
<p><img src="https://images2.imgbox.com/dc/91/jw5jZIFr_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/aa/7b/fZgG43eN_o.png" alt="在这里插入图片描述"></p> 
<p>实际执行的 Sql 语句是：</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users <span class="token keyword">where</span> username<span class="token operator">=</span><span class="token string">'123'</span> <span class="token operator">or</span> <span class="token string">'1'</span><span class="token operator">=</span><span class="token string">'1'</span> <span class="token operator">and</span> password<span class="token operator">=</span><span class="token string">'123'</span> <span class="token operator">or</span> <span class="token string">'1'</span><span class="token operator">=</span>'<span class="token number">1</span>
</code></pre> 
<p>看到了吗？两个 or 语句使 and 前后两个判断永远恒等于真，所以能够成功登录。还有很多其他 Mysql 语句可以巧妙的绕过验证，同学们可以发散自己的思维进行尝试。</p> 
<h3><a id="_Sql__161"></a>二、判断 Sql 注入点</h3> 
<p>通常情况下，<code>可能存在 Sql 注入漏洞的 Url 是类似这种形式 ：http://xxx.xxx.xxx/abcd.php?id=XX</code><br> 对 Sql 注入的判断，主要有两个方面：</p> 
<blockquote> 
 <ul><li>判断该带参数的 Url 是否存在 Sql 注入？</li><li>如果存在 Sql 注入，那么属于哪种 Sql 注入？</li></ul> 
</blockquote> 
<p>可能存在 Sql 注入攻击的 ASP/PHP/JSP 动态网页中，一个动态网页中可能只有一个参数，有时可能有多个参数。有时是整型参数，有时是字符串型参数，不能一概而论。<code>总之只要是带有参数的动态网页且此网页访问了数据库，那么就有可能存在 Sql 注入。</code>如果程序员没有足够的安全意识，没有进行必要的字符过滤，存在SQL注入的可能性就非常大。</p> 
<ol><li>判断是否存在 Sql 注入漏洞</li></ol> 
<p>最为经典的单引号判断法：<br> <code>在参数后面加上单引号</code>,比如:</p> 
<pre><code class="prism language-java">http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>xxx<span class="token operator">/</span>abc<span class="token punctuation">.</span>php<span class="token operator">?</span>id<span class="token operator">=</span><span class="token number">1</span>'
</code></pre> 
<p>如果页面返回错误，则存在 Sql 注入。<code>原因是无论字符型还是整型都会因为单引号个数不匹配而报错</code>。（如果未报错，不代表不存在 Sql 注入，因为有可能页面对单引号做了过滤，这时可以使用判断语句进行注入，因为此为入门基础课程，就不做深入讲解了）</p> 
<ol start="2"><li>判断 Sql 注入漏洞的类型</li></ol> 
<p>通常 Sql 注入漏洞分为 2 种类型：</p> 
<blockquote> 
 <ul><li>数字型</li><li>字符型</li></ul> 
</blockquote> 
<p>其实所有的类型都是根据数据库本身表的类型所产生的，在我们创建表的时候会发现其后总有个数据类型的限制，而不同的数据库又有不同的数据类型，但是无论怎么分<code>常用的查询数据类型总是以数字与字符来区分的</code>，所以就会产生注入点为何种类型。<br> <img src="https://images2.imgbox.com/5f/ee/tk7OOV7i_o.png" alt="在这里插入图片描述"></p> 
<ul><li>数字型判断：<br> 当输入的参 x 为整型时，通常 abc.php 中 Sql 语句类型大致如下：</li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token operator">&lt;</span>表名<span class="token operator">&gt;</span> <span class="token keyword">where</span> id <span class="token operator">=</span> x
</code></pre> 
<p>这种类型可以使用经典的 <code>and 1=1</code> 和 <code>and 1=2</code> 来判断：</p> 
<blockquote> 
 <ul><li>Url 地址中输入 <code>http://xxx/abc.php?id= x and 1=1</code> 页面依旧运行正常，继续进行下一步。</li><li>Url地址中继续输入 <code>http://xxx/abc.php?id= x and 1=2</code> 页面运行错误，<code>则说明此 Sql 注入为数字型注入。</code></li></ul> 
</blockquote> 
<p>原因如下：<br> 当输入 <code>and 1=1</code>时，后台执行 Sql 语句：</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token operator">&lt;</span>表名<span class="token operator">&gt;</span> <span class="token keyword">where</span> id <span class="token operator">=</span> x <span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span> 
</code></pre> 
<p>没有语法错误且逻辑判断为正确，所以返回正常。</p> 
<p>当输入 <code>and 1=2</code>时，后台执行 Sql 语句：</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token operator">&lt;</span>表名<span class="token operator">&gt;</span> <span class="token keyword">where</span> id <span class="token operator">=</span> x <span class="token operator">and</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">2</span>
</code></pre> 
<p>没有语法错误但是逻辑判断为假，所以返回错误。<br> 我们再使用假设法：<code>如果这是字符型注入的话，我们输入以上语句之后应该出现如下情况</code>：</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token operator">&lt;</span>表名<span class="token operator">&gt;</span> <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token string">'x and 1=1'</span> 
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token operator">&lt;</span>表名<span class="token operator">&gt;</span> <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token string">'x and 1=2'</span> 
</code></pre> 
<p>查询语句将 and 语句全部转换为了字符串，并没有进行 and 的逻辑判断，所以不会出现以上结果，故假设是不成立的。</p> 
<ul><li>字符型判断：<br> 当输入的参 x 为字符型时，通常 abc.php 中 SQL 语句类型大致如下：</li></ul> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token operator">&lt;</span>表名<span class="token operator">&gt;</span> <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token string">'x'</span>
</code></pre> 
<p>这种类型我们同样可以使用 <code>and '1'='1</code> 和 <code>and '1'='2</code>来判断：</p> 
<blockquote> 
 <ul><li>Url 地址中输入 <code>http://xxx/abc.php?id= x' and '1'='1</code> 页面运行正常，继续进行下一步。</li><li>Url地址中继续输入 <code>http://xxx/abc.php?id= x' and '1'='2</code> 页面运行错误，则说明<code>此 Sql 注入为字符型注入</code>。</li></ul> 
</blockquote> 
<p>原因如下：<br> 当输入 <code>and '1'='1</code>时，后台执行 Sql 语句：</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token operator">&lt;</span>表名<span class="token operator">&gt;</span> <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token string">'x'</span> <span class="token operator">and</span> <span class="token string">'1'</span><span class="token operator">=</span><span class="token string">'1'</span>
</code></pre> 
<p>语法正确，逻辑判断正确，所以返回正确。</p> 
<p>当输入 <code>and '1'='2</code>时，后台执行 Sql 语句：</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token operator">&lt;</span>表名<span class="token operator">&gt;</span> <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token string">'x'</span> <span class="token operator">and</span> <span class="token string">'1'</span><span class="token operator">=</span><span class="token string">'2'</span>
</code></pre> 
<p>语法正确，但逻辑判断错误，所以返回正确。同学们同样可以使用假设法来验证。</p> 
<p>三、Mybatis防止sql注入</p> 
<p>下面是MyBatis一个Dao配置</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findRank<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>String<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>String<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    SELECT u.name FROM UserInfo u
        where 1=1 and u.UserID=#{userID} ;    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>打印出执行的SQL语句</p> 
<pre><code class="prism language-sql"> <span class="token keyword">SELECT</span> u<span class="token punctuation">.</span>name <span class="token keyword">FROM</span> UserInfo u <span class="token keyword">where</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> u<span class="token punctuation">.</span>UserID<span class="token operator">=</span>?     
</code></pre> 
<p>这是因为<code>MyBatis启用了预编译功能，在SQL执行前，会先将上面的SQL发送给数据库进行编译</code>；执行时，<code>直接使用编译好的SQL，替换占位符“?”就可以了</code>。因为<code>SQL注入只能对编译过程起作用，所以这样的方式就很好地避免了SQL注入的问题。</code></p> 
<ul><li>底层实现原理</li></ul> 
<p>MyBatis是如何做到SQL预编译的呢？<code>其实在框架底层，是JDBC中的PreparedStatement类在起作用，PreparedStatement是我们很熟悉的Statement的子类，它的对象包含了编译好的SQL语句</code>。这种“准备好”的方式不仅能提高安全性，而且在多次执行同一个SQL时，能够提高效率。原因是SQL已编译好，再次执行时无需再编译。</p> 
<p>话说回来，是否我们使用MyBatis就一定可以防止SQL注入呢？当然不是，请看下面的代码：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>findRank<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span> <span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>String<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>String<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    SELECT u.name FROM UserInfo u
        where 1=1
        and u.UserID=${userID} ;   
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>假设userID=1,将SQL打印出来是这样的：</p> 
<pre><code class="prism language-sql"> <span class="token keyword">SELECT</span> u<span class="token punctuation">.</span>name <span class="token keyword">FROM</span> UserInfo u <span class="token keyword">where</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> u<span class="token punctuation">.</span>UserID<span class="token operator">=</span><span class="token number">1</span>
</code></pre> 
<p>假如：</p> 
<pre><code class="prism language-sql">userID<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">drop</span> <span class="token keyword">table</span> UserInfo <span class="token punctuation">;</span>
</code></pre> 
<p>那么sql是这样的</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> u<span class="token punctuation">.</span>name <span class="token keyword">FROM</span> UserInfo u <span class="token keyword">where</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span> <span class="token operator">and</span> u<span class="token punctuation">.</span>UserID<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">drop</span> <span class="token keyword">table</span> UserInfo <span class="token punctuation">;</span>
 测试结果
 
<span class="token keyword">SELECT</span> u<span class="token punctuation">.</span>name <span class="token keyword">FROM</span> UserInfo u  <span class="token keyword">where</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span>   <span class="token operator">and</span> u<span class="token punctuation">.</span>UserID<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token keyword">drop</span> <span class="token keyword">table</span> UserInfo<span class="token punctuation">;</span>
<span class="token comment">### Cause: com.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'drop table UserInfo' at line 3</span>
直接报异常，你应该庆幸mybaties做了处理，但是不管怎么说${xxx}是无法阻止<span class="token keyword">SQL</span>注入的。
</code></pre> 
<ul><li>“${xxx}”</li></ul> 
<blockquote> 
 <ol><li>缺点： 直接参与SQL编译，不能避免注入攻击。</li><li>优点：及到动态表名和列名时，只能使用“${xxx}”这样的参数格式</li><li>注意：这样的参数需要我们在代码中手工进行处理来防止注入。</li><li><code>${}将传入的参数直接显示生成在sql中，不会添加引号</code></li></ol> 
</blockquote> 
<ul><li>“#{xxx}“</li></ul> 
<blockquote> 
 <ol><li>相当于JDBC中的PreparedStatement</li><li>#{}将传入的参数当成一个字符串，会给传入的参数加一个双引号</li><li><code>优点：#{}是经过预编译的，是安全的；</code></li></ol> 
</blockquote> 
<p><a href="https://shentuzhigang.blog.csdn.net/article/details/103933987?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-1.pc_relevant_paycolumn_v3&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~CTRLIST~Rate-1.pc_relevant_paycolumn_v3&amp;utm_relevant_index=1" rel="nofollow">PreparedStatement只能用来为参数（如参数值）设置动态参数，即用?占位，不可用于表名、字段名等</a></p> 
<p><a href="https://blog.csdn.net/weixin_34175509/article/details/86353263?spm=1001.2101.3001.6661.1&amp;utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1.pc_relevant_antiscanv2&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1.pc_relevant_antiscanv2&amp;utm_relevant_index=1">参考文章</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/05423c12dadea0bbb08187da85903bba/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python零基础入门之第二章 Python数据结构（一.列表 ）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/62ffb18bf7c411e21b78be4fc25c2806/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Spring Boot 3的新特性 - jrebel</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>