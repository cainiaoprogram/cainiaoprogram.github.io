<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>批处理脚本 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="批处理脚本" />
<meta property="og:description" content="批处理 1. 常用变量 # 当前工作目录 %cd% # bat文件所在目录 %~dp0 # 传入bat的第一个参数 %~1 %1 # C:\Users\tudou\AppData\Roaming %appdata% # C:\Users\tudou\AppData\Local %localappdata% # C:\Users\tudou\Documents %userprofile%\Documents # C:\Users\Public\Documents %PUBLIC%\Documents # C:\Users\tudou %userprofile% # C:\Program Files (x86) %ProgramFiles(x86)% # C:\Program Files (x86)\Common Files %ProgramFiles(x86)%\Common Files # C:\Program Files %ProgramW6432% # C:\Program Files\Common Files %ProgramW6432%\Common Files # C:\ProgramData %ProgramData% # C:\Users\tudou\AppData\Local\Temp %temp% 2. code 2.1 if…else 等于 ==、equ不等于 neq大于 gtr小于 lss大于等于 geq小于等于 leq if ERRORLEVEL 1 (echo [ERROR] 请用管理员权限运行!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ee129e26da7b54f3256b430969e04aad/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-15T21:26:13+08:00" />
<meta property="article:modified_time" content="2022-04-15T21:26:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">批处理脚本</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_2"></a>批处理</h3> 
<h4><a id="1__5"></a>1. 常用变量</h4> 
<pre><code class="prism language-bash"><span class="token comment"># 当前工作目录</span>
%cd%
<span class="token comment"># bat文件所在目录</span>
%~dp0
<span class="token comment"># 传入bat的第一个参数</span>
%~1
%1
<span class="token comment"># C:\Users\tudou\AppData\Roaming</span>
%appdata%
<span class="token comment"># C:\Users\tudou\AppData\Local</span>
%localappdata%
<span class="token comment"># C:\Users\tudou\Documents</span>
%userprofile%<span class="token punctuation">\</span>Documents
<span class="token comment"># C:\Users\Public\Documents</span>
%PUBLIC%<span class="token punctuation">\</span>Documents
<span class="token comment"># C:\Users\tudou</span>
%userprofile%
<span class="token comment"># C:\Program Files (x86)</span>
%ProgramFiles<span class="token punctuation">(</span>x86<span class="token punctuation">)</span>%
<span class="token comment"># C:\Program Files (x86)\Common Files</span>
%ProgramFiles<span class="token punctuation">(</span>x86<span class="token punctuation">)</span>%<span class="token punctuation">\</span>Common Files
<span class="token comment"># C:\Program Files</span>
%ProgramW6432%
<span class="token comment"># C:\Program Files\Common Files</span>
%ProgramW6432%<span class="token punctuation">\</span>Common Files
<span class="token comment"># C:\ProgramData</span>
%ProgramData%
<span class="token comment"># C:\Users\tudou\AppData\Local\Temp</span>
%temp%
</code></pre> 
<h4><a id="2__code_41"></a>2. code</h4> 
<h5><a id="21_ifelse_43"></a>2.1 if…else</h5> 
<ul><li>等于 ==、equ</li><li>不等于 neq</li><li>大于 gtr</li><li>小于 lss</li><li>大于等于 geq</li><li>小于等于 leq</li></ul> 
<pre><code class="prism language-bash"><span class="token keyword">if</span> ERRORLEVEL <span class="token number">1</span> <span class="token punctuation">(</span>echo <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> 请用管理员权限运行<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token keyword">else</span> goto <span class="token function">install</span>
</code></pre> 
<blockquote> 
 <p>) else (</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token keyword">if</span> ERRORLEVEL <span class="token number">1</span> <span class="token punctuation">(</span>
	<span class="token builtin class-name">echo</span> <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> 请用管理员权限运行<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span>
<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">(</span>
	goto <span class="token function">install</span>
<span class="token punctuation">)</span>
</code></pre> 
<h5><a id="22_for_64"></a>2.2 for</h5> 
<pre><code class="prism language-bash"><span class="token keyword">for</span> /d %%x <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">"pip-*dist-info"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token function">rmdir</span> /s /q <span class="token string">"%%x"</span>
</code></pre> 
<pre><code class="prism language-bash">rem 创建c1到c10文件夹
<span class="token keyword">for</span> /l %%a <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">1,1</span>,10<span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token punctuation">(</span>mkdir c%%a<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-bash">rem for循环中使用外部变量
setlocal enabledelayedexpansion
<span class="token builtin class-name">set</span> <span class="token assign-left variable">v2</span><span class="token operator">=</span><span class="token number">0</span>
:: 正确
FOR /l %%G <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">1,1</span>,5<span class="token punctuation">)</span> Do <span class="token punctuation">(</span>echo <span class="token punctuation">[</span><span class="token operator">!</span>v2<span class="token operator">!</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token builtin class-name">set</span> /a <span class="token assign-left variable">v2</span><span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">)</span>
:: 错误
FOR /l %%G <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">1,1</span>,5<span class="token punctuation">)</span> Do <span class="token punctuation">(</span>echo <span class="token punctuation">[</span>%v2%<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token builtin class-name">set</span> /a <span class="token assign-left variable">v2</span><span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="23_echo_85"></a>2.3 echo</h5> 
<pre><code class="prism language-bash"><span class="token comment"># 输出内容</span>
<span class="token builtin class-name">echo</span> <span class="token number">123</span>
<span class="token comment"># 输出空白行</span>
echo.
<span class="token comment"># 命令执行成功或失败都不显示</span>
task /f /im notepad* <span class="token operator">&gt;</span>NUL <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>NUL
<span class="token comment"># ^脱字符，用于输出&amp;|等特殊符号</span>
<span class="token function">netstat</span> -aon^<span class="token operator">|</span>findstr <span class="token number">80</span> 
</code></pre> 
<h5><a id="24_exist_98"></a>2.4 exist</h5> 
<blockquote> 
 <p>支持文件或文件夹</p> 
</blockquote> 
<pre><code class="prism language-bash"><span class="token comment"># if exist</span>
<span class="token keyword">if</span> exist c:<span class="token punctuation">\</span> <span class="token punctuation">(</span>echo y<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">(</span>echo n<span class="token punctuation">)</span>
<span class="token comment"># if not exist</span>
<span class="token keyword">if</span> not exist c:<span class="token punctuation">\</span> <span class="token punctuation">(</span>echo n<span class="token punctuation">)</span> <span class="token keyword">else</span> <span class="token punctuation">(</span>echo y<span class="token punctuation">)</span>
</code></pre> 
<h5><a id="25_set_109"></a>2.5 set</h5> 
<h6><a id="251_set_111"></a>2.5.1 set</h6> 
<pre><code class="prism language-bash">:: 设置或修改变量
<span class="token builtin class-name">set</span> <span class="token assign-left variable">v1</span><span class="token operator">=</span><span class="token number">1</span>
</code></pre> 
<h6><a id="252_set_a_118"></a>2.5.2 set /a</h6> 
<pre><code class="prism language-bash">:: 设置或修改变量，右侧为表达式
<span class="token builtin class-name">set</span> /a <span class="token assign-left variable">v1</span><span class="token operator">=</span><span class="token number">1</span>*2*3
</code></pre> 
<h6><a id="253_set_p_125"></a>2.5.3 set /p</h6> 
<pre><code class="prism language-bash">:: 输入
<span class="token builtin class-name">set</span> /p <span class="token assign-left variable">sel</span><span class="token operator">=</span><span class="token string">"select:"</span>
</code></pre> 
<h6><a id="254__131"></a>2.5.4 去除路径结尾斜杠</h6> 
<pre><code class="prism language-bash">@echo off
<span class="token builtin class-name">set</span> <span class="token assign-left variable">a1</span><span class="token operator">=</span>c:<span class="token punctuation">\</span>windows<span class="token punctuation">\</span>system32<span class="token punctuation">\</span>
::set <span class="token assign-left variable">a1</span><span class="token operator">=</span>c:<span class="token punctuation">\</span>windows<span class="token punctuation">\</span>system32<span class="token punctuation">\</span>test
<span class="token builtin class-name">set</span> <span class="token assign-left variable">b1</span><span class="token operator">=</span>%a1%
<span class="token keyword">if</span> <span class="token string">"%a1:~-1%"</span> equ "<span class="token punctuation">\</span>" <span class="token punctuation">(</span>set <span class="token assign-left variable">b1</span><span class="token operator">=</span>%a1:~,-1%<span class="token punctuation">)</span>
<span class="token builtin class-name">echo</span> %a1%
<span class="token builtin class-name">echo</span> %b1%
pause
</code></pre> 
<h5><a id="26_errorlevel_145"></a>2.6 errorlevel</h5> 
<ul><li>不区分大小写 errorlevel ERRORLEVEL</li><li>表示上一条命令的返回值</li></ul> 
<h6><a id="261__errorlevel_150"></a>2.6.1 单条语句 %errorlevel%</h6> 
<pre><code class="prism language-bash">cmd1
<span class="token builtin class-name">echo</span> %errorlevel%
</code></pre> 
<h6><a id="262__errorlevel_157"></a>2.6.2 复合语句 !errorlevel!</h6> 
<ul><li>复合语句时要开启变量延迟，否则errorlevel返回的值跟实际不一致(比如命令返回0,errorlevel值为2)</li></ul> 
<pre><code class="prism language-bash">setlocal enabledelayedexpansion
<span class="token keyword">for</span> /f %%i <span class="token keyword">in</span> <span class="token punctuation">(</span>文件列表.txt<span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token punctuation">(</span>
	%smart_ass% <span class="token string">"%%i"</span>
	<span class="token builtin class-name">echo</span> <span class="token operator">!</span>errorlevel<span class="token operator">!</span>
<span class="token punctuation">)</span>
setlocal disabledelayedexpansion
</code></pre> 
<h6><a id="263__170"></a>2.6.3 比较</h6> 
<pre><code class="prism language-bash">:: errorlevel 大于等于0 跳转sub1
<span class="token keyword">if</span> errorlevel <span class="token number">0</span> goto :sub1

:: errorlevel 小于0 跳转sub1
<span class="token keyword">if</span> not errorlevel <span class="token number">0</span> goto :sub1

:: errorlevel 不等于0 跳转sub1
:: EQU - 等于
:: NEQ - 不等于
:: LSS - 小于
:: LEQ - 小于或等于
:: GTR - 大于
:: GEQ - 大于或等于
<span class="token keyword">if</span> %errorlevel% neq <span class="token number">9</span> goto :sub1
</code></pre> 
<h5><a id="27__189"></a>2.7 变量延迟</h5> 
<table><thead><tr><th>操作</th><th>说明</th></tr></thead><tbody><tr><td>setlocal enabledelayedexpansion</td><td>开启变量延迟，复合语句一条一条的执行，!变量名!、%变量名%都可以，复合语句中必须使用!变量名!，使用%变量名%值会不变</td></tr><tr><td>setlocal disabledelayedexpansion</td><td>禁用变量延迟，复合语句按一条语句执行，只能%变量名%</td></tr></tbody></table> 
<pre><code class="prism language-bash">@echo off
setlocal enabledelayedexpansion
<span class="token builtin class-name">set</span> <span class="token assign-left variable">v1</span><span class="token operator">=</span><span class="token number">6</span>
<span class="token builtin class-name">set</span> <span class="token assign-left variable">v2</span><span class="token operator">=</span><span class="token number">0</span>
<span class="token builtin class-name">echo</span> %v1%
<span class="token builtin class-name">echo</span> <span class="token operator">!</span>v1<span class="token operator">!</span>
<span class="token builtin class-name">echo</span> 第一次for循环
FOR /l %%G <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">1,1</span>,5<span class="token punctuation">)</span> Do <span class="token punctuation">(</span>echo <span class="token punctuation">[</span><span class="token operator">!</span>v2<span class="token operator">!</span><span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token builtin class-name">set</span> /a <span class="token assign-left variable">v2</span><span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token builtin class-name">echo</span> 第二次for循环
FOR /l %%G <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">1,1</span>,5<span class="token punctuation">)</span> Do <span class="token punctuation">(</span>echo <span class="token punctuation">[</span>%v2%<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token builtin class-name">set</span> /a <span class="token assign-left variable">v2</span><span class="token operator">+=</span><span class="token number">1</span><span class="token punctuation">)</span>
pause
</code></pre> 
<h5><a id="28__210"></a>2.8 注释</h5> 
<pre><code class="prism language-bash">:: 注释1
rem 注释2
</code></pre> 
<h5><a id="29__217"></a>2.9 退出</h5> 
<h6><a id="291_exit_219"></a>2.9.1 exit</h6> 
<pre><code class="prism language-bash">:: 退出cmd
<span class="token builtin class-name">exit</span>
:: 退出当前脚本<span class="token punctuation">(</span>比如1.bat调用2.bat，2.bat中执行exit /b<span class="token punctuation">)</span>
<span class="token builtin class-name">exit</span> /b
:: 退出当前脚本，并设置返回值为2
<span class="token builtin class-name">exit</span> /b <span class="token number">2</span>
</code></pre> 
<h6><a id="292_eof_230"></a>2.9.2 eof</h6> 
<blockquote> 
 <p>退出当前脚本</p> 
</blockquote> 
<pre><code class="prism language-bash">:: 退出当前脚本
goto :eof
</code></pre> 
<blockquote> 
 <p>退出当前标，注意goto调用标签时，goto :eof会直接退出当前脚本</p> 
</blockquote> 
<pre><code class="prism language-bash">call :sub

:sub
<span class="token builtin class-name">echo</span> aa
goto :eof
</code></pre> 
<h5><a id="210_call_249"></a>2.10 call</h5> 
<h6><a id="2101_call_1bat_251"></a>2.10.1 call 1.bat</h6> 
<pre><code class="prism language-bash">:: 调用1.bat并等待1.bat执行完成
call <span class="token number">1</span>.bat
</code></pre> 
<h6><a id="2102_call__258"></a>2.10.2 call 标签</h6> 
<pre><code class="prism language-bash">@echo off
<span class="token builtin class-name">set</span> <span class="token assign-left variable">_tst</span><span class="token operator">=</span><span class="token number">0</span>
rem 调用标签并传参
FOR /l %%G <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token number">1,1</span>,5<span class="token punctuation">)</span> Do <span class="token punctuation">(</span>call :sub %%G<span class="token punctuation">)</span>
goto :eof

:sub
<span class="token builtin class-name">echo</span> <span class="token punctuation">[</span>%1<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token builtin class-name">set</span> /a <span class="token assign-left variable">_tst</span><span class="token operator">+=</span><span class="token number">1</span>
goto :eof
</code></pre> 
<h5><a id="211__272"></a>2.11 标签</h5> 
<ul><li>call支持执行完返回</li><li>goto不支持执行完返回</li></ul> 
<pre><code class="prism language-bash">@echo off
rem 带参数调用sub2，执行完返回
call :sub2 <span class="token number">666</span>
rem 调用sub1，执行完返回
call :sub1
rem 调用sub1，执行完不返回
goto :sub1
rem 该语句不会执行
goto :sub3

:sub1
<span class="token builtin class-name">echo</span> 标签1
goto :eof

:sub2
<span class="token builtin class-name">echo</span> 标签2，参数：%1
goto :eof

:sub3
<span class="token builtin class-name">echo</span> 标签3
goto :eof
</code></pre> 
<h4><a id="3_bat_301"></a>3. 以管理员方式运行bat</h4> 
<h5><a id="31__303"></a>3.1 自动切换为管理员</h5> 
<p>方式一</p> 
<pre><code class="prism language-bash">@ECHO OFF <span class="token operator">&amp;</span> CD /D %~DP0 <span class="token operator">&amp;</span> TITLE 安装
<span class="token operator">&gt;</span>NUL <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span> REG.exe query <span class="token string">"HKU\S-1-5-19"</span> <span class="token operator">||</span> <span class="token punctuation">(</span>
    ECHO SET UAC <span class="token operator">=</span> CreateObject^<span class="token punctuation">(</span><span class="token string">"Shell.Application"</span>^<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token string">"%TEMP%\Getadmin.vbs"</span>
    ECHO UAC.ShellExecute <span class="token string">"%~f0"</span>, <span class="token string">"%1"</span>, <span class="token string">""</span>, <span class="token string">"runas"</span>, <span class="token number">1</span> <span class="token operator">&gt;&gt;</span> <span class="token string">"%TEMP%\Getadmin.vbs"</span>
    <span class="token string">"%TEMP%\Getadmin.vbs"</span>
    DEL /f /q <span class="token string">"%TEMP%\Getadmin.vbs"</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>NUL
    Exit /b
<span class="token punctuation">)</span>
</code></pre> 
<p>方式二</p> 
<pre><code class="prism language-bash">@ECHO OFF<span class="token operator">&amp;</span><span class="token punctuation">(</span>PUSHD <span class="token string">"%~DP0"</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>REG QUERY <span class="token string">"HKU\S-1-5-19"</span><span class="token operator">&gt;</span>NUL <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token punctuation">(</span>
powershell -Command <span class="token string">"Start-Process '%~sdpnx0' -Verb RunAs"</span><span class="token operator">&amp;&amp;</span>EXIT<span class="token punctuation">)</span>
</code></pre> 
<h5><a id="32__320"></a>3.2 仅判断需要手动切换管理员</h5> 
<pre><code class="prism language-bash">@echo off
<span class="token function">whoami</span> /groups <span class="token operator">|</span> <span class="token function">find</span> <span class="token string">"S-1-16-12288"</span> <span class="token operator">&gt;</span>nul
<span class="token keyword">if</span> ERRORLEVEL <span class="token number">1</span> <span class="token punctuation">(</span>echo <span class="token punctuation">[</span>ERROR<span class="token punctuation">]</span> 请用管理员权限运行<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token keyword">else</span> goto <span class="token function">install</span>
pause
<span class="token builtin class-name">exit</span>

:install
pause
</code></pre> 
<h4><a id="4__334"></a>4. 启动进程</h4> 
<h5><a id="41__336"></a>4.1 带参数</h5> 
<pre><code class="prism language-bash"><span class="token comment"># 启动notepad，批处理退出</span>
start <span class="token string">""</span> <span class="token string">"notepad.exe"</span> c:<span class="token punctuation">\</span><span class="token number">1</span>.txt
</code></pre> 
<h5><a id="42__341"></a>4.2 等待进程结束</h5> 
<pre><code class="prism language-bash"><span class="token comment"># 启动notepad，等待notepad结束后，批处理再退出</span>
start /wait /B <span class="token string">""</span> <span class="token string">"notepad.exe"</span> c:<span class="token punctuation">\</span><span class="token number">1</span>.txt
</code></pre> 
<h5><a id="43__346"></a>4.3 结束进程</h5> 
<pre><code class="prism language-bash">taskkill /f /im TeamViewer* <span class="token operator">&gt;</span>NUL <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>NUL
</code></pre> 
<h5><a id="44_cmd_352"></a>4.4 初始化环境变量，不关闭cmd</h5> 
<blockquote> 
 <p>类似于VS开发者工具</p> 
</blockquote> 
<ul><li>无banner</li></ul> 
<pre><code class="prism language-bash"><span class="token builtin class-name">set</span> <span class="token assign-left variable">msbild_dir</span><span class="token operator">=</span>C:<span class="token punctuation">\</span>Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span><span class="token punctuation">\</span>Microsoft Visual Studio<span class="token punctuation">\</span><span class="token number">2019</span><span class="token punctuation">\</span>Professional<span class="token punctuation">\</span>MSBuild<span class="token punctuation">\</span>Current<span class="token punctuation">\</span>Bin<span class="token punctuation">\</span>
<span class="token builtin class-name">set</span> <span class="token assign-left variable">path</span><span class="token operator">=</span>%path%<span class="token punctuation">;</span><span class="token string">"%msbild_dir%"</span><span class="token punctuation">;</span>
start <span class="token string">"mytool"</span> cmd.exe
<span class="token comment"># 此时可以使用msbuild命令</span>
<span class="token comment"># 如果此时还是不能使用，可以把%path%放在行最后</span>
</code></pre> 
<ul><li>有banner</li></ul> 
<pre><code class="prism language-bash"><span class="token builtin class-name">set</span> <span class="token assign-left variable">msbild_dir</span><span class="token operator">=</span>C:<span class="token punctuation">\</span>Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span><span class="token punctuation">\</span>Microsoft Visual Studio<span class="token punctuation">\</span><span class="token number">2019</span><span class="token punctuation">\</span>Professional<span class="token punctuation">\</span>MSBuild<span class="token punctuation">\</span>Current<span class="token punctuation">\</span>Bin<span class="token punctuation">\</span>
<span class="token builtin class-name">set</span> <span class="token assign-left variable">path</span><span class="token operator">=</span>%path%<span class="token punctuation">;</span><span class="token string">"%msbild_dir%"</span><span class="token punctuation">;</span>
start <span class="token string">"%~dp0logo.bat"</span>
</code></pre> 
<pre><code class="prism language-bash">@echo off
title vs2019
<span class="token builtin class-name">echo</span> banner
</code></pre> 
<h5><a id="45_bat_380"></a>4.5 管理员运行bat无法同时切换目录</h5> 
<pre><code class="prism language-bash">@ECHO OFF <span class="token operator">&amp;</span> CD /D %~dp0
start cmd.exe
</code></pre> 
<h5><a id="46_explorer_387"></a>4.6 explorer</h5> 
<pre><code class="prism language-bash"><span class="token comment"># 打开文件夹</span>
explorer C:<span class="token punctuation">\</span>Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span><span class="token punctuation">\</span>Internet Explorer
<span class="token comment"># 选中文件</span>
explorer /e,/select, C:<span class="token punctuation">\</span>Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span><span class="token punctuation">\</span>Internet Explorer<span class="token punctuation">\</span>iexplore.exe
<span class="token comment"># 选中文件夹</span>
explorer /e,/select, C:<span class="token punctuation">\</span>Program Files <span class="token punctuation">(</span>x86<span class="token punctuation">)</span><span class="token punctuation">\</span>Internet Explorer
</code></pre> 
<h4><a id="5__400"></a>5. 文件、文件夹</h4> 
<h5><a id="51__402"></a>5.1 删除文件</h5> 
<pre><code class="prism language-bash"><span class="token comment"># 删除文件</span>
del /q <span class="token string">"TeamViewer*.txt"</span> <span class="token operator">&gt;</span>NUL <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>NUL
</code></pre> 
<h5><a id="52__407"></a>5.2 删除文件夹</h5> 
<pre><code class="prism language-bash"><span class="token comment"># 删除文件夹</span>
rd/s/q <span class="token string">"%tmp%\TeamViewer"</span><span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>NUL
</code></pre> 
<h5><a id="53__412"></a>5.3 删除文件夹（使用通配符）</h5> 
<pre><code class="prism language-bash"><span class="token comment"># 删除pip-20.3.4.dist-info、pip-19.0.0.dist-info等文件夹</span>
<span class="token keyword">for</span> /d %%x <span class="token keyword">in</span> <span class="token punctuation">(</span><span class="token string">"pip-*dist-info"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token function">rmdir</span> /s /q <span class="token string">"%%x"</span>
</code></pre> 
<h5><a id="54__417"></a>5.4 拷贝文件夹</h5> 
<pre><code class="prism language-bash"><span class="token comment"># 将文件夹LocalAppData\Icecream中的内容拷贝到%LocalAppData%\Icecream\文件夹中</span>
<span class="token comment"># 第一个参数结尾不能有斜杠</span>
<span class="token comment"># 第二个参数必须以斜杠结束</span>
xcopy/e/y <span class="token string">"LocalAppData\Icecream"</span> "%LocalAppData%<span class="token punctuation">\</span>Icecream<span class="token punctuation">\</span>"
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment"># 常见问题1：xcopy报错未知错误无法创建目录，原因：第二个参数结尾多了个斜杠</span>
xcopy/e/y <span class="token string">"D:\Release"</span> <span class="token string">"D:\Update<span class="token entity" title="\\">\\</span>"</span>
<span class="token comment"># 改为</span>
copy/e/y <span class="token string">"D:\Release"</span> "D:<span class="token punctuation">\</span>Update<span class="token punctuation">\</span>"
</code></pre> 
<h4><a id="6__432"></a>6. 注册表</h4> 
<ul><li>项、值（值名称+值数据）</li><li>ROOTKEY\SubKey 
  <ul><li><u>HKCR</u>、<u>HKCU</u>、<u>HKLM</u>、HKU、HKCC</li></ul> </li><li>/f 强制操作</li><li>/v 值名称 /ve 默认值名称</li><li>/t 类型 
  <ul><li>REG_SZ （不设置/t参数的默认类型）</li><li>REG_MULTI_SZ</li><li>REG_EXPAND_SZ</li><li>REG_DWORD “0x00000022”</li><li>REG_QWORD</li><li>REG_BINARY</li><li>REG_NONE</li></ul> </li><li>/d 数据</li></ul> 
<h5><a id="61__449"></a>6.1 添加</h5> 
<pre><code class="prism language-bash"><span class="token comment"># 添加</span>
Reg Add HKCU<span class="token punctuation">\</span>Software<span class="token punctuation">\</span>TeamViewer /v UseNewUI /t REG_DWORD /d <span class="token number">1</span> /F <span class="token operator">&gt;</span>NUL <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>NUL
</code></pre> 
<h5><a id="62__456"></a>6.2 删除</h5> 
<pre><code class="prism language-bash"><span class="token comment"># 删除项</span>
reg delete <span class="token string">"HKCU\SOFTWARE\TeamViewer"</span> /f <span class="token operator">&gt;</span>NUL <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>NUL
</code></pre> 
<h4><a id="7__465"></a>7. 服务</h4> 
<h5><a id="71__467"></a>7.1 停止服务</h5> 
<pre><code class="prism language-bash">sc stop TeamViewer <span class="token operator">&gt;</span>NUL <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>NUL
sc delete TeamViewer <span class="token operator">&gt;</span>NUL <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>NUL
</code></pre> 
<h4><a id="10__476"></a>10. 创建桌面快捷方式</h4> 
<pre><code class="prism language-bash">mshta VBScript:Execute<span class="token punctuation">(</span><span class="token string">"Set a=CreateObject("</span>"WScript.Shell<span class="token string">""</span><span class="token punctuation">)</span>:Set <span class="token assign-left variable">b</span><span class="token operator">=</span>a.CreateShortcut<span class="token punctuation">(</span>a.SpecialFolders<span class="token punctuation">(</span><span class="token string">""</span>Desktop<span class="token string">""</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">""</span><span class="token punctuation">\</span>TeamViewer.lnk<span class="token string">""</span><span class="token punctuation">)</span>:b.TargetPath<span class="token operator">=</span><span class="token string">""</span>%~dp0TeamViewer.exe<span class="token string">""</span>:b.WorkingDirectory<span class="token operator">=</span><span class="token string">""</span>%~dp0<span class="token string">""</span>:b.Save:close"<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="11__484"></a>11. 延时退出</h4> 
<pre><code class="prism language-bash"><span class="token comment"># 延时2秒后退出</span>
TIMEOUT /t <span class="token number">2</span> <span class="token operator">&gt;</span>NUL<span class="token operator">&amp;</span><span class="token builtin class-name">exit</span>
<span class="token comment"># 延时2秒后退出</span>
<span class="token function">ping</span> <span class="token number">127.0</span>.0.1 /n <span class="token number">2</span> <span class="token operator">&gt;</span>NUL<span class="token operator">&amp;</span><span class="token builtin class-name">exit</span>
</code></pre> 
<h4><a id="12__tcp_udp_port_493"></a>12. 查看进程本地和远程端口 tcp udp port</h4> 
<pre><code class="prism language-bash"><span class="token comment"># 忽略大小写搜索包含client的进城</span>
tasklist<span class="token operator">|</span>findstr /I <span class="token string">"client"</span>
<span class="token comment"># 查找进程使用的端口</span>
<span class="token function">netstat</span> -ano<span class="token operator">|</span>findstr /I <span class="token string">"9836"</span>
<span class="token comment"># 根据pid结束进城</span>
taskkill /f /pid <span class="token number">9836</span>
</code></pre> 
<h4><a id="99__506"></a>99. 样例文件</h4> 
<pre><code class="prism language-bash">:: 管理员身份运行
@ECHO OFF<span class="token operator">&amp;</span><span class="token punctuation">(</span>PUSHD <span class="token string">"%~DP0"</span><span class="token punctuation">)</span><span class="token operator">&amp;</span><span class="token punctuation">(</span>REG QUERY <span class="token string">"HKU\S-1-5-19"</span><span class="token operator">&gt;</span>NUL <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token punctuation">(</span>
powershell -Command <span class="token string">"Start-Process '%~sdpnx0' -Verb RunAs"</span><span class="token operator">&amp;&amp;</span>EXIT<span class="token punctuation">)</span>

:: xp检测
ver<span class="token operator">|</span>findstr <span class="token string">"5\.[0-9]\.[0-9][0-9]*"</span> <span class="token operator">&gt;</span> NUL <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
ECHO.<span class="token operator">&amp;</span>ECHO 当前版本不支持WinXP <span class="token operator">&amp;</span>PAUSE<span class="token operator">&gt;</span>NUL<span class="token operator">&amp;</span>EXIT<span class="token punctuation">)</span>

:: 关闭进程
taskkill /f /im XMP.exe <span class="token operator">&gt;</span>NUL <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>NUL
taskkill /f /im XLLiveUD* <span class="token operator">&gt;</span>NUL <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>NUL

:: 删除文件和文件夹
:: %temp%
:: %UserProfile%<span class="token punctuation">\</span>AppData
:: %AppData%
:: %userprofile%<span class="token punctuation">\</span>Documents
:: %PUBLIC%<span class="token punctuation">\</span>Documents
:: %ProgramData%
:: %ProgramW6432%<span class="token punctuation">\</span>Common Files
:: %ProgramFiles<span class="token punctuation">(</span>x86<span class="token punctuation">)</span>%<span class="token punctuation">\</span>Common Files
rd/s/q <span class="token string">"%TEMP%\Xmp"</span><span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>NUL
del/q <span class="token string">"%ProgramData%\APlayerCodecs3.exe"</span> <span class="token operator">&gt;</span>NUL <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>NUL

:: 创建文件夹
md <span class="token string">"%PUBLIC%\Thunder Network<span class="token entity" title="\c">\c</span>id_store.dat"</span> <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span>NUL

:: 添加注册表
IF NOT EXIST <span class="token string">"%ProgramW6432%"</span> <span class="token punctuation">(</span>
reg <span class="token function">add</span> <span class="token string">"HKLM\SOFTWARE\Thunder Network\ThunderOem<span class="token entity" title="\t">\t</span>hunder_backwnd"</span> /f /v <span class="token string">"dir"</span> /d <span class="token string">"%~dp0<span class="token entity" title='\"'>\"</span> &gt;NUL 2&gt;NUL
) ELSE (
reg add "</span>HKLM<span class="token punctuation">\</span>SOFTWARE<span class="token punctuation">\</span>Wow6432Node<span class="token punctuation">\</span>Thunder Network<span class="token punctuation">\</span>ThunderOem<span class="token punctuation">\</span>thunder_backwnd<span class="token string">" /f /v "</span>Path<span class="token string">" /d "</span>%~dp0Program<span class="token punctuation">\</span>Thunder.exe<span class="token string">" &gt;NUL 2&gt;NUL
)

:: 注册dll
regsvr32 /s BHO\ThunderAgent.dll

::创建桌面快捷方式
mshta VBScript:Execute("</span>Set <span class="token assign-left variable">a</span><span class="token operator">=</span>CreateObject<span class="token punctuation">(</span><span class="token string">""</span>WScript.Shell<span class="token string">""</span><span class="token punctuation">)</span>:Set <span class="token assign-left variable">b</span><span class="token operator">=</span>a.CreateShortcut<span class="token punctuation">(</span>a.SpecialFolders<span class="token punctuation">(</span><span class="token string">""</span>Desktop<span class="token string">""</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token string">""</span><span class="token punctuation">\</span>迅雷.lnk<span class="token string">""</span><span class="token punctuation">)</span>:b.TargetPath<span class="token operator">=</span><span class="token string">""</span>%~sdp0Program<span class="token punctuation">\</span>Thunder.exe<span class="token string">""</span>:b.WorkingDirectory<span class="token operator">=</span><span class="token string">""</span>%~sdp0Program<span class="token string">""</span>:b.Save:close"<span class="token punctuation">)</span>

ECHO.<span class="token operator">&amp;</span>ECHO 完成 <span class="token operator">&amp;</span>TIMEOUT /t <span class="token number">2</span> <span class="token operator">&gt;</span>NUL<span class="token operator">&amp;</span>EXIT
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2229eab44f44c06b191c930fade2f0d8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">利用grep进行文本处理</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1b2e86acdc073c4915ec0f08130c0ac8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">傅里叶变换及低通滤波再反变换（C&#43;&#43;&amp;&amp;opencv）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>