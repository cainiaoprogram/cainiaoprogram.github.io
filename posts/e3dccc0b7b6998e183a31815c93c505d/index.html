<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于STM32单片机的智能家居窗户窗帘控制系统红外遥控proteus仿真原理图PCB - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="基于STM32单片机的智能家居窗户窗帘控制系统红外遥控proteus仿真原理图PCB" />
<meta property="og:description" content="功能：
0.本系统采用STM32F103RCT6作为单片机
1.LCD1602液晶实时显示当前时间/窗帘状态/光照强度
2.支持手动按键/定时/光强检测三种模式控制窗帘
3.&#39;设置’键进入设置界面
4.默认状态下’确定’键可切换模式
5.设置界面’确定’为确定
6.支持掉电保存
7.采用DC002作为电源接口可直接输入5V给整个系统供电
原理图：
PCB ：
主程序：
/************************************************************* 智能窗帘 补充说明： ***************************************************************/ #include &#34;reg52.h&#34; #include &#34;LCD1602.h&#34; #include &#34;DS1302.h&#34; #include &#34;28BYJ48.h&#34; #include &#34;eeprom52.h&#34; #include &#34;tlc0832.h&#34; #include &#34;infrared.h&#34; #include &#34;delay.h&#34; #define uchar unsigned char //宏定义 #define uint unsigned int /*******************引脚定义*********************/ sbit KEY_MODE = P3^3; //设置键 sbit KEY_ADD = P3^4; //加值键 sbit KEY_SUB = P3^6; //减值键 sbit KEY_ENTER = P3^5; //确定键 sbit BUZZER = P2^0; //蜂鸣器 sbit SW1 = P1^3; //全开 限位开关 /*******************变量定义*********************/ uchar light_up = 80; uchar light_down = 30; //存储光强上、下限值 uchar set_f = 0; //设置选择标记，=0非设置，=1设置年，=2设置月，=3设置日，=4设置时，=5设置分，=6设置秒 // =7设置定时-时，=8设置定时-分，=9设置定时-开关，=10设置窗帘打开/关闭 //	=11设置光强上限，=12设置光强下限，=13设置校准窗帘位置 unsigned char dis[10] = {&#39;0&#39;, &#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;, &#39;6&#39;, &#39;7&#39;, &#39;8&#39;, &#39;9&#39;}; uchar num; //计数变量 uchar ds[4] = {8, 30, 16, 20}; //定时控制开时、分、控制关时、分 uchar mode = 0; //模式标记。=0手动，=1定时，=2光控 uchar light; //存储光强 uint moto_num = 0; //记录窗帘位置 uchar motor_state = 0; //窗帘状态，=0已经关闭，=1处于运转过程中，=2已经打开 bit moto_f = 0; //标记当前控制状态，=0控制关，=1控制开 uchar code display_mode[3][3] = {&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/e3dccc0b7b6998e183a31815c93c505d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-02T14:18:41+08:00" />
<meta property="article:modified_time" content="2023-10-02T14:18:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于STM32单片机的智能家居窗户窗帘控制系统红外遥控proteus仿真原理图PCB</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>功能：<br> 0.本系统采用STM32F103RCT6作为单片机<br> 1.LCD1602液晶实时显示当前时间/窗帘状态/光照强度<br> 2.支持手动按键/定时/光强检测三种模式控制窗帘<br> 3.'设置’键进入设置界面<br> 4.默认状态下’确定’键可切换模式<br> 5.设置界面’确定’为确定<br> 6.支持掉电保存<br> 7.采用DC002作为电源接口可直接输入5V给整个系统供电</p> 
<p>原理图：<br> <img src="https://images2.imgbox.com/21/d3/2d2fWgMA_o.png" alt="在这里插入图片描述"></p> 
<p>PCB ：<br> <img src="https://images2.imgbox.com/57/d0/hb1YQWZj_o.png" alt="在这里插入图片描述"></p> 
<p>主程序：</p> 
<pre><code class="prism language-c"><span class="token comment">/*************************************************************
                        智能窗帘

补充说明：
***************************************************************/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"reg52.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"LCD1602.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"DS1302.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"28BYJ48.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"eeprom52.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"tlc0832.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"infrared.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"delay.h"</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">uchar</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">char</span> </span><span class="token comment">//宏定义</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">uint</span> <span class="token expression"><span class="token keyword">unsigned</span> <span class="token keyword">int</span></span></span>

<span class="token comment">/*******************引脚定义*********************/</span>
sbit KEY_MODE    <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">3</span><span class="token punctuation">;</span>   <span class="token comment">//设置键</span>
sbit KEY_ADD     <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">4</span><span class="token punctuation">;</span>   <span class="token comment">//加值键</span>
sbit KEY_SUB     <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">6</span><span class="token punctuation">;</span>   <span class="token comment">//减值键</span>
sbit KEY_ENTER   <span class="token operator">=</span> P3<span class="token operator">^</span><span class="token number">5</span><span class="token punctuation">;</span>   <span class="token comment">//确定键</span>
sbit BUZZER      <span class="token operator">=</span> P2<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span>   <span class="token comment">//蜂鸣器</span>

sbit SW1      <span class="token operator">=</span> P1<span class="token operator">^</span><span class="token number">3</span><span class="token punctuation">;</span>   <span class="token comment">//全开 限位开关</span>
<span class="token comment">/*******************变量定义*********************/</span>
uchar light_up <span class="token operator">=</span> <span class="token number">80</span><span class="token punctuation">;</span>
uchar light_down <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span> <span class="token comment">//存储光强上、下限值</span>
uchar set_f <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token comment">//设置选择标记，=0非设置，=1设置年，=2设置月，=3设置日，=4设置时，=5设置分，=6设置秒</span>
                            <span class="token comment">//              =7设置定时-时，=8设置定时-分，=9设置定时-开关，=10设置窗帘打开/关闭</span>
                            <span class="token comment">//				=11设置光强上限，=12设置光强下限，=13设置校准窗帘位置</span>

<span class="token keyword">unsigned</span> <span class="token keyword">char</span> dis<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token char">'0'</span><span class="token punctuation">,</span> <span class="token char">'1'</span><span class="token punctuation">,</span> <span class="token char">'2'</span><span class="token punctuation">,</span> <span class="token char">'3'</span><span class="token punctuation">,</span> <span class="token char">'4'</span><span class="token punctuation">,</span> <span class="token char">'5'</span><span class="token punctuation">,</span> <span class="token char">'6'</span><span class="token punctuation">,</span> <span class="token char">'7'</span><span class="token punctuation">,</span> <span class="token char">'8'</span><span class="token punctuation">,</span> <span class="token char">'9'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
uchar num<span class="token punctuation">;</span>   <span class="token comment">//计数变量</span>
uchar ds<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">//定时控制开时、分、控制关时、分</span>

uchar mode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//模式标记。=0手动，=1定时，=2光控</span>
uchar light<span class="token punctuation">;</span>    <span class="token comment">//存储光强</span>

uint moto_num <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                                        <span class="token comment">//记录窗帘位置</span>
uchar motor_state <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                                     <span class="token comment">//窗帘状态，=0已经关闭，=1处于运转过程中，=2已经打开</span>
bit moto_f <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>                                           <span class="token comment">//标记当前控制状态，=0控制关，=1控制开</span>
uchar code display_mode<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"SD\0"</span><span class="token punctuation">,</span> <span class="token string">"DS\0"</span><span class="token punctuation">,</span> <span class="token string">"GK\0"</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">//显示模式</span>

<span class="token keyword">void</span> <span class="token function">WriteData</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">SectorErase</span><span class="token punctuation">(</span><span class="token number">0x2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//擦除扇区</span>
    <span class="token function">WriteByte</span><span class="token punctuation">(</span><span class="token number">0x2000</span><span class="token punctuation">,</span> ds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//写入【定时时间】数据保存</span>
    <span class="token function">WriteByte</span><span class="token punctuation">(</span><span class="token number">0x2001</span><span class="token punctuation">,</span> ds<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//写入【定时时间】数据保存存</span>
    <span class="token function">WriteByte</span><span class="token punctuation">(</span><span class="token number">0x2002</span><span class="token punctuation">,</span> ds<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//写入【定时时间】数据保存存</span>
    <span class="token function">WriteByte</span><span class="token punctuation">(</span><span class="token number">0x2003</span><span class="token punctuation">,</span> ds<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//写入【定时时间】数据保存存</span>
    <span class="token function">WriteByte</span><span class="token punctuation">(</span><span class="token number">0x2004</span><span class="token punctuation">,</span> light_up<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//写入【光强上限值】数据保存</span>
    <span class="token function">WriteByte</span><span class="token punctuation">(</span><span class="token number">0x2005</span><span class="token punctuation">,</span> light_down<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//写入【光强下限值】数据保存</span>
    <span class="token function">WriteByte</span><span class="token punctuation">(</span><span class="token number">0x2006</span><span class="token punctuation">,</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//写入【模式】数据保存</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">ReadData</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    ds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token number">0x2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//读取存储的【定时时间】数据</span>
    ds<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token number">0x2001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//读取存储的【定时时间】数据</span>
    ds<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token number">0x2002</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//读取存储的【定时时间】数据</span>
    ds<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token number">0x2003</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">//读取存储的【定时时间】数据</span>
    light_up <span class="token operator">=</span> <span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token number">0x2004</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//读取存储的【光强上限值】数据</span>
    light_down <span class="token operator">=</span> <span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token number">0x2005</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//读取存储的【光强下限值】数据</span>
    mode <span class="token operator">=</span> <span class="token function">ReadByte</span><span class="token punctuation">(</span><span class="token number">0x2006</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//读取存储的【模式】数据</span>
<span class="token punctuation">}</span>

<span class="token comment">/********************************************************
函数名称:void display(void)
函数作用:正常显示日期、时间、光强等函数
参数说明:
********************************************************/</span>
<span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    uint t<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">//显示时间</span>
    <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示时【0：表示第1列，2：表示第2行，所有关于显示都一样】</span>
    <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token char">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示分【3：表示第4列，2：表示第2行，所有关于显示都一样】</span>
    <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token char">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示秒</span>
    <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//显示日期</span>
    <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示年</span>
    <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token char">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示月</span>
    <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token char">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示日</span>
    <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//显示模式</span>
    <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> display_mode<span class="token punctuation">[</span>mode<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//显示光强</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>light <span class="token operator">&gt;</span> <span class="token number">99</span><span class="token punctuation">)</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>light <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token char">' '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>light <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>light <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token char">'%'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//光强控制</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mode <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">//光控模式</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>light <span class="token operator">&gt;=</span> light_up <span class="token operator">||</span> light <span class="token operator">&lt;</span> light_down<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//判断实际光强是否【大于等于上限 或 小于下限值】、当前处于打开状态</span>
        <span class="token punctuation">{<!-- --></span>
            moto_f <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>     <span class="token comment">//标记当前控制窗帘关闭</span>
            motor_state <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//标记窗帘处于运转过程中</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>light <span class="token operator">&lt;</span> light_up <span class="token operator">&amp;&amp;</span> light <span class="token operator">&gt;=</span> light_down<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">//判断实际光强是否【大于等于下限值 并且 小于上限】、当前处于关闭状态</span>
        <span class="token punctuation">{<!-- --></span>
            moto_f <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>     <span class="token comment">//标记当前控制窗帘打开</span>
            motor_state <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//标记窗帘处于运转过程中</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>mode <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//定时模式</span>
    <span class="token punctuation">{<!-- --></span>
        t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> time<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">+</span> time<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//当前时间</span>
        t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> ds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">+</span> ds<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">//窗帘开启时间点</span>
        t<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> ds<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">60</span> <span class="token operator">+</span> ds<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token comment">//窗帘关闭时间点</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> t<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment">//0时 --&gt; t[1] --&gt; t[2] --&gt; 24时</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> t<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                moto_f <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//标记当前需要打开窗帘</span>
            <span class="token keyword">else</span>
                moto_f <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//标记当前需要关闭窗帘</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token comment">//0时 --&gt; t[2] --&gt; t[1] --&gt; 24时</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;=</span> t<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                moto_f <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//标记当前需要打开窗帘</span>
            <span class="token keyword">else</span>
                moto_f <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//标记当前需要关闭窗帘</span>
        <span class="token punctuation">}</span>
        motor_state <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//标记窗帘处于运转过程中</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>moto_f <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> motor_state <span class="token operator">!=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> SW1 <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//控制关闭窗帘</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>moto_num <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//控制次数减到0时，表示窗户已经关闭完成</span>
        <span class="token punctuation">{<!-- --></span>
            BYJ48 <span class="token operator">=</span> BYJ48 <span class="token operator">&amp;</span> <span class="token number">0xf0</span><span class="token punctuation">;</span> <span class="token comment">//关闭步进电机</span>
            motor_state <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token comment">//标记窗帘处于关闭状态</span>
            <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"ZT:OFF"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">motor_z</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//步进电机正转</span>
            moto_num<span class="token operator">--</span><span class="token punctuation">;</span> <span class="token comment">//控制次数-1</span>
            <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"--&gt;OFF"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>moto_f <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> motor_state <span class="token operator">!=</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> SW1 <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//控制打开窗帘</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>moto_num <span class="token operator">&gt;=</span> <span class="token number">192</span><span class="token punctuation">)</span> <span class="token comment">//控制次数加到192时，表示窗户已经打开完成</span>
        <span class="token punctuation">{<!-- --></span>
            BYJ48 <span class="token operator">=</span> BYJ48 <span class="token operator">&amp;</span> <span class="token number">0xf0</span><span class="token punctuation">;</span> <span class="token comment">//关闭步进电机</span>
            motor_state <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token comment">//标记窗帘处于打开状态</span>
            <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"ZT:ON "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">motor_f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//步进电机反转</span>
            moto_num<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//控制次数+1</span>
            <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"--&gt;ON "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token comment">//窗户处于停止状态</span>
    <span class="token punctuation">{<!-- --></span>
        BYJ48 <span class="token operator">=</span> BYJ48 <span class="token operator">&amp;</span> <span class="token number">0xf0</span><span class="token punctuation">;</span> <span class="token comment">//关闭步进电机</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>motor_state <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"ZT:OFF"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>motor_state <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span>
            <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"ZT:ON "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/********************************************************
函数名称:void display2(void)
函数作用:显示调整日期、时间函数
参数说明:
********************************************************/</span>
<span class="token keyword">void</span> <span class="token function">display2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    num<span class="token operator">++</span><span class="token punctuation">;</span>

    <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Date:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Time:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//偶数次显示，奇数次不显示。这样就会有闪烁效果，可以清楚看到当前设置的是哪个值</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示年</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token char">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示月</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token char">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示日</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示时</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token char">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示分</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token char">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示秒</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>time<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token comment">//奇数次不显示</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>set_f<span class="token punctuation">)</span> <span class="token comment">//根据当前设置的内容，对应位置闪烁</span>
        <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
            <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
            <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
            <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span>
            <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span>
            <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span>
            <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/********************************************************
函数名称:void display3(void)
函数作用:显示调整定时时间函数
参数说明:
********************************************************/</span>
<span class="token keyword">void</span> <span class="token function">display3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    num<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Sets timer time:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"--"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//偶数次显示，奇数次不显示。这样就会有闪烁效果，可以清楚看到当前设置的是哪个值</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>ds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示定时开-时</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>ds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token char">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>ds<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示定时开-分</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>ds<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>ds<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示定时关-时</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>ds<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token char">':'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>ds<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示定时关-分</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>ds<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token comment">//奇数次不显示</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>set_f<span class="token punctuation">)</span> <span class="token comment">//根据当前设置的内容，对应位置闪烁</span>
        <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span>
            <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">8</span><span class="token operator">:</span>
            <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">9</span><span class="token operator">:</span>
            <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">10</span><span class="token operator">:</span>
            <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/********************************************************
函数名称:void display4(void)
函数作用:显示调整光强控制函数
参数说明:
********************************************************/</span>
<span class="token keyword">void</span> <span class="token function">display4</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    num<span class="token operator">++</span><span class="token punctuation">;</span>

    <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"Light_Up  :"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Light_Down:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token char">'%'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token char">'%'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>num <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//偶数次显示，奇数次不显示。这样就会有闪烁效果，可以清楚看到当前设置的是哪个值</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>light_up <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示光强上限值</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>light_up <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>light_up <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>light_down <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//显示光强下限值</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>light_down <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">LCD_DispOneChar</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> dis<span class="token punctuation">[</span>light_down <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token comment">//奇数次不显示</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>set_f<span class="token punctuation">)</span> <span class="token comment">//根据当前设置的内容，对应位置闪烁</span>
        <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token number">11</span><span class="token operator">:</span>
            <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">"   "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token number">12</span><span class="token operator">:</span>
            <span class="token function">LCD_DispStr</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"   "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/********************************************************
函数名称:void KeyScan(void)
函数作用:按键查询处理函数
参数说明:
********************************************************/</span>
<span class="token keyword">void</span> <span class="token function">KeyScan</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//设置键</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hw_data <span class="token operator">==</span> <span class="token char">'B'</span> <span class="token operator">||</span> KEY_MODE <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//按键按下</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">DelayMs</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                        <span class="token comment">//延时消抖</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>hw_data <span class="token operator">==</span> <span class="token char">'B'</span> <span class="token operator">||</span> KEY_MODE <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//再次确认按键按下</span>
        <span class="token punctuation">{<!-- --></span>
            BUZZER <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token function">DelayMs</span><span class="token punctuation">(</span><span class="token number">130</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            BUZZER <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            BYJ48 <span class="token operator">=</span> BYJ48 <span class="token operator">&amp;</span> <span class="token number">0xf0</span><span class="token punctuation">;</span> <span class="token comment">//关闭步进电机</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>set_f <span class="token operator">==</span> <span class="token number">6</span><span class="token punctuation">)</span>    <span class="token comment">//日期、时间校准完</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token function">LCD_Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//清除屏幕显示</span>
                <span class="token function">DelayMs</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>        <span class="token comment">//延时等待全部清除完毕</span>
                set_f <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">;</span>              <span class="token comment">//跳到校准窗帘状态</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>set_f <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//进入设置先清除屏幕，显示设置部分</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token function">Write_DS1302</span><span class="token punctuation">(</span>WRITE_PROTECT<span class="token punctuation">,</span> <span class="token number">0X00</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//禁止DS1302写保护</span>
                <span class="token function">LCD_Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">//清除屏幕显示</span>
                <span class="token function">DelayMs</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>                 <span class="token comment">//延时等待全部清除完毕</span>
                <span class="token keyword">switch</span> <span class="token punctuation">(</span>mode<span class="token punctuation">)</span>                     <span class="token comment">//根据对应的模式，设置对应的参数</span>
                <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
                    set_f <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">//手动模式</span>
                <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
                    set_f <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">//定时模式</span>
                <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
                    set_f <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span> <span class="token comment">//光控模式</span>
                <span class="token keyword">default</span><span class="token operator">:</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>set_f <span class="token operator">==</span> <span class="token number">10</span> <span class="token operator">||</span> set_f <span class="token operator">==</span> <span class="token number">12</span><span class="token punctuation">)</span> <span class="token comment">//进入设置日期时间</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token function">LCD_Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//清除屏幕显示</span>
                <span class="token function">DelayMs</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>        <span class="token comment">//延时等待全部清除完毕</span>
                set_f <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>               <span class="token comment">//进入校准时间</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
                set_f<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">//设置变量+1</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>set_f <span class="token operator">&gt;</span> <span class="token number">12</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                set_f <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//重置设置变量</span>

                <span class="token function">Write_DS1302</span><span class="token punctuation">(</span>WRITE_MINUTE<span class="token punctuation">,</span> <span class="token punctuation">(</span>time<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">16</span> <span class="token operator">+</span> time<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将设置好的时间写入DS1302</span>
                <span class="token function">Write_DS1302</span><span class="token punctuation">(</span>WRITE_SECOND<span class="token punctuation">,</span> <span class="token punctuation">(</span>time<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">16</span> <span class="token operator">+</span> time<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token function">WriteData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token function">LCD_Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//清除屏幕显示</span>
                <span class="token function">DelayMs</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>        <span class="token comment">//延时等待全部清除完毕</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>KEY_MODE<span class="token punctuation">)</span>
            <span class="token punctuation">;</span> <span class="token comment">//等待按键松开</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//确定</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hw_data <span class="token operator">==</span> <span class="token char">'|'</span> <span class="token operator">||</span> KEY_ENTER <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//按键按下</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">DelayMs</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                                        <span class="token comment">//延时消抖</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>hw_data <span class="token operator">==</span> <span class="token char">'|'</span> <span class="token operator">||</span> KEY_ENTER <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> set_f <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//再次确认按键按下</span>
        <span class="token punctuation">{<!-- --></span>
            BUZZER <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
            <span class="token function">DelayMs</span><span class="token punctuation">(</span><span class="token number">130</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            BUZZER <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>set_f <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token function">Write_DS1302</span><span class="token punctuation">(</span>WRITE_MINUTE<span class="token punctuation">,</span> <span class="token punctuation">(</span>time<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">16</span> <span class="token operator">+</span> time<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将设置好的时间写入DS1302</span>
                <span class="token function">Write_DS1302</span><span class="token punctuation">(</span>WRITE_SECOND<span class="token punctuation">,</span> <span class="token punctuation">(</span>time<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">16</span> <span class="token operator">+</span> time<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            set_f <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">//重置设置变量</span>

            <span class="token function">WriteData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token function">LCD_Clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//清除屏幕显示</span>
            <span class="token function">DelayMs</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>        <span class="token comment">//延时等待全部清除完毕</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>KEY_ENTER <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> set_f <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//切换模式</span>
        <span class="token punctuation">{<!-- --></span>
            mode<span class="token operator">++</span><span class="token punctuation">;</span>              <span class="token comment">//模式变量+1</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mode <span class="token operator">&gt;=</span> <span class="token number">3</span><span class="token punctuation">)</span>       <span class="token comment">//最大3个模式</span>
                mode <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token comment">//重新回到第1个模式</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>motor_state <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//如果处于运转过程中</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>moto_f <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//控制步进电机关闭</span>
                    motor_state <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span> <span class="token comment">//控制步进电机打开</span>
                    motor_state <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token function">WriteData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>KEY_ENTER<span class="token punctuation">)</span>
            <span class="token punctuation">;</span> <span class="token comment">//等待按键松开</span>
    <span class="token punctuation">}</span> 作者：极寒钛科技 https<span class="token operator">:</span><span class="token comment">//www.bilibili.com/read/cv20281890 出处：bilibili</span>
</code></pre> 
<p>实物演示视频：<br> <a href="https://www.bilibili.com/video/BV1PV4y1L7nH/" rel="nofollow">https://www.bilibili.com/video/BV1PV4y1L7nH/</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7235736a801dc273fb38ee1ff475383a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Maven下载源码出现：Cannot download sources Sources not found for org.springframwork...</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3415758b29eee2fbd163359d38f15e2d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于STM32单片机的智能水表水流量计原理图PCB</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>