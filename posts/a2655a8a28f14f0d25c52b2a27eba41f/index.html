<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>我的SQL自学文档 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="我的SQL自学文档" />
<meta property="og:description" content="我的SQL自学文档 数据库可视化操作工具：sequelpro 链接
基本操作 网页练习题
命令行操作
#链接数据库
mysql -u root -p # u 是用户名，p 需要用密码登录数据库
#查看数据库
show databases; #选择数据库
use database_name; #查看数据库中的table表
show table; #查看表格的结构
desc table; #查看表中（一定量）的数据
select * from table_name (limit 10); #条件查询
select * from table_name where condition and/or condition #通配符%
%AT% 代表AT前后可以有任意字符
#查询结果过滤和排序
distinct 属性列唯一返回,直接删除重复行
select distinct column from table_name where condition(s); group by返回唯一行，按某个col_name对数据进行分组
SELECT AGG_FUNC(column_or_expression) AS aggregate_description, … FROM mytable WHERE constraint_expression GROUP BY column; order by 对结果的属性列进行排序" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a2655a8a28f14f0d25c52b2a27eba41f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-06T16:28:10+08:00" />
<meta property="article:modified_time" content="2020-10-06T16:28:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">我的SQL自学文档</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="SQL_0"></a>我的SQL自学文档</h2> 
<p>数据库可视化操作工具：<a href="http://www.ssequelpro.com" rel="nofollow">sequelpro 链接</a></p> 
<h3><a id="_6"></a>基本操作</h3> 
<p><a href="http://xuesql.cn/" rel="nofollow">网页练习题</a></p> 
<p>命令行操作<br> #链接数据库<br> <code>mysql -u root -p</code> # u 是用户名，p 需要用密码登录数据库</p> 
<p>#查看数据库</p> 
<pre><code class="prism language-sql"><span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span> </code></pre> 
<p>#选择数据库</p> 
<pre><code class="prism language-sql"><span class="token keyword">use</span> database_name<span class="token punctuation">;</span></code></pre> 
<p>#查看数据库中的table表</p> 
<pre><code class="prism language-sql"><span class="token keyword">show</span> <span class="token keyword">table</span><span class="token punctuation">;</span></code></pre> 
<p>#查看表格的结构</p> 
<pre><code class="prism language-sql"><span class="token keyword">desc</span> <span class="token keyword">table</span><span class="token punctuation">;</span></code></pre> 
<p>#查看表中（一定量）的数据</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_name <span class="token punctuation">(</span><span class="token keyword">limit</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> 
<p>#条件查询</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> table_name
<span class="token keyword">where</span> condition 
	<span class="token operator">and</span><span class="token operator">/</span><span class="token operator">or</span> condition
	</code></pre> 
<p>#通配符%<br> %AT% 代表AT前后可以有任意字符</p> 
<p>#查询结果过滤和排序<br> distinct 属性列唯一返回,直接删除重复行</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token keyword">distinct</span> <span class="token keyword">column</span> 
<span class="token keyword">from</span> table_name <span class="token keyword">where</span> condition<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre> 
<p>group by返回唯一行，按某个col_name对数据进行分组</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> AGG_FUNC<span class="token punctuation">(</span>column_or_expression<span class="token punctuation">)</span> <span class="token keyword">AS</span> aggregate_description<span class="token punctuation">,</span> …
<span class="token keyword">FROM</span> mytable
<span class="token keyword">WHERE</span> constraint_expression
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">column</span><span class="token punctuation">;</span></code></pre> 
<p>order by 对结果的属性列进行排序</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token keyword">column</span> <span class="token keyword">from</span> table_name <span class="token keyword">where</span> condition<span class="token punctuation">(</span>s<span class="token punctuation">)</span> 
<span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token keyword">column</span> <span class="token keyword">ASC</span><span class="token operator">/</span><span class="token keyword">DESC</span><span class="token punctuation">;</span></code></pre> 
<p>#查看表中的特定位置从：offset开始的limit片段</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token keyword">column</span> <span class="token keyword">from</span> table_name <span class="token keyword">where</span> condition 
<span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token keyword">column</span> 
<span class="token keyword">limit</span> num_limit <span class="token keyword">offset</span> num_offset<span class="token punctuation">;</span></code></pre> 
<p>#join多表联合查询</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span><span class="token keyword">from</span> table_name<span class="token punctuation">(</span>主表<span class="token punctuation">)</span>
<span class="token keyword">join</span> table1<span class="token punctuation">(</span>另一个<span class="token punctuation">)</span>
	<span class="token keyword">on</span> table_name<span class="token punctuation">.</span>id <span class="token operator">=</span> table1<span class="token punctuation">.</span>id<span class="token punctuation">(</span>main_key<span class="token punctuation">)</span>
<span class="token keyword">where</span> condition<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token keyword">order</span> <span class="token keyword">by</span> <span class="token keyword">column</span> <span class="token keyword">DESC</span>
<span class="token keyword">limit</span> <span class="token number">1</span> </code></pre> 
<p>为了不丢失两表不一样的属性，提出包含左集合left join，右集合right join，全集合full join的列联表</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">column</span><span class="token punctuation">,</span> another_column<span class="token punctuation">,</span> …（哪个列名写前面哪个列排前面）
<span class="token keyword">FROM</span> mytable
<span class="token keyword">INNER</span><span class="token operator">/</span><span class="token keyword">LEFT</span><span class="token operator">/</span><span class="token keyword">RIGHT</span><span class="token operator">/</span><span class="token keyword">FULL</span> <span class="token keyword">JOIN</span> another_table
    <span class="token keyword">ON</span> mytable<span class="token punctuation">.</span>id <span class="token operator">=</span> another_table<span class="token punctuation">.</span>matching_id
<span class="token keyword">WHERE</span> condition<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token keyword">column</span><span class="token punctuation">,</span> … <span class="token keyword">ASC</span><span class="token operator">/</span><span class="token keyword">DESC</span>
<span class="token keyword">LIMIT</span> num_limit <span class="token keyword">OFFSET</span> num_offset<span class="token punctuation">;</span></code></pre> 
<p>对属性列进行计算后重新命名<br> 对属性列的处理可以按照题目要求进行各种判断与计算，甚至包括在表中重新加入一列</p> 
<pre><code class="prism language-sql">按角色分组算出每个角色按有办公室和没办公室的统计人数<span class="token punctuation">(</span>列出角色，数量，有无办公室<span class="token punctuation">,</span>注意一个角色如果部分有办公室，部分没有需分开统计） ✓
<span class="token keyword">SELECT</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> count<span class="token punctuation">,</span>
	Role<span class="token punctuation">,</span>
	building <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">as</span> bn 
<span class="token keyword">FROM</span> employees 
<span class="token keyword">group</span> <span class="token keyword">by</span> Role<span class="token punctuation">,</span>bn</code></pre> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> col_expression <span class="token keyword">AS</span> expr_description<span class="token punctuation">,</span> …
<span class="token keyword">FROM</span> mytable
<span class="token keyword">INNER</span><span class="token operator">/</span><span class="token keyword">LEFT</span><span class="token operator">/</span><span class="token keyword">RIGHT</span><span class="token operator">/</span><span class="token keyword">FULL</span> <span class="token keyword">JOIN</span> another_table
    <span class="token keyword">ON</span> mytable<span class="token punctuation">.</span>id <span class="token operator">=</span> another_table<span class="token punctuation">.</span>matching_id
<span class="token keyword">WHERE</span> condition<span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token keyword">column</span><span class="token punctuation">,</span> … <span class="token keyword">ASC</span><span class="token operator">/</span><span class="token keyword">DESC</span>
<span class="token keyword">LIMIT</span> num_limit <span class="token keyword">OFFSET</span> num_offset<span class="token punctuation">;</span></code></pre> 
<p>常用统计函数:<br> COUNT(<em>), COUNT(column) 计数！COUNT(</em>) 统计数据行数，COUNT(column) 统计column非NULL的行数.<br> MIN(column) 找column最小的一行.<br> MAX(column) 找column最大的一行.<br> AVG(column) 对column所有行取平均值.<br> SUM(column) 对column所有行求和.</p> 
<p>#Having对分组完的数据再筛选</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> column_name<span class="token punctuation">,</span> aggregate_function<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> table_name
<span class="token keyword">WHERE</span> column_name operator <span class="token keyword">value</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> column_name
<span class="token keyword">HAVING</span> aggregate_function<span class="token punctuation">(</span>column_name<span class="token punctuation">)</span> operator <span class="token keyword">value</span><span class="token punctuation">;</span></code></pre> 
<p>排序函数<br> row_number,为每一行记录生成一个序号，依次排序且不会重复，使用时必须和over子句选择对某一列进行排序才能生成序号。over子句中的order by 要与Sql排序记录中的order by 保持一致，否则得到的序号可能不是连续的</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> row_numbe<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> subtime <span class="token keyword">desc</span><span class="token punctuation">)</span> <span class="token keyword">as</span> row_num<span class="token punctuation">,</span><span class="token operator">*</span>
<span class="token keyword">from</span> table1</code></pre> 
<p>rank用于返回结果集的分区内每行的排名，对查询出来的记录进行排名。rank函数考虑到over子句中字段相同的情况，over字句中相同的字段rank会跳过排下一个</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> rank<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> userid<span class="token punctuation">)</span> <span class="token keyword">as</span> rank<span class="token punctuation">,</span><span class="token operator">*</span>
<span class="token keyword">from</span> table1</code></pre> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/6f/c6/V0Mfnitv_o.png"></p> 
<p>dense_rank函数出现相同排名时，将不跳过相同排名号，紧接着上一个排名的值，有两个第一名的时候仍然跟着第二名</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> dense_rank<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> userid<span class="token punctuation">)</span> <span class="token keyword">as</span> den_rank<span class="token punctuation">,</span><span class="token operator">*</span>
<span class="token keyword">from</span> table1</code></pre> 
<p>ntile函数对序号进行分组处理，将有序分区中的行分发到指定数目的组中。对于每一个行ntile将返回此行所属的组的编号。相当于将查询出来的记录集放到指定长度的数组中，每一个数组元素存放一定数量的记录。ntile函数为每条记录生成的序号就是这条记录所有的数组元素的索引（从1开始）。ntile函数有一个参数，用来指定桶数。</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> ntile<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token keyword">over</span><span class="token punctuation">(</span><span class="token keyword">order</span> <span class="token keyword">by</span> subtime<span class="token punctuation">)</span> <span class="token keyword">as</span> ntile<span class="token punctuation">,</span><span class="token operator">*</span>
<span class="token keyword">from</span> table1</code></pre> 
<p><img alt="在这里插入图片描述" src="https://images2.imgbox.com/f7/0b/cBvnHdTl_o.png"></p> 
<p>完整的select查询</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token keyword">DISTINCT</span> <span class="token keyword">column</span><span class="token punctuation">,</span> AGG_FUNC<span class="token punctuation">(</span>column_or_expression<span class="token punctuation">)</span><span class="token punctuation">,</span> …
<span class="token keyword">FROM</span> mytable
    <span class="token keyword">JOIN</span> another_table
      <span class="token keyword">ON</span> mytable<span class="token punctuation">.</span><span class="token keyword">column</span> <span class="token operator">=</span> another_table<span class="token punctuation">.</span><span class="token keyword">column</span>
    <span class="token keyword">WHERE</span> constraint_expression
    <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> <span class="token keyword">column</span>
    <span class="token keyword">HAVING</span> constraint_expression
    <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token keyword">column</span> <span class="token keyword">ASC</span><span class="token operator">/</span><span class="token keyword">DESC</span>
    <span class="token keyword">LIMIT</span> count <span class="token keyword">OFFSET</span> COUNT<span class="token punctuation">;</span></code></pre> 
<p>每一列的计算都只能使用原表格中的数据，本次操作前计算出的重命名的列不能直接拿来计算</p> 
<pre><code class="prism language-sql"> <span class="token number">1.</span>
<span class="token keyword">SELECT</span> <span class="token function">sum</span><span class="token punctuation">(</span>Domestic_sales<span class="token operator">+</span>International_sales<span class="token punctuation">)</span> <span class="token keyword">as</span> sum_sale<span class="token punctuation">,</span>
	director<span class="token punctuation">,</span>
	<span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> count<span class="token punctuation">,</span> 
	<span class="token function">sum</span><span class="token punctuation">(</span>Domestic_sales<span class="token operator">+</span>International_sales<span class="token punctuation">)</span><span class="token operator">/</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token keyword">as</span> avg_sale 
<span class="token keyword">FROM</span> movies 
<span class="token keyword">left</span> <span class="token keyword">join</span> boxoffice 
	<span class="token keyword">on</span> movies<span class="token punctuation">.</span>id <span class="token operator">=</span> boxoffice<span class="token punctuation">.</span>movie_id 
<span class="token keyword">group</span> <span class="token keyword">by</span> director 
<span class="token keyword">having</span> count <span class="token operator">&gt;</span> <span class="token number">1</span> 
<span class="token keyword">order</span> <span class="token keyword">by</span> avg_sale <span class="token keyword">desc</span> 
<span class="token keyword">limit</span> <span class="token number">1</span>

<span class="token number">2.</span>
<span class="token keyword">SELECT</span> 
 <span class="token punctuation">(</span><span class="token keyword">SELECT</span> <span class="token punctuation">(</span>Domestic_sales<span class="token operator">+</span>International_sales<span class="token punctuation">)</span> <span class="token keyword">as</span> total_sale 
     <span class="token keyword">FROM</span> movies 
     <span class="token keyword">left</span> <span class="token keyword">join</span> boxoffice 
      <span class="token keyword">on</span> movies<span class="token punctuation">.</span>id <span class="token operator">=</span> boxoffice<span class="token punctuation">.</span>movie_id 
     <span class="token keyword">order</span> <span class="token keyword">by</span> total_sale <span class="token keyword">desc</span> 
     <span class="token keyword">limit</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>Domestic_sales<span class="token operator">+</span>International_sales<span class="token punctuation">)</span> <span class="token keyword">as</span> sale_diff<span class="token punctuation">,</span>
     title 
<span class="token keyword">FROM</span> movies <span class="token keyword">left</span> 
<span class="token keyword">join</span> boxoffice 
 <span class="token keyword">on</span> movies<span class="token punctuation">.</span>id <span class="token operator">=</span> boxoffice<span class="token punctuation">.</span>movie_id 
<span class="token keyword">order</span> <span class="token keyword">by</span> sale_diff <span class="token keyword">desc</span></code></pre> 
<h3><a id="_208"></a>总结</h3> 
<p>SQL语句的书写并不难，难点是SQL逻辑，尤其是需要处理的数据联合了多个数据表或者涉及到的计算层次太多的时候。SQL语句的功能其实都很明白易懂，分组、条件、排序、分页等等这些都可以根据语句来理解，也没有太多的语法限制，简单的英语语句即可，在书写多层递进的SQL语句的时候，可以分开写出每个条件的SQL语句，再根据计算顺序，将每个计算部分的功能块镶嵌进去</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cceedbc2a58e908fd49f9330bc9860e8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mac数据恢复软件 免费 magoshare data rescovery</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/605191f08a4c6045c20fa19061caa907/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">管理距离</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>