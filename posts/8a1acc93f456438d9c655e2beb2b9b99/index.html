<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>LVM配置及磁盘配额 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="LVM配置及磁盘配额" />
<meta property="og:description" content="LVM配置及磁盘配额 LVM基本概念LVM构成LVM命令LVM配置 磁盘配额磁盘配额配置 LVM基本概念 LVM (Logical Volume Manager)，逻辑卷管理 在保持现有数据不变的情况下动态的调整磁盘容量，提高磁盘管理的灵活性
注：/boot分区用于存放引导文件，不能基于LVM创建
LVM构成 PV物理卷 (Physical Volume)
物理卷是LVM机制的基本存储设备，通常为一个分区或整个硬盘
创建物理卷时，会在分区或硬盘的头部创建一个保留区块，用于记录 LVM 的属性，并把存储空间分割成默认大小为 4MB 的基本单元（PE），从而构成物理卷
VG卷组 (Volume Group)
卷组是由一个或多个物理卷组成的
在卷组中可以动态地添加或移除物理卷
LV逻辑卷 (Logical Volume)
从卷组中分割出的一块空间，形成逻辑卷
LVM命令 功能PVVGLVScan（扫描）pvscanvgscanlvscanCreate（建立）pvcreatevgcreatelvcreateDisplay（显示）pvdisplayvgdisplaylvdisplayRemove（移除）pvremovevgremovelvremoveExtend（扩展）-vgextendlvextendReduce（减少）-vgreducelvreduce 建立物理卷PV
pvcreate 设备名
建立卷组VG
vgcreate 卷组名 物理卷名1 物理卷名2
在卷组VG中添加物理卷PV
vgextend VG名 设备名
建立逻辑卷LV
lvcreate -L 容量大小 -n 逻辑卷名 卷组名
逻辑卷LV扩容
lvextend -L &#43;大小(不超过卷组最大容量) /dev/卷组名/逻辑卷名
LVM配置 我们在虚拟机中添加两块10G新硬盘，分别为 sdb1 和 sdc1
将这两块硬盘分区并更改分区类型为8e 也就是LVM类型
[root@hbh ~]# pvcreate /dev/sdb1 /dev/sdc1 #将2块硬盘做成2个物理卷 Physical volume &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/8a1acc93f456438d9c655e2beb2b9b99/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-21T11:51:48+08:00" />
<meta property="article:modified_time" content="2021-04-21T11:51:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">LVM配置及磁盘配额</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>LVM配置及磁盘配额</h4> 
 <ul><li><a href="#LVM_1" rel="nofollow">LVM基本概念</a></li><li><ul><li><a href="#LVM_7" rel="nofollow">LVM构成</a></li><li><a href="#LVM_23" rel="nofollow">LVM命令</a></li><li><a href="#LVM_50" rel="nofollow">LVM配置</a></li></ul> 
  </li><li><a href="#_104" rel="nofollow">磁盘配额</a></li><li><ul><li><a href="#_126" rel="nofollow">磁盘配额配置</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="LVM_1"></a>LVM基本概念</h2> 
<p>LVM (Logical Volume Manager)，逻辑卷管理 <br> 在保持现有数据不变的情况下动态的调整磁盘容量，提高磁盘管理的灵活性</p> 
<p>注：/boot分区用于存放引导文件，不能基于LVM创建</p> 
<h3><a id="LVM_7"></a>LVM构成</h3> 
<p><strong>PV物理卷</strong> (Physical Volume)</p> 
<p>物理卷是LVM机制的基本存储设备，通常为一个分区或整个硬盘<br> 创建物理卷时，会在分区或硬盘的头部创建一个保留区块，用于记录 LVM 的属性，并把存储空间分割成默认大小为 4MB 的基本单元（PE），从而构成物理卷</p> 
<p><strong>VG卷组</strong> (Volume Group)</p> 
<p>卷组是由一个或多个物理卷组成的<br> 在卷组中可以动态地添加或移除物理卷</p> 
<p><strong>LV逻辑卷</strong> (Logical Volume)<br> 从卷组中分割出的一块空间，形成逻辑卷</p> 
<p><img src="https://images2.imgbox.com/44/cd/pq5TOwbJ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="LVM_23"></a>LVM命令</h3> 
<table><thead><tr><th>功能</th><th>PV</th><th>VG</th><th>LV</th></tr></thead><tbody><tr><td>Scan（扫描）</td><td>pvscan</td><td>vgscan</td><td>lvscan</td></tr><tr><td><strong>Create（建立）</strong></td><td>pvcreate</td><td>vgcreate</td><td>lvcreate</td></tr><tr><td>Display（显示）</td><td>pvdisplay</td><td>vgdisplay</td><td>lvdisplay</td></tr><tr><td>Remove（移除）</td><td>pvremove</td><td>vgremove</td><td>lvremove</td></tr><tr><td>Extend（扩展）</td><td>-</td><td>vgextend</td><td>lvextend</td></tr><tr><td>Reduce（减少）</td><td>-</td><td>vgreduce</td><td>lvreduce</td></tr></tbody></table> 
<p>建立物理卷PV<br> pvcreate 设备名</p> 
<p>建立卷组VG<br> vgcreate 卷组名 物理卷名1 物理卷名2</p> 
<p>在卷组VG中添加物理卷PV<br> vgextend VG名 设备名</p> 
<p>建立逻辑卷LV<br> lvcreate -L 容量大小 -n 逻辑卷名 卷组名</p> 
<p>逻辑卷LV扩容<br> lvextend -L +大小(不超过卷组最大容量) /dev/卷组名/逻辑卷名</p> 
<h3><a id="LVM_50"></a>LVM配置</h3> 
<p>我们在虚拟机中添加两块10G新硬盘，分别为 sdb1 和 sdc1<br> <img src="https://images2.imgbox.com/ca/e2/4svxnWyh_o.png" alt="在这里插入图片描述"></p> 
<p>将这两块硬盘分区并更改分区类型为8e 也就是LVM类型</p> 
<p><img src="https://images2.imgbox.com/22/7e/aFVyNet7_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/f5/3c/G19kPGvR_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-handlebar">[root@hbh ~]# pvcreate /dev/sdb1 /dev/sdc1   #将2块硬盘做成2个物理卷 
  Physical volume "/dev/sdb1" successfully created.
  Physical volume "/dev/sdc1" successfully created.

[root@hbh ~]# vgcreate vghhh /dev/sdb1 /dev/sdc1  #将两个物理卷做成一个卷组
  Volume group "vghhh" successfully created        卷组名为 vghhh
  
[root@hbh ~]# lvcreate -L 15G -n lvhhh vghhh   # 在卷组中做一个15G的逻辑卷
  Logical volume "lvhhh" created.                逻辑卷名为lvhhh

</code></pre> 
<pre><code class="prism language-handlebar">[root@hbh /dev]# tree -R 
├── vghhh
│   └── lvhhh -&gt; ../dm-0           该逻辑卷文件路径为 /dev/vghhh/lvhhh


[root@hbh ~]# mkfs.xfs /dev/vghhh/lvhhh
格式化该逻辑卷
</code></pre> 
<p>可以使用mount命令挂载该逻辑卷到目录下使用</p> 
<p><img src="https://images2.imgbox.com/57/b2/Ld2Z7Eqn_o.png" alt="在这里插入图片描述"></p> 
<p><strong>扩容</strong><br> 之前说LVM支持动态扩容，我们来试一下</p> 
<pre><code class="prism language-handlebar">[root@hbh ~]# lvextend -L +4G /dev/vghhh/lvhhh    在LV中添加4G容量
  Size of logical volume vghhh/lvhhh changed from 15.00 GiB (3840 extents) to 19.00 GiB (4864 extents).
  Logical volume vghhh/lvhhh successfully resized.

[root@hbh ~]# xfs_growfs /dev/vghhh/lvhhh    刷新文件系统容量，要在挂载时刷新
</code></pre> 
<p><img src="https://images2.imgbox.com/16/a5/LWfYNdsK_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_104"></a>磁盘配额</h2> 
<p>磁盘配额，用来限制磁盘资源的使用</p> 
<p>为了避免在服务器中出现磁盘空间不足的问题，就需要启用磁盘配额功能<br> 对用户在指定文件系统（分区）中使用的磁盘空间、文件数量进行限制<br> 以防止个别用户恶意或无意间占用大量磁盘空间<br> 从而保持系统存储空间的稳定性和持续可用性</p> 
<p>在CentOS系统中，<br> XFS文件系统通过xfs_quota工具进行管理<br> EXT3/4 文件系统通过 quota 工具进行管理</p> 
<p><strong>实施磁盘配额条件</strong><br> 需要Linux内核支持<br> 安装xfsprogs与quota软件包</p> 
<p><strong>Linux磁盘限额的特点</strong><br> 作用范围:针对指定的文件系统（分区)<br> 限制对象:用户帐号、组帐号<br> 限制类型:磁盘容量、文件数量<br> 限制方法:软限制、硬限制</p> 
<h3><a id="_126"></a>磁盘配额配置</h3> 
<p>首先检查是否安装了xfsprogs和quota软件包<br> <img src="https://images2.imgbox.com/f8/e3/19QTwDAA_o.png" alt="在这里插入图片描述"><br> 配额也分为3种<br> uquota(限制普通用户),gquota(限制用户组),pquota(限制项目)<br> 需要用支持磁盘配额的挂载方式挂载</p> 
<blockquote> 
 <p>[root@hbh ~]# mount -o uquota,gquota,pquota /dev/vghhh/lvhhh /opt<br> 这里用的是临时挂载，也可以在 etc/fstab 设置永久挂载</p> 
</blockquote> 
<p><strong>创建用户或组账户进行配额设置</strong><br> <img src="https://images2.imgbox.com/28/bb/c2MScSlH_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>[root@hbh ~]# xfs_quota -x -c ‘limit -u bhard=100M ihard=5 shiyan’ /opt</p> 
 <p>为用户’shiyan’设置配额<br> 设置shiyan用户只能在此文件系统内创建5个文件,并且创建文件的总大小不能超过100M<br> -x 专家模式，只有用了-x后面才能接-c<br> -c 后面接子命令<br> limit 设置配额<br> -u 给用户设置配额，-g给用户组 -p给项目<br> bhard block的硬限制，bsoft为软限制<br> ihard inode的硬限制，isoft为软限制</p> 
</blockquote> 
<p>配额设置好了，查看下用户配额信息</p> 
<p><img src="https://images2.imgbox.com/d6/60/7rvaSYK6_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>运用report子命令，列出文件系统的quota信息<br> 后面也可以接一些选项<br> -u 只显示用户的配额<br> -g 只显示用户组的配额<br> -p 只显示项目的配额<br> -i 只显示inode的配额<br> -b 只显示block的配额<br> -h 人性化显示<br> -a 查看所有可用分区的磁盘容量配额</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/20/2b/iponjzmK_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>也可以在-c后接子命令quota再接选项 -uv 用户名和 -iuv 用户名 查看用户的磁盘容量限制和文件数量限制</p> 
</blockquote> 
<p><strong>验证磁盘配额功能</strong></p> 
<pre><code class="prism language-handlebar">[root@hbh ~]# chmod 777 /opt    shiyan是挂载到opt目录下的，将opt目录权限拉满
[root@hbh ~]# su shiyan    跳转到shiyan用户
[shiyan@hbh /root]$ cd /opt     一定要切换到做了配额的目录下在操作
[shiyan@hbh /opt]$ touch {1..5}.txt   创建5份txt文件
[shiyan@hbh /opt]$ ls
1.txt  2.txt  3.txt  4.txt  5.txt
[shiyan@hbh /opt]$ touch 6.txt       
touch: 无法创建"6.txt": 超出磁盘限额   创建第6份文件失败，因为我们设置的文件数是5

[shiyan@hbh /opt]$ dd if=/dev/zero of=/opt/1.txt bs=10M count=11 
dd: 写入"/opt/1.txt" 出错: 超出磁盘限额   
记录了11+0 的读入   写入第11次失败 因为超过了设置的100M
记录了10+0 的写出   直接默认写入10次
104857600字节(105 MB)已复制，0.0958669 秒，1.1 GB/秒
[shiyan@hbh /opt]$ 

dd 命令是一个设备转换和连续复制命令
“if=” 指定输入设备（或文件）
“of=” 指定输出设备（或文件）
“bs=” 指定读取数据块的大小
“count=” 指定读取数据块的数量
/dev/zero “零”设备文件，可以无限的提供空字符。常用来生成一个特定大小的文件

</code></pre> 
<p><strong>如何关闭配额设置</strong></p> 
<p>停止配额<br> xfs_quota -x -c ‘off -u’ /opt<br> 子选项<br> -u -g -p</p> 
<p>删除配额<br> xfs_quota -x -c ‘remove -u’ /opt<br> 子选项<br> -u -g -p</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/839c3587c3e6d61171f5c649939eeac6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Quartz执行逻辑（七）任务的暂停和恢复</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e22c75f67cc71ff7dba4077923ecf9a1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">netcat和shell反弹测试</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>