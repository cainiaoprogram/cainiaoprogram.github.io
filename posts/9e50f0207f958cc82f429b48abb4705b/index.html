<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux搭建redis真集群(三主三从) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux搭建redis真集群(三主三从)" />
<meta property="og:description" content="1.环境准备 三台服务器，一台服务器一主一从，如果是一台服务器，那是伪集群
2.解压 tar xzf redis-5.0.7.tar.gz
3.进入解压后的目录 cd redis-5.0.7
4.输入make命令 注:如果没有make命令需要下载yum -y install gcc ，因为make install命令需要此环境
make install PREFIX=/home/redis-5.0.7/redis-cluster
5.进入到redis-cluster文件夹下面，把bin改成7000，把redis-5.0.7里面的配置文件redis.conf复制到7000里面 cp /home/redis-5.0.7/redis.conf /home/redis-5.0.7/redis-cluster/7000/
6.修改配置文件 6.1修改bind 地址 6.2把端口从6379，修改成7000 6.3指定日志文件路径 6.4指定rdb、apf文件写入路径 6.5持久化配置 6.6开启集群 6.7集群配置文件名称 6.8超时时间 6.9连接主节点密码，各个节点访问密码(暂不设置密码) 6.10守护线程模式 6.11关闭保护模式用于公网访问 7.启动redis两个端口 回到/home/redis-5.0.7/src
./redis-server /home/redis-5.0.7/redis-cluster/7000/redis.conf &amp;
./redis-server /home/redis-5.0.7/redis-cluster/7001/redis.conf &amp;
ps -ef | grep redis
把另外两台服务器的redis也按照此步骤进行配置和启动，最后应该三台服务器应该是这样的
8.创建集群 ./src/redis-cli --cluster create IP:端口 IP:端口 IP:端口 --cluster-replicas 0
执行之后会提示，可以设置上述配置嘛，这块输入yes即可，三个主节点建立完成
9.查看集群 master是主节点
10.测试集群效果
10.1模拟主节点宕机操作 把服务器里的6380主节点进程干掉
现在服务器只有一个6381从节点进程，启动6380端口，去看集群6381端口是否变成了主节点
可以看到，6381端口已经变成了master
主从验证成功
11.设置密码 进入到redis节点，config set masterauth 123456" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9e50f0207f958cc82f429b48abb4705b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-02T14:16:32+08:00" />
<meta property="article:modified_time" content="2023-06-02T14:16:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux搭建redis真集群(三主三从)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>1.环境准备</h2> 
<p>        三台服务器，一台服务器一主一从，如果是一台服务器，那是伪集群</p> 
<h2>2.解压</h2> 
<p>        tar xzf redis-5.0.7.tar.gz</p> 
<h2>3.进入解压后的目录</h2> 
<p>        cd redis-5.0.7</p> 
<h2>4.输入make命令</h2> 
<p>注:如果没有make命令需要下载yum -y install gcc ，因为make install命令需要此环境</p> 
<p>make install PREFIX=/home/redis-5.0.7/redis-cluster</p> 
<p><img alt="" height="334" src="https://images2.imgbox.com/9c/db/sYl5K3xq_o.png" width="974"></p> 
<h2>5.进入到redis-cluster文件夹下面，把bin改成7000，把redis-5.0.7里面的配置文件redis.conf复制到7000里面</h2> 
<p> <img alt="" height="130" src="https://images2.imgbox.com/0e/e7/g79MlZK6_o.png" width="563"></p> 
<p> cp /home/redis-5.0.7/redis.conf /home/redis-5.0.7/redis-cluster/7000/</p> 
<h2>6.修改配置文件</h2> 
<h3>6.1修改bind 地址</h3> 
<p><img alt="" height="99" src="https://images2.imgbox.com/63/2e/mMZiOn27_o.png" width="882"></p> 
<h3>6.2把端口从6379，修改成7000</h3> 
<p><img alt="" height="162" src="https://images2.imgbox.com/eb/63/EH9AJpkx_o.png" width="758"></p> 
<h3> 6.3指定日志文件路径</h3> 
<p><img alt="" height="304" src="https://images2.imgbox.com/66/12/aushW0ca_o.png" width="944"></p> 
<h3> 6.4指定rdb、apf文件写入路径</h3> 
<p><img alt="" height="150" src="https://images2.imgbox.com/01/e1/pWG513UL_o.png" width="796"></p> 
<h3>6.5持久化配置</h3> 
<p><img alt="" height="174" src="https://images2.imgbox.com/b5/39/6AADeYr2_o.png" width="798"></p> 
<h3> 6.6开启集群</h3> 
<p><img alt="" height="265" src="https://images2.imgbox.com/f6/53/zV2FrYkt_o.png" width="804"></p> 
<h3> 6.7集群配置文件名称</h3> 
<p><img alt="" height="224" src="https://images2.imgbox.com/e0/19/pzV8gKGi_o.png" width="774"></p> 
<h3>6.8超时时间</h3> 
<p><img alt="" height="150" src="https://images2.imgbox.com/2c/75/vsDIWYmp_o.png" width="670"></p> 
<h3>6.9连接主节点密码，各个节点访问密码(暂不设置密码)</h3> 
<p><img alt="" height="146" src="https://images2.imgbox.com/b1/bc/uymcvb7u_o.png" width="552"></p> 
<p> <img alt="" height="166" src="https://images2.imgbox.com/a3/ea/fs5CBBCQ_o.png" width="610"></p> 
<h3> 6.10守护线程模式<img alt="" height="156" src="https://images2.imgbox.com/af/48/jweepcbp_o.png" width="863"></h3> 
<h3> 6.11关闭保护模式用于公网访问</h3> 
<p><img alt="" height="209" src="https://images2.imgbox.com/0c/27/xhCbzgBc_o.png" width="843"></p> 
<h2>7.启动redis两个端口 </h2> 
<p>回到/home/redis-5.0.7/src</p> 
<p>./redis-server /home/redis-5.0.7/redis-cluster/7000/redis.conf &amp;</p> 
<p>./redis-server /home/redis-5.0.7/redis-cluster/7001/redis.conf &amp;</p> 
<p>ps -ef | grep redis</p> 
<p><img alt="" height="162" src="https://images2.imgbox.com/2e/b3/agATq7HJ_o.png" width="1200"></p> 
<p>把另外两台服务器的redis也按照此步骤进行配置和启动，最后应该三台服务器应该是这样的</p> 
<p><img alt="" height="117" src="https://images2.imgbox.com/7d/b5/uivmjpCm_o.png" width="1142"></p> 
<p><img alt="" height="117" src="https://images2.imgbox.com/89/cc/KwQM89zk_o.png" width="1127"></p> 
<h2><img alt="" height="145" src="https://images2.imgbox.com/10/90/tgDn50hI_o.png" width="1123"> 8.创建集群</h2> 
<p>./src/redis-cli --cluster create IP:端口 IP:端口 IP:端口 --cluster-replicas 0<img alt="" height="161" src="https://images2.imgbox.com/e3/30/lwTXQxFx_o.png" width="1200"></p> 
<p> 执行之后会提示，可以设置上述配置嘛，这块输入yes即可，三个主节点建立完成</p> 
<p><img alt="" height="772" src="https://images2.imgbox.com/eb/37/PCq85RLO_o.png" width="1200"></p> 
<h2>9.查看集群</h2> 
<p style="margin-left:.0001pt;text-align:justify;">master是主节点</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="202" src="https://images2.imgbox.com/1a/af/rdZkuYpY_o.png" width="1200"></p> 
<p> 10<strong>.测试集群效果</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h4 style="text-align:justify;"><strong>10.1模拟主节点宕机操作</strong></h4> 
<p><img alt="" height="363" src="https://images2.imgbox.com/4c/0b/NmrJaNej_o.png" width="1200"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">把服务器里的6380主节点进程干掉</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="301" src="https://images2.imgbox.com/8c/b7/8Vbxvm86_o.png" width="1063"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">现在服务器只有一个6381从节点进程，启动6380端口，去看集群6381端口是否变成了主节点</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="325" src="https://images2.imgbox.com/2b/ef/LYpVGdWa_o.png" width="1084"></p> 
<p> 可以看到，6381端口已经变成了master</p> 
<p><img alt="" height="205" src="https://images2.imgbox.com/00/50/BgHsnBGh_o.png" width="1200">主从验证成功</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 style="text-align:justify;"><strong>11.设置密码</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">进入到redis节点，config set masterauth 123456</p> 
<p style="margin-left:.0001pt;text-align:justify;">config set requirepass 123456</p> 
<p style="margin-left:.0001pt;text-align:justify;">auth 123456(如果不执行此步骤，会报(error) NOAUTH Authentication required)</p> 
<p style="margin-left:.0001pt;text-align:justify;">config rewrite</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="295" src="https://images2.imgbox.com/c2/77/bUoFtjO5_o.png" width="884">每个节点都得设置密码，密码必须一样，此方法设置密码也不用重启，而且能动态去改变密码，而不是在redis.conf里面把密码写死，把每个节点都设置一遍即可</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">取消密码</p> 
<p style="margin-left:.0001pt;text-align:justify;">config set masterauth ""</p> 
<p style="margin-left:.0001pt;text-align:justify;">config set requirepass ""</p> 
<h3 style="text-align:justify;"><strong>12.集群命令</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">./src/redis-cli -h 192.168.99.227 -p 6380 -a 123456 -c</p> 
<p style="margin-left:.0001pt;text-align:justify;">这个提示是警告：在命令行界面上使用带有“-a”或“-u”选项的密码可能不安全。忽略就可以</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="123" src="https://images2.imgbox.com/90/c0/iBc4E5Ft_o.png" width="1089"></p> 
<p>在redis命令行，查看集群状态</p> 
<p style="margin-left:.0001pt;text-align:justify;">cluster nodes</p> 
<p style="margin-left:.0001pt;text-align:justify;">借鉴大佬文档在下面链接</p> 
<p style="margin-left:.0001pt;text-align:justify;"><a href="https://blog.csdn.net/xiefazhi123/article/details/119147657?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-1-119147657-blog-123268488.235%5Ev36%5Epc_relevant_default_base3&amp;spm=1001.2101.3001.4242.2&amp;utm_relevant_index=4" title="Redis搭建集群，三主三从集群模式_redis三主三从集群_xiefazhi123的博客-CSDN博客">Redis搭建集群，三主三从集群模式_redis三主三从集群_xiefazhi123的博客-CSDN博客</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c4fbf0c8156d05a50977ee06837d9548/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">NUC980编译错误，arm-linux-gcc: Command not found</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5ada5d88fa73274f74b4a2ef3ef5b6bb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">用C&#43;&#43;实现8皇后问题&#43;代码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>