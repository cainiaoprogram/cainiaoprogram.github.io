<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>个人微信api接口java调用代码 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="个人微信api接口java调用代码" />
<meta property="og:description" content="个人微信api接口java调用代码
1、微信好友收发消息
/**
* 给微信好友发消息
* @author wechatno:tangjinjinwx
* @blog http://www.wlkankan.cn
*/
@Async
public void handleMsg(ChannelHandlerContext ctx, TransportMessage vo, String contentJsonStr) {
try {
log.debug(contentJsonStr);
TalkToFriendTaskMessage.Builder bd = TalkToFriendTaskMessage.newBuilder();
JsonFormat.parser().merge(contentJsonStr, bd);
TalkToFriendTaskMessage req = bd.build();
// 消息记录数据库
asyncTaskService.savePcMessage(req);
// 将消息转发送给手机客户端
asyncTaskService.msgSend2Phone(ctx, req.getWeChatId(), EnumMsgType.TalkToFriendTask, vo, req);
} catch (Exception e) {
e.printStackTrace();
MessageUtil.sendJsonErrMsg(ctx, EnumErrorCode.InvalidParam, Constant.ERROR_MSG_DECODFAIL);
}
}
/**
* 微信好友发来聊天消息通知
* @author wechatno:tangjinjinwx
* @blog http://www.wlkankan.cn
*/
@Async
public void handleMsg(ChannelHandlerContext ctx, TransportMessage vo) {" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/6a810ef5b50658d2d9d48d6f1d534787/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-15T10:07:28+08:00" />
<meta property="article:modified_time" content="2020-12-15T10:07:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">个人微信api接口java调用代码</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>个人微信api接口java调用代码</p> 
<p>1、微信好友收发消息<br>         /**<br>      * 给微信好友发消息<br>      * @author wechatno:tangjinjinwx<br>      * @blog http://www.wlkankan.cn<br>      */<br>     @Async<br>     public void handleMsg(ChannelHandlerContext ctx, TransportMessage vo, String contentJsonStr) {<!-- --><br>         try {<!-- --><br>             log.debug(contentJsonStr);<br>             TalkToFriendTaskMessage.Builder bd = TalkToFriendTaskMessage.newBuilder();<br>             JsonFormat.parser().merge(contentJsonStr, bd);<br>             TalkToFriendTaskMessage req = bd.build();<br>             // 消息记录数据库<br>             asyncTaskService.savePcMessage(req);<br>             // 将消息转发送给手机客户端<br>             asyncTaskService.msgSend2Phone(ctx, req.getWeChatId(), EnumMsgType.TalkToFriendTask, vo, req);</p> 
<p>        } catch (Exception e) {<!-- --><br>             e.printStackTrace();<br>             MessageUtil.sendJsonErrMsg(ctx, EnumErrorCode.InvalidParam, Constant.ERROR_MSG_DECODFAIL);<br>         }<br>     }</p> 
<p> <br>     /**<br>      * 微信好友发来聊天消息通知<br>      * @author wechatno:tangjinjinwx<br>          * @blog http://www.wlkankan.cn<br>      */<br>     @Async<br>     public void handleMsg(ChannelHandlerContext ctx, TransportMessage vo) {<!-- --><br>         try {<!-- --><br>             FriendTalkNoticeMessage req = vo.getContent().unpack(FriendTalkNoticeMessage.class);<br>             log.debug(JsonFormat.printer().print(req));<br>             <br>             log.debug(LocalDateTime.now()+" 微信好友发来聊天消息  对应的线程名: "+Thread.currentThread().getName());<br>               <br>             //拦截消息<br>             asyncTaskService.msgAopTask(ctx,req,vo.getAccessToken(), vo.getId());<br>             //消息转发到pc端<br>             asyncTaskService.msgSend2pc(req.getWeChatId(), EnumMsgType.FriendTalkNotice, req);<br>              <br>             // 告诉客户端消息已收到<br>             MessageUtil.sendMsg(ctx, EnumMsgType.MsgReceivedAck, vo.getAccessToken(), vo.getId(), null);<br>             <br>             WxAccountInfo account = weChatAccountService.findWeChatAccountInfoByWeChatId(req.getWeChatId());<br>             //消息记录数据库<br>             if (null != account){<!-- --><br>                 asyncTaskService.saveMessage(account, req);<br>             }<br>              <br>         } catch (Exception e) {<!-- --><br>             e.printStackTrace();<br>             MessageUtil.sendErrMsg(ctx, EnumErrorCode.InvalidParam,vo.getId(), e.getMessage());<br>         }<br>     }</p> 
<p>2、触发手机推送微信好友列表及返回<br>         /**<br>      * 触发手机推送微信好友列表<br>      * @author wechatno:tangjinjinwx<br>      * @blog http://www.wlkankan.cn<br>      */<br>     @Async<br>     public  void handleMsg(ChannelHandlerContext ctx,TransportMessage vo, String contentJsonStr) {<!-- --><br>         try {<!-- --><br>             log.debug(contentJsonStr);<br>             TriggerFriendPushTaskMessage.Builder bd = TriggerFriendPushTaskMessage.newBuilder();<br>             JsonFormat.parser().merge(contentJsonStr, bd);<br>             TriggerFriendPushTaskMessage req = bd.build();<br>             //TriggerFriendPushTaskMessage req = vo.getContent().unpack(TriggerFriendPushTaskMessage.class);<br>             <br>             //将消息转发送给手机客户端<br>             asyncTaskService.msgSend2Phone(ctx, req.getWeChatId(), EnumMsgType.TriggerFriendPushTask, vo, req);<br>         } catch (Exception e) {<!-- --><br>             e.printStackTrace();<br>             MessageUtil.sendJsonErrMsg(ctx, EnumErrorCode.InvalidParam, Constant.ERROR_MSG_DECODFAIL);<br>         }<br>     }</p> 
<p><br>     /**<br>      * 微信好友列表消息推送<br>      * @author wechatno:tangjinjinwx<br>          * @blog http://www.wlkankan.cn<br>      */<br>     @Async<br>     public void handleMsg(ChannelHandlerContext ctx, TransportMessage vo) {<!-- --><br>         try {<!-- --><br>             FriendPushNoticeMessage req = vo.getContent().unpack(FriendPushNoticeMessage.class);<br>             log.debug(JsonFormat.printer().print(req));<br>             // 把消息转发给pc端<br>             asyncTaskService.msgSend2pc(req.getWeChatId(), EnumMsgType.FriendPushNotice, req);<br>              <br>             // 异步保存到数据库<br>             asyncTaskService.friendListSave(req);<br>              <br>             // 告诉客户端消息已收到<br>             MessageUtil.sendMsg(ctx, EnumMsgType.MsgReceivedAck, vo.getAccessToken(), vo.getId(), null);</p> 
<p>        } catch (Exception e) {<!-- --><br>             e.printStackTrace();<br>             MessageUtil.sendErrMsg(ctx, EnumErrorCode.InvalidParam, vo.getId(), Constant.ERROR_MSG_DECODFAIL);<br>         }<br>     }</p> 
<p>3、触发推送微信群聊列表及返回<br>     /**<br>      * 触发推送微信群聊列表<br>      * @author wechatno:tangjinjinwx<br>      * @blog http://www.wlkankan.cn<br>      */<br>     @Async<br>     public void handleMsg(ChannelHandlerContext ctx, TransportMessage vo, String contentJsonStr) {<!-- --><br>         try {<!-- --><br>             log.debug(contentJsonStr);<br>             TriggerChatRoomPushTaskMessage.Builder bd = TriggerChatRoomPushTaskMessage.newBuilder();<br>             JsonFormat.parser().merge(contentJsonStr, bd);<br>             TriggerChatRoomPushTaskMessage req = bd.build();<br>             // 将消息转发送给手机客户端<br>             asyncTaskService.msgSend2Phone(ctx, req.getWeChatId(), EnumMsgType.TriggerChatroomPushTask, vo, req);<br>         } catch (Exception e) {<!-- --><br>             e.printStackTrace();<br>             MessageUtil.sendJsonErrMsg(ctx, EnumErrorCode.InvalidParam, Constant.ERROR_MSG_DECODFAIL);<br>         }<br>     }</p> 
<p>    /**<br>      * 推送微信群聊列表<br>      * @author wechatno:tangjinjinwx<br>          * @blog http://www.wlkankan.cn<br>      */<br>     @Async<br>     public  void handleMsg(ChannelHandlerContext ctx, TransportMessage vo) {<!-- --><br>         try {<!-- --><br>             ChatRoomPushNoticeMessage req = vo.getContent().unpack(ChatRoomPushNoticeMessage.class);<br>             log.debug(JsonFormat.printer().print(req));<br>             <br>             asyncTaskService.msgSend2pc(req.getWeChatId(), EnumMsgType.ChatroomPushNotice, req);<br>              <br>             asyncTaskService.qunListSave(req);<br>               <br>             // 告诉客户端消息已收到<br>             MessageUtil.sendMsg(ctx, EnumMsgType.MsgReceivedAck, vo.getAccessToken(), vo.getId(), null);<br>         } catch (Exception e) {<!-- --><br>             e.printStackTrace();<br>             MessageUtil.sendErrMsg(ctx, EnumErrorCode.InvalidParam,vo.getId(), Constant.ERROR_MSG_DECODFAIL);<br>         }<br>     }</p> 
<p>4、推送微信朋友圈、发朋友圈<br>         /**<br>      * 触发推送朋友圈列表<br>      * @author wechatno:tangjinjinwx <br>      * startTime传秒<br>      * @blog http://www.wlkankan.cn<br>      */<br>     @Async<br>     public void handleMsg(ChannelHandlerContext ctx, TransportMessage vo, String contentJsonStr) {<!-- --><br>         try {<!-- --><br>             log.debug(contentJsonStr);<br>             TriggerCirclePushTaskMessage.Builder bd = TriggerCirclePushTaskMessage.newBuilder();<br>             JsonFormat.parser().merge(contentJsonStr, bd);<br>             TriggerCirclePushTaskMessage req = bd.build();<br>             // TriggerCirclePushTaskMessage req =<br>             // vo.getContent().unpack(TriggerCirclePushTaskMessage.class);<br>             // 将消息转发送给手机客户端<br>             asyncTaskService.msgSend2Phone(ctx, req.getWeChatId(), EnumMsgType.TriggerCirclePushTask, vo, req);<br>         } catch (Exception e) {<!-- --><br>             e.printStackTrace();<br>             MessageUtil.sendJsonErrMsg(ctx, EnumErrorCode.InvalidParam, Constant.ERROR_MSG_DECODFAIL);<br>         }<br>     }</p> 
<p>        /**<br>      * 回传手机微信朋友圈数据<br>      * @author wechatno:tangjinjinwx<br>          * @blog http://www.wlkankan.cn<br>      */<br>     @Async<br>     public  void handleMsg(ChannelHandlerContext ctx, TransportMessage vo) {<!-- --><br>         try {<!-- --><br>             CirclePushNoticeMessage req = vo.getContent().unpack(CirclePushNoticeMessage.class);<br>             log.debug(JsonFormat.printer().print(req));<br>             //把消息转发给pc端<br>             asyncTaskService.msgSend2pc(req.getWeChatId(), EnumMsgType.CirclePushNotice, req);<br>             <br>             //保存朋友圈信息<br>             asyncTaskService.asyncSaveCircleMsg(req, circleService, weChatContactService);<br>             <br>             //告诉客户端消息已收到<br>             MessageUtil.sendMsg(ctx, EnumMsgType.MsgReceivedAck, vo.getAccessToken(), vo.getId(), null);<br>         } catch (Exception e) {<!-- --><br>             e.printStackTrace();<br>             MessageUtil.sendErrMsg(ctx, EnumErrorCode.InvalidParam,vo.getId(), Constant.ERROR_MSG_DECODFAIL);<br>         }<br>     }</p> 
<p>    /**<br>      * 发微信朋友圈<br>      * @author wechatno:tangjinjinwx<br>      * @blog http://www.wlkankan.cn<br>      */</p> 
<p>    @Async<br>     public  void handleMsg(ChannelHandlerContext ctx,TransportMessage vo, String contentJsonStr) {<!-- --><br>         try {<!-- --><br>             log.debug(contentJsonStr);<br>             PostSNSNewsTaskMessage.Builder bd = PostSNSNewsTaskMessage.newBuilder();<br>             JsonFormat.parser().merge(contentJsonStr, bd);<br>             PostSNSNewsTaskMessage req = bd.build();<br>             //PostSNSNewsTaskMessage req = vo.getContent().unpack(PostSNSNewsTaskMessage.class);<br>               <br>             asyncTaskService.msgSend2Phone(ctx, req.getWeChatId(), EnumMsgType.PostSNSNewsTask, vo, req);<br>         } catch (Exception e) {<!-- --><br>             e.printStackTrace();<br>             MessageUtil.sendJsonErrMsg(ctx, EnumErrorCode.InvalidParam, Constant.ERROR_MSG_DECODFAIL);<br>         }<br>     }</p> 
<p>5、加好友及通过好友请求</p> 
<p>        /** <br>      * 微信自动添加好友<br>      * @author wechatno:tangjinjinwx<br>          * @blog http://www.wlkankan.cn<br>      */<br>     @Async<br>     public  void handleMsg(ChannelHandlerContext ctx ,TransportMessage vo, String contentJsonStr) {<!-- --><br>         try {<!-- --><br>             log.debug(contentJsonStr);<br>             FriendAddTaskSetting  req =  JSON.parseObject(contentJsonStr,FriendAddTaskSetting.class);<br>             if(null != req){<!-- --><br>                 String resp ="fail";<br>                  <br>                 resp = friendAddTaskService.savePcTask(req);<br>                  <br>                 //3、告诉PC客户端消息已收到<br>                 MessageUtil.sendCustomJsonMsg(ctx, "AutoFriendAddTaskResp", resp);<br>                 <br>             } <br>         } catch (Exception e) {<!-- --><br>             e.printStackTrace();<br>             MessageUtil.sendJsonErrMsg(ctx, EnumErrorCode.InvalidParam, Constant.ERROR_MSG_DECODFAIL);<br>         }<br>     }</p> 
<p><br>         /**<br>      * 微信新增好友通知<br>      * @author wechatno:tangjinjinwx<br>          * @blog http://www.wlkankan.cn<br>      */<br>     @Async<br>     public  void handleMsg(ChannelHandlerContext ctx, TransportMessage vo) {<!-- --><br>         try {<!-- --><br>             FriendAddNoticeMessage req = vo.getContent().unpack(FriendAddNoticeMessage.class);<br>              <br>             //把消息转发给pc端<br>             asyncTaskService.msgSend2pc(req.getWeChatId(), EnumMsgType.FriendAddNotice, req);<br>             <br>             //保存新增好友<br>             asyncTaskService.saveFriendAddContactinfo(req);<br>             <br>             //告诉客户端消息已收到<br>             MessageUtil.sendMsg(ctx, EnumMsgType.MsgReceivedAck, vo.getAccessToken(), vo.getId(), null);<br>               <br>              <br>         } catch (Exception e) {<!-- --><br>             e.printStackTrace();<br>             MessageUtil.sendErrMsg(ctx, EnumErrorCode.InvalidParam,vo.getId(), Constant.ERROR_MSG_DECODFAIL);<br>         }<br>     }</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a065894f8e8b397beca2397ff05735f2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python实现多个pdf文件合并</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ccd5c413f21a00725dd13f56b9943324/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SPI通讯协议必备知识。</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>