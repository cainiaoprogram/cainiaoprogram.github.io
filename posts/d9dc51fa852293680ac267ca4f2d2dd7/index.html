<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于Vue&#43;SpringCloudAlibaba微服务电商项目实战-016：构建微服务电商项目智能报警系统替代elk分布式日志收集 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="基于Vue&#43;SpringCloudAlibaba微服务电商项目实战-016：构建微服务电商项目智能报警系统替代elk分布式日志收集" />
<meta property="og:description" content="016：构建微服务电商项目智能报警系统替代elk分布式日志收集 1 微服务智能报警系统实现效果演示2 微服务智能报警系统设计原理3 分布式日志采集系统模块分析4 基于全局捕获异常将日志投递到MQ服务器端中5 定义MQ消费者将错误日志统一写入数据库db中6 定义微信消息推送错误日志模板接口7 分布式日志采集报警系统流程测试 1 微服务智能报警系统实现效果演示 今日课程任务
构建企业级微服务智能报警系统产生背景微服务智能报警系统与elk的区别有那些智能报警系统整体架构实现原理构建Aop拦截系统错误日志写入kafka中构建消费者获取kafka异常日志消息调用微信模板实现智能报警系统 2 微服务智能报警系统设计原理 分布式日志采集系统elk
“ELK”是三个开源项目的首字母缩写，这三个项目分别是：Elasticsearch、Logstash 和 Kibana。
Elasticsearch 是一个搜索和分析引擎。
Logstash 是服务器端数据处理管道，能够同时从多个来源采集数据，转换数据，然后将数据发送到诸如 Elasticsearch 等“存储库”中。
Kibana 则可以让用户在 Elasticsearch 中使用图形和图表对数据进行可视化。
传统的elk日志存在哪些缺陷？
搜索日志成本时间长，不如出现错误/异常主动上报自动报警功能的预警系统。
微服务智能报警系统设计思想
主动上报错误日志，用户调用接口如果出现错误异常的情况下，都会主动提醒给开发者。可以使用第三方可视化界面管理分析日志。 3 分布式日志采集系统模块分析 分布式日志采集系统mt_log分析思路
采用全局或者Aop捕获当前系统出现的异常，将错误的信息转换成json内容投递到MQ服务端；定义消费者获取MQ中错误的日志，将错误日志持久化到es/mongodb/数据库中；采用主动上报的形式，将错误日志以消息模板或者短信/邮件推送给开发者，减少搜索日志成本；可以采用web系统可以直接对数据库的日志实现图像报表的分析。
模块构建
mt-shop-service-log-aop --采用全局或者AOP捕获当前系统出现的异常/错误
mt-shop-service-log-mqconsumer --消费者获取MQ中错误的日志，将错误日志持久化到es/mongodb/数据库中，消费者一定要集群加速写日志
mt-shop-service-log-web --对数据库的日志实现图像报表的分析
4 基于全局捕获异常将日志投递到MQ服务器端中 全局捕获异常获取详细方法错误信息参数分析
系统打印的Exception记录包含出现异常代码的类、接口等相关信息，请求参数从HttpServletRequest中获取
分布式日志采集数据库表结构分析
数据库记录错误日志表
CREATE TABLE `mt_error_log` ( `message_id` varchar(255) NOT NULL DEFAULT &#39;&#39;, `service_id` varchar(30) DEFAULT NULL, `class_name` varchar(255) DEFAULT NULL, `method_name` varchar(255) DEFAULT NULL, `parameter_content` varchar(255) DEFAULT NULL, `errorContent` varchar(255) DEFAULT NULL, `create_time` datetime DEFAULT NULL, `line_number` int(11) DEFAULT NULL, `server_ip` varchar(255) DEFAULT NULL ) ENGINE=InnoDB DEFAULT CHARSET=utf8; message_id作为主键id可以防止mq重试导致插入相同的数据，从而调用两次模板消息推送，解决MQ消费者幂等性问题。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/d9dc51fa852293680ac267ca4f2d2dd7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-13T22:26:43+08:00" />
<meta property="article:modified_time" content="2021-07-13T22:26:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于Vue&#43;SpringCloudAlibaba微服务电商项目实战-016：构建微服务电商项目智能报警系统替代elk分布式日志收集</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>016：构建微服务电商项目智能报警系统替代elk分布式日志收集</h4> 
 <ul><li><ul><li><a href="#1__2" rel="nofollow">1 微服务智能报警系统实现效果演示</a></li><li><a href="#2__12" rel="nofollow">2 微服务智能报警系统设计原理</a></li><li><a href="#3__27" rel="nofollow">3 分布式日志采集系统模块分析</a></li><li><a href="#4_MQ_40" rel="nofollow">4 基于全局捕获异常将日志投递到MQ服务器端中</a></li><li><a href="#5_MQdb_116" rel="nofollow">5 定义MQ消费者将错误日志统一写入数据库db中</a></li><li><a href="#6__212" rel="nofollow">6 定义微信消息推送错误日志模板接口</a></li><li><a href="#7__297" rel="nofollow">7 分布式日志采集报警系统流程测试</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="1__2"></a>1 微服务智能报警系统实现效果演示</h3> 
<p><strong>今日课程任务</strong></p> 
<ol><li>构建企业级微服务智能报警系统产生背景</li><li>微服务智能报警系统与elk的区别有那些</li><li>智能报警系统整体架构实现原理</li><li>构建Aop拦截系统错误日志写入kafka中</li><li>构建消费者获取kafka异常日志消息</li><li>调用微信模板实现智能报警系统</li></ol> 
<h3><a id="2__12"></a>2 微服务智能报警系统设计原理</h3> 
<p><strong>分布式日志采集系统elk</strong><br> “ELK”是三个开源项目的首字母缩写，这三个项目分别是：Elasticsearch、Logstash 和 Kibana。<br> Elasticsearch 是一个搜索和分析引擎。<br> Logstash 是服务器端数据处理管道，能够同时从多个来源采集数据，转换数据，然后将数据发送到诸如 Elasticsearch 等“存储库”中。<br> Kibana 则可以让用户在 Elasticsearch 中使用图形和图表对数据进行可视化。</p> 
<p><strong>传统的elk日志存在哪些缺陷？</strong><br> 搜索日志成本时间长，不如出现错误/异常主动上报自动报警功能的预警系统。</p> 
<p><strong>微服务智能报警系统设计思想</strong></p> 
<ol><li>主动上报错误日志，用户调用接口如果出现错误异常的情况下，都会主动提醒给开发者。</li><li>可以使用第三方可视化界面管理分析日志。</li></ol> 
<h3><a id="3__27"></a>3 分布式日志采集系统模块分析</h3> 
<p><strong>分布式日志采集系统mt_log分析思路</strong></p> 
<ol><li>采用全局或者Aop捕获当前系统出现的异常，将错误的信息转换成json内容投递到MQ服务端；</li><li>定义消费者获取MQ中错误的日志，将错误日志持久化到es/mongodb/数据库中；</li><li>采用主动上报的形式，将错误日志以消息模板或者短信/邮件推送给开发者，减少搜索日志成本；</li><li>可以采用web系统可以直接对数据库的日志实现图像报表的分析。<br> <img src="https://images2.imgbox.com/ce/3e/7EeGHeFL_o.png" alt="在这里插入图片描述"></li></ol> 
<p><strong>模块构建</strong><br> mt-shop-service-log-aop --采用全局或者AOP捕获当前系统出现的异常/错误<br> mt-shop-service-log-mqconsumer --消费者获取MQ中错误的日志，将错误日志持久化到es/mongodb/数据库中，消费者一定要集群加速写日志<br> mt-shop-service-log-web --对数据库的日志实现图像报表的分析</p> 
<h3><a id="4_MQ_40"></a>4 基于全局捕获异常将日志投递到MQ服务器端中</h3> 
<p><strong>全局捕获异常获取详细方法错误信息参数分析</strong><br> 系统打印的Exception记录包含出现异常代码的类、接口等相关信息，请求参数从HttpServletRequest中获取</p> 
<p><strong>分布式日志采集数据库表结构分析<br> 数据库记录错误日志表</strong></p> 
<pre><code>CREATE TABLE `mt_error_log` (
  `message_id` varchar(255) NOT NULL DEFAULT '',
  `service_id` varchar(30) DEFAULT NULL,
  `class_name` varchar(255) DEFAULT NULL,
  `method_name` varchar(255) DEFAULT NULL,
  `parameter_content` varchar(255) DEFAULT NULL,
  `errorContent` varchar(255) DEFAULT NULL,
  `create_time` datetime DEFAULT NULL,
  `line_number` int(11) DEFAULT NULL,
`server_ip` varchar(255) DEFAULT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
</code></pre> 
<p>message_id作为主键id可以防止mq重试导致插入相同的数据，从而调用两次模板消息推送，解决MQ消费者幂等性问题。</p> 
<p>创建mt-shop-service-log-aop模块，会员服务引入该模块依赖即可<br> <strong>PoliceGlobalExceptionHandler</strong></p> 
<pre><code class="prism language-javascript">@ControllerAdvice
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PoliceGlobalExceptionHandler</span> <span class="token keyword">extends</span> <span class="token class-name">BaseApiService</span> <span class="token punctuation">{<!-- --></span>

    @<span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">"${spring.application.name}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String serverIdName<span class="token punctuation">;</span>
    @<span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">"${server.port}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> String serverPort<span class="token punctuation">;</span>

    @Autowired
    <span class="token keyword">private</span> KafkaTemplate<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token operator">&gt;</span> kafkaTemplate<span class="token punctuation">;</span>

    @<span class="token function">ExceptionHandler</span><span class="token punctuation">(</span>RuntimeException<span class="token punctuation">.</span>class<span class="token punctuation">)</span>
    @ResponseBody
    <span class="token keyword">public</span> BaseResponse<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> <span class="token function">errorResult</span><span class="token punctuation">(</span>HttpServletRequest request<span class="token punctuation">,</span> Exception ex<span class="token punctuation">)</span> throws UnknownHostException <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 采用全局捕获异常 拦截系统中的错误，返回友好的提示给客户端</span>
        Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span> String<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> parameterMap <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getParameterMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        StackTraceElement<span class="token punctuation">[</span><span class="token punctuation">]</span> stackTrace <span class="token operator">=</span> ex<span class="token punctuation">.</span><span class="token function">getStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        StackTraceElement stackTraceElement <span class="token operator">=</span> stackTrace<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 转换成json</span>
        JSONObject jsonObject <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>stackTraceElement<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 新增参数内容</span>
        jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"parameterContent"</span><span class="token punctuation">,</span> parameterMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 新增错误日志</span>
        jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"errorContent"</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"serviceId"</span><span class="token punctuation">,</span> serverIdName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"createTime"</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"messageId"</span><span class="token punctuation">,</span> serverIdName <span class="token operator">+</span> <span class="token string">"-"</span> <span class="token operator">+</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取ip地址</span>
        jsonObject<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"serverIp"</span><span class="token punctuation">,</span> <span class="token function">getServerAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 投递到kafka中</span>
        <span class="token function">send</span><span class="token punctuation">(</span>jsonObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">setResultError</span><span class="token punctuation">(</span><span class="token string">"系统错误"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 发送消息的方法
     *
     * @param data 推送数据的data
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span><span class="token parameter">JSONObject data</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// topic 名称 key data 消息数据</span>
        kafkaTemplate<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"mayikt-topic-log"</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> String <span class="token function">getServerAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> throws UnknownHostException <span class="token punctuation">{<!-- --></span>
        InetAddress ip4 <span class="token operator">=</span> Inet4Address<span class="token punctuation">.</span><span class="token function">getLocalHost</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ip4<span class="token punctuation">.</span><span class="token function">getHostAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> serverPort<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="5_MQdb_116"></a>5 定义MQ消费者将错误日志统一写入数据库db中</h3> 
<p><strong>为什么不在AOP类中写日志需要单独通过MQ进行？</strong><br> 主要目的是为了解耦，不影响到主要的业务代码</p> 
<p><strong>创建mt-shop-service-log-mqconsumer模块</strong></p> 
<pre><code class="prism language-javascript">@Data
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ErrorLogEntity</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 服务的id
     */</span>
    <span class="token keyword">private</span> String serviceId<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 类地址
     */</span>
    <span class="token keyword">private</span> String className<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 方法名称
     */</span>
    <span class="token keyword">private</span> String methodName<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 参数内容
     */</span>
    <span class="token keyword">private</span> String parameterContent<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 错误内容
     */</span>
    <span class="token keyword">private</span> String errorContent<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 创建时间
     */</span>
    <span class="token keyword">private</span> Date createTime<span class="token punctuation">;</span>
    <span class="token comment">/**
     * 错误行数
     */</span>
    <span class="token keyword">private</span> int lineNumber<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 消息全局id 主要解决消息幂等问题
     */</span>
    <span class="token keyword">private</span> String messageId<span class="token punctuation">;</span>

    <span class="token keyword">private</span> String serverIp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-javascript"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ErrorLogMapper</span> <span class="token punctuation">{<!-- --></span>


    @<span class="token function">Insert</span><span class="token punctuation">(</span><span class="token string">"INSERT INTO `mt_error_log` VALUES (#{messageId}, #{serviceId}, #{className}, "</span> <span class="token operator">+</span>
            <span class="token string">"#{methodName}, #{parameterContent}, #{errorContent},now(),#{lineNumber},#{serverIp});"</span><span class="token punctuation">)</span>
    int <span class="token function">insertErrorLog</span><span class="token punctuation">(</span>ErrorLogEntity errorLogEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-javascript">@Component
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogConsumer</span> <span class="token punctuation">{<!-- --></span>

    @Autowired
    <span class="token keyword">private</span> ErrorLogMapper errorLogMapper<span class="token punctuation">;</span>

    @<span class="token function">KafkaListener</span><span class="token punctuation">(</span>topics <span class="token operator">=</span> <span class="token string">"mayikt-topic-log"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive</span><span class="token punctuation">(</span>ConsumerRecord<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token operator">&gt;</span> consumer<span class="token punctuation">)</span> throws Exception <span class="token punctuation">{<!-- --></span>
        String json <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span> consumer<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 存放到数据库或者es、mongdb中</span>
        ErrorLogEntity errorLogEntity <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> ErrorLogEntity<span class="token punctuation">.</span>class<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 根据消息的全局id主动查询，如果在数据库中已经存在的情况下 不会执行以下流程</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            int result <span class="token operator">=</span> errorLogMapper<span class="token punctuation">.</span><span class="token function">insertErrorLog</span><span class="token punctuation">(</span>errorLogEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string">"日志插入数据库失败，开始触发MQ重试策略"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token punctuation">}</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-javascript">@SpringBootApplication
@<span class="token function">MapperScan</span><span class="token punctuation">(</span><span class="token string">"com.mayikt.log.mapper"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppLogConsumer</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token parameter">String<span class="token punctuation">[</span><span class="token punctuation">]</span> args</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>AppLogConsumer<span class="token punctuation">.</span>class<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>测试效果：</strong><br> <img src="https://images2.imgbox.com/12/83/KedrPtAR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="6__212"></a>6 定义微信消息推送错误日志模板接口</h3> 
<p><strong>创建消息模板</strong><br> http://mp.weixin.qq.com/debug/cgi-bin/sandboxinfo?action=showinfo&amp;t=sandbox/index<br> <strong>模板内容</strong></p> 
<pre><code>系统服务名称:{<!-- -->{first.DATA}} 
在{<!-- -->{keyword1.DATA}} 出现了错误
服务ip信息：{<!-- -->{keyword2.DATA}}
错误内容：
{<!-- -->{keyword3.DATA}}
</code></pre> 
<p><strong>mt-shop-service-api-weixin</strong></p> 
<pre><code class="prism language-javascript">@Data
@AllArgsConstructor
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ErrorTemplateDto</span> <span class="token punctuation">{<!-- --></span>
    String serviceId<span class="token punctuation">;</span>
    Date errorDate<span class="token punctuation">;</span>
    String errorMsg<span class="token punctuation">;</span>
    String serverIp<span class="token punctuation">;</span>
    String openId<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-javascript"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">WeiXinErrorTemplateService</span> <span class="token punctuation">{<!-- --></span>

    @<span class="token function">PostMapping</span><span class="token punctuation">(</span><span class="token string">"/sendErrorTemplate"</span><span class="token punctuation">)</span>
    BaseResponse<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> <span class="token function">sendErrorTemplate</span><span class="token punctuation">(</span>@RequestBody ErrorTemplateDto errorTemplateDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>mt-shop-service-weixin</strong></p> 
<pre><code class="prism language-javascript">@RestController
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WeiXinErrorTemplateServiceImpl</span> <span class="token keyword">extends</span> <span class="token class-name">BaseApiService</span> <span class="token keyword">implements</span> <span class="token class-name">WeiXinErrorTemplateService</span> <span class="token punctuation">{<!-- --></span>
    @Autowired
    <span class="token keyword">private</span> WxMpProperties wxMpProperties<span class="token punctuation">;</span>

    @Override
    <span class="token keyword">public</span> BaseResponse<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> <span class="token function">sendErrorTemplate</span><span class="token punctuation">(</span><span class="token parameter">ErrorTemplateDto errorTemplateDto</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        String serviceId <span class="token operator">=</span> errorTemplateDto<span class="token punctuation">.</span><span class="token function">getServiceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>serviceId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token function">setResultError</span><span class="token punctuation">(</span><span class="token string">"serviceId不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        Date errorDate <span class="token operator">=</span> errorTemplateDto<span class="token punctuation">.</span><span class="token function">getErrorDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>errorDate <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token function">setResultError</span><span class="token punctuation">(</span><span class="token string">"errorDate不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        String errorMsg <span class="token operator">=</span> errorTemplateDto<span class="token punctuation">.</span><span class="token function">getErrorMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>errorMsg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token function">setResultError</span><span class="token punctuation">(</span><span class="token string">"errorMsg不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        String openId <span class="token operator">=</span> errorTemplateDto<span class="token punctuation">.</span><span class="token function">getOpenId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>openId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token function">setResultError</span><span class="token punctuation">(</span><span class="token string">"openId参数不能为空!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        String serverIp <span class="token operator">=</span> errorTemplateDto<span class="token punctuation">.</span><span class="token function">getServerIp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>serverIp<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token function">setResultError</span><span class="token punctuation">(</span><span class="token string">"serverIp参数不能为空!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        WxMpTemplateMessage wxMpTemplateMessage <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WxMpTemplateMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        wxMpTemplateMessage<span class="token punctuation">.</span>
                <span class="token function">setTemplateId</span><span class="token punctuation">(</span><span class="token string">"0dz6fPAphJ6gtjjp9gtLfWvMgW4F8QDhsTBuoZMGGLY"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        wxMpTemplateMessage<span class="token punctuation">.</span><span class="token function">setToUser</span><span class="token punctuation">(</span>openId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        List<span class="token operator">&lt;</span>WxMpTemplateData<span class="token operator">&gt;</span> data <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WxMpTemplateData</span><span class="token punctuation">(</span><span class="token string">"first"</span><span class="token punctuation">,</span> serviceId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WxMpTemplateData</span><span class="token punctuation">(</span><span class="token string">"keyword1"</span><span class="token punctuation">,</span>
                SimpleDateFormatUtil<span class="token punctuation">.</span><span class="token function">getFormatStrByPatternAndDate</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WxMpTemplateData</span><span class="token punctuation">(</span><span class="token string">"keyword2"</span><span class="token punctuation">,</span> serverIp<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        data<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WxMpTemplateData</span><span class="token punctuation">(</span><span class="token string">"keyword3"</span><span class="token punctuation">,</span> errorMsg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        wxMpTemplateMessage<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span><span class="token string">"http://www.mayikt.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        wxMpTemplateMessage<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            String appId <span class="token operator">=</span> wxMpProperties<span class="token punctuation">.</span><span class="token function">getConfigs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAppId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            WxMpTemplateMsgService templateMsgService <span class="token operator">=</span> WxMpConfiguration<span class="token punctuation">.</span><span class="token function">getMpServices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>appId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTemplateMsgService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            templateMsgService<span class="token punctuation">.</span><span class="token function">sendTemplateMsg</span><span class="token punctuation">(</span>wxMpTemplateMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token function">setResultSuccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token function">setResultError</span><span class="token punctuation">(</span><span class="token string">"发送失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>测试效果：</strong><br> <img src="https://images2.imgbox.com/6b/ed/871R6WMW_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="7__297"></a>7 分布式日志采集报警系统流程测试</h3> 
<p><strong>微信openid表</strong></p> 
<pre><code>CREATE TABLE `sender_contacts` (
  `id` int(11) NOT NULL,
  `wechat_name` varchar(255) DEFAULT NULL,
  `openid` varchar(255) DEFAULT NULL,
  `availability` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;
</code></pre> 
<p>生成二维码链接提供扫码插入该表，记录发送微信模板消息联系人openid信息。</p> 
<p><strong>相关类代码</strong></p> 
<pre><code class="prism language-javascript">@Data
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SenderContactsEntity</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> Long id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String wechatName<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String openId<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String availability<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-javascript"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">SenderContactsMapper</span> <span class="token punctuation">{<!-- --></span>

    @<span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">"SELECT ID AS ID ,wechat_name AS wechatname,openid as openid , availability as availability from sender_contacts  "</span> <span class="token operator">+</span>
            <span class="token string">"where availability='1' "</span><span class="token punctuation">)</span>
    List<span class="token operator">&lt;</span>SenderContactsEntity<span class="token operator">&gt;</span> <span class="token function">getSenderContactsOpenId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-javascript">@<span class="token function">FeignClient</span><span class="token punctuation">(</span><span class="token string">"mayikt-weixin"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">WeiXinErrorTemplateServiceFeign</span> <span class="token keyword">extends</span> <span class="token class-name">WeiXinErrorTemplateService</span> <span class="token punctuation">{<!-- --></span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-javascript">@Component
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LogConsumer</span> <span class="token punctuation">{<!-- --></span>

    @Autowired
    <span class="token keyword">private</span> ErrorLogMapper errorLogMapper<span class="token punctuation">;</span>
    @Autowired
    <span class="token keyword">private</span> WeiXinErrorTemplateServiceFeign weiXinErrorTemplateServiceFeign<span class="token punctuation">;</span>
    @Autowired
    <span class="token keyword">private</span> SenderContactsMapper senderContactsMapper<span class="token punctuation">;</span>

    @<span class="token function">KafkaListener</span><span class="token punctuation">(</span>topics <span class="token operator">=</span> <span class="token string">"mayikt-topic-log"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receive</span><span class="token punctuation">(</span>ConsumerRecord<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token operator">&gt;</span> consumer<span class="token punctuation">)</span> throws Exception <span class="token punctuation">{<!-- --></span>
        String json <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span> consumer<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 存放到数据库或者es、mongdb中</span>
        ErrorLogEntity errorLogEntity <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> ErrorLogEntity<span class="token punctuation">.</span>class<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        String messageId = errorLogEntity.getMessageId();</span>
        <span class="token comment">// 根据消息的全局id主动查询 ，如果在数据库存在的情况下 不会执行以下流程</span>
        <span class="token comment">// 插入到数据库中</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            int result <span class="token operator">=</span> errorLogMapper<span class="token punctuation">.</span><span class="token function">insertErrorLog</span><span class="token punctuation">(</span>errorLogEntity<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Exception</span><span class="token punctuation">(</span><span class="token string">"日志插入数据库失败,开始触发MQ重试策略"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token punctuation">}</span>
            List<span class="token operator">&lt;</span>SenderContactsEntity<span class="token operator">&gt;</span> openIdList <span class="token operator">=</span> senderContactsMapper<span class="token punctuation">.</span><span class="token function">getSenderContactsOpenId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>SenderContactsEntity sd <span class="token operator">:</span>
                    openIdList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 调用微信服务接口 发送消息模板</span>
                String serviceId <span class="token operator">=</span> errorLogEntity<span class="token punctuation">.</span><span class="token function">getServiceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Date createTime <span class="token operator">=</span> errorLogEntity<span class="token punctuation">.</span><span class="token function">getCreateTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                String errorMsg <span class="token operator">=</span> errorLogEntity<span class="token punctuation">.</span><span class="token function">getClassName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">",的"</span> <span class="token operator">+</span> errorLogEntity<span class="token punctuation">.</span><span class="token function">getMethodName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"方法,"</span> <span class="token operator">+</span> errorLogEntity<span class="token punctuation">.</span><span class="token function">getLineNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                        <span class="token operator">+</span> <span class="token string">"行"</span> <span class="token operator">+</span> <span class="token string">"出现了"</span> <span class="token operator">+</span> errorLogEntity<span class="token punctuation">.</span><span class="token function">getErrorContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"异常"</span><span class="token punctuation">;</span>
                ErrorTemplateDto errorTemplateDto <span class="token operator">=</span>
                        <span class="token keyword">new</span> <span class="token class-name">ErrorTemplateDto</span><span class="token punctuation">(</span>serviceId<span class="token punctuation">,</span> createTime<span class="token punctuation">,</span> errorMsg<span class="token punctuation">,</span> errorLogEntity<span class="token punctuation">.</span><span class="token function">getServerIp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sd<span class="token punctuation">.</span><span class="token function">getOpenId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                weiXinErrorTemplateServiceFeign<span class="token punctuation">.</span><span class="token function">sendErrorTemplate</span><span class="token punctuation">(</span>errorTemplateDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>Exception e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>测试效果：</strong><br> <img src="https://images2.imgbox.com/a2/93/pEdKxKsU_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c7cfd652c100ad726d8a39b2a3b91c7f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">图像直方图正规化(Normalization)数学原理和纯C语言实现</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1ab289784926d5e7d0284f35a5f551cd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">消息中间件之ActiveMQ的入门使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>