<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>TrueCrypt原理与系统开发(1)：TrueCrypt Format创建加密卷 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="TrueCrypt原理与系统开发(1)：TrueCrypt Format创建加密卷" />
<meta property="og:description" content="一、概述
TrueCrypt是唯一的一款支持Windows Vista/XP/2000/Linux开源的虚拟加密磁盘软件，能够创建和设置加密的虚拟磁盘镜像，虚拟磁盘可以与其它磁盘一样正常访问，内部所有文件都会自动加密，需要通过密码来进行访问，加密和解密都是实时的。
TrueCrypt主要分为两部分；一部分是TrueCrypt Format，用来创建加密卷，另外一部分是TrueCrypt Mount，用来加载和卸载虚拟磁盘到分区等。
第一部分、TrueCrypt Format创建加密卷
按照TrueCrypt Format创建加密卷的向导，一共会出现加密卷位置，加密算法、加密卷大小、加密卷密码、加密卷格式化等几个步骤，之后就会创建加密卷，创建完的加密卷就是制定的加密卷位置的那个文件了。
因此我们知道TrueCrypt的核心就是创建加密卷函数了，该函数的作用就是接受上述的加密卷位置等几个参数，完成创建加密卷的过程，在TrueCrypt里的原型是
int FormatVolume (char *volumePath, BOOL bDevice, unsigned __int64 size, unsigned __int64 hiddenVolHostSize, Password *password, int cipher, int pkcs5, BOOL quickFormat, BOOL sparseFileSwitch, int fileSystem, int clusterSize, HWND hwndDlg, BOOL hiddenVol, int *realClusterSize, BOOL uac ); 下面我们来看下每个参数具体的含义
参数 类型 含义 示例 volumePath char * 用户选择的加密卷文件 C://1.txt bDevice BOOL 是否是一个分区卷 FALSE size unsigned __int64 加密卷大小（以byte为单位） 10*1024*1024 hiddenVolHostSize unsigned __int64 隐藏加密卷大小（以byte为单位） 0 password Password 用户输入的密码 123456 cipher int 默认加密的算法 1 pkcs5 int 哈希算法 DEFAULT_HASH_ALGORITHM quickFormat BOOL 是否是快速格式化 FALSE sparseFileSwitch BOOL TRUE fileSystem int 文件系统 FILESYS_FAT clusterSize int 0 hwndDlg HWND 传入的窗口句柄 NULL hiddenVol BOOL 是否是隐藏卷 FALSE realClusterSize int 512 uac BOOL FALSE 下面我们来看具体的实例" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/853a1eb3171ed1f87fc40c9a60a5945b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2011-02-14T14:53:00+08:00" />
<meta property="article:modified_time" content="2011-02-14T14:53:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">TrueCrypt原理与系统开发(1)：TrueCrypt Format创建加密卷</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p> </p> 
<p> </p> 
<p>一、概述<br>      TrueCrypt是唯一的一款支持Windows Vista/XP/2000/Linux开源的虚拟加密磁盘软件，能够创建和设置加密的虚拟磁盘镜像，虚拟磁盘可以与其它磁盘一样正常访问，内部所有文件都会自动加密，需要通过密码来进行访问，加密和解密都是实时的。<br>      TrueCrypt主要分为两部分；一部分是TrueCrypt Format，用来创建加密卷，另外一部分是TrueCrypt Mount，用来加载和卸载虚拟磁盘到分区等。</p> 
<p>第一部分、TrueCrypt Format创建加密卷<br>      按照TrueCrypt Format创建加密卷的向导，一共会出现加密卷位置，加密算法、加密卷大小、加密卷密码、加密卷格式化等几个步骤，之后就会创建加密卷，创建完的加密卷就是制定的加密卷位置的那个文件了。</p> 
<p>      因此我们知道TrueCrypt的核心就是创建加密卷函数了，该函数的作用就是接受上述的加密卷位置等几个参数，完成创建加密卷的过程，在TrueCrypt里的原型是</p> 
<p> </p> 
<div class="dp-highlighter nogutter"> 
 <div class="bar"> 
  <div class="tools"> 
   <textarea name="code" class="cpp:nogutter">int FormatVolume (char *volumePath,   
                  BOOL bDevice,   
                  unsigned __int64 size,   
                  unsigned __int64 hiddenVolHostSize,   
                  Password *password,   
                  int cipher,   
                  int pkcs5,   
                  BOOL quickFormat,   
                  BOOL sparseFileSwitch,   
                  int fileSystem,   
                  int clusterSize,   
                  HWND hwndDlg,   
                  BOOL hiddenVol,   
                  int *realClusterSize,   
                  BOOL uac ); </textarea>  
  </div> 
 </div> 
</div> 
<p>      下面我们来看下每个参数具体的含义</p> 
<p> </p> 
<table border="1" cellspacing="0" cellpadding="0"><tbody><tr><td width="142"> 参数</td><td width="142"> 类型</td><td width="200"> 含义</td><td width="142"> 示例</td></tr><tr><td width="142"><span lang="EN-US"> volumePath</span></td><td width="142"><span lang="EN-US"> char *</span></td><td width="200"> 用户选择的加密卷文件</td><td width="142"><span lang="EN-US"> C://1.txt</span></td></tr><tr><td width="142"><span lang="EN-US"> bDevice</span></td><td width="142"><span lang="EN-US"> BOOL</span></td><td width="200"> 是否是一个分区卷</td><td width="142"><span lang="EN-US"> FALSE</span></td></tr><tr><td width="142"><span lang="EN-US"> size</span></td><td width="142"><span lang="EN-US"> unsigned __int64</span></td><td width="200"> 加密卷大小（以byte为单位）</td><td width="142"><span lang="EN-US"> 10*1024*1024</span></td></tr><tr><td width="142"><span lang="EN-US"> hiddenVolHostSize</span></td><td width="142"><span lang="EN-US"> unsigned __int64</span></td><td width="240"> 隐藏加密卷大小（以byte为单位）</td><td width="142"><span lang="EN-US"> 0</span></td></tr><tr><td width="142"><span lang="EN-US"> password</span></td><td width="142"><span lang="EN-US"> Password</span></td><td width="200"> 用户输入的密码</td><td width="142"><span lang="EN-US"> 123456</span></td></tr><tr><td width="142"><span lang="EN-US"> cipher</span></td><td width="142"><span lang="EN-US"> int</span></td><td width="200"> 默认加密的算法</td><td width="142"><span lang="EN-US"> 1</span></td></tr><tr><td width="142"><span lang="EN-US"> pkcs5</span></td><td width="142"><span lang="EN-US"> int</span></td><td width="200"> 哈希算法</td><td width="240"><span lang="EN-US"> DEFAULT_HASH_ALGORITHM</span></td></tr><tr><td width="142"><span lang="EN-US"> quickFormat</span></td><td width="142"><span lang="EN-US"> BOOL</span></td><td width="200"> 是否是快速格式化</td><td width="142"><span lang="EN-US"> FALSE</span></td></tr><tr><td width="142"><span lang="EN-US"> sparseFileSwitch</span></td><td width="142"><span lang="EN-US"> BOOL</span></td><td width="200"><span lang="EN-US">  </span></td><td width="142"><span lang="EN-US"> TRUE</span></td></tr><tr><td width="142"><span lang="EN-US"> fileSystem</span></td><td width="142"><span lang="EN-US"> int</span></td><td width="200"> 文件系统</td><td width="142"><span lang="EN-US"> FILESYS_FAT</span></td></tr><tr><td width="142"><span lang="EN-US"> clusterSize</span></td><td width="142"><span lang="EN-US"> int</span></td><td width="200"><span lang="EN-US">  </span></td><td width="142"><span lang="EN-US"> 0</span></td></tr><tr><td width="142"><span lang="EN-US"> hwndDlg</span></td><td width="142"><span lang="EN-US"> HWND</span></td><td width="200"> 传入的窗口句柄</td><td width="142"><span lang="EN-US"> NULL</span></td></tr><tr><td width="142"><span lang="EN-US"> hiddenVol</span></td><td width="142"><span lang="EN-US"> BOOL</span></td><td width="200"> 是否是隐藏卷</td><td width="142"><span lang="EN-US"> FALSE</span></td></tr><tr><td width="142"><span lang="EN-US"> realClusterSize</span></td><td width="142"><span lang="EN-US"> int</span></td><td width="200"><span lang="EN-US">  </span></td><td width="142"><span lang="EN-US"> 512</span></td></tr><tr><td width="142"><span lang="EN-US"> uac</span></td><td width="142"><span lang="EN-US"> BOOL</span></td><td width="200"><span lang="EN-US">  </span></td><td width="142"><span lang="EN-US"> FALSE</span></td></tr></tbody></table> 
<p> </p> 
<p>      下面我们来看具体的实例</p> 
<p> </p> 
<div class="dp-highlighter nogutter"> 
 <div class="bar"> 
  <div class="tools"> 
   <textarea name="code" class="cpp:nogutter">int Format(char* szFile, unsigned __int64 nsize, char* szPassword, HWND hwndDlg)  
{  
    char szFileName[TC_MAX_PATH+1]; /* The file selected by the user */  
    char szDiskFile[TC_MAX_PATH+1]; /* Fully qualified name derived from szFileName */  
    BOOL bDevice = FALSE;       /* Is this a partition volume ? */  
    unsigned __int64 nVolumeSize = 0;       /* The volume size, in bytes. */  
    unsigned __int64 nHiddenVolHostSize = 0;    /* Size of the hidden volume host, in bytes */  
    Password volumePassword;            /* Users password */  
    int nVolumeEA = 1;          /* Default encryption algorithm */  
    int hash_algo = DEFAULT_HASH_ALGORITHM; /* Which PRF to use in header key derivation (PKCS #5) and in the RNG. */  
    volatile BOOL bSparseFileSwitch = FALSE;  
    volatile BOOL quickFormat = FALSE;  /* WARNING: Meaning of this variable depends on bSparseFileSwitch. */  
                                   /* If bSparseFileSwitch is TRUE, this variable represents the sparse file flag. */  
    volatile int fileSystem = 0;  
    volatile int clusterSize = 0;  
    BOOL bHidden;  
    int realClusterSize;        /* Parameter used when determining the maximum possible size of a hidden volume. */  
    int nStatus;  
    char szTmp[16];  
    int nMultiplier = 1024*1024;        /* Size selection multiplier.  */  
    //strcpy(szDiskFile, "C://1.txt");  
    //szDiskFile[8] = 0;  
    strcpy(szDiskFile, szFile);  
    szDiskFile[strlen(szFile)] = 0;  
    strcpy(szTmp, "10");  
    //nVolumeSize = _atoi64 (szTmp);  
    nVolumeSize = nsize;  
    nVolumeSize = nVolumeSize * nMultiplier;  
    nHiddenVolHostSize = 0;  
    //strcpy(volumePassword.Text, "123456");  
    strcpy(volumePassword.Text, szPassword);  
    volumePassword.Length = strlen (volumePassword.Text);  
    quickFormat = FALSE;  
    bSparseFileSwitch = TRUE;  
    fileSystem = FILESYS_FAT;  
    clusterSize = 0;  
    bHidden = FALSE;  
    realClusterSize = 512;  
      
    nStatus = FormatVolume (szDiskFile,//  
        bDevice,//  
        nVolumeSize,//1024*1024*10  
        nHiddenVolHostSize,//0  
        &amp;volumePassword,//  
        nVolumeEA,//  
        hash_algo,//  
        quickFormat,//FALSE  
        bSparseFileSwitch,//TRUE  
        fileSystem,//1  
        clusterSize,//0  
        hwndDlg,//  
        bHidden,//FALSE  
        &amp;realClusterSize,//512  
        FALSE);  
    return 1;  
}  </textarea>  
  </div> 
 </div> 
</div> 
<p> </p> 
<p>      在进行了一系列的参数设置后，即可完成加密卷的设置工作，下面就可以进行创建了，通过以上方式就可以实现自己的创建加密卷的方法。TrueCrypt对加密卷文件大小没有限制。虚拟的磁盘容量大小仅受加密卷所在磁盘的文件系统限制。例如，Fat32格式化的磁盘内，可以创建的加密卷文件不能超过4G。</p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/88f45d5c5c08fb2740b3dedd28d10935/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C# 回车（键盘）事件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/da8aa1db7cb6499c4abec09cdadadc88/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">深入认识学习ASP应用Cookies的技巧</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>