<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Ansible 参数·命令说明 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Ansible 参数·命令说明" />
<meta property="og:description" content="目录
ansible 命令的执行过程
Inventory 参数说明
Script 模块 在远程主机上运行ansible服务器上的脚本(无需执行权限)
Copy 模块 复制ansible服务器主控端或远程的本机的文件到远程主机
Get_url 模块 功能: 用于将文件从http 等下载到被管理机节点上
Fetch 模块 功能：从远程主机提取文件至ansible的主控端
File 模块 功能：设置文件属性,创建文件,目录和软链接等
stat 模块 功能：检查文件或文件系统的状态
unarchive 模块 功能：解包解压缩（推荐）
Archive 模块 打包压缩保存在被管理节点
常见选项 Hostname 模块 管理主机名
Cron 模块 功能：计划任务
Yum 和 Apt 模块 功能：管理安装软件包
yum_repository 模块 功能: 此模块实现yum的仓库配置管理
Service 模块 此模块和sytemd功能相似,选项很多相同 管理服务 启动自启等
User 模块 管理用户
Group 模块功能：管理组
Lineinfile 模块 进行替换
Replace 模块 类似于sed命令 于正则进行匹配和替换，建议使用
SELinux 模块 该模块管理 SELInux （Linux 安全子系统）" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c9a297d1d98d247f7f121bc8c88b0bca/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-25T16:44:12+08:00" />
<meta property="article:modified_time" content="2023-05-25T16:44:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Ansible 参数·命令说明</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="ansible%20%E5%91%BD%E4%BB%A4%E7%9A%84%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B-toc" style="margin-left:40px;"><a href="#ansible%20%E5%91%BD%E4%BB%A4%E7%9A%84%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B" rel="nofollow">ansible 命令的执行过程</a></p> 
<p id="Inventory%20%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E-toc" style="margin-left:40px;"><a href="#Inventory%20%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E" rel="nofollow">Inventory 参数说明</a></p> 
<p id="Script%20%E6%A8%A1%E5%9D%97-toc" style="margin-left:40px;"><a href="#Script%20%E6%A8%A1%E5%9D%97" rel="nofollow">Script 模块 在远程主机上运行ansible服务器上的脚本(无需执行权限)</a></p> 
<p id="%C2%A0Copy%20%E6%A8%A1%E5%9D%97%C2%A0%20%E5%A4%8D%E5%88%B6ansible%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%BB%E6%8E%A7%E7%AB%AF%E6%88%96%E8%BF%9C%E7%A8%8B%E7%9A%84%E6%9C%AC%E6%9C%BA%E7%9A%84%E6%96%87%E4%BB%B6%E5%88%B0%E8%BF%9C%E7%A8%8B%E4%B8%BB%E6%9C%BA-toc" style="margin-left:40px;"><a href="#%C2%A0Copy%20%E6%A8%A1%E5%9D%97%C2%A0%20%E5%A4%8D%E5%88%B6ansible%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%BB%E6%8E%A7%E7%AB%AF%E6%88%96%E8%BF%9C%E7%A8%8B%E7%9A%84%E6%9C%AC%E6%9C%BA%E7%9A%84%E6%96%87%E4%BB%B6%E5%88%B0%E8%BF%9C%E7%A8%8B%E4%B8%BB%E6%9C%BA" rel="nofollow"> Copy 模块  复制ansible服务器主控端或远程的本机的文件到远程主机</a></p> 
<p id="%C2%A0Get_url%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%E5%8A%9F%E8%83%BD%3A%20%E7%94%A8%E4%BA%8E%E5%B0%86%E6%96%87%E4%BB%B6%E4%BB%8Ehttp%C2%A0%E7%AD%89%E4%B8%8B%E8%BD%BD%E5%88%B0%E8%A2%AB%E7%AE%A1%E7%90%86%E6%9C%BA%E8%8A%82%E7%82%B9%E4%B8%8A-toc" style="margin-left:40px;"><a href="#%C2%A0Get_url%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%E5%8A%9F%E8%83%BD%3A%20%E7%94%A8%E4%BA%8E%E5%B0%86%E6%96%87%E4%BB%B6%E4%BB%8Ehttp%C2%A0%E7%AD%89%E4%B8%8B%E8%BD%BD%E5%88%B0%E8%A2%AB%E7%AE%A1%E7%90%86%E6%9C%BA%E8%8A%82%E7%82%B9%E4%B8%8A" rel="nofollow"> Get_url 模块  功能: 用于将文件从http 等下载到被管理机节点上</a></p> 
<p id="Fetch%20%E6%A8%A1%E5%9D%97%C2%A0%20%C2%A0%E5%8A%9F%E8%83%BD%EF%BC%9A%E4%BB%8E%E8%BF%9C%E7%A8%8B%E4%B8%BB%E6%9C%BA%E6%8F%90%E5%8F%96%E6%96%87%E4%BB%B6%E8%87%B3ansible%E7%9A%84%E4%B8%BB%E6%8E%A7%E7%AB%AF-toc" style="margin-left:40px;"><a href="#Fetch%20%E6%A8%A1%E5%9D%97%C2%A0%20%C2%A0%E5%8A%9F%E8%83%BD%EF%BC%9A%E4%BB%8E%E8%BF%9C%E7%A8%8B%E4%B8%BB%E6%9C%BA%E6%8F%90%E5%8F%96%E6%96%87%E4%BB%B6%E8%87%B3ansible%E7%9A%84%E4%B8%BB%E6%8E%A7%E7%AB%AF" rel="nofollow">Fetch 模块   功能：从远程主机提取文件至ansible的主控端</a></p> 
<p id="-toc" style="margin-left:40px;"></p> 
<p id="%C2%A0File%20%E6%A8%A1%E5%9D%97%C2%A0%20%C2%A0%20%E5%8A%9F%E8%83%BD%EF%BC%9A%E6%A3%80%E6%9F%A5%E6%96%87%E4%BB%B6%E6%88%96%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%8A%B6%E6%80%81-toc" style="margin-left:40px;"><a href="#%C2%A0File%20%E6%A8%A1%E5%9D%97%C2%A0%20%C2%A0%20%E5%8A%9F%E8%83%BD%EF%BC%9A%E6%A3%80%E6%9F%A5%E6%96%87%E4%BB%B6%E6%88%96%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%8A%B6%E6%80%81" rel="nofollow">File 模块    功能：设置文件属性,创建文件,目录和软链接等</a></p> 
<p id="stat%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%E5%8A%9F%E8%83%BD%EF%BC%9A%E6%A3%80%E6%9F%A5%E6%96%87%E4%BB%B6%E6%88%96%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%8A%B6%E6%80%81-toc" style="margin-left:40px;"><a href="#stat%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%E5%8A%9F%E8%83%BD%EF%BC%9A%E6%A3%80%E6%9F%A5%E6%96%87%E4%BB%B6%E6%88%96%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%8A%B6%E6%80%81" rel="nofollow">stat 模块  功能：检查文件或文件系统的状态</a></p> 
<p id="%C2%A0unarchive%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%E5%8A%9F%E8%83%BD%EF%BC%9A%E8%A7%A3%E5%8C%85%E8%A7%A3%E5%8E%8B%E7%BC%A9-toc" style="margin-left:40px;"><a href="#%C2%A0unarchive%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%E5%8A%9F%E8%83%BD%EF%BC%9A%E8%A7%A3%E5%8C%85%E8%A7%A3%E5%8E%8B%E7%BC%A9" rel="nofollow"> unarchive 模块  功能：解包解压缩（推荐）</a></p> 
<p id="Archive%20%E6%A8%A1%E5%9D%97%C2%A0%20%C2%A0%C2%A0%E6%89%93%E5%8C%85%E5%8E%8B%E7%BC%A9%E4%BF%9D%E5%AD%98%E5%9C%A8%E8%A2%AB%E7%AE%A1%E7%90%86%E8%8A%82%E7%82%B9-toc" style="margin-left:40px;"><a href="#Archive%20%E6%A8%A1%E5%9D%97%C2%A0%20%C2%A0%C2%A0%E6%89%93%E5%8C%85%E5%8E%8B%E7%BC%A9%E4%BF%9D%E5%AD%98%E5%9C%A8%E8%A2%AB%E7%AE%A1%E7%90%86%E8%8A%82%E7%82%B9" rel="nofollow">Archive 模块    打包压缩保存在被管理节点</a></p> 
<p id="%E5%B8%B8%E8%A7%81%E9%80%89%E9%A1%B9%C2%A0-toc" style="margin-left:40px;"><a href="#%E5%B8%B8%E8%A7%81%E9%80%89%E9%A1%B9%C2%A0" rel="nofollow">常见选项 </a></p> 
<p id="Hostname%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%E7%AE%A1%E7%90%86%E4%B8%BB%E6%9C%BA%E5%90%8D-toc" style="margin-left:40px;"><a href="#Hostname%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%E7%AE%A1%E7%90%86%E4%B8%BB%E6%9C%BA%E5%90%8D" rel="nofollow">Hostname 模块  管理主机名</a></p> 
<p id="Cron%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%E5%8A%9F%E8%83%BD%EF%BC%9A%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1-toc" style="margin-left:40px;"><a href="#Cron%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%E5%8A%9F%E8%83%BD%EF%BC%9A%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1" rel="nofollow">Cron 模块  功能：计划任务</a></p> 
<p id="Yum%20%E5%92%8C%20Apt%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%E5%8A%9F%E8%83%BD%EF%BC%9A%E7%AE%A1%E7%90%86%E8%BD%AF%E4%BB%B6%E5%8C%85-toc" style="margin-left:40px;"><a href="#Yum%20%E5%92%8C%20Apt%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%E5%8A%9F%E8%83%BD%EF%BC%9A%E7%AE%A1%E7%90%86%E8%BD%AF%E4%BB%B6%E5%8C%85" rel="nofollow">Yum 和 Apt 模块  功能：管理安装软件包</a></p> 
<p id="yum_repository%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%E5%8A%9F%E8%83%BD%3A%20%E6%AD%A4%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0yum%E7%9A%84%E4%BB%93%E5%BA%93%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86-toc" style="margin-left:40px;"><a href="#yum_repository%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%E5%8A%9F%E8%83%BD%3A%20%E6%AD%A4%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0yum%E7%9A%84%E4%BB%93%E5%BA%93%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86" rel="nofollow">yum_repository 模块  功能: 此模块实现yum的仓库配置管理</a></p> 
<p id="%C2%A0Service%20%E6%A8%A1%E5%9D%97%C2%A0%20%E6%AD%A4%E6%A8%A1%E5%9D%97%E5%92%8Csytemd%E5%8A%9F%E8%83%BD%E7%9B%B8%E4%BC%BC%2C%E9%80%89%E9%A1%B9%E5%BE%88%E5%A4%9A%E7%9B%B8%E5%90%8C%C2%A0%20%E7%AE%A1%E7%90%86%E6%9C%8D%E5%8A%A1-toc" style="margin-left:40px;"><a href="#%C2%A0Service%20%E6%A8%A1%E5%9D%97%C2%A0%20%E6%AD%A4%E6%A8%A1%E5%9D%97%E5%92%8Csytemd%E5%8A%9F%E8%83%BD%E7%9B%B8%E4%BC%BC%2C%E9%80%89%E9%A1%B9%E5%BE%88%E5%A4%9A%E7%9B%B8%E5%90%8C%C2%A0%20%E7%AE%A1%E7%90%86%E6%9C%8D%E5%8A%A1" rel="nofollow"> Service 模块  此模块和sytemd功能相似,选项很多相同  管理服务 启动自启等</a></p> 
<p id="%C2%A0User%20%E6%A8%A1%E5%9D%97-toc" style="margin-left:40px;"><a href="#%C2%A0User%20%E6%A8%A1%E5%9D%97" rel="nofollow"> User 模块 管理用户</a></p> 
<p id="%C2%A0Group%20%E6%A8%A1%E5%9D%97%E5%8A%9F%E8%83%BD%EF%BC%9A%E7%AE%A1%E7%90%86%E7%BB%84-toc" style="margin-left:40px;"><a href="#%C2%A0Group%20%E6%A8%A1%E5%9D%97%E5%8A%9F%E8%83%BD%EF%BC%9A%E7%AE%A1%E7%90%86%E7%BB%84" rel="nofollow"> Group 模块功能：管理组</a></p> 
<p id="%C2%A0Lineinfile%20%E6%A8%A1%E5%9D%97%C2%A0%20%C2%A0%20%C2%A0%E8%BF%9B%E8%A1%8C%E6%9B%BF%E6%8D%A2-toc" style="margin-left:40px;"><a href="#%C2%A0Lineinfile%20%E6%A8%A1%E5%9D%97%C2%A0%20%C2%A0%20%C2%A0%E8%BF%9B%E8%A1%8C%E6%9B%BF%E6%8D%A2" rel="nofollow"> Lineinfile 模块     进行替换</a></p> 
<p id="%C2%A0Replace%20%E6%A8%A1%E5%9D%97%C2%A0%20%C2%A0%C2%A0%E7%B1%BB%E4%BC%BC%E4%BA%8Esed%E5%91%BD%E4%BB%A4%C2%A0%E4%BA%8E%E6%AD%A3%E5%88%99%E8%BF%9B%E8%A1%8C%E5%8C%B9%E9%85%8D%E5%92%8C%E6%9B%BF%E6%8D%A2%EF%BC%8C%E5%BB%BA%E8%AE%AE%E4%BD%BF%E7%94%A8-toc" style="margin-left:40px;"><a href="#%C2%A0Replace%20%E6%A8%A1%E5%9D%97%C2%A0%20%C2%A0%C2%A0%E7%B1%BB%E4%BC%BC%E4%BA%8Esed%E5%91%BD%E4%BB%A4%C2%A0%E4%BA%8E%E6%AD%A3%E5%88%99%E8%BF%9B%E8%A1%8C%E5%8C%B9%E9%85%8D%E5%92%8C%E6%9B%BF%E6%8D%A2%EF%BC%8C%E5%BB%BA%E8%AE%AE%E4%BD%BF%E7%94%A8" rel="nofollow"> Replace 模块    类似于sed命令 于正则进行匹配和替换，建议使用</a></p> 
<p id="%C2%A0mount%20%E6%A8%A1%E5%9D%97%C2%A0%20%E5%8A%9F%E8%83%BD%3A%20%E6%8C%82%E8%BD%BD%E5%92%8C%E5%8D%B8%E8%BD%BD%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F-toc" style="margin-left:40px;"><a href="#%C2%A0mount%20%E6%A8%A1%E5%9D%97%C2%A0%20%E5%8A%9F%E8%83%BD%3A%20%E6%8C%82%E8%BD%BD%E5%92%8C%E5%8D%B8%E8%BD%BD%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F" rel="nofollow">  SELinux 模块 该模块管理 SELInux （Linux 安全子系统）</a></p> 
<p id="%C2%A0reboot%20%E6%A8%A1%E5%9D%97%20%E5%8A%9F%E8%83%BD%3A%20%E9%87%8D%E5%90%AF-toc" style="margin-left:40px;"><a href="#%C2%A0reboot%20%E6%A8%A1%E5%9D%97%20%E5%8A%9F%E8%83%BD%3A%20%E9%87%8D%E5%90%AF" rel="nofollow"> reboot 模块 功能: 重启 是立刻重启前面的会丢失notify重启前面不会</a></p> 
<p id="%C2%A0notify%20%E5%9C%A8%E4%B8%8D%E5%85%B3%E9%97%AD%E6%95%B4%E4%B8%AA%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E9%87%8D%E6%96%B0%E5%90%AF%E5%8A%A8%E5%8D%95%E4%B8%AA%E6%9C%8D%E5%8A%A1-toc" style="margin-left:80px;"><a href="#%C2%A0notify%20%E5%9C%A8%E4%B8%8D%E5%85%B3%E9%97%AD%E6%95%B4%E4%B8%AA%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E9%87%8D%E6%96%B0%E5%90%AF%E5%8A%A8%E5%8D%95%E4%B8%AA%E6%9C%8D%E5%8A%A1" rel="nofollow"> notify 在不关闭整个应用程序的情况下重新启动单个服务</a></p> 
<p id="mount%20%E6%A8%A1%E5%9D%97%C2%A0%20%E5%8A%9F%E8%83%BD%3A%20%E6%8C%82%E8%BD%BD%E5%92%8C%E5%8D%B8%E8%BD%BD%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F-toc" style="margin-left:40px;"><a href="#mount%20%E6%A8%A1%E5%9D%97%C2%A0%20%E5%8A%9F%E8%83%BD%3A%20%E6%8C%82%E8%BD%BD%E5%92%8C%E5%8D%B8%E8%BD%BD%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F" rel="nofollow">mount 模块  功能: 挂载和卸载文件系统</a></p> 
<p id="%C2%A0Setup%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%20setup%20%E6%A8%A1%E5%9D%97%E6%9D%A5%E6%94%B6%E9%9B%86%E4%B8%BB%E6%9C%BA%E7%9A%84%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF-toc" style="margin-left:40px;"><a href="#%C2%A0Setup%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%20setup%20%E6%A8%A1%E5%9D%97%E6%9D%A5%E6%94%B6%E9%9B%86%E4%B8%BB%E6%9C%BA%E7%9A%84%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF" rel="nofollow"> Setup 模块   setup 模块来收集主机的系统信息</a></p> 
<p id="%C2%A0%C2%A0debug%20%E6%A8%A1%E5%9D%97-toc" style="margin-left:40px;"><a href="#%C2%A0%C2%A0debug%20%E6%A8%A1%E5%9D%97" rel="nofollow">  debug 模块 功能类似于echo命令</a></p> 
<p id="%C2%A0sysctl%20%E6%A8%A1%E5%9D%97%C2%A0%20%C2%A0%E5%8A%9F%E8%83%BD%3A%20%E4%BF%AE%E6%94%B9%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0-toc" style="margin-left:40px;"><a href="#%C2%A0sysctl%20%E6%A8%A1%E5%9D%97%C2%A0%20%C2%A0%E5%8A%9F%E8%83%BD%3A%20%E4%BF%AE%E6%94%B9%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0" rel="nofollow"> sysctl 模块   功能: 修改内核参数</a></p> 
<p id="%C2%A0pam_limits%C2%A0%20%C2%A0%20%C2%A0%C2%A0%E5%8A%9F%E8%83%BD%3A%20%E7%AE%A1%E7%90%86%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6-toc" style="margin-left:40px;"><a href="#%C2%A0pam_limits%C2%A0%20%C2%A0%20%C2%A0%C2%A0%E5%8A%9F%E8%83%BD%3A%20%E7%AE%A1%E7%90%86%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6" rel="nofollow"> pam_limits      功能: 管理资源限制</a></p> 
<p id="apt_repository%C2%A0%20%C2%A0%E6%AD%A4%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0apt%E7%9A%84%E4%BB%93%E5%BA%93%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86-toc" style="margin-left:40px;"><a href="#apt_repository%C2%A0%20%C2%A0%E6%AD%A4%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0apt%E7%9A%84%E4%BB%93%E5%BA%93%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86" rel="nofollow">apt_repository   此模块实现apt的仓库配置管理</a></p> 
<p id="%C2%A0apt_key%20%E6%A8%A1%E5%9D%97%C2%A0%20%C2%A0%20%C2%A0%E6%B7%BB%E5%8A%A0%E5%92%8C%E5%88%A0%E9%99%A4apt%20key-toc" style="margin-left:40px;"><a href="#%C2%A0apt_key%20%E6%A8%A1%E5%9D%97%C2%A0%20%C2%A0%20%C2%A0%E6%B7%BB%E5%8A%A0%E5%92%8C%E5%88%A0%E9%99%A4apt%20key" rel="nofollow"> apt_key 模块     添加和删除apt key</a></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<hr id="hr-toc"> 
<p></p> 
<h3 id="ansible%20%E5%91%BD%E4%BB%A4%E7%9A%84%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B">ansible 命令的执行过程</h3> 
<p>1. 加载自己的配置文件,默认/etc/ansible/ansible.cfg<br> 2. 查找主机清单中对应的主机或主机组<br> 3. 加载自己对应的模块文件，如：command<br> 4. 通过ansible将模块或命令生成对应临时py文件，并将该文件传输至远程服务器的对应执行用户<br> $HOME/.ansible/tmp/ansible-tmp-数字/XXX.PY文件<br> 5. 给文件+x执行<br> 6. 执行并返回结果<br> 7. 删除临时py文件，退出</p> 
<p>ad-Hoc就是ansible的命令</p> 
<h3 id="Inventory%20%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E">Inventory 参数说明</h3> 
<blockquote> 
 <p>ansible_ssh_host #将要连接的远程主机名.与你想要设定的主机的别名不同的话,可通过此变量设置.<br> ansible_ssh_port #ssh端口号.如果不是默认的端口号,通过此变量设置.这种可以使用 ip:端口<br> 192.168.1.100:2222<br> ansible_ssh_user #默认的 ssh 用户名<br> ansible_ssh_pass #ssh 密码(这种方式并不安全,我们强烈建议使用 --ask-pass 或 SSH 密钥)<br> ansible_sudo_pass #sudo 密码(这种方式并不安全,我们强烈建议使用 --ask-sudo-pass)<br> ansible_sudo_exe (new in version 1.8) #sudo 命令路径(适用于1.8及以上版本)<br> ansible_connection #与主机的连接类型.比如:local, ssh 或者 paramiko. Ansible 1.2 以前默<br> 认使用 paramiko.1.2 以后默认使用 'smart','smart' 方式会根据是否支持 ControlPersist, 来<br> 判断'ssh' 方式是否可行.<br> ansible_ssh_private_key_file #ssh 使用的私钥文件.适用于有多个密钥,而你不想使用 SSH 代理的情况.<br> ansible_shell_type #目标系统的shell类型.默认情况下,命令的执行使用 'sh' 语法,可设置为<br> 'csh' 或 'fish'.<br> ansible_python_interpreter #目标主机的 python 路径.适用于的情况: 系统中有多个 Python,<br> 或者命令路径不是"/usr/bin/python",比如 \*BSD, 或者 /usr/bin/python 不是 2.X 版本的<br> Python.之所以不使用 "/usr/bin/env" 机制,因为这要求远程用户的路径设置正确,且要求 "python"可执行程序名不可为 python以外的名字(实际有可能名为python26).与<br> ansible_python_interpreter 的工作方式相同,可设定如 ruby 或 perl 的路径....</p> 
</blockquote> 
<h3 id="Script%20%E6%A8%A1%E5%9D%97">Script 模块 在远程主机上运行ansible服务器上的脚本(无需执行权限)</h3> 
<p>功能：在远程主机上运行ansible服务器上的脚本(无需执行权限)<br> 注意：此模块不具有幂等性<br> 常见选项</p> 
<blockquote> 
 <p>chdir=dir #执行命令前,先切换至目录dir<br> cmd #指定ansible主机的命令<br> creates=file #当file不存在时才会执行<br> removes=file #当file存在时才会执行</p> 
</blockquote> 
<p>范例：</p> 
<blockquote> 
 <p>ansible webservers -m script -a /data/test.sh</p> 
</blockquote> 
<p> <img alt="" height="524" src="https://images2.imgbox.com/0a/45/vdAG0UCV_o.png" width="713"></p> 
<h3 id="%C2%A0Copy%20%E6%A8%A1%E5%9D%97%C2%A0%20%E5%A4%8D%E5%88%B6ansible%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%BB%E6%8E%A7%E7%AB%AF%E6%88%96%E8%BF%9C%E7%A8%8B%E7%9A%84%E6%9C%AC%E6%9C%BA%E7%9A%84%E6%96%87%E4%BB%B6%E5%88%B0%E8%BF%9C%E7%A8%8B%E4%B8%BB%E6%9C%BA"> Copy 模块  复制ansible服务器主控端或远程的本机的文件到远程主机</h3> 
<p>功能：复制ansible服务器主控端或远程的本机的文件到远程主机<br> 注意: src=file 如果是没指明路径,则为当前目录或当前目录下的files目录下的file文件</p> 
<p>常见选项</p> 
<blockquote> 
 <p>src                 #控制端的源文件路径</p> 
 <p>content          #源文件内容<br> dest               #被控端的文件路径<br> owner            #属主<br> group             #属组<br> mode             #权限<br> backup           #是否备份 backup=yes" #生成的备份文件格式<br> validate          #验证成功才会执行copy  网络不确定性校验<br> remote_src    #no是默认值,表示src文件在ansible主机,yes表示src文件在远程主机</p> 
</blockquote> 
<p> 范例:</p> 
<blockquote> 
 <p>#如目标存在，默认覆盖，此处指定先备         下，结果<br> ansible webservers -m copy -a "src=/root/test1.sh dest=/tmp/test2.sh<br> owner=wang mode=600 backup=yes"</p> 
 <p></p> 
 <p>backup=yes" #生成的备份文件格式：rsync.pas.2029.2022-09-28@09:14:46~</p> 
 <p></p> 
 <p>#指定内容，直接生成目标文件 （不能创建文件夹）<br> ansible webservers -m copy -a "content='wang 123456\nxiao 654321\n'<br> dest=/etc/rsync.pas owner=root group=root mode=0600"</p> 
 <p></p> 
 <p>#复制/etc目录自身,注意/etc/后面没有/<br> ansible webservers -m copy -a "src=/etc dest=/backup"</p> 
 <p></p> 
 <p>#复制/etc/下的文件，不包括/etc/目录自身,注意/etc/后面有/<br> ansible webservers -m copy -a "src=/etc/ dest=/backup"</p> 
 <p></p> 
 <p>#复制/etc/suders,并校验语法,下面的 %s 表示src指定的文件名 <br> ansible webservers -m copy -a "src=/etc/suders dest=/etc/sudoers.edit<br> remote_src=yes validate=/usr/sbin/visudo -csf %s"   #visudo检查<strong>语法</strong>知否正确</p> 
</blockquote> 
<p><img alt="" height="449" src="https://images2.imgbox.com/41/26/6ZCgUydm_o.png" width="839"></p> 
<p></p> 
<h3 id="%C2%A0Get_url%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%E5%8A%9F%E8%83%BD%3A%20%E7%94%A8%E4%BA%8E%E5%B0%86%E6%96%87%E4%BB%B6%E4%BB%8Ehttp%C2%A0%E7%AD%89%E4%B8%8B%E8%BD%BD%E5%88%B0%E8%A2%AB%E7%AE%A1%E7%90%86%E6%9C%BA%E8%8A%82%E7%82%B9%E4%B8%8A"> Get_url 模块  功能: 用于将文件从http 等下载到被管理机节点上</h3> 
<p>功能: 用于将文件从http、https或ftp下载到被管理机节点上</p> 
<p>常用参数如下：</p> 
<pre><code>url   #下载文件的URL,支持HTTP，HTTPS或FTP协议

dest  #下载到目标路径（绝对路径），如果目标是一个目录，就用原文件名，如果目标设置了名称就用目标
设置的名称

owner #指定属主
group #指定属组
mode  #指定权限

force #如果yes，dest不是目录，将每次下载文件，如果内容改变替换文件。如果no，则只有在目标不存在
时才会下载

checksum  #对目标文件在下载后计算摘要，以确保其完整性
          #示例: checksum="sha256:D98291AC[...]B6DC7B97",
                checksum="sha256:http://example.com/path/sha256sum.txt"

url_username #用于HTTP基本认证的用户名。 对于允许空密码的站点，此参数可以不使用
`url_password'

url_password #用于HTTP基本认证的密码。 如果未指定`url_username'参数，则不会使用
`url_password'参数

validate_certs #如果“no”，SSL证书将不会被验证。 适用于自签名证书在私有网站上使用
timeout  #URL请求的超时时间,秒为单位
</code></pre> 
<p> [root@ubuntu2004 ~]#wget http://nginx.org/download/nginx-1.18.0.tar.gz    下载</p> 
<p>[root@ubuntu2004 ~]#md5sum nginx-1.18.0.tar.gz                            计算哈希值以确保完整形</p> 
<blockquote> 
 <p>ansible webservers -m get_url -a 'url=http://nginx.org/download/nginx-1.18.0.tar.gz dest=/usr/local/src/nginx.tar.gz checksum="md5:b2d33d24d89b8b1f87ff5d251aa27eb8"'</p> 
</blockquote> 
<h3 id="Fetch%20%E6%A8%A1%E5%9D%97%C2%A0%20%C2%A0%E5%8A%9F%E8%83%BD%EF%BC%9A%E4%BB%8E%E8%BF%9C%E7%A8%8B%E4%B8%BB%E6%9C%BA%E6%8F%90%E5%8F%96%E6%96%87%E4%BB%B6%E8%87%B3ansible%E7%9A%84%E4%B8%BB%E6%8E%A7%E7%AB%AF">Fetch 模块   功能：从远程主机提取文件至ansible的主控端</h3> 
<p>功能：从远程主机提取文件至an sible的主控端，copy相反，目前不支持目录 可以压缩包</p> 
<p>常见选项</p> 
<blockquote> 
 <p>src         #被控制端的源文件路径,只支持文件<br> dest         #ansible控制端的目录路径</p> 
</blockquote> 
<p> 范例：</p> 
<pre><code>[root@ubuntu2004 data]#ansible webservers -m fetch -a 'src=/data/test.sh dest=/data/scripts'</code></pre> 
<blockquote> 
 <p>[root@ansible ~]#ansible all -m fetch -a 'src=/etc/os-release dest=/data/os'<br> [root@ansible ~]#tree /data/os/     （目录也不用建）<br> /data/os/<br> ├── 10.0.0.6<br> │ └── etc<br> │ └── redhat-release<br> ├── 10.0.0.7<br> │ └── etc<br> │ └── redhat-release<br> └── 10.0.0.8<br> └── etc<br> └── redhat-release<br> 6 directories, 3 files</p> 
</blockquote> 
<h3></h3> 
<h3 id="%C2%A0File%20%E6%A8%A1%E5%9D%97%C2%A0%20%C2%A0%20%E5%8A%9F%E8%83%BD%EF%BC%9A%E6%A3%80%E6%9F%A5%E6%96%87%E4%BB%B6%E6%88%96%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%8A%B6%E6%80%81">File 模块    功能：设置文件属性,创建文件,目录和软链接等</h3> 
<p>功能：设置文件属性,创建文件,目录和软链接等<br> 常见选项</p> 
<blockquote> 
 <p>path/name       #在被控端创建的路径   和dest name 功能相同<br> owner              #属主<br> group               #属组<br> mode               #权限</p> 
 <p>recurse            #yes表示递归授权<br> state                 #状态<br>         =touch              #创建文件<br>         =directory         #创建目录<br>         =link                 #软链接<br>         =hard               #硬链接</p> 
 <p>         =absent           #删除</p> 
 <p>src                 #创建软硬链接时，指定源文件</p> 
</blockquote> 
<p>3.4.7 File 模块 </p> 
<pre><code>#创建空文件
ansible all -m file -a 'path=/data/test.txt state=touch'     #如果/data/目录不存在，会失败
ansible all -m file -a "path=/root/test.sh owner=wang mode=755"

#创建目录
ansible all -m file -a "path=/data/mysql state=directory owner=mysql
group=mysql"

#创建软链接
ansible all -m file -a "src=/data/testfile state=link dest=/tmp/link"
        #path|dest|name   那个都可以   注意路径他不能自己创建

#创建目录
ansible all -m file -a 'path=/data/testdir state=directory'

#递归修改目录属性,但不递归至子目录
ansible all -m file -a "path=/data/mysql state=directory owner=mysql
group=mysql"

#递归修改目录及子目录的属性
ansible all -m file -a "path=/data/mysql state=directory owner=mysql group=mysql
recurse=yes"
#递归删除，带文件夹
ansible 10.0.0.101 -m file -a 'path=/data/ state=absent'</code></pre> 
<h3 id="stat%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%E5%8A%9F%E8%83%BD%EF%BC%9A%E6%A3%80%E6%9F%A5%E6%96%87%E4%BB%B6%E6%88%96%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%8A%B6%E6%80%81">stat 模块  功能：检查文件或文件系统的状态</h3> 
<p>功能：检查文件或文件系统的状态<br> 注意：对于Windows目标，请改用win_stat模块</p> 
<p>常见选项</p> 
<blockquote> 
 <p>path #文件/对象的完整路径（必须）</p> 
</blockquote> 
<p> 常用的返回值判断</p> 
<blockquote> 
 <p>exists： 判断是否存在<br> isuid： 调用用户的ID与所有者ID是否匹配</p> 
 <pre><code class="language-bash">[root@ubuntu2004 data]#ansible 10.0.0.101 -m stat -a 'path=/etc/passwd'
10.0.0.101 | SUCCESS =&gt; {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python3"
    },
    "changed": false,
    "stat": {
        "atime": 1664367675.6140075,
        "attr_flags": "e",
        "attributes": [
            "extents"
        ],
        "block_size": 4096,
        "blocks": 8,
        "charset": "us-ascii",
        "checksum": "9867357720d5526cb761205431f2c0bc5b52a4ca",
        "ctime": 1663405315.4957695,
        "dev": 64768,
        "device_type": 0,
        "executable": false,
        "exists": true,
        "gid": 0,
        "gr_name": "root",
        "inode": 131904,
        "isblk": false,
        "ischr": false,
        "isdir": false,
        "isfifo": false,
        "isgid": false,
        "islnk": false,
        "isreg": true,
        "issock": false,
        "isuid": false,
        "mimetype": "text/plain",
        "mode": "0644",
</code></pre> 
</blockquote> 
<h3 id="%C2%A0unarchive%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%E5%8A%9F%E8%83%BD%EF%BC%9A%E8%A7%A3%E5%8C%85%E8%A7%A3%E5%8E%8B%E7%BC%A9"> unarchive 模块  功能：解包解压缩（推荐）</h3> 
<p>功能：解包解压缩<br> 实现有两种用法：</p> 
<ul><li>将ansible主机上的压缩包传到远程主机后解压缩至特定目录，设置remote_src=no,此为默认值,可省略</li><li>将远程本主机上或非ansible的其它主机的某个压缩包解压缩到远程主机本机的指定路径下，需要设置remote_src=yes</li></ul> 
<p>常见参数：</p> 
<blockquote> 
 <p>remote_src #和copy功能一样且选项互斥，yes表示源文件在远程被控主机或其它非ansible的其它主机上，no表示文件在ansible主机上,<strong>默认值为no</strong>, 此选项代替copy选项</p> 
 <p></p> 
 <p>  copy #默认为yes，当copy=yes，拷贝的文件是从ansible主机复制到远程主机上，如果设置为copy=no，会在远程主机上寻找src源文件,<strong>此选项已废弃</strong></p> 
 <p></p> 
 <p>src #源路径，可以是ansible主机上的路径，也可以是远程主机(被管理端或者第三方主机)上的路径，如果是远程主机上的路径，则需要设置remote_src=yes<br> dest #远程主机上的目标路径<br> owner #默认递归<br> group #默认递归<br> mode #设置解压缩后的文件权限,默认递归<br> creates=/path/file #当绝对路径/path/file不存在时才会执行</p> 
</blockquote> 
<blockquote> 
 <p>ansible all -m unarchive -a 'src=/data/foo.tgz dest=/var/lib/foo owner=wang group=bin'</p> 
 <p></p> 
 <p>ansible all -m unarchive -a 'src=/tmp/foo.zip dest=/data copy=no mode=0777'</p> 
 <p><br> ansible all -m unarchive -a 'src=https://example.com/example.zip dest=/data remote_src=yes'</p> 
 <p><br> ansible all -m unarchive -a 'src=https://nginx.org/download/nginx-1.20.2.tar.gz<br> dest=/data remote_src=yes owner=wang group=wang'</p> 
 <p><br> ansible webservers -m unarchive -a<br> 'src=https://releases.ansible.com/ansible/ansible-2.1.6.0-0.1.rc1.tar.gz<br> dest=/data/ owner=root remote_src=yes'</p> 
</blockquote> 
<h3 id="Archive%20%E6%A8%A1%E5%9D%97%C2%A0%20%C2%A0%C2%A0%E6%89%93%E5%8C%85%E5%8E%8B%E7%BC%A9%E4%BF%9D%E5%AD%98%E5%9C%A8%E8%A2%AB%E7%AE%A1%E7%90%86%E8%8A%82%E7%82%B9">Archive 模块    打包压缩保存在被管理节点</h3> 
<h3 id="%E5%B8%B8%E8%A7%81%E9%80%89%E9%A1%B9%C2%A0">常见选项 </h3> 
<blockquote> 
 <p>path #需要压缩的文件或目录<br> dest #压缩后的文件<br> format #压缩格式,支持gz,bz2,xz,tar,zip</p> 
</blockquote> 
<p> 范例：</p> 
<pre><code class="language-bash">ansible webservers -m archive -a 'path=/var/log/ dest=/data/log.tar.bz2 format=bz2 owner=wang mode=0600'

[root@rocky8 data]#tar tvf log.tar.bz2  查看打包文</code></pre> 
<h3 id="Hostname%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%E7%AE%A1%E7%90%86%E4%B8%BB%E6%9C%BA%E5%90%8D">Hostname 模块  管理主机名</h3> 
<p>功能：管理主机名<br> 常见选项</p> 
<blockquote> 
 <p>name #修改后的主机名称</p> 
</blockquote> 
<blockquote> 
 <p> [root@ubuntu2004 ~]#ansible 10.0.0.101 -m hostname -a 'name=ansible'</p> 
</blockquote> 
<h3 id="Cron%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%E5%8A%9F%E8%83%BD%EF%BC%9A%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1">Cron 模块  功能：计划任务</h3> 
<p>功能：计划任务<br> 支持时间：minute，hour，day，month，weekday<br> 常见选项 </p> 
<blockquote> 
 <p>name           #描述脚本的作用<br> minute         #分钟<br> hour            #小时</p> 
 <p>day             #日<br> weekday     #周</p> 
 <p>month         #月<br> user            #任务由哪个用户运行；默认root<br> job               #任务</p> 
 <p>state=absent     #删除</p> 
</blockquote> 
<p> 范例：   crontab -l  查看预计执行任务</p> 
<pre><code class="language-bash">#备份数据库脚本   #用于计划任务 备份
[root@centos8 ~]#cat /root/mysql_backup.sh
#!/bin/bash
mysqldump -A -F --single-transaction --master-data=2 -q -uroot |gzip &gt; /data/mysql_`date +%F_%T`.sql.gz

#创建任务   #引用计划任务指定脚本
ansible 10.0.0.8 -m cron -a 'hour=2 minute=30 weekday=1-5 name="backup mysql" job=/root/mysql_backup.sh' 

ansible webservers -m cron -a "minute=*/5 job='/usr/sbin/ntpdate
ntp.aliyun.com &amp;&gt;/dev/null' name=Synctime"

#禁用计划任务
ansible webservers -m cron -a "minute=*/5 job='/usr/sbin/ntpdate 172.20.0.1
&amp;&gt;/dev/null' name=Synctime disabled=yes"

#启用计划任务
ansible webservers -m cron -a "minute=*/5 job='/usr/sbin/ntpdate 172.20.0.1
&amp;&gt;/dev/null' name=Synctime disabled=no"

#删除任务
ansible webservers -m cron -a "name='backup mysql' state=absent"
ansible webservers -m cron -a 'state=absent name=Synctime'

ansible 10.0.0.8 -m cron -a 'hour=2 minute=30 weekday=1-5 name="backup mysql" job=/root/mysql_backup.sh state=absent'     直接在后面家 state=absent</code></pre> 
<h3 id="Yum%20%E5%92%8C%20Apt%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%E5%8A%9F%E8%83%BD%EF%BC%9A%E7%AE%A1%E7%90%86%E8%BD%AF%E4%BB%B6%E5%8C%85">Yum 和 Apt 模块  功能：管理安装软件包</h3> 
<p>功能：管理软件包<br> yum 管理软件包，只支持RHEL，CentOS，fedora，不支持Ubuntu其它版本<br> apt 模块管理 Debian 相关版本的软件包<br> yum常见选项</p> 
<pre><code class="language-bash">name          #软件包名称
state         #状态
  =present    #安装,此为默认值    可多个
  =absent     #删除
  =latest     #最新版
list            #列出指定包
enablerepo      #启用哪个仓库安装
disablerepo     #不使用哪些仓库的包
exclude         #排除指定的包
validate        #是否检验,默认为yes
</code></pre> 
<p>范例：</p> 
<pre><code class="language-bash">#安装
[root@ubuntu2004 ~]#ansible webservers -m yum -a 'name=iotop,cowsay'
[root@ansible ~]#ansible webservers -m yum -a 'name=httpd state=present'

#安装zabbix agent rpm包
[root@ansible ~]#ansible webservers -m yum -a
'name=https://mirrors.tuna.tsinghua.edu.cn/zabbix/zabbix/5.0/rhel/8/x86_64/zabbi
x-agent2-5.0.24-1.el8.x86_64.rpm state=present validate_certs=no'

#启用epel源进行安装
[root@ansible ~]#ansible webservers -m yum -a 'name=nginx state=present
enablerepo=epel'

#升级除kernel和foo开头以外的所有包
[root@ansible ~]#ansible webservers -m yum -a 'name=* state=lastest
exclude=kernel*,foo*'

#删除
[root@ansible ~]#ansible webservers -m yum -a 'name=httpd state=absent'

#删除包并包括配置文件
[root@ubuntu2004 ~]#ansible 10.0.0.102 -m apt -a 'name=mysql-client 
state=absent autoremove=yes purge=yes'

#查看
ansible all -m yum -a "list=tree"</code></pre> 
<h3 id="yum_repository%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%E5%8A%9F%E8%83%BD%3A%20%E6%AD%A4%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0yum%E7%9A%84%E4%BB%93%E5%BA%93%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86">yum_repository 模块  功能: 此模块实现yum的仓库配置管理</h3> 
<p>功能: 此模块实现yum的仓库配置管理<br> 常见选项</p> 
<blockquote> 
 <p>name #仓库id<br> description #仓库描述名称,对应配置文件中的name=<br> baseurl #仓库的地址<br> gpgcheck #验证开启<br> gpgkey #仓库公钥路径<br> state</p> 
</blockquote> 
<p> 范例: 安装Zabbix Agent</p> 
<pre><code class="language-bash">[root@ansible ~]#ansible 10.0.0.8 -m yum_repository -a 'name=zabbix description="zabbix repo" baseurl="https://mirrors.aliyun.com/zabbix/zabbix/6.0/rhel/$releasever/$basearch/" gpgcheck=no'
[root@ansible ~]#ansible 10.0.0.8 -m yum -a 'name=zabbix-agent2'

#删除仓库配置
[root@ubuntu2004 ~]#ansible 10.0.0.8 -m yum_repository -a 'name=zabbix 
state=absent'
</code></pre> 
<h3 id="%C2%A0Service%20%E6%A8%A1%E5%9D%97%C2%A0%20%E6%AD%A4%E6%A8%A1%E5%9D%97%E5%92%8Csytemd%E5%8A%9F%E8%83%BD%E7%9B%B8%E4%BC%BC%2C%E9%80%89%E9%A1%B9%E5%BE%88%E5%A4%9A%E7%9B%B8%E5%90%8C%C2%A0%20%E7%AE%A1%E7%90%86%E6%9C%8D%E5%8A%A1"> Service 模块  此模块和sytemd功能相似,选项很多相同  管理服务 启动自启等</h3> 
<p>功能：管理服务  <br> 常见选项</p> 
<blockquote> 
 <p>name #服务名称<br> state #服务状态<br> =started #启动<br> =stopped #停止<br> =restarted #重启<br> =reloaded #重载<br> enabled #开启自启动 yes开机启动，no开机不启动<br> daemon_reload #加载新的配置文件,适用于systemd模块</p> 
</blockquote> 
<blockquote> 
 <p>ansible all -m service -a 'name=httpd state=started enabled=yes'     #启动  开启自启动<br> ansible all -m service -a 'name=httpd state=stopped'          #停止<br> ansible all -m service -a 'name=httpd state=reloaded'       #重载<br> ansible all -m shell -a "sed -i 's/^Listen 80/Listen 8080/'<br> /etc/httpd/conf/httpd.conf"<br> ansible all -m service -a 'name=httpd state=restarted' </p> 
 <p></p> 
 <p>#重启动指定网卡服务<br> ansible all -m service -a 'name=network state=absent args=eth0'</p> 
</blockquote> 
<h3 id="%C2%A0User%20%E6%A8%A1%E5%9D%97"> User 模块 管理用户</h3> 
<p>功能：管理用户<br> 常见选项</p> 
<blockquote> 
 <p>name           #创建的名称<br> uid               #指定uid<br> group           #指定基本组<br> shell             #登录shell类型默认/bin/bash<br> create_home #是否创建家目录,默认会创建家目录,no不创建<br> password         #设定对应的密码，必须是加密后的字符串才行，否则不生效<br> system             #yes表示系统用户<br> groups             #附加组<br> append            #追加附加组使用,yes表示增加新的附加组<br> state                #absen删除<br> remove           #yes表示删除用户时将家目录一起删除<br> generate_ssh_key #创建私钥<br> ssh_keyu_bits         #私钥位数<br> ssh_key_file            #私钥文件路径</p> 
 <p>home                        #家目录是什么</p> 
 <p>non_unique             #是否允许uid重名   </p> 
</blockquote> 
<p> 范例：</p> 
<blockquote> 
 <p>#创建用户        # comment=  就是个名字而已可加可不加<br> ansible all -m user -a 'name=user1 comment="test user" uid=2048 home=/app/user1 group=root'</p> 
 <p></p> 
 <p>ansible all -m user -a 'name=nginx comment=nginx uid=88 group=nginx<br> groups="root,daemon" shell=/sbin/nologin system=yes create_home=no<br> home=/data/nginx non_unique=yes'</p> 
 <p></p> 
 <p>#remove=yes表示删除用户及家目录等数据,默认remove=no<br> ansible all -m user -a 'name=nginx state=absent remove=yes'</p> 
 <p></p> 
 <p>#生成123456加密的密码<br> openssl passwd -6  123456     #--help 可以生成各种加密算法</p> 
 <p></p> 
 <p>#用上面创建的密码创建用户<br> ansible webservers -m user -a 'name=www group=www system=yes shell=/sbin/nlogin<br> password="$6$salt$MktMKPZJ6t59GfxcJU20DwcwQzfMvOlHFVZiOVD71w."'</p> 
 <p></p> 
 <p>#创建用户test,并生成4096bit的私钥<br> ansible webservers -m user -a 'name=test generate_ssh_key=yes ssh_key_bits=4096<br> ssh_key_file=.ssh/id_rsa'</p> 
</blockquote> 
<h3 id="%C2%A0Group%20%E6%A8%A1%E5%9D%97%E5%8A%9F%E8%83%BD%EF%BC%9A%E7%AE%A1%E7%90%86%E7%BB%84"> Group 模块功能：管理组</h3> 
<p>常见选项</p> 
<blockquote> 
 <p>name #指定组名称<br> gid #指定gid<br> state<br> =present #创建,默认<br> =absent #删除<br> system #是否是系统组</p> 
</blockquote> 
<p> 范例：</p> 
<blockquote> 
 <p> #创建组<br> ansible webservers -m group -a 'name=nginx gid=88 system=yes'<br> #删除组<br> ansible webservers -m group -a 'name=nginx state=absent'</p> 
</blockquote> 
<h3 id="%C2%A0Lineinfile%20%E6%A8%A1%E5%9D%97%C2%A0%20%C2%A0%20%C2%A0%E8%BF%9B%E8%A1%8C%E6%9B%BF%E6%8D%A2"> Lineinfile 模块     进行替换</h3> 
<p>ansible在使用sed进行替换时，经常会遇到需要转义的问题，而且ansible在遇到特殊符号进行替换时，会存在问题，无法正常进行替换 。<br> ansible自身提供了两个模块：lineinfile模块和replace模块，可以方便的进行替换<br> 一般在ansible当中去修改某个文件的单行进行替换的时候需要使用lineinfile模块<br> 功能：相当于sed，主要用于修改一行的文件内容</p> 
<p><strong>常见选项</strong></p> 
<blockquote> 
 <p>path                 #被控端文件的路径<br> regexp             #正则匹配语法格式,表示被替换的内容<br> line                   #替换为的内容<br> state                 #absent表示删除<br> insertafter        #插入到替换内容前面,如和regexp同时存在,只在没找到与regexp匹配时才使用insertafter<br> insertbefore      #插入到替换内容后面,如和regexp同时存在,只在没找到与regexp匹配时才使用insertafter<br> backrefs           #支持后面引用,yes和no<br> backup            #修改前先备份<br> create              #如果文件不存在,则创建,默认不存在会出错<br> mode              #指定权限<br> owner            #指定用户<br> group            #指定组</p> 
 <p></p> 
 <p>#注意<br> regexp参数 ：使用正则表达式匹配对应的行，当替换文本时，如果有多行文本都能被匹配，则只有最后面被匹配到的那行文本才会被替换，当删除文本时，如果有多行文本都能被匹配，这么这些行都会被删除。</p> 
</blockquote> 
<p><span style="color:#fe2c24;"><strong>注意: 如果想进行多行匹配进行替换需要使用replace模块 </strong></span></p> 
<blockquote> 
 <p>#修改监听端口<br> ansible webservers -m lineinfile -a "path=/etc/httpd/conf/httpd.conf<br> regexp='^Listen' line='Listen 8080'"</p> 
 <p></p> 
 <p>#修改SELinux</p> 
 <p>ansible all -m lineinfile -a "path=/etc/selinux/config regexp='^SELINUX='<br> line='SELINUX=disabled'"</p> 
 <p></p> 
 <p>#添加网关<br> ansible webservers -m lineinfile -a 'path=/etc/sysconfig/network-scripts/ifcfg-<br> eth0 line="GATEWAY=10.0.0.254"'</p> 
 <p></p> 
 <p>#给主机增加一个网关，但需要增加到NAME=下面<br> ansible webservers -m lineinfile -a 'path=/etc/sysconfig/network-scripts/ifcfg-<br> eth0 insertafter="^NAME=" line="GATEWAY=10.0.0.254"'</p> 
 <p></p> 
 <p>#效果如下<br> cat /etc/sysconfig/network-scripts/ifcfg-eth0<br> DEVICE=eth0<br> NAME=eth0<br> GATEWAY=10.0.0.254</p> 
 <p></p> 
 <p>#给主机增加一个网关，但需要增加到NAME=上面<br> ansible webservers -m lineinfile -a 'path=/etc/sysconfig/network-scripts/ifcfg-<br> eth0 insertbefore="^NAME=" line="GATEWAY=10.0.0.254"'</p> 
 <p></p> 
 <p>#效果如下<br> cat /etc/sysconfig/network-scripts/ifcfg-eth0<br> DEVICE=eth0<br> GATEWAY=10.0.0.254<br> NAME=eth0</p> 
 <p></p> 
 <p>#删除网关<br> ansible webservers -m lineinfile -a 'path=/etc/sysconfig/network-scripts/ifcfg-<br> eth0 regexp="^GATEWAY" state=absent'</p> 
 <p></p> 
 <p>#删除#开头的行<br> ansible all -m lineinfile -a 'dest=/etc/fstab state=absent regexp="^#"'</p> 
</blockquote> 
<h3 id="%C2%A0Replace%20%E6%A8%A1%E5%9D%97%C2%A0%20%C2%A0%C2%A0%E7%B1%BB%E4%BC%BC%E4%BA%8Esed%E5%91%BD%E4%BB%A4%C2%A0%E4%BA%8E%E6%AD%A3%E5%88%99%E8%BF%9B%E8%A1%8C%E5%8C%B9%E9%85%8D%E5%92%8C%E6%9B%BF%E6%8D%A2%EF%BC%8C%E5%BB%BA%E8%AE%AE%E4%BD%BF%E7%94%A8"> Replace 模块    类似于sed命令 于正则进行匹配和替换，建议使用</h3> 
<p>该模块有点类似于sed命令，主要也是基于正则进行匹配和替换，建议使用<br> 功能: 多行修改替换</p> 
<p>常见选项</p> 
<blockquote> 
 <p>path              #被控端文件的路径<br> regexp          #正则匹配语法格式,表示被替换的内容<br> replace          #替换为的内容<br> after               #插入到替换内容前面,<br> before            #插入到替换内容后面<br> backup           #修改前先备份<br> mode              #指定权限<br> owner             #指定用户<br> group              #指定组</p> 
</blockquote> 
<p>范例： </p> 
<blockquote> 
 <p>ansible 10.0.0.8 -m replace -a "path=/etc/httpd/conf/httpd.conf regexp='^Listen.*' replace='Listen 1234'"      #加.* 就是把后面换成1234 不加就在Listen后面加1234 后面不变</p> 
</blockquote> 
<h3 id="%C2%A0mount%20%E6%A8%A1%E5%9D%97%C2%A0%20%E5%8A%9F%E8%83%BD%3A%20%E6%8C%82%E8%BD%BD%E5%92%8C%E5%8D%B8%E8%BD%BD%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F">  SELinux 模块 该模块管理 SELInux （Linux 安全子系统）</h3> 
<p>功能: 该模块管理 SELInux 策略 常见选项</p> 
<blockquote> 
 <p>policy     #指定SELINUXTYPE=targeted</p> 
 <p>state      #指定SELINUX=disabled  （禁用，不提醒）改完需要重启     禁止改不了加强</p> 
 <p>               enforcing（加强安全，禁止一些东西，并报警） 这不需要重启   </p> 
 <p>                permissive（不加强，但是提醒） </p> 
</blockquote> 
<pre><code class="language-bash">[root@ansible ~]#ansible 10.0.0.8 -m selinux -a 'state=disabled'
[WARNING]: SELinux state temporarily changed from 'enforcing' to 'permissive'. 
State change will take effect next reboot.
10.0.0.8 | CHANGED =&gt; {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/libexec/platform-python"
   },
    "changed": true,
    "configfile": "/etc/selinux/config",
    "msg": "Config SELinux state changed from 'enforcing' to 'disabled'",
    "policy": "targeted",
    "reboot_required": true,
    "state": "disabled"
}

[root@centos8 ~]#grep -v '#' /etc/selinux/config
SELINUX=disabled
SELINUXTYPE=targeted
[root@centos8 ~]#getenforce 
Permissive
</code></pre> 
<h3 id="%C2%A0reboot%20%E6%A8%A1%E5%9D%97%20%E5%8A%9F%E8%83%BD%3A%20%E9%87%8D%E5%90%AF"> reboot 模块 功能: 重启 是立刻重启前面的会丢失notify重启前面不会</h3> 
<p>常见选项</p> 
<blockquote> 
 <p>msg                       #重启提示</p> 
 <p>pre_reboot_delay  #重启前延迟时间的秒数</p> 
 <p>post_reboot_delay #重启后延迟时间的秒数后,再验证系统正常启动</p> 
 <p>reboot_timeout       #重启后延迟时间再执行测试成功与否的命令</p> 
 <p>test_command      #执行测试成功与否的命令</p> 
</blockquote> 
<p>范例:</p> 
<pre><code class="language-bash">[root@ansible ~]#ansible webservers -m reboot -a 'msg="host will be reboot"'</code></pre> 
<h4 id="%C2%A0notify%20%E5%9C%A8%E4%B8%8D%E5%85%B3%E9%97%AD%E6%95%B4%E4%B8%AA%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%83%85%E5%86%B5%E4%B8%8B%E9%87%8D%E6%96%B0%E5%90%AF%E5%8A%A8%E5%8D%95%E4%B8%AA%E6%9C%8D%E5%8A%A1"> notify 在不关闭整个应用程序的情况下重新启动单个服务</h4> 
<p>notify这个action可用于在每个play的最后被触发，这样可以避免多次有改变发生时每次都执行指定的操作，取而代之，仅在所有的变化发生完成后一次性地执行指定操作。</p> 
<p></p> 
<p>承上启下，上面指定做什么，下面写任务，运行的时候就会在这里重启，且前面的数据不会丢 </p> 
<pre><code class="hljs">在task中使用notify关键字来指定处理程序的名称 ，例如：
- name: restart service
 service:
   name: nginx
   state: restarted
 notify: restart nginx

在playbook中定义处理程序的名称和执行操作，例如：

handlers:
 - name: restart nginx
   service:
     name: nginx
     state: restarted</code></pre> 
<p></p> 
<h3 id="mount%20%E6%A8%A1%E5%9D%97%C2%A0%20%E5%8A%9F%E8%83%BD%3A%20%E6%8C%82%E8%BD%BD%E5%92%8C%E5%8D%B8%E8%BD%BD%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F">mount 模块  功能: 挂载和卸载文件系统</h3> 
<p>常见选项</p> 
<blockquote> 
 <p>src              #源设备路径，或网络地址<br> path           #挂载至本地哪个路径下<br> fstype         #设备类型； nfs<br> opts           #挂载的选项<br> state          #挂载还是卸载<br>         =present                #永久挂载，但没有立即生效<br>         =absent                 #卸载临时挂载,并删除永久挂载<br>         =mounted             #永久和临时挂载<br>         =unmounted         #临时卸载</p> 
</blockquote> 
<p> 范例:</p> 
<blockquote> 
 <p>#修改fstab文件永久挂载,但不立即生效<br> mount webservers -m mount -a 'src="UUID=b3e48f45-f933-4c8e-a700-22a159ec9077"<br> path=/home fstype=xfs opts=noatime state=present'<br> #临时取消挂载<br> mount webservers -m mount -a 'path=/home fstype=xfs opts=noatime<br> state=unmounted'<br> #永久挂载,并立即生效<br> ansible webservers -m mount -a 'src=10.0.0.8:/data/wordpress<br> path=/var/www/html/wp-content/uploads opts="_netdev" state=mounted'<br> #永久卸载,并立即生效<br> ansible webservers -m mount -a 'src=10.0.0.8:/data/wordpress<br> path=/var/www/html/wp-content/uploads fstype=nfs state=absent'</p> 
</blockquote> 
<h3 id="%C2%A0Setup%20%E6%A8%A1%E5%9D%97%C2%A0%C2%A0%20setup%20%E6%A8%A1%E5%9D%97%E6%9D%A5%E6%94%B6%E9%9B%86%E4%B8%BB%E6%9C%BA%E7%9A%84%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF"> Setup 模块   setup 模块来收集主机的系统信息</h3> 
<p>功能： setup 模块来收集主机的系统信息，这些 facts 信息可以直接以变量的形式使用，但是如果主机较多，会影响执行速度<br> 可以使用 gather_facts: no 来禁止 Ansible 收集 facts 信息<br> 常见选项</p> 
<blockquote> 
 <p>filter #指定过滤条件</p> 
</blockquote> 
<p> 范例：</p> 
<blockquote> 
 <p>ansible all -m setup</p> 
 <p>ansible all -m setup &gt;ser/txt   #也可以这样收集起来、<br> ansible all -m setup -a "filter=ansible_nodename"    查看指定内用<br> ansible all -m setup -a "filter=ansible_hostname"<br> ansible all -m setup -a "filter=ansible_domain"<br> ansible all -m setup -a "filter=ansible_memtotal_mb"<br> ansible all -m setup -a "filter=ansible_memory_mb"<br> ansible all -m setup -a "filter=ansible_memfree_mb</p> 
</blockquote> 
<p> <img alt="" height="375" src="https://images2.imgbox.com/96/73/chkKiOfU_o.png" width="743"><img alt="" height="654" src="https://images2.imgbox.com/ee/90/GAuung1L_o.png" width="781"></p> 
<h3 id="%C2%A0%C2%A0debug%20%E6%A8%A1%E5%9D%97">  debug 模块 功能类似于echo命令</h3> 
<p>功能: 此模块可以用于输出信息,并且通过 msg 定制输出的信息内容,功能类似于echo命令<br> 注意: msg后面的变量有时需要加 " " 引起来</p> 
<p>常见选项</p> 
<blockquote> 
 <p>msg #指定命令输出的信息<br> var #指定变量名,和msg互斥<br> verbosity #详细度</p> 
</blockquote> 
<p>范例: debug 模块默认输出Hello world</p> 
<p> <img alt="" height="104" src="https://images2.imgbox.com/f2/9c/66WLTAKl_o.png" width="612"></p> 
<p>范例: 利用debug 输出shell命令的执行结果</p> 
<pre><code class="language-bash">[root@ansible ansible]#cat debug.yml 
- hosts: webservers
 remote_user: root
 tasks:
  - name: echo hello
   shell:
     cmd: echo hello
   register:
     result
  - name: Display all variables/facts known for a host
   debug:
     msg: "{<!-- -->{ result.stdout }}"</code></pre> 
<p></p> 
<h3 id="%C2%A0sysctl%20%E6%A8%A1%E5%9D%97%C2%A0%20%C2%A0%E5%8A%9F%E8%83%BD%3A%20%E4%BF%AE%E6%94%B9%E5%86%85%E6%A0%B8%E5%8F%82%E6%95%B0"> sysctl 模块   功能: 修改内核参数</h3> 
<p>功能: 修改内核参数<br> 常见选项</p> 
<blockquote> 
 <p>name #内核参数<br> value #指定值<br> state #是否保存在sysctl.conf文件中,默认present<br> sysctl_set #使用sysctl -w 验证值生效</p> 
</blockquote> 
<p> 范例：</p> 
<blockquote> 
 <p>ansible webservers -m sysctl -a 'name=net.ipv4.ip_forward value=1 state=present</p> 
</blockquote> 
<p>  范例: 内核参数优化</p> 
<p><img alt="" height="100" src="https://images2.imgbox.com/19/52/gVP6JYsE_o.png" width="510"></p> 
<p></p> 
<h3 id="%C2%A0pam_limits%C2%A0%20%C2%A0%20%C2%A0%C2%A0%E5%8A%9F%E8%83%BD%3A%20%E7%AE%A1%E7%90%86%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6"> pam_limits      功能: 管理资源限制</h3> 
<p>功能: 管理资源限制<br> 范例:</p> 
<pre><code class="language-bash">- name: Change Limit /etc/security/limit.conf
 pam_limits:
   domain: "*"
   limit_type: "{<!-- -->{ item.limit_type }}"
   limit_item: "{<!-- -->{ item.limit_item }}"
   value: "{<!-- -->{ item.value }}"
 loop:
   - { limit_type: 'soft', limit_item: 'nofile',value: '100000' }
   - { limit_type: 'hard', limit_item: 'nofile',value: '10000' }</code></pre> 
<h3 id="apt_repository%C2%A0%20%C2%A0%E6%AD%A4%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0apt%E7%9A%84%E4%BB%93%E5%BA%93%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86">apt_repository   此模块实现apt的仓库配置管理</h3> 
<p>模块 功能: 此模块实现apt的仓库配置管理</p> 
<p>常见选项</p> 
<blockquote> 
 <p>repo                         #仓库信息</p> 
 <p>state                        #添加或删除</p> 
 <p>update_cache         #是否apt update,默认yes</p> 
 <p>filename                 #仓库文件,默认放在/etc/apt/sources.list.d/file.list</p> 
</blockquote> 
<pre><code class="language-bash">ansible ubuntu-servers -m apt_repository -a 'repo="deb 
http://archive.canonical.com/ubuntu focal partner" filename=google-chrome'

[root@ubuntu2004 ~]#cat /etc/apt/sources.list.d/google-chrome.list
deb http://archive.canonical.com/ubuntu focal partner</code></pre> 
<h3 id="%C2%A0apt_key%20%E6%A8%A1%E5%9D%97%C2%A0%20%C2%A0%20%C2%A0%E6%B7%BB%E5%8A%A0%E5%92%8C%E5%88%A0%E9%99%A4apt%20key"> apt_key 模块     添加和删除apt key</h3> 
<p>功能: 添加和删除apt key</p> 
<p>常见选项</p> 
<blockquote> 
 <p>url               #key路径</p> 
 <p>state           #添加或删除</p> 
</blockquote> 
<p> 范例: 生成ceph仓库配置</p> 
<pre><code class="language-bash">#先导入key,注意先后顺序
ansible ubuntu-servers -m apt_key -a
'url=https://download.ceph.com/keys/release.asc state=present'

#再生成apt配置,如果不导入key此步会出错
ansible ubuntu-servers -m apt_repository -a 'repo="deb 
http://mirror.tuna.tsinghua.edu.cn/ceph/debian-pacific focal main" 
filename=ansible_ceph'

#验证结果
[root@ubuntu2004 ~]#cat /etc/apt/sources.list.d/ansible_ceph.list 
deb http://mirror.tuna.tsinghua.edu.cn/ceph/debian-pacific focal main
</code></pre> 
<h2></h2>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9123c4400e5307d0c7b31bb2478c0cf8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Spring Boot 系列: 集成 Redis 数据库 分布式工具 Redisson 缓存 Spring Cache</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/aa221d4645f0f5ac8833287a69bd7965/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue高德地图关键词搜索，点击选点</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>