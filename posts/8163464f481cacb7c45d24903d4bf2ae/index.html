<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>c# mudbus TCP协议 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="c# mudbus TCP协议" />
<meta property="og:description" content="一、引言 建议先大致了解c# Socket通讯，之后再学习modbusTCP协议
ModbusTCP 协议概念：1996年施耐德公司推出基于以太网TCP/IP的Modbus协议。 Modbus协议是一项应用层报文传输协议,包括ASCII、RTU、TCP三种报文类型。报文格式是协议的重点。 TCP 协议 知道格式就完事了，主要是格式里面的数据。
二、ModbusTCP 报文格式–读取保持寄存器 1、ModbusTCP报文格式：报文头&#43;功能码&#43;数据 ① 报文头：服务器与客户端之间的“握手”，当一台服务器连接n台客户端，报文头能够保证服务器精准地给其中一客户端发送数据（或者服务器接收到数据，能够明白是哪一台客户端发送的）。
② 功能码：服务器与客户端交流是读取数据 还是写数据
③ 数据：读取的数据内容 或者要写数据的内容（前面一对乱七八糟 就是为了得到这个玩意）
2、报文头 报文头字节长度作用事务标志符2个字节Modbus 请求/响应事务（一般为16进制 00,00 ）协议标志符2个字节Modbus 协议（一般为00，00）长度 标志符2个字节单元标志符&#43;功能码&#43;数据 总共的字节数量（知道字节数，可以知道数据是否丢失）单元标志符1个字节总线的从站识别（相当于给每一个客户端一个号码/地址，知道你是谁） 一般格式为：
事务协议长度单元标志0x00,0x000x00,0x000x00,0x060x01 解释：报文格式均为16进制
事务/协议：0x00000000
长度：0x06 — 6个字节–后面的报文的字节总数量 ：单元1&#43;功能码1&#43;地址2&#43;线圈数量2
单元标识：0x01 —客户端号码/地址为1
2、功能码 Modbus的操作对象有四种：线圈、离散输入、保持寄存器、输入寄存器。占用一个字节
功能码含义0x01读线圈0x05写单个线圈0x0F写多个线圈0x02读离散量输入0x04读输入寄存器0x03读保持寄存器0x06写单个保持寄存器0x10写多个保持寄存器 不同的操作对象，报文格式不同，这里下面的主要介绍0x03 读保持寄存器----就是可以读取数据。
明白其中一种操作对象报文格式，其它功能码内容类似。
3、数据（寄存器） 读取保持寄存器报文又分为发送报文和返回报文两种
例如当你给服务器发送数据，这个数据格式是按照读保持寄存器报文格式发送的
服务器接收到你发的信息，就明白你是来读取数据的，之后就会回复给你信息，因为你发送很规范，服务器回复你的时候就会按照的你报文格式回复（返回报文格式）
发送报文格式如下：
起始地址低位、起始地址高位、线圈数量高位、线圈数量低位均占一个字节
事务协议缩写 0x00000000，实际为：0x00，0x00，0x00，0x00
长度缩写0x0006，实际为：0x00，0x06
--------------报文头--------------功能------------------------数据-------------------------- 事务协议长度单元标志功能码起始地址高位起始地址低位数量高位数量低位0x000000000x00060x010x030x000x6B0x000x02 发送报文含义：
读取1号服务器保持寄存器(数据)，数据起始地址0x6B=107，对应地址40108，读取寄存器数量0x02=2，即读取1号数据，地址从40108-40109，共两个寄存器数组（4个字节）。
为什么地址是从40000开始，因为读保持寄存器地址为0x03；前面有0x00、0x01、0x02。
返回报文格式如下：
事务协议缩写 0x00000000，实际为：0x00，0x00，0x00，0x00
长度缩写0x0006，实际为：0x00，0x06
--------------报文头--------------功能----------------------------------数据----------------------------------- 事务协议长度单元标志功能码字节数量1寄存器高位1寄存器低位2寄存器高位2寄存器低位0x000000000x00070x010x030x040x000x010x000x02 返回报文含义：
返回服务器1号从站保持寄存器40108-40109，共两个寄存器的数值，返回的字节数为4个
40108对应数值为0x0001,40109对应数值为0x00109；转换为10进制分别为1和2；
即读取到数据为1 和 2" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/8163464f481cacb7c45d24903d4bf2ae/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-03T09:33:16+08:00" />
<meta property="article:modified_time" content="2023-06-03T09:33:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">c# mudbus TCP协议</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>一、引言</h2> 
<p>建议先大致了解c# Socket通讯，之后再学习modbusTCP协议<br> ModbusTCP 协议概念：1996年<strong>施耐德</strong>公司推出基于以太网TCP/IP的Modbus协议。 Modbus协议是一项应用层报文传输协议,包括<strong>ASCII、RTU、TCP</strong>三种报文类型。<strong>报文格式是协议的重点。</strong> TCP 协议 知道格式就完事了，主要是格式里面的数据。</p> 
<h2><a id="ModbusTCP__3"></a>二、ModbusTCP 报文格式–读取保持寄存器</h2> 
<h3><a id="1ModbusTCP_4"></a>1、<strong>ModbusTCP报文格式：报文头+功能码+数据</strong></h3> 
<p>① 报文头：服务器与客户端之间的“握手”，当一台服务器连接n台客户端，报文头能够保证服务器精准地给其中一客户端发送数据（或者服务器接收到数据，能够明白是哪一台客户端发送的）。<br> ② 功能码：服务器与客户端交流是读取数据 还是写数据<br> ③ 数据：读取的数据内容 或者要写数据的内容（前面一对乱七八糟 就是为了得到这个玩意）</p> 
<h3><a id="2_9"></a>2、报文头</h3> 
<table><thead><tr><th>报文头</th><th>字节长度</th><th>作用</th></tr></thead><tbody><tr><td>事务标志符</td><td>2个字节</td><td>Modbus 请求/响应事务（一般为16进制 00,00 ）</td></tr><tr><td>协议标志符</td><td>2个字节</td><td>Modbus 协议（一般为00，00）</td></tr><tr><td>长度 标志符</td><td>2个字节</td><td>单元标志符+功能码+数据 总共的字节数量（知道字节数，可以知道数据是否丢失）</td></tr><tr><td>单元标志符</td><td>1个字节</td><td>总线的从站识别（相当于给每一个客户端一个号码/地址，知道你是谁）</td></tr></tbody></table> 
<p>一般格式为：</p> 
<table><thead><tr><th>事务</th><th>协议</th><th>长度</th><th>单元标志</th></tr></thead><tbody><tr><td>0x00,0x00</td><td>0x00,0x00</td><td>0x00,0x06</td><td>0x01</td></tr></tbody></table> 
<p>解释：报文格式均为16进制<br> 事务/协议：0x00000000<br> 长度：0x06 — 6个字节–后面的报文的字节总数量 ：单元1+功能码1+地址2+线圈数量2<br> 单元标识：0x01 —客户端号码/地址为1</p> 
<h3><a id="2_26"></a>2、功能码</h3> 
<p>Modbus的操作对象有四种：线圈、离散输入、保持寄存器、输入寄存器。占用一个字节</p> 
<table><thead><tr><th>功能码</th><th>含义</th></tr></thead><tbody><tr><td>0x01</td><td>读线圈</td></tr><tr><td>0x05</td><td>写单个线圈</td></tr><tr><td>0x0F</td><td>写多个线圈</td></tr><tr><td>0x02</td><td>读离散量输入</td></tr><tr><td>0x04</td><td>读输入寄存器</td></tr><tr><td>0x03</td><td>读保持寄存器</td></tr><tr><td>0x06</td><td>写单个保持寄存器</td></tr><tr><td>0x10</td><td>写多个保持寄存器</td></tr></tbody></table> 
<p>不同的操作对象，报文格式不同，这里下面的主要介绍0x03 <strong>读保持寄存器</strong>----就是可以读取数据。<br> 明白其中一种操作对象报文格式，其它功能码内容类似。</p> 
<h3><a id="3_42"></a>3、数据（寄存器）</h3> 
<p>读取保持寄存器报文又分为<strong>发送报文</strong>和<strong>返回报文</strong>两种<br> 例如当你给服务器发送数据，这个数据格式是按照<strong>读保持寄存器</strong>报文格式发送的<br> 服务器接收到你发的信息，就明白你是来读取数据的，之后就会回复给你信息，因为你发送很规范，服务器回复你的时候就会按照的你报文格式回复（<strong>返回报文格式</strong>）</p> 
<p><strong>发送报文格式如下：</strong><br> 起始地址低位、起始地址高位、线圈数量高位、线圈数量低位均占一个字节<br> 事务协议缩写 0x00000000，实际为：0x00，0x00，0x00，0x00<br> 长度缩写0x0006，实际为：0x00，0x06</p> 
<table><thead><tr><th>--------------报文头--------------</th><th>功能</th><th>------------------------数据--------------------------</th></tr></thead></table> 
<table><thead><tr><th>事务协议</th><th>长度</th><th>单元标志</th><th>功能码</th><th>起始地址高位</th><th>起始地址低位</th><th>数量高位</th><th>数量低位</th></tr></thead><tbody><tr><td>0x00000000</td><td>0x0006</td><td>0x01</td><td>0x03</td><td>0x00</td><td>0x6B</td><td>0x00</td><td>0x02</td></tr></tbody></table> 
<p><strong>发送报文含义：</strong><br> 读取1号服务器保持寄存器(数据)，数据起始地址0x6B=107，对应地址40108，读取寄存器数量0x02=2，即读取1号数据，地址从40108-40109，共两个寄存器数组（4个字节）。<br> 为什么地址是从40000开始，因为读保持寄存器地址为0x03；前面有0x00、0x01、0x02。</p> 
<p>返回报文格式如下：<br> 事务协议缩写 0x00000000，实际为：0x00，0x00，0x00，0x00<br> 长度缩写0x0006，实际为：0x00，0x06</p> 
<table><thead><tr><th>--------------报文头--------------</th><th>功能</th><th>----------------------------------数据-----------------------------------</th></tr></thead></table> 
<table><thead><tr><th>事务协议</th><th>长度</th><th>单元标志</th><th>功能码</th><th>字节数量</th><th>1寄存器高位</th><th>1寄存器低位</th><th>2寄存器高位</th><th>2寄存器低位</th></tr></thead><tbody><tr><td>0x00000000</td><td>0x0007</td><td>0x01</td><td>0x03</td><td>0x04</td><td>0x00</td><td>0x01</td><td>0x00</td><td>0x02</td></tr></tbody></table> 
<p><strong>返回报文含义：</strong><br> 返回服务器1号从站保持寄存器40108-40109，共两个寄存器的数值，返回的字节数为4个<br> 40108对应数值为0x0001,40109对应数值为0x00109；转换为10进制分别为1和2；<br> 即读取到数据为1 和 2</p> 
<h2><a id="C_ModbusTCP_80"></a>三、C# ModbusTCP编程</h2> 
<h3><a id="1_81"></a>1、通讯连接</h3> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">bool</span></span> <span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//实例化</span>
    tcpClient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Socket</span><span class="token punctuation">(</span>AddressFamily<span class="token punctuation">.</span>InterNetwork<span class="token punctuation">,</span> SocketType<span class="token punctuation">.</span>Stream<span class="token punctuation">,</span> ProtocolType<span class="token punctuation">.</span>Tcp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{<!-- --></span>
         <span class="token comment">//连接</span>
         tcpClient<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>IPAddress<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>IPAddress<span class="token punctuation">)</span><span class="token punctuation">,</span> Port<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
         <span class="token comment">//日志处理</span>
          <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="2_102"></a>2、断开通讯</h3> 
<pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DisConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>tcpClient <span class="token operator">!=</span><span class="token keyword">null</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        tcpClient<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="2_113"></a>2、读取保持型寄存器</h3> 
<pre><code class="prism language-csharp"> <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">ushort</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token function">ReadHoldingRegisters</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">ushort</span></span> start<span class="token punctuation">,</span><span class="token class-name"><span class="token keyword">ushort</span></span> length<span class="token punctuation">)</span>
 <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//五步走</span>

            <span class="token comment">//1、拼接报文</span>

            <span class="token comment">//集合放整个报文码</span>
            <span class="token class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">&gt;</span></span> SendCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//事务 协议</span>
            SendCommand<span class="token punctuation">.</span><span class="token function">AddRange</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{<!-- --></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//长度--两个字节  </span>
            SendCommand<span class="token punctuation">.</span><span class="token function">AddRange</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{<!-- --></span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//单元标志符</span>
            SendCommand<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>SlaveId<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//功能码</span>
            SendCommand<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">0x03</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//数据 起始寄存器地址+寄存器数量 两个字节组成</span>

            <span class="token comment">//起始寄存器地址</span>
            SendCommand<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span>start <span class="token operator">/</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//获得高位  一个字节8位 1111 1111为255    寄存器地址由两个字节组成 例如:1234 5678 0000 0000  高位：1234 5678</span>
            SendCommand<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span>start <span class="token operator">%</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//获得低位  1234 5678 0000 0000  低位：0000 0000</span>

            <span class="token comment">//读寄存器数量</span>
            SendCommand<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span>length <span class="token operator">/</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            SendCommand<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span><span class="token punctuation">(</span>length<span class="token operator">%</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//2、发送报文</span>
            <span class="token comment">//SendCommand.ToArray() 集合变数值</span>
            tcpClient<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>SendCommand<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//3、接收报文</span>
            <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span><span class="token number">512</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token comment">//Receive(buffer) 返回字节的长度</span>
            <span class="token class-name"><span class="token keyword">int</span></span> count <span class="token operator">=</span> tcpClient<span class="token punctuation">.</span><span class="token function">Receive</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//4、验证报文 读二个寄存器 返回长度7 读三个寄存器返回9</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>count<span class="token operator">==</span><span class="token number">2</span><span class="token operator">*</span>length<span class="token operator">+</span><span class="token number">9</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//获取真正的报文 字节数组的截取</span>
                <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> des <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">;</span>

                <span class="token comment">//将buffer复制给des </span>
                Array<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> des<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">//返回的报文 des[0]--des[5] 前6个字节为 事务2个字节 协议2个字节 长度2个字节</span>
                <span class="token comment">//接下来是 单元标识1个字节  功能码1个字节 字节计数1个字节</span>
                <span class="token comment">//二次验证 des[6]为单位识别码；des[5]为高位识别码  des[7]为功能码 des[8]为字节计数</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>des<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">==</span> SlaveId <span class="token operator">&amp;&amp;</span> des<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0x03</span><span class="token operator">&amp;&amp;</span>des<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">2</span><span class="token operator">*</span>length<span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//5、解析报文</span>

                    <span class="token comment">//字节数组截取</span>
                    <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> res <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span></span><span class="token punctuation">[</span>count<span class="token punctuation">]</span><span class="token punctuation">;</span> 
                    <span class="token comment">//将des复制给res  des[9] 第九位为信息 高位和低位</span>
                    Array<span class="token punctuation">.</span><span class="token function">Copy</span><span class="token punctuation">(</span>des<span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> res<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token comment">//解析  BitConverter.ToUInt16()将字节数组转换unint无符号的整数</span>

                    <span class="token class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">ushort</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span><span class="token keyword">ushort</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> res<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">+=</span><span class="token number">2</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        result<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>Convert<span class="token punctuation">.</span><span class="token function">ToUInt16</span><span class="token punctuation">(</span> res<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">*</span><span class="token number">256</span> <span class="token operator">+</span> res<span class="token punctuation">[</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">//result.Add(BitConverter.ToUInt16(res, i));</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">return</span> result<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2a311e2b68494dd72453654af2195a63/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java中的适配器模式（Adapter Pattern）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a93779726e636b7d6bc03f5c69908f45/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python-while循环</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>