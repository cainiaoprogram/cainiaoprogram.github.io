<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>linux 脚本 中断,Shell脚本中断后进行运行 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="linux 脚本 中断,Shell脚本中断后进行运行" />
<meta property="og:description" content="我以前一直使用一个脚本下载Ubuntu的源，Ubuntu 12.04的源，全部大概是120G，我1M带宽，要下载完，真的要10天时间。脚本运行过程中经常因为网络各种原因，中途退出和中断。
如果能让脚本退出后，自动继续运行呢？这是困惑我很久的问题，今天请教同事，终于搞定。
原理就是设置Crontab，检查一下脚本是否在运行，如果没有运行，就运行该脚本。如果在运行，就不进行任何操作。
我的ubuntu 下载脚本名字为：ubuntu_mirror.sh
编辑该脚本
在开始部分，增加下面内容
#!/bin/sh
appname=`basename $0`
nowdate=`date &#43;%Y%m%d%H%M%S`
echo $$ &gt; ${nowdate}.${appname}.pid
在脚本末尾，有两个退出 ： exit 1 和 exit 0
就是在exit 1 和exit 0 上面添加一行
rm ${nowdate}.${appname}.pid
创建一个master.sh 脚本
appname=$1
if [ -e *.${appname}.pid ]; then
exit 0
else
echo &#34;running&#34;
nohup sh -x ./${appname} 1&gt;${appname}.out 2&gt;&amp;1 &amp;
fi
让脚本可运行
chmod &#43;x master.sh
最后你需要设置crontab
运行命令
crontab -e
插入下面内容,表示10分钟运行一次.
0,10,20,30,40,50 * * * * /root/master.sh ubuntu_mirror.sh" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/2015ff26f8ac978c8158b8ff90b355dd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-02T10:58:42+08:00" />
<meta property="article:modified_time" content="2021-05-02T10:58:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">linux 脚本 中断,Shell脚本中断后进行运行</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>我以前一直使用一个脚本下载Ubuntu的源，Ubuntu 12.04的源，全部大概是120G，我1M带宽，要下载完，真的要10天时间。脚本运行过程中经常因为网络各种原因，中途退出和中断。</p> 
 <p>如果能让脚本退出后，自动继续运行呢？这是困惑我很久的问题，今天请教同事，终于搞定。</p> 
 <p>原理就是设置Crontab，检查一下脚本是否在运行，如果没有运行，就运行该脚本。如果在运行，就不进行任何操作。</p> 
 <p>我的ubuntu 下载脚本名字为：ubuntu_mirror.sh</p> 
 <p>编辑该脚本</p> 
 <p>在开始部分，增加下面内容</p> 
 <p>#!/bin/sh</p> 
 <p>appname=`basename $0`</p> 
 <p>nowdate=`date +%Y%m%d%H%M%S`</p> 
 <p>echo $$ &gt; ${nowdate}.${appname}.pid</p> 
 <p>在脚本末尾，有两个退出 ： exit 1 和  exit 0</p> 
 <p>就是在exit 1 和exit 0 上面添加一行</p> 
 <p>rm ${nowdate}.${appname}.pid</p> 
 <p>创建一个master.sh 脚本</p> 
 <p>appname=$1</p> 
 <p>if [ -e *.${appname}.pid ]; then</p> 
 <p>exit 0</p> 
 <p>else</p> 
 <p>echo "running"</p> 
 <p>nohup sh -x ./${appname} 1&gt;${appname}.out 2&gt;&amp;1 &amp;</p> 
 <p>fi</p> 
 <p>让脚本可运行</p> 
 <p>chmod +x master.sh</p> 
 <p>最后你需要设置crontab</p> 
 <p>运行命令</p> 
 <p>crontab -e</p> 
 <p>插入下面内容,表示10分钟运行一次.</p> 
 <p>0,10,20,30,40,50 * * * * /root/master.sh ubuntu_mirror.sh</p> 
 <p>这个时候,在脚本的目录里,可以看到一个类似 20131127223001.ubuntu_mirror.sh.pid 文件,就是脚本运行的进程id.</p> 
 <p># cat 20131127223001.ubuntu_mirror.sh.pid</p> 
 <p>12549</p> 
 <p>脚本退出后,会删除这个文件.如果crontab检查到这个文件存在,就不会运行脚本,认为脚本正在运行.如果不存在pid脚本,就会运行该脚本.</p> 
 <p>无比感谢武同学的指导.</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/90102260dd2bd188466d1825d8ad2748/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">linux服务器无法识别u盘,linux系统下不能识别U盘</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/97cd405570e1be57d9e4a83cdea2e849/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">acwing-843.n-皇后问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>