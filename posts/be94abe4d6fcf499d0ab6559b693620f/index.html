<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Ubuntué…ç½®Yolov8ç¯å¢ƒå¹¶è®­ç»ƒè‡ªå·±çš„æ•°æ®é›† &#43; ROSå®æ—¶è¿è¡Œ - èœé¸Ÿç¨‹åºå‘˜åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Ubuntué…ç½®Yolov8ç¯å¢ƒå¹¶è®­ç»ƒè‡ªå·±çš„æ•°æ®é›† &#43; ROSå®æ—¶è¿è¡Œ" />
<meta property="og:description" content="æ–‡ç« ç›®å½• ä¸€ã€ç¯å¢ƒé…ç½®ä¸åŠŸèƒ½æµ‹è¯•1.1 å®‰è£…1.2 ç›®æ ‡æ£€æµ‹1.3 å®ä¾‹åˆ†å‰²1.4 åˆ†ç±»1.5 å§¿æ€æ£€æµ‹ äºŒã€è®­ç»ƒæ•°æ®æ ‡æ³¨ä¸‰ã€æ•°æ®é›†è®­ç»ƒæ–¹æ³•3.1 å‘½ä»¤è®­ç»ƒ3.2 ä»£ç è®­ç»ƒ å››ã€Yolov8åœ¨ROSä¸­å®æ—¶è¿è¡Œ4.1 yolov8_ros4.2 ultralytics_ros å‰è¨€ï¼šéœ€è¦å…ˆå®‰è£…CUDAå’ŒAnacondaï¼Œå®ƒä»¬çš„å®‰è£…å‚è€ƒæˆ‘è¿™ç¯‡æ–‡ç« ï¼šUbuntué…ç½®æ·±åº¦å­¦ä¹ ç¯å¢ƒï¼ˆTensorFlowå’ŒPyTorchï¼‰
ä¸€ã€ç¯å¢ƒé…ç½®ä¸åŠŸèƒ½æµ‹è¯• 1.1 å®‰è£… æ–°å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒä¸‹å®‰è£…ï¼š
# æ–°å»ºè™šæ‹Ÿç¯å¢ƒ conda create -n yolov8 python=3.8 # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ conda activate yolov8 pip install ultralytics # ä½¿ç”¨æ¸…åå¤§å­¦çš„é•œåƒæºå®‰è£… pip install ultralytics -i https://pypi.tuna.tsinghua.edu.cn/simple/ æºç å®‰è£…ï¼š
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ conda activate yolov8 # éœ€è¦å•ç‹¬å®‰è£…torch conda install pytorch==2.0.0 torchvision==0.15.0 torchaudio==2.0.0 pytorch-cuda=11.7 -c pytorch -c nvidia git clone https://github.com/ultralytics/ultralytics.git cd ultralytics # å®‰è£…ä¾èµ– pip install -r requirements.txt # ä½¿ç”¨æ¸…åå¤§å­¦çš„é•œåƒæºå®‰è£… pip install -r requirements." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/be94abe4d6fcf499d0ab6559b693620f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-06T14:36:41+08:00" />
<meta property="article:modified_time" content="2024-01-06T14:36:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="èœé¸Ÿç¨‹åºå‘˜åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">èœé¸Ÿç¨‹åºå‘˜åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Ubuntué…ç½®Yolov8ç¯å¢ƒå¹¶è®­ç»ƒè‡ªå·±çš„æ•°æ®é›† &#43; ROSå®æ—¶è¿è¡Œ</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>æ–‡ç« ç›®å½•</h4> 
 <ul><li><a href="#_4" rel="nofollow">ä¸€ã€ç¯å¢ƒé…ç½®ä¸åŠŸèƒ½æµ‹è¯•</a></li><li><ul><li><a href="#11__5" rel="nofollow">1.1 å®‰è£…</a></li><li><a href="#12__34" rel="nofollow">1.2 ç›®æ ‡æ£€æµ‹</a></li><li><a href="#13__83" rel="nofollow">1.3 å®ä¾‹åˆ†å‰²</a></li><li><a href="#14__93" rel="nofollow">1.4 åˆ†ç±»</a></li><li><a href="#15__98" rel="nofollow">1.5 å§¿æ€æ£€æµ‹</a></li></ul> 
  </li><li><a href="#_105" rel="nofollow">äºŒã€è®­ç»ƒæ•°æ®æ ‡æ³¨</a></li><li><a href="#_127" rel="nofollow">ä¸‰ã€æ•°æ®é›†è®­ç»ƒæ–¹æ³•</a></li><li><ul><li><a href="#31__242" rel="nofollow">3.1 å‘½ä»¤è®­ç»ƒ</a></li><li><a href="#32__269" rel="nofollow">3.2 ä»£ç è®­ç»ƒ</a></li></ul> 
  </li><li><a href="#Yolov8ROS_318" rel="nofollow">å››ã€Yolov8åœ¨ROSä¸­å®æ—¶è¿è¡Œ</a></li><li><ul><li><a href="#41_yolov8_ros_319" rel="nofollow">4.1 yolov8_ros</a></li><li><a href="#42_ultralytics_ros_347" rel="nofollow">4.2 ultralytics_ros</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<p>å‰è¨€ï¼šéœ€è¦å…ˆå®‰è£…CUDAå’ŒAnacondaï¼Œå®ƒä»¬çš„å®‰è£…å‚è€ƒæˆ‘è¿™ç¯‡æ–‡ç« ï¼š<a href="https://blog.csdn.net/zardforever123/article/details/133432077?spm=1001.2014.3001.5501">Ubuntué…ç½®æ·±åº¦å­¦ä¹ ç¯å¢ƒï¼ˆTensorFlowå’ŒPyTorchï¼‰</a></p> 
<h2><a id="_4"></a>ä¸€ã€ç¯å¢ƒé…ç½®ä¸åŠŸèƒ½æµ‹è¯•</h2> 
<h3><a id="11__5"></a>1.1 å®‰è£…</h3> 
<p>æ–°å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒä¸‹å®‰è£…ï¼š</p> 
<pre><code class="prism language-bash"><span class="token comment"># æ–°å»ºè™šæ‹Ÿç¯å¢ƒ</span>
conda create <span class="token parameter variable">-n</span> yolov8 <span class="token assign-left variable">python</span><span class="token operator">=</span><span class="token number">3.8</span>
<span class="token comment"># æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span>
conda activate yolov8


pip <span class="token function">install</span> ultralytics  
<span class="token comment"># ä½¿ç”¨æ¸…åå¤§å­¦çš„é•œåƒæºå®‰è£…</span>
pip <span class="token function">install</span> ultralytics <span class="token parameter variable">-i</span>  https://pypi.tuna.tsinghua.edu.cn/simple/
</code></pre> 
<p>æºç å®‰è£…ï¼š</p> 
<pre><code class="prism language-bash"><span class="token comment"># æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span>
conda activate yolov8
<span class="token comment"># éœ€è¦å•ç‹¬å®‰è£…torch</span>
conda <span class="token function">install</span> <span class="token assign-left variable">pytorch</span><span class="token operator">==</span><span class="token number">2.0</span>.0 <span class="token assign-left variable">torchvision</span><span class="token operator">==</span><span class="token number">0.15</span>.0 <span class="token assign-left variable">torchaudio</span><span class="token operator">==</span><span class="token number">2.0</span>.0 pytorch-cuda<span class="token operator">=</span><span class="token number">11.7</span> <span class="token parameter variable">-c</span> pytorch <span class="token parameter variable">-c</span> nvidia


<span class="token function">git</span> clone https://github.com/ultralytics/ultralytics.git
<span class="token builtin class-name">cd</span> ultralytics
<span class="token comment"># å®‰è£…ä¾èµ–</span>
pip <span class="token function">install</span> <span class="token parameter variable">-r</span> requirements.txt
<span class="token comment"># ä½¿ç”¨æ¸…åå¤§å­¦çš„é•œåƒæºå®‰è£…</span>
pip <span class="token function">install</span> <span class="token parameter variable">-r</span> requirements.txt <span class="token parameter variable">-i</span>  https://pypi.tuna.tsinghua.edu.cn/simple/
</code></pre> 
<h3><a id="12__34"></a>1.2 ç›®æ ‡æ£€æµ‹</h3> 
<pre><code class="prism language-bash"><span class="token comment">#æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span>
conda activate yolov8

<span class="token comment">#å®˜æ–¹çš„æµ‹è¯•æ¡ˆä¾‹è¿›è¡Œç¨‹åºçš„æ¨ç†æµ‹è¯•ï¼š</span>
yolo <span class="token assign-left variable">task</span><span class="token operator">=</span>detect <span class="token assign-left variable">mode</span><span class="token operator">=</span>predict <span class="token assign-left variable">model</span><span class="token operator">=</span>yolov8n.pt <span class="token assign-left variable">source</span><span class="token operator">=</span>/home/zard/Pictures/2.jpeg  <span class="token assign-left variable">device</span><span class="token operator">=</span>cpu <span class="token assign-left variable">save</span><span class="token operator">=</span>True <span class="token assign-left variable">show</span><span class="token operator">=</span>True
<span class="token comment"># ä»»åŠ¡æ¨¡å‹task=detectï¼ŒYOLOv8å¯ç”¨äºæ£€æµ‹ï¼Œåˆ†å‰²ï¼Œå§¿æ€å’Œåˆ†ç±»</span>
<span class="token comment"># ä¼šè‡ªåŠ¨ä¸‹è½½æƒé‡æ–‡ä»¶https://github.com/ultralytics/assets/releases/download/v0.0.0/yolov8n.ptåˆ°å½“å‰ç›®å½•</span>
<span class="token comment"># æ¨ç†çš„æ•°æ®ä¸ºsource</span>
<span class="token comment"># è¿™æ˜¯CPUè¿›è¡Œæµ‹è¯•çš„ï¼Œå°†deviceæ”¹ä¸º0ç”¨GPU</span>
</code></pre> 
<p>ç»“æœå¦‚ä¸‹ï¼Œç»“æœä¿å­˜åœ¨å½“å‰è·¯å¾„ä¸‹çš„runs/detect/predictæ–‡ä»¶å¤¹ä¸­ï¼š</p> 
<pre><code class="prism language-bash">Ultralytics YOLOv8.0.145 ğŸš€ Python-3.7.16 torch-1.13.1+cu117 CPU <span class="token punctuation">(</span>12th Gen Intel Core<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> i5-12500H<span class="token punctuation">)</span>
YOLOv8n summary <span class="token punctuation">(</span>fused<span class="token punctuation">)</span>: <span class="token number">168</span> layers, <span class="token number">3151904</span> parameters, <span class="token number">0</span> gradients

image <span class="token number">1</span>/1 /home/zard/Pictures/2.jpeg: 480x640 <span class="token number">4</span> persons, <span class="token number">5</span> cars, <span class="token number">1</span> motorcycle, <span class="token number">1</span> suitcase, <span class="token number">32</span>.9ms
Speed: <span class="token number">1</span>.8ms preprocess, <span class="token number">32</span>.9ms inference, <span class="token number">0</span>.7ms postprocess per image at shape <span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">3</span>, <span class="token number">480</span>, <span class="token number">640</span><span class="token punctuation">)</span>
Results saved to runs/detect/predict
</code></pre> 
<p><img src="https://images2.imgbox.com/3f/8a/BWWKSQ5i_o.jpg" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> GPUè¿è¡Œ</p> 
<pre><code class="prism language-bash">yolo <span class="token assign-left variable">task</span><span class="token operator">=</span>detect <span class="token assign-left variable">mode</span><span class="token operator">=</span>predict <span class="token assign-left variable">model</span><span class="token operator">=</span>yolov8n.pt <span class="token assign-left variable">source</span><span class="token operator">=</span>/home/zard/Pictures/1.jpeg  <span class="token assign-left variable">device</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">save</span><span class="token operator">=</span>True <span class="token assign-left variable">show</span><span class="token operator">=</span>True

Ultralytics YOLOv8.0.145 ğŸš€ Python-3.7.16 torch-1.13.1+cu117 CUDA:0 <span class="token punctuation">(</span>NVIDIA GeForce RTX <span class="token number">3060</span> Laptop GPU, 5930MiB<span class="token punctuation">)</span>
YOLOv8n summary <span class="token punctuation">(</span>fused<span class="token punctuation">)</span>: <span class="token number">168</span> layers, <span class="token number">3151904</span> parameters, <span class="token number">0</span> gradients

image <span class="token number">1</span>/1 /home/zard/Pictures/1.jpeg: 448x640 <span class="token number">7</span> persons, <span class="token number">6</span> cars, <span class="token number">2</span> buss, <span class="token number">6</span>.8ms
Speed: <span class="token number">1</span>.5ms preprocess, <span class="token number">6</span>.8ms inference, <span class="token number">0</span>.8ms postprocess per image at shape <span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">3</span>, <span class="token number">448</span>, <span class="token number">640</span><span class="token punctuation">)</span>
Results saved to runs/detect/predict2
</code></pre> 
<p>ä¹Ÿå¯ä»¥è¾“å…¥æ–‡ä»¶å¤¹ï¼Œå¤„ç†å¤šå¼ å›¾ç‰‡ï¼š</p> 
<pre><code class="prism language-bash">yolo <span class="token assign-left variable">task</span><span class="token operator">=</span>detect <span class="token assign-left variable">mode</span><span class="token operator">=</span>predict <span class="token assign-left variable">model</span><span class="token operator">=</span>yolov8n.pt <span class="token assign-left variable">source</span><span class="token operator">=</span>/home/zard/Pictures/  <span class="token assign-left variable">device</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">save</span><span class="token operator">=</span>True <span class="token assign-left variable">show</span><span class="token operator">=</span>True
Ultralytics YOLOv8.0.145 ğŸš€ Python-3.7.16 torch-1.13.1+cu117 CUDA:0 <span class="token punctuation">(</span>NVIDIA GeForce RTX <span class="token number">3060</span> Laptop GPU, 5930MiB<span class="token punctuation">)</span>
YOLOv8n summary <span class="token punctuation">(</span>fused<span class="token punctuation">)</span>: <span class="token number">168</span> layers, <span class="token number">3151904</span> parameters, <span class="token number">0</span> gradients

image <span class="token number">1</span>/3 /home/zard/Pictures/1.jpeg: 448x640 <span class="token number">7</span> persons, <span class="token number">6</span> cars, <span class="token number">2</span> buss, <span class="token number">7</span>.0ms
image <span class="token number">2</span>/3 /home/zard/Pictures/2.jpeg: 480x640 <span class="token number">4</span> persons, <span class="token number">5</span> cars, <span class="token number">1</span> motorcycle, <span class="token number">1</span> suitcase, <span class="token number">6</span>.9ms
image <span class="token number">3</span>/3 /home/zard/Pictures/3.jpeg: 448x640 <span class="token number">7</span> persons, <span class="token number">1</span> car, <span class="token number">2</span> trucks, <span class="token number">3</span>.7ms
Speed: <span class="token number">1</span>.8ms preprocess, <span class="token number">5</span>.9ms inference, <span class="token number">0</span>.6ms postprocess per image at shape <span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">3</span>, <span class="token number">448</span>, <span class="token number">640</span><span class="token punctuation">)</span>
Results saved to runs/detect/predict3
</code></pre> 
<h3><a id="13__83"></a>1.3 å®ä¾‹åˆ†å‰²</h3> 
<pre><code class="prism language-bash"><span class="token comment">#æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span>
conda activate yolov8

yolo <span class="token assign-left variable">task</span><span class="token operator">=</span>segment <span class="token assign-left variable">mode</span><span class="token operator">=</span>predict <span class="token assign-left variable">model</span><span class="token operator">=</span>/home/zard/yolov8s-seg.pt <span class="token assign-left variable">source</span><span class="token operator">=</span>/home/zard/Pictures/2.jpeg <span class="token assign-left variable">device</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">save</span><span class="token operator">=</span>True <span class="token assign-left variable">show</span><span class="token operator">=</span>True

<span class="token comment"># è‡ªåŠ¨ä¸‹è½½æƒé‡æ–‡ä»¶https://github.com/ultralytics/assets/releases/download/v0.0.0/yolov8s-seg.pt</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/9c/a6/TeSkWNag_o.jpg" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="14__93"></a>1.4 åˆ†ç±»</h3> 
<pre><code class="prism language-bash">yolo <span class="token assign-left variable">task</span><span class="token operator">=</span>classify <span class="token assign-left variable">mode</span><span class="token operator">=</span>predict <span class="token assign-left variable">model</span><span class="token operator">=</span>yolov8x-cls.pt <span class="token assign-left variable">source</span><span class="token operator">=</span>/home/zard/Pictures/2.jpeg <span class="token assign-left variable">device</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">save</span><span class="token operator">=</span>True <span class="token assign-left variable">show</span><span class="token operator">=</span>True
</code></pre> 
<h3><a id="15__98"></a>1.5 å§¿æ€æ£€æµ‹</h3> 
<pre><code class="prism language-bash">yolo <span class="token assign-left variable">task</span><span class="token operator">=</span>pose <span class="token assign-left variable">mode</span><span class="token operator">=</span>predict <span class="token assign-left variable">model</span><span class="token operator">=</span>/home/zard/yolov8s-pose.pt <span class="token assign-left variable">source</span><span class="token operator">=</span>/home/zard/Pictures/2.jpeg <span class="token assign-left variable">device</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">save</span><span class="token operator">=</span>True <span class="token assign-left variable">show</span><span class="token operator">=</span>True
</code></pre> 
<p><img src="https://images2.imgbox.com/04/81/BKkLIJ8H_o.jpg" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"><br> <img src="https://images2.imgbox.com/d0/b0/6M4HrVI8_o.jpg" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"></p> 
<h2><a id="_105"></a>äºŒã€è®­ç»ƒæ•°æ®æ ‡æ³¨</h2> 
<p>å®‰è£…æ•°æ®æ ‡æ³¨ç¯å¢ƒï¼š</p> 
<pre><code class="prism language-bash"><span class="token comment">#æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span>
conda activate yolov8
pip <span class="token function">install</span> labelImg
<span class="token comment"># ä½¿ç”¨æ¸…åå¤§å­¦çš„é•œåƒæºå®‰è£…</span>
pip <span class="token function">install</span> labelImg <span class="token parameter variable">-i</span>  https://pypi.tuna.tsinghua.edu.cn/simple/

labelImg
</code></pre> 
<p>labelImgå…è®¸ç”¨æˆ·åœ¨å›¾åƒä¸­ç»˜åˆ¶è¾¹ç•Œæ¡†ã€å¤šè¾¹å½¢ã€çº¿æ¡å’Œç‚¹ç­‰æ¥æ ‡æ³¨ä¸åŒç±»å‹çš„å¯¹è±¡æˆ–ç‰¹å¾ã€‚ä¹Ÿå¯ä»¥æ ‡æ³¨æ ‡æ³¨ç±»åˆ«ï¼Œç”¨æˆ·å¯ä»¥å®šä¹‰ä¸åŒçš„æ ‡æ³¨ç±»åˆ«ï¼Œä½¿å…¶é€‚åº”ä¸åŒçš„é¡¹ç›®éœ€æ±‚ã€‚æ¯ä¸ªç±»åˆ«éƒ½å¯ä»¥æœ‰è‡ªå·±çš„åç§°å’Œé¢œè‰²ã€‚æˆ‘è¿™é‡Œä»ç½‘ä¸Šéšä¾¿æ‰¾äº†ä¸€äº›ç‹—å­çš„ç…§ç‰‡ç¤ºä¾‹ï¼š<br> é€‰æ‹©è¦æ ‡æ³¨çš„æ•°æ®å’Œè¾“å‡ºç›®å½•ï¼Œå³ä¸‹è§’ä¼šå‡ºç°ç›®å½•ä¸‹æ‰€æœ‰å›¾ç‰‡ï¼š<br> <img src="https://images2.imgbox.com/d9/6c/RgbDpVh4_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>æ›´æ”¹æ•°æ®çš„æ ‡æ³¨ç»“æœæ ¼å¼ï¼Œç‚¹å‡»saveä¸‹é¢æŒ‰é’®é€‰æ‹©è¾“å‡ºä¸ºYOLO<br> <img src="https://images2.imgbox.com/82/06/zelOMdIV_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> ç‚¹å‡»Creat RectBoxæ¡†é€‰ç›®æ ‡ï¼Œå¡«å…¥æ ‡ç­¾ï¼š<br> <img src="https://images2.imgbox.com/e5/be/42P4dmF9_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> æ¯ä¸€å¸§æ ‡æ³¨å®Œæˆåå‡è¦ç‚¹å‡»saveï¼Œä¼šåœ¨è¾“å‡ºè·¯å¾„ä¸‹ç”Ÿæˆç»“æœï¼Œå…¶ä¸­.txtæ–‡ä»¶åŒ…å«å›¾ç‰‡ä¸­çš„ç‰©ä½“ä¿¡æ¯åŠå¯¹åº”çš„ä½ç½®ä¹‹ç±»çš„ï¼Œclass.txtåˆ—å‡ºæ‰€æœ‰çš„æ ‡ç­¾ï¼š<br> <img src="https://images2.imgbox.com/2a/83/O6ToIL4G_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="_127"></a>ä¸‰ã€æ•°æ®é›†è®­ç»ƒæ–¹æ³•</h2> 
<p>æ ‡æ³¨å®Œæˆåï¼Œåˆ›å»ºdataæ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨imagesä¸­æ”¾ç½®æ‰€æœ‰æ ‡æ³¨åŸå›¾ï¼Œlabelsä¿å­˜æ¯ä¸ªå›¾ç‰‡å¯¹åº”çš„æ ‡ç­¾æ–‡ä»¶ï¼ˆ.txtï¼‰ï¼ŒdataSetç”¨æ¥ä¿å­˜æ•°æ®é›†åˆ’åˆ†ï¼Œä¾‹å¦‚è®­ç»ƒé›†ã€éªŒè¯é›†å’Œæµ‹è¯•é›†ï¼Œé€šå¸¸ä»¥æ–‡æœ¬æ–‡ä»¶çš„å½¢å¼åˆ—å‡ºæ¯ä¸ªæ•°æ®é›†ä¸­çš„å›¾åƒåç§°æˆ–IDï¼Œä½¿ç”¨ä¸‹é¢è„šæœ¬ç”Ÿæˆæ•°æ®é›†åˆ’åˆ†ï¼š</p> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>

<span class="token keyword">import</span> os
<span class="token keyword">import</span> random
<span class="token keyword">import</span> argparse
 
parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># æ ‡æ³¨æ–‡ä»¶çš„åœ°å€ï¼Œæ ¹æ®è‡ªå·±çš„æ•°æ®è¿›è¡Œä¿®æ”¹</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--label_path'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'./labels'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'input label path'</span><span class="token punctuation">)</span>
<span class="token comment"># æ•°æ®é›†çš„åˆ’åˆ†ï¼Œåœ°å€é€‰æ‹©è‡ªå·±æ•°æ®dataSetä¸‹</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--txt_path'</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token string">'./dataSet'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">str</span><span class="token punctuation">,</span> <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'output dataset path'</span><span class="token punctuation">)</span>
opt <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
 
<span class="token comment"># è®­ç»ƒä¸æµ‹è¯•æ•°æ®é›†æ¯”ä¾‹</span>
trainval_percent <span class="token operator">=</span> <span class="token number">1.0</span>
train_percent <span class="token operator">=</span> <span class="token number">0.9</span>
labelfilepath <span class="token operator">=</span> opt<span class="token punctuation">.</span>label_path
txtsavepath <span class="token operator">=</span> opt<span class="token punctuation">.</span>txt_path
<span class="token comment"># è¯»å–æ‰€æœ‰å·²ç»æ ‡æ³¨æ–‡ä»¶çš„åç§°</span>
total_label <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>labelfilepath<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>txtsavepath<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>txtsavepath<span class="token punctuation">)</span>
 
num <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>total_label<span class="token punctuation">)</span>
list_index <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span>
tv <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>num <span class="token operator">*</span> trainval_percent<span class="token punctuation">)</span>
tr <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>tv <span class="token operator">*</span> train_percent<span class="token punctuation">)</span>
trainval <span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>list_index<span class="token punctuation">,</span> tv<span class="token punctuation">)</span>
train <span class="token operator">=</span> random<span class="token punctuation">.</span>sample<span class="token punctuation">(</span>trainval<span class="token punctuation">,</span> tr<span class="token punctuation">)</span>

file_trainval <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>txtsavepath <span class="token operator">+</span> <span class="token string">'/trainval.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
file_test <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>txtsavepath <span class="token operator">+</span> <span class="token string">'/test.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
file_train <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>txtsavepath <span class="token operator">+</span> <span class="token string">'/train.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
file_val <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>txtsavepath <span class="token operator">+</span> <span class="token string">'/val.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
 
<span class="token keyword">for</span> i <span class="token keyword">in</span> list_index<span class="token punctuation">:</span>
    name <span class="token operator">=</span> total_label<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'\n'</span>
    <span class="token comment"># æ’é™¤æ‰ç”Ÿæˆçš„classes.txtæ–‡ä»¶</span>
    <span class="token keyword">if</span> name<span class="token operator">==</span><span class="token string">'classes'</span> <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">:</span>
        <span class="token keyword">continue</span>
    <span class="token keyword">if</span> i <span class="token keyword">in</span> trainval<span class="token punctuation">:</span>
        file_trainval<span class="token punctuation">.</span>write<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
        <span class="token keyword">if</span> i <span class="token keyword">in</span> train<span class="token punctuation">:</span>
            file_train<span class="token punctuation">.</span>write<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            file_val<span class="token punctuation">.</span>write<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        file_test<span class="token punctuation">.</span>write<span class="token punctuation">(</span>name<span class="token punctuation">)</span>
        
file_trainval<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
file_train<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
file_val<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
file_test<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>å†ç”¨ä¸‹é¢è„šæœ¬å°†æ•°æ®ç»„ç»‡æˆYolov8éœ€è¦çš„å½¢å¼ï¼ˆè®­ç»ƒä¸éªŒè¯æ•°æ®é›†ä¸‹å‡åŒ…å«å›¾åƒä¸å¯¹åº”çš„æ ‡ç­¾æ–‡ä»¶å¤¹ï¼‰ï¼š</p> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>

<span class="token keyword">import</span> os<span class="token punctuation">,</span>shutil
rootpath<span class="token operator">=</span><span class="token string">"/home/zard/Pictures/data/"</span><span class="token comment">#å¾…ä¿®æ”¹è·¯å¾„</span>
<span class="token comment"># è¾“å‡ºè·¯å¾„</span>
imgtrain<span class="token operator">=</span>rootpath<span class="token operator">+</span><span class="token string">"train/images/"</span>
imgval<span class="token operator">=</span>rootpath<span class="token operator">+</span><span class="token string">"val/images/"</span>
labeltrain<span class="token operator">=</span>rootpath<span class="token operator">+</span><span class="token string">"train/labels/"</span>
labelval<span class="token operator">=</span>rootpath<span class="token operator">+</span><span class="token string">"val/labels/"</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>imgtrain<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>imgtrain<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>imgval<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>imgval<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>labeltrain<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>labeltrain<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>labelval<span class="token punctuation">)</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>labelval<span class="token punctuation">)</span>

f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>rootpath<span class="token operator">+</span><span class="token string">"dataSet/train.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span>
lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
	shutil<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>rootpath<span class="token operator">+</span><span class="token string">"images/"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">".jpg"</span><span class="token punctuation">,</span>imgtrain<span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">".jpg"</span><span class="token punctuation">)</span>
    shutil<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>rootpath <span class="token operator">+</span> <span class="token string">"labels/"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".txt"</span><span class="token punctuation">,</span> labeltrain <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".txt"</span><span class="token punctuation">)</span>
 
f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>rootpath<span class="token operator">+</span><span class="token string">"dataSet/val.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span>
lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
    shutil<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>rootpath<span class="token operator">+</span><span class="token string">"images/"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">".jpg"</span><span class="token punctuation">,</span>imgval<span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">".jpg"</span><span class="token punctuation">)</span>
    shutil<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>rootpath <span class="token operator">+</span> <span class="token string">"labels/"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".txt"</span><span class="token punctuation">,</span> labelval <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".txt"</span><span class="token punctuation">)</span>
shutil<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>rootpath<span class="token operator">+</span><span class="token string">"dataSet/train.txt"</span><span class="token punctuation">,</span>rootpath<span class="token operator">+</span><span class="token string">"train.txt"</span><span class="token punctuation">)</span>
shutil<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>rootpath<span class="token operator">+</span><span class="token string">"dataSet/trainval.txt"</span><span class="token punctuation">,</span>rootpath<span class="token operator">+</span><span class="token string">"trainval.txt"</span><span class="token punctuation">)</span>
shutil<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>rootpath<span class="token operator">+</span><span class="token string">"dataSet/test.txt"</span><span class="token punctuation">,</span>rootpath<span class="token operator">+</span><span class="token string">"test.txt"</span><span class="token punctuation">)</span>
shutil<span class="token punctuation">.</span>copy<span class="token punctuation">(</span>rootpath<span class="token operator">+</span><span class="token string">"dataSet/val.txt"</span><span class="token punctuation">,</span>rootpath<span class="token operator">+</span><span class="token string">"val.txt"</span><span class="token punctuation">)</span>
</code></pre> 
<p>ç„¶åç¼–å†™ymalæ–‡ä»¶ï¼Œ${Youpath}æ›¿æ¢ä¸ºä½ çš„è·¯å¾„ï¼š</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">train</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>Youpath<span class="token punctuation">}</span>/data/train/images
<span class="token key atrule">val</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>Youpath<span class="token punctuation">}</span>/data/val/images
<span class="token key atrule">test</span><span class="token punctuation">:</span> $<span class="token punctuation">{<!-- --></span>Youpath<span class="token punctuation">}</span>/data/test/images

<span class="token comment"># number of classes</span>
<span class="token key atrule">nc</span><span class="token punctuation">:</span> <span class="token number">1</span>

<span class="token comment"># class names</span>
<span class="token key atrule">names</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'dog'</span><span class="token punctuation">]</span>
</code></pre> 
<p>ç„¶åå»Yoloæºç é‡Œæ‰¾åˆ°yolov8.yamlå‚æ•°æ–‡ä»¶ï¼Œå¤åˆ¶ä¸€ä»½å¹¶ä¿®æ”¹ï¼š</p> 
<pre><code class="prism language-bash">nc: <span class="token number">1</span>  <span class="token comment"># number of classes</span>
</code></pre> 
<p>æœ€åçš„æ–‡ä»¶ç»“æ„å¦‚ä¸‹ï¼Œè“è‰²æ–‡ä»¶å¤¹ä¸‹å‡ä¸ºå›¾åƒå’Œå¯¹åº”çš„æ ‡æ³¨æ–‡ä»¶ï¼š<br> <img src="https://images2.imgbox.com/10/82/Ie0iHAQo_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="31__242"></a>3.1 å‘½ä»¤è®­ç»ƒ</h3> 
<pre><code class="prism language-bash"><span class="token comment">#æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span>
conda activate yolov8

<span class="token builtin class-name">cd</span> <span class="token variable">${Youpath}</span>/data
yolo <span class="token assign-left variable">task</span><span class="token operator">=</span>detect <span class="token assign-left variable">mode</span><span class="token operator">=</span>train <span class="token assign-left variable">model</span><span class="token operator">=</span>yolov8.yaml <span class="token assign-left variable">data</span><span class="token operator">=</span>dog.yaml <span class="token assign-left variable">batch</span><span class="token operator">=</span><span class="token number">32</span> <span class="token assign-left variable">epochs</span><span class="token operator">=</span><span class="token number">100</span> <span class="token assign-left variable">imgsz</span><span class="token operator">=</span><span class="token number">640</span> <span class="token assign-left variable">workers</span><span class="token operator">=</span><span class="token number">16</span> <span class="token assign-left variable">device</span><span class="token operator">=</span><span class="token number">0</span>
</code></pre> 
<p>modeléƒ¨åˆ†å¯ä»¥è¿›è¡Œæ¨¡å‹çš„é€‰æ‹©ä¸æ›´æ”¹ï¼Œå…¶ä½™çš„å‚æ•°éƒ½å¯ä»¥æ ¹æ®è‡ªå·±ç”µè„‘çš„æ€§èƒ½è¿›è¡Œä¿®æ”¹ã€‚è®­ç»ƒå®Œæˆåå°±å¯ä»¥è¿›å…¥runsæ–‡ä»¶å¤¹ä¸‹é¢çœ‹è‡ªå·±çš„è®­ç»ƒæˆæœï¼š<br> <img src="https://images2.imgbox.com/b5/bb/7RSDaMbr_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> ç»“æœå¦‚ä¸‹ï¼ŒåŒ…æ‹¬ä¸€äº›å›¾è¡¨å’ŒéªŒè¯ç»“æœï¼šå…¶ä¸­weightsä¸‹åŒ…å«ä¸¤ä¸ªè®­ç»ƒçš„æƒé‡æ–‡ä»¶ï¼ˆæœ€å¥½çš„ å’Œ ä¸Šä¸€æ¬¡çš„ï¼‰<br> <img src="https://images2.imgbox.com/0d/1a/rtluLPJq_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> åˆ©ç”¨è®­ç»ƒå¾—åˆ°çš„æƒé‡æ¨ç†ï¼š</p> 
<pre><code class="prism language-bash"><span class="token comment">#æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span>
conda activate yolov8
yolo <span class="token assign-left variable">task</span><span class="token operator">=</span>detect <span class="token assign-left variable">mode</span><span class="token operator">=</span>predict <span class="token assign-left variable">model</span><span class="token operator">=</span>best.pt <span class="token assign-left variable">source</span><span class="token operator">=</span><span class="token number">15</span>.jpg  <span class="token assign-left variable">device</span><span class="token operator">=</span>cpu <span class="token assign-left variable">save</span><span class="token operator">=</span>True <span class="token assign-left variable">show</span><span class="token operator">=</span>True
</code></pre> 
<p>ç”±äºå°±åªæœ‰åå‡ å¼ å›¾ç‰‡ï¼Œæ²¡æœ‰è®­ç»ƒå‡ºæ¥æ•ˆæœå°±ä¸å±•ç¤ºäº†<br> best.ptè¿˜å¯ä»¥ä½œä¸ºä¸‹ä¸€æ¬¡è®­ç»ƒçš„åˆå€¼ï¼š</p> 
<pre><code class="prism language-bash"><span class="token comment">#æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span>
conda activate yolov8
yolo <span class="token assign-left variable">task</span><span class="token operator">=</span>detect <span class="token assign-left variable">mode</span><span class="token operator">=</span>predict <span class="token assign-left variable">model</span><span class="token operator">=</span> ./runs/detect/train/weights/best.pt <span class="token assign-left variable">source</span><span class="token operator">=</span><span class="token number">15</span>.jpg  <span class="token assign-left variable">device</span><span class="token operator">=</span>cpu <span class="token assign-left variable">save</span><span class="token operator">=</span>True <span class="token assign-left variable">show</span><span class="token operator">=</span>True
</code></pre> 
<h3><a id="32__269"></a>3.2 ä»£ç è®­ç»ƒ</h3> 
<p>è®­ç»ƒï¼š</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> ultralytics <span class="token keyword">import</span> YOLO

<span class="token comment"># Load a model</span>
<span class="token comment"># model = YOLO('yolov8n.pt')  # load a pretrained model (recommended for training)</span>
<span class="token comment"># model = YOLO('./runs/detect/train/weights/best.pt')  # load a pretrained model (recommended for training)</span>
model <span class="token operator">=</span> YOLO<span class="token punctuation">(</span><span class="token string">'yolov8.yaml'</span><span class="token punctuation">)</span>  <span class="token comment"># load a pretrained model (recommended for training)</span>

<span class="token comment"># Train the model</span>
model<span class="token punctuation">.</span>train<span class="token punctuation">(</span>data<span class="token operator">=</span><span class="token string">'dog.yaml'</span><span class="token punctuation">,</span> epochs<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">,</span> imgsz<span class="token operator">=</span><span class="token number">640</span>ï¼Œworkers<span class="token operator">=</span><span class="token number">16</span> device<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p>è¿è¡Œï¼Œä¸ä¸Šé¢æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼š</p> 
<pre><code class="prism language-bash"><span class="token comment">#æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span>
conda activate yolov8
python3 train.py
</code></pre> 
<p>æ¨ç†ï¼š</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> ultralytics <span class="token keyword">import</span> YOLO
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">import</span> cv2

model <span class="token operator">=</span> YOLO<span class="token punctuation">(</span><span class="token string">"runs/detect/train/weights/best.pt"</span><span class="token punctuation">)</span>
<span class="token comment"># accepts all fonmats - image/dir/Path/URL/video/PIL/ndarray. 0 for webcamresults = model.predict(source="0")</span>
<span class="token comment"># results = model.predict(source="0") # ç”¨æ‘„åƒå¤´</span>
<span class="token comment"># results = model.predict(source="folder",show=True)# Display preds. Accepts all YoLO predict argument</span>


<span class="token comment">#from PIL</span>
im1 <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"15.jpg"</span><span class="token punctuation">)</span>
results <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>source<span class="token operator">=</span>im1<span class="token punctuation">,</span> save<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment"># save plotted images</span>

<span class="token comment">#from ndarray</span>
<span class="token comment"># im2 = cv2.imread("test.jpg")</span>
<span class="token comment"># results = model.predict(source=im2,save=True,save_txt=True) # save predictions as labels</span>
<span class="token comment"># #from list of PIL/ndancay</span>
<span class="token comment"># results = model. predict(source=[im1, im2])</span>
</code></pre> 
<p>è¿è¡Œï¼š</p> 
<pre><code class="prism language-bash"><span class="token comment">#æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ</span>
conda activate yolov8
python3 train.py
</code></pre> 
<h2><a id="Yolov8ROS_318"></a>å››ã€Yolov8åœ¨ROSä¸­å®æ—¶è¿è¡Œ</h2> 
<h3><a id="41_yolov8_ros_319"></a>4.1 yolov8_ros</h3> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> yolov8_ros/src <span class="token parameter variable">-p</span>
<span class="token builtin class-name">cd</span> yolov8_ros/src
<span class="token function">git</span> clone https://github.com/qq44642754a/Yolov8_ros.git
<span class="token builtin class-name">cd</span> <span class="token punctuation">..</span>
catkin_make
</code></pre> 
<p>ä½¿ç”¨TUMæ•°æ®é›†æµ‹è¯•ï¼Œå›¾åƒè¯é¢˜å‚æ•°ä¿®æ”¹å¦‚ä¸‹ï¼š</p> 
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>param <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"image_topic"</span>       <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token string">"/camera/rgb/image_color"</span> /<span class="token operator">&gt;</span>
</code></pre> 
<pre><code class="prism language-bash">rosbag play rgbd_dataset_freiburg3_walking_rpy.bag
roslaunch yolov8_ros yolo_v8.launch
</code></pre> 
<p>å¦‚æœæŠ¥é”™ï¼šImportError: No module named cv2ï¼Œè¯´æ˜rosè°ƒç”¨äº†python2ï¼Œä¿®æ”¹ï¼š</p> 
<pre><code class="prism language-bash"><span class="token shebang important">#!/usr/bin/env python3</span>
-- coding: utf-8 --
</code></pre> 
<p><img src="https://images2.imgbox.com/f8/89/gJgJowbv_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="42_ultralytics_ros_347"></a>4.2 ultralytics_ros</h3> 
<p>è¿™ä¸ªç›¸å¯¹åŠŸèƒ½æ›´å…¨é¢ä¸€ç‚¹</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> yolov8_ros/src
<span class="token function">git</span> clone <span class="token parameter variable">-b</span> noetic-devel https://github.com/Alpaca-zip/ultralytics_ros.git
<span class="token function">git</span> clone <span class="token parameter variable">-b</span> noetic-devel https://github.com/ros-perception/vision_msgs.git
python3 <span class="token parameter variable">-m</span> pip <span class="token function">install</span> <span class="token parameter variable">-r</span> ultralytics_ros/requirements.txt
<span class="token builtin class-name">cd</span> yolov8_ros
rosdep <span class="token function">install</span> <span class="token parameter variable">-r</span> <span class="token parameter variable">-y</span> <span class="token parameter variable">-i</span> --from-paths <span class="token builtin class-name">.</span>
catkin build
</code></pre> 
<p>ä½¿ç”¨TUMæ•°æ®é›†æµ‹è¯•ï¼Œå‚æ•°ä¿®æ”¹å¦‚ä¸‹ï¼š</p> 
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>arg <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"input_topic"</span> <span class="token assign-left variable">default</span><span class="token operator">=</span><span class="token string">"/camera/rgb/image_color"</span>/<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>arg <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"device"</span> <span class="token assign-left variable">default</span><span class="token operator">=</span><span class="token string">"0"</span>/<span class="token operator">&gt;</span>
</code></pre> 
<pre><code class="prism language-bash">rosbag play rgbd_dataset_freiburg3_walking_rpy.bag
roslaunch ultralytics_ros tracker.launch
</code></pre> 
<p><img src="https://images2.imgbox.com/20/35/q6uutmYf_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>ä»£ç é˜…è¯»ï¼ˆyoloè·Ÿè¸ªæˆ–è€…åˆ†å‰²çš„æ•°æ®è·å–ï¼‰</p> 
<pre><code class="prism language-python"><span class="token comment">#!/usr/bin/env python3</span>
<span class="token comment"># æŒ‡å®šè„šæœ¬ä½¿ç”¨çš„Pythonè§£é‡Šå™¨</span>

<span class="token keyword">import</span> cv_bridge <span class="token comment"># å¯¼å…¥cv_bridgeæ¨¡å—ï¼Œç”¨äºROSå›¾åƒæ¶ˆæ¯å’ŒOpenCVå›¾åƒæ ¼å¼ä¹‹é—´çš„è½¬æ¢</span>
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> roslib<span class="token punctuation">.</span>packages
<span class="token keyword">import</span> rospy
<span class="token keyword">from</span> sensor_msgs<span class="token punctuation">.</span>msg <span class="token keyword">import</span> Image
<span class="token keyword">from</span> ultralytics <span class="token keyword">import</span> YOLO
<span class="token keyword">from</span> vision_msgs<span class="token punctuation">.</span>msg <span class="token keyword">import</span> Detection2D<span class="token punctuation">,</span> Detection2DArray<span class="token punctuation">,</span> ObjectHypothesisWithPose
<span class="token keyword">from</span> ultralytics_ros<span class="token punctuation">.</span>msg <span class="token keyword">import</span> YoloResult

<span class="token keyword">class</span> <span class="token class-name">TrackerNode</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># åˆå§‹åŒ–èŠ‚ç‚¹çš„å‚æ•°</span>
        <span class="token comment"># æŒ‡å®šæ¥æ”¶å›¾åƒæ•°æ®çš„ROSè¯é¢˜</span>
        self<span class="token punctuation">.</span>input_topic <span class="token operator">=</span> rospy<span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">"~input_topic"</span><span class="token punctuation">,</span> <span class="token string">"image_raw"</span><span class="token punctuation">)</span>
        <span class="token comment"># å°†æ£€æµ‹ç»“æœå‘å¸ƒåˆ°çš„ROSè¯é¢˜</span>
        self<span class="token punctuation">.</span>result_topic <span class="token operator">=</span> rospy<span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">"~result_topic"</span><span class="token punctuation">,</span> <span class="token string">"yolo_result"</span><span class="token punctuation">)</span>
        <span class="token comment"># ç»“æœå›¾åƒå‘å¸ƒçš„ROSè¯é¢˜åç§°</span>
        self<span class="token punctuation">.</span>result_image_topic <span class="token operator">=</span> rospy<span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">"~result_image_topic"</span><span class="token punctuation">,</span> <span class="token string">"yolo_image"</span><span class="token punctuation">)</span>

        <span class="token comment"># æŒ‡å®šè¦ä½¿ç”¨çš„YOLOæ¨¡å‹</span>
        yolo_model <span class="token operator">=</span> rospy<span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">"~yolo_model"</span><span class="token punctuation">,</span> <span class="token string">"yolov8n.pt"</span><span class="token punctuation">)</span>
        <span class="token comment"># ç½®ä¿¡åº¦é˜ˆå€¼ï¼Œé»˜è®¤å€¼ä¸º0.25ã€‚ç”¨äºè¿‡æ»¤æ£€æµ‹ç»“æœçš„ç½®ä¿¡åº¦é˜ˆå€¼ï¼Œä½äºè¯¥å€¼çš„ç»“æœä¼šè¢«ä¸¢å¼ƒã€‚</span>
        self<span class="token punctuation">.</span>conf_thres <span class="token operator">=</span> rospy<span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">"~conf_thres"</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">)</span> 
        <span class="token comment"># IoUï¼ˆäº¤å¹¶æ¯”ï¼‰é˜ˆå€¼ï¼Œé»˜è®¤å€¼ä¸º0.45ã€‚è¡¨ç¤ºä¸¤ä¸ªè¾¹ç•Œæ¡†ä¹‹é—´çš„æœ€å°IoUé˜ˆå€¼ï¼Œç”¨äºéæå¤§å€¼æŠ‘åˆ¶ï¼ˆNMSï¼‰ã€‚</span>
        self<span class="token punctuation">.</span>iou_thres <span class="token operator">=</span> rospy<span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">"~iou_thres"</span><span class="token punctuation">,</span> <span class="token number">0.45</span><span class="token punctuation">)</span>
        <span class="token comment"># æœ€å¤§æ£€æµ‹æ•°ï¼Œé»˜è®¤å€¼ä¸º300ã€‚æŒ‡å®šæ¯å¼ å›¾åƒä¸Šå…è®¸çš„æœ€å¤§æ£€æµ‹æ•°é‡ã€‚</span>
        self<span class="token punctuation">.</span>max_det <span class="token operator">=</span> rospy<span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">"~max_det"</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">)</span>
        <span class="token comment"># éœ€è¦æ£€æµ‹çš„ç±»åˆ«ï¼Œé»˜è®¤ä¸ºNoneã€‚å¯ä»¥æŒ‡å®šè¦æ£€æµ‹çš„ç‰¹å®šç±»åˆ«ï¼Œå¦‚æœä¸ºNoneï¼Œåˆ™æ£€æµ‹æ‰€æœ‰ç±»åˆ«ã€‚</span>
        self<span class="token punctuation">.</span>classes <span class="token operator">=</span> rospy<span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">"~classes"</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        <span class="token comment"># è·Ÿè¸ªå™¨çš„é…ç½®æ–‡ä»¶è·¯å¾„æˆ–åç§°ï¼Œé»˜è®¤å€¼ä¸º"bytetrack.yaml"ã€‚ç”¨äºæŒ‡å®šç›®æ ‡è·Ÿè¸ªå™¨çš„é…ç½®ã€‚</span>
        self<span class="token punctuation">.</span>tracker <span class="token operator">=</span> rospy<span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">"~tracker"</span><span class="token punctuation">,</span> <span class="token string">"bytetrack.yaml"</span><span class="token punctuation">)</span>
        <span class="token comment"># è®¾å¤‡ç±»å‹ï¼Œé»˜è®¤ä¸ºNoneã€‚æŒ‡å®šæ¨¡å‹çš„è¿è¡Œæ˜¾å¡è®¾å¤‡ï¼Œä¾‹å¦‚"cpu"æˆ–"cuda:0"ç­‰ã€‚</span>
        self<span class="token punctuation">.</span>device <span class="token operator">=</span> rospy<span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">"~device"</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>

        <span class="token comment"># result_confï¼šæ˜¯å¦åœ¨ç»“æœå›¾åƒä¸­æ˜¾ç¤ºç½®ä¿¡åº¦ï¼Œé»˜è®¤ä¸ºTrueã€‚æ§åˆ¶æ˜¯å¦åœ¨è¾“å‡ºå›¾åƒä¸­æ˜¾ç¤ºæ£€æµ‹æ¡†çš„ç½®ä¿¡åº¦ã€‚</span>
        <span class="token comment"># result_line_widthï¼šç»“æœå›¾åƒä¸­æ£€æµ‹æ¡†çš„çº¿å®½ï¼Œé»˜è®¤ä¸ºNoneã€‚æŒ‡å®šåœ¨ç»“æœå›¾åƒä¸­ç»˜åˆ¶æ£€æµ‹æ¡†çš„çº¿å®½ã€‚</span>
        <span class="token comment"># result_font_sizeï¼šç»“æœå›¾åƒä¸­æ–‡æœ¬çš„å­—ä½“å¤§å°ï¼Œé»˜è®¤ä¸ºNoneã€‚æŒ‡å®šåœ¨ç»“æœå›¾åƒä¸­æ˜¾ç¤ºçš„æ–‡æœ¬çš„å­—ä½“å¤§å°ã€‚</span>
        <span class="token comment"># result_fontï¼šç»“æœå›¾åƒä¸­æ–‡æœ¬çš„å­—ä½“åç§°ï¼Œé»˜è®¤ä¸º"Arial.ttf"ã€‚æŒ‡å®šåœ¨ç»“æœå›¾åƒä¸­æ˜¾ç¤ºçš„æ–‡æœ¬çš„å­—ä½“ã€‚</span>
        <span class="token comment"># result_labelsï¼šæ˜¯å¦åœ¨ç»“æœå›¾åƒä¸­æ˜¾ç¤ºæ ‡ç­¾ï¼Œé»˜è®¤ä¸ºTrueã€‚æ§åˆ¶æ˜¯å¦åœ¨è¾“å‡ºå›¾åƒä¸­æ˜¾ç¤ºç±»åˆ«æ ‡ç­¾ã€‚</span>
        <span class="token comment"># result_boxesï¼šæ˜¯å¦åœ¨ç»“æœå›¾åƒä¸­æ˜¾ç¤ºè¾¹ç•Œæ¡†ï¼Œé»˜è®¤ä¸ºTrueã€‚æ§åˆ¶æ˜¯å¦åœ¨è¾“å‡ºå›¾åƒä¸­æ˜¾ç¤ºæ£€æµ‹æ¡†ã€‚</span>
        self<span class="token punctuation">.</span>result_conf <span class="token operator">=</span> rospy<span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">"~result_conf"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>result_line_width <span class="token operator">=</span> rospy<span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">"~result_line_width"</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>result_font_size <span class="token operator">=</span> rospy<span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">"~result_font_size"</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>result_font <span class="token operator">=</span> rospy<span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">"~result_font"</span><span class="token punctuation">,</span> <span class="token string">"Arial.ttf"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>result_labels <span class="token operator">=</span> rospy<span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">"~result_labels"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>result_boxes <span class="token operator">=</span> rospy<span class="token punctuation">.</span>get_param<span class="token punctuation">(</span><span class="token string">"~result_boxes"</span><span class="token punctuation">,</span> <span class="token boolean">True</span><span class="token punctuation">)</span>

        <span class="token comment"># åŠ è½½YOLOæ¨¡å‹</span>
        path <span class="token operator">=</span> roslib<span class="token punctuation">.</span>packages<span class="token punctuation">.</span>get_pkg_dir<span class="token punctuation">(</span><span class="token string">"ultralytics_ros"</span><span class="token punctuation">)</span>  <span class="token comment"># è·å–ultralytics_rosè½¯ä»¶åŒ…çš„è·¯å¾„</span>
        self<span class="token punctuation">.</span>model <span class="token operator">=</span> YOLO<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>path<span class="token punctuation">}</span></span><span class="token string">/models/</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>yolo_model<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>  <span class="token comment"># åŠ è½½YOLOæ¨¡å‹</span>
        self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>fuse<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># åŠ è½½æ¨¡å‹æƒé‡</span>

        <span class="token comment"># åˆ›å»ºROSè®¢é˜…å™¨å’Œå‘å¸ƒå™¨</span>
        self<span class="token punctuation">.</span>sub <span class="token operator">=</span> rospy<span class="token punctuation">.</span>Subscriber<span class="token punctuation">(</span>
            self<span class="token punctuation">.</span>input_topic<span class="token punctuation">,</span>
            Image<span class="token punctuation">,</span>
            self<span class="token punctuation">.</span>image_callback<span class="token punctuation">,</span>
            queue_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
            buff_size<span class="token operator">=</span><span class="token number">2</span><span class="token operator">**</span><span class="token number">24</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>results_pub <span class="token operator">=</span> rospy<span class="token punctuation">.</span>Publisher<span class="token punctuation">(</span>self<span class="token punctuation">.</span>result_topic<span class="token punctuation">,</span> YoloResult<span class="token punctuation">,</span> queue_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>result_image_pub <span class="token operator">=</span> rospy<span class="token punctuation">.</span>Publisher<span class="token punctuation">(</span>self<span class="token punctuation">.</span>result_image_topic<span class="token punctuation">,</span> Image<span class="token punctuation">,</span> queue_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>bridge <span class="token operator">=</span> cv_bridge<span class="token punctuation">.</span>CvBridge<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># æ£€æŸ¥æ˜¯å¦ä½¿ç”¨åˆ†å‰²æ¨¡å‹</span>
        self<span class="token punctuation">.</span>use_segmentation <span class="token operator">=</span> yolo_model<span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">"-seg.pt"</span><span class="token punctuation">)</span>

    <span class="token comment"># å›¾åƒå›è°ƒå‡½æ•°ï¼Œç”¨äºæ¥æ”¶ä¼ æ„Ÿå™¨å›¾åƒæ¶ˆæ¯</span>
    <span class="token keyword">def</span> <span class="token function">image_callback</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
        cv_image <span class="token operator">=</span> self<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span>imgmsg_to_cv2<span class="token punctuation">(</span>msg<span class="token punctuation">,</span> desired_encoding<span class="token operator">=</span><span class="token string">"bgr8"</span><span class="token punctuation">)</span>

        <span class="token comment"># ä½¿ç”¨YOLOæ¨¡å‹è¿›è¡Œç›®æ ‡è·Ÿè¸ª</span>
        results <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">.</span>track<span class="token punctuation">(</span>
            source<span class="token operator">=</span>cv_image<span class="token punctuation">,</span>
            conf<span class="token operator">=</span>self<span class="token punctuation">.</span>conf_thres<span class="token punctuation">,</span>
            iou<span class="token operator">=</span>self<span class="token punctuation">.</span>iou_thres<span class="token punctuation">,</span>
            max_det<span class="token operator">=</span>self<span class="token punctuation">.</span>max_det<span class="token punctuation">,</span>
            classes<span class="token operator">=</span>self<span class="token punctuation">.</span>classes<span class="token punctuation">,</span>
            tracker<span class="token operator">=</span>self<span class="token punctuation">.</span>tracker<span class="token punctuation">,</span>
            device<span class="token operator">=</span>self<span class="token punctuation">.</span>device<span class="token punctuation">,</span>
            verbose<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
            retina_masks<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span>

        <span class="token comment"># å¦‚æœæœ‰æ£€æµ‹ç»“æœ</span>
        <span class="token keyword">if</span> results <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span> 
            yolo_result_image_msg <span class="token operator">=</span> Image<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># åˆ›å»ºå›¾åƒæ¶ˆæ¯</span>
            yolo_result_image_msg<span class="token punctuation">.</span>header <span class="token operator">=</span> msg<span class="token punctuation">.</span>header  <span class="token comment"># è®¾ç½®å›¾åƒæ¶ˆæ¯å¤´éƒ¨</span>
            yolo_result_image_msg <span class="token operator">=</span> self<span class="token punctuation">.</span>create_result_image<span class="token punctuation">(</span>results<span class="token punctuation">)</span>  <span class="token comment"># åˆ›å»ºç»“æœå›¾åƒæ¶ˆæ¯</span>
            self<span class="token punctuation">.</span>result_image_pub<span class="token punctuation">.</span>publish<span class="token punctuation">(</span>yolo_result_image_msg<span class="token punctuation">)</span>  <span class="token comment"># å‘å¸ƒç»“æœå›¾åƒæ¶ˆæ¯</span>

            <span class="token comment"># YoloResultæ¶ˆæ¯ç±»å‹åŒ…å«detectionså’Œæ©è†œå›¾åƒ</span>
            <span class="token comment"># header</span>
            <span class="token comment"># detections: </span>
            <span class="token comment">#     heade</span>
            <span class="token comment">#     detections: "&lt;array type: vision_msgs/Detection2D, length: 5&gt;"</span>
            <span class="token comment"># masks: "&lt;array type: sensor_msgs/Image, length: 5&gt;"</span>
            yolo_result_msg <span class="token operator">=</span> YoloResult<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># åˆ›å»ºYoloResultæ¶ˆæ¯</span>
            yolo_result_msg<span class="token punctuation">.</span>header <span class="token operator">=</span> msg<span class="token punctuation">.</span>header  <span class="token comment"># è®¾ç½®æ¶ˆæ¯å¤´éƒ¨</span>
            yolo_result_msg<span class="token punctuation">.</span>detections <span class="token operator">=</span> self<span class="token punctuation">.</span>create_detections_array<span class="token punctuation">(</span>results<span class="token punctuation">)</span>  <span class="token comment"># åˆ›å»ºæ£€æµ‹ç»“æœçš„æ¶ˆæ¯æ•°ç»„</span>
            <span class="token keyword">if</span> self<span class="token punctuation">.</span>use_segmentation<span class="token punctuation">:</span>  <span class="token comment"># å¦‚æœä½¿ç”¨åˆ†å‰²æ¨¡å‹</span>
                yolo_result_msg<span class="token punctuation">.</span>masks <span class="token operator">=</span> self<span class="token punctuation">.</span>create_segmentation_masks<span class="token punctuation">(</span>results<span class="token punctuation">)</span>  <span class="token comment"># åˆ›å»ºåˆ†å‰²æ©æ¨¡æ¶ˆæ¯</span>
            self<span class="token punctuation">.</span>results_pub<span class="token punctuation">.</span>publish<span class="token punctuation">(</span>yolo_result_msg<span class="token punctuation">)</span>  <span class="token comment"># å‘å¸ƒæ£€æµ‹ç»“æœæ¶ˆæ¯</span>

    <span class="token comment"># åˆ›å»ºæ£€æµ‹ç»“æœæ•°ç»„æ¶ˆæ¯</span>
    <span class="token keyword">def</span> <span class="token function">create_detections_array</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">:</span>
        detections_msg <span class="token operator">=</span> Detection2DArray<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># è·å–åæ ‡ã€ç±»åˆ«idå’Œç›¸ä¼¼åº¦ [0]æ˜¯å› ä¸ºç»“æœæ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œåœ¨å¤„ç†å¤šå¼ å›¾ç‰‡æ—¶ç”¨</span>
        <span class="token comment"># è¾¹ç•Œæ¡†çš„åæ ‡æ ¼å¼ä¸º [x, y, w, h]ï¼Œå…¶ä¸­ x å’Œ y æ˜¯è¾¹ç•Œæ¡†å·¦ä¸Šè§’çš„åæ ‡ï¼Œw å’Œ h åˆ†åˆ«è¡¨ç¤ºè¾¹ç•Œæ¡†çš„å®½åº¦å’Œé«˜åº¦</span>
        bounding_box <span class="token operator">=</span> results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>boxes<span class="token punctuation">.</span>xywh 
        classes <span class="token operator">=</span> results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>boxes<span class="token punctuation">.</span>cls
        confidence_score <span class="token operator">=</span> results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>boxes<span class="token punctuation">.</span>conf
        <span class="token keyword">for</span> bbox<span class="token punctuation">,</span> cls<span class="token punctuation">,</span> conf <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>bounding_box<span class="token punctuation">,</span> classes<span class="token punctuation">,</span> confidence_score<span class="token punctuation">)</span><span class="token punctuation">:</span>
            detection <span class="token operator">=</span> Detection2D<span class="token punctuation">(</span><span class="token punctuation">)</span>
            detection<span class="token punctuation">.</span>bbox<span class="token punctuation">.</span>center<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>bbox<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            detection<span class="token punctuation">.</span>bbox<span class="token punctuation">.</span>center<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>bbox<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            detection<span class="token punctuation">.</span>bbox<span class="token punctuation">.</span>size_x <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>bbox<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            detection<span class="token punctuation">.</span>bbox<span class="token punctuation">.</span>size_y <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>bbox<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            hypothesis <span class="token operator">=</span> ObjectHypothesisWithPose<span class="token punctuation">(</span><span class="token punctuation">)</span>
            hypothesis<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>cls<span class="token punctuation">)</span>
            hypothesis<span class="token punctuation">.</span>score <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
            detection<span class="token punctuation">.</span>results<span class="token punctuation">.</span>append<span class="token punctuation">(</span>hypothesis<span class="token punctuation">)</span>
            detections_msg<span class="token punctuation">.</span>detections<span class="token punctuation">.</span>append<span class="token punctuation">(</span>detection<span class="token punctuation">)</span>
        <span class="token keyword">return</span> detections_msg

    <span class="token comment"># åˆ›å»ºç»“æœå›¾åƒæ¶ˆæ¯</span>
    <span class="token keyword">def</span> <span class="token function">create_result_image</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># åœ¨å›¾åƒä¸Šç»˜åˆ¶åˆ†å‰²ç»“æœ</span>
        plotted_image <span class="token operator">=</span> results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>
            conf<span class="token operator">=</span>self<span class="token punctuation">.</span>result_conf<span class="token punctuation">,</span>
            line_width<span class="token operator">=</span>self<span class="token punctuation">.</span>result_line_width<span class="token punctuation">,</span>
            font_size<span class="token operator">=</span>self<span class="token punctuation">.</span>result_font_size<span class="token punctuation">,</span>
            font<span class="token operator">=</span>self<span class="token punctuation">.</span>result_font<span class="token punctuation">,</span>
            labels<span class="token operator">=</span>self<span class="token punctuation">.</span>result_labels<span class="token punctuation">,</span>
            boxes<span class="token operator">=</span>self<span class="token punctuation">.</span>result_boxes<span class="token punctuation">,</span>
        <span class="token punctuation">)</span>
        result_image_msg <span class="token operator">=</span> self<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span>cv2_to_imgmsg<span class="token punctuation">(</span>plotted_image<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"bgr8"</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> result_image_msg

    <span class="token comment"># åˆ›å»ºåˆ†å‰²æ©æ¨¡æ¶ˆæ¯</span>
    <span class="token keyword">def</span> <span class="token function">create_segmentation_masks</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> results<span class="token punctuation">)</span><span class="token punctuation">:</span>
        masks_msg <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> result <span class="token keyword">in</span> results<span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token string">"masks"</span><span class="token punctuation">)</span> <span class="token keyword">and</span> result<span class="token punctuation">.</span>masks <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
                <span class="token comment"># éå† result.masks ä¸­çš„æ¯ä¸ªåˆ†å‰²æ©æ¨¡</span>
                <span class="token keyword">for</span> mask_tensor <span class="token keyword">in</span> result<span class="token punctuation">.</span>masks<span class="token punctuation">:</span>
                    <span class="token comment"># å°† PyTorch å¼ é‡ï¼ˆtensorï¼‰è½¬æ¢ä¸º NumPy æ•°ç»„ï¼ˆnumpy arrayï¼‰</span>
                    mask_numpy <span class="token operator">=</span> <span class="token punctuation">(</span>
                        np<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span>mask_tensor<span class="token punctuation">.</span>data<span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">"cpu"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>
                            np<span class="token punctuation">.</span>uint8
                        <span class="token punctuation">)</span>
                        <span class="token operator">*</span> <span class="token number">255</span>
                    <span class="token punctuation">)</span>
                    <span class="token comment"># å°† NumPy æ•°ç»„è½¬æ¢ä¸º ROS å›¾åƒæ¶ˆæ¯</span>
                    mask_image_msg <span class="token operator">=</span> self<span class="token punctuation">.</span>bridge<span class="token punctuation">.</span>cv2_to_imgmsg<span class="token punctuation">(</span>
                        mask_numpy<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"mono8"</span>
                    <span class="token punctuation">)</span>
                    masks_msg<span class="token punctuation">.</span>append<span class="token punctuation">(</span>mask_image_msg<span class="token punctuation">)</span>
        <span class="token keyword">return</span> masks_msg


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    rospy<span class="token punctuation">.</span>init_node<span class="token punctuation">(</span><span class="token string">"tracker_node"</span><span class="token punctuation">)</span>  <span class="token comment"># åˆå§‹åŒ–ROSèŠ‚ç‚¹</span>
    node <span class="token operator">=</span> TrackerNode<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># å®ä¾‹åŒ–TrackerNodeç±»</span>
    rospy<span class="token punctuation">.</span>spin<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># è¿›å…¥ROSäº‹ä»¶å¾ªç¯</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4c08f8f4bc20488bd23e622956d3c152/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">Android æŸä¸ªåº”ç”¨ç¼ºå°‘ç‰¹æ®Šæƒé™å¯¼è‡´ç³»ç»Ÿä¸€ç›´é‡å¯è§£å†³</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a5f79e8166e8163db865063b3f6dc59d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">0-è‡ªç„¶è¯­è¨€å¤„ç†åŸºç¡€çŸ¥è¯†</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 èœé¸Ÿç¨‹åºå‘˜åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>