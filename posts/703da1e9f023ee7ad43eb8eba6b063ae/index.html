<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CTF--信息技术对抗赛ISCC之安卓逆向分析 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="CTF--信息技术对抗赛ISCC之安卓逆向分析" />
<meta property="og:description" content="0x01 题目介绍 本题目是一道信息安全大赛上的安卓逆向题目，主要考察选手，逆向分析能力，
反汇编能力，安卓程序结构分析能力，以及常见的安全加密编码算法得能力。题
目下载 http://download.csdn.net/detail/bjtbjt/9846682可能部分步骤过于啰嗦，大
佬略过。方便入门者学习。这个题目拿到手是个安卓apk程序。下载下来，我们先
不着急进行分析。先对其程序apk安装测试一下，看看有什么功能和提示，或者了
解一下要求我们做什么。在这里呢， 不建议大家直接在自己的安卓手机上安装，
最好使用模拟器。我这里呢，使用的是模拟器。模拟器地址网上也很多，我自己
安装的是蓝叠模拟器
http://www.bluestacks.cn/
安装很简单，就是下一步。如果出现这个说明安装成功了。
然后把我们的程序添加到这个模拟器，本地安装APK点击选择，安装好即可。
我们测试一下题目，随便输入1234，发现验证失败。那么此题目输入正确答案
密码串。
0x02 解题要点 到了这里，可以请出我们的安卓逆向神器，当然也有其它类似反编译器。
apktool，jd等之类的工具。JEB我这里是jeb 2.2.7破解版。载入我们的apk程
序进行分析。
通过关键按钮菜单，我们进行手动分析。和反编译部分函数和模块。由于刚才的
安卓程序有个按钮和编辑框。因此必须找到这个关键点位置。如下：onClick事件
就是负责处理验证密码过程。
前面绿色的数字ID就是按钮编辑框的标识，主要观察这个验证过程。对于用户的输入
这个程序先进行了。
此处把用户输入进行了字符串转化，然后去除空格。进行了encode函数编码。到底这是
个什么算法，还得跟踪Digest这个类对象的定义。先别着急分析编码函数，我们继续看
下面的代码关键点有个checkFlag函数进行了正确与否的验证，因为后面的输出判断刚好
有失败和成功之分。
这个函数呢，有声明，但是没有具体定义实体。为什么呢，因为这个是个内部JNI函数。
科普一下 Java Native Interface (JNI)标准是java平台的一部分，它允许Java代码和其他
语言写的代码进行交互。JNI 是本地编程接口，它使得在 Java 虚拟机 (VM) 内部运行的 Java 代码能够与用其它编程语言(如 C、C&#43;&#43; 和汇编语言)编写的应用程序和库进行交互
操作。
http://www.cnblogs.com/hoys/archive/2010/10/28/1863612.html
http://www.2cto.com/kf/201308/232666.html
到这里基本上就算是验证结束。那么我们看到了其中经历两个验证函数。一个是encode，
一个是checkFlag函数。只要分析清楚这两个函数，那么我们就直接可以进行反推，逆向
分析算法获取结果。
先来看看第一个函数encode
看编码和基本操作，好像是个base64，这个为了高校简单起见，我们可以直接验证这段java代码类。
自己编辑测试个字符串即可。
找个bas64算法验证一下。
验证成功。
下面我们关注第二个函数算法
既然是个内部函数，那么我们看看它在哪，其实我们可以从内部导出这个库文件，存储为*.so
然后单独ida分析这个iscc.so库。
关键函数checkFlag定位
关键静态密文字符串
分析算法
这里面将用户输入的字符串重新复制了一份，然后操作
先将用户输入的字符串按照长度分割成两半
把前一半字符串中的字符按照从左到右的顺序取出来
ASCII码减去 5 , 然后与后半个字符串与之对应的位置进行交换。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/703da1e9f023ee7ad43eb8eba6b063ae/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-05-19T13:34:06+08:00" />
<meta property="article:modified_time" content="2017-05-19T13:34:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">CTF--信息技术对抗赛ISCC之安卓逆向分析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2><span style="font-size:18px;">0x01 题目介绍</span></h2> 
<p><br></p> 
<p><span style="font-size:18px;">    本题目是一道信息安全大赛上的安卓逆向题目，主要考察选手，逆向分析能力，</span></p> 
<p><span style="font-size:18px;">反汇编能力，安卓程序结构分析能力，以及常见的安全加密编码算法得能力。题</span></p> 
<p><span style="font-size:18px;">目下载 <a href="http://download.csdn.net/detail/bjtbjt/9846682">http://download.csdn.net/detail/bjtbjt/9846682</a>可能部分步骤过于啰嗦，大</span></p> 
<p><span style="font-size:18px;">佬略过。方便入门者学习。这个题目拿到手是个安卓apk程序。下载下来，我们先</span></p> 
<p><span style="font-size:18px;">不着急进行分析。先对其程序apk安装测试一下，看看有什么功能和提示，或者了</span></p> 
<p><span style="font-size:18px;">解一下要求我们做什么。在这里呢， 不建议大家直接在自己的安卓手机上安装，</span></p> 
<p><span style="font-size:18px;">最好使用模拟器。我这里呢，使用的是模拟器。模拟器地址网上也很多，我自己</span></p> 
<p><span style="font-size:18px;">安装的是蓝叠模拟器</span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;"><a href="http://www.bluestacks.cn/" rel="nofollow">http://www.bluestacks.cn/</a></span></p> 
<p><span style="font-size:18px;"><a href="http://www.bluestacks.cn/" rel="nofollow"><br></a></span></p> 
<p><span style="font-size:18px;"><a href="http://www.bluestacks.cn/" rel="nofollow"><img src="https://images2.imgbox.com/3a/b7/zy4rxWZ7_o.png" alt="" width="641" height="523"><br></a></span></p> 
<p><span style="font-size:18px;"><a href="http://www.bluestacks.cn/" rel="nofollow"><br></a></span></p> 
<p><span style="font-size:18px;">安装很简单，就是下一步。如果出现这个说明安装成功了。</span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;"><img src="https://images2.imgbox.com/48/d0/cszsHa61_o.png" alt=""><br></span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;">然后把我们的程序添加到这个模拟器，本地安装APK点击选择，安装好即可。</span></p> 
<p><span style="font-size:18px;">我们测试一下题目，随便输入1234，发现验证失败。那么此题目输入正确答案</span></p> 
<p><span style="font-size:18px;">密码串。</span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;"><img src="https://images2.imgbox.com/13/b1/cv18lmuy_o.png" alt=""><br></span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<br> 
<p><span style="font-size:18px;"><br></span></p> 
<h2><span style="font-size:18px;">0x02 解题要点</span></h2> 
<p><br></p> 
<p><span style="font-size:18px;">    到了这里，可以请出我们的安卓逆向神器，当然也有其它类似反编译器。</span></p> 
<p><span style="font-size:18px;">apktool，jd等之类的工具。JEB我这里是jeb 2.2.7破解版。载入我们的apk程</span></p> 
<p><span style="font-size:18px;">序进行分析。</span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;"><img src="https://images2.imgbox.com/c6/d3/gifuRWQa_o.png" alt=""><br></span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><br><span style="font-size:18px;"></span></p> 
<p><span style="font-size:18px;">通过关键按钮菜单，我们进行手动分析。和反编译部分函数和模块。由于刚才的</span></p> 
<p><span style="font-size:18px;">安卓程序有个按钮和编辑框。因此必须找到这个关键点位置。如下：onClick事件</span></p> 
<p><span style="font-size:18px;">就是负责处理验证密码过程。</span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;"></span><br><img src="https://images2.imgbox.com/df/6b/DD0UVddE_o.png" alt="" width="731" height="429"><br></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;">前面绿色的数字ID就是按钮编辑框的标识，主要观察这个验证过程。对于用户的输入</span></p> 
<p><span style="font-size:18px;">这个程序先进行了。</span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><img src="https://images2.imgbox.com/a1/0d/6CGp8xu3_o.png" alt="" width="681" height="30"></p> 
<p><br></p> 
<p><span style="font-size:18px;">此处把用户输入进行了字符串转化，然后去除空格。进行了encode函数编码。到底这是</span></p> 
<p><span style="font-size:18px;">个什么算法，还得跟踪Digest这个类对象的定义。先别着急分析编码函数，我们继续看</span></p> 
<p><span style="font-size:18px;">下面的代码关键点有个checkFlag函数进行了正确与否的验证，因为后面的输出判断刚好</span></p> 
<p><span style="font-size:18px;">有失败和成功之分。</span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><img src="https://images2.imgbox.com/e4/82/qkFrg5kg_o.png" alt=""></p> 
<p><br></p> 
<p><br></p> 
<p><span style="font-size:18px;">这个函数呢，有声明，但是没有具体定义实体。为什么呢，因为这个是个内部JNI函数。</span></p> 
<p><span style="font-size:18px;">科普一下 Java Native Interface (JNI)标准是java平台的一部分，它允许Java代码和其他</span></p> 
<p><span style="font-size:18px;">语言写的代码进行交互。JNI 是本地编程接口，它使得在 Java 虚拟机 (VM) 内部运行的 <br></span></p> 
<p><span style="font-size:18px;">Java 代码能够与用其它编程语言(如 C、C++ 和汇编语言)编写的应用程序和库进行交互</span></p> 
<p><span style="font-size:18px;">操作。</span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;"><a href="http://www.cnblogs.com/hoys/archive/2010/10/28/1863612.html" rel="nofollow">http://www.cnblogs.com/hoys/archive/2010/10/28/1863612.html</a></span><br></p> 
<p><a href="http://www.2cto.com/kf/201308/232666.html" rel="nofollow"><span style="font-size:18px;">http://www.2cto.com/kf/201308/232666.html</span></a></p> 
<p><a href="http://www.2cto.com/kf/201308/232666.html" rel="nofollow"><span style="font-size:18px;"><br></span></a></p> 
<p><span style="font-size:18px;">到这里基本上就算是验证结束。那么我们看到了其中经历两个验证函数。一个是encode，</span></p> 
<p><span style="font-size:18px;">一个是checkFlag函数。只要分析清楚这两个函数，那么我们就直接可以进行反推，逆向</span></p> 
<p><span style="font-size:18px;">分析算法获取结果。</span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;">先来看看<strong>第一个函数encode</strong></span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;"><img src="https://images2.imgbox.com/74/d4/GejgiNWT_o.png" alt="" width="756" height="530"><br></span></p> 
<p><br><span style="font-size:18px;"></span></p> 
<p><span style="font-size:18px;">看编码和基本操作，好像是个base64，这个为了高校简单起见，我们可以直接验证这段java代码类。</span></p> 
<p><span style="font-size:18px;">自己编辑测试个字符串即可。</span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;"><img src="https://images2.imgbox.com/55/97/sqGOgQhN_o.png" alt=""><br></span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;">找个bas64算法验证一下。</span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;"><img src="https://images2.imgbox.com/ee/c4/LwD4wELi_o.png" alt=""><br></span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;">验证成功。</span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;">下面我们关注<strong>第二个函数算法</strong></span></p> 
<p><span style="font-size:18px;">既然是个内部函数，那么我们看看它在哪，其实我们可以从内部导出这个库文件，存储为*.so<br></span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;"><img src="https://images2.imgbox.com/61/64/5mpgzdBS_o.png" alt=""><br></span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;">然后单独ida分析这个iscc.so库。</span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;"><img src="https://images2.imgbox.com/4f/4e/CSwylNJ3_o.png" alt="" width="727" height="490"><br></span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;">关键函数checkFlag定位</span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;"><img src="https://images2.imgbox.com/be/d4/c7NMhpgo_o.png" alt="" width="760" height="383"><br></span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;">关键静态密文字符串</span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;"><img src="https://images2.imgbox.com/a2/12/j7EQw11g_o.png" alt="" width="739" height="368"><br></span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;">分析算法</span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;"><img src="https://images2.imgbox.com/08/4c/mtGNfJFk_o.png" alt="" width="771" height="452"><br></span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;"><img src="https://images2.imgbox.com/98/2a/1JlOWNMN_o.png" alt="" width="753" height="501"><br></span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;">这里面将用户输入的字符串重新复制了一份，然后操作<br>先将用户输入的字符串按照长度分割成两半<br>把前一半字符串中的字符按照从左到右的顺序取出来<br>ASCII码减去 5 , 然后与后半个字符串与之对应的位置进行交换。<br></span></p> 
<p><span style="font-size:18px;">最后是比较加密结果是否等于我们静态存储的密文。</span></p> 
<p><span style="font-size:18px;"><span style="color:#FF0000;"><strong>=0HWYl1SE5UQWFfN?I+PEo.UcshU</strong></span></span></p> 
<p><span style="font-size:18px;">完全一致返回真，否则返回假。</span></p> 
<p><span style="font-size:18px;">基于此算法，我们就可以手动编写逆向算法了。</span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;"></span></p> 
<pre><code class="language-python">'''
@author: 5t4rk
'''
def decrypt(cipher_string):
    try:
        plain = list(cipher_string)
        plain.reverse()
        print ''.join(plain)
        for i in range(0, (len(plain) / 2)):
            plain[i] = chr(ord(plain[i]) + 5)
        return''.join(i for i in plain)
    except Exception , e:
        print e
        pass

if __name__ == '__main__':
    print decrypt("=0HWYl1SE5UQWFfN?I+PEo.UcshU").decode("base64")
    pass

output:
UhscU.oEP+I?NfFWQU5ES1lYWH0=
flag{ISCCJAVANDKYXX}

 </code></pre> 
<br> 
<img src="https://images2.imgbox.com/c2/4c/8DgjAffV_o.png" alt=""> 
<br> 
<p></p> 
<h2><span style="font-size:18px;">0x03 学习总结</span></h2> 
<p><br></p> 
<p><span style="font-size:18px;">    本次题目难度不是很大，主要是注意两个算法的分析。</span></p> 
<p><span style="font-size:18px;">一个base64一个逆向置换编码</span></p> 
<p><span style="font-size:18px;">必须找到关键checkFlag函数。</span></p> 
<p><span style="font-size:18px;"><br></span></p> 
<p><span style="font-size:18px;">参考点：</span></p> 
<p><a href="http://www.2cto.com/kf/201308/232666.html" rel="nofollow"><span style="font-size:18px;">http://www.2cto.com/kf/201308/232666.html</span></a></p> 
<p><a href="http://blog.csdn.net/lovoo/article/details/51429303"><span style="font-size:18px;">http://blog.csdn.net/lovoo/article/details/51429303</span></a></p> 
<p><a href="http://www.cnblogs.com/hoys/archive/2010/10/28/1863612.html" rel="nofollow"><span style="font-size:18px;">http://www.cnblogs.com/hoys/archive/2010/10/28/1863612.html</span></a></p> 
<p><a href="http://blog.csdn.net/jiangwei0910410003/article/details/49336613/"><span style="font-size:18px;">http://blog.csdn.net/jiangwei0910410003/article/details/49336613/</span></a></p> 
<p><a href="http://blog.csdn.net/jiangwei0910410003/article/details/49336613/"><span style="font-size:18px;"></span></a><br></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cef78e779e5e60595dc77ab668ab4624/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于部分亲和字段PAF(Part Affinity Field)的2D图像姿态估计(openpose)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/23f3c0028f3c9eb05801fa3588d117c7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python学习之——import sys模块</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>