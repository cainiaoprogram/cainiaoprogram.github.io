<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Kubernetes-Dashboard v2.0.0 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Kubernetes-Dashboard v2.0.0" />
<meta property="og:description" content="系统环境：
Kubernetes 版本：1.19.2kubernetes-dashboard 版本：v2.0.3 兼容性 Kubernetes版本1.131.141.151.161.171.18兼容性？？？？?✓ ✕ 不支持的版本范围。✓ 完全支持的版本范围。? 由于Kubernetes API版本之间的重大更改，某些功能可能无法在仪表板中正常运行。 1、Dashboard RBAC 创建 Dashboard RBAC 部署文件
k8s-dashboard-rbac.yaml
apiVersion: v1 kind: ServiceAccount metadata: labels: k8s-app: kubernetes-dashboard name: kubernetes-dashboard namespace: kube-system --- apiVersion: rbac.authorization.k8s.io/v1 kind: Role metadata: labels: k8s-app: kubernetes-dashboard name: kubernetes-dashboard namespace: kube-system rules: - apiGroups: [&#34;&#34;] resources: [&#34;secrets&#34;] resourceNames: [&#34;kubernetes-dashboard-key-holder&#34;, &#34;kubernetes-dashboard-certs&#34;, &#34;kubernetes-dashboard-csrf&#34;] verbs: [&#34;get&#34;, &#34;update&#34;, &#34;delete&#34;] - apiGroups: [&#34;&#34;] resources: [&#34;configmaps&#34;] resourceNames: [&#34;kubernetes-dashboard-settings&#34;] verbs: [&#34;get&#34;, &#34;update&#34;] - apiGroups: [&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/93e7f4fe157260436cc3e8ad2b25992c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-08T10:06:39+08:00" />
<meta property="article:modified_time" content="2020-10-08T10:06:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Kubernetes-Dashboard v2.0.0</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>系统环境：</strong></p> 
<ul><li>Kubernetes 版本：1.19.2</li><li>kubernetes-dashboard 版本：v2.0.3</li></ul> 
<h3 id="wow1">兼容性</h3> 
<table><thead><tr><th>Kubernetes版本</th><th>1.13</th><th>1.14</th><th>1.15</th><th>1.16</th><th>1.17</th><th>1.18</th></tr></thead><tbody><tr><td>兼容性</td><td>？</td><td>？</td><td>？</td><td>？</td><td>?</td><td>✓</td></tr></tbody></table> 
<ul><li>✕ 不支持的版本范围。</li><li>✓ 完全支持的版本范围。</li><li>? 由于Kubernetes API版本之间的重大更改，某些功能可能无法在仪表板中正常运行。</li></ul> 
<h4 id="wow3">1、Dashboard RBAC</h4> 
<p>创建 Dashboard RBAC 部署文件</p> 
<p><strong>k8s-dashboard-rbac.yaml</strong></p> 
<pre><code class="language-bash">apiVersion: v1
kind: ServiceAccount
metadata:
  labels:
    k8s-app: kubernetes-dashboard
  name: kubernetes-dashboard
  namespace: kube-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  labels:
    k8s-app: kubernetes-dashboard
  name: kubernetes-dashboard
  namespace: kube-system
rules:
  - apiGroups: [""]
    resources: ["secrets"]
    resourceNames: ["kubernetes-dashboard-key-holder", "kubernetes-dashboard-certs", "kubernetes-dashboard-csrf"]
    verbs: ["get", "update", "delete"]
  - apiGroups: [""]
    resources: ["configmaps"]
    resourceNames: ["kubernetes-dashboard-settings"]
    verbs: ["get", "update"]
  - apiGroups: [""]
    resources: ["services"]
    resourceNames: ["heapster", "dashboard-metrics-scraper"]
    verbs: ["proxy"]
  - apiGroups: [""]
    resources: ["services/proxy"]
    resourceNames: ["heapster", "http:heapster:", "https:heapster:", "dashboard-metrics-scraper", "http:dashboard-metrics-scraper"]
    verbs: ["get"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    k8s-app: kubernetes-dashboard
  name: kubernetes-dashboard
rules:
  - apiGroups: ["metrics.k8s.io"]
    resources: ["pods", "nodes"]
    verbs: ["get", "list", "watch"]
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  labels:
    k8s-app: kubernetes-dashboard
  name: kubernetes-dashboard
  namespace: kube-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: kubernetes-dashboard
subjects:
  - kind: ServiceAccount
    name: kubernetes-dashboard
    namespace: kube-system
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  name: kubernetes-dashboard
  namespace: kube-system
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: kubernetes-dashboard
subjects:
  - kind: ServiceAccount
    name: kubernetes-dashboard
    namespace: kube-system
</code></pre> 
<p>部署 Dashboard RBAC</p> 
<pre><code>$ kubectl apply -f k8s-dashboard-rbac.yaml
</code></pre> 
<h4 id="wow4">2、创建 ConfigMap、Secret</h4> 
<p>创建 Dashboard Config &amp; Secret 部署文件</p> 
<p><strong>k8s-dashboard-configmap-secret.yaml</strong></p> 
<pre><code>apiVersion: v1
kind: Secret
metadata:
  labels:
    k8s-app: kubernetes-dashboard
  name: kubernetes-dashboard-certs
  namespace: kube-system
type: Opaque
---
apiVersion: v1
kind: Secret
metadata:
  labels:
    k8s-app: kubernetes-dashboard
  name: kubernetes-dashboard-csrf
  namespace: kube-system
type: Opaque
data:
  csrf: ""
---
apiVersion: v1
kind: Secret
metadata:
  labels:
    k8s-app: kubernetes-dashboard
  name: kubernetes-dashboard-key-holder
  namespace: kube-system
type: Opaque
---
kind: ConfigMap
apiVersion: v1
metadata:
  labels:
    k8s-app: kubernetes-dashboard
  name: kubernetes-dashboard-settings
  namespace: kube-system
</code></pre> 
<p>部署 Dashboard Config &amp; Secret</p> 
<pre><code>$ kubectl apply -f k8s-dashboard-configmap-secret.yaml
</code></pre> 
<h4 id="wow5">3、kubernetes-dashboard</h4> 
<p>创建 Dashboard Deploy 部署文件</p> 
<p><strong>k8s-dashboard-deploy.yaml</strong></p> 
<pre><code>## Dashboard Service
kind: Service
apiVersion: v1
metadata:
  labels:
    k8s-app: kubernetes-dashboard
  name: kubernetes-dashboard
  namespace: kube-system
spec:
  type: NodePort
  ports:
    - port: 443
      nodePort: 30001
      targetPort: 8443
  selector:
    k8s-app: kubernetes-dashboard
---
## Dashboard Deployment
kind: Deployment
apiVersion: apps/v1
metadata:
  labels:
    k8s-app: kubernetes-dashboard
  name: kubernetes-dashboard
  namespace: kube-system
spec:
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      k8s-app: kubernetes-dashboard
  template:
    metadata:
      labels:
        k8s-app: kubernetes-dashboard
    spec:
      serviceAccountName: kubernetes-dashboard
      containers:
        - name: kubernetes-dashboard
          image: kubernetesui/dashboard:v2.0.3
          securityContext:
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            runAsUser: 1001
            runAsGroup: 2001
          ports:
            - containerPort: 8443
              protocol: TCP
          args:
            - --auto-generate-certificates
            - --namespace=kube-system          #设置为当前部署的Namespace
          resources:
            limits:
              cpu: 1000m
              memory: 512Mi
            requests:
              cpu: 1000m
              memory: 512Mi
          livenessProbe:
            httpGet:
              scheme: HTTPS
              path: /
              port: 8443
            initialDelaySeconds: 30
            timeoutSeconds: 30
          volumeMounts:
            - name: kubernetes-dashboard-certs
              mountPath: /certs
            - name: tmp-volume
              mountPath: /tmp
            - name: localtime
              readOnly: true
              mountPath: /etc/localtime
      volumes:
        - name: kubernetes-dashboard-certs
          secret:
            secretName: kubernetes-dashboard-certs
        - name: tmp-volume
          emptyDir: {}
        - name: localtime
          hostPath:
            type: File
            path: /etc/localtime
      tolerations:
        - key: node-role.kubernetes.io/master
          effect: NoSchedule
</code></pre> 
<p>部署 Dashboard Deploy</p> 
<pre><code>$ kubectl apply -f k8s-dashboard-deploy.yaml
</code></pre> 
<h4 id="wow6">4、创建 kubernetes-metrics-scraper</h4> 
<p>创建 Dashboard Metrics 部署文件</p> 
<p><strong>k8s-dashboard-metrics.yaml</strong></p> 
<pre><code>## Dashboard Metrics Service
kind: Service
apiVersion: v1
metadata:
  labels:
    k8s-app: dashboard-metrics-scraper
  name: dashboard-metrics-scraper
  namespace: kube-system
spec:
  ports:
    - port: 8000
      targetPort: 8000
  selector:
    k8s-app: dashboard-metrics-scraper
---
## Dashboard Metrics Deployment
kind: Deployment
apiVersion: apps/v1
metadata:
  labels:
    k8s-app: dashboard-metrics-scraper
  name: dashboard-metrics-scraper
  namespace: kube-system
spec:
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      k8s-app: dashboard-metrics-scraper
  template:
    metadata:
      labels:
        k8s-app: dashboard-metrics-scraper
      annotations:
        seccomp.security.alpha.kubernetes.io/pod: 'runtime/default'
    spec:
      serviceAccountName: kubernetes-dashboard
      containers:
        - name: dashboard-metrics-scraper
          image: kubernetesui/metrics-scraper:v1.0.4
          securityContext:
            allowPrivilegeEscalation: false
            readOnlyRootFilesystem: true
            runAsUser: 1001
            runAsGroup: 2001
          ports:
            - containerPort: 8000
              protocol: TCP
          resources:
            limits:
              cpu: 1000m
              memory: 512Mi
            requests:
              cpu: 1000m
              memory: 512Mi
          livenessProbe:
            httpGet:
              scheme: HTTP
              path: /
              port: 8000
            initialDelaySeconds: 30
            timeoutSeconds: 30
          volumeMounts:
          - mountPath: /tmp
            name: tmp-volume
          - name: localtime
            readOnly: true
            mountPath: /etc/localtime
      volumes:
        - name: tmp-volume
          emptyDir: {}
        - name: localtime
          hostPath:
            type: File
            path: /etc/localtime
      nodeSelector:
        "beta.kubernetes.io/os": linux
      tolerations:
        - key: node-role.kubernetes.io/master
          effect: NoSchedule
</code></pre> 
<p>部署 Dashboard Metrics</p> 
<pre><code>$ kubectl apply -f k8s-dashboard-metrics.yaml
</code></pre> 
<h4 id="wow7">5、创建访问的 ServiceAccount</h4> 
<p>创建一个绑定 admin 权限的 ServiceAccount，获取其 Token 用于访问看板。</p> 
<p>创建 Dashboard ServiceAccount 部署文件</p> 
<p><strong>k8s-dashboard-token.yaml</strong></p> 
<pre><code>kind: ClusterRoleBinding
apiVersion: rbac.authorization.k8s.io/v1
metadata:
  name: admin
  annotations:
    rbac.authorization.kubernetes.io/autoupdate: "true"
roleRef:
  kind: ClusterRole
  name: cluster-admin
  apiGroup: rbac.authorization.k8s.io
subjects:
- kind: ServiceAccount
  name: admin
  namespace: kube-system
---
apiVersion: v1
kind: ServiceAccount
metadata:
  name: admin
  namespace: kube-system
  labels:
    kubernetes.io/cluster-service: "true"
    addonmanager.kubernetes.io/mode: Reconcile
</code></pre> 
<p>部署访问的 ServiceAccount</p> 
<pre><code>$ kubectl apply -f k8s-dashboard-token.yaml
</code></pre> 
<p>获取 Token</p> 
<pre><code>kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin | awk '{print $1}')
</code></pre> 
<p><strong>token：</strong></p> 
<p><img alt="" height="262" src="https://images2.imgbox.com/9a/52/6LKdPsbq_o.png" width="1200"></p> 
<h3 id="wow8">四、登录新版本 Dashboard 查看</h3> 
<p>       本人的 Kubernetes 集群地址为”<a href="https://192.168.1.111:30001/" rel="nofollow">192.168.1.111</a>”并且在 Service 中设置了 NodePort 端口为 30001 和类型为 NodePort 方式访问 Dashboard ，所以访问地址：<a href="https://192.168.1.111:30001/" rel="nofollow">https://192.168.1.111:30001</a> 进入 Kubernetes Dashboard 页面，然后输入上一步中创建的 ServiceAccount 的 Token 进入 Dashboard，可以看到新的 Dashboard。</p> 
<p>查看Dashboard安装地址：</p> 
<pre><code class="language-bash">kubectl -n kube-system get service kubernetes-dashboard</code></pre> 
<p><img alt="" height="373" src="https://images2.imgbox.com/14/e6/RQEeTLYE_o.png" width="1153"></p> 
<p><img alt="" height="710" src="https://images2.imgbox.com/78/d4/YLJBYSk5_o.png" width="1200"></p> 
<pre><code class="language-bash">kubectl get pods --all-namespaces -o wide
kubectl get deployment --all-namespaces -o wide

删除pod
kubectl delete pod kubernetes-dashboard-75bf8468f8-47bct -n kube-system

删除deployment
kubectl delete deployment kubernetes-dashboard -n kube-system

删除kubernetes-dashboard
kubectl get secret,sa,role,rolebinding,services,deployments --namespace=kube-system | grep dashboard

kubectl delete deployment kubernetes-dashboard --namespace=kube-system 
kubectl delete service kubernetes-dashboard  --namespace=kube-system 
kubectl delete role kubernetes-dashboard-minimal --namespace=kube-system 
kubectl delete rolebinding kubernetes-dashboard-minimal --namespace=kube-system
kubectl delete sa kubernetes-dashboard --namespace=kube-system 
kubectl delete secret kubernetes-dashboard-certs --namespace=kube-system
kubectl delete secret kubernetes-dashboard-key-holder --namespace=kube-system</code></pre> 
<p>yaml文件打包：<a href="https://download.csdn.net/download/xiaoxionglove/12914424">https://download.csdn.net/download/xiaoxionglove/12914424</a></p> 
<p> 运行效果：</p> 
<p> </p> 
<p><img alt="" height="965" src="https://images2.imgbox.com/33/84/evYg76kM_o.gif" width="1200"></p> 
<p>文献参考：</p> 
<p><a href="http://www.mydlq.club/article/28/" rel="nofollow">http://www.mydlq.club/article/28/</a> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/730872e7a71efda6e5902e965518f4f6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">JavaScript变量和常量</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9ecb6c3a806148b001db86a05aeb95f1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">GEE：筛选想要的行政区的边界（根据属性数据和手绘点/多边形的方法）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>