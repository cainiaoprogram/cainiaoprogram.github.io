<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue实现拍照人脸识别功能带人脸选中框 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue实现拍照人脸识别功能带人脸选中框" />
<meta property="og:description" content="前言： 实现打开摄像头，并识别人脸。 实现效果： 实现步骤： 一、安装 （1）官网下载 tracking.js 的代码包官网入口 （2）npm下载 执行命令： cnpm install tracking --save 二、demo案例代码 &lt;template&gt; &lt;div class=&#34;testTracking&#34;&gt; &lt;video id=&#34;video&#34; width=&#34;1000&#34; height=&#34;700&#34; preload autoplay loop muted &gt;&lt;/video&gt; &lt;canvas id=&#34;canvas&#34; width=&#34;1000&#34; height=&#34;700&#34;&gt;&lt;/canvas&gt; &lt;div class=&#34;buttonDiv&#34;&gt; &lt;button type=&#34;button&#34; @click=&#34;submit&#34; style=&#34;font-size: 3vw;&#34;&gt;提取照片&lt;/button&gt; &lt;button type=&#34;button&#34; name=&#34;button&#34; @click=&#34;checkFace&#34; style=&#34;font-size: 3vw;&#34;&gt;检测人脸&lt;/button&gt; &lt;button type=&#34;button&#34; name=&#34;button&#34; @click=&#34;getCompetence&#34; style=&#34;font-size: 3vw;&#34;&gt; 打开摄像头 &lt;/button&gt; &lt;button type=&#34;button&#34; name=&#34;button&#34; @click=&#34;de&#34; style=&#34;font-size: 3vw;&#34;&gt;停&lt;/button&gt; &lt;/div&gt; &lt;/div&gt; &lt;/template&gt; &lt;script&gt; require(&#34;tracking/build/tracking-min.js&#34;); require(&#34;tracking/build/data/face-min.js&#34;); require(&#34;tracking/build/data/mouth-min.js&#34;); require(&#34;tracking/examples/assets/stats.min.js&#34;); export default { name: &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/3bcaee35d06cd43ad1a21934c62f00c7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-29T15:17:21+08:00" />
<meta property="article:modified_time" content="2020-10-29T15:17:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue实现拍照人脸识别功能带人脸选中框</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>前言：</h4> 
<h4>       实现打开摄像头，并识别人脸。</h4> 
<h4>实现效果：</h4> 
<p><img alt="" height="476" src="https://images2.imgbox.com/f9/ae/bMBmrHlN_o.png" width="766"></p> 
<h2>实现步骤：</h2> 
<h3>一、安装</h3> 
<h4>（1）官网下载 tracking.js 的代码包<a href="" rel="nofollow">官网入口</a></h4> 
<h4>（2）npm下载</h4> 
<pre><code>执行命令： cnpm install tracking --save
</code></pre> 
<h3>二、demo案例代码</h3> 
<pre><code>&lt;template&gt;
    &lt;div class="testTracking"&gt;
        &lt;video
                id="video"
                width="1000"
                height="700"
                preload
                autoplay
                loop
                muted
        &gt;&lt;/video&gt;
        &lt;canvas id="canvas" width="1000" height="700"&gt;&lt;/canvas&gt;
        &lt;div class="buttonDiv"&gt;
            &lt;button type="button" @click="submit" style="font-size: 3vw;"&gt;提取照片&lt;/button&gt;
            &lt;button type="button" name="button" @click="checkFace" style="font-size: 3vw;"&gt;检测人脸&lt;/button&gt;
            &lt;button type="button" name="button" @click="getCompetence" style="font-size: 3vw;"&gt;
                打开摄像头
            &lt;/button&gt;
            &lt;button type="button" name="button" @click="de" style="font-size: 3vw;"&gt;停&lt;/button&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
    require("tracking/build/tracking-min.js");
    require("tracking/build/data/face-min.js");
    require("tracking/build/data/mouth-min.js");
    require("tracking/examples/assets/stats.min.js");
    export default {
        name: "testTracking",
        data() {
            return {};
        },
        methods: {
            checkFace() {
                var video = document.getElementById("video");
                var canvas = document.getElementById("canvas");
                var context = canvas.getContext("2d");

                var tracker = new tracking.ObjectTracker("face");
                tracker.setInitialScale(4);
                tracker.setStepSize(2);
                tracker.setEdgesDensity(0.1);

                this.trackerTask = tracking.track("#video", tracker, { camera: true });

                tracker.on("track", function (event) {
                    if (event.data.length &lt;= 0) {
                        return;
                    }
                    context.clearRect(0, 0, canvas.width, canvas.height);
                    event.data.forEach(function (rect) {
                        context.strokeStyle = '#a64ceb';
                        context.strokeRect(rect.x, rect.y, rect.width, rect.height);
                        context.font = '11px Helvetica';
                        context.fillStyle = "#fff";
                        context.fillText('x: ' + rect.x + 'px', rect.x + rect.width + 5, rect.y + 11);
                        context.fillText('y: ' + rect.y + 'px', rect.x + rect.width + 5, rect.y + 22);
                    });
                });
            },
            submit() {
                let that = this;
                let canvas = document.getElementById("canvas");
                let context = canvas.getContext("2d");
                let video = document.getElementById("video");
                context.drawImage(video, 0, 0, 1000, 700);
                canvas.toBlob((blob) =&gt; {
                    // axios.post({ faceUrl: URL.createObjectURL(blob) }).then((res) =&gt; {
                    //   console.log("上传成功");
                    // });
                    var reader = new FileReader();
                    reader.readAsDataURL(blob);
                    console.log(reader);
                });
            },
            getCompetence() {
                var _this = this;
                this.thisCancas = document.getElementById("canvas");
                this.thisContext = this.thisCancas.getContext("2d");
                this.thisVideo = document.getElementById("video");
                // 旧版本浏览器可能根本不支持mediaDevices，我们首先设置一个空对象
                if (navigator.mediaDevices === undefined) {
                    navigator.mediaDevices = {};
                }
                // 一些浏览器实现了部分mediaDevices，我们不能只分配一个对象
                // 使用getUserMedia，因为它会覆盖现有的属性。
                // 这里，如果缺少getUserMedia属性，就添加它。
                if (navigator.mediaDevices.getUserMedia === undefined) {
                    navigator.mediaDevices.getUserMedia = function (constraints) {
                        // 首先获取现存的getUserMedia(如果存在)
                        var getUserMedia =
                            navigator.webkitGetUserMedia ||
                            navigator.mozGetUserMedia ||
                            navigator.getUserMedia;
                        // 有些浏览器不支持，会返回错误信息
                        // 保持接口一致
                        if (!getUserMedia) {
                            return Promise.reject(
                                new Error("getUserMedia is not implemented in this browser")
                            );
                        }
                        // 否则，使用Promise将调用包装到旧的navigator.getUserMedia
                        return new Promise(function (resolve, reject) {
                            getUserMedia.call(navigator, constraints, resolve, reject);
                        });
                    };
                }
                var constraints = {
                    audio: false,
                    video: {
                        width: this.videoWidth,
                        height: this.videoHeight,
                        transform: "scaleX(-1)",
                    },
                };
                navigator.mediaDevices
                    .getUserMedia(constraints)
                    .then(function (stream) {
                        // 旧的浏览器可能没有srcObject
                        if ("srcObject" in _this.thisVideo) {
                            _this.thisVideo.srcObject = stream;
                        } else {
                            // 避免在新的浏览器中使用它，因为它正在被弃用。
                            _this.thisVideo.src = window.URL.createObjectURL(stream);
                        }
                        _this.thisVideo.onloadedmetadata = function (e) {
                            _this.thisVideo.play();
                        };
                    })
                    .catch((err) =&gt; {
                        console.log(err);
                    });
            },
            de() {
                // 停止侦测
                this.trackerTask.stop();
                // 关闭摄像头
                this.trackerTask.closeCamera();
            },
        },
        destroyed() {
            // 停止侦测
            this.trackerTask.stop();
            // 关闭摄像头
            this.trackerTask.closeCamera();
        },
    };
&lt;/script&gt;

&lt;style lang="less" scoped&gt;
    .testTracking {
        height: 100vh;
        width: 100%;
        position: relative;
        &gt; * {
            position: absolute;
            left: 0;
            right: 0;
            margin: auto;
        }
        video,
        canvas {
            top: 0;
        }
        .buttonDiv {
            bottom: 10px;
        }
    }
&lt;/style&gt;
</code></pre> 
<h2>***demo到此结束了***</h2> 
<h2>参考文章：<a href="https://blog.csdn.net/qingwu1104/article/details/100881658">https://blog.csdn.net/qingwu1104/article/details/100881658</a></h2> 
<p> </p> 
<h2>此外：上面的是案例，下面是另一份应用，不予解释，</h2> 
<pre><code>&lt;template&gt;
    &lt;div style="width: 100%;height: 100%;"&gt;
        &lt;Select v-model="modelSel" style="width:200px;margin-bottom:1%;" @on-change="changeSel"&gt;
            &lt;Option v-for="(item,index) in videoArr" :value="item.id" :key="index"&gt;{<!-- -->{ item.label }}&lt;/Option&gt;
        &lt;/Select&gt;
        &lt;div class="testTracking"&gt;
            &lt;!--开启摄像头--&gt;
            &lt;!--&lt;Button  type="primary"  @click="callCamera" style="margin-right: 10px;"&gt;开启摄像头&lt;/Button&gt;--&gt;
            &lt;!--&lt;Button @click = 'changePhoto' style="margin-right: 10px;"&gt;切换摄像头&lt;/Button&gt;--&gt;
            &lt;!--关闭摄像头--&gt;
            &lt;!--&lt;Button  type="primary"  @click="closeCamera"&gt;关闭摄像头&lt;/Button&gt;--&gt;
            &lt;!--canvas截取流--&gt;
            &lt;canvas style="display:none;" ref="canvas" :width="videoWidth" :height="videoHeight"&gt;&lt;/canvas&gt;
            &lt;!--图片展示--&gt;
            &lt;video ref="video" id="video" :width="videoWidth" :height="videoHeight" autoplay style="display: block;margin:0 auto;"&gt;&lt;/video&gt;
            &lt;canvas id="canvas"  :width="videoWidth" :height="videoHeight"&gt;&lt;/canvas&gt;
            &lt;!--确认--&gt;
            &lt;!--&lt;Button  type="primary" @click="setImage"&gt;拍照&lt;/Button&gt;--&gt;
            &lt;!--&lt;img :src="imgSrc" alt="" class="tx_img"&gt;--&gt;
        &lt;/div&gt;



    &lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
    require("tracking/build/tracking-min.js");
    require("tracking/build/data/face-min.js");
    require("tracking/build/data/mouth-min.js");
    require("tracking/examples/assets/stats.min.js");
    export default {
        props:['src'],
        data () {
            return {
                videoWidth: 900,
                videoHeight: 700,
                videoArr:[],//所有的摄像头
                modelSel:'',//
                myInterval: null,
                imgSrc: '',
                isHasFace:false,//默认没有人脸
                tracker:null,
            }
        },
        created(){
        },
        mounted(){
            this.callCamera();
            this.changePhoto();
            this.checkFace();
            if(this.src!='user'){
                this.myInterval = setInterval(()=&gt;{
                    this.setImage();
                },2000)
            }
        },
        methods: {
            // 调用摄像头
            callCamera () {
                // H5调用电脑摄像头API
                navigator.mediaDevices.getUserMedia({
                    video: true
                }).then(success =&gt; {
                    // 摄像头开启成功
                    this.$refs['video'].srcObject = success
                    // 实时拍照效果
                    this.$refs['video'].play()
                }).catch(error =&gt; {
                    console.error('摄像头开启失败，请检查摄像头是否可用！')
                })
            },
            // 拍照
            setImage () {
                console.log(this.isHasFace);
                if(!this.isHasFace){
                    return false;
                }
                let ctx = this.$refs['canvas'].getContext('2d')
                // 把当前视频帧内容渲染到canvas上
                ctx.drawImage(this.$refs['video'], 0, 0,  this.videoWidth, this.videoHeight)
                // 转base64格式、图片格式转换、图片质量压缩---支持两种格式image/jpeg+image/png
                let imgBase64 = this.$refs['canvas'].toDataURL('image/jpeg');
                this.imgSrc = imgBase64;
                this.$emit('refreshDataList', imgBase64)
                return true;
                /**------------到这里为止，就拿到了base64位置的地址，后面是下载功能----------*/

                    // 由字节转换为KB 判断大小
                // let str = imgBase64.replace('data:image/jpeg;base64,', '')
                // let strLength = str.length
                // let fileLength = parseInt(strLength - (strLength / 8) * 2)　　　 // 图片尺寸  用于判断
                // let size = (fileLength / 1024).toFixed(2)
                // console.log(size) 　　  // 上传拍照信息  调用接口上传图片 .........
                //
                // // 保存到本地
                // let ADOM = document.createElement('a')
                // ADOM.href = this.headImgSrc
                // ADOM.download = new Date().getTime() + '.jpeg'
                // ADOM.click()
            },
            // 关闭摄像头
            closeCamera () {
                if (!this.$refs['video'].srcObject) return
                let stream = this.$refs['video'].srcObject
                let tracks = stream.getTracks()
                tracks.forEach(track =&gt; {
                    track.stop()
                })
                this.$refs['video'].srcObject = null
            },


            //切换本地摄像头
            changePhoto(){
                /**得到所有的设备*/
                navigator.mediaDevices.enumerateDevices()
                    .then((devices)=&gt; {
                        console.log(devices)
                        this.videoArr = [];
                        devices.forEach((device)=&gt; {
                            if(device.kind == 'videoinput'){
                                this.videoArr.push({
                                    'label': device.label,
                                    'id': device.deviceId
                                })
                            }

                        });
                    })
                    .catch(function(err) {
                        layer.msg(err.name + ": " + err.message);
                    });
            },
            //切换下拉
            changeSel(val){
                const videoConstraints = {};
                if (val === '') {
                    videoConstraints.facingMode = 'environment';
                } else {
                    videoConstraints.deviceId = { exact: val };
                }
                var constraints = {
                    video: videoConstraints,
                };
                this.getUserMedia(constraints);

            },

            /**打开摄像头*/
           getUserMedia(constraints, success, error) {
                    if (navigator.mediaDevices.getUserMedia) {
                        //最新的标准API
                        navigator.mediaDevices.getUserMedia(constraints).then(success=&gt;{
                            // 摄像头开启成功
                            this.$refs['video'].srcObject = success
                            // 实时拍照效果
                            this.$refs['video'].play()
                        }).catch(error);

                    } else if (navigator.webkitGetUserMedia) {
                        //webkit核心浏览器
                        navigator.webkitGetUserMedia(constraints,success, error)
                    } else if (navigator.mozGetUserMedia) {
                        //firfox浏览器
                        navigator.mozGetUserMedia(constraints, success, error);
                    } else if (navigator.getUserMedia) {
                        //旧版API
                        navigator.getUserMedia(constraints, success, error);
                    }
                },


            /**
             * 检查取景框是否有人脸
             * */
            checkFace() {
                var video = document.getElementById("video");
                var canvas = document.getElementById("canvas");
                var context = canvas.getContext("2d");

                this.tracker = new tracking.ObjectTracker("face");
                this.tracker.setInitialScale(4);
                this.tracker.setStepSize(2);
                this.tracker.setEdgesDensity(0.1);
                this.trackerTask = tracking.track("#video",  this.tracker, { camera: true });
                let self = this;
                this.tracker.on("track", event=&gt; {
                    if (event.data.length &lt;= 0) {
                        self.setFace(false);
                        return;
                    }
                    self.setFace(true);
                    context.clearRect(0, 0, canvas.width, canvas.height);
                    event.data.forEach(function (rect) {
                        context.strokeStyle = '#a64ceb';
                        context.strokeRect(rect.x, rect.y, rect.width, rect.height);
                        context.font = '11px Helvetica';
                        context.fillStyle = "#fff";
                        context.fillText('x: ' + rect.x + 'px', rect.x + rect.width + 5, rect.y + 11);
                        context.fillText('y: ' + rect.y + 'px', rect.x + rect.width + 5, rect.y + 22);
                    });
                });
            },
            setFace(data){
                this.isHasFace = data;
            }



        },

        beforeDestroy () {
            clearInterval(this.myInterval);
            // 停止侦测
            this.trackerTask.stop();
        }

    }
&lt;/script&gt;
&lt;style lang="less" scoped&gt;
    .testTracking {
        min-height: 700px;
        width: 100%;
        position: relative;
        &gt; * {
            position: absolute;
            left: 0;
            right: 0;
            margin: auto;
        }
        video,
        canvas {
            top: 0;
        }
        .buttonDiv {
            bottom: 10px;
        }
    }
&lt;/style&gt;
</code></pre> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9578228acb3dec852667b741c9c9b1ce/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">linux namespace基本操作命令</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/27f39ecfeba512f3f3d74f96995ae666/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">uni-app项目转换quickapp</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>