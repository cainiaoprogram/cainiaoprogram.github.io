<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>centos7  启动流程 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="centos7  启动流程" />
<meta property="og:description" content="systemd POST --&gt; Boot Sequence --&gt; Bootloader --&gt; kernel &#43; initramfs(initrd) --&gt; rootfs --&gt; /sbin/init init: CentOS 5: SysV init CentOS 6: Upstart CentOS 7: Systemd Systemd：系统启动和服务器守护进程管理器，负责在系统启动或运行时，激活系统资源，服务器进程和其它进程 Systemd新特性： 系统引导时实现服务 并行启动 按需启动守护进程 （尽可能的启动必要的服务） 自动化的服务依赖关系管理 同时采用socket式与D-Bus总线式激活服务 系统状态快照 核心概念：unit unit表示不同类型的systemd对象，通过配置文件进行标识和配置；文件中主要包含了系统服务、监听socket、保存的系统快照以及其它与init相关的信息 配置文件： /usr/lib/systemd/system:每个服务最主要的启动脚本设置，类似于之前的/etc/init.d/ 【存放了不同类型的unit单元】 /run/systemd/system：系统 执行过程中所产生的服务脚本，比上面目录优先运行 /etc/systemd/system： 管理员建立的执行脚本，类似于/etc/rc.d/rcN.d/Sxx类的功能，比上面目录优先运行 unit类型： systemctl –t help 查看unit类型 Service unit: 文件扩展名为.service, 用于定义系统服务 Target unit: 文件扩展名为.target，用于模拟实现运行级别 Device unit: .device, 用于定义内核识别的设备 Mount unit: .mount, 定义文件系统挂载点 Socket unit: .socket, 用于标识进程间通信用的socket文件，也可在系统启动时，延迟启动服务，实现按需启动 Snapshot unit: ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/211f399233ca6c42dd658d462d41a1b4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-05-15T10:06:24+08:00" />
<meta property="article:modified_time" content="2018-05-15T10:06:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">centos7  启动流程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="text-align:center;white-space:pre-wrap;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;"><img src="https://images2.imgbox.com/6c/76/SoOsrO8s_o.png" alt=""><br></span> 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">systemd</span> 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  POST --&gt; Boot Sequence --&gt; Bootloader --&gt; kernel + initramfs(initrd) --&gt; rootfs --&gt; /sbin/init 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  init: CentOS 5: SysV init 
</div> 
<div style="white-space:pre-wrap;text-indent:84px;text-align:left;line-height:1.75;font-size:14px;">
  CentOS 6: Upstart 
</div> 
<div style="white-space:pre-wrap;text-indent:84px;text-align:left;line-height:1.75;font-size:14px;">
  CentOS 7: Systemd 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  Systemd：系统启动和服务器守护进程管理器，负责在系统启动或运行时，激活系统资源，服务器进程和其它进程 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;font-style:italic;">Systemd新特性</span>： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  系统引导时实现服务 
 <span style="color:rgb(223,64,42);">并行启动</span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(223,64,42);">按需启动</span>守护进程 （尽可能的启动必要的服务） 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  自动化的服务依赖关系管理 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  同时采用socket式与D-Bus总线式激活服务 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  系统状态快照 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">核心概念</span>：unit 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  unit表示不同类型的systemd对象，通过配置文件进行标识和配置；文件中主要包含了系统服务、监听socket、保存的系统快照以及其它与init相关的信息 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">配置文件</span>： 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  /usr/lib/systemd/system:每个服务最主要的启动脚本设置，类似于之前的/etc/init.d/ 
 <span style="color:rgb(223,64,42);">【存放了不同类型的unit单元】</span> 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  /run/systemd/system：系统 
 <span style="color:rgb(223,64,42);">执行过程中所产生的服务脚本</span>，比上面目录优先运行 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  /etc/systemd/system： 
 <span style="color:rgb(223,64,42);">管理员建立的执行脚本</span>，类似于/etc/rc.d/rcN.d/Sxx类的功能，比上面目录优先运行 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">unit类型</span>： 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl –t help 查看unit类型 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  Service unit: 文件扩展名为.service, 用于定义系统服务 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  Target unit: 文件扩展名为.target，用于模拟实现运行级别 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  Device unit: .device, 用于定义内核识别的设备 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  Mount unit: .mount, 定义文件系统挂载点 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  Socket unit: .socket, 用于标识进程间通信用的socket文件，也可在系统启动时，延迟启动服务，实现按需启动 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  Snapshot unit: .snapshot, 管理系统快照 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  Swap unit: .swap, 用于标识swap设备 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  Automount unit: .automount，文件系统的自动挂载点 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  Path unit: .path，用于定义文件系统中的一个文件或目录使用,常用于当文件系统变化时，延迟激活服务，如：spool 目录 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">特性：</span> 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">关键特性：</span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  基于socket的激活机制：socket与服务程序分离 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  基于d-bus的激活机制： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  基于device的激活机制： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  基于path的激活机制： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  系统快照：保存各unit的当前状态信息于持久存储设备中 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  向后兼容sysv init脚本 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">不兼容</span>： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl命令固定不变，不可扩展 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  非由systemd启动的服务，systemctl无法与之通信和控制 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">管理服务</span> 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  管理系统服务： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  CentOS 7: service unit 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  注意：能兼容早期的服务脚本 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  命令：systemctl COMMAND name.service 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(223,64,42);background-color:rgb(250,226,32);"><strong>注意：systemctl 优势，可一次性控制多个服务</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  启动：service name start ==&gt; systemctl start name.service 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  停止：service name stop ==&gt; systemctl stop name.service 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  重启：service name restart ==&gt; systemctl restart name.service 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  状态：service name status ==&gt; systemctl status name.service 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  条件式重启：已启动才重启，否则不做操作 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  service name condrestart ==&gt; systemctl try-restart name.service 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  重载或重启服务：先加载，再启动 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl reload-or-restart name.service 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  重载或条件式重启服务： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl reload-or-try-restart name.service 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(223,64,42);">禁止自动和手动启动：</span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl mask name.service //禁止某服务启动 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(223,64,42);">取消禁止：</span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl unmask name.service //取消禁止 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">服务查看</span> 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  查看某服务当前激活与否的状态： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl is-active name.service 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  查看所有 
 <span style="color:rgb(223,64,42);">已经激活</span>的服务： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl list-units --type|-t service 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  查看 
 <span style="color:rgb(223,64,42);">所有</span>服务： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl list-units --type service --all|-a 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  chkconfig命令的对应关系： 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  设定某服务开机自启： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  chkconfig name on ==&gt; systemctl enable name.service // 若有软链接一并创建 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  设定某服务开机禁止启动： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  chkconfig name off ==&gt; systemctl disable name.service //若有软链接一并删除 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  查看所有服务的开机自启状态： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  chkconfig --list ==&gt; systemctl list-unit-files --type service 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  用来列出该服务在哪些运行级别下启用和禁用 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  chkconfig sshd –list ==&gt; ls /etc/systemd/system/*.wants/sshd.service 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  查看 
 <span style="color:rgb(223,64,42);">服务是否开机自启</span>： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl 
 <span style="color:rgb(223,64,42);">is-enabled</span> name.service 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">其它命令</span>： 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  查看服务的依赖关系： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl list-dependencies name.service 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  杀掉进程： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl kill unitname 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">服务状态</span> 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;">
  systemctl list-unit-files --type service --all显示状态 
</div> 
<ul><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">loaded:Unit配置文件已处理</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">active(running):一次或多次持续处理的运行</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">active(exited):成功完成一次性的配置</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">active(waiting):运行中，等待一个事件</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">inactive:不运行</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">enabled:开机启动</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">disabled:开机不启动</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">static:开机不启动，但可被另一个启用的服务激活</li></ul> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;">
  systemctl 命令示例： 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  显示所有单元状态 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl 或 systemctl list-units 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  只显示服务单元的状态 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl --type=service 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  显示sshd服务单元 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl–l status sshd.service 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  验证sshd服务当前是否活动 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl is-active sshd 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  启动，停止和重启sshd服务 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl start sshd.service 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl stop sshd.service 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl restart sshd.service 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  重新加载配置 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl reload sshd.service 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  列出活动状态的所有服务单元 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl list-units --type=service 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  列出所有服务单元 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl list-units --type=service --all 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  查看服务单元的启用和禁用状态 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl list-unit-files --type=service 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  列出失败的服务 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl --failed --type=service 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  列出依赖的单元 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl list-dependencies sshd 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  验证sshd服务是否开机启动 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl is-enabled sshd 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  禁用network，使之不能自动启动,但手动可以 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl disable network 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  启用network 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl enable network 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  禁用network，使之不能手动或自动启动 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl mask network 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  启用network 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl unmask network 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">service unit文件格式</span> 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  /etc/systemd/system：系统管理员和用户使用 
 <span style="color:rgb(223,64,42);">/usr/lib/systemd/system</span>：发行版打包者使用 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  以 “#” 开头的行后面的内容会被认为是注释 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  相关布尔值，1、yes、on、true 都是开启，0、no、off、false 都是关闭 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  时间单位默认是秒，所以要用毫秒（ms）分钟（m）等须显式说明 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  service unit file文件通常由三部分组成： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  • [Unit]：定义与Unit类型无关的通用选项；用于提供unit的描述信息、unit行为及依赖关系等 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  • [Service]：与特定类型相关的专用选项；此处为Service类型 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  • [Install]：定义由“systemctl enable”以及"systemctl disable“命令在实现服务启用或禁用时用到的一些选项 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">service unit文件格式</span> 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">Unit段的常用选项：</span> 
</div> 
<div style="white-space:pre-wrap;margin-left:28px;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  Description：描述信息 
</div> 
<div style="white-space:pre-wrap;margin-left:28px;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  After：定义unit的启动次序，表示当前unit应该晚于哪些unit启动，其功能与Before相反 
</div> 
<div style="white-space:pre-wrap;margin-left:28px;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  Requires：依赖到的其它units， 
 <span style="color:rgb(223,64,42);">强依赖</span>，被依赖的units无法激活时，当前unit也无法激活 
</div> 
<div style="white-space:pre-wrap;margin-left:28px;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  Wants：依赖到的其它units， 
 <span style="color:rgb(223,64,42);">弱依赖</span> 
</div> 
<div style="white-space:pre-wrap;margin-left:28px;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  Conflicts：定义units间的冲突关系 
</div> 
<div style="white-space:pre-wrap;margin-left:28px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;"> Service段的常用选项</span>： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  Type：定义影响ExecStart及相关参数的功能的unit进程启动类型 
</div> 
<div style="white-space:pre-wrap;text-indent:84px;text-align:left;line-height:1.75;font-size:14px;">
  • simple：默认值，这个daemon主要由ExecStart接的指令串来启动，启动后常驻于内存中 
</div> 
<div style="white-space:pre-wrap;text-indent:84px;text-align:left;line-height:1.75;font-size:14px;">
  • forking：由ExecStart启动的程序透过spawns延伸出其他子程序来作为此daemon的主要服务。原生父程序在启动结束后就会终止 
</div> 
<div style="white-space:pre-wrap;text-indent:84px;text-align:left;line-height:1.75;font-size:14px;">
  • oneshot： 
 <span style="color:rgb(223,64,42);">（一次性）</span>与simple类似，不过这个程序在工作完毕后就结束了，不会常驻在内存中 
</div> 
<div style="white-space:pre-wrap;text-indent:84px;text-align:left;line-height:1.75;font-size:14px;">
  • dbus：与simple类似，但这个daemon必须要在取得一个D-Bus的名称后，才会继续运作.因此通常也要同时设定BusNname= 才行 
</div> 
<div style="white-space:pre-wrap;text-indent:84px;text-align:left;line-height:1.75;font-size:14px;">
  • notify：在启动完成后会发送一个通知消息。还需要配合 NotifyAccess 来让 Systemd接收消息 
</div> 
<div style="white-space:pre-wrap;text-indent:84px;text-align:left;line-height:1.75;font-size:14px;">
  • idle：与simple类似，要执行这个daemon必须要所有的工作都顺利执行完毕后才会执行。这类的daemon通常是开机到最后才执行即可的服务 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  EnvironmentFile：环境配置文件 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  ExecStart：指明启动unit要运行命令或脚本的绝对路径 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  ExecStartPre： ExecStart前运行 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  ExecStartPost： ExecStart后运行 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  ExecStop：指明停止unit要运行的命令或脚本 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  Restart：当设定Restart=1 时，则当次daemon服务意外终止后，会再次自动启动此服务 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">Install段的常用选项：</span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  • Alias：别名，可使用systemctl command Alias.service 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  • RequiredBy：被哪些units所依赖，强依赖 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  • WantedBy：被哪些units所依赖，弱依赖 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  • Also：安装本服务的时候还要安装别的相关服务 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(223,64,42);background-color:rgb(250,226,32);"><strong>注意：对于新创建的unit文件，或者修改了的unit文件，要通知systemd重载此配置文件,而后可以选择重启 systemctl daemon-reload（重新加载才生效）</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">服务Unit文件示例：</span> 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;">
  vim /etc/systemd/system/bak.service 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  [Unit] 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  Description=backup /etc 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  Requires=atd.service 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  [Service] 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  Type=simple 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  ExecStart=/bin/bash -c "echo /testdir/bak.sh |at now" 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  [Install] 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  WantedBy=multi-user.target 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(223,64,42);background-color:rgb(250,226,32);"><strong>注意：在这需手动添加bak.sh脚本</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;">
  systemctl daemon-reload //重新加载使之生效 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;">
  systemctl start bak //启动 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">运行级别</span>： 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  target units： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  unit配置文件：.target 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  ls /usr/lib/systemd/system/*.target 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl list-unit-files --type target --all 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  运行级别： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  0 ==&gt; runlevel0.target, poweroff.target 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  1 ==&gt; runlevel1.target, rescue.target 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  2 ==&gt; runlevel2.target, multi-user.target 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  3 ==&gt; runlevel3.target, multi-user.target 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  4 ==&gt; runlevel4.target, multi-user.target 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  5 ==&gt; runlevel5.target, graphical.target 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  6 ==&gt; runlevel6.target, reboot.target 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  查看依赖性： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl list-dependencies graphical.target //查看图形的target依赖情况 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">级别切换</span>：init N ==&gt; systemctl isolate name.target 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl isolate multi-user.target 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(223,64,42);background-color:rgb(250,226,32);"><strong>注：只有/lib/systemd/system/*.target文件中AllowIsolate=yes 才能切换(修改文件需执行systemctl daemon-reload才能生效)</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">查看target</span>： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  runlevel ; who -r 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl list-units --type target 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">获取默认运行级别</span>： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  /etc/inittab ==&gt; systemctl get-default 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">修改默认级别</span>：/etc/inittab ==&gt; systemctl set-default name.target 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl set-default multi-user.target 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  ls –l /etc/systemd/system/default.target 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">其他命令</span>： 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  切换至紧急救援模式： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl rescue 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  切换至emergency模式： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemctl emergency 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  其它常用命令： 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  传统命令init，poweroff，halt，reboot都成为systemctl的软链接 
</div> 
<ul><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">关机：systemctl halt、systemctl poweroff</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">重启：systemctl reboot</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">挂起：systemctl suspend</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">休眠：systemctl hibernate</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">休眠并挂起：systemctl hybrid-sleep</li></ul> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">centos7引导顺序</span>： 
</div> 
<ul><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">UEFi或BIOS初始化，运行POST开机自检</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">选择启动设备</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">引导装载程序, centos7是grub2</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">加载装载程序的配置文件：/etc/grub.d/ /etc/default/grub</li></ul> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  /boot/grub2/grub.cfg 
</div> 
<ul><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">加载initramfs驱动模块</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">加载内核选项</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">内核初始化，centos7使用systemd代替init</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">执行initrd.target所有单元，包括挂载/etc/fstab</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">从initramfs根文件系统切换到磁盘根目录</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">systemd执行默认target配置，配置文件/etc/systemd/system/default.target</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">systemd执行sysinit.target初始化系统及basic.target准备操作系统</li></ul> 
<ul><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">systemd启动multi-user.target下的本机与服务器服务</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">systemd执行multi-user.target下的/etc/rc.d/rc.local</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">Systemd执行multi-user.target下的getty.target及登录服务</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">systemd执行graphical需要的服务</li></ul> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">设置内核参数</span>： 
</div> 
<ul><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">设置内核参数，只影响当次启动</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">启动时，在linux16行后添加systemd.unit=desired.target //修改运行模式</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">systemd.unit=emergency.target</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">systemd.unit=rescue.target</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">rescue.target 比emergency 支持更多的功能，例如日志等</li><li style="text-align:left;line-height:1.75;font-size:14px;list-style-position:inside;white-space:pre-wrap;font-family:'Microsoft YaHei', STXihei;color:rgb(0,0,0);">systemctl default 进入默认target</li></ul> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">启动排错：</span> 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  文件系统损坏 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  先尝试自动修复，失败则进入emergency shell，提示用户修复 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  在/etc/fstab不存在对应的设备和UUID等一段时间，如不可用，进入emergency shell 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  在/etc/fstab不存在对应挂载点 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  systemd 尝试创建挂载点，否则提示进入emergency shell. 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  在/etc/fstab不正确的挂载选项 提示进入emergency shell 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"> 
 <br> 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(223,64,42);"><strong>一.破解root口令</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(249,150,59);"><strong>方法1： 启动时任意键暂停启动</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(249,150,59);"><strong>按e键进入编辑模式</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(249,150,59);"><strong>将光标移动linux16开始的行，添加内核参数rd.break</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(249,150,59);"><strong>按ctrl + x启动</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(249,150,59);"><strong>mount –o remount,rw /sysroot //重新挂载，给写权限</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(249,150,59);"><strong>chroot /sysroot 切根</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(249,150,59);"><strong>passwd root 修改口令</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(249,150,59);"><strong>touch /.autorelabel </strong></span> 
 <span style="color:rgb(223,64,42);background-color:rgb(250,226,32);"><strong> 如若SELinux是启动的，必须创建该文件</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(249,150,59);"><strong>exit</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(249,150,59);"><strong>reboot</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(79,99,36);"><strong>方法2： 启动时任意键暂停启动</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(79,99,36);"><strong>按e键进入编辑模式</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(79,99,36);"><strong>将光标移动linux16开始的行，改为rw init=/sysroot/bin/sh</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(79,99,36);"><strong>按ctrl + x启动</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(79,99,36);"><strong>chroot /sysroot</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(79,99,36);"><strong>passwd root</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(79,99,36);"><strong>touch /.autorelabel </strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(79,99,36);"><strong>exit</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(79,99,36);"><strong>reboot</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">修复grub2</span> 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  GRUB“the Grand Unified Bootloader” 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  引导提示时可以使用命令行界面 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  可从文件系统引导 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  主要配置文件 /boot/grub2/grub.cfg 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  修复配置文件 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  grub2-mkconfig &gt; /boot/grub2/grub.cfg 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  修复grub 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  grub2-install /dev/sda BIOS环境 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  grub2-install UEFI环境 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="font-weight:bold;">调整默认启动内核</span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  vim /etc/default/grub 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;">
  GRUB_DEFAULT=0 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;">
  grub2-mkcofig -o /boot/grub2/grub.cfg //重新生成grub.conf文件 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(223,64,42);"><strong>二.删除/boot/grub2下所有文件</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(118,148,54);"><strong>方法：1.修复grub2文件：</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(118,148,54);"><strong>进入救援模式 ；chroot /mnt/sysimage</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(118,148,54);"><strong>grub2-install /dev/sda //恢复grub2下的文件（缺少grub.conf 文件）</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(118,148,54);"><strong>2. 修复grub.conf 文件</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(118,148,54);"><strong>重启，insmod xfx 加载xfs驱动</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(118,148,54);"><strong>set root=(hd0,1)</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(118,148,54);"><strong>linux16 /vmlinuz-xxx root=/dev/sda2 selinux=0</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:56px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(118,148,54);"><strong>linitrd16 /initrafs-xxxx</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-indent:28px;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(223,64,42);"><strong>三.删除/boot/*</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(118,148,54);"><strong>方法：进入救援模式，chroot /mnt/sysimage</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(118,148,54);"><strong> mount /dev/sr0 /mnt （没挂就挂载光盘）</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(118,148,54);"><strong> rpm -ivh /mnt/Packages/kernel-xxx --force</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(118,148,54);"><strong> grub2-install /dev/sda </strong></span> 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(118,148,54);"><strong> </strong></span> 
 <span style="color:rgb(79,99,36);"><strong>g</strong></span> 
 <span style="color:rgb(118,148,54);"><strong>rub2-mkcofig -o /boot/grub2/grub.cfg //重新生成grub.conf文件</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(223,64,42);"><strong>四.删除软链接rm -f /etc/systemd/system/default.target；重新创建软链接 </strong></span> 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(223,64,42);"><strong>ln -s /usr/lib/systemd/system/reboot.target /etc/systemd/system/default.target </strong></span> 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(223,64,42);"><strong>效果：不断重启</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <span style="color:rgb(79,99,36);"><strong>修复方法： 重启，ESC，选中内核，按e键， 在Linux16 行的末尾写：systemd.unit=multi-user.target ;在按ctrl+x重启，在修改为正常</strong></span> 
</div> 
<div style="white-space:pre-wrap;text-align:left;line-height:1.75;font-size:14px;"> 
 <br> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/19695df049090d97b5fd90c03c040600/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【STM32】IIC的基本原理（实例：普通IO口模拟IIC时序读取24C02）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7d8c59d674d75d3c4c55f93d6270803f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ODL中notification开发过程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>