<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Centos7 合理分配 swap空间 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Centos7 合理分配 swap空间" />
<meta property="og:description" content="一：查看服务器内存情况命令： #free
可以看到，我的服务器还没有配置Swap虚拟内存！
第二步：检查硬盘驱动器分区上的可用空间 在我们创建swap文件之前，我们将检查当前的磁盘使用情况，以确保我们有足够的空间。通过输入：
#df -h Filesystem 列中的/dev/vda1 是我们的磁盘。在这个例子中我们有足够的空间（仅有9.1G被使用）。 对swap空间的适当大小实际上取决于您的个人偏好和您的应用程序要求。通常，等于或双倍于系统内存的量是一个很好的选择。如果您只是将其用作RAM后备，那么你的swap分区尽可能不要超过4G。 一般来说可以按照如下规则设置swap大小：
4G以内的物理内存，SWAP 设置为内存的2倍。 4-8G的物理内存，SWAP 等于内存大小。 8-64G 的物理内存，SWAP 设置为8G。 64-256G物理内存，SWAP 设置为16G。 第三步：创建Swap分区文件 我们可以在文件系统上创建一个swap分区。我们将在根/目录中分配我们想要调用的swap大小的文件swapfile。
创建交换文件的最佳方法是使用fallocate。此命令将创建指定大小的文件。
由于我的服务器物理内存数2G，因此我们将在本教程中创建4G文件：
sudo fallocate -l 4G /swapfile
我们可以通过输入以下内容来验证其是否保留了正确的空间量：
#ls -lh /swapfile
第四步：启用Swap分区 我们需要将swap文件转换为swap分区。首先，我们需要锁定文件的权限，以便只有具有root权限的用户才能读取内容。
通过输入以下内容使该文件只能由root访问：
sudo chmod 600 /swapfile 我们现在可以通过输入以下内容将文件标记为swap空间
sudo mkswap /swapfile 标记文件后，我们可以启用swap文件：
sudo swapon /swapfile 输入以下内容验证交换是否可用：
sudo swapon --show 我们可以用free命令再次检查：
free -h 我们的swap已成功设置，我们的操作系统将在必要时使用它。
第五步：永久化swap文件 我们已启用当前会话中的swap文件。但是，如果我们重新启动的话，服务器将不会自动保留swap设置。我们可以通过将交换文件添加到我们的/etc/fstab来进行更改。
为了避免出现任何问题，先备份/etc/fstab文件：
#sudo cp /etc/fstab /etc/fstab.bak 输入以下内容，将swap文件信息添加到/etc/fstab文件末尾：
#echo &#39;/swapfile none swap sw 0 0&#39; | sudo tee -a /etc/fstab 第六步：调整您的Swap设置 您可以配置一些选项，这些选项会在处理swap时对系统的性能产生影响。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/4e056995cf2e4376d854521986066b81/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-12-31T10:15:01+08:00" />
<meta property="article:modified_time" content="2019-12-31T10:15:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Centos7 合理分配 swap空间</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>一：查看服务器内存情况命令：</h4> 
<p>#free</p> 
<p><img alt="" class="has" height="65" src="https://images2.imgbox.com/05/6e/cdAM76F1_o.png" width="640"></p> 
<p>可以看到，我的服务器还没有配置Swap虚拟内存！</p> 
<h3><strong>第二步：检查硬盘驱动器分区上的可用空间</strong></h3> 
<p>在我们创建swap文件之前，我们将检查当前的磁盘使用情况，以确保我们有足够的空间。通过输入：</p> 
<pre>#df -h
</pre> 
<p><img alt="" class="has" height="129" src="https://images2.imgbox.com/2b/56/QGfa2XfY_o.png" width="412"></p> 
<pre>Filesystem 列中的/dev/vda1 是我们的磁盘。在这个例子中我们有足够的空间（仅有9.1G被使用）。

对swap空间的适当大小实际上取决于您的个人偏好和您的应用程序要求。通常，等于或双倍于系统内存的量是一个很好的选择。如果您只是将其用作RAM后备，那么你的swap分区尽可能不要超过4G。
</pre> 
<p><strong>一般来说可以按照如下规则设置swap大小：</strong></p> 
<h4><a name="t0"></a>4G以内的物理内存，SWAP 设置为内存的2倍。</h4> 
<h4><a name="t1"></a>4-8G的物理内存，SWAP 等于内存大小。</h4> 
<h4><a name="t2"></a>8-64G 的物理内存，SWAP 设置为8G。</h4> 
<h4><a name="t3"></a>64-256G物理内存，SWAP 设置为16G。</h4> 
<h3> </h3> 
<h3><strong>第三步：创建Swap分区文件</strong></h3> 
<p>我们可以在文件系统上创建一个swap分区。我们将在根<code>/</code>目录中分配我们想要调用的swap大小的文件<code>swapfile</code>。</p> 
<p>创建交换文件的最佳方法是使用<code>fallocate</code>。此命令将创建指定大小的文件。</p> 
<p>由于我的服务器物理内存数2G，因此我们将在本教程中创建4G文件：</p> 
<p>sudo fallocate -l 4G /swapfile</p> 
<p>我们可以通过输入以下内容来验证其是否保留了正确的空间量：</p> 
<p>#ls -lh /swapfile</p> 
<p><img alt="" class="has" height="37" src="https://images2.imgbox.com/19/b1/myzi4qDW_o.png" width="400"></p> 
<p> </p> 
<h3><strong>第四步：启用Swap分区</strong></h3> 
<p>我们需要将swap文件转换为swap分区。首先，我们需要锁定文件的权限，以便只有具有<strong>root</strong>权限的用户才能读取内容。</p> 
<p>通过输入以下内容使该文件只能由<strong>root</strong>访问：</p> 
<pre>sudo chmod 600 /swapfile</pre> 
<p>我们现在可以通过输入以下内容将文件标记为swap空间</p> 
<pre>sudo mkswap /swapfile</pre> 
<p><img alt="" class="has" height="49" src="https://images2.imgbox.com/46/8b/K4A81I0W_o.png" width="432"></p> 
<p>标记文件后，我们可以启用swap文件：</p> 
<pre>sudo swapon /swapfile</pre> 
<p>输入以下内容验证交换是否可用：</p> 
<pre>sudo swapon --show</pre> 
<p><img alt="" class="has" height="60" src="https://images2.imgbox.com/34/6e/ghG3LG3i_o.png" width="480"></p> 
<p> </p> 
<p>我们可以用<code>free</code>命令再次检查：</p> 
<pre>free -h</pre> 
<p><img alt="" class="has" height="61" src="https://images2.imgbox.com/63/03/hv9hnFhJ_o.png" width="620"></p> 
<p>我们的swap已成功设置，我们的操作系统将在必要时使用它。</p> 
<p> </p> 
<h3><strong>第五步：永久化swap文件</strong></h3> 
<p>我们已启用当前会话中的swap文件。但是，如果我们重新启动的话，服务器将不会自动保留swap设置。我们可以通过将交换文件添加到我们的<code>/etc/fstab</code>来进行更改。</p> 
<p>为了避免出现任何问题，先备份<code>/etc/fstab</code>文件：</p> 
<pre>#sudo cp /etc/fstab /etc/fstab.bak</pre> 
<p>输入以下内容，将swap文件信息添加到<code>/etc/fstab</code>文件末尾：</p> 
<pre>#echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab</pre> 
<h3><strong>第六步：调整您的Swap设置</strong></h3> 
<p>您可以配置一些选项，这些选项会在处理swap时对系统的性能产生影响。</p> 
<h4><a name="t11"></a><strong>调整Swappiness参数</strong></h4> 
<p>该swappiness参数主要配置系统将数据从RAM交换到交换空间的频率。该参数的值是介于0和100之间的百分比。swappiness，Linux内核参数，控制换出运行时内存的相对权重。swappiness参数值可设置范围在0到100之间。 低参数值会让内核尽量少用交换，更高参数值会使内核更多的去使用交换空间。默认值为60（参考网络资料：当剩余物理内存低于40%（40=100-60）时，开始使用交换空间）。对于大多数操作系统，设置为100可能会影响整体性能，而设置为更低值（甚至为0）则可能减少响应延迟。</p> 
<p>我们可以通过输入以下内容来查看当前的swappiness值：</p> 
<pre>cat /proc/sys/vm/swappiness</pre> 
<p>对于服务器本身来说，您可能希望这个数值更接近于0。我们可以使用<code>sysctl</code>命令将swappiness设置为不同的值。</p> 
<p>例如，要将swappiness设置为10（推荐设置为10）</p> 
<p><strong>修改</strong><strong>swappiness</strong><strong>的值</strong></p> 
<p>1：临时设置（重启后失效）：</p> 
<pre>sudo sysctl vm.swappiness=10</pre> 
<pre>vm.swappiness = 10</pre> 
<p>2：永久设置</p> 
<p>我们可以通过在<code>/etc/sysctl.conf</code>文件中添加以下行来自动设置此值：</p> 
<pre>sudo vi /etc/sysctl.conf</pre> 
<p>在底部，您可以添加：</p> 
<pre>vm.swappiness=10</pre> 
<p>完成后保存并关闭文件。</p> 
<h4><a name="t12"></a><strong>调整缓存压力设置</strong></h4> 
<p>您可能想要修改的另一个相关值是<code>vfs_cache_pressure</code>。这个数值是比较高的，意味着系统从缓存中移除inode信息的速度比较快。一个保守一些的数值是50。</p> 
<p>您可以通过<code>proc</code>命令来查看当前值：</p> 
<pre>cat /proc/sys/vm/vfs_cache_pressure</pre> 
<pre>100</pre> 
<p>我的设置系统会很快地从缓存中删除inode信息。我们可以通过输入以下内容将其设置为更保守的值（如50）：</p> 
<pre>sudo sysctl vm.vfs_cache_pressure=50</pre> 
<pre>vm.vfs_cache_pressure = 50</pre> 
<p>同样，这仅适用于我们当前的会话。我们可以通过将其添加到配置文件来改变它，就像我们使用<code>swappiness</code>设置一样：</p> 
<pre>sudo vi /etc/sysctl.conf</pre> 
<p>在底部，添加指定新值的行：</p> 
<pre>vm.vfs_cache_pressure=50</pre> 
<p>完成后保存并关闭文件。</p> 
<h3><a name="t13"></a><strong>结论</strong></h3> 
<p>本教程将为您提供一些额外的空间来避免内存不足的异常。swap空间可以避免一些常见问题。如果遇到内存不足错误，或者发现系统无法使用所需的应用程序，您的最佳解决方案是优化应用程序配置或升级服务器。</p> 
<p> </p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ac34403a533e5b612222617ccbfb710a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Kali之airodump-ng</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cc3f0b0f6ba2ff90fdaef9612f8aa613/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">文字超过两行省略</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>