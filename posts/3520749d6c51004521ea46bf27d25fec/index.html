<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>蛋白&#43;小分子配体md（详细保姆教程） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="蛋白&#43;小分子配体md（详细保姆教程）" />
<meta property="og:description" content="继续搬一点近期飞书文档模拟的到博客里
参考博客： Gromac中文教程：https://jerkwin.github.io/GMX/GMXtut-5/#%E6%A6%82%E8%BF%B0https://www.jianshu.com/p/b10fe4b4af11https://www.bilibili.com/read/cv6496041/ 生成小分子过程 生成：charm gui 官网：https://charmm-gui.org/?doc=input/pdbreader&amp;step=0 PDBID：6kyk，6kyh。生成时注意选择第一个。 在GNP文件中的mol2CGenFF上传 mol2:https://cgenff.umaryland.edu/userAccount/userLogin.php#20220227_5/6kyk_gnp.err。下载str，生成prm、itp、pdb python cgenff_charmm2gmx_py3_nx2.py GNP GNP.mol2 gnp.str charmm36-mar2019.ff 注意NetworkX版本，若是最新版不一致，将self.G.node替换成新版语法self.G.nodes力场下载地址：http://mackerell.umaryland.edu/charmm_ff.shtml#charmm生成gro文件 gmx pdb2gmx -ignh -ff charmm36-mar2019 -f 6kyh_mg.pdb -o 6kyh.gro -p 6kyh.top -water tip3p gmx editconf -f gnp_ini.pdb -o gnp.gro 将小分子gro坐标添加进6kyh.gro，修改gro原子数,32399 prm，itp文件include到6kyh.top，，增加GNP 1到top。一定要注意include prm文件的位置，一定要在所有的分子itp文件之前，力场文件之下，否则会导致GROMACS无法识别加入的小分子。 # add gro , &#43;49 # vim 6kyh.top，注意位置，prm一定要在所有的itp之前，而在力场之下。 ; Include ligand topology #include &#34;gnp.prm&#34; #include &#34;gnp.itp&#34; 模拟 水盒子 gmx editconf -f 6kyh.gro -o 6kyh-PBC.gro -bt dodecahedron -d 1.0 真空最小化 gmx grompp -f em-vac-pme." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/3520749d6c51004521ea46bf27d25fec/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-09T16:03:13+08:00" />
<meta property="article:modified_time" content="2022-03-09T16:03:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">蛋白&#43;小分子配体md（详细保姆教程）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>继续搬一点近期飞书文档模拟的到博客里</p> 
<h2>参考博客：</h2> 
<ul><li>Gromac中文教程：https://jerkwin.github.io/GMX/GMXtut-5/#%E6%A6%82%E8%BF%B0</li><li>https://www.jianshu.com/p/b10fe4b4af11</li><li>https://www.bilibili.com/read/cv6496041/</li></ul> 
<h2>生成小分子过程</h2> 
<ul><li>生成：charm gui 官网：https://charmm-gui.org/?doc=input/pdbreader&amp;step=0 
  <ul><li>PDBID：6kyk，6kyh。生成时注意选择第一个。</li><li><img alt="" height="366" src="https://images2.imgbox.com/19/41/zbxtAlzH_o.png" width="542"> </li></ul></li></ul> 
<p></p> 
<ul><li>在GNP文件中的mol2</li><li>CGenFF上传 mol2:https://cgenff.umaryland.edu/userAccount/userLogin.php#20220227_5/6kyk_gnp.err。</li><li>下载str，生成prm、itp、pdb</li></ul> 
<pre><code>python cgenff_charmm2gmx_py3_nx2.py GNP GNP.mol2 gnp.str charmm36-mar2019.ff</code></pre> 
<ul><li>注意NetworkX版本，若是最新版不一致，将self.G.node替换成新版语法self.G.nodes</li><li>力场下载地址：http://mackerell.umaryland.edu/charmm_ff.shtml#charmm</li><li>生成gro文件</li></ul> 
<p><code>gmx pdb2gmx -ignh -ff charmm36-mar2019 -f 6kyh_mg.pdb -o 6kyh.gro -p 6kyh.top -water tip3p </code></p> 
<p><code>gmx editconf -f gnp_ini.pdb -o gnp.gro </code></p> 
<ul><li>将小分子gro坐标添加进6kyh.gro，修改gro原子数,32399 prm，itp文件include到6kyh.top，，增加GNP 1到top。<strong>一定要注意include prm文件的位置，一定要在所有的分子itp文件之前，力场文件之下，否则会导致GROMACS无法识别加入的小分子。</strong></li></ul> 
<pre><code># add gro , +49

# vim 6kyh.top，注意位置，prm一定要在所有的itp之前，而在力场之下。

; Include ligand topology

#include "gnp.prm"

#include "gnp.itp"</code></pre> 
<h2>模拟</h2> 
<ol><li> <h4>水盒子</h4> </li></ol> 
<p><code>gmx editconf -f 6kyh.gro -o 6kyh-PBC.gro -bt dodecahedron -d 1.0 </code></p> 
<ol><li> <h4>真空最小化</h4> </li></ol> 
<p><code>gmx grompp -f em-vac-pme.mdp -c 6kyh-PBC.gro -p 6kyh.top -o em-vac.tpr </code></p> 
<p><code>gmx mdrun -v -deffnm em-vac </code></p> 
<ul><li>em-vac-pme.mdp</li></ul> 
<pre><code>; 传递给预处理器的一些定义
define          = -DFLEXIBLE    ; 使用柔性水模型而非刚性模型, 这样最陡下降法可进一步最小化能量

; 模拟类型, 结束控制, 输出控制参数
integrator      = steep         ; 指定使用最陡下降法进行能量最小化. 若设为`cg`则使用共轭梯度法
emtol           = 500.0         ; 若力的最大值小于此值则认为能量最小化收敛(单位kJ mol^-1^ nm^-1^)
emstep          = 0.01          ; 初始步长(nm)
nsteps          = 50000          ; 在能量最小化中, 指定最大迭代次数
nstenergy       = 1             ; 能量写出频率
energygrps      = System        ; 要写出的能量组

; 近邻列表, 相互作用计算参数
nstlist         = 1             ; 更新近邻列表的频率. 1表示每步都更新
ns_type         = grid          ; 近邻列表确定方法(simple或grid)
; ;coulombtype     = PME           ; ;无离子会报错 计算长程静电的方法. PME为粒子网格Ewald方法, 还可以使用cut-off
cutoff-scheme   = Verlet
rlist           = 1.0           ; 短程力近邻列表的截断值
rcoulomb        = 1.0           ; 长程库仑力的截断值
vdwtype         = cut-off       ; 计算范德华作用的方法
rvdw            = 1.0           ; 范德华距离截断值
constraints     = none          ; 设置模型中使用的约束
pbc             = xyz           ; 3维周期性边界条件</code></pre> 
<ol><li> <h4>溶剂和离子</h4> </li></ol> 
<p># 溶剂和离子 选择SOL，echo19</p> 
<p><img alt="" height="354" src="https://images2.imgbox.com/67/94/CwfJNsS2_o.png" width="317"></p> 
<p> </p> 
<p></p> 
<p><code>gmx solvate -cp em-vac.gro -cs spc216.gro -p 6kyh.top -o 6kyh-b4ion.gro </code></p> 
<p><code>gmx grompp -f em-sol-pme.mdp -c 6kyh-b4ion.gro -p 6kyh.top -o ion.tpr </code></p> 
<p><code>echo 19 | gmx genion -s ion.tpr -o 6kyh-b4em.gro -neutral -conc 0.15 -p 6kyh.top </code></p> 
<p><code>注意-conc选项的离子浓度，需要根据实验设定进行设计，可以选择默认浓度。</code></p> 
<ul><li>em-sol-pme.mdp</li></ul> 
<pre><code>define          = -DFLEXIBLE

integrator      = steep
emtol           = 250.0
nsteps          = 50000
nstenergy       = 1
energygrps      = System

nstlist         = 1
ns_type         = grid
;; coulombtype     = PME ;无离子会报错
rlist           = 1.0
rcoulomb        = 1.0
rvdw            = 1.0
constraints     = none
pbc             = xyz</code></pre> 
<ol><li> <h4>能量最小化</h4> </li></ol> 
<ul><li> <p>再次生成tpr文件，并运行能量最小化</p> </li></ul> 
<p><code>#能量最小化 </code></p> 
<p><code>gmx grompp -f em-sol-pme.mdp -c 6kyh-b4em.gro -p 6kyh.top -o em-sol.tpr </code></p> 
<p><code>gmx mdrun -v -deffnm em-sol </code></p> 
<ol><li> <h4>限制+NVT平衡</h4> </li></ol> 
<ul><li>是否需要限制配体，（此步根据需求来,对于我的实验可以略过。）</li></ul> 
<p><code>gmx make_ndx -f em.gro -o index.ndx </code></p> 
<p><img alt="" height="676" src="https://images2.imgbox.com/7f/4f/BsRFqrPB_o.png" width="665"></p> 
<p> </p> 
<p></p> 
<ul><li> <p>设置<code>tc_grps = Protein_JZ4 Water_and_ions</code>来达到我们需要的<code>Protein Non-Protein</code></p> </li></ul> 
<p>的效果了，模拟时要加-n index.ndx</p> 
<ul><li>平衡</li></ul> 
<p><code>#NVT平衡 </code></p> 
<p><code>##设置 温度耦合分组， </code></p> 
<p><code>gmx grompp -f nvt-pr-md.mdp -r em-sol.gro -c em-sol.gro -p 6kyh.top -o nvt-pr.tpr </code></p> 
<p><code>gmx mdrun -deffnm nvt-pr </code></p> 
<ul><li>nvt-pr-md.mdp</li></ul> 
<pre><code> 预处理选项

define = -DPOSRES ; 告诉GROMACS运行位置限制性模拟

; 运行控制参数

integrator = md

dt = 0.002 ; 时间步长(单位为ps, 我们使用了2 fs). 只用于动力学积分器(如md), 能量最小化时不需要

nsteps = 5000000 ; ; 10ns模拟步数(总模拟时间为nsteps*dt)

; 输出控制参数

nstxout = 50000 ;; 要100ps 输出模拟坐标的频率(nstxout=500且dt=0.002, 所以每1 ps输出一次)

nstvout = 50000 ; 速度保存频率

nstenergy = 50000 ; 能量保存频率

nstlog = 50000 ; log文件输出频率

energygrps = Protein Non-Protein

; 近邻列表参数

nstlist = 5

ns_type = grid

pbc = xyz

rlist = 1.0

; 静电和VDW参数

coulombtype = PME ; 长程静电相互作用的计算方法

pme_order = 4 ; 三次插值

fourierspacing = 0.16 ; FFT间隔

rcoulomb = 1.0 ; 计算静电作用的截断值(单位nm)

vdw-type = Cut-off

rvdw = 1.0

; 温度耦合部分非常重要, 必须正确填写.

tcoupl = v-rescale ; 随机重新调整速度

tc-grps = Protein Non-Protein ; 与控温器耦合的组(模型中的每个原子或残基都用一定的索引组表示), 对蛋白和非蛋白使用不同的组分开控制

tau_t = 0.1 0.1 ; 温度耦合的时间常数(单位ps). 必须每个tc_grps指定一个, 且顺序对应

ref_t = 300 300 ; 代表耦合的参考温度(即动力学模拟的温度, 单位K). 每个tc_grp对应一个ref_t

; 色散校正

DispCorr = EnerPres ; 校正VDW截断

; 不使用压力耦合

pcoupl = no ; NVT中不能使用压力耦合

; 初始速度选项

gen_vel = yes ; 根据Maxwell分布随机产生速度

gen_temp = 300 ; 当你改变温度时, 别忘了改变gen_temp变量以生成速度

gen_seed = -1 ; 随机数生成器的种子

; 键约束选项

constraints = all-bonds ; 使用LINCS算法约束所有键

continuation = no ; 第一次运行

constraint_algorithm = lincs ; 约束算法

lincs_iter = 1 ; LINCS精度

lincs_order = 4 ; LINCS阶数, 与精度有关</code></pre> 
<ol><li> <h4>NPT平衡</h4> </li></ol> 
<p><code># </code></p> 
<p><code>gmx grompp -f npt-pr-md.mdp -r nvt-pr.gro -c nvt-pr.gro -p 6kyh.top -o npt-pr.tpr </code></p> 
<p><code>gmx mdrun -deffnm npt-pr </code></p> 
<ul><li>npt-pr-md.mdp</li></ul> 
<pre><code>
define = -DPOSRES

integrator = md

dt = 0.002

nsteps = 5000000 ;10ns

nstxout = 50000 ;100ps

nstvout = 50000

nstfout = 50000

nstenergy = 50000

nstlog = 50000

energygrps = Protein Non-Protein

nstlist = 5

ns-type = Grid

pbc = xyz

rlist = 1.0

coulombtype = PME

pme_order = 4

fourierspacing = 0.16

rcoulomb = 1.0

vdw-type = Cut-off

rvdw = 1.0

Tcoupl = v-rescale

tc-grps = Protein Non-Protein

tau_t = 0.1 0.1

ref_t = 300 300

DispCorr = EnerPres

; 压力耦合

Pcoupl = Parrinello-Rahman ; Parrinello-Rahman控压器.

Pcoupltype = Isotropic ; isotropic 指盒子可以平均地向各个方向(x, y,z)膨胀或压缩以维持一定的压力. 进行膜模拟时需要用semiisotropic.

tau_p = 2.0 ; 压力耦合的时间常数(单位ps).

compressibility = 4.5e-5 ; 溶剂的压缩系数(4.5e-5为水在300 K和标准大气压下的压缩系数).

ref_p = 1.0 ; 压力耦合的参考压力(单位bar, 1大气压约为0.983 bar).

refcoord_scaling = com

gen_vel = no ; 不产生速度

constraints = all-bonds

continuation = yes

constraint_algorithm = lincs

lincs_iter = 1

lincs_order = 4</code></pre> 
<ol><li> <h4>成品模拟</h4> </li></ol> 
<p><code>gmx grompp -f npt-nopr-md.mdp -c npt-pr.gro -p 6kyh.top -o npt-nopr.tpr </code></p> 
<p><code>gmx mdrun -deffnm npt-nopr </code></p> 
<ul><li>npt-nopr-md.mdp</li></ul> 
<pre><code>
integrator = md

dt = 0.002

nsteps = 500000 ; ;cd

nstxout = 50000 ;100ps

nstvout = 50000

nstfout = 50000

nstenergy = 50000

nstlog = 500 ; log要小10psls

energygrps = Protein Non-Protein

nstlist = 10

ns-type = Grid

pbc = xyz

rlist = 1.0

coulombtype = PME

pme_order = 4

fourierspacing = 0.16

rcoulomb = 1.0

vdw-type = Cut-off

rvdw = 1.0

Tcoupl = v-rescale

tc-grps = Protein Non-Protein

tau_t = 0.1 0.1

ref_t = 300 300

DispCorr = EnerPres

Pcoupl = Parrinello-Rahman

Pcoupltype = Isotropic

tau_p = 2.0

compressibility = 4.5e-5

ref_p = 1.0

gen_vel = no

constraints = all-bonds

continuation = yes

constraint_algorithm = lincs

lincs_iter = 1

lincs_order = 4</code></pre> 
<h2>报错</h2> 
<ul><li>No,</li></ul> 
<p></p> 
<ul><li>修改:</li></ul> 
<p><code>; Include ligand topology </code></p> 
<p><code>#include "gnp.top" </code></p> 
<ul><li>网上建议：https://www.researchgate.net/post/How_to_solve_the_no_default_type_errors_in_GROMACS-507_using_CHARMM36ff</li></ul> 
<ul><li>修改一下力场版本：</li></ul> 
<p></p> 
<ul><li>最终解决方案：http://www.gromacs.org/Documentation/Errors#Invalid_order_for_directive_xxx\</li></ul> 
<h2>6kyk</h2> 
<pre><code>python cgenff_charmm2gmx_py3_nx2.py GNP GNP.mol2 gnp.str charmm36-mar2019.ff

gmx pdb2gmx -ignh -ff charmm36-mar2019 -f 6kyk_mg.pdb -o 6kyk.gro -p 6kyk.top -water tip3p

gmx editconf -f gnp_ini.pdb -o gnp.gro

; 21844+49=21893

;Include ligand topology

#include "gnp.prm"

#include "gnp.itp"

gmx editconf -f 6kyk.gro -o 6kyk-PBC.gro -bt dodecahedron -d 1.0

gmx grompp -f em-vac-pme.mdp -c 6kyk-PBC.gro -p 6kyk.top -o em-vac.tpr

gmx mdrun -v -deffnm em-vac

gmx solvate -cp em-vac.gro -cs spc216.gro -p 6kyk.top -o 6kyk-b4ion.gro

gmx grompp -f em-sol-pme.mdp -c 6kyk-b4ion.gro -p 6kyk.top -o ion.tpr

echo 19 | gmx genion -s ion.tpr -o 6kyk-b4em.gro -neutral -conc 0.15 -p 6kyk.top

gmx grompp -f em-sol-pme.mdp -c 6kyk-b4em.gro -p 6kyk.top -o em-sol.tpr

gmx mdrun -v -deffnm em-sol

gmx grompp -f nvt-pr-md.mdp -r em-sol.gro -c em-sol.gro -p 6kyk.top -o nvt-pr.tpr

gmx mdrun -deffnm nvt-pr

gmx grompp -f npt-pr-md.mdp -r nvt-pr.gro -c nvt-pr.gro -p 6kyk.top -o npt-pr.tpr

gmx mdrun -deffnm npt-pr

gmx grompp -f npt-nopr-md.mdp -c npt-pr.gro -p 6kyk.top -o npt-nopr.tpr

gmx mdrun -deffnm npt-nopr</code></pre> 
<h2>速度测试</h2> 
<ul><li>深圳超算(速度会有0.x ns的波动）</li></ul> 
<table><tbody><tr><td> <p><strong>PDB</strong></p> </td><td> <p><strong>总核数</strong></p> </td><td> <p><strong>速度ns/day</strong></p> </td><td> <p><strong>模拟时间</strong></p> </td><td> <p><strong>盒子大小</strong></p> </td></tr><tr><td rowspan="5"> <p>6kyh</p> </td><td> <p>60</p> </td><td> <p>4.66</p> </td><td rowspan="8"> <p>400ps</p> </td><td rowspan="8"> <p>1.0</p> </td></tr><tr><td> <p>96</p> </td><td> <p>5.452</p> </td></tr><tr><td> <p>120</p> </td><td> <p>5.783</p> </td></tr><tr><td> <p>144</p> </td><td> <p>5.693</p> </td></tr><tr><td> <p>180</p> </td><td> <p>6.7</p> </td></tr><tr><td rowspan="3"> <p>6kyk</p> </td><td> <p>96</p> </td><td> <p>9.8</p> </td></tr><tr><td> <p>120</p> </td><td> <p>10.9</p> </td></tr><tr><td> <p>144</p> </td><td> <p>11.3</p> </td></tr></tbody></table> 
<table><tbody><tr><td> <p><strong>PDB</strong></p> </td><td> <p><strong>总核数</strong></p> </td><td> <p><strong>速度ns/day</strong></p> </td><td> <p><strong>盒子大小</strong></p> </td></tr><tr><td rowspan="3"> <p>6kyh</p> </td><td rowspan="3"> <p><strong>96</strong></p> </td><td> <p>5.749</p> </td><td> <p>0.8</p> </td></tr><tr><td> <p>5.452</p> </td><td> <p>1.0</p> </td></tr><tr><td> <p>5.494</p> </td><td> <p>1.2</p> </td></tr><tr><td rowspan="3"> <p>6kyk</p> </td><td rowspan="3"> <p><strong>96</strong></p> </td><td> <p>10.241</p> </td><td> <p>0.8</p> </td></tr><tr><td> <p>9.881</p> </td><td> <p>1.0</p> </td></tr><tr><td> <p>9.776</p> </td><td> <p>1.2</p> </td></tr></tbody></table> 
<h2>存储大小</h2> 
<ul><li>400ps，100ps存一次，分别为90M和48M。</li></ul> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dd70734e5d572ee25464ded3abf54715/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">协议数据单元I-PDU Multiplexer深入理解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/701d27a84a40f6d2493b57c3d0e6a5be/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IDEA 中的 @NonNls 注解的引用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>