<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>torch模型的保存和加载 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="torch模型的保存和加载" />
<meta property="og:description" content="这里介绍只保存加载模型的参数的方法，因为速度快，占内存小。
保存语法：
torch.save(model.state_dict(),&#39;model.pth&#39;)
加载模型的语法：
因为只保存了模型的参数，所以需要先定义一个网络对象，然后再加载模型的参数。
例如：
model = ClassNet()
将模型参数加载到新模型中，torch.load返回的时一个OrderedDict,model.state_dict()把模型的所有参数都以OrderdeDict的形式保存了下来。
{&#39;epoch&#39;: 1, &#39;model_name&#39;: &#39;resnet&#39;, &#39;state_dict&#39;: OrderedDict([(&#39;backbone.conv1.weight&#39;, tensor([[[[-9.6635e-03, -5.8054e-03, -1.7499e-03, ..., 5.6849e-02, 1.7084e-02, -1.2774e-02], [ 1.1954e-02, 1.0023e-02, -1.0967e-01, ..., -2.7083e-01, -1.2892e-01, 3.8908e-03], [-6.0705e-03, 5.9568e-02, 2.9577e-01, ..., 5.2005e-01, 2.5649e-01, 6.3826e-02], state_dict = torch.load(&#39;model.pth&#39;)
model.load_state_dict(state_dict)
这里附上一份自己的torch分类代码中的模型的保存和加载
#自定义模型保存 state = { &#34;epoch&#34;: epoch &#43; 1, &#34;model_name&#34;: config.model_name, &#34;state_dict&#34;: model.state_dict(), &#34;F_Score&#34;: F_Score, &#34;optimizer&#34;: optimizer.state_dict(), } filename = config.weights &#43; config.model_name &#43; &#34;.pth&#34; # resnet.pth torch." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/da1a992c024e1be22b041bf781e371e8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-03T18:11:06+08:00" />
<meta property="article:modified_time" content="2022-05-03T18:11:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">torch模型的保存和加载</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>这里介绍只保存加载模型的参数的方法，因为速度快，占内存小。</p> 
<p>保存语法：</p> 
<p>torch.save(model.state_dict(),'model.pth')</p> 
<p>加载模型的语法：</p> 
<p>因为只保存了模型的参数，所以需要先定义一个网络对象，然后再加载模型的参数。</p> 
<p>例如：</p> 
<p>model = ClassNet()</p> 
<p>将模型参数加载到新模型中，torch.load返回的时一个OrderedDict,model.state_dict()把模型的所有参数都以OrderdeDict的形式保存了下来。</p> 
<pre><code class="language-python">{'epoch': 1, 'model_name': 'resnet', 'state_dict': OrderedDict([('backbone.conv1.weight', tensor([[[[-9.6635e-03, -5.8054e-03, -1.7499e-03,  ...,  5.6849e-02,
            1.7084e-02, -1.2774e-02],
          [ 1.1954e-02,  1.0023e-02, -1.0967e-01,  ..., -2.7083e-01,
           -1.2892e-01,  3.8908e-03],
          [-6.0705e-03,  5.9568e-02,  2.9577e-01,  ...,  5.2005e-01,
            2.5649e-01,  6.3826e-02],</code></pre> 
<p>state_dict = torch.load('model.pth')</p> 
<p>model.load_state_dict(state_dict)</p> 
<p>这里附上一份自己的torch分类代码中的模型的保存和加载</p> 
<pre><code class="language-python">#自定义模型保存
state = {
           "epoch": epoch + 1,
           "model_name": config.model_name,
           "state_dict": model.state_dict(),
           "F_Score": F_Score,
           "optimizer": optimizer.state_dict(),
            }

filename = config.weights + config.model_name + ".pth" # resnet.pth

torch.save(state, filename)

#test中模型的加载

 model = Model.get_net()
 checkpoint = torch.load(config.weights + config.model_name + '.pth')
 model.load_state_dict(checkpoint["state_dict"])
 Make_Confusion_Matrix(test_loader2, model)  #调用模型</code></pre> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/22e354907673b351841e4b8c1af6427a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">深入torch框架内部</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/78a06fc7e4ac53155fcf7c5c7b6e9135/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">RuntimeError: Error(s) in loading state_dict for ResNet</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>