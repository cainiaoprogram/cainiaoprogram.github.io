<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>spring rest docs创建api文档介绍 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="spring rest docs创建api文档介绍" />
<meta property="og:description" content="日常开发中可能很少会用到spring rest docs来创建API文档，因为spring boot容易集成的原因，大家可能还是比较倾向于使用swaggerUI文档框架了，spring rest docs有一个好处是需要写单元测试（这个是很多开发人员不愿意的，包括我 -_-），还有个人觉得从界面和展示效果，我还是比较喜欢spring rest docs。在开发中接口文档是必不可少的，至于选择哪一种，就自由选择了。
下面只要是以一个简单的例子来介绍怎么样去使用spring rest docs来生成文档的。
第一步先保证这些依赖引入，至于可以结合spring boot里面是starter来引入，如1.5.12.RELEASE
&lt;properties&gt; &lt;!--spring restdocs--&gt; &lt;spring-restdocs.version&gt;1.2.4.RELEASE&lt;/spring-restdocs.version&gt; &lt;!--asciidoctor--&gt; &lt;asciidoctor-maven-plugin.version&gt;1.5.6&lt;/asciidoctor-maven-plugin.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.restdocs&lt;/groupId&gt; &lt;artifactId&gt;spring-restdocs-mockmvc&lt;/artifactId&gt; &lt;version&gt;1.2.4.RELEASE&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.asciidoctor&lt;/groupId&gt; &lt;artifactId&gt;asciidoctor-maven-plugin&lt;/artifactId&gt; &lt;version&gt;${asciidoctor-maven-plugin.version}&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;generate-docs&lt;/id&gt; &lt;phase&gt;prepare-package&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;process-asciidoc&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;backend&gt;html&lt;/backend&gt; &lt;doctype&gt;book&lt;/doctype&gt; &lt;/configuration&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.restdocs&lt;/groupId&gt; &lt;artifactId&gt;spring-restdocs-asciidoctor&lt;/artifactId&gt; &lt;version&gt;${spring-restdocs.version}&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;/plugin&gt; &lt;plugin&gt; &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;copy-resources&lt;/id&gt; &lt;phase&gt;prepare-package&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;copy-resources&lt;/goal&gt; &lt;/goals&gt; &lt;configuration&gt; &lt;outputDirectory&gt;${project." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/919d03dd094771970e53f8057e633d71/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-07-11T15:53:28+08:00" />
<meta property="article:modified_time" content="2019-07-11T15:53:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">spring rest docs创建api文档介绍</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>日常开发中可能很少会用到<a href="https://docs.spring.io/spring-restdocs/docs/2.0.0.RELEASE/reference/html5/#" rel="nofollow">spring rest docs</a>来创建API文档，因为spring boot容易集成的原因，大家可能还是比较倾向于使用swaggerUI文档框架了，spring rest docs有一个好处是需要写单元测试（这个是很多开发人员不愿意的，包括我 -_-），还有个人觉得从界面和展示效果，我还是比较喜欢spring rest docs。在开发中接口文档是必不可少的，至于选择哪一种，就自由选择了。</p> 
<p>下面只要是以一个简单的例子来介绍怎么样去使用spring rest docs来生成文档的。</p> 
<p>第一步先保证这些依赖引入，至于可以结合spring boot里面是starter来引入，如1.5.12.RELEASE</p> 
<pre><code>   &lt;properties&gt;
        &lt;!--spring restdocs--&gt;
        &lt;spring-restdocs.version&gt;1.2.4.RELEASE&lt;/spring-restdocs.version&gt;
        &lt;!--asciidoctor--&gt;
        &lt;asciidoctor-maven-plugin.version&gt;1.5.6&lt;/asciidoctor-maven-plugin.version&gt;
    &lt;/properties&gt;
    
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;
 
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
 
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.restdocs&lt;/groupId&gt;
            &lt;artifactId&gt;spring-restdocs-mockmvc&lt;/artifactId&gt;
            &lt;version&gt;1.2.4.RELEASE&lt;/version&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.asciidoctor&lt;/groupId&gt;
                &lt;artifactId&gt;asciidoctor-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;${asciidoctor-maven-plugin.version}&lt;/version&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;id&gt;generate-docs&lt;/id&gt;
                        &lt;phase&gt;prepare-package&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;process-asciidoc&lt;/goal&gt;
                        &lt;/goals&gt;
                        &lt;configuration&gt;
                            &lt;backend&gt;html&lt;/backend&gt;
                            &lt;doctype&gt;book&lt;/doctype&gt;
                        &lt;/configuration&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
                &lt;dependencies&gt;
                    &lt;dependency&gt;
                        &lt;groupId&gt;org.springframework.restdocs&lt;/groupId&gt;
                        &lt;artifactId&gt;spring-restdocs-asciidoctor&lt;/artifactId&gt;
                        &lt;version&gt;${spring-restdocs.version}&lt;/version&gt;
                    &lt;/dependency&gt;
                &lt;/dependencies&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;id&gt;copy-resources&lt;/id&gt;
                        &lt;phase&gt;prepare-package&lt;/phase&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;copy-resources&lt;/goal&gt;
                        &lt;/goals&gt;
                        &lt;configuration&gt;
                            &lt;outputDirectory&gt;${project.build.outputDirectory}/static/docs&lt;/outputDirectory&gt;
                            &lt;resources&gt;
                                &lt;resource&gt;
                                    &lt;directory&gt;${project.build.directory}/generated-docs&lt;/directory&gt;
                                &lt;/resource&gt;
                            &lt;/resources&gt;
                        &lt;/configuration&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
            &lt;/plugin&gt;
   &lt;/build&gt;
</code></pre> 
<p>建一个单元测试类：</p> 
<pre><code>
import com.google.common.collect.ImmutableMap;
import com.xxx.service.customerservice.CustomerServiceTaskService;
import com.xxx..test.common.BaseTest;
import com.xxx.test.common.Constants;
import org.junit.Test;
import org.springframework.boot.test.mock.mockito.MockBean;
import org.springframework.restdocs.payload.JsonFieldType;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.when;
import static org.springframework.restdocs.mockmvc.MockMvcRestDocumentation.document;
import static org.springframework.restdocs.operation.preprocess.Preprocessors.preprocessResponse;
import static org.springframework.restdocs.operation.preprocess.Preprocessors.prettyPrint;
import static org.springframework.restdocs.payload.PayloadDocumentation.*;
import static org.springframework.restdocs.request.RequestDocumentation.parameterWithName;
import static org.springframework.restdocs.request.RequestDocumentation.requestParameters;

/**
 * @Date 2019-07-08
 */
public class ControllerTest extends BaseTest {

    @MockBean
    private CustomerServiceTaskService customerServiceTaskService;

    @Test
    public void listAvailableLists() throws Exception {
        List&lt;Map&lt;String, Object&gt;&gt; campaigns = new ArrayList&lt;&gt;();
        Map&lt;String, Object&gt; campaign = new HashMap&lt;&gt;();
        campaign.put("campaignId", 1);
        campaign.put("campaignName", "活动名称");
        campaign.put("remark", "备注信息");
        campaigns.add(campaign);

        when(this.customerServiceTaskService.listCampaigns(Constants.DEFAULT_V))
                .thenReturn(campaigns);

        assertGet("/xxxx/xx/listAvailableLists",
                ImmutableMap.of("vin", Constants.DEFAULT_V),
                document("v2-listAvailableLists",
                        preprocessResponse(prettyPrint()),
                        responseFields(
                                fieldWithPath("code").description("业务码"),
                                fieldWithPath("msg").optional().type(JsonFieldType.STRING).description("业务描述"),
                                subsectionWithPath("data").description("数据")
                        ),
                        responseFields(beneathPath("data").withSubsectionId("data"),
                                fieldWithPath("[].campaignId").description("ID"),
                                fieldWithPath("[].campaignName").description("名称"),
                                fieldWithPath("[].remark").description("备注")
                        ),
                        requestParameters(
                                parameterWithName("key").description("参数")
                        )
                )
        );
    }
}

</code></pre> 
<p>BaseTest.java</p> 
<pre><code>import com.xxx.server.boot.Application;
import com.xxx.test.AbstractMockTest;
import org.junit.Before;
import org.junit.Ignore;
import org.junit.runner.RunWith;
import org.mockito.MockitoAnnotations;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.restdocs.AutoConfigureRestDocs;
import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.test.context.junit4.SpringJUnit4ClassRunner;
import org.springframework.test.web.servlet.MockMvc;

/**
 * @author huangdi1309
 */
@RunWith(SpringJUnit4ClassRunner.class)
@SpringBootTest(classes = {Application.class})
@AutoConfigureMockMvc
@AutoConfigureRestDocs("target/generated-snippets")
@Ignore
public class BaseTest extends AbstractMockTest {

    @Autowired
    private MockMvc mockMvc;

    @Before
    public void setUp() throws Exception {
        MockitoAnnotations.initMocks(this);
    }

    @Override
    protected MockMvc getMockMvc() {
        return this.mockMvc;
    }
}
</code></pre> 
<p>AbstractMockTest.java</p> 
<pre><code>  public void assertGet(String api, Map&lt;String, Object&gt; params, RestDocumentationResultHandler document) throws Exception {
        this.assertGet(api, params, (HttpHeaders)null, HttpStatus.OK.value(), document);
    }
 public void assertGet(String api, Map&lt;String, Object&gt; params, int status, RestDocumentationResultHandler document) throws Exception {
        this.assertGet(api, params, (HttpHeaders)null, status, document);
    }

    public void assertGet(String api, Map&lt;String, Object&gt; params, HttpHeaders headers, int status, RestDocumentationResultHandler document) throws Exception {
        MockHttpServletRequestBuilder builder = RestDocumentationRequestBuilders.get(api, new Object[0]);
        if (params != null) {
            builder.params(this.toMulti(params));
        }

        if (headers != null) {
            builder.headers(headers);
        }

        builder.contentType(MediaType.APPLICATION_JSON_UTF8).accept(new MediaType[]{MediaType.APPLICATION_JSON_UTF8});
        ResultActions actions = this.perform(builder);
        if (document != null) {
            actions.andDo(document);
        }

        actions.andExpect(MockMvcResultMatchers.status().is(status));
    }
</code></pre> 
<p>在src/main/asciidoc目录下创建index.adoc 内容：</p> 
<pre><code>= Management API 文档
:doctype: book
:icons: font
:source-highlighter: highlightjs
:toc: left
:toclevels: 4
:sectlinks:
:numbered:


== API（v2版）
[[v2-listAvailableLists]]
=== 获取xxxxxx接口（/xxx/v2/xxx/listAvailableLists）

operation::v2-listAvailableLists[snippets='request-parameters,http-request,http-response,response-fields,response-fields-data']
[[v2-xxx-listFeedbacks]]

=== 获取事件接口（/xxx/v2/xxx/listFeedbacks）
operation::v2-xxx-listFeedbacks[snippets='request-parameters,http-request,http-response,response-fields,response-fields-data']

[[v2-xxx-listHis]]
=== 获取历史接口（/xxx/v2/xxx/listUpgradeHis）
operation::v2-xxx-listHis[snippets='request-parameters,http-request,http-response,response-fields,response-fields-data']

</code></pre> 
<p>通过mvnw package命令(也可以通过idea的maven界面操作，我就是这样的)就可以生成文档了。<br> <img src="https://images2.imgbox.com/63/47/bfF9FNyn_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/13/0c/cPza7sEh_o.png" alt="在这里插入图片描述"><br> 在/target/generated-docs下有个index.html，打开这个html,显示如下：<br> <img src="https://images2.imgbox.com/f0/f4/5XIuY1R9_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4fb070c4fa9046174bcd57322001d187/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">VisualStudioCode 构建 golang 开发环境</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/22cf7c96944279003b89708ba0233c57/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">TypeError: &#39;in &lt;string&gt;&#39; requires string as left operand, not int</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>