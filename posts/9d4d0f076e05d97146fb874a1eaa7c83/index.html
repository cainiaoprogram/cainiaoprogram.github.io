<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ACL的原理及配置 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ACL的原理及配置" />
<meta property="og:description" content="文章目录 一 技术背景：需要一个工具，实现流量过滤二 ACL应用三 ACL组成四 规则编号（Rule ID）：Rule ID分配规则： 六 通配符（Wildcard七 ACL的分类与标识八实验8.1.配置客户机8.2配置路由8.3 测试 一 技术背景：需要一个工具，实现流量过滤 某公司为保证财务数据安全，进制研发部门访问财务服务器，但总裁办公室不受限制
ACL概述
访问控制值列表（ACL）
通过ACL可以实现对网络中报文流的精确识别和控制，达到控制网络访问行为、防止网络攻击和提高网络带宽利用率的目的，从而切实保障网络环境的安全性和网络服务质量的可靠性。
应用于路由器接口的指令列表，用于指定哪些数据包可以接收转发，哪些数据包需要拒绝。
ACL是一系列permit或deny语句组成的、有序规则的列表。
ACL是一个匹配工具，能够对报文进行匹配和区分。
• permit（允许）：数据包过滤，允许那些流量通过
• deny （拒绝）：数据包过滤，拒绝那些流量通过
二 ACL应用 • 匹配IP流量
• 在Traffic-filter中被调用
• 在NAT（Network Address Translation）中被调用
• 在路由策略中被调用
• 在防火墙的策略部署中被调用
• 在QoS中被调用
• 其他……
三 ACL组成 ACL由若干条permit或deny语句组成。每条语句就是该ACL的一条规则，每条语句中的permit或deny就是与这条规则相对应的处理动作。原本华为和思科的ACL都是默认拒绝一切，但是，华为模拟器默认是允许一切。
ACL的组成：
• ACL编号：在网络设备上配置ACL时，每个ACL都需要分配一个编号，称为ACL编号，用来标识ACL。
• 规则：一个ACL通常由若干条“permit/deny”语句组成，每条语句就是该ACL的一条规则。
• 规则编号：每条规则都有一个相应的编号，称为规则编号，用来标识ACL规则。可以自定义，也可以系统自动分配。ACL规则的编号范围是0～4294967294，所有规则均按照规则编号从小到大进行排序。
• 动作：每条规则中的permit或deny，就是与这条规则相对应的处理动作。permit指“允许”，deny指“拒绝”，但是ACL一般是结合其他技术使用，不同的场景，处理动作的含义也有所不同。
比如：ACL如果与流量过滤技术结合使用（即流量过滤中调用ACL），permit就是“允许通行”的意思，deny就是“拒绝通行”的意思。
• 匹配项：ACL定义了极其丰富的匹配项。例子中体现的源地址，ACL还支持很多其他规则匹配项。
四 规则编号（Rule ID）： 规则编号（Rule ID）：
一个ACL中的每一条规则都有一个相应的编号，称为规则编号，用来标识ACL规则。可以自定义，也可以系统自动分配。
步长（Step）:
步长是系统自动为ACL规则分配编号时，每个相邻规则编号之间的差值，这个差值称为“步长”。缺省值/缺省步长为5。所以规则编号就是5/10/15…以此类推。
步长的作用是为了方便后续在旧规则之间，插入新的规则。
Rule ID分配规则： 系统为ACL中首条未手工指定编号的规则分配编号时，使用步长值（例如步长=5，首条规则编号为5）作为该规则的起始编号；为后续规则分配编号时，则使用大于当前ACL内最大规则编号且是步长整数倍的最小整数作为规则编号。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9d4d0f076e05d97146fb874a1eaa7c83/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-15T11:45:12+08:00" />
<meta property="article:modified_time" content="2022-11-15T11:45:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ACL的原理及配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#__1" rel="nofollow">一 技术背景：需要一个工具，实现流量过滤</a></li><li><a href="#_ACL_18" rel="nofollow">二 ACL应用</a></li><li><a href="#_ACL_27" rel="nofollow">三 ACL组成</a></li><li><a href="#_Rule_ID_38" rel="nofollow">四 规则编号（Rule ID）：</a></li><li><ul><li><a href="#Rule_ID_48" rel="nofollow">Rule ID分配规则：</a></li></ul> 
  </li><li><a href="#_Wildcard_59" rel="nofollow">六 通配符（Wildcard</a></li><li><a href="#_ACL_89" rel="nofollow">七 ACL的分类与标识</a></li><li><a href="#_122" rel="nofollow">八实验</a></li><li><ul><li><a href="#81_123" rel="nofollow">8.1.配置客户机</a></li><li><a href="#82_125" rel="nofollow">8.2配置路由</a></li><li><a href="#83__151" rel="nofollow">8.3 测试</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="__1"></a>一 技术背景：需要一个工具，实现流量过滤</h2> 
<p>某公司为保证财务数据安全，进制研发部门访问财务服务器，但总裁办公室不受限制<br> <img src="https://images2.imgbox.com/bf/8a/eg00SxdV_o.png" alt="在这里插入图片描述"><br> <strong>ACL概述</strong><br> 访问控制值列表（ACL）</p> 
<p>通过ACL可以实现对网络中报文流的精确识别和控制，达到控制网络访问行为、防止网络攻击和提高网络带宽利用率的目的，从而切实保障网络环境的安全性和网络服务质量的可靠性。</p> 
<p>应用于路由器接口的指令列表，用于指定哪些数据包可以接收转发，哪些数据包需要拒绝。</p> 
<p>ACL是一系列permit或deny语句组成的、有序规则的列表。<br> ACL是一个匹配工具，能够对报文进行匹配和区分。<br> • permit（允许）：数据包过滤，允许那些流量通过<br> • deny （拒绝）：数据包过滤，拒绝那些流量通过<br> <img src="https://images2.imgbox.com/7d/02/C0e1ODrg_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_ACL_18"></a>二 ACL应用</h2> 
<p>• 匹配IP流量<br> • 在Traffic-filter中被调用<br> • 在NAT（Network Address Translation）中被调用<br> • 在路由策略中被调用<br> • 在防火墙的策略部署中被调用<br> • 在QoS中被调用<br> • 其他……</p> 
<h2><a id="_ACL_27"></a>三 ACL组成</h2> 
<p>ACL由若干条permit或deny语句组成。每条语句就是该ACL的一条规则，每条语句中的permit或deny就是与这条规则相对应的处理动作。原本华为和思科的ACL都是默认拒绝一切，但是，华为模拟器默认是允许一切。<br> <img src="https://images2.imgbox.com/5c/06/4PauyWWk_o.png" alt="在这里插入图片描述"><br> ACL的组成：<br> • ACL编号：在网络设备上配置ACL时，每个ACL都需要分配一个编号，称为ACL编号，用来标识ACL。<br> • 规则：一个ACL通常由若干条“permit/deny”语句组成，每条语句就是该ACL的一条规则。<br> • 规则编号：每条规则都有一个相应的编号，称为规则编号，用来标识ACL规则。可以自定义，也可以系统自动分配。ACL规则的编号范围是0～4294967294，所有规则均按照规则编号从小到大进行排序。<br> • 动作：每条规则中的permit或deny，就是与这条规则相对应的处理动作。permit指“允许”，deny指“拒绝”，但是ACL一般是结合其他技术使用，不同的场景，处理动作的含义也有所不同。<br> 比如：ACL如果与流量过滤技术结合使用（即流量过滤中调用ACL），permit就是“允许通行”的意思，deny就是“拒绝通行”的意思。<br> • 匹配项：ACL定义了极其丰富的匹配项。例子中体现的源地址，ACL还支持很多其他规则匹配项。</p> 
<h2><a id="_Rule_ID_38"></a>四 规则编号（Rule ID）：</h2> 
<p>规则编号（Rule ID）：</p> 
<p>一个ACL中的每一条规则都有一个相应的编号，称为规则编号，用来标识ACL规则。可以自定义，也可以系统自动分配。</p> 
<p>步长（Step）:</p> 
<p>步长是系统自动为ACL规则分配编号时，每个相邻规则编号之间的差值，这个差值称为“步长”。缺省值/缺省步长为5。所以规则编号就是5/10/15…以此类推。</p> 
<p>步长的作用是为了方便后续在旧规则之间，插入新的规则。</p> 
<h3><a id="Rule_ID_48"></a>Rule ID分配规则：</h3> 
<p>系统为ACL中首条未手工指定编号的规则分配编号时，使用步长值（例如步长=5，首条规则编号为5）作为该规则的起始编号；为后续规则分配编号时，则使用大于当前ACL内最大规则编号且是步长整数倍的最小整数作为规则编号。<br> <img src="https://images2.imgbox.com/ef/53/dJIyw96g_o.png" alt="在这里插入图片描述"><br> 那步长的作用是什么？直接rule 1/2/3/4…为什么不可以？</p> 
<p>问：如果希望增加一条规则，该如何处理？</p> 
<p>答：可以在rule 10和rule 15之间，手工加入一条rule 11。</p> 
<p>因此，设置一定长度的步长的作用，是方便后续在旧规则之间插入新的规则。</p> 
<h2><a id="_Wildcard_59"></a>六 通配符（Wildcard</h2> 
<p>通配符是一个32比特长度的数值，用于指示IP地址中，哪些比特位需要严格匹配，哪些比特位无需匹配。</p> 
<p>通配符通常采用类似网络掩码的点分十进制形式表示，但是含义却与网络掩码完全不同。<br> • 当进行IP地址匹配的时候，后面会跟着32位掩码位，这32位称为通配符。</p> 
<p>• 通配符，也是点分十进制格式，换算成二进制后，0表示“匹配”，1表示“不关心”。</p> 
<p>• 具体看下这2条规则：</p> 
<p>rule 5: 拒绝源IP地址为10.1.1.1报文通过——因为通配符为全0，所以每一位都要严格匹配，因此匹配的是主机IP地址10.1.1.1；</p> 
<p>rule 15:允许源IP地址为10.1.1.0/24网段地址的报文通过——因为通配符：0.0.0.11111111，后8位为1，表示不关心，因此10.1.1.xxxxxxxx 的后8位可以为任意值，所以匹配的是10.1.1.0/24网段。</p> 
<p>• 例子：如果要精确匹配192.168.1.1/24这个IP地址对应的网段地址，通配符是多少？</p> 
<p>可以得出：网络位需要严格匹配，主机位无所谓，因此通配符为0.0.0.255。<br> <img src="https://images2.imgbox.com/e7/7f/s83l2RbK_o.png" alt="在这里插入图片描述"><br> • 如果想匹配192.168.1.0/24网段中的奇数IP地址，通配符该怎么写呢？</p> 
<p>奇数IP地址：192.168.1.1、192.168.1.5、192.168.1.11……<br> 后八位写成二进制：192.168.1.00000001、192.168.1.00000101、192.168.1.00001011……<br> 可以看出共同点：最后8位的高7位是任意值，最低位固定为1，因此答案是：192.168.1.1 0.0.0.254（0.0.0.11111110）<br> 这就得出了通配符的一个特点：通配符中的1或者0是可以不连续的。</p> 
<p>还有两个特殊的通配符：</p> 
<p>当通配符全为0来匹配IP地址时，表示精确匹配某个IP地址；<br> 当通配符全为1来匹配0.0.0.0地址时，表示匹配了所有IP地址。<br> <img src="https://images2.imgbox.com/f8/26/KVCRQHu0_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_ACL_89"></a>七 ACL的分类与标识</h2> 
<p>不同厂商编号不同<br> • <strong>基于ACL规则定义方式的分类</strong><br> <img src="https://images2.imgbox.com/8f/86/aUJUyleu_o.png" alt="在这里插入图片描述"><br> • <strong>基于ACL标识方法的分类</strong><br> <img src="https://images2.imgbox.com/c8/52/k821JvW8_o.png" alt="在这里插入图片描述"><br> • <strong>基本ACL&amp;高级ACL</strong><br> <img src="https://images2.imgbox.com/c4/7a/Xgr5ta1P_o.png" alt="在这里插入图片描述"><br> <strong>ACL的匹配机制</strong><br> 不同厂商机制不同，ACL的匹配机制概括来说就是：</p> 
<p>配置ACL的设备接收报文后，会将该报文与ACL中的规则逐条进行匹配，如果不能匹配上，就会继续尝试去匹配下一条规则。</p> 
<p>一旦匹配上，则设备会对该报文执行这条规则中定义的处理动作，并且不再继续尝试与后续规则匹配。</p> 
<p>①如果ACL不存在，则返回ACL匹配结果为：不匹配。<br> ②如果ACL存在，则查找设备是否配置了ACL规则。</p> 
<p>③如果规则不存在，则返回ACL匹配结果为：不匹配。<br> ④如果规则存在，则系统会从ACL中编号最小的规则开始查找。</p> 
<p>⑤如果匹配上了permit规则，则停止查找规则，并返回ACL匹配结果为：匹配（允许）。<br> ⑥如果匹配上了deny规则，则停止查找规则，并返回ACL匹配结果为：匹配（拒绝）。</p> 
<p>如果未匹配上规则，则继续查找下一条规则，以此循环。如果一直查到最后一条规则，报文仍未匹配上，则返回ACL匹配结果为：不匹配。</p> 
<p>从整个ACL匹配流程可以看出，报文与ACL规则匹配后，会产生两种匹配结果：“匹配”和“不匹配”。</p> 
<p>匹配（命中规则）：指存在ACL，且在ACL中查找到了符合匹配条件的规则。不论匹配的动作是“permit”还是“deny”，都称为“匹配”，而不是只是匹配上permit规则才算“匹配”。</p> 
<p>不匹配（未命中规则）：指不存在ACL，或ACL中无规则，再或者在ACL中遍历了所有规则都没有找到符合匹配条件的规则。以上三种情况，都叫做“不匹配”。</p> 
<p>PS：匹配原则：一旦命中即停止匹配。</p> 
<h2><a id="_122"></a>八实验</h2> 
<h3><a id="81_123"></a>8.1.配置客户机</h3> 
<p><img src="https://images2.imgbox.com/73/3b/ATbQsJgc_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="82_125"></a>8.2配置路由</h3> 
<pre><code class="prism language-bash"><span class="token operator">&lt;</span>Huawei<span class="token operator">&gt;</span>sys
Enter system view, <span class="token builtin class-name">return</span> user view with Ctrl+Z.
<span class="token punctuation">[</span>Huawei<span class="token punctuation">]</span>int g0/0/0
<span class="token punctuation">[</span>Huawei-GigabitEthernet0/0/0<span class="token punctuation">]</span>ip <span class="token function">add</span> <span class="token number">192.168</span>.1.254 <span class="token number">24</span>
<span class="token punctuation">[</span>Huawei-GigabitEthernet0/0/0<span class="token punctuation">]</span>int g0/0/1
<span class="token punctuation">[</span>Huawei-GigabitEthernet0/0/1<span class="token punctuation">]</span>ip <span class="token function">add</span> <span class="token number">192.168</span>.2.254 <span class="token number">24</span>  
<span class="token punctuation">[</span>Huawei-GigabitEthernet0/0/1<span class="token punctuation">]</span>int g0/0/2
<span class="token punctuation">[</span>Huawei-GigabitEthernet0/0/2<span class="token punctuation">]</span>ip <span class="token function">add</span> <span class="token number">192.168</span>.3.254 <span class="token number">24</span>
<span class="token punctuation">[</span>Huawei<span class="token punctuation">]</span>acl <span class="token number">2000</span>                                              <span class="token comment">## 建立规则 </span>
<span class="token punctuation">[</span>Huawei-acl-basic-2000<span class="token punctuation">]</span>rule <span class="token number">5</span> deny <span class="token builtin class-name">source</span> <span class="token number">192.168</span>.1.1 <span class="token number">0</span>       <span class="token comment">## 禁止该地址访问</span>
<span class="token builtin class-name">return</span>
<span class="token punctuation">[</span>Huawei-acl-basic-2000<span class="token punctuation">]</span>int g0/0/1
<span class="token punctuation">[</span>Huawei-GigabitEthernet0/0/1<span class="token punctuation">]</span>traffic-	
<span class="token punctuation">[</span>Huawei-GigabitEthernet0/0/1<span class="token punctuation">]</span>traffic-filter out	
<span class="token punctuation">[</span>Huawei-GigabitEthernet0/0/1<span class="token punctuation">]</span>traffic-filter outbound acl <span class="token number">2000</span>  <span class="token comment">##应用规则</span>
<span class="token punctuation">[</span>Huawei-GigabitEthernet0/0/1<span class="token punctuation">]</span>dis this
<span class="token punctuation">[</span>V200R003C00<span class="token punctuation">]</span>
<span class="token comment">#</span>
interface GigabitEthernet0/0/1
 <span class="token function">ip</span> address <span class="token number">192.168</span>.2.254 <span class="token number">255.255</span>.255.0 
 traffic-filter outbound acl <span class="token number">2000</span>
 
</code></pre> 
<h3><a id="83__151"></a>8.3 测试</h3> 
<p><img src="https://images2.imgbox.com/92/05/WqjWmdBL_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b8bae77fdc6b6a4d0bc76092297012bb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">模型压缩总结</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/593daa8b9e5c88c898c164c846f22ef0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">谷歌浏览器如何设置internet选项</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>