<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>docker搭建gitlab - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="docker搭建gitlab" />
<meta property="og:description" content="一、运行gitlab $ docker run --detach \ --publish 8443:443 --publish 8080:80 --publish 2222:22 \ --name=gitlab \ --restart=always \ --volume /data/gitlab/config:/etc/gitlab \ --volume /data/gitlab/logs:/var/log/gitlab \ --volume /data/gitlab/data:/var/opt/gitlab \ --privileged=true \ gitlab/gitlab-ce-zh:11.1.4 二、修改配置文件 配置web和ssh访问
$ vim /data/gitlab/config/gitlab.rb external_url &#39;http://192.168.15.9&#39; # 宿主机ip，设置web访问(http://192.168.15.9:8080) gitlab_rails[&#39;gitlab_ssh_host&#39;] = &#39;192.168.15.9&#39; # 宿主机ip，设置仓库的访问 gitlab_rails[&#39;gitlab_shell_ssh_port&#39;] = 2222 # 容器ssh 22端口映射到宿主机的端口2222 配置邮箱（可选），配置了邮箱：
1、新增gitlab用户的时候，会用该邮箱发送重置用户密码到用户邮箱
2、忘记管理员root密码的时候，也可以通过该邮箱找回密码
$ vim /etc/gitlab/gitlab.rb # 以下配置aliyun邮箱为例 #配置下面，需要配置smtp_tls #注意gitlab_rails[&#39;smtp_tls&#39;] 这个是设定为true gitlab_rails[&#39;smtp_enable&#39;] = true gitlab_rails[&#39;smtp_address&#39;] = &#34;smtp.aliyun.com&#34; gitlab_rails[&#39;smtp_port&#39;] = 465 gitlab_rails[&#39;smtp_user_name&#39;] = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/cf6b61e8b7714e04d7317f580a612b31/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-05-12T20:47:46+08:00" />
<meta property="article:modified_time" content="2020-05-12T20:47:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">docker搭建gitlab</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="gitlab_0"></a>一、运行gitlab</h4> 
<pre><code>$ docker run --detach \
  --publish 8443:443 --publish 8080:80 --publish 2222:22 \
  --name=gitlab \
  --restart=always \
  --volume /data/gitlab/config:/etc/gitlab \
  --volume /data/gitlab/logs:/var/log/gitlab \
  --volume /data/gitlab/data:/var/opt/gitlab \
  --privileged=true \
  gitlab/gitlab-ce-zh:11.1.4
</code></pre> 
<h4><a id="_13"></a>二、修改配置文件</h4> 
<p>配置web和ssh访问</p> 
<pre><code>$ vim /data/gitlab/config/gitlab.rb

external_url 'http://192.168.15.9'    # 宿主机ip，设置web访问(http://192.168.15.9:8080)
gitlab_rails['gitlab_ssh_host'] = '192.168.15.9'    # 宿主机ip，设置仓库的访问
gitlab_rails['gitlab_shell_ssh_port'] = 2222    # 容器ssh 22端口映射到宿主机的端口2222
</code></pre> 
<p>配置邮箱（可选），配置了邮箱：</p> 
<blockquote> 
 <p>1、新增gitlab用户的时候，会用该邮箱发送重置用户密码到用户邮箱<br> 2、忘记管理员root密码的时候，也可以通过该邮箱找回密码</p> 
</blockquote> 
<pre><code>$ vim /etc/gitlab/gitlab.rb

# 以下配置aliyun邮箱为例
#配置下面，需要配置smtp_tls 
#注意gitlab_rails['smtp_tls'] 这个是设定为true
gitlab_rails['smtp_enable'] = true
gitlab_rails['smtp_address'] = "smtp.aliyun.com"
gitlab_rails['smtp_port'] = 465
gitlab_rails['smtp_user_name'] = "tab609@aliyun.com"    # 邮箱用户
gitlab_rails['smtp_password'] = "youpassword"           # 邮箱密码
gitlab_rails['smtp_domain'] = "smtp.aliyun.com"
gitlab_rails['smtp_authentication'] = "login"
gitlab_rails['smtp_enable_starttls_auto'] = true
gitlab_rails['smtp_tls'] = true
#配置邮箱来源，以及展示的名称
gitlab_rails['gitlab_email_enabled'] = true
gitlab_rails['gitlab_email_from'] = 'tab609@aliyun.com'
gitlab_rails['gitlab_email_display_name'] = 'Gitlab'
</code></pre> 
<h4><a id="gitlab_47"></a>三、重启gitlab</h4> 
<pre><code># 方法一重启容器
$ docker restart gitlab

# 方法二在容器中执行重启gitlab命令
$ docker exec gitlab gitlab-ctl reconfigure
</code></pre> 
<p>访问web：http://192.168.15.9:8080<br> <strong>注：首次打开web登录界面需要先设置管理员root账号的密码（密码至少需要8个字符）</strong></p> 
<h4><a id="_58"></a>四、创建一个仓库测试是否搭建成功</h4> 
<p>以下1-4步用管理员root账号登录gitlab进行操作</p> 
<h5><a id="1_61"></a>1、创建一个群组</h5> 
<p><img src="https://images2.imgbox.com/fe/9a/eXRUY3Bx_o.png" alt="群组"></p> 
<h5><a id="2_63"></a>2、创建项目</h5> 
<p>这里我们创建一个属于dev群组的项目test，这样在dev群组下的用户就会有权限访问该项目仓库了<br> <img src="https://images2.imgbox.com/1a/2b/gYv03v1I_o.png" alt="项目"></p> 
<h5><a id="3_67"></a>3、创建一个普通用户</h5> 
<p>必填项只有：姓名，用户名，邮箱，其他默认就好了，这里我们创建tab609用户<br> <img src="https://images2.imgbox.com/91/61/O3lrPoS1_o.png" alt="用户"></p> 
<p><strong>注：如果我们在第二步没有配置gitlab邮箱，那么新创建的用户将不会收到重置密码的邮件，root管理员可以帮该用户设置初始密码</strong></p> 
<blockquote> 
 <p>管理区域 --&gt; Users --&gt; tab609 --&gt; 点击编辑</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/46/38/eMWprDn5_o.png" alt="编辑"><br> root用户设置tab609用户的初始密码（密码长度必须大于等于8个字符），把密码告诉tab609用户，tab609就可以用管理员设置的初始密码登录了，首次登录gitlab会提示重置密码</p> 
<p><img src="https://images2.imgbox.com/27/29/Topxajy2_o.png" alt="密码"></p> 
<h5><a id="4_80"></a>4、把用户拉都群组</h5> 
<p>把tab609用户拉到dev群组，并给予主程序员权限，这样tab609用户就有权限访问dev群组下的仓库了<br> <img src="https://images2.imgbox.com/32/5b/fRkL4r4l_o.png" alt="dev群"></p> 
<p><strong>注：可以单独配置某用户在群组中的具体权限，不同权限，拥有对该群组下的仓库操作权限不一样。</strong></p> 
<h5><a id="5tab609ssh_key_86"></a>5、设置tab609用户的ssh key</h5> 
<p>以下5-7步用tab609用户登录gitlab进行操作</p> 
<pre><code># step1: 先在要克隆代码的主机上生成ssh key
$ ssh-keygen    # 一直按 Enter 键确认即可，会在执行当前 ssh-keygen 命令的用户目录下生成相应文件(ls ~/.ssh)

# step2：把公钥添加到gitlab的tab609用户的ssh密钥中
$ cat ~/.ssh/id_rsa.pub    # 复制 ~/.ssh/id_rsa.pub 文件的内容
如下图
</code></pre> 
<p><img src="https://images2.imgbox.com/71/63/tvQEwet2_o.png" alt="ssh key"></p> 
<h5><a id="6_98"></a>6、克隆项目代码</h5> 
<p>到项目详情copy项目ssh url<br> <img src="https://images2.imgbox.com/e4/f3/MrJJZbfa_o.png" alt="ssh url"></p> 
<pre><code>$ git clone ssh://git@192.168.15.9:2222/dev/test.git
Cloning into 'test'...
remote: Counting objects: 17, done.
remote: Compressing objects: 100% (12/12), done.
remote: Total 17 (delta 1), reused 5 (delta 0)
Receiving objects: 100% (17/17), done.
Resolving deltas: 100% (1/1), done.

# 我们需要先设置以下git的账号和邮箱，可以设置全局的，也可以只针对某仓库local设置
# 针对全局
$ git config --global user.name "tab609"
$ git config --global user.email "tab609@qq.com"

# 针对某仓库设置，如只对test仓库配置特定的账号和邮箱（需要先进到test仓库目录再设置）
$ cd test
$ git config --local user.name "tab609"
$ git config --local user.email "tab609@qq.com"

# 针对某仓库设置账号的应用场景：比如我的电脑访问公司的仓库用户是A，而我个人的github仓库用户是B，那么我们就需要设置局部的git账号而并非全局了
</code></pre> 
<h5><a id="7_123"></a>7、提交代码到仓库</h5> 
<pre><code># 已配置好git的账号，进入到仓库目录
$ cd test

# 我们touch一个空的hello文件
$ touch hello

$ ls
hello  README.md

$ git add hello
$ git commit -m "touch hello file"
$ git push origin master

# 到gitlab页面就可以看到这次的提交了
</code></pre> 
<p>git常用操作的命令可以查看阮一峰老师的<a href="https://www.ruanyifeng.com/blog/2015/12/git-cheat-sheet.html" rel="nofollow">博客</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8e573d3937dbd1092c2bff9a78fe504c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">实验4 循环结构程序设计</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0421558a0db59e2d398f79393789544e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于卷积神经网络的垃圾分类</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>