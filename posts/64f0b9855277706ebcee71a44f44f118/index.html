<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python3报错处理：UnicodeEncodeError: ‘ascii‘ codec can‘t encode characters in position 0-1 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python3报错处理：UnicodeEncodeError: ‘ascii‘ codec can‘t encode characters in position 0-1" />
<meta property="og:description" content="一、背景说明 最开始不愿意使用Python，一大原因是因为Python2默认使用ASCII编码处理中文可以说是一件痛苦的事情。仅从更换默认编码一项变换，就可以说Python3和Python2不算同一门语言。
Python3更换为默认使用Unicode（utf-8）编码，一直使用下来再没有遇到编码问题带来的困挠，似乎编码问题在Python3时代就该完全消失的。但这两天遇到了一个问题。
在调用一个库时，出现了一个异常报错类似如UnicodeEncodeError: &#39;ascii&#39; codec can&#39;t encode characters in position 0-1: ordinal not in range(128)，几经排查之下发现只要该库返回结果包含中文，我这边使用print()打印该结果时就会出现该异常。
二、原因分析 2.1 数据要经过编码才能传输
我们知道数据在网络上传输时，需要先编码；平时我们可能并不注意，但现在要明确，编码的原因不在于网络而在于传输。
print()相当于把字符串从内存传输到了tty上，所以print()是需要encode()动作的；平时我们print()时一般都不需要encode()，只是因为当print()检测到传来的参数是不是byte类型时自动进行了编码。
2.2 print()使用何种编码
Python3默认使用的是utf-8，这可以通过sys.getdefaultencoding()进行确认。但这只是默认，当系统配置了LC_ALL、LC_CTYPE、LANG等环境变量时（三者优先级从高到低），Python3采用这些变量配置的编码；如果这些变量配置的是utf-8那Python3用的就还是utf-8，但如果不是utf-8那Python3所用的也就不是utf-8了。
当前使用的编码可通过sys.getfilesystemencoding()获取。
三、场景复现 为简单起见，我们这里直接以打印一个中文字符串作为演示，示例代码如下（我这里保存成test_encode.py）：
import sys class TestEncode(): def __int__(self): pass def main_logic(self): # 打印语言默认编码 print(f&#34;defaultencoding--{sys.getdefaultencoding()}&#34;) # 打印系统配置的编码 print(f&#34;filesystemencoding--{sys.getfilesystemencoding()}&#34;) # 最后尝试打印中文 print(&#34;中文&#34;) if __name__ == &#34;__main__&#34;: obj = TestEncode() obj.main_logic() shell依次执行如下命令：
# 查看当前编码情况 locale # 确认在utf-8情况下打印中文无误 python3 test_encode.py # 设置LC_TYPE，C代表ASCII export LC_CTYPE=&#34;C&#34; # 查看当前编码情况 locale # 再次运行，确认系统编码已改变，并出现编码错误 python3 test_encode." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/64f0b9855277706ebcee71a44f44f118/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-02T16:04:26+08:00" />
<meta property="article:modified_time" content="2020-07-02T16:04:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python3报错处理：UnicodeEncodeError: ‘ascii‘ codec can‘t encode characters in position 0-1</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>一、背景说明</h4> 
<p>最开始不愿意使用Python，一大原因是因为Python2默认使用ASCII编码处理中文可以说是一件痛苦的事情。仅从更换默认编码一项变换，就可以说Python3和Python2不算同一门语言。</p> 
<p>Python3更换为默认使用Unicode（utf-8）编码，一直使用下来再没有遇到编码问题带来的困挠，似乎编码问题在Python3时代就该完全消失的。但这两天遇到了一个问题。</p> 
<p>在调用一个库时，出现了一个异常报错类似如UnicodeEncodeError: 'ascii' codec can't encode characters in position 0-1: ordinal not in range(128)，几经排查之下发现只要该库返回结果包含中文，我这边使用print()打印该结果时就会出现该异常。</p> 
<p> </p> 
<h4>二、原因分析</h4> 
<p><strong>2.1 数据要经过编码才能传输</strong></p> 
<p>我们知道数据在网络上传输时，需要先编码；平时我们可能并不注意，但现在要明确，编码的原因不在于网络而在于传输。</p> 
<p>print()相当于把字符串从内存传输到了tty上，所以print()是需要encode()动作的；平时我们print()时一般都不需要encode()，只是因为当print()检测到传来的参数是不是byte类型时自动进行了编码。</p> 
<p><strong>2.2 print()使用何种编码</strong></p> 
<p>Python3默认使用的是utf-8，这可以通过sys.getdefaultencoding()进行确认。但这只是默认，当系统配置了LC_ALL、LC_CTYPE、LANG等环境变量时（三者优先级从高到低），Python3采用这些变量配置的编码；如果这些变量配置的是utf-8那Python3用的就还是utf-8，但如果不是utf-8那Python3所用的也就不是utf-8了。</p> 
<p>当前使用的编码可通过sys.getfilesystemencoding()获取。</p> 
<p> </p> 
<h4>三、场景复现</h4> 
<p>为简单起见，我们这里直接以打印一个中文字符串作为演示，示例代码如下（我这里保存成test_encode.py）：</p> 
<pre><code class="language-python">import sys

class TestEncode():
    def __int__(self):
        pass

    def main_logic(self):
        # 打印语言默认编码
        print(f"defaultencoding--{sys.getdefaultencoding()}")
        # 打印系统配置的编码
        print(f"filesystemencoding--{sys.getfilesystemencoding()}")

        # 最后尝试打印中文
        print("中文")

if __name__ == "__main__":
    obj = TestEncode()
    obj.main_logic()</code></pre> 
<p>shell依次执行如下命令：</p> 
<pre><code class="language-python"># 查看当前编码情况
locale
# 确认在utf-8情况下打印中文无误
python3 test_encode.py

# 设置LC_TYPE，C代表ASCII
export LC_CTYPE="C"
# 查看当前编码情况
locale
# 再次运行，确认系统编码已改变，并出现编码错误
python3 test_encode.py</code></pre> 
<p>最终结果如下，在系统编码配置为utf-8时打印正常，在系统编码改为C（即ASCII）后打印报编码异常（不过我在root用户环境修改编码一直不成功，不懂我电脑有点问题还是什么原因）：</p> 
<p><img alt="" height="433" src="https://images2.imgbox.com/1b/23/BHepqpiw_o.png" width="609"></p> 
<p> </p> 
<h4>四、解决办法</h4> 
<p>方法一：设置系统所用编码为utf-8</p> 
<p>既然问题是系统语言编码所致，那我们在运行前把LC_ALL等环境变量改为utf-8即可；实现的方式有多种，最简单的就是在运行前export。</p> 
<pre><code class="language-bash">export LC_ALL="en_US.utf8"</code></pre> 
<p>方法二：使用PYTHONIOENCODING</p> 
<pre><code class="language-bash">PYTHONIOENCODING=ascii python test_encode.py</code></pre> 
<p>方法三：先编好码再交给print()（不实用？）</p> 
<p>其实回顾我们第二大节的分析，之后以需要找系统的编码是因为print()收到未经编码的内容，所以更直接的处理办法是我们先编好码再交给print()就好了。（不过交给print时是byte类型，最后print输出的也是byte类型？）</p> 
<pre><code class="language-python">print("中文".encode(encoding="utf-8"))</code></pre> 
<p>方法四：直接在Python中重新设置标准输出编码</p> 
<p>这种方法直接在Python代码中改，是与Python最契合的做法，脚本文件形式时特别推荐</p> 
<pre><code class="language-python">import sys
import codecs

sys.stdout = codecs.getwriter("utf-8")(sys.stdout.detach())
print("中文")</code></pre> 
<p> </p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bb9f01b82f2e44d2f07289b42b98a38a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用nginx部署vue项目时，请求接口报404，但是postman能够拿到数据：解决办法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c2c8fc84811292a7e4ad0269d5fac694/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">打家劫舍</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>