<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Docker学习（十二）docker-compose构建 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Docker学习（十二）docker-compose构建" />
<meta property="og:description" content="目录 1.简介2.安装3.使用方法4.常用命令 1.简介 docker-compose： Compose可译为组合物，docker-compose 适用于定义和运行多个Docker容器的工具。通过docker-compose，你可以使用YAML文件来配置应用程序需要的所有服务，然后通过使用一个命令，就可以创建并启动所有服务。
docker-compose 将所管理的容器分为三层，分别是 工程（project），服务（service）以及容器（container）。
2.安装 官方安装文档：https://docs.docker.com/compose/install/
# 下载 sudo curl -L &#34;https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)&#34; -o /usr/local/bin/docker-compose # 增加执行权限 sudo chmod &#43;x /usr/local/bin/docker-compose # 查看是否安装成功 docker-compose --version 3.使用方法 目录分布
|- docker |- ---- docker-compose.yml |- ---- eureka-server |- ---- ---- eureka-server.jar |- ---- ---- Dockerfile |- ---- any-gateway |- ---- ---- any-gateway.jar |- ---- ---- Dockerfile Dockerfile：
FROM openjdk:8-jdk-alpine VOLUME /tmp ENV LANG en_US.UTF-8 ENV LANGUAGE en_US:en ENV LC_ALL en_US." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/195953eaa5f452a7bd9890bd8b32d941/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-23T11:24:54+08:00" />
<meta property="article:modified_time" content="2023-02-23T11:24:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Docker学习（十二）docker-compose构建</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><ul><li><a href="#1_2" rel="nofollow">1.简介</a></li><li><a href="#2_8" rel="nofollow">2.安装</a></li><li><a href="#3_22" rel="nofollow">3.使用方法</a></li><li><a href="#4_125" rel="nofollow">4.常用命令</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="1_2"></a>1.简介</h3> 
<blockquote> 
 <ul><li> <p><strong>docker-compose：</strong> Compose可译为组合物，docker-compose 适用于<code>定义和运行多个Docker容器的工具</code>。通过docker-compose，你可以使用YAML文件来配置应用程序需要的所有服务，然后通过使用一个命令，就可以创建并启动所有服务。</p> </li><li> <p>docker-compose 将所管理的容器分为三层，分别是 <strong>工程（project）</strong>，<strong>服务（service）<strong>以及</strong>容器（container）</strong>。</p> </li></ul> 
</blockquote> 
<h3><a id="2_8"></a>2.安装</h3> 
<p>官方安装文档：<a href="https://docs.docker.com/compose/install/" rel="nofollow">https://docs.docker.com/compose/install/</a></p> 
<pre><code class="prism language-shell"><span class="token comment"># 下载</span>
<span class="token function">sudo</span> <span class="token function">curl</span> <span class="token parameter variable">-L</span> <span class="token string">"https://github.com/docker/compose/releases/download/1.29.2/docker-compose-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-s</span><span class="token variable">)</span></span>-<span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-m</span><span class="token variable">)</span></span>"</span> <span class="token parameter variable">-o</span> /usr/local/bin/docker-compose
<span class="token comment"># 增加执行权限</span>
<span class="token function">sudo</span> <span class="token function">chmod</span> +x /usr/local/bin/docker-compose

<span class="token comment"># 查看是否安装成功</span>
<span class="token function">docker-compose</span> <span class="token parameter variable">--version</span>
</code></pre> 
<h3><a id="3_22"></a>3.使用方法</h3> 
<p>目录分布</p> 
<pre><code class="prism language-shell"><span class="token operator">|</span>- <span class="token function">docker</span>
<span class="token operator">|</span>- ---- docker-compose.yml
<span class="token operator">|</span>- ---- eureka-server
<span class="token operator">|</span>- ---- ---- eureka-server.jar
<span class="token operator">|</span>- ---- ---- Dockerfile
<span class="token operator">|</span>- ---- any-gateway
<span class="token operator">|</span>- ---- ---- any-gateway.jar
<span class="token operator">|</span>- ---- ---- Dockerfile
</code></pre> 
<p>Dockerfile：</p> 
<pre><code class="prism language-dockerfile">FROM openjdk:8-jdk-alpine
VOLUME /tmp
ENV LANG en_US.UTF-8
ENV LANGUAGE en_US:en
ENV LC_ALL en_US.UTF-8
ADD eureka-server.jar app.jar
ENTRYPOINT [ "java", "-Djava.security.egd=file:/dev/./urandom", "-jar", "/app.jar" ]
</code></pre> 
<p>docker-compose.yml</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">eureka-server</span><span class="token punctuation">:</span>
    <span class="token comment"># 指定容器名称</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> myProject<span class="token punctuation">-</span>eureka<span class="token punctuation">-</span>server
    <span class="token comment"># 指定主机名</span>
    <span class="token key atrule">hostname</span><span class="token punctuation">:</span> myProject
    <span class="token comment"># 指定镜像</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> myProject/eureka<span class="token punctuation">-</span>server<span class="token punctuation">:</span>0.0.1
    <span class="token comment"># 指定宿主映射端口</span>
    <span class="token comment">#ports:</span>
      <span class="token comment">#- "6002:6002"</span>
    <span class="token comment"># 绑定宿主机网络</span>
    <span class="token comment"># network_mode: "host"</span>
    <span class="token comment"># 指定容器IP</span>
    <span class="token key atrule">networks</span><span class="token punctuation">:</span>
      <span class="token key atrule">mynet</span><span class="token punctuation">:</span>
        <span class="token comment"># 宿主机会自动配置网关IP：172.20.1.1</span>
        <span class="token key atrule">ipv4_address</span><span class="token punctuation">:</span> 172.20.1.2
    <span class="token comment"># 指定构建</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./eureka<span class="token punctuation">-</span>server
    <span class="token comment"># 重启机制</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token comment"># 可以创建交互式会话</span>
    <span class="token key atrule">tty</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">any-gateway</span><span class="token punctuation">:</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> myProject<span class="token punctuation">-</span>gateway
    <span class="token key atrule">image</span><span class="token punctuation">:</span> myProject/gateway<span class="token punctuation">:</span>0.0.1
    <span class="token key atrule">build</span><span class="token punctuation">:</span> ./any<span class="token punctuation">-</span>gateway
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> eureka<span class="token punctuation">-</span>server
    <span class="token key atrule">network_mode</span><span class="token punctuation">:</span> <span class="token string">"service:eureka-server"</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
    <span class="token key atrule">tty</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token key atrule">networks</span><span class="token punctuation">:</span>
  <span class="token key atrule">mynet</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver</span><span class="token punctuation">:</span> bridge
    <span class="token key atrule">ipam</span><span class="token punctuation">:</span>
      <span class="token comment"># 这里不用配置driver</span>
      <span class="token comment"># driver: default</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">subnet</span><span class="token punctuation">:</span> <span class="token string">"172.20.1.0/24"</span>
</code></pre> 
<p>部署步骤：（以 eureka-server.jar 为例）</p> 
<ol><li> <p>将jar包放到 docker/eureka-server/ 下；</p> </li><li> <p>在 docker/eureka-server/ 执行如下命令，构建镜像</p> <pre><code class="prism language-shell">$ <span class="token function">docker</span> build <span class="token parameter variable">-t</span> my/eureka-server:0.0.1 <span class="token builtin class-name">.</span>
</code></pre> </li><li> <p>查看构建好的镜像：</p> <pre><code class="prism language-shell">$ <span class="token function">docker</span> images <span class="token operator">|</span> <span class="token function">grep</span> eureka-server
</code></pre> </li><li> <p>在 docker/ 执行如下命令，创建并后台运行容器：</p> <pre><code class="prism language-shell">$ <span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span>
</code></pre> </li><li> <p>查看运行的容器：</p> <pre><code class="prism language-shell">$ <span class="token function">docker-compose</span> <span class="token function">ps</span> <span class="token operator">|</span> <span class="token function">grep</span> eureka-server
</code></pre> </li></ol> 
<h3><a id="4_125"></a>4.常用命令</h3> 
<pre><code class="prism language-shell"><span class="token comment"># 创建并后台启动所有容器（-f 指定配置文件）</span>
$ <span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span>
<span class="token comment"># 创建并后台启动容器（镜像不存在自动build）</span>
$ <span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span> <span class="token punctuation">[</span>服务名<span class="token punctuation">]</span>

<span class="token comment"># 查看启动容器列表（-a 查看全部容器列表）</span>
$ <span class="token function">docker-compose</span> <span class="token function">ps</span>

<span class="token comment"># 查看日志</span>
$ <span class="token function">docker-compose</span> logs <span class="token parameter variable">-f</span> <span class="token parameter variable">--tail</span><span class="token operator">=</span><span class="token number">20</span> <span class="token punctuation">[</span>服务名<span class="token punctuation">]</span>

<span class="token comment"># 进入容器中</span>
$ <span class="token function">docker-compose</span> <span class="token builtin class-name">exec</span> <span class="token punctuation">[</span>服务名<span class="token punctuation">]</span> <span class="token function">bash</span>

<span class="token comment"># 停止容器</span>
$ <span class="token function">docker-compose</span> stop <span class="token punctuation">[</span>服务名<span class="token punctuation">]</span>
<span class="token comment"># 删除容器</span>
$ <span class="token function">docker-compose</span> <span class="token function">rm</span> <span class="token parameter variable">-f</span> <span class="token punctuation">[</span>服务名<span class="token punctuation">]</span>
<span class="token comment"># 构建镜像</span>
$ <span class="token function">docker-compose</span> build <span class="token punctuation">[</span>服务名<span class="token punctuation">]</span>
<span class="token comment"># 创建并后台启动容器（镜像不存在自动build）</span>
$ <span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span> <span class="token punctuation">[</span>服务名<span class="token punctuation">]</span>

<span class="token comment"># 构建镜像</span>
$ <span class="token function">docker-compose</span> build <span class="token punctuation">[</span>服务名<span class="token punctuation">]</span>
<span class="token comment"># 启动容器</span>
$ <span class="token function">docker-compose</span> start <span class="token punctuation">[</span>服务名<span class="token punctuation">]</span>
<span class="token comment"># 重启容器</span>
$ <span class="token function">docker-compose</span> restart <span class="token punctuation">[</span>服务名<span class="token punctuation">]</span>

<span class="token comment"># 停止并删除容器（--rmi all 删除镜像）</span>
$ <span class="token function">docker-compose</span> down
</code></pre> 
<br> 
<p>整理完毕，完结撒花~ 🌻</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b23e4d30742f903cbf61cebba7678793/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MongoDB在java代码中的增删改查</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b6bda7f06125d7401087fdf834def637/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">mysql中 show index from tablename后每列的含义</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>