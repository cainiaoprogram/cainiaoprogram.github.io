<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>跟着cherno手搓游戏引擎【2】：日志系统spdlog和premake的使用 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="跟着cherno手搓游戏引擎【2】：日志系统spdlog和premake的使用" />
<meta property="og:description" content="配置： 日志库文件github：
GitHub - gabime/spdlog: Fast C&#43;&#43; logging library.
新建vendor文件夹
将下载好的spdlog放入
配置YOTOEngine的附加包含目录：
配置Sandbox的附加包含目录：
包装spdlog： 在YOTO文件夹下创建Log.cpp和log.h
log.h：
#pragma once #include&#34;Core.h&#34; #include&lt;spdlog/spdlog.h&gt; #include &#34;spdlog/sinks/stdout_color_sinks.h&#34; namespace YOTO { class YOTO_API Log { public: static void Init(); //inline是为了提高性能，相当于直接把函数里的代码段放在那里 //返回的是Logger，分为服务器logger和核心logger inline static std::shared_ptr&lt;spdlog::logger&gt; GetCoreLogger() { return s_CoreLogger; } inline static std::shared_ptr&lt;spdlog::logger&gt; GetClientLogger() { return s_ClientLogger; } private: static std::shared_ptr&lt;spdlog::logger&gt; s_CoreLogger; static std::shared_ptr&lt;spdlog::logger&gt; s_ClientLogger; }; } //Core 的log 的简化 #define YT_CORE_ERROR(...)	::YOTO::Log::GetCoreLogger()-&gt;error(__VA_ARGS__) #define YT_CORE_WARN(...)	::YOTO::Log::GetCoreLogger()-&gt;warn(__VA_ARGS__) #define YT_CORE_INFO(." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/47f6b2834e71ecef6e0317d149e7b987/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-31T17:31:03+08:00" />
<meta property="article:modified_time" content="2023-12-31T17:31:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">跟着cherno手搓游戏引擎【2】：日志系统spdlog和premake的使用</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>配置：</h2> 
<p>日志库文件github：</p> 
<p><a href="https://github.com/gabime/spdlog" title="GitHub - gabime/spdlog: Fast C++ logging library.">GitHub - gabime/spdlog: Fast C++ logging library.</a></p> 
<p>新建vendor文件夹</p> 
<p>将下载好的spdlog放入</p> 
<p><img alt="" height="375" src="https://images2.imgbox.com/1b/9e/BUZPpngR_o.png" width="612"></p> 
<p>配置YOTOEngine的附加包含目录：</p> 
<p><img alt="" height="683" src="https://images2.imgbox.com/a0/4f/nOv0iC75_o.png" width="1200"></p> 
<p>配置Sandbox的附加包含目录：</p> 
<p><img alt="" height="517" src="https://images2.imgbox.com/5a/a1/1d4yoSkh_o.png" width="1200"></p> 
<h2>包装spdlog：</h2> 
<p>在YOTO文件夹下创建Log.cpp和log.h</p> 
<p><strong>log.h：</strong></p> 
<pre><code class="language-cpp">#pragma once
#include"Core.h"
#include&lt;spdlog/spdlog.h&gt;
#include "spdlog/sinks/stdout_color_sinks.h" 
namespace YOTO {
	class YOTO_API Log
	{
	public:
		static void Init();
		//inline是为了提高性能，相当于直接把函数里的代码段放在那里
		//返回的是Logger，分为服务器logger和核心logger
		inline static  std::shared_ptr&lt;spdlog::logger&gt;  GetCoreLogger() { return s_CoreLogger; }
		inline static  std::shared_ptr&lt;spdlog::logger&gt;  GetClientLogger() { return s_ClientLogger; }
	private:
		static std::shared_ptr&lt;spdlog::logger&gt; s_CoreLogger;
		static std::shared_ptr&lt;spdlog::logger&gt;  s_ClientLogger;
	};
}
//Core 的log 的简化
#define YT_CORE_ERROR(...)		::YOTO::Log::GetCoreLogger()-&gt;error(__VA_ARGS__)
#define YT_CORE_WARN(...)		::YOTO::Log::GetCoreLogger()-&gt;warn(__VA_ARGS__)
#define YT_CORE_INFO(...)		::YOTO::Log::GetCoreLogger()-&gt;info(__VA_ARGS__)
#define YT_CORE_TRACE(...)		::YOTO::Log::GetCoreLogger()-&gt;trace(__VA_ARGS__)
#define YT_CORE_FATAL(...)		::YOTO::Log::GetCoreLogger()-&gt;fatal(__VA_ARGS__)
//client 的log的简化
#define YT_CLIENT_ERROR(...)	::YOTO::Log::GetClientLogger()-&gt;error(__VA_ARGS__)
#define YT_CLIENT_WARN(...)		::YOTO::Log::GetClientLogger()-&gt;warn(__VA_ARGS__)
#define YT_CLIENT_INFO(...)		::YOTO::Log::GetClientLogger()-&gt;info(__VA_ARGS__)
#define YT_CLIENT_TRACE(...)	::YOTO::Log::GetClientLogger()-&gt;trace(__VA_ARGS__)
#define YT_CLIENT_FATAL(...)	::YOTO::Log::GetClientLogger()-&gt;fatal(__VA_ARGS__)

</code></pre> 
<p><strong> log.cpp：</strong></p> 
<pre><code class="language-cpp">#include "Log.h"

namespace YOTO {
	std::shared_ptr&lt;spdlog::logger&gt; Log::s_CoreLogger;
	std::shared_ptr&lt;spdlog::logger&gt;  Log::s_ClientLogger;
	void  Log::Init() {
		//设置日志格式
		spdlog::set_pattern("%^[%T] %n: %v%$");
		//创建多线程logger，核心logger为YOTO
		s_CoreLogger = spdlog::stdout_color_mt("YOTO");
		//设置打印消息的级别，trace是打印所有东西（筛选器）
		s_CoreLogger-&gt;set_level(spdlog::level::level_enum::trace);
		//客户端的为APP
		s_ClientLogger= spdlog::stdout_color_mt("APP");
		s_ClientLogger-&gt;set_level(spdlog::level::level_enum::trace);
	}
}
</code></pre> 
<h2 style="background-color:transparent;"> 测试：</h2> 
<p>在YOTO.h中加入#include "YOTO/Log.h"，记得重新生成，把dll加入到Sandbox（后续会使用premake简化该流程，这里暂时手动生成）</p> 
<p></p> 
<p>我们在入口点修改代码测试：</p> 
<pre><code class="language-cpp">#pragma once

#ifdef YT_PLATFORM_WINDOWS
#include "../YOTO.h"

extern YOTO::Application* YOTO::CreateApplication();
void main(int argc,char** argv) {
	YOTO::Log::Init();
	YT_CORE_ERROR("测试警告信息");
	int test = 1;
	YT_CLIENT_INFO("测试info:test={0}",test);
	auto app = YOTO::CreateApplication();
	app-&gt;Run();
	delete app;
}
#endif</code></pre> 
<p>输出：</p> 
<p></p> 
<h2>Premake配置安装：</h2> 
<p>点击下载：<a href="https://github.com/premake/premake-core/releases/download/v5.0.0-beta2/premake-5.0.0-beta2-windows.zip" title="https://github.com/premake/premake-core/releases/download/v5.0.0-beta2/premake-5.0.0-beta2-windows.zip">https://github.com/premake/premake-core/releases/download/v5.0.0-beta2/premake-5.0.0-beta2-windows.zip</a></p> 
<p>创建vendor文件夹：文件结构如下</p> 
<p><img alt="" height="441" src="https://images2.imgbox.com/f0/8d/IkLrBKxW_o.png" width="974"></p> 
<p><img alt="" height="205" src="https://images2.imgbox.com/f6/79/nNJBgZiW_o.png" width="627"></p> 
<p>放入声明文件LICENSE.txt:</p> 
<pre><code class="language-cpp">Copyright (c) 2003-2016 Jason Perkins and individual contributors.
All rights reserved.

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

  1. Redistributions of source code must retain the above copyright notice,
     this list of conditions and the following disclaimer.

  2. Redistributions in binary form must reproduce the above copyright notice,
     this list of conditions and the following disclaimer in the documentation
     and/or other materials provided with the distribution.

  3. Neither the name of Premake nor the names of its contributors may be
     used to endorse or promote products derived from this software without
     specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE
FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER
CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,
OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</code></pre> 
<p>编写premake5.lua文件：</p> 
<pre><code class="language-Lua">workspace "YOTOEngine"		-- sln文件名
	architecture "x64"	
	configurations{
		"Debug",
		"Release",
		"Dist"
	}

-- 组成输出目录:Debug-windows-x86_64
outputdir = "%{cfg.buildcfg}-%{cfg.system}-%{cfg.architecture}"

project "YOTOEngine"		
	location "YOTOEngine"--在sln所属文件夹下的Hazel文件夹
	kind "SharedLib"--dll动态库
	language "C++"
	targetdir ("bin/" .. outputdir .. "/%{prj.name}") -- 输出目录
	objdir ("bin-int/" .. outputdir .. "/%{prj.name}")-- 中间目录

	-- 包含的所有h和cpp文件
	files{
		"%{prj.name}/src/**.h",
		"%{prj.name}/src/**.cpp"
	}
	-- 包含目录
	includedirs{
		"%{prj.name}/vendor/spdlog-1.x/include"
	}
	-- 如果是window系统
	filter "system:windows"
		cppdialect "C++17"
		-- On:代码生成的运行库选项是MTD,静态链接MSVCRT.lib库;
		-- Off:代码生成的运行库选项是MDD,动态链接MSVCRT.dll库;打包后的exe放到另一台电脑上若无这个dll会报错
		staticruntime "On"	
		systemversion "latest"	-- windowSDK版本
		-- 预处理器定义
		defines{
			"YT_PLATFORM_WINDOWS",
			"YT_BUILD_DLL"
		}
		-- 编译好后移动Hazel.dll文件到Sandbox文件夹下
		postbuildcommands{
			("{COPY} %{cfg.buildtarget.relpath} ../bin/" .. outputdir .. "/Sandbox")
		}
	-- 不同配置下的预定义不同
	filter "configurations:Debug"
		defines "YT_DEBUG"
		symbols "On"

	filter "configurations:Release"
		defines "YT_RELEASE"
		optimize "On"

	filter "configurations:Dist"
		defines "YT_DIST"
		optimize "On"

project "Sandbox"
	location "Sandbox"
	kind "ConsoleApp"
	language "C++"

	targetdir ("bin/" .. outputdir .. "/%{prj.name}")
	objdir ("bin-int/" .. outputdir .. "/%{prj.name}")

	files{
		"%{prj.name}/src/**.h",
		"%{prj.name}/src/**.cpp"
	}
	-- 同样包含spdlog头文件
	includedirs{
		"YOTOEngine/vendor/spdlog-1.x/include",
		"YOTOEngine/src"
	}
	-- 引用YOTOEngine
	links{
		"YOTOEngine"
	}

	filter "system:windows"
		cppdialect "C++17"
		staticruntime "On"
		systemversion "latest"

		defines{
			"YT_PLATFORM_WINDOWS"
		}

	filter "configurations:Debug"
		defines "YT_DEBUG"
		symbols "On"

	filter "configurations:Release"
		defines "YT_RELEASE"
		optimize "On"

	filter "configurations:Dist"
		defines "YT_DIST"
		optimize "On"
</code></pre> 
<p>创建Generate.bat文件，每次将bin和bin-int删除然后点这个文件就可以自动生成。</p> 
<pre><code class="language-Lua">call vendor\bin\premake\premake5.exe vs2019
PAUSE</code></pre> 
<p> 遇到问题不要慌：</p> 
<p><img alt="" height="73" src="https://images2.imgbox.com/72/95/bn4nNfwr_o.png" width="1200"></p> 
<p>这个问题是还没创建完就启动了，只需要等一会儿就好了。</p> 
<p>等待10秒钟之后：启动！</p> 
<p><img alt="" height="549" src="https://images2.imgbox.com/68/69/E2g9UCRL_o.png" width="990"></p> 
<p>今天就看到这里，下一集：事件系统【持续更新中】</p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9e2f32a908990e83884a8e0912eeddd3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">139. Word Break</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0fb231a84142a1b9baf4808edb681c23/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue2与vue3数组的区别</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>