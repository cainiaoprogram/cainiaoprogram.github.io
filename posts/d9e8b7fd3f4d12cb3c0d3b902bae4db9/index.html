<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>GO项目自动化-根据库表字段自动生成API - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="GO项目自动化-根据库表字段自动生成API" />
<meta property="og:description" content="根据库表字段自动生成API 一个项目开发离不开数据库的增删改查，API功能也基本围绕着表的CRUD：增加(Create)、读取(Read)、更新(Update)和删除(Delete)。每个表写一个CRUD，方法都差不多，逻辑也非常相似。
那么有没有可能根据表结构直接自动化生成各个表的CRUD呢？
当然可以，前几篇文章已经介绍了golang的API项目搭建和数据库操作，那么本篇直接一个飞跃成长，项目自动化生成。
生成代码尽量简洁，方便根据项目实际需求二次开发。
API规则 首先建立好规则，方便生成逻辑统一的CRUD：
1.数据库表结构规则 id为int类型自增数值都有创建、更新时间，字段名固定为created_at,updated_at，且为int64类型，存值为时间戳都有状态字段，字段名固定为status，int类型，初始值为0，删除为-1 2.CRUD规则 Create时，除了id、status,created_at,updated_at，其他字段都作为入参，入库时初始status为0，创建、更新时间为当前时间戳Read时，带分页功能，分页参数统一为：limit（每页条数）、offset（第几页，从1开始），响应所有表字段原始数据Update时，必传id参数，除status,created_at,updated_at外的其他字段都可更改，更新时间自动设置为当前时间戳Delete时，必传id参数，status设置为-1，更新时间自动设置为当前时间戳 cli使用 下载cli源码
https://github.com/liyonge-cm/go-api-cli 编译可执行文件
go build 按规则创建库表
修改配置文件
修改config/config.yml的配置信息
mysql: mysql连接配置 frame: out_path: 项目文件所在位置 prj_name: 项目名称 json_case: api入参处参的json格式：camel-驼峰，默认下划线 api: tables: - user 指定生成API的表 创建项目
执行编辑文件创建项目 go-cli -g frame 或直接运行main文件
go run main.go -g frame 生成API
执行编辑文件生成API go-cli -g api 或直接运行main文件
go run main.go -g api 启动生成的新项目 进入项目文件: cd xxx/prj-aiee-api(配置文件中的项目地址)下载依赖包: go mod tidy修改配置config，数据库连接地址等启动: go run main.go
就可以调用API就行增删改查了 api 风格 API method统一为post，body以json入参。如 curl -X POST &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/d9e8b7fd3f4d12cb3c0d3b902bae4db9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-11T14:10:13+08:00" />
<meta property="article:modified_time" content="2024-01-11T14:10:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">GO项目自动化-根据库表字段自动生成API</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="API_0"></a>根据库表字段自动生成API</h2> 
<p>一个项目开发离不开数据库的增删改查，API功能也基本围绕着表的CRUD：增加(Create)、读取(Read)、更新(Update)和删除(Delete)。每个表写一个CRUD，方法都差不多，逻辑也非常相似。<br> 那么有没有可能根据表结构直接自动化生成各个表的CRUD呢？<br> 当然可以，前几篇文章已经介绍了golang的API项目搭建和数据库操作，那么本篇直接一个飞跃成长，项目自动化生成。<br> 生成代码尽量简洁，方便根据项目实际需求二次开发。</p> 
<h3><a id="API_7"></a>API规则</h3> 
<p>首先建立好规则，方便生成逻辑统一的CRUD：</p> 
<h4><a id="1_9"></a>1.数据库表结构规则</h4> 
<ol><li>id为int类型自增数值</li><li>都有创建、更新时间，字段名固定为created_at,updated_at，且为int64类型，存值为时间戳</li><li>都有状态字段，字段名固定为status，int类型，初始值为0，删除为-1</li></ol> 
<h4><a id="2CRUD_13"></a>2.CRUD规则</h4> 
<ol><li>Create时，除了id、status,created_at,updated_at，其他字段都作为入参，入库时初始status为0，创建、更新时间为当前时间戳</li><li>Read时，带分页功能，分页参数统一为：limit（每页条数）、offset（第几页，从1开始），响应所有表字段原始数据</li><li>Update时，必传id参数，除status,created_at,updated_at外的其他字段都可更改，更新时间自动设置为当前时间戳</li><li>Delete时，必传id参数，status设置为-1，更新时间自动设置为当前时间戳</li></ol> 
<h3><a id="cli_19"></a>cli使用</h3> 
<ol><li>下载cli源码<br> https://github.com/liyonge-cm/go-api-cli</li></ol> 
<p>编译可执行文件</p> 
<pre><code class="prism language-shell">go build
</code></pre> 
<ol start="2"><li> <p>按规则创建库表</p> </li><li> <p>修改配置文件<br> 修改config/config.yml的配置信息</p> </li></ol> 
<pre><code class="prism language-yml"><span class="token key atrule">mysql</span><span class="token punctuation">:</span> mysql连接配置

<span class="token key atrule">frame</span><span class="token punctuation">:</span>
  <span class="token key atrule">out_path</span><span class="token punctuation">:</span> 项目文件所在位置
  <span class="token key atrule">prj_name</span><span class="token punctuation">:</span> 项目名称
  <span class="token key atrule">json_case</span><span class="token punctuation">:</span> api入参处参的json格式：camel<span class="token punctuation">-</span>驼峰，默认下划线

<span class="token key atrule">api</span><span class="token punctuation">:</span>
  <span class="token key atrule">tables</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> user 指定生成API的表
</code></pre> 
<ol start="3"><li>创建项目<br> 执行编辑文件创建项目</li></ol> 
<pre><code class="prism language-shell">go-cli <span class="token parameter variable">-g</span> frame
</code></pre> 
<p>或直接运行main文件</p> 
<pre><code class="prism language-shell">go run main.go <span class="token parameter variable">-g</span> frame
</code></pre> 
<ol start="4"><li>生成API<br> 执行编辑文件生成API</li></ol> 
<pre><code class="prism language-shell">go-cli <span class="token parameter variable">-g</span> api
</code></pre> 
<p>或直接运行main文件</p> 
<pre><code class="prism language-shell">go run main.go <span class="token parameter variable">-g</span> api
</code></pre> 
<h3><a id="_64"></a>启动生成的新项目</h3> 
<ol><li>进入项目文件: cd xxx/prj-aiee-api(配置文件中的项目地址)</li><li>下载依赖包: go mod tidy</li><li>修改配置config，数据库连接地址等</li><li>启动: go run main.go<br> 就可以调用API就行增删改查了</li></ol> 
<h4><a id="api__72"></a>api 风格</h4> 
<ol><li>API method统一为post，body以json入参。如</li></ol> 
<pre><code class="prism language-shell"><span class="token function">curl</span> <span class="token parameter variable">-X</span> POST <span class="token string">"http://localhost:8080/user/getList"</span> <span class="token parameter variable">-H</span>  <span class="token string">"accept: application/json"</span> <span class="token parameter variable">-d</span> <span class="token string">"{<!-- --><span class="token entity" title='\"'>\"</span>limit<span class="token entity" title='\"'>\"</span>: 10,<span class="token entity" title='\"'>\"</span>offset<span class="token entity" title='\"'>\"</span>: 1}"</span> 
</code></pre> 
<ol start="2"><li>API路由以表名作为group，crud分别为create,get,getList,update,delete。<br> 如有一个表名为user，生成API请求地址分别为：</li></ol> 
<ul><li>http://localhost:8080/user/create</li><li>http://localhost:8080/user/get</li><li>http://localhost:8080/user/getList</li><li>http://localhost:8080/user/update</li><li>http://localhost:8080/user/delete</li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/569ca850465e95e2f7f6c9eef8e6c35d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何在 Microsoft Edge 浏览器中启用自动刷新</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7455e8c28a5e21fa8b1a75dfeaa1c6fb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于ssm的班级事务管理系统&#43;vue</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>