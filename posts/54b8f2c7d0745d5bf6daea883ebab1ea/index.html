<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android ZXing二维码包含中文时乱码解决 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android ZXing二维码包含中文时乱码解决" />
<meta property="og:description" content="Android ZXing二维码包含中文时乱码解决 文章目录 Android ZXing二维码包含中文时乱码解决一、前言二、ZXing 把中文字符串生成二维码扫描后显示问号解决1、Zxing 的简单使用2、源码上的编译的项目二维码乱码修改 二、其他1、查看字符串编码：2、字符串设置编码：3、是否utf-8字符串4、网上其他的处理方式 一、前言 ZXing就不过多介绍了，就是可以可以扫描二维码获取里面字符串和把字符串生成二维码的小框架。
本文记录一下源码编译中，ZXing 在源码编译后，包含中文字符串的二维码出现问号乱码解决。
Android Studio中运行该app是没有这个问题的，那么有可能就是编译环境不同导致的。
二、ZXing 把中文字符串生成二维码扫描后显示问号解决 1、Zxing 的简单使用 ImageView imageView; //要显示二维码的控件 String string = &#34;XXX&#34;; // 二维码的字符串 //Zxing 工具类 MultiFormatWriter formatWriter = new MultiFormatWriter() BitMatrix matrix = formatWriter.encode(string, BarcodeFormat.QR_CODE, viewWidth, viewHeight); Bitmap bitmap = bitMatrix2Bitmap(string, matrix); imageView.setImageBitmap(bitmap); //设置二维码图片显示 //像素点确认的方法 public static Bitmap bitMatrix2Bitmap(BitMatrix matrix) { int w = matrix.getWidth(); int h = matrix.getHeight(); int[] rawData = new int[w * h]; for (int i = 0; i &lt; w; i&#43;&#43;) { for (int j = 0; j &lt; h; j&#43;&#43;) { int color = Color." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/54b8f2c7d0745d5bf6daea883ebab1ea/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-02T20:51:09+08:00" />
<meta property="article:modified_time" content="2024-01-02T20:51:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android ZXing二维码包含中文时乱码解决</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Android_ZXing_0"></a>Android ZXing二维码包含中文时乱码解决</h2> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#Android_ZXing_0" rel="nofollow">Android ZXing二维码包含中文时乱码解决</a></li><li><ul><li><a href="#_5" rel="nofollow">一、前言</a></li><li><a href="#ZXing__17" rel="nofollow">二、ZXing 把中文字符串生成二维码扫描后显示问号解决</a></li><li><ul><li><a href="#1Zxing__21" rel="nofollow">1、Zxing 的简单使用</a></li><li><a href="#2_59" rel="nofollow">2、源码上的编译的项目二维码乱码修改</a></li></ul> 
   </li><li><a href="#_95" rel="nofollow">二、其他</a></li><li><ul><li><a href="#1_97" rel="nofollow">1、查看字符串编码：</a></li><li><a href="#2_110" rel="nofollow">2、字符串设置编码：</a></li><li><a href="#3utf8_131" rel="nofollow">3、是否utf-8字符串</a></li><li><a href="#4_172" rel="nofollow">4、网上其他的处理方式</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_5"></a>一、前言</h3> 
<p>ZXing就不过多介绍了，就是可以可以扫描二维码获取里面字符串和把字符串生成二维码的小框架。</p> 
<p>本文记录一下源码编译中，ZXing 在源码编译后，包含中文字符串的二维码出现问号乱码解决。</p> 
<p>Android Studio中运行该app是没有这个问题的，那么有可能就是编译环境不同导致的。</p> 
<h3><a id="ZXing__17"></a>二、ZXing 把中文字符串生成二维码扫描后显示问号解决</h3> 
<h4><a id="1Zxing__21"></a>1、Zxing 的简单使用</h4> 
<pre><code> ImageView imageView; //要显示二维码的控件
 String string = "XXX"; // 二维码的字符串

//Zxing 工具类
MultiFormatWriter formatWriter = new MultiFormatWriter()
BitMatrix matrix = formatWriter.encode(string, BarcodeFormat.QR_CODE, viewWidth, viewHeight);

Bitmap bitmap = bitMatrix2Bitmap(string, matrix);
imageView.setImageBitmap(bitmap); //设置二维码图片显示

//像素点确认的方法
public static Bitmap bitMatrix2Bitmap(BitMatrix matrix) {
    int w = matrix.getWidth();
    int h = matrix.getHeight();
    int[] rawData = new int[w * h];
    for (int i = 0; i &lt; w; i++) {
        for (int j = 0; j &lt; h; j++) {
            int color = Color.WHITE;
            if (matrix.get(i, j)) {
                color = Color.BLACK;
            }
            rawData[i + (j * w)] = color;
        }
    }

    Bitmap bitmap = Bitmap.createBitmap(w, h, Config.RGB_565);
    bitmap.setPixels(rawData, 0, w, 0, 0, w, h);
    return bitmap;
}
</code></pre> 
<h4><a id="2_59"></a>2、源码上的编译的项目二维码乱码修改</h4> 
<p>网上很多说把上面的string 字符串设置一下UTF-8 编码格式就行了，但是我在源码中编译的项目还是不行。</p> 
<p>其实有很多的解决办法的，可以在生成二维码的时候，对它进行修改，或者生成二维码之后，对其修改。</p> 
<p>今天我就只是在生成二维码的时候对其进行修改。</p> 
<pre><code> ImageView imageView; //要显示二维码的控件
 String string = "XXX"; // 二维码的字符串

//规避中文字符串，二维码乱码问题
Hashtable&lt;EncodeHintType, String&gt; hints = new Hashtable&lt;EncodeHintType, String&gt;();
hints.put(EncodeHintType.CHARACTER_SET, "UTF-8");

BitMatrix bitMatrix = new MultiFormatWriter().encode(string, BarcodeFormat.QR_CODE, 800, 800, hints);

Bitmap bitmap = bitMatrix2Bitmap(string, matrix);
imageView.setImageBitmap(bitmap); //设置二维码图片显示
</code></pre> 
<p>其实就是 MultiFormatWriter.encode 的两个不同方法，基本使用的代码未设置编码格式，</p> 
<p>后面的是在二维码生成过程设置了"UTF-8"格式。</p> 
<h3><a id="_95"></a>二、其他</h3> 
<h4><a id="1_97"></a>1、查看字符串编码：</h4> 
<pre><code>String string = "XXX";
InputStream inputStream = new ByteArrayInputStream(string.getBytes());
//编码格式：UTF-8,GBK,ISO-8859-1, ...
String encodingTypeString = new InputStreamReader(inputStream).getEncoding();
</code></pre> 
<h4><a id="2_110"></a>2、字符串设置编码：</h4> 
<pre><code>//api：
String string = "XXX";
String encodeString = new String(string.getBytes("oldType"), "newType");

//示例：
try {
    String encodeString = new String(string.getBytes("UTF-8"), "UTF-8");
} catch (UnsupportedEncodingException e) {
    e.printStackTrace();
}
</code></pre> 
<h4><a id="3utf8_131"></a>3、是否utf-8字符串</h4> 
<pre><code>    public static boolean isUtf8(byte[] buffer) {
        boolean isUtf8 = true;
        int end = buffer.length;
        for (int i = 0; i &lt; end; i++) {
            byte temp = buffer[i];
            if ((temp &amp; 0x80) == 0) {// 0xxxxxxx
                continue;
            } else if ((temp &amp; 0xC0) == 0xC0 &amp;&amp; (temp &amp; 0x20) == 0) {// 110xxxxx 10xxxxxx
                if (i + 1 &lt; end &amp;&amp; (buffer[i + 1] &amp; 0x80) == 0x80 &amp;&amp; (buffer[i + 1] &amp; 0x40) == 0) {
                    i = i + 1;
                    continue;
                }
            } else if ((temp &amp; 0xE0) == 0xE0 &amp;&amp; (temp &amp; 0x10) == 0) {// 1110xxxx 10xxxxxx 10xxxxxx
                if (i + 2 &lt; end &amp;&amp; (buffer[i + 1] &amp; 0x80) == 0x80 &amp;&amp; (buffer[i + 1] &amp; 0x40) == 0
                        &amp;&amp; (buffer[i + 2] &amp; 0x80) == 0x80 &amp;&amp; (buffer[i + 2] &amp; 0x40) == 0) {
                    i = i + 2;
                    continue;
                }
            } else if ((temp &amp; 0xF0) == 0xF0 &amp;&amp; (temp &amp; 0x08) == 0) {// 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx
                if (i + 3 &lt; end &amp;&amp; (buffer[i + 1] &amp; 0x80) == 0x80 &amp;&amp; (buffer[i + 1] &amp; 0x40) == 0
                        &amp;&amp; (buffer[i + 2] &amp; 0x80) == 0x80 &amp;&amp; (buffer[i + 2] &amp; 0x40) == 0
                        &amp;&amp; (buffer[i + 3] &amp; 0x80) == 0x80 &amp;&amp; (buffer[i + 3] &amp; 0x40) == 0) {
                    i = i + 3;
                    continue;
                }
            }
            isUtf8 = false;
            break;
        }
        return isUtf8;
    }

</code></pre> 
<h4><a id="4_172"></a>4、网上其他的处理方式</h4> 
<p>Android Zxing 扫码中文乱码解决：</p> 
<p>判断是否utf-8,设置一次字符串是<strong>GBK</strong>或者<strong>UTF-8</strong></p> 
<p><a href="https://blog.csdn.net/qq_25148525/article/details/124472345">https://blog.csdn.net/qq_25148525/article/details/124472345</a></p> 
<p>Android ZXing生成中文二维码，扫描后出现问号、乱码问题解决:</p> 
<p><a href="https://blog.csdn.net/PenTablet/article/details/80325741">https://blog.csdn.net/PenTablet/article/details/80325741</a></p> 
<p>本文的处理也是参考这个文章的。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/580fedb552642b7f8c7ee353140de6e0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">虚幻UE 材质-边界混合之PDO像素深度偏移量</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dde078b72cbc9608b2e9f640339bf377/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">neovim调试xv6-riscv过程中索引不到对应头文件问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>