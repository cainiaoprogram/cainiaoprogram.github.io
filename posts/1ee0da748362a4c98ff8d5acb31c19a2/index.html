<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>后台开发之--行政区划功能 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="后台开发之--行政区划功能" />
<meta property="og:description" content="1、数据库模型设计，使用powerDesigner将数据库结构生成pdm文件，便可以直接使用其SQL语句生成数据库；
2、新建maven工程， 根据引入的catalog，会将java api 代码和web页面分成两个模块, 两个模块各自有resource目录，其中
web模块中有config目录，用来配置数据库以及spring框架等信息：
数据库配置：
jdbc.driver=com.mysql.jdbc.jdbc2.optional.MysqlXADataSource
jdbc.url=jdbc:mysql://XXXXXX?useUnicode=true&amp;characterEncoding=utf-8
jdbc.username=XXX
jdbc.password=XXX
jdbc.reconnect=true
在数据库的使用方面，如果不使用框架配置的话，也是可以自己用java代码连接的：
private static Connection getConn() {
Connection conn = null;
try {
Class.forName(&#34;com.mysql.jdbc.Driver&#34;); //classLoader,加载对应驱动 } catch (ClassNotFoundException e) {
e.printStackTrace();
}
String url = &#34;jdbc:mysql://localhost:3306/test&#34;;
String username = &#34;root&#34;;//数据库账户，一般为root
String password = &#34;****&#34;;//数据库密码
try{
conn = DriverManager.getConnection(url, username, password);
} catch (SQLException e) {
e.printStackTrace();
}
return conn;
}
其他关于框架的配置信息在spring-mvc.xml 中， web模块负责后面放在tomcat容器中运行。
此处注意如果在运行后访问之后要有页面显示的话，记得在webapp 下的 WEB-INF 目录下添加index.html，访问路径记得使用IP&#43;端口，然后就是项目路径：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/1ee0da748362a4c98ff8d5acb31c19a2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-12-13T19:03:50+08:00" />
<meta property="article:modified_time" content="2018-12-13T19:03:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">后台开发之--行政区划功能</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>1、数据库模型设计，使用powerDesigner将数据库结构生成pdm文件，便可以直接使用其SQL语句生成数据库；</p> 
<p>2、新建maven工程， 根据引入的catalog，会将java api 代码和web页面分成两个模块, 两个模块各自有resource目录，其中</p> 
<p>web模块中有config目录，用来配置数据库以及spring框架等信息：</p> 
<p><img alt="" class="has" height="353" src="https://images2.imgbox.com/20/a1/xtTV1AdD_o.png" width="384"></p> 
<p>数据库配置：</p> 
<p>jdbc.driver=com.mysql.jdbc.jdbc2.optional.MysqlXADataSource<br> jdbc.url=jdbc:mysql://XXXXXX?useUnicode=true&amp;characterEncoding=utf-8<br> jdbc.username=XXX<br> jdbc.password=XXX<br> jdbc.reconnect=true</p> 
<p>在数据库的使用方面，如果不使用框架配置的话，也是可以自己用java代码连接的：</p> 
<p>private static Connection getConn() {<!-- --><br>         Connection conn = null;<br>         try {<!-- --><br>                Class.forName("com.mysql.jdbc.Driver"); //classLoader,加载对应驱动      <br>            } catch (ClassNotFoundException e) {<!-- --><br>                e.printStackTrace();<br>            }<br>            String url = "jdbc:mysql://localhost:3306/test";<br>            String username = "root";//数据库账户，一般为root<br>            String password = "****";//数据库密码<br>            <br>            try{<!-- --><br>                conn = DriverManager.getConnection(url, username, password);<br>            } catch (SQLException e) {<!-- --><br>            e.printStackTrace();<br>            }<br>            return conn;<br>         }</p> 
<p>其他关于框架的配置信息在spring-mvc.xml 中， web模块负责后面放在tomcat容器中运行。</p> 
<p>此处注意如果在运行后访问之后要有页面显示的话，记得在webapp 下的 WEB-INF 目录下添加index.html，访问路径记得使用IP+端口，然后就是项目路径：</p> 
<p><img alt="" class="has" height="433" src="https://images2.imgbox.com/08/fc/FpRCyPlq_o.png" width="1200"></p> 
<p> </p> 
<p>而java API 模块中则负责后台业务逻辑，传统的分成处理： Controller 、service、Dao、Entity，以及数据库执行语句放在mapper中：</p> 
<p><img alt="" class="has" height="369" src="https://images2.imgbox.com/ac/3f/ALUE04UJ_o.png" width="506"></p> 
<p> </p> 
<p>当然还有测试代码，有自己的包和位置，注意，测试模块有自己的数据库以及其他资源配置文件，在测试时需要同步修改：</p> 
<p><img alt="" class="has" height="379" src="https://images2.imgbox.com/ac/9a/t6mZe34o_o.png" width="487"></p> 
<p> </p> 
<p>3、为了使自己的后台接口能够很好地给前端阅读和使用，需要引入swagger工具来展示：</p> 
<p>具体就是在pom.xml文件中引入jar包：</p> 
<p>        &lt;dependency&gt;<br>             &lt;groupId&gt;io.springfox&lt;/groupId&gt;<br>             &lt;artifactId&gt;springfox-swagger2&lt;/artifactId&gt;<br>             &lt;version&gt;2.4.0&lt;/version&gt;<br>         &lt;/dependency&gt;<br>         &lt;dependency&gt;<br>             &lt;groupId&gt;io.springfox&lt;/groupId&gt;<br>             &lt;artifactId&gt;springfox-swagger-ui&lt;/artifactId&gt;<br>             &lt;version&gt;2.4.0&lt;/version&gt;<br>         &lt;/dependency&gt;</p> 
<p> </p> 
<p>然后增加一个配置类来启动：</p> 
<p>@EnableSwagger2<br> @Configuration("areaSwaggerConfig")<br> public class SwaggerConfig {<!-- --></p> 
<p>}</p> 
<p> </p> 
<p>因为这个类的放置目录在基准目录下，已经在sping-mvc.xml中配置了扫描，所以不用单独加扫描注解：</p> 
<p><img alt="" class="has" height="159" src="https://images2.imgbox.com/d8/72/fs6hsrwO_o.png" width="1200"></p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>4 接口API实现</p> 
<p>配置表用来给用户添加配置使用，所以基本的增删改查接口全部需要。</p> 
<p>行政区划表由于是查询信息，对外只需要提供查询接口即可。</p> 
<p>这其中主要是对注解的学习使用，刚开始不太了解，都是依葫芦画瓢，边用边学：</p> 
<p>@RestController  这个注解在业务控制层中比controller注解要多一层东西，如果不用这个会报错；</p> 
<p>@RequestMapping 用来指定访问路径的，暂时这么理解；</p> 
<p>method = {RequestMethod.POST, RequestMethod.GET} 注意这种配置必须加好，后面对接前端会知道使用哪种方式操作。</p> 
<p>@Autowired 自动装载，这个感觉还比较熟悉；</p> 
<p>@ApiOperation 这个感觉就是一个说明作用，在swagger中可以描述接口作用；</p> 
<p>@ModelAttribute  这个很重要，在swagger中如果要传对象参数，有了它才能真正传进来；</p> 
<p> </p> 
<p>@CommonDao  这个是DAO层的注解，表明数据库的操作在哪个库，是通用库还是业务站点库；</p> 
<p>@Service  这个是服务实现类中加的，没有它会报找不到对应的服务，应该就是在实例化对象的时候靠它了吧；</p> 
<p>@Test  测试代码运行用的，这个貌似要在继承了 AbstractControllerTest 这个类中才能用，而且在使用时还发现个问题就是</p> 
<p>像上面的那些@service  @autowired 注解不是随便在一个类中加上都可以用的，需要在这种测试类中才行，了解到的是需要在spring框架管理的类中才能使用；</p> 
<p> </p> 
<p>另外再说一下返回值处理WebResponse，这个可以设置参数，返回结果给前端，有统一定义。</p> 
<p> </p> 
<p>5、数据库SQL语句</p> 
<p>由于查询的要求为返回精确匹配和模糊匹配的结果集合，并且精确匹配排在前面。刚开始由于对于在mapper.xml中使用sql不熟悉，所以在java代码中来实现，即通过使用Criteria 来设置了两个不同类型的查询条件，分别返回两个结果集之后，在将其按照顺序加入到另外一个列表集合中，返回给前端：</p> 
<p>private void setCriteria(Criteria cri, Area area, String type){<!-- --><br>         if (null == cri || null == area || null == type) {<!-- --><br>             return ;<br>         }<br>         <br>         Integer id = area.getId();<br>         Integer parentId = area.getParentId();<br>         String code = area.getCode();<br>         String cityCode = area.getCityCode();<br>         String name = area.getName();<br>         String mergerName = area.getMergerName();<br>         String shortName = area.getShortName();<br>         String mergerShortName = area.getMergerShortName();<br>         String level = area.getLevel();<br>         String zipCode = area.getZipCode();<br>         String pinYin = area.getPinYin();<br>         String jianPin = area.getJianPin();<br>         String firstChar = area.getFirstChar();<br>         String lng = area.getLng();<br>         String lat = area.getLat();<br>         String remark = area.getRemark();<br>         <br>         // 通过area各个非空字段，模糊匹配后得到返回结果<br>         if (null != id) {<!-- --><br>             // 整型变量不用模糊查询<br>             cri.andIdEqualTo(id);<br>         }<br>         <br>         if (null != parentId) {<!-- --><br>             // 整型变量不用模糊查询<br>             cri.andParentIdEqualTo(parentId);<br>         }<br>         <br>         if ("like".equals(type)) {<!-- --><br>             if(StringUtils.isNotBlank(code)){<!-- --><br>                 cri.andCodeLike("%"+code+"%");<br>             }<br>             <br>             if(StringUtils.isNotBlank(cityCode)){<!-- --><br>                 cri.andCityCodeLike("%"+cityCode+"%");<br>             }<br>             <br>             if(StringUtils.isNotBlank(name)){<!-- --><br>                 cri.andNameLike("%"+name+"%");<br>             }<br>             <br>             if(StringUtils.isNotBlank(mergerName)){<!-- --><br>                 cri.andMergerNameLike("%"+mergerName+"%");<br>             }<br>             <br>             if(StringUtils.isNotBlank(shortName)){<!-- --><br>                 cri.andShortNameLike("%"+shortName+"%");<br>             }<br>             <br>             if(StringUtils.isNotBlank(mergerShortName)){<!-- --><br>                 cri.andMergerShortNameLike("%"+mergerShortName+"%");<br>             }<br>             <br>             if(StringUtils.isNotBlank(level)){<!-- --><br>                 cri.andLevelLike("%"+level+"%");<br>             }<br>             <br>             if(StringUtils.isNotBlank(zipCode)){<!-- --><br>                 cri.andZipCodeLike("%"+zipCode+"%");<br>             }<br>             <br>             if(StringUtils.isNotBlank(pinYin)){<!-- --><br>                 cri.andPinYinLike("%"+pinYin+"%");<br>             }<br>             <br>             if(StringUtils.isNotBlank(jianPin)){<!-- --><br>                 cri.andJianPinLike("%"+jianPin+"%");<br>             }<br>             <br>             if(StringUtils.isNotBlank(firstChar)){<!-- --><br>                 cri.andFirstCharLike("%"+firstChar+"%");<br>             }<br>             <br>             if(StringUtils.isNotBlank(lng)){<!-- --><br>                 cri.andLngLike("%"+lng+"%");<br>             }<br>             <br>             if(StringUtils.isNotBlank(lat)){<!-- --><br>                 cri.andLatLike("%"+lat+"%");<br>             }<br>             <br>             if(StringUtils.isNotBlank(remark)){<!-- --><br>                 cri.andRemarkLike("%"+remark+"%");<br>             }<br>         } else if ("equal".equals(type)) {<!-- --><br>             <br>             if(StringUtils.isNotBlank(code)){<!-- --><br>                 cri.andCodeEqualTo(code);<br>             }</p> 
<p>            if(StringUtils.isNotBlank(cityCode)){<!-- --><br>                 cri.andCityCodeEqualTo(cityCode);<br>             }</p> 
<p>            if(StringUtils.isNotBlank(name)){<!-- --><br>                 cri.andNameEqualTo(name);<br>             }</p> 
<p>            if(StringUtils.isNotBlank(mergerName)){<!-- --><br>                 cri.andMergerNameEqualTo(mergerName);<br>             }</p> 
<p>            if(StringUtils.isNotBlank(shortName)){<!-- --><br>                 cri.andShortNameEqualTo(shortName);<br>             }</p> 
<p>            if(StringUtils.isNotBlank(mergerShortName)){<!-- --><br>                 cri.andMergerShortNameEqualTo(mergerShortName);<br>             }</p> 
<p>            if(StringUtils.isNotBlank(level)){<!-- --><br>                 cri.andLevelEqualTo(level);<br>             }</p> 
<p>            if(StringUtils.isNotBlank(zipCode)){<!-- --><br>                 cri.andZipCodeEqualTo(zipCode);<br>             }</p> 
<p>            if(StringUtils.isNotBlank(pinYin)){<!-- --><br>                 cri.andPinYinEqualTo(pinYin);<br>             }</p> 
<p>            if(StringUtils.isNotBlank(jianPin)){<!-- --><br>                 cri.andJianPinEqualTo(jianPin);<br>             }</p> 
<p>            if(StringUtils.isNotBlank(firstChar)){<!-- --><br>                 cri.andFirstCharEqualTo(firstChar);<br>             }</p> 
<p>            if(StringUtils.isNotBlank(lng)){<!-- --><br>                 cri.andLngEqualTo(lng);<br>             }</p> 
<p>            if(StringUtils.isNotBlank(lat)){<!-- --><br>                 cri.andLatEqualTo(lat);<br>             }</p> 
<p>            if(StringUtils.isNotBlank(remark)){<!-- --><br>                 cri.andRemarkEqualTo(remark);<br>             }<br>         }</p> 
<p>        //return cri;<br>     }</p> 
<p>            // 将精确匹配和模糊匹配结果进行排序组装<br> //            result = new ArrayList&lt;&gt;();<br> //            //精确匹配<br> //            result.addAll(areas);<br> //            //模糊匹配<br> //            result.addAll(areaLike);<br> //            System.out.println("=====selectAreaByConfig result=" + (result == null ? null : result.toString()));<br>             <br> //            records = new PageList&lt;&gt;();<br> //            records.addAll(areas);<br> //            records.addAll(areaLike);<br> //            records = new PageList&lt;&gt;();<br> //            records.addAll(record1);</p> 
<p> </p> 
<p>这种功能是能够实现，但是后面遇到的问题就是分页不能兼容。那么接下来就说分页的事情吧，为啥要用分页呢，还不是因为数据量太大，一个子  慢 。。。。 因为从网上找到的我国新政区划五级联动信息有七十多万条记录，如果一次查询全部吐出来，那真是急死个人呢。</p> 
<p>使用的分页查询框架为：</p> 
<p><a href="https://github.com/miemiedev/mybatis-paginator">https://github.com/miemiedev/mybatis-paginator</a></p> 
<p>其主要原理看了下，应该就是先根据索引，查询出符合条件的总条数，然后根据传入的每页显示条数，来计算出页数，然后每次返回的结果就会根据传入参数来设置sql语句中的offset 和 limit 参数了。其实我也还是不懂，这种在查询总条数的时候应该也还是很耗时，但是事实胜于雄辩，可能是在返回结果集的时候限制了条数，能够起到很大的作用，来缩短时间。</p> 
<p>使用方法比较简单，就是在接口中增加PageParam pageParam 参数，</p> 
<p>在接口增加如下参数：</p> 
<p>        PageModel pgResult = new PageModel(pageParam);<br>         PageBounds pageBounds = new PageBounds(pageParam.getPageNo(), pageParam.getPageSize());</p> 
<p>        PageList&lt;Area&gt; records = null;</p> 
<p>            records = areaMapper.selectAreaByConfig(fields, areaExample, <br>                     areaExampleLike,  pageBounds);</p> 
<p>        // 返回对应的配置字段信息， 匹配查询条件<br>         if (records != null){<!-- --><br>             pgResult.setTotal(records.getPaginator().getTotalCount());<br>             pgResult.setRows(records);<br>         }<br>         return pgResult;</p> 
<p> </p> 
<p>由于这个分页框架是直接对SQL语句进行增加offset 和 limit 参数处理，因为不能使用前面那种在java代码中对结果集进行排序处理，所有的动作都需要在SQL语句中完成，包括查询、排序、去重等等。</p> 
<p>so, 我们来聊聊SQL语句，mybatis：</p> 
<p>最终的语句：</p> 
<p>&lt;select id="selectAreaByConfig" resultMap="BaseResultMap" parameterType="com.XXXXXX.area.entity.AreaExample" &gt;<br>     select DISTINCT ${fields} FROM (<br>     select ${fields}, 1 as orderField<br>     from hz_sys_area<br>     &lt;if test="_parameter != null" &gt;<br>       &lt;include refid="query_By_Example1_Where_Clause" /&gt;<br>     &lt;/if&gt;<br>     <br>     union<br>         <br>     select ${fields}, 2 as orderField<br>     from hz_sys_area<br>     &lt;if test="_parameter != null" &gt;<br>       &lt;include refid="query_By_Example2_Where_Clause" /&gt;<br>     &lt;/if&gt;<br>     <br>     ORDER BY orderField <br>     ) AS AREA_TABLE<br>   &lt;/select&gt;</p> 
<p> </p> 
<p>其实主要思路就是根据将精确和模糊匹配的两个条件分别查询，然后联合union, 最后根据各自新增定义的排序字段排序，然后再从这个结果集中选择最终结果，并且增加了distinct 字段来去重，当然这里面的ID 是不会有重复的，因为数据库信息是自己的控制插入的行政区划信息。</p> 
<p> </p> 
<p>当然这其中主要是学习mybatis框架中的对于数据库操作的用法，例如参数如何传递，_parameter 以及param1, param2 等等默认参数变量的用法，还有就是#  和 $ 的区别和用法等。</p> 
<p> </p> 
<p>5、前端界面vue</p> 
<p>关于前端界面的实现，主要是用别人搭好的框架，因为之前没有开发过前端，只是有个感性的认识。按照目前前端那边流行的用法，就是要用vue框架，这个东西运行环境需要装Node.js ，搞好之后通过npm install 命令安装一些依赖库（package.json），然后npm start 命令来启动前端。</p> 
<p>其中需要说明的就是有个路由配置，即启动什么项目，对应的项目的后端接口地址，需要进行配置：</p> 
<p><img alt="" class="has" height="833" src="https://images2.imgbox.com/30/c6/J3Wy3Fqb_o.png" width="1197"></p> 
<p> </p> 
<p>然后就是具体界面中对于各个菜单的配置：</p> 
<p><img alt="" class="has" height="709" src="https://images2.imgbox.com/d0/1c/BIoTSE5S_o.png" width="833"></p> 
<p> </p> 
<p>具体界面的实现在vue文件中，目前的理解为整体文件分三部分：</p> 
<p>模板template</p> 
<p>数据data</p> 
<p>方法method</p> 
<p>还有后端接口的调用，可以单独放置在一个api.js文件中，通过回调来传递数据参数。</p> 
<p>最后又依葫芦画瓢，吭哧吭哧将这个列表界面和增删改查界面做出来了：</p> 
<p><img alt="" class="has" height="632" src="https://images2.imgbox.com/b8/12/qHP25GZQ_o.png" width="1200"></p> 
<p> </p> 
<p>总体来说还是挺有意思的，新东西挺多，所以感觉学到了东西，对于一块白纸来说，一滴墨水已经够了。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f0b586ca27e59685c38ec379c557e675/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">input标签multiple属性用法简介</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0f0419ffe3e630527eb2911a7925f1ad/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">jupyter notebook import tensorflow as tf 报错解决</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>