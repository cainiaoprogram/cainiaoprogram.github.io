<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>利用XSS进行网页钓鱼 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="利用XSS进行网页钓鱼" />
<meta property="og:description" content="【XSS漏洞】利用XSS进行网页钓鱼 Hello 各位小伙伴周末晚上好
这里是你们微胖的小编Monster。
话说小编的老妈今天给小编打电话，叮嘱我平时吃饭少吃一点…
说昨天看我朋友圈发的照片，已经从以前的瓜子脸，变成国字脸了…
Whatever，让我们一起来看看今天的内容吧
一、实验概述
实验拓扑：
利用XSS漏洞，我们可以在网页中插入恶意js代码，通过js代码，我们可以干很多事情，例如伪造一个登陆页面。
当用户访问该网页时，就会自动弹出登陆页面，如果用户信以为真，输入了用户名与密码，密码就会传输到攻击者的服务器中，完成账号窃取。
二、编写登陆窗口代码
首先我们在攻击者服务器（192.168.211.1）编写一段弹窗代码，如下：
本段代码使用的是 PHP 的 HTTP 认证机制，说明如下。
首先，利用 header() 函数，我们可以向客户端浏览器发送 Authentication Required 信息，使其弹出一个用户名/密码输入窗口。
当用户输入用户名和密码后，包含有 URL 的 PHP 脚本将会和预定义变量 PHP_AUTH_USER、PHP_AUTH_PW 和 AUTH_TYPE 一起被调用，这三个变量分别被设定为用户名，密码和认证类型。
这三个预定义变量会被保存在 $_SERVER 数组中，我们再通过Get方法，将用户名、密码传递给record.php页面，等待下一步处理。
尝试访问一下这个页面，弹出登录框：
输入账号、密码123/123，通过GET方式发送给record.php：
这样，我们的登陆窗口页面就完成了，接下来编写记录页面。
三、用户信息记录 伪造的登陆界面，会把用户名、密码信息发送给record.php页面。
通过该页面，我们将用户名、密码保存到攻击者服务器本地，代码如下：
代码说明：
通过$_GET接收传过来的username和password的值
通过getenv方法，可以获取用户的ip地址和信息来源
通过date函数，记录下获取到信息的时间
通过fopen函数，通过a（追加）的方式，打开user.txt文件
通过fwrite的方式，将我们获取到的信息记录到user.txt文件中
最后，fclose函数关闭文件。
再访问一次登陆伪造页面，并输入用户名、密码123/123： 攻击者本地生成user.txt，成功记录账号、密码信息：
四、插入恶意js脚本 Web页面以DVWA平台 存储型XSS为例，我们来插入一个恶意JS代码。
代码构造如下：
通过插入iframe标签，让用户访问漏洞页面时，自动访问攻击者服务器上的钓鱼页面fish.php，出现登陆弹窗。
选择low安全等级，打开dvwa XSS(stored)页面 ：
在Name栏、Message栏均存在存储型XSS，在Message中输入上面的恶意代码，并提交，会发现有输入长度限制：
不过这里是前端长度限制，我们直接修改当前网页代码即可，将maxlength改大：
再次输入，可顺利输入，点击提交即可：
当前页面马上出现弹窗：
现在我们使用靶机来模拟一次攻击行为，使用用户主机访问low安全等级的dvwa XSS(stored)页面，因为impossible等级不存在XSS漏洞，
立刻出现弹窗：
使用用户名、密码，点击确认，页面恢复正常：
查看攻击者服务器user.txt文件：
同时，输入用户名、密码后，当前页面已存在PHP_AUTH_USER、PHP_AUTH_PW 变量，因此再次访问该页面，不会再出现弹窗，避免露馅：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b1a66ca256fe101e6c99dd193d5285f7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-07-22T08:30:24+08:00" />
<meta property="article:modified_time" content="2019-07-22T08:30:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">利用XSS进行网页钓鱼</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="XSSXSS_0"></a>【XSS漏洞】利用XSS进行网页钓鱼</h2> 
<p>Hello 各位小伙伴周末晚上好<br> <img src="https://images2.imgbox.com/f3/2c/i6pMNGC9_o.png" alt="在这里插入图片描述"></p> 
<p>这里是你们微胖的小编Monster。</p> 
<p>话说小编的老妈今天给小编打电话，叮嘱我平时吃饭少吃一点…<br> <img src="https://images2.imgbox.com/b8/26/ZIJAd0fg_o.png" alt="在这里插入图片描述"></p> 
<p>说昨天看我朋友圈发的照片，已经从以前的瓜子脸，变成国字脸了…<br> <img src="https://images2.imgbox.com/a0/2d/2Qa8DVpX_o.png" alt="在这里插入图片描述"><br> Whatever，让我们一起来看看今天的内容吧</p> 
<hr> 
<p>一、实验概述</p> 
<p>实验拓扑：<br> <img src="https://images2.imgbox.com/03/6c/RyyJZS1w_o.png" alt="在这里插入图片描述"></p> 
<p>利用XSS漏洞，我们可以在网页中插入恶意js代码，通过js代码，我们可以干很多事情，例如伪造一个登陆页面。</p> 
<p>当用户访问该网页时，就会自动弹出登陆页面，如果用户信以为真，输入了用户名与密码，密码就会传输到攻击者的服务器中，完成账号窃取。</p> 
<br> 
<p>二、编写登陆窗口代码</p> 
<p>首先我们在攻击者服务器（192.168.211.1）编写一段弹窗代码，如下：<br> <img src="https://images2.imgbox.com/19/5f/y4XdAsvy_o.png" alt="在这里插入图片描述"><br> 本段代码使用的是 PHP 的 HTTP 认证机制，说明如下。</p> 
<p>首先，利用 header() 函数，我们可以向客户端浏览器发送 Authentication Required 信息，使其弹出一个用户名/密码输入窗口。</p> 
<p>当用户输入用户名和密码后，包含有 URL 的 PHP 脚本将会和预定义变量 PHP_AUTH_USER、PHP_AUTH_PW 和 AUTH_TYPE 一起被调用，这三个变量分别被设定为用户名，密码和认证类型。</p> 
<p>这三个预定义变量会被保存在 $_SERVER 数组中，我们再通过Get方法，将用户名、密码传递给record.php页面，等待下一步处理。</p> 
<p>尝试访问一下这个页面，弹出登录框：<br> <img src="https://images2.imgbox.com/6c/46/L27PmSs5_o.png" alt="在这里插入图片描述"></p> 
<p>输入账号、密码123/123，通过GET方式发送给record.php：<br> <img src="https://images2.imgbox.com/05/0d/zF2k1p2N_o.png" alt="在这里插入图片描述"></p> 
<p>这样，我们的登陆窗口页面就完成了，接下来编写记录页面。</p> 
<br> 三、用户信息记录 
<p>伪造的登陆界面，会把用户名、密码信息发送给record.php页面。</p> 
<p>通过该页面，我们将用户名、密码保存到攻击者服务器本地，代码如下：<br> <img src="https://images2.imgbox.com/56/88/bU0WnJR1_o.png" alt="在这里插入图片描述"><br> 代码说明：</p> 
<p>通过$_GET接收传过来的username和password的值</p> 
<p>通过getenv方法，可以获取用户的ip地址和信息来源</p> 
<p>通过date函数，记录下获取到信息的时间</p> 
<p>通过fopen函数，通过a（追加）的方式，打开user.txt文件</p> 
<p>通过fwrite的方式，将我们获取到的信息记录到user.txt文件中</p> 
<p>最后，fclose函数关闭文件。</p> 
<br> 再访问一次登陆伪造页面，并输入用户名、密码123/123： 
<p><img src="https://images2.imgbox.com/91/60/AvWBuJHa_o.png" alt="在这里插入图片描述"><br> 攻击者本地生成user.txt，成功记录账号、密码信息：<br> <img src="https://images2.imgbox.com/95/76/mA4PZYbh_o.png" alt="在这里插入图片描述"></p> 
<br> 四、插入恶意js脚本 
<p>Web页面以DVWA平台 存储型XSS为例，我们来插入一个恶意JS代码。</p> 
<p>代码构造如下：<br> <img src="https://images2.imgbox.com/03/5d/EhsIRmMl_o.png" alt="在这里插入图片描述"></p> 
<p>通过插入iframe标签，让用户访问漏洞页面时，自动访问攻击者服务器上的钓鱼页面fish.php，出现登陆弹窗。</p> 
<p>选择low安全等级，打开dvwa XSS(stored)页面 ：<br> <img src="https://images2.imgbox.com/46/5a/uQlWm2HZ_o.png" alt="在这里插入图片描述"></p> 
<p>在Name栏、Message栏均存在存储型XSS，在Message中输入上面的恶意代码，并提交，会发现有输入长度限制：<br> <img src="https://images2.imgbox.com/e4/8c/lKmjAhxt_o.png" alt="在这里插入图片描述"><br> 不过这里是前端长度限制，我们直接修改当前网页代码即可，将maxlength改大：<br> <img src="https://images2.imgbox.com/0a/15/ClF8pCKf_o.png" alt="在这里插入图片描述"><br> 再次输入，可顺利输入，点击提交即可：<br> <img src="https://images2.imgbox.com/24/44/MQQHsqs5_o.png" alt="在这里插入图片描述"></p> 
<p>当前页面马上出现弹窗：<br> <img src="https://images2.imgbox.com/83/29/5Xw9KmEm_o.png" alt="在这里插入图片描述"></p> 
<p>现在我们使用靶机来模拟一次攻击行为，使用用户主机访问low安全等级的dvwa XSS(stored)页面，因为impossible等级不存在XSS漏洞，</p> 
<p>立刻出现弹窗：</p> 
<p><img src="https://images2.imgbox.com/d9/e4/lFL3JkQ9_o.png" alt="[外链图片转存失败(img-fSw9rkMZ-1563754984873)(C:\Users\Monster\AppData\Roaming\Typora\typora-user-images\1563719688890.png)]"></p> 
<p>使用用户名、密码，点击确认，页面恢复正常：<br> <img src="https://images2.imgbox.com/a4/6c/fx4YitTE_o.png" alt="在这里插入图片描述"></p> 
<p>查看攻击者服务器user.txt文件：<br> <img src="https://images2.imgbox.com/e1/bc/NTgphEWQ_o.png" alt="在这里插入图片描述"></p> 
<p>同时，输入用户名、密码后，当前页面已存在PHP_AUTH_USER、PHP_AUTH_PW 变量，因此再次访问该页面，不会再出现弹窗，避免露馅：<br> <img src="https://images2.imgbox.com/f3/0b/tPSbcRE8_o.png" alt="在这里插入图片描述"></p> 
<p>利用XSS漏洞，我们甚至能跳转到一个和真实网站登陆界面一模一样的网页，更具有欺骗性。</p> 
<hr> 
<p>好啦，以上就是今天的全部内容了~</p> 
<p>如果有问题，或者是有想听的专题，也欢迎到我的微信公众号留言哦~<br> <img src="https://images2.imgbox.com/11/e8/XxUcfGuf_o.png" alt="在这里插入图片描述"><br> Peace！<br> <img src="https://images2.imgbox.com/2c/ad/oKol2slt_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/aca842a20af447f6db3970e962a21c81/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">react 16.7 hook概述</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f58fcad90a93b80c243bbee6c4529b3a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">电脑cpu风扇转一下就停，不停重复，无法开机。</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>