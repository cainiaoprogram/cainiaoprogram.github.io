<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>网络——传输层（详细版） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="网络——传输层（详细版）" />
<meta property="og:description" content="目录
一、传输层功能
二、传输层协议
1.UDP协议
（1）协议格式
（2）特点
（3）缓冲区
（4）UDP注意事项
（5）基于UDP的应用层协议
2.TCP协议
（1）协议格式
（2）六位标志位
（3）TCP原理/机制
①确认应答机制（安全机制）
②超时重传机制（安全机制）
③连接管理机制（安全机制）
三次握手流程（建立连接） ​
四次挥手流程（关闭连接）
④滑动窗口机制（提高效率机制）
⑤流量控制机制（安全机制）（接收端安全）
⑥拥塞机制（安全机制）（发送端安全）
⑦延迟应答机制（提高效率机制）
⑧捎带应答机制（提高效率机制）
（4）TCP特点
①面向字节流
②粘包
3.TCP和UDP的区别
三、常见问题
一、传输层功能 提供端对端的接口，确保网络数据传输的可靠性(安全性）向应用层提供通信服务；
（五元组：源ip，源port，目的ip，目的port，协议号；作用：标识一个通信）
二、传输层协议 1.UDP协议 （1）协议格式 16位的源端口/16位的目的端口：描述数据从哪个进程发送到哪个进程 – 负责实现应用程序间的数据传输16位的数据报长度：包含UDP报文头部在内的整体报文长度，16位存储的最大数字为6553516位的校验和：二进制反码求和算法，用于校验接收到的数据和发送的数据是否一致发送方在发送数据之前，校验和为0，从完整报文的第0个字节开始，每个字节进行取反相加，超过16位的部分取出来，再次与低16位进行相加，最后得到一个校验和填充到协议字段中接收方接收到数据之后，从完整报文的第0个字节开始，每个字节进行取反相加，最终的结果如果为0，则表示数据一致，否则则表示数据不一致 （2）特点 UDP传输过程类似于寄信；
①无连接：知道对端的IP和端口号就直接进传输，不需要建立连接；
②不可靠：没有确认，重传机制；如果因为网络故障该段无法发送到对方，UDP协议层不会给应用层返回任何错误信息；
③面向数据报：不能灵活的控制读写数据的次数和数量；
（3）缓冲区 ①没有真正意义上的发送缓冲区，调用sendto会直接交给内核，由内核将数据传给网络层协议进行后续的传输动作；
②具有接收缓冲区，不能保证数据顺序一致；
UDP的socket既能读也能写，叫做全双工；
（4）UDP注意事项 UDP协议首部中有一个16位的最大长度，也就是说一个UDP能传输的数据最大长度是64K（包含UDP首部），如需传输大于64K的数据，就需要在应用层手动分包，多次发送，并在接收端手动拼接；
（5）基于UDP的应用层协议 NFS：网络文件共享；
TFTP：简单文件传输协议；
DHCP：动态主机配置协议；
BOOTP：启动协议（用于无盘设备启动）；
DNS：域名解析协议；
2.TCP协议 （1）协议格式 16位的源端口和目的端口：负责应用程序之间的数据传输32位序号/32位确认序号：实现确认应答机制以及接收端的包序管理4位头部长度：表示TCP头部有多少，TCP头部是不定长的，主要取决于选项数据的大小，TCP头部最小为20字节，最大60字节(选项数据中占0~40字节)6位保留位：目前没有想好用来干什么，先预留出来用于以后扩展6位标志位：URG/ACK/PSH/RST/SYN/FIN16位窗口大小：表示本端可以接收的数据大小，用于实现滑动窗口机制，进行流量控制16位校验和：二进制反码求和算法，校验数据接收与发送的一致性16位紧急指针：标识哪些数据是紧急数据(带外数据)0-40字节的选项数据：通常用于协商一些信息如MSS的长度 （2）六位标志位 URG：紧急指针是否有效；
ACK：确认号是否有效；
PSH：提示接收端应用程序立刻从TCP缓冲区把数据读走；
RST：对方要求重新建立连接，把携带RST标识的称为复位报文段；
SYN：请求建立连接，把携带SYN标识的称为同步报文段；
FIN：通知对方，本端要关闭了，把携带FIN标识的称为结束报文段；
（3）TCP原理/机制 ①确认应答机制（安全机制） ②超时重传机制（安全机制） 发送端发送的数据报超过一定时间间隔没有收到确认应答的数据报，表示之前发送的数据报可能丢包，所以要重新发送；" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/15bebc6b2023b95193ece9b29ac8cf39/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-22T18:59:24+08:00" />
<meta property="article:modified_time" content="2022-04-22T18:59:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">网络——传输层（详细版）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80%E3%80%81%E5%8A%9F%E8%83%BD-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E5%8A%9F%E8%83%BD" rel="nofollow">一、传输层功能</a></p> 
<p id="%E4%BA%8C%E3%80%81%E4%BC%A0%E8%BE%93%E5%B1%82%E5%8D%8F%E8%AE%AE-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E4%BC%A0%E8%BE%93%E5%B1%82%E5%8D%8F%E8%AE%AE" rel="nofollow">二、传输层协议</a></p> 
<p id="1.UDP%E5%8D%8F%E8%AE%AE-toc" style="margin-left:40px;"><a href="#1.UDP%E5%8D%8F%E8%AE%AE" rel="nofollow">1.UDP协议</a></p> 
<p id="%EF%BC%881%EF%BC%89%E5%8D%8F%E8%AE%AE%E6%A0%BC%E5%BC%8F-toc" style="margin-left:80px;"><a href="#%EF%BC%881%EF%BC%89%E5%8D%8F%E8%AE%AE%E6%A0%BC%E5%BC%8F" rel="nofollow">（1）协议格式</a></p> 
<p id="%EF%BC%881%EF%BC%89%E7%89%B9%E7%82%B9-toc" style="margin-left:80px;"><a href="#%EF%BC%881%EF%BC%89%E7%89%B9%E7%82%B9" rel="nofollow">（2）特点</a></p> 
<p id="%EF%BC%882%EF%BC%89%E7%BC%93%E5%86%B2%E5%8C%BA-toc" style="margin-left:80px;"><a href="#%EF%BC%882%EF%BC%89%E7%BC%93%E5%86%B2%E5%8C%BA" rel="nofollow">（3）缓冲区</a></p> 
<p id="%EF%BC%883%EF%BC%89UDP%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9-toc" style="margin-left:80px;"><a href="#%EF%BC%883%EF%BC%89UDP%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" rel="nofollow">（4）UDP注意事项</a></p> 
<p id="%EF%BC%884%EF%BC%89%E5%9F%BA%E4%BA%8EUDP%E7%9A%84%E5%BA%94%E7%94%A8%E5%B1%82%E5%8D%8F%E8%AE%AE-toc" style="margin-left:80px;"><a href="#%EF%BC%884%EF%BC%89%E5%9F%BA%E4%BA%8EUDP%E7%9A%84%E5%BA%94%E7%94%A8%E5%B1%82%E5%8D%8F%E8%AE%AE" rel="nofollow">（5）基于UDP的应用层协议</a></p> 
<p id="2.TCP%E5%8D%8F%E8%AE%AE-toc" style="margin-left:40px;"><a href="#2.TCP%E5%8D%8F%E8%AE%AE" rel="nofollow">2.TCP协议</a></p> 
<p id="%EF%BC%881%EF%BC%89%E5%8D%8F%E8%AE%AE%E6%A0%BC%E5%BC%8F-toc" style="margin-left:80px;"><a href="#%EF%BC%881%EF%BC%89%E5%8D%8F%E8%AE%AE%E6%A0%BC%E5%BC%8F" rel="nofollow">（1）协议格式</a></p> 
<p id="%EF%BC%881%EF%BC%89%E5%85%AD%E4%BD%8D%E6%A0%87%E5%BF%97%E4%BD%8D-toc" style="margin-left:80px;"><a href="#%EF%BC%881%EF%BC%89%E5%85%AD%E4%BD%8D%E6%A0%87%E5%BF%97%E4%BD%8D" rel="nofollow">（2）六位标志位</a></p> 
<p id="%EF%BC%882%EF%BC%89TCP%E5%8E%9F%E7%90%86%2F%E6%9C%BA%E5%88%B6-toc" style="margin-left:80px;"><a href="#%EF%BC%882%EF%BC%89TCP%E5%8E%9F%E7%90%86%2F%E6%9C%BA%E5%88%B6" rel="nofollow">（3）TCP原理/机制</a></p> 
<p id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A0%E7%A1%AE%E8%AE%A4%E5%BA%94%E7%AD%94%E6%9C%BA%E5%88%B6-toc" style="margin-left:80px;"><a href="#%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A0%E7%A1%AE%E8%AE%A4%E5%BA%94%E7%AD%94%E6%9C%BA%E5%88%B6" rel="nofollow">        ①确认应答机制（安全机制）</a></p> 
<p id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A1%E8%B6%85%E6%97%B6%E9%87%8D%E4%BC%A0%E6%9C%BA%E5%88%B6-toc" style="margin-left:80px;"><a href="#%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A1%E8%B6%85%E6%97%B6%E9%87%8D%E4%BC%A0%E6%9C%BA%E5%88%B6" rel="nofollow">        ②超时重传机制（安全机制）</a></p> 
<p id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A2%E8%BF%9E%E6%8E%A5%E7%AE%A1%E7%90%86%E6%9C%BA%E5%88%B6-toc" style="margin-left:80px;"><a href="#%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A2%E8%BF%9E%E6%8E%A5%E7%AE%A1%E7%90%86%E6%9C%BA%E5%88%B6" rel="nofollow">        ③连接管理机制（安全机制）</a></p> 
<p id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E6%B5%81%E7%A8%8B%EF%BC%88%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5%EF%BC%89-toc" style="margin-left:80px;"><a href="#%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E6%B5%81%E7%A8%8B%EF%BC%88%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5%EF%BC%89" rel="nofollow">      <span style="color:#fe2c24;">                  三次握手流程（建立连接）</span></a><a href="#%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%80%8B" rel="nofollow"><span style="color:#fe2c24;">           ​</span></a></p> 
<p id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%E6%B5%81%E7%A8%8B%EF%BC%88%E5%85%B3%E9%97%AD%E8%BF%9E%E6%8E%A5%EF%BC%89-toc" style="margin-left:80px;"><a href="#%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%E6%B5%81%E7%A8%8B%EF%BC%88%E5%85%B3%E9%97%AD%E8%BF%9E%E6%8E%A5%EF%BC%89" rel="nofollow"><span style="color:#fe2c24;">                        四次挥手流程（关闭连接</span>）</a></p> 
<p id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A3%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E6%9C%BA%E5%88%B6-toc" style="margin-left:80px;"><a href="#%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A3%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E6%9C%BA%E5%88%B6" rel="nofollow">        ④滑动窗口机制（提高效率机制）</a></p> 
<p id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A4%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6%E6%9C%BA%E5%88%B6-toc" style="margin-left:80px;"><a href="#%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A4%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6%E6%9C%BA%E5%88%B6" rel="nofollow">        ⑤流量控制机制（安全机制）（接收端安全）</a></p> 
<p id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A5%E6%8B%A5%E5%A1%9E%E6%9C%BA%E5%88%B6-toc" style="margin-left:80px;"><a href="#%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A5%E6%8B%A5%E5%A1%9E%E6%9C%BA%E5%88%B6" rel="nofollow">        ⑥拥塞机制（安全机制）（发送端安全）</a></p> 
<p id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A6%E5%BB%B6%E8%BF%9F%E5%BA%94%E7%AD%94%E6%9C%BA%E5%88%B6-toc" style="margin-left:80px;"><a href="#%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A6%E5%BB%B6%E8%BF%9F%E5%BA%94%E7%AD%94%E6%9C%BA%E5%88%B6" rel="nofollow">        ⑦延迟应答机制（提高效率机制）</a></p> 
<p id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A7%E6%8D%8E%E5%B8%A6%E5%BA%94%E7%AD%94%E6%9C%BA%E5%88%B6-toc" style="margin-left:80px;"><a href="#%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A7%E6%8D%8E%E5%B8%A6%E5%BA%94%E7%AD%94%E6%9C%BA%E5%88%B6" rel="nofollow">        ⑧捎带应答机制（提高效率机制）</a></p> 
<p id="%EF%BC%883%EF%BC%89TCP%E7%89%B9%E7%82%B9-toc" style="margin-left:80px;"><a href="#%EF%BC%883%EF%BC%89TCP%E7%89%B9%E7%82%B9" rel="nofollow">（4）TCP特点</a></p> 
<p id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A0%E9%9D%A2%E5%90%91%E5%AD%97%E8%8A%82%E6%B5%81-toc" style="margin-left:80px;"><a href="#%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A0%E9%9D%A2%E5%90%91%E5%AD%97%E8%8A%82%E6%B5%81" rel="nofollow">        ①面向字节流</a></p> 
<p id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A1%E7%B2%98%E5%8C%85-toc" style="margin-left:80px;"><a href="#%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A1%E7%B2%98%E5%8C%85" rel="nofollow">        ②粘包</a></p> 
<p id="3.TCP%E5%92%8CUDP%E7%9A%84%E5%8C%BA%E5%88%AB-toc" style="margin-left:40px;"><a href="#3.TCP%E5%92%8CUDP%E7%9A%84%E5%8C%BA%E5%88%AB" rel="nofollow">3.TCP和UDP的区别</a></p> 
<p id="%E4%B8%89%E3%80%81%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98" rel="nofollow">三、常见问题</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E4%B8%80%E3%80%81%E5%8A%9F%E8%83%BD">一、传输层功能</h2> 
<p>提供端对端的接口，确保网络数据传输的可靠性(安全性）向应用层提供通信服务；</p> 
<p>（五元组：源ip，源port，目的ip，目的port，协议号；作用：标识一个通信）</p> 
<hr> 
<h2 id="%E4%BA%8C%E3%80%81%E4%BC%A0%E8%BE%93%E5%B1%82%E5%8D%8F%E8%AE%AE">二、传输层协议</h2> 
<h3 id="1.UDP%E5%8D%8F%E8%AE%AE">1.UDP协议</h3> 
<h4 id="%EF%BC%881%EF%BC%89%E5%8D%8F%E8%AE%AE%E6%A0%BC%E5%BC%8F">（1）协议格式</h4> 
<p><img alt="" height="164" src="https://images2.imgbox.com/1d/96/Ivxm4T3D_o.png" width="316"></p> 
<ul><li>16位的源端口/16位的目的端口：描述数据从哪个进程发送到哪个进程 – 负责实现应用程序间的数据传输</li><li>16位的数据报长度：包含UDP报文头部在内的整体报文长度，16位存储的最大数字为65535</li><li>16位的校验和：二进制反码求和算法，用于校验接收到的数据和发送的数据是否一致</li><li>发送方在发送数据之前，校验和为0，从完整报文的第0个字节开始，每个字节进行取反相加，超过16位的部分取出来，再次与低16位进行相加，最后得到一个校验和填充到协议字段中</li><li>接收方接收到数据之后，从完整报文的第0个字节开始，每个字节进行取反相加，最终的结果如果为0，则表示数据一致，否则则表示数据不一致</li></ul> 
<h4 id="%EF%BC%881%EF%BC%89%E7%89%B9%E7%82%B9">（2）特点</h4> 
<p>UDP传输过程类似于寄信；</p> 
<p>①无连接：知道对端的IP和端口号就直接进传输，不需要建立连接；</p> 
<p>②不可靠：没有确认，重传机制；如果因为网络故障该段无法发送到对方，UDP协议层不会给应用层返回任何错误信息；</p> 
<p>③面向数据报：不能灵活的控制读写数据的次数和数量；</p> 
<h4 id="%EF%BC%882%EF%BC%89%E7%BC%93%E5%86%B2%E5%8C%BA">（3）缓冲区</h4> 
<p>①没有真正意义上的发送缓冲区，调用sendto会直接交给内核，由内核将数据传给网络层协议进行后续的传输动作；</p> 
<p>②具有接收缓冲区，不能保证数据顺序一致；</p> 
<p>UDP的socket既能读也能写，叫做全双工；</p> 
<h4 id="%EF%BC%883%EF%BC%89UDP%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">（4）UDP注意事项</h4> 
<p>UDP协议首部中有一个16位的最大长度，也就是说一个UDP能传输的数据最大长度是64K（包含UDP首部），如需传输大于64K的数据，就需要在应用层手动分包，多次发送，并在接收端手动拼接；</p> 
<h4 id="%EF%BC%884%EF%BC%89%E5%9F%BA%E4%BA%8EUDP%E7%9A%84%E5%BA%94%E7%94%A8%E5%B1%82%E5%8D%8F%E8%AE%AE">（5）基于UDP的应用层协议</h4> 
<p>NFS：网络文件共享；</p> 
<p>TFTP：简单文件传输协议；</p> 
<p>DHCP：动态主机配置协议；</p> 
<p>BOOTP：启动协议（用于无盘设备启动）；</p> 
<p>DNS：域名解析协议；</p> 
<h3 id="2.TCP%E5%8D%8F%E8%AE%AE">2.TCP协议</h3> 
<h4>（1）协议格式</h4> 
<p><img alt="" height="202" src="https://images2.imgbox.com/33/8a/bf9tYTQF_o.png" width="409"></p> 
<ul><li>16位的源端口和目的端口：负责应用程序之间的数据传输</li><li>32位序号/32位确认序号：实现确认应答机制以及接收端的包序管理</li><li>4位头部长度：表示TCP头部有多少，TCP头部是不定长的，主要取决于选项数据的大小，TCP头部最小为20字节，最大60字节(选项数据中占0~40字节)</li><li>6位保留位：目前没有想好用来干什么，先预留出来用于以后扩展</li><li>6位标志位：URG/ACK/PSH/RST/SYN/FIN</li><li>16位窗口大小：表示本端可以接收的数据大小，用于实现滑动窗口机制，进行流量控制</li><li>16位校验和：二进制反码求和算法，校验数据接收与发送的一致性</li><li>16位紧急指针：标识哪些数据是紧急数据(带外数据)</li><li>0-40字节的选项数据：通常用于协商一些信息如MSS的长度</li></ul> 
<h4 id="%EF%BC%881%EF%BC%89%E5%85%AD%E4%BD%8D%E6%A0%87%E5%BF%97%E4%BD%8D">（2）六位标志位</h4> 
<p>URG：紧急指针是否有效；</p> 
<p><span style="color:#fe2c24;">ACK</span>：确认号是否有效；</p> 
<p>PSH：提示接收端应用程序立刻从TCP缓冲区把数据读走；</p> 
<p>RST：对方要求重新建立连接，把携带RST标识的称为复位报文段；</p> 
<p><span style="color:#fe2c24;">SYN</span>：请求建立连接，把携带SYN标识的称为同步报文段；</p> 
<p><span style="color:#fe2c24;">FIN</span>：通知对方，本端要关闭了，把携带FIN标识的称为结束报文段；</p> 
<h4 id="%EF%BC%882%EF%BC%89TCP%E5%8E%9F%E7%90%86%2F%E6%9C%BA%E5%88%B6">（3）TCP原理/机制</h4> 
<h4 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A0%E7%A1%AE%E8%AE%A4%E5%BA%94%E7%AD%94%E6%9C%BA%E5%88%B6">        ①确认应答机制（安全机制）</h4> 
<p><img alt="" height="254" src="https://images2.imgbox.com/24/6e/WD7ChfUr_o.png" width="348"></p> 
<h4 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A1%E8%B6%85%E6%97%B6%E9%87%8D%E4%BC%A0%E6%9C%BA%E5%88%B6">        ②超时重传机制（安全机制）</h4> 
<p>发送端发送的数据报超过<span style="color:#38d8f0;">一定时间</span>间隔没有收到确认应答的数据报，表示之前发送的数据报<span style="color:#ff9900;">可能丢包</span>，所以要重新发送；</p> 
<p><span style="color:#38d8f0;">一定时间</span>：网络环境不同，是有差异的，时间太长会影响重传效率，时间太短会频繁发送重复的包，为了保证高性能通信，会动态设置计算最大超时时间，超时500ms重发，再超时2*500ms......累计一定的重传次数，认为无法正常发送数据，关闭连接；</p> 
<p><span style="color:#ff9900;">可能丢包：</span><span style="color:#0d0016;">发送的数据报丢包 或 确认应答数据报；</span></p> 
<h4 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A2%E8%BF%9E%E6%8E%A5%E7%AE%A1%E7%90%86%E6%9C%BA%E5%88%B6">        ③连接管理机制（安全机制）</h4> 
<p>连接：对每一端来说，保持一个本端到对端的连接状态；</p> 
<h4 id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E6%B5%81%E7%A8%8B%EF%BC%88%E5%BB%BA%E7%AB%8B%E8%BF%9E%E6%8E%A5%EF%BC%89">                     <span style="color:#fe2c24;">   三次握手流程（建立连接）</span></h4> 
<h4 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%80%8B">                        <img alt="" height="197" src="https://images2.imgbox.com/8d/e3/0hWfV2Ja_o.png" width="212"></h4> 
<p>流程：</p> 
<p>a）客户端发送SYN数据报到服务端，申请建立客户端到服务端的连接；</p> 
<p>b）服务端返回SYN+ACK给客户端；</p> 
<p>（ACK是第一次SYN的应答，SYN是申请建立服务端到客户端的连接，客户端接收到该数据报，建立客户端到服务端的连接）</p> 
<p>c）客户端返回ACK给服务端；</p> 
<p>（ACK是对第二次SYN的应答）</p> 
<h4 id="%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%C2%A0%20%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B%E6%B5%81%E7%A8%8B%EF%BC%88%E5%85%B3%E9%97%AD%E8%BF%9E%E6%8E%A5%EF%BC%89"><span style="color:#fe2c24;">                        四次挥手流程（关闭连接）</span></h4> 
<p><span style="color:#fe2c24;">        </span>                   <img alt="" height="228" src="https://images2.imgbox.com/ed/a5/5KNX5rNQ_o.png" width="239"></p> 
<p> a）客户端发送FIN到服务端，申请关闭连接（客户端——&gt;服务端的连接）；</p> 
<p>        （服务端收到该数据报，状态置为CLOSE_WAIT）</p> 
<p>b）服务端返回ACK给客户端；</p> 
<p>        （操作系统实现TCP协议时，默认机制：系统自动返回）</p> 
<p>c）服务端发送FIN到客户端，申请关闭连接（服务端——&gt;客户端的连接）；</p> 
<p>        （客户端收到该数据报，状态置为TIME_WAIT）</p> 
<p>d）客户端返回ACK给服务端；</p> 
<h4 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A3%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3%E6%9C%BA%E5%88%B6">        ④滑动窗口机制（提高效率机制）</h4> 
<p>“高速重发控制” 也叫 “快重传”；</p> 
<p>作用：同时发送多个数据报，同时接收多个响应ACK，提高效率；</p> 
<p>窗口大小：指的是无需等待确认应答而可以继续发送数据的最大值；</p> 
<p>如何确定窗口大小：min（流量窗口大小，拥塞窗口大小）；</p> 
<p>滑动：发送后没有返回ACK的数据，都保存在发送缓冲区，接收到下一个是多少的ACK之后，可以计算出可以滑动的大小（下一个是多少 - 窗口最小序号）；</p> 
<h4 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A4%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6%E6%9C%BA%E5%88%B6">        ⑤流量控制机制（安全机制）（接收端安全）</h4> 
<p>根据接收端的处理能力，来决定发送端的发送速度；</p> 
<p>作用：间接的控制发送端滑动窗口大小（发送数据的大小）；</p> 
<h4 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A5%E6%8B%A5%E5%A1%9E%E6%9C%BA%E5%88%B6">        ⑥拥塞机制（安全机制）（发送端安全）</h4> 
<p>TCP引入了“慢启动”机制，先发少量的数据，探探路，摸清当前的网络拥堵状态，再决定按照多大的速度进行传输数据；</p> 
<p>慢启动的阈值（窗口最大值），当拥塞窗口超过这个阈值的时候，不再按照指数的方式增加，而是按照线性方式增长，在每次超时重发的时候，慢启动的阈值会变成原来的一半，同时拥塞窗口置位1；</p> 
<h4 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A6%E5%BB%B6%E8%BF%9F%E5%BA%94%E7%AD%94%E6%9C%BA%E5%88%B6">        ⑦延迟应答机制（提高效率机制）</h4> 
<p>马上应答，返回的流量窗口大小会比较小，接收端处理速度是比较快的，稍等一段时间，接收端消费一些接收缓冲区数据后，再返回的流量窗口大小会更大；发送端设置的滑动窗口大小就可能更大，网络数据传输的吞吐量就更高；</p> 
<h4 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A7%E6%8D%8E%E5%B8%A6%E5%BA%94%E7%AD%94%E6%9C%BA%E5%88%B6">        ⑧捎带应答机制（提高效率机制）</h4> 
<p>需要主动发送的数据报，可以和接收数据报后要返回的ACK数据报合并为一个，类似TCP三次握手中，第二次合并SYN和ACK的数据报；</p> 
<h4 id="%EF%BC%883%EF%BC%89TCP%E7%89%B9%E7%82%B9">（4）TCP特点</h4> 
<h4 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A0%E9%9D%A2%E5%90%91%E5%AD%97%E8%8A%82%E6%B5%81">        ①面向字节流</h4> 
<p>创建一个TCP的socket，同时在内核中创建一个发送缓冲区和一个接收缓冲区，调用write时，数据会先写入发送缓冲区中；如果发送的字节数太长，会被拆成多个TCP的数据包发出；如果发送的字节数太短，就会先在缓冲区里等待，等到缓冲区长度差不多了，或者其他合适的时机发送出去；接收数据时，数据也是从网卡驱动程序到达内核的接收缓冲区，然后应用程序可以调用read从接收缓冲区拿数据；</p> 
<p>TCP的一个连接，既有发送缓冲区也要接收缓冲区，那么对于这一个连接，既可以读数据，也可以写数据，这叫做<span style="color:#fe2c24;">全双工</span>。</p> 
<h4 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E2%91%A1%E7%B2%98%E5%8C%85">        ②粘包</h4> 
<p>表示应用层读取多组数据时，一定要规定号一个业务的数据格式（应用层协议）</p> 
<p>产生原有：没有明确数据报的边界；（UDP不存在粘包问题）</p> 
<h3 id="3.TCP%E5%92%8CUDP%E7%9A%84%E5%8C%BA%E5%88%AB">3.TCP和UDP的区别</h3> 
<p>1）UDP是无连接的，不可靠，但效率更高</p> 
<p>      TCP是有连接，可靠传输，效率相对UDP更差</p> 
<p>2）UDP是面向数据报（一次发，一次收）</p> 
<p>      TCP是面向字节流（多次发，多次收）</p> 
<p>3）UDP没有发送缓冲区，有接收缓冲区</p> 
<p>      TCP既有发送缓冲区也有接收缓冲区</p> 
<p>（基于TCP和UDP程序，既可以发也可以收，叫做全双工）</p> 
<p>4）UDP数据大小受限</p> 
<p>      TCP数据大小不限</p> 
<p>5）TCP提供了很多可靠传输机制</p> 
<hr> 
<h2 id="%E4%B8%89%E3%80%81%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98">三、常见问题</h2> 
<p>1）问：基于传输层UDP协议，如何传输超过64k的数据？如何保证可靠传输？</p> 
<p>-----&gt;在应用层实现类似TCP所有可靠传输机制；</p> 
<p>2）问：连接管理机制中为什么是四次挥手，能不能是三次？</p> 
<p>-----&gt;第二次是系统自动返回，第三次是手动调用close关闭连接才返回；</p> 
<p>问：为什么不能合并？</p> 
<p>-----&gt;TCP协议栈实现时，就不包含主动发的FIN，交给程序自己实现；（程序关闭前，可以完成一些前置工作，如释放资源等操作）</p> 
<p>问：第三步，客户端收到FIN以后，为什么还不能置为关闭状态，而要等待一定的时间？</p> 
<p>-----&gt;第四步的ACK也可能丢包，这种情况下，服务端会基于超时重传机制，重发FIN，如果客户端关闭连接，就无法处理这个数据报；</p> 
<p>问：为什么TIME_WAIT的时间时2MSL？</p> 
<p>-----&gt;MSL是TCP报文的最大生存时间，如果最后一步的ACK丢包，上一步的FIN还需要再发一次；</p> 
<p>问：为什么服务器出现大量的CLOSE_WAIT?</p> 
<p>-----&gt;原因是服务器没有正确的关闭socket，导致四次挥手没有正确完成，这是一个BUG，只需要加上对应的CLOSE即可解决问题；</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a6d976f595d22e26791f6986e5f12b3b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">django树形结构展示</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d843181edb2d62299f329a7467e6f983/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">约瑟夫问题的几种解决方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>