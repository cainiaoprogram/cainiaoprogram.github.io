<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用Arduino的触摸传感器模块接口库 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用Arduino的触摸传感器模块接口库" />
<meta property="og:description" content="触摸传感器模块接口库与I2C和Arduino兼容。它是一个基本函数库，可用于处理与传感器模块的通信。该库包含一个示例程序，可帮助学习。
0 Arduino的接口库 用于与 Neonode 触摸传感器模块光学触摸传感器通信的 Arduino 库。处理通过 I2C 通信的基本 BER 编码 ASN.1 消息。
1 使用案例 如果您想轻松地开始使用原型，了解如何使用I2C与传感器模块通信，或者如果您想了解该库是如何实现通信的，则此库非常有用
2 简介 该库提供了一种与触摸传感器模块进行通信的简单方式，以及ASN.1串行消息的一些原始解析。这使得最终用户可以轻松地从触摸通知中获取x和y坐标，或者设置不同的设置，例如正确的触摸活动区域。该库不支持ASN.1协议中的所有可用消息，但是I2C读写功能是公共的，如果需要从传感器模块发送/读取库不支持的任何设置或请求，则可以使用该功能。
3 开源 这个库是在GNU LGPL v2.1开源许可证下分发的，可以在GitHub上获得，还有其他文档和完整的示例程序。
4 如何使用库 主循环
该库是围绕使用 zforce.GetMessage() 作为从传感器读取消息的主要方法而构建的。 GetMessage() 方法检查数据就绪引脚是否为高电平，如果是，则从传感器读取等待消息。然后解析接收到的消息并返回指向消息的指针。
成功调用 GetMessage() 将为新消息动态分配内存。当不再需要消息信息时，最终用户可以通过调用 zforce.DestroyMessage() 来销毁消息。请检查提供的示例代码以获取使用示例。
Message* Zforce::GetMessage() { Message* msg = nullptr; if(GetDataReady() == HIGH) { if(!Read(buffer)) { msg = VirtualParse(buffer); ClearBuffer(buffer); } } return msg; } 发送和读取消息
该库支持在传感器中设置一些基本配置参数，例如zforce。SetTouchActiveArea（）。当向传感器写入任何消息时，最终用户必须在写入之前确保数据就绪信号为LOW（低）（即，必须没有等待从传感器读取的消息）。如果数据就绪信号为HIGH，则需要调用GetMessage（）方法，直到接收到nullptr作为响应，这表明传感器中不再有消息等待。
发送消息后，传感器始终会创建一个必须由主机读取的响应。传感器可能需要一些时间才能创建响应并将其放入 I2C 缓冲区，因此建议在发送请求后在 do-while 循环中调用 GetMessage() 方法。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/e3256a90a6806854d924b2a30d22d2d3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-12T11:10:21+08:00" />
<meta property="article:modified_time" content="2024-01-12T11:10:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用Arduino的触摸传感器模块接口库</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>触摸传感器模块接口库与I2C和Arduino兼容。它是一个基本函数库，可用于处理与传感器模块的通信。该库包含一个示例程序，可帮助学习。</p> 
<h4><a id="0_Arduino_1"></a>0 Arduino的接口库</h4> 
<p>用于与 Neonode 触摸传感器模块光学触摸传感器通信的 Arduino 库。处理通过 I2C 通信的基本 BER 编码 ASN.1 消息。</p> 
<h4><a id="1__3"></a>1 使用案例</h4> 
<p>如果您想轻松地开始使用原型，了解如何使用I2C与传感器模块通信，或者如果您想了解该库是如何实现通信的，则此库非常有用</p> 
<h4><a id="2__5"></a>2 简介</h4> 
<p>该库提供了一种与触摸传感器模块进行通信的简单方式，以及ASN.1串行消息的一些原始解析。这使得最终用户可以轻松地从触摸通知中获取x和y坐标，或者设置不同的设置，例如正确的触摸活动区域。该库不支持ASN.1协议中的所有可用消息，但是I2C读写功能是公共的，如果需要从传感器模块发送/读取库不支持的任何设置或请求，则可以使用该功能。</p> 
<h4><a id="3__7"></a>3 开源</h4> 
<p>这个库是在GNU LGPL v2.1开源许可证下分发的，可以在<a href="https://github.com/neonode-inc/zforce-arduino">GitHub</a>上获得，还有其他文档和完整的示例程序。</p> 
<h4><a id="4__9"></a>4 如何使用库</h4> 
<p><strong>主循环</strong><br> 该库是围绕使用 <code>zforce.GetMessage() </code>作为从传感器读取消息的主要方法而构建的。 <code>GetMessage() </code>方法检查数据就绪引脚是否为高电平，如果是，则从传感器读取等待消息。然后解析接收到的消息并返回指向消息的指针。<br> 成功调用 <code>GetMessage() </code>将为新消息动态分配内存。当不再需要消息信息时，最终用户可以通过调用 <code>zforce.DestroyMessage()</code> 来销毁消息。请检查提供的示例代码以获取使用示例。</p> 
<pre><code class="prism language-c">Message<span class="token operator">*</span> Zforce<span class="token operator">::</span><span class="token function">GetMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
Message<span class="token operator">*</span> msg <span class="token operator">=</span> nullptr<span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">GetDataReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> HIGH<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">Read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
msg <span class="token operator">=</span> <span class="token function">VirtualParse</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">ClearBuffer</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> msg<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>发送和读取消息</strong><br> 该库支持在传感器中设置一些基本配置参数，例如zforce。SetTouchActiveArea（）。当向传感器写入任何消息时，最终用户必须在写入之前确保数据就绪信号为LOW（低）（即，必须没有等待从传感器读取的消息）。如果数据就绪信号为HIGH，则需要调用GetMessage（）方法，直到接收到nullptr作为响应，这表明传感器中不再有消息等待。<br> 发送消息后，传感器始终会创建一个必须由主机读取的响应。传感器可能需要一些时间才能创建响应并将其放入 I2C 缓冲区，因此建议在发送请求后在 do-while 循环中调用 GetMessage() 方法。<br> 传感器的配置</p> 
<pre><code class="prism language-c"><span class="token comment">// Make sure that there is nothing in the I2C buffer before writing to the sensor module</span>
Message<span class="token operator">*</span> msg <span class="token operator">=</span> zforce<span class="token punctuation">.</span><span class="token function">GetMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>msg <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token comment">// Here you can read whatever is in the message or just destroy it.</span>
zforce<span class="token punctuation">.</span><span class="token function">DestroyMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Send Touch Active Area request</span>
zforce<span class="token punctuation">.</span><span class="token function">TouchActiveArea</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">2000</span><span class="token punctuation">,</span><span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Wait for the response to arrive</span>
<span class="token keyword">do</span>
<span class="token punctuation">{<!-- --></span>
msg <span class="token operator">=</span> zforce<span class="token punctuation">.</span><span class="token function">GetMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>msg <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// See what the response contains</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>msg<span class="token operator">-&gt;</span>type <span class="token operator">==</span> MessageType<span class="token operator">::</span>TOUCHACTIVEAREATYPE<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"minX is: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>TouchActiveAreaMessage<span class="token operator">*</span><span class="token punctuation">)</span>msg<span class="token punctuation">)</span><span class="token operator">-&gt;</span>minX<span class="token punctuation">)</span><span class="token punctuation">;</span>
Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"minY is: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>TouchActiveAreaMessage<span class="token operator">*</span><span class="token punctuation">)</span>msg<span class="token punctuation">)</span><span class="token operator">-&gt;</span>minY<span class="token punctuation">)</span><span class="token punctuation">;</span>
Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"maxX is: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>TouchActiveAreaMessage<span class="token operator">*</span><span class="token punctuation">)</span>msg<span class="token punctuation">)</span><span class="token operator">-&gt;</span>maxX<span class="token punctuation">)</span><span class="token punctuation">;</span>
Serial<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"maxY is: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>TouchActiveAreaMessage<span class="token operator">*</span><span class="token punctuation">)</span>msg<span class="token punctuation">)</span><span class="token operator">-&gt;</span>maxY<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Destroy the message</span>
zforce<span class="token punctuation">.</span><span class="token function">DestroyMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5e4b4dad1c4d86703001f69a42e0795f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">信息系统中的需求分析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3241fea36929f84107227287009316d2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">每日 python 面试10题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>