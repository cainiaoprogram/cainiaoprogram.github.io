<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于kubernetes平台微服务的部署 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="基于kubernetes平台微服务的部署" />
<meta property="og:description" content="目录
Jenkins&#43;Kubernetes&#43;Docker完成微服务持续集成
创建NFS共享目录
配置harbor
微服务的部署
Jenkins认证k8s凭证
部署其他微服务
手动上传父工程依赖到NFS的Maven共享仓库目录中
Jenkins&#43;Kubernetes&#43;Docker完成微服务持续集成 创建NFS共享目录 让所有Jenkins-Slave构建指向NFS的Maven的共享仓库目录
[root@harbor /opt/nfs]# mkdir maven [root@harbor /opt/nfs]# chmod 777 maven/ [root@harbor /opt/nfs]# vim /etc/exports /opt/nfs/jenkins 192.168.37.0/24(rw,sync,no_root_squash) /opt/nfs/maven 192.168.37.0/24(rw,sync,no_root_squash) ​ #刷新 [root@harbor /opt/nfs]# exportfs -rv exporting 192.168.37.0/24:/opt/nfs/maven exporting 192.168.37.0/24:/opt/nfs/jenkins 查看k8s集群
[root@node01 ~]# showmount -e 192.168.37.106 Export list for 192.168.37.106: /opt/nfs/maven 192.168.37.0/24 /opt/nfs/jenkins 192.168.37.0/24 Docker命令执行权限问题
[root@master01 /var/run]# chmod 777 docker.sock 新建一个流水线项目
编写构建Pipeline
配置harbor 配置harbor凭证
流水线脚本
def git_url = &#34;http://192.168.37.103:85/devops_group/tensquare_back.git&#34; def git_auth = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/46c27cdfb1777bdb55ec5fb139490d85/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-29T22:31:10+08:00" />
<meta property="article:modified_time" content="2022-06-29T22:31:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于kubernetes平台微服务的部署</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="Jenkins%2BKubernetes%2BDocker%E5%AE%8C%E6%88%90%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90-toc" style="margin-left:0px;"><a href="#Jenkins%2BKubernetes%2BDocker%E5%AE%8C%E6%88%90%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90" rel="nofollow">Jenkins+Kubernetes+Docker完成微服务持续集成</a></p> 
<p id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E5%88%9B%E5%BB%BANFS%E5%85%B1%E4%BA%AB%E7%9B%AE%E5%BD%95-toc" style="margin-left:80px;"><a href="#%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E5%88%9B%E5%BB%BANFS%E5%85%B1%E4%BA%AB%E7%9B%AE%E5%BD%95" rel="nofollow">                创建NFS共享目录</a></p> 
<p id="%C2%A0%E9%85%8D%E7%BD%AEharbor-toc" style="margin-left:40px;"><a href="#%C2%A0%E9%85%8D%E7%BD%AEharbor" rel="nofollow"> 配置harbor</a></p> 
<p id="%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E9%83%A8%E7%BD%B2-toc" style="margin-left:0px;"><a href="#%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E9%83%A8%E7%BD%B2" rel="nofollow">微服务的部署</a></p> 
<p id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0Jenkins%E8%AE%A4%E8%AF%81k8s%E5%87%AD%E8%AF%81-toc" style="margin-left:80px;"><a href="#%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0Jenkins%E8%AE%A4%E8%AF%81k8s%E5%87%AD%E8%AF%81" rel="nofollow">                Jenkins认证k8s凭证</a></p> 
<p id="%E9%83%A8%E7%BD%B2%E5%85%B6%E4%BB%96%E5%BE%AE%E6%9C%8D%E5%8A%A1-toc" style="margin-left:0px;"><a href="#%E9%83%A8%E7%BD%B2%E5%85%B6%E4%BB%96%E5%BE%AE%E6%9C%8D%E5%8A%A1" rel="nofollow">部署其他微服务</a></p> 
<p id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E6%89%8B%E5%8A%A8%E4%B8%8A%E4%BC%A0%E7%88%B6%E5%B7%A5%E7%A8%8B%E4%BE%9D%E8%B5%96%E5%88%B0NFS%E7%9A%84Maven%E5%85%B1%E4%BA%AB%E4%BB%93%E5%BA%93%E7%9B%AE%E5%BD%95%E4%B8%AD-toc" style="margin-left:80px;"><a href="#%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E6%89%8B%E5%8A%A8%E4%B8%8A%E4%BC%A0%E7%88%B6%E5%B7%A5%E7%A8%8B%E4%BE%9D%E8%B5%96%E5%88%B0NFS%E7%9A%84Maven%E5%85%B1%E4%BA%AB%E4%BB%93%E5%BA%93%E7%9B%AE%E5%BD%95%E4%B8%AD" rel="nofollow">                手动上传父工程依赖到NFS的Maven共享仓库目录中</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="Jenkins%2BKubernetes%2BDocker%E5%AE%8C%E6%88%90%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90">Jenkins+Kubernetes+Docker完成微服务持续集成</h2> 
<h4 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E5%88%9B%E5%BB%BANFS%E5%85%B1%E4%BA%AB%E7%9B%AE%E5%BD%95">                创建NFS共享目录</h4> 
<p>让所有Jenkins-Slave构建指向NFS的Maven的共享仓库目录</p> 
<pre><code>[root@harbor /opt/nfs]# mkdir maven
[root@harbor /opt/nfs]# chmod 777 maven/
[root@harbor /opt/nfs]# vim /etc/exports
/opt/nfs/jenkins 192.168.37.0/24(rw,sync,no_root_squash)
/opt/nfs/maven 192.168.37.0/24(rw,sync,no_root_squash)
​
#刷新
[root@harbor /opt/nfs]# exportfs -rv
exporting 192.168.37.0/24:/opt/nfs/maven
exporting 192.168.37.0/24:/opt/nfs/jenkins</code></pre> 
<p>查看k8s集群</p> 
<pre><code>[root@node01 ~]# showmount -e 192.168.37.106
Export list for 192.168.37.106:
/opt/nfs/maven   192.168.37.0/24
/opt/nfs/jenkins 192.168.37.0/24</code></pre> 
<p>Docker命令执行权限问题</p> 
<pre><code>[root@master01 /var/run]# chmod 777 docker.sock</code></pre> 
<p>新建一个流水线项目</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/d2/02/pqEBWvLA_o.png"></p> 
<p> </p> 
<p></p> 
<p>               <strong> 编写构建Pipeline</strong></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/25/f7/XbHaGutH_o.png"></p> 
<p> <img alt="" src="https://images2.imgbox.com/90/ce/jQPafoFj_o.png"></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/06/79/26JAnGLo_o.png"> </p> 
<h3 id="%C2%A0%E9%85%8D%E7%BD%AEharbor"> 配置harbor</h3> 
<p><strong>        配置harbor凭证</strong></p> 
<p></p> 
<p></p> 
<p></p> 
<p><img alt="" src="https://images2.imgbox.com/0d/11/3neZym9Z_o.png"></p> 
<p> </p> 
<p> </p> 
<p></p> 
<p><strong>流水线脚本</strong></p> 
<pre><code>def git_url = "http://192.168.37.103:85/devops_group/tensquare_back.git"
def git_auth = "72a48f14-72c7-444f-a471-2d482e85d808"
//构建版本的名称
def tag = "latest"
//Harbor私服地址
def harbor_url = "192.168.37.106:85"
//Harbor的项目名称
def harbor_project_name = "tensquare"
//Harbor的凭证
def harbor_auth = "ea2f47a0-3f01-4149-a095-987675db7162"
​
​
podTemplate(label: 'jenkins-slave', cloud: 'kubernetes', containers: [ 
        containerTemplate(
            name: 'jnlp',
            image: "192.168.37.106:85/library/jenkins-slave-maven:latest"
        ),
        containerTemplate( 
            name: 'docker',
            image: "docker:stable",
            ttyEnabled: true,
            command: 'cat'
        ),
    ],
    volumes: [
        hostPathVolume(mountPath: '/var/run/docker.sock', hostPath: '/var/run/docker.sock'),
        nfsVolume(mountPath: '/usr/local/apache-maven/repo', serverAddress: '192.168.37.106' , serverPath: '/opt/nfs/maven'),
    ],
)
{
node("jenkins-slave") {
    // 第一步
    stage('pull code'){
        checkout([$class: 'GitSCM', branches: [[name: '*/master']], extensions: [], 
      userRemoteConfigs: [[credentialsId: "${git_auth}", url: "${git_url}"]]])
    }
    // 第二步
    stage('make public sub project'){
        //编译并安装公共工程
        sh "mvn -f tensquare_common clean install"
    }
    // 第三步
    stage('make image'){
        //把选择的项目信息转为数组
        def selectedProjects = "${project_name}".split(',')
​
​
        for(int i=0;i&lt;selectedProjects.size();i++){
            //取出每个项目的名称和端口
            def currentProject = selectedProjects[i];
            //项目名称
            def currentProjectName = currentProject.split('@')[0]
            //项目启动端口
            def currentProjectPort = currentProject.split('@')[1]
​
            //定义镜像名称
            def imageName = "${currentProjectName}:${tag}"
​
            //编译，构建本地镜像
            sh "mvn -f ${currentProjectName} clean package dockerfile:build"
            container('docker') {
​
                //给镜像打标签
                sh "docker tag ${imageName} ${harbor_url}/${harbor_project_name}/${imageName}"
​
                //登录Harbor，并上传镜像
                withCredentials([usernamePassword(credentialsId: "${harbor_auth}", passwordVariable: 'password', usernameVariable: 'username')])
                {
                    //登录
                    sh "docker login -u ${username} -p ${password} ${harbor_url}"
                    //上传镜像
                    sh "docker push ${harbor_url}/${harbor_project_name}/${imageName}"
                }
​
            //删除本地镜像
            sh "docker rmi -f ${imageName}" 
            sh "docker rmi -f ${harbor_url}/${harbor_project_name}/${imageName}"
            }
        }
    }
}
}</code></pre> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/6a/a9/PffUXieQ_o.png"></p> 
<p> </p> 
<p></p> 
<p>Eureka服务构建成功！！！</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/34/4f/VuZo2Bjz_o.png"></p> 
<p> </p> 
<p></p> 
<p>此时harbor仓库已经推送上去了</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/8a/ff/Zbcxhwbc_o.png"></p> 
<p> </p> 
<h2 id="%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%9A%84%E9%83%A8%E7%BD%B2">微服务的部署</h2> 
<p>安装<a href="https://plugins.jenkins.io/kubernetes-cd" rel="nofollow" title=" Kubernetes Continuous Deploy"> Kubernetes Continuous Deploy</a>插件</p> 
<h4 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0Jenkins%E8%AE%A4%E8%AF%81k8s%E5%87%AD%E8%AF%81">                Jenkins认证k8s凭证</h4> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/cf/2a/Vu6MGBKH_o.png"></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/a2/cb/DNUJktuX_o.png"> </p> 
<p>添加k8s凭证</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/14/25/5r89MaCG_o.png"></p> 
<p> </p> 
<p>点击确定，获取id号</p> 
<p>K8S 创建访问Harbor私服拉取镜像所需要密钥权限凭证，设置免交互</p> 
<pre><code>[root@master01 ~/.kube]# kubectl create secret docker-registry registry-auth-secret --docker-username=jack --docker-password=Abc12345 --docker-email=jack@123.com --docker-server=192.168.37.106:85</code></pre> 
<p style="text-align:center;"> <img alt="" src="https://images2.imgbox.com/ed/71/7nTLwJxk_o.png"></p> 
<p><strong> 在tensquare_eureka_server微服务项目根目录下创建 deploy.yml配置文件</strong></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/17/87/25gMRY6f_o.png"></p> 
<p> </p> 
<pre><code>---
apiVersion: v1
kind: Service
metadata:
  name: eureka
  labels:
    app: eureka
spec:
  type: NodePort
  ports:
    - port: 10086
      name: eureka
      targetPort: 10086
  selector:
    app: eureka
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: eureka
spec:
  serviceName: "eureka"
  replicas: 2
  selector:
    matchLabels:
      app: eureka
  template:
    metadata:
      labels:
        app: eureka
    spec:
      imagePullSecrets:
        - name: $SECRET_NAME    #通过变量引用K8S访问Harbor私服拉取镜像所需要的secret资源名称
      containers:
        - name: eureka
          image: $IMAGE_NAME
          ports:
            - containerPort: 10086
          env:
            - name: MY_POD_NAME    #MY_POD_NAME环境变量会从每个被创建的Pod的metadata.name字段获取变量值，如eureka-0、eureka-1
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
            - name: EUREKA_SERVER    #此环境变量会被项目代码中的application.yml文件引用
              value: "http://eureka-0.eureka:10086/eureka/,http://eureka-1.eureka:10086/eureka/"
            - name: EUREKA_INSTANCE_HOSTNAME    #此环境变量会项目代码中的application.yml文件引用
              value: ${MY_POD_NAME}.eureka
  podManagementPolicy: "Parallel"</code></pre> 
<p></p> 
<p><strong>修改tensquare_eureka_server微服务项目的 application.yml 文件</strong></p> 
<pre><code>tensquare_eureka_server\src\main\resources \application.yml

---
server:
  port: ${PORT:10086}
spring:
  application:
    name: eureka
​
eureka:
  server:
    #续期时间，即扫描失效服务的间隔时间（缺省为60*1000ms）
    eviction-interval-timer-in-ms: 5000
    enable-self-preservation: false
    use-read-only-response-cache: false
  client:
    #eureka client间隔多久去拉取服务注册信息 默认30s
    registry-fetch-interval-seconds: 5
    serviceUrl:
      defaultZone: ${EUREKA_SERVER:http://127.0.0.1:${server.port}/eureka/}    #引用deploy.yml配置中的环境变量EUREKA_SERVER
  instance:
    #心跳间隔时间，即发送一次心跳之后，多久在发起下一次（缺省为30s）
    lease-renewal-interval-in-seconds: 5
    #在收到一次心跳之后，等待下一次心跳的空档时间，大于心跳间隔即可，即服务续约到期时间（缺省为90s）
    lease-expiration-duration-in-seconds: 10
    instance-id: ${EUREKA_INSTANCE_HOSTNAME:${spring.application.name}}:${server.port}@${random.long(1000000,9999999)}
    hostname: ${EUREKA_INSTANCE_HOSTNAME:${spring.application.name}}</code></pre> 
<p>上传代码</p> 
<p>编写pipeline脚本</p> 
<pre><code>def git_url = "http://192.168.37.103:85/devops_group/tensquare_back.git"
def git_auth = "72a48f14-72c7-444f-a471-2d482e85d808"
//构建版本的名称
def tag = "latest"
//Harbor私服地址
def harbor_url = "192.168.37.106:85"
//Harbor的项目名称
def harbor_project_name = "tensquare"
//Harbor的凭证
def harbor_auth = "ea2f47a0-3f01-4149-a095-987675db7162"
//获取当前选择项目名称
def selectedProjectNames="${project_name}".split(",")
def secret_name = "registry-auth-secret"
def k8s_auth = "2e95a29c-79f1-41dd-be38-3f9691b25807"
​
podTemplate(label: 'jenkins-slave', cloud: 'kubernetes', containers: [ 
        containerTemplate(
            name: 'jnlp',
            image: "192.168.37.106:85/library/jenkins-slave-maven:latest"
        ),
        containerTemplate( 
            name: 'docker',
            image: "docker:stable",
            ttyEnabled: true,
            command: 'cat'
        ),
    ],
    volumes: [
        hostPathVolume(mountPath: '/var/run/docker.sock', hostPath: '/var/run/docker.sock'),
        nfsVolume(mountPath: '/usr/local/apache-maven/repo', serverAddress: '192.168.37.106' , serverPath: '/opt/nfs/maven'),
    ],
)
{
node("jenkins-slave") {
    // 第一步
    stage('pull code'){
        checkout([$class: 'GitSCM', branches: [[name: '*/master']], extensions: [], 
      userRemoteConfigs: [[credentialsId: "${git_auth}", url: "${git_url}"]]])
    }
    // 第二步
    stage('make public sub project'){
        //编译并安装公共工程
        sh "mvn -f tensquare_common clean install"
    }
    // 第三步
    stage('make image'){
        //把选择的项目信息转为数组
        def selectedProjects = "${project_name}".split(',')
​
​
        for(int i=0;i&lt;selectedProjects.size();i++){
            //取出每个项目的名称和端口
            def currentProject = selectedProjects[i];
            //项目名称
            def currentProjectName = currentProject.split('@')[0]
            //项目启动端口
            def currentProjectPort = currentProject.split('@')[1]
​
            //定义镜像名称
            def imageName = "${currentProjectName}:${tag}"
​
            //编译，构建本地镜像
            sh "mvn -f ${currentProjectName} clean package dockerfile:build"
            container('docker') {
​
                //给镜像打标签
                sh "docker tag ${imageName} ${harbor_url}/${harbor_project_name}/${imageName}"
​
                //登录Harbor，并上传镜像
                withCredentials([usernamePassword(credentialsId: "${harbor_auth}", passwordVariable: 'password', usernameVariable: 'username')])
                {
                    //登录
                    sh "docker login -u ${username} -p ${password} ${harbor_url}"
                    //上传镜像
                    sh "docker push ${harbor_url}/${harbor_project_name}/${imageName}"
                }
​
            //删除本地镜像
            sh "docker rmi -f ${imageName}" 
            sh "docker rmi -f ${harbor_url}/${harbor_project_name}/${imageName}"
            }
        }
    }
   
   stage('部署应用到K8S') {
         for(int i=0; i&lt;selectedProjectNames.length; i++) {
            def projectInfo=selectedProjectNames[i]
​
               //当前的项目名称
               def currentProjectName="${projectInfo}".split("@")[0]
​
               //当前的项目端口
               def currentProjectPort="${projectInfo}".split("@")[1]
            def imageName = "${currentProjectName}:${tag}"
            def harbor_imageName = "${harbor_url}/${harbor_project_name}/${imageName}"
            sh """
               sed -i 's#\$IMAGE_NAME#${harbor_imageName}#' ${currentProjectName}/deploy.yml
               sed -i 's#\$SECRET_NAME#${secret_name}#' ${currentProjectName}/deploy.yml
            """
            kubernetesDeploy configs: "${currentProjectName}/deploy.yml", kubeconfigId: "${k8s_auth}"
         }     
      }
   }
}</code></pre> 
<p>构建</p> 
<p>查看pod，svc资源</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/52/ac/0VLfU9MU_o.png"></p> 
<p> </p> 
<p></p> 
<p>浏览器访问</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/ea/03/cZoEXqKp_o.png"></p> 
<p> </p> 
<p></p> 
<h2 id="%E9%83%A8%E7%BD%B2%E5%85%B6%E4%BB%96%E5%BE%AE%E6%9C%8D%E5%8A%A1">部署其他微服务</h2> 
<p>更改配置文件中的eureka集群地址</p> 
<pre><code>tensquare_zuul\src\main\resources\application.yml

# Eureka注册配置信息
eureka:
  client:
    service-url:  
      defaultZone: http://eureka-0.eureka:10086/eureka/,http://eureka-1.eureka:10086/eureka/ #Eureka访问地址
  instance:
    prefer-ip-address: true</code></pre> 
<p>创建配置文件deploy.yml</p> 
<pre><code>---
apiVersion: v1
kind: Service
metadata:
  name: zuul
  labels:
    app: zuul
spec:
  type: NodePort
  ports:
    - port: 10020
      name: zuul
      targetPort: 10020
  selector:
    app: zuul
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: zuul
spec:
  serviceName: "zuul"
  replicas: 2
  selector:
    matchLabels:
      app: zuul
  template:
    metadata:
      labels:
        app: zuul
    spec:
      imagePullSecrets:
        - name: $SECRET_NAME    #通过变量引用K8S访问Harbor私服拉取镜像所需要的secret资源名称
      containers:
        - name: zuul
          image: $IMAGE_NAME
          ports:
            - containerPort: 10020
  podManagementPolicy: "Parallel"</code></pre> 
<h4 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%E6%89%8B%E5%8A%A8%E4%B8%8A%E4%BC%A0%E7%88%B6%E5%B7%A5%E7%A8%8B%E4%BE%9D%E8%B5%96%E5%88%B0NFS%E7%9A%84Maven%E5%85%B1%E4%BA%AB%E4%BB%93%E5%BA%93%E7%9B%AE%E5%BD%95%E4%B8%AD"><strong>                手动上传父工程依赖到NFS的Maven共享仓库目录中</strong></h4> 
<p style="text-align:center;"><strong><img alt="" src="https://images2.imgbox.com/b8/a3/mMQRELMn_o.png"></strong></p> 
<p> </p> 
<p></p> 
<p>开始构建</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/ae/92/sENCO7jr_o.png"></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/96/27/fRHyVlls_o.png">  </p> 
<p></p> 
<p></p> 
<p><strong>其他项目名字和端口进行修改即可</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cf6e3c8f577acfb052c9c663f62efd16/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">监督学习中判别式模型和生成式模型的区别 | 无监督学习的生成模型GAN、VAE（生成样本）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/267ad406e5991ecb3484e35357707516/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">linux安装zookeeper</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>