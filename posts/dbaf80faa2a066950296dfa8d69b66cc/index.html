<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>前端基于uniapp[uniPush]实现APP消息推送（安卓、IOS） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="前端基于uniapp[uniPush]实现APP消息推送（安卓、IOS）" />
<meta property="og:description" content="前提概述：此文章都是基于uniapp中uniPush2实现的在线、离线推送
app消息推送流程 登录开发者中心先填写好项目信息以及配置厂商在manifest.json文件中勾选推送模块打包自定义基座在前端项目中创建云函数（此云函数的作用是接受后台发送的消息模板，解析出来后，发送给到uniapp后台，以此触发消息推送功能）在app.vue文件中需要做三件事：
①获取客户端推送标识
②处理离线（推送点击）
③在线（接收消息、推送点击）真机测试 好了，以下会根据上面的五个流程给出的具体笔记。。。
坑点 在具体讲述之前，我觉得可以把坑点先记下来，方便大家避雷：
上传iOS证书提示“证书环境错误”的问题 需要上传的是推送证书，不是打包证书
配置完成后，运行到真机会出现&#34;打包时未添加push模块,请参考…“的情况 在manifest.json勾选了push模块之后，需要重新打包自定义基座
账号共同的问题 你在哪个开发者账号中配置的app,对应的你的HBuilder也要登录那个账号进行开发
小米真机测试，出现收不到消息的情况 需要配置推送时间
华为离线时，收不到消息推送，若厂商信息确认配置无误，那么检测以下两个地方 1、查看开发者中心 - uniPush - 应用信息，点击 [包名再“应用详情“中”各平台信息“管理，点击前往]，然后选择你的应用进行修改，一定要认真核对 Android 应用签名SHA256 是否填写正确
2、华为推送信息乱写的时候，是可能不被推送的，可以按照以下格式发送排查下：
title：订单提醒
body：您的外卖订单已接单，请耐心等候
官方排错文档 如果以上都不能帮助到你，那么再查看这两个文档进行排查：厂商限额和提醒方式说明、uni-push2.0 常见问题，如果都不行的话，只能添加unipush的客服咨询啦
具体处理笔记（从0到1） 1、在开发者中心填写项目信息以及配置厂商（见图） 2、在manifest.json文件中勾选推送模块 上传图片注意事项和格式，看文档
3、更新自定义基座 在 发行-&gt;原生APP-云打包，点击打自定义调试基座。这一步，务必保证你前面的配置都好了，尤其是oppo的。
4、在前端项目中创建云函数 消息推送属于敏感操作，只能直接或间接由服务端触发。传统的三方push服务，需要开发者在服务端配置密钥或证书，根据服务器端文档签名获取token，再向相关URL接口发起网络请求…而unipush仅是需要我们创建一个云函数作为一个中转站
点击项目，右键点击创建uniCloud云开发环境，然后选择阿里云或者腾讯云创建完成后，右键点击uniCloud选择关联空间再右键点击cloudfunctions,选择新建云函数，新建时可选择uni-cloud-push扩展库 具体里面的内容，我们处理的不需要很多，可以具体看文档，文档写的比较详细，一直往下滑，直接看第四步
5、在app.vue处理消息 注意：安卓和IOS在线推送的情况是，是不会弹出提示的，需要我们手动创建
直接贴代码啦，具体看注释
// #ifdef APP-PLUS // 客户端获取push客户端标记 uni.getPushClientId({ success: async (res) =&gt; { let push_clientid = res.cid //这个id是不会改变的，我们需要在登录必经过的页面或者方法拿到这个id传给后端存储起来 uni.setStorageSync(&#39;unipush_id&#39;, push_clientid) }, fail(err) { console.log(&#39;推送id获取失败:&#39;, err) }, }) //离线推送-点击信息 plus." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/dbaf80faa2a066950296dfa8d69b66cc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-06T15:32:42+08:00" />
<meta property="article:modified_time" content="2023-11-06T15:32:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">前端基于uniapp[uniPush]实现APP消息推送（安卓、IOS）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>前提概述：此文章都是基于uniapp中uniPush2实现的在线、离线推送</p> 
<h3><a id="app_1"></a>app消息推送流程</h3> 
<ol><li>登录<a href="https://dev.dcloud.net.cn/pages/common/login?uniIdRedirectUrl=%252Fpages%252Fapp%252Flist" rel="nofollow">开发者中心</a>先填写好项目信息以及配置厂商</li><li>在manifest.json文件中勾选推送模块</li><li>打包自定义基座</li><li>在前端项目中创建云函数（此云函数的作用是接受后台发送的消息模板，解析出来后，发送给到uniapp后台，以此触发消息推送功能）</li><li>在app.vue文件中需要做三件事：<br> ①获取客户端推送标识<br> ②处理离线（推送点击）<br> ③在线（接收消息、推送点击）</li><li>真机测试</li></ol> 
<p>好了，以下会根据上面的五个流程给出的具体笔记。。。</p> 
<h3><a id="_15"></a>坑点</h3> 
<p>在具体讲述之前，我觉得可以把坑点先记下来，方便大家避雷：</p> 
<ul><li>上传iOS证书提示“证书环境错误”的问题</li></ul> 
<blockquote> 
 <p>需要上传的是推送证书，不是打包证书</p> 
</blockquote> 
<ul><li>配置完成后，运行到真机会出现"打包时未添加push模块,请参考…“的情况</li></ul> 
<blockquote> 
 <p>在manifest.json勾选了push模块之后，需要重新打包自定义基座</p> 
</blockquote> 
<ul><li>账号共同的问题</li></ul> 
<blockquote> 
 <p>你在哪个开发者账号中配置的app,对应的你的HBuilder也要登录那个账号进行开发</p> 
</blockquote> 
<ul><li>小米真机测试，出现收不到消息的情况</li></ul> 
<blockquote> 
 <p>需要配置推送时间</p> 
</blockquote> 
<ul><li>华为离线时，收不到消息推送，若厂商信息确认配置无误，那么检测以下两个地方</li></ul> 
<blockquote> 
 <p>1、查看开发者中心 - uniPush - 应用信息，点击 [包名再“应用详情“中”各平台信息“管理，点击前往]，然后选择你的应用进行修改，一定要认真核对 Android 应用签名SHA256 是否填写正确<br> 2、华为推送信息乱写的时候，是可能不被推送的，可以按照以下格式发送排查下：<br> <strong>title：订单提醒<br> body：您的外卖订单已接单，请耐心等候</strong></p> 
</blockquote> 
<ul><li><strong>官方排错文档</strong></li></ul> 
<blockquote> 
 <p>如果以上都不能帮助到你，那么再查看这两个文档进行排查：<a href="https://docs.getui.com/getui/mobile/vendor/qps/" rel="nofollow">厂商限额和提醒方式说明</a>、<a href="https://ask.dcloud.net.cn/article/40291" rel="nofollow">uni-push2.0 常见问题</a>，如果都不行的话，只能添加unipush的客服咨询啦</p> 
</blockquote> 
<h3><a id="01_45"></a>具体处理笔记（从0到1）</h3> 
<h4><a id="1_46"></a>1、在开发者中心填写项目信息以及配置厂商（见图）</h4> 
<p><img src="https://images2.imgbox.com/60/d4/KVYdD2hk_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/4e/5b/tPvIUNly_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2manifestjson_50"></a>2、在manifest.json文件中勾选推送模块</h4> 
<p><img src="https://images2.imgbox.com/fb/62/E2muB263_o.png" alt="在这里插入图片描述"><br> 上传图片注意事项和格式，看<a href="https://www.cnblogs.com/huihuihero/p/13711909.html" rel="nofollow">文档</a></p> 
<h4><a id="3_54"></a>3、更新自定义基座</h4> 
<p>在 发行-&gt;原生APP-云打包，点击打自定义调试基座。这一步，务必保证你前面的配置都好了，尤其是oppo的。</p> 
<h4><a id="4_57"></a>4、在前端项目中创建云函数</h4> 
<p>消息推送属于敏感操作，只能直接或间接由服务端触发。传统的三方push服务，需要开发者在服务端配置密钥或证书，根据服务器端文档签名获取token，再向相关URL接口发起网络请求…而unipush仅是需要我们创建一个云函数作为一个中转站</p> 
<ul><li>点击项目，右键点击创建uniCloud云开发环境，然后选择阿里云或者腾讯云</li><li>创建完成后，右键点击uniCloud选择关联空间</li><li>再右键点击cloudfunctions,选择新建云函数，新建时可选择uni-cloud-push扩展库</li></ul> 
<p>具体里面的内容，我们处理的不需要很多，可以具体看文档，<a href="https://uniapp.dcloud.net.cn/unipush-v2.html" rel="nofollow">文档</a>写的比较详细，一直往下滑，直接看第四步</p> 
<h4><a id="5appvue_66"></a>5、在app.vue处理消息</h4> 
<blockquote> 
 <p>注意：安卓和IOS在线推送的情况是，是不会弹出提示的，需要我们手动创建</p> 
</blockquote> 
<p>直接贴代码啦，具体看注释</p> 
<pre><code class="prism language-javascript"><span class="token comment">// #ifdef APP-PLUS</span>
  <span class="token comment">// 客户端获取push客户端标记</span>
  uni<span class="token punctuation">.</span><span class="token function">getPushClientId</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">let</span> push_clientid <span class="token operator">=</span> res<span class="token punctuation">.</span>cid
      <span class="token comment">//这个id是不会改变的，我们需要在登录必经过的页面或者方法拿到这个id传给后端存储起来</span>
      uni<span class="token punctuation">.</span><span class="token function">setStorageSync</span><span class="token punctuation">(</span><span class="token string">'unipush_id'</span><span class="token punctuation">,</span> push_clientid<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">fail</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'推送id获取失败:'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  
  <span class="token comment">//离线推送-点击信息</span>
  plus<span class="token punctuation">.</span>push<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
    <span class="token string">'click'</span><span class="token punctuation">,</span>
    <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>msg<span class="token punctuation">.</span>payload<span class="token punctuation">[</span><span class="token string">'path'</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
      plus<span class="token punctuation">.</span>push<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token boolean">false</span>
  <span class="token punctuation">)</span>
  <span class="token comment">// 在线推送-接收信息</span>
  plus<span class="token punctuation">.</span>push<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
    <span class="token string">'receive'</span><span class="token punctuation">,</span>
    <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">msg</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//ios平台需要多一层判断，且拿取方式不同</span>
      <span class="token keyword">var</span> platform <span class="token operator">=</span> uni<span class="token punctuation">.</span><span class="token function">getSystemInfoSync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>platform
      <span class="token keyword">if</span> <span class="token punctuation">(</span>platform <span class="token operator">==</span> <span class="token string">'ios'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">'receive'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token comment">// 这里判断触发的来源，否则一直推送。</span>
          <span class="token keyword">let</span> options <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">cover</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> msg<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>title <span class="token punctuation">}</span>
          plus<span class="token punctuation">.</span>push<span class="token punctuation">.</span><span class="token function">createMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>content<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>path<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>platform <span class="token operator">==</span> <span class="token string">'android'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">let</span> option <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">cover</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token literal-property property">title</span><span class="token operator">:</span> msg<span class="token punctuation">.</span>title <span class="token punctuation">}</span>
        plus<span class="token punctuation">.</span>push<span class="token punctuation">.</span><span class="token function">createMessage</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>content<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>payload<span class="token punctuation">.</span>path<span class="token punctuation">,</span> option<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token boolean">false</span>
  <span class="token punctuation">)</span>

  <span class="token comment">// 在线推送-点击信息</span>
  uni<span class="token punctuation">.</span><span class="token function">onPushMessage</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">let</span> data <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>payload
    <span class="token keyword">if</span> <span class="token punctuation">(</span>res<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'click'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        uni<span class="token punctuation">.</span><span class="token function">navigateTo</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
      plus<span class="token punctuation">.</span>push<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      plus<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span><span class="token function">setBadgeNumber</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//清除图标右上角数字</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// #endif</span>
</code></pre> 
<h4><a id="6_133"></a>6、真机测试</h4> 
<p>有两种测试方法：</p> 
<ol><li>后端在apipost中弄一个接口，点击发送</li><li>在开发者平台-&gt;unipush-&gt;消息推广-&gt;创建推送-&gt;透传消息<br> 注意：<br> 1、测试小米手机一定要填写定时推送<br> 2、Android配置里面，initende的填写方式是（以下全部复制哦，然后再根据提示修改）：</li></ol> 
<blockquote> 
 <p>intent:#Intent;action=android.intent.action.oppopush;launchFlags=0x14000000;component=安卓包名/io.dcloud.PandoraEntry;S.UP-OL-SU=true;S.title=测试标题;S.content=测试内容;S.payload=test;end</p> 
</blockquote> 
<p>帮到你的话，就点个赞再走吧~</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b1d35dfd99d6680eb7313b9e1e044f6a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">socket编程中的EINTR是什么?</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1acb210b7c8ebaf4920a324292df4894/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">VMware安装Ubuntu22.04教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>