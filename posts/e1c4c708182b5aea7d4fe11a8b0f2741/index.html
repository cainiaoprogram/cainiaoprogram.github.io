<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>详解springboot整合redis - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="详解springboot整合redis" />
<meta property="og:description" content="redis相信大家不会陌生，可以说是日常开发中用的最广泛的缓存工具，而springboot作为与Java的集成框架，适用面非常广泛，其中就包含了对redis的集成，网上针对此类文章个人搜索后感觉大多写的不够详细，所以小编决定自己写一篇，一来供自己学习，二来供读者探讨
目录
相关配置文件
redis配置类
测试Case
测试结果
导入依赖
&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt; &lt;/dependency&gt; 说明：这里用的springboot版本较新，3.0.6
相关配置文件 # Redis本地服务器地址，注意要开启redis服务，即 redis-server.exe spring.data.redis.host=localhost # Redis服务器端口,默认为6379.若有改动按改动后的来 spring.data.redis.port=6379 # Redis服务器连接密码，默认为空，若有设置按设置的来 spring.redis.password= # redis客户端类型，springboot支持jedis和lettuce两种客户端，仅引入spring-boot-starter-data-redis依赖时，默认客户端类型为lettuce，可无需配置 spring.data.redis.client-type=lettuce # spring cache 缓存前缀配置，注意该前缀并不会在redisTemplate操作缓存时加入，而是redisCache操作缓存时生效的 spring.cache.redis.key-prefix=yqw_redis_ # 开启spring cache 默认前缀 spring.cache.redis.use-key-prefix=true redis配置类 @Configuration public class RedisConfig { @Bean public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory redisConnectionFactory) { RedisTemplate&lt;String, Object&gt; redisTemplate = new RedisTemplate&lt;&gt;(); redisTemplate.setConnectionFactory(redisConnectionFactory); redisTemplate.setKeySerializer(RedisSerializer.string()); redisTemplate.setValueSerializer(RedisSerializer.json()); redisTemplate.setDefaultSerializer(RedisSerializer.json()); return redisTemplate; } @Bean public RedisCacheManager redisCacheManager(RedisConnectionFactory redisConnectionFactory, CacheProperties cacheProperties) { RedisCacheConfiguration config = RedisCacheConfiguration." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/e1c4c708182b5aea7d4fe11a8b0f2741/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-05T16:25:24+08:00" />
<meta property="article:modified_time" content="2023-05-05T16:25:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">详解springboot整合redis</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p>        redis相信大家不会陌生，可以说是日常开发中用的最广泛的缓存工具，而springboot作为与Java的集成框架，适用面非常广泛，其中就包含了对redis的集成，网上针对此类文章个人搜索后感觉大多写的不够详细，所以小编决定自己写一篇，一来供自己学习，二来供读者探讨</p> 
</blockquote> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" rel="nofollow">相关配置文件</a></p> 
<p id="redis%E9%85%8D%E7%BD%AE%E7%B1%BB-toc" style="margin-left:80px;"><a href="#redis%E9%85%8D%E7%BD%AE%E7%B1%BB" rel="nofollow">redis配置类</a></p> 
<p id="%E6%B5%8B%E8%AF%95Case-toc" style="margin-left:80px;"><a href="#%E6%B5%8B%E8%AF%95Case" rel="nofollow">测试Case</a></p> 
<p id="%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C-toc" style="margin-left:80px;"><a href="#%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C" rel="nofollow">测试结果</a></p> 
<p></p> 
<p> 导入依赖</p> 
<pre><code class="language-XML">        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;
        &lt;/dependency&gt;</code></pre> 
<blockquote> 
 <p> 说明：这里用的springboot版本较新，3.0.6</p> 
</blockquote> 
<h4 id="%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">相关配置文件</h4> 
<pre><code class="language-Matlab"># Redis本地服务器地址，注意要开启redis服务，即 redis-server.exe
spring.data.redis.host=localhost
# Redis服务器端口,默认为6379.若有改动按改动后的来
spring.data.redis.port=6379
# Redis服务器连接密码，默认为空，若有设置按设置的来
spring.redis.password=
# redis客户端类型，springboot支持jedis和lettuce两种客户端，仅引入spring-boot-starter-data-redis依赖时，默认客户端类型为lettuce，可无需配置
spring.data.redis.client-type=lettuce
# spring cache 缓存前缀配置，注意该前缀并不会在redisTemplate操作缓存时加入，而是redisCache操作缓存时生效的
spring.cache.redis.key-prefix=yqw_redis_
# 开启spring cache 默认前缀
spring.cache.redis.use-key-prefix=true</code></pre> 
<h4 id="redis%E9%85%8D%E7%BD%AE%E7%B1%BB">redis配置类</h4> 
<pre><code class="language-java">@Configuration
public class RedisConfig {

    @Bean
    public RedisTemplate&lt;String, Object&gt; redisTemplate(RedisConnectionFactory redisConnectionFactory) {
        RedisTemplate&lt;String, Object&gt; redisTemplate = new RedisTemplate&lt;&gt;();
        redisTemplate.setConnectionFactory(redisConnectionFactory);
        redisTemplate.setKeySerializer(RedisSerializer.string());
        redisTemplate.setValueSerializer(RedisSerializer.json());
        redisTemplate.setDefaultSerializer(RedisSerializer.json());
        return redisTemplate;
    }

    @Bean
    public RedisCacheManager redisCacheManager(RedisConnectionFactory redisConnectionFactory, CacheProperties cacheProperties) {
        RedisCacheConfiguration config = RedisCacheConfiguration.defaultCacheConfig()
                // 设置缓存有效期为1天
                .entryTtl(Duration.ofDays(1))
                // 设置键序列化方式
                .serializeKeysWith(RedisSerializationContext.SerializationPair.fromSerializer(RedisSerializer.string()))
                // 设置值序列化方式
                .serializeValuesWith(RedisSerializationContext.SerializationPair.fromSerializer(RedisSerializer.json()))
                // 不处理空数据
                .disableCachingNullValues();
        CacheProperties.Redis redisProperties = cacheProperties.getRedis();
        // 设置cache前缀
        if (redisProperties.getKeyPrefix() != null) {
            config = config.prefixCacheNameWith(redisProperties.getKeyPrefix());
        }
        RedisCacheManager.RedisCacheManagerBuilder builder = RedisCacheManager.builder(redisConnectionFactory)
                .cacheDefaults(config);
        return builder.build();
    }
}</code></pre> 
<blockquote> 
 <p>1. 本配置类，针对redis的序列化，关于key的序列化为String的默认序列化方式，关于value的序列化为json序列化方式，借助到了 GenericJackson2JsonRedisSerializer 类</p> 
 <p>2. 针对redisTemplate实例，RedisAutoConfiguration类中已经帮我们注入了 RedisTemplate&lt;Object, Object&gt; 和 RedisTemplate&lt;String, String&gt; 其中关于object的默认序列化方式为 jdk序列，性能相对较差且jdk序列化扩展性也不强，所以自定义RedisTemplate&lt;String, Object&gt;序列化方式，关于object采用json序列化</p> 
 <p>3. 关于RedisCacheManager 的配置办法，大家也可以参考RedisCacheConfiguration 配置类，很多配置的写法我们要学会参考源码的配置办法</p> 
 <p>4. RedisCacheManager负责生成和管理redisCache，从配置类中可以看到，RedisCacheManager其实是和redisTemplate公用一套redis连接的，redisCache本质上也是redis，但和redisTemplate的适用面又不太相同，个人理解redisCache主要与org.springframework.cache.annotation 包下的类如 @Cacheable 等注解结合使用，下面会有测试示例</p> 
</blockquote> 
<h4 id="%E6%B5%8B%E8%AF%95Case">测试Case</h4> 
<pre><code class="language-java">@RestController
public class RedisController {

    @Autowired
    private StringRedisTemplate stringRedisTemplate;

    @Autowired
    private RedisCacheManager redisCacheManager;

    @Autowired
    private CacheService cacheService;

    @Autowired
    private RedisTemplate&lt;String, Object&gt; redisTemplate;

    @GetMapping("/redis/put")
    public String put(String key, String value) {
        stringRedisTemplate.opsForValue().set(key, value);
        return "success!";
    }

    @GetMapping("/redis/putObj")
    public String putObj(String key) {
        redisTemplate.opsForValue().set(key, TestEntity.returnTestObj());
        return "success";
    }

    @GetMapping("/redis/getObj")
    public String getObj(String key) {
        Object o = redisTemplate.opsForValue().get(key);
        return JSON.toJSONString(o);
    }

    @GetMapping("/cache/put")
    public String cachePut(String key) {
        Cache testCache = redisCacheManager.getCache("testCache");
        testCache.put(key, TestEntity.returnTestObj());
        return "success!";
    }

    @GetMapping("/cache/get")
    public String cacheGet(String key) {
        TestEntity testEntity = cacheService.cacheGet(key);
        return JSON.toJSONString(testEntity);
    }

}


@Service
public class CacheService {

    /**
     * testCache为cacheName，会有具体的redisCache与其以Map结构来一一对应，不同redisCache均由redisCacheManager生成
     * @param key
     * @return
     */
    @Cacheable(value = "testCache", cacheManager = "redisCacheManager", key = "#key")
    public TestEntity cacheGet(String key) {
        return new TestEntity("缓存", "找不到");
    }
}

public class TestEntity implements Serializable {

    @Serial
    private static final long serialVersionUID = -4058390548264688398L;
    
    private String fieldOne;

    private String fieldTwo;

    private String enumField;

    private static String staticField = "yangqingwei";

    public TestEntity(String fieldOne, String fieldTwo) {
        this.fieldOne = fieldOne;
        this.fieldTwo = fieldTwo;
    }

    public TestEntity() {}
    
    public static TestEntity returnTestObj() {
        return new TestEntity("one", "two");
    }
}</code></pre> 
<h4 id="%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C">测试结果</h4> 
<p>1. 请求 localhost:9090/redis/putObj?key=yuan 会将默认的 TestEntity 测试对象json序列化后放入redis中</p> 
<p><img alt="" height="174" src="https://images2.imgbox.com/17/0f/mBxG6mlT_o.png" width="484"></p> 
<p>2.  请求 http://localhost:9090/cache/put?key=yang</p> 
<p><img alt="" height="171" src="https://images2.imgbox.com/83/95/oGI2FTut_o.png" width="445"></p> 
<blockquote> 
 <p>TTL为过期时间，对应RedisCacheManager配置的缓存有效期，秒级别展示</p> 
 <p>key为我们设置的yqw_redis_前缀加使用的redisCache name 后跟 :: 和实际的存储的key，key的模板可参考 CacheKeyPrefix </p> 
</blockquote> 
<p>3. 请求 <a href="http://localhost:9090/cache/get?key=yang" rel="nofollow" title="http://localhost:9090/cache/get?key=yang">http://localhost:9090/cache/get?key=yang</a></p> 
<p><img alt="" height="74" src="https://images2.imgbox.com/27/6e/5eKpT8eA_o.png" width="443"></p> 
<blockquote> 
 <p>        好啦，本章就先写到这里，个人觉得本篇文章是网上关于此块儿写的较为详细的文章，关于springboot整合redis各位读者有什么不同想法和对于本文有任何不清楚的地方欢迎留言指出，我们一起探索提高，最后，码字不易，觉得小编写的还行对你确实有帮助的，不要吝啬您的赞赞哦，感谢！ </p> 
</blockquote> 
<blockquote> 
 <p> <a class="link-info" href="http://www.manongjc.com/detail/23-zdjlgtlmuhnybxg.html" rel="nofollow" title="参考文章">参考文章</a></p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c05850d89dca579c3eb5337f3ac3c587/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Window下的反弹shell</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/53447dd08277616a5d639e197b8857ac/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Pytorch-GPU安装(选择正确的CUDA版本）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>