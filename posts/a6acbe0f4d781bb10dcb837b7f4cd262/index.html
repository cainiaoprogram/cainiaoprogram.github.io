<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>机器学习--朴素贝叶斯分类器（python手动实现） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="机器学习--朴素贝叶斯分类器（python手动实现）" />
<meta property="og:description" content="机器学习-朴素贝叶斯分类器 简介名词介绍公式概率分布数据集及代码实现代码实现定义容器对象循环提取十个桶文件中的数据，分门别类存储计算先验概率，条件概率预测分类测试集验证预测测试十折交叉验证 代码汇总 总结 简介 朴素贝叶斯（Naive Bayes）是基于贝叶斯定理和概率论预测样本类别的概率算法，而朴素一词的来源就是假设各特征之间相互独立。朴素贝叶斯属于监督学习的生成模型，实现简单，没有迭代，并有坚实的数学理论（即贝叶斯定理）作为支撑。在大量样本下会有较好的表现，不适用于输入向量的特征条件有关联的场景。
关于贝叶斯定理的详细介绍
名词介绍 拿西瓜是否成熟举例，假设判断西瓜成熟的特征有：瓜蒂是否脱落，敲打的声音-浊响|清脆
先验概率：
先验概率是根据以往经验和分析得到的概率，先验概率无需样本数据，不受任何条件的影响。比如有1000个西瓜，其中熟瓜600，涩瓜400，则先验概率p（熟瓜）=0.6，p（涩瓜）=0.4，并不受瓜蒂和敲打声音的影响。再比如硬币正反面概率各为0.5也是先验概率。后验（条件）概率：
已知结果或者某一条件（结果也是一种条件），求知条件或者结果的概率。比如已知某西瓜瓜蒂脱落，判断瓜成熟的概率，即p(成熟|瓜蒂脱落)。拉普拉斯平滑（Laplace smoothing）：
它的思想非常简单，就是对先验概率的分子（划分的计数）加1，分母加上类别数；对条件概率分子加1，分母加上对应特征的可能取值数量。这样在解决零概率问题的同时，也保证了概率和依然为1。
直接的作用就是防止模型“过拟合”，提高了模型的泛化性能。
也是解决样本为0的时概率为0的问题，因为若p(B)为0，则P(B|A)也为0，而实际并非如此。概率密度函数：
用于描述连续型随机变量所服从的概率分布，由此判断不可列的连续型随机变量的概率。 公式 贝叶斯公式：
朴素贝叶斯基本公式：
即P(B|A) = P(A|B)P(B)
概率密度函数：
正态分布：
概率分布 高斯分布型：
正态曲线呈钟型，两头低，中间高，左右对称因其曲线呈钟形，因此人们又经常称之为钟形曲线多项式型：
用于离散值模型里。比如文本分类问题里面我们提到过，我们不光看词语是否在文本中出现，也得看出现次数。如果总词数为n，出现词数为m的话，有点像掷骰子n次出现m次这个词的场景。伯努利型：
亦称“零一分布”、“两点分布”：一个事情有两种可能的结果，其中结果为1的发生概率为a,结果2发生的概率为1-a 数据集及代码实现 数据集是使用了分层抽样的十折交叉验证的，所以分为了十个名字相似的各类样本相近的数据集桶文件，如下：
该数据集为国会投票的样本：
分析数据集：
democrat为民主党，republican为共和党，即标签，表示类别
此后y和n表示特征，共16个特征，每个特征两个类别
代码实现 定义容器对象 存储从数据集中提取的数据，存储对数据统计分析的结果
数据分为三类：标签类别（democrat/republican），字符型特征（y/n），数值型（即连续型，该数据集没有此类型）
&#39;&#39;&#39; params: bucketPrefix： 桶文件名的前缀 testBucketNumber：测试数据所在的桶的编号 dataFormat: 数据文件格式列表 &#39;&#39;&#39; total=0 #记录总数据量 classes={} #存类别出现的次数 counts={} #每个类别对应的属性值出现的次数 self.format = dataFormat.strip().split(&#39;\t&#39;) # 切分每一列的数据类型 &#39;&#39;&#39; 存储数值型数据信息 &#39;&#39;&#39; totals={} # 每种类别对应的值的总和 numericValues={} #存每种类别对应的列的取值 &#39;&#39;&#39; 存储计算出的概率 &#39;&#39;&#39; self." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a6acbe0f4d781bb10dcb837b7f4cd262/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-03-25T19:57:44+08:00" />
<meta property="article:modified_time" content="2019-03-25T19:57:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">机器学习--朴素贝叶斯分类器（python手动实现）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>机器学习-朴素贝叶斯分类器</h4> 
 <ul><li><a href="#_2" rel="nofollow">简介</a></li><li><a href="#_6" rel="nofollow">名词介绍</a></li><li><a href="#_18" rel="nofollow">公式</a></li><li><a href="#_30" rel="nofollow">概率分布</a></li><li><a href="#_37" rel="nofollow">数据集及代码实现</a></li><li><ul><li><a href="#_45" rel="nofollow">代码实现</a></li><li><ul><li><a href="#_46" rel="nofollow">定义容器对象</a></li><li><a href="#_77" rel="nofollow">循环提取十个桶文件中的数据，分门别类存储</a></li><li><a href="#_155" rel="nofollow">计算先验概率，条件概率</a></li><li><a href="#_201" rel="nofollow">预测分类</a></li><li><a href="#_239" rel="nofollow">测试集验证</a></li><li><a href="#_276" rel="nofollow">预测测试</a></li><li><a href="#_290" rel="nofollow">十折交叉验证</a></li></ul> 
   </li><li><a href="#_384" rel="nofollow">代码汇总</a></li></ul> 
  </li><li><a href="#_651" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>简介</h2> 
<p>朴素贝叶斯（Naive Bayes）是基于贝叶斯定理和概率论预测样本类别的概率算法，而朴素一词的来源就是假设各特征之间相互独立。朴素贝叶斯属于监督学习的生成模型，实现简单，没有迭代，并有坚实的数学理论（即贝叶斯定理）作为支撑。在大量样本下会有较好的表现，不适用于输入向量的特征条件有关联的场景。<br> 关于贝叶斯定理的<a href="https://blog.csdn.net/sdutacm/article/details/50938957">详细介绍</a></p> 
<h2><a id="_6"></a>名词介绍</h2> 
<p>拿西瓜是否成熟举例，假设判断西瓜成熟的特征有：瓜蒂是否脱落，敲打的声音-浊响|清脆</p> 
<ul><li>先验概率：<br> 先验概率是根据以往经验和分析得到的概率，先验概率无需样本数据，不受任何条件的影响。比如有1000个西瓜，其中熟瓜600，涩瓜400，则先验概率p（熟瓜）=0.6，p（涩瓜）=0.4，并不受瓜蒂和敲打声音的影响。再比如硬币正反面概率各为0.5也是先验概率。</li><li>后验（条件）概率：<br> 已知结果或者某一条件（结果也是一种条件），求知条件或者结果的概率。比如已知某西瓜瓜蒂脱落，判断瓜成熟的概率，即p(成熟|瓜蒂脱落)。</li><li>拉普拉斯平滑（Laplace smoothing）：<br> 它的思想非常简单，就是对先验概率的分子（划分的计数）加1，分母加上类别数；对条件概率分子加1，分母加上对应特征的可能取值数量。这样在解决零概率问题的同时，也保证了概率和依然为1。<br> 直接的作用就是防止模型“过拟合”，提高了模型的泛化性能。<br> 也是解决样本为0的时概率为0的问题，因为若p(B)为0，则P(B|A)也为0，而实际并非如此。</li><li>概率密度函数：<br> 用于描述连续型随机变量所服从的概率分布，由此判断不可列的连续型随机变量的概率。</li></ul> 
<h2><a id="_18"></a>公式</h2> 
<ul><li> <p>贝叶斯公式：<br> <img src="https://images2.imgbox.com/1f/a4/5I8j64Gy_o.png" alt="在这里插入图片描述"></p> </li><li> <p>朴素贝叶斯基本公式：<img src="https://images2.imgbox.com/ac/b3/b5cE0jCR_o.png" alt="在这里插入图片描述"><br> 即P(B|A) = P(A|B)P(B)</p> </li><li> <p>概率密度函数：<br> <img src="https://images2.imgbox.com/4b/5e/Ypsb8ZwM_o.png" alt="在这里插入图片描述"></p> </li><li> <p>正态分布：<br> <img src="https://images2.imgbox.com/9a/08/hbCenySj_o.png" alt="在这里插入图片描述"></p> </li></ul> 
<h2><a id="_30"></a>概率分布</h2> 
<ul><li>高斯分布型：<br> 正态曲线呈钟型，两头低，中间高，左右对称因其曲线呈钟形，因此人们又经常称之为钟形曲线</li><li>多项式型：<br> 用于离散值模型里。比如文本分类问题里面我们提到过，我们不光看词语是否在文本中出现，也得看出现次数。如果总词数为n，出现词数为m的话，有点像掷骰子n次出现m次这个词的场景。</li><li>伯努利型：<br> 亦称“零一分布”、“两点分布”：一个事情有两种可能的结果，其中结果为1的发生概率为a,结果2发生的概率为1-a</li></ul> 
<h2><a id="_37"></a>数据集及代码实现</h2> 
<p>数据集是使用了分层抽样的十折交叉验证的，所以分为了十个名字相似的各类样本相近的数据集桶文件，如下：<br> 该数据集为国会投票的样本：<br> <img src="https://images2.imgbox.com/fc/79/7SsXPVR1_o.png" alt="在这里插入图片描述"><br> 分析数据集：<br> democrat为民主党，republican为共和党，即标签，表示类别<br> 此后y和n表示特征，共16个特征，每个特征两个类别<br> <img src="https://images2.imgbox.com/8e/9b/GNlMa08c_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_45"></a>代码实现</h3> 
<h4><a id="_46"></a>定义容器对象</h4> 
<p>存储从数据集中提取的数据，存储对数据统计分析的结果<br> 数据分为三类：标签类别（democrat/republican），字符型特征（y/n），数值型（即连续型，该数据集没有此类型）</p> 
<pre><code class="prism language-python">        <span class="token triple-quoted-string string">'''
        params:
            bucketPrefix： 桶文件名的前缀
            testBucketNumber：测试数据所在的桶的编号
            dataFormat: 数据文件格式列表
        
        '''</span>
        total<span class="token operator">=</span><span class="token number">0</span>    <span class="token comment">#记录总数据量</span>
        classes<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token comment">#存类别出现的次数</span>
        counts<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token comment">#每个类别对应的属性值出现的次数</span>
        self<span class="token punctuation">.</span><span class="token builtin">format</span> <span class="token operator">=</span> dataFormat<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">)</span> <span class="token comment"># 切分每一列的数据类型</span>
        
        <span class="token triple-quoted-string string">'''
        存储数值型数据信息
        '''</span>
        totals<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token comment"># 每种类别对应的值的总和</span>
        numericValues<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token comment">#存每种类别对应的列的取值  </span>
        
        <span class="token triple-quoted-string string">'''
        存储计算出的概率
        '''</span>
        self<span class="token punctuation">.</span>prior<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token comment">#先验概率</span>
        self<span class="token punctuation">.</span>condition<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token comment">#条件概率</span>
</code></pre> 
<h4><a id="_77"></a>循环提取十个桶文件中的数据，分门别类存储</h4> 
<p>十个桶文件中根据传入的参数指定一个为测试数据集，其他九个都为训练数据集</p> 
<pre><code class="prism language-python">        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#循环10次</span>
            <span class="token keyword">if</span> i<span class="token operator">!=</span>testBucketNumber<span class="token punctuation">:</span> <span class="token comment">#判断是否为测试集</span>
                filename<span class="token operator">=</span><span class="token string">'%s-%02i'</span><span class="token operator">%</span><span class="token punctuation">(</span>bucketPrefix<span class="token punctuation">,</span>i<span class="token punctuation">)</span>
                f<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span>
                lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
                f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
                    
                    total<span class="token operator">=</span>total<span class="token operator">+</span><span class="token number">1</span> <span class="token comment">#统计总数</span>
                    fields <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">)</span> <span class="token comment">#分割文件的每列 </span>
                    vector <span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">#存储字符型特征</span>
                    <span class="token triple-quoted-string string">'''
                    保存每一条数据的数值型数据
                    '''</span>
                    nums<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
                    <span class="token comment">#分门别类存储标签和不同类型的特征</span>
                    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>fields<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">if</span> self<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'attr'</span><span class="token punctuation">:</span>
                            vector<span class="token punctuation">.</span>append<span class="token punctuation">(</span>fields<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                        <span class="token keyword">elif</span> self<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'class'</span><span class="token punctuation">:</span>
                            category<span class="token operator">=</span>fields<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                        <span class="token keyword">elif</span> self<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'num'</span><span class="token punctuation">:</span>
                            nums<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            
                    <span class="token comment">#记录每个列别出现的次数</span>
                    classes<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>category<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
                    counts<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>category<span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                    classes<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token operator">+=</span><span class="token number">1</span>
                    
                    <span class="token triple-quoted-string string">'''
                    记录每个数值型数据
                    '''</span>
                    totals<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>category<span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                    numericValues<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>category<span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                    
                    <span class="token comment">#循环处理么每条记录出现的属性值</span>
                    <span class="token comment">#循环vector 取出每列值</span>
                    col<span class="token operator">=</span><span class="token number">0</span>
                    <span class="token keyword">for</span> columnValue <span class="token keyword">in</span> vector<span class="token punctuation">:</span>
                        col<span class="token operator">+=</span><span class="token number">1</span>
                        counts<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>col<span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                        counts<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>columnValue<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
                        counts<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">[</span>columnValue<span class="token punctuation">]</span><span class="token operator">+=</span><span class="token number">1</span>
                    <span class="token triple-quoted-string string">'''
                    counts形成的结构为：
                    {
                    'democrat': 
                        {
                            1: {'y': 64, 'n': 48}, 
                            2: {'n': 64, 'y': 48},
                            ...
                            16: {'y': 105, 'n': 7}
                        },
                   'republican': 
                       {
                           1: {'y': 22, 'n': 76},
                           2: {'y': 46, 'n': 52},
                           ...
                           16: {'n': 30, 'y': 68}
                        }
                    }
                    '''</span>
                    
                    <span class="token triple-quoted-string string">'''
                    保存每个数值型数据与类别的对应字典
                    '''</span>
                    col<span class="token operator">=</span><span class="token number">0</span>
                    <span class="token keyword">for</span> columnValue <span class="token keyword">in</span> nums<span class="token punctuation">:</span>
                        col<span class="token operator">+=</span><span class="token number">1</span>
                        totals<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>col<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
                        totals<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token operator">+=</span>columnValue
                        numericValues<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>col<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        numericValues<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>columnValue<span class="token punctuation">)</span>
                        
</code></pre> 
<h4><a id="_155"></a>计算先验概率，条件概率</h4> 
<p><strong>多项式类型</strong>数据的概率，利用贝叶斯公式（引入拉普拉斯平滑）计算<strong>先验概率</strong>，再<strong>计算条件概率</strong></p> 
<pre><code class="prism language-python"><span class="token comment">#开始计算概率</span>
		<span class="token comment"># classes：  {'democrat': 112, 'republican': 98}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>category<span class="token punctuation">,</span> count<span class="token punctuation">)</span> <span class="token keyword">in</span> classes<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>prior<span class="token punctuation">[</span>category<span class="token punctuation">]</span> <span class="token operator">=</span> count<span class="token operator">/</span>total
            
        <span class="token comment">#条件概率： 注意：columns是一个字典</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>category<span class="token punctuation">,</span> columns<span class="token punctuation">)</span> <span class="token keyword">in</span> counts<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>condition<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>category<span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            
            <span class="token keyword">for</span> <span class="token punctuation">(</span>col<span class="token punctuation">,</span>valueCount<span class="token punctuation">)</span> <span class="token keyword">in</span> columns<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>condition<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>col<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                
                <span class="token comment"># 此处引入拉普拉斯平滑处理已存在值</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span>attrValue<span class="token punctuation">,</span> count<span class="token punctuation">)</span> <span class="token keyword">in</span> valueCount<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token comment"># 此处先计算所有在样本中已存在值的条件概率 ( nc+(mp))/(N+m)</span>
                    m<span class="token operator">=</span><span class="token builtin">len</span><span class="token punctuation">(</span>counts<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>condition<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">[</span>attrValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>count<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>classes<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token operator">+</span>m<span class="token punctuation">)</span>
                    
        <span class="token comment"># 设置为类成员，方便在创建类对象后查看</span>
        self<span class="token punctuation">.</span>counts<span class="token operator">=</span>counts
        self<span class="token punctuation">.</span>classes<span class="token operator">=</span>classes
</code></pre> 
<p>处理连续型数值型数据的概率，因为连续型数据的分布不如多项式型数据直观，引入概率密度函数使得我们能直观的从数据上比较观察,这里先计算概率密度函数所需的<strong>均值</strong>和<strong>样本标准差</strong></p> 
<pre><code class="prism language-python">		self<span class="token punctuation">.</span>means<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        self<span class="token punctuation">.</span>totals<span class="token operator">=</span>totals
        <span class="token comment">#先计算均值</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>category<span class="token punctuation">,</span> columns<span class="token punctuation">)</span> <span class="token keyword">in</span> totals<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>means<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>category<span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>col<span class="token punctuation">,</span>colTotal<span class="token punctuation">)</span> <span class="token keyword">in</span> columns<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>means<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token operator">=</span>colTotal<span class="token operator">/</span>classes<span class="token punctuation">[</span>category<span class="token punctuation">]</span>
        <span class="token comment">#在计算样本标准差</span>
        self<span class="token punctuation">.</span>ssd<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>category<span class="token punctuation">,</span>columns<span class="token punctuation">)</span> <span class="token keyword">in</span> numericValues<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>ssd<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>category<span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>col<span class="token punctuation">,</span>values<span class="token punctuation">)</span> <span class="token keyword">in</span> columns<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                sumOfSquareDifferences<span class="token operator">=</span><span class="token number">0</span>
                theMean <span class="token operator">=</span> self<span class="token punctuation">.</span>means<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span>
                <span class="token keyword">for</span> value <span class="token keyword">in</span> values<span class="token punctuation">:</span>
                    sumOfSquareDifferences<span class="token operator">+=</span> <span class="token punctuation">(</span>value<span class="token operator">-</span>theMean<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span>
                columns<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token number">0</span>
                self<span class="token punctuation">.</span>ssd<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>sumOfSquareDifferences<span class="token operator">/</span><span class="token punctuation">(</span>classes<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_201"></a>预测分类</h4> 
<p>在处理完所有样本的信息后，我们已经得到样本类别的统计，<strong>各类别（标签）中每个特征的数量统计</strong>，以及<strong>各类别每个特征的概率</strong>，接下来就可以利用这些数据和贝叶斯公式预测<strong>待测样本</strong>在各类别的概率</p> 
<pre><code class="prism language-python">    <span class="token keyword">def</span> <span class="token function">classify</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> itemVector<span class="token punctuation">,</span> numVector<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>results<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment"># [()]</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>category<span class="token punctuation">,</span> prior<span class="token punctuation">)</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>prior<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            prob <span class="token operator">=</span> prior
            col<span class="token operator">=</span><span class="token number">1</span>
            <span class="token keyword">for</span> attrValue <span class="token keyword">in</span> itemVector<span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token operator">not</span> attrValue <span class="token keyword">in</span> self<span class="token punctuation">.</span>condition<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">:</span>
                    <span class="token comment"># prob=0 即nc=0 ( nc+(mp))/(N+m) = 1/(n+m) </span>
                    <span class="token comment">#此处计算缺失值的概率/处理样本中0概率事件 ,因为实际情况事件概率可能不为0,只是概率低未出现在样本中</span>
                    <span class="token comment">#如果想进一步优化,可以对拉普拉斯平滑值调参</span>
     
                    m<span class="token operator">=</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>counts<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    temp<span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>classes<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token operator">+</span>m<span class="token punctuation">)</span>
                    prob<span class="token operator">=</span>prob<span class="token operator">*</span>temp
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    prob <span class="token operator">=</span> prob<span class="token operator">*</span>self<span class="token punctuation">.</span>condition<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">[</span>attrValue<span class="token punctuation">]</span>
                col<span class="token operator">+=</span><span class="token number">1</span>
            <span class="token triple-quoted-string string">'''
            数值型的联合概率运算
            '''</span>
            sqrt2pi <span class="token operator">=</span> math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>math<span class="token punctuation">.</span>pi<span class="token punctuation">)</span>
            col<span class="token operator">=</span><span class="token number">1</span>
            <span class="token keyword">for</span> x <span class="token keyword">in</span> numVector<span class="token punctuation">:</span>
                mean <span class="token operator">=</span> self<span class="token punctuation">.</span>means<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span>
                ssd <span class="token operator">=</span> self<span class="token punctuation">.</span>ssd<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span>
                <span class="token comment"># 使用概率密度公式</span>
                ePart <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token builtin">pow</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>e<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token punctuation">(</span>x<span class="token operator">-</span>mean<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>ssd<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                prob <span class="token operator">=</span> prob<span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token operator">/</span><span class="token punctuation">(</span>sqrt2pi<span class="token operator">*</span>ssd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span>ePart<span class="token punctuation">)</span>
                col<span class="token operator">+=</span><span class="token number">1</span>
            self<span class="token punctuation">.</span>results<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>prob<span class="token punctuation">,</span>category<span class="token punctuation">)</span><span class="token punctuation">)</span>
            
        <span class="token comment">#这里返回值为预测概率最大的类别</span>
        <span class="token keyword">return</span> <span class="token builtin">max</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>results<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
</code></pre> 
<h4><a id="_239"></a>测试集验证</h4> 
<p>因为十个桶文件中有一个是测试集，之前的操作都是处理训练集数据训练模型，我们需要用测试来评断模型的好坏</p> 
<pre><code class="prism language-python">    <span class="token keyword">def</span> <span class="token function">testBucket</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>bucketPrefix<span class="token punctuation">,</span> bucketNumber<span class="token punctuation">)</span><span class="token punctuation">:</span>
    	<span class="token triple-quoted-string string">'''
		用 bucketNumber 这个桶做测试集，来完成十折交叉测试
		'''</span>
    	<span class="token comment">#提取测试集数据</span>
        filename <span class="token operator">=</span> <span class="token string">'%s-%02i'</span><span class="token operator">%</span><span class="token punctuation">(</span>bucketPrefix<span class="token punctuation">,</span>bucketNumber<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'待测试的桶为：'</span><span class="token punctuation">,</span>filename<span class="token punctuation">)</span>
        f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
        lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
        f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#循环lines中的每一行数据，调用classify进行预测，保留预测结果</span>
        totals<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
            data <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">)</span>
            vector<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment"># 存储真实的待预测的数据</span>
            numV<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
            classInColumn<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span>  <span class="token comment"># 类别在原始数据中的列索引</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'attr'</span><span class="token punctuation">:</span>
                    vector<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">elif</span> self<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'class'</span><span class="token punctuation">:</span>
                    classInColumn<span class="token operator">=</span>i
                <span class="token keyword">elif</span> self<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'num'</span><span class="token punctuation">:</span>
                    numV<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">#取出这个一行line的实际类别名</span>
            theRealClass <span class="token operator">=</span> data<span class="token punctuation">[</span>classInColumn<span class="token punctuation">]</span>
           	<span class="token comment"># 对vector 特征向量进行预测类别</span>
            predictClass <span class="token operator">=</span> self<span class="token punctuation">.</span>classify<span class="token punctuation">(</span>vector<span class="token punctuation">,</span>numV<span class="token punctuation">)</span>
            <span class="token comment"># 预测结果 totals结构为{'democrat': {'democrat': 12}, 'republican': {'republican': 10}}</span>
            totals<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>theRealClass<span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            totals<span class="token punctuation">[</span>theRealClass<span class="token punctuation">]</span><span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>predictClass<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
            totals<span class="token punctuation">[</span>theRealClass<span class="token punctuation">]</span><span class="token punctuation">[</span>predictClass<span class="token punctuation">]</span><span class="token operator">+=</span><span class="token number">1</span>
        <span class="token keyword">return</span> totals
</code></pre> 
<h4><a id="_276"></a>预测测试</h4> 
<p>使用第七个文件作为测试数据集</p> 
<pre><code class="prism language-python">c<span class="token operator">=</span>Classifer<span class="token punctuation">(</span><span class="token string">'house-votes/hv'</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">'class\tattr\tattr\tattr\tattr\tattr\tattr\tattr\tattr\tattr\tattr\tattr\tattr\tattr\tattr\tattr\tattr'</span><span class="token punctuation">)</span>
c<span class="token punctuation">.</span>testBucket<span class="token punctuation">(</span><span class="token string">'house-votes/hv'</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">)</span>
</code></pre> 
<p>结果：<br> 真实标签为democrat的12个预测中，有9个预测结果为democrat，3个预测结果为republican<br> 真实标签为republican的11个预测中，有10个预测结果为republican，1个预测结果为democrat</p> 
<pre><code>待测试的桶为： house-votes/hv-07
{'democrat': {'republican': 3, 'democrat': 9},
 'republican': {'republican': 10, 'democrat': 1}}
</code></pre> 
<h4><a id="_290"></a>十折交叉验证</h4> 
<p>从一个测试桶文件中看不出什么，我们将十个桶的每个桶文件<strong>轮流</strong>做测试数据集，而其他九个桶文件做训练集，这样得到的十个结果的准确率的<strong>平均值</strong>，就是比较理想的预测正确率，<br> 当然这里做了<strong>混淆矩阵</strong>的<strong>正确率，准确率，召回率</strong>三指标的输出，方便观察模型的好坏</p> 
<pre><code class="prism language-python"><span class="token comment">#自动化进行10折交叉验证</span>
<span class="token keyword">def</span> <span class="token function">tenfold</span><span class="token punctuation">(</span>bucketPrefix<span class="token punctuation">,</span> dataFormat<span class="token punctuation">)</span><span class="token punctuation">:</span>
    results <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        c <span class="token operator">=</span> Classifer<span class="token punctuation">(</span>bucketPrefix<span class="token punctuation">,</span>i<span class="token punctuation">,</span>dataFormat<span class="token punctuation">)</span>
        t <span class="token operator">=</span> c<span class="token punctuation">.</span>testBucket<span class="token punctuation">(</span>bucketPrefix<span class="token punctuation">,</span>i<span class="token punctuation">)</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span>value<span class="token punctuation">)</span> <span class="token keyword">in</span> t<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            results<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>ckey <span class="token punctuation">,</span>cvalue<span class="token punctuation">)</span> <span class="token keyword">in</span> value<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                results<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>ckey<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
                results<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span>ckey<span class="token punctuation">]</span><span class="token operator">+=</span> cvalue
    <span class="token keyword">print</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>
    categories  <span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span>results<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#['democrat', 'republican']</span>
    categories<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n          混淆矩阵"</span><span class="token punctuation">)</span>
    header <span class="token operator">=</span> <span class="token string">"         "</span>
    subheader <span class="token operator">=</span> <span class="token string">"                +"</span>
    <span class="token keyword">for</span> category <span class="token keyword">in</span> categories<span class="token punctuation">:</span>
        header<span class="token operator">+=</span> <span class="token string">"  %10s   "</span> <span class="token operator">%</span>category
        subheader <span class="token operator">+=</span> <span class="token string">"-------+"</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>subheader<span class="token punctuation">)</span>
    total <span class="token operator">=</span> <span class="token number">0.0</span>
    correct <span class="token operator">=</span> <span class="token number">0.0</span>
    confusion_matrix<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> category <span class="token keyword">in</span> categories<span class="token punctuation">:</span> <span class="token comment">#['democrat', 'republican']</span>
        row <span class="token operator">=</span> <span class="token string">" %10s     |"</span> <span class="token operator">%</span>category
        <span class="token keyword">for</span> c2 <span class="token keyword">in</span> categories<span class="token punctuation">:</span><span class="token comment">##['democrat', 'republican']    tp0               fn 1                              tn   3             fp2</span>
            <span class="token keyword">if</span> c2 <span class="token keyword">in</span> results<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">:</span>  <span class="token comment">#{'democrat': {'democrat': 111, 'republican': 13}, 'republican': {'republican': 99, 'democrat': 9}}</span>
                count <span class="token operator">=</span> results<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>c2<span class="token punctuation">]</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                count <span class="token operator">=</span> <span class="token number">0</span>
            row<span class="token operator">+=</span> <span class="token string">" %5i  |"</span><span class="token operator">%</span>count
            total <span class="token operator">+=</span>count
            <span class="token keyword">if</span> c2 <span class="token operator">==</span> category<span class="token punctuation">:</span>
                correct <span class="token operator">+=</span>count
                confusion_matrix<span class="token punctuation">.</span>append<span class="token punctuation">(</span>count<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                confusion_matrix<span class="token punctuation">.</span>append<span class="token punctuation">(</span>count<span class="token punctuation">)</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>subheader<span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n正确率：%5.3f "</span><span class="token operator">%</span><span class="token punctuation">(</span><span class="token punctuation">(</span>correct <span class="token operator">*</span> <span class="token number">100</span> <span class="token punctuation">)</span><span class="token operator">/</span>total<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"实例总数： %s"</span> <span class="token operator">%</span>total<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"准确率：\ndemocrat:%5.3f\nrepublican:%5.3f"</span><span class="token operator">%</span><span class="token punctuation">(</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token punctuation">(</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token punctuation">(</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">+</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"召回率：\ndemocrat:%5.3f\nrepublican:%5.3f"</span><span class="token operator">%</span><span class="token punctuation">(</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token punctuation">(</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token punctuation">(</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">+</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">(</span>results<span class="token punctuation">,</span>total<span class="token punctuation">)</span>
    
</code></pre> 
<pre><code class="prism language-python">tenfold<span class="token punctuation">(</span><span class="token string">"house-votes/hv"</span><span class="token punctuation">,</span> <span class="token string">'class\tattr\tattr\tattr\tattr\tattr\tattr\tattr\tattr\tattr\tattr\tattr\tattr\tattr\tattr\tattr\tattr'</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code>待测试的桶为： house-votes/hv-01
待测试的桶为： house-votes/hv-02
待测试的桶为： house-votes/hv-03
待测试的桶为： house-votes/hv-04
待测试的桶为： house-votes/hv-05
待测试的桶为： house-votes/hv-06
待测试的桶为： house-votes/hv-07
待测试的桶为： house-votes/hv-08
待测试的桶为： house-votes/hv-09
待测试的桶为： house-votes/hv-10
{'democrat': {'democrat': 111, 'republican': 13}, 'republican': {'republican': 101, 'democrat': 7}}

          混淆矩阵
             democrat     republican   
                +-------+-------+
   democrat     |   111  |    13  |
 republican     |     7  |   101  |
                +-------+-------+

正确率：91.379 
实例总数： 232.0
准确率：
democrat:0.941
republican:0.886
召回率：
democrat:0.895
republican:0.935
</code></pre> 
<p>总预测正误情况</p> 
<pre><code>({'democrat': {'democrat': 111, 'republican': 13},
  'republican': {'republican': 101, 'democrat': 7}},
 232.0)
</code></pre> 
<h3><a id="_384"></a>代码汇总</h3> 
<pre><code class="prism language-python"><span class="token keyword">import</span> math
<span class="token keyword">class</span> <span class="token class-name">Classifer</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> bucketPrefix<span class="token punctuation">,</span> testBucketNumber<span class="token punctuation">,</span> dataFormat<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        params:
            bucketPrefix： 桶文件名的前缀
            testBucketNumber：测试数据所在的桶的编号
            dataFormat: 数据文件格式列表
        
        '''</span>
        total<span class="token operator">=</span><span class="token number">0</span>    <span class="token comment">#记录总数据量</span>
        classes<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token comment">#存类别出现的次数</span>
        counts<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token comment">#每个类别对应的属性值出现的次数</span>
        self<span class="token punctuation">.</span><span class="token builtin">format</span> <span class="token operator">=</span> dataFormat<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">)</span> <span class="token comment"># 切分每一列的数据类型</span>
        
        <span class="token triple-quoted-string string">'''
        存储数值型数据信息
        '''</span>
        totals<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token comment"># 每种类别对应的值的总和</span>
        numericValues<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token comment">#存每种类别对应的列的取值  </span>
        
        <span class="token triple-quoted-string string">'''
        存储计算出的概率
        '''</span>
        self<span class="token punctuation">.</span>prior<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token comment">#先验概率</span>
        self<span class="token punctuation">.</span>condition<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token comment">#条件概率</span>
        
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#循环10次</span>
            <span class="token keyword">if</span> i<span class="token operator">!=</span>testBucketNumber<span class="token punctuation">:</span> <span class="token comment">#判断是否为测试集</span>
                filename<span class="token operator">=</span><span class="token string">'%s-%02i'</span><span class="token operator">%</span><span class="token punctuation">(</span>bucketPrefix<span class="token punctuation">,</span>i<span class="token punctuation">)</span>
                f<span class="token operator">=</span><span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span>
                lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
                f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
                    
                    total<span class="token operator">=</span>total<span class="token operator">+</span><span class="token number">1</span> <span class="token comment">#统计总数</span>
                    fields <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">)</span> <span class="token comment">#分割文件的每列 </span>
                    vector <span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">#存储字符型特征</span>
                    <span class="token triple-quoted-string string">'''
                    保存每一条数据的数值型数据
                    '''</span>
                    nums<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
                    <span class="token comment">#分门别类存储标签和不同类型的特征</span>
                    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>fields<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        <span class="token keyword">if</span> self<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'attr'</span><span class="token punctuation">:</span>
                            vector<span class="token punctuation">.</span>append<span class="token punctuation">(</span>fields<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                        <span class="token keyword">elif</span> self<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'class'</span><span class="token punctuation">:</span>
                            category<span class="token operator">=</span>fields<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                        <span class="token keyword">elif</span> self<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'num'</span><span class="token punctuation">:</span>
                            nums<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>fields<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                            
                    <span class="token comment">#记录每个列别出现的次数</span>
                    classes<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>category<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
                    counts<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>category<span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                    classes<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token operator">+=</span><span class="token number">1</span>
                    
                    <span class="token triple-quoted-string string">'''
                    记录每个数值型数据
                    '''</span>
                    totals<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>category<span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                    numericValues<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>category<span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                    
                    <span class="token comment">#循环处理么每条记录出现的属性值</span>
                    <span class="token comment">#循环vector 取出每列值</span>
                    col<span class="token operator">=</span><span class="token number">0</span>
                    <span class="token keyword">for</span> columnValue <span class="token keyword">in</span> vector<span class="token punctuation">:</span>
                        col<span class="token operator">+=</span><span class="token number">1</span>
                        counts<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>col<span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                        counts<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>columnValue<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
                        counts<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">[</span>columnValue<span class="token punctuation">]</span><span class="token operator">+=</span><span class="token number">1</span>
                    <span class="token triple-quoted-string string">'''
                    counts形成的结构为：
                    {
                    'democrat': 
                        {
                            1: {'y': 64, 'n': 48}, 
                            2: {'n': 64, 'y': 48},
                            ...
                            16: {'y': 105, 'n': 7}
                        },
                   'republican': 
                       {
                           1: {'y': 22, 'n': 76},
                           2: {'y': 46, 'n': 52},
                           ...
                           16: {'n': 30, 'y': 68}
                        }
                    }
                    '''</span>
                    
                    <span class="token triple-quoted-string string">'''
                    保存每个数值型数据与类别的对应字典
                    '''</span>
                    col<span class="token operator">=</span><span class="token number">0</span>
                    <span class="token keyword">for</span> columnValue <span class="token keyword">in</span> nums<span class="token punctuation">:</span>
                        col<span class="token operator">+=</span><span class="token number">1</span>
                        totals<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>col<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
                        totals<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token operator">+=</span>columnValue
                        numericValues<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>col<span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                        numericValues<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>columnValue<span class="token punctuation">)</span>
                        
        <span class="token keyword">print</span><span class="token punctuation">(</span>counts<span class="token punctuation">)</span>  
<span class="token comment">#开始计算概率</span>
<span class="token comment"># classes：  {'democrat': 112, 'republican': 98}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>category<span class="token punctuation">,</span> count<span class="token punctuation">)</span> <span class="token keyword">in</span> classes<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>prior<span class="token punctuation">[</span>category<span class="token punctuation">]</span> <span class="token operator">=</span> count<span class="token operator">/</span>total
            
        <span class="token comment">#条件概率： 注意：columns是一个字典</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>category<span class="token punctuation">,</span> columns<span class="token punctuation">)</span> <span class="token keyword">in</span> counts<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>condition<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>category<span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            
            <span class="token keyword">for</span> <span class="token punctuation">(</span>col<span class="token punctuation">,</span>valueCount<span class="token punctuation">)</span> <span class="token keyword">in</span> columns<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>condition<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>col<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
                
                <span class="token comment"># 此处引入拉普拉斯平滑处理已存在值</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span>attrValue<span class="token punctuation">,</span> count<span class="token punctuation">)</span> <span class="token keyword">in</span> valueCount<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token comment"># 此处先计算所有在样本中已存在值的条件概率 ( nc+(mp))/(N+m)</span>
                    m<span class="token operator">=</span><span class="token builtin">len</span><span class="token punctuation">(</span>counts<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    self<span class="token punctuation">.</span>condition<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">[</span>attrValue<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>count<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>classes<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token operator">+</span>m<span class="token punctuation">)</span>
                    
        <span class="token comment"># 设置为类成员，方便在创建类对象后查看</span>
        self<span class="token punctuation">.</span>counts<span class="token operator">=</span>counts
        self<span class="token punctuation">.</span>classes<span class="token operator">=</span>classes
        <span class="token triple-quoted-string string">'''
        开始计算数值型数据的概率密度函数
        '''</span>
        self<span class="token punctuation">.</span>means<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        self<span class="token punctuation">.</span>totals<span class="token operator">=</span>totals
        <span class="token comment">#先计算均值</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>category<span class="token punctuation">,</span> columns<span class="token punctuation">)</span> <span class="token keyword">in</span> totals<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>means<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>category<span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>col<span class="token punctuation">,</span>colTotal<span class="token punctuation">)</span> <span class="token keyword">in</span> columns<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>means<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token operator">=</span>colTotal<span class="token operator">/</span>classes<span class="token punctuation">[</span>category<span class="token punctuation">]</span>
        <span class="token comment">#在计算样本标准差</span>
        self<span class="token punctuation">.</span>ssd<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>category<span class="token punctuation">,</span>columns<span class="token punctuation">)</span> <span class="token keyword">in</span> numericValues<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>ssd<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>category<span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>col<span class="token punctuation">,</span>values<span class="token punctuation">)</span> <span class="token keyword">in</span> columns<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                sumOfSquareDifferences<span class="token operator">=</span><span class="token number">0</span>
                theMean <span class="token operator">=</span> self<span class="token punctuation">.</span>means<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span>
                <span class="token keyword">for</span> value <span class="token keyword">in</span> values<span class="token punctuation">:</span>
                    sumOfSquareDifferences<span class="token operator">+=</span> <span class="token punctuation">(</span>value<span class="token operator">-</span>theMean<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span>
                columns<span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token number">0</span>
                self<span class="token punctuation">.</span>ssd<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>sumOfSquareDifferences<span class="token operator">/</span><span class="token punctuation">(</span>classes<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        
    <span class="token keyword">def</span> <span class="token function">classify</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> itemVector<span class="token punctuation">,</span> numVector<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>results<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment"># [()]</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>category<span class="token punctuation">,</span> prior<span class="token punctuation">)</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>prior<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            prob <span class="token operator">=</span> prior
            col<span class="token operator">=</span><span class="token number">1</span>
            <span class="token keyword">for</span> attrValue <span class="token keyword">in</span> itemVector<span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token operator">not</span> attrValue <span class="token keyword">in</span> self<span class="token punctuation">.</span>condition<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">:</span>
                    <span class="token comment"># prob=0 即nc=0 ( nc+(mp))/(N+m) = 1/(n+m) </span>
                    <span class="token comment">#此处计算缺失值的概率/处理样本中0概率事件 ,因为实际情况事件概率可能不为0,只是概率低未出现在样本中</span>
                    <span class="token comment">#如果想进一步优化,可以对拉普拉斯平滑值调参</span>
     
                    m<span class="token operator">=</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>counts<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                    temp<span class="token operator">=</span><span class="token number">1</span><span class="token operator">/</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>classes<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token operator">+</span>m<span class="token punctuation">)</span>
                    prob<span class="token operator">=</span>prob<span class="token operator">*</span>temp
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    prob <span class="token operator">=</span> prob<span class="token operator">*</span>self<span class="token punctuation">.</span>condition<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span><span class="token punctuation">[</span>attrValue<span class="token punctuation">]</span>
                col<span class="token operator">+=</span><span class="token number">1</span>
            <span class="token triple-quoted-string string">'''
            数值型的联合概率运算
            '''</span>
            sqrt2pi <span class="token operator">=</span> math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>math<span class="token punctuation">.</span>pi<span class="token punctuation">)</span>
            col<span class="token operator">=</span><span class="token number">1</span>
            <span class="token keyword">for</span> x <span class="token keyword">in</span> numVector<span class="token punctuation">:</span>
                mean <span class="token operator">=</span> self<span class="token punctuation">.</span>means<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span>
                ssd <span class="token operator">=</span> self<span class="token punctuation">.</span>ssd<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>col<span class="token punctuation">]</span>
                <span class="token comment"># 使用概率密度公式</span>
                ePart <span class="token operator">=</span> math<span class="token punctuation">.</span><span class="token builtin">pow</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>e<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token punctuation">(</span>x<span class="token operator">-</span>mean<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token operator">/</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>ssd<span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                prob <span class="token operator">=</span> prob<span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1.0</span><span class="token operator">/</span><span class="token punctuation">(</span>sqrt2pi<span class="token operator">*</span>ssd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span>ePart<span class="token punctuation">)</span>
                col<span class="token operator">+=</span><span class="token number">1</span>
            self<span class="token punctuation">.</span>results<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>prob<span class="token punctuation">,</span>category<span class="token punctuation">)</span><span class="token punctuation">)</span>
            
        <span class="token comment">#这里返回值为预测概率最大的类别</span>
        <span class="token keyword">return</span> <span class="token builtin">max</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>results<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    
    <span class="token keyword">def</span> <span class="token function">testBucket</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>bucketPrefix<span class="token punctuation">,</span> bucketNumber<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        用 bucketNumber 这个桶做测试集，来完成十折交叉测试
        '''</span>
        <span class="token comment">#提取测试集数据</span>
        filename <span class="token operator">=</span> <span class="token string">'%s-%02i'</span><span class="token operator">%</span><span class="token punctuation">(</span>bucketPrefix<span class="token punctuation">,</span>bucketNumber<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'待测试的桶为：'</span><span class="token punctuation">,</span>filename<span class="token punctuation">)</span>
        f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>
        lines <span class="token operator">=</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span>
        f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#循环lines中的每一行数据，调用classify进行预测，保留预测结果</span>
        totals<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> line <span class="token keyword">in</span> lines<span class="token punctuation">:</span>
            data <span class="token operator">=</span> line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\t'</span><span class="token punctuation">)</span>
            vector<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment"># 存储真实的待预测的数据</span>
            numV<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
            classInColumn<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span>  <span class="token comment"># 类别在原始数据中的列索引</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'attr'</span><span class="token punctuation">:</span>
                    vector<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token keyword">elif</span> self<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'class'</span><span class="token punctuation">:</span>
                    classInColumn<span class="token operator">=</span>i
                <span class="token keyword">elif</span> self<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'num'</span><span class="token punctuation">:</span>
                    numV<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment">#取出这个一行line的实际类别名</span>
            theRealClass <span class="token operator">=</span> data<span class="token punctuation">[</span>classInColumn<span class="token punctuation">]</span>
           	<span class="token comment"># 对vector 特征向量进行预测类别</span>
            predictClass <span class="token operator">=</span> self<span class="token punctuation">.</span>classify<span class="token punctuation">(</span>vector<span class="token punctuation">,</span>numV<span class="token punctuation">)</span>
            <span class="token comment"># 预测结果 totals结构为{'democrat': {'democrat': 12}, 'republican': {'republican': 10}}</span>
            totals<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>theRealClass<span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            totals<span class="token punctuation">[</span>theRealClass<span class="token punctuation">]</span><span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>predictClass<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
            totals<span class="token punctuation">[</span>theRealClass<span class="token punctuation">]</span><span class="token punctuation">[</span>predictClass<span class="token punctuation">]</span><span class="token operator">+=</span><span class="token number">1</span>
        <span class="token keyword">return</span> totals
</code></pre> 
<pre><code class="prism language-python"><span class="token comment">#自动化进行10折交叉验证</span>
<span class="token keyword">def</span> <span class="token function">tenfold</span><span class="token punctuation">(</span>bucketPrefix<span class="token punctuation">,</span> dataFormat<span class="token punctuation">)</span><span class="token punctuation">:</span>
    results <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        c <span class="token operator">=</span> Classifer<span class="token punctuation">(</span>bucketPrefix<span class="token punctuation">,</span>i<span class="token punctuation">,</span>dataFormat<span class="token punctuation">)</span>
        t <span class="token operator">=</span> c<span class="token punctuation">.</span>testBucket<span class="token punctuation">(</span>bucketPrefix<span class="token punctuation">,</span>i<span class="token punctuation">)</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>key<span class="token punctuation">,</span>value<span class="token punctuation">)</span> <span class="token keyword">in</span> t<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            results<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>ckey <span class="token punctuation">,</span>cvalue<span class="token punctuation">)</span> <span class="token keyword">in</span> value<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                results<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>ckey<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
                results<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">[</span>ckey<span class="token punctuation">]</span><span class="token operator">+=</span> cvalue
    <span class="token keyword">print</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span>
    categories  <span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span>results<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#['democrat', 'republican']</span>
    categories<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n          混淆矩阵"</span><span class="token punctuation">)</span>
    header <span class="token operator">=</span> <span class="token string">"         "</span>
    subheader <span class="token operator">=</span> <span class="token string">"                +"</span>
    <span class="token keyword">for</span> category <span class="token keyword">in</span> categories<span class="token punctuation">:</span>
        header<span class="token operator">+=</span> <span class="token string">"  %10s   "</span> <span class="token operator">%</span>category
        subheader <span class="token operator">+=</span> <span class="token string">"-------+"</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>header<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>subheader<span class="token punctuation">)</span>
    total <span class="token operator">=</span> <span class="token number">0.0</span>
    correct <span class="token operator">=</span> <span class="token number">0.0</span>
    confusion_matrix<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> category <span class="token keyword">in</span> categories<span class="token punctuation">:</span> <span class="token comment">#['democrat', 'republican']</span>
        row <span class="token operator">=</span> <span class="token string">" %10s     |"</span> <span class="token operator">%</span>category
        <span class="token keyword">for</span> c2 <span class="token keyword">in</span> categories<span class="token punctuation">:</span><span class="token comment">##['democrat', 'republican']    tp0               fn 1                              tn   3             fp2</span>
            <span class="token keyword">if</span> c2 <span class="token keyword">in</span> results<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">:</span>  <span class="token comment">#{'democrat': {'democrat': 111, 'republican': 13}, 'republican': {'republican': 99, 'democrat': 9}}</span>
                count <span class="token operator">=</span> results<span class="token punctuation">[</span>category<span class="token punctuation">]</span><span class="token punctuation">[</span>c2<span class="token punctuation">]</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                count <span class="token operator">=</span> <span class="token number">0</span>
            row<span class="token operator">+=</span> <span class="token string">" %5i  |"</span><span class="token operator">%</span>count
            total <span class="token operator">+=</span>count
            <span class="token keyword">if</span> c2 <span class="token operator">==</span> category<span class="token punctuation">:</span>
                correct <span class="token operator">+=</span>count
                confusion_matrix<span class="token punctuation">.</span>append<span class="token punctuation">(</span>count<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                confusion_matrix<span class="token punctuation">.</span>append<span class="token punctuation">(</span>count<span class="token punctuation">)</span>

        <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>subheader<span class="token punctuation">)</span>
    
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n正确率：%5.3f "</span><span class="token operator">%</span><span class="token punctuation">(</span><span class="token punctuation">(</span>correct <span class="token operator">*</span> <span class="token number">100</span> <span class="token punctuation">)</span><span class="token operator">/</span>total<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"实例总数： %s"</span> <span class="token operator">%</span>total<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"准确率：\ndemocrat:%5.3f\nrepublican:%5.3f"</span><span class="token operator">%</span><span class="token punctuation">(</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token punctuation">(</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token punctuation">(</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">+</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"召回率：\ndemocrat:%5.3f\nrepublican:%5.3f"</span><span class="token operator">%</span><span class="token punctuation">(</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token punctuation">(</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">+</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token punctuation">(</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">+</span>confusion_matrix<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
    <span class="token keyword">return</span> <span class="token punctuation">(</span>results<span class="token punctuation">,</span>total<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="_651"></a>总结</h2> 
<p>朴素贝叶斯代码的实现其实分为下面几部分：</p> 
<ul><li>提取数据集数据</li><li>分析处理数据集数据</li><li>计算概率（先验，条件，联合）</li><li>根据贝叶斯公式计算预测概率</li></ul> 
<p>其中处理不同数据类型（伯努利，多项式，连续型）和0概率情况，还用到了：</p> 
<ul><li>概率密度函数</li><li>拉普拉斯平滑</li></ul> 
<p>但是在官方sklearn的朴素贝叶斯函数中还有许多地方可以调参优化模型准确率，这里只是简单的实现，熟悉基本原理。<br> 若有不足之处，请提醒我改正，感激不尽</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8816d95c53f8980ad27e2b3d757acea7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">一个Java死锁示例</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/47e3053f32bedd1fca4f7c30e13be7f9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">navicat连接Oracle异常需指定oci.dll文件解决办法以及工具下载</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>