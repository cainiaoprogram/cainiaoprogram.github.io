<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>libevent高并发网络编程 - 04_libevent实现http服务器 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="libevent高并发网络编程 - 04_libevent实现http服务器" />
<meta property="og:description" content="文章目录 1 evhttp简介2 相关的APIevhttp_new()evhttp_free()evhttp_bind_socket()evhttp_set_gencb()evhttp_set_cb()evhttp_request_get_uri()evhttp_request_get_command()evhttp_request_get_input_headers()evhttp_request_get_input_buffer()evhttp_request_get_output_headers()evhttp_add_header()evhttp_request_get_output_buffer()evhttp_send_reply() http服务器例子http服务器代码index.html文件运行效果 链接: C/C&#43;&#43;Linux服务器开发/后台架构师【零声教育】-学习视频教程-腾讯课堂 1 evhttp简介 在libevent中，HTTP的实现主要是通过evhttp模块来完成的。evhttp提供了一个高层次的HTTP服务器接口，可以处理HTTP请求并发送HTTP响应。
在源码中，libevent的HTTP协议处理主要是通过evhttp模块来完成的。当客户端发起一个HTTP请求时，libevent将该请求解析为struct evhttp_request结构体表示，并调用用户设置的请求处理函数进行处理。
struct evhttp_request结构体定义了HTTP请求的各个字段，如请求行、请求头、请求正文等。例如，以下是struct evhttp_request结构体的部分定义：
struct evhttp_request { int major; // 主版本号 int minor; // 次版本号 enum evhttp_cmd_type type; // 请求方法（GET、POST等） char *uri; // 请求URI struct evkeyvalq *input_headers;// 请求头 struct evbuffer *input_buffer; // 请求正文 }; enum evhttp_cmd_type { EVHTTP_REQ_GET = 1 &lt;&lt; 0, EVHTTP_REQ_POST = 1 &lt;&lt; 1, EVHTTP_REQ_HEAD = 1 &lt;&lt; 2, EVHTTP_REQ_PUT = 1 &lt;&lt; 3, EVHTTP_REQ_DELETE = 1 &lt;&lt; 4, ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c6b8c0f5cb727e16a2defe7c6b26f5b8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-21T19:34:53+08:00" />
<meta property="article:modified_time" content="2023-05-21T19:34:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">libevent高并发网络编程 - 04_libevent实现http服务器</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#1_evhttp_2" rel="nofollow">1 evhttp简介</a></li><li><a href="#2_API_36" rel="nofollow">2 相关的API</a></li><li><ul><li><a href="#evhttp_new_38" rel="nofollow">evhttp_new()</a></li><li><a href="#evhttp_free_48" rel="nofollow">evhttp_free()</a></li><li><a href="#evhttp_bind_socket_56" rel="nofollow">evhttp_bind_socket()</a></li><li><a href="#evhttp_set_gencb_69" rel="nofollow">evhttp_set_gencb()</a></li><li><a href="#evhttp_set_cb_86" rel="nofollow">evhttp_set_cb()</a></li><li><a href="#evhttp_request_get_uri_103" rel="nofollow">evhttp_request_get_uri()</a></li><li><a href="#evhttp_request_get_command_122" rel="nofollow">evhttp_request_get_command()</a></li><li><a href="#evhttp_request_get_input_headers_144" rel="nofollow">evhttp_request_get_input_headers()</a></li><li><a href="#evhttp_request_get_input_buffer_157" rel="nofollow">evhttp_request_get_input_buffer()</a></li><li><a href="#evhttp_request_get_output_headers_170" rel="nofollow">evhttp_request_get_output_headers()</a></li><li><a href="#evhttp_add_header_183" rel="nofollow">evhttp_add_header()</a></li><li><a href="#evhttp_request_get_output_buffer_199" rel="nofollow">evhttp_request_get_output_buffer()</a></li><li><a href="#evhttp_send_reply_212" rel="nofollow">evhttp_send_reply()</a></li></ul> 
   </li><li><a href="#http_231" rel="nofollow">http服务器例子</a></li><li><ul><li><a href="#http_235" rel="nofollow">http服务器代码</a></li><li><a href="#indexhtml_397" rel="nofollow">index.html文件</a></li><li><a href="#_419" rel="nofollow">运行效果</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<br> 链接: 
<a href="https://ke.qq.com/course/417774?flowToken=1010783#term_id=100498433" rel="nofollow">C/C++Linux服务器开发/后台架构师【零声教育】-学习视频教程-腾讯课堂</a> 
<p></p> 
<h3><a id="1_evhttp_2"></a>1 evhttp简介</h3> 
<p>在libevent中，HTTP的实现主要是通过<code>evhttp</code>模块来完成的。<code>evhttp</code>提供了一个高层次的HTTP服务器接口，可以处理HTTP请求并发送HTTP响应。</p> 
<p>在源码中，libevent的HTTP协议处理主要是通过<code>evhttp</code>模块来完成的。<strong>当客户端发起一个HTTP请求时，libevent将该请求解析为<code>struct evhttp_request</code>结构体表示，并调用用户设置的请求处理函数进行处理</strong>。</p> 
<p><strong><code>struct evhttp_request</code>结构体定义了HTTP请求的各个字段，如请求行、请求头、请求正文等</strong>。例如，以下是<code>struct evhttp_request</code>结构体的部分定义：</p> 
<pre><code class="prism language-c"><span class="token keyword">struct</span> <span class="token class-name">evhttp_request</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> major<span class="token punctuation">;</span>  <span class="token comment">// 主版本号</span>
    <span class="token keyword">int</span> minor<span class="token punctuation">;</span>  <span class="token comment">// 次版本号</span>
    <span class="token keyword">enum</span> <span class="token class-name">evhttp_cmd_type</span> type<span class="token punctuation">;</span>  	<span class="token comment">// 请求方法（GET、POST等）</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>uri<span class="token punctuation">;</span>  					<span class="token comment">// 请求URI</span>
    <span class="token keyword">struct</span> <span class="token class-name">evkeyvalq</span> <span class="token operator">*</span>input_headers<span class="token punctuation">;</span><span class="token comment">// 请求头</span>
    <span class="token keyword">struct</span> <span class="token class-name">evbuffer</span> <span class="token operator">*</span>input_buffer<span class="token punctuation">;</span>  <span class="token comment">// 请求正文</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">enum</span> <span class="token class-name">evhttp_cmd_type</span> <span class="token punctuation">{<!-- --></span>
	EVHTTP_REQ_GET     <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">,</span>
	EVHTTP_REQ_POST    <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">,</span>
	EVHTTP_REQ_HEAD    <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">,</span>
	EVHTTP_REQ_PUT     <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">,</span>
	EVHTTP_REQ_DELETE  <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>当接收到HTTP请求数据时，libevent将会使用一个状态机来逐步解析HTTP请求。在此过程中，它将从输入流中读取一些数据并按照HTTP协议格式解析这些数据，以获得请求的不同部分。具体来说，HTTP请求包括请求行、请求头和请求正文三个部分，每个部分都有其特定的格式。</p> 
<p>将HTTP请求解析为<code>struct evhttp_request</code>结构体，libevent就会调用用户设置的请求处理函数来处理该请求。对于GET请求等不包含请求正文的请求，可以直接在请求处理函数中进行处理；对于POST请求等包含请求正文的请求，则需要从<code>struct evhttp_request</code>结构体中获取请求正文数据并进行处理。</p> 
<p>总之，libevent使用状态机来逐步解析HTTP请求，并将请求解析为<code>struct evhttp_request</code>结构体表示。这种设计使得libevent能够高效地处理HTTP请求，同时也方便了开发者对HTTP协议进行扩展和定制。</p> 
<h3><a id="2_API_36"></a>2 相关的API</h3> 
<h4><a id="evhttp_new_38"></a>evhttp_new()</h4> 
<p><code>evhttp_new</code> 用于创建和初始化一个 <code>evhttp</code> 结构体，以便用于 HTTP 服务器。 <code>evhttp</code> 结构体表示一个 HTTP 服务器，它可以在一个或多个套接字上监听传入的 HTTP 请求，并将这些请求分派给适当的请求处理程序。</p> 
<pre><code class="prism language-c"><span class="token keyword">struct</span> <span class="token class-name">evhttp</span> <span class="token operator">*</span> <span class="token function">evhttp_new</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">event_base</span> <span class="token operator">*</span>base<span class="token punctuation">)</span>
    
base：即指向 `event_base` 结构体的指针，用于处理 HTTP 服务器的事件
</code></pre> 
<h4><a id="evhttp_free_48"></a>evhttp_free()</h4> 
<p><code>evhttp_free()</code> 用于释放 <code>evhttp</code> 结构体及其相关资源。调用该函数后，将销毁与 <code>evhttp</code> 相关联的所有信息，包括绑定的套接字以及任何未完成的请求。</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">evhttp_free</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">evhttp</span><span class="token operator">*</span> http<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="evhttp_bind_socket_56"></a>evhttp_bind_socket()</h4> 
<p><code>evhttp_bind_socket</code>用于将HTTP服务器绑定到指定的IP地址和端口号。它接受一个指向<code>evhttp</code>结构体的指针，一个字符串表示IP地址，以及一个16位整数表示端口号。</p> 
<pre><code class="prism language-c"><span class="token keyword">int</span> <span class="token function">evhttp_bind_socket</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">evhttp</span> <span class="token operator">*</span>http<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>address<span class="token punctuation">,</span> <span class="token class-name">ev_uint16_t</span> port<span class="token punctuation">)</span>

参数：
    http：指向要绑定的evhttp对象的指针。
    address：要绑定的IP地址。可以是一个IPv4或IPv6地址，也可以是一个域名。如果为<span class="token constant">NULL</span>，则默认绑定到所有可用地址。
    port：要绑定的端口号。
</code></pre> 
<h4><a id="evhttp_set_gencb_69"></a>evhttp_set_gencb()</h4> 
<p><code>evhttp_set_gencb()</code> 是 libevent 库中的一个函数，用于设置通用回调函数，该函数将在 HTTP 请求到达时被调用。</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span>
<span class="token function">evhttp_set_gencb</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">evhttp</span> <span class="token operator">*</span>http<span class="token punctuation">,</span>
   				 <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>cb<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">evhttp_request</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
                 <span class="token keyword">void</span> <span class="token operator">*</span>cbarg<span class="token punctuation">)</span>
    
	第一个参数是指向 evhttp 结构体的指针，表示要设置回调函数的 HTTP 服务器；
	第二个参数是指向回调函数的指针，该回调函数的原型为 <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>cb<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">evhttp_request</span> <span class="token operator">*</span><span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>，其中第一个参数是指向当前 HTTP 请求的指针，第二个参数是传递给 <span class="token function">evhttp_set_gencb</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 函数的第三个参数；
    第三个参数是传递给回调函数的上下文参数 cbarg，它可以是任何数据类型的指针；
</code></pre> 
<p>当 HTTP 请求到达并且没有与之匹配的特定 URI 或处理程序时，将调用设置的通用回调函数。注意，如果已经为某个 URI 注册了特定的处理程序，则不会调用通用回调函数来处理该 URI 的请求。</p> 
<h4><a id="evhttp_set_cb_86"></a>evhttp_set_cb()</h4> 
<p><code>evhttp_set_cb()</code> 用于为 HTTP 服务器注册特定 URI 的请求处理程序回调函数。</p> 
<pre><code class="prism language-int">evhttp_set_cb(struct evhttp *http, 
			  const char *uri,
    		  void (*cb)(struct evhttp_request *, void *), 
    		  void *cbarg)
	第一个参数是指向 evhttp 结构体的指针，表示要设置回调函数的 HTTP 服务器；
	第二个参数是字符串类型的 URI，表示要注册回调函数的 URI；
	第三个参数是指向回调函数的指针，该回调函数的原型为 void (*cb)(struct evhttp_request *, void *)，其中第一个参数是指向当前 HTTP 请求的指针，第二个参数是传递给 evhttp_set_cb() 函数的第四个参数；
	四个参数是传递给回调函数的上下文参数 cbarg，它可以是任何数据类型的指针。
</code></pre> 
<p>当 HTTP 请求到达并且与所注册的 URI 匹配时，将调用设置的回调函数。注意，如果同时为相同的 URI 注册了多个回调函数，则只会调用最后一个注册的回调函数。</p> 
<h4><a id="evhttp_request_get_uri_103"></a>evhttp_request_get_uri()</h4> 
<p><code>evhttp_request_get_uri()</code> 用于获取 HTTP 请求的 URI（Uniform Resource Identifier）。</p> 
<pre><code class="prism language-c"><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>
<span class="token function">evhttp_request_get_uri</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">evhttp_request</span> <span class="token operator">*</span>req<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token operator">-&gt;</span>uri <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
		<span class="token function">event_debug</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"%s: request %p has no uri\n"</span><span class="token punctuation">,</span> <span class="token constant">__func__</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>req<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>req<span class="token operator">-&gt;</span>uri<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//返回struct evhttp_reques中的URI</span>
<span class="token punctuation">}</span>

该函数只有一个参数，即指向 `evhttp_request` 结构体的指针，表示要获取 URI 的 HTTP 请求
</code></pre> 
<p>函数返回一个字符串类型的指针，指向 HTTP 请求的 URI。URI 是客户端在请求服务器时发送的字符串，该字符串通常包含一个主机名、路径和查询字符串。例如，对于 “http://example.com/foo?bar=baz” 这样的请求，URI 将是 “/foo?bar=baz”。</p> 
<p>需要注意的是，返回的指针指向的内存由 <code>evhttp_request</code> 结构体管理，因此不需要手动释放该指针指向的内存。</p> 
<h4><a id="evhttp_request_get_command_122"></a>evhttp_request_get_command()</h4> 
<p><code>evhttp_request_get_command()</code> 用于获取 HTTP 请求的方法类型。</p> 
<pre><code class="prism language-c"><span class="token keyword">enum</span> <span class="token class-name">evhttp_cmd_type</span>
<span class="token function">evhttp_request_get_command</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">evhttp_request</span> <span class="token operator">*</span>req<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>req<span class="token operator">-&gt;</span>type<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//返回struct evhttp_reques中请求方法（GET、POST等）</span>
<span class="token punctuation">}</span>

函数返回一个枚举类型 evhttp_cmd_type 值，表示 HTTP 请求使用的方法类型。枚举类型包括以下值：
    EVHTTP_REQ_GET<span class="token operator">:</span> 使用 GET 方法。
    EVHTTP_REQ_POST<span class="token operator">:</span> 使用 POST 方法。
    EVHTTP_REQ_HEAD<span class="token operator">:</span> 使用 HEAD 方法。
    EVHTTP_REQ_PUT<span class="token operator">:</span> 使用 PUT 方法。
    EVHTTP_REQ_DELETE<span class="token operator">:</span> 使用 DELETE 方法。
    EVHTTP_REQ_OPTIONS<span class="token operator">:</span> 使用 OPTIONS 方法。
    EVHTTP_REQ_TRACE<span class="token operator">:</span> 使用 TRACE 方法。
    EVHTTP_REQ_CONNECT<span class="token operator">:</span> 使用 CONNECT 方法。
    EVHTTP_REQ_PATCH<span class="token operator">:</span> 使用 PATCH 方法。
</code></pre> 
<h4><a id="evhttp_request_get_input_headers_144"></a>evhttp_request_get_input_headers()</h4> 
<p><code>evhttp_request_get_input_headers()</code> 用于<strong>获取 HTTP 请求中的输入头部</strong>。输入头部是从客户端发送到服务器的数据块，其中包含一些元信息，例如请求的内容类型、长度或来源等。</p> 
<pre><code class="prism language-c"><span class="token keyword">struct</span> <span class="token class-name">evkeyvalq</span> <span class="token operator">*</span><span class="token function">evhttp_request_get_input_headers</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">evhttp_request</span> <span class="token operator">*</span>req<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>req<span class="token operator">-&gt;</span>input_headers<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 返回struct evhttp_reques中请求头</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>函数返回一个指向 <code>evkeyvalq</code> 结构体的指针，该结构体代表了 HTTP 请求的输入头部。 该结构体是一个键值对列表，其中每个键都是头部的名称，每个值都是头部的值。</p> 
<h4><a id="evhttp_request_get_input_buffer_157"></a>evhttp_request_get_input_buffer()</h4> 
<p><code>evhttp_request_get_input_buffer()</code> 用于<strong>获取 HTTP 请求的输入缓冲区</strong>。输入缓冲区是从客户端发送到服务器的数据块，其中包含了 HTTP 请求体以及可能的其他数据。</p> 
<pre><code class="prism language-c"><span class="token keyword">struct</span> <span class="token class-name">evbuffer</span> <span class="token operator">*</span><span class="token function">evhttp_request_get_input_buffer</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">evhttp_request</span> <span class="token operator">*</span>req<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>req<span class="token operator">-&gt;</span>input_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 返回struct evhttp_reques中请求正文</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>函数返回一个指向 <code>evbuffer</code> 结构体的指针，该结构体代表了 HTTP 请求的输入缓冲区。</p> 
<h4><a id="evhttp_request_get_output_headers_170"></a>evhttp_request_get_output_headers()</h4> 
<p><code>evhttp_request_get_output_headers()</code> 用于<strong>获取 HTTP 请求的输出头部</strong>。输出头部是从服务器发送到客户端的元信息块，其中包含了一些关于响应的信息，例如响应状态码、内容类型或其他自定义头部等。</p> 
<pre><code class="prism language-c"><span class="token keyword">struct</span> <span class="token class-name">evkeyvalq</span> <span class="token operator">*</span><span class="token function">evhttp_request_get_output_headers</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">evhttp_request</span> <span class="token operator">*</span>req<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>req<span class="token operator">-&gt;</span>output_headers<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>函数返回一个指向 <code>evkeyvalq</code> 结构体的指针，该结构体代表了 HTTP 请求的输出头部。 该结构体是一个键值对列表，其中每个键都是头部的名称，每个值都是头部的值。</p> 
<h4><a id="evhttp_add_header_183"></a>evhttp_add_header()</h4> 
<p><code>evhttp_add_header()</code>用于向 <code>evkeyvalq</code> 结构体<strong>表示的头部列表添加一个新的键值对</strong>。</p> 
<pre><code class="prism language-c"><span class="token keyword">int</span>	<span class="token function">evhttp_add_header</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">evkeyvalq</span> <span class="token operator">*</span>headers<span class="token punctuation">,</span>
    				  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>key<span class="token punctuation">,</span> 
                      <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>value<span class="token punctuation">)</span>
    
第一个参数是指向 evkeyvalq 结构体的指针，表示要添加头部的头部列表；
第二个参数是字符串类型的键名，表示要添加的头部的名称；
第三个参数是字符串类型的键值，表示要添加的头部的值。
</code></pre> 
<p>需要注意的是，如果某个键已经存在于头部列表中，则会将现有键值对的值替换为新的值。如果要添加多个具有相同名称的头部，请使用逗号分隔它们的值。例如，可以使用<code>"Accept-Encoding: gzip, deflate"</code>来同时添加两个<code>Accept-Encoding</code>头部。</p> 
<h4><a id="evhttp_request_get_output_buffer_199"></a>evhttp_request_get_output_buffer()</h4> 
<p><code>evhttp_request_get_output_buffer()</code> 用于<strong>获取 HTTP 请求的输出缓冲区</strong>。输出缓冲区是服务器发送到客户端的数据块，其中包含了 HTTP 响应体以及可能的其他数据。</p> 
<pre><code class="prism language-c"><span class="token keyword">struct</span> <span class="token class-name">evbuffer</span> <span class="token operator">*</span><span class="token function">evhttp_request_get_output_buffer</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">evhttp_request</span> <span class="token operator">*</span>req<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token punctuation">(</span>req<span class="token operator">-&gt;</span>output_buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

函数返回一个指向 evbuffer 结构体的指针，该结构体代表了 HTTP 请求的输出缓冲区。可以使用 <span class="token function">evbuffer_add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 函数将内容添加到缓冲区中。
</code></pre> 
<h4><a id="evhttp_send_reply_212"></a>evhttp_send_reply()</h4> 
<p><code>evhttp_send_reply()</code> 用于向客户端发送 HTTP 响应。该函数使用指定的状态码、原因短语和响应正文来构造 HTTP 响应。</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span>
<span class="token function">evhttp_send_reply</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">evhttp_request</span> <span class="token operator">*</span>req<span class="token punctuation">,</span> 
                 <span class="token keyword">int</span> code<span class="token punctuation">,</span> 
                 <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>reason<span class="token punctuation">,</span>
    			 <span class="token keyword">struct</span> <span class="token class-name">evbuffer</span> <span class="token operator">*</span>databuf<span class="token punctuation">)</span>
    
	第一个参数是指向 evhttp_request 结构体的指针，表示要发送响应的 HTTP 请求；
    第二个参数是整数类型的状态码，表示响应的状态码；
    第三个参数是字符串类型的原因短语，表示状态码的原因短语；
    第四个参数是指向 evbuffer 结构体的指针，表示响应正文的内容。
</code></pre> 
<p>需要注意的是，在调用 <code>evhttp_send_reply()</code> 函数之前，必须确保已经设置了响应状态码和必要的响应头部，并且已经将所有响应数据写入到输出缓冲区中。</p> 
<h3><a id="http_231"></a>http服务器例子</h3> 
<p>通过浏览器发送http请求，并解析url和http头部，并响应浏览器对文件和图片的请求。</p> 
<h4><a id="http_235"></a>http服务器代码</h4> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;event2/event.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;event2/listener.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;event2/http.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;event2/keyvalq_struct.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;event2/buffer.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">_WIN32</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;signal.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
using namespace std<span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">WEBROOT</span> <span class="token string">"."</span> </span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DEFAULTINDEX</span> <span class="token string">"index.html"</span></span>

<span class="token keyword">void</span> <span class="token function">http_cb</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">evhttp_request</span> <span class="token operator">*</span>request<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>arg<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"http_cb"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token comment">//1 获取浏览器的请求信息</span>
	<span class="token comment">//uri </span>
	<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>uri <span class="token operator">=</span> <span class="token function">evhttp_request_get_uri</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"uri:"</span> <span class="token operator">&lt;&lt;</span> uri <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	<span class="token comment">//请求类型 GET POST</span>
	string cmdtype<span class="token punctuation">;</span>
	<span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token function">evhttp_request_get_command</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">case</span> EVHTTP_REQ_GET<span class="token operator">:</span>
		cmdtype <span class="token operator">=</span> <span class="token string">"GET"</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> EVHTTP_REQ_POST<span class="token operator">:</span>
		cmdtype <span class="token operator">=</span> <span class="token string">"POST"</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"cmdtype:"</span> <span class="token operator">&lt;&lt;</span> cmdtype <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	<span class="token comment">// 消息报头</span>
	evkeyvalq <span class="token operator">*</span>headers <span class="token operator">=</span> <span class="token function">evhttp_request_get_input_headers</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"====== headers ======"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span>evkeyval <span class="token operator">*</span>p <span class="token operator">=</span> headers<span class="token operator">-&gt;</span>tqh_first<span class="token punctuation">;</span> p <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span> p <span class="token operator">=</span> p<span class="token operator">-&gt;</span>next<span class="token punctuation">.</span>tqe_next<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> p<span class="token operator">-&gt;</span>key <span class="token operator">&lt;&lt;</span> <span class="token string">":"</span> <span class="token operator">&lt;&lt;</span> p<span class="token operator">-&gt;</span>value <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 请求正文 (GET为空，POST有表单信息  )</span>
	evbuffer <span class="token operator">*</span>inbuf <span class="token operator">=</span> <span class="token function">evhttp_request_get_input_buffer</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> buf<span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"======= Input data ======"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">evbuffer_get_length</span><span class="token punctuation">(</span>inbuf<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token function">evbuffer_remove</span><span class="token punctuation">(</span>inbuf<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			buf<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'\0'</span><span class="token punctuation">;</span>
			cout <span class="token operator">&lt;&lt;</span> buf <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//2 回复浏览器</span>
	<span class="token comment">//状态行 消息报头 响应正文 HTTP_NOTFOUND HTTP_INTERNAL</span>
	string filepath <span class="token operator">=</span> WEBROOT<span class="token punctuation">;</span>
	filepath <span class="token operator">+=</span> uri<span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strcmp</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token string">"/"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//默认加入首页文件</span>
		filepath <span class="token operator">+=</span> DEFAULTINDEX<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//消息报头</span>
	evkeyvalq <span class="token operator">*</span>outhead <span class="token operator">=</span> <span class="token function">evhttp_request_get_output_headers</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//  要支持 图片 js css 下载zip文件</span>
	<span class="token comment">//  获取文件的后缀</span>
	<span class="token comment">// ./index.html</span>
	<span class="token keyword">int</span> pos <span class="token operator">=</span> filepath<span class="token punctuation">.</span><span class="token function">rfind</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	string postfix <span class="token operator">=</span> filepath<span class="token punctuation">.</span><span class="token function">substr</span><span class="token punctuation">(</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> filepath<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>pos <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>postfix <span class="token operator">==</span> <span class="token string">"jpg"</span> <span class="token operator">||</span> postfix <span class="token operator">==</span> <span class="token string">"gif"</span> <span class="token operator">||</span> postfix <span class="token operator">==</span> <span class="token string">"png"</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		string tmp <span class="token operator">=</span> <span class="token string">"image/"</span> <span class="token operator">+</span> postfix<span class="token punctuation">;</span>
		<span class="token function">evhttp_add_header</span><span class="token punctuation">(</span>outhead<span class="token punctuation">,</span> <span class="token string">"Content-Type"</span><span class="token punctuation">,</span> tmp<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>postfix <span class="token operator">==</span> <span class="token string">"zip"</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">evhttp_add_header</span><span class="token punctuation">(</span>outhead<span class="token punctuation">,</span> <span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"application/zip"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>postfix <span class="token operator">==</span> <span class="token string">"html"</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">evhttp_add_header</span><span class="token punctuation">(</span>outhead<span class="token punctuation">,</span> <span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"text/html;charset=UTF8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//evhttp_add_header(outhead, "Content-Type", "text/html");</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>postfix <span class="token operator">==</span> <span class="token string">"css"</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">evhttp_add_header</span><span class="token punctuation">(</span>outhead<span class="token punctuation">,</span> <span class="token string">"Content-Type"</span><span class="token punctuation">,</span> <span class="token string">"text/css"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//读取html文件返回正文</span>
	FILE <span class="token operator">*</span>fp <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span>filepath<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fp<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">evhttp_send_reply</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> HTTP_NOTFOUND<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	evbuffer <span class="token operator">*</span>outbuf <span class="token operator">=</span> <span class="token function">evhttp_request_get_output_buffer</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token function">fread</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span> fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>len <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token function">evbuffer_add</span><span class="token punctuation">(</span>outbuf<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">fclose</span><span class="token punctuation">(</span>fp<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">evhttp_send_reply</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> HTTP_OK<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> outbuf<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span><span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">_WIN32 </span></span>
	<span class="token comment">//初始化socket库</span>
	WSADATA wsa<span class="token punctuation">;</span>
	<span class="token function">WSAStartup</span><span class="token punctuation">(</span><span class="token function">MAKEWORD</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>wsa<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
	<span class="token comment">//忽略管道信号，发送数据给已关闭的socket</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">signal</span><span class="token punctuation">(</span>SIGPIPE<span class="token punctuation">,</span> SIG_IGN<span class="token punctuation">)</span> <span class="token operator">==</span> SIG_ERR<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

	std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"test server!\n"</span><span class="token punctuation">;</span> 
	<span class="token comment">//创建libevent的上下文</span>
	event_base <span class="token operator">*</span> base <span class="token operator">=</span> <span class="token function">event_base_new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>base<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"event_base_new success!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// http  服务器</span>
	<span class="token comment">//1	创建evhttp上下文</span>
	evhttp <span class="token operator">*</span>evh <span class="token operator">=</span> <span class="token function">evhttp_new</span><span class="token punctuation">(</span>base<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//2  绑定端口和IP</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">evhttp_bind_socket</span><span class="token punctuation">(</span>evh<span class="token punctuation">,</span> <span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span> <span class="token number">8080</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"evhttp_bind_socket failed!"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//3   设定回调函数</span>
	<span class="token function">evhttp_set_gencb</span><span class="token punctuation">(</span>evh<span class="token punctuation">,</span> http_cb<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//事件分发处理</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>base<span class="token punctuation">)</span>
		<span class="token function">event_base_dispatch</span><span class="token punctuation">(</span>base<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>base<span class="token punctuation">)</span>
		<span class="token function">event_base_free</span><span class="token punctuation">(</span>base<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>evh<span class="token punctuation">)</span>
		<span class="token function">evhttp_free</span><span class="token punctuation">(</span>evh<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="indexhtml_397"></a>index.html文件</h4> 
<pre><code class="prism language-c"><span class="token operator">&lt;</span>HTML<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>HEAD<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>meta charset<span class="token operator">=</span> <span class="token string">"UTF8"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>TITLE<span class="token operator">&gt;</span>test http server<span class="token operator">&lt;</span><span class="token operator">/</span>TITLE<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>HEAD<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>BODY<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>test http server<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
    <span class="token number">1234567890</span>
      测试中文  
    <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token string">"test.jpg"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>form method<span class="token operator">=</span><span class="token string">"post"</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"text"</span> name<span class="token operator">=</span><span class="token string">"username"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"password"</span> name<span class="token operator">=</span><span class="token string">"password"</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>input type<span class="token operator">=</span><span class="token string">"submit"</span> name<span class="token operator">=</span><span class="token string">"submit"</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>form<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>BODY<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>HTML<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="_419"></a>运行效果</h4> 
<p><img src="https://images2.imgbox.com/ff/d3/NYsp8o7F_o.png" alt="请添加图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cd3426f896daaba2a9ecab5ce30e5883/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">libevent高并发网络编程 - 06_基于libevent的C&#43;&#43;线程池实现</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/285deafc9dbafba898fe16d6faeadadd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">rtl仿真器-incisive安装和测试</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>