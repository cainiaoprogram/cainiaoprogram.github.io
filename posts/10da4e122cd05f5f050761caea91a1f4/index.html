<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用Docker容器运行Mysql - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用Docker容器运行Mysql" />
<meta property="og:description" content="提示：文章写完后，目录可以自动生成，如何生成可参考右边的帮助文档
使用Docker容器运行Mysql 前言一、基础的虚拟机环境二、安装过程安装配置docker拉取Mysql镜像用docker启动mysql命令的使用和参数具体解释如下：1.必要参数：2.数据卷配置参数：3.MySQL账户安全参数：4.容器启动参数： 总结 前言 随着虚拟化技术和云计算的普及，容器技术的优点也逐步体现，软件部署和环境迁移的优势无可替代。
目前Docker已经成为容器技术中的主要代表，恰好涉及需要在liunux系统上部署Mysql数据库用于测试，由于是初次使用docker部署Mysql，所以对其中一些操作进行记录。
一、基础的虚拟机环境 使用虚拟机，安装ubuntu系统，发行版和内核信息如下：
root@ldap:/# cat /etc/lsb-release DISTRIB_ID=Ubuntu DISTRIB_RELEASE=22.04 DISTRIB_CODENAME=jammy DISTRIB_DESCRIPTION=&#34;Ubuntu 22.04.2 LTS&#34; root@ldap:/# uname -r 5.15.0-72-generic root@ldap:/# 只所以使用ubuntu是因为centos各大镜像站都已经停止维护，在基础系统安装过程中，经常出现一些莫名其妙的问题，虽然可以解决但比较浪费时间。
二、安装过程 安装配置docker # 安装 docker 和 docker-compose #先移除docker。其实也不用重装docker，我用的ubuntu里已经安装了完整的docker，但我想用用华为云发布的docker-ce，所以就按说明对原docker进行了移除操作 #如果不是root用户，则需要加sudo，否则不用。 sudo apt remove docker docker-engine dockdocker.io containerd runc #更新后，安装依赖，apt源已经改为华为镜像源 sudo apt update sudo apt install -y \ apt-transport-https \ ca-certificates \ curl \ gnupg-agent \ software-properties-common #运行公钥，添加docker软件仓库 curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - sudo add-apt-repository \ &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/10da4e122cd05f5f050761caea91a1f4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-29T09:35:32+08:00" />
<meta property="article:modified_time" content="2023-05-29T09:35:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用Docker容器运行Mysql</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>提示：文章写完后，目录可以自动生成，如何生成可参考右边的帮助文档</p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>使用Docker容器运行Mysql</h4> 
 <ul><li><a href="#_7" rel="nofollow">前言</a></li><li><a href="#_14" rel="nofollow">一、基础的虚拟机环境</a></li><li><a href="#_27" rel="nofollow">二、安装过程</a></li><li><ul><li><a href="#docker_28" rel="nofollow">安装配置docker</a></li><li><a href="#Mysql_63" rel="nofollow">拉取Mysql镜像</a></li><li><a href="#dockermysql_98" rel="nofollow">用docker启动mysql</a></li><li><ul><li><a href="#_107" rel="nofollow">命令的使用和参数具体解释如下：</a></li><li><ul><li><a href="#1_108" rel="nofollow">1.必要参数：</a></li><li><a href="#2_112" rel="nofollow">2.数据卷配置参数：</a></li><li><a href="#3MySQL_117" rel="nofollow">3.MySQL账户安全参数：</a></li><li><a href="#4_120" rel="nofollow">4.容器启动参数：</a></li></ul> 
   </li></ul> 
  </li></ul> 
  </li><li><a href="#_184" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_7"></a>前言</h2> 
<p>随着虚拟化技术和云计算的普及，容器技术的优点也逐步体现，软件部署和环境迁移的优势无可替代。<br> 目前Docker已经成为容器技术中的主要代表，恰好涉及需要在liunux系统上部署Mysql数据库用于测试，由于是初次使用docker部署Mysql，所以对其中一些操作进行记录。</p> 
<hr> 
<h2><a id="_14"></a>一、基础的虚拟机环境</h2> 
<p>使用虚拟机，安装ubuntu系统，发行版和内核信息如下：</p> 
<pre><code class="prism language-bash">root@ldap:/<span class="token comment"># cat /etc/lsb-release </span>
<span class="token assign-left variable">DISTRIB_ID</span><span class="token operator">=</span>Ubuntu
<span class="token assign-left variable">DISTRIB_RELEASE</span><span class="token operator">=</span><span class="token number">22.04</span>
<span class="token assign-left variable">DISTRIB_CODENAME</span><span class="token operator">=</span>jammy
<span class="token assign-left variable">DISTRIB_DESCRIPTION</span><span class="token operator">=</span><span class="token string">"Ubuntu 22.04.2 LTS"</span>
root@ldap:/<span class="token comment"># uname -r</span>
<span class="token number">5.15</span>.0-72-generic
root@ldap:/<span class="token comment"># </span>
</code></pre> 
<p>只所以使用ubuntu是因为centos各大镜像站都已经停止维护，在基础系统安装过程中，经常出现一些莫名其妙的问题，虽然可以解决但比较浪费时间。</p> 
<h2><a id="_27"></a>二、安装过程</h2> 
<h3><a id="docker_28"></a>安装配置docker</h3> 
<pre><code class="prism language-bash"><span class="token comment"># 安装 docker 和 docker-compose</span>
<span class="token comment">#先移除docker。其实也不用重装docker，我用的ubuntu里已经安装了完整的docker，但我想用用华为云发布的docker-ce，所以就按说明对原docker进行了移除操作</span>
<span class="token comment">#如果不是root用户，则需要加sudo，否则不用。</span>
<span class="token function">sudo</span> <span class="token function">apt</span> remove docker docker-engine dockdocker.io containerd runc
<span class="token comment">#更新后，安装依赖，apt源已经改为华为镜像源</span>
<span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span>  -y <span class="token punctuation">\</span>
    apt-transport-https <span class="token punctuation">\</span>
    ca-certificates <span class="token punctuation">\</span>
    <span class="token function">curl</span> <span class="token punctuation">\</span>
    gnupg-agent <span class="token punctuation">\</span>
    software-properties-common
<span class="token comment">#运行公钥，添加docker软件仓库</span>
<span class="token function">curl</span> -fsSL https://download.docker.com/linux/ubuntu/gpg <span class="token operator">|</span> <span class="token function">sudo</span> apt-key <span class="token function">add</span> -
<span class="token function">sudo</span> add-apt-repository <span class="token punctuation">\</span>
<span class="token string">"deb [arch=amd64] https://download.docker.com/linux/ubuntu \
<span class="token variable"><span class="token variable">$(</span>lsb_release -cs<span class="token variable">)</span></span> \
stable"</span>
<span class="token comment">#安装docker-ce docker-ce-clicontainerd.io</span>
<span class="token function">sudo</span> <span class="token function">apt</span> update
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> docker-ce docker-ce-cli containerd.io -y

<span class="token comment">#sudo curl -L "https://github.com/docker/compose/releases/download/1.25.3/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose</span>
<span class="token comment">#sleep 1</span>
<span class="token comment">#sudo chmod +x /usr/local/bin/docker-compose</span>
<span class="token comment">#安装docker-compose</span>
<span class="token function">apt</span> <span class="token function">install</span> docker-compose docker-compose-plugin -y

<span class="token comment">#启动docker,开机自启动</span>
systemctl start docker
systemctl <span class="token builtin class-name">enable</span> docker
</code></pre> 
<h3><a id="Mysql_63"></a>拉取Mysql镜像</h3> 
<pre><code class="prism language-bash"><span class="token comment">#查看仓库mysql镜像</span>
<span class="token comment">#docker search mysql</span>
docker search mysql
NAME                            DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
mysql                           MySQL is a widely used, open-source relation…   <span class="token number">14159</span>     <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>       
mariadb                         MariaDB Server is a high performing <span class="token function">open</span> sou…   <span class="token number">5408</span>      <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>       
percona                         Percona Server is a fork of the MySQL relati…   <span class="token number">609</span>       <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>       
phpmyadmin                      phpMyAdmin - A web interface <span class="token keyword">for</span> MySQL and M…   <span class="token number">802</span>       <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>       
circleci/mysql                  MySQL is a widely used, open-source relation…   <span class="token number">29</span>                   
bitnami/mysql                   Bitnami MySQL Docker Image                      <span class="token number">86</span>                   <span class="token punctuation">[</span>OK<span class="token punctuation">]</span>
bitnami/mysqld-exporter                                                         <span class="token number">5</span>                    
ubuntu/mysql
<span class="token comment">#使用命令docker pull mysql ,默认tag：latest</span>
docker pull mysql
Using default tag: latest
latest: Pulling from library/mysql
90e2fb2facff: Pull complete 
ba60eb20fd5f: Pull complete 
4f509402d469: Pull complete 
496c2cfa6815: Pull complete 
8ec1dfa9522c: Pull complete 
6dec7ba896f8: Pull complete 
dc9ff75362b0: Pull complete 
73e4682f9014: Pull complete 
9ffdeecd6fb6: Pull complete 
a4346ccfb53f: Pull complete 
434c13bc32de: Pull complete 
Digest: sha256:d6164ff4855b9b3f2c7748c6ec564ccff841f79a7023db0f9293143481a44b6e
Status: Downloaded newer image <span class="token keyword">for</span> mysql:latest
docker.io/library/mysql:latest
   
</code></pre> 
<h3><a id="dockermysql_98"></a>用docker启动mysql</h3> 
<pre><code class="prism language-bash">docker run -p <span class="token number">3306</span>:3306 --name mysql -v /mydata/mysql/log:/var/log/mysql -v /mydata/mysql/data:/var/lib/mysql -v /mydata/mysql/conf:/etc/mysql -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root -d mysql:latest
60bc33b60efa81c32d93e3452fd5fbe3a5d72c4cfc898d77af1a70a83cdd77e5
root@l:/<span class="token comment"># </span>
root@l:/<span class="token comment"># docker ps</span>
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
root@:/<span class="token comment"># </span>
</code></pre> 
<h4><a id="_107"></a>命令的使用和参数具体解释如下：</h4> 
<h5><a id="1_108"></a>1.必要参数：</h5> 
<p>-p 3306:3306：将宿主主机的3306端口映射到容器的3306端口，使宿主主机可以连接容器内的MySQL服务。<br> –name mysql：为容器命名为mysql。</p> 
<h5><a id="2_112"></a>2.数据卷配置参数：</h5> 
<p>-v /mydata/mysql/log:/var/log/mysql：将宿主机上的/mydata/mysql/log目录挂载到容器的/var/log/mysql目录下，用于存储MySQL的日志文件。<br> -v /mydata/mysql/data:/var/lib/mysql：将宿主机上的/mydata/mysql/data目录挂载到容器的/var/lib/mysql目录下，用于存储MySQL的数据文件。<br> -v /mydata/mysql/conf:/etc/mysql：将宿主机上的/mydata/mysql/conf目录挂载到容器的/etc/mysql目录下，用于存储MySQL的配置文件。</p> 
<h5><a id="3MySQL_117"></a>3.MySQL账户安全参数：</h5> 
<p>-e MYSQL_ROOT_PASSWORD=root：设置MySQL的root账户密码为root。建议设置复杂的密码。</p> 
<h5><a id="4_120"></a>4.容器启动参数：</h5> 
<p>-d mysql:lates：使用MySQL:lates镜像,在宿主机后台启动容器，并命名为mysql。</p> 
<p>通过以上参数配置，可以实现对MySQL容器的定制化部署，提高应用程序的性能和可靠性。</p> 
<p>这时候，返回一串字符“60bc33b60efa81c32d93e3452fd5fbe3a5d72c4cfc898d77af1a70a83cdd77e5”<br> 表示命令正常执行，而且已经运行了Mysql镜像容器。</p> 
<p>当然，如果你这样做了，会发现：</p> 
<pre><code class="prism language-bash"><span class="token comment">#使用docker ps查看不到mysql的进程</span>
docker <span class="token function">ps</span>
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES

<span class="token comment">#加参数-a后是有记录的</span>
<span class="token comment"># docker ps -a</span>
docker <span class="token function">ps</span> -a
CONTAINER ID   IMAGE     COMMAND                  CREATED      STATUS                  PORTS     NAMES
60bc33b60efa   mysql     <span class="token string">"docker-entrypoint.s…"</span>   <span class="token number">2</span> days ago   Exited <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">2</span> days ago             mysql
</code></pre> 
<p>原因是：虽然成功运行的了mysql容器，但是容器中没有在执行的程序，所以容器自动停止了。</p> 
<p>你可以根据自己的需要，在启动时添加容器运行参数，例如</p> 
<pre><code class="prism language-bash"><span class="token comment">#以交互方式运行容器，并加载bash指令集</span>
<span class="token comment">#docker run -it -p 3306:3306 --name mysql_new1 -e MYSQL_ROOT_PASSWORD=root -d mysql bash</span>
<span class="token comment">#之前使用centos、ubuntu等基础镜像时，使用参数-it后，会进入到容器内，但这里不知道为什么，命令符还是宿主机的</span>
docker run it -e <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>root -d mysql <span class="token function">bash</span>

101258d2fdbf87f97dd533a05f164e2c6ec152e170a497b4ac787723cfc2cc81
<span class="token comment"># docker ps就可以看到运行容器状态</span>
docker <span class="token function">ps</span>
CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS                                                  NAMES
101258d2fdbf   mysql     <span class="token string">"docker-entrypoint.s…"</span>   <span class="token number">7</span> seconds ago   Up <span class="token number">6</span> seconds   <span class="token number">0.0</span>.0.0:3306-<span class="token operator">&gt;</span><span class="token number">3306</span>/tcp, :::3306-<span class="token operator">&gt;</span><span class="token number">3306</span>/tcp, <span class="token number">33060</span>/tcp   mysql_new1

<span class="token comment">#进入容器:docker exec -it mysql bash</span>
docker <span class="token builtin class-name">exec</span> -it <span class="token number">101</span> <span class="token function">bash</span>
bash-4.4<span class="token comment"># ls</span>
bin   dev			  entrypoint.sh  home  lib64  mnt  proc  run   srv  tmp  var
boot  docker-entrypoint-initdb.d  etc		 lib   media  opt  root  sbin  sys  usr

bash-4.4<span class="token comment"># cat /etc/os-release </span>
<span class="token assign-left variable">NAME</span><span class="token operator">=</span><span class="token string">"Oracle Linux Server"</span>
<span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token string">"8.8"</span>
<span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token string">"ol"</span>
<span class="token assign-left variable">ID_LIKE</span><span class="token operator">=</span><span class="token string">"fedora"</span>
<span class="token assign-left variable">VARIANT</span><span class="token operator">=</span><span class="token string">"Server"</span>
<span class="token assign-left variable">VARIANT_ID</span><span class="token operator">=</span><span class="token string">"server"</span>
<span class="token assign-left variable">VERSION_ID</span><span class="token operator">=</span><span class="token string">"8.8"</span>
<span class="token assign-left variable">PLATFORM_ID</span><span class="token operator">=</span><span class="token string">"platform:el8"</span>
<span class="token assign-left variable">PRETTY_NAME</span><span class="token operator">=</span><span class="token string">"Oracle Linux Server 8.8"</span>
<span class="token assign-left variable">ANSI_COLOR</span><span class="token operator">=</span><span class="token string">"0;31"</span>
<span class="token assign-left variable">CPE_NAME</span><span class="token operator">=</span><span class="token string">"cpe:/o:oracle:linux:8:8:server"</span>
<span class="token assign-left variable">HOME_URL</span><span class="token operator">=</span><span class="token string">"https://linux.oracle.com/"</span>
<span class="token assign-left variable">BUG_REPORT_URL</span><span class="token operator">=</span><span class="token string">"https://bugzilla.oracle.com/"</span>

<span class="token assign-left variable">ORACLE_BUGZILLA_PRODUCT</span><span class="token operator">=</span><span class="token string">"Oracle Linux 8"</span>
<span class="token assign-left variable">ORACLE_BUGZILLA_PRODUCT_VERSION</span><span class="token operator">=</span><span class="token number">8.8</span>
<span class="token assign-left variable">ORACLE_SUPPORT_PRODUCT</span><span class="token operator">=</span><span class="token string">"Oracle Linux"</span>
<span class="token assign-left variable">ORACLE_SUPPORT_PRODUCT_VERSION</span><span class="token operator">=</span><span class="token number">8.8</span>

<span class="token comment">#尴尬了，没用过Oracle Linux 8</span>
</code></pre> 
<h2><a id="_184"></a>总结</h2> 
<p>以上就是我使用docker运行mysql的过程记录，docker的使用使用虽然简单而且便利，但对不同程序镜像运行容器时，还是要对具体要运行的程序有一定的了解，比如mysql，至少要知道一些mysql的使用命令或者参数。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b673d8cef3a01c2621ebbb3794b7db3e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C#/.Net开发chatGPT、openAI的简单步骤</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8439dee124ce46fa8a19dac24a93c6f4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Digicert证书是什么？有哪些类型？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>