<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android应用间共享目录,FileProvider（应用间共享文件） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android应用间共享目录,FileProvider（应用间共享文件）" />
<meta property="og:description" content="可参考《第一行代码》第八章8.3内容。
简介
Android 7.0强制启用了被称作 StrictMode的策略，带来的影响就是你的App对外无法暴露file://类型的URI了。
如果你使用Intent携带这样的URI去打开外部App(比如：打开系统相机拍照)，那么会抛出FileUriExposedException异常。
官方给出解决这个问题的方案，就是使用FileProvider
FileProvider使用步骤
manifest中申明FileProvider
res/xml中定义对外暴露的文件夹路径
生成content://类型的Uri
给Uri授予临时权限
使用Intent传递Uri
1.manifest中申明FileProvider：
...
...
android:name=&#34;android.support.v4.content.FileProvider&#34;
android:authorities=&#34;com.mydomain.fileprovider&#34;
android:exported=&#34;false&#34;
android:grantUriPermissions=&#34;true&#34;&gt;
...
...
android:name：provider你可以使用v4包提供的FileProvider，或者自定义您自己的，只需要在name申明就好了，一般使用系统的就足够了。
android:authorities：类似schema，命名空间之类，后面会用到。
android:exported：false表示我们的provider不需要对外开放。
android:grantUriPermissions：申明为true，你才能获取临时共享权限。
2. res/xml中定义对外暴露的文件夹路径：
新建file_paths.xml，文件名随便起，后面会引用到。
name：一个引用字符串。
path：文件夹“相对路径”，完整路径取决于当前的标签类型。path可以为空，表示指定目录下的所有文件、文件夹都可以被共享。
这个元素内可以包含以下一个或多个，具体如下：
注意：external-cache-path在support-v4:24.0.0这个版本并未支持，直到support-v4:25.0.0才支持，最近适配才发现这个坑!
以上是官方提供的几种path类型，不过如果你想使用外置SD卡，可以用这个
物理路径相当于/path/
编写好file_paths.xml，我们在manifest中的provider这样使用：
android:name=&#34;android.support.v4.content.FileProvider&#34;
android:authorities=&#34;com.mydomain.fileprovider&#34;
android:exported=&#34;false&#34;
android:grantUriPermissions=&#34;true&#34;&gt;
android:name=&#34;android.support.FILE_PROVIDER_PATHS&#34;
android:resource=&#34;@xml/file_paths&#34; /&gt;
3.生成content://类型的Uri
我们通常通过File生成Uri的代码是这样：
File picFile = xxx;
Uri picUri = Uri.fromFile(picFile);
这样生成的Uri，路径格式为file://xxx。前面我们也说了这种Uri是无法在App之间共享的，我们需要生成content://xxx类型的Uri，方法就是通过Context.getUriForFile来实现：
File imagePath = new File(Context.getFilesDir(), &#34;images&#34;);
File newFile = new File(imagePath, &#34;default_image.jpg&#34;);
Uri contentUri = FileProvider." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/770498257acbce43b51200c836910c59/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-31T10:11:24+08:00" />
<meta property="article:modified_time" content="2021-05-31T10:11:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android应用间共享目录,FileProvider（应用间共享文件）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>可参考《第一行代码》第八章8.3内容。</p> 
 <p>简介</p> 
 <p>Android 7.0强制启用了被称作 StrictMode的策略，带来的影响就是你的App对外无法暴露file://类型的URI了。</p> 
 <p>如果你使用Intent携带这样的URI去打开外部App(比如：打开系统相机拍照)，那么会抛出FileUriExposedException异常。</p> 
 <p>官方给出解决这个问题的方案，就是使用FileProvider</p> 
 <p>FileProvider使用步骤</p> 
 <p>manifest中申明FileProvider</p> 
 <p>res/xml中定义对外暴露的文件夹路径</p> 
 <p>生成content://类型的Uri</p> 
 <p>给Uri授予临时权限</p> 
 <p>使用Intent传递Uri</p> 
 <p>1.manifest中申明FileProvider：</p> 
 <p>...</p> 
 <p>...</p> 
 <p></p> 
 <p>android:name="android.support.v4.content.FileProvider"</p> 
 <p>android:authorities="com.mydomain.fileprovider"</p> 
 <p>android:exported="false"</p> 
 <p>android:grantUriPermissions="true"&gt;</p> 
 <p>...</p> 
 <p>...</p> 
 <p>android:name：provider你可以使用v4包提供的FileProvider，或者自定义您自己的，只需要在name申明就好了，一般使用系统的就足够了。</p> 
 <p>android:authorities：类似schema，命名空间之类，后面会用到。</p> 
 <p>android:exported：false表示我们的provider不需要对外开放。</p> 
 <p>android:grantUriPermissions：申明为true，你才能获取临时共享权限。</p> 
 <p>2. res/xml中定义对外暴露的文件夹路径：</p> 
 <p>新建file_paths.xml，文件名随便起，后面会引用到。</p> 
 <p>name：一个引用字符串。</p> 
 <p>path：文件夹“相对路径”，完整路径取决于当前的标签类型。path可以为空，表示指定目录下的所有文件、文件夹都可以被共享。</p> 
 <p>这个元素内可以包含以下一个或多个，具体如下：</p> 
 <p>注意：external-cache-path在support-v4:24.0.0这个版本并未支持，直到support-v4:25.0.0才支持，最近适配才发现这个坑!</p> 
 <p>以上是官方提供的几种path类型，不过如果你想使用外置SD卡，可以用这个</p> 
 <p>物理路径相当于/path/</p> 
 <p>编写好file_paths.xml，我们在manifest中的provider这样使用：</p> 
 <p></p> 
 <p>android:name="android.support.v4.content.FileProvider"</p> 
 <p>android:authorities="com.mydomain.fileprovider"</p> 
 <p>android:exported="false"</p> 
 <p>android:grantUriPermissions="true"&gt;</p> 
 <p></p> 
 <p>android:name="android.support.FILE_PROVIDER_PATHS"</p> 
 <p>android:resource="@xml/file_paths" /&gt;</p> 
 <p>3.生成content://类型的Uri</p> 
 <p>我们通常通过File生成Uri的代码是这样：</p> 
 <p>File picFile = xxx;</p> 
 <p>Uri picUri = Uri.fromFile(picFile);</p> 
 <p>这样生成的Uri，路径格式为file://xxx。前面我们也说了这种Uri是无法在App之间共享的，我们需要生成content://xxx类型的Uri，方法就是通过Context.getUriForFile来实现：</p> 
 <p>File imagePath = new File(Context.getFilesDir(), "images");</p> 
 <p>File newFile = new File(imagePath, "default_image.jpg");</p> 
 <p>Uri contentUri = FileProvider.getUriForFile(getContext(),</p> 
 <p>"com.mydomain.fileprovider", newFile);</p> 
 <p>imagePath：使用的路径需要和你在file_paths.xml申明的其中一个符合(或者子文件夹："images/work")。当然，你可以申明N个你需要共享的路径：</p> 
 <p>//...</p> 
 <p>getUriForFile：第一个参数是Context；第二个参数，就是我们之前在manifest#provider中定义的android:authorities属性的值；第三个参数是File。</p> 
 <p>4.给Uri授予临时权限</p> 
 <p>intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION</p> 
 <p>| Intent.FLAG_GRANT_WRITE_URI_PERMISSION);</p> 
 <p>FLAG_GRANT_READ_URI_PERMISSION：表示读取权限；</p> 
 <p>FLAG_GRANT_WRITE_URI_PERMISSION：表示写入权限。</p> 
 <p>你可以同时或单独使用这两个权限，视你的需求而定。</p> 
 <p>5.使用Intent传递Uri</p> 
 <p>以开头的拍照代码作为示例，需要这样改写：</p> 
 <p>// 重新构造Uri：content://</p> 
 <p>File imagePath = new File(Context.getFilesDir(), "images");</p> 
 <p>if (!imagePath.exists()){imagePath.mkdirs();}</p> 
 <p>File newFile = new File(imagePath, "default_image.jpg");</p> 
 <p>Uri contentUri = getUriForFile(getContext(),</p> 
 <p>"com.mydomain.fileprovider", newFile);</p> 
 <p>Intent intent = new Intent(MediaStore.ACTION_IMAGE_CAPTURE);</p> 
 <p>intent.putExtra(MediaStore.EXTRA_OUTPUT, contentUri);</p> 
 <p>// 授予目录临时共享权限</p> 
 <p>intent.addFlags(Intent.FLAG_GRANT_READ_URI_PERMISSION</p> 
 <p>| Intent.FLAG_GRANT_WRITE_URI_PERMISSION);</p> 
 <p>startActivityForResult(intent, 100);</p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a1b1e65e20e8e3e406776e4c6d443a03/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">html从json格式取某字段,从服务器端获取JSON格式字符串并解决到前端页面中显示；使用JSON改写表单验证案例（使用JSON.parse()来把JSON格式转变为js对象的运用）2019年5月1...</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2076a530854203a3619f0436f54ef8f3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JavaScript模块化 （CommonJS、AMD、CMD和ES6&#43;）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>