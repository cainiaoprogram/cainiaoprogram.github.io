<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Flutter】自动测试探索 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Flutter】自动测试探索" />
<meta property="og:description" content="根据flutter官方文档的说明，flutter可以对我们的应用，进行自动化测试，保证我们应用的稳定性和功能的完整性，并且可以快速修复问题。
自动化测试可分为以下几类：
单元测试：测试单一的函数，方法或类
组件测试：测试单一的 widget
集成测试：测试一个完整的应用或者一个应用的大部分功能。
我的整个探索，也是根据这上面3项项进行的。
官方文档地址：
测试 Flutter 应用 - Flutter 中文文档 - Flutter 中文开发者网站 - Flutter学习不同类型的测试以及如何编写它们。https://flutter.cn/docs/testing
一.单元测试 测试单一的函数，方法或类。单元测试的目标是验证逻辑单元在各种条件下的正确性。因为，在很多对日项目，都在追求单元测试覆盖率的前提下，推荐以一个物理文件为单位，编写一组测试。整个过程如下：
step1.新建一个Flutter 项目 fluttertest并编写一个逻辑处理类lib/counter.dart
class Counter { int value = 0; void increment() =&gt; value&#43;&#43;; void decrement() =&gt; value--; } step2.项目追加test依赖
flutter pub add test
step3.创建一个单元测试类，在test目录中 counter_test.dart
import &#39;package:counter_app/counter.dart&#39;; import &#39;package:test/test.dart&#39;; void main() { group(&#39;Counter&#39;, () { test(&#39;value should start at 0&#39;, () { expect(Counter().value, 0); }); test(&#39;value should be incremented&#39;, () { final counter = Counter(); counter." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/f76204970e5fa91e13b8958f2f4e31dd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-19T14:02:49+08:00" />
<meta property="article:modified_time" content="2023-07-19T14:02:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Flutter】自动测试探索</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>        根据flutter官方文档的说明，flutter可以对我们的应用，进行自动化测试，保证我们应用的稳定性和功能的完整性，并且可以快速修复问题。</p> 
<p>自动化测试可分为以下几类：</p> 
<p><span style="color:#ed7976;"><strong>单元测试：</strong></span>测试单一的函数，方法或类</p> 
<p><span style="color:#ed7976;"><strong>组件测试：</strong></span>测试单一的 widget</p> 
<p><span style="color:#ed7976;"><strong>集成测试：</strong></span>测试一个完整的应用或者一个应用的大部分功能。</p> 
<p>        我的整个探索，也是根据这上面3项项进行的。</p> 
<p>官方文档地址：</p> 
<p><a class="has-card" href="https://flutter.cn/docs/testing" rel="nofollow" title="测试 Flutter 应用 - Flutter 中文文档 - Flutter 中文开发者网站 - Flutter"><span class="link-card-box"><span class="link-title">测试 Flutter 应用 - Flutter 中文文档 - Flutter 中文开发者网站 - Flutter</span><span class="link-desc">学习不同类型的测试以及如何编写它们。</span><span class="link-link"><img alt="" class="link-link-icon" src="https://images2.imgbox.com/67/16/wlo76IGD_o.png">https://flutter.cn/docs/testing</span></span></a></p> 
<h2>一.单元测试</h2> 
<p>        测试单一的函数，方法或类。单元测试的目标是验证逻辑单元在各种条件下的正确性。因为，在很多对日项目，都在追求单元测试覆盖率的前提下，推荐以一个物理文件为单位，编写一组测试。整个过程如下：</p> 
<p>        <strong>step1.</strong>新建一个Flutter 项目 fluttertest并编写一个逻辑处理类<span style="color:#ed7976;">lib/counter.dart</span></p> 
<pre><code class="language-Dart">class Counter {
  int value = 0;

  void increment() =&gt; value++;

  void decrement() =&gt; value--;
}</code></pre> 
<p>        <strong>step2</strong>.项目追加test依赖</p> 
<blockquote> 
 <p> flutter pub add test</p> 
</blockquote> 
<p>         <strong>step3.</strong>创建一个单元测试类，在test目录中 <span style="color:#ed7976;">counter_test.dart</span></p> 
<pre><code class="language-Dart">import 'package:counter_app/counter.dart';
import 'package:test/test.dart';

void main() {
  group('Counter', () {
    test('value should start at 0', () {
      expect(Counter().value, 0);
    });

    test('value should be incremented', () {
      final counter = Counter();

      counter.increment();

      expect(counter.value, 1);
    });

    test('value should be decremented', () {
      final counter = Counter();

      counter.decrement();

      expect(counter.value, -1);
    });
  });
}</code></pre> 
<p>        这样单元测试就编写好了，单元测试主要测试的是逻辑处理单元，用到了<span style="color:#ed7976;">test</span>作为一个测试单元，在其中进行相关的测试逻辑编写，并使用<span style="color:#ed7976;">expect</span>进行期望判定，同时，可以通过<span style="color:#ed7976;">group</span>对test进行分类。</p> 
<p>       <strong> step4.</strong>通过命令，可以运行单元测试，并获取相应的测试报告。</p> 
<blockquote> 
 <p>flutter test --coverage </p> 
</blockquote> 
<p>       <strong> step5.</strong>执行上述的测试后，我们可以在项目根目录中找到<span style="color:#ed7976;">coverage</span>文件夹，在文件夹中已经为我们生成好了<span style="color:#ed7976;">lcov.info</span>文件，该文件中计入了测试的覆盖率信息，我们可以通过vscode 上的插件对他进行简单的查看。<a href="https://marketplace.visualstudio.com/items?itemName=alexdima.vscode-lcov" rel="nofollow" title="VSCode LCOV - Visual Studio Marketplace">VSCode LCOV - Visual Studio Marketplace</a></p> 
<p>        当然，我们还需要对这个文件进行转换，生成相应的测试报告。这个转换过程在windows下，我们需要搭建Linux环境，并通过相应的指令进行。环境搭建需要依次安装下面的内容。</p> 
<p>MinGW-W64-&gt;msys2-&gt;lcov 相关的软件我都是在SourceForge上找到并安装。搜关键字即可。<br><a class="has-card" href="https://sourceforge.net/" rel="nofollow" title="Compare, Download &amp; Develop Open Source &amp; Business Software - SourceForge"><span class="link-card-box"><span class="link-title">Compare, Download &amp; Develop Open Source &amp; Business Software - SourceForge</span><span class="link-desc">SourceForge provides free &amp; fast open source software downloads and development, and business software reviews and comparisons featuring the largest open source and business software directory.</span><span class="link-link"><img alt="" class="link-link-icon" src="https://images2.imgbox.com/33/8d/nm6vlV9k_o.png">https://sourceforge.net/</span></span></a><a class="has-card" href="https://ltp.sourceforge.net/coverage/lcov.php" rel="nofollow" title="Linux Test Project - Coverage » lcov (sourceforge.net)"><span class="link-card-box"><span class="link-title">Linux Test Project - Coverage » lcov (sourceforge.net)</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/e0/10/zBJbgI9T_o.png" alt="icon-default.png?t=N6B9">https://ltp.sourceforge.net/coverage/lcov.php</span></span></a></p> 
<p>安装的简单说明：不会的不明白的可以自己百度，这个没什么难度。不浪费篇幅，贴图了。</p> 
<blockquote> 
 <ul><li>MinGW-W64 和msys2都只下一步就可以了。</li><li>lcov 是解压文件，需要解压，并把lcov、gendesc、genhtml、geninfo、genpng复制到mingw64的bin目录下。然后在吧整个bin目录加到系统的环境变量中path中。</li><li>找到msys2的shell入口cmd文件C:\msys64\msys2_shell.cmd,修改该文件。检索set MSYS2_PATH_TYPE=inherit 把该行的rem去掉，让其在cmd运行时执行，以便把我们的windows系统环境变量，加入到msys2中。</li></ul> 
</blockquote> 
<p>        经过上面的安装，我们再msys2的shell环境中，进入到我们的项目目录，如果你的项目在e盘，你需要通过<span style="color:#ed7976;">cd /e/ </span>来进入。</p> 
<p>当你进入到的项目根目录后，你需要执行下面的指令，来完成转换</p> 
<blockquote> 
 <p>genhtml coverage/lcov.info -o coverage/html</p> 
</blockquote> 
<pre><code class="language-bash">Administrator@BAC1901170-PC MSYS /e/test/fluttertest
$ genhtml coverage/lcov.info -o coverage/html
Reading data file coverage/lcov.info
Resolved relative source file path "lib\counter.dart" with CWD to "/e/test/fluttertest/lib/counter.dart".
Found 2 entries.
Found common filename prefix "/e/test/fluttertest"
Writing .css and .png files.
Generating output.
Processing file lib/main.dart
Processing file lib/counter.dart
Writing directory view page.
Overall coverage rate:
  lines......: 92.3% (24 of 26 lines)
  functions..: no data found
</code></pre> 
<p>然后再到自己的根目录下，就可以看到html文件夹，双击<span style="color:#ed7976;">html/index.html </span><span style="color:#0d0016;">就可以看到报告了。</span></p> 
<p><img alt="" height="1080" src="https://images2.imgbox.com/54/2c/mJPN75Gp_o.png" width="1200"></p> 
<blockquote> 
 <p>总结：</p> 
 <p>上述内容容易理解，记住一下二点即可：</p> 
 <p>1.flutter单元测试主要用到 test expect group 三个函数</p> 
 <p>2.理解到单元测试的主要目标是，测试逻辑的正确性</p> 
 <p><em>另外：覆盖率是度量测试完整性的一个手段,是测试有效性的一个度量</em></p> 
 <p><em>测试覆盖是对测试完全程度的评测。</em><a href="https://baike.baidu.com/item/%E8%A6%86%E7%9B%96%E7%8E%87/4520224" rel="nofollow" title="覆盖率_百度百科">覆盖率_百度百科</a></p> 
</blockquote> 
<h2><span style="color:#0d0016;">2.<strong>组件测试</strong></span></h2> 
<p>        组件测试，就是widget测试，对widget类的测试，这部分的测试弥补了单元测试只能测试业务逻辑而不能测试画面组件的缺憾。从而提高我们整个测试的覆盖率。</p> 
<p>        当你新建一个flutter项目时，创建模板就已经将组件测试包含到你的项目中了，你无需再添加flutter_test依赖，就可以使用他了。</p> 
<pre><code class="language-Groovy">dev_dependencies:
  flutter_test:
    sdk: flutter</code></pre> 
<p>        当然你也将在test文件夹中，找到widget_test文件，在这个文件里已经编写好了一个典型的widget测试。我们一起学习一下他的构造。</p> 
<pre><code class="language-Groovy">import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';

import 'package:fluttertest/main.dart';

void main() {
  testWidgets('Counter increments smoke test', (WidgetTester tester) async {
    // Build our app and trigger a frame.
    await tester.pumpWidget(const MyApp());

    // Verify that our counter starts at 0.
    expect(find.text('0'), findsOneWidget);
    expect(find.text('1'), findsNothing);

    // Tap the '+' icon and trigger a frame.
    await tester.tap(find.byIcon(Icons.add));
    await tester.pump();

    // Verify that our counter has incremented.
    expect(find.text('0'), findsNothing);
    expect(find.text('1'), findsOneWidget);
  });
}
</code></pre> 
<p><span style="color:#ed7976;">testWidgets测试</span>方法，这个方法中定义了我们整个widget测试的内容。</p> 
<p><span style="color:#ed7976;">WidgetTester</span>提供的 <span style="color:#ed7976;">pumpWidget</span>方法会建立并渲染我们提供的 widget。在调用pumpwidget后，我们还可以调用<span style="color:#ed7976;">pump</span>等函数用于重新构建widget，这个对<code>StatefulWidget</code> 或者动画会非常有用。</p> 
<p>在一个expect函数中，我们可以通过<span style="color:#ed7976;">expct（Finder,Matcher）</span><span style="color:#0d0016;">来验证，控件的内容期望。</span></p> 
<p>案例是通过<span style="color:#ed7976;">find.text</span><span style="color:#0d0016;">这个Finder</span>，来查找指定文本内容的组件，通过<span style="color:#ed7976;">findsOneWidget </span><span style="color:#0d0016;">这个Matcher来进行判断</span>。</p> 
<blockquote> 
 <p>常用的Matchers：</p> 
 <p><a href="https://api.flutter-io.cn/flutter/flutter_test/findsOneWidget-constant.html" rel="nofollow" title="findsOneWidget">findsOneWidget</a>                  验证widget 只在屏幕中出现一次</p> 
 <p><a href="https://api.flutter-io.cn/flutter/flutter_test/findsNothing-constant.html" rel="nofollow" title="findsNothing">findsNothing</a>                        验证没有可被查找的 widgets。</p> 
 <p><a href="https://api.flutter-io.cn/flutter/flutter_test/findsWidgets-constant.html" rel="nofollow" title="findsWidgets">findsWidgets</a>                       验证一个或多个 widgets 被找到。</p> 
 <p><a href="https://api.flutter-io.cn/flutter/flutter_test/findsNWidgets.html" rel="nofollow" title="findsNWidgets">findsNWidgets</a>                     验证特定数量的 widgets 被找到。</p> 
 <p><a href="https://api.flutter-io.cn/flutter/flutter_test/matchesGoldenFile.html" rel="nofollow" title="matchesGoldenFile">matchesGoldenFile</a>             验证渲染的 widget 是否与特定的图像匹配（「目标文件」测试）。</p> 
</blockquote> 
<p>常用的finder构造函数:</p> 
<blockquote> 
 <p>find.text 它会创建一个 <code>Finder</code> 来寻找显示特定文本 <code>String</code> 的 widget</p> 
 <p>find.byKey 通过已经提供给 widget 的 Key 来查找 widget</p> 
 <p>如果上述示例不适用于一些特殊情况，请到 <a href="https://api.flutter-io.cn/flutter/flutter_test/CommonFinders-class.html" rel="nofollow" title="CommonFinders 文档">CommonFinders 文档</a> 中查看更多用法</p> 
 <p></p> 
</blockquote> 
<p><code>WidgetTester</code> 提供了文本输入、点击、拖动的相关方法：</p> 
<ul><li><a href="https://api.flutter-io.cn/flutter/flutter_test/WidgetTester/enterText.html" rel="nofollow" title="enterText()">enterText()</a></li><li><a href="https://api.flutter-io.cn/flutter/flutter_test/WidgetController/tap.html" rel="nofollow" title="tap()">tap()</a></li><li><a href="https://api.flutter-io.cn/flutter/flutter_test/WidgetController/drag.html" rel="nofollow" title="drag()">drag()</a></li></ul> 
<p>在很多情况下，用户交互会更新应用状态。在测试环境中，Flutter 在状态发生改变的时候并不会自动重建 widget。为了保证模拟用户交互实现后，widget 树能重建，一定要调用 <code>WidgetTester</code> 提供的 <a href="https://api.flutter-io.cn/flutter/flutter_test/WidgetTester/pump.html" rel="nofollow" title="pump()">pump()</a> 或 <a href="https://api.flutter-io.cn/flutter/flutter_test/WidgetTester/pumpAndSettle.html" rel="nofollow" title="pumpAndSettle()">pumpAndSettle()</a>。</p> 
<h4 id="directions"><span style="color:#0d0016;">3.集成<strong>测试</strong></span></h4> 
<p>        Unit tests 和 Widget tests 并不能够测试单独的模块形成的整体或者获取真实设备上应用运行状态。这些任务需要集成测试 (<strong>integration tests</strong>) 来处理。</p> 
<p>        他能够达到的效果是在真机上运行测试脚本，进行自动化测试。正体编写与单元测试和组件测试类似。具体步骤如下：</p> 
<p>        step1.引入依赖</p> 
<pre><code class="language-Dart">dev_dependencies:
  integration_test:
    sdk: flutter
  flutter_test:
    sdk: flutter</code></pre> 
<p>        step2.项目根目录下创建integration_test 文件夹，编写一个app_test.dart的文件，内容如下</p> 
<pre><code class="language-Dart">import 'package:flutter/material.dart';
import 'package:flutter_test/flutter_test.dart';

import 'package:integration_test/integration_test.dart';


void main() {
  IntegrationTestWidgetsFlutterBinding.ensureInitialized();

  group('end-to-end test', () {
    testWidgets('Main Test', (WidgetTester tester) async {
      //进入主程序
      await tester.pumpWidget(MyApp());
      //等待加载一会
      await Future.delayed(const Duration(seconds: 3));
      //找到对应的入力框
      Finder userFinder = find.byType(TextFormField).at(0);
      Finder passwordFinder = find.byType(TextFormField).at(1);
      expect(userFinder, findsOneWidget);
      expect(passwordFinder, findsOneWidget);
      //填写用户名密码
      await tester.enterText(userFinder, 'xxxx');
      await tester.enterText(passwordFinder, 'xxxx');
      await tester.pumpAndSettle();
      
      //等待3秒后执行点击登录按钮操作
      await Future.delayed(const Duration(seconds: 3)).then((value) async {
        Finder loginFinder = find.byType(LoginButton);
        expect(loginFinder, findsOneWidget);
        await tester.tap(loginFinder);
        //需要等待动画加载画面迁移（此处不能省略）
        await tester.pumpAndSettle();
        await Future.delayed(const Duration(seconds: 10));
      });


    });
  });
}
</code></pre> 
<p>注意：await tester.pumpAndSettle();的调用，在用动画的画面，迁移画面时必须调用，否则看不到相应动画的测试与调用。</p> 
<p>        step3.启动设备，运行测试 </p> 
<blockquote> 
 <p>flutter test integration_test --coverage</p> 
</blockquote> 
<p>        step4.查看报告（参2.组件测试）</p> 
<p></p> 
<p></p> 
<hr> 
<p>其他测试相关内容，有待探索。。。</p> 
<p>《TODO》处理滚动</p> 
<p><a class="has-card" href="https://flutter.cn/docs/cookbook/testing/widget/scrolling" rel="nofollow" title="处理滚动 - Flutter 中文文档 - Flutter 中文开发者网站 - Flutter"><span class="link-card-box"><span class="link-title">处理滚动 - Flutter 中文文档 - Flutter 中文开发者网站 - Flutter</span><span class="link-desc">如何在 widget 测试中处理滚动。</span><span class="link-link"><img alt="" class="link-link-icon" src="https://images2.imgbox.com/21/f1/33aiSB63_o.png">https://flutter.cn/docs/cookbook/testing/widget/scrolling</span></span></a></p> 
<p>《TODO》模拟（Mocks）允许我们仿造一个线上服务或数据库<a class="has-card" href="https://flutter.cn/docs/cookbook/testing/unit/mocking" rel="nofollow" title="使用 Mockito 模拟依赖关系 - Flutter 中文文档 - Flutter 中文开发者网站 - Flutter"><span class="link-card-box"><span class="link-title">使用 Mockito 模拟依赖关系 - Flutter 中文文档 - Flutter 中文开发者网站 - Flutter</span><span class="link-desc">使用 Mockito package 在测试中模拟服务端行为。</span><span class="link-link"><img alt="" class="link-link-icon" src="https://images2.imgbox.com/29/b7/BVz7WoyA_o.png">https://flutter.cn/docs/cookbook/testing/unit/mocking</span></span></a></p> 
<p>《TODO》为 plugin 编写单元测试<a class="has-card" href="https://flutter.cn/docs/development/packages-and-plugins/plugins-in-tests" rel="nofollow" title="如何测试 Flutter Plugin"><span class="link-card-box"><span class="link-title">如何测试 Flutter Plugin</span><span class="link-link"><img alt="" class="link-link-icon" src="https://images2.imgbox.com/f7/c6/rYaJIEnw_o.png">https://flutter.cn/docs/development/packages-and-plugins/plugins-in-tests</span></span></a></p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2a540bf331f1c88434f95b31d78f8a91/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【引用】引用的概念与基本使用原则</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/23c04aed350c00e85cfeb4e62de09576/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IIR和FIR滤波器的区别-公式与思想</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>