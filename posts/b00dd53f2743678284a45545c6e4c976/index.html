<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>群晖和QNAP的NAS的备份功能的测试 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="群晖和QNAP的NAS的备份功能的测试" />
<meta property="og:description" content="原文网址：http://www.nas1.cn/thread-68635-1-1.html
群晖和QNAP都能在其NAS上做冗余磁盘(RAID-1或RAID-5)保护,以防磁盘损坏时丢失数据.但这不叫备份, 只能称为冗余保护.因为这种方式不能防止误删除,误操作的情况. 同时如果NAS主板坏掉, 再多的磁盘冗余也不能保护数据.所以,真正的,狭义的数据备份,其所保存的地点, 至少不应该是那台NAS本身. 同时需要能保留数据的多个历史版本, 在需要的时候,可以选择任一历史版本进行恢复.毕竟很多时候,误删除的数据可能要较长时间才能发现, 进入挽救过程.
群晖和QNAP的NAS自身都带有备份功能, 能独立运行, 不依赖计算机的参与的那种. 我期待使用它们的备份功能,主要出于几点原因:
如前文所述,我们需要能还原数据的多个历史版本,以应对误删除, 误改名, 误移动等操作;如前文所述,我们需要应对NAS完全坏掉的情况;我的这两个NAS都是双盘位的,大部分是电影,不值得保护; 只有极少部分是文档, 需要保护. 但是如果将NAS做RAID-1,容量一下缩减一半, 又太可惜了;我这里只有NAS是常开机在线的, 计算机流动性非常大, 没有一个固定的计算机作为服务器角色来存储和管理备份数据. 因此希望(一个或多个)NAS能搞定备份的所有的事情;平常不会有人关心数据备份的,所以备份应该是自动静默运行的,同时又不占用太多存储空间. 我最近同时有了群晖DS213j和QNAP TS-220各一台, 做了一些测试, 本文主要对它们的备份功能进行了测试. 它们的软件版本分别为DSM 4.2-3211和QTS 4.0.1 . -------------------------
情况一: 群晖作为客户端(源), QNAP作为服务器端(目的)
普通备份, 从界面上来看,备份的目的端可以是一个QNAP(Rsync兼容),备份源可以到目录和文件级别, 但备份目的则只能是共享目录级别,可以指定历史版本数(最多30个),可以指定备份排程. 而且, 在目的端(QNAP的某个共享目录)中, 最后一个备份历史版本的备份数据与源文件的结构形式相同, 也就是说不需要群辉也可以拿回文件(仅限于最后一次备份). 还原时, 可以选择历史版本, 但不能选择具体文件/目录, 且不能改变还原目的路径.还原过程中NAS上所有共享目录都会暂时消失. 但是, 上述功能只是从界面上来看. 在实际测试中, 无论你选择哪个历史版本, 实际上能还原的都仅仅是最后一次备份的内容而已. 哪怕备份目标是本地的另外一个目录(此时已经与另外一个NAS或Rsync之类的无关了).共享文件夹同步功能, 目的端不能是一个QNAP;Time Backup客户端, 此功能同样不支持QNAP作为目的端, 哪怕QNAP启用了支持作为TIME BACKUP服务端. 没有尝试备份到本地, 因为那需要NAS中含有两个存储空间,而我只有一个. --------------------------------
情况二: QNAP作为客户端(源),群晖作为服务器端(目的):
可以使用Rsync备份到群晖上, 但没有历史版本的选项,只是保留最近的数据而已;可以用RTRR的目录同步功能, 而且源可以是本机,也可以是远端服务器, 当然目的端需要相应地调整. 但远端(服务器)只能是FTP服务器,群晖不能作为RTRR服务器.FTP同步效果还好, 稍微有些延迟,也许真正的RTRR会好些.QNAP不能作为time backup的客户端. --------------------------------" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b00dd53f2743678284a45545c6e4c976/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-12-04T10:28:03+08:00" />
<meta property="article:modified_time" content="2018-12-04T10:28:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">群晖和QNAP的NAS的备份功能的测试</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>原文网址：<a href="http://www.nas1.cn/thread-68635-1-1.html" rel="nofollow">http://www.nas1.cn/thread-68635-1-1.html</a></p> 
<p> 群晖和QNAP都能在其NAS上做冗余磁盘(RAID-1或RAID-5)保护,以防磁盘损坏时丢失数据.但这不叫备份, 只能称为冗余保护.因为这种方式不能防止误删除,误操作的情况. 同时如果NAS主板坏掉, 再多的磁盘冗余也不能保护数据.所以,真正的,狭义的数据备份,其所保存的地点, 至少不应该是那台NAS本身. 同时需要能保留数据的多个历史版本, 在需要的时候,可以选择任一历史版本进行恢复.毕竟很多时候,误删除的数据可能要较长时间才能发现, 进入挽救过程.<br><br>    群晖和QNAP的NAS自身都带有备份功能, 能独立运行, 不依赖计算机的参与的那种. 我期待使用它们的备份功能,主要出于几点原因:</p> 
<ul><li>如前文所述,我们需要能还原数据的多个历史版本,以应对误删除, 误改名, 误移动等操作;</li><li>如前文所述,我们需要应对NAS完全坏掉的情况;</li><li>我的这两个NAS都是双盘位的,大部分是电影,不值得保护; 只有极少部分是文档, 需要保护. 但是如果将NAS做RAID-1,容量一下缩减一半, 又太可惜了;</li><li>我这里只有NAS是常开机在线的, 计算机流动性非常大, 没有一个固定的计算机作为服务器角色来存储和管理备份数据. 因此希望(一个或多个)NAS能搞定备份的所有的事情;</li><li>平常不会有人关心数据备份的,所以备份应该是自动静默运行的,同时又不占用太多存储空间.</li></ul> 
<p><br> 我最近同时有了群晖DS213j和QNAP TS-220各一台, 做了一些测试, 本文主要对它们的备份功能进行了测试. 它们的软件版本分别为DSM 4.2-3211和QTS 4.0.1 . <br> -------------------------<br> 情况一: 群晖作为客户端(源), QNAP作为服务器端(目的)</p> 
<ul><li>普通备份, 从界面上来看,备份的目的端可以是一个QNAP(Rsync兼容),备份源可以到目录和文件级别, 但备份目的则只能是共享目录级别,可以指定历史版本数(最多30个),可以指定备份排程. 而且, 在目的端(QNAP的某个共享目录)中, 最后一个备份历史版本的备份数据与源文件的结构形式相同, 也就是说不需要群辉也可以拿回文件(仅限于最后一次备份). 还原时, 可以选择历史版本, 但不能选择具体文件/目录, 且不能改变还原目的路径.还原过程中NAS上所有共享目录都会暂时消失. 但是, 上述功能只是从界面上来看. 在实际测试中, 无论你选择哪个历史版本, 实际上能还原的都仅仅是最后一次备份的内容而已. 哪怕备份目标是本地的另外一个目录(此时已经与另外一个NAS或Rsync之类的无关了).</li><li>共享文件夹同步功能, 目的端不能是一个QNAP;</li><li>Time Backup客户端,  此功能同样不支持QNAP作为目的端, 哪怕QNAP启用了支持作为TIME BACKUP服务端. 没有尝试备份到本地, 因为那需要NAS中含有两个存储空间,而我只有一个.</li></ul> 
<p>--------------------------------<br> 情况二: QNAP作为客户端(源),群晖作为服务器端(目的):</p> 
<ul><li>可以使用Rsync备份到群晖上, 但没有历史版本的选项,只是保留最近的数据而已;</li><li>可以用RTRR的目录同步功能, 而且源可以是本机,也可以是远端服务器, 当然目的端需要相应地调整. 但远端(服务器)只能是FTP服务器,群晖不能作为RTRR服务器.FTP同步效果还好, 稍微有些延迟,也许真正的RTRR会好些.</li><li>QNAP不能作为time backup的客户端.</li></ul> 
<p>--------------------------------<br> 所有NAS的Internet云备份都没有测试, 我这里上网带宽有限, 而且期望备份的数据量较大, 至少几百个GB, 所以对Internet云备份不感兴趣.<br><br> 总结: <br><br> 1, 在最终,两家的NAS都无法做到在一个备份任务中,保留多个历史版本的数据,只能保留最后一次的备份数据, 因此只能算是有冗余保护了. 当然, 如果做多个备份任务, 使用同一个源,备份到不同的目的, 安排不同的排程, 也勉强可以实现多个历史版本, 但是这样的存储空间的代价还是非常大的, 至少差异备份, 增量备份, 块备份等功能全都没有了.<br><br> 2,群晖在真正的(多个历史版本的)备份功能上已经迈出了第一步, 尽管她的普通备份功能最终没有实现出多个历史版本的效果,但我希望这只是一个小小的bug,毕从其菜单上已经看到了群晖实现此功能的意愿. 另外, 群辉的time backup客户端,一旦能成功运行, 显然是支持多个历史版本的. 相比之下,QNAP尚无任何这方面的动作, 仍然停留在冗余保护的阶段上;<br><br> 3,群晖对备份目的端的需求太高了,至少是一个Rsync兼容的NAS, 有此功能的NAS一般都不便宜, 性能也不低, 仅作为备份可惜了. 应该考虑能用SMB或FTP作为备份的目的端, 性能也不必很好, 能满足这点的NAS一般都很便宜, 这点QNAP做得就挺好.<br><br> 4,在NAS备份领域用到的, Rsync和RTRR是UNIX领域的标准(或规范), Time Backup应该是苹果的标准(或规范),都不是这两个厂家自己推出的, 可以说都是通用的和开放的技术. 但即便如此, 当落实到产品上时, 这些标准不能说被这两个厂家改动得面目全非,至少互不相容是肯定的. 而且貌似群晖篡改得更多, 这点非常遗憾.<br><br>     最后, 我理想的备份体系是: 群晖或 QNAP作为主NAS, 完全不做磁盘冗余保护, 那么两块4TB的磁盘就可以得到8TB的容量, 其上有500GB的内容是文档,重要的照片等需要保护的数据, 并且改动量不很大. 其他内容主要是电影, 音乐等, 丢了也无所谓. 我另外配一个200元人民币的备份NAS, 装一个1TB的旧磁盘作为备份的目的端, 连在网络上, 即便它的速度只有3M字节/秒也够用. 主NAS定期(例如每日或每周)将重要数据备份到备份NAS, 1TB的容量也许够做100个历史版本的. 如果哪天我发现文档更新错了, 我可以轻易地恢复到最近100次备份中的任意一次; 如果哪天主NAS坏了, 我直接从备份NAS读出数据即可.<br><br>     网上有卖200元一个的艾美加的二手NAS, 铝壳无风扇单盘位, 能支持Time Backup, 正是合适我的设想的设备, 但是鉴于我所做的上述测试, 群晖和QNAP在各自的NAS上实现的技术并不兼容, 我又十分担心买回来是否有用.</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cc824389ccac9cfde6be4197e14ca061/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">gitlab内存占用过大</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c394f9d4d99ec7b8088a057de6b0e243/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Unity C#作为客户端与C&#43;&#43;服务器 传递结构体进行Socket通讯</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>