<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>多媒体技术第一次作业：将24位真彩色图像转换为灰度图（无调色板） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="多媒体技术第一次作业：将24位真彩色图像转换为灰度图（无调色板）" />
<meta property="og:description" content="#include&lt;stdio.h&gt; #include&lt;malloc.h&gt; #include&lt;stdlib.h&gt; #include&lt;string.h&gt; /* 位图头结构 */ #pragma pack(1) typedef struct tagBITMAPFILEHEADER { unsigned char bfType[2];//文件格式 unsigned long bfSize;//文件大小 unsigned short bfReserved1;//保留 unsigned short bfReserved2; unsigned long bfOffBits; //DIB数据在文件中的偏移量 }fileHeader; #pragma pack() /* 位图数据信息结构 */ #pragma pack(1) typedef struct tagBITMAPINFOHEADER { unsigned long biSize;//该结构的大小 long biWidth;//文件宽度 long biHeight;//文件高度 unsigned short biPlanes;//平面数 unsigned short biBitCount;//颜色位数 unsigned long biCompression;//压缩类型 unsigned long biSizeImage;//DIB数据区大小 long biXPixPerMeter; long biYPixPerMeter; unsigned long biClrUsed;//多少颜色索引表 unsigned long biClrImporant;//多少重要颜色 }fileInfo; #pragma pack() int main() { /*存储RGB图像的一行像素点*/ unsigned char ImgData[3000][3]; /*将灰度图的像素存到一个二维数组中*/ unsigned char ImgData2[3000][3]; int i,j,k; FILE * fpBMP,* fpGray; fileHeader * fh; fileInfo * fi; char filename1[20],filename2[20]; printf(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/acae151dd11df3bcf7f3cc2c81303d43/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-18T21:37:38+08:00" />
<meta property="article:modified_time" content="2020-12-18T21:37:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">多媒体技术第一次作业：将24位真彩色图像转换为灰度图（无调色板）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <pre><code>#include&lt;stdio.h&gt;
#include&lt;malloc.h&gt;
#include&lt;stdlib.h&gt;
#include&lt;string.h&gt;
/*
位图头结构
*/
#pragma pack(1)
typedef struct tagBITMAPFILEHEADER
{
    unsigned char bfType[2];//文件格式
    unsigned long bfSize;//文件大小
    unsigned short bfReserved1;//保留
    unsigned short bfReserved2;
    unsigned long bfOffBits; //DIB数据在文件中的偏移量
}fileHeader;
#pragma pack()
 
/*
位图数据信息结构
*/
#pragma pack(1)
typedef struct tagBITMAPINFOHEADER
{
    unsigned long biSize;//该结构的大小
    long biWidth;//文件宽度
    long biHeight;//文件高度
    unsigned short biPlanes;//平面数
    unsigned short biBitCount;//颜色位数
    unsigned long biCompression;//压缩类型
    unsigned long biSizeImage;//DIB数据区大小
    long biXPixPerMeter;
    long biYPixPerMeter;
    unsigned long biClrUsed;//多少颜色索引表
    unsigned long biClrImporant;//多少重要颜色
}fileInfo;
#pragma pack()
 
int main()
{
    /*存储RGB图像的一行像素点*/
    unsigned char ImgData[3000][3];
    /*将灰度图的像素存到一个二维数组中*/
    unsigned char ImgData2[3000][3];
    int i,j,k;
    FILE * fpBMP,* fpGray;
    fileHeader * fh;
    fileInfo * fi;
    char filename1[20],filename2[20];
 
    printf("输入图像文件名：");
    scanf("%s",filename1);
    if((fpBMP=fopen(filename1,"rb"))==NULL)
    {
        printf("打开文件失败");
        exit(0);
    }
    printf("输出图像文件名：");
    scanf("%s",filename2);
    if((fpGray=fopen(filename2,"wb"))==NULL)
    {
        printf("创建文件失败");
        exit(0);
    }
 
    fh=(fileHeader *)malloc(sizeof(fileHeader));
    fi=(fileInfo *)malloc(sizeof(fileInfo));
    //读取位图头结构和信息头
    fread(fh,sizeof(fileHeader),1,fpBMP);
    fread(fi,sizeof(fileInfo),1,fpBMP);
    //修改头信息
    fi-&gt;biSizeImage=( (fi-&gt;biWidth*3+3)/4 ) * 4*fi-&gt;biHeight;
    //将头信息写入
    fwrite(fh,sizeof(fileHeader),1,fpGray);
    fwrite(fi,sizeof(fileInfo),1,fpGray);
    //fwrite(fq,sizeof(rgbq),256,fpGray);
    //读取RGB图像素并转换为灰度值
    for ( i=0;i&lt;fi-&gt;biHeight;i++ )
    {
        for(j=0;j&lt;(fi-&gt;biWidth+3)/4*4;j++)
        {
        
		for(k=0;k&lt;3;k++)
            {
			fread(&amp;ImgData[j][k],1,1,fpBMP);
        			  
        }
        	ImgData2[j][0]=ImgData2[j][1]=ImgData2[j][2]=int(ImgData[j][0]+ImgData[j][1] +
                        ImgData[j][2])/3;
        fwrite(ImgData2[j],k,1,fpGray);
		}
        //将灰度图信息写入
    }
 
        free(fh);
        free(fi);
        fclose(fpBMP);
        fclose(fpGray);
        printf("success\n");
        return 0;
}

</code></pre> 
<p>把代码文件和图片放同一文件夹，输入图片的名字，再输入要输出的图片名字，以.bmp结尾 就可以了。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ac2996d8a6b257bba674f6333e5a7c6f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Neo4j登录报错Neo4j Server shutdown initiated by request解决</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d2be358bb659e769ad8970bc839611a8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">zigzag算法详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>