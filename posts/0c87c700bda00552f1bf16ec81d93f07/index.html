<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux服务器初始化工作 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux服务器初始化工作" />
<meta property="og:description" content="本文内容基于AlmaLinux 8系统。 以下为一键运行脚本，此脚本在AlmaLinux8，9系统上测试通过，其它版本系统无法保证全部功能正常运行。推荐仅在全新的服务器操作系统上运行此脚本，如二次执行可能会出现未知错误！
# bash &lt;(curl -L https://github.com/AlexWalker97/Shell/raw/main/linux_init.sh) 一、修改主机名 通常在购买一台新的服务器时服务器Hostname会被云厂商定义为特定的名称，如果需要修改的话可以按照下面步骤进行：
1. 查看系统信息 你可以使用下面指令查看到主机的相关信息：
# hostnamectl 例如下面截图是我的服务器信息：
2. 修改主机名 接下来修改服务器主机名：
# hostnamectl set-hostname 主机名 修改成功并重连ssh后可以看到服务器名称变成了server007：
二、禁用ICMP协议 部分攻击者会使用ping工具来测试服务器是否&#34;存在&#34;，我们可以禁用ICMP协议（让我们的服务器不响应其它服务器的ping请求）来保护服务器安全。
在 /etc/sysctl.conf 文件中增加一行 net.ipv4.icmp_echo_ignore_all = 1 (= 号后面的值0表示允许，1表示禁止)，之后执行 sysctl -p 使新配置生效：
# echo &#34;net.ipv4.icmp_echo_ignore_all = 1&#34; &gt;&gt; /etc/sysctl.conf # sysctl -p 此时使用windows cmd工具ping服务器时会发现无法ping通：
三、关闭SELinux y1s1，SELinux是个好东西，它能为linux服务器带来很强的安全防护功能。但是这个系统总是会和各种软件之间出现莫名其妙的冲突，有些问题排查极为浪费时间。在此直接将SELinux一关了之，再见！
输入getenforce检测selinux是否打开：
# getenforce 如结果如下：
Enforcing或Permissive表示SELinux为已打开(后者表示临时关闭，但重启后还会打开)，若结果为Disabled则代表selinux系统未启用，无需关闭。
输入以下指令已永久关闭SELinux：
# setenforce 0 # sed -i &#34;s/SELINUX=enforcing/SELINUX=disabled/g&#34; /etc/selinux/config 四、修改ssh端口 22端口为服务器默认ssh端口，因此易受攻击。我们可以通过修改服务器默认ssh端口的方式来规避风险。
1. 准备端口 首先确认我们需要开放的ssh端口（此处以端口1234为例）未被占用：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0c87c700bda00552f1bf16ec81d93f07/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-07T20:04:29+08:00" />
<meta property="article:modified_time" content="2022-10-07T20:04:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux服务器初始化工作</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <h3><em>本文内容基于</em>AlmaLinux 8系统。</h3> 
 <p>以下为一键运行脚本，此脚本在AlmaLinux8，9系统上测试通过，其它版本系统无法保证全部功能正常运行。推荐仅在全新的服务器操作系统上运行此脚本，如二次执行可能会出现未知错误！</p> 
 <pre><code class="language-bash"># bash &lt;(curl -L https://github.com/AlexWalker97/Shell/raw/main/linux_init.sh)</code></pre> 
 <p></p> 
</blockquote> 
<h2><strong>一、修改主机名</strong></h2> 
<div></div> 
<blockquote> 
 <p>通常在购买一台新的服务器时服务器Hostname会被云厂商定义为特定的名称，如果需要修改的话可以按照下面步骤进行：</p> 
</blockquote> 
<h3 id="1.%20%E6%9F%A5%E7%9C%8B%E7%B3%BB%E7%BB%9F%E4%BF%A1%E6%81%AF">1. 查看系统信息</h3> 
<p>你可以使用下面指令查看到主机的相关信息：</p> 
<pre><code class="language-bash"># hostnamectl</code></pre> 
<p>例如下面截图是我的服务器信息：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/5d/ba/eRWlxuQK_o.png"></p> 
<h3 id="%C2%A02.%20%E4%BF%AE%E6%94%B9%E4%B8%BB%E6%9C%BA%E5%90%8D">2. 修改主机名</h3> 
<p>接下来修改服务器主机名：</p> 
<pre><code class="language-bash"># hostnamectl set-hostname 主机名</code></pre> 
<p> 修改成功并重连ssh后可以看到服务器名称变成了server007：</p> 
<p><img alt="" height="374" src="https://images2.imgbox.com/e1/11/eZS9Thuf_o.png" width="832"></p> 
<p></p> 
<h2>二、禁用ICMP协议</h2> 
<blockquote> 
 <p>部分攻击者会使用ping工具来测试服务器是否"存在"，我们可以禁用ICMP协议（让我们的服务器不响应其它服务器的ping请求）来保护服务器安全。</p> 
</blockquote> 
<p>在 /etc/sysctl.conf 文件中增加一行 net.ipv4.icmp_echo_ignore_all = 1 (= 号后面的值0表示允许，1表示禁止)，之后执行 sysctl -p 使新配置生效：</p> 
<pre><code class="language-bash"># echo "net.ipv4.icmp_echo_ignore_all = 1" &gt;&gt; /etc/sysctl.conf
# sysctl -p</code></pre> 
<p>此时使用windows cmd工具ping服务器时会发现无法ping通：</p> 
<p><img alt="" height="306" src="https://images2.imgbox.com/66/8b/GbjZojHS_o.png" width="966"></p> 
<p></p> 
<h2>三、关闭SELinux</h2> 
<blockquote> 
 <p>y1s1，SELinux是个好东西，它能为linux服务器带来很强的安全防护功能。但是这个系统总是会和各种软件之间出现莫名其妙的冲突，有些问题排查极为浪费时间。在此直接将SELinux一关了之，再见！</p> 
</blockquote> 
<p> 输入getenforce检测selinux是否打开：</p> 
<pre><code class="language-bash"># getenforce</code></pre> 
<p>如结果如下：</p> 
<p> <img alt="" height="68" src="https://images2.imgbox.com/dd/35/dkNzdAiy_o.png" width="398"></p> 
<p>Enforcing或Permissive表示SELinux为已打开(后者表示临时关闭，但重启后还会打开)，若结果为Disabled则代表selinux系统未启用，无需关闭。</p> 
<p> 输入以下指令已永久关闭SELinux：</p> 
<pre><code class="language-bash"># setenforce 0
# sed -i "s/SELINUX=enforcing/SELINUX=disabled/g" /etc/selinux/config</code></pre> 
<p></p> 
<h2>四、修改ssh端口</h2> 
<blockquote> 
 <p>22端口为服务器默认ssh端口，因此易受攻击。我们可以通过修改服务器默认ssh端口的方式来规避风险。</p> 
</blockquote> 
<h3>1. 准备端口</h3> 
<p>首先确认我们需要开放的ssh端口（此处以端口1234为例）未被占用：</p> 
<p>安装lsof工具（便捷查看端口占用情况）：</p> 
<pre><code class="language-bash"># yum -y install lsof</code></pre> 
<p>查看端口占用：</p> 
<pre><code class="language-bash"># lsof -i:1234</code></pre> 
<p>结果如下所示则代表端口未被使用：</p> 
<p><img alt="" height="68" src="https://images2.imgbox.com/c4/f4/WYoAJg3n_o.png" width="506"></p> 
<h3>2. 防火墙开放端口</h3> 
<p>执行以下命令开放1234端口：</p> 
<pre><code class="language-bash"># firewall-cmd --add-port=1234/tcp --permanent</code></pre> 
<p>重启防火墙：</p> 
<pre><code class="language-bash"># firewall-cmd --reload</code></pre> 
<p>查看防火墙已开放端口：</p> 
<pre><code class="language-bash"># firewall-cmd --zone=public --list-ports</code></pre> 
<p>结果如下：</p> 
<p><img alt="" height="74" src="https://images2.imgbox.com/3d/6a/U9jYk0oN_o.png" width="898"></p> 
<p></p> 
<h3>3.修改ssh端口 </h3> 
<p>修改文件/etc/ssh/sshd_config：</p> 
<pre><code class="language-bash"># vi /etc/ssh/sshd_config</code></pre> 
<p>将其中的#Port 22取消注释并修改为Port 1234：</p> 
<p><img alt="" height="316" src="https://images2.imgbox.com/09/52/7jHjOrUA_o.png" width="1082"></p> 
<p>重启sshd服务：</p> 
<pre><code class="language-bash"># systemctl restart sshd</code></pre> 
<p>我们可以通过sudo lsof -i -P -n | grep LISTEN指令来查看所有系统监听的端口： </p> 
<p><img alt="" height="103" src="https://images2.imgbox.com/6d/58/Vrffbbpu_o.png" width="1098"></p> 
<p>之后我们在ssh工具中只能使用1234端口登录服务器。</p> 
<p></p> 
<h2 id="%E4%BA%8C%E3%80%81%E5%88%9B%E5%BB%BA%E6%96%B0%E7%94%A8%E6%88%B7">五、创建新用户</h2> 
<blockquote> 
 <p>为了安全起见一般不建议直接使用root用户进行操作，为此我们需要创建新的用户，并在需要时给予他们root权限。新用户名最好不要使用user，admin等常见词，以下使用user1仅作为演示。</p> 
</blockquote> 
<h3 id="1.%20%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7"><a id="1_20"></a>1. 创建用户</h3> 
<pre><code class="language-bash"># adduser 用户名</code></pre> 
<h3 id="2.%20%E4%BF%AE%E6%94%B9%E5%AF%86%E7%A0%81">2. 修改密码</h3> 
<p>为刚刚创建的用户设置密码：</p> 
<pre><code class="language-bash"># passwd 用户名</code></pre> 
<p>完成后结果如下：</p> 
<h2 id="%E2%80%8B%E7%BC%96%E8%BE%91"><img alt="" height="210" src="https://images2.imgbox.com/f2/c6/I4llUBMu_o.png" width="840"></h2> 
<h3>3. 赋予新用户管理员权限</h3> 
<p>在AlmaLinux 8系统上，用户组 wheel 成员都可以使用sudo以管理员权限访问系统。如果你想要新创建的用户拥有管理员权限，添加用户到wheel用户组：</p> 
<pre><code class="language-bash"># usermod -aG wheel 用户名</code></pre> 
<p>查看属于wheel组中的用户：</p> 
<pre><code class="language-bash"># cat /etc/group |grep wheel</code></pre> 
<p>结果如下：</p> 
<p><img alt="" height="64" src="https://images2.imgbox.com/1b/4d/U78CaOr1_o.png" width="766"></p> 
<p></p> 
<h2>六、禁止root用户远程登陆</h2> 
<blockquote> 
 <p>这点十分重要。一台暴露在互联网上的服务器每天可能会受到成千上百次的ip扫描或root密码暴力破解，其中远程ssh连接的用户名基本默认为root，因此我们有必要禁止root用户远程登陆，并使用我们上一步创建的新用户名登录。</p> 
</blockquote> 
<h3>1. 修改配置：</h3> 
<pre><code class="language-bash"># vi /etc/ssh/sshd_config</code></pre> 
<p>将其中如下图位置所示Permitrootlogin改为no：</p> 
<p><img alt="" class="left" height="188" src="https://images2.imgbox.com/37/58/HXEFcyuA_o.png" width="294"></p> 
<h3>2. 重启sshd服务：</h3> 
<pre><code class="language-bash"># systemctl restart sshd</code></pre> 
<p>现在如果我们断开此次ssh会话并再次尝试使用root登录会有如下报错：</p> 
<p><img alt="" height="64" src="https://images2.imgbox.com/d8/83/fKc63b8Y_o.png" width="1130"></p> 
<p>这说明修改已经生效。</p> 
<p></p> 
<h2>七、(可选)为服务器开启bbr</h2> 
<blockquote> 
 <p>TCP BBR是谷歌出品的TCP拥塞控制算法，可以使 Linux 服务器显著地提高吞吐量和减少 TCP 连接的延迟。Linux4.9之后的内核自带bbr算法，如果linux内核版本低于4.9需要升级内核，这篇文章不会涉及到服务器升级内核的内容，仅针对服务器内核&gt;4.9的系统。</p> 
</blockquote> 
<h3>1.查看内核</h3> 
<pre><code class="language-bash">$ uname -r</code></pre> 
<p>如下可以看到我们的内核为4.18，因此可以直接开启bbr。</p> 
<p><img alt="" height="76" src="https://images2.imgbox.com/6a/9d/wPKPa67k_o.png" width="446"></p> 
<h3>2.开启bbr并设定队列算法为fq_codel（队列算法有很多种如:fq,fq_pie,cake等，这里选择fq_codel演示）：</h3> 
<p></p> 
<p>首先进入管理员账户：</p> 
<pre><code class="language-bash">$ sudo su</code></pre> 
<p>之后执行：</p> 
<pre><code class="language-bash"># echo "net.ipv4.tcp_congestion_control = bbr" &gt;&gt; /etc/sysctl.conf
# echo "net.core.default_qdisc = fq_codel" &gt;&gt; /etc/sysctl.conf
# sysctl -p</code></pre> 
<p>执行这一步时可能会有报错:"sysctl: setting key "net.core.default_qdisc": No such file or directory"，我们直接忽略掉错误重启机器。</p> 
<h3>3.重启电脑后输入如下指令：</h3> 
<pre><code class="language-bash">$ sysctl net.ipv4.tcp_congestion_control
$ sysctl net.core.default_qdisc
$ lsmod | grep bbr</code></pre> 
<p>如果均出现bbr则说明启用成功，如下图所示：</p> 
<p><img alt="" height="210" src="https://images2.imgbox.com/93/ca/N7LsGOV4_o.png" width="904"></p> 
<p></p> 
<h2 id="%E6%80%BB%E7%BB%93"><a id="_45"></a>总结</h2> 
<p>以上是一台新服务器到手后的一些简单安全防护及优化内容，更高级的保护措施(如：fail2ban，蜜罐技术等)之后有需要的话会再汇总成一篇文章，欢迎关注~</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c01bfb8162b588f0884f26cc2c37d75f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">大数据工程师、数据挖掘师和数据分析师有啥区别</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/47b96a58f69b9e4b8e188a161332c4ab/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">计算机视觉数据增强系列1</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>