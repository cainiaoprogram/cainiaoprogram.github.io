<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>VRPSolverEasy：可求解多种VRP变体（rich vehicle routing）问题的精确算法python包 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="VRPSolverEasy：可求解多种VRP变体（rich vehicle routing）问题的精确算法python包" />
<meta property="og:description" content="当前运筹优化领域的研究者在使用 branch-cut-and-price (BCP) 算法求解车辆路径问题 (VRP)的最优解方面取得了重大进展。BCP算法是VRPSolver中常用的算法，在许多 VRP变体的求解中表现优异。然而，其复杂的底层数学模型使其对于路径规划从业者（入门者）而言难以理解。为了解决这个问题，Najib Errami等人开发了VRPSolverEasy这个python工具包（Najib Errami, Eduardo Queiroga, Ruslan Sadykov, Eduardo Uchoa (2023) VRPSolverEasy: A Python Library for the Exact Solution of a Rich Vehicle Routing Problem. INFORMS Journal on Computing），VRPSolverEasy 提供了一个 Python 接口，无需任何混合整数规划建模知识即可使用的VRPSolver。在使用时，可以直接以VRP问题常用元素定义，例如仓库、客户、链接和车辆类型。VRPSolverEasy 可以处理多种流行的 VRP 变体及其任意组合。
目录 1. VRPSolverEasy安装2. VRPSolverEasy模块介绍2.1 添加车场节点（depot points）2.2 添加客户节点（customer points）2.3 添加弧（link）2.4 添加车辆类型（vehicle type） 3. VRPTW算例4. VRPSolverEasy可求解的其它类型VRP部分算例4.1 CVRP4.2 MDVRP4.3 RICHVRP 5. 性能 1. VRPSolverEasy安装 VRPSolverEasy包提供了两种使用模式，一种是免费版本，该版本中使用了开源线性规划求解器COIN-OR CLP（果然开源才是王道，COIN-OR还有其它的开源求解器，具体可参考文章开源建模框架&#43;开源求解器 | 使用pyomo建模框架实现交通物流优化问题的求解 (shortest path p），直接使用pip安装就可获取免费版本。 python3 -m pip install VRPSolverEasy 另一个版本是学术版本（其实是使用商业版本的CPLEX求解器），该版本提供了一些基于MIP的启发式方法，在求解性能上更强，更容易获取可行解，但是安装起来稍微有点麻烦，需要以下四个步骤： 将VRPSolverEasy python包克隆到本地安装CPLEX下载并安装Bapcod，Bapcod是基于C&#43;&#43;写的branch-and-price包，也是VRPSolverEasy python包的求解内核，一直在保持持续更新，可能也是感觉使用C&#43;&#43;怕别人觉得困难，也推出了python接口 4." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/fce7480ab6d2c2874ff6f7fc5aab7e88/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-04T21:55:24+08:00" />
<meta property="article:modified_time" content="2024-01-04T21:55:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">VRPSolverEasy：可求解多种VRP变体（rich vehicle routing）问题的精确算法python包</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>当前运筹优化领域的研究者在使用 branch-cut-and-price (BCP) 算法求解车辆路径问题 (VRP)的最优解方面取得了重大进展。BCP算法是VRPSolver中常用的算法，在许多 VRP变体的求解中表现优异。然而，其复杂的底层数学模型使其对于路径规划从业者（入门者）而言难以理解。为了解决这个问题，Najib Errami等人开发了VRPSolverEasy这个python工具包（Najib Errami, Eduardo Queiroga, Ruslan Sadykov, Eduardo Uchoa (2023) VRPSolverEasy: A Python Library for the Exact Solution of a Rich Vehicle Routing Problem. INFORMS Journal on Computing），VRPSolverEasy 提供了一个 Python 接口，无需任何混合整数规划建模知识即可使用的VRPSolver。在使用时，可以直接以VRP问题常用元素定义，例如仓库、客户、链接和车辆类型。VRPSolverEasy 可以处理多种流行的 VRP 变体及其任意组合。</p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#1_VRPSolverEasy_3" rel="nofollow">1. VRPSolverEasy安装</a></li><li><a href="#2_VRPSolverEasy_45" rel="nofollow">2. VRPSolverEasy模块介绍</a></li><li><ul><li><a href="#21_depot_points_60" rel="nofollow">2.1 添加车场节点（depot points）</a></li><li><a href="#22_customer_points_71" rel="nofollow">2.2 添加客户节点（customer points）</a></li><li><a href="#23_link_97" rel="nofollow">2.3 添加弧（link）</a></li><li><a href="#24_vehicle_type_103" rel="nofollow">2.4 添加车辆类型（vehicle type）</a></li></ul> 
  </li><li><a href="#3_VRPTW_140" rel="nofollow">3. VRPTW算例</a></li><li><a href="#4_VRPSolverEasyVRP_253" rel="nofollow">4. VRPSolverEasy可求解的其它类型VRP部分算例</a></li><li><ul><li><a href="#41_CVRP_256" rel="nofollow">4.1 CVRP</a></li><li><a href="#42_MDVRP_522" rel="nofollow">4.2 MDVRP</a></li><li><a href="#43_RICHVRP_738" rel="nofollow">4.3 RICHVRP</a></li></ul> 
  </li><li><a href="#5__1024" rel="nofollow">5. 性能</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1_VRPSolverEasy_3"></a>1. VRPSolverEasy安装</h2> 
<br> VRPSolverEasy包提供了两种使用模式，一种是免费版本，该版本中使用了开源线性规划求解器COIN-OR CLP（果然开源才是王道，COIN-OR还有其它的开源求解器，具体可参考文章开源建模框架+开源求解器 | 使用pyomo建模框架实现交通物流优化问题的求解 (shortest path p），直接使用pip安装就可获取免费版本。 
<br> 
<pre><code class="prism language-python">python3 <span class="token operator">-</span>m pip install VRPSolverEasy
</code></pre> 
<br> 另一个版本是学术版本（其实是使用商业版本的CPLEX求解器），该版本提供了一些基于MIP的启发式方法，在求解性能上更强，更容易获取可行解，但是安装起来稍微有点麻烦，需要以下四个步骤： 
<ol><li>将VRPSolverEasy python包克隆到本地</li><li>安装CPLEX</li><li>下载并安装Bapcod，Bapcod是基于C++写的branch-and-price包，也是VRPSolverEasy python包的求解内核，一直在保持持续更新，可能也是感觉使用C++怕别人觉得困难，也推出了python接口</li></ol> 
<p><img src="https://images2.imgbox.com/8f/05/SV8Wz6EB_o.png" alt="在这里插入图片描述"><br> 4. 安装完后使用cmake进行编译</p> 
<pre><code class="prism language-python">cmake <span class="token operator">-</span><span class="token operator">-</span>build build <span class="token operator">-</span><span class="token operator">-</span>config Release <span class="token operator">-</span><span class="token operator">-</span>target bapcod<span class="token operator">-</span>shared
</code></pre> 
<br> 
<p>编译后会生成对应不同系统的三个库文件：</p> 
<pre><code class="prism language-python"><span class="token string">"Bapcod-path/build/Bapcod/libbapcod-shared.so"</span> <span class="token operator">//</span> Linux
<span class="token string">"Bapcod-path/build/Bapcod/libbapcod-shared.dylib"</span> <span class="token operator">//</span> MacOs
<span class="token string">"Bapcod-path/build/Bapcod/Release/bapcod-shared.dll"</span> <span class="token operator">//</span> Windows
</code></pre> 
<br> 
<p>用新生成的库文件替换VRPSolverEasy中旧的库文件（lib/）,然后再重新安装VRPSolverEasy包：</p> 
<pre><code class="prism language-python">python <span class="token operator">-</span>m pip install
</code></pre> 
<br> 
<p>在使用VRPSolverEasy时，需进行参数设置solver_name=‘CPLEX’，如果使用的是Windows系统，参数设置时还需要明确CPLEX的路径，cplex_path=‘ 
 <path>
   ’。如果想要用下内置的启发式算法，添加heuristic_used=True即可。 
 </path></p> 
<h2><a id="2_VRPSolverEasy_45"></a>2. VRPSolverEasy模块介绍</h2> 
<br> 在安装完成后就可以使用VRPSolverEasy模块进行建模了 
<br> 
<pre><code class="prism language-python"><span class="token keyword">import</span> VRPSolverEasy
model<span class="token operator">=</span>VRPSolverRasy<span class="token punctuation">.</span>Model<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<br> 
<p>VRPSolverEasy模型主要通过车场节点（depot points）、客户节点（customer points）、弧（link）和车辆类型（vehicle types）来进行定义。</p> 
<h3><a id="21_depot_points_60"></a>2.1 添加车场节点（depot points）</h3> 
<br> 
<pre><code class="prism language-python">model<span class="token punctuation">.</span>add_depot<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token operator">&lt;</span><span class="token builtin">id</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>service_time<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span>
tw_begin<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span>tw_end<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<br> 
<p>depot点的属性及解释如下<br> <img src="https://images2.imgbox.com/6c/ff/7EQDIfeC_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="22_customer_points_71"></a>2.2 添加客户节点（customer points）</h3> 
<br> 
<p>每个客户与一个或多个节点关联，每个节点（车场或客户）都应该有唯一的标识</p> 
<pre><code class="prism language-python">model<span class="token punctuation">.</span>add_customer<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token operator">&lt;</span><span class="token builtin">id</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>id_customer<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token builtin">id</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
demand<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>penalty<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span>service_time<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span>tw_begin<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span>
tw_end<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span>incompatible_vehicles<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<br> 
<p>此外，VRPSolverEasy还设置了添加额外节点的功能，用于表示可替代的时间窗和/或客户位置（实现一个客户对应多个节点，以便处理不同VRP问题变体的复杂情形），以及可能具有不同兼容车辆集的情况。</p> 
<pre><code class="prism language-python">model<span class="token punctuation">.</span>add_point<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token operator">&lt;</span><span class="token builtin">id</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>id_customer<span class="token operator">=</span><span class="token operator">&lt;</span><span class="token builtin">id</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>
demand<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>penalty<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span>service_time<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span>tw_begin<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span>
tw_end<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span>incompatible_vehicles<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<br> 
<p>customer点的属性及解释如下<br> <img src="https://images2.imgbox.com/b9/1d/noMK58n7_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="23_link_97"></a>2.3 添加弧（link）</h3> 
<br> 
<p>这里link既可以是有向的arc(is_directed=True),也可以是无向的edge(is_directed=False)，link的属性及解释如下<br> <img src="https://images2.imgbox.com/a2/d9/xsJc7GPk_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="24_vehicle_type_103"></a>2.4 添加车辆类型（vehicle type）</h3> 
<br> 
<pre><code class="prism language-python">model<span class="token punctuation">.</span>add_vehicle_type<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token operator">&lt;</span><span class="token builtin">id</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>start_point_id<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>end_point_id<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
name<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span>capacity<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>fixed_cost<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span>var_cost_dist<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span>
var_cost_time<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span>max_number<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>tw_begin<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">,</span>tw_end<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">)</span>
</code></pre> 
<p>vehicle type的属性及解释如下<br> <img src="https://images2.imgbox.com/e6/49/nTKgy0DD_o.png" alt="在这里插入图片描述"><br> 此外，模型设置了总的最大车辆数（所以类型），默认取值为10000，可通过如下方式进行修改</p> 
<br> 
<pre><code class="prism language-python">model<span class="token punctuation">.</span>set_max_total_vehicles_number<span class="token punctuation">(</span><span class="token operator">&lt;</span>value<span class="token operator">&gt;</span><span class="token punctuation">)</span>
</code></pre> 
<br> 
<p>路径成本的计算通过link成本的加和得到，link成本包括三部分：（1）link上的固定成本；（2）根据link的旅行时间和不同车型换算得到的成本；（3）根据link的距离和不同车型换算得到的成本。路径包含的属性及解释如下<br> <img src="https://images2.imgbox.com/17/56/cyMExlCQ_o.png" alt="在这里插入图片描述"><br> 在求解机制上，VRPSolverEasy首先将现有模型转化为VRPSolver可求解的模型（Pessoa et al.2020）,然后再调用Bapcod包（Sadykov et al.2021）进行求解,求解时可设置的参数如下：</p> 
<pre><code class="prism language-python">model<span class="token punctuation">.</span>set_parameters<span class="token punctuation">(</span>time_limit<span class="token operator">=</span><span class="token number">300</span><span class="token punctuation">,</span>upper_bound<span class="token operator">=</span><span class="token number">1000000</span><span class="token punctuation">,</span>heuristic_used<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
time_limit_heuristic<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span>solver_name<span class="token operator">=</span><span class="token string">'CLP'</span><span class="token punctuation">,</span>print_level<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
</code></pre> 
<br> 
<p>VRPSolverEasy求解的速度取决于upper_bound的取值，upper_bound越接近最优解，求解就越快，所以VRPSolverEasy实际上是先通过CLP或者CPLEX得到一个启发式的可行解作为上界，然后再进行求解，VRPSolverEasy求解参数设置的一些属性及解释如下：<br> <img src="https://images2.imgbox.com/5e/1c/4I2MOBSb_o.png" alt="在这里插入图片描述"></p> 
<p>在模型求解结束后，如果求到了解（model.solution.is_defined()==True）,那么目标值可通过model.solution.value得到，路径信息可通过model.solution.routes得到。</p> 
<h2><a id="3_VRPTW_140"></a>3. VRPTW算例</h2> 
<br> 
<p>设置若干客户点和车场节点构造vrptw的算例如下<br> <img src="https://images2.imgbox.com/a8/9e/cFmlNyIO_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token comment"># data</span>
cost_per_distance <span class="token operator">=</span> <span class="token number">10</span>
begin_time <span class="token operator">=</span> <span class="token number">0</span>
end_time <span class="token operator">=</span> <span class="token number">5000</span>
nb_point <span class="token operator">=</span> <span class="token number">7</span>

<span class="token comment"># map with names and coordinates</span>
coordinates <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"Wisconsin, USA"</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">44.50</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">89.50</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># depot</span>
               <span class="token string">"West Virginia, USA"</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">39.000000</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">80.500000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               <span class="token string">"Vermont, USA"</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">44.000000</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">72.699997</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               <span class="token string">"Texas, the USA"</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">31.000000</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">100.000000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               <span class="token string">"South Dakota, the US"</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">44.500000</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">100.000000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               <span class="token string">"Rhode Island, the US"</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">41.742325</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">71.742332</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
               <span class="token string">"Oregon, the US"</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">44.000000</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">120.500000</span><span class="token punctuation">)</span>
               <span class="token punctuation">}</span>

<span class="token comment"># demands of points</span>
demands <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">658</span><span class="token punctuation">,</span> <span class="token number">741</span><span class="token punctuation">,</span> <span class="token number">436</span><span class="token punctuation">]</span>
</code></pre> 
<br> 
<p><strong>模型构建</strong></p> 
<pre><code class="prism language-python">
<span class="token comment"># Initialisation</span>
model <span class="token operator">=</span> solver<span class="token punctuation">.</span>Model<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Add vehicle type</span>
model<span class="token punctuation">.</span>add_vehicle_type<span class="token punctuation">(</span>
    <span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
    start_point_id<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>
    end_point_id<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>
    name<span class="token operator">=</span><span class="token string">"VEH1"</span><span class="token punctuation">,</span>
    capacity<span class="token operator">=</span><span class="token number">1100</span><span class="token punctuation">,</span>
    max_number<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span>
    var_cost_dist<span class="token operator">=</span>cost_per_distance<span class="token punctuation">,</span>
    tw_end<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span>

<span class="token comment"># Add depot</span>
model<span class="token punctuation">.</span>add_depot<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"D1"</span><span class="token punctuation">,</span> tw_begin<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> tw_end<span class="token operator">=</span><span class="token number">5000</span><span class="token punctuation">)</span>

coordinates_keys <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># Add Customers</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> nb_point<span class="token punctuation">)</span><span class="token punctuation">:</span>
    model<span class="token punctuation">.</span>add_customer<span class="token punctuation">(</span>
        <span class="token builtin">id</span><span class="token operator">=</span>i<span class="token punctuation">,</span>
        name<span class="token operator">=</span>coordinates_keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
        demand<span class="token operator">=</span>demands<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>
        tw_begin<span class="token operator">=</span>begin_time<span class="token punctuation">,</span>
        tw_end<span class="token operator">=</span>end_time<span class="token punctuation">)</span>

<span class="token comment"># Add links</span>
coordinates_values <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>coordinates<span class="token punctuation">.</span>values<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        dist <span class="token operator">=</span> compute_euclidean_distance<span class="token punctuation">(</span>coordinates_values<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                          coordinates_values<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                          coordinates_values<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                          coordinates_values<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        model<span class="token punctuation">.</span>add_link<span class="token punctuation">(</span>
            start_point_id<span class="token operator">=</span>i<span class="token punctuation">,</span>
            end_point_id<span class="token operator">=</span>j<span class="token punctuation">,</span>
            distance<span class="token operator">=</span>dist<span class="token punctuation">,</span>
            time<span class="token operator">=</span>dist<span class="token punctuation">)</span>
</code></pre> 
<br> 
<p><strong>求解</strong></p> 
<pre><code class="prism language-python">model<span class="token punctuation">.</span>solve<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<br> 
<p><strong>结果输出</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">if</span> model<span class="token punctuation">.</span>solution<span class="token punctuation">.</span>is_defined<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>solution<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">Route <span class="token keyword">for</span> vehicle <span class="token number">1</span><span class="token punctuation">:</span>
    ID <span class="token punctuation">:</span> <span class="token number">0</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">2</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">5</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">0</span>
    Name <span class="token punctuation">:</span> DEPOT <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> Vermont<span class="token punctuation">,</span> USA <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> Rhode Island<span class="token punctuation">,</span> the US <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> DEPOT
    End time <span class="token punctuation">:</span> <span class="token number">0.0</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">16.807</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">19.259</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">37.230000000000004</span>
    Load <span class="token punctuation">:</span> <span class="token number">0.0</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">300.0</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">1041.0</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">1041.0</span>
    Total cost <span class="token punctuation">:</span> <span class="token number">372.29999999999995</span>

Route <span class="token keyword">for</span> vehicle <span class="token number">1</span><span class="token punctuation">:</span>
    ID <span class="token punctuation">:</span> <span class="token number">0</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">3</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">0</span>
    Name <span class="token punctuation">:</span> DEPOT <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> West Virginia<span class="token punctuation">,</span> USA <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> Texas<span class="token punctuation">,</span> the USA <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> DEPOT
    End time <span class="token punctuation">:</span> <span class="token number">0.0</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">10.548</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">31.625</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">48.728</span>
    Load <span class="token punctuation">:</span> <span class="token number">0.0</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">500.0</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">1100.0</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">1100.0</span>
    Total cost <span class="token punctuation">:</span> <span class="token number">487.2800000000001</span>

Route <span class="token keyword">for</span> vehicle <span class="token number">1</span><span class="token punctuation">:</span>
    ID <span class="token punctuation">:</span> <span class="token number">0</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">4</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">6</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">0</span>
    Name <span class="token punctuation">:</span> DEPOT <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> South Dakota<span class="token punctuation">,</span> the US <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> Oregon<span class="token punctuation">,</span> the US <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> DEPOT
    End time <span class="token punctuation">:</span> <span class="token number">0.0</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">10.5</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">31.006</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">62.010000000000005</span>
    Load <span class="token punctuation">:</span> <span class="token number">0.0</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">658.0</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">1094.0</span> <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">1094.0</span>
    Total cost <span class="token punctuation">:</span> <span class="token number">620.1</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/15/5c/qQGPvHn7_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="4_VRPSolverEasyVRP_253"></a>4. VRPSolverEasy可求解的其它类型VRP部分算例</h2> 
<br> 
<h3><a id="41_CVRP_256"></a>4.1 CVRP</h3> 
<br> 
<p>容量限制车辆路径问题（CVRP）是最基础的 VRP，是指满足不同区域里的顾客需求的有容量限制的车辆路径规划问题。该问题的目标是最大限度降低总路径成本，即车辆行驶的总距离。</p> 
<pre><code class="prism language-python">
<span class="token keyword">from</span> VRPSolverEasy<span class="token punctuation">.</span>src <span class="token keyword">import</span> solver
<span class="token keyword">import</span> os<span class="token punctuation">,</span>sys<span class="token punctuation">,</span>getopt
<span class="token keyword">import</span> math
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token keyword">def</span> <span class="token function">read_instance</span><span class="token punctuation">(</span>name <span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" Read an instance in the folder data from a given name """</span>
    path_project <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span> <span class="token punctuation">(</span>name<span class="token punctuation">,</span>
        <span class="token string">"r"</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span> <span class="token punctuation">)</span><span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
        elements <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token keyword">for</span> element <span class="token keyword">in</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> elements

<span class="token keyword">def</span> <span class="token function">compute_euclidean_distance</span><span class="token punctuation">(</span>x_i<span class="token punctuation">,</span> y_i<span class="token punctuation">,</span> x_j<span class="token punctuation">,</span> y_j<span class="token punctuation">,</span>number_digit<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Compute the euclidean distance between 2 points from graph"""</span>
    <span class="token keyword">return</span> <span class="token builtin">round</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token punctuation">(</span>x_i <span class="token operator">-</span> x_j<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span>
                           <span class="token punctuation">(</span>y_i <span class="token operator">-</span> y_j<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> number_digit<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">solve_demo</span><span class="token punctuation">(</span>instance_path<span class="token punctuation">,</span>
               solver_name<span class="token operator">=</span><span class="token string">"CLP"</span><span class="token punctuation">,</span>
               solver_path<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">,</span>
               time_resolution<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span>
               disableBuiltInHeur<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
               upper_bound<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""return a solution from modelisation"""</span>

    <span class="token comment"># read instance</span>
    data <span class="token operator">=</span> read_cvrp_instances<span class="token punctuation">(</span>instance_path<span class="token punctuation">)</span>

    <span class="token comment"># get data</span>
    vehicle_type <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">"VehicleTypes"</span><span class="token punctuation">]</span>
    depot <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">"Points"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    customers <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">"Points"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
    links <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">"Links"</span><span class="token punctuation">]</span>

    <span class="token comment"># modelisation of problem</span>
    model <span class="token operator">=</span> solver<span class="token punctuation">.</span>Model<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># add vehicle type</span>
    model<span class="token punctuation">.</span>add_vehicle_type<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span>vehicle_type<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                           start_point_id<span class="token operator">=</span>vehicle_type<span class="token punctuation">[</span><span class="token string">"start_point_id"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                           end_point_id<span class="token operator">=</span>vehicle_type<span class="token punctuation">[</span><span class="token string">"end_point_id"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                           max_number<span class="token operator">=</span>vehicle_type<span class="token punctuation">[</span><span class="token string">"max_number"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                           capacity<span class="token operator">=</span>vehicle_type<span class="token punctuation">[</span><span class="token string">"capacity"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                           var_cost_dist<span class="token operator">=</span>vehicle_type<span class="token punctuation">[</span><span class="token string">"var_cost_dist"</span><span class="token punctuation">]</span>
                           <span class="token punctuation">)</span>

    <span class="token comment"># add depot</span>
    model<span class="token punctuation">.</span>add_depot<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span>depot<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># add all customers</span>
    <span class="token keyword">for</span> customer <span class="token keyword">in</span> customers<span class="token punctuation">:</span>
        model<span class="token punctuation">.</span>add_customer<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span>customer<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                           demand<span class="token operator">=</span>customer<span class="token punctuation">[</span><span class="token string">"demand"</span><span class="token punctuation">]</span>
                           <span class="token punctuation">)</span>
    <span class="token comment"># add all links</span>
    <span class="token keyword">for</span> link <span class="token keyword">in</span> links<span class="token punctuation">:</span>
        model<span class="token punctuation">.</span>add_link<span class="token punctuation">(</span>start_point_id<span class="token operator">=</span>link<span class="token punctuation">[</span><span class="token string">"start_point_id"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                       end_point_id<span class="token operator">=</span>link<span class="token punctuation">[</span><span class="token string">"end_point_id"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                       distance<span class="token operator">=</span>link<span class="token punctuation">[</span><span class="token string">"distance"</span><span class="token punctuation">]</span>
                       <span class="token punctuation">)</span>

    <span class="token comment"># set parameters</span>
    <span class="token keyword">if</span> disableBuiltInHeur<span class="token punctuation">:</span>
        model<span class="token punctuation">.</span>set_parameters<span class="token punctuation">(</span>time_limit<span class="token operator">=</span>time_resolution<span class="token punctuation">,</span> solver_name<span class="token operator">=</span>solver_name<span class="token punctuation">,</span> 
                            heuristic_used<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Built-in heuristic is disabled'</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        model<span class="token punctuation">.</span>set_parameters<span class="token punctuation">(</span>time_limit<span class="token operator">=</span>time_resolution<span class="token punctuation">,</span> solver_name<span class="token operator">=</span>solver_name<span class="token punctuation">,</span> 
                            heuristic_used<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Built-in heuristic is enabled'</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> upper_bound <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
        model<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span>upper_bound <span class="token operator">=</span> upper_bound

    <span class="token triple-quoted-string string">''' If you have cplex 22.1 installed on your laptop windows you have to specify
        solver path'''</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>solver_name <span class="token operator">==</span> <span class="token string">"CPLEX"</span> <span class="token keyword">and</span> solver_path <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        model<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span>cplex_path <span class="token operator">=</span> solver_path

    <span class="token comment"># solve model</span>
    model<span class="token punctuation">.</span>solve<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> model<span class="token punctuation">.</span>solution<span class="token punctuation">.</span>is_defined <span class="token punctuation">:</span>
        path_instance_name <span class="token operator">=</span> instance_path<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        name_instance <span class="token operator">=</span> path_instance_name<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\\"</span><span class="token punctuation">)</span><span class="token punctuation">[</span>
            <span class="token builtin">len</span><span class="token punctuation">(</span>path_instance_name<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"\\"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'{0} {1} {2} {3} {4} {5} {6} {7} {8} {9}\n'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
                <span class="token string">"instance_name"</span><span class="token punctuation">,</span><span class="token string">"solver_name"</span><span class="token punctuation">,</span><span class="token string">"ext_heuristic"</span><span class="token punctuation">,</span>
                <span class="token string">"solution_value"</span><span class="token punctuation">,</span>
                <span class="token string">"solution_time"</span><span class="token punctuation">,</span>
                <span class="token string">"best_lb"</span><span class="token punctuation">,</span>
                <span class="token string">"root_lb"</span><span class="token punctuation">,</span>
                <span class="token string">"root_time"</span><span class="token punctuation">,</span>
                <span class="token string">"nb_branch_and_bound_nodes"</span><span class="token punctuation">,</span>
                <span class="token string">"status"</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'{0} {1} {2} {3} {4} {5} {6} {7} {8} {9}\n'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>
            instance_path<span class="token punctuation">,</span>solver_name<span class="token punctuation">,</span><span class="token boolean">False</span> <span class="token keyword">if</span> upper_bound <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token keyword">else</span> <span class="token boolean">True</span><span class="token punctuation">,</span>
            model<span class="token punctuation">.</span>solution<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
            model<span class="token punctuation">.</span>statistics<span class="token punctuation">.</span>solution_time<span class="token punctuation">,</span>
            model<span class="token punctuation">.</span>statistics<span class="token punctuation">.</span>best_lb<span class="token punctuation">,</span>
            model<span class="token punctuation">.</span>statistics<span class="token punctuation">.</span>root_lb<span class="token punctuation">,</span>
            model<span class="token punctuation">.</span>statistics<span class="token punctuation">.</span>root_time<span class="token punctuation">,</span>
            model<span class="token punctuation">.</span>statistics<span class="token punctuation">.</span>nb_branch_and_bound_nodes<span class="token punctuation">,</span>
            model<span class="token punctuation">.</span>status
            <span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># export the result</span>
    <span class="token comment"># model.solution.export(instance_name.split(".")[0] + "_result")</span>

    <span class="token keyword">return</span> model<span class="token punctuation">.</span>solution

<span class="token keyword">def</span> <span class="token function">read_cvrp_instances</span><span class="token punctuation">(</span>instance_name<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Read literature instances from CVRPLIB by giving the name of instance
       and returns dictionary containing all elements of model"""</span>

    instance_iter <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>read_instance<span class="token punctuation">(</span>instance_name<span class="token punctuation">)</span><span class="token punctuation">)</span>
    points <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    id_point <span class="token operator">=</span> <span class="token number">0</span>
    dimension_input <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    capacity_input <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token comment"># Instantiate the data problem.</span>
    data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        element <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span>
        <span class="token keyword">if</span> element <span class="token operator">==</span> <span class="token string">"DIMENSION"</span><span class="token punctuation">:</span>
            <span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span>  <span class="token comment"># pass ":"</span>
            dimension_input <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> element <span class="token operator">==</span> <span class="token string">"CAPACITY"</span><span class="token punctuation">:</span>
            <span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span>  <span class="token comment"># pass ":"</span>
            capacity_input <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> element <span class="token operator">==</span> <span class="token string">"EDGE_WEIGHT_TYPE"</span><span class="token punctuation">:</span>
            <span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span>  <span class="token comment"># pass ":"</span>
            element <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span>
            <span class="token keyword">if</span> element <span class="token operator">!=</span> <span class="token string">"EUC_2D"</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"EDGE_WEIGHT_TYPE : "</span> <span class="token operator">+</span> element <span class="token operator">+</span> <span class="token triple-quoted-string string">"""
                is not supported (only EUC_2D)"""</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> element <span class="token operator">==</span> <span class="token string">"NODE_COORD_SECTION"</span><span class="token punctuation">:</span>
            <span class="token keyword">break</span>

    <span class="token comment"># Initialize vehicle type</span>
    vehicle_type <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"id"</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>  <span class="token comment"># we cannot have an id less than 1</span>
                    <span class="token string">"start_point_id"</span><span class="token punctuation">:</span> id_point<span class="token punctuation">,</span>
                    <span class="token string">"end_point_id"</span><span class="token punctuation">:</span> id_point<span class="token punctuation">,</span>
                    <span class="token string">"capacity"</span><span class="token punctuation">:</span> capacity_input<span class="token punctuation">,</span>
                    <span class="token string">"max_number"</span><span class="token punctuation">:</span> dimension_input<span class="token punctuation">,</span>
                    <span class="token string">"var_cost_dist"</span><span class="token punctuation">:</span> <span class="token number">1</span>
                    <span class="token punctuation">}</span>

    vehicles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    index <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>dimension_input<span class="token punctuation">)</span><span class="token punctuation">:</span>
        vehicles<span class="token punctuation">.</span>append<span class="token punctuation">(</span>capacity_input<span class="token punctuation">)</span>

    data<span class="token punctuation">[</span><span class="token string">'vehicle_capacities'</span><span class="token punctuation">]</span> <span class="token operator">=</span> vehicles
    data<span class="token punctuation">[</span><span class="token string">'vehicle_capacity'</span><span class="token punctuation">]</span> <span class="token operator">=</span> capacity_input
    data<span class="token punctuation">[</span><span class="token string">'num_vehicles'</span><span class="token punctuation">]</span> <span class="token operator">=</span> dimension_input
    data<span class="token punctuation">[</span><span class="token string">'depot'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token comment"># Create points</span>
    <span class="token keyword">for</span> current_id <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>dimension_input<span class="token punctuation">)</span><span class="token punctuation">:</span>
        point_id <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> point_id <span class="token operator">!=</span> current_id <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"Unexpected index"</span><span class="token punctuation">)</span>
        x_coord <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        y_coord <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        points<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"x"</span><span class="token punctuation">:</span> x_coord<span class="token punctuation">,</span>
                        <span class="token string">"y"</span><span class="token punctuation">:</span> y_coord<span class="token punctuation">,</span>
                        <span class="token string">"demand"</span><span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>
                        <span class="token string">"id"</span><span class="token punctuation">:</span> id_point<span class="token punctuation">}</span><span class="token punctuation">)</span>
        id_point <span class="token operator">+=</span> <span class="token number">1</span>

    element <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span>
    <span class="token keyword">if</span> element <span class="token operator">!=</span> <span class="token string">"DEMAND_SECTION"</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"Expected line DEMAND_SECTION"</span><span class="token punctuation">)</span>
    jobs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment"># Get the demands</span>
    <span class="token keyword">for</span> current_id <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>dimension_input<span class="token punctuation">)</span><span class="token punctuation">:</span>
        point_id <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> point_id <span class="token operator">!=</span> current_id <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"Unexpected index"</span><span class="token punctuation">)</span>
        demand <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        points<span class="token punctuation">[</span>current_id<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"demand"</span><span class="token punctuation">]</span> <span class="token operator">=</span> demand
        jobs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>demand<span class="token punctuation">)</span>
    
    data<span class="token punctuation">[</span><span class="token string">'demands'</span><span class="token punctuation">]</span> <span class="token operator">=</span> jobs

    element <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span>
    <span class="token keyword">if</span> element <span class="token operator">!=</span> <span class="token string">"DEPOT_SECTION"</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"Expected line DEPOT_SECTION"</span><span class="token punctuation">)</span>
    <span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span> <span class="token comment"># pass id depot</span>

    end_depot_section <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> end_depot_section <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"Expected only one depot."</span><span class="token punctuation">)</span>

    <span class="token comment"># Compute the links of graph</span>
    links <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    nb_link <span class="token operator">=</span> <span class="token number">0</span>
    matrix <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> point <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>points<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            dist <span class="token operator">=</span> compute_euclidean_distance<span class="token punctuation">(</span>point<span class="token punctuation">[</span><span class="token string">"x"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                                    point<span class="token punctuation">[</span><span class="token string">"y"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                                    points<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"x"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                                    points<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"y"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                                    <span class="token number">0</span><span class="token punctuation">)</span>
            links<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"L"</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>nb_link<span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token string">"start_point_id"</span><span class="token punctuation">:</span> point<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                          <span class="token string">"end_point_id"</span><span class="token punctuation">:</span> points<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                          <span class="token string">"distance"</span><span class="token punctuation">:</span> dist
                          <span class="token punctuation">}</span><span class="token punctuation">)</span>

            matrix<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> dist
            matrix<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> dist

            nb_link <span class="token operator">+=</span> <span class="token number">1</span>
    
    data<span class="token punctuation">[</span><span class="token string">'distance_matrix'</span><span class="token punctuation">]</span> <span class="token operator">=</span> matrix

    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"Points"</span><span class="token punctuation">:</span> points<span class="token punctuation">,</span>
            <span class="token string">"VehicleTypes"</span><span class="token punctuation">:</span> vehicle_type<span class="token punctuation">,</span>
            <span class="token string">"Links"</span><span class="token punctuation">:</span> links<span class="token punctuation">}</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>argv<span class="token punctuation">)</span><span class="token punctuation">:</span>
    instance_path <span class="token operator">=</span> <span class="token string">''</span>
    solver_name <span class="token operator">=</span> <span class="token string">''</span>
    solver_path <span class="token operator">=</span> <span class="token string">''</span>
    disableBuiltInHeur <span class="token operator">=</span> <span class="token boolean">False</span>
    time_resolution <span class="token operator">=</span> <span class="token number">30</span>
    upper_bound <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    opts<span class="token punctuation">,</span> args <span class="token operator">=</span> getopt<span class="token punctuation">.</span>getopt<span class="token punctuation">(</span>argv<span class="token punctuation">,</span><span class="token string">"i:s:u:b:e:p:"</span><span class="token punctuation">)</span>
   
    <span class="token keyword">for</span> opt<span class="token punctuation">,</span> arg <span class="token keyword">in</span> opts<span class="token punctuation">:</span>
        <span class="token keyword">if</span> opt <span class="token operator">==</span> <span class="token string">"-i"</span><span class="token punctuation">:</span>
            instance_path <span class="token operator">=</span> arg
        <span class="token keyword">elif</span> opt <span class="token operator">==</span> <span class="token string">"-s"</span><span class="token punctuation">:</span>
            solver_name <span class="token operator">=</span> arg
        <span class="token keyword">elif</span> opt <span class="token operator">==</span> <span class="token string">"-u"</span><span class="token punctuation">:</span>
            upper_bound <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
        <span class="token keyword">elif</span> opt <span class="token operator">==</span> <span class="token string">"-b"</span><span class="token punctuation">:</span>
            disableBuiltInHeur <span class="token operator">=</span> arg <span class="token operator">==</span> <span class="token string">"yes"</span>
        <span class="token keyword">elif</span> opt <span class="token operator">==</span> <span class="token string">"-e"</span><span class="token punctuation">:</span>
            time_resolution <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
        <span class="token keyword">if</span> opt <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"-p"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            solver_path <span class="token operator">=</span> arg

    solve_demo<span class="token punctuation">(</span>instance_path<span class="token punctuation">,</span> solver_name<span class="token punctuation">,</span> solver_path<span class="token punctuation">,</span> time_resolution<span class="token punctuation">,</span> disableBuiltInHeur<span class="token punctuation">,</span> upper_bound<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
        main<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<br> 
<h3><a id="42_MDVRP_522"></a>4.2 MDVRP</h3> 
<br> 
<p>多车场路径规划问题（MDVRP）是 CVRP 的一种变体，其中车辆来自于不同车场。</p> 
<pre><code class="prism language-python">
<span class="token keyword">import</span> os
<span class="token keyword">import</span> math
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> getopt
<span class="token keyword">from</span> VRPSolverEasy<span class="token punctuation">.</span>src <span class="token keyword">import</span> solver


<span class="token keyword">class</span> <span class="token class-name">DataMdvrp</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Contains all data for MDVRP problem
    """</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>
            self<span class="token punctuation">,</span>
            nb_customers<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span>
            nb_depots<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span>
            vehicle_capacity<span class="token punctuation">:</span> <span class="token builtin">int</span><span class="token punctuation">,</span>
            cust_demands<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
            cust_coordinates<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
            depot_coordinates<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>nb_customers <span class="token operator">=</span> nb_customers
        self<span class="token punctuation">.</span>nb_depots <span class="token operator">=</span> nb_depots
        self<span class="token punctuation">.</span>vehicle_capacity <span class="token operator">=</span> vehicle_capacity
        self<span class="token punctuation">.</span>cust_demands <span class="token operator">=</span> cust_demands
        self<span class="token punctuation">.</span>cust_coordinates <span class="token operator">=</span> cust_coordinates
        self<span class="token punctuation">.</span>depot_coordinates <span class="token operator">=</span> depot_coordinates


<span class="token keyword">def</span> <span class="token function">compute_euclidean_distance</span><span class="token punctuation">(</span>x_i<span class="token punctuation">,</span> y_i<span class="token punctuation">,</span> x_j<span class="token punctuation">,</span> y_j<span class="token punctuation">,</span> number_digit<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Compute the euclidean distance between 2 points from graph"""</span>
    <span class="token keyword">return</span> <span class="token builtin">round</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token punctuation">(</span>x_i <span class="token operator">-</span> x_j<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span>
                           <span class="token punctuation">(</span>y_i <span class="token operator">-</span> y_j<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> number_digit<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">read_instance</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" Read an instance in the folder data from a given name """</span>

    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>
            os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>normpath<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"r"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token keyword">for</span> element <span class="token keyword">in</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">solve_demo</span><span class="token punctuation">(</span>instance_name<span class="token punctuation">,</span>
               time_resolution<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span>
               solver_name_input<span class="token operator">=</span><span class="token string">"CLP"</span><span class="token punctuation">,</span>
               solver_path<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""return a solution from modelisation"""</span>

    <span class="token comment"># read parameters given in command line</span>
    type_instance <span class="token operator">=</span> <span class="token string">"MDVRP/"</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>instance_name<span class="token punctuation">)</span>
        opts <span class="token operator">=</span> getopt<span class="token punctuation">.</span>getopt<span class="token punctuation">(</span>instance_name<span class="token punctuation">,</span> <span class="token string">"i:t:s:p:"</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> opt<span class="token punctuation">,</span> arg <span class="token keyword">in</span> opts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> opt <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"-i"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                instance_name <span class="token operator">=</span> arg
                folder_data <span class="token operator">=</span> <span class="token string">""</span>
                type_instance <span class="token operator">=</span> <span class="token string">""</span>
            <span class="token keyword">if</span> opt <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"-t"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                time_resolution <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
            <span class="token keyword">if</span> opt <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"-s"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                solver_name_input <span class="token operator">=</span> arg
            <span class="token keyword">if</span> opt <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"-p"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                solver_path <span class="token operator">=</span> arg

    <span class="token comment"># read instance</span>
    data <span class="token operator">=</span> read_mdvrp_instances<span class="token punctuation">(</span>instance_name<span class="token punctuation">)</span>
    
    
    <span class="token comment"># modelisation of problem</span>
    model <span class="token operator">=</span> solver<span class="token punctuation">.</span>Model<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># add vehicle types</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>nb_depots<span class="token punctuation">)</span><span class="token punctuation">:</span>
        model<span class="token punctuation">.</span>add_vehicle_type<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span>data<span class="token punctuation">.</span>nb_customers <span class="token operator">+</span> i<span class="token punctuation">,</span>
                               start_point_id<span class="token operator">=</span>data<span class="token punctuation">.</span>nb_customers <span class="token operator">+</span> i<span class="token punctuation">,</span>
                               end_point_id<span class="token operator">=</span>data<span class="token punctuation">.</span>nb_customers <span class="token operator">+</span> i<span class="token punctuation">,</span>
                               capacity<span class="token operator">=</span>data<span class="token punctuation">.</span>vehicle_capacity<span class="token punctuation">,</span>
                               max_number<span class="token operator">=</span>data<span class="token punctuation">.</span>nb_customers<span class="token punctuation">,</span>
                               var_cost_dist<span class="token operator">=</span><span class="token number">1</span>
                               <span class="token punctuation">)</span>

    <span class="token comment"># add all customers</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>nb_customers<span class="token punctuation">)</span><span class="token punctuation">:</span>
        model<span class="token punctuation">.</span>add_customer<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span>i<span class="token punctuation">,</span>
                           id_customer<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>
                           demand<span class="token operator">=</span>data<span class="token punctuation">.</span>cust_demands<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
                           <span class="token punctuation">)</span>
    <span class="token comment"># add depots</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>nb_customers<span class="token punctuation">,</span>data<span class="token punctuation">.</span>nb_customers <span class="token operator">+</span> data<span class="token punctuation">.</span>nb_depots<span class="token punctuation">)</span><span class="token punctuation">:</span>
        model<span class="token punctuation">.</span>add_depot<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span>i<span class="token punctuation">)</span>



    nb_link <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token comment"># Compute the links between depots and other points</span>
    <span class="token keyword">for</span> index<span class="token punctuation">,</span>coord_depot <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>depot_coordinates<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> cust_i <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>cust_coordinates<span class="token punctuation">)</span><span class="token punctuation">:</span>
            dist <span class="token operator">=</span> compute_euclidean_distance<span class="token punctuation">(</span>
                cust_i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                cust_i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                coord_depot<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                coord_depot<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            model<span class="token punctuation">.</span>add_link<span class="token punctuation">(</span>start_point_id<span class="token operator">=</span>index<span class="token operator">+</span>data<span class="token punctuation">.</span>nb_customers<span class="token punctuation">,</span>
                           end_point_id<span class="token operator">=</span>i<span class="token punctuation">,</span>
                           distance<span class="token operator">=</span>dist
                           <span class="token punctuation">)</span>

    <span class="token comment"># Compute the links between points</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span>cust_i <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>cust_coordinates<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>cust_coordinates<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            dist <span class="token operator">=</span> compute_euclidean_distance<span class="token punctuation">(</span>cust_i<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                              cust_i<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                              data<span class="token punctuation">.</span>cust_coordinates<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                              data<span class="token punctuation">.</span>cust_coordinates<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            model<span class="token punctuation">.</span>add_link<span class="token punctuation">(</span>start_point_id<span class="token operator">=</span>i<span class="token punctuation">,</span>
                           end_point_id<span class="token operator">=</span>j<span class="token punctuation">,</span>
                           distance<span class="token operator">=</span>dist
                           <span class="token punctuation">)</span>

    <span class="token comment"># set parameters</span>
    model<span class="token punctuation">.</span>set_parameters<span class="token punctuation">(</span>time_limit<span class="token operator">=</span>time_resolution<span class="token punctuation">,</span>
                         solver_name<span class="token operator">=</span>solver_name_input<span class="token punctuation">)</span>

    <span class="token triple-quoted-string string">''' If you have cplex 22.1 installed on your laptop windows you have to specify
        solver path'''</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>solver_name_input <span class="token operator">==</span> <span class="token string">"CPLEX"</span> <span class="token keyword">and</span> solver_path <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        model<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span>cplex_path <span class="token operator">=</span> solver_path

    <span class="token comment">#model.export(instance_name,all_elements=True)</span>

    <span class="token comment"># solve model</span>
    model<span class="token punctuation">.</span>solve<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># export the result</span>
    <span class="token comment"># model.solution.export(instance_name.split(".")[0] + "_result")</span>

    <span class="token keyword">return</span> model<span class="token punctuation">.</span>solution<span class="token punctuation">.</span>value


<span class="token keyword">def</span> <span class="token function">read_mdvrp_instances</span><span class="token punctuation">(</span>instance_full_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Read literature instances of MDVRP by giving the name of instance
        and returns dictionary containing all elements of model"""</span>
    instance_iter <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>
        read_instance<span class="token punctuation">(</span>instance_full_path<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># pass type instance</span>
    <span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span>

    <span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span>

    nb_customers <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
    nb_depots <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>

    vehicle_capacities <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>nb_depots<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># pass max duration</span>
        <span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span>
        vehicle_capacities<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    cust_demands <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    cust_coordinates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>nb_customers<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span>
        cust_x <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        cust_y <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        cust_coordinates<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>cust_x<span class="token punctuation">,</span> cust_y<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment"># pass duration</span>
        <span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span>

        cust_demand <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        cust_demands<span class="token punctuation">.</span>append<span class="token punctuation">(</span>cust_demand<span class="token punctuation">)</span>
        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span>

    depot_coordinates <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token comment"># add depots and vehicle types</span>
    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>nb_depots<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span>
        cust_x <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        cust_y <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        depot_coordinates<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>cust_x<span class="token punctuation">,</span> cust_y<span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span>

    <span class="token keyword">return</span> DataMdvrp<span class="token punctuation">(</span>nb_customers<span class="token punctuation">,</span>
                     nb_depots<span class="token punctuation">,</span>
                     vehicle_capacities<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                     cust_demands<span class="token punctuation">,</span>
                     cust_coordinates<span class="token punctuation">,</span>
                     depot_coordinates
                     <span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
        solve_demo<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token triple-quoted-string string">"""Please indicates the parameters of your model like this : \n
       python MDVRP.py -i INSTANCE_PATH/NAME_INSTANCE \n
       -t TIME_RESOLUTION -s SOLVER_NAME (-p PATH_SOLVER (WINDOWS only))
       """</span><span class="token punctuation">)</span>
</code></pre> 
<br> 
<h3><a id="43_RICHVRP_738"></a>4.3 RICHVRP</h3> 
<br> 
<p>RichVRP 是 VRPSolverEasy 解决的特色问题之一，这里给出一个示例。它包括开放路线、多个仓库、多个时间窗口、两种类型的车辆（小型和大型）、可选客户和不兼容车辆（有些客户只可由小型车辆提供服务）。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> math
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> getopt
<span class="token keyword">from</span> VRPSolverEasy<span class="token punctuation">.</span>src <span class="token keyword">import</span> solver

<span class="token keyword">class</span> <span class="token class-name">Depot</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> tw_begin<span class="token punctuation">,</span> tw_end<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">=</span> <span class="token builtin">id</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> x
        self<span class="token punctuation">.</span>y <span class="token operator">=</span> y
        self<span class="token punctuation">.</span>tw_begin <span class="token operator">=</span> tw_begin
        self<span class="token punctuation">.</span>tw_end <span class="token operator">=</span> tw_end
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Depot(id: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">, x: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>x<span class="token punctuation">}</span></span><span class="token string">, y: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>y<span class="token punctuation">}</span></span><span class="token string">, "</span></span>
                <span class="token string-interpolation"><span class="token string">f"tw_begin: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>tw_begin<span class="token punctuation">}</span></span><span class="token string">, tw_end: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>tw_end<span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Vehicle</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> capacity<span class="token punctuation">,</span> fixed_cost<span class="token punctuation">,</span> var_cost<span class="token punctuation">,</span> max_number<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>capacity <span class="token operator">=</span> capacity
        self<span class="token punctuation">.</span>fixed_cost <span class="token operator">=</span> fixed_cost
        self<span class="token punctuation">.</span>var_cost <span class="token operator">=</span> var_cost
        self<span class="token punctuation">.</span>max_number <span class="token operator">=</span> max_number
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Vehicle(capacity: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>capacity<span class="token punctuation">}</span></span><span class="token string">, "</span></span>
                <span class="token string-interpolation"><span class="token string">f"fixed_cost: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>fixed_cost<span class="token punctuation">}</span></span><span class="token string">, var_cost: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>var_cost<span class="token punctuation">}</span></span><span class="token string">, "</span></span>
                <span class="token string-interpolation"><span class="token string">f"max_number: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>max_number<span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Customer</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> demand<span class="token punctuation">,</span> service_time<span class="token punctuation">,</span> optional<span class="token punctuation">,</span> only_small_veh<span class="token punctuation">,</span> time_windows<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">=</span> <span class="token builtin">id</span>
        self<span class="token punctuation">.</span>x <span class="token operator">=</span> x
        self<span class="token punctuation">.</span>y <span class="token operator">=</span> y
        self<span class="token punctuation">.</span>demand <span class="token operator">=</span> demand
        self<span class="token punctuation">.</span>service_time <span class="token operator">=</span> service_time
        self<span class="token punctuation">.</span>optional <span class="token operator">=</span> optional <span class="token comment"># Is the customer optional?</span>
        self<span class="token punctuation">.</span>only_small_veh <span class="token operator">=</span> only_small_veh <span class="token comment"># Can the customer served only by small vehicles? </span>
        self<span class="token punctuation">.</span>time_windows <span class="token operator">=</span> time_windows <span class="token comment"># List of time windows (list of pairs)</span>
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        tw_str <span class="token operator">=</span> <span class="token string">', '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f"(</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>start<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>end<span class="token punctuation">}</span></span><span class="token string">)"</span></span> <span class="token keyword">for</span> start<span class="token punctuation">,</span> end <span class="token keyword">in</span> self<span class="token punctuation">.</span>time_windows<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Customer(id: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">, x: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>x<span class="token punctuation">}</span></span><span class="token string">, y: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>y<span class="token punctuation">}</span></span><span class="token string">, "</span></span>
                <span class="token string-interpolation"><span class="token string">f"demand: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>demand<span class="token punctuation">}</span></span><span class="token string">, service_time: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>service_time<span class="token punctuation">}</span></span><span class="token string">, "</span></span>
                <span class="token string-interpolation"><span class="token string">f"optional: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>optional<span class="token punctuation">}</span></span><span class="token string">, only_small_veh: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>only_small_veh<span class="token punctuation">}</span></span><span class="token string">, "</span></span>
                <span class="token string-interpolation"><span class="token string">f"time_windows: [</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>tw_str<span class="token punctuation">}</span></span><span class="token string">])"</span></span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">DataRichVrp</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Contains all data for RichVRP
    """</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>
            self<span class="token punctuation">,</span>
            depots <span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
            big_vehicle <span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
            small_vehicle <span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">,</span>
            customers <span class="token punctuation">:</span> <span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>depots <span class="token operator">=</span> depots
        self<span class="token punctuation">.</span>big_vehicle <span class="token operator">=</span> big_vehicle
        self<span class="token punctuation">.</span>small_vehicle <span class="token operator">=</span> small_vehicle
        self<span class="token punctuation">.</span>customers <span class="token operator">=</span> customers 
    <span class="token keyword">def</span> <span class="token function">__str__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        depots_str <span class="token operator">=</span> <span class="token string">'\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>depot<span class="token punctuation">)</span> <span class="token keyword">for</span> depot <span class="token keyword">in</span> self<span class="token punctuation">.</span>depots<span class="token punctuation">]</span><span class="token punctuation">)</span>
        big_vehicle_str <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>big_vehicle<span class="token punctuation">)</span>
        small_vehicle_str <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>small_vehicle<span class="token punctuation">)</span>
        customers_str <span class="token operator">=</span> <span class="token string">'\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>customer<span class="token punctuation">)</span> <span class="token keyword">for</span> customer <span class="token keyword">in</span> self<span class="token punctuation">.</span>customers<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"DataRichVrp:\n\nDepots:\n</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>depots_str<span class="token punctuation">}</span></span><span class="token string">\n\nBig Vehicle:\n</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>big_vehicle_str<span class="token punctuation">}</span></span><span class="token string">"</span></span>
                <span class="token string-interpolation"><span class="token string">f"\n\nSmall Vehicle:\n</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>small_vehicle_str<span class="token punctuation">}</span></span><span class="token string">\n\nCustomers:\n</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>customers_str<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">compute_euclidean_distance</span><span class="token punctuation">(</span>x_i<span class="token punctuation">,</span> y_i<span class="token punctuation">,</span> x_j<span class="token punctuation">,</span> y_j<span class="token punctuation">,</span> number_digit<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Compute the euclidean distance between 2 points from graph"""</span>
    <span class="token keyword">return</span> <span class="token builtin">round</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span><span class="token punctuation">(</span>x_i <span class="token operator">-</span> x_j<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span> <span class="token operator">+</span>
                           <span class="token punctuation">(</span>y_i <span class="token operator">-</span> y_j<span class="token punctuation">)</span><span class="token operator">**</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> number_digit<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">read_instance</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">""" Read an instance in the folder data from a given name """</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>
            os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>normpath<span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"r"</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token keyword">for</span> element <span class="token keyword">in</span> <span class="token builtin">file</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token keyword">def</span> <span class="token function">solve_demo</span><span class="token punctuation">(</span>instance_name<span class="token punctuation">,</span>
               time_resolution<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">,</span>
               solver_name_input<span class="token operator">=</span><span class="token string">"CLP"</span><span class="token punctuation">,</span>
               solver_path<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""return a solution from modelisation"""</span>

    <span class="token comment"># read parameters given in command line</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>instance_name<span class="token punctuation">)</span>
        opts <span class="token operator">=</span> getopt<span class="token punctuation">.</span>getopt<span class="token punctuation">(</span>instance_name<span class="token punctuation">,</span> <span class="token string">"i:t:s:p:"</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> opt<span class="token punctuation">,</span> arg <span class="token keyword">in</span> opts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> opt <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"-i"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                instance_name <span class="token operator">=</span> arg
            <span class="token keyword">if</span> opt <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"-t"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                time_resolution <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span>
            <span class="token keyword">if</span> opt <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"-s"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                solver_name_input <span class="token operator">=</span> arg
            <span class="token keyword">if</span> opt <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"-p"</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                solver_path <span class="token operator">=</span> arg

    <span class="token comment"># read instance</span>
    data <span class="token operator">=</span> read_richvrp_instance<span class="token punctuation">(</span>instance_name<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>

    <span class="token comment"># modelisation of problem</span>
    model <span class="token operator">=</span> solver<span class="token punctuation">.</span>Model<span class="token punctuation">(</span><span class="token punctuation">)</span>

    big_vehicle_id <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment"># Big vehicles have odd ids</span>
    big_vehicle_ids <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment"># Store all the ids for big vehicles</span>
    small_vehicle_id <span class="token operator">=</span> <span class="token number">2</span> <span class="token comment"># Small vehicles have even ids</span>
    <span class="token comment"># Add depots and vehicles</span>
    <span class="token keyword">for</span> depot <span class="token keyword">in</span> data<span class="token punctuation">.</span>depots<span class="token punctuation">:</span>
        <span class="token comment"># Add the depot</span>
        model<span class="token punctuation">.</span>add_depot<span class="token punctuation">(</span><span class="token builtin">id</span> <span class="token operator">=</span> depot<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>
                        tw_begin <span class="token operator">=</span> depot<span class="token punctuation">.</span>tw_begin<span class="token punctuation">,</span>
                        tw_end <span class="token operator">=</span> depot<span class="token punctuation">.</span>tw_end<span class="token punctuation">)</span>
        <span class="token comment"># Add the big vehicle to this depot</span>
        model<span class="token punctuation">.</span>add_vehicle_type<span class="token punctuation">(</span><span class="token builtin">id</span> <span class="token operator">=</span> big_vehicle_id<span class="token punctuation">,</span>
                               start_point_id <span class="token operator">=</span> depot<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>
                               end_point_id <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment"># A vehicle may end anywhere </span>
                               capacity <span class="token operator">=</span> data<span class="token punctuation">.</span>big_vehicle<span class="token punctuation">.</span>capacity<span class="token punctuation">,</span>
                               max_number <span class="token operator">=</span> data<span class="token punctuation">.</span>big_vehicle<span class="token punctuation">.</span>max_number<span class="token punctuation">,</span>
                               fixed_cost <span class="token operator">=</span> data<span class="token punctuation">.</span>big_vehicle<span class="token punctuation">.</span>fixed_cost<span class="token punctuation">,</span>
                               var_cost_dist <span class="token operator">=</span> data<span class="token punctuation">.</span>big_vehicle<span class="token punctuation">.</span>var_cost<span class="token punctuation">,</span>
                               tw_begin <span class="token operator">=</span> depot<span class="token punctuation">.</span>tw_begin<span class="token punctuation">,</span>
                               tw_end <span class="token operator">=</span> depot<span class="token punctuation">.</span>tw_end<span class="token punctuation">)</span>
        <span class="token comment"># Add the small vehicle to this depot</span>
        model<span class="token punctuation">.</span>add_vehicle_type<span class="token punctuation">(</span><span class="token builtin">id</span> <span class="token operator">=</span> small_vehicle_id<span class="token punctuation">,</span>
                               start_point_id <span class="token operator">=</span> depot<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>
                               end_point_id <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment"># A vehicle may end anywhere </span>
                               capacity <span class="token operator">=</span> data<span class="token punctuation">.</span>small_vehicle<span class="token punctuation">.</span>capacity<span class="token punctuation">,</span>
                               max_number <span class="token operator">=</span> data<span class="token punctuation">.</span>small_vehicle<span class="token punctuation">.</span>max_number<span class="token punctuation">,</span>
                               fixed_cost <span class="token operator">=</span> data<span class="token punctuation">.</span>small_vehicle<span class="token punctuation">.</span>fixed_cost<span class="token punctuation">,</span>
                               var_cost_dist <span class="token operator">=</span> data<span class="token punctuation">.</span>small_vehicle<span class="token punctuation">.</span>var_cost<span class="token punctuation">,</span>
                               tw_begin <span class="token operator">=</span> depot<span class="token punctuation">.</span>tw_begin<span class="token punctuation">,</span>
                               tw_end <span class="token operator">=</span> depot<span class="token punctuation">.</span>tw_end<span class="token punctuation">)</span>
        big_vehicle_ids<span class="token punctuation">.</span>append<span class="token punctuation">(</span>big_vehicle_id<span class="token punctuation">)</span>
        big_vehicle_id <span class="token operator">+=</span> <span class="token number">2</span>
        small_vehicle_id <span class="token operator">+=</span> <span class="token number">2</span>

    <span class="token comment"># ID for alternative points of a customer with multiple time windows</span>
    next_id <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">[</span>customer<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token keyword">for</span> customer <span class="token keyword">in</span> data<span class="token punctuation">.</span>customers<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token comment"># IDs of a customer, including the alternative ones</span>
    customer_ids <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>customer<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span>customer<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">]</span> <span class="token keyword">for</span> customer <span class="token keyword">in</span> data<span class="token punctuation">.</span>customers<span class="token punctuation">}</span>
    <span class="token comment"># Add customers</span>
    <span class="token keyword">for</span> customer <span class="token keyword">in</span> data<span class="token punctuation">.</span>customers<span class="token punctuation">:</span>
        <span class="token comment"># Add a point for each time window of a customer</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> tw <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>customer<span class="token punctuation">.</span>time_windows<span class="token punctuation">)</span><span class="token punctuation">:</span>
            point_id <span class="token operator">=</span> customer<span class="token punctuation">.</span><span class="token builtin">id</span>
            <span class="token keyword">if</span> i <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span> <span class="token comment"># Is it an alternative point?</span>
                point_id <span class="token operator">=</span> next_id
                customer_ids<span class="token punctuation">[</span>customer<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>next_id<span class="token punctuation">)</span>
                next_id <span class="token operator">+=</span> <span class="token number">1</span> <span class="token comment"># Get the next alternative ID</span>
            model<span class="token punctuation">.</span>add_customer<span class="token punctuation">(</span><span class="token builtin">id</span> <span class="token operator">=</span> point_id<span class="token punctuation">,</span>
                                id_customer <span class="token operator">=</span> customer<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>
                                demand <span class="token operator">=</span> customer<span class="token punctuation">.</span>demand<span class="token punctuation">,</span>
                                service_time <span class="token operator">=</span> customer<span class="token punctuation">.</span>service_time<span class="token punctuation">,</span>
                                tw_begin <span class="token operator">=</span> tw<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                tw_end <span class="token operator">=</span> tw<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                penalty <span class="token operator">=</span> <span class="token number">1.0</span> <span class="token keyword">if</span> customer<span class="token punctuation">.</span>optional <span class="token keyword">else</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
                                incompatible_vehicles <span class="token operator">=</span> big_vehicle_ids <span class="token keyword">if</span> customer<span class="token punctuation">.</span>only_small_veh <span class="token keyword">else</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># Compute the links between depots and other points</span>
    <span class="token keyword">for</span> depot <span class="token keyword">in</span> data<span class="token punctuation">.</span>depots<span class="token punctuation">:</span>
        <span class="token keyword">for</span> customer <span class="token keyword">in</span> data<span class="token punctuation">.</span>customers<span class="token punctuation">:</span>
            dist <span class="token operator">=</span> compute_euclidean_distance<span class="token punctuation">(</span>customer<span class="token punctuation">.</span>x<span class="token punctuation">,</span> customer<span class="token punctuation">.</span>y<span class="token punctuation">,</span> depot<span class="token punctuation">.</span>x<span class="token punctuation">,</span> depot<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
            <span class="token keyword">for</span> point_id <span class="token keyword">in</span> customer_ids<span class="token punctuation">[</span>customer<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                model<span class="token punctuation">.</span>add_link<span class="token punctuation">(</span>start_point_id <span class="token operator">=</span> depot<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span>
                                end_point_id <span class="token operator">=</span> point_id<span class="token punctuation">,</span>
                                distance <span class="token operator">=</span> dist<span class="token punctuation">,</span>
                                time <span class="token operator">=</span> dist<span class="token punctuation">)</span>
                
    <span class="token comment"># Compute the links between customer points</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> c1 <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>customers<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> j<span class="token punctuation">,</span> c2 <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>customers<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> j <span class="token operator">&lt;=</span> i<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>
            dist <span class="token operator">=</span> compute_euclidean_distance<span class="token punctuation">(</span>c1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> c1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> c2<span class="token punctuation">.</span>x<span class="token punctuation">,</span> c2<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
            <span class="token comment"># Add a link for each pair of points from c1 to c2</span>
            <span class="token keyword">for</span> point_id_c1 <span class="token keyword">in</span> customer_ids<span class="token punctuation">[</span>c1<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> point_id_c2 <span class="token keyword">in</span> customer_ids<span class="token punctuation">[</span>c2<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                    model<span class="token punctuation">.</span>add_link<span class="token punctuation">(</span>start_point_id <span class="token operator">=</span> point_id_c1<span class="token punctuation">,</span>
                                    end_point_id <span class="token operator">=</span> point_id_c2<span class="token punctuation">,</span>
                                    distance <span class="token operator">=</span> dist<span class="token punctuation">,</span>
                                    time <span class="token operator">=</span> dist<span class="token punctuation">)</span>

    <span class="token comment"># set parameters</span>
    model<span class="token punctuation">.</span>set_parameters<span class="token punctuation">(</span>time_limit<span class="token operator">=</span>time_resolution<span class="token punctuation">,</span>
                         solver_name<span class="token operator">=</span>solver_name_input<span class="token punctuation">)</span>

    <span class="token triple-quoted-string string">''' If you have cplex 22.1 installed on your laptop windows you have to specify
        solver path'''</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>solver_name_input <span class="token operator">==</span> <span class="token string">"CPLEX"</span> <span class="token keyword">and</span> solver_path <span class="token operator">!=</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        model<span class="token punctuation">.</span>parameters<span class="token punctuation">.</span>cplex_path <span class="token operator">=</span> solver_path

    <span class="token comment"># model.export(instance_name)</span>

    <span class="token comment"># Solve model</span>
    model<span class="token punctuation">.</span>solve<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nCustomer IDs and time windows:"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> customer <span class="token keyword">in</span> data<span class="token punctuation">.</span>customers<span class="token punctuation">:</span>
        ids_and_tws <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i<span class="token punctuation">,</span> point_id <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>customer_ids<span class="token punctuation">[</span>customer<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            ids_and_tws<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"(id: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>point_id<span class="token punctuation">}</span></span><span class="token string">, tw: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token builtin">list</span><span class="token punctuation">(</span>customer<span class="token punctuation">.</span>time_windows<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">)"</span></span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Customer </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>customer<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token string">', '</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>ids_and_tws<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> model<span class="token punctuation">.</span>solution<span class="token punctuation">.</span>is_defined<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">.</span>solution<span class="token punctuation">)</span>

    <span class="token comment"># export the result</span>
    <span class="token comment"># model.solution.export(instance_name.split(".")[0] + "_result")</span>

    <span class="token keyword">return</span> model<span class="token punctuation">.</span>solution<span class="token punctuation">.</span>value

<span class="token keyword">def</span> <span class="token function">read_richvrp_instance</span><span class="token punctuation">(</span>instance_full_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""Read instance of RichVRP by giving the name of instance
        and returns dictionary containing all elements of model"""</span>
    instance_iter <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span>
        read_instance<span class="token punctuation">(</span>instance_full_path<span class="token punctuation">)</span><span class="token punctuation">)</span>

    nb_depots <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Read depots</span>
    depots <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>nb_depots<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">id</span> <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        y <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        tw_begin <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        tw_end <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        depots<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Depot<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> tw_begin<span class="token punctuation">,</span> tw_end<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Read big vehicle</span>
    capacity_big_veh <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
    fixed_cost_big_veh <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
    var_cost_big_veh <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
    max_numb_big_veh <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
    big_vehicle <span class="token operator">=</span> Vehicle<span class="token punctuation">(</span>capacity_big_veh<span class="token punctuation">,</span> fixed_cost_big_veh<span class="token punctuation">,</span> var_cost_big_veh<span class="token punctuation">,</span> max_numb_big_veh<span class="token punctuation">)</span>

    <span class="token comment"># Read small vehicle</span>
    capacity_small_veh <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
    fixed_cost_small_veh <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
    var_cost_small_veh <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
    max_numb_small_veh <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
    small_vehicle <span class="token operator">=</span> Vehicle<span class="token punctuation">(</span>capacity_small_veh<span class="token punctuation">,</span> fixed_cost_small_veh<span class="token punctuation">,</span> var_cost_small_veh<span class="token punctuation">,</span> max_numb_small_veh<span class="token punctuation">)</span>

    <span class="token comment"># Read customers</span>
    nb_customers <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
    customers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>nb_customers<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">id</span> <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        x <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        y <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        demand <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        service_time <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        optional <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token boolean">True</span> <span class="token keyword">else</span> <span class="token boolean">False</span>
        small_vehicle_flag <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token keyword">if</span> <span class="token boolean">True</span> <span class="token keyword">else</span> <span class="token boolean">False</span>
        nb_time_windows <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
        time_windows <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>nb_time_windows<span class="token punctuation">)</span><span class="token punctuation">:</span>
            tw_begin <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
            tw_end <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>instance_iter<span class="token punctuation">)</span><span class="token punctuation">)</span>
            time_windows<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>tw_begin<span class="token punctuation">,</span> tw_end<span class="token punctuation">)</span><span class="token punctuation">)</span>
        customers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Customer<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> demand<span class="token punctuation">,</span> service_time<span class="token punctuation">,</span> optional<span class="token punctuation">,</span> small_vehicle_flag<span class="token punctuation">,</span> time_windows<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> DataRichVrp<span class="token punctuation">(</span>depots<span class="token punctuation">,</span> big_vehicle<span class="token punctuation">,</span> small_vehicle<span class="token punctuation">,</span> customers<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">:</span>
        solve_demo<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token triple-quoted-string string">"""Please indicates the parameters of your model like this : \n
       python RichVRP.py -i INSTANCE_PATH/NAME_INSTANCE \n
       -t TIME_RESOLUTION -s SOLVER_NAME (-p PATH_SOLVER (WINDOWS only))
       """</span><span class="token punctuation">)</span>

</code></pre> 
<br> 
<h2><a id="5__1024"></a>5. 性能</h2> 
<br> 
<p>毕竟是精确算法求解器，在大规模问题上还是拼不过启发式算法，对于200 个以上客户的算例得到最优解可能需要很长时间（数小时或数天），但少于 100 个客户的算例一般可以在几分钟内得到解决。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/780342c9499dcf70cb481e92ced683ce/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">深入理解 Golang 中的值类型和引用类型</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/92d3dd9613de86e5031636345755979b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">用数据结构python写大数计算器</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>