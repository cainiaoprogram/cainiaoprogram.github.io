<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>在vs mac中基于.Net6 Mvc EFcore生成数据表（mysql版） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="在vs mac中基于.Net6 Mvc EFcore生成数据表（mysql版）" />
<meta property="og:description" content="脑子抽筋尝试在vs 2022 for mac 版本中编写Mvc应用，真是踩的一堆坑，试了大半天终于将mysql数据库连接配置完成，（基于code firts）
---------------------------环境------------------------------
操作系统：macOS monterey 12.1(M1)
mysql数据库：8.0.28-arm64
开发工具：Visual Studio 2022 for Mac （Preview）（尝鲜。。。bug真多一言难尽哈哈哈哈）
---------------------------------------------------------------
开始溜达起来：
一、创建.NET6 MVC应用
二、导入相关NuGet包
Microsoft.EntityFrameworkCore Microsoft.EntityFrameworkCore.Tools Pomelo.EntityFrameworkCore.MySql 三、配置数据连接并迁移
(1)构造数据连接类
新建Data文件夹-&gt;文件夹中新增空白类-&gt;添加如下代码
using System; using Microsoft.EntityFrameworkCore; namespace EFdome.Data { //原始生成的类代码 //public class MyDbContext //{ //	public MyDbContext() //	{ //	} //} //手动改造后的类代码 public class MyDbContext:DbContext { public MyDbContext(DbContextOptions&lt;MyDbContext&gt; options):base(options) { } } } (2)修改appsettings.json配置类
增加ConnectionStrings
{ &#34;Logging&#34;: { &#34;LogLevel&#34;: { &#34;Default&#34;: &#34;Information&#34;, &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/2994bc03163567c07ce41c5531c35ca7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-20T15:41:41+08:00" />
<meta property="article:modified_time" content="2022-05-20T15:41:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">在vs mac中基于.Net6 Mvc EFcore生成数据表（mysql版）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>脑子抽筋尝试在vs 2022 for mac 版本中编写Mvc应用，真是踩的一堆坑，试了大半天终于将mysql数据库连接配置完成，（基于code firts）</p> 
<p>---------------------------环境------------------------------</p> 
<p>操作系统：macOS monterey 12.1(M1)</p> 
<p>mysql数据库：8.0.28-arm64</p> 
<p>开发工具：Visual Studio 2022 for Mac （Preview）（尝鲜。。。bug真多一言难尽哈哈哈哈）</p> 
<p>---------------------------------------------------------------</p> 
<p>开始溜达起来：</p> 
<p>一、创建.NET6 MVC应用</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/b2/ac/BzUmnwMO_o.png" width="1200"></p> 
<p>二、导入相关NuGet包</p> 
<pre><code class="language-cs">Microsoft.EntityFrameworkCore
Microsoft.EntityFrameworkCore.Tools
Pomelo.EntityFrameworkCore.MySql</code></pre> 
<p>三、配置数据连接并迁移</p> 
<p>(1)构造数据连接类</p> 
<p>        新建Data文件夹-&gt;文件夹中新增空白类-&gt;添加如下代码</p> 
<pre><code class="language-cs">using System;
using Microsoft.EntityFrameworkCore;
namespace EFdome.Data
{
	//原始生成的类代码
	//public class MyDbContext
	//{
	//	public MyDbContext()
	//	{

	//	}
	//}


	//手动改造后的类代码
	public class MyDbContext:DbContext
	{
		public MyDbContext(DbContextOptions&lt;MyDbContext&gt; options):base(options)
		{

		}
	}
}
</code></pre> 
<p>(2)修改appsettings.json配置类</p> 
<p>    增加ConnectionStrings</p> 
<pre><code>{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning"
    }
  },
  "AllowedHosts": "*",
  "ConnectionStrings": {
    "MySql": "server=localhost;user=root;database=mvcTest;port=3306;password=123456"
  }
}
</code></pre> 
<p>(3)修改Program.cs</p> 
<p>    注.Net6 生成的MVC应用中Startup.cs已被去掉相关代码以整合到Program.cs中</p> 
<p>    所以在Program中做如下修改</p> 
<pre><code>//新增引用
using Microsoft.EntityFrameworkCore;
using StudentMVC.Data;

var builder = WebApplication.CreateBuilder(args);

// Add services to the container.
builder.Services.AddControllersWithViews();


//新增数据库连接读取
builder.Services.AddDbContext&lt;MyDbContext&gt;(options =&gt; options.UseMySql(
    builder.Configuration.GetConnectionString("MySql"),
    ServerVersion.AutoDetect(builder.Configuration.GetConnectionString("MySql"))));
//builder.Services.AddScoped(&lt;DbContext, MyDbContext&gt;);


var app = builder.Build();

// Configure the HTTP request pipeline.
if (!app.Environment.IsDevelopment())
{
    app.UseExceptionHandler("/Home/Error");
}
app.UseStaticFiles();

app.UseRouting();

app.UseAuthorization();

app.MapControllerRoute(
    name: "default",
    pattern: "{controller=Home}/{action=Index}/{id?}");

app.Run();

</code></pre> 
<p>(4)新增数据表模型</p> 
<p>    在Models文件夹中新建两个类LoginModel、EmployeeModel</p> 
<pre><code class="language-cs">using System;
using System.ComponentModel.DataAnnotations;

namespace EFdome.Models
{
	public class LoginModel
	{
		[Key]
		public int ID { get; set; }

		[Required]
		[Display(Name ="登陆账号")]
		public string LoginName { get; set; }

		[Display(Name ="登陆密钥")]
		public string LoginPwd { get; set; }

		[Display(Name ="账号状态")]
		public int UserStatus { get; set; }

		[Display(Name ="创建时间")]
		public DateTime? CreateTime { get; set; }

		[Display(Name ="最近一次登陆时间")]
		public DateTime? LoginTime { get; set; }
	}
}</code></pre> 
<pre><code class="language-cs">using System;
using System.ComponentModel.DataAnnotations;

namespace EFdome.Models
{
	public class Employee
	{
		[Key]
		public int ID { get; set; }

		[Display(Name ="用户姓名")]
		public string UserName { get; set; }

		[Display(Name = "用户性别")]
		public string? UserSex { get; set; }

		[Display(Name = "用户年龄")]
		public string? UserAge { get; set; }

		[Display(Name = "用户电话")]
		public string? UserPhone { get; set; }

		[Display(Name = "用户状态")]
		public int UserStatus { get; set; }

		[Display(Name = "用户创建时间")]
		public DateTime? CreateTime { get; set; }

		[Display(Name = "用户住址")]
		public string? HomePath { get; set; }
	}
}

</code></pre> 
<p>    在连接器中注册这两个模型</p> 
<pre><code class="language-cs">using System;
using EFdome.Models;
using Microsoft.EntityFrameworkCore;
namespace EFdome.Data
{
	//原始生成的类代码
	//public class MyDbContext
	//{
	//	public MyDbContext()
	//	{

	//	}
	//}


	//手动改造后的类代码
	public class MyDbContext : DbContext
	{
		public MyDbContext(DbContextOptions&lt;MyDbContext&gt; options) : base(options)
		{

		}


		//在连接器中注册这两个模型
		public DbSet&lt;LoginModel&gt; Logins { get; set; }

		public DbSet&lt;EmployeeModel&gt; Employees { get; set; }
	}

	
}</code></pre> 
<p>(5)用过ef工具进行数据迁移</p> 
<p>    注：在VS for Mac 中包控制器是不能进行输入指令操作的，刚开始不知道真实想到头秃</p> 
<p>    在VS for Mac 中打开终端通过dotnet指令操作     Path：点击“查看”-》“终端”。 </p> 
<p>    踩坑....VS终端中切换拼音输入法在点击字母输入VS就崩溃了,异常提交地址：</p> 
<p><a class="has-card" href="https://developercommunity.visualstudio.com/t/%E7%BB%88%E7%AB%AF%E8%BE%93%E5%85%A5%E5%AD%97%E6%AF%8D%E7%B1%BB%E5%9E%8B%E6%9C%89%E9%97%AE%E9%A2%98-Typing-using-an-IME-in-the/10042362?space=41&amp;q=244009012" rel="nofollow" title="Visual Studio Feedback"><span class="link-card-box"><span class="link-title">Visual Studio Feedback</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/53/57/P6cOXYHg_o.png" alt="icon-default.png?t=M4AD">https://developercommunity.visualstudio.com/t/%E7%BB%88%E7%AB%AF%E8%BE%93%E5%85%A5%E5%AD%97%E6%AF%8D%E7%B1%BB%E5%9E%8B%E6%9C%89%E9%97%AE%E9%A2%98-Typing-using-an-IME-in-the/10042362?space=41&amp;q=244009012</span></span></a></p> 
<p>    输入dotnet指令查看是否安装ef（Microsoft.EntityFrameworkCore.Tools）</p> 
<pre><code class="language-cs">dotnet ef --version</code></pre> 
<p>   cd 到项目的根目录执行以下指令</p> 
<pre><code class="language-cs"> dotnet ef migrations add '迁移名称'</code></pre> 
<pre><code>winkk@wenwenwendeMacBook-Pro ef % dotnet ef migrations add 'EFdome1'
Build started...
Build succeeded.
info: Microsoft.EntityFrameworkCore.Infrastructure[10403]
      Entity Framework Core 6.0.5 initialized 'MyDbContext' using provider 'Pomelo.EntityFrameworkCore.MySql:6.0.1' with options: ServerVersion 8.0.28-mysql 
Done. To undo this action, use 'ef migrations remove'</code></pre> 
<p>  出现以上信息证明迁移成功，然后执行数据库更新指令创建对应的表</p> 
<pre><code class="language-cs"> dotnet ef database update</code></pre> 
<pre><code class="language-cs">winkk@wenwenwendeMacBook-Pro ef % dotnet ef database update
Build started...
Build succeeded.
info: Microsoft.EntityFrameworkCore.Infrastructure[10403]
      Entity Framework Core 6.0.5 initialized 'MyDbContext' using provider 'Pomelo.EntityFrameworkCore.MySql:6.0.1' with options: ServerVersion 8.0.28-mysql 
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (19ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='mvcTest' AND TABLE_NAME='__EFMigrationsHistory';
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (22ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      CREATE TABLE `__EFMigrationsHistory` (
          `MigrationId` varchar(150) CHARACTER SET utf8mb4 NOT NULL,
          `ProductVersion` varchar(32) CHARACTER SET utf8mb4 NOT NULL,
          CONSTRAINT `PK___EFMigrationsHistory` PRIMARY KEY (`MigrationId`)
      ) CHARACTER SET=utf8mb4;
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (4ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT 1 FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA='mvcTest' AND TABLE_NAME='__EFMigrationsHistory';
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (4ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT `MigrationId`, `ProductVersion`
      FROM `__EFMigrationsHistory`
      ORDER BY `MigrationId`;
info: Microsoft.EntityFrameworkCore.Migrations[20402]
      Applying migration '20220515095132_EFdome1'.
Applying migration '20220515095132_EFdome1'.
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (1ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      ALTER DATABASE CHARACTER SET utf8mb4;
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (5ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      CREATE TABLE `Employees` (
          `ID` int NOT NULL AUTO_INCREMENT,
          `UserName` longtext CHARACTER SET utf8mb4 NOT NULL,
          `UserSex` longtext CHARACTER SET utf8mb4 NULL,
          `UserAge` longtext CHARACTER SET utf8mb4 NULL,
          `UserPhone` longtext CHARACTER SET utf8mb4 NULL,
          `UserStatus` int NOT NULL,
          `CreateTime` datetime(6) NULL,
          `HomePath` longtext CHARACTER SET utf8mb4 NULL,
          CONSTRAINT `PK_Employees` PRIMARY KEY (`ID`)
      ) CHARACTER SET=utf8mb4;
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (5ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      CREATE TABLE `Logins` (
          `ID` int NOT NULL AUTO_INCREMENT,
          `LoginName` longtext CHARACTER SET utf8mb4 NOT NULL,
          `LoginPwd` longtext CHARACTER SET utf8mb4 NOT NULL,
          `UserStatus` int NOT NULL,
          `CreateTime` datetime(6) NULL,
          `LoginTime` datetime(6) NULL,
          CONSTRAINT `PK_Logins` PRIMARY KEY (`ID`)
      ) CHARACTER SET=utf8mb4;
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (1ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      INSERT INTO `__EFMigrationsHistory` (`MigrationId`, `ProductVersion`)
      VALUES ('20220515095132_EFdome1', '6.0.5');
Done.</code></pre> 
<p> 输出以上信息则会在对应的数据库中生成相应的表（Employess、Logins） 如图所示</p> 
<p><img alt="" height="1116" src="https://images2.imgbox.com/37/7e/pDfMaKs3_o.png" width="1112"></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6771ee63669e5657c56d4507a8b4c6b7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">全面认识包图，组件图，部署图</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/89db69cae39b26dedd3a6375f7b95119/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python opencv 简单的车牌识别 —— 简单学习</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>