<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>通过OCCI操作Oracle数据库详解 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="通过OCCI操作Oracle数据库详解" />
<meta property="og:description" content="1.简介
OCCI 即 Oracle C&#43;&#43; Call Interface 在Windows下访问Oracle数据库可以使用ADO,ADO.NET,OLEDB,ODBC,跨平台的OCCI等方法,其中速度最快，对Oracle支持最完整的是Oracle提供的OCCI.
2.安装OCCI SDK
OCCI SDK 包含在 Oracle 客户端中，在如下位置可以找到： 头文件： %OARCLE_HOME%\oci\include 库文件：%OARCLE_HOME% \oci\lib\msvc 推荐安装 Oracle 即时客户端（ Instant Client ），它也包含有 OCCI SDK 。 头文件： instantclient\sdk\include 库文件： instantclient\sdk\lib\msvc 3.OCCI编程步骤 3.1连接到数据库 // 创建 OCCI 上下文环境 Environment *env = Environment::createEnvironment(); assert ( env != NULL ); // 创建数据库连接 Connection *conn = env-&gt;createConnection(&#34;uid&#34;,&#34;pwd&#34;,&#34;oracle_svr_name&#34;); //... // todo: 插入自己的代码 // 关闭连接 env -&gt; terminateConnection ( conn ); // 释放 Environment :: terminateEnvironment ( env ); 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b5dd90d0046f14e43a313bb0a1df4e3e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-03-31T12:34:32+08:00" />
<meta property="article:modified_time" content="2017-03-31T12:34:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">通过OCCI操作Oracle数据库详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="color:rgb(51,51,51); line-height:26px; font-family:Arial; font-size:14px"> <span style="font-family:宋体; font-size:9pt"> <strong>1.简介</strong></span></p> 
<p style="color:rgb(51,51,51); line-height:26px; font-family:Arial; font-size:14px"> <span style="font-family:宋体; font-size:9pt"> OCCI 即 <a target="_blank" title="Oracle知识库" class="replace_word" href="http://lib.csdn.net/base/oracle" rel="nofollow noopener noreferrer" style="color:rgb(223,52,52); font-weight:bold; text-decoration:none">Oracle</a> C++ Call Interface     </span></p> 
<p style="color:rgb(51,51,51); line-height:26px; font-family:Arial; font-size:14px"> <span style="font-family:宋体; font-size:9pt"> 在</span><span style="">Windows</span><span style="font-family:宋体; font-size:9pt">下访问</span><span style="">Oracle</span><span style="font-family:宋体; font-size:9pt"><a target="_blank" title="MySQL知识库" class="replace_word" href="http://lib.csdn.net/base/mysql" rel="nofollow noopener noreferrer" style="color:rgb(223,52,52); font-weight:bold; text-decoration:none">数据库</a>可以使用</span><span style="">ADO,ADO<a target="_blank" title=".NET知识库" class="replace_word" href="http://lib.csdn.net/base/dotnet" rel="nofollow noopener noreferrer" style="color:rgb(223,52,52); font-weight:bold; text-decoration:none">.NET</a>,OLEDB,ODBC,</span><span style="font-family:宋体; font-size:9pt">跨平台的</span><span style="">OCCI</span><span style="font-family:宋体; font-size:9pt">等方法</span><span style="">,</span><span style="font-family:宋体; font-size:9pt">其中速度最快，对</span><span style="">Oracle</span><span style="font-family:宋体; font-size:9pt">支持最完整的是</span><span style="">Oracle</span><span style="font-family:宋体; font-size:9pt">提供的</span><span style="">OCCI.</span></p> 
<p style="color:rgb(51,51,51); line-height:26px; font-family:Arial; font-size:14px"> <strong>   2.安装OCCI SDK</strong></p> 
<div align="left" style="color:rgb(51,51,51); line-height:26px; font-family:Arial; font-size:14px"> 
 <span style="">  OCCI SDK</span> 
 <span style="font-family:宋体; font-size:9pt">包含在</span> 
 <span style="">Oracle</span> 
 <span style="font-family:宋体; font-size:9pt">客户端中，在如下位置可以找到：</span> 
</div> 
<div align="left" style="color:rgb(51,51,51); line-height:26px; font-family:Arial; font-size:14px"> 
 <span style="font-family:宋体; font-size:9pt">  头文件：</span> 
 <span style="">%OARCLE_HOME%\oci\include</span> 
</div> 
<div align="left" style="color:rgb(51,51,51); line-height:26px; font-family:Arial; font-size:14px"> 
 <span style="font-family:宋体; font-size:9pt">  库文件：<span style="">%OARCLE_HOME%</span></span> 
 <span style="">\oci\lib\msvc</span> 
</div> 
<div align="left" style="color:rgb(51,51,51); line-height:26px; font-family:Arial; font-size:14px">
    
</div> 
<div align="left" style="color:rgb(51,51,51); line-height:26px; font-family:Arial; font-size:14px"> 
 <span style="font-family:宋体; font-size:9pt">  推荐安装</span> 
 <span style="">Oracle</span> 
 <span style="font-family:宋体; font-size:9pt">即时客户端（</span> 
 <span style="">Instant Client</span> 
 <span style="font-family:宋体; font-size:9pt">），它也包含有</span> 
 <span style="">OCCI SDK</span> 
 <span style="font-family:宋体; font-size:9pt">。</span> 
</div> 
<div align="left" style="color:rgb(51,51,51); line-height:26px; font-family:Arial; font-size:14px"> 
 <span style="font-family:宋体; font-size:9pt">  头文件：</span> 
 <span style="">instantclient\sdk\include</span> 
</div> 
<div align="left" style="color:rgb(51,51,51); line-height:26px; font-family:Arial; font-size:14px"> 
 <span style="font-family:宋体; font-size:9pt">  库文件：</span> 
 <span style="">instantclient\sdk\lib\msvc</span> 
</div> 
<div align="left" style="color:rgb(51,51,51); line-height:26px; font-family:Arial; font-size:14px"> 
 <div align="left"> 
  <strong><span style=""> 3.OCCI</span><span style="font-family:宋体; font-size:9pt">编程步骤</span></strong> 
 </div> 
 <div align="left"> 
  <strong><span style="">3.1</span><span style="font-family:宋体; font-size:9pt">连接到数据库</span></strong> 
 </div> 
 <div align="left"> 
  <span style="">//</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">创建</span> 
  <span style="">OCCI</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">上下文环境</span> 
 </div> 
 <div align="left"> 
  <span style="">Environment</span> 
  <span style=""><span style="color:red">*</span><span style="color:black">env</span> <span style="color:red">=</span> <span style="color:black">Environment</span><span style="color:red">::</span><span style="color:black">createEnvironment</span><span style="color:red">();</span></span> 
 </div> 
 <div align="left"> 
  <span style="">assert</span> 
  <span style="">(</span> 
  <span style="">env</span> 
  <span style="">!=</span> 
  <span style="">NULL</span> 
  <span style="">);</span> 
 </div> 
 <div align="left"> 
  <span style="">//</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">创建数据库连接</span> 
 </div> 
 <div align="left"> 
  <span style="">Connection</span> 
  <span style=""><span style="color:red">*</span><span style="color:black">conn</span> <span style="color:red">=</span> <span style="color:black">env</span><span style="color:red">-&gt;</span><span style="color:black">createConnection</span><span style="color:red">(</span><span style="color:teal">"uid"</span><span style="color:red">,</span><span style="color:teal">"pwd"</span><span style="color:red">,</span><span style="color:teal">"oracle_svr_name"</span><span style="color:red">);</span></span> 
 </div> 
 <div align="left">
     
 </div> 
 <div align="left"> 
  <span style="">//...</span> 
 </div> 
 <div align="left"> 
  <span style="">// todo:</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">插入自己的代码</span> 
 </div> 
 <div align="left"> 
  <span style="">//</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">关闭连接</span> 
 </div> 
 <div align="left"> 
  <span style="">env</span> 
  <span style="">-&gt;</span> 
  <span style="">terminateConnection</span> 
  <span style="">(</span> 
  <span style="">conn</span> 
  <span style="">);</span> 
 </div> 
 <div align="left"> 
  <span style="">//</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">释放</span> 
 </div> 
 <div align="left"> 
  <span style="">Environment</span> 
  <span style="">::</span> 
  <span style="">terminateEnvironment</span> 
  <span style="">(</span> 
  <span style="">env</span> 
  <span style="">);</span> 
 </div> 
 <div align="left"> 
  <strong><span style="">3.2</span><span style="font-family:宋体; font-size:9pt">执行基本的</span><span style="">SQL</span><span style="font-family:宋体; font-size:9pt">语句</span></strong> 
 </div> 
 <div align="left"> 
  <span style="">//</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">创建</span> 
  <span style="">SQL</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">语句控制句柄</span> 
 </div> 
 <div align="left"> 
  <span style="">Statement</span> 
  <span style=""><span style="color:red">*</span><span style="color:black">stmt</span> <span style="color:red">=</span> <span style="color:black">conn</span><span style="color:red">-&gt;</span><span style="color:black">createStatement</span><span style="color:red">();</span></span> 
 </div> 
 <div align="left"> 
  <strong><span style="">a.</span><span style="font-family:宋体; font-size:9pt">执行一般的</span><span style="">SQL</span><span style="font-family:宋体; font-size:9pt">语句</span></strong> 
 </div> 
 <div align="left"> 
  <span style="">stmt</span> 
  <span style="">-&gt;</span> 
  <span style="">executeUpdate</span> 
  <span style="">(</span> 
  <span style="">"Create TABLE basket_tab (fruit VARCHAR2(30), quantity NUMBER)"</span> 
  <span style="">);</span> 
 </div> 
 <div align="left"> 
  <span style="">stmt</span> 
  <span style="">-&gt;</span> 
  <span style="">executeUpdate</span> 
  <span style="">(</span> 
  <span style="">"delete basket_tab"</span> 
  <span style="">);</span> 
 </div> 
 <div align="left"> 
  <strong><span style="">b.</span><span style="font-family:宋体; font-size:9pt">重复利用</span><span style="">SQL</span><span style="font-family:宋体; font-size:9pt">语句</span><span style="">,</span><span style="font-family:宋体; font-size:9pt">参数化的</span><span style="">SQL</span><span style="font-family:宋体; font-size:9pt">语句</span></strong> 
 </div> 
 <div align="left"> 
  <span style="">//:1,:2</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">是参数占位符</span> 
 </div> 
 <div align="left"> 
  <span style="">stmt</span> 
  <span style="">-&gt;</span> 
  <span style="">setSQL</span> 
  <span style="">(</span> 
  <span style="">"Insert INTO basket_tab VALUES(:1,:2)"</span> 
  <span style="">);</span> 
 </div> 
 <div align="left"> 
  <span style="">//</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">第一个参数</span> 
 </div> 
 <div align="left"> 
  <span style="">stmt</span> 
  <span style="">-&gt;</span> 
  <span style="">setString</span> 
  <span style="">(1,</span> 
  <span style=""><span style="color:teal">"Bananas"</span><span style="color:red">);</span></span> 
 </div> 
 <div align="left"> 
  <span style="">//</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">第二个参数</span> 
 </div> 
 <div align="left"> 
  <span style="">stmt</span> 
  <span style="">-&gt;</span> 
  <span style="">setInt</span> 
  <span style="">(2,</span> 
  <span style=""><span style="color:red">5);</span></span> 
 </div> 
 <div align="left"> 
  <span style="">stmt</span> 
  <span style="">-&gt;</span> 
  <span style="">executeUpdate</span> 
  <span style="">();</span> 
 </div> 
 <div align="left">
     
  <strong><span style="">c.</span><span style="font-family:宋体; font-size:9pt">一次修改多行数据</span></strong> 
 </div> 
 <div align="left"> 
  <span style="">//</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">最多允许的迭代次数，注意这个参数需要在</span> 
  <span style="">setXXX</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">系列函数之前执行</span> 
 </div> 
 <div align="left"> 
  <span style="">stmt</span> 
  <span style="">-&gt;</span> 
  <span style="">setMaxIterations</span> 
  <span style="">(</span> 
  <span style="">int</span> 
  <span style=""><span style="color:black">maxIterations</span><span style="color:red">);</span></span> 
 </div> 
 <div align="left"> 
  <span style="">//</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">指定某个参数的大小，</span> 
  <span style="">string</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">和</span> 
  <span style="">byte</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">需要</span> 
 </div> 
 <div align="left"> 
  <span style="">stmt</span> 
  <span style="">-&gt;</span> 
  <span style="">setMaxParamSize</span> 
  <span style="">(</span> 
  <span style="">int</span> 
  <span style=""><span style="color:black">parameterIndex</span><span style="color:red">,</span> <span style="color:blue">int</span> <span style="color:black">maxParamSize</span><span style="color:red">);</span></span> 
 </div> 
 <div align="left"> 
  <span style="">for</span> 
  <span style="">(...)</span> 
 </div> 
 <div align="left"> 
  <span style="">{<!-- --></span> 
 </div> 
 <div align="left"> 
  <span style="">    <span style="color:green">// </span></span> 
  <span style="font-family:宋体; color:green; font-size:9pt">第一个参数</span> 
 </div> 
 <div align="left"> 
  <span style="">    <span style="color:black">stmt</span><span style="color:red">-&gt;</span><span style="color:black">setString</span><span style="color:red">(1,</span><span style="color:teal">"Bananas"</span><span style="color:red">);</span></span> 
 </div> 
 <div align="left"> 
  <span style="">    <span style="color:green">// </span></span> 
  <span style="font-family:宋体; color:green; font-size:9pt">第二个参数</span> 
 </div> 
 <div align="left"> 
  <span style="">    <span style="color:black">stmt</span><span style="color:red">-&gt;</span><span style="color:black">setInt</span><span style="color:red">(2,</span><span style="color:red">5);</span></span> 
 </div> 
 <div align="left">
     
 </div> 
 <div align="left"> 
  <span style="">    <span style="color:green">//</span></span> 
  <span style="font-family:宋体; color:green; font-size:9pt">増加一行记录，类似于</span> 
  <span style="">ADO</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">的</span> 
  <span style="">AddNew</span> 
 </div> 
 <div align="left"> 
  <span style="">    <span style="color:black">pStmt</span><span style="color:red">-&gt;</span><span style="color:black">addIteration</span><span style="color:red">();</span></span> 
 </div> 
 <div align="left"> 
  <span style="">}</span> 
 </div> 
 <div align="left"> 
  <span style="">stmt</span> 
  <span style="">-&gt;</span> 
  <span style="">executeUpdate</span> 
  <span style="">();</span> 
 </div> 
 <div align="left"> 
  <strong><span style="">d.</span><span style="font-family:宋体; font-size:9pt">执行查询：获取结果集</span><span style="">(</span><span style="font-family:宋体; font-size:9pt">记录集</span><span style="">)</span></strong> 
 </div> 
 <div align="left"> 
  <span style="">ResultSet</span> 
  <span style=""><span style="color:red">*</span><span style="color:black">rs</span> <span style="color:red">=</span> <span style="color:black">stmt</span><span style="color:red">-&gt;</span><span style="color:black">executeQuery</span><span style="color:red">(</span><span style="color:teal">"Select * FROM basket_tab"</span><span style="color:red">);</span></span> 
 </div> 
 <div align="left"> 
  <span style="">while</span> 
  <span style=""><span style="color:red">(</span><span style="color:black">rs</span><span style="color:red">-&gt;</span><span style="color:black">next</span><span style="color:red">())</span></span> 
 </div> 
 <div align="left"> 
  <span style="">{<!-- --></span> 
 </div> 
 <div align="left"> 
  <span style="">    <span style="color:black">string</span> <span style="color:black">fruit</span> <span style="color:red">=</span><span style="color:black">rs</span><span style="color:red">-&gt;</span><span style="color:black">getString</span><span style="color:red">(1);</span><span style="color:green">// get the first column as string</span></span> 
 </div> 
 <div align="left"> 
  <span style="">    <span style="color:blue">int</span> <span style="color:black">quantity</span> <span style="color:red">=</span><span style="color:black">rs</span><span style="color:red">-&gt;</span><span style="color:black">getInt</span><span style="color:red">(2);</span><span style="color:green">// get the second column as int</span></span> 
 </div> 
 <div align="left"> 
  <span style="">}</span> 
 </div> 
 <div align="left"> 
  <span style="">//</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">关闭结果集</span> 
 </div> 
 <div align="left"> 
  <span style="">stmt</span> 
  <span style="">-&gt;</span> 
  <span style="">closeResultSet</span> 
  <span style="">(</span> 
  <span style="">rs</span> 
  <span style="">);</span> 
 </div> 
 <div align="left"> 
  <strong><span style="">e.</span><span style="font-family:宋体; font-size:9pt">执行存储过程</span></strong> 
 </div> 
 <div align="left"> 
  <span style="">//</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">指定存储过程</span> 
  <span style="">countFruit</span> 
 </div> 
 <div align="left"> 
  <span style="">stmt</span> 
  <span style="">-&gt;</span> 
  <span style="">setSQL</span> 
  <span style="">(</span> 
  <span style="">"BEGIN countFruit(:1, :2); END:"</span> 
  <span style="">);</span> 
 </div> 
 <div align="left"> 
  <span style="">//</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">设置第一个参数</span> 
 </div> 
 <div align="left"> 
  <span style="">stmt</span> 
  <span style="">-&gt;</span> 
  <span style="">setString</span> 
  <span style="">(1,</span> 
  <span style=""><span style="color:teal">"Apples"</span><span style="color:red">);</span></span> 
 </div> 
 <div align="left"> 
  <span style="">int</span> 
  <span style=""><span style="color:black">quantity</span><span style="color:red">;</span></span> 
 </div> 
 <div align="left"> 
  <span style="">//</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">注册输出参数</span> 
 </div> 
 <div align="left"> 
  <span style="">stmt</span> 
  <span style="">-&gt;</span> 
  <span style="">registerOutParam</span> 
  <span style="">(2,</span> 
  <span style=""><span style="color:black">Type</span><span style="color:red">::</span><span style="color:black">OCCIINT</span><span style="color:red">,</span><span style="color:blue">sizeof</span><span style="color:red">(</span><span style="color:black">quantity</span><span style="color:red">));</span></span> 
 </div> 
 <div align="left"> 
  <span style="">//</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">执行此存储过程</span> 
 </div> 
 <div align="left"> 
  <span style="">stmt</span> 
  <span style="">-&gt;</span> 
  <span style="">executeUpdate</span> 
  <span style="">();</span> 
 </div> 
 <div align="left">
     
 </div> 
 <div align="left"> 
  <span style="">//</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">释放</span> 
  <span style="">SQL</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">语句控制句柄</span> 
 </div> 
 <div align="left"> 
  <span style="">conn</span> 
  <span style="">-&gt;</span> 
  <span style="">terminateStatement</span> 
  <span style="">(</span> 
  <span style="">Statement</span> 
  <span style=""><span style="color:red">*</span><span style="color:black">stmt</span><span style="color:red">);</span></span> 
 </div> 
 <div align="left"> 
  <br> 
 </div> 
 <div align="left"> 
  <strong><span style="">3.3</span><span style="font-family:宋体; font-size:9pt">事务</span></strong> 
 </div> 
 <div align="left"> 
  <span style="font-family:宋体; font-size:9pt">所有的</span> 
  <span style="">DDL</span> 
  <span style="font-family:宋体; font-size:9pt">默认开始并自动提交一个事务</span> 
 </div> 
 <div align="left"> 
  <span style="font-family:宋体; font-size:9pt">所有的</span> 
  <span style="">DML</span> 
  <span style="font-family:宋体; font-size:9pt">默认开始一个事务，且不会自动提交</span> 
 </div> 
 <div align="left">
     
 </div> 
 <div align="left"> 
  <span style="">//</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">可以指定</span> 
  <span style="">DML</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">是否自动提交</span> 
 </div> 
 <div align="left"> 
  <span style="">stmt</span> 
  <span style="">-&gt;</span> 
  <span style="">setAutoCommit</span> 
  <span style="">(</span> 
  <span style="">TRUE</span> 
  <span style="">/</span> 
  <span style="">FALSE</span> 
  <span style="">);</span> 
 </div> 
 <div align="left">
     
 </div> 
 <div align="left"> 
  <span style="">//</span> 
  <span style="font-family:宋体; color:green; font-size:9pt">也可以手动提交或回滚。</span> 
 </div> 
 <div align="left"> 
  <span style="">conn</span> 
  <span style="">-&gt;</span> 
  <span style="">commit</span> 
  <span style="">();</span> 
 </div> 
 <div align="left"> 
  <span style="">conn</span> 
  <span style="">-&gt;</span> 
  <span style="">rollback</span> 
  <span style="">();</span>  
 </div> 
 <div align="left"> 
  <strong><span style="">3.4</span><span style="font-family:宋体; font-size:9pt">异常处理</span></strong> 
 </div> 
 <div align="left"> 
  <span style="">try</span> 
 </div> 
 <div align="left"> 
  <span style="">{<!-- --></span> 
 </div> 
 <div align="left"> 
  <span style="">    <span style="color:green">//OCCI</span></span> 
  <span style="font-family:宋体; color:green; font-size:9pt">程序</span> 
 </div> 
 <div align="left"> 
  <span style="">}</span> 
 </div> 
 <div align="left"> 
  <span style="">catch</span> 
  <span style=""><span style="color:red">(</span><span style="color:black">SQLException</span> <span style="color:red">&amp;</span><span style="color:black">sqlExcp</span><span style="color:red">)</span></span> 
 </div> 
 <div align="left"> 
  <span style="">{<!-- --></span> 
 </div> 
 <div align="left"> 
  <span style="">    <span style="color:black">cerr</span> <span style="color:red">&lt;&lt;</span><span style="color:black">sqlExcp</span><span style="color:red">.</span><span style="color:black">getErrorCode</span><span style="color:red">&lt;&lt;</span> <span style="color:teal">": "</span> <span style="color:red">&lt;&lt;</span> <span style="color:black">sqlExcp</span><span style="color:red">.</span><span style="color:black">getErrorMessage</span><span style="color:red">()</span><span style="color:red">&lt;&lt;</span> <span style="color:black">endl</span><span style="color:red">;</span></span> 
 </div> 
 <div align="left"> 
  <span style="">}</span> 
 </div> 
 <div align="left"> 
  <span style="">catch</span> 
  <span style=""><span style="color:red">(</span><span style="color:black">exception</span> <span style="color:red">&amp;</span><span style="color:black">excp</span><span style="color:red">)</span></span> 
 </div> 
 <div align="left"> 
  <span style="">{<!-- --></span> 
 </div> 
 <div align="left"> 
  <span style="">    <span style="color:black">cerr</span> <span style="color:red">&lt;&lt;</span> <span style="color:black">excp</span><span style="color:red">.</span><span style="color:black">what</span><span style="color:red">()</span><span style="color:red">&lt;&lt;</span> <span style="color:black">endl</span><span style="color:red">;</span></span> 
 </div> 
 <div align="left"> 
  <span style="">}</span> 
 </div> 
</div> 
<div align="left" style="color:rgb(51,51,51); line-height:26px; font-family:Arial; font-size:14px">
    
</div> 
<div align="left" style="color:rgb(51,51,51); line-height:26px; font-family:Arial; font-size:14px"> 
 <h2 style="margin:0px; padding:0px"><a target="_blank" name="t0" style="color:rgb(51,102,153)"></a><span style="">1.</span>   <span style="font-size:32px">OCCI</span><span style="font-size:32px">编程模式</span></h2> 
 <h3 style="margin:0px; padding:0px"><a target="_blank" name="t1" style="color:rgb(51,102,153)"></a><span style="font-size:24px">1.1.</span> <span style="font-size:24px">总体流程图</span></h3> 
 <p>编写<span style="">OCCI</span>程序的总体流程图，如下所示：</p> 
 <p align="left"><span style=""><img alt="" src="https://images2.imgbox.com/a1/ec/8cpKZQEe_o.jpg" style="border:currentColor; max-width:100%"> </span></p> 
 <h3 style="margin:0px; padding:0px"><a target="_blank" name="t2" style="color:rgb(51,102,153)"></a><span style="font-size:24px">1.2.</span> <span style="font-size:24px">执行SQL语句的流程图</span></h3> 
 <p>在<span style="">OCCI</span>中处理<span style="">SELECT</span>语句跟处理<span style="">INSERT</span>、<span style="">UPDATE</span>、<span style="">CREATE</span>等语句的方法是不一样的，其中<span style="">SELECT</span>语句是有返回结果，其它语句没有返回结果，所以必须区分<span style="">SQL</span>语句是否为查询语句，然后按照各自的流程处理。流程图如下所示：</p> 
 <p><img alt="" src="https://images2.imgbox.com/37/0a/WAHizbjn_o.jpg" style="border:currentColor; max-width:100%"></p> 
 <p></p> 
 <span style=""></span> 
 <p> </p> 
 <p><span style="font-family:Calibri">2.   </span>流程图具体说明</p> 
 <p><span style="font-family:Calibri">2.1. </span>创建与终止<span style="font-family:Calibri">OCCI</span>环境变量</p> 
 <p>创建<span style="font-family:Calibri">OCCI</span>环境变量</p> 
 <p><span style="font-family:Calibri">Environment</span>类是<span style="font-family:Calibri">OCCI</span>程序的基础类，所有的<span style="font-family:Calibri">OCCI</span>对象的建立都是依计<span style="font-family:Calibri">Environment</span>对象来创建的，所以<span style="font-family:Calibri">Environment</span>对象的建立必须放在第一位，而且也必须是最后一个被终止的。例如：首先创建一个<span style="font-family:Calibri">Environment</span>对象<span style="font-family:Calibri">env</span>，然后通过<span style="font-family:Calibri">env</span>创建一个<span style="font-family:Calibri">Connection</span>对象<span style="font-family:Calibri">conn</span>，<span style="font-family:Calibri">conn</span>是连接了数据库的对象；终止时，却反过来先终止对象<span style="font-family:Calibri">conn</span>，再终止对象<span style="font-family:Calibri">env</span>。具体<span style="font-family:Calibri">Environment</span>对象的创建方法如下所示：</p> 
 <p><span style="font-family:Calibri"> Environment *env = Environment::createEnvironment();</span></p> 
 <p><span style="font-family:Calibri"> </span>注意：<span style="font-family:Calibri">createEnvironment()</span>方法有以下几个参数模式：</p> 
 <p><span style="font-family:Calibri">1</span>．在线程环境中运行分为互斥线程<span style="font-family:Calibri">(THREADEC_MUTEXED)</span>、并行线程<span style="font-family:Calibri">(THREADEC_UMMUTEXED)</span>。</p> 
 <p><span style="font-family:Calibri">2</span>．使用对象（<span style="font-family:Calibri">OBJECT</span>）。</p> 
 <p><span style="font-family:Calibri">3</span>．利用共享<a target="_blank" title="算法与数据结构知识库" class="replace_word" href="http://lib.csdn.net/base/datastructure" rel="nofollow noopener noreferrer" style="color:rgb(223,52,52); font-weight:bold; text-decoration:none">数据结构</a>（<span style="font-family:Calibri">SHARED</span>）。</p> 
 <p>终止<span style="font-family:Calibri">OCCI</span>环境变量</p> 
 <p><span style="font-family:Calibri">Environment</span>对象的终止必须是放在最后一位，即等所有其它<span style="font-family:Calibri">OCCI</span>对象被终止完后再终止<span style="font-family:Calibri">Environment</span>对象。终止<span style="font-family:Calibri">Environment</span>对象的方法如下所示：</p> 
 <p><span style="font-family:Calibri">Environment::terminateEnvironment(env);</span></p> 
 <p><span style="font-family:Calibri">2.2. </span>连接与断开数据库</p> 
 <p>连接数据库</p> 
 <p>创建完一个<span style="font-family:Calibri">Environment</span>对象<span style="font-family:Calibri">env</span>后，可以调用<span style="font-family:Calibri">Environment</span>类下的方法<span style="font-family:Calibri">createConnection()</span>来创建一个<span style="font-family:Calibri">Connection</span>对象<span style="font-family:Calibri">conn</span>；通过<span style="font-family:Calibri">createConnection()</span>方法我们可以连接到任意一个数据库中。连接数据库的具体方法如下所示：</p> 
 <p><span style="font-family:Calibri">Connection *conn =env-&gt;createConnection(usename,password,[connectionstring]);</span></p> 
 <p>参数说明：<span style="font-family:Calibri">usename</span>是登录数据库的用户名；</p> 
 <p><span style="font-family:Calibri">         password</span>是登录数据库用户的密码；</p> 
 <p><span style="font-family:Calibri">         connectstingr</span>是数据库的连接串<span style="font-family:Calibri">(</span>可选<span style="font-family:Calibri">)</span>。</p> 
 <p>断开数据库</p> 
 <p>当对数据库操作完成之后，我们必须断开程序与数据库的连接，断开数据库的连接方法与创建的方法一样来自<span style="font-family:Calibri">Environment</span>类下的<span style="font-family:Calibri">terminateConnection()</span>函数。方法如下所示：</p> 
 <p><span style="font-family:Calibri">env-&gt;terminateConnection(conn);</span></p> 
 <p><span style="font-family:Calibri">2.3. </span>创建与断开连接池</p> 
 <p>创建连接池</p> 
 <p>对于很多共享服务器或中间层应用程序而言，数据库的连接必须要能被许多线程所使用，如果为每个线程都开一个数据库连接的话，当数量一大效率会明显的降低，所以我们通过创建连接池来处理这样的情况。创建完一个<span style="font-family:Calibri">Environment</span>对象<span style="font-family:Calibri">env</span>后，可以调用<span style="font-family:Calibri">Environment</span>类下的方法<span style="font-family:Calibri">createConnectionPool()</span>来创建一个<span style="font-family:Calibri">Connection</span>对象<span style="font-family:Calibri">connPool</span>；通过<span style="font-family:Calibri">createConnectionPool()</span>方法我们可以连接到任意一个数据库中。连接池创建的具体方法如下所示：</p> 
 <p><span style="font-family:Calibri">ConnectionPool  *connPool= env-&gt;createConnectionPool(</span></p> 
 <p><span style="font-family:Calibri">const string &amp;poolUseName,</span></p> 
 <p><span style="font-family:Calibri">const string &amp;poolPassWord,</span></p> 
 <p><span style="font-family:Calibri">const string &amp;connectstring,</span></p> 
 <p><span style="font-family:Calibri">unsigned int   minConn,</span></p> 
 <p><span style="font-family:Calibri">unsigned int   maxConn,</span></p> 
 <p><span style="font-family:Calibri">unsigned int   incrConn);</span></p> 
 <p>参数说明：<span style="font-family:Calibri">poolUseName</span>是连接池的用户名；</p> 
 <p><span style="font-family:Calibri">                poolPassWord</span>是连接数据库的密码；</p> 
 <p><span style="font-family:Calibri">                connectstring</span>是数据库连接串；</p> 
 <p><span style="font-family:Calibri">                minConn</span>是最小连接数；</p> 
 <p><span style="font-family:Calibri">                maxConn</span>是最大连接数；</p> 
 <p><span style="font-family:Calibri">                incrConn</span>是指所有已连接数处于繁忙中且小于最大连接数时，每次增加的连接数。</p> 
 <p>断开连接池</p> 
 <p>当对数据库操作完成之后，我们必须断开程序与数据库的连接，断开数据库的连接方法与创建的方法一样来自<span style="font-family:Calibri">Environment</span>类下的<span style="font-family:Calibri">terminateConnectPool()</span>函数。方法如下所示：</p> 
 <p><span style="font-family:Calibri">env-&gt;terminateConnectPool(connPoll);</span></p> 
 <p><span style="font-family:Calibri">2.4. </span>创建与终止<span style="font-family:Calibri">Statement</span>对象</p> 
 <p><span style="font-family:Calibri">2.4.1. </span>创建<span style="font-family:Calibri">Statement</span>对象</p> 
 <p><span style="font-family:Calibri">Statement</span>类包含了执行<span style="font-family:Calibri">SQL</span>语句的所有方法，是对数据库操作的具体实现。<span style="font-family:Calibri">Statement</span>对象<span style="font-family:Calibri">stmt</span>的创建是通过调用<span style="font-family:Calibri">Connection</span>类下的<span style="font-family:Calibri">createStatement()</span>函数实现，所以<span style="font-family:Calibri">Statement</span>对象的创建必须是在<span style="font-family:Calibri">Connection</span>对象创建之后。<span style="font-family:Calibri">createStatement()</span>函数可以带参数或不带参数，如果带参数的话，参数必须是一个<span style="font-family:Calibri">SQL</span>语句；如果没有带参数，则在后面必须用<span style="font-family:Calibri">Statement</span>类下<span style="font-family:Calibri">setSQL()</span>函数为<span style="font-family:Calibri">Statement</span>对象赋一个<span style="font-family:Calibri">SQL</span>语句。<span style="font-family:Calibri">Statement</span>对象的创建方法如下所示：</p> 
 <p><span style="font-family:Calibri">Statement *stmt =conn-&gt;createStatement();</span></p> 
 <p>终止<span style="font-family:Calibri">Statement</span>对象</p> 
 <p>当对数据库的操作完成时，我们必须先终止<span style="font-family:Calibri">Statement</span>对象，再断开<span style="font-family:Calibri">Connection</span>对象。终止<span style="font-family:Calibri">Statement</span>对象的方法如下所示：</p> 
 <p><span style="font-family:Calibri">Conn-&gt;terminateStatement(stmt);</span></p> 
 <p><span style="font-family:Calibri">3.   </span>执行<span style="font-family:Calibri">SQL</span>语句（<span style="font-family:Calibri">Statement</span>类）</p> 
 <p><span style="font-family:Calibri">3.1. </span>执行<span style="font-family:Calibri">SQL</span>语句的方法</p> 
 <p>执行<span style="font-family:Calibri">SQL</span>的所有方法都包含在<span style="font-family:Calibri">Statement</span>类下。<span style="font-family:Calibri">SQL</span>语句按返回结果分，可以分为两种：一种是有返回值的（查询语句），另外一种是没有返回值的（非查询语句）。一般情况下，在执行查询<span style="font-family:Calibri">SQL</span>语句我们使用<span style="font-family:Calibri">executeQurey()</span>函数，在执行非查询<span style="font-family:Calibri">SQL</span>语句时我们使用<span style="font-family:Calibri">executeUpdate()</span>函数。</p> 
 <p><span style="font-family:Calibri">1</span>．<span style="font-family:Calibri"> stmt-&gt;execute();</span>执行所有非特殊声明的<span style="font-family:Calibri">SQL</span>语句。</p> 
 <p><span style="font-family:Calibri">2</span>．<span style="font-family:Calibri">stmt-&gt;executeUpdate();</span>执行所有<span style="font-family:Calibri">DDL</span>和<span style="font-family:Calibri">DML</span>（一条记录）的<span style="font-family:Calibri">SQL</span>语句。</p> 
 <p><span style="font-family:Calibri">3</span>．<span style="font-family:Calibri">stmt-&gt;executeQurey();</span>执行所有查询<span style="font-family:Calibri">SQL</span>语句。</p> 
 <p><span style="font-family:Calibri">4</span>．<span style="font-family:Calibri">stmt-&gt;executeArrayUpdate();</span>执行多记录的<span style="font-family:Calibri">DML</span>的<span style="font-family:Calibri">SQL</span>语句。</p> 
 <p>例如：</p> 
 <p><span style="font-family:Calibri">      stmt-&gt;executeUpdate(</span>“<span style="font-family:Calibri">createtable student (sno number(10),sname varchar2)</span>”<span style="font-family:Calibri">)</span>；</p> 
 <p><span style="font-family:Calibri">      stmt-&gt;executeUpdate(“insertinto student (sno,sname)  values(1,’ZHANGSAN’)”);</span></p> 
 <p><span style="font-family:Calibri">      stmt-&gt;executeQurey(“select  snofrom student ”);</span></p> 
 <p><span style="font-family:Calibri">3.2. </span>执行非查询语句</p> 
 <p>当我们创建了一个<span style="font-family:Calibri">Statement</span>对象<span style="font-family:Calibri">stmt</span>后，可以通过<span style="font-family:Calibri">Statement</span>类下的方法<span style="font-family:Calibri">setSQL()</span>为<span style="font-family:Calibri">stmt</span>设置不同的<span style="font-family:Calibri">SQL</span>语句。</p> 
 <p><span style="font-family:Calibri">3.2.1.</span>准备<span style="font-family:Calibri">SQL</span>语句</p> 
 <p><span style="font-family:Calibri">stmt-&gt;setSQL(string &amp;sql)</span>；</p> 
 <p>例如：</p> 
 <p><span style="font-family:Calibri">stmt-&gt;setSQL(“insertinto student(sno,sname)  values(:1,:2)”)</span></p> 
 <p>其中：<span style="font-family:Calibri">:1</span>、<span style="font-family:Calibri">:2</span>是参数，通过给参数赋不同的值来实现。</p> 
 <p>与之对应的函数<span style="font-family:Calibri">getSQL()</span>是取出当前对象对应的<span style="font-family:Calibri">SQL</span>语句。</p> 
 <p><span style="font-family:Calibri">3.2.2. </span>绑定输入参数值</p> 
 <p>在<span style="font-family:Calibri">Statement</span>类中包含了所有参数的赋值方法，赋值方法<span style="font-family:Calibri">set</span>×××<span style="font-family:Calibri">(unsignedint paramindex,type values),</span>其中<span style="font-family:Calibri">paramindex</span>参数是代表所赋值参数在<span style="font-family:Calibri">SQL</span>语句中的第几个参数，×××与<span style="font-family:Calibri">type</span>代表中所赋值的类型，<span style="font-family:Calibri">values</span>是所赋的值。×××可以是<span style="font-family:Calibri">Int</span>、<span style="font-family:Calibri">String</span>、<span style="font-family:Calibri">Date</span>等等。</p> 
 <p>例如：</p> 
 <p><span style="font-family:Calibri">stmt-&gt;setString(1,</span>’<span style="font-family:Calibri">zhangsan</span>’<span style="font-family:Calibri">)</span>；指把’<span style="font-family:Calibri">zhangsan</span>’赋值给第一个参数，参数类型为字符串型。</p> 
 <p><span style="font-family:Calibri">stmt-&gt;setInt(2,1009);</span>指把<span style="font-family:Calibri">1009</span>赋值给第二个参数，参数类型为整型。</p> 
 <p><span style="font-family:Calibri">3.2.3.   </span>执行非查询语句</p> 
 <p>当<span style="font-family:Calibri">SQL</span>语句准备好后，就可以执行<span style="font-family:Calibri">SQL</span>语句了，方法如下所示：</p> 
 <p><span style="font-family:Calibri">stmt-&gt;executeUpdate();</span></p> 
 <p><span style="font-family:Calibri">3.3. </span>执行查询语句（<span style="font-family:Calibri">SELECT</span>）</p> 
 <p>在执行查询语句时有返回查询结果（可能是一条，也可能是多条），我们必须创建一个<span style="font-family:Calibri">ResultSet</span>对象来处理，通过使用<span style="font-family:Calibri">ResultSet</span>对象的<span style="font-family:Calibri">next()</span>方法我们可以一条一条（或批量）地处理结果集。具体使用如下所示：</p> 
 <p><span style="font-family:Calibri">3.3.1.   </span>准备<span style="font-family:Calibri">SQL</span>语句</p> 
 <p>详见<span style="font-family:Calibri">3.2.1</span>。</p> 
 <p><span style="font-family:Calibri">3.3.2.   </span>绑定输入参数值</p> 
 <p>详见<span style="font-family:Calibri">3.2.2</span>。</p> 
 <p><span style="font-family:Calibri">3.3.3.   </span>执行查询语句</p> 
 <p><span style="font-family:Calibri">ResultSet *rs = stmt-&gt;executeQuery();</span></p> 
 <p><span style="font-family:Calibri">3.3.4. </span>定义输出变量</p> 
 <p>根据<span style="font-family:Calibri">SELECT</span>语句查询的列的类型定义对应的变量，此变量用于存储<span style="font-family:Calibri">SELECT</span>查询的结果集。</p> 
 <p><span style="font-family:Calibri">3.3.5. </span>推进或处理数据</p> 
 <p>如果结果集为多条记录，我们可以批量或者一条条处理数据，使用<span style="font-family:Calibri">ResultSet</span>类下的方法<span style="font-family:Calibri">next(unsigned int numRows)</span>。</p> 
 <p>在<span style="font-family:Calibri">Statement</span>类中包含了所有参数的取值方法。取值方法<span style="font-family:Calibri">get</span>×××（<span style="font-family:Calibri">unsignedint paramindex</span>），其中<span style="font-family:Calibri">paramindex</span>参数是代表所取值列在<span style="font-family:Calibri">SQL</span>语句中的第几列，×××代表该列对应的类型。×××可以是<span style="font-family:Calibri">Int</span>、<span style="font-family:Calibri">String</span>、<span style="font-family:Calibri">Date</span>等等。</p> 
 <p>例如：</p> 
 <p><span style="font-family:Calibri">rs-&gt;next(unsignedint numRows);//</span>其中<span style="font-family:Calibri">numRows</span>为批量处理的记录行数。</p> 
 <p><span style="font-family:Calibri">stmt-&gt;getInt(paramindex);</span>获取整型参数值<span style="font-family:Calibri">,</span>其中<span style="font-family:Calibri">paramindex</span>为参数所在的位置；</p> 
 <p><span style="font-family:Calibri">stmt-&gt;getString(paramindex);</span>获取字符型参数值其中<span style="font-family:Calibri">paramindex</span>为参数所在的位置；</p> 
 <p><span style="font-family:Calibri">3.4. </span>输出参数声明</p> 
 <p>在调用存储过程时，有时候有返回参数，这些返回参数都必须在调用之前先用<span style="font-family:Calibri">Statement</span>类下的<span style="font-family:Calibri">registerOutParam()</span>方法声明，声明方法的使用如下所示：</p> 
 <p><span style="font-family:Calibri">stmt-&gt;registerOutParam(paramName,paramType,paramSize);</span></p> 
 <p>其中：<span style="font-family:Calibri">paramName</span>是参数名或者参数所在位置；</p> 
 <p><span style="font-family:Calibri">        paramType</span>是参数类型（比如：<span style="font-family:Calibri">TYPE::OCCIINT</span>）；</p> 
 <p><span style="font-family:Calibri">        paramSize</span>是参数的大小。</p> 
 <p><span style="font-family:Calibri">3.5. </span>事务提交</p> 
 <p><span style="font-family:Calibri">3.5.1. </span>手动提交</p> 
 <p>当事务的提交设置为手动时，每完成一个事务我们都必须调用<span style="font-family:Calibri">Connection</span>类下的<span style="font-family:Calibri">commit()</span>或<span style="font-family:Calibri">rollback()</span>方法来提交一个事务。使用方法如下所示：</p> 
 <p>手动提交必须调用以下函数：</p> 
 <p><span style="font-family:Calibri">Connection::commit();</span></p> 
 <p><span style="font-family:Calibri">Connection::rollback();</span></p> 
 <p><span style="font-family:Calibri">3.5.2. </span>自动提交</p> 
 <p>在对数据库进行操作的过程中，一个事务的提交是用手动还是自动，我们可以调用<span style="font-family:Calibri">Statement</span>类下的<span style="font-family:Calibri">setAutoCommit()</span>方法来设置。使用方法如下所示：</p> 
 <p>设置自动提交：</p> 
 <p><span style="font-family:Calibri">Statement:: setAutoCommit (TRUE);</span></p> 
 <p>设置手动提交：</p> 
 <p><span style="font-family:Calibri">Statement::setAutoCommit(FALSE);</span></p> 
 <p><span style="font-family:Calibri">4.  OCCI</span>常用类简要介绍</p> 
 <p><span style="font-family:Calibri">4.1. Environment</span>类</p> 
 <p><span style="font-family:Calibri">Environment</span>类提供了管理<span style="font-family:Calibri">OCCI</span>对象的内存及其它资源的一个环境<span style="font-family:Calibri">,</span>包含以下方法：</p> 
 <p><span style="font-family:Calibri">   createConnection(const stringusename,const string password,const stringconnstring);</span>指与数据库建立一个连接。</p> 
 <p><span style="font-family:Calibri">   createConnectionPoll(</span></p> 
 <p><span style="font-family:Calibri">                                                                                                                         const  string &amp;poolUseName,</span></p> 
 <p><span style="font-family:Calibri">                                                                                                                         const  string &amp;poolPassWord,</span></p> 
 <p><span style="font-family:Calibri">                                                                                                                         const  string &amp;connectstring,</span></p> 
 <p><span style="font-family:Calibri">                                                                                                                         unsigned  int  minConn,</span></p> 
 <p><span style="font-family:Calibri">                                                                                                                         unsigned  int maxConn,</span></p> 
 <p><span style="font-family:Calibri">                                                                                                                         unsigned  int incrConn); </span>创建连接池。</p> 
 <p><span style="font-family:Calibri">                                                                                                                         </span>参数说明：<span style="font-family:Calibri">poolUseName</span>是连接池的用户名；</p> 
 <p><span style="font-family:Calibri">                                    poolPassWord</span>是连接数据库的密码；</p> 
 <p><span style="font-family:Calibri">                                                connectstring</span>是数据库连接串；</p> 
 <p><span style="font-family:Calibri">                                                minConn</span>是最小连接数；</p> 
 <p><span style="font-family:Calibri">                                                maxConn</span>是最大连接数；</p> 
 <p><span style="font-family:Calibri">                   incrConn</span>是指所有已连接数处于繁忙中且小于最大连接数时，每次增加的连接数。</p> 
 <p><span style="font-family:Calibri">   createEnironment(Mode  mode );</span>创建一个环境对象，其中<span style="font-family:Calibri">mode</span>是模式（可选<span style="font-family:Calibri">DEFAULT</span>、<span style="font-family:Calibri">THREADED_MUTEXED</span>、<span style="font-family:Calibri">THREADED_UN-MUTEXED</span>、<span style="font-family:Calibri">OBJECT</span>、<span style="font-family:Calibri">SHARED</span>值）。</p> 
 <p><span style="font-family:Calibri">   getCurrentHeapSize();</span>指在同一环境下已经分配的内存数。</p> 
 <p><span style="font-family:Calibri">   getOCIEnironment();</span>返回一个<span style="font-family:Calibri">OCI</span>环境指针。</p> 
 <p><span style="font-family:Calibri">   terminateConnection(Connection*conn);</span>断开与数据库的连接。</p> 
 <p><span style="font-family:Calibri">   terminateConnection(ConnectionPool*poolconn);</span>断开与数据库的连接池。</p> 
 <p><span style="font-family:Calibri">   terminateEnironment(Einironment *env);</span>终止<span style="font-family:Calibri">OCCI</span>环境变量。</p> 
 <p><span style="font-family:Calibri">4.2. Connection</span>类</p> 
 <p><span style="font-family:Calibri">Connection</span>类提供了<span style="font-family:Calibri">C++</span>程序与指定数据库的连接，包含以下方法：</p> 
 <p><span style="font-family:Calibri">   changePassword(const string&amp;user,const string &amp;oldPassword,conststring &amp;newPassword);</span>改变当前用户的密码。</p> 
 <p><span style="font-family:Calibri">   Commit();</span>提交事务。</p> 
 <p><span style="font-family:Calibri">   createStatement(const string&amp;sql=</span>””<span style="font-family:Calibri">);</span>创建一个<span style="font-family:Calibri">Statement</span>对象。</p> 
 <p><span style="font-family:Calibri">   flushCache();</span></p> 
 <p><span style="font-family:Calibri">   rollback();</span>事务的回滚。</p> 
 <p><span style="font-family:Calibri">   terminateStatement(Statement*stmt).</span>终止一个<span style="font-family:Calibri">Statement</span>对象，并释放它占有的所有资源。</p> 
 <p><span style="font-family:Calibri">4.3. ConnectionPool</span>类</p> 
 <p><span style="font-family:Calibri">ConnectionPoll</span>类提供了<span style="font-family:Calibri">C++</span>程序与指定数据库间的连接池，包含以下方法：</p> 
 <p><span style="font-family:Calibri">   createConnection(const string&amp;username,const string &amp;password);</span>创建一个连接。</p> 
 <p><span style="font-family:Calibri">   getBusyConnections();</span>返回连接池中被占用的连接数量。</p> 
 <p><span style="font-family:Calibri">   getMaxConnections();</span>返回连接池的最大连接数。</p> 
 <p><span style="font-family:Calibri">   getMinConnections();</span>返回连接池的最小连接数。</p> 
 <p><span style="font-family:Calibri">   getOpenConnections();</span>返回连接池中已经被打开的连接数。</p> 
 <p><span style="font-family:Calibri">   getPollName();</span>返回连接池的名称。</p> 
 <p><span style="font-family:Calibri">   getTimeOut();</span>返回连接池的超时时间。</p> 
 <p><span style="font-family:Calibri">   setErrorOnBusy();</span>设置异常，当连接池处于繁忙或达到最大连接数后。</p> 
 <p><span style="font-family:Calibri">   serPoolSize(unsigned intminConn,unsigned int maxConn,unsigned intincrConn);</span>设置连接池的大小，其中参数<span style="font-family:Calibri">minConn</span>是最小连接数，<span style="font-family:Calibri">maxConn</span>是最大连接数，<span style="font-family:Calibri">incrConn</span>是递增连接数。</p> 
 <p><span style="font-family:Calibri">                 setTimeOut();</span>设置超时时间。</p> 
 <p><span style="font-family:Calibri">                 terminateConnection(Connection  *conn);</span>断开连接。</p> 
 <p><span style="font-family:Calibri">4.4. Statement</span>类</p> 
 <p><span style="font-family:Calibri">                   Statement</span>对象主要被用来执行<span style="font-family:Calibri">SQL</span>语句，它可以运行一个查询语句返回一个结果集也可以运行<span style="font-family:Calibri">UPDATE</span>、<span style="font-family:Calibri">DELETE</span>等<span style="font-family:Calibri">SQL</span>语句。</p> 
 <p><span style="font-family:Calibri">   addIteration();</span>增加一个循环。</p> 
 <p><span style="font-family:Calibri">   closeResultSet(ResultSet *rs);</span>关闭一个结果集。</p> 
 <p><span style="font-family:Calibri">   closeStream(Stream  *stream);</span>关闭一个已定义的流。</p> 
 <p><span style="font-family:Calibri">   execute(const string &amp;sql =</span>“”<span style="font-family:Calibri">);</span>执行一个<span style="font-family:Calibri">SQL</span>语句，如果前面使用的<span style="font-family:Calibri">setSQL()</span>方法，则参数<span style="font-family:Calibri">sql</span>可以为空。</p> 
 <p><span style="font-family:Calibri">   executeArrayUpdate(unsigned intarrayLength);</span>同时修改多条记录，前面必须使用了<span style="font-family:Calibri">setDataBuffer()</span>方法设置一个数量或设置了一个流（<span style="font-family:Calibri">stream</span>）。</p> 
 <p><span style="font-family:Calibri">   executeQuery();</span>执行一个查询语句。</p> 
 <p><span style="font-family:Calibri">   executeUpdate();</span>执行<span style="font-family:Calibri">DDL</span>、<span style="font-family:Calibri">DML</span>语句，如：<span style="font-family:Calibri">INSERT</span>、<span style="font-family:Calibri">UPDATE</span>、<span style="font-family:Calibri">DELETE</span>、<span style="font-family:Calibri">CREATE</span>等等。</p> 
 <p><span style="font-family:Calibri">   getAutoCommit();</span>返回是否事务自动提交。</p> 
 <p><span style="font-family:Calibri">   getDate(unsigned int paramindex);</span>返回<span style="font-family:Calibri">DATE</span>型数据。</p> 
 <p><span style="font-family:Calibri">                 getDouble(unsignedintparamindex);</span>返回<span style="font-family:Calibri">DOUBLE</span>型数据。</p> 
 <p><span style="font-family:Calibri">                 getFloat(unsigned intparamindex);</span>返回<span style="font-family:Calibri">FLOAT</span>型数据。</p> 
 <p><span style="font-family:Calibri">                 getInt(unsignedintparamindex);</span>返回<span style="font-family:Calibri">INT</span>型数据。</p> 
 <p><span style="font-family:Calibri">                 getNumber(unsigned intparamindex);</span>返回<span style="font-family:Calibri">NUMBER</span>型数据。</p> 
 <p><span style="font-family:Calibri">                 getRef(unsignedintparamindex);</span>返回<span style="font-family:Calibri">REF</span>参数值。</p> 
 <p><span style="font-family:Calibri">                 getResultSet();</span>得到一个结果集（<span style="font-family:Calibri">ResultSet</span>）。</p> 
 <p><span style="font-family:Calibri">                 getSQL();</span>返回当前的<span style="font-family:Calibri">SQL</span>语句。</p> 
 <p><span style="font-family:Calibri">                 getString(unsignedintparamindex);</span>返回<span style="font-family:Calibri">STRING</span>型数据。</p> 
 <p><span style="font-family:Calibri">                 getUpdateCount();</span>返回被更新的数量。</p> 
 <p><span style="font-family:Calibri">                 isNull(unsignedintparamindex);</span>判断第<span style="font-family:Calibri">X</span>个值是否为空。</p> 
 <p><span style="font-family:Calibri">                 isTruncated(unsignedintparamindex);</span>判断第<span style="font-family:Calibri">X</span>个值是否被截取。</p> 
 <p><span style="font-family:Calibri">                 setAutoCommit(boolautocommit);</span>设置事务是否自动提交。</p> 
 <p><span style="font-family:Calibri">                 setDouble(unsignedintparamindex,double x);</span>赋一个<span style="font-family:Calibri">double</span>型的值。</p> 
 <p><span style="font-family:Calibri">                 setFloat(unsignedintparamindex,float x);</span>赋一个<span style="font-family:Calibri">float</span>型的值。</p> 
 <p><span style="font-family:Calibri">                 setInt(unsignedintparamindex,int x);</span>赋一个<span style="font-family:Calibri">INT</span>型的值。</p> 
 <p><span style="font-family:Calibri">                 setNull(unsigned intparamindex,TYPEtype);</span>某参数设置为空。</p> 
 <p><span style="font-family:Calibri">                 setNumber(unsignedintparamindex,const number &amp;x);</span>赋一个<span style="font-family:Calibri">Number</span>型的值。</p> 
 <p><span style="font-family:Calibri">                 setObject(unsignedintparamindex,PObject *x);</span>赋一个<span style="font-family:Calibri">PObject</span>型的值。</p> 
 <p><span style="font-family:Calibri">                 setString(unsignedintparamindex,const string &amp;x);</span>赋一个<span style="font-family:Calibri">string</span>型的值。</p> 
 <p><span style="font-family:Calibri">                 setSQL(const string &amp;sql);</span>设置一个<span style="font-family:Calibri">SQL</span>语句。</p> 
 <p><span style="font-family:Calibri">                 Status();</span>返回当前的状态。</p> 
 <p><span style="font-family:Calibri">4.5. ResultSet</span>类</p> 
 <p><span style="font-family:Calibri">ResultSet</span>类是查询数据表的结果集，它包含以下方法：</p> 
 <p><span style="font-family:Calibri">   cancel();</span>取消结果集。</p> 
 <p><span style="font-family:Calibri">   closeStream(Stream  *stream);</span>关闭一个流。</p> 
 <p><span style="font-family:Calibri">   getDouble(unsigned intcolIndex);</span>返回<span style="font-family:Calibri">double</span>型的值。</p> 
 <p><span style="font-family:Calibri">   getFloat(unsigned intcolIndex);</span>返回<span style="font-family:Calibri">float</span>型的值。</p> 
 <p><span style="font-family:Calibri">   getInt(unsigned int colIndex);</span>返回<span style="font-family:Calibri">int</span>型的值。</p> 
 <p><span style="font-family:Calibri">   getMaxColumnSize(unsigned intcolIndex);</span>返回某列包含的数据量。</p> 
 <p><span style="font-family:Calibri">   getNumber(unsigned intcolIndex);</span>返回<span style="font-family:Calibri">number</span>型的数据。</p> 
 <p><span style="font-family:Calibri">   getPObject(unsigned intcolIndex);</span>返回<span style="font-family:Calibri">PObject</span>型的数据。</p> 
 <p><span style="font-family:Calibri">   getRowid(unsigned intcolIndex);</span>返回<span style="font-family:Calibri">rowid</span>值。</p> 
 <p><span style="font-family:Calibri">                 getString(unsignedintcolIndex);</span>返回<span style="font-family:Calibri">string</span>型的数据。</p> 
 <p><span style="font-family:Calibri">                 isNull(unsigned int colIndex);</span>判断值是否为空。</p> 
 <p><span style="font-family:Calibri">                 isTruncated(unsignedintcolIndex);</span>判断值是否被删。</p> 
 <p><span style="font-family:Calibri">                 next(unsigned int numRows);</span>取下<span style="font-family:Calibri">numRows</span>条记录。</p> 
 <p><span style="font-family:Calibri">                 status();</span>返回当前状态。</p> 
 <p><span style="font-family:Calibri">4.6. PObject</span>类</p> 
 <p><span style="font-family:Calibri">PObject</span>类包含以下方法：</p> 
 <p><span style="font-family:Calibri">   fush();</span></p> 
 <p><span style="font-family:Calibri">   Connection *getConnection();</span>从一个实例化的永久对象中返回连接。</p> 
 <p><span style="font-family:Calibri">   isLocked();</span>判断永久对象是否被锁（<span style="font-family:Calibri">TRUE</span>或<span style="font-family:Calibri">FALSE</span>）。</p> 
 <p><span style="font-family:Calibri">   isNull();</span>判断永久对象是否为空（<span style="font-family:Calibri">TRUE</span>或<span style="font-family:Calibri">FALSE</span>）。</p> 
 <p><span style="font-family:Calibri">   Lock(PObject::LockOption lock_option);</span>在数据库中锁住一个对象，其中<span style="font-family:Calibri">lock_option</span>取值为<span style="font-family:Calibri">OCCI_LOCK_WAIT</span>、<span style="font-family:Calibri">OCCI_LOCK_NOWAIT</span>。</p> 
 <p><span style="font-family:Calibri">   markDelete();</span>删除数据库中的永久对象。</p> 
 <p><span style="font-family:Calibri">   markModified();</span>修改永久对象。</p> 
 <p><span style="font-family:Calibri">   PObject &amp;operator(constPObject &amp;obj);</span>赋值（对象）。</p> 
 <p><span style="font-family:Calibri">   operator delete(void*obj,size_t size);</span>删除对象，但不能删除数据库中的对象。</p> 
 <p><span style="font-family:Calibri">                 *operator new(size_t size);</span>创建临时对象。</p> 
 <p><span style="font-family:Calibri">                 *operator new(size_tsize,constConnection *x,const string &amp;tablename,const char *type_name);</span>创建永久对象。</p> 
 <p><span style="font-family:Calibri">                 pin();</span></p> 
 <p><span style="font-family:Calibri">                 setNull();</span>设置对象为空。</p> 
 <p><span style="font-family:Calibri">                unmark();</span>不标记永久对象为删除或修改。</p> 
 <p><span style="font-family:Calibri">                 unpin(UnpinOption mode);</span>其中，<span style="font-family:Calibri">mode</span>的取值为<span style="font-family:Calibri">OCCI_PINCOUNT_RESET</span>、<span style="font-family:Calibri">OCCI_PINCOUNT_DECR</span>。</p> 
 <p><span style="font-family:Calibri">4.7. SQLException</span>类</p> 
 <p><span style="font-family:Calibri">SQLException</span>类提供错误代码及其错误信息，包含以下方法：</p> 
 <p><span style="font-family:Calibri">1</span>．<span style="font-family:Calibri"> getErrorCode();</span>返回数据库中的错误编码。</p> 
 <p><span style="font-family:Calibri">2</span>．<span style="font-family:Calibri"> getMessage();</span>返回错误信息，没有则为空。</p> 
 <p><span style="font-family:Calibri">4.8. Date</span>类</p> 
 <p><span style="font-family:Calibri">Date</span>类包含以下方法：</p> 
 <p><span style="font-family:Calibri">   addDays(int i);</span>返回增加<span style="font-family:Calibri">i</span>天后的日期。</p> 
 <p><span style="font-family:Calibri">   addMonths(int i);</span>返回增加<span style="font-family:Calibri">i</span>个月后的日期。</p> 
 <p><span style="font-family:Calibri">   intervalDS daysBetween(constDate &amp;d);</span>返回与<span style="font-family:Calibri">d</span>相差的天数。</p> 
 <p><span style="font-family:Calibri">   getDate(int &amp;year,unsignedint &amp;month,unsigned int&amp;day,unsigned int &amp;hour,unsigned int&amp;minute,unsigned int&amp;second );</span>返回分年月日小时分秒格式。</p> 
 <p><span style="font-family:Calibri">    getSystemDate(const Environment*env);</span>返回系统日期。</p> 
 <p><span style="font-family:Calibri">   isNull();</span>判断是否为空；</p> 
 <p><span style="font-family:Calibri">   lastDay();</span>返回当月的最后一天日期。</p> 
 <p><span style="font-family:Calibri">   setDate(int&amp;year=1,unsigned int &amp;month=1,unsigned int&amp;day=1,unsigned int&amp;hour=0,unsigned int &amp;minute=0,unsigned int&amp;second=0);</span>设置日期值。</p> 
 <p><span style="font-family:Calibri">   setNull();</span>设置为空。</p> 
 <p><span style="font-family:Calibri">4.9. Number</span>类</p> 
 <p><span style="font-family:Calibri">Number</span>类包含以下常用方法：</p> 
 <p><span style="font-family:Calibri">         abs();</span>返回绝对值。</p> 
 <p><span style="font-family:Calibri">         floor();</span>向下取整。</p> 
 <p><span style="font-family:Calibri">         isNull();</span>判断是否为空。</p> 
 <p><span style="font-family:Calibri">         operator+(constNumber&amp;a,const Number &amp;b);</span>两数相加。</p> 
 <p><span style="font-family:Calibri">         operator-(const Number&amp;a,const Number &amp;b);</span>两数相减（<span style="font-family:Calibri">a-b</span>）。</p> 
 <p><span style="font-family:Calibri">         operator*(constNumber&amp;a,const Number &amp;b);</span>两数相乘。</p> 
 <p><span style="font-family:Calibri">         operator/(constNumber&amp;a,const Number &amp;b);</span>两数相除。</p> 
 <p><span style="font-family:Calibri">         operator%(constNumber&amp;a,const Number &amp;b);</span>求余。</p> 
 <p><span style="font-family:Calibri">         operator&lt;(constNumber&amp;a,const Number &amp;b);a</span>是否小于<span style="font-family:Calibri">b</span>。</p> 
 <p><span style="font-family:Calibri">                      operator&lt;=(constNumber&amp;a,const Number &amp;b);a</span>是否小于等于<span style="font-family:Calibri">b</span>。</p> 
 <p><span style="font-family:Calibri">                      operator&gt;(constNumber&amp;a,const Number &amp;b);a</span>是否大于<span style="font-family:Calibri">b</span>。</p> 
 <p><span style="font-family:Calibri">                      operator&gt;=(constNumber&amp;a,const Number &amp;b);a</span>是否大于等于<span style="font-family:Calibri">b</span>。</p> 
 <p><span style="font-family:Calibri">                      operator==(constNumber&amp;a,const Number &amp;b);a</span>与<span style="font-family:Calibri">b</span>是否相等。</p> 
 <p><span style="font-family:Calibri">                      operator!=(constNumber&amp;a,const Number &amp;b);</span>判断<span style="font-family:Calibri">a</span>是否不等于<span style="font-family:Calibri">b</span>。</p> 
 <p><span style="font-family:Calibri">                      operator char();</span>将<span style="font-family:Calibri">number</span>型转化为<span style="font-family:Calibri">char</span>型。</p> 
 <p><span style="font-family:Calibri">                      operator signed char();</span>将<span style="font-family:Calibri">number</span>型转化为有符号<span style="font-family:Calibri">char</span>型。</p> 
 <p><span style="font-family:Calibri">                      operator double();</span>将<span style="font-family:Calibri">number</span>型转化为<span style="font-family:Calibri">double</span>型。</p> 
 <p><span style="font-family:Calibri">                      operator float();</span>将<span style="font-family:Calibri">number</span>型转化为<span style="font-family:Calibri">float</span>型。</p> 
 <p><span style="font-family:Calibri">                      operator int();</span>将<span style="font-family:Calibri">number</span>型转化为<span style="font-family:Calibri">int</span>型。</p> 
 <p><span style="font-family:Calibri">                      operator long();</span>将<span style="font-family:Calibri">number</span>型转化为<span style="font-family:Calibri">long</span>型。</p> 
 <p><span style="font-family:Calibri">                      operator short();</span>将<span style="font-family:Calibri">number</span>型转化为<span style="font-family:Calibri">short int</span>型。</p> 
 <p><span style="font-family:Calibri">                      setNull();</span>设置为空。</p> 
 <p><span style="font-family:Calibri">                      trunk();</span>取整。</p> 
 <p><span style="font-family:Calibri">5.   </span>附录：代码示例</p> 
 <p><span style="font-family:Calibri">5.1. </span>查询流程处理示例</p> 
 <p>下面给出了一个查询的例子<span style="font-family:Calibri">qrystudent.cpp</span>，通过使用<span style="font-family:Calibri">OCCI</span>接口函数查询数据库表<span style="font-family:Calibri">student</span>的信息（学号，学生姓名）。</p> 
 <p><span style="font-family:Calibri">#include &lt;iostream&gt;</span></p> 
 <p><span style="font-family:Calibri">#include &lt;occi.h&gt;</span></p> 
 <p><span style="font-family:Calibri">using namespace oracle::occi;</span></p> 
 <p><span style="font-family:Calibri">using namespace std;</span></p> 
 <p><span style="font-family:Calibri">int main ()</span></p> 
 <p><span style="font-family:Calibri">{<!-- --></span></p> 
 <p><span style="font-family:Calibri">Environment *env;</span></p> 
 <p><span style="font-family:Calibri">Connection *conn;</span></p> 
 <p><span style="font-family:Calibri">Statement *stmt;</span></p> 
 <p><span style="font-family:Calibri">ResultSet *rs;</span></p> 
 <p><span style="font-family:Calibri">string username = “ipd”;</span></p> 
 <p><span style="font-family:Calibri">string password = “ipd”;</span></p> 
 <p><span style="font-family:Calibri">string connstring = “ora9i”;</span></p> 
 <p><span style="font-family:Calibri">string sql,strname;</span></p> 
 <p><span style="font-family:Calibri">int isno;</span></p> 
 <p><span style="font-family:Calibri">env = Environment::createEnvironment(); //</span>创建一个环境变量</p> 
 <p><span style="font-family:Calibri">conn =env-&gt;createConnection(username,password,connstring);//</span>创建一个数据库连接对象</p> 
 <p><span style="font-family:Calibri">stmt = conn-&gt;createStatement(); //</span>创建一个<span style="font-family:Calibri">Statement</span>对象</p> 
 <p><span style="font-family:Calibri">sql = </span>“<span style="font-family:Calibri"> SELECT sno,snameFROM student </span>“<span style="font-family:Calibri">;  //</span>拼接一个<span style="font-family:Calibri">SQL</span>语句</p> 
 <p><span style="font-family:Calibri">stmt-&gt;setSQL(sql); //</span>设置<span style="font-family:Calibri">SQL</span>语句到<span style="font-family:Calibri">Statement</span>对象中</p> 
 <p><span style="font-family:Calibri">try {<!-- --></span></p> 
 <p><span style="font-family:Calibri">      rs=  stmt-&gt;executeQuery();//</span>执行<span style="font-family:Calibri">SQL</span>语句</p> 
 <p><span style="font-family:Calibri">      while(rs-&gt;next()) { //</span>用循环，一条一条地取得查询的结果记录</p> 
 <p><span style="font-family:Calibri">              isno= rs-&gt;getInt(1);//</span>取出第一列的值（对应为<span style="font-family:Calibri">int</span>型）</p> 
 <p><span style="font-family:Calibri">              strname=rs-&gt;getString(2);//</span>取出第二列的值（对应为<span style="font-family:Calibri">string</span>型）</p> 
 <p><span style="font-family:Calibri">              cout&lt;&lt; isno &lt;&lt; “  AND  “&lt;&lt; strname &lt;&lt; endl;</span></p> 
 <p><span style="font-family:Calibri">      }</span></p> 
 <p><span style="font-family:Calibri">      cout&lt;&lt; “SELECT―― SUCCESS”&lt;&lt; endl;</span></p> 
 <p><span style="font-family:Calibri">} catch (SQLException ex) {<!-- --></span></p> 
 <p><span style="font-family:Calibri">      cout&lt;&lt; </span>“<span style="font-family:Calibri"> Error Number : </span>“<span style="font-family:Calibri">&lt;&lt; ex.getErrorCode() &lt;&lt; endl; //</span>取出异常代码</p> 
 <p><span style="font-family:Calibri">      cout&lt;&lt; ex.getMessage() &lt;&lt; endl; //</span>取出异常信息</p> 
 <p><span style="font-family:Calibri">}</span></p> 
 <p><span style="font-family:Calibri"> </span></p> 
 <p><span style="font-family:Calibri">conn-&gt;terminateStatement(stmt); //</span>终止<span style="font-family:Calibri">Statement</span>对象</p> 
 <p><span style="font-family:Calibri">env-&gt;terminateConnection(conn); //</span>断开数据库连接</p> 
 <p><span style="font-family:Calibri">Environment::terminateEnvironment(env); //</span>终止环境变量</p> 
 <p><span style="font-family:Calibri">return 1;</span></p> 
 <p><span style="font-family:Calibri">}</span></p> 
 <p><span style="font-family:Calibri">5.2. </span>非查询流程处理示例</p> 
 <p>下面给出了一个<span style="font-family:Calibri">insert</span>例子<span style="font-family:Calibri">inserttab.cpp</span>，通过使用<span style="font-family:Calibri">OCCI</span>接口函数往数据库表<span style="font-family:Calibri">student</span>中插入信息（学号，学生姓名）。</p> 
 <p><span style="font-family:Calibri">#include &lt;iostream&gt;</span></p> 
 <p><span style="font-family:Calibri">#include &lt;occi.h&gt;</span></p> 
 <p><span style="font-family:Calibri">using namespace oracle::occi;</span></p> 
 <p><span style="font-family:Calibri">using namespace std;</span></p> 
 <p><span style="font-family:Calibri">int main ()</span></p> 
 <p><span style="font-family:Calibri">{<!-- --></span></p> 
 <p><span style="font-family:Calibri">Environment *env;</span></p> 
 <p><span style="font-family:Calibri">Connection *conn;</span></p> 
 <p><span style="font-family:Calibri">Statement *stmt;</span></p> 
 <p><span style="font-family:Calibri">string username = “ipd”;</span></p> 
 <p><span style="font-family:Calibri">string password = “ipd”;</span></p> 
 <p><span style="font-family:Calibri">string connstring = “ora9i”;</span></p> 
 <p><span style="font-family:Calibri">string sql;</span></p> 
 <p><span style="font-family:Calibri">env = Environment::createEnvironment(); //</span>创建一个环境变量</p> 
 <p><span style="font-family:Calibri">conn=env-&gt;createConnection(username,password,connstring); //</span>创建一个数据库连接对象</p> 
 <p><span style="font-family:Calibri">stmt = conn-&gt;createStatement(); //</span>创建一个<span style="font-family:Calibri">Statement</span>对象</p> 
 <p><span style="font-family:Calibri">sql = </span>“<span style="font-family:Calibri"> INSERT INTOstudent(sno,sname)  VALUES ( :x,:y) </span>“<span style="font-family:Calibri">; //</span>拼接<span style="font-family:Calibri">SQL</span>语句</p> 
 <p><span style="font-family:Calibri">stmt-&gt;setSQL(sql); //</span>设置<span style="font-family:Calibri">SQL</span>语句到<span style="font-family:Calibri">Statement</span>对象中</p> 
 <p><span style="font-family:Calibri">try {<!-- --></span></p> 
 <p><span style="font-family:Calibri">      stmt-&gt;setInt(1,10001);//</span>给第一个参数<span style="font-family:Calibri">x</span>赋值</p> 
 <p><span style="font-family:Calibri">      stmt-&gt;setString(2,</span>”<span style="font-family:Calibri">zhangsan</span>”<span style="font-family:Calibri">);//</span>给第二个参数<span style="font-family:Calibri">y</span>赋值</p> 
 <p><span style="font-family:Calibri">      stmt-&gt;executeUpdate();//</span>执行<span style="font-family:Calibri">SQL</span>语句</p> 
 <p><span style="font-family:Calibri">      cout&lt;&lt; “INSERT―― SUCCESS”&lt;&lt; endl;</span></p> 
 <p><span style="font-family:Calibri">} catch (SQLException ex) {<!-- --></span></p> 
 <p><span style="font-family:Calibri">      cout&lt;&lt; </span>“<span style="font-family:Calibri"> Error Number : </span>“<span style="font-family:Calibri">&lt;&lt; ex.getErrorCode() &lt;&lt; endl; //</span>获得异常代码</p> 
 <p><span style="font-family:Calibri">      cout&lt;&lt; ex.getMessage() &lt;&lt; endl; //</span>获得异常信息</p> 
 <p><span style="font-family:Calibri">}</span></p> 
 <p><span style="font-family:Calibri">conn-&gt;terminateStatement(stmt); //</span>终止<span style="font-family:Calibri">Statement</span>对象</p> 
 <p><span style="font-family:Calibri">env-&gt;terminateConnection(conn); //</span>断开数据库连接</p> 
 <p><span style="font-family:Calibri">Environment::terminateEnvironment(env); //</span>终止环境变量</p> 
 <p><span style="font-family:Calibri">return 1;</span></p> 
 <p><span style="font-family:Calibri">}</span></p> 
 <p><span style="font-family:Calibri">5.3. </span>批量处理非查询语句</p> 
 <p>在批量处理非查询语句时，首先必须使用<span style="font-family:Calibri">m_stmt-&gt;setMaxIterations(unsigned int maxnum)</span>方法设置最大的批处理数；然后使用<span style="font-family:Calibri">setMaxParamSize(unsignedint paramindex,int paramsize)</span>方法设置对应参数的大小，对于有固定长度的参数可以不必重新设置，如<span style="font-family:Calibri">int,double</span>；最后循环绑定参数使用<span style="font-family:Calibri">set</span>×××<span style="font-family:Calibri">()</span>方法，每循环一次必须使用<span style="font-family:Calibri">addIteration()</span>方法再进行下一次循环，直到最后一次。例子如下所示：</p> 
 <p><span style="font-family:Calibri">#include &lt;iostream&gt;</span></p> 
 <p><span style="font-family:Calibri">#include &lt;occi.h&gt;</span></p> 
 <p><span style="font-family:Calibri">using namespace oracle::occi;</span></p> 
 <p><span style="font-family:Calibri">using namespace std;</span></p> 
 <p><span style="font-family:Calibri">int main ()</span></p> 
 <p><span style="font-family:Calibri">{<!-- --></span></p> 
 <p><span style="font-family:Calibri">  Environment *env;</span></p> 
 <p><span style="font-family:Calibri">  Connection *conn;</span></p> 
 <p><span style="font-family:Calibri">  Statement *stmt;  </span></p> 
 <p><span style="font-family:Calibri">  string username = "bill";</span></p> 
 <p><span style="font-family:Calibri">  string password = "bill";</span></p> 
 <p><span style="font-family:Calibri">  string connstring = "jftest";</span></p> 
 <p><span style="font-family:Calibri">  string sql;</span></p> 
 <p><span style="font-family:Calibri">  intisno[2]={21,22},i,iage[2]={18,19};</span></p> 
 <p><span style="font-family:Calibri">  stringcsname[2]={"namea","nameb"};</span></p> 
 <p><span style="font-family:Calibri">  try {<!-- --></span></p> 
 <p><span style="font-family:Calibri">      env = Environment::createEnvironment();</span></p> 
 <p><span style="font-family:Calibri">      conn = env-&gt;createConnection(username,password,connstring);</span></p> 
 <p><span style="font-family:Calibri">      stmt = conn-&gt;createStatement();</span></p> 
 <p><span style="font-family:Calibri">      stmt-&gt;setAutoCommit(false);      </span></p> 
 <p><span style="font-family:Calibri">      sql = " INSERT INTO student (sno,sname,age)  VALUES (:x,:y,:z) ";     </span></p> 
 <p><span style="font-family:Calibri">      m_stmt-&gt;setSQL(sql);</span></p> 
 <p><span style="font-family:Calibri">      m_stmt-&gt;setMaxIterations(2);</span></p> 
 <p><span style="font-family:Calibri">      m_stmt-&gt;setMaxParamSize(1,sizeof(int));</span></p> 
 <p><span style="font-family:Calibri">      m_stmt-&gt;setMaxParamSize(2,sizeof(string));</span></p> 
 <p><span style="font-family:Calibri">      m_stmt-&gt;setMaxParamSize(3,sizeof(int));</span></p> 
 <p><span style="font-family:Calibri">      cout&lt;&lt;"setMaxIterations success !"&lt;&lt;endl;</span></p> 
 <p><span style="font-family:Calibri">      //cout&lt;&lt;"getMaxIterations ="&lt;&lt;m_stmt-&gt;getMaxIterations()&lt;&lt;endl;</span></p> 
 <p><span style="font-family:Calibri">      for (i=0;i&lt;2;i++)</span></p> 
 <p><span style="font-family:Calibri">      {<!-- --></span></p> 
 <p><span style="font-family:Calibri">          m_stmt-&gt;setInt(1,isno[i]);</span></p> 
 <p><span style="font-family:Calibri">          m_stmt-&gt;setString(2,csname[i]);</span></p> 
 <p><span style="font-family:Calibri">          m_stmt-&gt;setInt(3,iage[i]);     </span></p> 
 <p><span style="font-family:Calibri">           //cout &lt;&lt;isno[i]&lt;&lt; " and "&lt;&lt;csname[i]&lt;&lt; " and " &lt;&lt; iage[i] &lt;&lt;endl;</span></p> 
 <p><span style="font-family:Calibri">          if (i!=1) m_stmt-&gt;addIteration();</span></p> 
 <p><span style="font-family:Calibri">      }</span></p> 
 <p><span style="font-family:Calibri">      cout&lt;&lt;"getMaxIterations="&lt;&lt;m_stmt-&gt;getMaxIterations()&lt;&lt;endl;</span></p> 
 <p><span style="font-family:Calibri">          cout&lt;&lt;"setsuccess"&lt;&lt;endl;</span></p> 
 <p><span style="font-family:Calibri">          inum = m_stmt-&gt;executeUpdate();</span></p> 
 <p><span style="font-family:Calibri">          m_conn-&gt;commit();</span></p> 
 <p><span style="font-family:Calibri">          cout &lt;&lt; "INSERT ¨D¨DSUCCESS" &lt;&lt; endl;</span></p> 
 <p><span style="font-family:Calibri">   }catch (SQLException ex) {<!-- --></span></p> 
 <p><span style="font-family:Calibri">          inum = m_stmt-&gt;getUpdateCount();</span></p> 
 <p><span style="font-family:Calibri">          cout &lt;&lt; "ON" &lt;&lt;inum+1 &lt;&lt; " shi fail!" &lt;&lt; endl;</span></p> 
 <p><span style="font-family:Calibri">          cout &lt;&lt; " INSERT Error Number: "&lt;&lt;ex.getErrorCode() &lt;&lt; endl;</span></p> 
 <p><span style="font-family:Calibri">          cout &lt;&lt; ex.getMessage() &lt;&lt;endl;</span></p> 
 <p><span style="font-family:Calibri">          m_conn-&gt;rollback();</span></p> 
 <p><span style="font-family:Calibri">          return 0;</span></p> 
 <p><span style="font-family:Calibri">    }</span></p> 
 <p><span style="font-family:Calibri">  conn-&gt;terminateStatement(stmt);</span></p> 
 <p><span style="font-family:Calibri">  env-&gt;terminateConnection(conn);</span></p> 
 <p><span style="font-family:Calibri">  Environment::terminateEnvironment(env);</span></p> 
 <p><span style="font-family:Calibri">  cout &lt;&lt; "PROGRAM IS END ." &lt;&lt; endl;</span></p> 
 <p><span style="font-family:Calibri">  return 1;</span></p> 
 <p><span style="font-family:Calibri">}</span></p> 
 <p><span style="font-family:Calibri">5.4. </span>查询语句中批量取数</p> 
 <p>在批量取数时，使用<span style="font-family:Calibri">setDataBuffer</span>（）方法来设置接收数据缓冲区大小，例子如下所示：</p> 
 <p><span style="font-family:Calibri">#include &lt;iostream&gt;</span></p> 
 <p><span style="font-family:Calibri">#include &lt;occi.h&gt;</span></p> 
 <p><span style="font-family:Calibri">using namespace oracle::occi;</span></p> 
 <p><span style="font-family:Calibri">using namespace std;</span></p> 
 <p><span style="font-family:Calibri">int main ()</span></p> 
 <p><span style="font-family:Calibri">{<!-- --></span></p> 
 <p><span style="font-family:Calibri">  Environment *env;</span></p> 
 <p><span style="font-family:Calibri">  Connection *conn;</span></p> 
 <p><span style="font-family:Calibri">  Statement *stmt;</span></p> 
 <p><span style="font-family:Calibri">  ResultSet *rs;</span></p> 
 <p><span style="font-family:Calibri">  string username = "bill";</span></p> 
 <p><span style="font-family:Calibri">  string password = "bill";</span></p> 
 <p><span style="font-family:Calibri">  string connstring = "jftest";</span></p> 
 <p><span style="font-family:Calibri">  string sql;</span></p> 
 <p><span style="font-family:Calibri">  int i,numrows=5,isnum,ilnum,ipos=0;</span></p> 
 <p><span style="font-family:Calibri">  int isno[5],vsno[20],ii=0,x[20];</span></p> 
 <p><span style="font-family:Calibri">  ub2 isnolen[5],snamelen[5];</span></p> 
 <p><span style="font-family:Calibri">  char sname[5][20],vsname[20][20];</span></p> 
 <p><span style="font-family:Calibri">   for (i=0;i&lt;20;i++)</span></p> 
 <p><span style="font-family:Calibri">    {<!-- --></span></p> 
 <p><span style="font-family:Calibri">      isnolen[i]=sizeof(isno[i]);</span></p> 
 <p><span style="font-family:Calibri">                             snamelen[i]=strlen(sname[i]+1);</span></p> 
 <p><span style="font-family:Calibri">    }</span></p> 
 <p><span style="font-family:Calibri">  cout &lt;&lt; "PROGRAM START ..." &lt;&lt; endl;</span></p> 
 <p><span style="font-family:Calibri">  try {<!-- --></span></p> 
 <p><span style="font-family:Calibri">      env = Environment::createEnvironment();</span></p> 
 <p><span style="font-family:Calibri">      conn = env-&gt;createConnection(username,password,connstring);</span></p> 
 <p><span style="font-family:Calibri">      stmt = conn-&gt;createStatement();</span></p> 
 <p><span style="font-family:Calibri">      sql = " SELECT sno,sname FROM student ";</span></p> 
 <p><span style="font-family:Calibri">      stmt-&gt;setSQL(sql);</span></p> 
 <p><span style="font-family:Calibri">          rs = stmt-&gt;executeQuery();</span></p> 
 <p><span style="font-family:Calibri">          rs-&gt;setDataBuffer(1,isno,OCCIINT,sizeof(int));</span></p> 
 <p><span style="font-family:Calibri">          rs-&gt;setDataBuffer(2,sname,OCCI_SQLT_STR,sizeof(sname[0]),snamelen);</span></p> 
 <p><span style="font-family:Calibri">          ilnum = rs-&gt;getNumArrayRows();</span></p> 
 <p><span style="font-family:Calibri">          cout &lt;&lt; " ilnum = "&lt;&lt; ilnum &lt;&lt;endl;</span></p> 
 <p><span style="font-family:Calibri">          while (rs-&gt;next(numrows)) {<!-- --></span></p> 
 <p><span style="font-family:Calibri">                  isnum =rs-&gt;getNumArrayRows();</span></p> 
 <p><span style="font-family:Calibri">               cout &lt;&lt; " isnum ="&lt;&lt; isnum &lt;&lt;endl;</span></p> 
 <p><span style="font-family:Calibri">                 for(i=0;i&lt;numrows;i++)</span></p> 
 <p><span style="font-family:Calibri">              {<!-- --></span></p> 
 <p><span style="font-family:Calibri">                  vsno[ipos] = isno[i];</span></p> 
 <p><span style="font-family:Calibri">                  vsname[ipos] = sname[i];</span></p> 
 <p><span style="font-family:Calibri">                  ipos = ipos+1;</span></p> 
 <p><span style="font-family:Calibri">              }</span></p> 
 <p><span style="font-family:Calibri">          }</span></p> 
 <p><span style="font-family:Calibri">      ilnum = rs-&gt;getNumArrayRows();</span></p> 
 <p><span style="font-family:Calibri">          cout &lt;&lt; " ilnum = "&lt;&lt; ilnum &lt;&lt;endl;</span></p> 
 <p><span style="font-family:Calibri">          for(i=0;i&lt;ilnum-isnum;i++)</span></p> 
 <p><span style="font-family:Calibri">      {<!-- --></span></p> 
 <p><span style="font-family:Calibri">          vsno[ipos] = isno[i];</span></p> 
 <p><span style="font-family:Calibri">          vsname[ipos] = sname[i];</span></p> 
 <p><span style="font-family:Calibri">          ipos = ipos+1;</span></p> 
 <p><span style="font-family:Calibri">      }</span></p> 
 <p><span style="font-family:Calibri">      cout &lt;&lt; "SELECT RESULT IS ..." &lt;&lt; endl;</span></p> 
 <p><span style="font-family:Calibri">      for(i=0;i&lt;ilnum;i++)</span></p> 
 <p><span style="font-family:Calibri">      {<!-- --></span></p> 
 <p><span style="font-family:Calibri">          cout&lt;&lt;vsno[i]&lt;&lt;"AND"&lt;&lt;vsname[i]&lt;&lt;endl;</span></p> 
 <p><span style="font-family:Calibri">      }</span></p> 
 <p><span style="font-family:Calibri">      cout &lt;&lt; "SELECT RESULT END !" &lt;&lt; endl;</span></p> 
 <p><span style="font-family:Calibri">          cout &lt;&lt; "SELECT ¨D¨DSUCCESS" &lt;&lt; endl;</span></p> 
 <p><span style="font-family:Calibri">   }catch (SQLException ex) {<!-- --></span></p> 
 <p><span style="font-family:Calibri">          cout &lt;&lt; " Error Number :"&lt;&lt; ex.getErrorCode()&lt;&lt; endl;</span></p> 
 <p><span style="font-family:Calibri">          cout &lt;&lt; ex.getMessage() &lt;&lt;endl;</span></p> 
 <p><span style="font-family:Calibri">    }</span></p> 
 <p><span style="font-family:Calibri">  conn-&gt;terminateStatement(stmt);</span></p> 
 <p><span style="font-family:Calibri">  env-&gt;terminateConnection(conn);</span></p> 
 <p><span style="font-family:Calibri">  Environment::terminateEnvironment(env);</span></p> 
 <p><span style="font-family:Calibri">  cout &lt;&lt; "PROGRAM END !" &lt;&lt; endl;</span></p> 
 <p><span style="font-family:Calibri">  return 1;</span></p> 
 <p><span style="font-family:Calibri">}</span></p> 
 <p><span style="font-family:Calibri">5.5. MERGE</span>语句的使用</p> 
 <p>在使用<span style="font-family:Calibri">MEGER</span>语句时，<span style="font-family:Calibri">USING</span>部分的取值应该使用表或者<span style="font-family:Calibri">SELECT param1,param2FROM DUAL,</span>其中<span style="font-family:Calibri">param1,param2</span>是常量值，可以通过数组赋值，并且每列值都应该取别名，在后面的使用中就只用别名。例子如下所示：</p> 
 <p><span style="font-family:Calibri">#include &lt;iostream&gt;</span></p> 
 <p><span style="font-family:Calibri">#include &lt;occi.h&gt;</span></p> 
 <p><span style="font-family:Calibri">using namespace oracle::occi;</span></p> 
 <p><span style="font-family:Calibri">using namespace std;</span></p> 
 <p><span style="font-family:Calibri">int main ()</span></p> 
 <p><span style="font-family:Calibri">{<!-- --></span></p> 
 <p><span style="font-family:Calibri">  Environment *env;</span></p> 
 <p><span style="font-family:Calibri">  Connection *conn;</span></p> 
 <p><span style="font-family:Calibri">  Statement *stmt;</span></p> 
 <p><span style="font-family:Calibri">  string username = "bill";</span></p> 
 <p><span style="font-family:Calibri">  string password = "bill";</span></p> 
 <p><span style="font-family:Calibri">  string connstring = "jftest";</span></p> 
 <p><span style="font-family:Calibri">  string sql;</span></p> 
 <p><span style="font-family:Calibri">  int isno[2]={21,22},i,iage[2]={18,19};</span></p> 
 <p><span style="font-family:Calibri">  try {<!-- --></span></p> 
 <p><span style="font-family:Calibri">      env = Environment::createEnvironment();</span></p> 
 <p><span style="font-family:Calibri">      conn = env-&gt;createConnection(username,password,connstring);</span></p> 
 <p><span style="font-family:Calibri">      stmt = conn-&gt;createStatement();</span></p> 
 <p><span style="font-family:Calibri">      stmt-&gt;setAutoCommit(false);</span></p> 
 <p><span style="font-family:Calibri">      sql = " merge into student a ";</span></p> 
 <p><span style="font-family:Calibri">      sql += "    using (select:xbid,:y bage from dual) b ";</span></p> 
 <p><span style="font-family:Calibri">      sql += "    on (a.sno =b.bid)";</span></p> 
 <p><span style="font-family:Calibri">      sql += "    when matchedthen";</span></p> 
 <p><span style="font-family:Calibri">      sql += "    update seta.age=a.age+b.bage ";</span></p> 
 <p><span style="font-family:Calibri">      sql += "    when notmatchedthen ";</span></p> 
 <p><span style="font-family:Calibri">      sql += "   insert(a.sno,a.age) ";</span></p> 
 <p><span style="font-family:Calibri">      sql += "   values(b.bid,b.bage) ";</span></p> 
 <p><span style="font-family:Calibri">      stmt-&gt;setSQL(sql);</span></p> 
 <p><span style="font-family:Calibri">      stmt-&gt;setMaxIterations(2);</span></p> 
 <p><span style="font-family:Calibri">      stmt-&gt;setMaxParamSize(1,sizeof(int));</span></p> 
 <p><span style="font-family:Calibri">      //stmt-&gt;setMaxParamSize(2,sizeof(string));</span></p> 
 <p><span style="font-family:Calibri">      cout&lt;&lt;"setMaxIterations success !"&lt;&lt;endl;</span></p> 
 <p><span style="font-family:Calibri">      //cout&lt;&lt;"getMaxIterations ="&lt;&lt;stmt-&gt;getMaxIterations()&lt;&lt;endl;</span></p> 
 <p><span style="font-family:Calibri">      for (i=0;i&lt;2;i++)</span></p> 
 <p><span style="font-family:Calibri">      {<!-- --></span></p> 
 <p><span style="font-family:Calibri">          stmt-&gt;setInt(1,isno[i]);</span></p> 
 <p><span style="font-family:Calibri">          stmt-&gt;setInt(2,iage[i]);</span></p> 
 <p><span style="font-family:Calibri">          if (i!=1) stmt-&gt;addIteration();</span></p> 
 <p><span style="font-family:Calibri">      }</span></p> 
 <p><span style="font-family:Calibri">      cout&lt;&lt;"getMaxParamSize ="&lt;&lt;stmt-&gt;getMaxParamSize(2)&lt;&lt;endl; </span></p> 
 <p><span style="font-family:Calibri">      cout&lt;&lt;"getMaxIterations="&lt;&lt;stmt-&gt;getMaxIterations()&lt;&lt;endl;</span></p> 
 <p><span style="font-family:Calibri">          cout&lt;&lt;"setsuccess"&lt;&lt;endl;</span></p> 
 <p><span style="font-family:Calibri">          stmt-&gt;executeUpdate(); //?</span>′<span style="font-family:Calibri">DDSQL</span>ó<span style="font-family:Calibri">???</span></p> 
 <p><span style="font-family:Calibri">          conn-&gt;commit();</span></p> 
 <p><span style="font-family:Calibri">          cout &lt;&lt; "INSERT ¨D¨DSUCCESS" &lt;&lt; endl;</span></p> 
 <p><span style="font-family:Calibri">   }catch (SQLException ex) {<!-- --></span></p> 
 <p><span style="font-family:Calibri">          cout &lt;&lt; " Error Number :"&lt;&lt; ex.getErrorCode()&lt;&lt; endl;</span></p> 
 <p><span style="font-family:Calibri">          cout &lt;&lt; ex.getMessage() &lt;&lt;endl;</span></p> 
 <p><span style="font-family:Calibri">          conn-&gt;rollback();</span></p> 
 <p><span style="font-family:Calibri">    }</span></p> 
 <p><span style="font-family:Calibri">  conn-&gt;terminateStatement(stmt);</span></p> 
 <p><span style="font-family:Calibri">  env-&gt;terminateConnection(conn);</span></p> 
 <p><span style="font-family:Calibri">  Environment::terminateEnvironment(env)</span></p> 
 <p><span style="font-family:Calibri">  cout &lt;&lt; "PROGRAM IS END ." &lt;&lt; endl;</span></p> 
 <p><span style="font-family:Calibri">  return 1;</span></p> 
 <p><span style="font-family:Calibri">}</span></p> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bac7931c67cb1e93a2082ef177bf3026/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">几款移动跨平台App开发框架比较</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b7fb9055c81b90028d500661ece58929/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">maven pom.xml packaging报错</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>