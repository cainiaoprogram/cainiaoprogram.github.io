<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【机器学习】图像语义分割常用指标Dice系数 敏感性 特异性 IOU及python代码实现 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【机器学习】图像语义分割常用指标Dice系数 敏感性 特异性 IOU及python代码实现" />
<meta property="og:description" content="文章目录 知识铺垫1. Dice系数和IOUIOUDice系数Dice和IOU的关系分析代码 2.敏感性（=Recall）、特异性和精确度（=precision=PPV)2.1 敏感性（召回率）和特异性2.2 敏感性和特异性之间的关系2.3 Recall和Precision之间的关系 3. F1 知识铺垫 二分类和多分类的评价指标的选择
首先，对于像素点，我们要知道，当预测的像素点类别和其真实类别不同或者相同时，我们可以用混淆矩阵来表示，如下图：
1. Dice系数和IOU 首先，dice和IOU都是衡量两个集合之间相似性的度量，在图像分割领域用来衡量网络分割结果与金标准mask（标签）之间的相似性。
(分割网络评价指标)dice系数和IOU之间的区别和联系
IOU IOU指标可以使用几何办法给出直观的解释，我们假设红色代表图片中的标签，黄色是分割的结果，那么他们重叠的蓝色部分就是TP（true Positive)真正例，也就是正样本被正确分类。
那么对应的红色就是预测为负但实际为正，因此是FN。
下面黄色部分，就是预测为正，但实际为负，因此是FP（false Positive)。
结合上述图片，我们可以给出IOU的公式（结合几何意义）
I O U = T P F N &#43; T P &#43; F P IOU = \frac{TP}{FN&#43;TP&#43;FP} IOU=FN&#43;TP&#43;FPTP​
I O U = 预测正确：蓝色 ( 红色 &#43; 蓝色 &#43; 黄色 ) IOU=\frac{预测正确：蓝色}{(红色&#43;蓝色&#43;黄色)} IOU=(红色&#43;蓝色&#43;黄色)预测正确：蓝色​
这位是对于一个类别来说的IOU公式，而mIOU公式是对所有类别求交并比的平均值。
m I O U = 1 k ∑ i = 1 k T P F N &#43; T P &#43; F P mIOU = \frac{1}{k}\sum_{i=1}^{k}\frac{TP}{FN&#43;TP&#43;FP} mIOU=k1​i=1∑k​FN&#43;TP&#43;FPTP​" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/eeab80ecb0ccc5572b4ef8e99f43d59f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-01T14:26:30+08:00" />
<meta property="article:modified_time" content="2023-05-01T14:26:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【机器学习】图像语义分割常用指标Dice系数 敏感性 特异性 IOU及python代码实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">知识铺垫</a></li><li><a href="#1_DiceIOU_6" rel="nofollow">1. Dice系数和IOU</a></li><li><ul><li><a href="#IOU_10" rel="nofollow">IOU</a></li><li><a href="#Dice_23" rel="nofollow">Dice系数</a></li><li><a href="#DiceIOU_34" rel="nofollow">Dice和IOU的关系分析</a></li><li><a href="#_49" rel="nofollow">代码</a></li></ul> 
  </li><li><a href="#2RecallprecisionPPV_131" rel="nofollow">2.敏感性（=Recall）、特异性和精确度（=precision=PPV)</a></li><li><ul><li><a href="#21__132" rel="nofollow">2.1 敏感性（召回率）和特异性</a></li><li><a href="#22__174" rel="nofollow">2.2 敏感性和特异性之间的关系</a></li><li><a href="#23_RecallPrecision_176" rel="nofollow">2.3 Recall和Precision之间的关系</a></li></ul> 
  </li><li><a href="#3_F1_199" rel="nofollow">3. F1</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>知识铺垫</h2> 
<p><a href="https://blog.csdn.net/wf592523813/article/details/95202448?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_baidulandingword~default-4.queryctrv4&amp;spm=1001.2101.3001.4242.3&amp;utm_relevant_index=7">二分类和多分类的评价指标的选择</a><br> 首先，对于像素点，我们要知道，当预测的像素点类别和其真实类别不同或者相同时，我们可以用混淆矩阵来表示，如下图：<br> <img src="https://images2.imgbox.com/6a/96/VnuxHK20_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="1_DiceIOU_6"></a>1. Dice系数和IOU</h2> 
<p>首先，dice和IOU都是衡量两个集合之间相似性的度量，在图像分割领域用来衡量网络分割结果与金标准mask（标签）之间的相似性。<br> <a href="https://blog.csdn.net/baidu_33312138/article/details/104942925?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168256269916800217275174%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=168256269916800217275174&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-1-104942925-null-null.142%5Ev86%5Econtrol,239%5Ev2%5Einsert_chatgpt&amp;utm_term=Dice%E7%B3%BB%E6%95%B0%E5%92%8CIOU&amp;spm=1018.2226.3001.4187">(分割网络评价指标)dice系数和IOU之间的区别和联系</a></p> 
<h3><a id="IOU_10"></a>IOU</h3> 
<p>IOU指标可以使用几何办法给出直观的解释，我们假设红色代表图片中的标签，黄色是分割的结果，那么他们重叠的蓝色部分就是TP（true Positive)真正例，也就是正样本被正确分类。<br> 那么对应的红色就是预测为负但实际为正，因此是FN。<br> 下面黄色部分，就是预测为正，但实际为负，因此是FP（false Positive)。<br> <img src="https://images2.imgbox.com/e6/54/tySI7dP9_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/da/81/j0qpAV8Z_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/75/f1/xo5TZ1u5_o.png" alt="在这里插入图片描述"><br> 结合上述图片，我们可以给出IOU的公式（结合几何意义）<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          I 
         
        
          O 
         
        
          U 
         
        
          = 
         
         
          
          
            T 
           
          
            P 
           
          
          
          
            F 
           
          
            N 
           
          
            + 
           
          
            T 
           
          
            P 
           
          
            + 
           
          
            F 
           
          
            P 
           
          
         
        
       
         IOU = \frac{TP}{FN+TP+FP} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0785em;">I</span><span class="mord mathnormal" style="margin-right: 0.0278em;">O</span><span class="mord mathnormal" style="margin-right: 0.109em;">U</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.1297em; vertical-align: -0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3603em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em;">FN</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">FP</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.7693em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          I 
         
        
          O 
         
        
          U 
         
        
          = 
         
         
         
           预测正确：蓝色 
          
          
          
            ( 
           
          
            红色 
           
          
            + 
           
          
            蓝色 
           
          
            + 
           
          
            黄色 
           
          
            ) 
           
          
         
        
       
         IOU=\frac{预测正确：蓝色}{(红色+蓝色+黄色)} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0785em;">I</span><span class="mord mathnormal" style="margin-right: 0.0278em;">O</span><span class="mord mathnormal" style="margin-right: 0.109em;">U</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.2963em; vertical-align: -0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3603em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord cjk_fallback">红色</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord cjk_fallback">蓝色</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord cjk_fallback">黄色</span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord cjk_fallback">预测正确：蓝色</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><br> 这位是对于一个类别来说的IOU公式，而mIOU公式是对所有类别求交并比的平均值。<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          m 
         
        
          I 
         
        
          O 
         
        
          U 
         
        
          = 
         
         
         
           1 
          
         
           k 
          
         
         
         
           ∑ 
          
          
          
            i 
           
          
            = 
           
          
            1 
           
          
         
           k 
          
         
         
          
          
            T 
           
          
            P 
           
          
          
          
            F 
           
          
            N 
           
          
            + 
           
          
            T 
           
          
            P 
           
          
            + 
           
          
            F 
           
          
            P 
           
          
         
        
       
         mIOU = \frac{1}{k}\sum_{i=1}^{k}\frac{TP}{FN+TP+FP} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right: 0.0785em;">I</span><span class="mord mathnormal" style="margin-right: 0.0278em;">O</span><span class="mord mathnormal" style="margin-right: 0.109em;">U</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 3.1138em; vertical-align: -1.2777em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3214em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0315em;">k</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.8361em;"><span class="" style="top: -1.8723em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span><span class="" style="top: -4.3em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right: 0.0315em;">k</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2777em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3603em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em;">FN</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">FP</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.7693em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><br> mIOU的计算过程中首先需要计算混淆矩阵。</p> 
<h3><a id="Dice_23"></a>Dice系数</h3> 
<p><a href="https://blog.csdn.net/lipengfei0427/article/details/109556985?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168256747516800226553557%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=168256747516800226553557&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~hot_rank-2-109556985-null-null.142%5Ev86%5Econtrol,239%5Ev2%5Einsert_chatgpt&amp;utm_term=Dice%E7%B3%BB%E6%95%B0&amp;spm=1018.2226.3001.4187">Dice系数、mIOU与Dice LOss</a><br> <strong>Dice系数是一种集合的相似度度量函数，通常用于计算两个样本的相似度，取值范围在[0,1]之间。</strong><br> <img src="https://images2.imgbox.com/3a/27/yzjeD3as_o.png" alt="在这里插入图片描述"><br> 我们同样根据上图，可以得出Dice系数的公式为：</p> 
<p>Dice系数的计算公式如下：</p> 
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          D 
         
        
          i 
         
        
          c 
         
        
          e 
         
        
          = 
         
         
          
          
            2 
           
          
            × 
           
          
            T 
           
          
            P 
           
          
          
          
            ( 
           
          
            T 
           
          
            P 
           
          
            + 
           
          
            F 
           
          
            N 
           
          
            ) 
           
          
            + 
           
          
            ( 
           
          
            T 
           
          
            P 
           
          
            + 
           
          
            F 
           
          
            P 
           
          
            ) 
           
          
         
        
          = 
         
         
          
          
            2 
           
          
            × 
           
          
            预测正确：蓝色 
           
          
          
          
            ( 
           
          
            真实结果：红色 
           
          
            + 
           
          
            蓝色 
           
          
            ) 
           
          
            + 
           
          
            ( 
           
          
            预测结果：黄色 
           
          
            + 
           
          
            蓝色 
           
          
            ) 
           
          
         
        
       
         Dice=\frac{2\times TP}{(TP+FN)+(TP+FP)} =\frac{2\times 预测正确：蓝色}{(真实结果：红色+蓝色)+(预测结果：黄色+蓝色)} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.2963em; vertical-align: -0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3603em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.109em;">FN</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">FP</span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.2963em; vertical-align: -0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3603em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord cjk_fallback">真实结果：红色</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord cjk_fallback">蓝色</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mopen">(</span><span class="mord cjk_fallback">预测结果：黄色</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord cjk_fallback">蓝色</span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord cjk_fallback">预测正确：蓝色</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p> 
<h3><a id="DiceIOU_34"></a>Dice和IOU的关系分析</h3> 
<p><a href="https://blog.csdn.net/qq_44886601/article/details/129418831">Dice和IOU关系分析</a><br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          集合交并比： 
         
        
          m 
         
        
          I 
         
        
          O 
         
        
          U 
         
        
          = 
         
         
          
          
            T 
           
          
            P 
           
          
          
          
            F 
           
          
            N 
           
          
            + 
           
          
            T 
           
          
            P 
           
          
            + 
           
          
            F 
           
          
            P 
           
          
         
        
       
         集合交并比：mIOU = \frac{TP}{FN+TP+FP} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord cjk_fallback">集合交并比：</span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right: 0.0785em;">I</span><span class="mord mathnormal" style="margin-right: 0.0278em;">O</span><span class="mord mathnormal" style="margin-right: 0.109em;">U</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.1297em; vertical-align: -0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3603em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em;">FN</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">FP</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.7693em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          集合相似度： 
         
        
          D 
         
        
          i 
         
        
          c 
         
        
          e 
         
        
          = 
         
         
          
          
            2 
           
          
            × 
           
          
            T 
           
          
            P 
           
          
          
          
            ( 
           
          
            T 
           
          
            P 
           
          
            + 
           
          
            F 
           
          
            N 
           
          
            ) 
           
          
            + 
           
          
            ( 
           
          
            T 
           
          
            P 
           
          
            + 
           
          
            F 
           
          
            P 
           
          
            ) 
           
          
         
        
       
         集合相似度：Dice=\frac{2\times TP}{(TP+FN)+(TP+FP)} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord cjk_fallback">集合相似度：</span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.2963em; vertical-align: -0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3603em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.109em;">FN</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">FP</span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><br> <img src="https://images2.imgbox.com/c6/8f/8FNqqXdy_o.png" alt="在这里插入图片描述"><br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          集合交并比： 
         
        
          I 
         
        
          O 
         
        
          U 
         
        
          = 
         
         
          
          
            T 
           
          
            P 
           
          
          
          
            F 
           
          
            N 
           
          
            + 
           
          
            T 
           
          
            P 
           
          
            + 
           
          
            F 
           
          
            P 
           
          
         
         
        
          = 
         
         
          
          
            T 
           
          
            P 
           
          
          
          
            F 
           
          
            N 
           
          
            + 
           
          
            T 
           
          
            P 
           
          
            + 
           
          
            F 
           
          
            P 
           
          
            + 
           
          
            T 
           
          
            P 
           
          
            − 
           
          
            T 
           
          
            P 
           
          
         
         
        
          = 
         
         
          
          
            2 
           
          
            T 
           
          
            P 
           
          
          
          
            2 
           
          
            ( 
           
          
            F 
           
          
            N 
           
          
            + 
           
          
            T 
           
          
            P 
           
          
            + 
           
          
            F 
           
          
            P 
           
          
            + 
           
          
            T 
           
          
            P 
           
          
            ) 
           
          
            − 
           
          
            2 
           
          
            T 
           
          
            P 
           
          
         
         
        
          = 
         
         
          
          
            D 
           
          
            i 
           
          
            c 
           
          
            e 
           
          
          
          
            2 
           
          
            − 
           
          
            D 
           
          
            i 
           
          
            c 
           
          
            e 
           
          
         
        
       
         集合交并比：IOU = \frac{TP}{FN+TP+FP}\\ = \frac{TP}{FN+TP+FP+TP-TP}\\ =\frac{2TP}{2(FN+TP+FP+TP)-2TP}\\ =\frac{Dice}{2-Dice} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord cjk_fallback">集合交并比：</span><span class="mord mathnormal" style="margin-right: 0.0785em;">I</span><span class="mord mathnormal" style="margin-right: 0.0278em;">O</span><span class="mord mathnormal" style="margin-right: 0.109em;">U</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.1297em; vertical-align: -0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3603em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em;">FN</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">FP</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.7693em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height: 0.3669em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.1297em; vertical-align: -0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3603em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.109em;">FN</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">FP</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.7693em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height: 0.3669em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.2963em; vertical-align: -0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3603em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right: 0.109em;">FN</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">FP</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">2</span><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="mspace newline"></span><span class="base"><span class="strut" style="height: 0.3669em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.1297em; vertical-align: -0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3603em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.7693em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span><br> 由公式可知，Dice一般情况下&gt;IOU。<br> 曲线如下：<br> <img src="https://images2.imgbox.com/f4/02/8VlclOol_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_49"></a>代码</h3> 
<p>由于网上给的Dice系数的求解代码基本上都是batch_size=1的，当batch_size&gt;1的时候，就没法用了，因此在这里对网上流行的代码和自己改的代码分别进行总结。</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">dice_coef</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># batch_size=1</span>
    smooth <span class="token operator">=</span> <span class="token number">1e-5</span>
    <span class="token comment">#output = torch.sigmoid(output).view(-1).data.cpu().numpy()</span>
    output<span class="token operator">=</span>torch<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>output<span class="token punctuation">)</span>
    output<span class="token punctuation">[</span>output <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment">#将概率输出变为于标签相匹配的矩阵</span>
    output<span class="token punctuation">[</span>output <span class="token operator">&lt;=</span> <span class="token number">0.5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment">#target = target.view(-1).data.cpu().numpy()</span>

    intersection <span class="token operator">=</span> <span class="token punctuation">(</span>output <span class="token operator">*</span> target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> TP
	<span class="token comment"># \符号有换行的作用</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token number">2.</span> <span class="token operator">*</span> intersection <span class="token operator">+</span> smooth<span class="token punctuation">)</span> <span class="token operator">/</span> \
        <span class="token punctuation">(</span>output<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> target<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> smooth<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment"># dice=2*TP/(TP+FN)+(TP+FP)</span>
<span class="token keyword">def</span> <span class="token function">dice_coef</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># Batch_size&gt;1时</span>
    smooth <span class="token operator">=</span> <span class="token number">1e-5</span>
    <span class="token comment">#output = torch.sigmoid(output).view(-1).data.cpu().numpy()</span>
    output<span class="token operator">=</span>torch<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    output<span class="token punctuation">[</span>output <span class="token operator">&gt;</span> <span class="token number">0.5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment">#将概率输出变为于标签相匹配的矩阵</span>
    output<span class="token punctuation">[</span>output <span class="token operator">&lt;=</span> <span class="token number">0.5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment"># target = target.view(-1).data.cpu().numpy()</span>
    target <span class="token operator">=</span> target<span class="token punctuation">.</span>data<span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    dice<span class="token operator">=</span><span class="token number">0.</span>
    <span class="token comment"># ipdb.set_trace() # 用于断掉调试</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token comment"># 如果样本量&gt;1，则逐样本累加</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            intersection <span class="token operator">=</span> <span class="token punctuation">(</span>output<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            dice <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token number">2.</span> <span class="token operator">*</span> intersection <span class="token operator">+</span> smooth<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>output<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> smooth<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        intersection <span class="token operator">=</span> <span class="token punctuation">(</span>output <span class="token operator">*</span> target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 一个数字,=TP</span>
        dice <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">2.</span> <span class="token operator">*</span> intersection <span class="token operator">+</span> smooth<span class="token punctuation">)</span> <span class="token operator">/</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> target<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> smooth<span class="token punctuation">)</span>
    <span class="token keyword">return</span> dice
</code></pre> 
<p>IOU的计算公式如下：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          D 
         
        
          i 
         
        
          c 
         
        
          e 
         
        
          = 
         
         
          
          
            T 
           
          
            P 
           
          
          
          
            T 
           
          
            P 
           
          
            + 
           
          
            F 
           
          
            N 
           
          
            + 
           
          
            F 
           
          
            P 
           
          
         
        
       
         Dice=\frac{TP}{TP+FN+FP} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0278em;">D</span><span class="mord mathnormal">i</span><span class="mord mathnormal">ce</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.1297em; vertical-align: -0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3603em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.109em;">FN</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord mathnormal" style="margin-right: 0.1389em;">FP</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.1389em;">TP</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.7693em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span></p> 
<pre><code class="prism language-python"><span class="token comment"># batch_size = 1</span>
<span class="token keyword">def</span> <span class="token function">iou_score</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">:</span>
    smooth <span class="token operator">=</span> <span class="token number">1e-5</span>

    <span class="token keyword">if</span> torch<span class="token punctuation">.</span>is_tensor<span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">:</span>
        output <span class="token operator">=</span> torch<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> torch<span class="token punctuation">.</span>is_tensor<span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">:</span>
        target <span class="token operator">=</span> target<span class="token punctuation">.</span>data<span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    output_ <span class="token operator">=</span> output <span class="token operator">&gt;</span> <span class="token number">0.5</span>
    target_ <span class="token operator">=</span> target <span class="token operator">&gt;</span> <span class="token number">0.5</span>
    intersection <span class="token operator">=</span> <span class="token punctuation">(</span>output_ <span class="token operator">&amp;</span> target_<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    union <span class="token operator">=</span> <span class="token punctuation">(</span>output_ <span class="token operator">|</span> target_<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>intersection <span class="token operator">+</span> smooth<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>union <span class="token operator">+</span> smooth<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment">#batch_size &gt; 1</span>
<span class="token keyword">def</span> <span class="token function">iou_score</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">:</span>
    smooth <span class="token operator">=</span> <span class="token number">1e-5</span>

    <span class="token keyword">if</span> torch<span class="token punctuation">.</span>is_tensor<span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">:</span>
        output <span class="token operator">=</span> torch<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> torch<span class="token punctuation">.</span>is_tensor<span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">:</span>
        target <span class="token operator">=</span> target<span class="token punctuation">.</span>data<span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    output_ <span class="token operator">=</span> output <span class="token operator">&gt;</span> <span class="token number">0.5</span>
    target_ <span class="token operator">=</span> target <span class="token operator">&gt;</span> <span class="token number">0.5</span>
    <span class="token comment"># intersection = (output_ &amp; target_).sum()</span>
    <span class="token comment"># union = (output_ | target_).sum()</span>
    iou <span class="token operator">=</span> <span class="token number">0.</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            union <span class="token operator">=</span> <span class="token punctuation">(</span>output_<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">|</span> target_<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            intersection <span class="token operator">=</span> <span class="token punctuation">(</span>output_<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;</span> target_<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            iou <span class="token operator">+=</span> <span class="token punctuation">(</span>intersection <span class="token operator">+</span> smooth<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>union <span class="token operator">+</span> smooth<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        intersection <span class="token operator">=</span> <span class="token punctuation">(</span>output_ <span class="token operator">&amp;</span> target_<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        union <span class="token operator">=</span> <span class="token punctuation">(</span>output_ <span class="token operator">|</span> target_<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        iou <span class="token operator">=</span> <span class="token punctuation">(</span>intersection <span class="token operator">+</span> smooth<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>union <span class="token operator">+</span> smooth<span class="token punctuation">)</span>
    <span class="token keyword">return</span> iou
</code></pre> 
<h2><a id="2RecallprecisionPPV_131"></a>2.敏感性（=Recall）、特异性和精确度（=precision=PPV)</h2> 
<h3><a id="21__132"></a>2.1 敏感性（召回率）和特异性</h3> 
<p>Recall公式</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_sensitivity</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> gt<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment"># 求敏感度 se=TP/(TP+FN)</span>
    SE <span class="token operator">=</span> <span class="token number">0.</span>
    output <span class="token operator">=</span> output <span class="token operator">&gt;</span> <span class="token number">0.5</span>
    gt <span class="token operator">=</span> gt <span class="token operator">&gt;</span> <span class="token number">0.5</span>
    TP <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>output<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>byte<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>gt<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>byte<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span>
    FN <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>output<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>byte<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>gt<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>byte<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span>
    <span class="token comment">#wfy:batch_num&gt;1时，改进</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            SE <span class="token operator">+=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>TP<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>TP<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">+</span>FN<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1e-6</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        SE <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>TP<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>TP<span class="token operator">+</span>FN<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1e-6</span><span class="token punctuation">)</span> <span class="token comment">#原本只用这一句</span>
    <span class="token comment">#SE = float(torch.sum(TP)) / (float(torch.sum(TP + FN)) + 1e-6)  # 原本只用这一句</span>
    <span class="token keyword">return</span> SE  <span class="token comment">#返回batch中所有样本的SE和</span>
</code></pre> 
<p>特异性：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_specificity</span><span class="token punctuation">(</span>SR<span class="token punctuation">,</span> GT<span class="token punctuation">,</span> threshold<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment">#求特异性 sp=TN/(FP+TN)</span>
    SR <span class="token operator">=</span> SR <span class="token operator">&gt;</span> threshold <span class="token comment">#得到true和false</span>
    GT <span class="token operator">=</span> GT <span class="token operator">&gt;</span> threshold
    SP<span class="token operator">=</span><span class="token number">0.</span><span class="token comment"># wfy</span>
    <span class="token comment"># TN : True Negative</span>
    <span class="token comment"># FP : False Positive</span>
    TN <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>SR <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>byte<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>GT <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>byte<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span>
    FP <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>SR <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>byte<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>GT <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>byte<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span>
    <span class="token comment">#wfy:batch_num&gt;1时，改进</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>SR<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>SR<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            SP <span class="token operator">+=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>TN<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>TN<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> FP<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1e-6</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        SP <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>TN<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>TN <span class="token operator">+</span> FP<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1e-6</span><span class="token punctuation">)</span> <span class="token comment"># 原本只用这一句</span>
    <span class="token comment">#</span>
    <span class="token comment"># SP = float(torch.sum(TN)) / (float(torch.sum(TN + FP)) + 1e-6)</span>
    <span class="token keyword">return</span> SP
</code></pre> 
<p>这两个指标在医疗领域很常用，而在机器学习领域常用的是Recall和Precision。</p> 
<h3><a id="22__174"></a>2.2 敏感性和特异性之间的关系</h3> 
<p>暂略</p> 
<h3><a id="23_RecallPrecision_176"></a>2.3 Recall和Precision之间的关系</h3> 
<p>ppv=precision</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">ppv</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> target<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#阳性预测值，准确率（precision）pr = TP/(TP+FP)</span>
    smooth <span class="token operator">=</span> <span class="token number">1e-5</span>

    <span class="token keyword">if</span> torch<span class="token punctuation">.</span>is_tensor<span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">:</span>
        output <span class="token operator">=</span> torch<span class="token punctuation">.</span>sigmoid<span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">.</span>data<span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> torch<span class="token punctuation">.</span>is_tensor<span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">:</span>
        target <span class="token operator">=</span> target<span class="token punctuation">.</span>data<span class="token punctuation">.</span>cpu<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ppv<span class="token operator">=</span><span class="token number">0.</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            intersection <span class="token operator">=</span> <span class="token punctuation">(</span>output<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">*</span> target<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            ppv <span class="token operator">+=</span> <span class="token punctuation">(</span>intersection <span class="token operator">+</span> smooth<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>output<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> smooth<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        intersection <span class="token operator">=</span> <span class="token punctuation">(</span>output <span class="token operator">*</span> target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 一个数字,=TP</span>
        ppv <span class="token operator">=</span> <span class="token punctuation">(</span>intersection <span class="token operator">+</span> smooth<span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> smooth<span class="token punctuation">)</span>

    <span class="token comment"># intersection = (output * target).sum() # TP</span>
    <span class="token keyword">return</span> ppv
</code></pre> 
<h2><a id="3_F1_199"></a>3. F1</h2> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">get_F1</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> gt<span class="token punctuation">)</span><span class="token punctuation">:</span>
    se <span class="token operator">=</span> get_sensitivity<span class="token punctuation">(</span>output<span class="token punctuation">,</span> gt<span class="token punctuation">)</span>
    pc <span class="token operator">=</span> get_precision<span class="token punctuation">(</span>output<span class="token punctuation">,</span> gt<span class="token punctuation">)</span>
    f1 <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">*</span>se<span class="token operator">*</span>pc <span class="token operator">/</span> <span class="token punctuation">(</span>se<span class="token operator">+</span>pc<span class="token operator">+</span><span class="token number">1e-6</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> f1
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/57d5ef767252dabe05b65fe2800a6497/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">形容词变副词</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6275236f961a9e4126312297d565fd4b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java数据校验spring数据校验hibernate-validator一篇文章搞懂</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>