<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Mac M1使用PD虚拟机进行Linux开发（一）使用ubuntu进行裸机开发篇 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Mac M1使用PD虚拟机进行Linux开发（一）使用ubuntu进行裸机开发篇" />
<meta property="og:description" content="一、虚拟机系统的安装 使用Parallels Desktop 推荐的方式直接安装Ubuntu/Debian即可，这里我选择Debian（8G丐版在实际跑ubuntu的时候，用了几天，后面内存占用较高，改小运行内存后会出现闪退的情况，具体原因没有深究。Debian使用体验确实不错，使用的是xfce4桌面，这里先给大家避个雷）
博主这里默认的硬件配置是2核心&#43;2G内存，实际体验很不错，暂时没发现卡顿。
安装过程全程不用动电脑，等待就好，硬件配置后面可以在虚拟机的配置中修改。
二、 基本环境的配置和源的替换 这里仍然不用赘述，我使用的是清华源，注意替换好源之后要更新。
# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释
deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free
# deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free
deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free
# deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free
deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free
# deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free
deb https://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free
# deb-src https://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free
sudo apt-get update" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ea3575ac56bc13e9e064ca00f1bffe2d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-22T17:36:18+08:00" />
<meta property="article:modified_time" content="2021-10-22T17:36:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Mac M1使用PD虚拟机进行Linux开发（一）使用ubuntu进行裸机开发篇</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一、虚拟机系统的安装</h2> 
<p>        使用Parallels Desktop 推荐的方式直接安装Ubuntu/Debian即可，这里我选择Debian（8G丐版在实际跑ubuntu的时候，用了几天，后面内存占用较高，改小运行内存后会出现闪退的情况，具体原因没有深究。Debian使用体验确实不错，使用的是xfce4桌面，这里先给大家避个雷）</p> 
<p>        博主这里默认的硬件配置是2核心+2G内存，实际体验很不错，暂时没发现卡顿。</p> 
<p style="text-align:center;"><img alt="" height="395" src="https://images2.imgbox.com/df/0a/ma9xc50O_o.png" width="592"></p> 
<p>        安装过程全程不用动电脑，等待就好，硬件配置后面可以在虚拟机的配置中修改。</p> 
<h2>二、 基本环境的配置和源的替换</h2> 
<p>        这里仍然不用赘述，我使用的是清华源，注意替换好源之后要更新。</p> 
<blockquote> 
 <p># 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释<br> deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free<br> # deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free<br> deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free<br> # deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free</p> 
 <p>deb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free<br> # deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free</p> 
 <p>deb https://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free<br> # deb-src https://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free</p> 
</blockquote> 
<blockquote> 
 <p>sudo apt-get update</p> 
 <p>sudo apt-get upgrade</p> 
</blockquote> 
<h2>三、安装交叉编译工具链</h2> 
<p>        <strong>方法一：</strong>（缺点，只能在裸机开发下工作正常，编译uboot会出现问题，具体原因没有深究）</p> 
<p>        这里看过正点原子教程的都知道是在 linaro中下载解压安装的，但是教程中是针对x86架构的ubuntu，实际上我们安装的是arm架构的虚拟机，安装是一定会出问题的。</p> 
<p>        但是之前在ubuntu试图安装的时候偶然发现gcc-arm-linux-gnueabihf，然后就尝试了一波如下命令</p> 
<blockquote> 
 <p>sudo apt-get install gcc-arm-linux-gnueabihf</p> 
</blockquote> 
<p>       </p> 
<p style="text-align:center;"><img alt="" height="111" src="https://images2.imgbox.com/b0/a3/jCWmfUM9_o.png" width="646"></p> 
<p>        然后就安装成功了，看一下版本信息是没问题的。</p> 
<p style="text-align:center;"><img alt="" height="197" src="https://images2.imgbox.com/ab/01/SJIJsesI_o.png" width="647"></p> 
<p>        可以看到主机是aarch64，证明版本安装正确。</p> 
<p>       <strong> 方法二：</strong></p> 
<p>        由于在线安装交叉编译工具链会存在问题，于是推荐大家使用arm官方发行的交叉编译工具链进行安装<a class="link-info" href="https://developer.arm.com/tools-and-software/open-source-software/developer-tools/gnu-toolchain/gnu-a/downloads" rel="nofollow" title="下载地址">下载地址</a>，验证后发现可以进行uboot编译，但是编译命令脚本会和正点原子官方所提供的有所差别。安装好后，修改环境变量</p> 
<blockquote> 
 <p>sudo vi /etc/profile</p> 
</blockquote> 
<h2><img alt="" height="602" src="https://images2.imgbox.com/d9/c2/5ZvRYy7U_o.png" width="1200"></h2> 
<p>        重启查看版本号</p> 
<p><img alt="" height="878" src="https://images2.imgbox.com/91/35/YF4ZWXSy_o.png" width="1200"></p> 
<p>        验证成功，下一篇文章会进行uboot编译验证。 </p> 
<h2> 四、进行Linux 裸机下载验证</h2> 
<p>        我们在虚拟机上写好测试的程序之后，生成.bin文件</p> 
<p>        这里使用Makefile编译</p> 
<pre><code>CROSS_COMPILE 	?= arm-linux-gnueabihf
TARGET		  	?= bsp

GCC 			:= 	$(CROSS_COMPILE)-gcc
LD				:= 	$(CROSS_COMPILE)-ld
OBJCOPY 		:= 	$(CROSS_COMPILE)-objcopy
OBJDUMP 		:= 	$(CROSS_COMPILE)-objdump

INC_DIRS 		:= 	imx6ul 			\
				   	bsp/clk 		\
				   	bsp/led 		\
				   	bsp/delay 		\
					bsp/key			\
					bsp/gpio		\

SRC_DIRS		:= 	project 		\
				   	bsp/clk 		\
				   	bsp/led 		\
				   	bsp/delay 		\
					bsp/key			\
					bsp/gpio		\
				   
				   
INCLUDE			:= 	$(patsubst %, -I %, $(INC_DIRS))

S_DIR_FILES		:= 	$(foreach dir, $(SRC_DIRS), $(wildcard $(dir)/*.S))
C_DIR_FILES		:= 	$(foreach dir, $(SRC_DIRS), $(wildcard $(dir)/*.c))

S_FILES			:= 	$(notdir  $(S_DIR_FILES))
C_FILES			:= 	$(notdir  $(C_DIR_FILES))

S_OBJS			:= 	$(patsubst %, obj/%, $(S_FILES:.S=.o))
C_OBJS			:= 	$(patsubst %, obj/%, $(C_FILES:.c=.o))
OBJS			:= 	$(S_OBJS) $(C_OBJS)

VPATH			:= 	$(SRC_DIRS)

.PHONY: clean
	
$(TARGET).bin : $(OBJS)
	$(LD) -Timx6ul.lds -o $(TARGET).elf $^
	$(OBJCOPY) -O binary -S $(TARGET).elf $@
	$(OBJDUMP) -D -m arm $(TARGET).elf &gt; $(TARGET).dis

$(S_OBJS) : obj/%.o : %.S
	$(GCC) -Wall -nostdlib -c -O2  $(INCLUDE) -o $@ $&lt;

$(C_OBJS) : obj/%.o : %.c
	$(GCC) -Wall -nostdlib -c -O2  $(INCLUDE) -o $@ $&lt;
	
clean:
	rm -rf $(TARGET).elf $(TARGET).dis $(TARGET).bin $(OBJS)

	
</code></pre> 
<p>        此时进行下载验证会报错，因为之前正点原子的imxdownload 执行文件是在x86端编译的，显然我们在arm平台上要重新编译一次。</p> 
<p><img alt="" height="71" src="https://images2.imgbox.com/b0/a2/hzYIzqeF_o.png" width="945"></p> 
<p>        重新编译imxdownload</p> 
<p style="text-align:center;"><img alt="" height="239" src="https://images2.imgbox.com/47/6f/fYPRAkh9_o.png" width="352"></p> 
<p>        再将其拷贝到项目工程目录下 ，再次进行验证</p> 
<p><img alt="" height="305" src="https://images2.imgbox.com/93/6a/f82n2aS9_o.png" width="936"></p> 
<p>        下载成功！</p> 
<p>        至此，裸机开发部分，暂时没遇到其他问题。可以开心的在M1上进行Linux 裸机学习咯</p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e941e50280473e8df7ac13c16fe3fcfd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ShedLock使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/97caa8cc27ededfbb10eb420bfca9e9d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python中的条件语句</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>