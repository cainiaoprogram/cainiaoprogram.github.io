<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CDH5.16.1集群企业真正离线部署(三台阿里云主机按量付费) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="CDH5.16.1集群企业真正离线部署(三台阿里云主机按量付费)" />
<meta property="og:description" content="一.准备工作 1.集群规划
节点 MySQL部署组件Parcel文件离线源 CM服务进程 大数据组件hadoop001MySQLParcelActivity MonitorNN RM DN NMhadoop002 Alert Publisher
Event ServerDN NMhadoop003 Alert Publisher
Event ServerDN NM 2.下载源
CM：
http://archive.cloudera.com/cm5/cm/5/cloudera-manager-centos7-cm5.16.1_x86_64.tar.gz
Parcel：
http://archive.cloudera.com/cdh5/parcels/5.16.1/CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel
http://archive.cloudera.com/cdh5/parcels/5.16.1/CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel.sha1
http://archive.cloudera.com/cdh5/parcels/5.16.1/manifest.json
JDK：
https://www.oracle.com/technetwork/java/javase/downloads/java-archive-javase8-2177648.html
MySQL
https://dev.mysql.com/downloads/mysql/5.7.html#downloads
MySQL jdbc jar
http://central.maven.org/maven2/mysql/mysql-connector-java/5.1.47/mysql-connector-java-5.1.47.jar
下载完成后要重命名去掉版本号，
mv mysql-connector-java-5.1.47.jar mysql-connector-java.jar
二.集群节点初始化 1.阿里云上海海区购买3台，按量量付费虚拟机
CentOS7.2操作系统，2核8G最低配置
2.当前笔记本或台式机配置hosts文件
MAC: /etc/hosts
Window: C:\windows\system32\drivers\etc\hosts
172.17.79.118 hadoop001 172.17.79.117 hadoop002 172.17.79.116 hadoop003 3.设置所有节点的hosts文件
vim /etc/hosts
172.17.79.118 hadoop001 172.17.79.117 hadoop002 172.17.79.116 hadoop003 4.关闭所有节点的防火墙及清空规则
centos关闭防火墙
systemctl stop firewalld systemctl disable firewalld iptables -F iptables -L 一般阿里云的防火墙都是关闭的，但是阿里云服务器上有一个Web的防火墙，要打开7180的端口" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/aa31445998543ee02324bbbf291d1e5e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-10-06T00:30:42+08:00" />
<meta property="article:modified_time" content="2019-10-06T00:30:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">CDH5.16.1集群企业真正离线部署(三台阿里云主机按量付费)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>一.准备工作</h4> 
<p><strong>1.集群规划</strong><br>  </p> 
<table border="1" cellpadding="1" cellspacing="1" style="width:650px;"><tbody><tr><td style="width:115px;">节点        </td><td style="width:130px;">MySQL部署组件</td><td>Parcel文件离线源</td><td>    CM服务进程</td><td>    大数据组件</td></tr><tr><td style="width:115px;">hadoop001</td><td style="width:130px;">MySQL</td><td>Parcel</td><td>Activity Monitor</td><td>NN RM DN NM</td></tr><tr><td style="width:115px;">hadoop002</td><td style="width:130px;"> </td><td> </td><td>Alert Publisher<br> Event Server</td><td>DN NM</td></tr><tr><td style="width:115px;">hadoop003</td><td style="width:130px;"> </td><td> </td><td>Alert Publisher<br> Event Server</td><td>DN NM</td></tr></tbody></table> 
<p><strong>2.下载源</strong><br> CM：<br><a href="http://archive.cloudera.com/cm5/cm/5/cloudera-manager-centos7-cm5.16.1_x86_64.tar.gz" rel="nofollow">http://archive.cloudera.com/cm5/cm/5/cloudera-manager-centos7-cm5.16.1_x86_64.tar.gz</a><br> Parcel：<br><a href="http://archive.cloudera.com/cdh5/parcels/5.16.1/CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel" rel="nofollow">http://archive.cloudera.com/cdh5/parcels/5.16.1/CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel</a><br><a href="http://archive.cloudera.com/cdh5/parcels/5.16.1/CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel.sha1" rel="nofollow">http://archive.cloudera.com/cdh5/parcels/5.16.1/CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel.sha1</a><br><a href="http://archive.cloudera.com/cdh5/parcels/5.16.1/manifest.json" rel="nofollow">http://archive.cloudera.com/cdh5/parcels/5.16.1/manifest.json</a><br> JDK：<br><a href="https://www.oracle.com/technetwork/java/javase/downloads/java-archive-javase8-2177648.html" rel="nofollow">https://www.oracle.com/technetwork/java/javase/downloads/java-archive-javase8-2177648.html</a><br> MySQL<br><a href="https://dev.mysql.com/downloads/mysql/5.7.html#downloads" rel="nofollow">https://dev.mysql.com/downloads/mysql/5.7.html#downloads</a><br> MySQL jdbc jar<br><a href="http://central.maven.org/maven2/mysql/mysql-connector-java/5.1.47/mysql-connector-java-5.1.47.jar" rel="nofollow">http://central.maven.org/maven2/mysql/mysql-connector-java/5.1.47/mysql-connector-java-5.1.47.jar</a><br> 下载完成后要重命名去掉版本号，<br> mv mysql-connector-java-5.1.47.jar mysql-connector-java.jar</p> 
<h4>二.集群节点初始化</h4> 
<p><strong>1.阿里云上海海区购买3台，按量量付费虚拟机</strong><br> CentOS7.2操作系统，2核8G最低配置<br><strong>2.当前笔记本或台式机配置hosts文件</strong><br> MAC: /etc/hosts<br> Window: C:\windows\system32\drivers\etc\hosts</p> 
<pre class="has"><code>172.17.79.118 hadoop001
172.17.79.117 hadoop002
172.17.79.116 hadoop003</code></pre> 
<p><strong>3.设置所有节点的hosts文件</strong><br> vim /etc/hosts</p> 
<pre class="has"><code>172.17.79.118 hadoop001
172.17.79.117 hadoop002
172.17.79.116 hadoop003</code></pre> 
<p><strong>4.关闭所有节点的防火墙及清空规则</strong><br> centos关闭防火墙</p> 
<pre class="has"><code>systemctl stop firewalld
systemctl disable firewalld
iptables -F
iptables -L</code></pre> 
<p><br> 一般阿里云的防火墙都是关闭的，但是阿里云服务器上有一个Web的防火墙，要打开7180的端口<br><br><img alt="" class="has" height="179" src="https://images2.imgbox.com/92/d9/DvmNRkPC_o.png" width="601"><br><img alt="" class="has" height="425" src="https://images2.imgbox.com/a4/e7/CoXh1Hhk_o.png" width="952"><br><img alt="" class="has" height="639" src="https://images2.imgbox.com/72/62/Aqr8v0s5_o.png" width="600"><br><strong>5.关闭所有节点的selinux</strong><br> [root@hadoop001 ~]# vim /etc/selinux/config<br> 将SELINUX=enforcing改为SELINUX=disabled<br> 设置后需要重启才能生效<br> [root@hadoop001 ~]# reboot<br><strong>6.查看设置所有节点的时区一致及时钟同步</strong><br> 6.1 时区</p> 
<pre class="has"><code>[root@hadoop001 ~]# date
Sat Oct  5 19:22:21 CST 2019
[root@hadoop001 ~]# timedatectl
      Local time: Sat 2019-10-05 19:21:55 CST
  Universal time: Sat 2019-10-05 11:21:55 UTC
        RTC time: Sat 2019-10-05 19:21:54
       Time zone: Asia/Shanghai (CST, +0800)
     NTP enabled: yes
NTP synchronized: yes
 RTC in local TZ: yes
      DST active: n/a

Warning: The system is configured to read the RTC time in the local time zone.
         This mode can not be fully supported. It will create various problems
         with time zone changes and daylight saving time adjustments. The RTC
         time is never updated, it relies on external facilities to maintain it.
         If at all possible, use RTC in UTC by calling
         'timedatectl set-local-rtc 0'.
[root@hadoop001 ~]# 
</code></pre> 
<p>如果时区不一致，使用如下命令</p> 
<pre class="has"><code>[root@hadoop001 ~]# timedatectl set-timezone Asia/Shanghai</code></pre> 
<p>6.2 时间<br> 为所有节点安装ntp</p> 
<pre class="has"><code>[root@hadoop001 ~]# yum install -y ntp</code></pre> 
<p>选取hadoop001为ntp的主节点<br> [root@hadoop001 ~]# vi /etc/ntp.conf</p> 
<pre class="has"><code>server 0.asia.pool.ntp.org
server 1.asia.pool.ntp.org
server 2.asia.pool.ntp.org
server 3.asia.pool.ntp.org

#当外部时间不不可用时，可使⽤用本地硬件时间
server 127.127.1.0 iburst local clock
#允许哪些网段的机器（如果网络时间不可用，使用本网段的时间）来同步时间（查看自己机器的网段）
restrict 172.17.79.0 mask 255.255.255.0 nomodify notrap</code></pre> 
<p><img alt="" class="has" height="407" src="https://images2.imgbox.com/cc/49/XnyxpwXj_o.png" width="803"><br> 开启ntpd及查看状态</p> 
<pre class="has"><code>[root@hadoop001 ~]# systemctl start ntpd
[root@hadoop001 ~]# systemctl status ntpd
● ntpd.service - Network Time Service
   Loaded: loaded (/usr/lib/systemd/system/ntpd.service; enabled; vendor preset: disabled)
   Active: active (running) since Sat 2019-10-05 19:27:05 CST; 21min ago
 Main PID: 18524 (ntpd)
   CGroup: /system.slice/ntpd.service
           └─18524 /usr/sbin/ntpd -u ntp:ntp -g

Oct 05 19:27:05 hadoop001 systemd[1]: Starting Network Time Service...
Oct 05 19:27:05 hadoop001 ntpd[18524]: proto: precision = 0.088 usec
Oct 05 19:27:05 hadoop001 ntpd[18524]: 0.0.0.0 c01d 0d kern kernel time sync enabled
Oct 05 19:27:05 hadoop001 systemd[1]: Started Network Time Service.
[root@hadoop001 ~]# </code></pre> 
<p>验证时间的配置</p> 
<pre class="has"><code>[root@hadoop001 ~]# ntpq -p
     remote           refid      st t when poll reach   delay   offset  jitter
==============================================================================
 LOCAL(0)        .LOCL.          10 l 1381   64    0    0.000    0.000   0.000
-120.25.115.20   10.137.53.7      2 u    -   64  377   47.131   15.104   7.207
 10.143.33.49    .INIT.          16 u    - 1024    0    0.000    0.000   0.000
+100.100.3.1     10.137.55.181    2 u   21   64  377   34.082   24.574   9.506
*100.100.3.2     10.137.55.181    2 u   30   64  377   25.756   15.962   6.527
+100.100.3.3     10.137.55.181    2 u   26   64  377   30.820   22.105   6.735
+203.107.6.88    100.107.25.114   2 u   20   64  377   12.715   16.232   6.725
 10.143.33.50    .INIT.          16 u    - 1024    0    0.000    0.000   0.000
 10.143.33.51    .INIT.          16 u    - 1024    0    0.000    0.000   0.000
 10.143.0.44     .INIT.          16 u    - 1024    0    0.000    0.000   0.000
 10.143.0.45     .INIT.          16 u    - 1024    0    0.000    0.000   0.000
 10.143.0.46     .INIT.          16 u    - 1024    0    0.000    0.000   0.000
+100.100.5.1     10.137.55.181    2 u   25   64  377   26.518   23.554   9.289
-100.100.5.2     10.137.55.181    2 u   12   64  377   26.562   10.974   9.288
+100.100.5.3     10.137.55.181    2 u   38   64  377   25.519   24.802   9.669</code></pre> 
<p>其他从节点停止并禁用ntpd服务</p> 
<pre class="has"><code>[root@hadoop002 ~]# vim /etc/ntp.conf
[root@hadoop002 ~]# clear
[root@hadoop002 ~]# systemctl stop ntpd
[root@hadoop002 ~]# systemctl disable ntpd
Removed symlink /etc/systemd/system/multi-user.target.wants/ntpd.service.
[root@hadoop002 ~]# which ntpdate
/usr/sbin/ntpdate
[root@hadoop002 ~]# /usr/sbin/ntpdate hadoop001
 5 Oct 19:54:22 ntpdate[18602]: adjust time server 172.17.79.118 offset -0.000208 sec</code></pre> 
<p>每天凌晨同步hadoop001节点时间<br> [root@hadoop002 ~]# crontab -e<br> 00 00 * * * /usr/sbin/ntpdate hadoop001<br> hadoop003机器做同样的配置操作<br><br><strong>7.部署集群的JDK</strong></p> 
<pre class="has"><code>mkdir /usr/java
tar -xzvf jdk-8u45-linux-x64.tar.gz -C /usr/java/
#切记必须修正所属⽤用户及⽤用户组
chown -R root:root /usr/java/jdk1.8.0_45
vim /etc/profile

export JAVA_HOME=/usr/java/jdk1.8.0_45
export PATH=$JAVA_HOME/bin:$PATH

source /etc/profile
which java</code></pre> 
<p><strong>8.hadoop001节点离线部署MySQL5.7</strong><br><a href="https://blog.csdn.net/muyingmiao/article/details/101685786">https://blog.csdn.net/muyingmiao/article/details/101685786</a><br><br><strong>9.创建CDH的元数据库和用户、amon服务的数据库及用户</strong></p> 
<pre class="has"><code>mysql&gt; create database cmf DEFAULT CHARACTER SET utf8;
Query OK, 1 row affected (0.00 sec)

mysql&gt; create database amon DEFAULT CHARACTER SET utf8;
Query OK, 1 row affected (0.00 sec)

mysql&gt; grant all on cmf.* TO 'cmf'@'%' IDENTIFIED BY 'root';
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql&gt; grant all on amon.* TO 'amon'@'%' IDENTIFIED BY 'root';
Query OK, 0 rows affected, 1 warning (0.00 sec)

mysql&gt; flush privileges;
Query OK, 0 rows affected (0.00 sec)
</code></pre> 
<p><strong>10.hadoop001节点部署mysql jdbc jar</strong></p> 
<pre class="has"><code>[root@hadoop001 ~]# mkdir -p /usr/share/java/
[root@hadoop001 ~]# cd cdh5.16.1/
[root@hadoop001 cdh5.16.1]# ll
total 3605080
-rw-r--r-- 1 root root 2127506677 Oct  5 20:54 CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel
-rw-r--r-- 1 root root         41 Oct  5 19:51 CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel.sha1
-rw-r--r-- 1 root root  841524318 Oct  5 20:27 cloudera-manager-centos7-cm5.16.1_x86_64.tar.gz
-rw-r--r-- 1 root root  173271626 Oct  5 19:40 jdk-8u45-linux-x64.gz
-rw-r--r-- 1 root root      66538 Oct  5 19:32 manifest.json
-rw-r--r-- 1 root root  548193637 Oct  5 19:48 mysql-5.7.11-linux-glibc2.5-x86_64.tar.gz
-rw-r--r-- 1 root root    1007502 Oct  5 19:32 mysql-connector-java-5.1.47.jar
[root@hadoop001 cdh5.16.1]# cp mysql-connector-java-5.1.47.jar  /usr/share/java/
[root@hadoop001 cdh5.16.1]# cd /usr/share/java/
[root@hadoop001 java]# ll
total 984
-rw-r--r-- 1 root root 1007502 Oct  5 22:22 mysql-connector-java-5.1.47.jar
[root@hadoop001 java]# mv mysql-connector-java-5.1.47.jar  mysql-connector-java.jar 
</code></pre> 
<h4>三.CDH部署</h4> 
<p>1.1 将cdh安装包分发到其他的从节点机器</p> 
<pre class="has"><code>[root@hadoop001 cdh5.16.1]# scp cloudera-manager-centos7-cm5.16.1_x86_64.tar.gz hadoop002:/root/cdh5.16.1/
root@hadoop003's password: 
cloudera-manager-centos7-cm5.16.1_x86_64.tar.gz                                                                                                            100%  803MB  50.2MB/s   00:16    
[root@hadoop001 cdh5.16.1]# 
[root@hadoop001 cdh5.16.1]# scp cloudera-manager-centos7-cm5.16.1_x86_64.tar.gz hadoop003:/root/cdh5.16.1/
root@hadoop003's password: 
cloudera-manager-centos7-cm5.16.1_x86_64.tar.gz                                                                                                            100%  803MB  50.2MB/s   00:16    
[root@hadoop001 cdh5.16.1]# 
</code></pre> 
<p>1.2 所有节点创建目录及解压<br> mkdir /opt/cloudera-manager<br> tar -zxvf cloudera-manager-centos7-cm5.16.1_x86_64.tar.gz -C /opt/cloudera-manager/<br> 1.3 所有节点修改agent的配置，指向server的节点hadoop001[root@hadoop001 cloudera-scm-agent]# cd /opt/cloudera-manager/cm-5.16.1/etc/cloudera-scm-agent/<br> [root@hadoop001 cloudera-scm-agent]# vim config.ini <br> [root@hadoop001 cloudera-scm-agent]# </p> 
<pre class="has"><code>server_host=hadoop001</code></pre> 
<p>1.4 主节点【hadoop001】修改server的配置<br> vi /opt/cloudera-manager/cm-5.16.1/etc/cloudera-scm-server/db.properties<br> com.cloudera.cmf.db.type=mysql<br> com.cloudera.cmf.db.host=hadoop001<br> com.cloudera.cmf.db.name=cmf<br> com.cloudera.cmf.db.user=cmf<br> com.cloudera.cmf.db.password=Ruozedata123456!<br> com.cloudera.cmf.db.setupType=EXTERNAL</p> 
<p><img alt="" class="has" height="442" src="https://images2.imgbox.com/ca/8d/9gLqD1Yx_o.png" width="558"><br> 1.5.所有节点创建用户<br> useradd --system --home=/opt/cloudera-manager/cm-5.16.1/run/cloudera-scm-server/ --no-create-home --shell=/bin/false --comment "Cloudera SCM User" cloudera-scm<br> 1.6.目录修改用户及用户组<br> chown -R cloudera-scm:cloudera-scm /opt/cloudera-manager<br><strong>2.hadoop001节点部署离线parcel源</strong><br><strong>[离线部署 cm<br> 解压<br> agent配置 hadoop001-hadoop003<br> server配置 hadoop001<br> 创建cloudera-scm<br> 文件夹用户用户组修改<br> parcel文件离线源 hadoop001<br> ]</strong><br> 2.1 部署离线parcel源，将<strong>CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel，CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel.sha1， manifest.json，</strong>上传到hadoop001的cdh5.16.1目录下</p> 
<pre class="has"><code>[root@hadoop001 ~]# mkdir -p /opt/cloudera/parcel-repo
[root@hadoop001 ~]# cd cdh5.16.1/
[root@hadoop001 cdh5.16.1]# ll
total 3605080
-rw-r--r-- 1 root root 2127506677 Oct  5 20:54 CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel
-rw-r--r-- 1 root root         41 Oct  5 19:51 CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel.sha1
-rw-r--r-- 1 root root  841524318 Oct  5 20:27 cloudera-manager-centos7-cm5.16.1_x86_64.tar.gz
-rw-r--r-- 1 root root  173271626 Oct  5 19:40 jdk-8u45-linux-x64.gz
-rw-r--r-- 1 root root      66538 Oct  5 19:32 manifest.json
-rw-r--r-- 1 root root  548193637 Oct  5 19:48 mysql-5.7.11-linux-glibc2.5-x86_64.tar.gz
-rw-r--r-- 1 root root    1007502 Oct  5 19:32 mysql-connector-java-5.1.47.jar
[root@hadoop001 cdh5.16.1]# mv CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel /opt/cloudera/parcel-repo
[root@hadoop001 cdh5.16.1]# mv CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel.sha1 /opt/cloudera/parcel-repo/CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel.sha
[root@hadoop001 cdh5.16.1]# mv manifest.json /opt/cloudera/parcel-repo
[root@hadoop001 ~]# cd /opt/cloudera/parcel-repo
## 校验O包裹文件
[root@hadoop001 parcel-repo]# ll
total 2077720
-rw-r--r-- 1 root         root         2127506677 Oct 22 19:15 CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel
-rw-r--r-- 1 cloudera-scm cloudera-scm         41 Oct 22 20:04 CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel.sha
-rw-r--r-- 1 cloudera-scm cloudera-scm      66538 Oct 22 20:04 manifest.json
[root@hadoop001 parcel-repo]# /usr/bin/sha1sum CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel
703728dfa7690861ecd3a9bcd412b04ac8de7148  CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel
</code></pre> 
<p>2.2 目录修改用户及用户组<br> [root@hadoop001 cdh5.16.1]# chown -R cloudera-scm:cloudera-scm /opt/cloudera/<br><strong>3.<span style="color:#f33b45;">所有节点创建</span>软件安装目录、用户及用户组权限（所有节点创建大数据软件安装目录，用户和用户组权限）</strong><br> [root@hadoop00* parcel-repo]# mkdir -p /opt/cloudera/parcels<br> [root@hadoop00* parcel-repo]# chown -R cloudera-scm:cloudera-scm /opt/cloudera/<br><strong>4.hadoop001节点启动Server</strong><br> 4.1.启动server<br> /opt/cloudera-manager/cm-5.16.1/etc/init.d/cloudera-scm-server start</p> 
<pre class="has"><code>[root@hadoop001 cloudera]# cd /opt/cloudera-manager/cm-5.16.1/etc/init.d
[root@hadoop001 init.d]# ll
total 32
-rwxr-xr-x 1 cloudera-scm cloudera-scm 8871 Nov 21  2018 cloudera-scm-agent
-rwxr-xr-x 1 cloudera-scm cloudera-scm 8417 Nov 21  2018 cloudera-scm-server
-rwxr-xr-x 1 cloudera-scm cloudera-scm 4444 Nov 21  2018 cloudera-scm-server-db
[root@hadoop001 init.d]# ./cloudera-scm-server start
Starting cloudera-scm-server:                              [  OK  ]</code></pre> 
<p>打开另一个terminal，查看server的启动日志<br> 等待一分钟，看到7180的端口</p> 
<pre class="has"><code>[root@hadoop001 cloudera-scm-server]# cd /opt/cloudera-manager/cm-5.16.1/log/cloudera-scm-server
[root@hadoop001 cloudera-scm-server]# ll
total 44
-rw-r----- 1 root root 33569 Oct 23 17:31 cloudera-scm-server.log
-rw-r--r-- 1 root root  7296 Oct 23 17:31 cloudera-scm-server.out
-rw-r----- 1 root root     0 Oct 23 17:31 cmf-server-perf.log
[root@hadoop001 cloudera-scm-server]# tail -f  cloudera-scm-server.log
........
........
cloudera-scm-server]
2019-10-23 17:43:09,884 INFO WebServerImpl:org.mortbay.log: jetty-6.1.26.cloudera.4
2019-10-23 17:43:09,885 INFO WebServerImpl:org.mortbay.log: Started SelectChannelConnector@0.0.0.0:7180
2019-10-23 17:43:09,885 INFO WebServerImpl:com.cloudera.server.cmf.WebServerImpl: Started Jetty server.
2019-10-23 17:43:10,168 INFO ParcelUpdateService:com.turn.ttorrent.common.Torrent:   ... 10% complete
2019-10-23 17:43:10,995 INFO ParcelUpdateService:com.turn.ttorrent.common.Torrent:   ... 20% complete
2019-10-23 17:43:11,777 INFO ParcelUpdateService:com.turn.ttorrent.common.Torrent:   ... 30% complete
2019-10-23 17:43:12,548 INFO ParcelUpdateService:com.turn.ttorrent.common.Torrent:   ... 40% complete
2019-10-23 17:43:13,314 INFO ParcelUpdateService:com.turn.ttorrent.common.Torrent:   ... 50% complete
2019-10-23 17:43:14,070 INFO ParcelUpdateService:com.turn.ttorrent.common.Torrent:   ... 60% complete
2019-10-23 17:43:14,846 INFO ParcelUpdateService:com.turn.ttorrent.common.Torrent:   ... 70% complete
2019-10-23 17:43:15,628 INFO ParcelUpdateService:com.turn.ttorrent.common.Torrent:   ... 80% complete
2019-10-23 17:43:16,408 INFO ParcelUpdateService:com.turn.ttorrent.common.Torrent:   ... 90% complete
2019-10-23 17:43:17,201 INFO ParcelUpdateService:com.turn.ttorrent.common.Torrent: Hashed 1 file(s) (2127506677 bytes) in 4058 pieces (4058 expected) in 9791.8ms.
2019-10-23 17:43:17,227 INFO ParcelUpdateService:com.turn.ttorrent.common.Torrent: Single-file torrent information:
2019-10-23 17:43:17,227 INFO ParcelUpdateService:com.turn.ttorrent.common.Torrent:   Torrent name: CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel
2019-10-23 17:43:17,227 INFO ParcelUpdateService:com.turn.ttorrent.common.Torrent:   Announced at: Seems to be trackerless
2019-10-23 17:43:17,227 INFO ParcelUpdateService:com.turn.ttorrent.common.Torrent:   Created on..: Wed Oct 23 17:43:07 CST 2019
2019-10-23 17:43:17,227 INFO ParcelUpdateService:com.turn.ttorrent.common.Torrent:   Created by..: cm-server
2019-10-23 17:43:17,227 INFO ParcelUpdateService:com.turn.ttorrent.common.Torrent:   Pieces......: 4058 piece(s) (524288 byte(s)/piece)
2019-10-23 17:43:17,228 INFO ParcelUpdateService:com.turn.ttorrent.common.Torrent:   Total size..: 2,127,506,677 byte(s)</code></pre> 
<p>然后所有的节点启动agent：<br> /opt/cloudera-manager/cm-5.16.1/etc/init.d/cloudera-scm-agent start</p> 
<p>4.2.阿里里云web界面，设置该hadoop001节点防火墙放开7180端口<br><img alt="" class="has" height="463" src="https://images2.imgbox.com/9a/08/NKgANxJR_o.png" width="663"><br> 4.3.等待1min，打开 http://hadoop001:7180 账号密码:admin/admin<br> 4.4.假如打不不开，去看server的log，根据错误仔细排查错误，日志目录如下<br> [root@hadoop001 cloudera-scm-server]# pwd<br> /opt/cloudera-manager/cm-5.16.1/log/cloudera-scm-server<br> 5.所有节点启动Agent（包括hadoop001主节点）<br> /opt/cloudera-manager/cm-5.16.1/etc/init.d/cloudera-scm-agent start<br> 6.接下来，全部Web界⾯面操作<br> http://ip:7180/<br> 账号密码:admin/admin<br> 7 欢迎使用Cloudera Manager--最终用户许可条款与条件。勾选<br><img alt="" class="has" height="419" src="https://images2.imgbox.com/7f/09/OuFUHlxT_o.png" width="572"><br> 8.欢迎使用Cloudera Manager--您想要部署哪个版本？选择Cloudera Express免费版本<br><img alt="" class="has" height="481" src="https://images2.imgbox.com/1d/7b/NmHVrGAw_o.png" width="650"><br> 9.感谢您选择 Cloudera Manager 和 CDH。<br><img alt="" class="has" height="448" src="https://images2.imgbox.com/46/4f/j6rCuYPV_o.png" width="654"><br> 10 为 CDH 群集安装指定主机。<br><img alt="" class="has" height="517" src="https://images2.imgbox.com/f3/8c/GNU9DoEF_o.png" width="705"><br> 11 群集安装<br> 选择存储库<br><img alt="" class="has" height="493" src="https://images2.imgbox.com/d6/2d/EjoB6bfQ_o.png" width="513"><br> 12.集群安装--正在安装选定Parcel假如<br> 本地parcel离线源配置正确，则"下载"阶段瞬间完成，其余阶段视节点数与内部网络情况决定。<br> 如果页面加载很慢，去/opt/cloudera/parcel-repo查看，如下</p> 
<pre class="has"><code>[root@hadoop001 parcel-repo]# ll
total 2077800
-rw-r--r-- 1 cloudera-scm cloudera-scm 2127506677 Nov  2 22:16 CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel
-rw-r--r-- 1 cloudera-scm cloudera-scm         41 Nov  2 21:24 CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel.sha
-rw-r----- 1 root         root              181326 Nov  2 22:56 CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel.part
-rw-r----- 1 root         root              81326 Nov  2 22:56 CDH-5.16.1-1.cdh5.16.1.p0.3-el7.parcel.torrent
-rw-r--r-- 1 cloudera-scm cloudera-scm      66538 Nov  2 21:16 manifest.json
[root@hadoop001 parcel-repo]# 
</code></pre> 
<p>那么就要卸载CDH，重新安装（不用卸载mysql）<a href="https://blog.csdn.net/muyingmiao/article/details/102741735">https://blog.csdn.net/muyingmiao/article/details/102741735</a><br><br><img alt="" class="has" height="243" src="https://images2.imgbox.com/7c/38/FipW6lbq_o.png" width="980"><br><br><img alt="" class="has" height="325" src="https://images2.imgbox.com/fd/00/V3FXOUj7_o.png" width="1031"><br> 13.检查主机正确性<br><img alt="" class="has" height="274" src="https://images2.imgbox.com/8a/75/fiu0LIXO_o.png" width="1200"><br><img alt="" class="has" height="1200" src="https://images2.imgbox.com/0a/c6/5YH5klX2_o.png" width="1041"><br><br> 处理大页面的问题：<br> Transparent Huge Page Compaction is enabled and can cause significant performance problems. Run "echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag" and "echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled" to disable this, and then add the same command to an init script such as /etc/rc.local so it will be set on system reboot.<br> 三个节点一起做：</p> 
<pre class="has"><code>echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag
echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</code></pre> 
<p>然后在页面点【run again】，黄色警告消失。<br> 14.自定义服务，选择部署Zookeeper、HDFS、Yarn服务<br><img alt="" class="has" height="1159" src="https://images2.imgbox.com/8b/5f/8vdrKdyn_o.png" width="861"><br><strong>15 自定义⻆角色分配</strong><br><img alt="" class="has" height="508" src="https://images2.imgbox.com/17/db/OFAs3JVi_o.png" width="758"><br><strong>16 数据库设置</strong><br><img alt="" class="has" height="661" src="https://images2.imgbox.com/d0/92/ercwXFhI_o.png" width="1200"><br><img alt="" class="has" height="545" src="https://images2.imgbox.com/0b/67/28jpz85F_o.png" width="1200"><br><strong>17 审改设置，默认即可</strong><br><img alt="" class="has" height="611" src="https://images2.imgbox.com/80/d1/a0mJBG6J_o.png" width="1200"><br><strong>18 首次运行</strong><br><img alt="" class="has" height="662" src="https://images2.imgbox.com/33/58/7rwNBWff_o.png" width="1200"><br><strong>19.恭喜您!</strong><br><img alt="" class="has" height="228" src="https://images2.imgbox.com/c7/5d/FvYgUggN_o.png" width="1200"><br><strong>20主页图</strong><img alt="" class="has" height="665" src="https://images2.imgbox.com/66/78/NTzx28Wv_o.png" width="1200"></p> 
<h4>错误排查</h4> 
<p><strong>1.A package was not selected.</strong><br> 原因:<br> 测试连接时，等待时间过长，我就点了返回键重新加载，然后出现packet找不到的异常。<br> 解决:<br> 返回到选择大数据组件的页面后，重新进行操作，就可以测试成功了。<br><strong>2.无法找到主机的 NTP 服务，或该服务未响应时钟偏差请求。</strong><br><img alt="" class="has" height="154" src="https://images2.imgbox.com/fc/58/A9swlBtx_o.png" width="555"><br> 通过在服务器上使用date命令查看时间是一致的，所以点击上图的Suppress...<br><img alt="" class="has" height="271" src="https://images2.imgbox.com/44/ba/GU8BuYZZ_o.png" width="553"><br> 再次查看主页：<br><img alt="" class="has" height="392" src="https://images2.imgbox.com/29/e8/JVeWCpz1_o.png" width="559"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2ab2f92d7ead5ce5f661a3ca284a72a0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">什么是FTP</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b7745cbbbf07d78f47fd568c6a326a1d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C&#43;&#43;输入文件流ifstream用法详解[转载]</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>