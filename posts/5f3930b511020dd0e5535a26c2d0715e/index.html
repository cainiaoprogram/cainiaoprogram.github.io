<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>86：第七章：开发前台首页、作家个人展示页、粉丝等功能：7：【查看是否已关注某用户，接口】、【关注，接口】、【取关，接口】；（核心：对于一些热点的、需要频繁&#43;-的数据，也可以存在Redis中；） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="86：第七章：开发前台首页、作家个人展示页、粉丝等功能：7：【查看是否已关注某用户，接口】、【关注，接口】、【取关，接口】；（核心：对于一些热点的、需要频繁&#43;-的数据，也可以存在Redis中；）" />
<meta property="og:description" content="说明：
（1）本篇博客开发的内容：【查看是否已关注某用户，接口】、【关注，接口】、【取关，接口】；
（2）本篇博客就一个点：对于那些需要频繁写的小数据，也可以存到Redis中，直接在Redis中增改；
目录
一：粉丝功能，技术选择：利用Redis的&#34;累加&#34;、&#34;累减&#34;来统计用户的关注数和粉丝数；（从而消除使用聚合函数操作数据，给数据库带来的压力）
二：开发【假如当前登录用户是A，当A查看B的主页时，查询A是否已经关注B，接口】；
1.该部分，内容说明；
2.开发【查询当前登录用户，是否已经关注当前查看页面的作家，接口】；
（1）在【api】接口工程中，创建MyFansControllerApi接口，并定义【查询当前登录用户，是否已经关注当前查看页面的作家，接口】；
（2）在【user】用户服务中，创建MyFansController类，去实现【查询当前登录用户，是否已经关注当前查看页面的作家，接口】；
（3）在【user】用户服务中，创建MyFansService接口，定义一个查询当前登录用户是否关注的方法；然后，创建MyFansServiceImpl实现类，去实现这个方法；
3.效果；
三：开发【A用户关注B用户，A的关注数&#43;1，B的粉丝数&#43;1，接口】；
1.在【api】接口工程的MyFansControllerApi接口，定义【A用户关注B用户，A的关注数&#43;1，B的粉丝数&#43;1，接口】； 2.在【user】用户服务的MyFansController类中，去实现【A用户关注B用户，A的关注数数&#43;1，B的粉丝数&#43;1，接口】；
3.在【user】用户服务的MyFansService接口，定义一个方法；然后，在MyFansServiceImpl实现类，去实现这个方法；
4.效果；
四：开发【A用户取关B用户，A的关注数-1，B的粉丝数-1，接口】； 1.在【api】接口工程的MyFansControllerApi接口，定义【A用户取关B用户，A的关注数-1，B的粉丝数-1，接口】； 2.在【user】用户服务的MyFansController类中，去实现【A用户取关B用户，A的关注数-1，B的粉丝数-1，接口】；
3.在【user】用户服务的MyFansService接口，定义一个方法；然后，在MyFansServiceImpl实现类，去实现这个方法；
4.效果；
附加：【关注，接口】和【取关，接口】都需要，“用户登录、并且用户是激活状态”才能操作；所以，在【api】接口工程的InterceptorConfig类中，对其进行配置；
一：粉丝功能，技术选择：利用Redis的&#34;累加&#34;、&#34;累减&#34;来统计用户的关注数和粉丝数；（从而消除使用聚合函数操作数据，给数据库带来的压力） 已知，在MariaDB中有一个fans表；
（1）统计某个用户的关注数和粉丝数，直接的想法是count()的方式去查询fans表；
（2）但是，由于前台门户端的并发量将会很高；也将会有很多人查看别人的个人展示页；那么，就会频繁的count()查询fans表；
（3）而这是不好的（尤其是数据量很大的时候），数据库的压力会很大；（在【附加：数据的聚合函数，会给数据库造成很大压力；】中，对此进行了介绍）
（4）所以，针对这个具体的业务而言，我们会利用Redis来优化，减轻数据库压力；
（1）对于Redis来说，前面我们使用Redis存放过热点数据；即，都是redis这款nosql数据库，作为缓存来使用；
（2）但是，Redis本身就是一款nosql；我们，自然可以把其当成数据库来使用；
（3）某个用户的【关注数】、【粉丝数】的累加和类减，可以通过Redis来实现；（Redis具体处理任务的时候，是单线程的，所以其实安全的）
（4）Redis中，底层有INCR（对某个值加1）和DECR（对某个值减1）两个命令；
● 比如用户1001，可以在Redis中创建一个【1001:fans，fansNum】数据，记录用户的粉丝数；
● 如果有人关注了1001，那么这个值就加1；
● 如果有人取关了1001，那么这个值就减1；
● 用户的关注数，同理；
二：开发【假如当前登录用户是A，当A查看B的主页时，查询A是否已经关注B，接口】； 1.该部分，内容说明； 而【我是慕课网】是否关注【慕小健】，是需要去数据库表中查询的；
2.开发【查询当前登录用户，是否已经关注当前查看页面的作家，接口】； （1）在【api】接口工程中，创建MyFansControllerApi接口，并定义【查询当前登录用户，是否已经关注当前查看页面的作家，接口】； package com.imooc.api.controller.user; import io.swagger.annotations.Api; import io.swagger.annotations.ApiOperation; import org.springframework.web.bind.annotation.GetMapping; import org.springframework.web.bind.annotation.PostMapping; import org.springframework.web.bind.annotation.RequestMapping; import org.springframework.web.bind.annotation.RequestParam; @Api(value = &#34;粉丝管理&#34;,tags = {&#34;粉丝管理功能的controller&#34;}) @RequestMapping(&#34;fans&#34;) //设置路由，这个是需要前后端约定好的； public interface MyFansControllerApi { /** * 假如当前登录用户是A，当A查看B的主页时，查询A是否已经关注B； * @param writerId * @param fanId * @return */ @ApiOperation(value = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/5f3930b511020dd0e5535a26c2d0715e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-15T11:14:17+08:00" />
<meta property="article:modified_time" content="2022-09-15T11:14:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">86：第七章：开发前台首页、作家个人展示页、粉丝等功能：7：【查看是否已关注某用户，接口】、【关注，接口】、【取关，接口】；（核心：对于一些热点的、需要频繁&#43;-的数据，也可以存在Redis中；）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p><strong>说明：</strong></p> 
 <p><strong>（1）</strong>本篇博客开发的内容：【查看是否已关注某用户，接口】、【关注，接口】、【取关，接口】；</p> 
 <p><span style="color:#fe2c24;"><strong><span style="background-color:#c7e6ea;">（2）本篇博客就一个点：对于那些需要频繁写的小数据，也可以存到Redis中，直接在Redis中增改；</span></strong></span></p> 
</blockquote> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80%EF%BC%9A%E7%B2%89%E4%B8%9D%E5%8A%9F%E8%83%BD%EF%BC%8C%E6%8A%80%E6%9C%AF%E9%80%89%E6%8B%A9%EF%BC%9A%E5%88%A9%E7%94%A8Redis%E7%9A%84%22%E7%B4%AF%E5%8A%A0%22%E3%80%81%22%E7%B4%AF%E5%87%8F%22%E6%9D%A5%E7%BB%9F%E8%AE%A1%E7%94%A8%E6%88%B7%E7%9A%84%E5%85%B3%E6%B3%A8%E6%95%B0%E5%92%8C%E7%B2%89%E4%B8%9D%E6%95%B0%EF%BC%9B%EF%BC%88%E4%BB%8E%E8%80%8C%E6%B6%88%E9%99%A4%E4%BD%BF%E7%94%A8%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%EF%BC%8C%E7%BB%99%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%A6%E6%9D%A5%E7%9A%84%E5%8E%8B%E5%8A%9B%EF%BC%89-toc" style="margin-left:0px;"><a href="#%E4%B8%80%EF%BC%9A%E7%B2%89%E4%B8%9D%E5%8A%9F%E8%83%BD%EF%BC%8C%E6%8A%80%E6%9C%AF%E9%80%89%E6%8B%A9%EF%BC%9A%E5%88%A9%E7%94%A8Redis%E7%9A%84%22%E7%B4%AF%E5%8A%A0%22%E3%80%81%22%E7%B4%AF%E5%87%8F%22%E6%9D%A5%E7%BB%9F%E8%AE%A1%E7%94%A8%E6%88%B7%E7%9A%84%E5%85%B3%E6%B3%A8%E6%95%B0%E5%92%8C%E7%B2%89%E4%B8%9D%E6%95%B0%EF%BC%9B%EF%BC%88%E4%BB%8E%E8%80%8C%E6%B6%88%E9%99%A4%E4%BD%BF%E7%94%A8%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%EF%BC%8C%E7%BB%99%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%A6%E6%9D%A5%E7%9A%84%E5%8E%8B%E5%8A%9B%EF%BC%89" rel="nofollow">一：粉丝功能，技术选择：利用Redis的"累加"、"累减"来统计用户的关注数和粉丝数；（从而消除使用聚合函数操作数据，给数据库带来的压力）</a></p> 
<p id="%E4%BA%8C%EF%BC%9A%E5%BC%80%E5%8F%91%E3%80%90%E5%81%87%E5%A6%82%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%E6%98%AFA%EF%BC%8C%E5%BD%93A%E6%9F%A5%E7%9C%8BB%E7%9A%84%E4%B8%BB%E9%A1%B5%E6%97%B6%EF%BC%8C%E6%9F%A5%E8%AF%A2A%E6%98%AF%E5%90%A6%E5%B7%B2%E7%BB%8F%E5%85%B3%E6%B3%A8B%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%EF%BC%9A%E5%BC%80%E5%8F%91%E3%80%90%E5%81%87%E5%A6%82%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%E6%98%AFA%EF%BC%8C%E5%BD%93A%E6%9F%A5%E7%9C%8BB%E7%9A%84%E4%B8%BB%E9%A1%B5%E6%97%B6%EF%BC%8C%E6%9F%A5%E8%AF%A2A%E6%98%AF%E5%90%A6%E5%B7%B2%E7%BB%8F%E5%85%B3%E6%B3%A8B%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B" rel="nofollow">二：开发【假如当前登录用户是A，当A查看B的主页时，查询A是否已经关注B，接口】；</a></p> 
<p id="1.%E8%AF%A5%E9%83%A8%E5%88%86%EF%BC%8C%E5%86%85%E5%AE%B9%E8%AF%B4%E6%98%8E%EF%BC%9B-toc" style="margin-left:40px;"><a href="#1.%E8%AF%A5%E9%83%A8%E5%88%86%EF%BC%8C%E5%86%85%E5%AE%B9%E8%AF%B4%E6%98%8E%EF%BC%9B" rel="nofollow">1.该部分，内容说明；</a></p> 
<p id="2.%E5%BC%80%E5%8F%91%E3%80%90%E6%9F%A5%E8%AF%A2%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%EF%BC%8C%E6%98%AF%E5%90%A6%E5%B7%B2%E7%BB%8F%E5%85%B3%E6%B3%A8%E5%BD%93%E5%89%8D%E6%9F%A5%E7%9C%8B%E9%A1%B5%E9%9D%A2%E7%9A%84%E4%BD%9C%E5%AE%B6%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B-toc" style="margin-left:40px;"><a href="#2.%E5%BC%80%E5%8F%91%E3%80%90%E6%9F%A5%E8%AF%A2%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%EF%BC%8C%E6%98%AF%E5%90%A6%E5%B7%B2%E7%BB%8F%E5%85%B3%E6%B3%A8%E5%BD%93%E5%89%8D%E6%9F%A5%E7%9C%8B%E9%A1%B5%E9%9D%A2%E7%9A%84%E4%BD%9C%E5%AE%B6%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B" rel="nofollow">2.开发【查询当前登录用户，是否已经关注当前查看页面的作家，接口】；</a></p> 
<p id="%EF%BC%881%EF%BC%89%E5%9C%A8%E3%80%90api%E3%80%91%E6%8E%A5%E5%8F%A3%E5%B7%A5%E7%A8%8B%E4%B8%AD%EF%BC%8C%E5%88%9B%E5%BB%BAMyFansControllerApi%E6%8E%A5%E5%8F%A3%EF%BC%8C%E5%B9%B6%E5%AE%9A%E4%B9%89%E3%80%90%E6%9F%A5%E8%AF%A2%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%EF%BC%8C%E6%98%AF%E5%90%A6%E5%B7%B2%E7%BB%8F%E5%85%B3%E6%B3%A8%E5%BD%93%E5%89%8D%E6%9F%A5%E7%9C%8B%E9%A1%B5%E9%9D%A2%E7%9A%84%E4%BD%9C%E5%AE%B6%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B-toc" style="margin-left:80px;"><a href="#%EF%BC%881%EF%BC%89%E5%9C%A8%E3%80%90api%E3%80%91%E6%8E%A5%E5%8F%A3%E5%B7%A5%E7%A8%8B%E4%B8%AD%EF%BC%8C%E5%88%9B%E5%BB%BAMyFansControllerApi%E6%8E%A5%E5%8F%A3%EF%BC%8C%E5%B9%B6%E5%AE%9A%E4%B9%89%E3%80%90%E6%9F%A5%E8%AF%A2%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%EF%BC%8C%E6%98%AF%E5%90%A6%E5%B7%B2%E7%BB%8F%E5%85%B3%E6%B3%A8%E5%BD%93%E5%89%8D%E6%9F%A5%E7%9C%8B%E9%A1%B5%E9%9D%A2%E7%9A%84%E4%BD%9C%E5%AE%B6%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B" rel="nofollow">（1）在【api】接口工程中，创建MyFansControllerApi接口，并定义【查询当前登录用户，是否已经关注当前查看页面的作家，接口】；</a></p> 
<p id="%EF%BC%882%EF%BC%89%E5%9C%A8%E3%80%90user%E3%80%91%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E4%B8%AD%EF%BC%8C%E5%88%9B%E5%BB%BAMyFansController%E7%B1%BB%EF%BC%8C%E5%8E%BB%E5%AE%9E%E7%8E%B0%E3%80%90%E6%9F%A5%E8%AF%A2%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%EF%BC%8C%E6%98%AF%E5%90%A6%E5%B7%B2%E7%BB%8F%E5%85%B3%E6%B3%A8%E5%BD%93%E5%89%8D%E6%9F%A5%E7%9C%8B%E9%A1%B5%E9%9D%A2%E7%9A%84%E4%BD%9C%E5%AE%B6%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B-toc" style="margin-left:80px;"><a href="#%EF%BC%882%EF%BC%89%E5%9C%A8%E3%80%90user%E3%80%91%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E4%B8%AD%EF%BC%8C%E5%88%9B%E5%BB%BAMyFansController%E7%B1%BB%EF%BC%8C%E5%8E%BB%E5%AE%9E%E7%8E%B0%E3%80%90%E6%9F%A5%E8%AF%A2%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%EF%BC%8C%E6%98%AF%E5%90%A6%E5%B7%B2%E7%BB%8F%E5%85%B3%E6%B3%A8%E5%BD%93%E5%89%8D%E6%9F%A5%E7%9C%8B%E9%A1%B5%E9%9D%A2%E7%9A%84%E4%BD%9C%E5%AE%B6%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B" rel="nofollow">（2）在【user】用户服务中，创建MyFansController类，去实现【查询当前登录用户，是否已经关注当前查看页面的作家，接口】；</a></p> 
<p id="%EF%BC%883%EF%BC%89%E5%9C%A8%E3%80%90user%E3%80%91%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E4%B8%AD%EF%BC%8C%E5%88%9B%E5%BB%BAMyFansService%E6%8E%A5%E5%8F%A3%EF%BC%8C%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E6%9F%A5%E8%AF%A2%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%E6%98%AF%E5%90%A6%E5%85%B3%E6%B3%A8%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%9B%E7%84%B6%E5%90%8E%EF%BC%8C%E5%88%9B%E5%BB%BAMyFansServiceImpl%E5%AE%9E%E7%8E%B0%E7%B1%BB%EF%BC%8C%E5%8E%BB%E5%AE%9E%E7%8E%B0%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%EF%BC%9B-toc" style="margin-left:80px;"><a href="#%EF%BC%883%EF%BC%89%E5%9C%A8%E3%80%90user%E3%80%91%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E4%B8%AD%EF%BC%8C%E5%88%9B%E5%BB%BAMyFansService%E6%8E%A5%E5%8F%A3%EF%BC%8C%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E6%9F%A5%E8%AF%A2%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%E6%98%AF%E5%90%A6%E5%85%B3%E6%B3%A8%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%9B%E7%84%B6%E5%90%8E%EF%BC%8C%E5%88%9B%E5%BB%BAMyFansServiceImpl%E5%AE%9E%E7%8E%B0%E7%B1%BB%EF%BC%8C%E5%8E%BB%E5%AE%9E%E7%8E%B0%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%EF%BC%9B" rel="nofollow">（3）在【user】用户服务中，创建MyFansService接口，定义一个查询当前登录用户是否关注的方法；然后，创建MyFansServiceImpl实现类，去实现这个方法；</a></p> 
<p id="3.%E6%95%88%E6%9E%9C%EF%BC%9B-toc" style="margin-left:40px;"><a href="#3.%E6%95%88%E6%9E%9C%EF%BC%9B" rel="nofollow">3.效果；</a></p> 
<p id="%E4%B8%89%EF%BC%9A%E5%BC%80%E5%8F%91%E3%80%90A%E7%94%A8%E6%88%B7%E5%85%B3%E6%B3%A8B%E7%94%A8%E6%88%B7%EF%BC%8CA%E7%9A%84%E5%85%B3%E6%B3%A8%E6%95%B0%2B1%EF%BC%8CB%E7%9A%84%E7%B2%89%E4%B8%9D%E6%95%B0%2B1%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B-toc" style="margin-left:0px;"><a href="#%E4%B8%89%EF%BC%9A%E5%BC%80%E5%8F%91%E3%80%90A%E7%94%A8%E6%88%B7%E5%85%B3%E6%B3%A8B%E7%94%A8%E6%88%B7%EF%BC%8CA%E7%9A%84%E5%85%B3%E6%B3%A8%E6%95%B0%2B1%EF%BC%8CB%E7%9A%84%E7%B2%89%E4%B8%9D%E6%95%B0%2B1%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B" rel="nofollow">三：开发【A用户关注B用户，A的关注数+1，B的粉丝数+1，接口】；</a></p> 
<p id="1.%E5%9C%A8%E3%80%90api%E3%80%91%E6%8E%A5%E5%8F%A3%E5%B7%A5%E7%A8%8B%E7%9A%84MyFansControllerApi%E6%8E%A5%E5%8F%A3%EF%BC%8C%E5%AE%9A%E4%B9%89%E3%80%90A%E7%94%A8%E6%88%B7%E5%85%B3%E6%B3%A8B%E7%94%A8%E6%88%B7%EF%BC%8CA%E7%9A%84%E5%85%B3%E6%B3%A8%E6%95%B0%2B1%EF%BC%8CB%E7%9A%84%E7%B2%89%E4%B8%9D%E6%95%B0%2B1%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B%C2%A0-toc" style="margin-left:40px;"><a href="#1.%E5%9C%A8%E3%80%90api%E3%80%91%E6%8E%A5%E5%8F%A3%E5%B7%A5%E7%A8%8B%E7%9A%84MyFansControllerApi%E6%8E%A5%E5%8F%A3%EF%BC%8C%E5%AE%9A%E4%B9%89%E3%80%90A%E7%94%A8%E6%88%B7%E5%85%B3%E6%B3%A8B%E7%94%A8%E6%88%B7%EF%BC%8CA%E7%9A%84%E5%85%B3%E6%B3%A8%E6%95%B0%2B1%EF%BC%8CB%E7%9A%84%E7%B2%89%E4%B8%9D%E6%95%B0%2B1%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B%C2%A0" rel="nofollow">1.在【api】接口工程的MyFansControllerApi接口，定义【A用户关注B用户，A的关注数+1，B的粉丝数+1，接口】； </a></p> 
<p id="2.%E5%9C%A8%E3%80%90user%E3%80%91%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E7%9A%84MyFansController%E7%B1%BB%E4%B8%AD%EF%BC%8C%E5%8E%BB%E5%AE%9E%E7%8E%B0%E3%80%90A%E7%94%A8%E6%88%B7%E5%85%B3%E6%B3%A8B%E7%94%A8%E6%88%B7%EF%BC%8CA%E7%9A%84%E5%85%B3%E6%B3%A8%E6%95%B0%E6%95%B0%2B1%EF%BC%8CB%E7%9A%84%E7%B2%89%E4%B8%9D%E6%95%B0%2B1%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B-toc" style="margin-left:40px;"><a href="#2.%E5%9C%A8%E3%80%90user%E3%80%91%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E7%9A%84MyFansController%E7%B1%BB%E4%B8%AD%EF%BC%8C%E5%8E%BB%E5%AE%9E%E7%8E%B0%E3%80%90A%E7%94%A8%E6%88%B7%E5%85%B3%E6%B3%A8B%E7%94%A8%E6%88%B7%EF%BC%8CA%E7%9A%84%E5%85%B3%E6%B3%A8%E6%95%B0%E6%95%B0%2B1%EF%BC%8CB%E7%9A%84%E7%B2%89%E4%B8%9D%E6%95%B0%2B1%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B" rel="nofollow">2.在【user】用户服务的MyFansController类中，去实现【A用户关注B用户，A的关注数数+1，B的粉丝数+1，接口】；</a></p> 
<p id="3.%E5%9C%A8%E3%80%90user%E3%80%91%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E7%9A%84MyFansService%E6%8E%A5%E5%8F%A3%EF%BC%8C%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E6%96%B9%E6%B3%95%EF%BC%9B%E7%84%B6%E5%90%8E%EF%BC%8C%E5%9C%A8MyFansServiceImpl%E5%AE%9E%E7%8E%B0%E7%B1%BB%EF%BC%8C%E5%8E%BB%E5%AE%9E%E7%8E%B0%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%EF%BC%9B-toc" style="margin-left:40px;"><a href="#3.%E5%9C%A8%E3%80%90user%E3%80%91%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E7%9A%84MyFansService%E6%8E%A5%E5%8F%A3%EF%BC%8C%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E6%96%B9%E6%B3%95%EF%BC%9B%E7%84%B6%E5%90%8E%EF%BC%8C%E5%9C%A8MyFansServiceImpl%E5%AE%9E%E7%8E%B0%E7%B1%BB%EF%BC%8C%E5%8E%BB%E5%AE%9E%E7%8E%B0%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%EF%BC%9B" rel="nofollow">3.在【user】用户服务的MyFansService接口，定义一个方法；然后，在MyFansServiceImpl实现类，去实现这个方法；</a></p> 
<p id="4.%E6%95%88%E6%9E%9C%EF%BC%9B-toc" style="margin-left:40px;"><a href="#4.%E6%95%88%E6%9E%9C%EF%BC%9B" rel="nofollow">4.效果；</a></p> 
<p id="%E5%9B%9B%EF%BC%9A%E5%BC%80%E5%8F%91%E3%80%90A%E7%94%A8%E6%88%B7%E5%8F%96%E5%85%B3B%E7%94%A8%E6%88%B7%EF%BC%8CA%E7%9A%84%E5%85%B3%E6%B3%A8%E6%95%B0-1%EF%BC%8CB%E7%9A%84%E7%B2%89%E4%B8%9D%E6%95%B0-1%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B%C2%A0-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%EF%BC%9A%E5%BC%80%E5%8F%91%E3%80%90A%E7%94%A8%E6%88%B7%E5%8F%96%E5%85%B3B%E7%94%A8%E6%88%B7%EF%BC%8CA%E7%9A%84%E5%85%B3%E6%B3%A8%E6%95%B0-1%EF%BC%8CB%E7%9A%84%E7%B2%89%E4%B8%9D%E6%95%B0-1%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B%C2%A0" rel="nofollow">四：开发【A用户取关B用户，A的关注数-1，B的粉丝数-1，接口】； </a></p> 
<p id="%C2%A01.%E5%9C%A8%E3%80%90api%E3%80%91%E6%8E%A5%E5%8F%A3%E5%B7%A5%E7%A8%8B%E7%9A%84MyFansControllerApi%E6%8E%A5%E5%8F%A3%EF%BC%8C%E5%AE%9A%E4%B9%89%E3%80%90A%E7%94%A8%E6%88%B7%E5%8F%96%E5%85%B3B%E7%94%A8%E6%88%B7%EF%BC%8CA%E7%9A%84%E5%85%B3%E6%B3%A8%E6%95%B0-1%EF%BC%8CB%E7%9A%84%E7%B2%89%E4%B8%9D%E6%95%B0-1%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B%C2%A0-toc" style="margin-left:40px;"><a href="#%C2%A01.%E5%9C%A8%E3%80%90api%E3%80%91%E6%8E%A5%E5%8F%A3%E5%B7%A5%E7%A8%8B%E7%9A%84MyFansControllerApi%E6%8E%A5%E5%8F%A3%EF%BC%8C%E5%AE%9A%E4%B9%89%E3%80%90A%E7%94%A8%E6%88%B7%E5%8F%96%E5%85%B3B%E7%94%A8%E6%88%B7%EF%BC%8CA%E7%9A%84%E5%85%B3%E6%B3%A8%E6%95%B0-1%EF%BC%8CB%E7%9A%84%E7%B2%89%E4%B8%9D%E6%95%B0-1%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B%C2%A0" rel="nofollow"> 1.在【api】接口工程的MyFansControllerApi接口，定义【A用户取关B用户，A的关注数-1，B的粉丝数-1，接口】； </a></p> 
<p id="2.%E5%9C%A8%E3%80%90user%E3%80%91%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E7%9A%84MyFansController%E7%B1%BB%E4%B8%AD%EF%BC%8C%E5%8E%BB%E5%AE%9E%E7%8E%B0%E3%80%90A%E7%94%A8%E6%88%B7%E5%8F%96%E5%85%B3B%E7%94%A8%E6%88%B7%EF%BC%8CA%E7%9A%84%E5%85%B3%E6%B3%A8%E6%95%B0-1%EF%BC%8CB%E7%9A%84%E7%B2%89%E4%B8%9D%E6%95%B0-1%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B-toc" style="margin-left:40px;"><a href="#2.%E5%9C%A8%E3%80%90user%E3%80%91%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E7%9A%84MyFansController%E7%B1%BB%E4%B8%AD%EF%BC%8C%E5%8E%BB%E5%AE%9E%E7%8E%B0%E3%80%90A%E7%94%A8%E6%88%B7%E5%8F%96%E5%85%B3B%E7%94%A8%E6%88%B7%EF%BC%8CA%E7%9A%84%E5%85%B3%E6%B3%A8%E6%95%B0-1%EF%BC%8CB%E7%9A%84%E7%B2%89%E4%B8%9D%E6%95%B0-1%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B" rel="nofollow">2.在【user】用户服务的MyFansController类中，去实现【A用户取关B用户，A的关注数-1，B的粉丝数-1，接口】；</a></p> 
<p id="3.%E5%9C%A8%E3%80%90user%E3%80%91%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E7%9A%84MyFansService%E6%8E%A5%E5%8F%A3%EF%BC%8C%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E6%96%B9%E6%B3%95%EF%BC%9B%E7%84%B6%E5%90%8E%EF%BC%8C%E5%9C%A8MyFansServiceImpl%E5%AE%9E%E7%8E%B0%E7%B1%BB%EF%BC%8C%E5%8E%BB%E5%AE%9E%E7%8E%B0%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%EF%BC%9B-toc" style="margin-left:40px;"><a href="#3.%E5%9C%A8%E3%80%90user%E3%80%91%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E7%9A%84MyFansService%E6%8E%A5%E5%8F%A3%EF%BC%8C%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E6%96%B9%E6%B3%95%EF%BC%9B%E7%84%B6%E5%90%8E%EF%BC%8C%E5%9C%A8MyFansServiceImpl%E5%AE%9E%E7%8E%B0%E7%B1%BB%EF%BC%8C%E5%8E%BB%E5%AE%9E%E7%8E%B0%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%EF%BC%9B" rel="nofollow">3.在【user】用户服务的MyFansService接口，定义一个方法；然后，在MyFansServiceImpl实现类，去实现这个方法；</a></p> 
<p id="4.%E6%95%88%E6%9E%9C%EF%BC%9B-toc" style="margin-left:40px;"><a href="#4.%E6%95%88%E6%9E%9C%EF%BC%9B" rel="nofollow">4.效果；</a></p> 
<p id="%E9%99%84%E5%8A%A0%EF%BC%9A%E3%80%90%E5%85%B3%E6%B3%A8%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%E5%92%8C%E3%80%90%E5%8F%96%E5%85%B3%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%E9%83%BD%E9%9C%80%E8%A6%81%EF%BC%8C%E2%80%9C%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E3%80%81%E5%B9%B6%E4%B8%94%E7%94%A8%E6%88%B7%E6%98%AF%E6%BF%80%E6%B4%BB%E7%8A%B6%E6%80%81%E2%80%9D%E6%89%8D%E8%83%BD%E6%93%8D%E4%BD%9C%EF%BC%9B%E6%89%80%E4%BB%A5%EF%BC%8C%E5%9C%A8%E3%80%90api%E3%80%91%E6%8E%A5%E5%8F%A3%E5%B7%A5%E7%A8%8B%E7%9A%84InterceptorConfig%E7%B1%BB%E4%B8%AD%EF%BC%8C%E5%AF%B9%E5%85%B6%E8%BF%9B%E8%A1%8C%E9%85%8D%E7%BD%AE%EF%BC%9B-toc" style="margin-left:0px;"><a href="#%E9%99%84%E5%8A%A0%EF%BC%9A%E3%80%90%E5%85%B3%E6%B3%A8%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%E5%92%8C%E3%80%90%E5%8F%96%E5%85%B3%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%E9%83%BD%E9%9C%80%E8%A6%81%EF%BC%8C%E2%80%9C%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E3%80%81%E5%B9%B6%E4%B8%94%E7%94%A8%E6%88%B7%E6%98%AF%E6%BF%80%E6%B4%BB%E7%8A%B6%E6%80%81%E2%80%9D%E6%89%8D%E8%83%BD%E6%93%8D%E4%BD%9C%EF%BC%9B%E6%89%80%E4%BB%A5%EF%BC%8C%E5%9C%A8%E3%80%90api%E3%80%91%E6%8E%A5%E5%8F%A3%E5%B7%A5%E7%A8%8B%E7%9A%84InterceptorConfig%E7%B1%BB%E4%B8%AD%EF%BC%8C%E5%AF%B9%E5%85%B6%E8%BF%9B%E8%A1%8C%E9%85%8D%E7%BD%AE%EF%BC%9B" rel="nofollow">附加：【关注，接口】和【取关，接口】都需要，“用户登录、并且用户是激活状态”才能操作；所以，在【api】接口工程的InterceptorConfig类中，对其进行配置；</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E4%B8%80%EF%BC%9A%E7%B2%89%E4%B8%9D%E5%8A%9F%E8%83%BD%EF%BC%8C%E6%8A%80%E6%9C%AF%E9%80%89%E6%8B%A9%EF%BC%9A%E5%88%A9%E7%94%A8Redis%E7%9A%84%22%E7%B4%AF%E5%8A%A0%22%E3%80%81%22%E7%B4%AF%E5%87%8F%22%E6%9D%A5%E7%BB%9F%E8%AE%A1%E7%94%A8%E6%88%B7%E7%9A%84%E5%85%B3%E6%B3%A8%E6%95%B0%E5%92%8C%E7%B2%89%E4%B8%9D%E6%95%B0%EF%BC%9B%EF%BC%88%E4%BB%8E%E8%80%8C%E6%B6%88%E9%99%A4%E4%BD%BF%E7%94%A8%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%EF%BC%8C%E7%BB%99%E6%95%B0%E6%8D%AE%E5%BA%93%E5%B8%A6%E6%9D%A5%E7%9A%84%E5%8E%8B%E5%8A%9B%EF%BC%89">一：粉丝功能，技术选择：利用Redis的"累加"、"累减"来统计用户的关注数和粉丝数；（从而消除使用聚合函数操作数据，给数据库带来的压力）</h2> 
<blockquote> 
 <p><img alt="" height="393" src="https://images2.imgbox.com/02/5a/q0Qg4opx_o.png" width="978"></p> 
</blockquote> 
<blockquote> 
 <p>已知，在MariaDB中有一个fans表；</p> 
 <p><strong><img alt="" height="311" src="https://images2.imgbox.com/88/de/BJ7txft5_o.png" width="861"></strong></p> 
 <p><strong>（1）</strong>统计某个用户的关注数和粉丝数，直接的想法是count()的方式去查询fans表；</p> 
 <p><strong>（2）</strong>但是，由于前台门户端的并发量将会很高；也将会有很多人查看别人的个人展示页；那么，就会频繁的count()查询fans表；</p> 
 <p><strong>（3）</strong>而这是不好的（尤其是数据量很大的时候），数据库的压力会很大；（在【<a href="https://wgy-coder.blog.csdn.net/article/details/126400374" rel="nofollow" title="附加：数据的聚合函数，会给数据库造成很大压力；">附加：数据的聚合函数，会给数据库造成很大压力；</a>】中，对此进行了介绍）</p> 
 <p><strong>（4）</strong>所以，针对这个具体的业务而言，我们会利用Redis来优化，减轻数据库压力；</p> 
</blockquote> 
<blockquote> 
 <p><strong>（1）</strong>对于Redis来说，前面我们使用Redis存放过热点数据；即，都是redis这款nosql数据库，作为缓存来使用；</p> 
 <p><strong>（2）</strong>但是，Redis本身就是一款nosql；我们，自然可以把其当成数据库来使用；</p> 
 <p><strong>（3）</strong>某个用户的【关注数】、【粉丝数】的累加和类减，可以通过Redis来实现；（Redis具体处理任务的时候，是单线程的，所以其实安全的）</p> 
 <p><strong>（4）</strong>Redis中，底层有INCR（对某个值加1）和DECR（对某个值减1）两个命令；</p> 
 <p>          ● 比如用户1001，可以在Redis中创建一个【1001:fans，fansNum】数据，记录用户的粉丝数；</p> 
 <p>          ● 如果有人关注了1001，那么这个值就加1；</p> 
 <p>          ● 如果有人取关了1001，那么这个值就减1；</p> 
 <p>          ● 用户的关注数，同理；</p> 
</blockquote> 
<hr> 
<p></p> 
<h2 id="%E4%BA%8C%EF%BC%9A%E5%BC%80%E5%8F%91%E3%80%90%E5%81%87%E5%A6%82%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%E6%98%AFA%EF%BC%8C%E5%BD%93A%E6%9F%A5%E7%9C%8BB%E7%9A%84%E4%B8%BB%E9%A1%B5%E6%97%B6%EF%BC%8C%E6%9F%A5%E8%AF%A2A%E6%98%AF%E5%90%A6%E5%B7%B2%E7%BB%8F%E5%85%B3%E6%B3%A8B%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B">二：开发【假如当前登录用户是A，当A查看B的主页时，查询A是否已经关注B，接口】；</h2> 
<h3 id="1.%E8%AF%A5%E9%83%A8%E5%88%86%EF%BC%8C%E5%86%85%E5%AE%B9%E8%AF%B4%E6%98%8E%EF%BC%9B">1.该部分，内容说明；</h3> 
<blockquote> 
 <p><img alt="" height="348" src="https://images2.imgbox.com/0e/73/bkoP9pXS_o.png" width="938"></p> 
 <p><img alt="" height="313" src="https://images2.imgbox.com/e6/00/qig7tlUc_o.png" width="920"></p> 
 <p><img alt="" height="375" src="https://images2.imgbox.com/2a/07/wylwGVUu_o.png" width="942"></p> 
</blockquote> 
<blockquote> 
 <p>而【我是慕课网】是否关注【慕小健】，是需要去数据库表中查询的；</p> 
 <p><img alt="" height="430" src="https://images2.imgbox.com/a0/e5/Cpt0FKY1_o.png" width="912"></p> 
</blockquote> 
<p></p> 
<h3 id="2.%E5%BC%80%E5%8F%91%E3%80%90%E6%9F%A5%E8%AF%A2%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%EF%BC%8C%E6%98%AF%E5%90%A6%E5%B7%B2%E7%BB%8F%E5%85%B3%E6%B3%A8%E5%BD%93%E5%89%8D%E6%9F%A5%E7%9C%8B%E9%A1%B5%E9%9D%A2%E7%9A%84%E4%BD%9C%E5%AE%B6%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B">2.开发【查询当前登录用户，是否已经关注当前查看页面的作家，接口】；</h3> 
<blockquote> 
 <h4 id="%EF%BC%881%EF%BC%89%E5%9C%A8%E3%80%90api%E3%80%91%E6%8E%A5%E5%8F%A3%E5%B7%A5%E7%A8%8B%E4%B8%AD%EF%BC%8C%E5%88%9B%E5%BB%BAMyFansControllerApi%E6%8E%A5%E5%8F%A3%EF%BC%8C%E5%B9%B6%E5%AE%9A%E4%B9%89%E3%80%90%E6%9F%A5%E8%AF%A2%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%EF%BC%8C%E6%98%AF%E5%90%A6%E5%B7%B2%E7%BB%8F%E5%85%B3%E6%B3%A8%E5%BD%93%E5%89%8D%E6%9F%A5%E7%9C%8B%E9%A1%B5%E9%9D%A2%E7%9A%84%E4%BD%9C%E5%AE%B6%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B">（1）在【api】接口工程中，创建MyFansControllerApi接口，并定义【查询当前登录用户，是否已经关注当前查看页面的作家，接口】；</h4> 
 <p><img alt="" height="373" src="https://images2.imgbox.com/be/b9/88jbSZRS_o.png" width="413"></p> 
 <pre><code class="language-java">package com.imooc.api.controller.user;


import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;


@Api(value = "粉丝管理",tags = {"粉丝管理功能的controller"})
@RequestMapping("fans")  //设置路由，这个是需要前后端约定好的；
public interface MyFansControllerApi {

    /**
     * 假如当前登录用户是A，当A查看B的主页时，查询A是否已经关注B；
     * @param writerId
     * @param fanId
     * @return
     */
    @ApiOperation(value = "查询当前登录用户，是否已经关注当前查看页面的作家", notes = "查询当前登录用户，是否已经关注当前查看页面的作家", httpMethod = "POST")
    @PostMapping("/isMeFollowThisWriter")
    public GraceJSONResult hello(@RequestParam String writerId,
                        @RequestParam String fanId);
}
</code></pre> 
 <p><strong>说明：</strong></p> 
 <p><strong>（1）</strong>这个接口的url、请求方式、参数需要前后端保持一致；</p> 
</blockquote> 
<blockquote> 
 <h4 id="%EF%BC%882%EF%BC%89%E5%9C%A8%E3%80%90user%E3%80%91%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E4%B8%AD%EF%BC%8C%E5%88%9B%E5%BB%BAMyFansController%E7%B1%BB%EF%BC%8C%E5%8E%BB%E5%AE%9E%E7%8E%B0%E3%80%90%E6%9F%A5%E8%AF%A2%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%EF%BC%8C%E6%98%AF%E5%90%A6%E5%B7%B2%E7%BB%8F%E5%85%B3%E6%B3%A8%E5%BD%93%E5%89%8D%E6%9F%A5%E7%9C%8B%E9%A1%B5%E9%9D%A2%E7%9A%84%E4%BD%9C%E5%AE%B6%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B">（2）在【user】用户服务中，创建MyFansController类，去实现【查询当前登录用户，是否已经关注当前查看页面的作家，接口】；</h4> 
 <pre><code class="language-java">package com.imooc.user.controller;

import com.imooc.api.BaseController;
import com.imooc.api.controller.user.MyFansControllerApi;
import com.imooc.grace.result.GraceJSONResult;
import com.imooc.user.service.MyFansService;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class MyFansController extends BaseController implements MyFansControllerApi {

    final static Logger logger = LoggerFactory.getLogger(MyFansController.class);

    @Autowired
    private MyFansService myFansService;


    /**
     * 假如当前登录用户是A，当A查看B的主页时，查询A是否已经关注B；
     * @param writerId
     * @param fanId
     * @return
     */
    @Override
    public GraceJSONResult isMeFollowThisWriter(String writerId, String fanId) {
//这儿需要加一个writerId和fanId判空的处理
        boolean isFollow = myFansService.isMeFollowThisWriter(writerId, fanId);
        return GraceJSONResult.ok(isFollow);
    }
}
</code></pre> 
</blockquote> 
<blockquote> 
 <h4 id="%EF%BC%883%EF%BC%89%E5%9C%A8%E3%80%90user%E3%80%91%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E4%B8%AD%EF%BC%8C%E5%88%9B%E5%BB%BAMyFansService%E6%8E%A5%E5%8F%A3%EF%BC%8C%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E6%9F%A5%E8%AF%A2%E5%BD%93%E5%89%8D%E7%99%BB%E5%BD%95%E7%94%A8%E6%88%B7%E6%98%AF%E5%90%A6%E5%85%B3%E6%B3%A8%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%9B%E7%84%B6%E5%90%8E%EF%BC%8C%E5%88%9B%E5%BB%BAMyFansServiceImpl%E5%AE%9E%E7%8E%B0%E7%B1%BB%EF%BC%8C%E5%8E%BB%E5%AE%9E%E7%8E%B0%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%EF%BC%9B">（3）在【user】用户服务中，创建MyFansService接口，定义一个查询当前登录用户是否关注的方法；然后，创建MyFansServiceImpl实现类，去实现这个方法；</h4> 
 <p><img alt="" height="448" src="https://images2.imgbox.com/42/3c/dqP05iKR_o.png" width="393"></p> 
 <pre><code class="language-java">package com.imooc.user.service;

public interface MyFansService {

    /**
     * 假如当前登录用户是A，当A查看B的主页时，查询A是否已经关注B；
     */
    public boolean isMeFollowThisWriter(String writerId, String fanId);
}</code></pre> 
 <pre><code class="language-java">package com.imooc.user.service.impl;

import com.imooc.api.service.BaseService;
import com.imooc.bo.UpdateUserInfoBO;
import com.imooc.enums.Sex;
import com.imooc.enums.UserStatus;
import com.imooc.exception.GraceException;
import com.imooc.grace.result.ResponseStatusEnum;
import com.imooc.pojo.AppUser;
import com.imooc.pojo.Fans;
import com.imooc.user.mapper.AppUserMapper;
import com.imooc.user.mapper.FansMapper;
import com.imooc.user.service.MyFansService;
import com.imooc.user.service.UserService;
import com.imooc.utils.DateUtil;
import com.imooc.utils.DesensitizationUtil;
import com.imooc.utils.JsonUtils;
import com.imooc.utils.RedisOperator;
import org.n3r.idworker.Sid;
import org.springframework.beans.BeanUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import tk.mybatis.mapper.entity.Example;

import java.util.Date;

@Service
public class MyFansServiceImpl extends BaseService implements MyFansService {

    @Autowired
    FansMapper fansMapper;
    /**
     * 假如当前登录用户是A，当A查看B的主页时，查询A是否已经关注B；
     */
    @Override
    public boolean isMeFollowThisWriter(String writerId, String fanId) {

        //根据传过来的参数，构建一个Fans对象；
        Fans fans = new Fans();
        fans.setFanId(fanId);
        fans.setWriterId(writerId);

        //然后，去数据库的fans表中，查查看是否有满足这种条件的记录；
        int count = fansMapper.selectCount(fans);

        return count &gt; 0;
    }
}
</code></pre> 
 <p><strong>（1）</strong>记得使用【<a href="https://blog.csdn.net/csucsgoat/article/details/125402058" title="15：第二章：架构后端项目：11：使用【mybatis-generator-core】依赖生成实体类、mapper接口、mapper.xml等逆向文件；（我们使用tkmybatis来帮助提升开发效率）">15：第二章：架构后端项目：11：使用【mybatis-generator-core】依赖生成实体类、mapper接口、mapper.xml等逆向文件；（我们使用tkmybatis来帮助提升开发效率）</a>】这个工程，针对fans表生成对应的mapper接口、xml、实体类；</p> 
 <p><strong>（2）</strong>这儿我们查询的时候，使用了selectCount()方法，即这儿底层其实也是使用了SQL的count函数；即，这儿是不好的；；；；后面，我们使用elasticsearch的时候，我们会把粉丝的数据保存到elasticsearch中，所以后面这儿我们会优化；</p> 
 <p><strong>（3）</strong>fans表的结构；这个表其实是有点冗余的，但是这个冗余是为了后面方便的，所以这个冗余是有价值的；</p> 
 <p><img alt="" height="291" src="https://images2.imgbox.com/b7/04/zMsH26SJ_o.png" width="802"></p> 
</blockquote> 
<p></p> 
<h3 id="3.%E6%95%88%E6%9E%9C%EF%BC%9B">3.效果；</h3> 
<blockquote> 
 <p>（1）先install一下整个项目；（2）记得使用SwitchHost开启虚拟域名映射；（3）使用Tomcat启动前端项目；（4）然后，启动后端项目； </p> 
</blockquote> 
<blockquote> 
 <p><img alt="" height="313" src="https://images2.imgbox.com/a5/83/WFksWBEf_o.png" width="864"></p> 
</blockquote> 
<hr> 
<p></p> 
<blockquote> 
 <p><img alt="" height="504" src="https://images2.imgbox.com/87/85/AWvP4sjC_o.png" width="934"></p> 
</blockquote> 
<hr> 
<p></p> 
<h2 id="%E4%B8%89%EF%BC%9A%E5%BC%80%E5%8F%91%E3%80%90A%E7%94%A8%E6%88%B7%E5%85%B3%E6%B3%A8B%E7%94%A8%E6%88%B7%EF%BC%8CA%E7%9A%84%E5%85%B3%E6%B3%A8%E6%95%B0%2B1%EF%BC%8CB%E7%9A%84%E7%B2%89%E4%B8%9D%E6%95%B0%2B1%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B">三：开发【A用户关注B用户，A的关注数+1，B的粉丝数+1，接口】；</h2> 
<blockquote> 
 <p>PS：按理说A用户是不能关注自己的；；；但是，这儿我们因为懒，就没有对这一点做控制；；；</p> 
</blockquote> 
<blockquote> 
 <h3 id="1.%E5%9C%A8%E3%80%90api%E3%80%91%E6%8E%A5%E5%8F%A3%E5%B7%A5%E7%A8%8B%E7%9A%84MyFansControllerApi%E6%8E%A5%E5%8F%A3%EF%BC%8C%E5%AE%9A%E4%B9%89%E3%80%90A%E7%94%A8%E6%88%B7%E5%85%B3%E6%B3%A8B%E7%94%A8%E6%88%B7%EF%BC%8CA%E7%9A%84%E5%85%B3%E6%B3%A8%E6%95%B0%2B1%EF%BC%8CB%E7%9A%84%E7%B2%89%E4%B8%9D%E6%95%B0%2B1%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B%C2%A0">1.在【api】接口工程的MyFansControllerApi接口，定义【A用户关注B用户，A的关注数+1，B的粉丝数+1，接口】； </h3> 
 <pre><code class="language-java">    /**
     * A用户关注B用户，A的粉丝数+1；
     * @param writerId
     * @param fanId
     * @return
     */
    @ApiOperation(value = "A用户关注B用户，A的粉丝数+1", notes = "A用户关注B用户，A的粉丝数+1", httpMethod = "POST")
    @PostMapping("/follow")
    public GraceJSONResult follow(@RequestParam String writerId,
                                                @RequestParam String fanId);</code></pre> 
 <p><strong> 说明：</strong></p> 
 <p><strong>（1）</strong></p> 
 <p><img alt="" height="368" src="https://images2.imgbox.com/3c/0c/HIbzBIhN_o.png" width="812"></p> 
</blockquote> 
<blockquote> 
 <h3 id="2.%E5%9C%A8%E3%80%90user%E3%80%91%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E7%9A%84MyFansController%E7%B1%BB%E4%B8%AD%EF%BC%8C%E5%8E%BB%E5%AE%9E%E7%8E%B0%E3%80%90A%E7%94%A8%E6%88%B7%E5%85%B3%E6%B3%A8B%E7%94%A8%E6%88%B7%EF%BC%8CA%E7%9A%84%E5%85%B3%E6%B3%A8%E6%95%B0%E6%95%B0%2B1%EF%BC%8CB%E7%9A%84%E7%B2%89%E4%B8%9D%E6%95%B0%2B1%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B">2.在【user】用户服务的MyFansController类中，去实现【A用户关注B用户，A的关注数数+1，B的粉丝数+1，接口】；</h3> 
 <pre><code class="language-java">    /**
     * A用户关注B用户，A的关注数数+1，B的粉丝数+1；
     * @param writerId
     * @param fanId
     * @return
     */
    @Override
    public GraceJSONResult follow(String writerId, String fanId) {
        //这儿需要加一个writerId和fanId判空的处理

        myFansService.follow(writerId, fanId);
        return GraceJSONResult.ok();
    }</code></pre> 
 <p></p> 
</blockquote> 
<blockquote> 
 <h3 id="3.%E5%9C%A8%E3%80%90user%E3%80%91%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E7%9A%84MyFansService%E6%8E%A5%E5%8F%A3%EF%BC%8C%E5%AE%9A%E4%B9%89%E4%B8%80%E4%B8%AA%E6%96%B9%E6%B3%95%EF%BC%9B%E7%84%B6%E5%90%8E%EF%BC%8C%E5%9C%A8MyFansServiceImpl%E5%AE%9E%E7%8E%B0%E7%B1%BB%EF%BC%8C%E5%8E%BB%E5%AE%9E%E7%8E%B0%E8%BF%99%E4%B8%AA%E6%96%B9%E6%B3%95%EF%BC%9B">3.在【user】用户服务的MyFansService接口，定义一个方法；然后，在MyFansServiceImpl实现类，去实现这个方法；</h3> 
 <pre><code class="language-java">    /**
     * A用户关注B用户，A的关注数数+1，B的粉丝数+1；
     * @param writerId
     * @param fanId
     * @return
     */
    public void follow(String writerId, String fanId);</code></pre> 
 <p>……………………………………………………</p> 
 <p></p> 
 <pre><code class="language-java">    /**
     * A用户关注B用户，A的关注数数+1，B的粉丝数+1；
     *
     * @param writerId
     * @param fanId
     * @return
     */
    @Transactional
    @Override
    public void follow(String writerId, String fanId) {

        Fans fans = new Fans();

        AppUser appUser = userService.getUser(fanId);//根据粉丝id，去查询该粉丝的详细信息
        String fanPkId = sid.nextShort();//通过雪花算法，得到一个fans表记录的id

        //然后，根据fans表的要求，去设置信息
        fans.setId(fanPkId);
        fans.setFanId(fanId);
        fans.setWriterId(writerId);
        fans.setFace(appUser.getFace());
        fans.setFanNickname(appUser.getNickname());
        fans.setProvince(appUser.getProvince());
        fans.setSex(appUser.getSex());
        fansMapper.insert(fans);//插入数据库


        //然后，A的关注数需要+1，B的粉丝数要+1;
        //B的粉丝数+1；(如果这个key不存在，就去创建)
        redisOperator.increment(REDIS_WRITER_FANS_COUNT + ":" + writerId, 1);
        //A的关注数+1;
        redisOperator.increment(REDIS_MY_FOLLOW_COUNT + ":" + fanId, 1);

    }</code></pre> 
 <p><strong>说明：</strong></p> 
 <p><strong>（0）关注数和粉丝数，这种既需要频繁查询，又需要频繁增改的小数据；我们也使用了Redis；</strong></p> 
 <p><strong>（1）</strong>我们在【api】接口工程的BaseService类中，定义了两个常量，让其作为向Redis中存放数据时，key的前半部分；</p> 
 <p><img alt="" height="407" src="https://images2.imgbox.com/09/3c/6pCbMYOM_o.png" width="837"></p> 
</blockquote> 
<blockquote> 
 <h3 id="4.%E6%95%88%E6%9E%9C%EF%BC%9B">4.效果；</h3> 
 <p>（1）先install一下整个项目；（2）记得使用SwitchHost开启虚拟域名映射；（3）使用Tomcat启动前端项目；（4）然后，启动后端项目； </p> 
 <p><img alt="" height="491" src="https://images2.imgbox.com/35/53/llYpjO1R_o.png" width="973"></p> 
</blockquote> 
<hr> 
<p></p> 
<h2 id="%E5%9B%9B%EF%BC%9A%E5%BC%80%E5%8F%91%E3%80%90A%E7%94%A8%E6%88%B7%E5%8F%96%E5%85%B3B%E7%94%A8%E6%88%B7%EF%BC%8CA%E7%9A%84%E5%85%B3%E6%B3%A8%E6%95%B0-1%EF%BC%8CB%E7%9A%84%E7%B2%89%E4%B8%9D%E6%95%B0-1%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B%C2%A0">四：开发【A用户取关B用户，A的关注数-1，B的粉丝数-1，接口】； </h2> 
<blockquote> 
 <h3 id="%C2%A01.%E5%9C%A8%E3%80%90api%E3%80%91%E6%8E%A5%E5%8F%A3%E5%B7%A5%E7%A8%8B%E7%9A%84MyFansControllerApi%E6%8E%A5%E5%8F%A3%EF%BC%8C%E5%AE%9A%E4%B9%89%E3%80%90A%E7%94%A8%E6%88%B7%E5%8F%96%E5%85%B3B%E7%94%A8%E6%88%B7%EF%BC%8CA%E7%9A%84%E5%85%B3%E6%B3%A8%E6%95%B0-1%EF%BC%8CB%E7%9A%84%E7%B2%89%E4%B8%9D%E6%95%B0-1%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B%C2%A0"> 1.在【api】接口工程的MyFansControllerApi接口，定义【A用户取关B用户，A的关注数-1，B的粉丝数-1，接口】； </h3> 
 <pre><code class="language-java">    /**
     * A用户取关B用户，A的关注数数-1，B的粉丝数-1；
     * @param writerId：当前被查看主页的用户；（换句话说，将要被取关的用户）
     * @param fanId：当前登录的用户；（换句话说，将要取关别人的，用户）
     * @return
     */
    @ApiOperation(value = "A用户取关B用户，A的关注数数-1，B的粉丝数-1", notes = "A用户取关B用户，A的关注数数-1，B的粉丝数-1", httpMethod = "POST")
    @PostMapping("/follow")
    public GraceJSONResult unFollow(@RequestParam String writerId,
                                  @RequestParam String fanId);</code></pre> 
 <p><strong> 说明：</strong></p> 
 <p><strong>（1）</strong></p> 
 <p><img alt="" height="344" src="https://images2.imgbox.com/46/a9/BksOgLlE_o.png" width="928"></p> 
 <p> </p> 
</blockquote> 
<blockquote> 
 <h3 id="2.%E5%9C%A8%E3%80%90user%E3%80%91%E7%94%A8%E6%88%B7%E6%9C%8D%E5%8A%A1%E7%9A%84MyFansController%E7%B1%BB%E4%B8%AD%EF%BC%8C%E5%8E%BB%E5%AE%9E%E7%8E%B0%E3%80%90A%E7%94%A8%E6%88%B7%E5%8F%96%E5%85%B3B%E7%94%A8%E6%88%B7%EF%BC%8CA%E7%9A%84%E5%85%B3%E6%B3%A8%E6%95%B0-1%EF%BC%8CB%E7%9A%84%E7%B2%89%E4%B8%9D%E6%95%B0-1%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%EF%BC%9B">2.在【user】用户服务的MyFansController类中，去实现【A用户取关B用户，A的关注数-1，B的粉丝数-1，接口】；</h3> 
 <pre><code class="language-java">    /**
     * A用户取关B用户，A的关注数数-1，B的粉丝数-1；
     * @param writerId：当前被查看主页的用户；（换句话说，将要被取关的用户）
     * @param fanId：当前登录的用户；（换句话说，将要取关别人的，用户）
     * @return
     */
    @Override
    public GraceJSONResult unFollow(String writerId, String fanId) {

        //这儿需要加一个writerId和fanId判空的处理
        myFansService.unFollow(writerId, fanId);
        return GraceJSONResult.ok();
    }</code></pre> 
 <p></p> 
</blockquote> 
<blockquote> 
 <h3>3.在【user】用户服务的MyFansService接口，定义一个方法；然后，在MyFansServiceImpl实现类，去实现这个方法；</h3> 
 <pre><code class="language-java">    /**
     * A用户取关B用户，A的关注数数-1，B的粉丝数-1；
     * @param writerId
     * @param fanId
     * @return
     */
    public void unFollow(String writerId, String fanId);</code></pre> 
 <p>……………………………………………………</p> 
 <p></p> 
 <pre><code class="language-java">    /**
     * A用户取关B用户，A的关注数数-1，B的粉丝数-1；
     *
     * @param writerId
     * @param fanId
     * @return
     */
    @Transactional
    @Override
    public void unFollow(String writerId, String fanId) {
        Fans fans = new Fans();
        fans.setWriterId(writerId);
        fans.setFanId(fanId);

        fansMapper.delete(fans);//删除fans表中的记录

        //然后，A的关注数需要-1，B的粉丝数要-1;
        //B的粉丝数-1；(如果这个key不存在，就去创建)
        redisOperator.decrement(REDIS_WRITER_FANS_COUNT + ":" + writerId, 1);
        //A的关注数-1;
        redisOperator.decrement(REDIS_MY_FOLLOW_COUNT + ":" + fanId, 1);

    }</code></pre> 
</blockquote> 
<blockquote> 
 <h3>4.效果；</h3> 
 <p>（1）先install一下整个项目；（2）记得使用SwitchHost开启虚拟域名映射；（3）使用Tomcat启动前端项目；（4）然后，启动后端项目； </p> 
 <p><img alt="" height="409" src="https://images2.imgbox.com/5a/55/NdVSkupG_o.png" width="907"></p> 
 <p> </p> 
 <p><img alt="" height="405" src="https://images2.imgbox.com/97/0c/6nZEHYBY_o.png" width="940"></p> 
 <p>同时，在Redis中的数据，也是OK的；</p> 
</blockquote> 
<hr> 
<p></p> 
<h2 id="%E9%99%84%E5%8A%A0%EF%BC%9A%E3%80%90%E5%85%B3%E6%B3%A8%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%E5%92%8C%E3%80%90%E5%8F%96%E5%85%B3%EF%BC%8C%E6%8E%A5%E5%8F%A3%E3%80%91%E9%83%BD%E9%9C%80%E8%A6%81%EF%BC%8C%E2%80%9C%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95%E3%80%81%E5%B9%B6%E4%B8%94%E7%94%A8%E6%88%B7%E6%98%AF%E6%BF%80%E6%B4%BB%E7%8A%B6%E6%80%81%E2%80%9D%E6%89%8D%E8%83%BD%E6%93%8D%E4%BD%9C%EF%BC%9B%E6%89%80%E4%BB%A5%EF%BC%8C%E5%9C%A8%E3%80%90api%E3%80%91%E6%8E%A5%E5%8F%A3%E5%B7%A5%E7%A8%8B%E7%9A%84InterceptorConfig%E7%B1%BB%E4%B8%AD%EF%BC%8C%E5%AF%B9%E5%85%B6%E8%BF%9B%E8%A1%8C%E9%85%8D%E7%BD%AE%EF%BC%9B">附加：【关注，接口】和【取关，接口】都需要，“用户登录、并且用户是激活状态”才能操作；所以，在【api】接口工程的InterceptorConfig类中，对其进行配置；</h2> 
<blockquote> 
 <p><img alt="" height="347" src="https://images2.imgbox.com/db/1b/dboFX7dM_o.png" width="930"></p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b010c2f661948c8d0721c858a394f256/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Lsky Pro&#43;云服务器搭建私人图床</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7562bc9394624d15c073d2411d30c16c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">微信小程序图片前端压缩（canvas）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>