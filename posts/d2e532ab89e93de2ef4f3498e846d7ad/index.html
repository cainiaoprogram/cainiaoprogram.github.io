<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>xtrabackup备份原理解析 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="xtrabackup备份原理解析" />
<meta property="og:description" content="对于数据量大的数据库来说，xtrabackup是作为mysql最好的热备份工具。
xtrabackup内容解析：
首先做一次全量备份：
xtrabackup -uroot -p123456 --backup -S /usr/local/mysql/mysql.sock 第一部分（对于innodb表的备份）：
190422 16:14:28 version_check Connected to MySQL server
190422 16:14:28 version_check Executing a version check against the server...
190422 16:14:28 version_check Done.
190422 16:14:28 Connecting to MySQL server host: localhost, user: root, password: set, port: not set, socket: /usr/local/mysql/mysql.sock
Using server version 5.7.23-log
xtrabackup version 2.4.12 based on MySQL server 5.7.19 Linux (x86_64) (revision id: 170eb8c)
xtrabackup: uses posix_fadvise().
xtrabackup: cd to /usr/local/mysql/data" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/d2e532ab89e93de2ef4f3498e846d7ad/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-22T16:37:28+08:00" />
<meta property="article:modified_time" content="2019-04-22T16:37:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">xtrabackup备份原理解析</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>对于数据量大的数据库来说，xtrabackup是作为mysql最好的热备份工具。</p> 
<p>xtrabackup内容解析：</p> 
<p>首先做一次全量备份：</p> 
<p>xtrabackup -uroot -p123456 --backup -S /usr/local/mysql/mysql.sock </p> 
<p>第一部分（对于innodb表的备份）：</p> 
<p>190422 16:14:28  version_check Connected to MySQL server<br> 190422 16:14:28  version_check Executing a version check against the server...<br> 190422 16:14:28  version_check Done.<br> 190422 16:14:28 Connecting to MySQL server host: localhost, user: root, password: set, port: not set, socket: /usr/local/mysql/mysql.sock<br> Using server version 5.7.23-log<br> xtrabackup version 2.4.12 based on MySQL server 5.7.19 Linux (x86_64) (revision id: 170eb8c)<br> xtrabackup: uses posix_fadvise().<br> xtrabackup: cd to /usr/local/mysql/data<br> xtrabackup: open files limit requested 65535, set to 65535<br> xtrabackup: using the following InnoDB configuration:<br> xtrabackup:   innodb_data_home_dir = .<br> xtrabackup:   innodb_data_file_path = ibdata1:12M;ibdata2:1G:autoextend<br> xtrabackup:   innodb_log_group_home_dir = ./<br> xtrabackup:   innodb_log_files_in_group = 3<br> xtrabackup:   innodb_log_file_size = 1073741824<br> xtrabackup: using O_DIRECT<br> InnoDB: Number of pools: 1<br> 190422 16:14:29 &gt;&gt; log scanned up to (23226687)<br> xtrabackup: Generating a list of tablespaces<br> InnoDB: Allocated tablespace ID 2 for mysql/plugin, old maximum was 0<br> 190422 16:14:29 [01] Copying ./ibdata1 to /root/xtrabackup_backupfiles/ibdata1<br> 190422 16:14:29 [01]        ...done<br> 190422 16:14:29 [01] Copying ./ibdata2 to /root/xtrabackup_backupfiles/ibdata2<br> 190422 16:14:30 &gt;&gt; log scanned up to (23226687)<br> 190422 16:14:31 &gt;&gt; log scanned up to (23226687)<br> 190422 16:14:32 &gt;&gt; log scanned up to (23226687)<br> 190422 16:14:33 &gt;&gt; log scanned up to (23226687)<br> 190422 16:14:33 [01]        ...done<br> 190422 16:14:33 [01] Copying ./mysql/plugin.ibd to /root/xtrabackup_backupfiles/mysql/plugin.ibd<br>  </p> 
<p>1）log scanned up to (23226687)之前都是一些输出的常用信息。</p> 
<p>2）Copying。。</p> 
<p>开始拷贝ibdata1和ibdata2文件</p> 
<p>3）log scanned up to</p> 
<p>扫描最新的redolog的LSN号</p> 
<p>4）Copying 。。</p> 
<p>拷贝innodb的数据文件</p> 
<p> </p> 
<p>第二部分（对于非innodb表）：</p> 
<p>190422 16:14:34 &gt;&gt; log scanned up to (23226687)<br> 190422 16:14:34 Executing FLUSH NO_WRITE_TO_BINLOG TABLES...<br> 190422 16:14:34 Executing FLUSH TABLES WITH READ LOCK...<br> 190422 16:14:34 Starting to backup non-InnoDB tables and files<br> 190422 16:14:34 [01] Copying ./mysql/db.opt to /root/xtrabackup_backupfiles/mysql/db.opt<br> 190422 16:14:34 [01]        ...done<br> 1）log scanned up to (23226687)</p> 
<p>后台的redolog扫描线程一直在扫描最新的日志，持续写入</p> 
<p>2）Executing FLUSH TABLES WITH READ LOCK...</p> 
<p>执行全局读锁，防止写入</p> 
<p>3）Starting to backup non-InnoDB tables and files</p> 
<p>开始对非innodb表和文件开始拷贝</p> 
<p>4）Copying .</p> 
<p>拷贝开始</p> 
<p> </p> 
<p>第三部分：</p> 
<p>190422 16:14:34 [00]        ...done<br> 190422 16:14:34 Executing FLUSH NO_WRITE_TO_BINLOG ENGINE LOGS...<br> xtrabackup: The latest check point (for incremental): '23226678'<br> xtrabackup: Stopping log copying thread.<br> .190422 16:14:34 &gt;&gt; log scanned up to (23226687)</p> 
<p>190422 16:14:34 Executing UNLOCK TABLES<br> 190422 16:14:34 All tables unlocked<br> 190422 16:14:34 [00] Copying ON to /root/xtrabackup_backupfiles/ON<br> 190422 16:14:34 [00]        ...done<br> 190422 16:14:34 Backup created in directory '/root/xtrabackup_backupfiles/'<br> MySQL binlog position: filename 'mysql-bin.000002', position '1874', GTID of the last change '5e8ed74d-61c4-11e9-8417-000c290bcf2a:1-221,<br> 73218b73-61ca-11e9-8462-000c2993db47:1-13882'<br> 190422 16:14:34 [00] Writing /root/xtrabackup_backupfiles/backup-my.cnf<br> 190422 16:14:34 [00]        ...done<br> 190422 16:14:34 [00] Writing /root/xtrabackup_backupfiles/xtrabackup_info<br> 190422 16:14:34 [00]        ...done<br> xtrabackup: Transaction log of lsn (23226678) to (23226687) was copied.<br> 190422 16:14:35 completed OK!<br> 1）    ...done</p> 
<p>拷贝完成</p> 
<p>2）Stopping log copying thread.</p> 
<p>停止后台redo线程</p> 
<p>3）Executing UNLOCK TABLES</p> 
<p>释放锁</p> 
<p> </p> 
<p><img alt="PXBå¤ä»½è¿ç¨" class="has" src="https://images2.imgbox.com/9e/34/6xmFmpWp_o.png"></p> 
<p> </p> 
<p>1、xtrabackup在启动后，会有两个线程，一个是redolog扫描线程，一个是innodb文件的ibd文件拷贝线程。redo日志线程总是在拷贝线程之前启动，早拷贝线程结束后结束。</p> 
<p>2、ibd文件拷贝完成后通知主进程，告知拷贝完毕。</p> 
<p>3、启动非innodb引擎的拷贝线程，加全局读锁。</p> 
<p>4、非innodb引擎的文件拷贝完毕后，停止拷贝线程，然后停止redo线程，在停止redo线程之前，redo线程一直在拷贝，到最新的日志。</p> 
<p>5、redo线程结束后，执行解锁表操作，进行收尾工作，备份结束。</p> 
<p><br>  </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/774116726367d7425eda31132be4e2d9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java代码里出现中文乱码怎么解决</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5b9e7eb9a6e25635eb808ac428c98aea/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">闭包，看这一篇就够了——带你看透闭包的本质，百发百中</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>