<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>input上传文件-vue3 -ts使用formData上传和base64上传 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="input上传文件-vue3 -ts使用formData上传和base64上传" />
<meta property="og:description" content="tempent
&lt;AFormItem label=&#34;白色图标&#34; name=&#34;iconWhiteUrl&#34;&gt; &lt;div class=&#34;inputBox&#34;&gt; &lt;span&gt;上传文件 &lt;input id=&#34;iconWhiteInp&#34; accept=&#34;image/png&#34; class=&#34;img-input&#34; type=&#34;file&#34; @change=&#34;(file)=&gt;handleChangeIconWhiteUrl(file)&#34; /&gt; &lt;/span&gt; &lt;/div&gt; &lt;p&gt;{{ value.iconWhiteUrl }}&lt;/p&gt; &lt;/AFormItem&gt; ts
import { defineComponent, reactive,ref ,nextTick} from &#39;vue&#39; import {uploadImg} from &#34;./addOrChange&#34; const handleChangeIconWhiteUrl = async(e:any)=&gt;{ iconWhiteUrlList.value =[] // 自己展示的返回图片地址 uploadImg(e,&#39;white&#39;) //调用上传方法 const iconWhiteInp = document.getElementById(&#39;iconWhiteInp&#39;) as HTMLInputElement | null; //获取元素清空value if(iconWhiteInp){ iconWhiteInp.value = &#39;&#39; } } //addOrChange文件封装引入，这里是传formData的 import { reactive } from &#39;vue&#39;; import { message } from &#39;ant-design-vue&#39; import api from &#39;@/api/api&#39; export const addOrChangeForm = reactive({ iconWhiteUrl:&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c1b7b4d54f0f90dadf72eba998a461fe/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-10T11:23:52+08:00" />
<meta property="article:modified_time" content="2023-08-10T11:23:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">input上传文件-vue3 -ts使用formData上传和base64上传</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>tempent</p> 
<pre><code class="hljs">&lt;AFormItem label="白色图标" name="iconWhiteUrl"&gt;
            &lt;div class="inputBox"&gt;
              &lt;span&gt;上传文件
                &lt;input
                  id="iconWhiteInp"
                  accept="image/png"
                  class="img-input"
                  type="file"
                  @change="(file)=&gt;handleChangeIconWhiteUrl(file)"
                /&gt;
              &lt;/span&gt;
            &lt;/div&gt;
          &lt;p&gt;{<!-- -->{ value.iconWhiteUrl }}&lt;/p&gt;
 &lt;/AFormItem&gt;

</code></pre> 
<p>ts</p> 
<pre><code class="hljs"> import { defineComponent, reactive,ref ,nextTick} from 'vue'
 import {uploadImg} from "./addOrChange"

 const handleChangeIconWhiteUrl = async(e:any)=&gt;{
        iconWhiteUrlList.value =[] // 自己展示的返回图片地址
        uploadImg(e,'white') //调用上传方法
        const iconWhiteInp = document.getElementById('iconWhiteInp') as HTMLInputElement | null;  //获取元素清空value
        if(iconWhiteInp){ 
          iconWhiteInp.value = ''
        }
      }

//addOrChange文件封装引入，这里是传formData的
import { reactive } from 'vue';
import { message } from 'ant-design-vue'
import api from '@/api/api'
export const addOrChangeForm = reactive({
    iconWhiteUrl:"",
})
// 上传图片传formdata对象方法
export const uploadImg = async(e:any,type:string)=&gt;{
        const fileFormData = e.target.files[0]
        if (!uploadImgRules.type.includes(fileFormData.type)) {
          message.destroy()
          message.error('图片格式不符合要求，请重新上传png格式图片')
          return 
        }
        if (fileFormData.size  &gt; uploadImgRules.size) {
          message.destroy()
          message.error(`图片上传超过30kb，请重新上传`)
          return 
        }
        let formData  = new FormData() //传formdata对象方法
        formData.append('file',fileFormData);
        const data = await api.hotWordIcon.uploadImgIcon(formData)
        if(data?.retcode ==0){
          if(type=='white'){
            addOrChangeForm.iconWhiteUrl = data.data
          }
          if(type=='black'){
            addOrChangeForm.iconBlackUrl = data.data
          }
        }
    
}

// 上传图片 传base64位文件流方法
export const uploadImg = async(e:any,type:string)=&gt;{
        const fileFormData = e.target.files[0]
        
        const resultFile = e.target.files; // input 获取的文件列表
        const aBlob = new Blob([resultFile[0]],{type:'image/png'}) // 指定转换成blob的类型
        const reader = new FileReader(); // 3 新建 FileReader 对象,用于操作文件
        reader.readAsDataURL(aBlob) // 4 将文件转换成指定类型的数据
        reader.onload= async(ev:any)=&gt;{
        const base64Url = ev.target.result; // 5 base64内容
            if (!uploadImgRules.type.includes(fileFormData.type)) {
             message.destroy()
             message.error('图片格式不符合要求，请重新上传png格式图片')
             return 
           }
           if (fileFormData.size  &gt; uploadImgRules.size) {
             message.destroy()
             message.error(`图片上传超过30kb，请重新上传`)
             return 
           }
           const data = await api.hotWordIcon.uploadImgIcon(base64Url)
           if(data?.retcode ==0){
             if(type=='white'){
               addOrChangeForm.iconWhiteUrl = data.data
             }
             if(type=='black'){
               addOrChangeForm.iconBlackUrl = data.data
             }
           }
         }
    
}</code></pre> 
<p>css</p> 
<pre><code class="hljs">    .inputBox{
      margin-top: 5px;
      span{
        padding: 6px 18px;
        background-color: #456fff;
        color: #fff;
        line-height: 10px;
        position: relative;
      }
      input{
        width: 90px;
        height: 35px;
        position: absolute;
        top: 0px;
        left: 0px;
        border: 1px solid red;
        opacity: 0;
      }
    }</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/23885e0a2cf6256ddf07e18b5e5988d0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CKA考试注意事项--考前必看！</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/04ac15e7ed27263f73cbfc73bd19b2b7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Redis7.0源码安装与部署</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>