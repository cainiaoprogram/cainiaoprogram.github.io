<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Intel RealSense D435i:简介、安装与使用(ROS、Python) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Intel RealSense D435i:简介、安装与使用(ROS、Python)" />
<meta property="og:description" content="link
1.简介2.安装与配置 (1)添加Keys(2)添加Repositories(3)安装Libraries(4)安装Dev和Debug工具 3.测试与使用4.ROS接口安装5.ROS接口使用5.Python接口安装6.Python接口使用7.其它注意事项 (1)IMU信息的融合(2)深度图对齐问题(3)红外散斑问题(4)红外发射器的开关(5)D435i的不同分辨率(6)D435i相机默认参数查看(7)数据采集的常规流程 8.参考资料 实验室最近买了个Intel RealSense D435i相机让我来学习和采集数据，由于之前没有接触过相关内容，所以就简单学习了解了一下。这篇博客主要从使用角度对435i相机进行相关介绍，不涉及理论问题。插一句题外话，虽然Intel官网上RealSense相机看起来都很大的样子，但其实真正拿到手里会发现其实是非常小巧的，一个手就可以握住，如下图所示。 1.简介 Intel RealSense D435i是英特尔公司推出的一款消费级深度相机，它的主要构成如下图所示。 它主要包含一个RGB相机、两个红外相机以及一个红外发射器，此外还有一个IMU单元(这也就是D435i和D435的区别，i就表示imu)。简单来说它的深度成像原理是主动立体红外成像，不是传统意义上理解的双目RGB相机成像，这点需要注意一下。 有了深度图(3D点云)和对应的RGB影像，因此也就很容易获得RGB-D点云了。因此从输出的角度而言，D435i可以看做是一个RGB-D传感器相机。后续可以搭配ORB-SLAM中RGB-D的模式进行使用。当然，也可以只用单目RGB影像，以单目SLAM模式运行，或者单目结合IMU，以Mono-Initial模式运行。唯一不能运行的是双目RGB模式(因为两个红外相机是单通道的)。当然我们可以获取双目的红外影像，以此作为输入，进行双目SLAM，结果也是类似的。因此可以看出，D435i是一个比较“全能”的传感器，从单目、单目&#43;IMU、双目、双目&#43;IMU、RGB-D都可以使用。
对于它的一些技术上的参数，这里也简单列举一下：
深度技术：主动立体IR图像传感器技术：3μm×3μm像素大小，全局快门深度视场(H×V)：86°×57°(±3°)深度分辨率&amp;帧率：1280×720，90FPS(最高)RGB传感器技术：卷帘快门RGB传感器分辨率&amp;帧率：1920×1080,30FPS(最高)RGB传感器FOV(H×V)：69°×42°(±1°)最小深度距离(Min-Z)：0.105m最大范围：约10m尺寸(长宽高)：90mm × 25mm × 25mm 从上面的参数中，也可以看出来它的一些特点。比如深度图和RGB影像的大小是不同的，换句话说RGB影像中只有和深度图重叠的那部分才有深度信息，否则是没有的。同时帧率也不相同，如果需要使用RGB-D信息，那么时间同步也可能是个需要处理的问题。第二点是RGB传感器采用的是卷帘快门，因此在一些高速运动的场景下，可能会出现果冻效应。最后由于采用主动红外测距技术，而红外传感器本身发射的信号强度有限，最大10m左右，因此并不能适用于室外很大的场景。
2.安装与配置 在电脑端使用需要配合RealSense专门的驱动和SDK，这里以Ubuntu为例，介绍安装使用过程。
(1)添加Keys apt-key adv --keyserver keys.gnupg.net --recv-key C8B3A55A6F3EFCDE || apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-key C8B3A55A6F3EFCDE (2)添加Repositories Ubuntu 16.04：
add-apt-repository &#34;deb http://realsense-hw-public.s3.amazonaws.com/Debian/apt-repo xenial main&#34; -u Ubuntu 18.04:
add-apt-repository &#34;deb http://realsense-hw-public.s3.amazonaws.com/Debian/apt-repo bionic main&#34; -u (3)安装Libraries apt-get install librealsense2-dkms apt-get install librealsense2-utils (4)安装Dev和Debug工具 apt-get install librealsense2-dev apt-get install librealsense2-dbg 需要注意的是librealsense2-dbg比较大，大约110MB左右，又因为是外网，因此可能会下载一段时间。 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/5e743cd122dad21ca1e487915a29b8b1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-13T21:14:46+08:00" />
<meta property="article:modified_time" content="2023-07-13T21:14:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Intel RealSense D435i:简介、安装与使用(ROS、Python)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><a href="http://zhaoxuhui.top/blog/2020/09/09/intel-realsense-d435i-installation-and-use.html" rel="nofollow">link</a></p> 
<ul><li><a href="#1%E7%AE%80%E4%BB%8B" rel="nofollow">1.简介</a></li><li><a href="#2%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE" rel="nofollow">2.安装与配置</a> 
 <ul><li><a href="#1%E6%B7%BB%E5%8A%A0keys" rel="nofollow">(1)添加Keys</a></li><li><a href="#2%E6%B7%BB%E5%8A%A0repositories" rel="nofollow">(2)添加Repositories</a></li><li><a href="#3%E5%AE%89%E8%A3%85libraries" rel="nofollow">(3)安装Libraries</a></li><li><a href="#4%E5%AE%89%E8%A3%85dev%E5%92%8Cdebug%E5%B7%A5%E5%85%B7" rel="nofollow">(4)安装Dev和Debug工具</a></li></ul> </li><li><a href="#3%E6%B5%8B%E8%AF%95%E4%B8%8E%E4%BD%BF%E7%94%A8" rel="nofollow">3.测试与使用</a></li><li><a href="#4ros%E6%8E%A5%E5%8F%A3%E5%AE%89%E8%A3%85" rel="nofollow">4.ROS接口安装</a></li><li><a href="#5ros%E6%8E%A5%E5%8F%A3%E4%BD%BF%E7%94%A8" rel="nofollow">5.ROS接口使用</a></li><li><a href="#5python%E6%8E%A5%E5%8F%A3%E5%AE%89%E8%A3%85" rel="nofollow">5.Python接口安装</a></li><li><a href="#6python%E6%8E%A5%E5%8F%A3%E4%BD%BF%E7%94%A8" rel="nofollow">6.Python接口使用</a></li><li><a href="#7%E5%85%B6%E5%AE%83%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9" rel="nofollow">7.其它注意事项</a> 
 <ul><li><a href="#1imu%E4%BF%A1%E6%81%AF%E7%9A%84%E8%9E%8D%E5%90%88" rel="nofollow">(1)IMU信息的融合</a></li><li><a href="#2%E6%B7%B1%E5%BA%A6%E5%9B%BE%E5%AF%B9%E9%BD%90%E9%97%AE%E9%A2%98" rel="nofollow">(2)深度图对齐问题</a></li><li><a href="#3%E7%BA%A2%E5%A4%96%E6%95%A3%E6%96%91%E9%97%AE%E9%A2%98" rel="nofollow">(3)红外散斑问题</a></li><li><a href="#4%E7%BA%A2%E5%A4%96%E5%8F%91%E5%B0%84%E5%99%A8%E7%9A%84%E5%BC%80%E5%85%B3" rel="nofollow">(4)红外发射器的开关</a></li><li><a href="#5d435i%E7%9A%84%E4%B8%8D%E5%90%8C%E5%88%86%E8%BE%A8%E7%8E%87" rel="nofollow">(5)D435i的不同分辨率</a></li><li><a href="#6d435i%E7%9B%B8%E6%9C%BA%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0%E6%9F%A5%E7%9C%8B" rel="nofollow">(6)D435i相机默认参数查看</a></li><li><a href="#7%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86%E7%9A%84%E5%B8%B8%E8%A7%84%E6%B5%81%E7%A8%8B" rel="nofollow">(7)数据采集的常规流程</a></li></ul> </li><li><a href="#8%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" rel="nofollow">8.参考资料</a></li><li><hr> 
 
<p>实验室最近买了个Intel RealSense D435i相机让我来学习和采集数据，由于之前没有接触过相关内容，所以就简单学习了解了一下。这篇博客主要从使用角度对435i相机进行相关介绍，不涉及理论问题。插一句题外话，虽然Intel官网上RealSense相机看起来都很大的样子，但其实真正拿到手里会发现其实是非常小巧的，一个手就可以握住，如下图所示。 <img src="https://images2.imgbox.com/3f/3d/Y9IPKpqq_o.jpg" width="680"> <img src="https://images2.imgbox.com/33/22/ITGCCnmG_o.jpg" width="680"></p> 
<h5 id="1简介">1.简介</h5> 
<p>Intel RealSense D435i是英特尔公司推出的一款消费级深度相机，它的主要构成如下图所示。 <img src="https://images2.imgbox.com/78/e2/VLHmosIw_o.jpg" width="680"> 它主要包含一个RGB相机、两个红外相机以及一个红外发射器，此外还有一个IMU单元(这也就是D435i和D435的区别，i就表示imu)。简单来说它的深度成像原理是主动立体红外成像，不是传统意义上理解的双目RGB相机成像，这点需要注意一下。 有了深度图(3D点云)和对应的RGB影像，因此也就很容易获得RGB-D点云了。因此从输出的角度而言，D435i可以看做是一个RGB-D传感器相机。后续可以搭配ORB-SLAM中RGB-D的模式进行使用。当然，也可以只用单目RGB影像，以单目SLAM模式运行，或者单目结合IMU，以Mono-Initial模式运行。唯一不能运行的是双目RGB模式(因为两个红外相机是单通道的)。当然我们可以获取双目的红外影像，以此作为输入，进行双目SLAM，结果也是类似的。因此可以看出，D435i是一个比较“全能”的传感器，从单目、单目+IMU、双目、双目+IMU、RGB-D都可以使用。</p> 
<p>对于它的一些技术上的参数，这里也简单列举一下：</p> 
<ul><li>深度技术：主动立体IR</li><li>图像传感器技术：3μm×3μm像素大小，全局快门</li><li>深度视场(H×V)：86°×57°(±3°)</li><li>深度分辨率&amp;帧率：1280×720，90FPS(最高)</li><li>RGB传感器技术：卷帘快门</li><li>RGB传感器分辨率&amp;帧率：1920×1080,30FPS(最高)</li><li>RGB传感器FOV(H×V)：69°×42°(±1°)</li><li>最小深度距离(Min-Z)：0.105m</li><li>最大范围：约10m</li><li>尺寸(长宽高)：90mm × 25mm × 25mm</li></ul> 
<p>从上面的参数中，也可以看出来它的一些特点。比如深度图和RGB影像的大小是不同的，换句话说RGB影像中只有和深度图重叠的那部分才有深度信息，否则是没有的。同时帧率也不相同，如果需要使用RGB-D信息，那么时间同步也可能是个需要处理的问题。第二点是RGB传感器采用的是卷帘快门，因此在一些高速运动的场景下，可能会出现果冻效应。最后由于采用主动红外测距技术，而红外传感器本身发射的信号强度有限，最大10m左右，因此并不能适用于室外很大的场景。</p> 
<h5 id="2安装与配置">2.安装与配置</h5> 
<p>在电脑端使用需要配合RealSense专门的驱动和SDK，这里以Ubuntu为例，介绍安装使用过程。</p> 
<h6 id="1添加keys">(1)添加Keys</h6> 
<div class="language-shell highlighter-rouge"> 
 <div class="highlight"> 
  <pre class="highlight"><code class="hljs perl">apt-key adv <span class="nt">--keyserver</span> keys.gnupg.net <span class="nt">--<span class="hljs-keyword">recv</span>-key</span> C8B3A55A6F3EFCDE <span class="o">||</span> apt-key adv <span class="nt">--keyserver</span> hkp:<span class="hljs-regexp">//keyserver</span>.ubuntu.com:<span class="hljs-number">80</span> <span class="nt">--<span class="hljs-keyword">recv</span>-key</span> C8B3A55A6F3EFCDE
</code></pre> 
 </div> 
</div> 
<h6 id="2添加repositories">(2)添加Repositories</h6> 
<p>Ubuntu 16.04：</p> 
<div class="language-shell highlighter-rouge"> 
 <div class="highlight"> 
  <pre class="highlight"><code class="hljs apache"><span class="hljs-attribute">add</span>-apt-repository <span class="s2"><span class="hljs-string">"deb http://realsense-hw-public.s3.amazonaws.com/Debian/apt-repo xenial main"</span></span> <span class="nt">-u</span>
</code></pre> 
 </div> 
</div> 
<p>Ubuntu 18.04:</p> 
<div class="language-shell highlighter-rouge"> 
 <div class="highlight"> 
  <pre class="highlight"><code class="hljs apache"><span class="hljs-attribute">add</span>-apt-repository <span class="s2"><span class="hljs-string">"deb http://realsense-hw-public.s3.amazonaws.com/Debian/apt-repo bionic main"</span></span> <span class="nt">-u</span>
</code></pre> 
 </div> 
</div> 
<h6 id="3安装libraries">(3)安装Libraries</h6> 
<div class="language-shell highlighter-rouge"> 
 <div class="highlight"> 
  <pre class="highlight"><code class="hljs sql">apt-get <span class="nb"><span class="hljs-keyword">install</span> </span>librealsense2-dkms
apt-<span class="hljs-keyword">get</span> <span class="nb"><span class="hljs-keyword">install</span> </span>librealsense2-utils
</code></pre> 
 </div> 
</div> 
<h6 id="4安装dev和debug工具">(4)安装Dev和Debug工具</h6> 
<div class="language-shell highlighter-rouge"> 
 <div class="highlight"> 
  <pre class="highlight"><code class="hljs sql">apt-get <span class="nb"><span class="hljs-keyword">install</span> </span>librealsense2-dev
apt-<span class="hljs-keyword">get</span> <span class="nb"><span class="hljs-keyword">install</span> </span>librealsense2-dbg
</code></pre> 
 </div> 
</div> 
<p>需要注意的是<code class="language-plaintext highlighter-rouge">librealsense2-dbg</code>比较大，大约110MB左右，又因为是外网，因此可能会下载一段时间。 <img src="https://images2.imgbox.com/67/76/VOjZjrny_o.png" width="680"></p> 
<h5 id="3测试与使用">3.测试与使用</h5> 
<p>首先，连接D435i到电脑上，然后在终端中输入<code class="language-plaintext highlighter-rouge">realsense-viewer</code>启动数据可视化界面，如下图所示。 <img src="https://images2.imgbox.com/31/11/Pv7LqWzH_o.png" width="680"> 然后点击左侧的Stereo Module可以开启深度图显示，RGB Module可以显示RGB影像，Motion Module会显示IMU相关数据，如下图所示。 <img src="https://images2.imgbox.com/f0/e0/VAmRsDg5_o.png" width="680"> 如果可以正常显示上图中的画面，那么就说明RealSense的基本配置就成功了，可以向电脑传输数据了。</p> 
<h5 id="4ros接口安装">4.ROS接口安装</h5> 
<p>当然，上面是基础配置，买来RealSense不可能只是用它自带的Viewer看看数据，而是拿它来跑SLAM的。RealSense本身也提供了很多Wrapper，方便编程调用数据。 编译ROS接口，那么首先你电脑上得要有ROS环境，如果没有，可以参考<a href="http://zhaoxuhui.top/blog/2019/09/19/ros-note-1.html" rel="nofollow">这篇博客</a>，这里就不再赘述。</p> 
<p>首先，我们需要从GitHub上下载源码，仓库地址是<a href="https://github.com/IntelRealSense/realsense-ros">这里</a>。</p> 
<div class="language-shell highlighter-rouge"> 
 <div class="highlight"> 
  <pre class="highlight"><code class="hljs nginx"><span class="hljs-attribute">git</span> clone https://github.com/IntelRealSense/realsense-ros.git
</code></pre> 
 </div> 
</div> 
<p>其实这个仓库也是比较大的，大约30MB。国内网速可能也需要很久，或者中途断掉。这样的话直接下载zip压缩包也是可以的。 然后将<code class="language-plaintext highlighter-rouge">clone</code>下来的源码的文件夹放到Catkin Workspace的<code class="language-plaintext highlighter-rouge">src</code>文件夹中去，比如笔者的文件夹是<code class="language-plaintext highlighter-rouge">~/root/catkin_ws/src</code>。</p> 
<p>然后返回Catkin Workspace根目录，使用<code class="language-plaintext highlighter-rouge">catkin_make</code>命令进行编译即可。编译的过程中可能会遇到说缺少包的情况，这种情况下根据提示信息安装缺少的包即可，例如笔者安装的时候缺少的是<code class="language-plaintext highlighter-rouge">ddynamic_reconfigure</code>库。下载好以后，把代码放到Catkin工作空间的src文件夹下，<code class="language-plaintext highlighter-rouge">catkin_make</code>即可。</p> 
<p>最后别忘了<code class="language-plaintext highlighter-rouge">source ~/.bashrc</code>更新一下。</p> 
<h5 id="5ros接口使用">5.ROS接口使用</h5> 
<p>其实Realsense的ROS接口可以理解为一个读取数据并发布topic的节点，我们在写自己的ROS程序的时候订阅这个节点发出的topic即可，因此使用起来并没有什么特殊的情况。 输入一下命令即可以启动RealSense的ROS节点。</p> 
<div class="language-shell highlighter-rouge"> 
 <div class="highlight"> 
  <pre class="highlight"><code class="hljs css"><span class="hljs-selector-tag">roslaunch</span> <span class="hljs-selector-tag">realsense2_camera</span> <span class="hljs-selector-tag">rs_camera</span><span class="hljs-selector-class">.launch</span>
</code></pre> 
 </div> 
</div> 
<p>正常情况下就会出现如下的输出。 <img src="https://images2.imgbox.com/f6/61/cxH43cz2_o.png" width="680"> 出现“RealSense Node Is Up!”就说明节点启动成功了，这个节点会发布以下一些Topic，我们可以利用<code class="language-plaintext highlighter-rouge">rostopic list</code>查看现有的Topic，或者利用RViz或者rqt_image_view等工具订阅这些Topic，就可以显示数据了。</p> 
<div class="language-shell highlighter-rouge"> 
 <div class="highlight"> 
  <pre class="highlight"><code class="hljs">/camera/color/camera_info
/camera/color/image_raw
/camera/depth/camera_info
/camera/depth/image_rect_raw
/camera/extrinsics/depth_to_color
/camera/extrinsics/depth_to_infra1
/camera/extrinsics/depth_to_infra2
/camera/infra1/camera_info
/camera/infra1/image_rect_raw
/camera/infra2/camera_info
/camera/infra2/image_rect_raw
/camera/gyro/imu_info
/camera/gyro/sample
/camera/accel/imu_info
/camera/accel/sample
</code></pre> 
 </div> 
</div> 
<p>这里我们使用rqt_image_view订阅<code class="language-plaintext highlighter-rouge">image_raw</code>话题，显示如下图所示。 <img src="https://images2.imgbox.com/18/ee/KEWKPwgp_o.png" width="600"> 可以看到通过这个Topic就订阅了RealSense发布的数据，可以进行后续处理了。</p> 
<p>另外需要注意的是，前面提到D435i是支持双目的红外影像输出的，但是它默认是关闭这一选项的，也就是说它不会有双目红外影像的Topic。我们需要在对应的Launch文件中修改相关参数，就可以获得红外影像了。具体如下。</p> 
<p>首先，我们打开Realsense-ROS节点的Launch文件夹，如下。 <img src="https://images2.imgbox.com/a5/12/TfvfMb7X_o.png" width="680"> 找到<code class="language-plaintext highlighter-rouge">rs_camera.launch</code>文件，并打开。 <img src="https://images2.imgbox.com/f4/09/L3YPyKcG_o.png" width="680"> 可以看到，这里有非常多的参数可以供我们设置，我们需要找到<code class="language-plaintext highlighter-rouge">enable_infra</code>、<code class="language-plaintext highlighter-rouge">enable_infra1</code>、<code class="language-plaintext highlighter-rouge">enable_infra2</code>这三个参数，并且都设置为<code class="language-plaintext highlighter-rouge">true</code>。这样，我们下次再运行的时候，就会出现双目红外影像的Topic了，如下。 <img src="https://images2.imgbox.com/52/2a/hnT816SX_o.png" width="680"> 和上面一样，我们还是可以通过RQT来可视化影像，如下。 <img src="https://images2.imgbox.com/5c/b1/gtvoiiYj_o.png" width="680"> 左影像 <img src="https://images2.imgbox.com/a6/9f/fct8UjfZ_o.png" width="680"> 右影像</p> 
<p>可以看到，相对于常规RGB影像，它多了很多“星星”一样的斑点，这些斑点就是发射出去的红外光，D435i正是通过这种主动红外光进行距离估计，有点类似于结构光。</p> 
<h5 id="5python接口安装">5.Python接口安装</h5> 
<p>Python的接口安装其实非常简单，<code class="language-plaintext highlighter-rouge">pip</code>一行命令即可。</p> 
<div class="language-shell highlighter-rouge"> 
 <div class="highlight"> 
  <pre class="highlight"><code class="hljs nginx"><span class="hljs-attribute">pip</span> <span class="nb">install </span>pyrealsense2
</code></pre> 
 </div> 
</div> 
<h5 id="6python接口使用">6.Python接口使用</h5> 
<p>下面内容取自PyRealSense2包的介绍页面。</p> 
<div class="language-python highlighter-rouge"> 
 <div class="highlight"> 
  <pre class="highlight"><code class="hljs python"><span class="kn"><span class="hljs-keyword">import</span></span> <span class="nn">pyrealsense2</span> <span class="k"><span class="hljs-keyword">as</span></span> <span class="n">rs</span>
<span class="n">pipe</span> <span class="o">=</span> <span class="n">rs</span><span class="p">.</span><span class="n">pipeline</span><span class="p">()</span>
<span class="n">profile</span> <span class="o">=</span> <span class="n">pipe</span><span class="p">.</span><span class="n">start</span><span class="p">()</span>
<span class="k"><span class="hljs-keyword">try</span></span><span class="p">:</span>
  <span class="k"><span class="hljs-keyword">for</span></span> <span class="n">i</span> <span class="ow"><span class="hljs-keyword">in</span></span> <span class="nb">range</span><span class="p">(</span><span class="mi"><span class="hljs-number">0</span></span><span class="p">,</span> <span class="mi"><span class="hljs-number">100</span></span><span class="p">):</span>
    <span class="n">frames</span> <span class="o">=</span> <span class="n">pipe</span><span class="p">.</span><span class="n">wait_for_frames</span><span class="p">()</span>
    <span class="k"><span class="hljs-keyword">for</span></span> <span class="n">f</span> <span class="ow"><span class="hljs-keyword">in</span></span> <span class="n">frames</span><span class="p">:</span>
      <span class="k">print</span><span class="p">(</span><span class="n">f</span><span class="p">.</span><span class="n">profile</span><span class="p">)</span>
<span class="k"><span class="hljs-keyword">finally</span></span><span class="p">:</span>
    <span class="n">pipe</span><span class="p">.</span><span class="n">stop</span><span class="p">()</span>
</code></pre> 
 </div> 
</div> 
<p>如果能成功运行，输入如下结果： <img src="https://images2.imgbox.com/23/9c/qnL9VXvR_o.png" width="680"> 就说明安装是成功的了。</p> 
<h5 id="7其它注意事项">7.其它注意事项</h5> 
<h6 id="1imu信息的融合">(1)IMU信息的融合</h6> 
<p>前面的Topic List里也看到了，D435i可以输出陀螺仪和加速度计的信息，我们可以分开读取，也可以将<code class="language-plaintext highlighter-rouge">/camera/gyro/sample</code>和<code class="language-plaintext highlighter-rouge">/camera/accel/sample</code>两个Topic合并到一起，叫做<code class="language-plaintext highlighter-rouge">/camera/imu</code>，这样一个Topic里既有陀螺仪的数据也有加速度计的数据。具体方法也很简单，还是修改Launch文件里的配置选项。在<code class="language-plaintext highlighter-rouge">rs_camera.launch</code>文件中找到<code class="language-plaintext highlighter-rouge">unite_imu_method</code>这个参数，把它的值可以设置为<code class="language-plaintext highlighter-rouge">copy</code>或者<code class="language-plaintext highlighter-rouge">linear_interpolation</code>，这样再次启动<code class="language-plaintext highlighter-rouge">rs_camera</code>节点启动D435i就可以在Topic列表里看到<code class="language-plaintext highlighter-rouge">/camera/imu</code>这个Topic了。</p> 
<h6 id="2深度图对齐问题">(2)深度图对齐问题</h6> 
<p>D435i可以输出原始的深度图(<code class="language-plaintext highlighter-rouge">/camera/depth/image_rect_raw</code>)以及和单目RGB影像对齐的深度图(<code class="language-plaintext highlighter-rouge">/camera/aligned_depth_to_color/image_raw</code>)，这两个深度图是不一样的。在采集数据的时候尤其需要注意。比如在采集RGBD数据的时候需要的是对齐的深度，如果不小心采成了原始深度，那基本就是不能用的了。如何输出对齐的深度图，也非常简单，修改Launch文件里的配置选项。在<code class="language-plaintext highlighter-rouge">rs_camera.launch</code>文件中找到<code class="language-plaintext highlighter-rouge">align_depth</code>这个参数，把它的值可以设置为<code class="language-plaintext highlighter-rouge">true</code>即可。(设置这个选项之前，记得打开<code class="language-plaintext highlighter-rouge">enable_depth</code>，要不然是没有数据的) <img src="https://images2.imgbox.com/26/48/wKSo6Idm_o.png" width="680"></p> 
<p>另外需要注意的是，前面也提到过，D435i的深度测量是通过红外发射器实现的，因此如果想要准确的深度数据，千万不能遮挡红外发射器。</p> 
<h6 id="3红外散斑问题">(3)红外散斑问题</h6> 
<p>因为D435i会主动发射红外散斑，因此可以获得相对准确的深度信息。但这些红外散斑会显示在双目红外相机拍摄的图片中，对于较大或者较亮的场景，红外散斑不是很明显。但如果在较小或者较暗的场景，红外散斑会非常明显。这样带来的一个显著影响是会严重干扰视觉SLAM的特征点提取。由于散斑很亮、很明显，而且位置相对固定，很多时候会被认为是特征点，这样在帧间匹配的时候会让SLAM误认为机器人没有运动。导致采集的数据不能用。如下图所示。 <img src="https://images2.imgbox.com/17/30/nGqhcXx3_o.png" width="680"> <img src="https://images2.imgbox.com/db/c0/vcRQIpjQ_o.png" width="680"> 因此如果想使用红外相机拍摄的影像做视觉SLAM，在较暗或者较小场景下，一定要记得关闭红外发射器。当然，如果关闭了红外发射器，深度信息就不太准了。采集的数据就无法用于RGBD模式。所以对于较暗或者较小场景，RGBD数据和红外双目数据得要分开采集，否则就会出现上面提到的情况。红外散斑严重干扰视觉匹配。</p> 
<h6 id="4红外发射器的开关">(4)红外发射器的开关</h6> 
<p>上面提到关闭红外发射器，如何开关也十分简单。在启动<code class="language-plaintext highlighter-rouge">rs_camera</code>节点运行D435i以后，打开一个新的终端，输入<code class="language-plaintext highlighter-rouge">rosrun rqt_reconfigure rqt_reconfigure</code>启动Reconfigure节点，如下。 <img src="https://images2.imgbox.com/03/b4/MsSDOxnd_o.png" width="680"> 然后选择左边的<code class="language-plaintext highlighter-rouge">stereo_module</code>，然后找到<code class="language-plaintext highlighter-rouge">emitter_enabled</code>选项，选择”关闭”即可。开关的效果如下图所示。 <img src="https://images2.imgbox.com/90/b9/SQbwMzDO_o.png" width="680"> 当然，如果细心的话会发现，这里面除了红外发射器，还有非常多的选项可以设置，比如曝光度、增益等等，可以按需调整。</p> 
<h6 id="5d435i的不同分辨率">(5)D435i的不同分辨率</h6> 
<p>D435i的RGB、深度以及双目等影像都可以支持不同的分辨率和帧率。但是需要注意的一点是，这并不意味着可以任意指定分辨率和帧率，而是在几个支持的模式下选择。那么我们怎么知道D435i到底支持哪些分辨率和帧率呢？方法也很简单，我们可以直接在终端中输入<code class="language-plaintext highlighter-rouge">realsense-viewer</code>打开Realsense Viewer，在对应模块的设置里就可以查看了，如下图所示。 <img src="https://images2.imgbox.com/79/11/shoIBWfn_o.png" width="680"> <img src="https://images2.imgbox.com/f7/29/PQwuchNP_o.png" width="680"> <img src="https://images2.imgbox.com/79/87/KDflJE7C_o.png" width="680"> 这里为了方便，就简单把支持的分辨率和帧率总结一下：</p> 
<ul><li>单目相机(RGB影像):分辨率：320×180,320×240,424×240,640×360,640×480,848×480,960×540,1280×720,1920×1080；帧率：6,15,30,60</li><li>双目红外相机(灰度影像&amp;深度影像):分辨率：256×144,424×240,480×270,640×360,640×400,640×480,848×100,848×480,1280×720,1280×800；帧率：6,15,25,30,60,90,100,300</li><li>IMU(加速度计&amp;陀螺仪)：加速度计帧率:63,250；陀螺仪帧率:200,400</li></ul> 
<p>需要注意的是，上面的分辨率和帧率也并不是任意组合的，比如红外的640×480分辨率最高支持到90帧，如果设置成100或者300帧同样是会报错的。所以一个稳妥的方法就是，如果不清楚分辨率和帧率的组合，打开Realsense Viewer，先设置一下，如果可以成功运行，就说明是支持的，否则就换一个配置。</p> 
<p>另外需要说明的是，D435i支持的最低帧率是6Hz，如果要求更低帧率，就需要后续进一步处理了。关于如何处理，可以参考我写的另一篇有关于ROS Bag处理的博客。另外，虽然说最低6Hz，但实际测试发现，如果降低到6Hz，RGB相机很容易出现果冻效应，因此如果不是特殊需求，并不建议把帧率设的太低。可以使用默认帧率，后续处理成低帧率。</p> 
<h6 id="6d435i相机默认参数查看">(6)D435i相机默认参数查看</h6> 
<p>D435i相机在出厂时有一个默认的内参。查看方式有非常简单，在运行D435i以后，我们可以在Topic列表中看到很多叫<code class="language-plaintext highlighter-rouge">camera_info</code>的Topic，这些Topic就是对应的相机内参等参数。如下，查看的是RGB相机的参数。 <img src="https://images2.imgbox.com/c0/53/wujFqg4t_o.png" width="680"> 所以如果有什么不清楚的，直接查看对应Topic下面的<code class="language-plaintext highlighter-rouge">camera_info</code>即可。</p> 
<h6 id="7数据采集的常规流程">(7)数据采集的常规流程</h6> 
<p>这里简单给出一些D435i数据采集的建议。首先，如果要采RGBD数据，那么一定要记得录对齐后的深度，而非原始输出深度。第二，如果采集场景是较暗或者较小的场景，那么可能会有很多红外斑点出现在双目红外影像中。如果想用双目影像做视觉SLAM，那么一定记得关闭红外发射器。</p> 
<p>下面以一个利用D435i进行单目RGB、红外双目、IMU数据采集的过程为例，介绍一般流程与步骤。</p> 
<p>首先明确要采集的数据类型、影像的大小、帧率、深度是否对齐等信息，这些都在<code class="language-plaintext highlighter-rouge">rs_camera.launch</code>文件的对应参数里设置。</p> 
<p>然后，在终端中输入<code class="language-plaintext highlighter-rouge">roslaunch realsense2_camera rs_camera.launch</code>启动D435i。启动以后如果需要关闭红外发射器，按照上面提到的第三点进行操作即可。</p> 
<p>然后，利用<code class="language-plaintext highlighter-rouge">rqt_image_view</code>进行可视化。可以打开多个<code class="language-plaintext highlighter-rouge">rqt_image_view</code>节点，分别查看RGB影像、左右红外影像等。</p> 
<p>最后，打开终端，输入<code class="language-plaintext highlighter-rouge">rosbag record /camera/color/image_raw /camera/infra1/image_rect_raw /camera/infra2/image_rect_raw /camera/imu</code>，这样就开始录制了。录制完成后，按Ctrl+C保存退出即可。</p> 
<p>以上就是本篇博客的主要内容了。之后随着学习和了解的深入，会进一步介绍RealSense D435i其它的内容，如标定、跑实际的SLAM、采集数据等等。</p> 
<h5 id="8参考资料">8.参考资料</h5> 
<ul><li>[1]https://www.intelrealsense.com/zh-hans</li><li>[2]https://www.intelrealsense.com/zh-hans/depth-camera-d435i</li><li>[3]https://www.pianshen.com/article/2177388157</li><li>[4]https://github.com/IntelRealSense/realsense-ros</li><li>[5]https://blog.csdn.net/sinat_36502563/article/details/89174282</li><li>[6]https://pypi.org/project/pyrealsense2/</li></ul> 
<pre><code>    &lt;/section&gt;
&lt;p style="margin-bottom:0px;text-align:center;font-size:16px"&gt;本文作者原创,未经许可不得转载,谢谢配合&lt;/p&gt;

&lt;table width="100%" cellspacing="0" cellpadding="0" border="0" bgcolor="#ffffff"&gt;
</code></pre> 
<p><a href="#top" rel="nofollow">返回顶部</a></p> 
<div class="sq_left"> 
</div></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5b40778290bab55c494c6b584a4d9f34/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C&#43;&#43;: Windows下的Socket编程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d442620fab53bb54832a218249ed2c32/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">深入解析Tomcat：从入门到精通，一站式学习Tomcat服务器的完全指南</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>