<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>谈谈基于Github的OAuth2第三方登录实现 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="谈谈基于Github的OAuth2第三方登录实现" />
<meta property="og:description" content="上篇文章介绍了OAuth2.0的基本知识，这篇文章将介绍怎么通过github来实现OAuth2.0第三方登录
注册OAuthApp https://github.com/settings/developers
1.新建OAuth App 2.填写应用信息 homepageURL为主页地址，Authorization Callback URL为回调地址，当用户同意授权后，会回调该地址，并将ActionCode拼接到地址后面。
3.注册完毕获取clientId与client Secret 代码实现 github对外接口 上一篇文章说过，OAuth2.0的授权码模式要调用两次认证服务器来获取accessToken。github对于OAuth2.0的授权码登录提供了以下接口:
接口URL接口类型接口作用https://github.com/login/oauth/authorizeGET获取授权码codehttps://github.com/login/oauth/access_tokenPOST通过授权码获取accessTokenhttps://api.github.com/userGET通过accessToken获取用户信息 这些接口的传参可以参照官方文档：授权 OAuth 应用 - GitHub 文档，我们可以用这些接口来实现OAuth2.0的登录。
前端主页面 使用了github提供的获取授权码Code的接口，clientId是上面创建OAuthApp后显示的，redirect_uri代表回调地址。用户进行授权成功后，会跳转到该uri地址，并且在地址后面拼接授权码code。
&lt;!doctype html&gt; &lt;html lang=&#34;en&#34;&gt; &lt;head&gt; &lt;meta charset=&#34;utf-8&#34;/&gt; &lt;title&gt;第三方登录&lt;/title&gt; &lt;meta name=&#34;description&#34; content=&#34;&#34;/&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;github登录&lt;/h1&gt; &lt;!-- 获取授权码接口--&gt; &lt;a href=&#34;https://github.com/login/oauth/authorize?client_id=xxx&amp;redirect_uri=http://localhost:8080/callback&amp;state=1&amp;scope=user&#34;&gt;点击授权登录&lt;/a&gt; &lt;/body&gt; &lt;/html&gt; 后端回调接口 回调地址拿到授权码code后，通过授权码code来交换得到accessToken，然后再用accessToken获取用户信息
@RequestMapping(value = &#34;/callback&#34;) public String callBack(@RequestParam(&#34;code&#34;)String code) throws Exception{ //获取accessToken String getAccessTokenUrl=&#34;https://github.com/login/oauth/access_token&#34;; JSONObject param=new JSONObject(); param.put(&#34;client_id&#34;,&#34;xxx&#34;); //OAuthApp页面对应的clientId param.put(&#34;client_secret&#34;,&#34;xxxx&#34;);//OAuthApp页面对应的client_secret param.put(&#34;code&#34;,code); Map&lt;String, String&gt; headers=new HashMap&lt;&gt;(2); headers.put(HttpUtils.CONTENT_TYPE,&#34;application/json&#34;); headers." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/47601480f56f23af6ff414bc3dac6176/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-19T21:11:27+08:00" />
<meta property="article:modified_time" content="2023-07-19T21:11:27+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">谈谈基于Github的OAuth2第三方登录实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>上篇文章介绍了<a href="https://zhuanlan.zhihu.com/p/643886429" rel="nofollow" title="OAuth2.0的基本知识">OAuth2.0的基本知识</a>，这篇文章将介绍怎么通过github来实现OAuth2.0第三方登录</p> 
<h3 id="h_644330358_0">注册OAuthApp</h3> 
<p><a href="https://link.zhihu.com/?target=https%3A//github.com/settings/developers" title="https://github.com/settings/developers">https://github.com/settings/developers</a></p> 
<h4 id="h_644330358_1">1.<strong>新建OAuth App</strong></h4> 
<p></p> 
<p class="img-center"><img alt="" height="276" src="https://images2.imgbox.com/e1/da/Eh8slUk9_o.png" width="1200"></p> 
<h4 id="h_644330358_2">2.<strong>填写应用信息</strong></h4> 
<p>homepageURL为主页地址，Authorization Callback URL为回调地址，当用户同意授权后，会回调该地址，并将ActionCode拼接到地址后面。</p> 
<p></p> 
<p class="img-center"><img alt="" height="758" src="https://images2.imgbox.com/01/9c/54l4mLrI_o.png" width="637"></p> 
<h4 id="h_644330358_3">3.<strong>注册完毕获取clientId与client Secret</strong></h4> 
<p></p> 
<p class="img-center"><img alt="" height="382" src="https://images2.imgbox.com/00/4d/RI4lwos8_o.png" width="962"></p> 
<h3 id="h_644330358_4">代码实现</h3> 
<h4 id="h_644330358_5">github对外接口</h4> 
<p>上一篇文章说过，OAuth2.0的授权码模式要调用两次认证服务器来获取accessToken。github对于OAuth2.0的授权码登录提供了以下接口:</p> 
<table><tbody><tr><th>接口URL</th><th>接口类型</th><th>接口作用</th></tr><tr><td><a href="https://link.zhihu.com/?target=https%3A//github.com/login/oauth/authorize" title="https://github.com/login/oauth/authorize">https://github.com/login/oauth/authorize</a></td><td>GET</td><td>获取授权码code</td></tr><tr><td><a href="https://link.zhihu.com/?target=https%3A//github.com/login/oauth/access_token" title="https://github.com/login/oauth/access_token">https://github.com/login/oauth/access_token</a></td><td>POST</td><td>通过授权码获取accessToken</td></tr><tr><td><a href="https://link.zhihu.com/?target=https%3A//api.github.com/user" rel="nofollow" title="https://api.github.com/user">https://api.github.com/user</a></td><td>GET</td><td>通过accessToken获取用户信息</td></tr></tbody></table> 
<p>这些接口的传参可以参照官方文档：<a href="https://link.zhihu.com/?target=https%3A//docs.github.com/zh/apps/oauth-apps/building-oauth-apps/authorizing-oauth-apps%23web-application-flow" rel="nofollow" title="授权 OAuth 应用 - GitHub 文档">授权 OAuth 应用 - GitHub 文档</a>，我们可以用这些接口来实现OAuth2.0的登录。</p> 
<h4 id="h_644330358_6">前端主页面</h4> 
<p>使用了github提供的获取授权码Code的接口，clientId是上面创建OAuthApp后显示的，redirect_uri代表回调地址。用户进行授权成功后，会跳转到该uri地址，并且在地址后面拼接授权码code。</p> 
<pre><code>&lt;!doctype html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
    &lt;meta charset="utf-8"/&gt;
    &lt;title&gt;第三方登录&lt;/title&gt;
    &lt;meta name="description" content=""/&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;github登录&lt;/h1&gt;
&lt;!-- 获取授权码接口--&gt;
&lt;a href="https://github.com/login/oauth/authorize?client_id=xxx&amp;redirect_uri=http://localhost:8080/callback&amp;state=1&amp;scope=user"&gt;点击授权登录&lt;/a&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre> 
<h4 id="h_644330358_7">后端回调接口</h4> 
<p>回调地址拿到授权码code后，通过授权码code来交换得到accessToken，然后再用accessToken获取用户信息</p> 
<pre><code> @RequestMapping(value = "/callback")
    public String callBack(@RequestParam("code")String code) throws Exception{

        //获取accessToken
        String getAccessTokenUrl="https://github.com/login/oauth/access_token";
        JSONObject param=new JSONObject();
        param.put("client_id","xxx"); //OAuthApp页面对应的clientId
        param.put("client_secret","xxxx");//OAuthApp页面对应的client_secret
        param.put("code",code);

        Map&lt;String, String&gt; headers=new HashMap&lt;&gt;(2);
        headers.put(HttpUtils.CONTENT_TYPE,"application/json");
        headers.put("Accept","application/json");
        String resultStr=HttpUtils.postJsonStr(getAccessTokenUrl,headers,param.toJSONString());
        JSONObject jsonObject=(JSONObject)JSON.parse(resultStr);
        System.out.println("accessToken Return:"+jsonObject.toJSONString());

        //获取用户信息
        String getUserInfoUrl="https://api.github.com/user";
        Map&lt;String, String&gt; headers2=new HashMap&lt;&gt;(2);
        String token="Bearer "+jsonObject.getString("access_token");
        headers2.put("Authorization",token);
        String userInfo= HttpUtils.httpGet(getUserInfoUrl,headers2,null);
        System.out.println("userInfo:"+userInfo);
        return userInfo;
    }</code></pre> 
<h3 id="h_644330358_8">运行效果</h3> 
<h4 id="h_644330358_9">1.前端页面授权登录</h4> 
<p></p> 
<p class="img-center"><img alt="" height="244" src="https://images2.imgbox.com/66/f2/LTfSwM3c_o.png" width="385"></p> 
<h4 id="h_644330358_10">2.GitHub用户名与密码登录</h4> 
<p></p> 
<p class="img-center"><img alt="" height="750" src="https://images2.imgbox.com/44/d4/JAkkoVDk_o.png" width="659"></p> 
<h4 id="h_644330358_11">3.GitHub授权登录</h4> 
<p></p> 
<p class="img-center"><img alt="" height="829" src="https://images2.imgbox.com/ac/71/pkvk41Kd_o.png" width="720"></p> 
<h4 id="h_644330358_12">4.回调显示用户信息</h4> 
<p></p> 
<p class="img-center"><img alt="" height="133" src="https://images2.imgbox.com/c8/12/BwaSKThD_o.png" width="720"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e7a53af502d78ddbd28aa8874df0ac8d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【软考】系统架构设计风格分类的个人理解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1decabbef12cf45d6119f2cf06d5d657/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">24款热门数据可视化工具 你用过哪些？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>