<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【STM32】串口通信基本原理（超基础、详细版） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【STM32】串口通信基本原理（超基础、详细版）" />
<meta property="og:description" content="STM32F1xx官方资料：
《STM32中文参考手册V10》-第25章通用同步异步收发器（USART)
通信接口背景知识 设备之间通信的方式 一般情况下，设备之间的通信方式可以分成并行通信和串行通信两种。它们的区别是：
并、串行通信的区别 并行通信串行通信传输原理数据各个位同时传输数据按位顺序传输优点速度快占用引脚资源少缺点占用引脚资源多速度相对较慢 串行通信的分类 1、按照数据传送方向，分为：
单工：数据传输只支持数据在一个方向上传输；半双工：允许数据在两个方向上传输。但是，在某一时刻，只允许数据在一个方向上传输，它实际上是一种切换方向的单工通信；它不需要独立的接收端和发送端，两者可以合并一起使用一个端口。全双工：允许数据同时在两个方向上传输。因此，全双工通信是两个单工通信方式的结合，需要独立的接收端和发送端。 2、按照通信方式，分为：
同步通信：带时钟同步信号传输。比如：SPI，IIC通信接口。异步通信：不带时钟同步信号。比如：UART(通用异步收发器)，单总线。 在同步通讯中，收发设备上方会使用一根信号线传输信号，在时钟信号的驱动下双方进行协调，同步数据。例如，通讯中通常双方会统一规定在时钟信号的上升沿或者下降沿对数据线进行采样。
在异步通讯中不使用时钟信号进行数据同步，它们直接在数据信号中穿插一些用于同步的信号位，或者将主题数据进行打包，以数据帧的格式传输数据。通讯中还需要双方规约好数据的传输速率（也就是波特率）等，以便更好地同步。常用的波特率有4800bps、9600bps、115200bps等。
在同步通讯中，数据信号所传输的内容绝大部分是有效数据，而异步通讯中会则会包含数据帧的各种标识符，所以同步通讯效率高，但是同步通讯双方的时钟允许误差小，稍稍时钟出错就可能导致数据错乱，异步通讯双方的时钟允许误差较大。
常见的串行通信接口 常见的串行通信接口 通信标准引脚说明通信方式通信方向 UART
（通用异步收发器）
TXD：发送端
RXT：接收端
GND：共地
异步通信全双工 1-wire
（单总线）
DQ：发送/接收端异步通信半双工SPI SCK：同步时钟
MISO：主机输入，从机输出
MOSI：主机输出，从机输入
同步通信全双工I2C SCK：同步时钟
SDA：数据输入/输出端
同步通信半双工 STM32串口通信基础 STM32的串口通信接口有两种，分别是：UART（通用异步收发器）、USART（通用同步异步收发器）。而对于大容量STM32F10x系列芯片，分别有3个USART和2个UART。
UART引脚连接方法 RXD：数据输入引脚，数据接受；TXD：数据发送引脚，数据发送。 对于两个芯片之间的连接，两个芯片GND共地，同时TXD和RXD交叉连接。这里的交叉连接的意思就是，芯片1的RxD连接芯片2的TXD，芯片2的RXD连接芯片1的TXD。这样，两个芯片之间就可以进行TTL电平通信了。
若是芯片与PC机（或上位机）相连，除了共地之外，就不能这样直接交叉连接了。尽管PC机和芯片都有TXD和RXD引脚，但是通常PC机（或上位机）通常使用的都是RS232接口（通常为DB9封装），因此不能直接交叉连接。RS232接口是9针（或引脚），通常是TxD和RxD经过电平转换得到的。故，要想使得芯片与PC机的RS232接口直接通信，需要也将芯片的输入输出端口也电平转换成rs232类型，再交叉连接。
经过电平转换后，芯片串口和rs232的电平标准是不一样的：
单片机的电平标准（TTL电平）：&#43;5V表示1，0V表示0；Rs232的电平标准：&#43;15/&#43;13 V表示0，-15/-13表示1。 RS-232通讯协议标准串口的设备间通讯结构图如下： 所以单片机串口与PC串口通信就应该遵循下面的连接方式：在单片机串口与上位机给出的rs232口之间，通过电平转换电路(如下面图中的Max232芯片) 实现TTL电平与RS232电平之间的转换。
具体要了解RS232串口的，可以查看链接RS232串口简介。
STM32的UART特点 全双工异步通信；分数波特率发生器系统，提供精确的波特率。发送和接受共用的可编程波特率，最高可达4.5Mbits/s；可编程的数据字长度（8位或者9位）；可配置的停止位（支持1或者2位停止位）；可配置的使用DMA多缓冲器通信；单独的发送器和接收器使能位；检测标志：① 接受缓冲器 ②发送缓冲器空 ③传输结束标志；多个带标志的中断源，触发中断；其他：校验控制，四个错误检测标志。 串口通信过程 STM32中UART参数 串口通讯的数据包由发送设备通过自身的TXD接口传输到接收设备的RXD接口，通讯双方的数据包格式要规约一致才能正常收发数据。STM32中串口异步通信需要定义的参数：起始位、数据位（8位或者9位）、奇偶校验位（第9位）、停止位（1,15,2位）、波特率设置。
UART串口通信的数据包以帧为单位，常用的帧结构为：1位起始位&#43;8位数据位&#43;1位奇偶校验位（可选）&#43;1位停止位。如下图所示：
奇偶校验位分为奇校验和偶校验两种，是一种简单的数据误码校验方法。奇校验是指每帧数据中，包括数据位和奇偶校验位的全部9个位中1的个数必须为奇数；偶校验是指每帧数据中，包括数据位和奇偶校验位的全部9个位中1的个数必须为偶数。
校验方法除了奇校验(odd)、偶校验(even)之外，还可以有：0 校验(space)、1 校验(mark)以及无校验(noparity)。 0/1校验：不管有效数据中的内容是什么，校验位总为0或者1。
UART（USART）框图 这个框图分成上、中、下三个部分。本文大概地讲述一下各个部分的内容，具体的可以看《STM32中文参考手册》中的描述。
框图的上部分，数据从RX进入到接收移位寄存器，后进入到接收数据寄存器，最终供CPU或者DMA来进行读取；数据从CPU或者DMA传递过来，进入发送数据寄存器，后进入发送移位寄存器，最终通过TX发送出去。
然而，UART的发送和接收都需要波特率来进行控制的，波特率是怎样控制的呢？
这就到了框图的下部分，在接收移位寄存器、发送移位寄存器都还有一个进入的箭头，分别连接到接收器控制、发送器控制。而这两者连接的又是接收器时钟、发送器时钟。也就是说，异步通信尽管没有时钟同步信号，但是在串口内部，是提供了时钟信号来进行控制的。而接收器时钟和发送器时钟有是由什么控制的呢？
可以看到，接收器时钟和发送器时钟又被连接到同一个控制单元，也就是说它们共用一个波特率发生器。同时也可以看到接收器时钟（发生器时钟）的计算方法、USRRTDIV的计算方法。
这里需要知道一个知识点：
UART1的时钟：PCLK2（高速）；UART2、UART3、UART4的时钟：PCLK1（低速）。 框图的中部分，涉及到UART（USART）的中断控制部分，在后面的文章中会具体介绍到。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/dbb80d8ccae2fd1fd234b548d599c8e6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-04-12T13:26:02+08:00" />
<meta property="article:modified_time" content="2018-04-12T13:26:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【STM32】串口通信基本原理（超基础、详细版）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>STM32F1xx官方资料：</p> 
<p>《STM32中文参考手册V10》-第25章通用同步异步收发器（USART)</p> 
<p> </p> 
<h3>通信接口背景知识</h3> 
<h4>设备之间通信的方式</h4> 
<p>一般情况下，设备之间的通信方式可以分成<strong>并行通信和串行通信</strong>两种。它们的区别是：</p> 
<table align="center" border="1" cellpadding="1" cellspacing="1"><caption>
   并、串行通信的区别 
 </caption><tbody><tr><td> </td><td style="text-align:center;">并行通信</td><td style="text-align:center;">串行通信</td></tr><tr><td>传输原理</td><td>数据各个位同时传输</td><td>数据按位顺序传输</td></tr><tr><td>优点</td><td>速度快</td><td>占用引脚资源少</td></tr><tr><td>缺点</td><td>占用引脚资源多</td><td>速度相对较慢</td></tr></tbody></table> 
<h4>串行通信的分类</h4> 
<p>1、<strong>按照数据传送方向</strong>，分为：</p> 
<ul><li><strong>单工：数据传输只支持数据在一个方向上传输；</strong></li><li><strong>半双工：允许数据在两个方向上传输。但是，在某一时刻，只允许数据在一个方向上传输</strong>，它实际上是一种切换方向的单工通信；<strong>它不需要独立的接收端和发送端，两者可以合并一起使用一个端口</strong>。</li><li><strong>全双工：允许数据同时在两个方向上传输</strong>。因此，全双工通信是两个单工通信方式的结合，<strong>需要独立的接收端和发送端</strong>。</li></ul> 
<p style="text-align:center;"><img alt="" class="has" src="https://images2.imgbox.com/fd/01/DZnuTKDv_o.png"></p> 
<p>2、<strong>按照通信方式</strong>，分为：</p> 
<ul><li><strong>同步通信：带时钟同步信号传输。比如：SPI，IIC通信接口。</strong></li><li><strong>异步通信：不带时钟同步信号。比如：UART(通用异步收发器)，单总线。</strong></li></ul> 
<p><strong>在同步通讯中，收发设备上方会使用一根信号线传输信号，在时钟信号的驱动下双方进行协调，同步数据。</strong>例如，通讯中通常双方会统一规定在时钟信号的上升沿或者下降沿对数据线进行采样。</p> 
<p><strong>在异步通讯中不使用时钟信号进行数据同步，它们直接在数据信号中穿插一些用于同步的信号位，或者将主题数据进行打包，以数据帧的格式传输数据。通讯中还需要双方规约好数据的传输速率（也就是波特率）等，以便更好地同步。</strong>常用的波特率有4800bps、9600bps、115200bps等。</p> 
<p><strong>在同步通讯中，数据信号所传输的内容绝大部分是有效数据，而异步通讯中会则会包含数据帧的各种标识符，所以同步通讯效率高，但是同步通讯双方的时钟允许误差小，稍稍时钟出错就可能导致数据错乱，异步通讯双方的时钟允许误差较大。</strong></p> 
<h4>常见的串行通信接口</h4> 
<p> </p> 
<table align="center" border="1" cellpadding="1" cellspacing="1"><caption>
   常见的串行通信接口 
 </caption><tbody><tr><td style="text-align:center;">通信标准</td><td style="text-align:center;">引脚说明</td><td style="text-align:center;">通信方式</td><td style="text-align:center;">通信方向</td></tr><tr><td style="text-align:center;"> <p>UART</p> <p>（通用异步收发器）</p> </td><td> <p>TXD：发送端</p> <p>RXT：接收端</p> <p>GND：共地</p> </td><td>异步通信</td><td>全双工</td></tr><tr><td style="text-align:center;vertical-align:middle;"> <p>1-wire</p> <p>（单总线）</p> </td><td>DQ：发送/接收端</td><td>异步通信</td><td>半双工</td></tr><tr><td style="text-align:center;">SPI</td><td> <p>SCK：同步时钟</p> <p>MISO：主机输入，从机输出</p> <p>MOSI：主机输出，从机输入</p> </td><td>同步通信</td><td>全双工</td></tr><tr><td style="text-align:center;">I2C</td><td> <p>SCK：同步时钟</p> <p>SDA：数据输入/输出端</p> </td><td>同步通信</td><td>半双工</td></tr></tbody></table> 
<p> </p> 
<h3>STM32串口通信基础</h3> 
<p>STM32的串口通信接口有两种，分别是：<strong>UART（通用异步收发器）、USART（通用同步异步收发器）。而对于大容量STM32F10x系列芯片，分别有3个USART和2个UART。</strong></p> 
<h4>UART引脚连接方法</h4> 
<ul><li>RXD：数据输入引脚，数据接受；</li><li>TXD：数据发送引脚，数据发送。</li></ul> 
<p style="text-align:center;"><img alt="" class="has" src="https://images2.imgbox.com/46/27/Bo2wiT6J_o.png"></p> 
<p>对于两个芯片之间的连接，两个芯片GND共地，同时TXD和RXD交叉连接。这里的交叉连接的意思就是，芯片1的RxD连接芯片2的TXD，芯片2的RXD连接芯片1的TXD。这样，<strong>两个芯片之间就可以进行TTL电平通信了</strong>。</p> 
<p style="text-align:center;"><img alt="" class="has" src="https://images2.imgbox.com/f2/bf/uJCsIxnV_o.png"></p> 
<p>若是芯片与PC机（或上位机）相连，除了共地之外，就不能这样直接交叉连接了。尽管PC机和芯片都有TXD和RXD引脚，但是<strong>通常PC机（或上位机）通常使用的都是RS232接口（通常为DB9封装）</strong>，因此不能直接交叉连接。<strong>RS232接口是9针（或引脚），通常是TxD和RxD经过电平转换得到的。故，要想使得芯片与PC机的RS232接口直接通信，需要也将芯片的输入输出端口也电平转换成rs232类型，再交叉连接。</strong></p> 
<p>经过电平转换后，芯片串口和rs232的电平标准是不一样的：</p> 
<ul><li><strong>单片机的电平标准（TTL电平）：+5V表示1，0V表示0；</strong></li><li><strong>Rs232的电平标准：+15/+13 V表示0，-15/-13表示1。</strong></li></ul> 
<p>RS-232通讯协议标准串口的设备间通讯结构图如下： </p> 
<p style="text-align:center;"><img alt="" class="has" src="https://images2.imgbox.com/ae/c7/rR2YrOKm_o.png"></p> 
<p>所以单<strong>片机串口与PC串口通信就应该遵循下面的连接方式：在单片机串口与上位机给出的rs232口之间，通过电平转换电路(如下面图中的Max232芯片) 实现TTL电平与RS232电平之间的转换。</strong></p> 
<p style="text-align:center;"><img alt="" class="has" src="https://images2.imgbox.com/99/66/HapU7yC3_o.jpg"></p> 
<p>具体要了解RS232串口的，可以查看链接<a href="http://www.21ic.com/jichuzhishi/datasheet/RS232/jiekou/187973.html" rel="nofollow">RS232串口简介</a>。</p> 
<h4>STM32的UART特点</h4> 
<ul><li><strong>全双工异步通信</strong>；</li><li><strong>分数波特率发生器系统，提供精确的波特率</strong>。发送和接受共用的可编程波特率，最高可达4.5Mbits/s；</li><li>可编程的数据字长度（8位或者9位）；</li><li>可配置的停止位（支持1或者2位停止位）；</li><li><strong>可配置的使用DMA多缓冲器通信</strong>；</li><li><strong>单独的发送器和接收器使能位</strong>；</li><li>检测标志：① 接受缓冲器  ②发送缓冲器空 ③传输结束标志；</li><li><strong>多个带标志的中断源，触发中断</strong>；</li><li>其他：校验控制，四个错误检测标志。</li></ul> 
<p> </p> 
<h3>串口通信过程</h3> 
<p style="text-align:center;"><img alt="" class="has" src="https://images2.imgbox.com/ef/98/qqIuNUnZ_o.png"></p> 
<h4>STM32中UART参数</h4> 
<p>串口通讯的数据包由发送设备通过自身的TXD接口传输到接收设备的RXD接口，通讯双方的数据包格式要规约一致才能正常收发数据。STM32中串口异步通信需要定义的参数：<strong>起始位、数据位（8位或者9位）、奇偶校验位（第9位）、停止位（1,15,2位）、波特率设置。</strong></p> 
<p><strong>UART串口通信的数据包以帧为单位，常用的帧结构为：1位起始位+8位数据位+1位奇偶校验位（可选）+1位停止位。</strong>如下图所示：</p> 
<p style="text-align:center;"><img alt="" class="has" src="https://images2.imgbox.com/37/bf/Yuiaulve_o.png"></p> 
<p>奇偶校验位分为奇校验和偶校验两种，是一种简单的数据误码校验方法。<strong>奇校验是指每帧数据中，包括数据位和奇偶校验位的全部9个位中1的个数必须为奇数；偶校验是指每帧数据中，包括数据位和奇偶校验位的全部9个位中1的个数必须为偶数。</strong></p> 
<p><strong>校验方法除了奇校验(odd)、偶校验(even)之外，还可以有：0 校验(space)、1 校验(mark)以及无校验(noparity)。</strong> 0/1校验：不管有效数据中的内容是什么，校验位总为0或者1。</p> 
<h4>UART（USART）框图</h4> 
<p style="text-align:center;"><img alt="" class="has" src="https://images2.imgbox.com/f3/9f/OmbPxDuz_o.jpg"></p> 
<p>这个框图分成上、中、下三个部分。本文大概地讲述一下各个部分的内容，具体的可以看《STM32中文参考手册》中的描述。</p> 
<p>框图的上部分，<strong>数据从RX进入到接收移位寄存器，后进入到接收数据寄存器，最终供CPU或者DMA来进行读取；数据从CPU或者DMA传递过来，进入发送数据寄存器，后进入发送移位寄存器，最终通过TX发送出去。</strong></p> 
<p>然而，UART的发送和接收都需要波特率来进行控制的，波特率是怎样控制的呢？</p> 
<p>这就到了框图的下部分，<strong>在接收移位寄存器、发送移位寄存器都还有一个进入的箭头，分别连接到接收器控制、发送器控制。而这两者连接的又是接收器时钟、发送器时钟。也就是说，异步通信尽管没有时钟同步信号，但是在串口内部，是提供了时钟信号来进行控制的。</strong>而接收器时钟和发送器时钟有是由什么控制的呢？</p> 
<p>可以看到，<strong>接收器时钟和发送器时钟又被连接到同一个控制单元，也就是说它们共用一个波特率发生器。</strong>同时也可以看到接收器时钟（发生器时钟）的计算方法、USRRTDIV的计算方法。</p> 
<p>这里需要知道一个知识点：</p> 
<ul><li><strong>UART1的时钟：PCLK2（高速）；</strong></li><li><strong>UART2、UART3、UART4的时钟：PCLK1（低速）。</strong></li></ul> 
<p>框图的中部分，涉及到UART（USART）的中断控制部分，在后面的文章中会具体介绍到。</p> 
<p style="text-align:center;"><img alt="" class="has" src="https://images2.imgbox.com/84/39/sghyIsUu_o.jpg"></p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/98491d64db464f95a53e687dff73e859/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于JDK8的JVM参数设置和GC日志解读</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/662b1252525819b220f85f8d57427bfc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">第004篇：ArcGIS中制作一张图中有多个图框（一幅多图）的方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>