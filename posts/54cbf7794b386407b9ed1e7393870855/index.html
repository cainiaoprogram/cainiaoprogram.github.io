<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ansible命令详解 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ansible命令详解" />
<meta property="og:description" content="1.comand模块 （默认模块）
用于在远程主机(被管理的主机)上执行某个命令
注：A. 不能变量$HOME和操作等&#34;&lt;&#34;，&#34;&gt;&#34;，&#34;|&#34;，&#34;;“和”&amp;&#34;
#在默认家目录下创建一个 ansible.txt的文件 [root@cdhnode1 ~]# ansible all -m command -a &#34; touch ansible.txt &#34; #指定切换到/home/zx目录下，再创建一个ansible.txt的文件 [root@cdhnode1 ~]# ansible all -a &#34;chdir=/home/zx touch ansible.txt &#34; [root@cdhnode1 ~]# ansible all -m command -a &#34; creates=/root/ansible.txt touch ansible2.txt &#34; # 当/home/zx/ansible.txt文件存，就执行删除操作 [root@cdhnode1 ~]# ansible all -m command -a &#34; chdir=/home/zx removes=ansible.txt rm ansible.txt &#34; 2.copy模块
把管理端的数据分发到被管理端服务器上
[root@cdhnode1 ~]# ansible all -m copy -a &#34;src=/root/test.txt dest=/root/ &#34; [root@cdhnode1 ~]# ansible all -m copy -a &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/54cbf7794b386407b9ed1e7393870855/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-06-07T12:57:07+08:00" />
<meta property="article:modified_time" content="2020-06-07T12:57:07+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ansible命令详解</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>1.comand模块 （默认模块）</strong></p> 
<p>用于在远程主机(被管理的主机)上执行某个命令<br> 注：A. 不能变量$HOME和操作等"&lt;"，"&gt;"，"|"，";“和”&amp;"</p> 
<p><img src="https://images2.imgbox.com/26/91/29rAE4cJ_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment">#在默认家目录下创建一个 ansible.txt的文件</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible   all -m command   -a "   touch   ansible.txt "</span>
<span class="token comment">#指定切换到/home/zx目录下，再创建一个ansible.txt的文件</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible   all  -a "chdir=/home/zx   touch  ansible.txt   "</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible   all -m command   -a "  creates=/root/ansible.txt   touch  ansible2.txt   "</span>
<span class="token comment"># 当/home/zx/ansible.txt文件存，就执行删除操作</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible   all -m command   -a " chdir=/home/zx  removes=ansible.txt   rm   ansible.txt "</span>
</code></pre> 
<p><strong>2.copy模块</strong><br> 把管理端的数据分发到被管理端服务器上<br> <img src="https://images2.imgbox.com/25/65/h4j9QevU_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible   all -m copy -a "src=/root/test.txt     dest=/root/ "</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible   all -m copy -a "src=/root/test.txt     dest=/root/   owner=ldg  group=ldg  backup=yes   mode=600 "</span>
<span class="token comment">##创建一个密码文件</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible   all -m copy -a " content=123456    dest=/root/mytest.password "</span>
</code></pre> 
<p><strong>3.shell模块( 万能模块)</strong></p> 
<pre><code>   功能: 在被管理机中执行操作

   注： 1.没有 command 模块的限制

           2.参数列表与command 相拟
</code></pre> 
<p><strong>4.script 模块</strong><br> 需求，要在我管理的主机上批量创建用户</p> 
<p>要在管理机上执行批量创建用户的脚本</p> 
<p>以前要执行的方式:</p> 
<p>a.创批量创建用户的脚本 ----addUsers.sh</p> 
<p>b. 分发到各个机子上</p> 
<p>c.设置执行权限 chmod a+x</p> 
<p>d.执行要脚本</p> 
<p>使用 ansible在管理机上编写好脚本，会自动分发并执行</p> 
<p>注： 参数列表功能与command模块相拟</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m script  -a "/root/test.sh  "</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token shebang important">#!/bin/bash</span>
m<span class="token operator">=</span>1
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span> <span class="token function">cat</span> ./class.txt <span class="token variable">)</span></span>
<span class="token keyword">do</span>
 user_name<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span> <span class="token keyword">echo</span> <span class="token string">"<span class="token variable">$i</span>"</span> <span class="token operator">|</span> <span class="token function">awk</span> -F:  <span class="token string">'{print <span class="token variable">$1</span>} '</span><span class="token variable">)</span></span>
 user_id<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span> <span class="token keyword">echo</span> <span class="token string">"<span class="token variable">$i</span>"</span> <span class="token operator">|</span> <span class="token function">awk</span> -F:  <span class="token string">'{print <span class="token variable">$2</span>} '</span><span class="token variable">)</span></span>
 user_passwd<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span> <span class="token keyword">echo</span> <span class="token string">"<span class="token variable">$i</span>"</span> <span class="token operator">|</span> <span class="token function">awk</span> -F:  <span class="token string">'{print <span class="token variable">$3</span>} '</span><span class="token variable">)</span></span>
 <span class="token function">useradd</span>  <span class="token variable">${user_id}</span> -c  <span class="token variable">${user_name}</span>
 <span class="token keyword">echo</span> <span class="token variable">${user_passwd}</span> <span class="token operator">|</span> <span class="token function">passwd</span>  <span class="token variable">${user_id}</span> --stdin <span class="token operator">&amp;</span><span class="token operator">&gt;</span> /dev/null
 <span class="token keyword">echo</span> <span class="token string">"创建...<span class="token variable">${m}</span>个学生用户 <span class="token variable">${user_name}</span> 帐号为: <span class="token variable">${user_id}</span>  密码为：<span class="token variable">${user_passwd}</span>  成功..."</span>
 <span class="token variable"><span class="token punctuation">((</span> m<span class="token operator">=</span>m<span class="token operator">+</span><span class="token number">1</span> <span class="token punctuation">))</span></span>
<span class="token keyword">done</span>
<span class="token keyword">echo</span> <span class="token string">"批量创建用户完成"</span>

</code></pre> 
<pre><code class="prism language-bash"><span class="token shebang important">#!/bin/bash</span>
<span class="token keyword">echo</span> <span class="token string">"删除用户操作"</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token variable"><span class="token variable">$(</span> <span class="token function">cat</span> ./class.txt <span class="token variable">)</span></span>
<span class="token keyword">do</span>
  user_id<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span> <span class="token keyword">echo</span> $<span class="token punctuation">{<!-- --></span>i<span class="token punctuation">}</span> <span class="token operator">|</span> <span class="token function">awk</span> -F <span class="token keyword">:</span> <span class="token string">'{print <span class="token variable">$2</span>}'</span> <span class="token variable">)</span></span>
  <span class="token function">userdel</span> <span class="token variable">${user_id}</span> -r
  <span class="token keyword">echo</span> <span class="token string">"删除用户:<span class="token variable">${user_id}</span> 成功..."</span>
<span class="token keyword">done</span>
<span class="token keyword">echo</span> <span class="token string">"批量删除用户成功！"</span>

</code></pre> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># cat class.txt</span>
陈玲:test1:268808::
高攀:test2:213184::
敖容:test3:10446X::
</code></pre> 
<p>a.分发 class.txt</p> 
<p>b.管理机上ansible 来执行addUser.sh 脚本</p> 
<p><strong>5.user模块</strong><br> 管理用户帐号的模块<br> <img src="https://images2.imgbox.com/a1/b7/RozKBo08_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b9/46/IzfSNjZt_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash">
<span class="token comment">#在每个被管理的主机上创建名为user_ldg的用户</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible  all -m user   -a " name=user_ldg  comment='my create user'  "</span>


<span class="token comment">#删除指定用户 </span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible  all -m user   -a " name=user_ldg    state=absent  "</span>


<span class="token comment">#创建一个用户 并指定密码( 加密过后密文 )</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible  all -m user   -a 'name=user_ldg2   password=$6$ukkMjpa8$qLqXwaKzyhCdBU9WapXwWSviUFnP92338GhIb5/LO2AXLUW.PVnHCIMMXq4FDyhAPKoBF/Degii/.S8H26Qbp.'</span>

</code></pre> 
<p><strong>6. file模块</strong></p> 
<p>主要用于对文件/目录操作，如：属性，创建文件/目录，创建链接文件，删除等操作<br> <img src="https://images2.imgbox.com/4e/0a/DrHdlIPh_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/3b/e3/Ke5ZcyAx_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment">#递归创建/root.ansible_test/A 目录</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m file  -a " dest=/root/ansible_test/A  state=directory  "</span>


<span class="token comment">#递归创建/root.ansible_test/A 目录</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m file  -a " dest=/root/ansible_test/A/test1.txt state=touch  "</span>

<span class="token comment">#创建文件，并指定所有者或所属组</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m file  -a " dest=/root/ansible_test/A/test2.txt state=touch owner=ldg  group=ldg   "</span>


<span class="token comment">#删除文件</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m file  -a " dest=/root/ansible_test/A/test2.txt state=absent  "</span>

<span class="token comment">#递归删除/root/ansible_test/A</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m file  -a " dest=/root/ansible_test/A   state=absent  "</span>



<span class="token comment">#创建软连接文件</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m file  -a " src=/root/ansible_test/A/test1.txt  dest=/root/ansible_test/A/test1.txt.ln   state=link  "</span>

</code></pre> 
<p>对目录能不能创建硬连接 ？？？？ 不能</p> 
<p>对文件能不能创建硬连接 ?? 能</p> 
<p><strong>7 cron 模块</strong><br> 用于管理定时计划任务模块 类拟于crontab -e 命令操作<br> 注： 1.建议给任务指定个name计划名，方便执行删除操作</p> 
<p>2.如果不指定计划的时间，那计划时间五个参数默认都为星号</p> 
<pre><code class="prism language-bash"><span class="token comment">#创建任务计划任务  计划任务名为:默认为None </span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m cron -a "  job='/usr/bin/date  &gt;&gt; /root/a.txt'    "</span>

<span class="token comment">#创建一个任务计划，并指定名称为:create_date</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m cron -a "  job='/usr/bin/date  &gt;&gt; /root/a.txt'   name=create_date   "</span>

<span class="token comment">#删除指定的计划名为create_date</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m cron -a " name=create_date   state=absent  "</span>

<span class="token comment">#对create_date这个计划进行修改前进行备份,备份至/tem/cronXXXXXX文件中</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m cron -a "  minute=0  hour=23   weekday=0     job='/usr/bin/date  &gt;&gt; /root/a.txt'   name=create_date   backup=yes   "</span>

</code></pre> 
<p><strong>8.yum模块</strong><br> yum源软件管理(安装，卸载,更新)</p> 
<pre><code class="prism language-bash"><span class="token comment">#卸载</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m yum   -a " name=tree state=absent     "</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m yum   -a " name=tree state=removed"</span>



<span class="token comment">#安装</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m yum   -a " name=tree state=installed "</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment"># ansible all -m yum   -a " name=tree state=present "</span>
</code></pre> 
<p><strong>9.fetch模块</strong><br> 拉取文件 从远程的被管理机复制文件到管理机</p> 
<pre><code class="prism language-bash"> <span class="token comment">#从远程的被管理机上拉取test.txt文件，存入到本机（管理机中）拉取的文件分别存到各自ip地址所对应的目录中</span>
<span class="token punctuation">[</span>root@cdhnode1 192.168.100.52<span class="token punctuation">]</span><span class="token comment">#  ansible all  -m fetch  -a " src=/root/test.txt   dest=/root/test    "</span>

</code></pre> 
<p><strong>10.service服务模块</strong></p> 
<pre><code class="prism language-bash"><span class="token comment">#启动服务</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment">#  ansible all  -m service   -a " name=crond  state=started   "</span>

<span class="token comment">#重启</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment">#  ansible all  -m service   -a " name=crond  state=restarted   "</span>


<span class="token comment">#关闭服务</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment">#  ansible all  -m service   -a " name=crond  state=stopped   "</span>


<span class="token comment">#把服务加入开机启动</span>
<span class="token punctuation">[</span>root@cdhnode1 ~<span class="token punctuation">]</span><span class="token comment">#  ansible all  -m service   -a " name=crond  enabled=yes  "</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b936ca871f0887059c5a56813ebe3729/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">网页上的文本不让你复制下载？老司机教你几招，轻松免费复制</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fb26cd91f1efaf4715f99ac4f6866165/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IDEA命令行缩短器助你解决此问题：Command line is too long. Shorten command line...</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>