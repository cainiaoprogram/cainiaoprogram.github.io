<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>51单片机学习-AT24C02数据存储&amp;秒表（定时器扫描按键数码管） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="51单片机学习-AT24C02数据存储&amp;秒表（定时器扫描按键数码管）" />
<meta property="og:description" content="首先编写I2C模块，根据下面的原理图进行位声明：
sbit I2C_SCL = P2^1; sbit I2C_SDA = P2^0; 再根据下面的时序结构图编写函数：
/** * @brief I2C开始 * @param 无 * @retval 无 */ void I2C_Start(void) { I2C_SDA = 1; I2C_SCL = 1; I2C_SDA = 0; I2C_SCL = 0; } /** * @brief I2C停止 * @param 无 * @retval 无 */ void I2C_Stop(void) { I2C_SDA = 0; I2C_SCL = 1; I2C_SDA = 1; } /** * @brief I2C发送一个字节 * @param 要发送的字节 * @retval 无 */ void I2C_SendByte(unsigned char Byte) { unsigned char i; for(i = 0; i &lt; 8; i &#43;&#43;) { I2C_SDA = Byte &amp; (0x80 &gt;&gt; i); //由高位到低位依次取出写入 I2C_SCL = 1; I2C_SCL = 0; } } /** * @brief I2C接受一个字节 * @param 无 * @retval 接收到的字节 */ unsigned char I2C_ReceiveByte(void) { unsigned char i, Byte = 0x00; I2C_SDA = 1; for(i = 0; i &lt; 8; i &#43;&#43;) { I2C_SCL = 1; if(I2C_SDA) {Byte |= (0x80 &gt;&gt; i);} //由高位到低位把读到的 取出 I2C_SCL = 0; } return Byte; } /** * @brief I2C发送应答 * @param 应答位，0为应答，1为非应答 * @retval 无 */ void I2C_SendAck(unsigned char AckBit) { I2C_SDA = AckBit; I2C_SCL = 1; I2C_SCL = 0; } /** * @brief I2C接收应答 * @param 无 * @retval 接收到的应答位，0为应答，1为非应答 */ unsigned char I2C_ReceiveAck(void) { unsigned char AckBit; I2C_SDA = 1; I2C_SCL = 1; AckBit = I2C_SDA; I2C_SCL = 0; return AckBit; } 接下来利用写好的I2C模块，创建AT24C02模块来凑成数据帧：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/80b7caed25cd6ac1e28daaf2994ea479/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-04T13:28:46+08:00" />
<meta property="article:modified_time" content="2023-08-04T13:28:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">51单片机学习-AT24C02数据存储&amp;秒表（定时器扫描按键数码管）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/54/a7/LricASUz_o.png" alt="在这里插入图片描述"><br> <strong>首先编写I2C模块，根据下面的原理图进行位声明：</strong><br> <img src="https://images2.imgbox.com/a3/66/Om3tSNrt_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c">sbit I2C_SCL <span class="token operator">=</span> P2<span class="token operator">^</span><span class="token number">1</span><span class="token punctuation">;</span>
sbit I2C_SDA <span class="token operator">=</span> P2<span class="token operator">^</span><span class="token number">0</span><span class="token punctuation">;</span>
</code></pre> 
<hr> 
<hr> 
<p><strong>再根据下面的时序结构图编写函数：</strong><br> <img src="https://images2.imgbox.com/30/0e/PKPpGHlB_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c"><span class="token comment">/**
  * @brief I2C开始
  * @param 无
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	I2C_SDA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> 
	I2C_SCL <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> 
	
	I2C_SDA <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	I2C_SCL <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">/**
  * @brief I2C停止
  * @param 无
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">I2C_Stop</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	I2C_SDA <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	
	I2C_SCL <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	I2C_SDA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<hr> 
<p><img src="https://images2.imgbox.com/68/7f/d6uzHOIx_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c"><span class="token comment">/**
  * @brief I2C发送一个字节
  * @param 要发送的字节
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">I2C_SendByte</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Byte<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		I2C_SDA <span class="token operator">=</span> Byte <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">0x80</span> <span class="token operator">&gt;&gt;</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//由高位到低位依次取出写入</span>
    	I2C_SCL <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	    I2C_SCL <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<hr> 
<p><img src="https://images2.imgbox.com/7f/56/1pfMbgmc_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c"><span class="token comment">/**
  * @brief I2C接受一个字节
  * @param 无
  * @retval 接收到的字节
  */</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">I2C_ReceiveByte</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> i<span class="token punctuation">,</span> Byte <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span>
	I2C_SDA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	
	<span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	  I2C_SCL <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	  <span class="token keyword">if</span><span class="token punctuation">(</span>I2C_SDA<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>Byte <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">0x80</span> <span class="token operator">&gt;&gt;</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token comment">//由高位到低位把读到的 取出</span>
	  I2C_SCL <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">return</span> Byte<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<hr> 
<p><img src="https://images2.imgbox.com/b9/68/C4oVxzrX_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c"><span class="token comment">/**
  * @brief I2C发送应答
  * @param 应答位，0为应答，1为非应答
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">I2C_SendAck</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> AckBit<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	I2C_SDA <span class="token operator">=</span> AckBit<span class="token punctuation">;</span>
	I2C_SCL <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	I2C_SCL <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">/**
  * @brief I2C接收应答
  * @param 无
  * @retval 接收到的应答位，0为应答，1为非应答
  */</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">I2C_ReceiveAck</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> AckBit<span class="token punctuation">;</span>
	I2C_SDA <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	I2C_SCL <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	AckBit <span class="token operator">=</span> I2C_SDA<span class="token punctuation">;</span>
	I2C_SCL <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	
	<span class="token keyword">return</span> AckBit<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<hr> 
<p><strong>接下来利用写好的I2C模块，创建AT24C02模块来凑成数据帧：</strong></p> 
<p><img src="https://images2.imgbox.com/fd/c1/klPHK1lU_o.png" alt="在这里插入图片描述"><br> 同样根据图中的时序模拟就可以了：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;REGX52.H&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"I2C.h"</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">AT24C02_ADDRESS</span>  <span class="token expression"><span class="token number">0xA0</span> </span><span class="token comment">//写地址  </span></span>

<span class="token comment">/**
  * @brief AT24C02写入一个字节
  * @param 要写入字节的地址,0~255
  * @param 要写入的数据
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">AT24C02_WriteByte</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> WordAddress<span class="token punctuation">,</span> Data<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_SendByte</span><span class="token punctuation">(</span>AT24C02_ADDRESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_ReceiveAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_SendByte</span><span class="token punctuation">(</span>WordAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_ReceiveAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_SendByte</span><span class="token punctuation">(</span>Data<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_ReceiveAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">/**
  * @brief AT24C02读取一个字节
  * @param 要读出字节的地址 0~255
  * @retval 读出的数据
  */</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">AT24C02_ReadByte</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> WordAddress<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> Data<span class="token punctuation">;</span>
	
	<span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_SendByte</span><span class="token punctuation">(</span>AT24C02_ADDRESS<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_ReceiveAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_SendByte</span><span class="token punctuation">(</span>WordAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_ReceiveAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">I2C_Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_SendByte</span><span class="token punctuation">(</span>AT24C02_ADDRESS <span class="token operator">|</span> <span class="token number">0x01</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_ReceiveAck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Data <span class="token operator">=</span> <span class="token function">I2C_ReceiveByte</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">I2C_SendAck</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//非应答</span>
	<span class="token function">I2C_Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">return</span> Data<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<hr> 
<p>在main中调用看一下效果如何（这种存储，写入之后是掉电不丢失的）：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;REGX52.H&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Delay.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Key.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"LCD1602.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"AT24C02.h"</span></span>

<span class="token keyword">unsigned</span> <span class="token keyword">char</span> Data<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">LCD_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">AT24C02_WriteByte</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">66</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//写完不要马上去读，写需要时间</span>
	Data <span class="token operator">=</span> <span class="token function">AT24C02_ReadByte</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Data<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ee/23/yUOcJNQf_o.jpg" alt="在这里插入图片描述"></p> 
<hr> 
<hr> 
<p><strong>接下来配合上按键就可以做出一个按键存储器啦，有了之前编写的模块，只要适当地调用就可以了，以下是按键存储器的main.c文件代码：<br> 按键1：增大数据<br> 按键2：减小数据<br> 按键3：写入<br> 按键4：读出</strong></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;REGX52.H&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Delay.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Key.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"LCD1602.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"AT24C02.h"</span></span>

<span class="token keyword">unsigned</span> <span class="token keyword">char</span> KeyNum<span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">int</span> Num<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">LCD_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Num<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		KeyNum <span class="token operator">=</span> <span class="token function">Key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token keyword">if</span><span class="token punctuation">(</span>KeyNum <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Num <span class="token operator">++</span><span class="token punctuation">;</span>
			<span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Num<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>KeyNum <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Num <span class="token operator">--</span><span class="token punctuation">;</span>
			<span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Num<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>KeyNum <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">//写入</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">AT24C02_WriteByte</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> Num <span class="token operator">%</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//Num十六位,先取低八位</span>
			<span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">AT24C02_WriteByte</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> Num <span class="token operator">%</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//存高八位</span>
			<span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			<span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Write OK"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"        "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>KeyNum <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token comment">//读出</span>
		<span class="token punctuation">{<!-- --></span>
			Num <span class="token operator">=</span> <span class="token function">AT24C02_ReadByte</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//拿到低八位</span>
			Num <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token function">AT24C02_ReadByte</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//高八位左移8位或上去</span>
			
			<span class="token function">LCD_ShowNum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> Num<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"Read OK"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">Delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">LCD_ShowString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"       "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p><strong>接下来，利用定时器扫描按键和数码管，制作一个秒表：</strong><br> 由于按键和数码管都需要中断函数，所以就为Key和Nixie都定义一个中断的时候需要执行的操作，然后在中断函数中调用它们即可。。</p> 
<p>先来看重新编写的Key模块，只要在中断函数中每隔20ms执行一次Key_Loop()就能保证读到每一次按键松开时的键码值，这样也达到了定时器扫描按键的目的</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;REGX52.H&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Delay.h"</span></span>

<span class="token keyword">unsigned</span> <span class="token keyword">char</span> Key_KeyNumber<span class="token punctuation">;</span>

<span class="token comment">/**
  * @brief 获取独立按键键码
  * @param 无
  * @retval 按下的按键的键码，范围0~4，无按键按下时返回0
  */</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">Key</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> Temp<span class="token punctuation">;</span>
	Temp <span class="token operator">=</span> Key_KeyNumber<span class="token punctuation">;</span>
	Key_KeyNumber <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	
	<span class="token keyword">return</span> Temp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * @brief 获取按键实时状态，0为松开
  * @param 无
  * @retval 无
  */</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token function">Key_GetState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">unsigned</span> <span class="token keyword">char</span> KeyNumber <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span>P3_1 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>KeyNumber <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>P3_0 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>KeyNumber <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>P3_2 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>KeyNumber <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>P3_3 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>KeyNumber <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
	
	<span class="token keyword">return</span> KeyNumber<span class="token punctuation">;</span>
<span class="token punctuation">}</span>



<span class="token keyword">void</span> <span class="token function">Key_Loop</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token comment">//捕捉按键松开瞬间，并得到键码</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">static</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> NowState<span class="token punctuation">,</span> LastState<span class="token punctuation">;</span>
	LastState <span class="token operator">=</span> NowState<span class="token punctuation">;</span>
	NowState <span class="token operator">=</span> <span class="token function">Key_GetState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>LastState <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> NowState <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//此时按键从1松开</span>
	<span class="token punctuation">{<!-- --></span>
		Key_KeyNumber <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>LastState <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> NowState <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//此时按键从2松开</span>
	<span class="token punctuation">{<!-- --></span>
		Key_KeyNumber <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>LastState <span class="token operator">==</span> <span class="token number">3</span> <span class="token operator">&amp;&amp;</span> NowState <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//此时按键从3松开</span>
	<span class="token punctuation">{<!-- --></span>
		Key_KeyNumber <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>LastState <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">&amp;&amp;</span> NowState <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">//此时按键从4松开</span>
	<span class="token punctuation">{<!-- --></span>
		Key_KeyNumber <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<hr> 
<p>接下来要改写Nixie，使定时器扫描数码管，每隔2ms调用一次Nixie_Loop();</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;REGX52.H&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Delay.h"</span></span>

<span class="token keyword">unsigned</span> <span class="token keyword">char</span> NixieTable<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0x3F</span><span class="token punctuation">,</span><span class="token number">0x06</span><span class="token punctuation">,</span><span class="token number">0x5B</span><span class="token punctuation">,</span><span class="token number">0x4F</span><span class="token punctuation">,</span><span class="token number">0x66</span><span class="token punctuation">,</span><span class="token number">0x6D</span><span class="token punctuation">,</span><span class="token number">0x7D</span><span class="token punctuation">,</span><span class="token number">0x07</span><span class="token punctuation">,</span><span class="token number">0x7F</span><span class="token punctuation">,</span><span class="token number">0x6F</span><span class="token punctuation">,</span><span class="token number">0x00</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">unsigned</span> <span class="token keyword">char</span> Nixie_Buf<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">;</span>




<span class="token keyword">void</span> <span class="token function">Nixie_SetBuf</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Location<span class="token punctuation">,</span> Number<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	Nixie_Buf<span class="token punctuation">[</span>Location<span class="token punctuation">]</span> <span class="token operator">=</span> Number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">/**
  * @brief 在对应位置显示对应数字
  * @param 位置，数字
  * @retval 无
  */</span>
<span class="token keyword">void</span> <span class="token function">Nixie_Scan</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> Location<span class="token punctuation">,</span> Number<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	P0 <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">;</span> <span class="token comment">//清零消影</span>
	<span class="token keyword">switch</span><span class="token punctuation">(</span>Location<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> P2_4 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> P2_3 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> P2_2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> P2_4 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> P2_3 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> P2_2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> P2_4 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> P2_3 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> P2_2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> P2_4 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> P2_3 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> P2_2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span> P2_4 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> P2_3 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> P2_2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span> P2_4 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> P2_3 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> P2_2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">7</span><span class="token operator">:</span> P2_4 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> P2_3 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> P2_2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token number">8</span><span class="token operator">:</span> P2_4 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> P2_3 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> P2_2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	P0 <span class="token operator">=</span> NixieTable<span class="token punctuation">[</span>Number<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">void</span> <span class="token function">Nixie_Loop</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token comment">//每调用一次就向后显示一位</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">static</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	
	<span class="token function">Nixie_Scan</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> Nixie_Buf<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	i <span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>i <span class="token operator">&gt;=</span> <span class="token number">9</span><span class="token punctuation">)</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<hr> 
<p>因此，要同时维护这两个中断，中断函数需要这样写：</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">Timer0_Routine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> interrupt <span class="token number">1</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">static</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> T0Count1<span class="token punctuation">,</span> T0Count2<span class="token punctuation">;</span>
	TL0 <span class="token operator">=</span> <span class="token number">0x66</span><span class="token punctuation">;</span>		<span class="token comment">//设置定时初值</span>
	TH0 <span class="token operator">=</span> <span class="token number">0xFC</span><span class="token punctuation">;</span>		<span class="token comment">//设置定时初值</span>
	T0Count1 <span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>T0Count1 <span class="token operator">&gt;=</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token comment">//20ms扫描一次</span>
	<span class="token punctuation">{<!-- --></span>
		T0Count1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		
    <span class="token function">Key_Loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	T0Count2 <span class="token operator">++</span><span class="token punctuation">;</span> 
	<span class="token keyword">if</span><span class="token punctuation">(</span>T0Count2 <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">//2ms扫描一次</span>
	<span class="token punctuation">{<!-- --></span>
		T0Count2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token function">Nixie_Loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p><strong>有了以上这些模块，就可以开始编写秒表了：</strong></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;REGX52.H&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Timer0.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Key.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Nixie.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Delay.h"</span></span>

<span class="token keyword">unsigned</span> <span class="token keyword">char</span> KeyNum<span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> Min<span class="token punctuation">,</span> Sec<span class="token punctuation">,</span> MiniSec<span class="token punctuation">;</span>
<span class="token keyword">unsigned</span> <span class="token keyword">char</span> RunFlag<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">Timer0_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		KeyNum <span class="token operator">=</span> <span class="token function">Key</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>KeyNum <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//启动/暂停</span>
		<span class="token punctuation">{<!-- --></span>
			RunFlag <span class="token operator">=</span> <span class="token operator">!</span>RunFlag<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>KeyNum <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">//清零复位</span>
		<span class="token punctuation">{<!-- --></span>
			Min <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			Sec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			MiniSec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		
    	<span class="token function">Nixie_SetBuf</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> Min <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">Nixie_SetBuf</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> Min <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">Nixie_SetBuf</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">Nixie_SetBuf</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> Sec <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">Nixie_SetBuf</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> Sec <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">Nixie_SetBuf</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">Nixie_SetBuf</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> MiniSec <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">Nixie_SetBuf</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> MiniSec <span class="token operator">%</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">Sec_Loop</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> <span class="token comment">//每过一个MiniSec执行一次</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>RunFlag <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token comment">//暂停中不执行</span>
	MiniSec <span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>MiniSec <span class="token operator">&gt;=</span> <span class="token number">100</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		MiniSec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		Sec <span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>Sec <span class="token operator">&gt;=</span> <span class="token number">60</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Sec <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			Min <span class="token operator">++</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>Min <span class="token operator">&gt;=</span> <span class="token number">60</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Min <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">Timer0_Routine</span><span class="token punctuation">(</span><span class="token punctuation">)</span> interrupt <span class="token number">1</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">static</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> T0Count1<span class="token punctuation">,</span> T0Count2<span class="token punctuation">,</span> T0Count3<span class="token punctuation">;</span>
	TL0 <span class="token operator">=</span> <span class="token number">0x66</span><span class="token punctuation">;</span>		<span class="token comment">//设置定时初值</span>
	TH0 <span class="token operator">=</span> <span class="token number">0xFC</span><span class="token punctuation">;</span>		<span class="token comment">//设置定时初值</span>
	T0Count1 <span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>T0Count1 <span class="token operator">&gt;=</span> <span class="token number">20</span><span class="token punctuation">)</span> <span class="token comment">//20ms扫描一次</span>
	<span class="token punctuation">{<!-- --></span>
		T0Count1 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		
    <span class="token function">Key_Loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	T0Count2 <span class="token operator">++</span><span class="token punctuation">;</span> 
	<span class="token keyword">if</span><span class="token punctuation">(</span>T0Count2 <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">//2ms扫描一次</span>
	<span class="token punctuation">{<!-- --></span>
		T0Count2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token function">Nixie_Loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	T0Count3 <span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>T0Count3 <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">//一个MiniSec扫描一次</span>
	<span class="token punctuation">{<!-- --></span>
		T0Count3 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token function">Sec_Loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p><strong>如果要和之前的AT24C02结合起来，那就KeyNum为3的时候写入秒表的时间，KeyNum为4的时候读出时间，利用WriteByte和ReadByte即可</strong><br> <img src="https://images2.imgbox.com/ba/96/haUFUGif_o.jpg" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a1/26/QF04tBv4_o.jpg" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/89de5ad13e6d0ed9ef4cee85d579cc22/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">20230804做了一个梦</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1cac1a28834d2c55e8362e73ff6f503a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">pycharm远程连服务器问题总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>