<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue3实现video控件的h5端进度条拖拽与跳转 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue3实现video控件的h5端进度条拖拽与跳转" />
<meta property="og:description" content="代码：
&lt;template&gt; &lt;div class=&#34;video-box&#34;&gt; &lt;!-- poster=&#34;static/video/covershu.png&#34;--&gt; &lt;video ref=&#34;homeVideo&#34; id=&#34;video&#34; class=&#34;video&#34; src=&#34;https://www.w3school.com.cn/i/movie.ogg&#34; :playsinline=&#34;true&#34; :webkit-playsinline=&#34;true&#34; @canplay=&#34;getVideoInfo&#34; @timeupdate=&#34;getCurrentInfo&#34; @ended=&#34;handleEnd&#34; @click=&#34;dispControls&#34; loop :x5-video-player-fullscreen=&#34;true&#34; x5-video-orientation=&#34;portraint&#34; &gt; &lt;p&gt;你的浏览器不支持video标签.&lt;/p&gt; &lt;/video&gt; &lt;div id=&#34;controls&#34; class=&#34;controls&#34;&gt; &lt;!-- pause play --&gt; &lt;van-icon :name=&#34;iconName&#34; class=&#34;play-btn&#34; @click=&#34;playOrPause&#34; color=&#34;white&#34; /&gt; &lt;div class=&#34;slider&#34;&gt; &lt;!-- 进度条容器 --&gt; &lt;div id=&#34;control&#34; ref=&#34;control&#34; class=&#34;control&#34; @click=&#34;setProgress&#34; @touchmove=&#34;controlMove&#34; @touchend=&#34;controlEnd&#34; &gt; &lt;!-- 进度条本条 --&gt; &lt;div class=&#34;progress&#34; :style=&#34;{width: progressWidth &#43; &#39;px&#39; }&#34; /&gt; &lt;!-- 滑块 --&gt; &lt;div v-if=&#34;progressWidth - 10 &gt; 0&#34; class=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/e9a0c33627c7b5c226df1c6133cb10dd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-09T10:47:09+08:00" />
<meta property="article:modified_time" content="2022-09-09T10:47:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue3实现video控件的h5端进度条拖拽与跳转</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>代码：</p> 
<pre><code class="language-javascript">&lt;template&gt;
    &lt;div class="video-box"&gt;
&lt;!--            poster="static/video/covershu.png"--&gt;
        &lt;video
            ref="homeVideo"
            id="video"
            class="video"
            src="https://www.w3school.com.cn/i/movie.ogg"
            :playsinline="true"
            :webkit-playsinline="true"
            @canplay="getVideoInfo"
            @timeupdate="getCurrentInfo"
            @ended="handleEnd"
            @click="dispControls"
            loop
            :x5-video-player-fullscreen="true"
            x5-video-orientation="portraint"
        &gt;
            &lt;p&gt;你的浏览器不支持video标签.&lt;/p&gt;
        &lt;/video&gt;
        &lt;div id="controls"  class="controls"&gt;
&lt;!--            pause play --&gt;
            &lt;van-icon
                :name="iconName"
                class="play-btn"
                @click="playOrPause"
                color="white"
            /&gt;
            &lt;div class="slider"&gt;
                &lt;!-- 进度条容器 --&gt;
                &lt;div
                    id="control"
                    ref="control"
                    class="control"
                    @click="setProgress"
                    @touchmove="controlMove"
                    @touchend="controlEnd"
                &gt;
                    &lt;!-- 进度条本条 --&gt;
                    &lt;div
                        class="progress"
                        :style="{width: progressWidth + 'px' }"
                    /&gt;
                    &lt;!-- 滑块 --&gt;
                    &lt;div
                        v-if="progressWidth - 10 &gt; 0"
                        class="slider_circle"
                        :style="{left: (progressWidth - 10) + 'px' }"
                        @touchstart="sliderStart"
                    /&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            &lt;span&gt;
                {<!-- -->{currentTime }} / {<!-- -->{ duration}}
            &lt;/span&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import {ref} from "vue"

//video的ref
const homeVideo = ref(null)
// 展厅或者播放
const iconName = ref('play')
//显示总时长
const duration = ref(0)
//显示播放到的当前时间
const currentTime = ref(0)

//滑动到位置的高度
const progressWidth = ref(0)
//移动的类型，用来标明是否在拖动进度条
const moveType = ref("")
//拖动开始时点击的位置
const moveOffsetX = ref(0)
//拖动开始时进度条的宽度度
const curWidth = ref(0)



//播放暂停
const playOrPause = () =&gt; {
    if (homeVideo.value.paused) {
        homeVideo.value.play()
        iconName.value = 'pause'
    } else {
        homeVideo.value.pause()
        iconName.value = 'play'
    }
}


//得到视频的时长等信息
const getVideoInfo = () =&gt; {
    duration.value = formatTime(parseInt(homeVideo.value.duration))
}

// 视频播放完毕
const handleEnd = () =&gt; {
    iconName.value = 'pause'
}
//得到视频当前播放到哪里的信息
const getCurrentInfo = () =&gt; {
    // 视频已经播放时长
    currentTime.value = formatTime(parseInt(homeVideo.value.currentTime))
    let ratio = homeVideo.value.currentTime / homeVideo.value.duration
    let allWidth = document.getElementById('control').getBoundingClientRect().width
    progressWidth.value = allWidth * ratio
}

// 格式化时间函数
const formatTime = (s) =&gt; {
    let t
    if (s &gt; -1) {
        let hour = Math.floor(s / 3600)
        let min = Math.floor(s / 60) % 60
        let sec = s % 60
        if (hour &lt; 0 || hour === 0) {
            t = ''
        } else if (0 &lt; hour &lt; 10) {
            t = '0' + hour + ":"
        } else {
            t = hour + ":"
        }

        if (min &lt; 10) {
            t += "0"
        }
        t += min + ":"
        if (sec &lt; 10) {
            t += "0"
        }
        t += sec
    }
    return t
}

//设置进度条的长度
const setProgress = (e) =&gt; {
    e.preventDefault()
    const {left, width} = document.getElementById('control').getBoundingClientRect()
    progressWidth.value = e.clientX - left
    updadteCurrentTime(progressWidth.value, width)
}

//设置视频播放到指定的长度
const updadteCurrentTime = (progressWidth, width) =&gt; {
    let dest = (progressWidth / width) * homeVideo.value.duration
    homeVideo.value.currentTime = Math.floor(dest)
}


//当开始触摸开始在圆点按下时
const sliderStart = (e) =&gt; {
    e.preventDefault()
    moveOffsetX.value = e.touches[0].clientX
    moveType.value = "slider"
    curWidth.value = progressWidth.value
}

//当触摸在controls上移动时
const controlMove = (e) =&gt; {
    if (moveType.value !== 'slider') {
        return false
    }
    e.preventDefault()
    // 滑动距离可视区域左侧的距离
    const X = e.touches[0].clientX
    //得到本次拖动已经过的距离
    const cl = X - moveOffsetX.value
    //容器的宽度
    const { width } = document.getElementById('control').getBoundingClientRect()
    //得到已拖动到宽度
    const ml = curWidth.value + cl
    let proWidth
    if (ml &lt;= 0) {
        //进度条长度最小和最大值的界定
        proWidth = 0
    } else if (ml &gt;= width) {
        proWidth = width
    } else {
        proWidth = ml
    }
    progressWidth.value = proWidth
    // 更新当前时间
    updadteCurrentTime(progressWidth.value, width)
}

//滑动结束
const controlEnd = () =&gt; {
    moveType.value = ""
}


const dispControls = () =&gt; {
    let isDisp = document.getElementById('controls').style.visibility
    if (isDisp === 'hidden') {
        document.getElementById('controls').style.visibility = 'visible'
    } else {
        document.getElementById('controls').style.visibility = 'hidden'
    }
}
&lt;/script&gt;

&lt;style lang="less"&gt;
@import "index.less";
&lt;/style&gt;
</code></pre> 
<p>index.less文件：</p> 
<pre><code class="language-css">.video-box {
    width:100%;
    height: 100vh;
    background-color: #000;
    .video {
        width: 100vw;
        height: 422px;
        margin-top: 200px;
    }
    .controls {
        width: 100vw;
        z-index: 1;
        display: flex;
        align-items: center;
        .play-btn {
            width: 30px;
            height: 30px;
            padding: 20px;
        }
        .progress {
            height: 7px;
            border-radius: 3px;
            background-color: #e4c487;
        }
        .slider {
            flex: 1;
            .control {
                width: 100%;
                background-color: white;
                padding: 20px 0;
                position: relative;
                background-clip: content-box;
                z-index: 2;
            }
        }
        span {
            color: white;
            font-size: 24px;
            padding: 0 20px;
        }
        .slider_circle {
            position: absolute;
            left: 0;
            top: 13px;
            width: 20px;
            height: 20px;
            border-radius: 10px;
            border: 1px;
            background: #e4c487;
        }
    }
}




</code></pre> 
<p>效果图：</p> 
<p style="text-align:center;"> <img alt="" src="https://images2.imgbox.com/3d/b8/hfRjvRkO_o.jpg"></p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6f2115a87f7a38dc8b87c7ff9ef10ff5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">h5 js调用移动端 相机 相册</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/060b9995c940145ec8f42f486d7485df/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SCS【7】单细胞转录组之轨迹分析 (Monocle 3)  聚类、分类和计数细胞</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>