<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>大恒相机开发实践(2)——触发采图 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="大恒相机开发实践(2)——触发采图" />
<meta property="og:description" content="目录 前言正文开启采图模式开启实时采图功能点击触发按钮 总结 前言 这部分完成的功能是触发采图，所谓触发采图，基本的过程是在先开启连续采图，然后，在某个触发信号到来的时候，读取其中的某一帧的信号，显示在主界面上这个触发可以是软触发，也可以是硬件触发信号，看具体的需求，下面开讲大恒相机的触发采图。
正文 开启采图模式 首先，我们要让程序先开启采图模式，也就是处于回调抓图的模式，才能让相机在触发信号到来的信号进行抓图。我们这里使用的函数是GrabThreadStart：
GrabThreadStart
qint32 MDeviceDahengG3UC::GrabThreadStart() { qint32 ret = RETURN_FAIL; #ifdef WIN32_DAHENG_GEV if(m_bLoaded) { CGXFeatureControlPointer m_objFeatureControlPtr2 = m_objDevicePtr-&gt;GetRemoteFeatureControl(); if((!m_objDevicePtr.IsNull())&amp;&amp;(!m_objFeatureControlPtr2.IsNull())) { if(!m_objStreamPtr.IsNull()) { m_objStreamPtr-&gt;RegisterCaptureCallback(m_pCaptureEventHandler,this);// m_objStreamPtr-&gt;StartGrab();//startGrab } else qDebug()&lt;&lt;&#34;MDeviceDahengG3UC::GrabThreadStart m_objStreamPtr is null&#34;; m_objFeatureControlPtr2-&gt;GetCommandFeature(&#34;AcquisitionStart&#34;)-&gt;Execute(); ret = RETURN_OK; } else { if(m_objDevicePtr.IsNull()) qDebug()&lt;&lt;&#34;MDeviceDahengG3UC::GrabThreadStart m_objDevicePtr is null&#34;; } } #endif return ret; } 下面进行解析：
这里面最重要的肯定是进行回调注册了，也就是这个函数： m_objStreamPtr-&gt;RegisterCaptureCallback(m_pCaptureEventHandler,this); 这个函数在大恒相机的文档上有，我这里稍微解释一下，就是把这个this的指针传给m_pCaptureEventHandler这个对象，它这个注册函数的定义是这个：
//---------------------------------------------------------------------------------- virtual void RegisterCaptureCallback(ICaptureEventHandler* pEventHandler, void *pUserParam) = 0; 相当于，在这里注册了pEventHandler这个对象，并把this指针往下传，在你按下触发按钮的时候，就会执行这个对象里面的函数，也就是ICaptureEventHandler，我就顺势在这里给出这个函数的解析：
//回调处理类 class CSampleCaptureEventHandler : public ICaptureEventHandler { public: void DoOnImageCaptured(CImageDataPointer&amp; objImageDataPointer, void* pUserParam) { MDeviceDahengG3UC* pDev = static_cast&lt;MDeviceDahengG3UC*&gt;(pUserParam); pDev-&gt;triggerEvent(objImageDataPointer); } }; 注意，这个类是大恒相机给的，不是我自己创造的，所以，看文档就显得至关重要了，包括这个RegisterCaptureCallback这个函数也是文档里有的，我这里只是给你一个这种问题的解决方向。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a67222c66c6dd92f2d7abed1229bafd5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-11-22T00:17:09+08:00" />
<meta property="article:modified_time" content="2020-11-22T00:17:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">大恒相机开发实践(2)——触发采图</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">前言</a></li><li><a href="#_3" rel="nofollow">正文</a></li><li><ul><li><a href="#_4" rel="nofollow">开启采图模式</a></li><li><a href="#_113" rel="nofollow">开启实时采图功能</a></li><li><a href="#_184" rel="nofollow">点击触发按钮</a></li></ul> 
  </li><li><a href="#_209" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>前言</h2> 
<p>这部分完成的功能是触发采图，所谓触发采图，基本的过程是在<strong>先开启连续采图，然后，在某个触发信号到来的时候，读取其中的某一帧的信号，显示在主界面上</strong>这个触发可以是软触发，也可以是硬件触发信号，看具体的需求，下面开讲大恒相机的触发采图。</p> 
<h2><a id="_3"></a>正文</h2> 
<h3><a id="_4"></a>开启采图模式</h3> 
<p>首先，我们要让程序先开启采图模式，也就是处于回调抓图的模式，才能让相机在触发信号到来的信号进行抓图。我们这里使用的函数是<code>GrabThreadStart</code>：<br> <code>GrabThreadStart</code></p> 
<pre><code class="prism language-c">qint32  MDeviceDahengG3UC<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GrabThreadStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    qint32 ret <span class="token operator">=</span> RETURN_FAIL<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> WIN32_DAHENG_GEV</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>m_bLoaded<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        CGXFeatureControlPointer m_objFeatureControlPtr2  <span class="token operator">=</span> m_objDevicePtr<span class="token operator">-&gt;</span><span class="token function">GetRemoteFeatureControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>m_objDevicePtr<span class="token punctuation">.</span><span class="token function">IsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span><span class="token operator">!</span>m_objFeatureControlPtr2<span class="token punctuation">.</span><span class="token function">IsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m_objStreamPtr<span class="token punctuation">.</span><span class="token function">IsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                m_objStreamPtr<span class="token operator">-&gt;</span><span class="token function">RegisterCaptureCallback</span><span class="token punctuation">(</span>m_pCaptureEventHandler<span class="token punctuation">,</span>this<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//</span>
                m_objStreamPtr<span class="token operator">-&gt;</span><span class="token function">StartGrab</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//startGrab</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
                <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"MDeviceDahengG3UC::GrabThreadStart m_objStreamPtr is null"</span><span class="token punctuation">;</span>
            m_objFeatureControlPtr2<span class="token operator">-&gt;</span><span class="token function">GetCommandFeature</span><span class="token punctuation">(</span><span class="token string">"AcquisitionStart"</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ret <span class="token operator">=</span> RETURN_OK<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>m_objDevicePtr<span class="token punctuation">.</span><span class="token function">IsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"MDeviceDahengG3UC::GrabThreadStart m_objDevicePtr is null"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
    <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>下面进行解析：</strong></p> 
<ol><li>这里面最重要的肯定是进行回调注册了，也就是这个函数：</li></ol> 
<pre><code class="prism language-c">m_objStreamPtr<span class="token operator">-&gt;</span><span class="token function">RegisterCaptureCallback</span><span class="token punctuation">(</span>m_pCaptureEventHandler<span class="token punctuation">,</span>this<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这个函数在大恒相机的文档上有，我这里稍微解释一下，就是把这个<code>this</code>的指针传给<code>m_pCaptureEventHandler</code>这个对象，它这个注册函数的定义是这个：</p> 
<pre><code class="prism language-c"><span class="token comment">//----------------------------------------------------------------------------------</span>
	virtual <span class="token keyword">void</span> <span class="token function">RegisterCaptureCallback</span><span class="token punctuation">(</span>ICaptureEventHandler<span class="token operator">*</span> pEventHandler<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>pUserParam<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre> 
<p>相当于，在这里注册了<code>pEventHandler</code>这个对象，并把<code>this</code>指针往下传，在你按下触发按钮的时候，就会执行这个对象里面的函数，也就是<code>ICaptureEventHandler</code>，我就顺势在这里给出这个函数的解析：</p> 
<pre><code class="prism language-c"><span class="token comment">//回调处理类</span>
class CSampleCaptureEventHandler <span class="token punctuation">:</span> public ICaptureEventHandler
<span class="token punctuation">{<!-- --></span>
public<span class="token punctuation">:</span>
    <span class="token keyword">void</span> <span class="token function">DoOnImageCaptured</span><span class="token punctuation">(</span>CImageDataPointer<span class="token operator">&amp;</span> objImageDataPointer<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> pUserParam<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        MDeviceDahengG3UC<span class="token operator">*</span> pDev <span class="token operator">=</span> static_cast<span class="token operator">&lt;</span>MDeviceDahengG3UC<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>pUserParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
        pDev<span class="token operator">-&gt;</span><span class="token function">triggerEvent</span><span class="token punctuation">(</span>objImageDataPointer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>注意，这个类是大恒相机给的，不是我自己创造的，所以，看文档就显得至关重要了，包括这个<code>RegisterCaptureCallback</code>这个函数也是文档里有的，我这里只是给你一个这种问题的解决方向。<br> 当你触发信号到来后，就执行<code>DoOnImageCaptured</code>。</p> 
<ol start="2"><li>接着上面那个继续讲一下<code>triggerEvent</code>这个函数：</li></ol> 
<pre><code class="prism language-c"><span class="token keyword">void</span>   MDeviceDahengG3UC<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">triggerEvent</span><span class="token punctuation">(</span>CImageDataPointer objImageDataPointer<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> WIN32_DAHENG_GEV</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>m_bStopWork<span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>m_fGrabCallbackEx<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        MFrameInfo info<span class="token punctuation">;</span>
        info<span class="token punctuation">.</span>nWidth  <span class="token operator">=</span> <span class="token punctuation">(</span>qint32<span class="token punctuation">)</span>objImageDataPointer<span class="token operator">-&gt;</span><span class="token function">GetWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        info<span class="token punctuation">.</span>nHeight <span class="token operator">=</span> <span class="token punctuation">(</span>qint32<span class="token punctuation">)</span>objImageDataPointer<span class="token operator">-&gt;</span><span class="token function">GetHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        info<span class="token punctuation">.</span>nFramerLen <span class="token operator">=</span> <span class="token punctuation">(</span>qint32<span class="token punctuation">)</span>objImageDataPointer<span class="token operator">-&gt;</span><span class="token function">GetPayloadSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        quint64 format <span class="token operator">=</span> objImageDataPointer<span class="token operator">-&gt;</span><span class="token function">GetPixelFormat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        info<span class="token punctuation">.</span>cFormat <span class="token operator">=</span> <span class="token function">GetPixelFormat</span><span class="token punctuation">(</span>format<span class="token punctuation">)</span><span class="token punctuation">;</span>
        uchar <span class="token operator">*</span>pbit <span class="token operator">=</span> <span class="token punctuation">(</span>uchar<span class="token operator">*</span><span class="token punctuation">)</span>objImageDataPointer<span class="token operator">-&gt;</span><span class="token function">GetBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Buffer</span>
        <span class="token function">m_fGrabCallbackEx</span><span class="token punctuation">(</span>m_pCallUser<span class="token punctuation">,</span>pbit<span class="token punctuation">,</span><span class="token operator">&amp;</span>info<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token macro property">#<span class="token directive keyword">endif</span></span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这里的m_fGrabCallbackEx是从最上层往下传的一个回调函数，所以，你可以看到，我这里把所有有的东西都传给这个函数了，就是为了让这个函数带着这些东西回到最上层，从而把这个<code>pbit</code>地址里面的东西给我显示出来。我觉得如果你的程序，做成插件类型，并且要传到<code>MainWindow</code>的话，应该也是要使用这种方式。</p> 
<ol start="3"><li>注意最后要进行回调功能的关闭的话要进行Stop的操作，函数如下：</li></ol> 
<pre><code class="prism language-c">qint32  MDeviceDahengG3UC<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">GrabThreadStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    qint32 ret <span class="token operator">=</span> RETURN_FAIL<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> WIN32_DAHENG_GEV</span>
    <span class="token comment">//ɡ</span>
    CGXFeatureControlPointer m_objFeatureControlPtr  <span class="token operator">=</span> m_objDevicePtr<span class="token operator">-&gt;</span><span class="token function">GetRemoteFeatureControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m_objFeatureControlPtr<span class="token punctuation">.</span><span class="token function">IsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        m_objFeatureControlPtr<span class="token operator">-&gt;</span><span class="token function">GetCommandFeature</span><span class="token punctuation">(</span><span class="token string">"AcquisitionStop"</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_objStreamPtr<span class="token operator">-&gt;</span><span class="token function">StopGrab</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_objStreamPtr<span class="token operator">-&gt;</span><span class="token function">UnregisterCaptureCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ret <span class="token operator">=</span> RETURN_OK<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"MDeviceDahengG3UC::GrabThreadStop m_objFeatureControlPtr is null"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
    <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_113"></a>开启实时采图功能</h3> 
<p>接下来就该开启相机的连续采图功能，但并不显示在界面之上，也就是不去拿那些数据，这样就为后续的触发抓图做准备。这个函数与之前的实时采图所用的函数是一样的。这里使用的是</p> 
<pre><code class="prism language-c">qint32  MDeviceDahengG3UC<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">AcquisitionStart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    qint32 ret <span class="token operator">=</span> RETURN_FAIL<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> WIN32_DAHENG_GEV</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>m_bLoaded<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>m_bStopWork<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            m_objFeatureControlPtr <span class="token operator">=</span> m_objDevicePtr<span class="token operator">-&gt;</span><span class="token function">GetRemoteFeatureControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            m_objImageProcessPtr <span class="token operator">=</span> m_objDevicePtr<span class="token operator">-&gt;</span><span class="token function">CreateImageProcessConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            bool m_bIsColorFilter <span class="token operator">=</span> m_objFeatureControlPtr<span class="token operator">-&gt;</span><span class="token function">IsImplemented</span><span class="token punctuation">(</span><span class="token string">"PixelColorFilter"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m_objStreamPtr<span class="token punctuation">.</span><span class="token function">IsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token function">qDebug</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span><span class="token string">"MDeviceDahengG3UC::AcquisitionStart m_objStreamPtr"</span><span class="token punctuation">;</span>
                <span class="token comment">//objStreamPtr-&gt;SetAcqusitionBufferNumber(10);//StartGrabòbufferЧ</span>
                m_objStreamPtr<span class="token operator">-&gt;</span><span class="token function">StartGrab</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m_objFeatureControlPtr<span class="token punctuation">.</span><span class="token function">IsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                m_objFeatureControlPtr<span class="token operator">-&gt;</span><span class="token function">GetCommandFeature</span><span class="token punctuation">(</span><span class="token string">"AcquisitionStart"</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ret <span class="token operator">=</span> RETURN_OK<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>m_pConfigureObj<span class="token operator">-&gt;</span><span class="token function">UpdateConfigureFromDevice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                m_pConfigureObj<span class="token operator">-&gt;</span><span class="token function">SlotConfigChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>m_pConfigureObj<span class="token operator">-&gt;</span><span class="token function">UpdateSimplyConfigureFromDevice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                m_pConfigureObj<span class="token operator">-&gt;</span><span class="token function">SlotSimplyConfigChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            m_bStopWork <span class="token operator">=</span>false<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
    <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol><li>最主要的还是执行<code>Acquisition</code>这个命令：</li></ol> 
<pre><code class="prism language-c">m_objFeatureControlPtr<span class="token operator">-&gt;</span><span class="token function">GetCommandFeature</span><span class="token punctuation">(</span><span class="token string">"AcquisitionStart"</span><span class="token punctuation">)</span><span class="token operator">-</span>
</code></pre> 
<ol start="2"><li>我这里讲一下<code>UpdateConfigureFromDevice</code>这个函数的功能，从字面意思就可以知道，从<strong>硬件中更新配置文件</strong>，通过这样，在每次相机通道被创建的时候，就会从硬件中读取参数，这样的参数显示才是最新的。至于<code>simply</code>就不用管它来了。</li><li>这里还是稍微讲一下，上面有了<code>AcquisitionStart</code>，那肯定有<code>AcquisitionStop</code>。这里也贴出这个函数，还是比较简单的。</li></ol> 
<pre><code class="prism language-c">qint32  MDeviceDahengG3UC<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">AcquisitionStop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    qint32 ret <span class="token operator">=</span> RETURN_FAIL<span class="token punctuation">;</span>
<span class="token macro property">#<span class="token directive keyword">ifdef</span> WIN32_DAHENG_GEV</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>m_bLoaded<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m_bStopWork<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>m_objFeatureControlPtr<span class="token punctuation">.</span><span class="token function">IsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span><span class="token operator">!</span>m_objStreamPtr<span class="token punctuation">.</span><span class="token function">IsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                m_objFeatureControlPtr<span class="token operator">-&gt;</span><span class="token function">GetCommandFeature</span><span class="token punctuation">(</span><span class="token string">"AcquisitionStop"</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                m_objStreamPtr<span class="token operator">-&gt;</span><span class="token function">StopGrab</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//</span>
                m_objStreamPtr<span class="token operator">-&gt;</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>m_pConfigureObj<span class="token operator">-&gt;</span><span class="token function">UpdateConfigureFromDevice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                m_pConfigureObj<span class="token operator">-&gt;</span><span class="token function">SlotConfigChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span>m_pConfigureObj<span class="token operator">-&gt;</span><span class="token function">UpdateSimplyConfigureFromDevice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                m_pConfigureObj<span class="token operator">-&gt;</span><span class="token function">SlotSimplyConfigChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ret <span class="token operator">=</span> RETURN_OK<span class="token punctuation">;</span>
            m_bStopWork <span class="token operator">=</span> true<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>
    <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_184"></a>点击触发按钮</h3> 
<p>最后一步，当然是点击触发按钮，实现软触发了。这里也是比较简单，使用的是<code>TriggerSoftwareExecute</code>这个函数，下面直接给出：</p> 
<pre><code class="prism language-c">qint32  MDeviceDahengG3UC<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">TriggerSoftwareExecute</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    qint32 ret <span class="token operator">=</span> RETURN_FAIL<span class="token punctuation">;</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span>m_bLoaded<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>m_objDevicePtr<span class="token punctuation">.</span><span class="token function">IsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            CGXFeatureControlPointer objFeatureControlPtr <span class="token operator">=</span> m_objDevicePtr<span class="token operator">-&gt;</span><span class="token function">GetRemoteFeatureControl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>objFeatureControlPtr<span class="token punctuation">.</span><span class="token function">IsNull</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                CCommandFeaturePointer objCommandPtr <span class="token operator">=</span> objFeatureControlPtr<span class="token operator">-&gt;</span><span class="token function">GetCommandFeature</span><span class="token punctuation">(</span><span class="token string">"TriggerSoftware"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                objCommandPtr<span class="token operator">-&gt;</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                ret <span class="token operator">=</span> RETURN_OK<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>你直接软件触发的按钮和这个函数进行关联，执行<code>Execute</code>命令就可以了。</p> 
<h2><a id="_209"></a>总结</h2> 
<p>我觉得对于回调采图的这部分，最难的地方应该还是在对回调函数的设置上面，对这个东西的理解，我之前一直也不是很理解，但后面弄的多了，也就有点理解了，你就找到那个回调函数，这个相机自带的回调函数就会在程序产生触发操作的时候调用里面的回调函数。希望你能成功解决这个问题。<br> 这个部分还有另外两篇，这里给出地址，有需要的可以去看看：</p> 
<blockquote> 
 <p><a href="https://blog.csdn.net/weixin_38809485/article/details/109890686">大恒相机开发实践(1)——实时采图</a><br> <a href="https://blog.csdn.net/weixin_38809485/article/details/109890816">大恒相机开发实践(3)——参数设置</a></p> 
</blockquote> 
<p><strong>若有错误，欢迎指出，感谢~</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5d4a3d27274d1c1c487eeb0ebb54a6eb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">tkinter checkbutton_Tkinter简明教程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e409c57e3e4ca5b3e520b0236815c278/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">VS Code Remote SSH配置</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>