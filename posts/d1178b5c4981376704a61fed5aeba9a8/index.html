<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>数据挖掘——数据采集和数据清洗 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="数据挖掘——数据采集和数据清洗" />
<meta property="og:description" content="数据采集和数据清洗 一、数据清洗1.数据去重（一）相关知识1&gt; pandas读取csv文件-read_csv()2&gt; pandas的去重函数-drop_duplicates() （二）本关任务（三）参考代码 2.处理空值（一）相关知识1&gt; DataFrame中空值的表示2&gt; 查找空值及计算空值的个数3&gt; 处理空值-fillna （二）本关任务（三）参考代码 二、数据采集实战1. 单网页爬取（一）相关知识1&gt; 爬虫简介2&gt; 网络爬虫3&gt; 网络爬虫：载入4&gt; 网络爬虫：动态载入5&gt; 网络爬虫：解析 （二）本关任务（三）参考代码 2.网页爬取策略（一）相关知识1&gt; 深度优先爬虫（一路到底）2&gt; 广度优先爬虫（逐层爬取） （二）本关任务（三）参考代码 3.爬取与反爬取（一）相关知识1&gt;常见反爬手段：2&gt; 应对措施： （二）本关任务（三）参考代码 4.爬取与反爬取进阶（一）相关知识（二）本关任务（三）参考代码 一、数据清洗 1.数据去重 （一）相关知识 1&gt; pandas读取csv文件-read_csv() CSV为简单的文本格式文件，每行为一条用逗号分隔的数据。Excel保存文件时可以选择csv格式；在记事本里输入内容，保存时使用.csv扩展名，也能生成CSV文件。
只要能阅读文本文件的编辑器，就能打开CSV文件，也可以用Excel把它作为电子表格打开。现在，我们要用pandas中的read_csv函数读取csv文件中的数据。这个函数有很多参数，在本关卡和接下来的关卡中，我们将逐个介绍其中几个常用的参数。
在本关卡中，我们只需要将CSV文件的文件名作为参数即可。
import pandas as pd a=pd.read_csv(&#39;示例数据.csv&#39;) #此时，a就存储了示例数据.csv文件中的数据 print(a) # 输出结果如下： # 1 2 # 0 3 4 # 1 5 6 # 2 1 3 # 3 1 2 # 4 4 2 2&gt; pandas的去重函数-drop_duplicates() pandas中的drop_duplicates()函数是对DataFrame格式的数据，可以去掉特定列的重复行。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/d1178b5c4981376704a61fed5aeba9a8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-21T17:30:51+08:00" />
<meta property="article:modified_time" content="2022-02-21T17:30:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">数据挖掘——数据采集和数据清洗</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>数据采集和数据清洗</h4> 
 <ul><li><a href="#_1" rel="nofollow">一、数据清洗</a></li><li><ul><li><a href="#1_2" rel="nofollow">1.数据去重</a></li><li><ul><li><a href="#_3" rel="nofollow">（一）相关知识</a></li><li><ul><li><a href="#1_pandascsvread_csv_4" rel="nofollow">1&gt; pandas读取csv文件-read_csv()</a></li><li><a href="#2_pandasdrop_duplicates_22" rel="nofollow">2&gt; pandas的去重函数-drop_duplicates()</a></li></ul> 
    </li><li><a href="#_64" rel="nofollow">（二）本关任务</a></li><li><a href="#_67" rel="nofollow">（三）参考代码</a></li></ul> 
   </li><li><a href="#2_89" rel="nofollow">2.处理空值</a></li><li><ul><li><a href="#_90" rel="nofollow">（一）相关知识</a></li><li><ul><li><a href="#1_DataFrame_91" rel="nofollow">1&gt; DataFrame中空值的表示</a></li><li><a href="#2__109" rel="nofollow">2&gt; 查找空值及计算空值的个数</a></li><li><a href="#3_fillna_138" rel="nofollow">3&gt; 处理空值-fillna</a></li></ul> 
    </li><li><a href="#_162" rel="nofollow">（二）本关任务</a></li><li><a href="#_181" rel="nofollow">（三）参考代码</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_228" rel="nofollow">二、数据采集实战</a></li><li><ul><li><a href="#1__229" rel="nofollow">1. 单网页爬取</a></li><li><ul><li><a href="#_230" rel="nofollow">（一）相关知识</a></li><li><ul><li><a href="#1__232" rel="nofollow">1&gt; 爬虫简介</a></li><li><a href="#2__237" rel="nofollow">2&gt; 网络爬虫</a></li><li><a href="#3__245" rel="nofollow">3&gt; 网络爬虫：载入</a></li><li><a href="#4__262" rel="nofollow">4&gt; 网络爬虫：动态载入</a></li><li><a href="#5__265" rel="nofollow">5&gt; 网络爬虫：解析</a></li></ul> 
    </li><li><a href="#_272" rel="nofollow">（二）本关任务</a></li><li><a href="#_279" rel="nofollow">（三）参考代码</a></li></ul> 
   </li><li><a href="#2_305" rel="nofollow">2.网页爬取策略</a></li><li><ul><li><a href="#_306" rel="nofollow">（一）相关知识</a></li><li><ul><li><a href="#1__308" rel="nofollow">1&gt; 深度优先爬虫（一路到底）</a></li><li><a href="#2__314" rel="nofollow">2&gt; 广度优先爬虫（逐层爬取）</a></li></ul> 
    </li><li><a href="#_320" rel="nofollow">（二）本关任务</a></li><li><a href="#_322" rel="nofollow">（三）参考代码</a></li></ul> 
   </li><li><a href="#3_468" rel="nofollow">3.爬取与反爬取</a></li><li><ul><li><a href="#_469" rel="nofollow">（一）相关知识</a></li><li><ul><li><a href="#1_472" rel="nofollow">1&gt;常见反爬手段：</a></li><li><a href="#2__477" rel="nofollow">2&gt; 应对措施：</a></li></ul> 
    </li><li><a href="#_482" rel="nofollow">（二）本关任务</a></li><li><a href="#_484" rel="nofollow">（三）参考代码</a></li></ul> 
   </li><li><a href="#4_508" rel="nofollow">4.爬取与反爬取进阶</a></li><li><ul><li><a href="#_509" rel="nofollow">（一）相关知识</a></li><li><a href="#_511" rel="nofollow">（二）本关任务</a></li><li><a href="#_513" rel="nofollow">（三）参考代码</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>一、数据清洗</h2> 
<h3><a id="1_2"></a>1.数据去重</h3> 
<h4><a id="_3"></a>（一）相关知识</h4> 
<h5><a id="1_pandascsvread_csv_4"></a>1&gt; pandas读取csv文件-read_csv()</h5> 
<p>    CSV为简单的文本格式文件，每行为一条用逗号分隔的数据。Excel保存文件时可以选择csv格式；在记事本里输入内容，保存时使用.csv扩展名，也能生成CSV文件。<br>     只要能阅读文本文件的编辑器，就能打开CSV文件，也可以用Excel把它作为电子表格打开。现在，我们要用pandas中的read_csv函数读取csv文件中的数据。这个函数有很多参数，在本关卡和接下来的关卡中，我们将逐个介绍其中几个常用的参数。<br> 在本关卡中，我们只需要将CSV文件的文件名作为参数即可。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
a<span class="token operator">=</span>pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'示例数据.csv'</span><span class="token punctuation">)</span>
<span class="token comment">#此时，a就存储了示例数据.csv文件中的数据</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>

<span class="token comment"># 输出结果如下：</span>
<span class="token comment">#     1  2</span>
<span class="token comment"># 0   3  4</span>
<span class="token comment"># 1   5  6</span>
<span class="token comment"># 2   1  3</span>
<span class="token comment"># 3   1  2</span>
<span class="token comment"># 4   4  2</span>
</code></pre> 
<h5><a id="2_pandasdrop_duplicates_22"></a>2&gt; pandas的去重函数-drop_duplicates()</h5> 
<p>pandas中的drop_duplicates()函数是对DataFrame格式的数据，可以去掉特定列的重复行。</p> 
<p><strong>drop_duplicates()有以下参数：</strong><br> <strong>subset=</strong><br> 用于指定需要去重的列。默认为所有列。</p> 
<p><strong>keep:{‘first’, ‘last’, False}. default 'first’</strong><br> 删除重复项时是否保留其中第一次/最后一次出现的项。keep=False时不保留重复项；默认保留第一次出现的项。</p> 
<p><strong>inplace: boolean, default False</strong><br> 是否保留被修改的数据副本。默认不保留副本。</p> 
<p><mark>示例代码1</mark></p> 
<pre><code class="prism language-python">result_1<span class="token operator">=</span>a<span class="token punctuation">.</span>drop_duplicates<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 删除a中a、b列均重复的数据；保留第一次出现的重复数据；保留副本</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result_1<span class="token punctuation">)</span>

<span class="token comment"># 输出结果如下：</span>
<span class="token comment">#    a  b</span>
<span class="token comment"># 0  3  4</span>
<span class="token comment"># 1  5  6</span>
<span class="token comment"># 2  3  1</span>
<span class="token comment"># 3  1  2</span>
<span class="token comment"># 4  4  2</span>
</code></pre> 
<p><mark>示例代码2</mark></p> 
<pre><code class="prism language-python">result_2<span class="token operator">=</span>a<span class="token punctuation">.</span>drop_duplicates<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># 删除a中b列重复的数据；保留第一次出现的重复数据；不保留副本</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result_2<span class="token punctuation">)</span>
<span class="token comment"># 输出结果为None.因为直接在a上修改，不再将修改结果传递给result_2</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>

<span class="token comment"># 输出结果如下：</span>
<span class="token comment">#    a  b</span>
<span class="token comment"># 0  3  4</span>
<span class="token comment"># 1  5  6</span>
<span class="token comment"># 2  3  1</span>
<span class="token comment"># 3  1  2</span>
</code></pre> 
<h4><a id="_64"></a>（二）本关任务</h4> 
<p>利用pandas将‘basketball.csv’中的数据导入名为dataset的DataFrame对象中，并使用drop_duplicates()函数对dataset中的Date列进行去重，不保留副本。将去重结果dealed和dataset返回。</p> 
<h4><a id="_67"></a>（三）参考代码</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd


<span class="token keyword">def</span> <span class="token function">duplicate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    返回值:
    dealed: 对dataset的Date列进行去重后的DataFrame类型数据，不保留副本
    dataset: 初始读入的basketball.csv的数据
    '''</span>
    <span class="token comment"># 请在此添加代码 完成本关任务</span>
    <span class="token comment"># ********** Begin *********#</span>
    dataset <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'basketball.csv'</span><span class="token punctuation">)</span>
    dealed <span class="token operator">=</span> dataset<span class="token punctuation">.</span>drop_duplicates<span class="token punctuation">(</span>subset<span class="token operator">=</span><span class="token string">'Date'</span><span class="token punctuation">)</span>

    <span class="token comment"># ********** End **********#</span>

    <span class="token comment"># 返回dealed,dataset</span>
    <span class="token keyword">return</span> dealed<span class="token punctuation">,</span> dataset

</code></pre> 
<h3><a id="2_89"></a>2.处理空值</h3> 
<h4><a id="_90"></a>（一）相关知识</h4> 
<h5><a id="1_DataFrame_91"></a>1&gt; DataFrame中空值的表示</h5> 
<p>    Pandas通常把<mark>空值表示为 NaN</mark>，以上一关卡中的basketball.csv为例，当中的OT?字段和Notes字段中就有许多空值。我们可以取出数据的前五行的OT?字段看一下DataFrame中空值的表示。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
dataset<span class="token operator">=</span>pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'basketball.csv'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>dataset<span class="token punctuation">[</span><span class="token string">"OT?"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ix<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 输出结果为：</span>
<span class="token number">0</span>    NaN
<span class="token number">1</span>    NaN
<span class="token number">2</span>    NaN
<span class="token number">3</span>    NaN
<span class="token number">4</span>    NaN
<span class="token number">5</span>    NaN
Name<span class="token punctuation">:</span> OT?<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> <span class="token builtin">object</span>
</code></pre> 
<p>在数据挖掘过程中，模型通常不能直接接收NaN数据。这就需要我们对空值进行处理。在处理空值之前，要先能找出空值的个数和位置。</p> 
<h5><a id="2__109"></a>2&gt; 查找空值及计算空值的个数</h5> 
<p>    <strong>Pandas中查找数据表中空值的函数有两个，一个是函数isnull，如果是空值就显示True。另一个函数notnull正好相反，如果是空值就显示False。</strong><br>     分别利用这两个函数来找出basketball.csv数据中OT?字段和Notes字段中的个数。下面的一段程序是对isnull函数的使用示例。</p> 
<pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>dataset<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 输出结果为：</span>
    Date Score Type Visitor Team VisitorPts Home Team HomePts   OT? Notes
<span class="token number">0</span>  <span class="token boolean">False</span>      <span class="token boolean">False</span>        <span class="token boolean">False</span>      <span class="token boolean">False</span>     <span class="token boolean">False</span>   <span class="token boolean">False</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>
<span class="token number">1</span>  <span class="token boolean">False</span>      <span class="token boolean">False</span>        <span class="token boolean">False</span>      <span class="token boolean">False</span>     <span class="token boolean">False</span>   <span class="token boolean">False</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>
<span class="token number">2</span>  <span class="token boolean">False</span>      <span class="token boolean">False</span>        <span class="token boolean">False</span>      <span class="token boolean">False</span>     <span class="token boolean">False</span>   <span class="token boolean">False</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>
<span class="token number">3</span>  <span class="token boolean">False</span>      <span class="token boolean">False</span>        <span class="token boolean">False</span>      <span class="token boolean">False</span>     <span class="token boolean">False</span>   <span class="token boolean">False</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>
<span class="token number">4</span>  <span class="token boolean">False</span>      <span class="token boolean">False</span>        <span class="token boolean">False</span>      <span class="token boolean">False</span>     <span class="token boolean">False</span>   <span class="token boolean">False</span>  <span class="token boolean">True</span>  <span class="token boolean">True</span>
</code></pre> 
<p>    从输出的结果上来看，前五行数据只有OT?和Notes字段值是空值，其他均为非空。notnull函数的使用同理，只是输出的结果与isnull函数相反。</p> 
<p>    接下来我们可能还需要计算数据中空值的个数。为了解决这个问题，我们可以使用value_counts函数。这个函数的使用示例见下：</p> 
<pre><code class="prism language-python">result<span class="token operator">=</span>dataset<span class="token punctuation">[</span><span class="token string">'OT?'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#将dataset的OT?字段的空值与否情况传给result</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>value_counts<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 输出结果为：</span>
<span class="token boolean">True</span>     <span class="token number">1151</span>
<span class="token boolean">False</span>      <span class="token number">79</span>
Name<span class="token punctuation">:</span> OT?<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> int64
</code></pre> 
<p>由输出结果可以看出dataset中的OT?字段有1151个空值和79个非空值。</p> 
<h5><a id="3_fillna_138"></a>3&gt; 处理空值-fillna</h5> 
<p><strong>fillna()函数可以将空值位置填充任意指定的值。</strong><br> 下面这段代码将OT?字段中的空值赋值为’0OT’，将Notes字段中的空值赋值为’Nowhere’.</p> 
<pre><code class="prism language-python">dataset<span class="token operator">=</span>dataset<span class="token punctuation">[</span><span class="token string">'OT?'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">'0OT'</span><span class="token punctuation">)</span>
dataset<span class="token operator">=</span>dataset<span class="token punctuation">[</span><span class="token string">'Notes'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">'Nowhere'</span><span class="token punctuation">)</span>
<span class="token comment">#在处理空值之后，我们可以打印出前五行数据，看看原先是'NaN'的位置现在的值是什么</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>dataset<span class="token punctuation">.</span>ix<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 输出结果为：</span>

              Date Score Type          Visitor Team  VisitorPts  \
<span class="token number">0</span>  Tue Oct <span class="token number">29</span> <span class="token number">2013</span>  Box Score         Orlando Magic          <span class="token number">87</span>
<span class="token number">1</span>  Tue Oct <span class="token number">29</span> <span class="token number">2013</span>  Box Score  Los Angeles Clippers         <span class="token number">103</span>
<span class="token number">2</span>  Tue Oct <span class="token number">29</span> <span class="token number">2013</span>  Box Score         Chicago Bulls          <span class="token number">95</span>
<span class="token number">3</span>  Wed Oct <span class="token number">30</span> <span class="token number">2013</span>  Box Score         Brooklyn Nets          <span class="token number">94</span>
<span class="token number">4</span>  Wed Oct <span class="token number">30</span> <span class="token number">2013</span>  Box Score         Atlanta Hawks         <span class="token number">109</span>
             Home Team  HomePts  OT?    Notes
<span class="token number">0</span>       Indiana Pacers       <span class="token number">97</span>  0OT  Nowhere
<span class="token number">1</span>   Los Angeles Lakers      <span class="token number">116</span>  0OT  Nowhere
<span class="token number">2</span>           Miami Heat      <span class="token number">107</span>  0OT  Nowhere
<span class="token number">3</span>  Cleveland Cavaliers       <span class="token number">98</span>  0OT  Nowhere
<span class="token number">4</span>     Dallas Mavericks      <span class="token number">118</span>  0OT  Nowhere
</code></pre> 
<h4><a id="_162"></a>（二）本关任务</h4> 
<p>在本关卡中，我们为你提供了一个鸢尾花的数据集。数据集总共有五个字段，分别是：</p> 
<ol><li>sepal.length</li><li>sepal.width</li><li>petal.length</li><li>petal.width</li><li>variety</li></ol> 
<p>除了variety字段内容是字符串外，其他字段的内容均是浮点数。你要完成的任务包括：</p> 
<ul><li>找出每项字段中各有多少空值，并按上文给出的字段顺序打印出来。</li><li>前四项字段的空值，各用该空值所在列的均值填充。</li><li>第五项字段的空值，统一填充为’Unknown’.</li><li>处理均值后的数据命名为dealed_data，并返回</li></ul> 
<p><mark>注：pandas中均值的计算可以使用means()函数。<br> 示例：data[‘a’].means()的结果就是a字段的均值。</mark></p> 
<h4><a id="_181"></a>（三）参考代码</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

dataset <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'iris.csv'</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">count_nan</span><span class="token punctuation">(</span>dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    返回值:
    [n1,n2,n3,n4,n5]
    分别代表dataset的五列各有多少空值
    '''</span>
    <span class="token comment"># 请在此添加代码 完成本关任务</span>
    <span class="token comment"># ********** Begin *********#</span>
    <span class="token punctuation">[</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> n3<span class="token punctuation">,</span> n4<span class="token punctuation">,</span> n5<span class="token punctuation">]</span> <span class="token operator">=</span> dataset<span class="token punctuation">.</span>isnull<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># ********** End **********#</span>

    <span class="token comment"># 返回[n1,n2,n3,n4,n5]</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>n1<span class="token punctuation">,</span> n2<span class="token punctuation">,</span> n3<span class="token punctuation">,</span> n4<span class="token punctuation">,</span> n5<span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">deal_nan</span><span class="token punctuation">(</span>dataset<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    返回值：
    dataset：按要求处理过、已经没有空值的数据
    '''</span>
    <span class="token comment"># 请在此添加代码 完成本关任务</span>
    <span class="token comment"># ********** Begin *********#</span>
    dataset<span class="token punctuation">[</span><span class="token string">'sepal.length'</span><span class="token punctuation">]</span> <span class="token operator">=</span> dataset<span class="token punctuation">[</span><span class="token string">'sepal.length'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>
        dataset<span class="token punctuation">[</span><span class="token string">'sepal.length'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    dataset<span class="token punctuation">[</span><span class="token string">'sepal.width'</span><span class="token punctuation">]</span> <span class="token operator">=</span> dataset<span class="token punctuation">[</span><span class="token string">'sepal.width'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>
        dataset<span class="token punctuation">[</span><span class="token string">'sepal.width'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    dataset<span class="token punctuation">[</span><span class="token string">'petal.length'</span><span class="token punctuation">]</span> <span class="token operator">=</span> dataset<span class="token punctuation">[</span><span class="token string">'petal.length'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>
        dataset<span class="token punctuation">[</span><span class="token string">'petal.length'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    dataset<span class="token punctuation">[</span><span class="token string">'petal.width'</span><span class="token punctuation">]</span> <span class="token operator">=</span> dataset<span class="token punctuation">[</span><span class="token string">'petal.width'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span>
        dataset<span class="token punctuation">[</span><span class="token string">'petal.width'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    dataset<span class="token punctuation">[</span><span class="token string">'variety'</span><span class="token punctuation">]</span> <span class="token operator">=</span> dataset<span class="token punctuation">[</span><span class="token string">'variety'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>fillna<span class="token punctuation">(</span><span class="token string">'Unknown'</span><span class="token punctuation">)</span>

    <span class="token comment"># ********** End **********#</span>

    <span class="token comment"># 返回dataset</span>
    <span class="token keyword">return</span> dataset

</code></pre> 
<h2><a id="_228"></a>二、数据采集实战</h2> 
<h3><a id="1__229"></a>1. 单网页爬取</h3> 
<h4><a id="_230"></a>（一）相关知识</h4> 
<p>为了完成本关任务，需要具备几个基本的技能。首先需要对 Python 语言具有一定的掌握。<mark>了解其中的 urllib 库， re 库， random 库。其中，rrllib 库主要实现对网页的爬取。re 库实现数据的正则化表达。random 库实现数据的随机生成。</mark></p> 
<h5><a id="1__232"></a>1&gt; 爬虫简介</h5> 
<p><strong>网络爬虫是一种按照一定规则自动抓取互联网信息的程序或者脚本。爬虫的行为过程可以划分为三个部分：</strong></p> 
<ul><li>载入；</li><li>解析；</li><li>存储。</li></ul> 
<h5><a id="2__237"></a>2&gt; 网络爬虫</h5> 
<p>    在利用 Python 进行数据爬取的过程中，我们首先需要了解爬虫的基本技能树，包括：<strong>静态网页采集、动态网页采集、爬虫框架设计以及数据存储</strong>。</p> 
<ul><li>在静态网页的取得过程中，需要涉及正则化规则和一些 Python 库。比如 requests 和 beautifulSoup(bs4)；</li><li>在进行动态网页爬取的过程中，需要解决验证码自动识别的问题；</li><li>在进行爬虫框架设计的过程中，需要掌握 pyspider 和 scrapy ；</li><li>在进行数据存储的过程中，需要掌握 CSV、EXCEL、TXT 等格式文件和 MongDB等数据库的相关操作。<br> <img src="https://images2.imgbox.com/ce/7e/YySy3veL_o.png" alt="在这里插入图片描述"></li></ul> 
<h5><a id="3__245"></a>3&gt; 网络爬虫：载入</h5> 
<p><strong>载入就是将目标网站数据下载到本地</strong>，主要步骤如下：</p> 
<ul><li> <p>1.网站数据主要依托于网页 （html） 展示；</p> </li><li> <p>2.爬虫程序向服务器发送网络请求，从而获取相应的网页；</p> 
  <ul><li>网站常用网络协议： http，https，ftp；</li><li>数据常用请求方式：<strong>get，post</strong>； 
    <ul><li><strong>get</strong> ：参数常放置在 URL 中，如： http://www.adc.com?p=1&amp;q=2&amp;r=3 ， 问号后为参数；</li><li><strong>post</strong> ：参数常放置在一个表单（报文头（ header ））中。</li></ul> </li></ul> </li></ul> 
<p><mark>实际操作：抓取一个静态网页步骤</mark></p> 
<ul><li><strong>1.确定 URL</strong>；</li><li><strong>2.确定请求的方式以及相关参数</strong>；</li><li><strong>3.用浏览器或者抓包工具 URL 发送参数</strong>；</li><li><strong>4.即可收到网页返回的结果</strong>。</li></ul> 
<h5><a id="4__262"></a>4&gt; 网络爬虫：动态载入</h5> 
<p>    <strong>部分页面的数据是动态加载的，比如 Ajax 异步请求，网页中的部分数据需要浏览器渲染或者用户的某些点击、下拉的操作触发才能获得的即 Ajax 异步请求</strong>。<br>     面对动态加载的页面时，我们可以借助抓包工具，分析某次操作所触发的请求，通过代码实现相应请求利用智能化的工具：<strong>selenium + webdriver</strong>。</p> 
<h5><a id="5__265"></a>5&gt; 网络爬虫：解析</h5> 
<p><strong>在载入的结果中抽取特定的数据</strong>，<strong>载入的结果主要分成三类</strong>：<strong>html、json、xml</strong> 。</p> 
<ul><li> <p><strong>html</strong>： beautifulSoup、xpath 等；</p> </li><li> <p><strong>json</strong>： json 、 demjson 等；</p> </li><li> <p><strong>xml</strong>： xml 、 libxml2 等。</p> </li></ul> 
<h4><a id="_272"></a>（二）本关任务</h4> 
<p>请仔细阅读代码，结合相关知识，在 Begin-End 区域内进行代码补充，编写一个爬虫，爬取 www.jd.com 网的 title ，具体要求如下：</p> 
<ul><li> <p>获取 www.jd.com 的页面 html 代码并保存在 ./step1/京东.html；<br> <img src="https://images2.imgbox.com/82/0b/FKTKsgr0_o.png" alt="在这里插入图片描述"></p> </li><li> <p>使用正则提取 title；</p> </li><li> <p>将 title 的内容保存为 csv 文件，位置为 ./step1/csv_file.csv。</p> </li></ul> 
<h4><a id="_279"></a>（三）参考代码</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token keyword">import</span> csv
<span class="token keyword">import</span> re

<span class="token comment"># 打开京东www.jd.com，读取并爬到内存中，解码, 并赋值给data</span>
<span class="token comment"># 将data保存到本地</span>
<span class="token comment"># ********** Begin ********** #</span>
data <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span><span class="token string">"https://www.jd.com"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">,</span> <span class="token string">"ignore"</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"./step1/京东.html"</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token comment"># ********** End ********** #</span>

<span class="token comment"># 使用正则提取title</span>
<span class="token comment"># 保存数据到csv文件中</span>
<span class="token comment"># ********** Begin ********** #</span>
pattern <span class="token operator">=</span> <span class="token string">"&lt;title&gt;(.*?)&lt;/title&gt;"</span>
title <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>pattern<span class="token punctuation">,</span> re<span class="token punctuation">.</span>S<span class="token punctuation">)</span><span class="token punctuation">.</span>findall<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"./step1/csv_file.csv"</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f_csv <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    f_csv<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>title<span class="token punctuation">)</span>

<span class="token comment"># ********** End ********** #</span>

</code></pre> 
<h3><a id="2_305"></a>2.网页爬取策略</h3> 
<h4><a id="_306"></a>（一）相关知识</h4> 
<p>主要介绍两种爬虫爬取策略：<strong>1. 深度优先爬虫； 2. 广度优先爬虫。</strong></p> 
<h5><a id="1__308"></a>1&gt; 深度优先爬虫（一路到底）</h5> 
<p>在一个网页中，当一个超链被选择后，被链接的网页将执行深度优先搜索，即在搜索其余的超链结果之前必须先完整地搜索单独的一条链。深度优先搜索沿着网页上的超链走到不能再深入为止，然后返回到某一个网页，再继续选择该网页中的其他超链。当不再有其他超链可选择时，说明搜索已经结束。</p> 
<p>示例：<br> <img src="https://images2.imgbox.com/af/9e/pMv5EUoE_o.png" alt=""><br> 爬取顺序为：1-&gt;2-&gt;4-&gt;8-&gt;5-&gt;3-&gt;6-&gt;7</p> 
<h5><a id="2__314"></a>2&gt; 广度优先爬虫（逐层爬取）</h5> 
<p>广度优先爬虫过程就是从一系列的种子节点开始，把这些网页中的“子节点” 提取出来，放入队列中依次进行抓取，被处理过的链接需要放入一张表中。每次新处理一个链接之前，需要查看这个链接是否已经存在于表中。如果存在，证明链接已经处理过， 跳过，不做处理，否则进行下一步处理。</p> 
<p>示例：<br> <img src="https://images2.imgbox.com/4b/4a/7Q3IAlAz_o.png" alt="在这里插入图片描述"><br> 爬取顺序为：1-&gt;2-&gt;3-&gt;4-&gt;5-&gt;6-&gt;7-&gt;8</p> 
<h4><a id="_320"></a>（二）本关任务</h4> 
<p>请仔细阅读代码，结合相关知识，在 Begin-End 区域内进行代码补充，编写一个爬虫实现<mark>深度优先爬虫</mark>，爬取的网站为 <mark>www.baidu.com</mark>。</p> 
<h4><a id="_322"></a>（三）参考代码</h4> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
' @author:ljq
' @date:2021/04/12
' @description
'
'''</span>
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> re


<span class="token keyword">class</span> <span class="token class-name">linkQuence</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 已访问的url集合</span>
        self<span class="token punctuation">.</span>visted <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token comment"># 待访问的url集合</span>
        self<span class="token punctuation">.</span>unVisited <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

    <span class="token comment"># 获取访问过的url队列</span>
    <span class="token keyword">def</span> <span class="token function">getVisitedUrl</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>visted

    <span class="token comment"># 获取未访问的url队列</span>
    <span class="token keyword">def</span> <span class="token function">getUnvisitedUrl</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>unVisited

    <span class="token comment"># 添加到访问过得url队列中</span>
    <span class="token keyword">def</span> <span class="token function">addVisitedUrl</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>visted<span class="token punctuation">.</span>append<span class="token punctuation">(</span>url<span class="token punctuation">)</span>

    <span class="token comment"># 移除访问过得url</span>
    <span class="token keyword">def</span> <span class="token function">removeVisitedUrl</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>visted<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>url<span class="token punctuation">)</span>

    <span class="token comment"># 未访问过得url出队列</span>
    <span class="token keyword">def</span> <span class="token function">unVisitedUrlDeQuence</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> self<span class="token punctuation">.</span>unVisited<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token boolean">None</span>

    <span class="token comment"># 保证每个url只被访问一次</span>
    <span class="token keyword">def</span> <span class="token function">addUnvisitedUrl</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> url <span class="token operator">!=</span> <span class="token string">""</span> <span class="token keyword">and</span> url <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>visted <span class="token keyword">and</span> url <span class="token keyword">not</span> <span class="token keyword">in</span> self<span class="token punctuation">.</span>unVisited<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>unVisited<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> url<span class="token punctuation">)</span>

    <span class="token comment"># 获得已访问的url数目</span>
    <span class="token keyword">def</span> <span class="token function">getVisitedUrlCount</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>visted<span class="token punctuation">)</span>

    <span class="token comment"># 获得未访问的url数目</span>
    <span class="token keyword">def</span> <span class="token function">getUnvistedUrlCount</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>unVisited<span class="token punctuation">)</span>

    <span class="token comment"># 判断未访问的url队列是否为空</span>
    <span class="token keyword">def</span> <span class="token function">unVisitedUrlsEnmpy</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>unVisited<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>


<span class="token keyword">class</span> <span class="token class-name">MyCrawler</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> seeds<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 初始化当前抓取的深度</span>
        self<span class="token punctuation">.</span>current_deepth <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token comment"># 使用种子初始化url队列</span>
        self<span class="token punctuation">.</span>linkQuence <span class="token operator">=</span> linkQuence<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>seeds<span class="token punctuation">,</span> <span class="token builtin">str</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>linkQuence<span class="token punctuation">.</span>addUnvisitedUrl<span class="token punctuation">(</span>seeds<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>seeds<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> seeds<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>linkQuence<span class="token punctuation">.</span>addUnvisitedUrl<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Add the seeds url %s to the unvisited url list"</span> <span class="token operator">%</span>
              <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>linkQuence<span class="token punctuation">.</span>unVisited<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">################ BEGIN ##################</span>
        <span class="token comment"># 抓取过程主函数（方法一）</span>
    <span class="token keyword">def</span> <span class="token function">crawling</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> seeds<span class="token punctuation">,</span> crawl_deepth<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 循环条件：抓取深度不超过crawl_deepth</span>
        <span class="token keyword">while</span> self<span class="token punctuation">.</span>current_deepth <span class="token operator">&lt;=</span> crawl_deepth<span class="token punctuation">:</span>
            <span class="token comment"># 循环条件：待抓取的链接不空</span>
            <span class="token keyword">while</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>linkQuence<span class="token punctuation">.</span>unVisitedUrlsEnmpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># 队头url出队列</span>
                visitUrl <span class="token operator">=</span> self<span class="token punctuation">.</span>linkQuence<span class="token punctuation">.</span>unVisitedUrlDeQuence<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Pop out one url \"%s\" from unvisited url list"</span> <span class="token operator">%</span> visitUrl<span class="token punctuation">)</span>
                <span class="token keyword">if</span> visitUrl <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> visitUrl <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">:</span>
                    <span class="token keyword">continue</span>
                <span class="token comment"># 获取超链接</span>
                links <span class="token operator">=</span> self<span class="token punctuation">.</span>getHyperLinks<span class="token punctuation">(</span>visitUrl<span class="token punctuation">)</span>  <span class="token comment"># 获取visiturl中的所有超链接</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Get %d new links"</span> <span class="token operator">%</span> <span class="token builtin">len</span><span class="token punctuation">(</span>links<span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment"># 将visitUrl放入已访问的url中</span>
                self<span class="token punctuation">.</span>linkQuence<span class="token punctuation">.</span>addVisitedUrl<span class="token punctuation">(</span>visitUrl<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Visited url count: "</span> <span class="token operator">+</span>
                      <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>linkQuence<span class="token punctuation">.</span>getVisitedUrlCount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Visited deepth: "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>current_deepth<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token comment"># 未访问的url入列   也就是visiturl网页中的所有超链接links</span>
            <span class="token keyword">for</span> link <span class="token keyword">in</span> links<span class="token punctuation">:</span>
                self<span class="token punctuation">.</span>linkQuence<span class="token punctuation">.</span>addUnvisitedUrl<span class="token punctuation">(</span>link<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"%d unvisited links:"</span> <span class="token operator">%</span>
                  <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>linkQuence<span class="token punctuation">.</span>getUnvisitedUrl<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>current_deepth <span class="token operator">+=</span> <span class="token number">1</span>
		<span class="token comment"># 抓取过程主函数（方法二）</span>
	<span class="token keyword">def</span> <span class="token function">crawling</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> seeds<span class="token punctuation">,</span> crawl_deepth<span class="token punctuation">)</span><span class="token punctuation">:</span>
		<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token triple-quoted-string string">'''
		Pop out one url "http://baozhang.baidu.com/guarantee/" from unvisited url list
Get 0 new links
Visited url count: 12
Visited deepth: 3
Pop out one url "http://ir.baidu.com/phoenix.zhtml?c=188488&amp;p=irol-irhome" from unvisited url list
Get 19 new links
Visited url count: 13
Visited deepth: 3
19 unvisited links:
		'''</span><span class="token punctuation">)</span>
    <span class="token comment"># 获取源码中得超链接</span>
    <span class="token keyword">def</span> <span class="token function">getHyperLinks</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span>
        links <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        data <span class="token operator">=</span> self<span class="token punctuation">.</span>getPageSource<span class="token punctuation">(</span>url<span class="token punctuation">)</span>  <span class="token comment"># 获取url网页源码</span>
        soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span>
        a <span class="token operator">=</span> soup<span class="token punctuation">.</span>findAll<span class="token punctuation">(</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">"href"</span><span class="token punctuation">:</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">'^http|^/'</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> a<span class="token punctuation">:</span>
            <span class="token keyword">if</span> i<span class="token punctuation">[</span><span class="token string">"href"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">"http://"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
                links<span class="token punctuation">.</span>append<span class="token punctuation">(</span>i<span class="token punctuation">[</span><span class="token string">"href"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> links

    <span class="token comment"># 获取网页源码</span>
    <span class="token keyword">def</span> <span class="token function">getPageSource</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> url<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
            r<span class="token punctuation">.</span>raise_for_status<span class="token punctuation">(</span><span class="token punctuation">)</span>
            r<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span>
            <span class="token keyword">return</span> r<span class="token punctuation">.</span>text
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token string">''</span>
<span class="token comment">############### END ###############</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>seeds<span class="token punctuation">,</span> crawl_deepth<span class="token punctuation">)</span><span class="token punctuation">:</span>
    craw <span class="token operator">=</span> MyCrawler<span class="token punctuation">(</span>seeds<span class="token punctuation">)</span>
    craw<span class="token punctuation">.</span>crawling<span class="token punctuation">(</span>seeds<span class="token punctuation">,</span> crawl_deepth<span class="token punctuation">)</span>


<span class="token comment"># 爬取百度超链接，深度为3</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token string">"http://www.baidu.com"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>

</code></pre> 
<h3><a id="3_468"></a>3.爬取与反爬取</h3> 
<h4><a id="_469"></a>（一）相关知识</h4> 
<p>随着网络爬虫对目标网站访问频率的加大，网站也会禁止爬虫程序访问。</p> 
<h5><a id="1_472"></a>1&gt;常见反爬手段：</h5> 
<ul><li>出现用户登录界面，需要验证码；</li><li>禁止某个固定用户帐号或 ip 一段时间内访问网站；</li><li>直接返回错误的无用数据。</li></ul> 
<h5><a id="2__477"></a>2&gt; 应对措施：</h5> 
<ul><li>优化爬虫程序，尽量减少访问次数，尽量不抓取重复内容；</li><li>使用多个 cookie （网站用来识别用户的手段，每个用户登录会生成一个 cookie ）；</li><li>使用多个 ip （可以用代理实现）。</li></ul> 
<h4><a id="_482"></a>（二）本关任务</h4> 
<p>本关任务：编写一个爬虫，实现对<a href="http://121.40.96.250:9999/webdemo/page/1/12/749" rel="nofollow">http://121.40.96.250:9999/webdemo/page/1/12/749</a> 该网址所有信息的爬取，并将结果保存在 step3/result.txt 中。</p> 
<h4><a id="_484"></a>（三）参考代码</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request


<span class="token keyword">def</span> <span class="token function">spider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	<span class="token comment"># 任意改一个可以爬取的网页即可</span>
    url <span class="token operator">=</span> <span class="token string">"https://www.qiushibaike.com/text/page/"</span>
    <span class="token comment"># ********** Begin **********#</span>
    <span class="token comment"># 构建opener</span>
    opener <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># User-Agent设置成浏览器的值</span>
    User_Agent <span class="token operator">=</span> <span class="token punctuation">(</span>
        <span class="token string">'User-agent'</span><span class="token punctuation">,</span> <span class="token string">'Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)'</span><span class="token punctuation">)</span>
    <span class="token comment"># 将UA添加到headers中</span>
    opener<span class="token punctuation">.</span>addheaders <span class="token operator">=</span> <span class="token punctuation">[</span>User_Agent<span class="token punctuation">]</span>
    urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>install_opener<span class="token punctuation">(</span>opener<span class="token punctuation">)</span>
    data <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">,</span> <span class="token string">"ignore"</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'step3/result.txt'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
        fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token comment"># ********** End **********#</span>
    <span class="token keyword">return</span> data

</code></pre> 
<h3><a id="4_508"></a>4.爬取与反爬取进阶</h3> 
<h4><a id="_509"></a>（一）相关知识</h4> 
<p>    <mark>在反爬机制中，许多网站会通过 ip 以及请求头来限制你的访问，在不影响网站正常运作的情况下，我们可以使用 ip 代理池以及随机请求头来伪装自己的爬虫，其中需要用到的就是 python 的 random 模块。</mark></p> 
<h4><a id="_511"></a>（二）本关任务</h4> 
<p>使用随机请求头爬取 <a href="https://www.qiushibaike.com/text/" rel="nofollow">www.qiushibaike.com/text/</a> 前两页的段子内容，并保存在 ./step4/content.txt 中。</p> 
<h4><a id="_513"></a>（三）参考代码</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request
<span class="token keyword">import</span> re
<span class="token keyword">import</span> random
<span class="token comment"># 请求头</span>
uapools <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.79 Safari/537.36 Edge/14.14393"</span><span class="token punctuation">,</span>
    <span class="token string">"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.22 Safari/537.36 SE 2.X MetaSr 1.0"</span><span class="token punctuation">,</span>
    <span class="token string">"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Maxthon 2.0)"</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>


<span class="token keyword">def</span> <span class="token function">UA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#********** Begin **********#</span>
    <span class="token comment"># 使用随机请求头</span>
    opener <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>build_opener<span class="token punctuation">(</span><span class="token punctuation">)</span>
    thisua <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>uapools<span class="token punctuation">)</span>
    ua <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"User-Agent"</span><span class="token punctuation">,</span> thisua<span class="token punctuation">)</span>
    opener<span class="token punctuation">.</span>addheaders <span class="token operator">=</span> <span class="token punctuation">[</span>ua<span class="token punctuation">]</span>
    urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>install_opener<span class="token punctuation">(</span>opener<span class="token punctuation">)</span>
    <span class="token comment"># print("当前使用UA："+str(thisua))</span>
    <span class="token comment">#********** End **********#</span>


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment"># page为页号，int类型</span>
    <span class="token comment">#********** Begin **********#</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> page<span class="token punctuation">)</span><span class="token punctuation">:</span>
        UA<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># 此处需加https，否则报错“ValueError: unknown url type”</span>
        thisurl <span class="token operator">=</span> <span class="token string">"https://www.qiushibaike.com/text/page/"</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
        data <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>thisurl<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">,</span> <span class="token string">"ignore"</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./step4/content.txt'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fp<span class="token punctuation">:</span>
            fp<span class="token punctuation">.</span>write<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token comment">#********** End **********#</span>

</code></pre> 
<p><em>@date: 2021.04.12<br> @author: zkinglin</em><br> （完）</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1b2b1ce071bb33776cc0b6eb4bc204b4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据挖掘——数据可视化</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/eb85cd6565dbd2e53c0ea1cfd642567f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数据挖掘——决策树和K近邻</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>