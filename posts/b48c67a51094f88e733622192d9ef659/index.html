<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>iOS 吸顶效果 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="iOS 吸顶效果" />
<meta property="og:description" content="项目中，在列表向上滚动时，有时需要将某个控件置顶，这就是我们常见的吸顶效果。
1. UITableView 吸顶效果 UITableView是自带吸顶效果，我们把需要置顶的控件设置为SectionHeaderView，这样在滚动时，该控件会自动置顶。
- (UITableView *)tableView { if (!_tableView) { _tableView = [[UKNestedTableView alloc] init]; _tableView.bounces = NO; _tableView.showsVerticalScrollIndicator = NO; _tableView.delegate = self; _tableView.dataSource = self; [_tableView registerClass:[UITableViewCell class] forCellReuseIdentifier:@&#34;CellId&#34;]; } return _tableView; } #pragma mark - UITableViewDataSource - - (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView { return 2; } - (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section { if (section == 0) { return 1; } return 20; } - (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath { if (indexPath." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b48c67a51094f88e733622192d9ef659/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-17T14:01:50+08:00" />
<meta property="article:modified_time" content="2023-04-17T14:01:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">iOS 吸顶效果</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>项目中，在列表向上滚动时，有时需要将某个控件置顶，这就是我们常见的吸顶效果。</p> 
<h2><a id="1_UITableView__1"></a>1. UITableView 吸顶效果</h2> 
<p><code>UITableView</code>是自带吸顶效果，我们把需要置顶的控件设置为<code>SectionHeaderView</code>，这样在滚动时，该控件会自动置顶。</p> 
<pre><code class="prism language-objectivec"><span class="token operator">-</span> <span class="token punctuation">(</span>UITableView <span class="token operator">*</span><span class="token punctuation">)</span>tableView <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_tableView<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        _tableView <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>UKNestedTableView alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        _tableView<span class="token punctuation">.</span>bounces <span class="token operator">=</span> NO<span class="token punctuation">;</span>
        _tableView<span class="token punctuation">.</span>showsVerticalScrollIndicator <span class="token operator">=</span> NO<span class="token punctuation">;</span>

        _tableView<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
        _tableView<span class="token punctuation">.</span>dataSource <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
        
        <span class="token punctuation">[</span>_tableView registerClass<span class="token punctuation">:</span><span class="token punctuation">[</span>UITableViewCell class<span class="token punctuation">]</span> forCellReuseIdentifier<span class="token punctuation">:</span><span class="token string">@"CellId"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _tableView<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">mark <span class="token operator">-</span> UITableViewDataSource <span class="token operator">-</span></span></span>
<span class="token operator">-</span> <span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>numberOfSectionsInTableView<span class="token punctuation">:</span><span class="token punctuation">(</span>UITableView <span class="token operator">*</span><span class="token punctuation">)</span>tableView <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>tableView<span class="token punctuation">:</span><span class="token punctuation">(</span>UITableView <span class="token operator">*</span><span class="token punctuation">)</span>tableView numberOfRowsInSection<span class="token punctuation">:</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>section <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>section <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">20</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>CGFloat<span class="token punctuation">)</span>tableView<span class="token punctuation">:</span><span class="token punctuation">(</span>UITableView <span class="token operator">*</span><span class="token punctuation">)</span>tableView heightForRowAtIndexPath<span class="token punctuation">:</span><span class="token punctuation">(</span>NSIndexPath <span class="token operator">*</span><span class="token punctuation">)</span>indexPath <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>indexPath<span class="token punctuation">.</span>section <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token number">150</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">60</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>UIView <span class="token operator">*</span><span class="token punctuation">)</span>tableView<span class="token punctuation">:</span><span class="token punctuation">(</span>UITableView <span class="token operator">*</span><span class="token punctuation">)</span>tableView viewForHeaderInSection<span class="token punctuation">:</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>section <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>section <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        UIView <span class="token operator">*</span>headerView <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>UIView alloc<span class="token punctuation">]</span> initWithFrame<span class="token punctuation">:</span><span class="token function">CGRectMake</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> kScreenWidth<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        headerView<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor blueColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> headerView<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> nil<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>CGFloat<span class="token punctuation">)</span>tableView<span class="token punctuation">:</span><span class="token punctuation">(</span>UITableView <span class="token operator">*</span><span class="token punctuation">)</span>tableView heightForHeaderInSection<span class="token punctuation">:</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>section <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>section <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token number">50</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>UITableViewCell <span class="token operator">*</span><span class="token punctuation">)</span>tableView<span class="token punctuation">:</span><span class="token punctuation">(</span>UITableView <span class="token operator">*</span><span class="token punctuation">)</span>tableView cellForRowAtIndexPath<span class="token punctuation">:</span><span class="token punctuation">(</span>NSIndexPath <span class="token operator">*</span><span class="token punctuation">)</span>indexPath <span class="token punctuation">{<!-- --></span>
    UITableViewCell <span class="token operator">*</span>cell <span class="token operator">=</span> <span class="token punctuation">[</span>tableView dequeueReusableCellWithIdentifier<span class="token punctuation">:</span><span class="token string">@"CellId"</span> forIndexPath<span class="token punctuation">:</span>indexPath<span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span> <span class="token punctuation">(</span>indexPath<span class="token punctuation">.</span>section <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cell<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor yellowColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
        cell<span class="token punctuation">.</span>textLabel<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">@"section 0"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>indexPath<span class="token punctuation">.</span>row <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            cell<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor grayColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            cell<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor whiteColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        cell<span class="token punctuation">.</span>textLabel<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token punctuation">[</span>NSString stringWithFormat<span class="token punctuation">:</span><span class="token string">@"item - %ld"</span><span class="token punctuation">,</span> indexPath<span class="token punctuation">.</span>row<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> cell<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>自定义<code>UKNestedTableView</code></p> 
<pre><code class="prism language-objectivec"><span class="token keyword">@implementation</span> UKNestedTableView

<span class="token operator">-</span> <span class="token punctuation">(</span>instancetype<span class="token punctuation">)</span>init <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">self</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">super</span> initWithFrame<span class="token punctuation">:</span>CGRectZero style<span class="token punctuation">:</span>UITableViewStylePlain<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor whiteColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>separatorColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor clearColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token keyword">self</span><span class="token punctuation">.</span>separatorStyle <span class="token operator">=</span> UITableViewCellSeparatorStyleNone<span class="token punctuation">;</span>
                
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">@</span><span class="token function">available</span><span class="token punctuation">(</span>iOS <span class="token number">11.0</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>contentInsetAdjustmentBehavior <span class="token operator">=</span> UIScrollViewContentInsetAdjustmentNever<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">self</span><span class="token punctuation">.</span>estimatedRowHeight <span class="token operator">=</span> <span class="token number">0.000</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>estimatedSectionHeaderHeight <span class="token operator">=</span> <span class="token number">0.000</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>estimatedSectionFooterHeight <span class="token operator">=</span> <span class="token number">0.000</span><span class="token punctuation">;</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">@</span><span class="token function">available</span><span class="token punctuation">(</span>iOS <span class="token number">13.0</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>automaticallyAdjustsScrollIndicatorInsets <span class="token operator">=</span> NO<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">@</span><span class="token function">available</span><span class="token punctuation">(</span>iOS <span class="token number">15.0</span><span class="token punctuation">,</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 去除表格头留白</span>
            <span class="token keyword">self</span><span class="token punctuation">.</span>sectionHeaderTopPadding <span class="token operator">=</span> YES<span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">@end</span>
</code></pre> 
<p>效果如下</p> 
<p><img src="https://images2.imgbox.com/97/14/5VVuu0f8_o.gif" alt="在这里插入图片描述"></p> 
<h2><a id="2_TabView_112"></a>2. 带TabView的吸顶效果</h2> 
<p><code>UITableView</code>的吸顶效果能满足部分的要求，但在实际应用中，需要置顶的往往是一些标签页，对应的也是多个列表。</p> 
<p>我们用<a href="https://blog.csdn.net/chennai1101/article/details/130082194">UKTabView</a>作为置顶的控件，并对应多个内容。</p> 
<pre><code class="prism language-objectivec"><span class="token operator">-</span> <span class="token punctuation">(</span>UKTabView <span class="token operator">*</span><span class="token punctuation">)</span>tabView <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_tabView<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        _tabView <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>UKTabView alloc<span class="token punctuation">]</span> initWithFrame<span class="token punctuation">:</span><span class="token function">CGRectMake</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> kScreenWidth<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>_tabView setIndicatorWidth<span class="token punctuation">:</span><span class="token number">80</span> height<span class="token punctuation">:</span><span class="token number">2</span> radius<span class="token punctuation">:</span><span class="token number">1</span> color<span class="token punctuation">:</span><span class="token punctuation">[</span>UIColor blueColor<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        UKCustomTabItemView <span class="token operator">*</span>tabItemView1 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>UKCustomTabItemView alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>tabItemView1 setText<span class="token punctuation">:</span><span class="token string">@"选项1"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>_tabView addItemView<span class="token punctuation">:</span>tabItemView1<span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        UKCustomTabItemView <span class="token operator">*</span>tabItemView2 <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>UKCustomTabItemView alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>tabItemView2 setText<span class="token punctuation">:</span><span class="token string">@"选项2"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>_tabView addItemView<span class="token punctuation">:</span>tabItemView2<span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        _tabView<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
        
        <span class="token punctuation">[</span>_tabView setSelection<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _tabView<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>UIView <span class="token operator">*</span><span class="token punctuation">)</span>tableView<span class="token punctuation">:</span><span class="token punctuation">(</span>UITableView <span class="token operator">*</span><span class="token punctuation">)</span>tableView viewForHeaderInSection<span class="token punctuation">:</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>section <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>section <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span>tabView<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> nil<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token operator">-</span> <span class="token punctuation">(</span>UITableViewCell <span class="token operator">*</span><span class="token punctuation">)</span>tableView<span class="token punctuation">:</span><span class="token punctuation">(</span>UITableView <span class="token operator">*</span><span class="token punctuation">)</span>tableView cellForRowAtIndexPath<span class="token punctuation">:</span><span class="token punctuation">(</span>NSIndexPath <span class="token operator">*</span><span class="token punctuation">)</span>indexPath <span class="token punctuation">{<!-- --></span>
    UITableViewCell <span class="token operator">*</span>cell <span class="token operator">=</span> <span class="token punctuation">[</span>tableView dequeueReusableCellWithIdentifier<span class="token punctuation">:</span><span class="token string">@"CellId"</span> forIndexPath<span class="token punctuation">:</span>indexPath<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>indexPath<span class="token punctuation">.</span>section <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        cell<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor yellowColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
        cell<span class="token punctuation">.</span>textLabel<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token string">@"section 0"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>indexPath<span class="token punctuation">.</span>row <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>selection <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                cell<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor grayColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                cell<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor darkGrayColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            cell<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token punctuation">[</span>UIColor whiteColor<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        cell<span class="token punctuation">.</span>textLabel<span class="token punctuation">.</span>text <span class="token operator">=</span> <span class="token punctuation">[</span>NSString stringWithFormat<span class="token punctuation">:</span><span class="token string">@"item %ld - %ld"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>selection<span class="token punctuation">,</span> indexPath<span class="token punctuation">.</span>row<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> cell<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">mark <span class="token operator">-</span> UKTabViewDelegate <span class="token operator">-</span></span></span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>onTabViewSelected<span class="token punctuation">:</span><span class="token punctuation">(</span>UKTabView <span class="token operator">*</span><span class="token punctuation">)</span>tabView position<span class="token punctuation">:</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>position <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>selection <span class="token operator">=</span> position<span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>tableView reloadData<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>效果如下<br> <img src="https://images2.imgbox.com/7f/e0/aWMw5kxV_o.gif" alt="在这里插入图片描述"></p> 
<p>上述的方法简单地实现了标签页置顶和选项卡切换功能，但由于我们只能共用一个列表，所以会发生两个标签页都滚动的现象。</p> 
<p>为此，我们需要优化滚动的偏移，首先在滚动结束时记录偏移量，然后在切换标签页时设置原有的偏移量。</p> 
<pre><code class="prism language-objectivec"><span class="token keyword">@property</span><span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> assign<span class="token punctuation">)</span> NSInteger selection<span class="token punctuation">;</span>
<span class="token keyword">@property</span><span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> assign<span class="token punctuation">)</span> CGFloat tab1Offset<span class="token punctuation">;</span>
<span class="token keyword">@property</span><span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> assign<span class="token punctuation">)</span> CGFloat tab2Offset<span class="token punctuation">;</span>

<span class="token comment">// 拖动结束</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>scrollViewDidEndDragging<span class="token punctuation">:</span><span class="token punctuation">(</span>UIScrollView <span class="token operator">*</span><span class="token punctuation">)</span>scrollView willDecelerate<span class="token punctuation">:</span><span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span>decelerate <span class="token punctuation">{<!-- --></span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@"scrollViewDidEndDragging"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">[</span><span class="token keyword">self</span> recordOffset<span class="token punctuation">:</span>scrollView<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 滚动结束</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>scrollViewDidEndDecelerating<span class="token punctuation">:</span><span class="token punctuation">(</span>UIScrollView <span class="token operator">*</span><span class="token punctuation">)</span>scrollView <span class="token punctuation">{<!-- --></span>
    <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@"scrollViewDidEndDecelerating"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">[</span><span class="token keyword">self</span> recordOffset<span class="token punctuation">:</span>scrollView<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>recordOffset<span class="token punctuation">:</span><span class="token punctuation">(</span>UIScrollView <span class="token operator">*</span><span class="token punctuation">)</span>scrollView <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>selection <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>tab1Offset <span class="token operator">=</span> scrollView<span class="token punctuation">.</span>contentOffset<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
        <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@"tab1Offset = %.2f"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>tab1Offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>selection <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>tab2Offset <span class="token operator">=</span> scrollView<span class="token punctuation">.</span>contentOffset<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
        <span class="token function">NSLog</span><span class="token punctuation">(</span><span class="token string">@"tab2Offset = %.2f"</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>tab2Offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在切换标签页时，设置实际的偏移量</p> 
<pre><code class="prism language-objectivec"><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>onTabViewSelected<span class="token punctuation">:</span><span class="token punctuation">(</span>UKTabView <span class="token operator">*</span><span class="token punctuation">)</span>tabView position<span class="token punctuation">:</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>position <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>selection <span class="token operator">=</span> position<span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>tableView reloadData<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// 有时设置tableView.contentOffset无效，需要提前刷新</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>tableView layoutIfNeeded<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>tableView<span class="token punctuation">.</span>contentOffset <span class="token operator">=</span> <span class="token function">CGPointMake</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>tab1Offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>tableView<span class="token punctuation">.</span>contentOffset <span class="token operator">=</span> <span class="token function">CGPointMake</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>tab2Offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>效果如下<br> <img src="https://images2.imgbox.com/b5/bd/Hsqbd6xa_o.gif" alt="在这里插入图片描述"></p> 
<p>虽然我们记录了原有的偏移量，但从实际的效果来看，切换时<code>TabView</code>会在同样的位置，闪烁比较严重。为此，我们需要尽量保持<code>TabView</code>的位置。</p> 
<pre><code class="prism language-objectivec"><span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>onTabViewSelected<span class="token punctuation">:</span><span class="token punctuation">(</span>UKTabView <span class="token operator">*</span><span class="token punctuation">)</span>tabView position<span class="token punctuation">:</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>position <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>selection <span class="token operator">=</span> position<span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>tableView reloadData<span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>tableView layoutIfNeeded<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>tab1Offset <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span> getDestOffset<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>tab1Offset originOffset<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>tab2Offset<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>tableView<span class="token punctuation">.</span>contentOffset <span class="token operator">=</span> <span class="token function">CGPointMake</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>tab1Offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>tab2Offset <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">self</span> getDestOffset<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>tab2Offset originOffset<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>tab1Offset<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>tableView<span class="token punctuation">.</span>contentOffset <span class="token operator">=</span> <span class="token function">CGPointMake</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>tab2Offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 如果TabView已经置顶，切换时保持置顶。</span>
<span class="token comment">// 1、如果切换后的内容已经置顶，保持原有效果</span>
<span class="token comment">// 2、如果切换后的内容没有置顶，修改切换后的内容为置顶</span>
<span class="token comment">// 如果TabView没有制度，切换后保持一致</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>CGFloat<span class="token punctuation">)</span>getDestOffset<span class="token punctuation">:</span><span class="token punctuation">(</span>CGFloat<span class="token punctuation">)</span>destOffset originOffset<span class="token punctuation">:</span><span class="token punctuation">(</span>CGFloat<span class="token punctuation">)</span>originOffset <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>originOffset <span class="token operator">&gt;=</span> <span class="token number">150</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>destOffset <span class="token operator">&gt;=</span> <span class="token number">150</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> destOffset<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token number">150</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> originOffset<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>效果如下<br> <img src="https://images2.imgbox.com/3c/ca/HvleMdPF_o.gif" alt="在这里插入图片描述"></p> 
<p>虽然现在的方案已经解决了大部分的需求，但还是留下了一点瑕疵，</p> 
<ol><li>内容只能用<code>UIScrollView</code>显示</li><li>为了保持<code>UKTableView</code>保持位置不变，不能完全保证内容的偏移位置。</li><li>如果一个内容较短的情况下，依然会有偏移量的问题，虽然我们可以通过填充空白内容来改善这个问题，但又增加了很多工作量。</li><li>内容切换时没有平顺的效果。</li></ol> 
<h2><a id="3_UITableViewUICollectionView_273"></a>3. UITableView+UICollectionView嵌套</h2> 
<p>为了尽可能的完善我们的吸顶效果，我们尝试用<code>UITableView+UICollectionView</code>的组合来实现吸顶和左右滑动二种效果。</p> 
<p>我们自定义<code>UKNestedScrollView</code></p> 
<pre><code class="prism language-objectivec"><span class="token keyword">@interface</span> <span class="token function">UKNestedScrollView</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">@property</span><span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> strong<span class="token punctuation">)</span> NSMutableArray <span class="token operator">&lt;</span>UITableView <span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token operator">*</span>contentViewArray<span class="token punctuation">;</span>
<span class="token keyword">@property</span><span class="token punctuation">(</span>nonatomic<span class="token punctuation">,</span> assign<span class="token punctuation">)</span> BOOL dragging<span class="token punctuation">;</span>

<span class="token keyword">@end</span>

<span class="token keyword">@implementation</span> UKNestedScrollView

<span class="token operator">-</span> <span class="token punctuation">(</span>instancetype<span class="token punctuation">)</span>initWithFrame<span class="token punctuation">:</span><span class="token punctuation">(</span>CGRect<span class="token punctuation">)</span>frame <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">self</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">super</span> initWithFrame<span class="token punctuation">:</span>frame<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">[</span><span class="token keyword">self</span> setupInitialUI<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 设置表头</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>setHeaderView<span class="token punctuation">:</span><span class="token punctuation">(</span>UIView <span class="token operator">*</span><span class="token punctuation">)</span>headerView <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>tableView<span class="token punctuation">.</span>tableHeaderView <span class="token operator">=</span> headerView<span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>headerHeight <span class="token operator">=</span> headerView<span class="token punctuation">.</span>frame<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 添加标签页和内容</span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>addTabView<span class="token punctuation">:</span><span class="token punctuation">(</span>UKTabItemView <span class="token operator">*</span><span class="token punctuation">)</span>itemView contentView<span class="token punctuation">:</span><span class="token punctuation">(</span>UITableView <span class="token operator">*</span><span class="token punctuation">)</span>contentView <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>tabView addItemView<span class="token punctuation">:</span>itemView<span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>contentViewArray addObject<span class="token punctuation">:</span>contentView<span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>collectionView reloadData<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>setupInitialUI <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// UKNestedScrollView包含一个UITableView</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span> addSubview<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>tableView<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>tableView mas_makeConstraints<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>MASConstraintMaker <span class="token operator">*</span>make<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        make<span class="token punctuation">.</span>left<span class="token punctuation">.</span>right<span class="token punctuation">.</span>top<span class="token punctuation">.</span>bottom<span class="token punctuation">.</span><span class="token function">equalTo</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>UITableView <span class="token operator">*</span><span class="token punctuation">)</span>tableView <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_tableView<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        _tableView <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>UKNestedTableView alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        _tableView<span class="token punctuation">.</span>bounces <span class="token operator">=</span> NO<span class="token punctuation">;</span>
        _tableView<span class="token punctuation">.</span>showsVerticalScrollIndicator <span class="token operator">=</span> NO<span class="token punctuation">;</span>

        _tableView<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
        _tableView<span class="token punctuation">.</span>dataSource <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
        
        <span class="token punctuation">[</span>_tableView registerClass<span class="token punctuation">:</span><span class="token punctuation">[</span>UITableViewCell class<span class="token punctuation">]</span> forCellReuseIdentifier<span class="token punctuation">:</span><span class="token string">@"CellId"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _tableView<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>UITableView <span class="token operator">*</span><span class="token punctuation">)</span>tableView <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_tableView<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        _tableView <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>UKNestedTableView alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        _tableView<span class="token punctuation">.</span>bounces <span class="token operator">=</span> NO<span class="token punctuation">;</span>
        _tableView<span class="token punctuation">.</span>showsVerticalScrollIndicator <span class="token operator">=</span> NO<span class="token punctuation">;</span>

        _tableView<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
        _tableView<span class="token punctuation">.</span>dataSource <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
        
        <span class="token punctuation">[</span>_tableView registerClass<span class="token punctuation">:</span><span class="token punctuation">[</span>UITableViewCell class<span class="token punctuation">]</span> forCellReuseIdentifier<span class="token punctuation">:</span><span class="token string">@"CellId"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _tableView<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// SectionHeaderView包含UKTabView和UICollectionView</span>
<span class="token operator">-</span> <span class="token punctuation">(</span>UIView <span class="token operator">*</span><span class="token punctuation">)</span>sectionHeaderView <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_sectionHeaderView<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        _sectionHeaderView <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>UIView alloc<span class="token punctuation">]</span> initWithFrame<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>frame<span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token punctuation">[</span>_sectionHeaderView addSubview<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>tabView<span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token punctuation">[</span>_sectionHeaderView addSubview<span class="token punctuation">:</span><span class="token keyword">self</span><span class="token punctuation">.</span>collectionView<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _sectionHeaderView<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>UKTabView <span class="token operator">*</span><span class="token punctuation">)</span>tabView <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_tabView<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        _tabView <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>UKTabView alloc<span class="token punctuation">]</span> initWithFrame<span class="token punctuation">:</span><span class="token function">CGRectMake</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>frame<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">[</span>_tabView setIndicatorWidth<span class="token punctuation">:</span><span class="token number">80</span> height<span class="token punctuation">:</span><span class="token number">2</span> radius<span class="token punctuation">:</span><span class="token number">1</span> color<span class="token punctuation">:</span><span class="token punctuation">[</span>UIColor blueColor<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        _tabView<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _tabView<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>UICollectionView <span class="token operator">*</span><span class="token punctuation">)</span>collectionView <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_collectionView<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        UICollectionViewFlowLayout <span class="token operator">*</span>layout <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>UICollectionViewFlowLayout alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>
        layout<span class="token punctuation">.</span>scrollDirection <span class="token operator">=</span> UICollectionViewScrollDirectionHorizontal<span class="token punctuation">;</span>
        layout<span class="token punctuation">.</span>itemSize <span class="token operator">=</span> <span class="token function">CGSizeMake</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>frame<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>frame<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height <span class="token operator">-</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        layout<span class="token punctuation">.</span>minimumLineSpacing <span class="token operator">=</span> CGFLOAT_MIN<span class="token punctuation">;</span>
        layout<span class="token punctuation">.</span>minimumInteritemSpacing <span class="token operator">=</span> CGFLOAT_MIN<span class="token punctuation">;</span>
        
        _collectionView <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>UICollectionView alloc<span class="token punctuation">]</span> initWithFrame<span class="token punctuation">:</span><span class="token function">CGRectMake</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>frame<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>frame<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height <span class="token operator">-</span> <span class="token number">50</span><span class="token punctuation">)</span> collectionViewLayout<span class="token punctuation">:</span>layout<span class="token punctuation">]</span><span class="token punctuation">;</span>
        _collectionView<span class="token punctuation">.</span>pagingEnabled <span class="token operator">=</span> YES<span class="token punctuation">;</span>
        _collectionView<span class="token punctuation">.</span>bounces <span class="token operator">=</span> NO<span class="token punctuation">;</span>
        _collectionView<span class="token punctuation">.</span>showsHorizontalScrollIndicator <span class="token operator">=</span> NO<span class="token punctuation">;</span>

        _collectionView<span class="token punctuation">.</span>dataSource <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
        _collectionView<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>
        
        <span class="token punctuation">[</span>_collectionView registerClass<span class="token punctuation">:</span><span class="token punctuation">[</span>UICollectionViewCell class<span class="token punctuation">]</span> forCellWithReuseIdentifier<span class="token punctuation">:</span><span class="token string">@"CellId"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> _collectionView<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">mark <span class="token operator">-</span> UITableViewDataSource <span class="token operator">-</span></span></span>
<span class="token operator">-</span> <span class="token punctuation">(</span>CGFloat<span class="token punctuation">)</span>tableView<span class="token punctuation">:</span><span class="token punctuation">(</span>UITableView <span class="token operator">*</span><span class="token punctuation">)</span>tableView heightForHeaderInSection<span class="token punctuation">:</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>section <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span>frame<span class="token punctuation">.</span>size<span class="token punctuation">.</span>height<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>UIView <span class="token operator">*</span><span class="token punctuation">)</span>tableView<span class="token punctuation">:</span><span class="token punctuation">(</span>UITableView <span class="token operator">*</span><span class="token punctuation">)</span>tableView viewForHeaderInSection<span class="token punctuation">:</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>section <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span>sectionHeaderView<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>tableView<span class="token punctuation">:</span><span class="token punctuation">(</span>UITableView <span class="token operator">*</span><span class="token punctuation">)</span>tableView numberOfRowsInSection<span class="token punctuation">:</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>section <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>UITableViewCell <span class="token operator">*</span><span class="token punctuation">)</span>tableView<span class="token punctuation">:</span><span class="token punctuation">(</span>UITableView <span class="token operator">*</span><span class="token punctuation">)</span>tableView cellForRowAtIndexPath<span class="token punctuation">:</span><span class="token punctuation">(</span>NSIndexPath <span class="token operator">*</span><span class="token punctuation">)</span>indexPath <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>UITableViewCell alloc<span class="token punctuation">]</span> init<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">mark <span class="token operator">-</span> UICollectionViewDataSource <span class="token operator">-</span></span></span>
<span class="token operator">-</span> <span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>collectionView<span class="token punctuation">:</span><span class="token punctuation">(</span>UICollectionView <span class="token operator">*</span><span class="token punctuation">)</span>collectionView numberOfItemsInSection<span class="token punctuation">:</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>section <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span>contentViewArray<span class="token punctuation">.</span>count<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span>__kindof UICollectionViewCell <span class="token operator">*</span><span class="token punctuation">)</span>collectionView<span class="token punctuation">:</span><span class="token punctuation">(</span>UICollectionView <span class="token operator">*</span><span class="token punctuation">)</span>collectionView cellForItemAtIndexPath<span class="token punctuation">:</span><span class="token punctuation">(</span>NSIndexPath <span class="token operator">*</span><span class="token punctuation">)</span>indexPath <span class="token punctuation">{<!-- --></span>
    UICollectionViewCell <span class="token operator">*</span>cell <span class="token operator">=</span> <span class="token punctuation">[</span>collectionView dequeueReusableCellWithReuseIdentifier<span class="token punctuation">:</span><span class="token string">@"CellId"</span> forIndexPath<span class="token punctuation">:</span>indexPath<span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    UITableView <span class="token operator">*</span>contentView <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>contentViewArray<span class="token punctuation">[</span>indexPath<span class="token punctuation">.</span>row<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>contentView removeFromSuperview<span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token punctuation">[</span>cell<span class="token punctuation">.</span>contentView addSubview<span class="token punctuation">:</span>contentView<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">[</span>contentView mas_makeConstraints<span class="token punctuation">:</span><span class="token operator">^</span><span class="token punctuation">(</span>MASConstraintMaker <span class="token operator">*</span>make<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        make<span class="token punctuation">.</span>left<span class="token punctuation">.</span>right<span class="token punctuation">.</span>top<span class="token punctuation">.</span>bottom<span class="token punctuation">.</span><span class="token function">equalTo</span><span class="token punctuation">(</span>cell<span class="token punctuation">.</span>contentView<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> cell<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">mark <span class="token operator">-</span> UIScrollViewDelegate <span class="token operator">-</span></span></span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>scrollViewWillBeginDragging<span class="token punctuation">:</span><span class="token punctuation">(</span>UIScrollView <span class="token operator">*</span><span class="token punctuation">)</span>scrollView <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>scrollView <span class="token operator">==</span> <span class="token keyword">self</span><span class="token punctuation">.</span>collectionView<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>dragging <span class="token operator">=</span> YES<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>scrollViewDidScroll<span class="token punctuation">:</span><span class="token punctuation">(</span>UIScrollView <span class="token operator">*</span><span class="token punctuation">)</span>scrollView <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>scrollView <span class="token operator">==</span> <span class="token keyword">self</span><span class="token punctuation">.</span>collectionView<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>dragging<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            CGFloat width <span class="token operator">=</span> scrollView<span class="token punctuation">.</span>contentOffset<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
            NSInteger page <span class="token operator">=</span> width<span class="token operator">/</span><span class="token keyword">self</span><span class="token punctuation">.</span>frame<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
            
            <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>tabView setSelection<span class="token punctuation">:</span>page offsetRatio<span class="token punctuation">:</span><span class="token punctuation">(</span>width<span class="token operator">/</span><span class="token keyword">self</span><span class="token punctuation">.</span>frame<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width <span class="token operator">-</span> page<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>scrollViewDidEndDecelerating<span class="token punctuation">:</span><span class="token punctuation">(</span>UIScrollView <span class="token operator">*</span><span class="token punctuation">)</span>scrollView <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>scrollView <span class="token operator">==</span> <span class="token keyword">self</span><span class="token punctuation">.</span>collectionView<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        CGFloat width <span class="token operator">=</span> scrollView<span class="token punctuation">.</span>contentOffset<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
        NSInteger page <span class="token operator">=</span> width<span class="token operator">/</span><span class="token keyword">self</span><span class="token punctuation">.</span>frame<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">;</span>

        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>tabView setSelection<span class="token punctuation">:</span>page<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>dragging <span class="token operator">=</span> NO<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>scrollViewDidEndDragging<span class="token punctuation">:</span><span class="token punctuation">(</span>UIScrollView <span class="token operator">*</span><span class="token punctuation">)</span>scrollView willDecelerate<span class="token punctuation">:</span><span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span>decelerate <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>scrollView <span class="token operator">==</span> <span class="token keyword">self</span><span class="token punctuation">.</span>collectionView <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>decelerate<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        CGFloat width <span class="token operator">=</span> scrollView<span class="token punctuation">.</span>contentOffset<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
        NSInteger page <span class="token operator">=</span> width<span class="token operator">/</span><span class="token keyword">self</span><span class="token punctuation">.</span>frame<span class="token punctuation">.</span>size<span class="token punctuation">.</span>width <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">;</span>

        <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>tabView setSelection<span class="token punctuation">:</span>page<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>dragging <span class="token operator">=</span> NO<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">mark <span class="token operator">-</span> UKTabViewDelegate <span class="token operator">-</span></span></span>
<span class="token operator">-</span> <span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>onTabViewSelected<span class="token punctuation">:</span><span class="token punctuation">(</span>UKTabView <span class="token operator">*</span><span class="token punctuation">)</span>tabView position<span class="token punctuation">:</span><span class="token punctuation">(</span>NSInteger<span class="token punctuation">)</span>position <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">[</span><span class="token keyword">self</span> collectionViewScrollToPosition<span class="token punctuation">:</span>position<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>为了让<code>UICollectionView</code>内的手势能被<code>UITableView</code>接收，需要在<code>UKNestedTableView</code>里面加上</p> 
<pre><code class="prism language-objectivec"><span class="token operator">-</span> <span class="token punctuation">(</span>BOOL<span class="token punctuation">)</span>gestureRecognizer<span class="token punctuation">:</span><span class="token punctuation">(</span>UIGestureRecognizer <span class="token operator">*</span><span class="token punctuation">)</span>gestureRecognizer shouldRecognizeSimultaneouslyWithGestureRecognizer<span class="token punctuation">:</span><span class="token punctuation">(</span>UIGestureRecognizer <span class="token operator">*</span><span class="token punctuation">)</span>otherGestureRecognizer <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> YES<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>显示如下<br> <img src="https://images2.imgbox.com/97/fa/AULPYqgn_o.gif" alt="在这里插入图片描述"></p> 
<p>我们可以看到当列表滑动时，两个列表都在滑动，而且里面的内容的滑动更快。这主要是因为例外两个列表都在滑动，所以里面的列表其实是两个滑动距离相加，所有我们需要在外面列表滑动时，禁止里面列表的滑动。</p> 
<pre><code class="prism language-objectivec"><span class="token keyword">if</span> <span class="token punctuation">(</span>scrollView <span class="token operator">==</span> <span class="token keyword">self</span><span class="token punctuation">.</span>tableView<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>offset <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>tableView<span class="token punctuation">.</span>contentOffset<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
    <span class="token comment">// changed表示外面列表在滑动</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>changed <span class="token operator">=</span> YES<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    NSInteger position <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>UIScrollView <span class="token operator">*</span>contentView <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>contentViewArray<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>contentView <span class="token operator">==</span> scrollView<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 如果外面列表滑动，禁止里面列表滑动事件</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>changed<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                scrollView<span class="token punctuation">.</span>contentOffset <span class="token operator">=</span> <span class="token function">CGPointMake</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>offsetArray<span class="token punctuation">[</span>position<span class="token punctuation">]</span> floatValue<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>changed <span class="token operator">=</span> NO<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 记录当前页面偏移量，方便后面禁止事件</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>offsetArray<span class="token punctuation">[</span>position<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>NSNumber numberWithFloat<span class="token punctuation">:</span>scrollView<span class="token punctuation">.</span>contentOffset<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>           
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        position<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>效果如下<br> <img src="https://images2.imgbox.com/db/88/G6ovqaBd_o.gif" alt="在这里插入图片描述"></p> 
<p>现在的效果已经基本满足了我们的需求，有吸顶效果、能左右滑动、能记录列表偏移量，内容滑动时也比较平顺了。</p> 
<p>最后我们尝试了一下下拉时控制内容先下拉，也许后面有用</p> 
<pre><code class="prism language-objectivec"><span class="token keyword">if</span> <span class="token punctuation">(</span>scrollView <span class="token operator">==</span> <span class="token keyword">self</span><span class="token punctuation">.</span>tableView<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>originOffset <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>offset<span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>offset <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>tableView<span class="token punctuation">.</span>contentOffset<span class="token punctuation">.</span>y<span class="token punctuation">;</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>changed <span class="token operator">=</span> YES<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    NSInteger position <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>UIScrollView <span class="token operator">*</span>contentView <span class="token keyword">in</span> <span class="token keyword">self</span><span class="token punctuation">.</span>contentViewArray<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>contentView <span class="token operator">==</span> scrollView<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>                
            CGFloat scrollViewOffset <span class="token operator">=</span> scrollView<span class="token punctuation">.</span>contentOffset<span class="token punctuation">.</span>y <span class="token operator">-</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>offsetArray<span class="token punctuation">[</span>position<span class="token punctuation">]</span> floatValue<span class="token punctuation">]</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>scrollViewOffset <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>changed<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    scrollView<span class="token punctuation">.</span>contentOffset <span class="token operator">=</span> <span class="token function">CGPointMake</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token keyword">self</span><span class="token punctuation">.</span>offsetArray<span class="token punctuation">[</span>position<span class="token punctuation">]</span> floatValue<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">self</span><span class="token punctuation">.</span>changed <span class="token operator">=</span> NO<span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">self</span><span class="token punctuation">.</span>offsetArray<span class="token punctuation">[</span>position<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>NSNumber numberWithFloat<span class="token punctuation">:</span>scrollView<span class="token punctuation">.</span>contentOffset<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>scrollViewOffset <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>changed<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">self</span><span class="token punctuation">.</span>offset <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>originOffset<span class="token punctuation">;</span>

                    <span class="token keyword">self</span><span class="token punctuation">.</span>tableView<span class="token punctuation">.</span>delegate <span class="token operator">=</span> nil<span class="token punctuation">;</span>
                    <span class="token keyword">self</span><span class="token punctuation">.</span>tableView<span class="token punctuation">.</span>contentOffset <span class="token operator">=</span> <span class="token function">CGPointMake</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">self</span><span class="token punctuation">.</span>offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">self</span><span class="token punctuation">.</span>tableView<span class="token punctuation">.</span>delegate <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">;</span>

                    <span class="token keyword">self</span><span class="token punctuation">.</span>changed <span class="token operator">=</span> NO<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">self</span><span class="token punctuation">.</span>offsetArray<span class="token punctuation">[</span>position<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>NSNumber numberWithFloat<span class="token punctuation">:</span>scrollView<span class="token punctuation">.</span>contentOffset<span class="token punctuation">.</span>y<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        position<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a8a153fd5887805379625d533b1d1bcc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">创建Google play开发者账号，并验证身份通过</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/00f7f25d42a6ab0469d36ad446e6d140/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Elastic-job架构图（plantuml生成）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>