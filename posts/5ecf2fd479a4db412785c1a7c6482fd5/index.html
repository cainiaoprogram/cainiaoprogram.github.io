<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spring Boot 生产就绪中文文档-上 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Spring Boot 生产就绪中文文档-上" />
<meta property="og:description" content="本文为官方文档直译版本。原文链接
由于篇幅较长，遂分两篇。下半部分中文文档
Spring Boot 生产就绪中文文档-上 引言启用 Production-ready 功能端点（Endpoints）启用端点暴露端点安全跨域请求伪造保护 配置端点敏感值脱敏执行器网络终端的超媒体CORS 支持实现自定义端点接收输入输入类型转换 自定义 Web 端点Web 端点请求谓词路径HTTP 方法消耗生产Web 端点响应状态Web 端点范围请求Web 端点安全 Servlet 端点控制器端点 健康信息自动配置HealthIndicators编写自定义HealthIndicators反应式健康指标自动配置ReactiveHealthIndicators健康小组数据源健康 Kubernetes 探针利用 Kubernetes 探测器检查外部状态应用程序生命周期和探针状态 应用信息自动配置InfoContributors自定义应用信息Git 提交信息构建信息Java 信息OS 信息编写自定义InfoContributors 通过 HTTP 进行监控和管理自定义管理端点路径自定义管理服务器端口配置管理专用 SSL自定义管理服务器地址禁用 HTTP 端点通过 JMX 进行监控和管理自定义 MBean 名称禁用 JMX 端点 可观察性（Observability）通用键值防止观察OpenTelemetry 支持 Loggers配置Logger 引言 Spring Boot 包含大量附加功能，可帮助您在将应用程序推向生产时对其进行监控和管理。您可以选择使用 HTTP 端点或 JMX 来管理和监控应用程序。审计、健康状况和指标收集也可自动应用于您的应用程序。
启用 Production-ready 功能 spring-boot-actuator 模块提供了 Spring Boot production-ready 的所有功能。启用这些功能的推荐方法是添加对 spring-boot-starter-actuator &#34;Starter &#34;的依赖。
执行器(Actuator)的定义
执行器是一个制造术语，指用于移动或控制某物的机械装置。推杆可以通过微小的变化产生较大的运动。
要将执行器添加到基于 Maven 的项目中，请添加以下 &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/5ecf2fd479a4db412785c1a7c6482fd5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-05T15:58:35+08:00" />
<meta property="article:modified_time" content="2024-01-05T15:58:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spring Boot 生产就绪中文文档-上</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>本文为官方文档直译版本。<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html#actuator.enabling" rel="nofollow">原文链接</a><br> 由于篇幅较长，遂分两篇。<a href="https://blog.csdn.net/qq_41939901/article/details/135411696">下半部分中文文档</a></p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>Spring Boot 生产就绪中文文档-上</h4> 
 <ul><li><a href="#_4" rel="nofollow">引言</a></li><li><a href="#_Productionready__6" rel="nofollow">启用 Production-ready 功能</a></li><li><a href="#Endpoints_26" rel="nofollow">端点（Endpoints）</a></li><li><ul><li><a href="#_65" rel="nofollow">启用端点</a></li><li><a href="#_93" rel="nofollow">暴露端点</a></li><li><a href="#_130" rel="nofollow">安全</a></li><li><ul><li><a href="#_190" rel="nofollow">跨域请求伪造保护</a></li></ul> 
   </li><li><a href="#_195" rel="nofollow">配置端点</a></li><li><a href="#_205" rel="nofollow">敏感值脱敏</a></li><li><a href="#_223" rel="nofollow">执行器网络终端的超媒体</a></li><li><a href="#CORS__234" rel="nofollow">CORS 支持</a></li><li><a href="#_247" rel="nofollow">实现自定义端点</a></li><li><ul><li><a href="#_259" rel="nofollow">接收输入</a></li><li><ul><li><a href="#_279" rel="nofollow">输入类型转换</a></li></ul> 
    </li><li><a href="#_Web__281" rel="nofollow">自定义 Web 端点</a></li><li><ul><li><a href="#Web__283" rel="nofollow">Web 端点请求谓词</a></li><li><a href="#_287" rel="nofollow">路径</a></li><li><a href="#HTTP__290" rel="nofollow">HTTP 方法</a></li><li><a href="#_299" rel="nofollow">消耗</a></li><li><a href="#_301" rel="nofollow">生产</a></li><li><a href="#Web__304" rel="nofollow">Web 端点响应状态</a></li><li><a href="#Web__309" rel="nofollow">Web 端点范围请求</a></li><li><a href="#Web__313" rel="nofollow">Web 端点安全</a></li></ul> 
    </li><li><a href="#Servlet__315" rel="nofollow">Servlet 端点</a></li><li><a href="#_317" rel="nofollow">控制器端点</a></li></ul> 
   </li><li><a href="#_319" rel="nofollow">健康信息</a></li><li><ul><li><a href="#HealthIndicators_336" rel="nofollow">自动配置HealthIndicators</a></li><li><a href="#HealthIndicators_366" rel="nofollow">编写自定义HealthIndicators</a></li><li><a href="#_427" rel="nofollow">反应式健康指标</a></li><li><a href="#ReactiveHealthIndicators_457" rel="nofollow">自动配置ReactiveHealthIndicators</a></li><li><a href="#_471" rel="nofollow">健康小组</a></li><li><a href="#_521" rel="nofollow">数据源健康</a></li></ul> 
   </li><li><a href="#Kubernetes__523" rel="nofollow">Kubernetes 探针</a></li><li><ul><li><a href="#_Kubernetes__552" rel="nofollow">利用 Kubernetes 探测器检查外部状态</a></li><li><a href="#_568" rel="nofollow">应用程序生命周期和探针状态</a></li></ul> 
   </li><li><a href="#_590" rel="nofollow">应用信息</a></li><li><ul><li><a href="#InfoContributors_592" rel="nofollow">自动配置InfoContributors</a></li><li><a href="#_606" rel="nofollow">自定义应用信息</a></li><li><a href="#Git__627" rel="nofollow">Git 提交信息</a></li><li><a href="#_645" rel="nofollow">构建信息</a></li><li><a href="#Java__649" rel="nofollow">Java 信息</a></li><li><a href="#OS__651" rel="nofollow">OS 信息</a></li><li><a href="#InfoContributors_653" rel="nofollow">编写自定义InfoContributors</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_HTTP__681" rel="nofollow">通过 HTTP 进行监控和管理</a></li><li><ul><li><a href="#_687" rel="nofollow">自定义管理端点路径</a></li><li><a href="#_708" rel="nofollow">自定义管理服务器端口</a></li><li><a href="#_SSL_718" rel="nofollow">配置管理专用 SSL</a></li><li><a href="#_749" rel="nofollow">自定义管理服务器地址</a></li><li><a href="#_HTTP__760" rel="nofollow">禁用 HTTP 端点</a></li><li><a href="#_JMX__775" rel="nofollow">通过 JMX 进行监控和管理</a></li><li><a href="#_MBean__780" rel="nofollow">自定义 MBean 名称</a></li><li><a href="#_JMX__793" rel="nofollow">禁用 JMX 端点</a></li></ul> 
  </li><li><a href="#Observability_802" rel="nofollow">可观察性（Observability）</a></li><li><ul><li><a href="#_840" rel="nofollow">通用键值</a></li><li><a href="#_850" rel="nofollow">防止观察</a></li><li><a href="#OpenTelemetry__883" rel="nofollow">OpenTelemetry 支持</a></li></ul> 
  </li><li><a href="#Loggers_889" rel="nofollow">Loggers</a></li><li><ul><li><a href="#Logger_902" rel="nofollow">配置Logger</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_4"></a>引言</h2> 
<p>Spring Boot 包含大量附加功能，可帮助您在将应用程序推向生产时对其进行监控和管理。您可以选择使用 HTTP 端点或 JMX 来管理和监控应用程序。审计、健康状况和指标收集也可自动应用于您的应用程序。</p> 
<h2><a id="_Productionready__6"></a>启用 Production-ready 功能</h2> 
<p><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator">spring-boot-actuator</a> 模块提供了 Spring Boot production-ready 的所有功能。启用这些功能的推荐方法是添加对 <code>spring-boot-starter-actuator</code> "Starter "的依赖。</p> 
<blockquote> 
 <p>执行器(Actuator)的定义<br> 执行器是一个制造术语，指用于移动或控制某物的机械装置。推杆可以通过微小的变化产生较大的运动。</p> 
</blockquote> 
<p>要将执行器添加到基于 Maven 的项目中，请添加以下 "Starter "依赖关系：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>对于 Gradle，使用以下声明：</p> 
<pre><code class="prism language-groovy">dependencies <span class="token punctuation">{<!-- --></span>
    implementation <span class="token string">'org.springframework.boot:spring-boot-starter-actuator'</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="Endpoints_26"></a>端点（Endpoints）</h2> 
<p>执行器端点可让您监控应用程序并与之交互。Spring Boot 包含许多内置端点，您还可以添加自己的端点。例如，<code>health</code> 端点提供基本的应用程序健康信息。<br> 您可以启用或禁用每个单独的端点，并通过 HTTP 或 JMX 将其公开（使其可远程访问）。当一个端点同时启用和暴露时，它就被认为是可用的。内置端点只有在可用时才会自动配置。大多数应用程序会选择通过 HTTP 暴露，端点的 ID 和 <code>/actuator</code> 前缀会映射到 URL。例如，默认情况下，健康端点映射到 <code>/actuator/health</code>。</p> 
<blockquote> 
 <p>要了解有关执行器端点及其请求和响应格式的更多信息，请参阅单独的 API 文档（<a href="https://docs.spring.io/spring-boot/docs/3.2.1/actuator-api/htmlsingle" rel="nofollow">HTML</a> 或 <a href="https://docs.spring.io/spring-boot/docs/3.2.1/actuator-api/pdf/spring-boot-actuator-web-api.pdf" rel="nofollow">PDF</a>）。</p> 
</blockquote> 
<p>可提供以下与技术无关的端点：</p> 
<table><thead><tr><th><strong>ID</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>auditevents</code></td><td>公开当前应用程序的审计事件信息。需要 <code>AuditEventRepository</code> Bean。</td></tr><tr><td><code>beans</code></td><td>显示应用程序中所有 Spring Bean 的完整列表。</td></tr><tr><td><code>caches</code></td><td>显示可用缓存。</td></tr><tr><td><code>conditions</code></td><td>显示对配置和自动配置类进行评估的条件，以及匹配或不匹配的原因。</td></tr><tr><td><code>configprops</code></td><td>显示所有 <code>@ConfigurationProperties</code> 的整理列表。须经过脱敏处理。</td></tr><tr><td><code>env</code></td><td>公开 Spring 的 <code>ConfigurableEnvironment</code> 属性。须经过脱敏处理。</td></tr><tr><td><code>flyway</code></td><td>显示已应用的任何 Flyway 数据库迁移。需要一个或多个 <code>Flyway</code> Bean。</td></tr><tr><td><code>health</code></td><td>显示应用程序的运行状况信息。</td></tr><tr><td><code>httpexchanges</code></td><td>显示 HTTP 交换信息（默认情况下，显示最近 100 次 HTTP 请求-响应交换）。需要 <code>HttpExchangeRepository</code> Bean。</td></tr><tr><td><code>info</code></td><td>显示任意应用程序信息。</td></tr><tr><td><code>integrationgraph</code></td><td>显示 Spring Integration 图形。需要依赖 <code>spring-integration-core</code>。</td></tr><tr><td><code>loggers</code></td><td>显示并修改应用程序中日志记录的配置。</td></tr><tr><td><code>liquibase</code></td><td>显示已应用的任何 Liquibase 数据库迁移。需要一个或多个 <code>Liquibase</code> Bean。</td></tr><tr><td><code>metrics</code></td><td>显示当前应用程序的 “度量” 信息。</td></tr><tr><td><code>mappings</code></td><td>显示所有 <code>@RequestMapping</code> 路径的整理列表。</td></tr><tr><td><code>quartz</code></td><td>显示有关 Quartz Scheduler 作业的信息。须经过脱敏处理。</td></tr><tr><td><code>scheduledtasks</code></td><td>显示应用程序中的计划任务。</td></tr><tr><td><code>sessions</code></td><td>允许从 Spring Session 支持的会话存储中检索和删除用户会话。需要使用 Spring Session 的基于 servlet 的网络应用程序。</td></tr><tr><td><code>shutdown</code></td><td>让应用程序从容关闭。仅在使用 jar 打包时有效。默认情况下已禁用。</td></tr><tr><td><code>startup</code></td><td>显示 <code>ApplicationStartup</code> 收集的启动步骤数据。要求 <code>SpringApplication</code> 配置有 <code>BufferingApplicationStartup</code>。</td></tr><tr><td><code>threaddump</code></td><td>执行线程转储。</td></tr></tbody></table> 
<p>如果您的应用程序是网络应用程序（Spring MVC、Spring WebFlux 或 Jersey），您可以使用以下附加端点：</p> 
<table><thead><tr><th><strong>ID</strong></th><th><strong>Description</strong></th></tr></thead><tbody><tr><td><code>heapdump</code></td><td>返回堆转储文件。在 HotSpot JVM 上，将返回 <code>HPROF</code> 格式的文件。在 OpenJ9 JVM 上，将返回 <code>PHD</code> 格式文件。</td></tr><tr><td><code>logfile</code></td><td>返回日志文件的内容（如果已设置 <code>logging.file.name</code> 或 <code>logging.file.path</code> 属性）。支持使用 HTTP <code>Range</code> 标头检索日志文件的部分内容。</td></tr><tr><td><code>prometheus</code></td><td>以可被 Prometheus 服务器抓取的格式提供指标。需要依赖 <code>micrometer-registry-prometheus</code>。</td></tr></tbody></table> 
<h3><a id="_65"></a>启用端点</h3> 
<p>默认情况下，除<code>shutdown</code>（关机）外的所有端点都已启用。要配置端点的启用，请使用其 <code>management.endpoint.&lt;id&gt;.enabled</code> 属性。下面的示例启用了<code>shutdown</code>（关机）端点：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
    <span class="token key atrule">shutdown</span><span class="token punctuation">:</span>
      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> 
<p>如果希望端点启用是“opt-in“而不是”opt-out“，可将 <code>management.endpoints.enabled-by-default</code> 属性设置为 <code>false</code>，然后使用单个端点启用属性重新选择进入。下面的示例启用了 <code>info</code> 端点，并禁用了所有其他端点：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled-by-default</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
    <span class="token key atrule">info</span><span class="token punctuation">:</span>
      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre> 
<blockquote> 
 <p>顺便说一下”opt-in“和”opt-out“<br> opt-in：《通用数据保护法》（General Data Protection Regulation,简称GDPR)于2018年5月开始生效，其目的是让互联网用户重获个人数据控制权。任何以电子邮件形式进行的促销活动都需要用户明确的同意，即“opt-in”（选择同意接受电子邮件广告），从而限制滥用。Opt-in是指用户明确同意接收某个企业的信息，通常是营销和广告。网站用户可通过选择“Opt-in”明确表示同意接收营销和促销信息。<br> opt-out：Opt-out是发送商业性电子邮件的另一种做法。这种方法允许企业在未征得互联网用户同意的情况下发送电子邮件。虽然Opt-out是合法的，但受到严格监管。Opt-out只能在两种特定情况下使用。</p> 
 <ul><li>当用户已经同意企业使用其个人数据时，企业可向用户发送类似可订阅的电子报，其中内容可能包括同一公司或其合作伙伴的产品。</li><li>如果企业提供与互联网用户有关的服务，那它有权采用opt-out并在其电子邮件中加入商业提案。</li></ul> 
</blockquote> 
<p>然而，互联网用户必须被明确告知其数据使用目的，以及是否有权撤销同意。如果用户要撤销同意，必须告知企业不希望个人数据被用于这项特定的服务。通常也是勾选一个方框即可完成。</p> 
<blockquote> 
 <p>上述参考自：<a href="https://news.gandi.net/zh-hans/2022/07/what-is-opt-in/#Opt-In,%20Opt-Out,%20%E5%92%8Cdouble%20Opt-In%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88?" rel="nofollow">什么是Opt-in？</a></p> 
</blockquote> 
<blockquote> 
 <p>禁用的端点会从应用上下文中完全删除。如果只想更改暴露端点的技术，可使用 <code>include</code> 和 <code>exclude</code> 属性。</p> 
</blockquote> 
<h3><a id="_93"></a>暴露端点</h3> 
<p>默认情况下，只有健康状况端点通过 HTTP 和 JMX 公开。由于端点可能包含敏感信息，因此应仔细考虑何时暴露端点。<br> 要更改暴露哪些端点，请使用以下特定于技术的包含和排除属性：</p> 
<table><thead><tr><th><strong>Property</strong></th><th><strong>Default</strong></th></tr></thead><tbody><tr><td><code>management.endpoints.jmx.exposure.exclude</code></td><td></td></tr><tr><td></td><td></td></tr><tr><td><code>management.endpoints.jmx.exposure.include</code></td><td><code>health</code></td></tr><tr><td><code>management.endpoints.web.exposure.exclude</code></td><td></td></tr><tr><td></td><td></td></tr><tr><td><code>management.endpoints.web.exposure.include</code></td><td><code>health</code></td></tr></tbody></table> 
<p><code>include</code> 属性列出了暴露的端点 ID。<code>exclude</code>属性列出了不应暴露的端点 ID。<code>exclude</code>属性优先于<code>include</code> 属性。可以使用端点 ID 列表配置<code>include</code> 和<code>exclude</code>属性。<br> 例如，要只通过 JMX 公开健康和信息端点，请使用以下属性：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">jmx</span><span class="token punctuation">:</span>
      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">"health,info"</span>
</code></pre> 
<p><code>*</code> 可用于选择所有端点。例如，要通过 HTTP 公开除 <code>env</code> 和 <code>beans</code> 端点之外的所有内容，请使用以下属性：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">"*"</span>
        <span class="token key atrule">exclude</span><span class="token punctuation">:</span> <span class="token string">"env,beans"</span>
</code></pre> 
<blockquote> 
 <p><code>*</code> 在 YAML 中有特殊含义，因此如果要包含（或排除）所有端点，请务必加上引号。</p> 
</blockquote> 
<blockquote> 
 <p>如果您的应用程序是公开暴露的，我们强烈建议您也确保端点的安全。</p> 
</blockquote> 
<blockquote> 
 <p>如果您想在端点暴露时实施自己的策略，可以注册一个 <code>EndpointFilter</code> Bean。</p> 
</blockquote> 
<h3><a id="_130"></a>安全</h3> 
<p>出于安全考虑，默认情况下只有 <code>/health</code> 端点通过 HTTP 暴露。你可以使用 <code>management.endpoints.web.exposure.include</code> 属性来配置暴露的端点。</p> 
<blockquote> 
 <p>在设置 <code>management.endpoints.web.exposure.include</code> 之前，请确保被暴露的执行器不包含敏感信息，并将其置于防火墙之后以确保安全，或使用类似 Spring Security 这样的软件确保安全。</p> 
</blockquote> 
<p>如果 Spring Security 位于类路径上，并且不存在其他 <code>SecurityFilterChain</code> Bean，那么除 <code>/health</code> 之外的所有执行器都会受到 Spring Boot 自动配置的保护。如果您定义了自定义 <code>SecurityFilterChain</code> Bean，Spring Boot 自动配置就会退出，让您完全控制执行器的访问规则。<br> 如果您想为 HTTP 端点配置自定义安全性（例如，只允许具有特定角色的用户访问这些端点），Spring Boot 提供了一些方便的 <code>RequestMatcher</code> 对象，您可以将其与 Spring Security 结合使用。<br> 典型的 Spring Security 配置可能与下面的示例类似：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>actuate<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>security<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">EndpointRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>web<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">HttpSecurity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span></span><span class="token class-name">SecurityFilterChain</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">Customizer</span><span class="token punctuation">.</span><span class="token static">withDefaults</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MySecurityConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        http<span class="token punctuation">.</span><span class="token function">securityMatcher</span><span class="token punctuation">(</span><span class="token class-name">EndpointRequest</span><span class="token punctuation">.</span><span class="token function">toAnyEndpoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        http<span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span><span class="token punctuation">(</span>requests<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> requests<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasRole</span><span class="token punctuation">(</span><span class="token string">"ENDPOINT_ADMIN"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        http<span class="token punctuation">.</span><span class="token function">httpBasic</span><span class="token punctuation">(</span><span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>前面的示例使用 <code>EndpointRequest.toAnyEndpoint()</code> 将请求匹配到任何端点，然后确保所有端点都具有 <code>ENDPOINT_ADMIN</code> 角色。<code>EndpointRequest</code> 上还有其他几种匹配器方法。详情请查看 API 文档（<a href="https://docs.spring.io/spring-boot/docs/3.2.1/actuator-api/htmlsingle" rel="nofollow">HTML</a> 或 <a href="https://docs.spring.io/spring-boot/docs/3.2.1/actuator-api/pdf/spring-boot-actuator-web-api.pdf" rel="nofollow">PDF</a>）。<br> 如果在防火墙后面部署应用程序，可能更希望所有执行器端点都能在不需要身份验证的情况下被访问。为此，您可以更改 <code>management.endpoints.web.exposure.include</code> 属性，如下所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
        <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">"*"</span>
</code></pre> 
<p>此外，如果存在 Spring Security，则需要添加允许未经身份验证访问端点的自定义安全配置，如下例所示：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>actuate<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span>security<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span></span><span class="token class-name">EndpointRequest</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Bean</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Configuration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>web<span class="token punctuation">.</span>builders<span class="token punctuation">.</span></span><span class="token class-name">HttpSecurity</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>security<span class="token punctuation">.</span>web<span class="token punctuation">.</span></span><span class="token class-name">SecurityFilterChain</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Configuration</span><span class="token punctuation">(</span>proxyBeanMethods <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MySecurityConfiguration</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">SecurityFilterChain</span> <span class="token function">securityFilterChain</span><span class="token punctuation">(</span><span class="token class-name">HttpSecurity</span> http<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        http<span class="token punctuation">.</span><span class="token function">securityMatcher</span><span class="token punctuation">(</span><span class="token class-name">EndpointRequest</span><span class="token punctuation">.</span><span class="token function">toAnyEndpoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        http<span class="token punctuation">.</span><span class="token function">authorizeHttpRequests</span><span class="token punctuation">(</span><span class="token punctuation">(</span>requests<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> requests<span class="token punctuation">.</span><span class="token function">anyRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">permitAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> http<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>在上述两个示例中，配置仅适用于执行器端点。由于在存在任何 <code>SecurityFilterChain</code> Bean 的情况下，Spring Boot 的安全配置都会完全关闭，因此您需要配置一个额外的 <code>SecurityFilterChain</code> Bean，其中包含适用于应用程序其余部分的规则。</p> 
</blockquote> 
<h4><a id="_190"></a>跨域请求伪造保护</h4> 
<p>由于 Spring Boot 依赖 Spring Security 的默认设置，因此 CSRF 保护默认开启。这意味着在使用默认安全配置时，需要 <code>POST</code>（关机和日志记录端点）、<code>PUT</code> 或 <code>DELETE</code> 的执行器端点会出现 403（禁止）错误。</p> 
<blockquote> 
 <p>我们建议，只有在创建的服务被非浏览器客户端使用时，才完全禁用 CSRF 保护。</p> 
</blockquote> 
<p>有关 CSRF 保护的更多信息，请参阅<a href="https://docs.spring.io/spring-security/reference/6.2/features/exploits/csrf.html" rel="nofollow">《Spring 安全参考指南》</a>。</p> 
<h3><a id="_195"></a>配置端点</h3> 
<p>对于不带任何参数的读取操作，端点会自动缓存响应。要配置端点缓存响应的时间，请使用其 <code>cache.time-to-live</code> 属性。下面的示例将 <code>beans</code> 端点缓存的生存时间设置为 10 秒：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
    <span class="token key atrule">beans</span><span class="token punctuation">:</span>
      <span class="token key atrule">cache</span><span class="token punctuation">:</span>
        <span class="token key atrule">time-to-live</span><span class="token punctuation">:</span> <span class="token string">"10s"</span>
</code></pre> 
<p><code>management.endpoint.&lt;name&gt;</code> 前缀可唯一标识正在配置的端点。</p> 
<h3><a id="_205"></a>敏感值脱敏</h3> 
<p>由 <code>/env</code>、<code>/configprops</code> 和 <code>/quartz</code> 端点返回的信息可能有些敏感。默认情况下，所有值都经过脱敏处理（即用 <code>******</code> 代替）。可以使用每个端点的 <code>showValues</code> 属性为该端点配置以未脱敏形式查看原始值。该属性可配置为以下值：</p> 
<ul><li><code>ALWAYS</code> - 所有值都以未经脱敏的形式显示给所有用户</li><li><code>NEVER</code> - 所有值始终经过脱敏处理（即用 <code>******</code> 代替）</li><li><code>WHEN_AUTHORIZED</code> - 所有值都以未经脱敏的形式显示给授权用户</li></ul> 
<p>对于 HTTP 端点，如果用户已通过身份验证并拥有端点的角色属性所配置的角色，则视为已获得授权。默认情况下，任何已通过身份验证的用户都已获得授权。对于 JMX 端点，所有用户始终都有授权。</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
    <span class="token key atrule">env</span><span class="token punctuation">:</span>
      <span class="token key atrule">show-values</span><span class="token punctuation">:</span> WHEN_AUTHORIZED
      <span class="token key atrule">roles</span><span class="token punctuation">:</span> <span class="token string">"admin"</span>
</code></pre> 
<p>通过上述配置，所有具有<code>admin</code>角色的用户都能从 <code>/env</code> 端点以原始形式查看所有值。</p> 
<blockquote> 
 <p>当 <code>show-values</code> 设置为 <code>ALWAYS</code> 或 <code>WHEN_AUTHORIZED</code> 时，仍会应用 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto.actuator.customizing-sanitization" rel="nofollow">SanitizingFunction</a> 所应用的任何脱敏处理。</p> 
</blockquote> 
<h3><a id="_223"></a>执行器网络终端的超媒体</h3> 
<p>添加一个 “discovery page”，其中包含所有端点的链接。默认情况下，“discovery page” 位于 <code>/actuator</code>。<br> 要禁用 “discovery page”，请在应用程序属性中添加以下属性：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre> 
<p>配置自定义管理上下文路径后，“discovery page” 会自动从 <code>/actuator</code> 移至管理上下文的根目录。例如，如果管理上下文路径为<code>/management</code>，则可从<code>/management</code> 获取发现页面。当管理上下文路径设置为 <code>/</code> 时，发现页面将被禁用，以防止与其他映射发生冲突。</p> 
<h3><a id="CORS__234"></a>CORS 支持</h3> 
<p><a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing" rel="nofollow">跨源资源共享</a>（CORS）是一项<a href="https://www.w3.org/TR/cors/" rel="nofollow">W3C规范</a>，它能让你以灵活的方式指定授权哪种跨域请求。如果使用 Spring MVC 或 Spring WebFlux，就可以配置 Actuator 的网络端点以支持此类场景。<br> CORS 支持默认是禁用的，只有设置了 <code>management.endpoints.web.cors.allowed-origins</code> 属性后才会启用。以下配置允许从 <code>example.com</code> 域进行 <code>GET</code> 和 <code>POST</code> 调用：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">cors</span><span class="token punctuation">:</span>
        <span class="token key atrule">allowed-origins</span><span class="token punctuation">:</span> <span class="token string">"https://example.com"</span>
        <span class="token key atrule">allowed-methods</span><span class="token punctuation">:</span> <span class="token string">"GET,POST"</span>
</code></pre> 
<blockquote> 
 <p>有关选项的完整列表，请参阅 <a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator-autoconfigure/src/main/java/org/springframework/boot/actuate/autoconfigure/endpoint/web/CorsEndpointProperties.java">CorsEndpointProperties</a>。</p> 
</blockquote> 
<h3><a id="_247"></a>实现自定义端点</h3> 
<p>如果添加了注释为 <code>@Endpoint</code> 的 <code>@Bean</code>，那么注释为 <code>@ReadOperation</code>、<code>@WriteOperation</code> 或 <code>@DeleteOperation</code> 的任何方法都会自动通过 JMX 公开，在 Web 应用程序中还会通过 HTTP 公开。可以通过使用 Jersey、Spring MVC 或 Spring WebFlux 通过 HTTP 公开端点。如果 Jersey 和 Spring MVC 都可用，则使用 Spring MVC。<br> 下面的示例公开了一个返回自定义对象的读操作：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@ReadOperation</span>
<span class="token keyword">public</span> <span class="token class-name">CustomData</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CustomData</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>您还可以使用 <code>@JmxEndpoint</code> 或 <code>@WebEndpoint</code> 编写特定技术的端点。这些端点仅限于各自的技术。例如，<code>@WebEndpoint</code> 只能通过 HTTP 而不是 JMX 暴露。<br> 您可以使用 <code>@EndpointWebExtension</code> 和 <code>@EndpointJmxExtension</code> 编写特定技术的扩展。这些注解可让你提供特定于技术的操作，以增强现有的端点。<br> 最后，如果需要访问特定于网络框架的功能，可以实现 servlet 或 Spring <code>@Controller</code> 和 <code>@RestController</code> 端点，但代价是这些端点不能通过 JMX 或使用不同的网络框架时可用。</p> 
<h4><a id="_259"></a>接收输入</h4> 
<p>端点上的操作通过参数接收输入。通过网络公开时，这些参数的值取自 URL 的查询参数和 JSON 请求体。通过 JMX 公开时，参数会映射到 MBean 操作的参数。默认情况下，参数是必需的。通过使用 <code>@javax.annotation.Nullable</code> 或 <code>@org.springframework.lang.Nullable</code> 对参数进行注解，可将其设置为可选参数。<br> 您可以将 JSON 请求正文中的每个根属性映射到端点参数。请看下面的 JSON 请求正文：</p> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"test"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"counter"</span><span class="token operator">:</span> <span class="token number">42</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>如下面的示例所示，你可以用它来调用一个包含<code>String name</code>和 <code>int counter</code>参数的写操作：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@WriteOperation</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateData</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">int</span> counter<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// injects "test" and 42</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>由于端点与技术无关，因此只能在方法签名中指定简单的类型。特别是，不支持使用定义了<code>name</code>和<code>counter</code>属性的 <code>CustomData</code> 类型声明单个参数。</p> 
</blockquote> 
<blockquote> 
 <p>为了让输入映射到操作方法的参数，实现端点的 Java 代码在编译时应使用 <code>-parameters</code>，而实现端点的 Kotlin 代码在编译时应使用 <code>-java-parameters</code>。如果使用 Spring Boot 的 Gradle 插件，或使用 Maven 和 <code>spring-boot-starter-parent</code>，这将自动实现。</p> 
</blockquote> 
<h5><a id="_279"></a>输入类型转换</h5> 
<p>必要时，传递给端点操作方法的参数会自动转换为所需类型。在调用操作方法之前，通过 JMX 或 HTTP 接收的输入会使用 <code>ApplicationConversionService</code> 的实例以及任何用 <code>@EndpointConverter</code> 限定的 <code>Converter</code> 或 <code>GenericConverter</code> Bean 转换为所需类型。</p> 
<h4><a id="_Web__281"></a>自定义 Web 端点</h4> 
<p>对 <code>@Endpoint</code>、<code>@WebEndpoint</code> 或 <code>@EndpointWebExtension</code> 的操作会自动使用 Jersey、Spring MVC 或 Spring WebFlux 通过 HTTP 公开。如果 Jersey 和 Spring MVC 都可用，则使用 Spring MVC。</p> 
<h5><a id="Web__283"></a>Web 端点请求谓词</h5> 
<p>网络端点上的每个操作都会自动生成一个请求谓词。</p> 
<blockquote> 
 <p>predicate ：谓词，这里表判断的意思</p> 
</blockquote> 
<h5><a id="_287"></a>路径</h5> 
<p>谓词的路径由端点的 ID 和网络暴露端点的基本路径决定。默认的基本路径是<code>/actuator</code>。例如，ID 为 <code>sessions</code> 的端点在谓词中使用 <code>/actuator/sessions</code> 作为路径。<br> 通过使用 <code>@Selector</code> 对操作方法的一个或多个参数进行注解，可以进一步自定义路径。此类参数将作为路径变量添加到路径谓词中。在调用端点操作时，该变量的值将被传递到操作方法中。如果要捕获所有剩余的路径元素，可以在最后一个参数中添加 <code>@Selector(Match=ALL_REMAINING)</code>，并使其成为与 <code>String[]</code> 兼容的转换类型。</p> 
<h5><a id="HTTP__290"></a>HTTP 方法</h5> 
<p>谓词的 HTTP 方法由操作类型决定，如下表所示：</p> 
<table><thead><tr><th><strong>Operation</strong></th><th><strong>HTTP method</strong></th></tr></thead><tbody><tr><td><code>@ReadOperation</code></td><td><code>GET</code></td></tr><tr><td><code>@WriteOperation</code></td><td><code>POST</code></td></tr><tr><td><code>@DeleteOperation</code></td><td><code>DELETE</code></td></tr></tbody></table> 
<h5><a id="_299"></a>消耗</h5> 
<p>对于使用请求正文的 <code>@WriteOperation</code>（HTTP <code>POST</code>），谓词的 <code>consumes</code> 子句为 <code>application/vnd.spring-boot.actuator.v2+json</code>、<code>application/json</code>。对于所有其他操作，<code>consumes</code> 子句为空。</p> 
<h5><a id="_301"></a>生产</h5> 
<p>谓词的 <code>produces</code> 子句可由 <code>@DeleteOperation</code>、<code>@ReadOperation</code> 和 <code>@WriteOperation</code> 注解的 <code>produces</code> 属性决定。该属性是可选的。如果不使用，<code>produces</code> 子句将自动确定。<br> 如果操作方法返回 <code>void</code> 或 <code>Void</code>，则 <code>produces</code> 子句为空。如果操作方法返回 <code>org.springframework.core.io.Resource</code>，则 <code>produces</code> 子句为 <code>application/octet-stream</code>。对于所有其他操作，<code>produces</code> 子句为 <code>application/vnd.spring-boot.actuator.v2+json</code>、<code>application/json</code>。</p> 
<h5><a id="Web__304"></a>Web 端点响应状态</h5> 
<p>端点操作的默认响应状态取决于操作类型（读取、写入或删除）和操作返回的内容（如果有的话）。<br> 如果 <code>@ReadOperation</code> 返回一个值，响应状态将是 200（OK）。如果没有返回值，响应状态将是 404（未找到）。<br> 如果 <code>@WriteOperation</code> 或 <code>@DeleteOperation</code> 返回值，响应状态将是 200（OK）。如果没有返回值，响应状态将是 204（无内容）。<br> 如果调用的操作没有必填参数或参数无法转换为必填类型，则不会调用操作方法，响应状态将是 400（错误请求）。</p> 
<h5><a id="Web__309"></a>Web 端点范围请求</h5> 
<p>您可以使用 HTTP 范围请求来请求 HTTP 资源的一部分。使用 Spring MVC 或 Spring Web Flux 时，返回 <code>org.springframework.core.io.Resource</code> 的操作会自动支持范围请求。</p> 
<blockquote> 
 <p>使用 Jersey 时不支持范围请求。</p> 
</blockquote> 
<h5><a id="Web__313"></a>Web 端点安全</h5> 
<p>网络端点或特定于网络的端点扩展上的操作可以接收当前的 <code>java.security.Principal</code> 或 <code>org.springframework.boot.actuate.endpoint.SecurityContext</code> 作为方法参数。前者通常与 <code>@Nullable</code> 结合使用，为已通过身份验证和未通过身份验证的用户提供不同的行为。后者通常使用 <code>isUserInRole(String)</code> 方法执行授权检查。</p> 
<h4><a id="Servlet__315"></a>Servlet 端点</h4> 
<p>通过实现一个同时实现 <code>Supplier&lt;EndpointServlet&gt;</code> 和注释 <code>@ServletEndpoint</code> 的类，可以将 Servlet 作为端点公开。Servlet 端点提供了与 Servlet 容器的深度集成，但却牺牲了可移植性。它们的目的是将现有的 servlet 作为端点公开。对于新端点，应尽可能使用 <code>@Endpoint</code> 和 <code>@WebEndpoint</code> 注解。</p> 
<h4><a id="_317"></a>控制器端点</h4> 
<p>您可以使用 <code>@ControllerEndpoint</code> 和 <code>@RestControllerEndpoint</code> 来实现仅由 Spring MVC 或 Spring WebFlux 公开的端点。方法通过使用 Spring MVC 和 Spring WebFlux 的标准注解（如 <code>@RequestMapping</code> 和 <code>@GetMapping</code>）进行映射，端点的 ID 用作路径的前缀。控制器端点提供了与 Spring Web 框架的深度集成，但却牺牲了可移植性。在可能的情况下，应首选 <code>@Endpoint</code> 和 <code>@WebEndpoint</code> 注解。</p> 
<h3><a id="_319"></a>健康信息</h3> 
<p>您可以使用健康信息来检查运行中应用程序的状态。当生产系统宕机时，监控软件通常会使用它来发出警报。健康状况端点显示的信息取决于 <code>management.endpoint.health.show-details</code> 和 <code>management.endpoint.health.show-components</code> 属性，这两个属性可配置为以下值之一：</p> 
<table><thead><tr><th><strong>名称</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td><code>never</code></td><td>从未显示细节。</td></tr><tr><td><code>when-authorized</code></td><td>详细信息只显示给授权用户。授权角色可通过使用 <code>management.endpoint.health.roles</code> 进行配置。</td></tr><tr><td><code>always</code></td><td>所有用户都能看到详细信息。</td></tr></tbody></table> 
<p>默认值为<code>never</code>。当用户处于端点的一个或多个角色中时，就会被视为已获授权。如果端点没有配置角色（默认值），则所有通过身份验证的用户都被视为已获授权。您可以使用 <code>management.endpoint.health.roles</code> 属性配置角色。</p> 
<blockquote> 
 <p>如果您已确保应用程序的安全并希望<code>always</code>，您的安全配置必须允许通过身份验证和未通过身份验证的用户访问健康状况端点。</p> 
</blockquote> 
<p>健康信息是从 <a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthContributorRegistry.java">HealthContributorRegistry</a>（默认情况下是 <code>ApplicationContext</code> 中定义的所有 <a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/HealthContributor.java">HealthContributor</a> 实例）的内容中收集的。Spring Boot 包含大量自动配置的 <code>HealthContributor</code>，您也可以编写自己的 <code>HealthContributor</code>。<br> <code>HealthContributor</code> 可以是 <code>HealthIndicator</code> 或 <code>CompositeHealthContributor</code>。<code>HealthIndicator</code> 提供实际的健康信息，包括<code>Status</code>。<code>CompositeHealthContributor</code>提供其他<code>HealthIndicator</code> 的复合信息。这些贡献器共同组成了一个树形结构，用来表示整个系统的健康状况。<br> 默认情况下，最终的系统健康状况是由 <code>StatusAggregator</code> 得出的，它会根据有序状态列表对每个 <code>HealthIndicator</code> 的状态进行排序。排序列表中的第一个状态被用作整体健康状态。如果没有 <code>HealthIndicator</code> 返回 <code>StatusAggregator</code> 所知道的状态，则使用<code>UNKNOWN</code>状态。</p> 
<blockquote> 
 <p>您可以使用 <code>HealthContributorRegistry</code> 在运行时注册或取消注册健康指标。</p> 
</blockquote> 
<h4><a id="HealthIndicators_336"></a>自动配置HealthIndicators</h4> 
<p>在适当的时候，Spring Boot 会自动配置下表列出的 <code>HealthIndicators</code>。您还可以通过配置 <code>management.health.key.enabled</code> 启用或禁用所选指标，键值如下表所列：</p> 
<table><thead><tr><th>Key</th><th>Name</th><th>描述</th></tr></thead><tbody><tr><td><code>cassandra</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/cassandra/CassandraDriverHealthIndicator.java">CassandraDriverHealthIndicator</a></td><td>检查 Cassandra 数据库是否正常运行</td></tr><tr><td><code>couchbase</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/couchbase/CouchbaseHealthIndicator.java">CouchbaseHealthIndicator</a></td><td>检查 Couchbase 集群是否正常运行。</td></tr><tr><td><code>db</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/jdbc/DataSourceHealthIndicator.java">DataSourceHealthIndicator</a></td><td>检查是否可以获得与<code>DataSource</code>的连接</td></tr><tr><td><code>diskspace</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/system/DiskSpaceHealthIndicator.java">DiskSpaceHealthIndicator</a></td><td>检查磁盘空间是否不足。</td></tr><tr><td><code>elasticsearch</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/elasticsearch/ElasticsearchRestClientHealthIndicator.java">ElasticsearchRestClientHealthIndicator</a></td><td>检查 Elasticsearch 集群是否正常运行。</td></tr><tr><td><code>hazelcast</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/hazelcast/HazelcastHealthIndicator.java">HazelcastHealthIndicator</a></td><td>检查 Hazelcast 服务器是否正常运行。</td></tr><tr><td><code>influxdb</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/influx/InfluxDbHealthIndicator.java">InfluxDbHealthIndicator</a></td><td>检查 InfluxDB 服务器是否正常运行。</td></tr><tr><td><code>jms</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/jms/JmsHealthIndicator.java">JmsHealthIndicator</a></td><td>检查 JMS 代理是否正常运行。</td></tr><tr><td><code>ldap</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/ldap/LdapHealthIndicator.java">LdapHealthIndicator</a></td><td>检查 LDAP 服务器是否正常运行。</td></tr><tr><td><code>mail</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/mail/MailHealthIndicator.java">MailHealthIndicator</a></td><td>检查邮件服务器是否正常运行。</td></tr><tr><td><code>mongo</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/data/mongo/MongoHealthIndicator.java">MongoHealthIndicator</a></td><td>检查 Mongo 数据库是否正常运行。</td></tr><tr><td><code>neo4j</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/neo4j/Neo4jHealthIndicator.java">Neo4jHealthIndicator</a></td><td>检查 Neo4j 数据库是否正常运行。</td></tr><tr><td><code>ping</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/PingHealthIndicator.java">PingHealthIndicator</a></td><td>总是以 UP 作回应。</td></tr><tr><td><code>rabbit</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/amqp/RabbitHealthIndicator.java">RabbitHealthIndicator</a></td><td>检查 Rabbit 服务器是否正常运行。</td></tr><tr><td><code>redis</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/data/redis/RedisHealthIndicator.java">RedisHealthIndicator</a></td><td>检查 Redis 服务器是否正常运行。</td></tr></tbody></table> 
<blockquote> 
 <p>您可以通过设置 <code>management.health.defaults.enabled</code> 属性将其全部禁用。</p> 
</blockquote> 
<p>其他<code>HealthIndicators</code>可用，但默认情况下不启用：</p> 
<table><thead><tr><th>Key</th><th>Name</th><th>描述</th></tr></thead><tbody><tr><td><code>livenessstate</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/availability/LivenessStateHealthIndicator.java">LivenessStateHealthIndicator</a></td><td>公开 “Liveness” 应用程序可用性状态。</td></tr><tr><td><code>readinessstate</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/availability/ReadinessStateHealthIndicator.java">ReadinessStateHealthIndicator</a></td><td>公开 “Readiness” 应用程序的可用性状态。</td></tr></tbody></table> 
<h4><a id="HealthIndicators_366"></a>编写自定义HealthIndicators</h4> 
<p>要提供自定义的健康信息，您可以注册实现 <code>HealthIndicator</code> 接口的 Spring Bean。您需要提供 <code>health()</code> 方法的实现，并返回 <code>Health</code> 响应。<code>Health</code> 响应应包括一个状态，并可选择性地包括要显示的其他详细信息。以下代码展示了一个 <code>HealthIndicator</code> 实现示例：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>actuate<span class="token punctuation">.</span>health<span class="token punctuation">.</span></span><span class="token class-name">Health</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>actuate<span class="token punctuation">.</span>health<span class="token punctuation">.</span></span><span class="token class-name">HealthIndicator</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyHealthIndicator</span> <span class="token keyword">implements</span> <span class="token class-name">HealthIndicator</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Health</span> <span class="token function">health</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> errorCode <span class="token operator">=</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>errorCode <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">Health</span><span class="token punctuation">.</span><span class="token function">down</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withDetail</span><span class="token punctuation">(</span><span class="token string">"Error Code"</span><span class="token punctuation">,</span> errorCode<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">Health</span><span class="token punctuation">.</span><span class="token function">up</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// perform some specific health check</span>
        <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>给定 <code>HealthIndicator</code> 的标识符是 bean 的名称，不含 <code>HealthIndicator</code> 后缀（如果存在的话）。在上例中，健康信息存在于名为 <code>my</code> 的条目中。</p> 
</blockquote> 
<blockquote> 
 <p>健康指示器通常通过 HTTP 调用，需要在连接超时前做出响应。对于响应时间超过 10 秒的健康指示器，Spring Boot 会记录一条警告消息。如果要配置此阈值，可以使用 <code>management.endpoint.health.logging.slow-indicator-threshold</code> 属性。</p> 
</blockquote> 
<p>除了 Spring Boot 预定义的 <a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/health/Status.java">Status</a> 类型外，<code>Health</code> 还可以返回代表新系统状态的自定义 <code>Status</code>。在这种情况下，您还需要提供 <code>StatusAggregator</code> 接口的自定义实现，或者必须使用 <code>management.endpoint.health.status.order</code> 配置属性来配置默认实现。<br> 例如，假设在某个 <code>HealthIndicator</code> 实现中使用了代码为 <code>FATAL</code> 的新 <code>Status</code>。要配置严重性顺序，请在应用程序属性中添加以下属性：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
    <span class="token key atrule">health</span><span class="token punctuation">:</span>
      <span class="token key atrule">status</span><span class="token punctuation">:</span>
        <span class="token key atrule">order</span><span class="token punctuation">:</span> <span class="token string">"fatal,down,out-of-service,unknown,up"</span>
</code></pre> 
<p>响应中的 HTTP 状态代码反映了整体健康状态。默认情况下，<code>OUT_OF_SERVICE</code> 和 <code>DOWN</code> 映射为 503。任何未映射的健康状态（包括 <code>UP</code>）都映射为 200。如果通过 HTTP 访问健康状况端点，可能还需要注册自定义状态映射。配置自定义映射会禁用 <code>DOWN</code> 和 <code>OUT_OF_SERVICE</code> 的默认映射。如果要保留默认映射，必须显式配置它们以及任何自定义映射。例如，以下属性将 <code>FATAL</code> 映射为 503（服务不可用），并保留了 <code>DOWN</code> 和 <code>OUT_OF_SERVICE</code> 的默认映射：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
    <span class="token key atrule">health</span><span class="token punctuation">:</span>
      <span class="token key atrule">status</span><span class="token punctuation">:</span>
        <span class="token key atrule">http-mapping</span><span class="token punctuation">:</span>
          <span class="token key atrule">down</span><span class="token punctuation">:</span> <span class="token number">503</span>
          <span class="token key atrule">fatal</span><span class="token punctuation">:</span> <span class="token number">503</span>
          <span class="token key atrule">out-of-service</span><span class="token punctuation">:</span> <span class="token number">503</span>
</code></pre> 
<blockquote> 
 <p>如果需要更多控制，可以定义自己的 <code>HttpCodeStatusMapper</code> Bean。</p> 
</blockquote> 
<p>下表列出了内置状态的默认状态映射：</p> 
<table><thead><tr><th>Status</th><th>Mapping</th></tr></thead><tbody><tr><td><code>DOWN</code></td><td><code>SERVICE_UNAVAILABLE</code> (<code>503</code>)</td></tr><tr><td><code>OUT_OF_SERVICE</code></td><td><code>SERVICE_UNAVAILABLE </code>(<code>503</code>)</td></tr><tr><td><code>UP</code></td><td>默认情况下无映射，因此 HTTP 状态为 <code>200</code></td></tr><tr><td><code>UNKNOWN</code></td><td>默认情况下无映射，因此 HTTP 状态为 <code>200</code></td></tr></tbody></table> 
<h4><a id="_427"></a>反应式健康指标</h4> 
<p>对于反应式应用程序（如使用 Spring WebFlux 的应用程序），<code>ReactiveHealthContributor</code> 提供了获取应用程序健康状况的非阻塞合约。与传统的 <code>HealthContributor</code> 类似，健康信息也是从 <code>ReactiveHealthContributorRegistry</code>（默认情况下是 <code>ApplicationContext</code> 中定义的所有 <code>HealthContributor</code> 和 <code>ReactiveHealthContributor</code> 实例）的内容中收集的。不检查反应式 API 的常规 <code>HealthContributor</code> 会在弹性调度程序上执行。</p> 
<blockquote> 
 <p>在反应式应用程序中，应使用 <code>ReactiveHealthContributorRegistry</code> 在运行时注册和取消注册健康指标。如果需要注册普通的 <code>HealthContributor</code>，则应使用 <code>ReactiveHealthContributor#adapt</code> 对其进行封装。</p> 
</blockquote> 
<p>要通过反应式 API 提供自定义健康信息，可以注册实现 <code>ReactiveHealthIndicator</code> 接口的 Spring Bean。下面的代码展示了一个 <code>ReactiveHealthIndicator</code> 实现示例：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>actuate<span class="token punctuation">.</span>health<span class="token punctuation">.</span></span><span class="token class-name">Health</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>actuate<span class="token punctuation">.</span>health<span class="token punctuation">.</span></span><span class="token class-name">ReactiveHealthIndicator</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyReactiveHealthIndicator</span> <span class="token keyword">implements</span> <span class="token class-name">ReactiveHealthIndicator</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Health</span><span class="token punctuation">&gt;</span></span> <span class="token function">health</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">doHealthCheck</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">onErrorResume</span><span class="token punctuation">(</span><span class="token punctuation">(</span>exception<span class="token punctuation">)</span> <span class="token operator">-&gt;</span>
            <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Health<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">down</span><span class="token punctuation">(</span>exception<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Health</span><span class="token punctuation">&gt;</span></span> <span class="token function">doHealthCheck</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// perform some specific health check</span>
        <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>要自动处理错误，可以考虑从 <code>AbstractReactiveHealthIndicator</code> 扩展。</p> 
</blockquote> 
<h4><a id="ReactiveHealthIndicators_457"></a>自动配置ReactiveHealthIndicators</h4> 
<p>在适当的时候，Spring Boot 会自动配置以下 <code>ReactiveHealthIndicators</code>：</p> 
<table><thead><tr><th>Key</th><th>Name</th><th>Description</th></tr></thead><tbody><tr><td><code>cassandra</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/cassandra/CassandraDriverReactiveHealthIndicator.java">CassandraDriverReactiveHealthIndicator</a></td><td>检查 Cassandra 数据库是否正常运行。</td></tr><tr><td><code>couchbase</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/couchbase/CouchbaseReactiveHealthIndicator.java">CouchbaseReactiveHealthIndicator</a></td><td>检查 Couchbase 集群是否正常运行。</td></tr><tr><td><code>elasticsearch</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/data/elasticsearch/ElasticsearchReactiveHealthIndicator.java">ElasticsearchReactiveHealthIndicator</a></td><td>检查 Elasticsearch 集群是否正常运行。</td></tr><tr><td><code>mongo</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/data/mongo/MongoReactiveHealthIndicator.java">MongoReactiveHealthIndicator</a></td><td>检查 Mongo 数据库是否正常运行。</td></tr><tr><td><code>neo4j</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/neo4j/Neo4jReactiveHealthIndicator.java">Neo4jReactiveHealthIndicator</a></td><td>检查 Neo4j 数据库是否正常运行。</td></tr><tr><td><code>redis</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/data/redis/RedisReactiveHealthIndicator.java">RedisReactiveHealthIndicator</a></td><td>检查 Redis 服务器是否正常运行。</td></tr></tbody></table> 
<blockquote> 
 <p>如有必要，反应式指示器会取代常规指示器。此外，任何未明确处理的 <code>HealthIndicator</code> 都会被自动封装。</p> 
</blockquote> 
<h4><a id="_471"></a>健康小组</h4> 
<p>有时，将健康指标组织成可用于不同目的的组非常有用。<br> 要创建健康指标组，可以使用 <code>management.endpoint.health.group.&lt;name&gt;</code> 属性，并指定要包括或排除的健康指标 ID 列表。例如，要创建一个只包括数据库指标的组，可以定义如下：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
    <span class="token key atrule">health</span><span class="token punctuation">:</span>
      <span class="token key atrule">group</span><span class="token punctuation">:</span>
        <span class="token key atrule">custom</span><span class="token punctuation">:</span>
          <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">"db"</span>
</code></pre> 
<p>然后点击 <code>localhost:8080/actuator/health/custom</code> 查看结果。<br> 同样，如果要创建一个组，将数据库指标排除在组之外，而将所有其他指标包括在内，可以定义如下：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
    <span class="token key atrule">health</span><span class="token punctuation">:</span>
      <span class="token key atrule">group</span><span class="token punctuation">:</span>
        <span class="token key atrule">custom</span><span class="token punctuation">:</span>
          <span class="token key atrule">exclude</span><span class="token punctuation">:</span> <span class="token string">"db"</span>
</code></pre> 
<p>默认情况下，如果健康组包含或排除了不存在的健康指示符，启动将失败。要禁用此行为，请将 <code>management.endpoint.health.validate-group-membership</code> 设置为 <code>false</code>。<br> 默认情况下，组继承与系统健康状况相同的 <code>StatusAggregator</code> 和 <code>HttpCodeStatusMapper</code> 设置。不过，您也可以按组定义这些设置。如果需要，还可以覆盖<code>show-details</code>和<code>roles</code>属性：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
    <span class="token key atrule">health</span><span class="token punctuation">:</span>
      <span class="token key atrule">group</span><span class="token punctuation">:</span>
        <span class="token key atrule">custom</span><span class="token punctuation">:</span>
          <span class="token key atrule">show-details</span><span class="token punctuation">:</span> <span class="token string">"when-authorized"</span>
          <span class="token key atrule">roles</span><span class="token punctuation">:</span> <span class="token string">"admin"</span>
          <span class="token key atrule">status</span><span class="token punctuation">:</span>
            <span class="token key atrule">order</span><span class="token punctuation">:</span> <span class="token string">"fatal,up"</span>
            <span class="token key atrule">http-mapping</span><span class="token punctuation">:</span>
              <span class="token key atrule">fatal</span><span class="token punctuation">:</span> <span class="token number">500</span>
              <span class="token key atrule">out-of-service</span><span class="token punctuation">:</span> <span class="token number">500</span>
</code></pre> 
<blockquote> 
 <p>如果您需要注册自定义的 <code>StatusAggregator</code> 或 <code>HttpCodeStatusMapper</code> Bean 以用于组，可以使用 <code>@Qualifier("groupname")</code>。</p> 
</blockquote> 
<p>健康组也可以包含/排除<code>CompositeHealthContributor</code>。您也可以只包含/排除 <code>CompositeHealthContributor</code> 的某个组件。可以使用组件的全限定名称来实现，如下所示：</p> 
<pre><code class="prism language-properties">management.endpoint.health.group.custom.include="test/primary"
management.endpoint.health.group.custom.exclude="test/primary/b"
</code></pre> 
<p>在上面的示例中，自定义组将包括名称为 <code>primary</code> 的 <code>HealthContributor</code>，它是复合测试的一个组件。在这里，<code>primary</code> 本身就是复合测试，名称为 <code>b</code> 的 <code>HealthContributor</code> 将被排除在自定义组之外。<br> 健康组可以在主端口或管理端口的附加路径上提供。这在 Kubernetes 等云环境中非常有用，在这些环境中，为了安全起见，通常会为执行器端点使用单独的管理端口。使用单独的端口可能会导致不可靠的健康检查，因为即使健康检查成功，主应用程序也可能无法正常工作。健康组可以通过以下额外路径进行配置：</p> 
<pre><code class="prism language-properties">management.endpoint.health.group.live.additional-path="server:/healthz"
</code></pre> 
<p>这样，<code>live</code>健康组就可以在 <code>/healthz</code> 的主服务器端口上使用。前缀必须是 <code>server:</code>（表示主服务器端口）或 <code>management:</code>（表示管理端口，如果已配置）。</p> 
<h4><a id="_521"></a>数据源健康</h4> 
<p>数据源健康状况指标显示标准数据源和路由数据源 Bean 的健康状况。路由数据源的健康状况包括其每个目标数据源的健康状况。在健康状况端点的响应中，路由数据源的每个目标都使用其路由键命名。如果不希望在指标输出中包含路由数据源，请将 <code>management.health.db.ignore-routing-data-sources</code> 设置为 <code>true</code>。</p> 
<h3><a id="Kubernetes__523"></a>Kubernetes 探针</h3> 
<p>部署在 Kubernetes 上的应用程序可以通过容器探针（<a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#container-probes" rel="nofollow">Container Probes</a>）提供有关其内部状态的信息。根据 <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/" rel="nofollow">Kubernetes 的配置</a>，kubelet 会调用这些探针并对结果做出反应。<br> 默认情况下，Spring Boot 会管理<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.spring-application.application-availability" rel="nofollow">应用程序可用性状态</a>。如果部署在 Kubernetes 环境中，actuator 会从 <code>ApplicationAvailability</code> 接口收集 “Liveness” 和 “Readiness” 信息，并在专用的健康指示器中使用这些信息： <code>LivenessStateHealthIndicator</code> 和 <code>ReadinessStateHealthIndicator</code>。这些指标显示在全局健康状况端点（<code>"/actuator/health"</code>）上。它们还可以通过使用健康组作为单独的 HTTP 探测器显示： <code>"/actuator/health/liveness"</code> 和 <code>"/actuator/health/readiness"</code>。<br> 然后，您可以使用以下端点信息配置 Kubernetes 基础设施：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
  <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">"/actuator/health/liveness"</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> &lt;actuator<span class="token punctuation">-</span>port<span class="token punctuation">&gt;</span>
  <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token punctuation">...</span>
  <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token punctuation">...</span>

<span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
  <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">"/actuator/health/readiness"</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> &lt;actuator<span class="token punctuation">-</span>port<span class="token punctuation">&gt;</span>
  <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token punctuation">...</span>
  <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token punctuation">...</span>
</code></pre> 
<blockquote> 
 <p><code>&lt;actuator-port&gt;</code>（执行器端口）应设置为执行器端点可用的端口。如果设置了 <code>"management.server.port"</code>（管理服务器端口）属性，则可以是主网络服务器端口或单独的管理端口。</p> 
</blockquote> 
<p>只有当应用程序<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/deployment.html#deployment.cloud.kubernetes" rel="nofollow">在 Kubernetes 环境中运行</a>时，这些健康组才会自动启用。您可以使用 <code>management.endpoint.health.probes.enabled</code> 配置属性在任何环境中启用它们。</p> 
<blockquote> 
 <p>如果应用程序的启动时间超过了配置的有效期，Kubernetes 会将 <code>"startupProbe"</code> 作为一种可能的解决方案。一般来说，这里并不一定需要 <code>"startupProbe"</code>，因为在所有启动任务完成之前，<code>"readinessProbe"</code> 都会失败。这意味着您的应用程序在准备就绪之前不会接收流量。不过，如果您的应用程序需要很长时间才能启动，可以考虑使用 <code>"startupProbe"</code> 来确保 Kubernetes 不会在您的应用程序启动过程中杀死它。请参阅 “探针在应用程序生命周期中的行为” 部分。</p> 
</blockquote> 
<p>如果 Actuator 端点部署在单独的管理上下文中，则端点不会使用与主应用程序相同的网络基础结构（端口、连接池、框架组件）。在这种情况下，即使主应用程序无法正常工作（例如，无法接受新连接），探测检查也可能成功。因此，最好在主服务器端口上提供<code>liveness</code>和<code>readiness</code>状态组。这可以通过设置以下属性来实现：</p> 
<pre><code class="prism language-properties">management.endpoint.health.probes.add-additional-paths=true
</code></pre> 
<p>这样，主服务器端口上的<code>/livez</code> 和<code>/readyz</code> 就可以分别使用<code>liveness</code>组和<code>readiness</code>组。可以使用每个组的 <code>additional-path</code> 属性自定义路径，详情请参阅健康组。</p> 
<h4><a id="_Kubernetes__552"></a>利用 Kubernetes 探测器检查外部状态</h4> 
<p>Actuator 将 “liveness” 和 “readiness” 探测器配置为健康组。这意味着它们可以使用健康组的所有功能。例如，您可以配置额外的健康指标：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoint</span><span class="token punctuation">:</span>
    <span class="token key atrule">health</span><span class="token punctuation">:</span>
      <span class="token key atrule">group</span><span class="token punctuation">:</span>
        <span class="token key atrule">readiness</span><span class="token punctuation">:</span>
          <span class="token key atrule">include</span><span class="token punctuation">:</span> <span class="token string">"readinessState,customCheck"</span>
</code></pre> 
<p>默认情况下，Spring Boot 不会向这些组添加其他健康指标。<br> “liveness”探针不应依赖外部系统的健康检查。如果<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.spring-application.application-availability.liveness" rel="nofollow">应用程序的有效性状态</a>被破坏，Kubernetes 会尝试通过重启应用程序实例来解决问题。这意味着，如果外部系统（如数据库、Web API 或外部缓存）发生故障，Kubernetes 可能会重启所有应用实例，并造成级联故障。<br> 至于 “readiness” 探针，应用程序开发人员必须谨慎选择检查外部系统。因此，Spring Boot 在 “readiness” 探针中不包含任何额外的健康检查。如果<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.spring-application.application-availability.readiness" rel="nofollow">应用程序实例的就绪状态</a>为 “未就绪”，Kubernetes 不会将流量路由到该实例。有些外部系统可能不被应用实例共享，在这种情况下，它们可以被包含在就绪状态探查中。其他外部系统可能对应用并不重要（应用可能有断路器和回退），在这种情况下，它们肯定不应该被包括在内。不幸的是，所有应用程序实例共享的外部系统很常见，因此必须做出判断： 是将其包含在就绪探测器中，并期望在外部服务宕机时应用程序停止服务，还是不将其包含在内，而是通过在调用程序中使用断路器来处理堆栈上层的故障。</p> 
<blockquote> 
 <p>如果应用程序的所有实例都未就绪，则 <code>type=ClusterIP</code> 或 <code>NodePort</code> 的 Kubernetes 服务不会接受任何传入连接。由于没有连接，所以不会有 HTTP 错误响应（503 等）。<code>type=LoadBalancer</code> 的服务可能接受也可能不接受连接，具体取决于提供商。有明确<a href="https://kubernetes.io/docs/concepts/services-networking/ingress/" rel="nofollow">入口</a>的服务的响应方式也取决于实现–入口服务本身必须决定如何处理来自下游的 “连接被拒绝”。在负载平衡器和入口的情况下，都很可能出现 HTTP 503。</p> 
</blockquote> 
<p>此外，如果应用程序使用 Kubernetes <a href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/" rel="nofollow">自动扩展</a>，它可能会对从负载平衡器中取出的应用程序做出不同的反应，具体取决于其自动扩展器配置。</p> 
<h4><a id="_568"></a>应用程序生命周期和探针状态</h4> 
<p>Kubernetes 探针支持的一个重要方面是它与应用程序生命周期的一致性。<code>AvailabilityState</code>（应用程序的内存内部状态）与实际探针（暴露该状态）之间存在显著差异。根据应用程序生命周期的不同阶段，探针可能不可用。<br> Spring Boot 会在<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.spring-application.application-events-and-listeners" rel="nofollow">启动和关闭期间发布应用程序事件</a>，探针可以监听此类事件并公开 <code>AvailabilityState</code> 信息。<br> 下表显示了不同阶段的 <code>AvailabilityState</code> 和 HTTP 连接器状态。<br> Spring Boot 应用程序启动时：</p> 
<table><thead><tr><th><strong>启动阶段</strong></th><th><strong>LivenessState</strong></th><th><strong>ReadinessState</strong></th><th><strong>HTTP server</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>Starting</td><td><code>BROKEN</code></td><td><code>REFUSING_TRAFFIC</code></td><td>未启动</td><td>Kubernetes 会检查 “liveness” 探针，并在时间过长时重启应用程序。</td></tr><tr><td>Started</td><td><code>CORRECT</code></td><td><code>REFUSING_TRAFFIC</code></td><td>拒绝请求</td><td>应用程序上下文已刷新。应用程序执行启动任务，尚未接收流量。</td></tr><tr><td>Ready</td><td><code>CORRECT</code></td><td><code>ACCEPTING_TRAFFIC</code></td><td>接受请求</td><td>启动任务已完成。应用程序正在接收流量。</td></tr></tbody></table> 
<p>Spring Boot 应用程序关闭时：</p> 
<table><thead><tr><th><strong>关闭阶段</strong></th><th><strong>Liveness State</strong></th><th><strong>Readiness State</strong></th><th><strong>HTTP server</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>Running</td><td><code>CORRECT</code></td><td><code>ACCEPTING_TRAFFIC</code></td><td>接受请求</td><td>已申请关闭。</td></tr><tr><td>Graceful shutdown</td><td><code>CORRECT</code></td><td><code>REFUSING_TRAFFIC</code></td><td>新的请求被拒绝</td><td>如果启用，<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/web.html#web.graceful-shutdown" rel="nofollow">优雅关机将处理执行中的请求</a>。</td></tr><tr><td>Shutdown complete</td><td><code>N/A</code></td><td><code>N/A</code></td><td>服务器已关闭</td><td>应用程序上下文已关闭，应用程序也已关闭。</td></tr></tbody></table> 
<blockquote> 
 <p>有关 Kubernetes 部署的更多信息，请参阅 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/deployment.html#deployment.cloud.kubernetes.container-lifecycle" rel="nofollow">Kubernetes 容器生命周期部分</a>。</p> 
</blockquote> 
<h3><a id="_590"></a>应用信息</h3> 
<p>应用程序信息会公开从 <code>ApplicationContext</code> 中定义的所有 <code>InfoContributor</code> Bean 收集到的各种信息。Spring Boot 包含大量自动配置的 <code>InfoContributor</code> Bean，您也可以编写自己的 <code>InfoContributor</code> Bean。</p> 
<h4><a id="InfoContributors_592"></a>自动配置InfoContributors</h4> 
<p>在适当的时候，Spring 会自动配置以下 <code>InfoContributor</code> Bean：</p> 
<table><thead><tr><th><strong>ID</strong></th><th><strong>Name</strong></th><th><strong>描述</strong></th><th><strong>先决条件</strong></th></tr></thead><tbody><tr><td><code>build</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/BuildInfoContributor.java">BuildInfoContributor</a></td><td>暴露构建信息。</td><td><code>META-INF/build-info.properties</code> 资源。</td></tr><tr><td><code>env</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/EnvironmentInfoContributor.java">EnvironmentInfoContributor</a></td><td>暴露环境中名称以 <code>info.</code> 开头的任何属性…</td><td>None.</td></tr><tr><td><code>git</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/GitInfoContributor.java">GitInfoContributor</a></td><td>暴露 git 信息。</td><td><code>git.properties</code> 资源。</td></tr><tr><td><code>java</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/JavaInfoContributor.java">JavaInfoContributor</a></td><td>暴露 Java 运行时信息。</td><td>None.</td></tr><tr><td><code>os</code></td><td><a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-actuator/src/main/java/org/springframework/boot/actuate/info/OsInfoContributor.java">OsInfoContributor</a></td><td>暴露操作系统信息。</td><td>None.</td></tr></tbody></table> 
<p>单个贡献者是否启用由其 <code>management.info.&lt;id&gt;.enabled</code> 属性控制。不同的贡献者有不同的默认值，这取决于它们的先决条件和所暴露信息的性质。<br> 由于没有先决条件表明它们应该被启用，因此 <code>env</code>、<code>java</code> 和 <code>os</code> 贡献者默认为禁用。可通过将其 <code>management.info.&lt;id&gt;.enabled</code> 属性设置为 <code>true</code> 来启用它们。<br> <code>build</code>和 <code>git</code> info 贡献者默认为启用。可通过将其 <code>management.info.&lt;id&gt;.enabled</code> 属性设置为 <code>false</code> 来禁用。或者，要禁用通常默认启用的每个贡献器，可将 <code>management.info.defaults.enabled</code> 属性设置为 false。</p> 
<h4><a id="_606"></a>自定义应用信息</h4> 
<p>启用 <code>env</code> 贡献者后，你可以通过设置 <code>info.*</code> Spring 属性来定制 <code>info</code> 端点暴露的数据。<code>info.*</code> 键下的所有环境属性都会自动公开。例如，你可以在 <code>application.properties</code> 文件中添加以下设置：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">info</span><span class="token punctuation">:</span>
  <span class="token key atrule">app</span><span class="token punctuation">:</span>
    <span class="token key atrule">encoding</span><span class="token punctuation">:</span> <span class="token string">"UTF-8"</span>
    <span class="token key atrule">java</span><span class="token punctuation">:</span>
      <span class="token key atrule">source</span><span class="token punctuation">:</span> <span class="token string">"17"</span>
      <span class="token key atrule">target</span><span class="token punctuation">:</span> <span class="token string">"17"</span>
</code></pre> 
<blockquote> 
 <p>除了硬编码这些值之外，还可以在<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto.properties-and-configuration.expand-properties" rel="nofollow">构建时扩展 info 属性</a>。<br> 假设你使用 Maven，你可以将前面的示例重写如下：</p> 
</blockquote> 
<pre><code class="prism language-yaml"><span class="token key atrule">info</span><span class="token punctuation">:</span>
  <span class="token key atrule">app</span><span class="token punctuation">:</span>
    <span class="token key atrule">encoding</span><span class="token punctuation">:</span> <span class="token string">"@project.build.sourceEncoding@"</span>
    <span class="token key atrule">java</span><span class="token punctuation">:</span>
      <span class="token key atrule">source</span><span class="token punctuation">:</span> <span class="token string">"@java.version@"</span>
      <span class="token key atrule">target</span><span class="token punctuation">:</span> <span class="token string">"@java.version@"</span>
</code></pre> 
<h4><a id="Git__627"></a>Git 提交信息</h4> 
<p><code>info</code> 端点的另一个有用功能是，它能发布项目构建时 git 源代码库的状态信息。如果有 <code>GitProperties</code> Bean，就可以使用 <code>info</code> 端点公开这些属性。</p> 
<blockquote> 
 <p>如果类路径根目录下有 <code>git.properties</code> 文件，<code>GitProperties</code> Bean 就会自动配置。详情请参阅 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto.build.generate-git-info" rel="nofollow">“如何生成 git 信息”</a>。</p> 
</blockquote> 
<p>默认情况下，端点会公开 <code>git.branch</code>、<code>git.commit.id</code> 和 <code>git.commit.time</code> 属性（如果存在）。如果不想在端点响应中显示这些属性，就需要在 <code>git.properties</code> 文件中排除它们。如果要显示完整的 git 信息（即 <code>git.properties</code> 的全部内容），请使用 <code>management.info.git.mode</code> 属性，如下所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">info</span><span class="token punctuation">:</span>
    <span class="token key atrule">git</span><span class="token punctuation">:</span>
      <span class="token key atrule">mode</span><span class="token punctuation">:</span> <span class="token string">"full"</span>
</code></pre> 
<p>要完全禁用 <code>info</code> 端点的 git 提交信息，请将 <code>management.info.git.enabled</code> 属性设置为 <code>false</code>，如下所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">info</span><span class="token punctuation">:</span>
    <span class="token key atrule">git</span><span class="token punctuation">:</span>
      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre> 
<h4><a id="_645"></a>构建信息</h4> 
<p>如果 <code>BuildProperties</code> Bean 可用，<code>info</code> 端点也可以发布有关构建的信息。如果类路径中存在 <code>META-INF/build-info.properties</code> 文件，就会出现这种情况。</p> 
<blockquote> 
 <p>Maven 和 Gradle 插件都能生成该文件。详情请参阅 “<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html#howto.build.generate-info" rel="nofollow">如何生成构建信息</a>”。</p> 
</blockquote> 
<h4><a id="Java__649"></a>Java 信息</h4> 
<p><code>info</code> 端点会发布有关 Java 运行环境的信息，详情请参阅 <a href="https://docs.spring.io/spring-boot/docs/3.2.1/api/org/springframework/boot/info/JavaInfo.html" rel="nofollow">JavaInfo</a>。</p> 
<h4><a id="OS__651"></a>OS 信息</h4> 
<p><code>info</code> 端点发布有关操作系统的信息，详情请查看 <a href="https://docs.spring.io/spring-boot/docs/3.2.1/api/org/springframework/boot/info/OsInfo.html" rel="nofollow">OsInfo</a>。</p> 
<h4><a id="InfoContributors_653"></a>编写自定义InfoContributors</h4> 
<p>要提供自定义应用程序信息，可以注册实现 <code>InfoContributor</code> 接口的 Spring Bean。<br> 下面的示例提供了一个具有单一值的<code>example</code>条目：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collections</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>actuate<span class="token punctuation">.</span>info<span class="token punctuation">.</span></span><span class="token class-name">Info</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>actuate<span class="token punctuation">.</span>info<span class="token punctuation">.</span></span><span class="token class-name">InfoContributor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyInfoContributor</span> <span class="token keyword">implements</span> <span class="token class-name">InfoContributor</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">contribute</span><span class="token punctuation">(</span><span class="token class-name">Info<span class="token punctuation">.</span>Builder</span> builder<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        builder<span class="token punctuation">.</span><span class="token function">withDetail</span><span class="token punctuation">(</span><span class="token string">"example"</span><span class="token punctuation">,</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonMap</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">,</span> <span class="token string">"value"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>如果访问 <code>info</code> 端点，就会看到一个包含以下附加条目的响应：</p> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"example"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"key"</span> <span class="token operator">:</span> <span class="token string">"value"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_HTTP__681"></a>通过 HTTP 进行监控和管理</h2> 
<p>如果您正在开发 Web 应用程序，Spring Boot Actuator 会自动配置所有启用的端点，使其通过 HTTP 暴露。默认的惯例是使用带有 <code>/actuator</code> 前缀的端点 <code>id</code> 作为 URL 路径。例如，<code>health</code> 显示为 <code>/actuator/health</code>。</p> 
<blockquote> 
 <p>Actuator 原生支持 Spring MVC、Spring WebFlux 和 Jersey。如果 Jersey 和 Spring MVC 都可用，则使用 Spring MVC。</p> 
</blockquote> 
<blockquote> 
 <p>Jackson 是获取 API 文档（<a href="https://docs.spring.io/spring-boot/docs/3.2.1/actuator-api/htmlsingle" rel="nofollow">HTML</a> 或 <a href="https://docs.spring.io/spring-boot/docs/3.2.1/actuator-api/pdf/spring-boot-actuator-web-api.pdf" rel="nofollow">PDF</a>）中记录的正确 JSON 响应所必需的依赖项。</p> 
</blockquote> 
<h3><a id="_687"></a>自定义管理端点路径</h3> 
<p>有时，自定义管理端点的前缀非常有用。例如，您的应用程序可能已将 <code>/actuator</code> 用于其他目的。您可以使用 <code>management.endpoints.web.base-path</code> 属性更改管理端点的前缀，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">base-path</span><span class="token punctuation">:</span> <span class="token string">"/manage"</span>
</code></pre> 
<p>前面的 <code>application.properties</code> 示例将端点从 <code>/actuator/{id}</code> 更改为 <code>/manage/{id}</code>（例如，<code>/manage/info</code>）。</p> 
<blockquote> 
 <p>除非管理端口已配置为通过<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html#actuator.monitoring.customizing-management-server-port" rel="nofollow">使用不同的 HTTP 端口来暴露端点</a>，否则 <code>management.endpoints.web.base-path</code> 将相对于 <code>server.servlet.context-path</code>（针对 servlet 网络应用程序）或 <code>spring.webflux.base-path</code>（针对反应式网络应用程序）。如果配置了 <code>management.server.port</code>，则 <code>management.endpoints.web.base-path</code> 会相对于 <code>management.server.base-path</code>。</p> 
</blockquote> 
<p>如果要将端点映射到不同的路径，可以使用 <code>management.endpoints.web.path-mapping</code> 属性。<br> 下面的示例将 <code>/actuator/health</code> 重映射为 <code>/healthcheck</code>：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">base-path</span><span class="token punctuation">:</span> <span class="token string">"/"</span>
      <span class="token key atrule">path-mapping</span><span class="token punctuation">:</span>
        <span class="token key atrule">health</span><span class="token punctuation">:</span> <span class="token string">"healthcheck"</span>
</code></pre> 
<h3><a id="_708"></a>自定义管理服务器端口</h3> 
<p>使用默认 HTTP 端口暴露管理端点是基于云的部署的明智选择。但如果你的应用程序在自己的数据中心内运行，你可能更愿意使用不同的 HTTP 端口来暴露端点。<br> 您可以设置 <code>management.server.port</code> 属性来更改 HTTP 端口，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8081</span>
</code></pre> 
<blockquote> 
 <p>在 Cloud Foundry 上，默认情况下应用程序仅在 HTTP 和 TCP 路由的 8080 端口上接收请求。如果您想在 Cloud Foundry 上使用自定义管理端口，则需要显式设置应用程序的路由以将流量转发到自定义端口。</p> 
</blockquote> 
<h3><a id="_SSL_718"></a>配置管理专用 SSL</h3> 
<p>当配置为使用自定义端口时，还可以通过使用各种 <code>management.server.ssl.*</code> 属性，为管理服务器配置自己的 SSL。例如，这样做可以让管理服务器通过 HTTP 提供服务，而主应用程序则使用 HTTPS，如下属性设置所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8443</span>
  <span class="token key atrule">ssl</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">key-store</span><span class="token punctuation">:</span> <span class="token string">"classpath:store.jks"</span>
    <span class="token key atrule">key-password</span><span class="token punctuation">:</span> <span class="token string">"secret"</span>
<span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
    <span class="token key atrule">ssl</span><span class="token punctuation">:</span>
      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre> 
<p>或者，主服务器和管理服务器都可以使用 SSL，但使用不同的密钥存储，如下所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8443</span>
  <span class="token key atrule">ssl</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">key-store</span><span class="token punctuation">:</span> <span class="token string">"classpath:main.jks"</span>
    <span class="token key atrule">key-password</span><span class="token punctuation">:</span> <span class="token string">"secret"</span>
<span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
    <span class="token key atrule">ssl</span><span class="token punctuation">:</span>
      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">key-store</span><span class="token punctuation">:</span> <span class="token string">"classpath:management.jks"</span>
      <span class="token key atrule">key-password</span><span class="token punctuation">:</span> <span class="token string">"secret"</span>
</code></pre> 
<h3><a id="_749"></a>自定义管理服务器地址</h3> 
<p>通过设置 <code>management.server.address</code> 属性，可以自定义管理端点可用的地址。如果你只想监听内部网络或面向操作的网络，或者只想监听来自 <code>localhost</code> 的连接，那么这样做会很有用。</p> 
<blockquote> 
 <p>只有当端口与主服务器端口不同时，才能监听不同的地址。</p> 
</blockquote> 
<p>以下示例的 <code>application.properties</code> 不允许远程管理连接：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8081</span>
    <span class="token key atrule">address</span><span class="token punctuation">:</span> <span class="token string">"127.0.0.1"</span>
</code></pre> 
<h3><a id="_HTTP__760"></a>禁用 HTTP 端点</h3> 
<p>如果不想通过 HTTP 公开端点，可以将管理端口设置为<code>-1</code>，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">server</span><span class="token punctuation">:</span>
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">-1</span>
</code></pre> 
<p>您还可以使用 <code>management.endpoints.web.exposure.exclude</code> 属性来实现这一目的，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">web</span><span class="token punctuation">:</span>
      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
        <span class="token key atrule">exclude</span><span class="token punctuation">:</span> <span class="token string">"*"</span>
</code></pre> 
<h3><a id="_JMX__775"></a>通过 JMX 进行监控和管理</h3> 
<p>Java 管理扩展（JMX）提供了一种监控和管理应用程序的标准机制。默认情况下，此功能未启用。您可以通过将 <code>spring.jmx.enabled</code> 配置属性设置为 <code>true</code> 来开启该功能。Spring Boot 将最合适的 <code>MBeanServer</code> 公开为一个 ID 为 <code>mbeanServer</code> 的 Bean。您的任何带有 Spring JMX 注释（<code>@ManagedResource</code>、<code>@ManagedAttribute</code> 或 <code>@ManagedOperation</code>）的 Bean 都会暴露给它。<br> 如果您的平台提供了标准 <code>MBeanServer</code>，Spring Boot 将使用该服务器，并在必要时默认使用 VM <code>MBeanServer</code>。如果所有方法都失败，则会创建一个新的 <code>MBeanServer</code>。<br> 有关详细信息，请参阅 <a href="https://github.com/spring-projects/spring-boot/tree/v3.2.1/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/jmx/JmxAutoConfiguration.java">JmxAutoConfiguration</a> 类。<br> 默认情况下，Spring Boot 还会将管理端点作为 <code>org.springframework.boot</code> 域下的 JMX MBeans 公开。要完全控制 JMX 域中的端点注册，请考虑注册自己的 <code>EndpointObjectNameFactory</code> 实现。</p> 
<h3><a id="_MBean__780"></a>自定义 MBean 名称</h3> 
<p>MBean 的名称通常由端点的 <code>id</code> 生成。例如，健康端点以 <code>org.springframework.boot:type=Endpoint,name=Health</code> 的形式公开。<br> 如果您的应用程序包含多个 Spring <code>ApplicationContext</code>，您可能会发现名称冲突。要解决这个问题，可以将 <code>spring.jmx.unique-names</code> 属性设置为 <code>true</code>，这样 MBean 名称就总是唯一的了。<br> 您还可以自定义端点暴露的 JMX 域。下面的设置展示了在 <code>application.properties</code> 中这样做的一个示例：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">jmx</span><span class="token punctuation">:</span>
    <span class="token key atrule">unique-names</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">jmx</span><span class="token punctuation">:</span>
      <span class="token key atrule">domain</span><span class="token punctuation">:</span> <span class="token string">"com.example.myapp"</span>
</code></pre> 
<h3><a id="_JMX__793"></a>禁用 JMX 端点</h3> 
<p>如果不想通过 JMX 暴露端点，可以将 <code>management.endpoints.jmx.exposure.exclude</code> 属性设置为 <code>*</code>，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">endpoints</span><span class="token punctuation">:</span>
    <span class="token key atrule">jmx</span><span class="token punctuation">:</span>
      <span class="token key atrule">exposure</span><span class="token punctuation">:</span>
        <span class="token key atrule">exclude</span><span class="token punctuation">:</span> <span class="token string">"*"</span>
</code></pre> 
<h2><a id="Observability_802"></a>可观察性（Observability）</h2> 
<p>可观察性是指从外部观察运行系统内部状态的能力。它由日志、度量和跟踪三大支柱组成。<br> 对于度量和跟踪，Spring Boot 使用 <a href="https://micrometer.io/docs/observation" rel="nofollow">Micrometer Observation</a>。要创建自己的观察结果（这将导致度量和跟踪），您可以注入一个 <code>ObservationRegistry</code>。</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>micrometer<span class="token punctuation">.</span>observation<span class="token punctuation">.</span></span><span class="token class-name">Observation</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>micrometer<span class="token punctuation">.</span>observation<span class="token punctuation">.</span></span><span class="token class-name">ObservationRegistry</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCustomObservation</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ObservationRegistry</span> observationRegistry<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">MyCustomObservation</span><span class="token punctuation">(</span><span class="token class-name">ObservationRegistry</span> observationRegistry<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>observationRegistry <span class="token operator">=</span> observationRegistry<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Observation</span><span class="token punctuation">.</span><span class="token function">createNotStarted</span><span class="token punctuation">(</span><span class="token string">"doSomething"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>observationRegistry<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">lowCardinalityKeyValue</span><span class="token punctuation">(</span><span class="token string">"locale"</span><span class="token punctuation">,</span> <span class="token string">"en-US"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">highCardinalityKeyValue</span><span class="token punctuation">(</span><span class="token string">"userId"</span><span class="token punctuation">,</span> <span class="token string">"42"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// Execute business logic here</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>卡入度低（Low cardinality）的键值将被添加到度量和轨迹中，而卡入度高（high cardinality）的键值只会被添加到轨迹中。</p> 
</blockquote> 
<p><code>ObservationPredicate</code>、<code>GlobalObservationConvention</code>、<code>ObservationFilter</code> 和 <code>ObservationHandler</code> 类型的 Bean 将自动在 <code>ObservationRegistry</code> 上注册。此外，您还可以注册任意数量的 <code>ObservationRegistryCustomizer</code> Bean 来进一步配置注册表。<br> 可观察性支持依赖于<a href="https://github.com/micrometer-metrics/context-propagation">上下文传播库</a>，以跨线程和反应管道转发当前观察结果。默认情况下，线程本地值不会在反应式操作符中自动恢复。这一行为由 <code>spring.reactor.context-propagation</code> 属性控制，可将其设置为 <code>auto</code> 以启用自动传播。<br> 有关观察的更多详情，请参阅 <a href="https://micrometer.io/docs/observation" rel="nofollow">Micrometer Observation 文档</a>。</p> 
<blockquote> 
 <p>JDBC 的可观察性可以使用单独的项目进行配置。<a href="https://github.com/jdbc-observations/datasource-micrometer">Datasource Micrometer 项目</a>提供了一个 Spring Boot 启动器，可在调用 JDBC 操作时自动创建观察结果。有关详细信息，请参阅<a href="https://jdbc-observations.github.io/datasource-micrometer/docs/current/docs/html/" rel="nofollow">参考文档</a>。</p> 
</blockquote> 
<blockquote> 
 <p>Spring Boot 内置了 R2DBC 的可观察性。要启用它，请在项目中添加 <code>io.r2dbc:r2dbc-proxy</code> 依赖关系。</p> 
</blockquote> 
<h3><a id="_840"></a>通用键值</h3> 
<p>通用键值通常用于对运行环境进行维度钻取，如主机、实例、区域、堆栈等。通用键值作为低卡片性键值应用于所有观测值，并可进行配置，如下例所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">observations</span><span class="token punctuation">:</span>
    <span class="token key atrule">key-values</span><span class="token punctuation">:</span>
      <span class="token key atrule">region</span><span class="token punctuation">:</span> <span class="token string">"us-east-1"</span>
      <span class="token key atrule">stack</span><span class="token punctuation">:</span> <span class="token string">"prod"</span>
</code></pre> 
<p>上例为所有值分别为 <code>us-east-1</code> 和 <code>prod</code> 的观测值添加了<code>region</code>和<code>stack</code>键值。</p> 
<h3><a id="_850"></a>防止观察</h3> 
<p>如果想阻止某些观察结果被报告，可以使用 <code>management.observations.enable</code> 属性：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">management</span><span class="token punctuation">:</span>
  <span class="token key atrule">observations</span><span class="token punctuation">:</span>
    <span class="token key atrule">enable</span><span class="token punctuation">:</span>
      <span class="token key atrule">denied</span><span class="token punctuation">:</span>
        <span class="token key atrule">prefix</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token key atrule">another</span><span class="token punctuation">:</span>
        <span class="token key atrule">denied</span><span class="token punctuation">:</span>
          <span class="token key atrule">prefix</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre> 
<p>上例将阻止所有名称以 <code>denied.prefix</code> 或 <code>another.denied.prefix</code> 开头的观察结果。</p> 
<blockquote> 
 <p>如果要阻止 Spring Security 报告观察结果，请将 <code>management.observations.enable.spring.security</code> 属性设置为 <code>false</code>。</p> 
</blockquote> 
<p>如果需要对观察结果的预防进行更多控制，可以注册 <code>ObservationPredicate</code> 类型的 Bean。只有当所有 <code>ObservationPredicate</code> Bean 都对该观察结果返回 <code>true</code> 时，才会报告该观察结果。</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>micrometer<span class="token punctuation">.</span>observation<span class="token punctuation">.</span></span><span class="token class-name">Observation</span><span class="token punctuation">.</span><span class="token class-name">Context</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>micrometer<span class="token punctuation">.</span>observation<span class="token punctuation">.</span></span><span class="token class-name">ObservationPredicate</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Component</span>
<span class="token keyword">class</span> <span class="token class-name">MyObservationPredicate</span> <span class="token keyword">implements</span> <span class="token class-name">ObservationPredicate</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token class-name">Context</span> context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token operator">!</span>name<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"denied"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>上例将阻止所有名称包含 “denied” 的观察结果。</p> 
<h3><a id="OpenTelemetry__883"></a>OpenTelemetry 支持</h3> 
<p>Spring Boot 的执行器模块包含对 <a href="https://opentelemetry.io/" rel="nofollow">OpenTelemetry</a> 的基本支持。<br> 它提供了 <code>OpenTelemetry</code> 类型的 Bean，如果应用程序上下文中有 <code>SdkTracerProvider</code>、<code>ContextPropagators</code>、<code>SdkLoggerProvider</code> 或 <code>SdkMeterProvider</code> 类型的 Bean，它们会自动注册。此外，它还提供了一个<code>Resource</code> bean。<code>Resource</code>的属性可通过 <code>management.opentelemetry.resource-attributes</code> 配置属性进行配置。</p> 
<blockquote> 
 <p>Spring Boot 不为 <code>OpenTelemetry</code> 指标或日志提供自动配置。<code>OpenTelemetry</code> 跟踪只有在与 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/actuator.html#actuator.micrometer-tracing" rel="nofollow">Micrometer 跟踪</a>一起使用时才会自动配置。</p> 
</blockquote> 
<p>接下来的章节将详细介绍日志、度量和跟踪。</p> 
<h2><a id="Loggers_889"></a>Loggers</h2> 
<p>Spring Boot Actuator 具有在运行时查看和配置应用程序日志级别的功能。您既可以查看整个列表，也可以查看单个日志记录器的配置，其中既包括显式配置的日志记录级别，也包括日志记录框架赋予它的有效日志记录级别。这些级别可以是：</p> 
<ul><li><code>TRACE</code></li><li><code>DEBUG</code></li><li><code>INFO</code></li><li><code>WARN</code></li><li><code>ERROR</code></li><li><code>FATAL</code></li><li><code>OFF</code></li><li><code>null</code></li></ul> 
<p><code>null</code> 表示没有明确的配置。</p> 
<h3><a id="Logger_902"></a>配置Logger</h3> 
<p>要配置给定的logger，请向资源的 URI 发送部分实体，如下例所示：</p> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"configuredLevel"</span><span class="token operator">:</span> <span class="token string">"DEBUG"</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>要 “reset” 日志记录器的特定级别（并使用默认配置），可将 <code>configuredLevel</code> 设为<code>null</code>值。</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4c4a463480603d44cbb2cf2493ff0868/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MySQL基础笔记（4）DQL数据查询语句</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/915f205ee27b817e9afd0db40b8e64ee/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Vue3-37-路由-组件内的路由守卫 onBeforeRouteLeave 和 onBeforeRouteUpdate</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>