<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>LCD/HDMI OUT调试经验（6）------点亮HDMI屏幕 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="LCD/HDMI OUT调试经验（6）------点亮HDMI屏幕" />
<meta property="og:description" content="在调试display的经历中，除了一些手持类设备以外其他机器基本都会外接HDMI屏幕，显示原理之前也提过：由模块发出的MIPI信号经过9611或者9611uxc芯片输出HDMI信号最后在屏幕进行显示。这两款芯片的最主要差别是9611uxc最高可以支持到4K60fps 的输出画面而9611是4K30fps。和调试9211的大致步骤完全一样，9611和9611uxc的芯片也是分为添加驱动，上电和配置屏幕，只不过需要具体修改配置屏幕的一些参数。所以请先熟悉9211的调试再阅读本篇文章。
本文基于高通845平台，首先大致讲解上电与添加驱动操作，配置屏幕方面在具体调试的过程中1080p与4k的区别会详细介绍。
一、阅读材料与上电 首先还是阅读手上的一些材料：芯片数据手册、原理图以及驱动部分代码。这里不再具体介绍，和9211调试的步骤基本一致，而且芯片的上电脚也差不多。这里贴一下9611uxc的原理图与数据手册部分内容
阅读完芯片手册与原理图下面在驱动进行上电操作，首先还是在设备树配置对应的GPIO：
接下来添加驱动并且解析对应GPIO再按照时序上电，相关代码就不贴，和9211的是一样的，这一步最主要的还是I2C要调通，后面都相对简单。
二、屏幕的配置 这一部分主要讲4k屏幕的配置与1080p的区别，9611uxc最多可以支持4k60 fps的显示，所以向下可以兼容1080p60 fps和720p60 fps，AP的4k MIPI参数配置如下：
（1）AP /* Copyright (c) 2015-2017, The Linux Foundation. All rights reserved. * * This program is free software; you can redistribute it and/or modify * it under the terms of the GNU General Public License version 2 and * only version 2 as published by the Free Software Foundation. * * This program is distributed in the hope that it will be useful, * but WITHOUT ANY WARRANTY; without even the implied warranty of * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/91d6838f026b4d9054d4a707e0721f8a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-28T15:26:12+08:00" />
<meta property="article:modified_time" content="2022-12-28T15:26:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">LCD/HDMI OUT调试经验（6）------点亮HDMI屏幕</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>在调试display的经历中，除了一些手持类设备以外其他机器基本都会外接HDMI屏幕，显示原理之前也提过：由模块发出的MIPI信号经过9611或者9611uxc芯片输出HDMI信号最后在屏幕进行显示。这两款芯片的最主要差别是9611uxc最高可以支持到4K60fps 的输出画面而9611是4K30fps。和调试9211的大致步骤完全一样，9611和9611uxc的芯片也是分为添加驱动，上电和配置屏幕，只不过需要具体修改配置屏幕的一些参数。所以请先熟悉9211的调试再阅读本篇文章。</p> 
<p>本文基于高通845平台，首先大致讲解上电与添加驱动操作，配置屏幕方面在具体调试的过程中1080p与4k的区别会详细介绍。</p> 
<p> </p> 
<h2>一、阅读材料与上电</h2> 
<p>首先还是阅读手上的一些材料：芯片数据手册、原理图以及驱动部分代码。这里不再具体介绍，和9211调试的步骤基本一致，而且芯片的上电脚也差不多。这里贴一下9611uxc的原理图与数据手册部分内容</p> 
<p><img src="https://images2.imgbox.com/92/87/SOBgH57J_o.png" alt="918eda62ec09408d81a40f8ab688cd86.png"></p> 
<p> </p> 
<p><img src="https://images2.imgbox.com/51/8b/uOG1S4Qc_o.png" alt="5600be5929d140258a8264ece1cdce8c.png"></p> 
<p> </p> 
<p>阅读完芯片手册与原理图下面在驱动进行上电操作，首先还是在设备树配置对应的GPIO：</p> 
<p><img src="https://images2.imgbox.com/06/31/pCHn16J2_o.png" alt="f665327faa904ecf9804d99928105c1d.png"></p> 
<p> 接下来添加驱动并且解析对应GPIO再按照时序上电，相关代码就不贴，和9211的是一样的，这一步最主要的还是I2C要调通，后面都相对简单。</p> 
<p> </p> 
<h2>二、屏幕的配置</h2> 
<p>这一部分主要讲4k屏幕的配置与1080p的区别，9611uxc最多可以支持4k60 fps的显示，所以向下可以兼容1080p60 fps和720p60 fps，AP的4k MIPI参数配置如下：</p> 
<h3>（1）AP</h3> 
<pre><code>/* Copyright (c) 2015-2017, The Linux Foundation. All rights reserved.
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License version 2 and
 * only version 2 as published by the Free Software Foundation.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 */

&amp;mdss_mdp {
	dsi_lt9611_4k_video: qcom,mdss_dsi_lt9611_4k_video {
		qcom,mdss-dsi-panel-name ="lt9611 video mode dsi panel without DSC";
 		qcom,mdss-dsi-panel-type = "dsi_video_mode";
 		qcom,mdss-dsi-virtual-channel-id = &lt;0&gt;;
 		qcom,mdss-dsi-stream = &lt;0&gt;;
 		qcom,mdss-dsi-bpp = &lt;24&gt;;
 		qcom,mdss-dsi-border-color = &lt;0&gt;;
 		qcom,mdss-dsi-traffic-mode = "burst_mode";
 		qcom,mdss-dsi-bllp-eof-power-mode;
		qcom,mdss-dsi-bllp-power-mode;
 		qcom,mdss-dsi-lane-0-state;
 		qcom,mdss-dsi-lane-1-state;
		qcom,mdss-dsi-lane-2-state;
		qcom,mdss-dsi-lane-3-state;
 		qcom,mdss-dsi-dma-trigger = "trigger_sw";
 		qcom,mdss-dsi-mdp-trigger = "none";
		qcom,mdss-dsi-reset-sequence = &lt;1 200&gt;, &lt;0 200&gt;, &lt;1 200&gt;;
		qcom,mdss-pan-physical-width-dimension = &lt;167&gt;;
		qcom,mdss-pan-physical-height-dimension = &lt;131&gt;;
		qcom,mdss-dsi-tx-eot-append;
		qcom,adjust-timer-wakeup-ms = &lt;1&gt;;
		qcom,mdss-dsi-panel-peak-brightness = &lt;4200000&gt;;
		qcom,mdss-dsi-panel-blackness-level = &lt;3230&gt;;

		qcom,mdss-dsi-display-timings {
			timing@0{
				qcom,mdss-dsi-panel-width = &lt;1920&gt;;
				qcom,mdss-dsi-panel-height = &lt;2160&gt;;
				qcom,mdss-dsi-h-front-porch = &lt;176&gt;;
				qcom,mdss-dsi-h-back-porch = &lt;298&gt;;
				qcom,mdss-dsi-h-pulse-width = &lt;88&gt;;
				qcom,mdss-dsi-h-sync-skew = &lt;0&gt;;
				qcom,mdss-dsi-v-back-porch = &lt;72&gt;;
				qcom,mdss-dsi-v-front-porch = &lt;8&gt;;
				qcom,mdss-dsi-v-pulse-width = &lt;10&gt;;
				qcom,mdss-dsi-h-sync-pulse = &lt;0&gt;;
				qcom,mdss-dsi-panel-framerate = &lt;60&gt;;
				qcom,mdss-dsi-on-command = [
					05 01 00 00 78 00 02 11 00
					05 01 00 00 78 00 02 29 00
					];
				qcom,mdss-dsi-off-command = [05 01 00 00 78 00 02 28 00 
						05 01 00 00 14 00 02 10 00];
				qcom,mdss-dsi-on-command-state = "dsi_lp_mode";
				qcom,mdss-dsi-off-command-state = "dsi_hs_mode";
        qcom,mdss-dsi-force-clock-lane-hs;
			};
		};
 	};
 };</code></pre> 
<p>需要注意的是这里的width不是3840而是1920，因为9611uxc的输出是分两路port，也就是可以理解为一个4k屏幕是两个小屏拼凑出来的，而小屏的分辨率是1920x2160，一路port显示左半边一路显示右半边，当驱动来加载这里的参数时并且配置为两路port后会自动拼接，在这里只需要这样配置就可以了。</p> 
<p>下面是配置背光以及kernel屏幕选择的设备树：</p> 
<p>背光添加：</p> 
<pre><code>&amp;dsi_lt9611_1080p_video {
	qcom,panel-supply-entries = &lt;&amp;dsi_panel_pwr_supply&gt;;
	qcom,mdss-dsi-bl-pmic-control-type = "bl_ctrl_wled";
	qcom,mdss-dsi-bl-min-level = &lt;1&gt;;
	qcom,mdss-dsi-bl-max-level = &lt;4095&gt;;
	qcom,mdss-dsi-mode-sel-gpio-state = "dual_port";
	qcom,panel-mode-gpio = &lt;&amp;tlmm 99 0&gt;;
	qcom,platform-reset-gpio = &lt;&amp;tlmm 100 0&gt;;
};

&amp;dsi_lt9611_4k_video {
	qcom,panel-supply-entries = &lt;&amp;dsi_panel_pwr_supply&gt;;
	qcom,mdss-dsi-bl-pmic-control-type = "bl_ctrl_wled";
	qcom,mdss-dsi-bl-min-level = &lt;1&gt;;
	qcom,mdss-dsi-bl-max-level = &lt;4095&gt;;
	qcom,mdss-dsi-mode-sel-gpio-state = "dual_port";
	qcom,panel-mode-gpio = &lt;&amp;tlmm 99 0&gt;;
	qcom,platform-reset-gpio = &lt;&amp;tlmm 100 0&gt;;
};


&amp;dsi_lt9611_720p_video {
	qcom,panel-supply-entries = &lt;&amp;dsi_panel_pwr_supply&gt;;
	qcom,mdss-dsi-bl-pmic-control-type = "bl_ctrl_wled";
	qcom,mdss-dsi-bl-min-level = &lt;1&gt;;
	qcom,mdss-dsi-bl-max-level = &lt;4095&gt;;
	qcom,mdss-dsi-mode-sel-gpio-state = "dual_port";
	qcom,panel-mode-gpio = &lt;&amp;tlmm 99 0&gt;;
	qcom,platform-reset-gpio = &lt;&amp;tlmm 100 0&gt;;
};</code></pre> 
<p> 这边的reset脚和panel mode脚需要根据平台配置，另外在使用9611uxc时sel gpio state需要配置为dual_port代表两路port输出。</p> 
<p>设置可选择显示的屏幕以及时钟pin脚等参数：</p> 
<pre><code>dsi_lt9611_1080p_video_display: qcom,dsi-display@21 {
		compatible = "qcom,dsi-display";
		label = "dsi_lt9611_1080p_video_display";
		qcom,display-type = "primary";

		qcom,dsi-ctrl = &lt;&amp;mdss_dsi0 &amp;mdss_dsi1&gt;;
		qcom,dsi-phy = &lt;&amp;mdss_dsi_phy0 &amp;mdss_dsi_phy1&gt;;
		clocks = &lt;&amp;mdss_dsi0_pll BYTECLK_MUX_0_CLK&gt;,
			&lt;&amp;mdss_dsi0_pll PCLK_MUX_0_CLK&gt;;
		clock-names = "mux_byte_clk", "mux_pixel_clk";

		pinctrl-names = "panel_active", "panel_suspend";
		pinctrl-0 = &lt;&amp;sde_dsi_active &amp;sde_te_active&gt;;
		pinctrl-1 = &lt;&amp;sde_dsi_suspend &amp;sde_te_suspend&gt;;
		qcom,platform-te-gpio = &lt;&amp;tlmm 10 0&gt;;
		qcom,platform-reset-gpio = &lt;&amp;tlmm 6 0&gt;;
		qcom,panel-mode-gpio = &lt;&amp;tlmm 52 0&gt;;

		qcom,dsi-panel = &lt;&amp;dsi_lt9611_1080p_video&gt;;
		vddio-supply = &lt;&amp;pm8998_l14&gt;;
		lab-supply = &lt;&amp;lab_regulator&gt;;
		ibb-supply = &lt;&amp;ibb_regulator&gt;;
	};

	dsi_lt9611_4k_video_display: qcom,dsi-display@22 {
		compatible = "qcom,dsi-display";
		label = "dsi_lt9611_4k_video_display";
		qcom,display-type = "primary";

		qcom,dsi-ctrl = &lt;&amp;mdss_dsi0 &amp;mdss_dsi1&gt;;
		qcom,dsi-phy = &lt;&amp;mdss_dsi_phy0 &amp;mdss_dsi_phy1&gt;;
		clocks = &lt;&amp;mdss_dsi0_pll BYTECLK_MUX_0_CLK&gt;,
			&lt;&amp;mdss_dsi0_pll PCLK_MUX_0_CLK&gt;;
		clock-names = "mux_byte_clk", "mux_pixel_clk";

		pinctrl-names = "panel_active", "panel_suspend";
		pinctrl-0 = &lt;&amp;sde_dsi_active &amp;sde_te_active&gt;;
		pinctrl-1 = &lt;&amp;sde_dsi_suspend &amp;sde_te_suspend&gt;;
		qcom,platform-te-gpio = &lt;&amp;tlmm 10 0&gt;;
		qcom,platform-reset-gpio = &lt;&amp;tlmm 6 0&gt;;
		qcom,panel-mode-gpio = &lt;&amp;tlmm 52 0&gt;;

		qcom,dsi-panel = &lt;&amp;dsi_lt9611_4k_video&gt;;
		vddio-supply = &lt;&amp;pm8998_l14&gt;;
		lab-supply = &lt;&amp;lab_regulator&gt;;
		ibb-supply = &lt;&amp;ibb_regulator&gt;;
	};


	dsi_lt9611_720p_video_display: qcom,dsi-display@20 {
		compatible = "qcom,dsi-display";
		label = "dsi_lt9611_720p_video_display";
		qcom,display-type = "primary";

		qcom,dsi-ctrl = &lt;&amp;mdss_dsi0 &amp;mdss_dsi1&gt;;
		qcom,dsi-phy = &lt;&amp;mdss_dsi_phy0 &amp;mdss_dsi_phy1&gt;;
		clocks = &lt;&amp;mdss_dsi0_pll BYTECLK_MUX_0_CLK&gt;,
			&lt;&amp;mdss_dsi0_pll PCLK_MUX_0_CLK&gt;;
		clock-names = "mux_byte_clk", "mux_pixel_clk";

		pinctrl-names = "panel_active", "panel_suspend";
		pinctrl-0 = &lt;&amp;sde_dsi_active &amp;sde_te_active&gt;;
		pinctrl-1 = &lt;&amp;sde_dsi_suspend &amp;sde_te_suspend&gt;;
		qcom,platform-te-gpio = &lt;&amp;tlmm 10 0&gt;;
		qcom,platform-reset-gpio = &lt;&amp;tlmm 6 0&gt;;
		qcom,panel-mode-gpio = &lt;&amp;tlmm 52 0&gt;;

		qcom,dsi-panel = &lt;&amp;dsi_lt9611_720p_video&gt;;
		vddio-supply = &lt;&amp;pm8998_l14&gt;;
		lab-supply = &lt;&amp;lab_regulator&gt;;
		ibb-supply = &lt;&amp;ibb_regulator&gt;;
	};</code></pre> 
<p>计算时序并配置：</p> 
<pre><code>&amp;dsi_lt9611_1080p_video {
	qcom,mdss-dsi-t-clk-post = &lt;0x0A&gt;;  //1920x2160 60 4lane
	qcom,mdss-dsi-t-clk-pre = &lt;0x20&gt;;   //1920x2160 60 4lane
	qcom,mdss-dsi-display-timings {
		timing@0{
			qcom,mdss-dsi-panel-phy-timings = [00 13 04 04 1F 1E 05    
				05 03 02 04 00];
			qcom,display-topology = &lt;2 0 2&gt;,&lt;1 0 2&gt;;
			qcom,default-topology-index = &lt;0&gt;;
		};
	};
};


&amp;dsi_lt9611_720p_video {
	qcom,mdss-dsi-t-clk-post = &lt;0x09&gt;;  //640x720 60 4lane
	qcom,mdss-dsi-t-clk-pre = &lt;0x17&gt;;
	qcom,mdss-dsi-display-timings {
		timing@0{
			qcom,mdss-dsi-panel-phy-timings = [00 0c 03 03 1d 1d 03    
				03 01 02 04 00];
			qcom,display-topology = &lt;2 0 2&gt;,&lt;1 0 2&gt;;
			qcom,default-topology-index = &lt;0&gt;;
		};
	};
};


&amp;dsi_lt9611_4k_video {
	qcom,mdss-dsi-t-clk-post = &lt;0x15&gt;;  //1920x2160 60 4lane
	qcom,mdss-dsi-t-clk-pre = &lt;0x30&gt;;   //1920x2160 60 4lane
	qcom,mdss-dsi-display-timings {
		timing@0{
			qcom,mdss-dsi-panel-phy-timings = [00 3E 11 11 30 2C 11    
				11 0C 02 04 00];
			qcom,display-topology = &lt;2 2 2&gt;;
			qcom,default-topology-index = &lt;0&gt;;
		};
	};
};</code></pre> 
<p>这一部分需要注意1080p与4k配置的区别，如分辨率1080p是正常配置而4k则需要将宽度减小一半并且时序也是用缩小的分辨率来计算。还需要注意display-topology这一项参数，官方文档给出的配置为4k应设置&lt;2 2 2&gt;.</p> 
<p>如果需要添加pinctrl，先在pinctrl文件添加对应GPIO再引用。</p> 
<p> </p> 
<h3>（2）BP</h3> 
<p>BP的配置很简单，在MDDPlatformLib.c文件中添加三个不同分辨率的xml常量，再在.h文件添加你想要显示的三块屏幕，最后在逻辑代码中修改选择显示的屏幕即可，参考9211修改或者之前的提交记录即可。</p> 
<p> </p> 
<h2>三、总结</h2> 
<p>本文大概介绍了9611与9611uxc的调试办法，很多细节在点亮LCD与LVDS的时候都已经写过了，如果有比较模糊的地方可以参考LVDS与LCD的调试文档，关于I2C的权限问题在GPIO的文档中也提过，但是在此之前的文章中没有具体介绍如何调试I2C与定位屏幕不显示的问题，在下一篇中将根据个人调试经验详细介绍I2C与屏幕不显示的调试办法。</p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ed7306bf22077142d34314f2e9d429d3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java反射异常报错解决：java.lang.NoSuchFieldException</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7c4d54d511ac7fa0359bf024244642c7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue3 ＜script setup＞下reactive用法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>