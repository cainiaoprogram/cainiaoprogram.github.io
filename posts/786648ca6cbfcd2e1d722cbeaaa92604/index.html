<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>torch训练gpu利用率不高 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="torch训练gpu利用率不高" />
<meta property="og:description" content="GPU的显存占用和算力利用直接影响模型的训练速度
显存一直占用，但是显卡使用率大多数情况为0
GPU利用率低问题
1.提高线程数
2.打开pin_memory
# 在pytorch 加载数据时提高线程数，打开pin_memory torch.utils.data.DataLoader(image_datasets[x], batch_size=batch_size, shuffle=True, num_workers=8, pin_memory=True) 3.数据预处理占用比较久
mmdetection中yolov3的数据预处理
# dict( # type=&#39;Expand&#39;, # mean=img_norm_cfg[&#39;mean&#39;], # to_rgb=img_norm_cfg[&#39;to_rgb&#39;], # ratio_range=(1, 2)), # dict( # type=&#39;MinIoURandomCrop&#39;, # min_ious=(0.4, 0.5, 0.6, 0.7, 0.8, 0.9), # min_crop_size=0.3), 这部分注释掉会比较快
暂时不知道如何处理
参考链接：
模型训练 GPU利用率低，占用低怎么破_vmare gpu使用低_Dennis-Ning的博客-CSDN博客
Images normalization using too much cpu during inference · Issue #4488 · open-mmlab/mmdetection · GitHub
yolov5训练加速--一个可能忽视的细节（mmdetection也一样），为什么显卡使用率老是为0？_kv1830的博客-CSDN博客
深度学习训练时GPU利用率忽高忽低如何解决？ - 知乎 (zhihu.com)
【深度学习】踩坑日记：模型训练速度过慢，GPU利用率低_模型跑的慢的原因-CSDN博客
深度强化学习遇到问题：模型训练速度过慢、GPU利用率较低，CPU利用率很低问题总结与分析。 - 知乎 (zhihu." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/786648ca6cbfcd2e1d722cbeaaa92604/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-12T19:45:24+08:00" />
<meta property="article:modified_time" content="2023-10-12T19:45:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">torch训练gpu利用率不高</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>GPU的显存占用和算力利用直接影响模型的训练速度</p> 
<p>显存一直占用，但是显卡使用率大多数情况为0</p> 
<p><strong>GPU利用率低问题</strong></p> 
<p>1.提高线程数</p> 
<p>2.打开pin_memory</p> 
<pre><code># 在pytorch 加载数据时提高线程数，打开pin_memory
torch.utils.data.DataLoader(image_datasets[x],
                            batch_size=batch_size, 
                            shuffle=True,
                            num_workers=8,
                            pin_memory=True)</code></pre> 
<p>3.数据预处理占用比较久</p> 
<p>mmdetection中yolov3的数据预处理</p> 
<pre><code>    # dict(
    #     type='Expand',
    #     mean=img_norm_cfg['mean'],
    #     to_rgb=img_norm_cfg['to_rgb'],
    #     ratio_range=(1, 2)),
    # dict(
    #     type='MinIoURandomCrop',
    #     min_ious=(0.4, 0.5, 0.6, 0.7, 0.8, 0.9),
    #     min_crop_size=0.3),</code></pre> 
<p>这部分注释掉会比较快</p> 
<p><br> 暂时不知道如何处理</p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p></p> 
<p>参考链接：</p> 
<p><a href="https://blog.csdn.net/weixin_45456178/article/details/125635061" title="模型训练 GPU利用率低，占用低怎么破_vmare gpu使用低_Dennis-Ning的博客-CSDN博客">模型训练 GPU利用率低，占用低怎么破_vmare gpu使用低_Dennis-Ning的博客-CSDN博客</a><br><a href="https://github.com/open-mmlab/mmdetection/issues/4488" title="Images normalization using too much cpu during inference · Issue #4488 · open-mmlab/mmdetection · GitHub">Images normalization using too much cpu during inference · Issue #4488 · open-mmlab/mmdetection · GitHub</a></p> 
<p><a href="https://blog.csdn.net/ogebgvictor/article/details/129784503" title="yolov5训练加速--一个可能忽视的细节（mmdetection也一样），为什么显卡使用率老是为0？_kv1830的博客-CSDN博客">yolov5训练加速--一个可能忽视的细节（mmdetection也一样），为什么显卡使用率老是为0？_kv1830的博客-CSDN博客</a><br><a href="https://www.zhihu.com/question/443462237#:~:text=1%20I%2FO%E7%8A%B6%E6%80%81%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%90%9E%E5%90%90%E6%85%A2%EF%BC%8C%E4%BB%8E%E7%A3%81%E7%9B%98%E5%88%B0CPU%E6%97%B6%E9%97%B4%E9%95%BF%E3%80%82%202%20%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86,%EF%BC%9ACPU%E9%A2%84%E5%A4%84%E7%90%86%E5%A4%AA%E9%95%BF%EF%BC%8CGPU%E7%A9%BA%E9%97%B2%E3%80%82%203%20%E7%BD%91%E7%BB%9C%E6%9C%AC%E8%BA%AB%EF%BC%9A%E6%95%B0%E6%8D%AE%E9%87%8F%E5%B0%8F%EF%BC%8C%E5%BE%AA%E7%8E%AF%E5%A4%9A%EF%BC%88%E5%AF%BC%E8%87%B4%E6%95%B0%E6%8D%AE%E6%90%AC%E8%BF%90%E5%B7%A5%E4%BD%9C%E5%A4%AA%E5%A4%9A%EF%BC%89%204%20%E5%A4%9A%E5%8D%A1%E6%A3%80%E6%9F%A5%E9%80%9A%E4%BF%A1%E7%8A%B6%E6%80%81%E3%80%82" rel="nofollow" title="深度学习训练时GPU利用率忽高忽低如何解决？ - 知乎 (zhihu.com)">深度学习训练时GPU利用率忽高忽低如何解决？ - 知乎 (zhihu.com)</a><br><a href="https://blog.csdn.net/swocky/article/details/105922049" title="【深度学习】踩坑日记：模型训练速度过慢，GPU利用率低_模型跑的慢的原因-CSDN博客">【深度学习】踩坑日记：模型训练速度过慢，GPU利用率低_模型跑的慢的原因-CSDN博客</a><br><a href="https://zhuanlan.zhihu.com/p/592242473#:~:text=%E4%B8%BA%E4%BA%86%E6%8F%90%E9%AB%98%E5%88%A9%E7%94%A8%E7%8E%87%EF%BC%8C,%E7%82%B9%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E6%97%B6%E9%97%B4%E3%80%82" rel="nofollow" title="深度强化学习遇到问题：模型训练速度过慢、GPU利用率较低，CPU利用率很低问题总结与分析。 - 知乎 (zhihu.com)">深度强化学习遇到问题：模型训练速度过慢、GPU利用率较低，CPU利用率很低问题总结与分析。 - 知乎 (zhihu.com)</a></p> 
<p><a href="https://www.cvmart.net/community/detail/4483" rel="nofollow" title="https://www.cvmart.net/community/detail/4483">https://www.cvmart.net/community/detail/4483</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/665836c0b1e92bbea71d1e1c500a95af/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">LaTeX 调整行距、列宽，以及表格的整体大小和字体大小</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cb3033411c541ceaf7bf136e8316b223/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MySQL 2 环境搭建（MySQL5.7.43和8.0.34的下载；8.0.34的安装、配置教程 ）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>