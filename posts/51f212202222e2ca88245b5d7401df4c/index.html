<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>某鹅通js逆向 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="某鹅通js逆向" />
<meta property="og:description" content="群里一直有小伙伴，不知道咋下载某鹅通的视频，这里说一下我的逆向过程（开始那个某利威的确实不怎么详细，逻辑也很胡乱，主要是我不知道有挺多小伙伴需要这个，我当时就随便写写，记录一下，也没想有多少人看）
1.首先找m3u8链接 这里我们直接抓包，可以看到，这个m3u8链接
这个抓包过程就不赘述了，我们看一下这个m3u8的返回。
可以看到，这个返回的是一串字符，看来是加密的。
2.寻找解密代码 这个m3u8文本是加密的，但是他肯定要解密后才能进行解析，所以，我们要找到他的解密代码。这里对这个m3u8解密视频的key下一个断点。
就是这个链接。
查看一下他的发起程序。
可以看到一个loadkey，既然已经loadkey了，那肯定在这个之前就已经解密完成了，我们再往下移一下看看。
可以看到这个loadsuccess，这个很可疑。点进入看一下。
可以看到这样的代码，很熟悉，应该是对m3u8文件进行解析。看来解密不远了。先打结果断点。断住看看。
断住过后，找到这个解密函数，是这个D.decrypt，输出一下这个t.data。可以看到。
就是没解密的数据，而 D.decrypt(t.data)就是解密后的数据。
3.进入D.decryp函数 进入到decrypt函数，可以看到这些东西，乍一看，人都麻了，这一定是混淆了吧？头都大了，殊不知，这都是障眼法。他是直接运行了这样一行代码。
return t[y[1] &#43; m[54] &#43; y[9] &#43; y[32] &#43; y[26] &#43; m[50] &#43; y[10]](y[24] &#43; v[50] &#43; v[2]) &gt; -1 ? (t = (t = (t = (t = (t = t[y[27] &#43; m[34] &#43; v[29] &#43; y[58] &#43; m[58] &#43; y[30] &#43; y[32]](m[27] &#43; m[42] &#43; v[2], &#34;&#34;))[y[27] &#43; y[32] &#43; m[17] &#43; y[58] &#43; m[58] &#43; y[30] &#43; m[34]](/@/g, y[35]))[m[60] &#43; y[32] &#43; y[19] &#43; m[55] &#43; y[12] &#43; y[30] &#43; y[32]](/#/g, m[44]))[m[60] &#43; m[34] &#43; v[29] &#43; m[55] &#43; v[2] &#43; y[30] &#43; v[8]](/\$/g, y[48]))[v[58] &#43; v[8] &#43; y[19] &#43; v[53] &#43; m[58] &#43; y[30] &#43; v[8]](/%/g, v[11]),I(O(t))) : t return了一个值，判断ty[1] &#43; m[54] &#43; y[9] &#43; y[32] &#43; y[26] &#43; m[50] &#43; y[10]是否大于-1，如果不大于，就直接返回t，大于则执行，" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/51f212202222e2ca88245b5d7401df4c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-20T16:32:14+08:00" />
<meta property="article:modified_time" content="2022-05-20T16:32:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">某鹅通js逆向</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>群里一直有小伙伴，不知道咋下载某鹅通的视频，这里说一下我的逆向过程（开始那个某利威的确实不怎么详细，逻辑也很胡乱，主要是我不知道有挺多小伙伴需要这个，我当时就随便写写，记录一下，也没想有多少人看）</strong></p> 
<h3>1.首先找m3u8链接</h3> 
<p>这里我们直接抓包，可以看到，这个m3u8链接</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/a9/b6/ihvkGXmK_o.png"></p> 
<p></p> 
<p>这个抓包过程就不赘述了，我们看一下这个m3u8的返回。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/dc/72/MfsNE9ay_o.png"></p> 
<p>可以看到，这个返回的是一串字符，看来是加密的。</p> 
<h3>2.寻找解密代码</h3> 
<p>这个m3u8文本是加密的，但是他肯定要解密后才能进行解析，所以，我们要找到他的解密代码。这里对这个m3u8解密视频的key下一个断点。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/67/58/ZzVhkkDC_o.png"></p> 
<p>就是这个链接。</p> 
<p>查看一下他的发起程序。</p> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/b2/34/dPfKdseJ_o.png"></p> 
<p>可以看到一个loadkey，既然已经loadkey了，那肯定在这个之前就已经解密完成了，我们再往下移一下看看。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/4d/d9/FCY7nubq_o.png"></p> 
<p>可以看到这个loadsuccess，这个很可疑。点进入看一下。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/1e/99/e7jKbW8s_o.png"></p> 
<p>可以看到这样的代码，很熟悉，应该是对m3u8文件进行解析。看来解密不远了。先打结果断点。断住看看。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/38/2b/ZFv9suoj_o.png"></p> 
<p>断住过后，找到这个解密函数，是这个D.decrypt，输出一下这个t.data。可以看到。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/04/98/E7GoHVKn_o.png"></p> 
<p>就是没解密的数据，而 D.decrypt(t.data)就是解密后的数据。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/3b/1c/tqzEO6Wj_o.png"></p> 
<h4>3.进入D.decryp函数</h4> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/09/fd/cor0FvL8_o.png"></p> 
<p>进入到decrypt函数，可以看到这些东西，乍一看，人都麻了，这一定是混淆了吧？头都大了，殊不知，这都是障眼法。他是直接运行了这样一行代码。</p> 
<pre>return t[y[1] + m[54] + y[9] + y[32] + y[26] + m[50] + y[10]](y[24] + v[50] + v[2]) &gt; -1 ? (t = (t = (t = (t = (t = t[y[27] + m[34] + v[29] + y[58] + m[58] + y[30] + y[32]](m[27] + m[42] + v[2], ""))[y[27] + y[32] + m[17] + y[58] + m[58] + y[30] + m[34]](/@/g, y[35]))[m[60] + y[32] + y[19] + m[55] + y[12] + y[30] + y[32]](/#/g, m[44]))[m[60] + m[34] + v[29] + m[55] + v[2] + y[30] + v[8]](/\$/g, y[48]))[v[58] + v[8] + y[19] + v[53] + m[58] + y[30] + v[8]](/%/g, v[11]),I(O(t))) : t</pre> 
<p>return了一个值，判断ty[1] + m[54] + y[9] + y[32] + y[26] + m[50] + y[10]是否大于-1，如果不大于，就直接返回t，大于则执行，</p> 
<p>(t = (t = (t = (t = (t = ty[27] + m[34] + v[29] + y[58] + m[58] + y[30] + y[32])y[27] + y[32] + m[17] + y[58] + m[58] + y[30] + m[34])m[60] + y[32] + y[19] + m[55] + y[12] + y[30] + y[32])m[60] + m[34] + v[29] + m[55] + v[2] + y[30] + v[8])v[58] + v[8] + y[19] + v[53] + m[58] + y[30] + v[8], I(O(t)))这一行代码。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/81/ff/LxCOP1oX_o.png"></p> 
<p>在控制台输出一下，可以看到y,m,v都是定值，他是从里面选字母，组成单词，对t进行解密。</p> 
<p>解密后的代码是这样的。</p> 
<pre>(t = (t = (t = (t = (t = t.replace("_ba", "")).replace(/@/g, 1)).replace(/#/g, 2)).replace(/\$/g, 3)).replace(/%/g, 4))
const buff = Buffer.from(t, 'base64');
const str = buff.toString('utf-8');</pre> 
<p>先移除一些关键词，在对结果对base64解码。就可以得到解密后的m3u8文本了。</p> 
<h4>4.请求m3u8文本</h4> 
<p>这里有一点要注意，请求链接的时候要带上<strong>referer</strong>和<strong>origin</strong>，某鹅通对这个有检测。这里你就可以请求视频下载了。</p> 
<p>这个总体还是很简单的。可以作为练手。</p> 
<p><strong>有啥问题加群：342096685</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fc64dee12af909391700ecc59a8ad448/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Gradle 和插件这两者的最新版本</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f6249aa286fc9119a9708d819cd4d55e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ES查询语法总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>