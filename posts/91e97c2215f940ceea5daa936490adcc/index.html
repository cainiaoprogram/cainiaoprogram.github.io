<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>大话 JavaScript（Speaking JavaScript）：第十一章到第十五章 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="大话 JavaScript（Speaking JavaScript）：第十一章到第十五章" />
<meta property="og:description" content="第十一章：数字 原文：11. Numbers
译者：飞龙
协议：CC BY-NC-SA 4.0
JavaScript 对所有数字都使用单一类型：它将它们全部视为浮点数。但是，如果小数点后没有数字，则不显示小数点：
&gt; 5.000 5 在内部，大多数 JavaScript 引擎都会优化并区分浮点数和整数（详情请参见JavaScript 中的整数）。但这是程序员看不到的东西。
JavaScript 数字是基于 IEEE 浮点算术标准（IEEE 754）的double（64 位）值。该标准被许多编程语言使用。
数字文字 数字文字可以是整数、浮点数或（整数）十六进制：
&gt; 35 // integer 35 &gt; 3.141 // floating point 3.141 &gt; 0xFF // hexadecimal 255 指数 指数eX是“乘以 10^X”的缩写：
&gt; 5e2 500 &gt; 5e-2 0.05 &gt; 0.5e2 50 在文字上调用方法 对于数字文字，访问属性的点必须与小数点区分开。如果要在数字文字123上调用toString()，则有以下选项：
123..toString() 123 .toString() // space before the dot 123.0.toString() (123).toString() 转换为数字 将值转换为数字的方式如下：
值结果undefinedNaNnull0布尔值false → 0true → 1数字与输入相同（无需转换）字符串解析字符串中的数字（忽略前导和尾随空格）；空字符串转换为 0。示例：&#39;3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/91e97c2215f940ceea5daa936490adcc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-11T12:23:38+08:00" />
<meta property="article:modified_time" content="2024-01-11T12:23:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">大话 JavaScript（Speaking JavaScript）：第十一章到第十五章</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_1"></a>第十一章：数字</h3> 
<blockquote> 
 <p>原文：<a href="https://exploringjs.com/es5/ch11.html" rel="nofollow">11. Numbers</a></p> 
 <p>译者：<a href="https://github.com/wizardforcel">飞龙</a></p> 
 <p>协议：<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="nofollow">CC BY-NC-SA 4.0</a></p> 
</blockquote> 
<p>JavaScript 对所有数字都使用单一类型：它将它们全部视为浮点数。但是，如果小数点后没有数字，则不显示小数点：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">5.000</span>
<span class="token number">5</span>
</code></pre> 
<p>在内部，大多数 JavaScript 引擎都会优化并区分浮点数和整数（详情请参见<a href="ch11.html#integers" rel="nofollow" title="JavaScript 中的整数">JavaScript 中的整数</a>）。但这是程序员看不到的东西。</p> 
<p>JavaScript 数字是基于 IEEE 浮点算术标准（IEEE 754）的<code>double</code>（64 位）值。该标准被许多编程语言使用。</p> 
<h3><a id="_21"></a>数字文字</h3> 
<p>数字文字可以是整数、浮点数或（整数）十六进制：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">35</span>  <span class="token comment">// integer</span>
<span class="token number">35</span>
<span class="token operator">&gt;</span> <span class="token number">3.141</span>  <span class="token comment">// floating point</span>
<span class="token number">3.141</span>
<span class="token operator">&gt;</span> <span class="token number">0xFF</span>  <span class="token comment">// hexadecimal</span>
<span class="token number">255</span>
</code></pre> 
<h4><a id="_34"></a>指数</h4> 
<p>指数<code>eX</code>是“乘以 10^X”的缩写：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">5e2</span>
<span class="token number">500</span>
<span class="token operator">&gt;</span> <span class="token number">5e-2</span>
<span class="token number">0.05</span>
<span class="token operator">&gt;</span> <span class="token number">0.5e2</span>
<span class="token number">50</span>
</code></pre> 
<h4><a id="_47"></a>在文字上调用方法</h4> 
<p>对于数字文字，访问属性的点必须与小数点区分开。如果要在数字文字<code>123</code>上调用<code>toString()</code>，则有以下选项：</p> 
<pre><code class="prism language-js"><span class="token number">123.</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">123</span> <span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// space before the dot</span>
<span class="token number">123.0</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_58"></a>转换为数字</h3> 
<p>将值转换为数字的方式如下：</p> 
<table><thead><tr><th>值</th><th>结果</th></tr></thead><tbody><tr><td><code>undefined</code></td><td><code>NaN</code></td></tr><tr><td><code>null</code></td><td><code>0</code></td></tr><tr><td>布尔值</td><td><code>false</code> → <code>0</code></td></tr><tr><td></td><td><code>true</code> → <code>1</code></td></tr><tr><td>数字</td><td>与输入相同（无需转换）</td></tr><tr><td>字符串</td><td>解析字符串中的数字（忽略前导和尾随空格）；空字符串转换为 0。示例：<code>'3.141'</code> → <code>3.141</code></td></tr><tr><td>对象</td><td>调用<code>ToPrimitive(value, Number)</code>（参见<a href="ch08.html#toprimitive" rel="nofollow" title="算法：ToPrimitive()—将值转换为原始值">算法：ToPrimitive()—将值转换为原始值</a>）并转换生成的原始值。</td></tr></tbody></table> 
<p>将空字符串转换为数字时，<code>NaN</code>可能是更好的结果。选择结果 0 是为了帮助处理空的数字输入字段，符合 1990 年代中期其他编程语言的做法。¹²</p> 
<h4><a id="_74"></a>手动转换为数字</h4> 
<p>将任何值转换为数字的两种最常见方法是：</p> 
<table><thead><tr><th><code>Number(value)</code></th><th>（作为函数调用，而不是作为构造函数调用）</th></tr></thead><tbody><tr><td><code>+value</code></td><td></td></tr></tbody></table> 
<p>我更喜欢<code>Number()</code>，因为它更具描述性。以下是一些示例：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token number">0</span>
<span class="token operator">&gt;</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span>
<span class="token number">123</span>
<span class="token operator">&gt;</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">'\t\v\r12.34\n '</span><span class="token punctuation">)</span>  <span class="token comment">// ignores leading and trailing whitespace</span>
<span class="token number">12.34</span>

<span class="token operator">&gt;</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token number">0</span>
<span class="token operator">&gt;</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token number">1</span>
</code></pre> 
<h4><a id="parseFloat_98"></a>parseFloat()</h4> 
<p>全局函数<code>parseFloat()</code>提供了另一种将值转换为数字的方法。但是，<code>Number()</code>通常是更好的选择，我们稍后将看到。这段代码：</p> 
<pre><code class="prism language-js"><span class="token function">parseFloat</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
</code></pre> 
<p>将<code>str</code>转换为字符串，修剪前导空格，然后解析最长的浮点数前缀。如果不存在这样的前缀（例如，在空字符串中），则返回<code>NaN</code>。</p> 
<p>比较<code>parseFloat()</code>和<code>Number()</code>：</p> 
<ul><li> <p>将<code>parseFloat()</code>应用于非字符串的效率较低，因为它在解析之前将其参数强制转换为字符串。因此，<code>Number()</code>转换为实际数字的许多值被<code>parseFloat()</code>转换为<code>NaN</code>：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>  <span class="token comment">// same as parseFloat('true')</span>
<span class="token number">NaN</span>
<span class="token operator">&gt;</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token number">1</span>

<span class="token operator">&gt;</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>  <span class="token comment">// same as parseFloat('null')</span>
<span class="token number">NaN</span>
<span class="token operator">&gt;</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token number">0</span>
</code></pre> </li><li> <p><code>parseFloat()</code>将空字符串解析为<code>NaN</code>：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token number">NaN</span>
<span class="token operator">&gt;</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token number">0</span>
</code></pre> </li><li> <p><code>parseFloat()</code>解析到最后一个合法字符，这意味着您可能会得到一个您不想要的结果：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token string">'123.45#'</span><span class="token punctuation">)</span>
<span class="token number">123.45</span>
<span class="token operator">&gt;</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">'123.45#'</span><span class="token punctuation">)</span>
<span class="token number">NaN</span>
</code></pre> </li><li> <p><code>parseFloat()</code>忽略前导空格，并在非法字符之前停止（其中包括空格）：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token string">'\t\v\r12.34\n '</span><span class="token punctuation">)</span>
<span class="token number">12.34</span>
</code></pre> </li></ul> 
<p><code>Number()</code>忽略前导和尾随空格（但其他非法字符会导致<code>NaN</code>）。</p> 
<h3><a id="_151"></a>特殊数字值</h3> 
<p>JavaScript 有几个特殊的数字值：</p> 
<ul><li> <p>两个错误值，<code>NaN</code>和<code>Infinity</code>。</p> </li><li> <p>两个零值，<code>+0</code>和<code>-0</code>。JavaScript 有两个零，一个正零和一个负零，因为数字的符号和大小存储在不同的位置。在本书的大部分内容中，我假设只有一个零，并且您几乎从不在 JavaScript 中看到有两个零。</p> </li></ul> 
<h4><a id="NaN_159"></a>NaN</h4> 
<p>错误值<code>NaN</code>（“不是一个数字”的缩写）是一个数字值，具有讽刺意味：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token keyword">typeof</span> <span class="token number">NaN</span>
<span class="token string">'number'</span>
</code></pre> 
<p>它是由以下错误产生的：</p> 
<ul><li> <p>无法解析数字：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">'xyz'</span><span class="token punctuation">)</span>
<span class="token number">NaN</span>
<span class="token operator">&gt;</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span>
<span class="token number">NaN</span>
</code></pre> </li><li> <p>操作失败：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">acos</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token number">NaN</span>
<span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token number">NaN</span>
<span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">sqrt</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token number">NaN</span>
</code></pre> </li><li> <p>操作数之一是<code>NaN</code>（这可以确保在较长的计算过程中发生错误时，您可以在最终结果中看到它）：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">NaN</span> <span class="token operator">+</span> <span class="token number">3</span>
<span class="token number">NaN</span>
<span class="token operator">&gt;</span> <span class="token number">25</span> <span class="token operator">/</span> <span class="token number">NaN</span>
<span class="token number">NaN</span>
</code></pre> </li></ul> 
<h5><a id="_NaN_199"></a>陷阱：检查值是否为 NaN</h5> 
<p><code>NaN</code>是唯一不等于自身的值：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">NaN</span> <span class="token operator">===</span> <span class="token number">NaN</span>
<span class="token boolean">false</span>
</code></pre> 
<p>严格相等（<code>===</code>）也被<code>Array.prototype.indexOf</code>使用。因此，您不能通过该方法在数组中搜索<code>NaN</code>：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token number">NaN</span> <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token number">1</span>
</code></pre> 
<p>如果要检查值是否为<code>NaN</code>，则必须使用全局函数<code>isNaN()</code>：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">)</span>
<span class="token boolean">true</span>
<span class="token operator">&gt;</span> <span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">)</span>
<span class="token boolean">false</span>
</code></pre> 
<p>但是，<code>isNaN</code>不能正确处理非数字，因为它首先将它们转换为数字。该转换可能产生<code>NaN</code>，然后该函数错误地返回<code>true</code>：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token string">'xyz'</span><span class="token punctuation">)</span>
<span class="token boolean">true</span>
</code></pre> 
<p>因此，最好将<code>isNaN</code>与类型检查结合使用：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">myIsNaN</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">'number'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isNaN</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>或者，您可以检查值是否不等于自身（因为<code>NaN</code>是唯一具有此特性的值）。但这不够自解释：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">myIsNaN</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> value <span class="token operator">!==</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>请注意，此行为由 IEEE 754 规定。如第 7.11 节“比较谓词的详细信息”中所述：¹³</p> 
<blockquote> 
 <p>每个 NaN 都将与任何东西（包括自身）比较无序。</p> 
</blockquote> 
<h4><a id="Infinity_251"></a>Infinity</h4> 
<p><code>Infinity</code>是一个错误值，指示两个问题中的一个：一个数字无法表示，因为其大小太大，或者发生了除以零。</p> 
<p><code>Infinity</code>大于任何其他数字（除了<code>NaN</code>）。同样，<code>-Infinity</code>小于任何其他数字（除了<code>NaN</code>）。这使它们在默认值方面非常有用，例如，当您正在寻找最小值或最大值时。</p> 
<h5><a id="_257"></a>错误：数字的大小太大</h5> 
<p>一个数字的大小取决于其内部表示（如<a href="ch11.html#number_representation" rel="nofollow" title="数字的内部表示">数字的内部表示</a>中所讨论的），即：</p> 
<ul><li> <p>尾数（一个二进制数 1.f[1]f[2]…）</p> </li><li> <p>指数的 2 次幂</p> </li></ul> 
<p>指数必须在（不包括）-1023 和 1024 之间。如果指数太小，数字变为 0。如果指数太大，它变为<code>Infinity</code>。2¹⁰²³仍然可以表示，但 2¹⁰²⁴不能：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1023</span><span class="token punctuation">)</span>
<span class="token number">8.98846567431158e+307</span>
<span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span>
<span class="token number">Infinity</span>
</code></pre> 
<h5><a id="_274"></a>错误：除以零</h5> 
<p>除以零会产生<code>Infinity</code>作为错误值：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">3</span> <span class="token operator">/</span> <span class="token number">0</span>
<span class="token number">Infinity</span>
<span class="token operator">&gt;</span> <span class="token number">3</span> <span class="token operator">/</span> <span class="token operator">-</span><span class="token number">0</span>
<span class="token operator">-</span><span class="token number">Infinity</span>
</code></pre> 
<h5><a id="_Infinity__285"></a>使用 Infinity 进行计算</h5> 
<p>如果您尝试用另一个<code>Infinity</code>“中和”一个<code>Infinity</code>，则会得到错误结果<code>NaN</code>：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">Infinity</span> <span class="token operator">-</span> <span class="token number">Infinity</span>
<span class="token number">NaN</span>
<span class="token operator">&gt;</span> <span class="token number">Infinity</span> <span class="token operator">/</span> <span class="token number">Infinity</span>
<span class="token number">NaN</span>
</code></pre> 
<p>如果您尝试超出<code>Infinity</code>，您仍然会得到<code>Infinity</code>：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">Infinity</span> <span class="token operator">+</span> <span class="token number">Infinity</span>
<span class="token number">Infinity</span>
<span class="token operator">&gt;</span> <span class="token number">Infinity</span> <span class="token operator">*</span> <span class="token number">Infinity</span>
<span class="token number">Infinity</span>
</code></pre> 
<h5><a id="_Infinity_305"></a>检查 Infinity</h5> 
<p>严格和宽松的相等对<code>Infinity</code>也适用：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">Infinity</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> x <span class="token operator">===</span> <span class="token number">Infinity</span>
<span class="token boolean">true</span>
</code></pre> 
<p>此外，全局函数<code>isFinite()</code>允许您检查一个值是否是一个实际的数字（既不是无穷大也不是<code>NaN</code>）：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">isFinite</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token boolean">true</span>
<span class="token operator">&gt;</span> <span class="token function">isFinite</span><span class="token punctuation">(</span><span class="token number">Infinity</span><span class="token punctuation">)</span>
<span class="token boolean">false</span>
<span class="token operator">&gt;</span> <span class="token function">isFinite</span><span class="token punctuation">(</span><span class="token number">NaN</span><span class="token punctuation">)</span>
<span class="token boolean">false</span>
</code></pre> 
<h4><a id="_326"></a>两个零</h4> 
<p>因为 JavaScript 的数字保持大小和符号分开，每个非负数都有一个负数，包括<code>0</code>。</p> 
<p>这是因为当您以数字的方式表示数字时，它可能变得非常小，以至于无法与 0 区分，因为编码不够精确以表示差异。然后，有符号零允许您记录“从哪个方向”接近零；也就是说，在被视为零之前，数字具有什么符号。维基百科很好地总结了<a href="http://en.wikipedia.org/wiki/Signed_zero" rel="nofollow">有符号零</a>的利弊：</p> 
<blockquote> 
 <p>据称，IEEE 754 中包含有符号零使得在一些关键问题中更容易实现数值精度，特别是在计算复杂的初等函数时。另一方面，有符号零的概念与大多数数学领域（以及大多数数学课程）中的一般假设相矛盾，即负零和零是相同的。允许负零的表示可以成为程序中的错误源，因为软件开发人员没有意识到（或可能忘记了），虽然这两个零表示在数值比较下行为相等，但它们是不同的位模式，并在一些操作中产生不同的结果。</p> 
</blockquote> 
<h5><a id="_334"></a>最佳实践：假装只有一个零</h5> 
<p>JavaScript 竭尽全力隐藏有两个零这一事实。鉴于通常并不重要它们是不同的，建议您配合单个零的幻觉。让我们看看这个幻觉是如何维持的。</p> 
<p>在 JavaScript 中，通常写为<code>0</code>，这意味着<code>+0</code>。但<code>-0</code>也显示为简单的<code>0</code>。这是您在使用浏览器命令行或 Node.js REPL 时看到的情况：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">0</span>
<span class="token number">0</span>
</code></pre> 
<p>这是因为标准的<code>toString()</code>方法将这两个零都转换为相同的<code>'0'</code>：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'0'</span>
<span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'0'</span>
</code></pre> 
<p>相等也无法区分零。甚至<code>===</code>也不行：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token operator">+</span><span class="token number">0</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">0</span>
<span class="token boolean">true</span>
</code></pre> 
<p><code>Array.prototype.indexOf</code>使用<code>===</code>搜索元素，维持了这个幻觉：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">+</span><span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token number">0</span>
<span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token number">0</span>
</code></pre> 
<p>排序运算符也认为这两个零是相等的：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">0</span> <span class="token operator">&lt;</span> <span class="token operator">+</span><span class="token number">0</span>
<span class="token boolean">false</span>
<span class="token operator">&gt;</span> <span class="token operator">+</span><span class="token number">0</span> <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">0</span>
<span class="token boolean">false</span>
</code></pre> 
<h5><a id="_379"></a>区分这两个零</h5> 
<p><em>您</em>如何实际观察到这两个零是不同的？您可以除以零（<code>-Infinity</code>和<code>+Infinity</code>可以通过<code>===</code>进行区分）：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">3</span> <span class="token operator">/</span> <span class="token operator">-</span><span class="token number">0</span>
<span class="token operator">-</span><span class="token number">Infinity</span>
<span class="token operator">&gt;</span> <span class="token number">3</span> <span class="token operator">/</span> <span class="token operator">+</span><span class="token number">0</span>
<span class="token number">Infinity</span>
</code></pre> 
<p>通过<code>Math.pow()</code>（参见<a href="ch21.html#Math.pow" rel="nofollow" title="数值函数">数值函数</a>）进行除以零的另一种方法：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token number">Infinity</span>
<span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token number">Infinity</span>
</code></pre> 
<p><code>Math.atan2()</code>（参见[三角函数](ch21.html#Math.atan2 “Trigonometric Functions”））还显示了这两个零是不同的：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token number">3.141592653589793</span>
<span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span><span class="token operator">+</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token number">3.141592653589793</span>
</code></pre> 
<p>区分这两个零的规范方法是除以零。因此，用于检测负零的函数如下：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">isNegativeZero</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> x <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span>x <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>以下是使用的函数：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">isNegativeZero</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token boolean">false</span>
<span class="token operator">&gt;</span> <span class="token function">isNegativeZero</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token boolean">true</span>
<span class="token operator">&gt;</span> <span class="token function">isNegativeZero</span><span class="token punctuation">(</span><span class="token number">33</span><span class="token punctuation">)</span>
<span class="token boolean">false</span>
</code></pre> 
<h3><a id="_427"></a>数字的内部表示</h3> 
<p>JavaScript 数字具有 64 位精度，也称为<em>双精度</em>（某些编程语言中的<code>double</code>类型）。内部表示基于 IEEE 754 标准。64 位分布在数字的符号、指数和分数之间，如下所示：</p> 
<table><thead><tr><th>符号</th><th>指数 ∈ [−1023, 1024]</th><th>分数</th></tr></thead><tbody><tr><td>1 位</td><td>11 位</td><td>52 位</td></tr><tr><td>位 63</td><td>位 62–52</td><td>位 51–0</td></tr></tbody></table> 
<p>数字的值由以下公式计算：</p> 
<p>(–1)^(sign) × %1.fraction × 2^(exponent)</p> 
<p>前缀百分号（<code>%</code>）表示中间的数字以二进制表示：1，后跟二进制点，后跟二进制分数，即分数的二进制数字（自然数）。以下是此表示的一些示例：</p> 
<table><thead><tr><th>+0</th><th></th><th>（符号：0，小数：0，指数：−1023）</th></tr></thead><tbody><tr><td>–0</td><td></td><td>（符号：1，小数：0，指数：−1023）</td></tr><tr><td>1</td><td>= (−1)⁰ × %1.0 × 2⁰</td><td>（符号：0，小数：0，指数：0）</td></tr><tr><td>2</td><td>= (−1)⁰ × %1.0 × 2¹</td><td></td></tr><tr><td>3</td><td>= (−1)⁰ × %1.1 × 2¹</td><td>（符号：0，小数：2⁵¹，指数：0）</td></tr><tr><td>0.5</td><td>= (−1)⁰ × %1.0 × 2^(−1)</td><td></td></tr><tr><td>−1</td><td>= (−1)¹ × %1.0 × 2⁰</td><td></td></tr></tbody></table> 
<p>+0、−0 和 3 的编码可以解释如下：</p> 
<ul><li> <p>±0：鉴于分数始终以 1 为前缀，因此无法使用它来表示 0。因此，JavaScript 通过分数 0 和特殊指数−1023 来编码零。符号可以是正数或负数，这意味着 JavaScript 有两个零（参见<a href="ch11.html#two_zeros" rel="nofollow" title="Two Zeros">两个零</a>）。</p> </li><li> <p>3：位 51 是分数的最高有效位。该位为 1。</p> </li></ul> 
<h4><a id="_457"></a>特殊指数</h4> 
<p>前面提到的数字表示称为<em>标准化</em>。在这种情况下，指数 <em>e</em> 在范围内 −1023 &lt; <em>e</em> &lt; 1024（不包括下限和上限）。−1023 和 1024 是特殊指数：</p> 
<ul><li> <p>1024 用于<code>NaN</code>和<code>Infinity</code>等错误值。</p> </li><li> <p>−1023 用于：</p> </li><li> <p>零（如果分数为 0，如刚才解释的那样）</p> </li><li> <p>靠近零的小数字（如果分数不为 0）。</p> </li></ul> 
<p>为了同时启用两个应用程序，使用了不同的所谓<em>非标准化</em>表示：</p> 
<p>(–1)^(sign) × %0.fraction × 2^(–1022)</p> 
<p>要比较，标准化表示中最小（即“最接近零”的）数字是：</p> 
<p>(–1)^(sign) × %1.fraction × 2^(–1022)</p> 
<p>非标准化的数字更小，因为没有前导数字 1。</p> 
<h3><a id="_479"></a>处理舍入误差</h3> 
<p>JavaScript 的数字通常以十进制浮点数输入，但在内部表示为二进制浮点数。这导致了不精确。为了理解原因，让我们忘记 JavaScript 的内部存储格式，来看看十进制浮点数和二进制浮点数可以很好地表示哪些分数。在十进制系统中，所有分数都是一个底数 <em>m</em> 除以 10 的幂：</p> 
<p><img src="https://images2.imgbox.com/8f/5e/VgWdO25z_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> 
<p>因此，在分母中只有十。这就是为什么无法将<img src="https://images2.imgbox.com/8f/17/z6QZ9lsN_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传">精确表示为十进制浮点数的原因——无法将 3 放入分母。二进制浮点数中只有二。让我们看看哪些十进制浮点数可以很好地表示为二进制浮点数，哪些不能。如果分母中只有二，那么可以表示十进制数：</p> 
<ul><li> <p>0.5[dec] = <img src="https://images2.imgbox.com/a0/88/L3JbNSgo_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"> = <img src="https://images2.imgbox.com/ba/c7/qVDRrn3d_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"> = 0.1[bin]</p> </li><li> <p>0.75[dec] = <img src="https://images2.imgbox.com/1f/4b/SwDsy7KG_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"> = <img src="https://images2.imgbox.com/5e/fa/wIOhd2aX_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"> = 0.11[bin]</p> </li><li> <p>0.125[dec] = <img src="https://images2.imgbox.com/c0/19/HYg3l268_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"> = <img src="https://images2.imgbox.com/6b/44/23Rug8Le_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"> = 0.001[bin]</p> </li></ul> 
<p>其他分数无法精确表示，因为分母中有 2 以外的数字（经过质因数分解）：</p> 
<ul><li> <p>0.1[dec] = <img src="https://images2.imgbox.com/67/68/hzO0Jgjl_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"> = <img src="https://images2.imgbox.com/95/80/Gw2Ionnq_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> </li><li> <p>0.2[dec] = <img src="https://images2.imgbox.com/4c/54/bfl3RZIh_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"> = <img src="https://images2.imgbox.com/f7/07/6fvIyt2b_o.png" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传"></p> </li></ul> 
<p>通常看不到 JavaScript 内部并未精确存储 0.1。但是，通过将其乘以足够高的 10 的幂，可以使其可见：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">0.1</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">24</span><span class="token punctuation">)</span>
<span class="token number">1.0000000000000001e+23</span>
</code></pre> 
<p>如果将两个不精确表示的数字相加，结果有时会不精确到足以使不精确性变得可见：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span>
<span class="token number">0.30000000000000004</span>
</code></pre> 
<p>另一个例子：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">-</span> <span class="token number">1</span>
<span class="token number">0.10000000000000009</span>
</code></pre> 
<p>由于舍入误差，最好的做法是不直接比较非整数。而是考虑舍入误差的上限。这样的上限称为<a href="http://en.wikipedia.org/wiki/Machine_epsilon" rel="nofollow"><em>机器 epsilon</em></a>。双精度标准 epsilon 值为 2^(−53)：</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> <span class="token constant">EPSILON</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">53</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">epsEqu</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>x <span class="token operator">-</span> y<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token constant">EPSILON</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><code>epsEqu()</code>确保正确的结果，普通比较会不足以满足要求：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span> <span class="token operator">===</span> <span class="token number">0.3</span>
<span class="token boolean">false</span>
<span class="token operator">&gt;</span> <span class="token function">epsEqu</span><span class="token punctuation">(</span><span class="token number">0.1</span><span class="token operator">+</span><span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">)</span>
<span class="token boolean">true</span>
</code></pre> 
<h3><a id="JavaScript__538"></a>JavaScript 中的整数</h3> 
<p>如前所述，JavaScript 只有浮点数。整数在内部以两种方式出现。首先，大多数 JavaScript 引擎将足够小的没有小数部分的数字存储为整数（例如，31 位），并尽可能长时间地保持该表示。如果数字的大小增长太大或出现小数部分，则必须切换回浮点表示。</p> 
<p>其次，ECMAScript 规范具有整数运算符：即所有按位运算符。这些运算符将其操作数转换为 32 位整数并返回 32 位整数。对于规范，<em>整数</em>只意味着数字没有小数部分，<em>32 位</em>意味着它们在某个范围内。对于引擎，<em>32 位整数</em>意味着通常可以引入或保持实际整数（非浮点）表示。</p> 
<h4><a id="_544"></a>整数范围</h4> 
<p>在 JavaScript 中，以下整数范围很重要：</p> 
<ul><li> <p>安全整数（参见<a href="ch11.html#safe_integers" rel="nofollow" title="安全整数">安全整数</a>），JavaScript 支持的最大实用整数范围：</p> </li><li> <p>53 位加上一个符号，范围（−2⁵³, 2⁵³）</p> </li><li> <p>数组索引（参见<a href="ch18.html#array_indices" rel="nofollow" title="数组索引">数组索引</a>）：</p> </li><li> <p>32 位，无符号</p> </li><li> <p>最大长度：2³²−1</p> </li><li> <p>索引范围：[0, 2³²−1)（不包括最大长度！）</p> </li><li> <p>按位操作数（参见<a href="ch11.html#bitwise_operators" rel="nofollow" title="按位运算符">按位运算符</a>）：</p> </li><li> <p>无符号右移运算符(<code>&gt;&gt;&gt;</code>)：32 位，无符号，范围[0, 2³²)</p> </li><li> <p>所有其他按位运算符：32 位，包括符号，范围[−2³¹, 2³¹]</p> </li><li> <p>“字符代码”，UTF-16 代码单元作为数字：</p> </li><li> <p>被<code>String.fromCharCode()</code>接受（参见<a href="ch12.html#String.fromCharCode" rel="nofollow" title="字符串构造方法">字符串构造方法</a>）</p> </li><li> <p>由<code>String.prototype.charCodeAt()</code>返回（参见<a href="ch12.html#String.prototype.charCodeAt" rel="nofollow" title="提取子字符串">提取子字符串</a>）</p> </li><li> <p>16 位，无符号</p> </li></ul> 
<h4><a id="_574"></a>将整数表示为浮点数</h4> 
<p>JavaScript 只能处理最大为 53 位的整数值（52 位的小数部分加上 1 个间接位，通过指数; 有关详细信息，请参见<a href="ch11.html#number_representation" rel="nofollow" title="数字的内部表示">数字的内部表示</a>）。</p> 
<p>以下表格解释了 JavaScript 如何将 53 位整数表示为浮点数：</p> 
<table><thead><tr><th>位</th><th>范围</th><th>编码</th></tr></thead><tbody><tr><td>1 位</td><td>0</td><td>(参见<a href="ch11.html#number_representation" rel="nofollow" title="数字的内部表示">数字的内部表示</a>)</td></tr><tr><td>1 位</td><td>1</td><td>%1 × 2⁰</td></tr><tr><td>2 位</td><td>2–3</td><td>%1.f[51] × 2¹</td></tr><tr><td>3 位</td><td>4–7 = 2²–(2³−1)</td><td>%1.f[51]f[50] × 2²</td></tr><tr><td>4 位</td><td>2³–(2⁴−1)</td><td>%1.f[51]f[50]f[49] × 2³</td></tr><tr><td>⋯</td><td>⋯</td><td>⋯</td></tr><tr><td>53 位</td><td>2⁵²–(2⁵³−1)</td><td>%1.f[51]⋯f[0] × 2⁵²</td></tr></tbody></table> 
<p>没有固定的位序列表示整数。相反，尾数%1.f 被指数移位，以便领先的数字 1 位于正确的位置。在某种程度上，指数计算出分数中活跃使用的数字的数量（其余数字为 0）。这意味着对于 2 位，我们使用分数的一位数字，对于 53 位，我们使用分数的所有数字。此外，我们可以将 2⁵³表示为%1.0 × 2⁵³，但是对于更高的数字，我们会遇到问题：</p> 
<table><thead><tr><th>位</th><th>范围</th><th>编码</th></tr></thead><tbody><tr><td>54 位</td><td>2⁵³–(2⁵⁴−1)</td><td>%1.f[51]⋯f[0]0 × 2⁵³</td></tr><tr><td>55 位</td><td>2⁵⁴–(2⁵⁵−1)</td><td>%1.f[51]⋯f[0]00 × 2⁵⁴</td></tr><tr><td>⋯</td><td></td><td></td></tr></tbody></table> 
<p>对于 54 位，最低有效位始终为 0，对于 55 位，最低的两位始终为 0，依此类推。这意味着对于 54 位，我们只能表示每第二个数字，对于 55 位，只能表示每第四个数字，依此类推。例如：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span>  <span class="token comment">// OK</span>
<span class="token number">9007199254740991</span>
<span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">)</span>  <span class="token comment">// OK</span>
<span class="token number">9007199254740992</span>
<span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>  <span class="token comment">// can't be represented</span>
<span class="token number">9007199254740992</span>
<span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span>  <span class="token comment">// OK</span>
<span class="token number">9007199254740994</span>
</code></pre> 
<h5><a id="_611"></a>最佳实践</h5> 
<p>如果您使用的整数的大小不超过 53 位，那么就没问题。不幸的是，在编程中经常会遇到 64 位无符号整数（Twitter ID、数据库等）。这些必须以字符串形式存储在 JavaScript 中。如果要对这样的整数执行算术运算，就需要特殊的库。有计划将更大的整数引入 JavaScript，但这需要一些时间。</p> 
<h4><a id="_615"></a>安全整数</h4> 
<p>JavaScript 只能安全地表示范围在−2⁵³ &lt; i &lt; 2⁵³的整数。本节将探讨这意味着什么以及其后果。它基于 Mark S. Miller 发送给 es-discuss 邮件列表的一封邮件。</p> 
<p>安全整数的概念集中在 JavaScript 中如何表示数学整数上。在范围(−2⁵³, 2⁵³)（不包括下限和上限）内，JavaScript 整数是<em>安全</em>的：数学整数与它们在 JavaScript 中的表示之间存在一对一的映射。</p> 
<p>超出此范围后，JavaScript 整数是<em>不安全</em>的：两个或更多数学整数被表示为相同的 JavaScript 整数。例如，从 2⁵³开始，JavaScript 只能表示每第二个数学整数（前一节解释了原因）。因此，安全的 JavaScript 整数是可以明确表示单个数学整数的整数。</p> 
<h5><a id="ECMAScript_6__623"></a>ECMAScript 6 中的定义</h5> 
<p>ECMAScript 6 将提供以下常量：</p> 
<pre><code class="prism language-js">Number<span class="token punctuation">.</span><span class="token constant">MAX_SAFE_INTEGER</span> <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">53</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
Number<span class="token punctuation">.</span><span class="token constant">MIN_SAFE_INTEGER</span> <span class="token operator">=</span> <span class="token operator">-</span>Number<span class="token punctuation">.</span><span class="token constant">MAX_SAFE_INTEGER</span><span class="token punctuation">;</span>
</code></pre> 
<p>它还将提供一个用于确定整数是否安全的函数：</p> 
<pre><code class="prism language-js">Number<span class="token punctuation">.</span><span class="token function-variable function">isSafeInteger</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> n <span class="token operator">===</span> <span class="token string">'number'</span> <span class="token operator">&amp;&amp;</span>
        Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token operator">===</span> n <span class="token operator">&amp;&amp;</span>
        Number<span class="token punctuation">.</span><span class="token constant">MIN_SAFE_INTEGER</span> <span class="token operator">&lt;=</span> n <span class="token operator">&amp;&amp;</span>
        n <span class="token operator">&lt;=</span> Number<span class="token punctuation">.</span><span class="token constant">MAX_SAFE_INTEGER</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>对于给定值<code>n</code>，此函数首先检查<code>n</code>是否为数字和整数。如果两个检查都成功，则如果<code>n</code>大于或等于<code>MIN_SAFE_INTEGER</code>且小于或等于<code>MAX_SAFE_INTEGER</code>，则<code>n</code>是安全的。</p> 
<h5><a id="_645"></a>算术计算的安全结果</h5> 
<p>我们如何确保算术计算的结果是正确的？例如，以下结果显然是不正确的：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">9007199254740990</span> <span class="token operator">+</span> <span class="token number">3</span>
<span class="token number">9007199254740992</span>
</code></pre> 
<p>我们有两个安全的操作数，但是一个不安全的结果：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> Number<span class="token punctuation">.</span><span class="token function">isSafeInteger</span><span class="token punctuation">(</span><span class="token number">9007199254740990</span><span class="token punctuation">)</span>
<span class="token boolean">true</span>
<span class="token operator">&gt;</span> Number<span class="token punctuation">.</span><span class="token function">isSafeInteger</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token boolean">true</span>
<span class="token operator">&gt;</span> Number<span class="token punctuation">.</span><span class="token function">isSafeInteger</span><span class="token punctuation">(</span><span class="token number">9007199254740992</span><span class="token punctuation">)</span>
<span class="token boolean">false</span>
</code></pre> 
<p>以下结果也是不正确的：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">9007199254740995</span> <span class="token operator">-</span> <span class="token number">10</span>
<span class="token number">9007199254740986</span>
</code></pre> 
<p>这次结果是安全的，但其中一个操作数不是：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> Number<span class="token punctuation">.</span><span class="token function">isSafeInteger</span><span class="token punctuation">(</span><span class="token number">9007199254740995</span><span class="token punctuation">)</span>
<span class="token boolean">false</span>
<span class="token operator">&gt;</span> Number<span class="token punctuation">.</span><span class="token function">isSafeInteger</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token boolean">true</span>
<span class="token operator">&gt;</span> Number<span class="token punctuation">.</span><span class="token function">isSafeInteger</span><span class="token punctuation">(</span><span class="token number">9007199254740986</span><span class="token punctuation">)</span>
<span class="token boolean">true</span>
</code></pre> 
<p>因此，只有当所有操作数和结果都是安全的时，才能保证应用整数运算符<code>op</code>的结果是正确的。更正式地说：</p> 
<pre><code class="prism language-js"><span class="token function">isSafeInteger</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isSafeInteger</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isSafeInteger</span><span class="token punctuation">(</span>a op b<span class="token punctuation">)</span>
</code></pre> 
<p>意味着<code>a op b</code>是正确的结果。</p> 
<h3><a id="_691"></a>转换为整数</h3> 
<p>在 JavaScript 中，所有数字都是浮点数。整数是没有小数部分的浮点数。将数字<code>n</code>转换为整数意味着找到与<code>n</code>“最接近”的整数（“最接近”的含义取决于如何进行转换）。您有几种选项可以执行此转换：</p> 
<ol><li> <p><code>Math</code>函数<code>Math.floor()</code>、<code>Math.ceil()</code>和<code>Math.round()</code>（参见<a href="ch11.html#integers_via_math" rel="nofollow" title="Integers via Math.floor(), Math.ceil(), and Math.round()">Integers via Math.floor(), Math.ceil(), and Math.round()</a>）</p> </li><li> <p>自定义函数<code>ToInteger()</code>（参见<a href="ch11.html#ToInteger" rel="nofollow" title="Integers via the Custom Function ToInteger()">Integers via the Custom Function ToInteger()</a>）</p> </li><li> <p>二进制位运算符（参见[通过位运算符实现 32 位整数](ch11.html#integers_via_bitwise_operators “通过位运算符实现 32 位整数”））</p> </li><li> <p>全局函数<code>parseInt()</code>（参见[通过 parseInt()实现整数](ch11.html#parseInt “通过 parseInt()实现整数”））</p> </li></ol> 
<p>结论：#1 通常是最佳选择，#2 和#3 有特定应用，#4 适用于解析字符串，但不适用于将数字转换为整数。</p> 
<h4><a id="_MathfloorMathceil_Mathround_705"></a>通过 Math.floor()、Math.ceil()和 Math.round()实现整数</h4> 
<p>以下三个函数通常是将数字转换为整数的最佳方式：</p> 
<ul><li> <p><code>Math.floor()</code>将其参数转换为最接近的较低整数：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token number">3.8</span><span class="token punctuation">)</span>
<span class="token number">3</span>
<span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3.8</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token number">4</span>
</code></pre> </li><li> <p><code>Math.ceil()</code>将其参数转换为最接近的更高整数：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token number">3.2</span><span class="token punctuation">)</span>
<span class="token number">4</span>
<span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3.2</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token number">3</span>
</code></pre> </li><li> <p><code>Math.round()</code>将其参数转换为最接近的整数：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token number">3.2</span><span class="token punctuation">)</span>
<span class="token number">3</span>
<span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token number">3.5</span><span class="token punctuation">)</span>
<span class="token number">4</span>
<span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token number">3.8</span><span class="token punctuation">)</span>
<span class="token number">4</span>
</code></pre> </li></ul> 
<p>四舍五入<code>-3.5</code>的结果可能会让人惊讶：</p> 
<pre><code class="prism language-js">    <span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3.2</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token number">3</span>
    <span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3.5</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token number">3</span>
    <span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3.8</span><span class="token punctuation">)</span>
    <span class="token operator">-</span><span class="token number">4</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

因此，</span><span class="token template-punctuation string">`</span></span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">与以下相同：

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
    Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

### 通过自定义函数 ToInteger()实现整数

将任何值转换为整数的另一个好选择是内部 ECMAScript 操作</span><span class="token template-punctuation string">`</span></span><span class="token function">ToInteger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">，它去除了浮点数的小数部分。如果它在 JavaScript 中可用，它将像这样工作：

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token operator">&gt;</span> <span class="token function">ToInteger</span><span class="token punctuation">(</span><span class="token number">3.2</span><span class="token punctuation">)</span>
<span class="token number">3</span>
<span class="token operator">&gt;</span> <span class="token function">ToInteger</span><span class="token punctuation">(</span><span class="token number">3.5</span><span class="token punctuation">)</span>
<span class="token number">3</span>
<span class="token operator">&gt;</span> <span class="token function">ToInteger</span><span class="token punctuation">(</span><span class="token number">3.8</span><span class="token punctuation">)</span>
<span class="token number">3</span>
<span class="token operator">&gt;</span> <span class="token function">ToInteger</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3.2</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token number">3</span>
<span class="token operator">&gt;</span> <span class="token function">ToInteger</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3.5</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token number">3</span>
<span class="token operator">&gt;</span> <span class="token function">ToInteger</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">3.8</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token number">3</span>
</code></pre> 
<p>ECMAScript 规范将<code>ToInteger(number)</code>的结果定义为：</p> 
<p>sign(number) × floor(abs(number))</p> 
<p>这个公式相对复杂，因为<code>floor</code>寻找最接近的<em>大</em>整数；如果你想去掉负整数的小数部分，你必须寻找最接近的小整数。以下代码在 JavaScript 中实现了这个操作。如果数字是负数，我们避免使用<code>sign</code>操作，而是使用<code>ceil</code>：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">ToInteger</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    x <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> x <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">:</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_32__787"></a>通过位运算符实现 32 位整数</h4> 
<p>二进制位运算符（参见[二进制位运算符](ch11.html#binary_bitwise_operators “二进制位运算符”）将（至少）一个操作数转换为 32 位整数，然后对其进行操作以产生也是 32 位整数的结果。因此，如果你适当选择另一个操作数，你可以快速地将任意数字转换为 32 位整数（有符号或无符号）。</p> 
<h5><a id="_791"></a>按位或（|)</h5> 
<p>如果掩码，第二个操作数，为 0，则不改变任何位，结果是第一个操作数，强制转换为有符号 32 位整数。这是执行这种强制转换的规范方式，例如，asm.js（参见[JavaScript 足够快吗？](ch02.html#asm.js “JavaScript 足够快吗？”））中使用：</p> 
<pre><code class="prism language-js"><span class="token comment">// Convert x to a signed 32-bit integer</span>
<span class="token keyword">function</span> <span class="token function">ToInt32</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> x <span class="token operator">|</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><code>ToInt32()</code>去除小数并应用模 2³²：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">ToInt32</span><span class="token punctuation">(</span><span class="token number">1.001</span><span class="token punctuation">)</span>
<span class="token number">1</span>
<span class="token operator">&gt;</span> <span class="token function">ToInt32</span><span class="token punctuation">(</span><span class="token number">1.999</span><span class="token punctuation">)</span>
<span class="token number">1</span>
<span class="token operator">&gt;</span> <span class="token function">ToInt32</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token number">1</span>
<span class="token operator">&gt;</span> <span class="token function">ToInt32</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token number">1</span>
<span class="token operator">&gt;</span> <span class="token function">ToInt32</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token number">1</span>
<span class="token operator">&gt;</span> <span class="token function">ToInt32</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token number">1</span>
</code></pre> 
<h5><a id="_819"></a>移位运算符</h5> 
<p>对移位运算符也适用与按位或相同的技巧：如果你移动零位，移位操作的结果是第一个操作数，强制转换为 32 位整数。以下是通过移位运算符实现 ECMAScript 规范操作的一些示例：</p> 
<pre><code class="prism language-js"><span class="token comment">// Convert x to a signed 32-bit integer</span>
<span class="token keyword">function</span> <span class="token function">ToInt32</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> x <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Convert x to a signed 32-bit integer</span>
<span class="token keyword">function</span> <span class="token function">ToInt32</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> x <span class="token operator">&gt;&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Convert x to an unsigned 32-bit integer</span>
<span class="token keyword">function</span> <span class="token function">ToUint32</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> x <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这是<code>ToUint32()</code>的实际操作：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">ToUint32</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token number">4294967295</span>
<span class="token operator">&gt;</span> <span class="token function">ToUint32</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token number">4294967295</span>
<span class="token operator">&gt;</span> <span class="token function">ToUint32</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token number">0</span>
</code></pre> 
<h5><a id="_851"></a>我应该使用位运算符强制转换为整数吗？</h5> 
<p>你必须自己决定，稍微提高效率是否值得让你的代码更难理解。另外要注意，位运算符人为地限制自己在 32 位，这通常既不必要也不实用。使用<code>Math</code>函数之一，可能还加上<code>Math.abs()</code>，是一个更易于理解且可能更好的选择。</p> 
<h4><a id="_parseInt_855"></a>通过 parseInt()实现整数</h4> 
<p><code>parseInt()</code>函数：</p> 
<pre><code class="prism language-js"><span class="token function">parseInt</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span> radix<span class="token operator">?</span><span class="token punctuation">)</span>
</code></pre> 
<p>解析字符串<code>str</code>（非字符串被强制转换）为整数。该函数忽略前导空格，并考虑尽可能多的连续合法数字。</p> 
<h5><a id="_865"></a>基数</h5> 
<p>基数的范围是 2 ≤ <code>radix</code> ≤ 36。它确定要解析的数字的基数。如果基数大于 10，则除了 0-9，还使用字母作为数字（不区分大小写）。</p> 
<p>如果<code>radix</code>缺失，则假定为 10，除非<code>str</code>以“0x”或“0X”开头，此时<code>radix</code>设置为 16（十六进制）：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'0xA'</span><span class="token punctuation">)</span>
<span class="token number">10</span>
</code></pre> 
<p>如果<code>radix</code>已经是 16，则十六进制前缀是可选的：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'0xA'</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
<span class="token number">10</span>
<span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
<span class="token number">10</span>
</code></pre> 
<p>到目前为止，我已经描述了<code>parseInt()</code>的行为，符合 ECMAScript 规范。此外，一些引擎如果<code>str</code>以零开头，则将基数设置为 8：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'010'</span><span class="token punctuation">)</span>
<span class="token number">8</span>
<span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'0109'</span><span class="token punctuation">)</span>  <span class="token comment">// ignores digits ≥ 8</span>
<span class="token number">8</span>
</code></pre> 
<p>因此，最好总是明确指定基数，始终使用两个参数调用<code>parseInt()</code>。</p> 
<p>以下是一些例子：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token number">NaN</span>
<span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'zz'</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span>
<span class="token number">1295</span>
<span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'   81'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token number">81</span>

<span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'12**'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token number">12</span>
<span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'12.34'</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token number">12</span>
<span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token number">12.34</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token number">12</span>
</code></pre> 
<p>不要使用<code>parseInt()</code>将数字转换为整数。最后一个例子让我们希望我们可以使用<code>parseInt()</code>将数字转换为整数。然而，这里有一个转换不正确的例子：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token number">1000000000000000000000.5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token number">1</span>
</code></pre> 
<h5><a id="_921"></a>解释</h5> 
<p>首先将参数转换为字符串：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">1000000000000000000000.5</span><span class="token punctuation">)</span>
<span class="token string">'1e+21'</span>
</code></pre> 
<p><code>parseInt</code>不认为“e”是一个整数数字，因此在 1 之后停止解析。这里是另一个例子：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token number">0.0000008</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token number">8</span>
<span class="token operator">&gt;</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">0.0000008</span><span class="token punctuation">)</span>
<span class="token string">'8e-7'</span>
</code></pre> 
<h5><a id="_939"></a>总结</h5> 
<p><code>parseInt()</code>不应该用于将数字转换为整数：强制转换为字符串是一个不必要的绕道，即使这样，结果也不总是正确的。</p> 
<p><code>parseInt()</code>用于解析字符串很有用，但你必须意识到它会在第一个非法数字处停止。通过<code>Number()</code>（参见[函数 Number](ch11.html#function_number “函数 Number”））解析字符串不太宽容，但可能会产生非整数。</p> 
<h3><a id="_945"></a>算术运算符</h3> 
<p>以下运算符适用于数字：</p> 
<p><code>number1 + number2</code></p> 
<p>数值相加，除非其中一个操作数是字符串。然后两个操作数都会被转换为字符串并连接在一起（参见[加号运算符（+）](ch09.html#plus_operator “加号运算符（+）”））：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">3.1</span> <span class="token operator">+</span> <span class="token number">4.3</span>
<span class="token number">7.4</span>
<span class="token operator">&gt;</span> <span class="token number">4</span> <span class="token operator">+</span> <span class="token string">' messages'</span>
<span class="token string">'4 messages'</span>
</code></pre> 
<p><code>number1 - number2</code></p> 
<p>减法。</p> 
<p><code>number1 * number2</code></p> 
<p>乘法。</p> 
<p><code>number1 / number2</code></p> 
<p>除法。</p> 
<p><code>number1 % number2</code></p> 
<p>余数：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">9</span> <span class="token operator">%</span> <span class="token number">7</span>
<span class="token number">2</span>
<span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">9</span> <span class="token operator">%</span> <span class="token number">7</span>
<span class="token operator">-</span><span class="token number">2</span>
</code></pre> 
<h4><a id="_983"></a>警告</h4> 
<p>这个操作不是模运算。它返回一个与第一个操作数相同符号的值（稍后会有更多细节）。</p> 
<p><code>-number</code></p> 
<p>否定其参数。</p> 
<p><code>+number</code></p> 
<p>将其参数保持不变；非数字被转换为数字。</p> 
<p><code>++variable</code>, <code>--variable</code></p> 
<p>在增加（或减少）1 之后返回变量的当前值：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> <span class="token operator">++</span>x
<span class="token number">4</span>
<span class="token operator">&gt;</span> x
<span class="token number">4</span>
</code></pre> 
<p><code>variable++</code>, <code>variable--</code></p> 
<p>通过 1 来增加（或减少）变量的值并返回它：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token keyword">var</span> x <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> x<span class="token operator">++</span>
<span class="token number">3</span>
<span class="token operator">&gt;</span> x
<span class="token number">4</span>
</code></pre> 
<h4><a id="_1019"></a>助记符：增量（++）和减量（–）运算符</h4> 
<p>操作数的位置可以帮助你记住它是在增加（或减少）之前还是之后返回的。如果操作数在增加运算符之前，它在增加之前返回。如果操作数在运算符之后，它会增加然后返回。（减量运算符的工作方式类似。）</p> 
<p>陷阱：余数运算符（%）不是模运算</p> 
<p>余数运算符的结果始终具有第一个操作数的符号（对于模运算，它是第二个操作数的符号）：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">5</span> <span class="token operator">%</span> <span class="token number">2</span>
<span class="token operator">-</span><span class="token number">1</span>
</code></pre> 
<p>这意味着以下函数不起作用：</p> 
<pre><code class="prism language-js"><span class="token comment">// Wrong!</span>
<span class="token keyword">function</span> <span class="token function">isOdd</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> n <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isOdd</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isOdd</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre> 
<p>正确的版本是：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">isOdd</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span>n <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isOdd</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">isOdd</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre> 
<h3><a id="_1053"></a>位运算符</h3> 
<p>JavaScript 有几个位运算符，可以处理 32 位整数。也就是说，它们将操作数转换为 32 位整数，并产生一个 32 位整数的结果。这些运算符的用例包括处理二进制协议、特殊算法等。</p> 
<h4><a id="_1057"></a>背景知识</h4> 
<p>本节解释了一些概念，这些概念将帮助你理解位运算符。</p> 
<h5><a id="_1061"></a>二进制补码</h5> 
<p>计算二进制补码（或反码）的两种常见方法是：</p> 
<p>补码</p> 
<p>通过反转 32 位数字来计算数字<code>x</code>的补码<code>~x</code>。让我们通过四位数字来说明补码。<code>1100</code>的补码是<code>0011</code>。将一个数字加上它的补码会得到一个所有数字都是 1 的数字：</p> 
<pre><code class="prism language-js"><span class="token number">1</span> <span class="token operator">+</span> <span class="token operator">~</span><span class="token number">1</span> <span class="token operator">=</span> <span class="token number">0001</span> <span class="token operator">+</span> <span class="token number">1110</span> <span class="token operator">=</span> <span class="token number">1111</span>
</code></pre> 
<p>二进制补码</p> 
<p>数字<code>x</code>的二进制补码<code>-x</code>是补码加一。将一个数字加上它的二进制补码会得到<code>0</code>（忽略最高位之外的溢出）。以下是一个使用四位数字的例子：</p> 
<pre><code class="prism language-js"><span class="token number">1</span> <span class="token operator">+</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">=</span> <span class="token number">0001</span> <span class="token operator">+</span> <span class="token number">1111</span> <span class="token operator">=</span> <span class="token number">0000</span>
</code></pre> 
<h5><a id="_32__1081"></a>有符号的 32 位整数</h5> 
<p>32 位整数没有显式的符号，但你仍然可以编码负数。例如，-1 可以编码为 1 的补码：将结果加 1 得到 0（在 32 位内）。正数和负数之间的边界是流动的；4294967295（2³²−1）和-1 在这里是相同的整数。但是，当你将这样的整数从 JavaScript 数字转换到 JavaScript 数字时，你必须决定一个符号，这个符号与隐式符号相对。因此，<em>有符号的 32 位整数</em>被分成两组：</p> 
<ul><li> <p>最高位为 0：数字为零或正数。</p> </li><li> <p>最高位为 1：数字为负数。</p> </li></ul> 
<p>最高位通常称为<em>符号位</em>。因此，4294967295，解释为有符号 32 位整数，当转换为 JavaScript 数字时变为-1：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">ToInt32</span><span class="token punctuation">(</span><span class="token number">4294967295</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token number">1</span>
</code></pre> 
<p><code>ToInt32()</code>在<a href="ch11.html#integers_via_bitwise_operators" rel="nofollow" title="32-bit Integers via Bitwise Operators">通过按位操作获取 32 位整数</a>中有解释。</p> 
<h4><a id="_1098"></a>注意</h4> 
<p>只有无符号右移操作符（<code>&gt;&gt;&gt;</code>）适用于无符号 32 位整数；所有其他按位操作符适用于有符号 32 位整数。</p> 
<h5><a id="_1102"></a>输入和输出二进制数</h5> 
<p>在以下示例中，我们通过以下两个操作使用二进制数：</p> 
<ul><li> <p><code>parseInt(str, 2)</code>（参见[通过 parseInt()获取整数](ch11.html#parseInt “Integers via parseInt()”））解析二进制表示法（基数为 2）的字符串<code>str</code>。例如：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'110'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token number">6</span>
</code></pre> </li><li> <p><code>num.toString(2)</code>（参见[Number.prototype.toString(radix?)](ch11.html#Number.prototype.toString “Number.prototype.toString(radix?)”）将数字<code>num</code>转换为二进制表示的字符串。例如：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">6.</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token string">'110'</span>
</code></pre> </li></ul> 
<h4><a id="_1120"></a>按位非操作符</h4> 
<p><code>~number</code>计算<code>number</code>的补码：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'11111111111111111111111111111111'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token string">'0'</span>
</code></pre> 
<h4><a id="_1129"></a>二进制按位操作符</h4> 
<p>JavaScript 有三个二进制按位操作符：</p> 
<ul><li> <p><code>number1 &amp; number2</code>（按位与）：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'11001010'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'1111'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token string">'1010'</span>
</code></pre> </li><li> <p><code>number1 | number2</code>（按位或）：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'11001010'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'1111'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token string">'11001111'</span>
</code></pre> </li><li> <p><code>number1 ^ number2</code>（按位异或）：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'11001010'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'1111'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token string">'11000101'</span>
</code></pre> </li></ul> 
<p>直观理解二进制按位操作符有两种方式：</p> 
<p>每位一个布尔操作。</p> 
<p>在以下公式中，<code>n[i]</code>表示将数字<code>n</code>的第<code>i</code>位解释为布尔值（0 为<code>false</code>，1 为<code>true</code>）。例如，<code>2[0]</code>为<code>false</code>；<code>2[1]</code>为<code>true</code>：</p> 
<ul><li> <p>And：<code>result[i] = number1[i] &amp;&amp; number2[i]</code></p> </li><li> <p>或：<code>result[i] = number1[i] || number2[i]</code></p> </li><li> <p>Xor：<code>result[i] = number1[i] ^^ number2[i]</code></p> </li></ul> 
<p>操作符<code>^^</code>不存在。如果存在，它将按照以下方式工作（如果操作数中恰好有一个为<code>true</code>，则结果为<code>true</code>）：</p> 
<pre><code class="prism language-js">    x <span class="token operator">^</span><span class="token operator">^</span> y <span class="token operator">===</span> <span class="token punctuation">(</span>x <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>y<span class="token punctuation">)</span> <span class="token operator">||</span><span class="token punctuation">(</span><span class="token operator">!</span>x <span class="token operator">&amp;&amp;</span> y<span class="token punctuation">)</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

通过</span><span class="token template-punctuation string">`</span></span>number2<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">改变</span><span class="token template-punctuation string">`</span></span>number1<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">的位

+   And：仅保留</span><span class="token template-punctuation string">`</span></span>number1<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">中设置的那些位。这个操作也被称为*掩码*，</span><span class="token template-punctuation string">`</span></span>number2<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">是*掩码*。

+   或：设置</span><span class="token template-punctuation string">`</span></span>number1<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">中设置的所有位，并保持所有其他位不变。

+   Xor：反转</span><span class="token template-punctuation string">`</span></span>number1<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">中设置的所有位，并保持所有其他位不变。

### 按位移动操作符

JavaScript 有三个按位移动操作符：

+   </span><span class="token template-punctuation string">`</span></span>number <span class="token operator">&lt;&lt;</span> digitCount<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">（左移）：

    </span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
    <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token string">'10'</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

+   </span><span class="token template-punctuation string">`</span></span>number <span class="token operator">&gt;&gt;</span> digitCount<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">（有符号右移）：

32 位二进制数被解释为有符号数（参见前面的部分）。向右移动时，符号被保留：

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
    <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'11111111111111111111111111111110'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token string">'-1'</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

我们已经右移了-2。结果-1 等同于一个 32 位整数，其所有数字都是 1（1 的补码）。换句话说，向右移动一个数字，负数和正数都会除以 2。

+   </span><span class="token template-punctuation string">`</span></span>number <span class="token operator">&gt;&gt;&gt;</span> digitCount<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">（无符号右移）：

    </span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
    <span class="token operator">&gt;</span> <span class="token punctuation">(</span><span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'11100'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token string">'1110'</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

正如你所看到的，这个操作符从左边补零。

## 函数数字

</span><span class="token template-punctuation string">`</span></span>Number<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">函数可以以两种方式调用：

</span><span class="token template-punctuation string">`</span></span><span class="token function">Number</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

作为普通函数，它将</span><span class="token template-punctuation string">`</span></span>value<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">转换为原始数字（参见[转换为数字](ch11.html#tonumber "Converting to Number"））：

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token operator">&gt;</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span>
<span class="token number">123</span>
<span class="token operator">&gt;</span> <span class="token keyword">typeof</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>  <span class="token comment">// no change</span>
<span class="token string">'number'</span>
</code></pre> 
<p><code>new Number(num)</code></p> 
<p>作为构造函数，它创建一个<code>Number</code>的新实例（参见[原始值的包装对象](ch08.html#wrapper_objects “Wrapper Objects for Primitives”）），一个将<code>num</code>（在转换为数字后）包装的对象。例如：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token keyword">typeof</span> <span class="token keyword">new</span> <span class="token class-name">Number</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token string">'object'</span>
</code></pre> 
<p>前一种调用是常见的。</p> 
<h3><a id="_1237"></a>数字构造函数属性</h3> 
<p>对象<code>Number</code>具有以下属性：</p> 
<p><code>Number.MAX_VALUE</code></p> 
<p>可以表示的最大正数。在内部，其分数的所有数字都是 1，指数是最大的，为 1023。如果尝试通过将指数乘以 2 来增加指数，结果将是错误值<code>Infinity</code>（参见<a href="ch11.html#infinity" rel="nofollow" title="Infinity">Infinity</a>）：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> Number<span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span>
<span class="token number">1.7976931348623157e+308</span>
<span class="token operator">&gt;</span> Number<span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span> <span class="token operator">*</span> <span class="token number">2</span>
<span class="token number">Infinity</span>
</code></pre> 
<p><code>Number.MIN_VALUE</code></p> 
<p>最小的可表示正数（大于零，一个微小的分数）：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> Number<span class="token punctuation">.</span><span class="token constant">MIN_VALUE</span>
<span class="token number">5e-324</span>
</code></pre> 
<p><code>Number.NaN</code></p> 
<p>与全局<code>NaN</code>相同的值。</p> 
<p><code>Number.NEGATIVE_INFINITY</code></p> 
<p>与“-无穷大”相同的值：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> Number<span class="token punctuation">.</span><span class="token constant">NEGATIVE_INFINITY</span> <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">Infinity</span>
<span class="token boolean">true</span>
</code></pre> 
<p><code>Number.POSITIVE_INFINITY</code></p> 
<p>与<code>Infinity</code>相同的值：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> Number<span class="token punctuation">.</span><span class="token constant">POSITIVE_INFINITY</span> <span class="token operator">===</span> <span class="token number">Infinity</span>
<span class="token boolean">true</span>
</code></pre> 
<h3><a id="_1283"></a>数字原型方法</h3> 
<p>所有原始数字的方法都存储在<code>Number.prototype</code>中（参见<a href="ch08.html#primitive_methods_via_wrappers" rel="nofollow" title="Primitives Borrow Their Methods from Wrappers">Primitives Borrow Their Methods from Wrappers</a>）。</p> 
<h4><a id="NumberprototypetoFixedfractionDigits_1287"></a>Number.prototype.toFixed(fractionDigits?)</h4> 
<p><code>Number.prototype.toFixed(fractionDigits?)</code>返回一个不带指数的数字表示，四舍五入到<code>fractionDigits</code>位。如果省略参数，则使用值 0：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">0.0000003</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token string">'0.0000003000'</span>
<span class="token operator">&gt;</span> <span class="token number">0.0000003</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'3e-7'</span>
</code></pre> 
<p>如果数字大于或等于 10²¹，那么这个方法的工作方式与<code>toString()</code>相同。您会得到一个用指数表示的数字：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">1234567890123456789012.</span><span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'1.2345678901234568e+21'</span>
<span class="token operator">&gt;</span> <span class="token number">1234567890123456789012.</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'1.2345678901234568e+21'</span>
</code></pre> 
<h4><a id="NumberprototypetoPrecisionprecision_1307"></a>Number.prototype.toPrecision(precision?)</h4> 
<p><code>Number.prototype.toPrecision(precision?)</code>在使用类似于<code>toString()</code>的转换算法之前，将尾数修剪为<code>precision</code>位数字。如果没有给出精度，则直接使用<code>toString()</code>：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">1234.</span><span class="token punctuation">.</span><span class="token function">toPrecision</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token string">'1.23e+3'</span>

<span class="token operator">&gt;</span> <span class="token number">1234.</span><span class="token punctuation">.</span><span class="token function">toPrecision</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token string">'1234'</span>

<span class="token operator">&gt;</span> <span class="token number">1234.</span><span class="token punctuation">.</span><span class="token function">toPrecision</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token string">'1234.0'</span>

<span class="token operator">&gt;</span> <span class="token number">1.234</span><span class="token punctuation">.</span><span class="token function">toPrecision</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token string">'1.23'</span>
</code></pre> 
<p>您需要指数表示法来显示 1234，精度为三位。</p> 
<h4><a id="NumberprototypetoStringradix_1327"></a>Number.prototype.toString(radix?)</h4> 
<p>对于<code>Number.prototype.toString(radix?)</code>，参数<code>radix</code>表示要显示数字的系统的基数。最常见的基数是 10（十进制）、2（二进制）和 16（十六进制）：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">15.</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token string">'1111'</span>
<span class="token operator">&gt;</span> <span class="token number">65535.</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span>
<span class="token string">'ffff'</span>
</code></pre> 
<p>基数必须至少为 2，最多为 36。任何大于 10 的基数都会导致字母字符被用作数字，这解释了最大 36，因为拉丁字母表有 26 个字符：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">1234567890.</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">36</span><span class="token punctuation">)</span>
<span class="token string">'kf12oi'</span>
</code></pre> 
<p>全局函数<code>parseInt</code>（参见<a href="ch11.html#parseInt" rel="nofollow" title="Integers via parseInt()">Integers via parseInt()</a>）允许您将这些表示法转换回数字：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'kf12oi'</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">)</span>
<span class="token number">1234567890</span>
</code></pre> 
<h5><a id="_1352"></a>十进制指数表示法</h5> 
<p>对于基数 10，<code>toString()</code>在两种情况下使用指数表示法（小数点前有一个数字）。首先，如果小数点前有超过 21 位数字：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">1234567890123456789012</span>
<span class="token number">1.2345678901234568e+21</span>
<span class="token operator">&gt;</span> <span class="token number">123456789012345678901</span>
<span class="token number">123456789012345680000</span>
</code></pre> 
<p>其次，如果一个数字以<code>0.</code>开头，后面跟着超过五个零和一个非零数字：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">0.0000003</span>
<span class="token number">3e-7</span>
<span class="token operator">&gt;</span> <span class="token number">0.000003</span>
<span class="token number">0.000003</span>
</code></pre> 
<p>在所有其他情况下，使用固定表示法。</p> 
<h4><a id="NumberprototypetoExponentialfractionDigits_1374"></a>Number.prototype.toExponential(fractionDigits?)</h4> 
<p><code>Number.prototype.toExponential(fractionDigits?)</code>强制一个数字以指数表示。<code>fractionDigits</code>是一个介于 0 和 20 之间的数字，用于确定小数点后应显示多少位数字。如果省略，则包括尽可能多的有效数字以唯一指定数字。</p> 
<p>在这个例子中，当<code>toString()</code>也使用指数表示时，我们强制更多的精度。结果是混合的，因为当将二进制数字转换为十进制表示时，我们达到了可以实现的精度限制：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">1234567890123456789012.</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'1.2345678901234568e+21'</span>

<span class="token operator">&gt;</span> <span class="token number">1234567890123456789012.</span><span class="token punctuation">.</span><span class="token function">toExponential</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token string">'1.23456789012345677414e+21'</span>
</code></pre> 
<p>在这个例子中，数字的数量级不够大，无法通过<code>toString()</code>显示指数。然而，<code>toExponential()</code>确实显示了一个指数：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">1234.</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'1234'</span>

<span class="token operator">&gt;</span> <span class="token number">1234.</span><span class="token punctuation">.</span><span class="token function">toExponential</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token string">'1.23400e+3'</span>

<span class="token operator">&gt;</span> <span class="token number">1234.</span><span class="token punctuation">.</span><span class="token function">toExponential</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'1.234e+3'</span>
</code></pre> 
<p>在这个例子中，当分数不够小时，我们得到指数表示法：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token number">0.003</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'0.003'</span>

<span class="token operator">&gt;</span> <span class="token number">0.003</span><span class="token punctuation">.</span><span class="token function">toExponential</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token string">'3.0000e-3'</span>

<span class="token operator">&gt;</span> <span class="token number">0.003</span><span class="token punctuation">.</span><span class="token function">toExponential</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'3e-3'</span>
</code></pre> 
<h3><a id="_1414"></a>数字函数</h3> 
<p>以下函数操作数字：</p> 
<p><code>isFinite(number)</code></p> 
<p>检查<code>number</code>是否是实际数字（既不是<code>Infinity</code>也不是<code>NaN</code>）。详情请参见<a href="ch11.html#isFinite" rel="nofollow" title="Checking for Infinity">Checking for Infinity</a>。</p> 
<p><code>isNaN(number)</code></p> 
<p>如果<code>number</code>是<code>NaN</code>，则返回<code>true</code>。详情请参见<a href="ch11.html#isNaN" rel="nofollow" title="Pitfall: checking whether a value is NaN">Pitfall: checking whether a value is NaN</a>。</p> 
<p><code>parseFloat(str)</code></p> 
<p>将<code>str</code>转换为浮点数。详情请参见<a href="ch11.html#parseFloat" rel="nofollow" title="parseFloat()">parseFloat()</a>。</p> 
<p><code>parseInt(str, radix?)</code></p> 
<p>将<code>str</code>解析为以<code>radix</code>为基数的整数（2-36）。详情请参阅<a href="ch11.html#parseInt" rel="nofollow" title="通过 parseInt()获取整数">通过 parseInt()获取整数</a>。</p> 
<h3><a id="_1434"></a>本章的来源</h3> 
<p>在编写本章时，我参考了以下来源：</p> 
<ul><li> <p><a href="http://bit.ly/1oOc43P" rel="nofollow">“IEEE 标准 754 浮点数”</a> 由 Steve Hollasch</p> </li><li> <p><a href="http://bit.ly/1oOc83t" rel="nofollow">“数据类型和缩放（固定点块集）”</a> 在 MATLAB 文档中</p> </li><li> <p><a href="http://en.wikipedia.org/wiki/IEEE_754" rel="nofollow">“IEEE 浮点”</a> 在维基百科上</p> </li></ul> 
<hr> 
<p>¹² 来源：Brendan Eich，<a href="http://bit.ly/1lKzQeC" rel="nofollow"><code>bit.ly/1lKzQeC</code></a>。</p> 
<p>¹³ Béla Varga（@netzzwerg）指出 IEEE 754 规定 NaN 不等于自身。</p> 
<h3><a id="_1451"></a>第十二章：字符串</h3> 
<blockquote> 
 <p>原文：<a href="https://exploringjs.com/es5/ch12.html" rel="nofollow">12. Strings</a></p> 
 <p>译者：<a href="https://github.com/wizardforcel">飞龙</a></p> 
 <p>协议：<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="nofollow">CC BY-NC-SA 4.0</a></p> 
</blockquote> 
<p>字符串是 JavaScript 字符的不可变序列。每个字符都是一个 16 位的 UTF-16 代码单元。这意味着一个 Unicode 字符由一个或两个 JavaScript 字符表示。当您计算字符数或拆分字符串时，您主要需要考虑两个字符的情况（参见第二十四章）。</p> 
<h3><a id="_1462"></a>字符串文字</h3> 
<p>单引号和双引号都可以用来界定字符串文字：</p> 
<pre><code class="prism language-js"><span class="token string">'He said: "Hello"'</span>
<span class="token string">"He said: \"Hello\""</span>

<span class="token string">'Everyone\'s a winner'</span>
<span class="token string">"Everyone's a winner"</span>
</code></pre> 
<p>因此，您可以自由地使用任何一种引号。不过，有几点需要考虑：</p> 
<ul><li> <p>社区中最常见的风格是在 HTML 中使用双引号，在 JavaScript 中使用单引号。</p> </li><li> <p>另一方面，某些语言（例如 C 和 Java）中双引号专门用于字符串。因此，在多语言代码库中使用它们可能是有意义的。</p> </li><li> <p>对于 JSON（在第二十二章中讨论），您必须使用双引号。</p> </li></ul> 
<p>如果您一贯使用引号，您的代码看起来会更整洁。但有时，不同的引号意味着您不必转义，这可以证明您不那么一致是合理的（例如，您可能通常使用单引号，但暂时切换到双引号来编写前面例子的最后一个）。</p> 
<h3><a id="_1484"></a>字符串文字中的转义</h3> 
<p>字符串文字中的大多数字符只是代表它们自己。反斜杠用于<em>转义</em>并启用了一些特殊功能：</p> 
<p>行继续</p> 
<p>您可以通过用反斜杠转义行尾（行终止字符，<em>行终止符</em>）来将字符串分布在多行上：</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">'written \
over \
multiple \
lines'</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>str <span class="token operator">===</span> <span class="token string">'written over multiple lines'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> 
<p>另一种方法是使用加号运算符进行连接：</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">'written '</span> <span class="token operator">+</span>
          <span class="token string">'over '</span> <span class="token operator">+</span>
          <span class="token string">'multiple '</span> <span class="token operator">+</span>
          <span class="token string">'lines'</span><span class="token punctuation">;</span>
</code></pre> 
<p>字符转义序列</p> 
<p>这些序列以反斜杠开头：</p> 
<ul><li> <p>控制字符：<code>\b</code>是一个退格，<code>\f</code>是一个换页符，<code>\n</code>是一个换行符（新行），<code>\r</code>是一个回车，<code>\t</code>是一个水平制表符，<code>\v</code>是一个垂直制表符。</p> </li><li> <p>转义字符代表它们自己：<code>\'</code>是一个单引号，<code>\"</code>是一个双引号，<code>\\</code>是一个反斜杠。除了<code>b f n r t v x u</code>和十进制数字之外，所有字符也代表它们自己。以下是两个例子：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'\"'</span>
<span class="token string">'"'</span>
<span class="token operator">&gt;</span> <span class="token string">'\q'</span>
<span class="token string">'q'</span>
</code></pre> </li></ul> 
<p>NUL 字符（Unicode 代码点 0）</p> 
<p>这个字符由<code>\0</code>表示。</p> 
<p>十六进制转义序列</p> 
<p><code>\xHH</code>（<code>HH</code>是两个十六进制数字）指定了一个 ASCII 码的字符。例如：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'\x4D'</span>
<span class="token string">'M'</span>
</code></pre> 
<p>Unicode 转义序列</p> 
<p><code>\uHHHH</code>（<code>HHHH</code>是四个十六进制数字）指定了一个 UTF-16 代码单元（参见第二十四章）。以下是两个例子：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'\u004D'</span>
<span class="token string">'M'</span>
<span class="token operator">&gt;</span> <span class="token string">'\u03C0'</span>
<span class="token string">'π'</span>
</code></pre> 
<h3><a id="_1548"></a>字符访问</h3> 
<p>有两个操作可以返回字符串的第<em>n</em>个字符。请注意，JavaScript 没有专门的字符数据类型；这些操作返回字符串：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'abc'</span><span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token string">'b'</span>
<span class="token operator">&gt;</span> <span class="token string">'abc'</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token string">'b'</span>
</code></pre> 
<p>一些较旧的浏览器不支持通过方括号进行类似数组的字符访问。</p> 
<h3><a id="_1561"></a>转换为字符串</h3> 
<p>值将按以下方式转换为字符串：</p> 
<table><thead><tr><th>值</th><th>结果</th></tr></thead><tbody><tr><td></td><td><code>undefined</code> → <code>'undefined'</code></td></tr><tr><td></td><td><code>null</code> → <code>'null'</code></td></tr><tr><td>布尔值</td><td><code>false</code> → <code>'false'</code></td></tr><tr><td></td><td><code>true</code> → <code>'true'</code></td></tr><tr><td>数字</td><td>作为字符串的数字（例如，<code>3.141</code> → <code>'3.141'</code>）</td></tr><tr><td>字符串</td><td>与输入相同（无需转换）</td></tr><tr><td>对象</td><td>调用<code>ToPrimitive(value, String)</code>（请参阅<a href="ch08.html#toprimitive" rel="nofollow" title="算法：ToPrimitive()——将值转换为原始值">算法：ToPrimitive()——将值转换为原始值</a>）并转换生成的原始值。</td></tr></tbody></table> 
<h4><a id="_1575"></a>手动转换为字符串</h4> 
<p>将三种将任何值转换为字符串的最常见方法是：</p> 
<p>| <code>String(value)</code> | （作为函数调用，而不是作为构造函数） |<br> | <code>''+value</code> | |<br> | <code>value.toString()</code> | （对于<code>undefined</code>和<code>null</code>不起作用！） |</p> 
<p>我更喜欢<code>String()</code>，因为它更具描述性。以下是一些示例：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token string">'false'</span>
<span class="token operator">&gt;</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">7.35</span><span class="token punctuation">)</span>
<span class="token string">'7.35'</span>
<span class="token operator">&gt;</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">first</span><span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span> <span class="token literal-property property">last</span><span class="token operator">:</span> <span class="token string">'Doe'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token string">'[object Object]'</span>
<span class="token operator">&gt;</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span> <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token string">'a,b,c'</span>
</code></pre> 
<p>请注意，对于显示数据，<code>JSON.stringify()</code>（<a href="ch22.html#JSON.stringify" rel="nofollow" title="JSON.stringify(value, replacer?, space?)">JSON.stringify(value, replacer?, space?)</a>）通常比规范的字符串转换效果更好：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">first</span><span class="token operator">:</span> <span class="token string">'John'</span><span class="token punctuation">,</span> <span class="token literal-property property">last</span><span class="token operator">:</span> <span class="token string">'Doe'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span><span class="token string-property property">"first"</span><span class="token operator">:</span><span class="token string">"John"</span><span class="token punctuation">,</span><span class="token string-property property">"last"</span><span class="token operator">:</span><span class="token string">"Doe"</span><span class="token punctuation">}</span>
<span class="token operator">&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token string">"b"</span><span class="token punctuation">,</span><span class="token string">"c"</span><span class="token punctuation">]</span>
</code></pre> 
<p>当然，您必须意识到<code>JSON.stringify()</code>的局限性——它并不总是显示所有内容。例如，它隐藏了它无法处理的属性的值（函数等！）。另一方面，它的输出可以被<code>eval()</code>解析，并且可以将深度嵌套的数据显示为格式良好的树。</p> 
<h5><a id="_1607"></a>陷阱：转换不可逆</h5> 
<p>考虑到 JavaScript 自动转换的频率，遗憾的是转换并不总是可逆的，特别是在布尔值方面：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
<span class="token string">'false'</span>
<span class="token operator">&gt;</span> <span class="token function">Boolean</span><span class="token punctuation">(</span><span class="token string">'false'</span><span class="token punctuation">)</span>
<span class="token boolean">true</span>
</code></pre> 
<p>对于<code>undefined</code>和<code>null</code>，我们面临类似的问题。</p> 
<h3><a id="_1620"></a>比较字符串</h3> 
<p>有两种比较字符串的方法。首先，您可以使用比较运算符：<code>&lt;</code>，<code>&gt;</code>，<code>===</code>，<code>&lt;=</code>，<code>&gt;=</code>。它们有以下缺点：</p> 
<ul><li> <p>它们区分大小写：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'B'</span> <span class="token operator">&gt;</span> <span class="token string">'A'</span>  <span class="token comment">// ok</span>
<span class="token boolean">true</span>
<span class="token operator">&gt;</span> <span class="token string">'B'</span> <span class="token operator">&gt;</span> <span class="token string">'a'</span>  <span class="token comment">// should be true</span>
<span class="token boolean">false</span>
</code></pre> </li><li> <p>它们不能很好地处理变音符和重音符号：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'ä'</span> <span class="token operator">&lt;</span> <span class="token string">'b'</span>  <span class="token comment">// should be true</span>
<span class="token boolean">false</span>
<span class="token operator">&gt;</span> <span class="token string">'é'</span> <span class="token operator">&lt;</span> <span class="token string">'f'</span>  <span class="token comment">// should be true</span>
<span class="token boolean">false</span>
</code></pre> </li></ul> 
<p>其次，您可以使用<code>String.prototype.localeCompare(other)</code>，这往往更好，但并不总是受支持（有关详细信息，请参阅<a href="ch12.html#String.prototype.localeCompare" rel="nofollow" title="搜索和比较">搜索和比较</a>）。以下是 Firefox 控制台中的交互：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'B'</span><span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span><span class="token string">'A'</span><span class="token punctuation">)</span>
<span class="token number">2</span>
<span class="token operator">&gt;</span> <span class="token string">'B'</span><span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
<span class="token number">2</span>

<span class="token operator">&gt;</span> <span class="token string">'ä'</span><span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token number">2</span>
<span class="token operator">&gt;</span> <span class="token string">'é'</span><span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span><span class="token string">'f'</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token number">2</span>
</code></pre> 
<p>小于零的结果意味着接收器“小于”参数。大于零的结果意味着接收器“大于”参数。</p> 
<h3><a id="_1658"></a>连接字符串</h3> 
<p>有两种主要的字符串连接方法。</p> 
<h4><a id="_1662"></a>连接：加号（+）运算符</h4> 
<p>运算符<code>+</code>在其操作数之一是字符串时进行字符串连接。如果要在变量中收集字符串片段，则复合赋值运算符<code>+=</code>很有用：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token keyword">var</span> str <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> str <span class="token operator">+=</span> <span class="token string">'Say hello '</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> str <span class="token operator">+=</span> <span class="token number">7</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> str <span class="token operator">+=</span> <span class="token string">' times fast!'</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> str
<span class="token string">'Say hello 7 times fast!'</span>
</code></pre> 
<h4><a id="_1675"></a>连接：连接字符串片段的数组</h4> 
<p>似乎以前的方法每次添加一个片段到<code>str</code>时都会创建一个新的字符串。旧的 JavaScript 引擎是这样做的，这意味着您可以通过首先将所有片段收集到一个数组中，然后作为最后一步连接它们来提高字符串连接的性能：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token operator">&gt;</span> arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'Say hello '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> arr<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">' times fast'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">&gt;</span> arr<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token string">'Say hello 7 times fast'</span>
</code></pre> 
<p>然而，较新的引擎通过<code>+</code>优化字符串连接，并在内部使用类似的方法。因此，在这些引擎上，加号运算符的速度更快。</p> 
<h3><a id="_1692"></a>字符串函数</h3> 
<p>函数<code>String</code>可以以两种方式调用：</p> 
<p><code>String(value)</code></p> 
<p>作为普通函数，它将<code>value</code>转换为原始字符串（请参阅<a href="ch12.html#tostring" rel="nofollow" title="转换为字符串">转换为字符串</a>）：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token number">123</span><span class="token punctuation">)</span>
<span class="token string">'123'</span>
<span class="token operator">&gt;</span> <span class="token keyword">typeof</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span>  <span class="token comment">// no change</span>
<span class="token string">'string'</span>
</code></pre> 
<p><code>new String(str)</code></p> 
<p>作为构造函数，它创建<code>String</code>的新实例（请参阅<a href="ch08.html#wrapper_objects" rel="nofollow" title="原始值的包装对象">原始值的包装对象</a>），一个包装<code>str</code>的对象（非字符串被强制转换为字符串）。例如：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token keyword">typeof</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span>
<span class="token string">'object'</span>
</code></pre> 
<p>前一种调用是常见的。</p> 
<h3><a id="_1718"></a>字符串构造函数方法</h3> 
<p><code>String.fromCharCode(codeUnit1, codeUnit2, ...)</code> 生成一个字符串，其字符由 16 位无符号整数<code>codeUnit1</code>，<code>codeUnit2</code>等指定的 UTF-16 代码单元组成。例如：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">(</span><span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span>
<span class="token string">'abc'</span>
</code></pre> 
<p>如果要将数字数组转换为字符串，可以通过<code>apply()</code>（请参阅<a href="ch15.html#functional_apply" rel="nofollow" title="func.apply(thisValue, argArray">func.apply(thisValue, argArray)</a>）来实现：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> String<span class="token punctuation">.</span><span class="token function">fromCharCode</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token string">'abc'</span>
</code></pre> 
<p><code>String.fromCharCode()</code>的反函数是<code>String.prototype.charCodeAt()</code>。</p> 
<h3><a id="_1736"></a>字符串实例属性长度</h3> 
<p><code>length</code>属性指示字符串中的 JavaScript 字符数，并且是不可变的：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'abc'</span><span class="token punctuation">.</span>length
<span class="token number">3</span>
</code></pre> 
<h3><a id="_1745"></a>字符串原型方法</h3> 
<p>原始字符串的所有原始字符串方法都存储在<code>String.prototype</code>中（参见<a href="ch08.html#primitive_methods_via_wrappers" rel="nofollow" title="原始通过包装器借用其方法">原始通过包装器借用其方法</a>）。接下来，我描述了它们如何用于原始字符串，而不是<code>String</code>的实例。</p> 
<h4><a id="_1749"></a>提取子字符串</h4> 
<p>以下方法从接收者中提取子字符串：</p> 
<p><code>String.prototype.charAt(pos)</code></p> 
<p>返回位置<code>pos</code>处的字符。例如：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'abc'</span><span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token string">'b'</span>
</code></pre> 
<p>以下两个表达式返回相同的结果，但一些较旧的 JavaScript 引擎只支持使用<code>charAt()</code>来访问字符：</p> 
<pre><code class="prism language-js">str<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span>
str<span class="token punctuation">[</span>n<span class="token punctuation">]</span>
</code></pre> 
<p><code>String.prototype.charCodeAt(pos)</code></p> 
<p>返回 JavaScript 字符（UTF-16 代码单元；参见第二十四章）在位置<code>pos</code>处的代码（一个 16 位无符号整数）。</p> 
<p>这是如何创建字符代码数组的：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'abc'</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> x<span class="token punctuation">.</span><span class="token function">charCodeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span> <span class="token number">97</span><span class="token punctuation">,</span> <span class="token number">98</span><span class="token punctuation">,</span> <span class="token number">99</span> <span class="token punctuation">]</span>
</code></pre> 
<p><code>charCodeAt()</code>的反函数是<code>String.fromCharCode()</code>。</p> 
<p><code>String.prototype.slice(start, end?)</code></p> 
<p>返回从位置<code>start</code>开始到位置<code>end</code>之前的子字符串。这两个参数都可以是负数，然后它们的长度将被添加到它们中：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'abc'</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token string">'c'</span>
<span class="token operator">&gt;</span> <span class="token string">'abc'</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token string">'b'</span>
<span class="token operator">&gt;</span> <span class="token string">'abc'</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token string">'bc'</span>
</code></pre> 
<p><code>String.prototype.substring(start, end?)</code></p> 
<p>应该避免使用<code>slice()</code>，它类似，但可以处理负位置，并且在各个浏览器中实现更一致。</p> 
<p><code>String.prototype.split(separator?, limit?)</code></p> 
<p>提取由<code>separator</code>分隔的接收者的子字符串，并将它们作为数组返回。该方法有两个参数：</p> 
<ul><li> <p><code>separator</code>：要么是一个字符串，要么是一个正则表达式。如果缺失，将返回完整的字符串，包裹在一个数组中。</p> </li><li> <p><code>limit</code>：如果给定，返回的数组最多包含<code>limit</code>个元素。</p> </li></ul> 
<p>以下是一些示例：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'a,  b,c, d'</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span>  <span class="token comment">// string</span>
<span class="token punctuation">[</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'  b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">' d'</span> <span class="token punctuation">]</span>
<span class="token operator">&gt;</span> <span class="token string">'a,  b,c, d'</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">,</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>  <span class="token comment">// simple regular expression</span>
<span class="token punctuation">[</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'  b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">' d'</span> <span class="token punctuation">]</span>
<span class="token operator">&gt;</span> <span class="token string">'a,  b,c, d'</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">, *</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>   <span class="token comment">// more complex regular expression</span>
<span class="token punctuation">[</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'d'</span> <span class="token punctuation">]</span>
<span class="token operator">&gt;</span> <span class="token string">'a,  b,c, d'</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">, *</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment">// setting a limit</span>
<span class="token punctuation">[</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span> <span class="token punctuation">]</span>
<span class="token operator">&gt;</span> <span class="token string">'test'</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment">// no separator provided</span>
<span class="token punctuation">[</span> <span class="token string">'test'</span> <span class="token punctuation">]</span>
</code></pre> 
<p>如果有一个组，那么匹配项也会作为数组元素返回：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'a,  b  ,  '</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(,)</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
<span class="token punctuation">[</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">'  b  '</span><span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">'  '</span> <span class="token punctuation">]</span>
<span class="token operator">&gt;</span> <span class="token string">'a,  b  ,  '</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex"> *(,) *</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
<span class="token punctuation">[</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">,</span> <span class="token string">''</span> <span class="token punctuation">]</span>
</code></pre> 
<p>使用<code>''</code>（空字符串）作为分隔符，以产生一个包含字符串字符的数组：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'abc'</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span> <span class="token punctuation">]</span>
</code></pre> 
<h4><a id="_1838"></a>转换</h4> 
<p>前一节是关于提取子字符串，而这一节是关于将给定的字符串转换为新字符串。这些方法通常如下使用：</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> str <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>换句话说，原始字符串在（非破坏性地）转换后被丢弃：</p> 
<p><code>String.prototype.trim()</code></p> 
<p>从字符串的开头和结尾删除所有空格：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'\r\nabc \t'</span><span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'abc'</span>
</code></pre> 
<p><code>String.prototype.concat(str1?, str2?, ...)</code></p> 
<p>返回接收者和<code>str1</code>、<code>str2</code>等的连接：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'hello'</span><span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'world'</span><span class="token punctuation">,</span> <span class="token string">'!'</span><span class="token punctuation">)</span>
<span class="token string">'hello world!'</span>
</code></pre> 
<p><code>String.prototype.toLowerCase()</code></p> 
<p>创建一个新字符串，其中包含所有原始字符串的字符转换为小写：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'MJÖLNIR'</span><span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'mjölnir'</span>
</code></pre> 
<p><code>String.prototype.toLocaleLowerCase()</code></p> 
<p>与<code>toLowerCase()</code>相同，但遵守当前区域设置的规则。根据 ECMAScript 规范：“只有在少数情况下（如土耳其语）语言的规则与常规 Unicode 大小写映射冲突时才会有差异。”</p> 
<p><code>String.prototype.toUpperCase()</code></p> 
<p>创建一个新字符串，其中包含所有原始字符串的字符转换为大写：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'mjölnir'</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token string">'MJÖLNIR'</span>
</code></pre> 
<p><code>String.prototype.toLocaleUpperCase()</code></p> 
<p>与<code>toUpperCase()</code>相同，但遵守当前区域设置的规则。</p> 
<h4><a id="_1892"></a>搜索和比较</h4> 
<p>以下方法用于搜索和比较字符串：</p> 
<p><code>String.prototype.indexOf(searchString, position?)</code></p> 
<p>从<code>position</code>（默认为 0）开始搜索<code>searchString</code>。它返回<code>searchString</code>被找到的位置，或者-1（如果找不到）：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'aXaX'</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'X'</span><span class="token punctuation">)</span>
<span class="token number">1</span>
<span class="token operator">&gt;</span> <span class="token string">'aXaX'</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'X'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token number">3</span>
</code></pre> 
<p>请注意，当涉及在字符串中查找文本时，正则表达式同样有效。例如，以下两个表达式是等价的：</p> 
<pre><code class="prism language-js">str<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'abc'</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span>
<span class="token operator">/</span>abc<span class="token operator">/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span>
</code></pre> 
<p><code>String.prototype.lastIndexOf(searchString, position?)</code></p> 
<p>从<code>position</code>（默认为末尾）开始向后搜索<code>searchString</code>。它返回<code>searchString</code>被找到的位置，或者-1（如果找不到）：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'aXaX'</span><span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'X'</span><span class="token punctuation">)</span>
<span class="token number">3</span>
<span class="token operator">&gt;</span> <span class="token string">'aXaX'</span><span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token string">'X'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token number">1</span>
</code></pre> 
<p><code>String.prototype.localeCompare(other)</code></p> 
<p>对字符串与<code>other</code>进行区域敏感比较。它返回一个数字：</p> 
<ul><li> <p>&lt; 0 如果字符串在<code>other</code>之前</p> </li><li> <p>= 0 如果字符串等同于<code>other</code></p> </li><li> 
  <blockquote> 
   <p>如果字符串在<code>other</code>之后</p> 
  </blockquote> </li></ul> 
<p>例如：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'apple'</span><span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span><span class="token string">'banana'</span><span class="token punctuation">)</span>
<span class="token operator">-</span><span class="token number">2</span>
<span class="token operator">&gt;</span> <span class="token string">'apple'</span><span class="token punctuation">.</span><span class="token function">localeCompare</span><span class="token punctuation">(</span><span class="token string">'apple'</span><span class="token punctuation">)</span>
<span class="token number">0</span>
</code></pre> 
<h4><a id="_1944"></a>警告</h4> 
<p>并非所有 JavaScript 引擎都正确实现了这种方法。有些只是基于比较运算符。然而，ECMAScript 国际化 API（参见<a href="ch30.html#i18n_api" rel="nofollow" title="ECMAScript 国际化 API">ECMAScript 国际化 API</a>）提供了一个基于 Unicode 的实现。也就是说，如果引擎中有这个 API，<code>localeCompare()</code>将起作用。</p> 
<p>如果支持，<code>localeCompare()</code>比比较运算符更适合比较字符串。请参阅<a href="ch12.html#comparing_strings" rel="nofollow" title="比较字符串">比较字符串</a>了解更多信息。</p> 
<h4><a id="_1950"></a>使用正则表达式进行测试、匹配和替换</h4> 
<p>以下方法适用于正则表达式：</p> 
<p><code>String.prototype.search(regexp)</code>（在<a href="ch19.html#String.prototype.search" rel="nofollow" title="字符串原型搜索：有匹配的索引是什么？">字符串原型搜索：有匹配的索引是什么？</a>中更详细地解释）</p> 
<p>返回<code>regexp</code>在接收者中匹配的第一个索引（如果没有匹配，则返回-1）：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'-yy-xxx-y-'</span><span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">x+</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
<span class="token number">4</span>
</code></pre> 
<p><code>String.prototype.match(regexp)</code>（在<a href="ch19.html#String.prototype.match" rel="nofollow" title="字符串原型匹配：捕获组或返回所有匹配的子字符串">字符串原型匹配：捕获组或返回所有匹配的子字符串</a>中更详细地解释）</p> 
<p>匹配给定的正则表达式与接收者。如果未设置<code>regexp</code>的标志<code>/g</code>，则返回第一个匹配的匹配对象：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'-abb--aaab-'</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(a+)b</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span>
<span class="token punctuation">[</span> <span class="token string">'ab'</span><span class="token punctuation">,</span>
  <span class="token string">'a'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">'-abb--aaab-'</span> <span class="token punctuation">]</span>
</code></pre> 
<p>如果标志<code>/g</code>被设置，那么所有完整的匹配（第 0 组）将以数组的形式返回：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'-abb--aaab-'</span><span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(a+)b</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">)</span>
<span class="token punctuation">[</span> <span class="token string">'ab'</span><span class="token punctuation">,</span> <span class="token string">'aaab'</span> <span class="token punctuation">]</span>
</code></pre> 
<p><code>String.prototype.replace(search, replacement)</code>（在<a href="ch19.html#String.prototype.replace" rel="nofollow" title="字符串原型替换：搜索和替换">字符串原型替换：搜索和替换</a>中更详细地解释）</p> 
<p>搜索<code>search</code>并用<code>replacement</code>替换它。<code>search</code>可以是一个字符串或一个正则表达式，<code>replacement</code>可以是一个字符串或一个函数。除非您使用一个设置了标志<code>/g</code>的正则表达式作为<code>search</code>，否则只会替换第一个出现的：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'iixxxixx'</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">'i'</span><span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">)</span>
<span class="token string">'oixxxixx'</span>
<span class="token operator">&gt;</span> <span class="token string">'iixxxixx'</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">i</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">)</span>
<span class="token string">'oixxxixx'</span>
<span class="token operator">&gt;</span> <span class="token string">'iixxxixx'</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">i</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'o'</span><span class="token punctuation">)</span>
<span class="token string">'ooxxxoxx'</span>
</code></pre> 
<p>替换字符串中的美元符号（<code>$</code>）允许您引用完整的匹配或捕获的组：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token string">'iixxxixx'</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">i+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'($&amp;)'</span><span class="token punctuation">)</span> <span class="token comment">// complete match</span>
<span class="token string">'(ii)xxx(i)xx'</span>
<span class="token operator">&gt;</span> <span class="token string">'iixxxixx'</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">(i+)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">'($1)'</span><span class="token punctuation">)</span> <span class="token comment">// group 1</span>
<span class="token string">'(ii)xxx(i)xx'</span>
</code></pre> 
<p>您还可以通过函数计算替换：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token keyword">function</span> <span class="token function">repl</span><span class="token punctuation">(</span><span class="token parameter">all</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token string">'('</span><span class="token operator">+</span>all<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">')'</span> <span class="token punctuation">}</span>
<span class="token operator">&gt;</span> <span class="token string">'axbbyyxaa'</span><span class="token punctuation">.</span><span class="token function">repl</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">a+|b+</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> replacement<span class="token punctuation">)</span>
<span class="token string">'(A)x(BB)yyx(AA)'</span>
</code></pre> 
<hr> 
<p>¹⁴ 严格来说，JavaScript 字符串由一系列 UTF-16 代码单元组成。也就是说，JavaScript 字符是 Unicode 代码单元（参见第二十四章）。</p> 
<h3><a id="_2017"></a>第十三章：语句</h3> 
<blockquote> 
 <p>原文：<a href="https://exploringjs.com/es5/ch13.html" rel="nofollow">13. Statements</a></p> 
 <p>译者：<a href="https://github.com/wizardforcel">飞龙</a></p> 
 <p>协议：<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="nofollow">CC BY-NC-SA 4.0</a></p> 
</blockquote> 
<p>本章涵盖了 JavaScript 的语句：变量声明、循环、条件语句等。</p> 
<h3><a id="_2028"></a>声明和赋值变量</h3> 
<p><code>var</code>用于<em>声明</em>一个变量，它创建变量并使您能够使用它。等号（<code>=</code>）用于给它赋值：</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> foo<span class="token punctuation">;</span>
foo <span class="token operator">=</span> <span class="token string">'abc'</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>var</code>还允许您将前面的两个语句合并为一个：</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token string">'abc'</span><span class="token punctuation">;</span>
</code></pre> 
<p>最后，您还可以将多个<code>var</code>语句合并为一个：</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> x<span class="token punctuation">,</span> y<span class="token operator">=</span><span class="token number">123</span><span class="token punctuation">,</span> z<span class="token punctuation">;</span>
</code></pre> 
<p>了解有关变量如何工作的更多信息，请阅读第十六章。</p> 
<h3><a id="_2051"></a>循环和条件语句的主体</h3> 
<p>复合语句，如循环和条件语句，嵌入了一个或多个“主体”——例如，<code>while</code>循环：</p> 
<pre><code class="prism language-js"><span class="token keyword">while</span> <span class="token punctuation">(</span>«condition»<span class="token punctuation">)</span>
    «statement»
</code></pre> 
<p>对于<code>«statement»</code>主体，您有选择。您可以使用单个语句：</p> 
<pre><code class="prism language-js"><span class="token keyword">while</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> x<span class="token operator">--</span><span class="token punctuation">;</span>
</code></pre> 
<p>或者您可以使用一个块（它算作一个单独的语句）：</p> 
<pre><code class="prism language-js"><span class="token keyword">while</span> <span class="token punctuation">(</span>x <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    x<span class="token operator">--</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>如果要使主体包含多个语句，您需要使用一个块。除非完整的复合语句可以写在一行中，否则我建议使用一个块。</p> 
<h3><a id="_2076"></a>循环</h3> 
<p>本节探讨了 JavaScript 的循环语句。</p> 
<h4><a id="_2080"></a>与循环一起使用的机制</h4> 
<p>以下机制可以与所有循环一起使用：</p> 
<p><code>break ⟦«label»⟧</code></p> 
<p>退出循环。</p> 
<p><code>continue ⟦«label»⟧</code></p> 
<p>停止当前循环迭代，并立即继续下一个。</p> 
<p>标签</p> 
<p>标签是一个标识符，后面跟着一个冒号。在循环前，标签允许您即使从嵌套在其中的循环中也可以中断或继续该循环。在块的前面，您可以跳出该块。在这两种情况下，标签的名称成为<code>break</code>或<code>continue</code>的参数。这是一个打破块的例子：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">findEvenNumber</span><span class="token punctuation">(</span><span class="token parameter">arr</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">loop</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// label</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">var</span> elem <span class="token operator">=</span> arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>elem <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Found: '</span> <span class="token operator">+</span> elem<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span> loop<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'No even number found.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'DONE'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_2112"></a>当</h4> 
<p>一个<code>while</code>循环：</p> 
<pre><code class="prism language-js"><span class="token keyword">while</span> <span class="token punctuation">(</span>«condition»<span class="token punctuation">)</span>
    «statement»
</code></pre> 
<p>只要<code>condition</code>成立，就执行<code>statement</code>。如果<code>condition</code>始终为<code>true</code>，则会得到一个无限循环：</p> 
<pre><code class="prism language-js"><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token operator">...</span> <span class="token punctuation">}</span>
</code></pre> 
<p>在以下示例中，我们删除数组的所有元素并将它们记录到控制台：</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>arr<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这是输出：</p> 
<pre><code class="prism language-js">a
b
c
</code></pre> 
<h4><a id="dowhile_2144"></a>do-while</h4> 
<p>一个<code>do-while</code>循环：</p> 
<pre><code class="prism language-js"><span class="token keyword">do</span> «statement»
<span class="token keyword">while</span> <span class="token punctuation">(</span>«condition»<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>至少执行<code>statement</code>一次，然后只要<code>condition</code>成立。例如：</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> line<span class="token punctuation">;</span>
<span class="token keyword">do</span> <span class="token punctuation">{<!-- --></span>
    line <span class="token operator">=</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">'Enter a number:'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^[0-9]+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_2162"></a>为了</h4> 
<p>在<code>for</code>循环中：</p> 
<pre><code class="prism language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span>⟦«init»⟧<span class="token punctuation">;</span> ⟦«condition»⟧<span class="token punctuation">;</span> ⟦«post_iteration»⟧<span class="token punctuation">)</span>
    «statement»
</code></pre> 
<p><code>init</code>在循环之前执行一次，只要<code>condition</code>为<code>true</code>，循环就会继续。您可以在<code>init</code>中使用<code>var</code>声明变量，但是这些变量的作用域始终是完整的周围函数。<code>post_iteration</code>在循环的每次迭代之后执行。考虑到所有这些，前面的循环等同于以下<code>while</code>循环：</p> 
<pre><code class="prism language-js">«init»<span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>«condition»<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    «statement»
    «post_iteration»<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>以下示例是迭代数组的传统方法（其他可能性在<a href="ch18.html#array_iteration" rel="nofollow" title="最佳实践：迭代数组">最佳实践：迭代数组</a>中描述）：</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>arr<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>如果您省略头部的所有部分，<code>for</code>循环将变得无限：</p> 
<pre><code class="prism language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_2198"></a>对于</h4> 
<p>一个<code>for-in</code>循环：</p> 
<pre><code class="prism language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span>«variable» <span class="token keyword">in</span> «object»<span class="token punctuation">)</span>
    «statement»
</code></pre> 
<p>遍历<code>object</code>的所有属性键，包括继承的属性。但是，标记为不可枚举的属性将被忽略（参见<a href="ch17_split_000.html#property_attributes" rel="nofollow" title="属性属性和属性描述符">属性属性和属性描述符</a>）。以下规则适用于<code>for-in</code>循环：</p> 
<ul><li> <p>您可以使用<code>var</code>声明变量，但是这些变量的作用域始终是完整的周围函数。</p> </li><li> <p>在迭代期间可以删除属性。</p> </li></ul> 
<h5><a id="_forin_2213"></a>最佳实践：不要对数组使用 for-in</h5> 
<p>不要使用<code>for-in</code>来遍历数组。首先，它遍历索引，而不是值：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> arr<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token number">0</span>
<span class="token number">1</span>
<span class="token number">2</span>
</code></pre> 
<p>其次，它还遍历所有（非索引）属性键。以下示例说明了当您向数组添加属性<code>foo</code>时会发生什么：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token keyword">var</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span> <span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'c'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> arr<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> arr<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token number">0</span>
<span class="token number">1</span>
<span class="token number">2</span>
foo
</code></pre> 
<p>因此，最好使用普通的<code>for</code>循环或数组方法<code>forEach()</code>（参见<a href="ch18.html#array_iteration" rel="nofollow" title="最佳实践：迭代数组">最佳实践：迭代数组</a>）。</p> 
<h5><a id="_forin_2239"></a>最佳实践：小心使用对象的 for-in</h5> 
<p><code>for-in</code>循环遍历<em>所有</em>（可枚举）属性，包括继承的属性。这可能不是您想要的。让我们使用以下构造函数来说明问题：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">Person</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Person</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">describe</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token string">'Name: '</span><span class="token operator">+</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>Person</code>的实例从<code>Person.prototype</code>继承了属性<code>describe</code>，这是由<code>for-in</code>看到的：</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">'Jane'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> person<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这是输出：</p> 
<pre><code class="prism language-js">name
describe
</code></pre> 
<p>通常，使用<code>for-in</code>的最佳方法是通过<code>hasOwnProperty()</code>跳过继承的属性：</p> 
<pre><code class="prism language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> person<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>person<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这是输出：</p> 
<pre><code class="prism language-js">name
</code></pre> 
<p>还有一个最后的警告：<code>person</code>可能有一个<code>hasOwnProperty</code>属性，这将阻止检查起作用。为了安全起见，您必须直接引用通用方法（参见<a href="ch17_split_001.html#generic_method" rel="nofollow" title="通用方法：从原型中借用方法">通用方法：从原型中借用方法</a>）<code>Object.prototype.hasOwnProperty</code>：</p> 
<pre><code class="prism language-js"><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> key <span class="token keyword">in</span> person<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>person<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>还有其他更舒适的方法可以遍历属性键，这些方法在<a href="ch17_split_000.html#object_iteration" rel="nofollow" title="最佳实践：遍历自有属性">最佳实践：遍历自有属性</a>中有描述。</p> 
<h4><a id="_2296"></a>对于每个-在</h4> 
<p>这个循环只存在于 Firefox 上。不要使用它。</p> 
<h3><a id="_2300"></a>条件</h3> 
<p>本节涵盖了 JavaScript 的条件语句。</p> 
<h4><a id="ifthenelse_2304"></a>if-then-else</h4> 
<p>在<code>if-then-else</code>语句中：</p> 
<pre><code class="prism language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>«condition»<span class="token punctuation">)</span>
    «then_branch»
⟦<span class="token keyword">else</span>
    «else_branch»⟧
</code></pre> 
<p><code>then_branch</code>和<code>else_branch</code>可以是单个语句或语句块（参见<a href="ch13.html#loops_conditionals_bodies" rel="nofollow" title="循环和条件的主体">循环和条件的主体</a>）。</p> 
<h5><a id="_if__2317"></a>链接 if 语句</h5> 
<p>您可以链接几个<code>if</code>语句：</p> 
<pre><code class="prism language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>s1 <span class="token operator">&gt;</span> s2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>s1 <span class="token operator">&lt;</span> s2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>请注意，在前面的例子中，所有的<code>else</code>分支都是单个语句（<code>if</code>语句）。只允许<code>else</code>分支为块的编程语言需要一些类似<code>else-if</code>分支的东西来进行链接。</p> 
<h5><a id="_else_2333"></a>陷阱：悬空的 else</h5> 
<p>以下示例的<code>else</code>分支被称为“悬空”，因为不清楚它属于两个<code>if</code>语句中的哪一个：</p> 
<pre><code class="prism language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>«cond1»<span class="token punctuation">)</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>«cond2»<span class="token punctuation">)</span> «stmt1» <span class="token keyword">else</span> «stmt2»
</code></pre> 
<p>这是一个简单的规则：使用大括号。前面的片段等同于以下代码（在这里很明显<code>else</code>属于谁）：</p> 
<pre><code class="prism language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>«cond1»<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>«cond2»<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        «stmt1»
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        «stmt2»
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="switch_2353"></a>switch</h4> 
<p>一个<code>switch</code>语句：</p> 
<pre><code class="prism language-js"><span class="token keyword">switch</span> <span class="token punctuation">(</span>«expression»<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">case</span> <span class="token literal-property property">«label1_1»</span><span class="token operator">:</span>
    <span class="token keyword">case</span> <span class="token literal-property property">«label1_2»</span><span class="token operator">:</span>
        <span class="token operator">...</span>
        «statements1»
        ⟦<span class="token keyword">break</span><span class="token punctuation">;</span>⟧
    <span class="token keyword">case</span> <span class="token literal-property property">«label2_1»</span><span class="token operator">:</span>
    <span class="token keyword">case</span> <span class="token literal-property property">«label2_2»</span><span class="token operator">:</span>
        <span class="token operator">...</span>
        «statements2»
        ⟦<span class="token keyword">break</span><span class="token punctuation">;</span>⟧
    <span class="token operator">...</span>
    ⟦<span class="token keyword">default</span><span class="token operator">:</span>
        «statements_default»
        ⟦<span class="token keyword">break</span><span class="token punctuation">;</span>⟧⟧
<span class="token punctuation">}</span>
</code></pre> 
<p>评估<code>expression</code>，然后跳转到与结果匹配的<code>case</code>子句。如果没有匹配的标签，<code>switch</code>会跳转到<code>default</code>子句（如果存在）或者不执行任何操作。</p> 
<p><code>case</code>后的“操作数”可以是任何表达式；它通过<code>===</code>与<code>switch</code>的参数进行比较。</p> 
<p>如果不使用终止语句结束子句，执行将继续到下一个子句。最常用的终止语句是<code>break</code>。但是<code>return</code>和<code>throw</code>也可以工作，尽管它们通常不仅仅离开<code>switch</code>语句。</p> 
<p>以下示例说明了如果使用<code>throw</code>或<code>return</code>，则不需要<code>break</code>：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">divide</span><span class="token punctuation">(</span><span class="token parameter">dividend<span class="token punctuation">,</span> divisor</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>divisor<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
            <span class="token keyword">throw</span> <span class="token string">'Division by zero'</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">return</span> dividend <span class="token operator">/</span> divisor<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在这个例子中，没有<code>default</code>子句。因此，如果<code>fruit</code>不匹配任何<code>case</code>标签，则什么也不会发生：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">useFruit</span><span class="token punctuation">(</span><span class="token parameter">fruit</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>fruit<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token string">'apple'</span><span class="token operator">:</span>
            <span class="token function">makeCider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">'grape'</span><span class="token operator">:</span>
            <span class="token function">makeWine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token comment">// neither apple nor grape: do nothing</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在这里，有多个连续的<code>case</code>标签：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">categorizeColor</span><span class="token punctuation">(</span><span class="token parameter">color</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> result<span class="token punctuation">;</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>color<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token string">'red'</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token string">'yellow'</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token string">'blue'</span><span class="token operator">:</span>
            result <span class="token operator">=</span> <span class="token string">'Primary color: '</span><span class="token operator">+</span>color<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">'or'</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token string">'green'</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token string">'violet'</span><span class="token operator">:</span>
            result <span class="token operator">=</span> <span class="token string">'Secondary color: '</span><span class="token operator">+</span>color<span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token string">'black'</span><span class="token operator">:</span>
        <span class="token keyword">case</span> <span class="token string">'white'</span><span class="token operator">:</span>
            result <span class="token operator">=</span> <span class="token string">'Not a color'</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">throw</span> <span class="token string">'Illegal argument: '</span><span class="token operator">+</span>color<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这个例子演示了<code>case</code>后面的值可以是任意表达式：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> x <span class="token operator">&lt;</span> y<span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> x <span class="token operator">===</span> y<span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>前面的<code>switch</code>语句通过遍历<code>case</code>子句来寻找其参数<code>true</code>的匹配项。如果其中一个<code>case</code>表达式求值为<code>true</code>，则执行相应的<code>case</code>主体。因此，前面的代码等同于以下<code>if</code>语句：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">&lt;</span> y<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">===</span> y<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>通常应该更喜欢后一种解决方案；它更加自解释。</p> 
<h3><a id="with_2469"></a><code>with</code>语句</h3> 
<p>本节解释了<code>with</code>语句在 JavaScript 中的工作原理以及为什么不鼓励使用它。</p> 
<h4><a id="_2473"></a>语法和语义</h4> 
<p><code>with</code>语句的语法如下：</p> 
<pre><code class="prism language-js"><span class="token keyword">with</span> <span class="token punctuation">(</span>«object»<span class="token punctuation">)</span>
    «statement»
</code></pre> 
<p>它将<code>object</code>的属性转换为<code>statement</code>的局部变量。例如：</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">first</span><span class="token operator">:</span> <span class="token string">'John'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">with</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello '</span><span class="token operator">+</span>first<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Hello John</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>它的预期用途是在多次访问对象时避免冗余。以下是一个带有冗余的代码示例：</p> 
<pre><code class="prism language-js">foo<span class="token punctuation">.</span>bar<span class="token punctuation">.</span>baz<span class="token punctuation">.</span>bla   <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
foo<span class="token punctuation">.</span>bar<span class="token punctuation">.</span>baz<span class="token punctuation">.</span>yadda <span class="token operator">=</span> <span class="token string">'abc'</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>with</code>使这更短：</p> 
<pre><code class="prism language-js"><span class="token keyword">with</span> <span class="token punctuation">(</span>foo<span class="token punctuation">.</span>bar<span class="token punctuation">.</span>baz<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    bla   <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
    yadda <span class="token operator">=</span> <span class="token string">'abc'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="with_2507"></a><code>with</code>语句已被弃用</h4> 
<p>通常不鼓励使用<code>with</code>语句（下一节解释了原因）。例如，在严格模式下是禁止的：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token string">'use strict'</span><span class="token punctuation">;</span> <span class="token keyword">with</span> <span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token literal-property property">SyntaxError</span><span class="token operator">:</span> strict mode code may not contain <span class="token string">'with'</span> statements
</code></pre> 
<h5><a id="with_2516"></a>避免使用<code>with</code>语句的技巧</h5> 
<p>避免这样的代码：</p> 
<pre><code class="prism language-js"><span class="token comment">// Don't do this:</span>
<span class="token keyword">with</span> <span class="token punctuation">(</span>foo<span class="token punctuation">.</span>bar<span class="token punctuation">.</span>baz<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello '</span><span class="token operator">+</span>first<span class="token operator">+</span><span class="token string">' '</span><span class="token operator">+</span>last<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>而是使用一个短名称的临时变量：</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> b <span class="token operator">=</span> foo<span class="token punctuation">.</span>bar<span class="token punctuation">.</span>baz<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello '</span><span class="token operator">+</span>b<span class="token punctuation">.</span>first<span class="token operator">+</span><span class="token string">' '</span><span class="token operator">+</span>b<span class="token punctuation">.</span>last<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>如果您不想将临时变量<code>b</code>暴露给当前作用域，可以使用 IIFE（参见<a href="ch16.html#iife" rel="nofollow" title="通过 IIFE 引入新作用域">通过 IIFE 引入新作用域</a>）：</p> 
<pre><code class="prism language-js"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> b <span class="token operator">=</span> foo<span class="token punctuation">.</span>bar<span class="token punctuation">.</span>baz<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello '</span><span class="token operator">+</span>b<span class="token punctuation">.</span>first<span class="token operator">+</span><span class="token string">' '</span><span class="token operator">+</span>b<span class="token punctuation">.</span>last<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>您还可以选择将要访问的对象作为 IIFE 的参数：</p> 
<pre><code class="prism language-js"><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">b</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello '</span><span class="token operator">+</span>b<span class="token punctuation">.</span>first<span class="token operator">+</span><span class="token string">' '</span><span class="token operator">+</span>b<span class="token punctuation">.</span>last<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span>foo<span class="token punctuation">.</span>bar<span class="token punctuation">.</span>baz<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_2551"></a>弃用的原因</h4> 
<p>要理解为什么<code>with</code>被弃用，请看下面的例子，并注意函数的参数如何完全改变了它的工作方式：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">logit</span><span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> opts</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">with</span> <span class="token punctuation">(</span>opts<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'msg: '</span><span class="token operator">+</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (1)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>如果<code>opts</code>有一个<code>msg</code>属性，那么第（1）行的语句不再访问参数<code>msg</code>。它访问属性：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">logit</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// parameter msg</span>
<span class="token literal-property property">msg</span><span class="token operator">:</span> hello
<span class="token operator">&gt;</span> <span class="token function">logit</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token string">'world'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// property opts.msg</span>
<span class="token literal-property property">msg</span><span class="token operator">:</span> world
</code></pre> 
<p><code>with</code>语句引起了三个问题：</p> 
<p>性能下降</p> 
<p>变量查找变慢，因为对象被临时插入到作用域链中。</p> 
<p>代码变得不太可预测</p> 
<p>您无法通过查看其语法环境（其词法上下文）来确定标识符指的是什么。根据<a href="http://bit.ly/1jCrTKj" rel="nofollow">Brendan Eich</a>的说法，这才是<code>with</code>被弃用的实际原因，而不是性能考虑：</p> 
<blockquote> 
 <p><code>with</code>违反了词法作用域，使程序分析（例如安全性）变得困难或不可行。</p> 
</blockquote> 
<p>缩小器（在第三十二章中描述）无法缩短变量名</p> 
<p>在<code>with</code>语句内部，无法静态确定名称是指变量还是属性。缩小器只能重命名变量。</p> 
<p>以下是<code>with</code>使代码变得脆弱的示例：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">someArray</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> values <span class="token operator">=</span> <span class="token operator">...</span><span class="token punctuation">;</span>  <span class="token comment">// (1)</span>
    <span class="token keyword">with</span> <span class="token punctuation">(</span>someArray<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        values<span class="token punctuation">.</span><span class="token function">someMethod</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// (2)</span>
        <span class="token operator">...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span>myData<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// (3)</span>
</code></pre> 
<p>即使您无法访问数组<code>myData</code>，也可以阻止行（3）中的函数调用起作用。</p> 
<p>如何？通过向<code>Array.prototype</code>添加一个属性<code>values</code>。例如：</p> 
<pre><code class="prism language-js"><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">values</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>现在，行（2）中的代码调用<code>someArray.values.someMethod()</code>而不是<code>values.someMethod()</code>。原因是，在<code>with</code>语句内，<code>values</code>现在指的是<code>someArray.values</code>，而不再是行（1）中的局部变量。</p> 
<p>这不仅仅是一个思想实验：数组方法<code>values()</code>已添加到 Firefox 并破坏了 TYPO3 内容管理系统。<a href="http://mzl.la/1jCrXti" rel="nofollow">Brandon Benvie 找出了问题所在</a>。</p> 
<h3><a id="_2615"></a>调试器语句</h3> 
<p><code>debugger</code>语句的语法如下：</p> 
<pre><code class="prism language-js"><span class="token keyword">debugger</span><span class="token punctuation">;</span>
</code></pre> 
<p>如果调试器处于活动状态，此语句将作为断点；如果没有，它没有可观察的效果。</p> 
<h3><a id="_2626"></a>第十四章：异常处理</h3> 
<blockquote> 
 <p>原文：<a href="https://exploringjs.com/es5/ch14.html" rel="nofollow">14. Exception Handling</a></p> 
 <p>译者：<a href="https://github.com/wizardforcel">飞龙</a></p> 
 <p>协议：<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="nofollow">CC BY-NC-SA 4.0</a></p> 
</blockquote> 
<p>本章描述了 JavaScript 的异常处理工作原理。它从异常处理的一般解释开始。</p> 
<h3><a id="_2637"></a>什么是异常处理？</h3> 
<p>在异常处理中，通常会将紧密耦合的语句分组在一起。如果在执行这些语句时，其中一个导致错误，那么继续执行剩余的语句就没有意义了。相反，您尝试尽可能优雅地从错误中恢复。这在某种程度上类似于事务（但没有原子性）。</p> 
<p>让我们来看一下没有异常处理的代码：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">processFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> fileNames <span class="token operator">=</span> <span class="token function">collectFileNames</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> entries <span class="token operator">=</span> <span class="token function">extractAllEntries</span><span class="token punctuation">(</span>fileNames<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">processEntries</span><span class="token punctuation">(</span>entries<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">extractAllEntries</span><span class="token punctuation">(</span><span class="token parameter">fileNames</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> allEntries <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileNames<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fileName</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">var</span> entry <span class="token operator">=</span> <span class="token function">extractOneEntry</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        allEntries<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// (1)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">extractOneEntry</span><span class="token punctuation">(</span><span class="token parameter">fileName</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> file <span class="token operator">=</span> <span class="token function">openFile</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// (2)</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
<span class="token operator">...</span>
</code></pre> 
<p>在（2）处的<code>openFile()</code>中，对错误做出反应的最佳方法是什么？显然，不应再执行语句（1）。但我们也不想中止<code>extractAllEntries()</code>。相反，足够的是跳过当前文件并继续下一个。为此，我们在先前的代码中添加异常处理：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">extractAllEntries</span><span class="token punctuation">(</span><span class="token parameter">fileNames</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> allEntries <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fileNames<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fileName</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">var</span> entry <span class="token operator">=</span> <span class="token function">extractOneEntry</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            allEntries<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>entry<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>exception<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// (2)</span>
            errorLog<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error in '</span><span class="token operator">+</span>fileName<span class="token punctuation">,</span> exception<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">extractOneEntry</span><span class="token punctuation">(</span><span class="token parameter">fileName</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> file <span class="token operator">=</span> <span class="token function">openFile</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">openFile</span><span class="token punctuation">(</span><span class="token parameter">fileName</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">exists</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Could not find file '</span><span class="token operator">+</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (1)</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>异常处理有两个方面：</p> 
<ol><li> <p>如果在发生错误的地方无法有意义地处理问题，请抛出异常。</p> </li><li> <p>找到可以处理错误的地方：捕获异常。</p> </li></ol> 
<p>在（1）处，以下结构是活动的：</p> 
<pre><code class="prism language-js">    <span class="token function">processFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token function">extractAllEntries</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
            fileNames<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
                <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">fileName</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token operator">...</span> <span class="token punctuation">}</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span> <span class="token operator">...</span> <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>exception<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token operator">...</span> <span class="token punctuation">}</span>
                        <span class="token function">extractOneEntry</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
                            <span class="token function">openFile</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
</code></pre> 
<p>在（1）处的<code>throw</code>语句沿着树向上走，并离开所有结构，直到遇到一个活动的<code>try</code>语句。然后调用该语句的<code>catch</code>块并将异常值传递给它。</p> 
<h3><a id="JavaScript__2709"></a>JavaScript 中的异常处理</h3> 
<p>JavaScript 中的异常处理与大多数编程语言一样：<code>try</code>语句将语句分组，并允许您拦截这些语句中的异常。</p> 
<h4><a id="throw_2713"></a>throw</h4> 
<p><code>throw</code>的语法如下：</p> 
<pre><code class="prism language-js"><span class="token keyword">throw</span> «value»<span class="token punctuation">;</span>
</code></pre> 
<p>任何 JavaScript 值都可以被抛出。为了简单起见，许多 JavaScript 程序只抛出字符串：</p> 
<pre><code class="prism language-js"><span class="token comment">// Don't do this</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>somethingBadHappened<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">throw</span> <span class="token string">'Something bad happened'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>不要这样做。JavaScript 有专门的异常对象构造函数（参见<a href="ch14.html#error_constructors" rel="nofollow" title="错误构造函数">错误构造函数</a>）。使用它们或对其进行子类化（参见第二十八章）。它们的优势是 JavaScript 会自动添加堆栈跟踪（在大多数引擎上），并且它们有额外的上下文特定属性的空间。最简单的解决方案是使用内置构造函数<code>Error()</code>：</p> 
<pre><code class="prism language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>somethingBadHappened<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Something bad happened'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="trycatchfinally_2738"></a>try-catch-finally</h4> 
<p><code>try-catch-finally</code>的语法如下。<code>try</code>是必需的，<code>catch</code>和<code>finally</code>至少有一个也必须存在：</p> 
<pre><code class="prism language-js"><span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
    «try_statements»
<span class="token punctuation">}</span>
<span class="token function">⟦catch</span> <span class="token punctuation">(</span><span class="token parameter">«exceptionVar»</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   «catch_statements»
<span class="token punctuation">}</span>⟧
⟦<span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
   «finally_statements»
<span class="token punctuation">}</span>⟧
</code></pre> 
<p>它是如何工作的：</p> 
<ul><li> <p><code>catch</code>捕获在<code>try_statements</code>中抛出的任何异常，无论是直接抛出还是在它们调用的函数中。提示：如果要区分不同类型的异常，可以使用<code>constructor</code>属性来切换异常的构造函数（请参阅<a href="ch17_split_001.html#switch_constructor" rel="nofollow" title="构造函数属性的用例">构造函数属性的用例</a>）。</p> </li><li> <p><code>finally</code>总是被执行，无论<code>try_statements</code>中发生了什么（或者它们调用的函数中发生了什么）。用它来进行应该始终执行的清理操作，无论<code>try_statements</code>中发生了什么：</p> <pre><code class="prism language-js"><span class="token keyword">var</span> resource <span class="token operator">=</span> <span class="token function">allocateResource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
    resource<span class="token punctuation">.</span><span class="token function">deallocate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> </li></ul> 
<p>如果<code>try_statements</code>中有一个<code>return</code>，则<code>try</code>块会在之后执行（在离开函数或方法之前立即执行；请参阅接下来的示例）。</p> 
<h4><a id="_2771"></a>例子</h4> 
<p>任何值都可以被抛出：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">throwIt</span><span class="token punctuation">(</span><span class="token parameter">exception</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">throw</span> exception<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Caught: '</span><span class="token operator">+</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>以下是交互：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">throwIt</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token literal-property property">Caught</span><span class="token operator">:</span> <span class="token number">3</span>
<span class="token operator">&gt;</span> <span class="token function">throwIt</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token literal-property property">Caught</span><span class="token operator">:</span> hello
<span class="token operator">&gt;</span> <span class="token function">throwIt</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'An error happened'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token literal-property property">Caught</span><span class="token operator">:</span> Error<span class="token operator">:</span> An error happened
</code></pre> 
<p><code>finally</code>总是被执行：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">throwsError</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Sorry...'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">cleansUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">throwsError</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Performing clean-up'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>以下是交互：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">cleansUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Performing clean<span class="token operator">-</span>up
<span class="token literal-property property">Error</span><span class="token operator">:</span> Sorry<span class="token operator">...</span>
</code></pre> 
<p><code>finally</code>在<code>return</code>语句之后执行：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">idLog</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">'result'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"FINALLY"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>以下是交互：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">idLog</span><span class="token punctuation">(</span><span class="token string">'arg'</span><span class="token punctuation">)</span>
arg
<span class="token constant">FINALLY</span>
<span class="token string">'result'</span>
</code></pre> 
<p>在执行<code>finally</code>之前，返回值已排队：</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">countUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> count<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{<!-- --></span>
        count<span class="token operator">++</span><span class="token punctuation">;</span>  <span class="token comment">// (1)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在执行语句（1）时，<code>count</code>的值已经排队返回：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">countUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">0</span>
<span class="token operator">&gt;</span> count
<span class="token number">1</span>
</code></pre> 
<h3><a id="_2863"></a>错误构造函数</h3> 
<p>ECMAScript 标准化以下错误构造函数。描述摘自 ECMAScript 5 规范：</p> 
<ul><li> <p><code>Error</code>是错误的通用构造函数。这里提到的所有其他错误构造函数都是子构造函数。</p> </li><li> <p><code>EvalError</code>“在本规范中当前未使用。此对象保留用于与本规范先前版本的兼容性。”</p> </li><li> <p><code>RangeError</code>“表示数字值超出了允许的范围。”例如：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token keyword">new</span> <span class="token class-name">Array</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token literal-property property">RangeError</span><span class="token operator">:</span> Invalid array length
</code></pre> </li><li> <p><code>ReferenceError</code>“表示检测到无效引用值。”通常，这是一个未知的变量。例如：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> unknownVariable
<span class="token literal-property property">ReferenceError</span><span class="token operator">:</span> unknownVariable is not defined
</code></pre> </li><li> <p><code>SyntaxError</code>“表示发生了解析错误”——例如，通过<code>eval()</code>解析代码时：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">'3 +'</span><span class="token punctuation">)</span>
<span class="token literal-property property">SyntaxError</span><span class="token operator">:</span> Unexpected end <span class="token keyword">of</span> file
</code></pre> </li><li> <p><code>TypeError</code>“表示操作数的实际类型与预期类型不同。”例如：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token keyword">undefined</span><span class="token punctuation">.</span>foo
<span class="token literal-property property">TypeError</span><span class="token operator">:</span> Cannot read property <span class="token string">'foo'</span> <span class="token keyword">of</span> <span class="token keyword">undefined</span>
</code></pre> </li><li> <p><code>URIError</code>“表示以与其定义不兼容的方式使用了全局 URI 处理函数之一。”例如：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">decodeURI</span><span class="token punctuation">(</span><span class="token string">'%2'</span><span class="token punctuation">)</span>
<span class="token literal-property property">URIError</span><span class="token operator">:</span> <span class="token constant">URI</span> malformed
</code></pre> </li></ul> 
<p>以下是错误的属性：</p> 
<p><code>message</code></p> 
<p>错误消息。</p> 
<p><code>name</code></p> 
<p>错误的名称。</p> 
<p><code>stack</code></p> 
<p>堆栈跟踪。这是非标准的，但在许多平台上都可用，例如 Chrome，Node.js 和 Firefox。</p> 
<h3><a id="_2920"></a>堆栈跟踪</h3> 
<p>错误的常见来源要么是外部的（错误的输入，丢失的文件等），要么是内部的（程序中的错误）。特别是在后一种情况下，您将收到意外的异常并需要进行调试。通常情况下，您没有运行调试器。对于“手动”调试，有两条信息是有帮助的：</p> 
<ol><li> <p>数据：变量具有什么值？</p> </li><li> <p>执行：异常发生在哪一行，活动的函数调用是什么？</p> </li></ol> 
<p>您可以将第一项（数据）的一些内容放入消息或异常对象的属性中。第二项（执行）在许多 JavaScript 引擎上通过<em>堆栈跟踪</em>得到支持，这是在创建异常对象时调用堆栈的快照。以下示例打印堆栈跟踪：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">catchit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">throwit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// print stack trace</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">throwit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>以下是交互：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">catchit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
Error
    at <span class="token function">throwit</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token operator">/</span>examples<span class="token operator">/</span>throwcatch<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">9</span><span class="token operator">:</span><span class="token number">11</span><span class="token punctuation">)</span>
    at <span class="token function">catchit</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token operator">/</span>examples<span class="token operator">/</span>throwcatch<span class="token punctuation">.</span>js<span class="token operator">:</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">)</span>
    at repl<span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span>
</code></pre> 
<h3><a id="_2953"></a>实现您自己的错误构造函数</h3> 
<p>如果您想要堆栈跟踪，您需要内置错误构造函数的服务。您可以使用现有构造函数并将自己的数据附加到其中。或者您可以创建一个子构造函数，其实例可以通过<code>instanceof</code>与其他错误构造函数的实例区分开来。然而，这样做（对于内置构造函数）是复杂的；请参阅第二十八章以了解如何做到这一点。</p> 
<h3><a id="_2958"></a>第十五章：函数</h3> 
<blockquote> 
 <p>原文：<a href="https://exploringjs.com/es5/ch15.html" rel="nofollow">15. Functions</a></p> 
 <p>译者：<a href="https://github.com/wizardforcel">飞龙</a></p> 
 <p>协议：<a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="nofollow">CC BY-NC-SA 4.0</a></p> 
</blockquote> 
<p>函数是可以调用的值。定义函数的一种方式称为<em>函数声明</em>。例如，以下代码定义了具有单个参数<code>x</code>的函数<code>id</code>：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><code>return</code>语句从<code>id</code>返回一个值。您可以通过提及其名称，后跟括号中的参数来调用函数：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
<span class="token string">'hello'</span>
</code></pre> 
<p>如果您从函数中不返回任何内容，则返回<code>undefined</code>（隐式）：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token punctuation">}</span>
<span class="token operator">&gt;</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">undefined</span>
</code></pre> 
<p>本节仅展示了定义函数的一种方式和调用函数的一种方式。其他方式将在后面描述。</p> 
<h3><a id="JavaScript__2992"></a>JavaScript 中函数的三种角色</h3> 
<p>一旦您像刚才所示那样定义了一个函数，它可以扮演多种角色：</p> 
<p>非方法函数（“普通函数”）</p> 
<p>您可以直接调用函数。然后它将作为普通函数工作。以下是一个示例调用：</p> 
<pre><code class="prism language-js"><span class="token function">id</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
</code></pre> 
<p>按照惯例，普通函数的名称以小写字母开头。</p> 
<p>构造函数</p> 
<p>您可以通过<code>new</code>运算符调用函数。然后它变成一个构造函数，一个对象的工厂。以下是一个示例调用：</p> 
<pre><code class="prism language-js"><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>按照惯例，构造函数的名称以大写字母开头。</p> 
<p>方法</p> 
<p>您可以将函数存储在对象的属性中，这将使其成为一个<em>方法</em>，您可以通过该对象调用它。以下是一个示例调用：</p> 
<pre><code class="prism language-js">obj<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>按照惯例，方法的名称以小写字母开头。</p> 
<p>非方法函数在本章中有解释；构造函数和方法在第十七章中有解释。</p> 
<h3><a id="_3028"></a>术语：“参数”与“参数”</h3> 
<p>术语<em>参数</em>和<em>参数</em>通常可以互换使用，因为上下文通常可以清楚地表明所需的含义。以下是区分它们的一个经验法则。</p> 
<ul><li> <p><em>参数</em>用于定义函数。它们也被称为形式参数和形式参数。在下面的例子中，<code>param1</code>和<code>param2</code>是参数：</p> <pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">param1<span class="token punctuation">,</span> param2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p><em>参数</em>用于调用函数。它们也被称为实际参数和实际参数。在下面的例子中，<code>3</code>和<code>7</code>是参数：</p> <pre><code class="prism language-js"><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> </li></ul> 
<h3><a id="_3046"></a>定义函数</h3> 
<p>本节描述了创建函数的三种方法：</p> 
<ul><li> <p>通过函数表达式</p> </li><li> <p>通过函数声明</p> </li><li> <p>通过构造函数<code>Function()</code></p> </li></ul> 
<p>所有函数都是对象，是<code>Function</code>的实例：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>id <span class="token keyword">instanceof</span> <span class="token class-name">Function</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> 
<p>因此，函数从<code>Function.prototype</code>获取它们的方法。</p> 
<h4><a id="_3067"></a>函数表达式</h4> 
<p>函数表达式产生一个值 - 一个函数对象。例如：</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> x <span class="token operator">+</span> y <span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>
</code></pre> 
<p>前面的代码将函数表达式的结果分配给变量<code>add</code>，并通过该变量调用它。函数表达式产生的值可以分配给一个变量（如最后一个例子中所示），作为另一个函数的参数传递，等等。因为普通函数表达式没有名称，它们也被称为<em>匿名函数表达式</em>。</p> 
<h5><a id="_3078"></a>命名函数表达式</h5> 
<p>您可以给函数表达式一个名称。<em>命名函数表达式</em>允许函数表达式引用自身，这对于自我递归很有用：</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> <span class="token function-variable function">fac</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">me</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> n <span class="token operator">*</span> <span class="token function">me</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">fac</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 6</span>
</code></pre> 
<h4><a id="_3093"></a>注意</h4> 
<p>命名函数表达式的名称只能在函数表达式内部访问：</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> <span class="token function-variable function">repeat</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">me</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> str</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> n <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">?</span> str <span class="token operator">+</span> <span class="token function">me</span><span class="token punctuation">(</span>n<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">repeat</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'Yeah'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// YeahYeahYeah</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>me<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError: me is not defined</span>
</code></pre> 
<h4><a id="_3105"></a>函数声明</h4> 
<p>以下是一个函数声明：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>前面的代码看起来像一个函数表达式，但它是一个语句（参见<a href="ch07.html#expr_vs_stmt" rel="nofollow" title="表达式与语句">表达式与语句</a>）。它大致相当于以下代码：</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> <span class="token function-variable function">add</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>换句话说，函数声明声明一个新变量，创建一个函数对象，并将其分配给变量。</p> 
<h4><a id="_3125"></a>函数构造函数</h4> 
<p>构造函数<code>Function()</code>评估存储在字符串中的 JavaScript 代码。例如，以下代码等同于前面的例子：</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> add <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'return x + y'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>然而，这种定义函数的方式很慢，并且将代码保留在字符串中（无法访问工具）。因此，最好尽可能使用函数表达式或函数声明。<a href="ch23.html#function_constructor" rel="nofollow" title="使用 new Function()评估代码">使用 new Function()评估代码</a>更详细地解释了<code>Function()</code>；它的工作方式类似于<code>eval()</code>。</p> 
<h3><a id="_3135"></a>提升</h3> 
<p><em>提升</em>意味着“移动到作用域的开头”。函数声明完全提升，变量声明只部分提升。</p> 
<p>函数声明完全被提升。这允许您在声明之前调用函数：</p> 
<pre><code class="prism language-js"><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// this function is hoisted</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>前面的代码之所以有效是因为 JavaScript 引擎将<code>foo</code>的声明移动到作用域的开头。它们执行代码，就好像它看起来是这样的：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>var</code>声明也会被提升，但只有声明，而不是使用它们进行的赋值。因此，类似于前面的例子使用<code>var</code>声明和函数表达式会导致错误：</p> 
<pre><code class="prism language-js"><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// TypeError: undefined is not a function</span>
<span class="token keyword">var</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>只有变量声明被提升。引擎执行前面的代码如下：</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> foo<span class="token punctuation">;</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// TypeError: undefined is not a function</span>
<span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_3176"></a>函数的名称</h3> 
<p>大多数 JavaScript 引擎支持函数对象的非标准属性<code>name</code>。函数声明具有它：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token keyword">function</span> <span class="token function">f1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
<span class="token operator">&gt;</span> f1<span class="token punctuation">.</span>name
<span class="token string">'f1'</span>
</code></pre> 
<p>匿名函数表达式的名称是空字符串：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token keyword">var</span> <span class="token function-variable function">f2</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> f2<span class="token punctuation">.</span>name
<span class="token string">''</span>
</code></pre> 
<p>然而，命名函数表达式确实有一个名称：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token keyword">var</span> <span class="token function-variable function">f3</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">myName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> f3<span class="token punctuation">.</span>name
<span class="token string">'myName'</span>
</code></pre> 
<p>函数的名称对于调试很有用。有些人总是给他们的函数表达式命名。</p> 
<h3><a id="_3204"></a>哪个更好：函数声明还是函数表达式？</h3> 
<p>您是否更喜欢以下的函数声明？</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">id</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>或者等效的<code>var</code>声明加上函数表达式的组合？</p> 
<pre><code class="prism language-js"><span class="token keyword">var</span> <span class="token function-variable function">id</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>它们基本上是相同的，但是函数声明比函数表达式有两个优点：</p> 
<ul><li> <p>它们被提升（参见<a href="ch15.html#function_hoisting" rel="nofollow" title="Hoisting">提升</a>），因此您可以在它们出现在源代码中之前调用它们。</p> </li><li> <p>它们有一个名称（请参见[函数的名称](ch15.html#function_names “函数的名称”））。但是，JavaScript 引擎正在更好地推断匿名函数表达式的名称。</p> </li></ul> 
<h3><a id="callapply_bind_3228"></a>对函数调用的更多控制：call()，apply()和 bind()</h3> 
<p><code>call()</code>，<code>apply()</code>和<code>bind()</code>是所有函数都具有的方法（请记住函数是对象，因此具有方法）。它们可以在调用方法时提供<code>this</code>的值，因此主要在面向对象的上下文中很有趣（参见[调用函数时设置 this：call()，apply()和 bind()](ch17_split_000.html#oop_call_apply_bind “调用函数时设置 this：call()，apply()和 bind()”））。本节解释了非方法的两种用法。</p> 
<h4><a id="funcapplythisValue_argArray_3232"></a>func.apply(thisValue, argArray)</h4> 
<p>此方法在调用函数<code>func</code>时使用<code>argArray</code>的元素作为参数；也就是说，以下两个表达式是等价的：</p> 
<pre><code class="prism language-js"><span class="token function">func</span><span class="token punctuation">(</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> arg3<span class="token punctuation">)</span>
<span class="token function">func</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> arg3<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p><code>thisValue</code>是在执行<code>func</code>时<code>this</code>的值。在非面向对象的设置中不需要它，因此在这里是<code>null</code>。</p> 
<p><code>apply()</code>在函数以类似数组的方式接受多个参数时很有用，但不是一个数组。</p> 
<p>由于<code>apply()</code>，我们可以使用<code>Math.max()</code>（参见[其他函数](ch21.html#Math_max “其他函数”））来确定数组的最大元素：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token number">33</span>
<span class="token operator">&gt;</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">,</span> <span class="token number">33</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token number">33</span>
</code></pre> 
<h4><a id="funcbindthisValue_arg1__argN_3254"></a>func.bind(thisValue, arg1, …, argN)</h4> 
<p>这执行<em>部分函数应用</em> - 创建一个新函数，该函数使用<code>thisValue</code>调用<code>func</code>，并使用以下参数：从<code>arg1</code>到<code>argN</code>，然后是新函数的实际参数。在以下非面向对象的设置中，不需要<code>thisValue</code>，这就是为什么它在这里是<code>null</code>。</p> 
<p>在这里，我们使用<code>bind()</code>创建一个新函数<code>plus1()</code>，它类似于<code>add()</code>，但只需要参数<code>y</code>，因为<code>x</code>始终为 1：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> plus1 <span class="token operator">=</span> <span class="token function">add</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">plus1</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 6</span>
</code></pre> 
<p>换句话说，我们已经创建了一个等效于以下代码的新函数：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">plus1</span><span class="token punctuation">(</span><span class="token parameter">y</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_3276"></a>处理缺失或额外的参数</h3> 
<p>JavaScript 不强制函数的 arity：您可以使用任意数量的实际参数调用它，而不受已定义的形式参数的限制。因此，实际参数和形式参数的数量可以以两种方式不同：</p> 
<p>实际参数比形式参数多</p> 
<p>额外的参数将被忽略，但可以通过特殊的类数组变量<code>arguments</code>检索（稍后讨论）。</p> 
<p>实际参数比形式参数少</p> 
<p>所有缺失的形式参数都具有值<code>undefined</code>。</p> 
<h4><a id="_arguments_3288"></a>按索引获取所有参数：特殊变量 arguments</h4> 
<p>特殊变量<code>arguments</code>仅存在于函数内（包括方法）。它是一个类似数组的对象，保存当前函数调用的所有实际参数。以下代码使用它：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">logArgs</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>arguments<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token string">'. '</span><span class="token operator">+</span>arguments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>以下是交互：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">logArgs</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token string">'world'</span><span class="token punctuation">)</span>
<span class="token number">0</span>\<span class="token punctuation">.</span> hello
<span class="token number">1</span>\<span class="token punctuation">.</span> world
</code></pre> 
<p><code>arguments</code>具有以下特点：</p> 
<ul><li>它类似于数组，但不是数组。一方面，它有一个<code>length</code>属性，可以通过索引读取和写入单个参数。</li></ul> 
<p>另一方面，<code>arguments</code>不是一个数组，它只是类似于数组。它没有任何数组方法（<code>slice()</code>，<code>forEach()</code>等）。幸运的是，您可以借用数组方法或将<code>arguments</code>转换为数组，如<a href="ch17_split_001.html#array-like_objects" rel="nofollow" title="类数组对象和通用方法">类数组对象和通用方法</a>中所述。</p> 
<ul><li> <p>它是一个对象，因此所有对象方法和运算符都是可用的。例如，你可以使用<code>in</code>运算符（<a href="ch17_split_000.html#iterate_and_detect_properties" rel="nofollow" title="Iteration and Detection of Properties">迭代和属性检测</a>）来检查<code>arguments</code>是否“有”给定的索引：</p> <pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token number">1</span> <span class="token keyword">in</span> arguments <span class="token punctuation">}</span>
<span class="token operator">&gt;</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">)</span>
<span class="token boolean">false</span>
<span class="token operator">&gt;</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">)</span>
<span class="token boolean">true</span>
</code></pre> </li></ul> 
<p>你可以以类似的方式使用<code>hasOwnProperty()</code>（<a href="ch17_split_000.html#iterate_and_detect_properties" rel="nofollow" title="Iteration and Detection of Properties">迭代和属性检测</a>）：</p> 
<pre><code class="prism language-js">    <span class="token operator">&gt;</span> <span class="token keyword">function</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> arguments<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
    <span class="token operator">&gt;</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">)</span>
    <span class="token boolean">true</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

#### 已弃用的</span><span class="token template-punctuation string">`</span></span>arguments<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">特性

严格模式下会取消</span><span class="token template-punctuation string">`</span></span>arguments<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">的一些更不寻常的特性：

+   </span><span class="token template-punctuation string">`</span></span>arguments<span class="token punctuation">.</span>callee<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">指的是当前函数。它主要用于在匿名函数中进行自递归，并且在严格模式下是不允许的。作为一种解决方法，可以使用命名函数表达式（参见[命名函数表达式](ch15.html#named_function_expression "Named function expressions")），它可以通过其名称引用自身。

+   在非严格模式下，如果更改参数，</span><span class="token template-punctuation string">`</span></span>arguments<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">会保持最新：

    </span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
    <span class="token keyword">function</span> <span class="token function">sloppyFunc</span><span class="token punctuation">(</span><span class="token parameter">param</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        param <span class="token operator">=</span> <span class="token string">'changed'</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">sloppyFunc</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// changed</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

但是在严格模式下不会进行这种更新：

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
    <span class="token keyword">function</span> <span class="token function">strictFunc</span><span class="token punctuation">(</span><span class="token parameter">param</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'use strict'</span><span class="token punctuation">;</span>
        param <span class="token operator">=</span> <span class="token string">'changed'</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">strictFunc</span><span class="token punctuation">(</span><span class="token string">'value'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// value</span>
    <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">

+   严格模式禁止对变量</span><span class="token template-punctuation string">`</span></span>arguments<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">进行赋值（例如通过</span><span class="token template-punctuation string">`</span></span>arguments<span class="token operator">++</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">）。仍然允许对元素和属性进行赋值。

### 强制参数，强制最小数量

有三种方法可以找出参数是否缺失。首先，你可以检查它是否为</span><span class="token template-punctuation string">`</span></span><span class="token keyword">undefined</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">：

</span><span class="token template-punctuation string">`</span></span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span>js
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">mandatory<span class="token punctuation">,</span> optional</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mandatory <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Missing parameter: mandatory'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>其次，你可以将参数解释为布尔值。然后<code>undefined</code>被视为<code>false</code>。但是，有一个警告：其他几个值也被视为<code>false</code>（参见<a href="ch10.html#truthy_falsy" rel="nofollow" title="Truthy and Falsy Values">真值和假值</a>），因此检查无法区分，比如<code>0</code>和缺少的参数：</p> 
<pre><code class="prism language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mandatory<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Missing parameter: mandatory'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>第三，你也可以检查<code>arguments</code>的长度以强制最小 arity：</p> 
<pre><code class="prism language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'You need to provide at least 1 argument'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>最后一种方法与其他方法不同：</p> 
<ul><li> <p>前两种方法不区分<code>foo()</code>和<code>foo(undefined)</code>。在这两种情况下，都会抛出异常。</p> </li><li> <p>第三种方法对<code>foo()</code>抛出异常，并对<code>foo(undefined)</code>将<code>optional</code>设置为<code>undefined</code>。</p> </li></ul> 
<h4><a id="_3395"></a>可选参数</h4> 
<p>如果参数是可选的，这意味着如果缺少参数，则给它一个默认值。与强制参数类似，有四种替代方案。</p> 
<p>首先，检查<code>undefined</code>：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">arg1<span class="token punctuation">,</span> arg2<span class="token punctuation">,</span> optional</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>optional <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        optional <span class="token operator">=</span> <span class="token string">'default value'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>其次，将<code>optional</code>解释为布尔值：</p> 
<pre><code class="prism language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>optional<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    optional <span class="token operator">=</span> <span class="token string">'default value'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>第三，你可以使用或运算符<code>||</code>（参见<a href="ch10.html#logical_or" rel="nofollow" title="Logical Or (||)">逻辑或(||)</a>），如果左操作数不是假值，则返回左操作数。否则，返回右操作数：</p> 
<pre><code class="prism language-js"><span class="token comment">// Or operator: use left operand if it isn't falsy</span>
optional <span class="token operator">=</span> optional <span class="token operator">||</span> <span class="token string">'default value'</span><span class="token punctuation">;</span>
</code></pre> 
<p>第四，你可以通过<code>arguments.length</code>检查函数的 arity：</p> 
<pre><code class="prism language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    optional <span class="token operator">=</span> <span class="token string">'default value'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>再次，最后一种方法与其他方法不同：</p> 
<ul><li> <p>前三种方法不区分<code>bar(1, 2)</code>和<code>bar(1, 2, undefined)</code>。在这两种情况下，<code>optional</code>都是<code>'default value'</code>。</p> </li><li> <p>第四种方法为<code>bar(1, 2)</code>设置<code>optional</code>为<code>'default value'</code>，并且对于<code>bar(1, 2, undefined)</code>保持<code>undefined</code>（即不变）。</p> </li></ul> 
<p>另一种可能性是将可选参数作为<em>命名参数</em>传递，作为对象字面量的属性（参见<a href="ch15.html#named_parameters" rel="nofollow" title="Named Parameters">命名参数</a>）。</p> 
<h4><a id="_3440"></a>模拟通过引用传递参数</h4> 
<p>在 JavaScript 中，你不能通过引用传递参数；也就是说，如果你将一个变量传递给一个函数，它的值会被复制并传递给函数（按值传递）。因此，函数无法更改变量。如果需要这样做，必须将变量的值封装在数组中。</p> 
<p>这个例子演示了一个增加变量的函数：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">incRef</span><span class="token punctuation">(</span><span class="token parameter">numberRef</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    numberRef<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> n <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">incRef</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>n<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 8</span>
</code></pre> 
<h4><a id="_3455"></a>陷阱：意外的可选参数</h4> 
<p>如果将函数<code>c</code>作为参数传递给另一个函数<code>f</code>，则必须了解两个签名：</p> 
<ul><li> <p><code>f</code>期望其参数具有的签名。<code>f</code>可能提供多个参数，而<code>c</code>可以决定使用其中的多少（如果有的话）。</p> </li><li> <p><code>c</code>的实际签名。例如，它可能支持可选参数。</p> </li></ul> 
<p>如果两者不一致，那么您可能会得到意想不到的结果：<code>c</code>可能具有您不知道的可选参数，并且会错误地解释<code>f</code>提供的附加参数。</p> 
<p>例如，考虑数组方法<code>map()</code>（参见[转换方法](ch18.html#Array.prototype.map “转换方法”）），其参数通常是一个带有单个参数的函数：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> x <span class="token operator">*</span> x <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">9</span> <span class="token punctuation">]</span>
</code></pre> 
<p>您可以将<code>parseInt()</code>作为参数传递给一个函数（参见[通过 parseInt()获取整数](ch11.html#parseInt “通过 parseInt()获取整数”））：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'1024'</span><span class="token punctuation">)</span>
<span class="token number">1024</span>
</code></pre> 
<p>您可能（错误地）认为<code>map()</code>只提供了一个参数，而<code>parseInt()</code>只接受了一个参数。然后您会对以下结果感到惊讶：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'3'</span> <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>parseInt<span class="token punctuation">)</span>
<span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">NaN</span><span class="token punctuation">,</span> <span class="token number">NaN</span> <span class="token punctuation">]</span>
</code></pre> 
<p><code>map()</code>期望具有以下签名的函数：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">element<span class="token punctuation">,</span> index<span class="token punctuation">,</span> array</span><span class="token punctuation">)</span>
</code></pre> 
<p>但是<code>parseInt()</code>具有以下签名：</p> 
<pre><code class="prism language-js"><span class="token function">parseInt</span><span class="token punctuation">(</span>string<span class="token punctuation">,</span> radix<span class="token operator">?</span><span class="token punctuation">)</span>
</code></pre> 
<p>因此，<code>map()</code>不仅填充了<code>string</code>（通过<code>element</code>），还填充了<code>radix</code>（通过<code>index</code>）。这意味着前面数组的值是这样产生的：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token number">1</span>
<span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token number">NaN</span>
<span class="token operator">&gt;</span> <span class="token function">parseInt</span><span class="token punctuation">(</span><span class="token string">'3'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token number">NaN</span>
</code></pre> 
<p>总之，对于您不确定其签名的函数和方法要小心。如果使用它们，明确指定接收了哪些参数并传递了哪些参数通常是有意义的。这是通过回调函数实现的：</p> 
<pre><code class="prism language-js"><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">,</span> <span class="token string">'3'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">]</span>
</code></pre> 
<h3><a id="_3516"></a>命名参数</h3> 
<p>在调用编程语言中的函数（或方法）时，您必须将实际参数（由调用者指定）映射到函数定义的形式参数。有两种常见的方法来实现这一点：</p> 
<ul><li> <p><em>位置参数</em>按位置进行映射。第一个实际参数映射到第一个形式参数，第二个实际参数映射到第二个形式参数，依此类推。</p> </li><li> <p><em>命名参数</em>使用<em>名称</em>（标签）执行映射。名称与函数定义中的形式参数相关联，并标记函数调用中的实际参数。命名参数出现的顺序并不重要，只要它们被正确标记。</p> </li></ul> 
<p>命名参数有两个主要好处：它们为函数调用中的参数提供描述，并且对于可选参数也很有效。我将首先解释这些好处，然后向您展示如何通过对象字面量在 JavaScript 中模拟命名参数。</p> 
<h4><a id="_3526"></a>命名参数作为描述</h4> 
<p>一旦函数有多个参数，您可能会对每个参数的用途感到困惑。例如，假设您有一个名为<code>selectEntries()</code>的函数，它从数据库中返回条目。给定以下函数调用：</p> 
<pre><code class="prism language-js"><span class="token function">selectEntries</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这两个数字代表什么？Python 支持命名参数，这使得很容易弄清楚发生了什么：</p> 
<pre><code class="prism language-js"><span class="token function">selectEntries</span><span class="token punctuation">(</span>start<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> step<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>  # Python syntax
</code></pre> 
<h4><a id="_3540"></a>可选命名参数</h4> 
<p>可选位置参数仅在末尾省略时才有效。在其他任何地方，您必须插入占位符，例如<code>null</code>，以便剩余参数具有正确的位置。对于可选命名参数，这不是问题。您可以轻松地省略其中任何一个。以下是一些示例：</p> 
<pre><code class="prism language-js"># Python syntax
<span class="token function">selectEntries</span><span class="token punctuation">(</span>step<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token function">selectEntries</span><span class="token punctuation">(</span>end<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> start<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token function">selectEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_JavaScript__3551"></a>在 JavaScript 中模拟命名参数</h4> 
<p>JavaScript 不像 Python 和许多其他语言那样原生支持命名参数。但是有一个相当优雅的模拟方法：通过对象字面量命名参数，作为单个实际参数传递。当您使用这种技术时，<code>selectEntries()</code>的调用看起来像：</p> 
<pre><code class="prism language-js"><span class="token function">selectEntries</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token literal-property property">step</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>该函数接收一个具有属性<code>start</code>、<code>end</code>和<code>step</code>的对象。您可以省略其中任何一个：</p> 
<pre><code class="prism language-js"><span class="token function">selectEntries</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">step</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">selectEntries</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">selectEntries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>您可以将<code>selectEntries()</code>实现如下：</p> 
<pre><code class="prism language-js"><span class="token keyword">function</span> <span class="token function">selectEntries</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    options <span class="token operator">=</span> options <span class="token operator">||</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> start <span class="token operator">=</span> options<span class="token punctuation">.</span>start <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> end <span class="token operator">=</span> options<span class="token punctuation">.</span>end <span class="token operator">||</span> <span class="token function">getDbLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> step <span class="token operator">=</span> options<span class="token punctuation">.</span>step <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>您还可以将位置参数与命名参数结合使用。后者通常出现在最后：</p> 
<pre><code class="prism language-js"><span class="token function">selectEntries</span><span class="token punctuation">(</span>posArg1<span class="token punctuation">,</span> posArg2<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">namedArg1</span><span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token literal-property property">namedArg2</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="_3585"></a>注意</h4> 
<p>在 JavaScript 中，这里显示的命名参数模式有时被称为<em>选项</em>或<em>选项对象</em>（例如，由 jQuery 文档）。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d636c3de72f77cdc840c92e7fa807959/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">大话 JavaScript（Speaking JavaScript）：第一章到第五章</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7ecfd6cd925361f0409a976baf112432/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">大话 JavaScript（Speaking JavaScript）：第二十六章到第三十章</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>