<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>quartz 常规增删改查方法 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="quartz 常规增删改查方法" />
<meta property="og:description" content="1.controller封装
@RestController @RequestMapping(&#34;/api&#34;) public class SchedulerJobController { private Logger logger = LoggerFactory.getLogger(SchedulerJobController.class); @Autowired private SchedulerJobService schedulerJobService; /** * 获取所有任务 * @param pageNum * @param pageSize * @return */ @PostMapping(&#34;/getAllJobs&#34;) public Map&lt;String, Object&gt; getAllJobs(@RequestParam(&#34;pageNum&#34;) Integer pageNum, @RequestParam(&#34;pageSize&#34;) Integer pageSize){ logger.info(&#34;getAllJobs：Request{pageNum：&#34; &#43; pageNum &#43; &#34;,pageSize：&#34; &#43; pageSize &#43; &#34;}&#34;); PageInfo&lt;ScheduleJob&gt; jobList = schedulerJobService.getAllScheduleJob(pageNum,pageSize); Map&lt;String, Object&gt; resultMap = new HashMap&lt;String, Object&gt;(); resultMap.put(&#34;errCode&#34;,200); resultMap.put(&#34;errMsg&#34;,&#34;查询任务成功&#34;); resultMap.put(&#34;jobList&#34;, jobList.getList()); resultMap.put(&#34;count&#34;, jobList.getTotal()); resultMap.put(&#34;begin&#34;, pageNum); logger.info(&#34;getAllJobs：Response&#34; &#43; JSON.toJSONString(resultMap)); return resultMap; } /** * 更新或者添加一个任务 * @param scheduleJobStr * @return * @throws Exception */ @PostMapping(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ef0bfc0e61b7a79ced8d89edb2449d9e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-04T21:16:50+08:00" />
<meta property="article:modified_time" content="2022-01-04T21:16:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">quartz 常规增删改查方法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>1.controller封装</p> 
<pre><code class="prism language-bash">@RestController
@RequestMapping<span class="token punctuation">(</span><span class="token string">"/api"</span><span class="token punctuation">)</span>
public class SchedulerJobController <span class="token punctuation">{<!-- --></span>

    private Logger logger <span class="token operator">=</span> LoggerFactory.getLogger<span class="token punctuation">(</span>SchedulerJobController.class<span class="token punctuation">)</span><span class="token punctuation">;</span>

    @Autowired
    private SchedulerJobService schedulerJobService<span class="token punctuation">;</span>

    /**
     * 获取所有任务
     * @param pageNum
     * @param pageSize
     * @return
     */
    @PostMapping<span class="token punctuation">(</span><span class="token string">"/getAllJobs"</span><span class="token punctuation">)</span>
    public Map<span class="token operator">&lt;</span>String, Object<span class="token operator">&gt;</span> getAllJobs<span class="token punctuation">(</span>@RequestParam<span class="token punctuation">(</span><span class="token string">"pageNum"</span><span class="token punctuation">)</span> Integer pageNum, @RequestParam<span class="token punctuation">(</span><span class="token string">"pageSize"</span><span class="token punctuation">)</span> Integer pageSize<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        logger.info<span class="token punctuation">(</span><span class="token string">"getAllJobs：Request{pageNum："</span> + pageNum + <span class="token string">",pageSize："</span> + pageSize + <span class="token string">"}"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        PageInfo<span class="token operator">&lt;</span>ScheduleJob<span class="token operator">&gt;</span> jobList <span class="token operator">=</span> schedulerJobService.getAllScheduleJob<span class="token punctuation">(</span>pageNum,pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Map<span class="token operator">&lt;</span>String, Object<span class="token operator">&gt;</span> resultMap <span class="token operator">=</span> new HashMap<span class="token operator">&lt;</span>String, Object<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap.put<span class="token punctuation">(</span><span class="token string">"errCode"</span>,200<span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap.put<span class="token punctuation">(</span><span class="token string">"errMsg"</span>,<span class="token string">"查询任务成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap.put<span class="token punctuation">(</span><span class="token string">"jobList"</span>, jobList.getList<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
        resultMap.put<span class="token punctuation">(</span><span class="token string">"count"</span>, jobList.getTotal<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
        resultMap.put<span class="token punctuation">(</span><span class="token string">"begin"</span>, pageNum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger.info<span class="token punctuation">(</span><span class="token string">"getAllJobs：Response"</span> + JSON.toJSONString<span class="token punctuation">(</span>resultMap<span class="token punctuation">))</span><span class="token punctuation">;</span>
        <span class="token builtin class-name">return</span> resultMap<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    /**
     * 更新或者添加一个任务
     * @param scheduleJobStr
     * @return
     * @throws Exception
     */
    @PostMapping<span class="token punctuation">(</span><span class="token string">"/saveOrUpdate"</span><span class="token punctuation">)</span>
    public Map<span class="token operator">&lt;</span>String, Object<span class="token operator">&gt;</span> addOrUpdateJob<span class="token punctuation">(</span>@RequestBody String scheduleJobStr<span class="token punctuation">)</span> throws Exception <span class="token punctuation">{<!-- --></span>
        logger.info<span class="token punctuation">(</span><span class="token string">"addOrUpdateJob：Request"</span> + scheduleJobStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Map<span class="token operator">&lt;</span>String,Object<span class="token operator">&gt;</span> scheduleMap <span class="token operator">=</span> JSON.parseObject<span class="token punctuation">(</span>scheduleJobStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        String branchOrgInfo <span class="token operator">=</span> scheduleMap.get<span class="token punctuation">(</span><span class="token string">"branchOrgInfo"</span><span class="token punctuation">)</span>.toString<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String settlement <span class="token operator">=</span> scheduleMap.get<span class="token punctuation">(</span><span class="token string">"settlement"</span><span class="token punctuation">)</span>.toString<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Map<span class="token operator">&lt;</span>String,String<span class="token operator">&gt;</span> paramMap <span class="token operator">=</span> new HashMap<span class="token operator">&lt;&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        paramMap.put<span class="token punctuation">(</span><span class="token string">"branchOrgCode"</span>,branchOrgInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        paramMap.put<span class="token punctuation">(</span><span class="token string">"settlement"</span>,settlement<span class="token punctuation">)</span><span class="token punctuation">;</span>
        scheduleMap.put<span class="token punctuation">(</span><span class="token string">"params"</span>,JSON.toJSONString<span class="token punctuation">(</span>paramMap<span class="token punctuation">))</span><span class="token punctuation">;</span>
        scheduleJobStr <span class="token operator">=</span> JSON.toJSONString<span class="token punctuation">(</span>scheduleMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ScheduleJob scheduleJob <span class="token operator">=</span> JSON.parseObject<span class="token punctuation">(</span>scheduleJobStr,ScheduleJob.class<span class="token punctuation">)</span><span class="token punctuation">;</span>
        int flag <span class="token operator">=</span> schedulerJobService.saveOrUpdate<span class="token punctuation">(</span>scheduleJob<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Map<span class="token operator">&lt;</span>String,Object<span class="token operator">&gt;</span> resultMap <span class="token operator">=</span> new HashMap<span class="token operator">&lt;</span>String,Object<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        if<span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            resultMap.put<span class="token punctuation">(</span><span class="token string">"errCode"</span>,200<span class="token punctuation">)</span><span class="token punctuation">;</span>
            resultMap.put<span class="token punctuation">(</span><span class="token string">"errMsg"</span>,<span class="token string">"添加任务成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            resultMap.put<span class="token punctuation">(</span><span class="token string">"errCode"</span>,200<span class="token punctuation">)</span><span class="token punctuation">;</span>
            resultMap.put<span class="token punctuation">(</span><span class="token string">"errMsg"</span>,<span class="token string">"更新任务成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        logger.info<span class="token punctuation">(</span><span class="token string">"addOrUpdateJob：success"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger.info<span class="token punctuation">(</span><span class="token string">"addOrUpdateJob：Response"</span> + JSON.toJSONString<span class="token punctuation">(</span>resultMap<span class="token punctuation">))</span><span class="token punctuation">;</span>
        <span class="token builtin class-name">return</span> resultMap<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    /**
     * 暂停任务
     * @param scheduleJobStr
     * @return
     * @throws SchedulerException
     */
    @PostMapping<span class="token punctuation">(</span><span class="token string">"/pausejob"</span><span class="token punctuation">)</span>
    public Map<span class="token operator">&lt;</span>String,Object<span class="token operator">&gt;</span> pauseJob<span class="token punctuation">(</span>@RequestBody String scheduleJobStr<span class="token punctuation">)</span> throws SchedulerException <span class="token punctuation">{<!-- --></span>
        logger.info<span class="token punctuation">(</span><span class="token string">"pausejob：Request"</span> + scheduleJobStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ScheduleJob scheduleJob <span class="token operator">=</span> JSON.parseObject<span class="token punctuation">(</span>scheduleJobStr,ScheduleJob.class<span class="token punctuation">)</span><span class="token punctuation">;</span>
        schedulerJobService.pauseJob<span class="token punctuation">(</span>scheduleJob.getJobName<span class="token punctuation">(</span><span class="token punctuation">)</span>,scheduleJob.getJobGroup<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
        Map<span class="token operator">&lt;</span>String,Object<span class="token operator">&gt;</span> resultMap <span class="token operator">=</span> new HashMap<span class="token operator">&lt;</span>String,Object<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap.put<span class="token punctuation">(</span><span class="token string">"errCode"</span>,200<span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap.put<span class="token punctuation">(</span><span class="token string">"errMsg"</span>,<span class="token string">"暂停任务成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger.info<span class="token punctuation">(</span><span class="token string">"pauseJob：Response"</span> + JSON.toJSONString<span class="token punctuation">(</span>resultMap<span class="token punctuation">))</span><span class="token punctuation">;</span>
        <span class="token builtin class-name">return</span> resultMap<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    /**
     * 删除任务
     * @param scheduleJobStr
     * @return
     * @throws SchedulerException
     */
    @PostMapping<span class="token punctuation">(</span><span class="token string">"/deleteJob"</span><span class="token punctuation">)</span>
    public Map<span class="token operator">&lt;</span>String,Object<span class="token operator">&gt;</span> deleteJob<span class="token punctuation">(</span>@RequestBody String scheduleJobStr<span class="token punctuation">)</span> throws SchedulerException <span class="token punctuation">{<!-- --></span>
        logger.info<span class="token punctuation">(</span><span class="token string">"deleteJob：Request"</span> + scheduleJobStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ScheduleJob scheduleJob <span class="token operator">=</span> JSON.parseObject<span class="token punctuation">(</span>scheduleJobStr,ScheduleJob.class<span class="token punctuation">)</span><span class="token punctuation">;</span>
        schedulerJobService.deleteJob<span class="token punctuation">(</span>scheduleJob.getJobName<span class="token punctuation">(</span><span class="token punctuation">)</span>,scheduleJob.getJobGroup<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
        Map<span class="token operator">&lt;</span>String,Object<span class="token operator">&gt;</span> resultMap <span class="token operator">=</span> new HashMap<span class="token operator">&lt;</span>String,Object<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap.put<span class="token punctuation">(</span><span class="token string">"errCode"</span>,200<span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap.put<span class="token punctuation">(</span><span class="token string">"errMsg"</span>,<span class="token string">"删除任务成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger.info<span class="token punctuation">(</span><span class="token string">"deleteJob：Response"</span> + JSON.toJSONString<span class="token punctuation">(</span>resultMap<span class="token punctuation">))</span><span class="token punctuation">;</span>
        <span class="token builtin class-name">return</span> resultMap<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    /**
     * 运行一次任务
     * @param scheduleJobStr
     * @return
     * @throws SchedulerException
     */
    @PostMapping<span class="token punctuation">(</span><span class="token string">"/runOneJob"</span><span class="token punctuation">)</span>
    public Map<span class="token operator">&lt;</span>String,Object<span class="token operator">&gt;</span> runJob<span class="token punctuation">(</span>@RequestBody String scheduleJobStr<span class="token punctuation">)</span> throws SchedulerException <span class="token punctuation">{<!-- --></span>
        logger.info<span class="token punctuation">(</span><span class="token string">"runOneJob：Request"</span> + scheduleJobStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ScheduleJob scheduleJob <span class="token operator">=</span> JSON.parseObject<span class="token punctuation">(</span>scheduleJobStr,ScheduleJob.class<span class="token punctuation">)</span><span class="token punctuation">;</span>
        schedulerJobService.runOneJob<span class="token punctuation">(</span>scheduleJob.getJobName<span class="token punctuation">(</span><span class="token punctuation">)</span>,scheduleJob.getJobGroup<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
        Map<span class="token operator">&lt;</span>String,Object<span class="token operator">&gt;</span> resultMap <span class="token operator">=</span> new HashMap<span class="token operator">&lt;</span>String,Object<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap.put<span class="token punctuation">(</span><span class="token string">"errCode"</span>,200<span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap.put<span class="token punctuation">(</span><span class="token string">"errMsg"</span>,<span class="token string">"运行一次任务成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger.info<span class="token punctuation">(</span><span class="token string">"runOneJob：Response"</span> + JSON.toJSONString<span class="token punctuation">(</span>resultMap<span class="token punctuation">))</span><span class="token punctuation">;</span>
        <span class="token builtin class-name">return</span> resultMap<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    /**
     * 重启一个定时任务
     * @param scheduleJobStr
     * @return
     * @throws SchedulerException
     */
    @PostMapping<span class="token punctuation">(</span><span class="token string">"/resumeJob"</span><span class="token punctuation">)</span>
    public Object resumeJob<span class="token punctuation">(</span>@RequestBody String scheduleJobStr<span class="token punctuation">)</span> throws SchedulerException <span class="token punctuation">{<!-- --></span>
        logger.info<span class="token punctuation">(</span><span class="token string">"resumeJob：Request"</span> + scheduleJobStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ScheduleJob scheduleJob <span class="token operator">=</span> JSON.parseObject<span class="token punctuation">(</span>scheduleJobStr,ScheduleJob.class<span class="token punctuation">)</span><span class="token punctuation">;</span>
        schedulerJobService.resumeJob<span class="token punctuation">(</span>scheduleJob.getJobName<span class="token punctuation">(</span><span class="token punctuation">)</span>,scheduleJob.getJobGroup<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
        Map<span class="token operator">&lt;</span>String,Object<span class="token operator">&gt;</span> resultMap <span class="token operator">=</span> new HashMap<span class="token operator">&lt;</span>String,Object<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap.put<span class="token punctuation">(</span><span class="token string">"errCode"</span>,200<span class="token punctuation">)</span><span class="token punctuation">;</span>
        resultMap.put<span class="token punctuation">(</span><span class="token string">"errMsg"</span>,<span class="token string">"重启任务成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger.info<span class="token punctuation">(</span><span class="token string">"resumeJob：Response"</span> + JSON.toJSONString<span class="token punctuation">(</span>resultMap<span class="token punctuation">))</span><span class="token punctuation">;</span>
        <span class="token builtin class-name">return</span> resultMap<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>2.service</p> 
<pre><code class="prism language-bash">public interface SchedulerJobService <span class="token punctuation">{<!-- --></span>

    PageInfo<span class="token operator">&lt;</span>ScheduleJob<span class="token operator">&gt;</span> getAllScheduleJob<span class="token punctuation">(</span>Integer pageNum, Integer pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>

    int saveOrUpdate<span class="token punctuation">(</span>ScheduleJob scheduleJob<span class="token punctuation">)</span> throws Exception<span class="token punctuation">;</span>

    public void pauseJob<span class="token punctuation">(</span>String jobName, String jobGroup<span class="token punctuation">)</span> throws SchedulerException<span class="token punctuation">;</span>

    public void deleteJob<span class="token punctuation">(</span>String jobName,String jobGroup<span class="token punctuation">)</span> throws SchedulerException<span class="token punctuation">;</span>

    public void runOneJob<span class="token punctuation">(</span>String jobName, String jobGroup<span class="token punctuation">)</span> throws SchedulerException<span class="token punctuation">;</span>

    public void resumeJob<span class="token punctuation">(</span>String jobName, String jobGroup<span class="token punctuation">)</span> throws SchedulerException<span class="token punctuation">;</span>

    void checkNotNull<span class="token punctuation">(</span>ScheduleJob scheduleJob<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-bash">@Service
@Transactional
public class SchedulerJobServiceImpl implements SchedulerJobService <span class="token punctuation">{<!-- --></span>

    private Logger logger <span class="token operator">=</span> LoggerFactory.getLogger<span class="token punctuation">(</span>SchedulerJobServiceImpl.class<span class="token punctuation">)</span><span class="token punctuation">;</span>

    @Autowired
    private SchedulerJobInService schedulerJobInService<span class="token punctuation">;</span>
    @Autowired
    private Scheduler scheduler<span class="token punctuation">;</span>

    @Override
    public PageInfo<span class="token operator">&lt;</span>ScheduleJob<span class="token operator">&gt;</span> getAllScheduleJob<span class="token punctuation">(</span>Integer pageNum, Integer pageSize<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        PageHelper.startPage<span class="token punctuation">(</span>pageNum,pageSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
        List<span class="token operator">&lt;</span>ScheduleJob<span class="token operator">&gt;</span> scheduleJobs <span class="token operator">=</span> schedulerJobInService.selectAllJobs<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        PageInfo<span class="token operator">&lt;</span>ScheduleJob<span class="token operator">&gt;</span> page <span class="token operator">=</span> new PageInfo<span class="token operator">&lt;</span>ScheduleJob<span class="token operator">&gt;</span><span class="token punctuation">(</span>scheduleJobs<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin class-name">return</span> page<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    @Override
    public int saveOrUpdate<span class="token punctuation">(</span>ScheduleJob scheduleJob<span class="token punctuation">)</span> throws Exception <span class="token punctuation">{<!-- --></span>
        int flag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        TriggerKey triggerKey <span class="token operator">=</span> TriggerKey.triggerKey<span class="token punctuation">(</span>scheduleJob.getJobGroup<span class="token punctuation">(</span><span class="token punctuation">)</span>,scheduleJob.getJobGroup<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
        CronTrigger cronTrigger <span class="token operator">=</span> <span class="token punctuation">(</span>CronTrigger<span class="token punctuation">)</span> scheduler.getTrigger<span class="token punctuation">(</span>triggerKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cronTrigger<span class="token operator">==</span>null<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            logger.info<span class="token punctuation">(</span><span class="token string">"添加任务----------------/addJob"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            addJob<span class="token punctuation">(</span>scheduleJob<span class="token punctuation">)</span><span class="token punctuation">;</span>
            flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>else <span class="token punctuation">{<!-- --></span>
            logger.info<span class="token punctuation">(</span><span class="token string">"更新任务----------------/updateJob"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            updateJobSchedule<span class="token punctuation">(</span>scheduleJob<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token builtin class-name">return</span> flag<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    @Override
    public void pauseJob<span class="token punctuation">(</span>String jobName, String jobGroup<span class="token punctuation">)</span> throws SchedulerException <span class="token punctuation">{<!-- --></span>
        logger.info<span class="token punctuation">(</span><span class="token string">"暂停任务----------------/pausejob"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        JobKey jobKey <span class="token operator">=</span> JobKey.jobKey<span class="token punctuation">(</span>jobGroup,jobGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ScheduleJob scheduleJob <span class="token operator">=</span> schedulerJobInService.selectByJobNameAngJobGroup<span class="token punctuation">(</span>jobName,jobGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
        scheduleJob.setJobStatus<span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        scheduler.pauseJob<span class="token punctuation">(</span>jobKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        schedulerJobInService.updateByPrimaryKeySelective<span class="token punctuation">(</span>scheduleJob<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    @Override
    public void deleteJob<span class="token punctuation">(</span>String jobName, String jobGroup<span class="token punctuation">)</span> throws SchedulerException <span class="token punctuation">{<!-- --></span>
        logger.info<span class="token punctuation">(</span><span class="token string">"删除任务----------------/deleteJob"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ScheduleJob jobKey <span class="token operator">=</span> new ScheduleJob<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jobKey.setJobName<span class="token punctuation">(</span>jobName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        jobKey.setJobGroup<span class="token punctuation">(</span>jobGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
        TriggerKey triggerKey <span class="token operator">=</span> TriggerKey.triggerKey<span class="token punctuation">(</span>jobGroup, jobGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
        // 停止触发器
        scheduler.pauseTrigger<span class="token punctuation">(</span>triggerKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        // 移除触发器
        scheduler.unscheduleJob<span class="token punctuation">(</span>triggerKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        // 删除任务
        scheduler.deleteJob<span class="token punctuation">(</span>JobKey.jobKey<span class="token punctuation">(</span>jobGroup, jobGroup<span class="token punctuation">))</span><span class="token punctuation">;</span>
        schedulerJobInService.deleteByJobNameAndJobGroup<span class="token punctuation">(</span>jobKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        logger.info<span class="token punctuation">(</span><span class="token string">"deleteJob:"</span> + JobKey.jobKey<span class="token punctuation">(</span>jobName<span class="token punctuation">))</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    @Override
    public void runOneJob<span class="token punctuation">(</span>String jobName, String jobGroup<span class="token punctuation">)</span> throws SchedulerException <span class="token punctuation">{<!-- --></span>
        logger.info<span class="token punctuation">(</span><span class="token string">"运行一次任务----------------/runOneJob"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        JobKey jobKey <span class="token operator">=</span> JobKey.jobKey<span class="token punctuation">(</span>jobGroup, jobGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ScheduleJob scheduleJob <span class="token operator">=</span> schedulerJobInService.selectByJobNameAngJobGroup<span class="token punctuation">(</span>jobName, jobGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
        scheduler.triggerJob<span class="token punctuation">(</span>jobKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        schedulerJobInService.updateByPrimaryKeySelective<span class="token punctuation">(</span>scheduleJob<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    @Override
    public void resumeJob<span class="token punctuation">(</span>String jobName, String jobGroup<span class="token punctuation">)</span> throws SchedulerException <span class="token punctuation">{<!-- --></span>
        logger.info<span class="token punctuation">(</span><span class="token string">"重启任务----------------/resumeJob"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        JobKey jobKey <span class="token operator">=</span> JobKey.jobKey<span class="token punctuation">(</span>jobGroup,jobGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ScheduleJob scheduleJob <span class="token operator">=</span> schedulerJobInService.selectByJobNameAngJobGroup<span class="token punctuation">(</span>jobName,jobGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
        scheduleJob.setJobStatus<span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        scheduler.resumeJob<span class="token punctuation">(</span>jobKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        schedulerJobInService.updateByPrimaryKeySelective<span class="token punctuation">(</span>scheduleJob<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    private void addJob<span class="token punctuation">(</span>ScheduleJob scheduleJob<span class="token punctuation">)</span> throws Exception<span class="token punctuation">{<!-- --></span>
        //校验参数
        checkNotNull<span class="token punctuation">(</span>scheduleJob<span class="token punctuation">)</span><span class="token punctuation">;</span>
        String cronExpression <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils.isBlank<span class="token punctuation">(</span>scheduleJob.getNextSchedulTime<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            cronExpression <span class="token operator">=</span> scheduleJob.getCronExpression<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            String nextSchedulTime <span class="token operator">=</span> scheduleJob.getNextSchedulTime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            logger.info<span class="token punctuation">(</span><span class="token string">"调度时间-----------------&gt;"</span> + nextSchedulTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
            String now <span class="token operator">=</span> DateUtil.formatDate<span class="token punctuation">(</span>new Date<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
            logger.info<span class="token punctuation">(</span><span class="token string">"当前时间-----------------&gt;"</span> + now<span class="token punctuation">)</span><span class="token punctuation">;</span>
            int index <span class="token operator">=</span> DateUtil.compareDate<span class="token punctuation">(</span>now, nextSchedulTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                logger.info<span class="token punctuation">(</span><span class="token string">"-----------------&gt;调度时间不能小于当前时间"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                throw new BusinessException<span class="token punctuation">(</span><span class="token number">9999</span>,<span class="token string">"调度时间不能小于当前时间"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            cronExpression <span class="token operator">=</span> DateUtil.getCron<span class="token punctuation">(</span>nextSchedulTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        logger.info<span class="token punctuation">(</span><span class="token string">"cron表达式："</span> + cronExpression<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils.isBlank<span class="token punctuation">(</span>cronExpression<span class="token punctuation">))</span><span class="token punctuation">{<!-- --></span>
            throw new BusinessException<span class="token punctuation">(</span><span class="token string">"CronExpression不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        scheduleJob.setCronExpression<span class="token punctuation">(</span>cronExpression<span class="token punctuation">)</span><span class="token punctuation">;</span>
        scheduleJob.setTriggerName<span class="token punctuation">(</span><span class="token string">"trigger"</span> + scheduleJob.getJobName<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
        scheduleJob.setTriggerGroup<span class="token punctuation">(</span>scheduleJob.getJobGroup<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
        scheduleJob.setJobStatus<span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        scheduleJob.setJobRunState<span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        //构建job信息
        JobDetail jobDetail <span class="token operator">=</span> JobBuilder.newJob<span class="token punctuation">(</span>getCls<span class="token punctuation">(</span>scheduleJob.getJobClassName<span class="token punctuation">(</span><span class="token punctuation">))</span>.getClass<span class="token punctuation">(</span><span class="token punctuation">))</span>
                .withIdentity<span class="token punctuation">(</span>scheduleJob.getJobGroup<span class="token punctuation">(</span><span class="token punctuation">)</span>,scheduleJob.getJobGroup<span class="token punctuation">(</span><span class="token punctuation">))</span>
                .withDescription<span class="token punctuation">(</span>scheduleJob.getRemark<span class="token punctuation">(</span><span class="token punctuation">))</span>
                .build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jobDetail.getJobDataMap<span class="token punctuation">(</span><span class="token punctuation">)</span>.put<span class="token punctuation">(</span><span class="token string">"scheduleJob"</span>,scheduleJob<span class="token punctuation">)</span><span class="token punctuation">;</span>
        //表达式调度构建器<span class="token punctuation">(</span>即任务执行的时间<span class="token punctuation">)</span>
        CronScheduleBuilder cronScheduleBuilder <span class="token operator">=</span> CronScheduleBuilder.cronSchedule<span class="token punctuation">(</span>cronExpression<span class="token punctuation">)</span><span class="token punctuation">;</span>
        //按新的cronExpression表达式构建一个新的trigger
        CronTrigger cronTrigger <span class="token operator">=</span> TriggerBuilder.newTrigger<span class="token punctuation">(</span><span class="token punctuation">)</span>
                .withIdentity<span class="token punctuation">(</span>scheduleJob.getJobGroup<span class="token punctuation">(</span><span class="token punctuation">)</span>,scheduleJob.getJobGroup<span class="token punctuation">(</span><span class="token punctuation">))</span>
                .withSchedule<span class="token punctuation">(</span>cronScheduleBuilder<span class="token punctuation">)</span>.build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        //传递的参数
        jobDetail.getJobDataMap<span class="token punctuation">(</span><span class="token punctuation">)</span>.put<span class="token punctuation">(</span><span class="token string">"jobTaskType"</span>, <span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jobDetail.getJobDataMap<span class="token punctuation">(</span><span class="token punctuation">)</span>.put<span class="token punctuation">(</span><span class="token string">"jobType"</span>, scheduleJob.getJobType<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
        jobDetail.getJobDataMap<span class="token punctuation">(</span><span class="token punctuation">)</span>.put<span class="token punctuation">(</span><span class="token string">"apiUrl"</span>, scheduleJob.getApiUrl<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
        jobDetail.getJobDataMap<span class="token punctuation">(</span><span class="token punctuation">)</span>.put<span class="token punctuation">(</span><span class="token string">"params"</span>, scheduleJob.getParams<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
        //交由Scheduler安排触发
        scheduler.scheduleJob<span class="token punctuation">(</span>jobDetail,cronTrigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
        schedulerJobInService.insertSelective<span class="token punctuation">(</span>scheduleJob<span class="token punctuation">)</span><span class="token punctuation">;</span>
        if<span class="token punctuation">(</span><span class="token string">"1"</span>.equals<span class="token punctuation">(</span>scheduleJob.getIsNowRun<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> // 如果是立即运行则首先触发一次任务
            JobKey key <span class="token operator">=</span> new JobKey<span class="token punctuation">(</span>scheduleJob.getJobGroup<span class="token punctuation">(</span><span class="token punctuation">)</span>, scheduleJob.getJobGroup<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
            scheduler.triggerJob<span class="token punctuation">(</span>key, jobDetail.getJobDataMap<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    private void updateJobSchedule<span class="token punctuation">(</span>ScheduleJob scheduleJob<span class="token punctuation">)</span> throws Exception<span class="token punctuation">{<!-- --></span>
        //校验参数
        checkNotNull<span class="token punctuation">(</span>scheduleJob<span class="token punctuation">)</span><span class="token punctuation">;</span>
        String cronExpression <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils.isBlank<span class="token punctuation">(</span>scheduleJob.getNextSchedulTime<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            cronExpression <span class="token operator">=</span> scheduleJob.getCronExpression<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            String nextSchedulTime <span class="token operator">=</span> scheduleJob.getNextSchedulTime<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            logger.info<span class="token punctuation">(</span><span class="token string">"调度时间-----------------&gt;"</span> + nextSchedulTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
            String now <span class="token operator">=</span> DateUtil.formatDate<span class="token punctuation">(</span>new Date<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
            logger.info<span class="token punctuation">(</span><span class="token string">"当前时间-----------------&gt;"</span> + now<span class="token punctuation">)</span><span class="token punctuation">;</span>
            int index <span class="token operator">=</span> DateUtil.compareDate<span class="token punctuation">(</span>now, nextSchedulTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                logger.info<span class="token punctuation">(</span><span class="token string">"------------------&gt;调度时间不能小于当前时间"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                throw new BusinessException<span class="token punctuation">(</span><span class="token number">9999</span>,<span class="token string">"调度时间不能小于当前时间"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            cronExpression <span class="token operator">=</span> DateUtil.getCron<span class="token punctuation">(</span>nextSchedulTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        logger.info<span class="token punctuation">(</span><span class="token string">"cron表达式："</span> + cronExpression<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils.isBlank<span class="token punctuation">(</span>cronExpression<span class="token punctuation">))</span><span class="token punctuation">{<!-- --></span>
            throw new BusinessException<span class="token punctuation">(</span><span class="token string">"CronExpression不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        scheduleJob.setCronExpression<span class="token punctuation">(</span>cronExpression<span class="token punctuation">)</span><span class="token punctuation">;</span>
        String jobName <span class="token operator">=</span> scheduleJob.getJobName<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String jobGroup <span class="token operator">=</span> scheduleJob.getJobGroup<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ScheduleJob job <span class="token operator">=</span> schedulerJobInService.selectByJobNameAngJobGroup<span class="token punctuation">(</span>jobName,jobGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
        if<span class="token punctuation">(</span>job <span class="token operator">==</span> null <span class="token operator">||</span> job.equals<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">))</span> <span class="token punctuation">{<!-- --></span>
            throw new BusinessException<span class="token punctuation">(</span><span class="token string">"null Job, please check it"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        scheduleJob.setJobId<span class="token punctuation">(</span>job.getJobId<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
        //移除任务
        TriggerKey triggerKey <span class="token operator">=</span> TriggerKey.triggerKey<span class="token punctuation">(</span>jobGroup, jobGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
        // 停止触发器
        scheduler.pauseTrigger<span class="token punctuation">(</span>triggerKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        // 移除触发器
        scheduler.unscheduleJob<span class="token punctuation">(</span>triggerKey<span class="token punctuation">)</span><span class="token punctuation">;</span>
        // 删除任务
        scheduler.deleteJob<span class="token punctuation">(</span>JobKey.jobKey<span class="token punctuation">(</span>jobGroup, jobGroup<span class="token punctuation">))</span><span class="token punctuation">;</span>
        //构建job信息
        JobDetail jobDetail <span class="token operator">=</span> JobBuilder.newJob<span class="token punctuation">(</span>getCls<span class="token punctuation">(</span>scheduleJob.getJobClassName<span class="token punctuation">(</span><span class="token punctuation">))</span>.getClass<span class="token punctuation">(</span><span class="token punctuation">))</span>
                .withIdentity<span class="token punctuation">(</span>jobGroup,jobGroup<span class="token punctuation">)</span>
                .withDescription<span class="token punctuation">(</span>scheduleJob.getRemark<span class="token punctuation">(</span><span class="token punctuation">))</span>
                .build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jobDetail.getJobDataMap<span class="token punctuation">(</span><span class="token punctuation">)</span>.put<span class="token punctuation">(</span><span class="token string">"scheduleJob"</span>,scheduleJob<span class="token punctuation">)</span><span class="token punctuation">;</span>
        //表达式调度构建器<span class="token punctuation">(</span>即任务执行的时间<span class="token punctuation">)</span>
        CronScheduleBuilder cronScheduleBuilder <span class="token operator">=</span> CronScheduleBuilder.cronSchedule<span class="token punctuation">(</span>cronExpression<span class="token punctuation">)</span><span class="token punctuation">;</span>
        //按新的cronExpression表达式构建一个新的trigger
        CronTrigger cronTrigger <span class="token operator">=</span> TriggerBuilder.newTrigger<span class="token punctuation">(</span><span class="token punctuation">)</span>
                .withIdentity<span class="token punctuation">(</span>jobGroup,jobGroup<span class="token punctuation">)</span>
                .withSchedule<span class="token punctuation">(</span>cronScheduleBuilder<span class="token punctuation">)</span>.build<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        //传递的参数
        jobDetail.getJobDataMap<span class="token punctuation">(</span><span class="token punctuation">)</span>.put<span class="token punctuation">(</span><span class="token string">"jobTaskType"</span>, <span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jobDetail.getJobDataMap<span class="token punctuation">(</span><span class="token punctuation">)</span>.put<span class="token punctuation">(</span><span class="token string">"jobType"</span>, scheduleJob.getJobType<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
        jobDetail.getJobDataMap<span class="token punctuation">(</span><span class="token punctuation">)</span>.put<span class="token punctuation">(</span><span class="token string">"apiUrl"</span>, scheduleJob.getApiUrl<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
        jobDetail.getJobDataMap<span class="token punctuation">(</span><span class="token punctuation">)</span>.put<span class="token punctuation">(</span><span class="token string">"params"</span>, scheduleJob.getParams<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
        //交由Scheduler安排触发
        scheduler.scheduleJob<span class="token punctuation">(</span>jobDetail,cronTrigger<span class="token punctuation">)</span><span class="token punctuation">;</span>
        scheduleJob.setJobStatus<span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        scheduleJob.setJobRunState<span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        schedulerJobInService.updateByPrimaryKeySelective<span class="token punctuation">(</span>scheduleJob<span class="token punctuation">)</span><span class="token punctuation">;</span>
        if<span class="token punctuation">(</span><span class="token string">"1"</span>.equals<span class="token punctuation">(</span>scheduleJob.getIsNowRun<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> // 如果是立即运行则首先触发一次任务
            JobKey key <span class="token operator">=</span> new JobKey<span class="token punctuation">(</span>jobGroup, jobGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>
            scheduler.triggerJob<span class="token punctuation">(</span>key, jobDetail.getJobDataMap<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    /**
     * 校验参数
     * @param scheduleJob
     */
    @Override
    public void checkNotNull<span class="token punctuation">(</span>ScheduleJob scheduleJob<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>scheduleJob<span class="token operator">==</span>null<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            throw new BusinessException<span class="token punctuation">(</span><span class="token string">"scheduleJob is null,Please check it"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>scheduleJob.getJobName<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span>null <span class="token operator">||</span> scheduleJob.getJobName<span class="token punctuation">(</span><span class="token punctuation">)</span>.equals<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">))</span><span class="token punctuation">{<!-- --></span>
            throw new BusinessException<span class="token punctuation">(</span><span class="token string">"the jobName of scheduleJob is null,Please check it"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>scheduleJob.getJobGroup<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span>null <span class="token operator">||</span> scheduleJob.getJobGroup<span class="token punctuation">(</span><span class="token punctuation">)</span>.equals<span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">))</span><span class="token punctuation">{<!-- --></span>
            throw new BusinessException<span class="token punctuation">(</span><span class="token string">"the jobGroup of scheduleJob is null,Please check it"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    /**
     * 根据类名称，通过反射得到该类，然后创建一个BaseJob的实例。
     * 由于NewJob和HelloJob都实现了BaseJob，
     * 所以这里不需要我们手动去判断。这里涉及到了一些java多态调用的机制
     *
     * @param classname
     * @return
     * @throws Exception
     */
    public static BaseJob getCls<span class="token punctuation">(</span>String classname<span class="token punctuation">)</span> throws Exception <span class="token punctuation">{<!-- --></span>
        Class<span class="token operator">&lt;</span>?<span class="token operator">&gt;</span> class1 <span class="token operator">=</span> Class.forName<span class="token punctuation">(</span>classname<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin class-name">return</span> <span class="token punctuation">(</span>BaseJob<span class="token punctuation">)</span>class1.newInstance<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/add6952a57818db4407d8a34eb55b868/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用MIB Builder 生成MIB文件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cd6eb5c78d0b54dacf551a410af2ba0c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">内网渗透工具——Natapp的注册和使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>