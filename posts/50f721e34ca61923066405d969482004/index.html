<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Nuxt3数据请求及封装 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Nuxt3数据请求及封装" />
<meta property="og:description" content="文章目录 前言一、Nuxt3中数据请求方式二、unjs/ofetch库三、请求方式之间的区别1. useAsyncData2. useFetch3. useLazyAsyncData 与 useLazyFetch 四、封装useFetch1. Nuxt3使用技巧①：Composables 目录自动导入②：定义 Runtime Config 公共变量③：定义env环境变量 2. 封装函数3. 调用 总结 前言 这篇文章记录一下Nuxt3网络请求的方法，结合了自己项目的需求对其中的数据请求进行了统一的封装，这样可以统一处理公共的请求逻辑，采用的是Nuxt3自带的useFetch方法。
一、Nuxt3中数据请求方式 Nuxt3提供了多种方法来处理应用程序中的数据获取：
$fetchuseFetchuseLazyFetchuseAsyncDatauseLazyAsyncData 二、unjs/ofetch库 Nuxt3 不推荐也没必要使用Axios进行网络请求，Axios本来是对 XMLHttpRequest 的封装，而现如今网络请求这种功能由 XMLHttpRequest 逐渐被 Fetch API 代替，浏览器已支持原生支持fetch，Node v17.5也引入了对fetch的原生支持。Nuxt3的官方团队将fetch进一步封装，封装的项目叫做ofetch，并且将其集成到Nuxt3中，就是开头提到的$fetch方法。
三、请求方式之间的区别 1. useAsyncData 需要提供一个用于缓存去重的 key 和数据请求的处理函数。
第一个参数是 key，但是即使你不传 key，Nuxt 也会根据文件名和行号帮你生成一个。
const { data, pending, error, refresh } = await useAsyncData( &#39;mountains&#39;, () =&gt; $fetch(&#39;https://api.nuxtjs.dev/mountains&#39;) ) 2. useFetch useFetch这个可组合函数提供了一个方便的包装器，用于useAsyncData和$fetch。它会自动生成基于URL和fetch选项的键，根据服务器路由提供请求URL的类型提示，并推断API响应类型。
对useFetch的多个调用，建议使用&lt;script setup&gt;，因为它消除了使用顶级等待的限制。
useFetch 是对 useAsyncData 的一层包装，可以理解为所有的都选择默认配置的useAsyncData 方法，useFetch(url)几乎等同于useAsyncData(url, () =&gt; $fetch(url))——它是最常见用例的开发人员语法糖。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/50f721e34ca61923066405d969482004/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-13T16:16:38+08:00" />
<meta property="article:modified_time" content="2023-11-13T16:16:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Nuxt3数据请求及封装</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_4" rel="nofollow">前言</a></li><li><a href="#Nuxt3_9" rel="nofollow">一、Nuxt3中数据请求方式</a></li><li><a href="#unjsofetch_17" rel="nofollow">二、unjs/ofetch库</a></li><li><a href="#_21" rel="nofollow">三、请求方式之间的区别</a></li><li><ul><li><a href="#1_useAsyncData_23" rel="nofollow">1. useAsyncData</a></li><li><a href="#2_useFetch_32" rel="nofollow">2. useFetch</a></li><li><a href="#3_useLazyAsyncData__useLazyFetch_44" rel="nofollow">3. useLazyAsyncData 与 useLazyFetch</a></li></ul> 
  </li><li><a href="#useFetch_47" rel="nofollow">四、封装useFetch</a></li><li><ul><li><a href="#1_Nuxt3_51" rel="nofollow">1. Nuxt3使用技巧</a></li><li><ul><li><a href="#Composables__52" rel="nofollow">①：Composables 目录自动导入</a></li><li><a href="#_Runtime_Config__57" rel="nofollow">②：定义 Runtime Config 公共变量</a></li><li><a href="#env_82" rel="nofollow">③：定义env环境变量</a></li></ul> 
   </li><li><a href="#2__100" rel="nofollow">2. 封装函数</a></li><li><a href="#3__172" rel="nofollow">3. 调用</a></li></ul> 
  </li><li><a href="#_196" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_4"></a>前言</h2> 
<p>这篇文章记录一下Nuxt3网络请求的方法，结合了自己项目的需求对其中的数据请求进行了统一的封装，这样可以统一处理公共的请求逻辑，采用的是Nuxt3自带的useFetch方法。</p> 
<hr> 
<h2><a id="Nuxt3_9"></a>一、Nuxt3中数据请求方式</h2> 
<p>Nuxt3提供了多种方法来处理应用程序中的数据获取：</p> 
<ul><li>$fetch</li><li>useFetch</li><li>useLazyFetch</li><li>useAsyncData</li><li>useLazyAsyncData</li></ul> 
<h2><a id="unjsofetch_17"></a>二、unjs/ofetch库</h2> 
<p>Nuxt3 不推荐也没必要使用Axios进行网络请求，Axios本来是对 XMLHttpRequest 的封装，而现如今网络请求这种功能由 XMLHttpRequest 逐渐被 <a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch" rel="nofollow">Fetch API</a> 代替，浏览器已支持原生支持fetch，Node v17.5也引入了对fetch的原生支持。Nuxt3的官方团队将fetch进一步封装，封装的项目叫做<a href="https://github.com/unjs/ofetch">ofetch</a>，并且将其集成到Nuxt3中，就是开头提到的<code>$fetch</code>方法。</p> 
<h2><a id="_21"></a>三、请求方式之间的区别</h2> 
<h3><a id="1_useAsyncData_23"></a>1. useAsyncData</h3> 
<p>需要提供一个用于缓存去重的 key 和数据请求的处理函数。<br> 第一个参数是 key，但是即使你不传 key，Nuxt 也会根据文件名和行号帮你生成一个。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> data<span class="token punctuation">,</span> pending<span class="token punctuation">,</span> error<span class="token punctuation">,</span> refresh <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">useAsyncData</span><span class="token punctuation">(</span>
  <span class="token string">'mountains'</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">$fetch</span><span class="token punctuation">(</span><span class="token string">'https://api.nuxtjs.dev/mountains'</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="2_useFetch_32"></a>2. useFetch</h3> 
<blockquote> 
 <p><code>useFetch</code>这个可组合函数提供了一个方便的包装器，用于useAsyncData和$fetch。它会自动生成基于URL和fetch选项的键，根据服务器路由提供请求URL的类型提示，并推断API响应类型。<br> 对useFetch的多个调用，建议使用<code>&lt;script setup&gt;</code>，因为它消除了使用顶级等待的限制。</p> 
</blockquote> 
<p>useFetch 是对 useAsyncData 的一层包装，可以理解为所有的都选择默认配置的useAsyncData 方法，useFetch(url)几乎等同于useAsyncData(url, () =&gt; $fetch(url))——它是最常见用例的开发人员语法糖。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> param1 <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">'value1'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> data<span class="token punctuation">,</span> pending<span class="token punctuation">,</span> error<span class="token punctuation">,</span> refresh <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">useFetch</span><span class="token punctuation">(</span><span class="token string">'https://api.nuxtjs.dev/mountains'</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">query</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> param1<span class="token punctuation">,</span> <span class="token literal-property property">param2</span><span class="token operator">:</span> <span class="token string">'value2'</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="3_useLazyAsyncData__useLazyFetch_44"></a>3. useLazyAsyncData 与 useLazyFetch</h3> 
<p>这两个Api分别对应useAsyncData和useFetch，用法一致，只是把配置选项中的 Lazy 设置成了true，即使用useLazyFetch 和 useLazyAsyncData 在客户端渲染时不会阻塞导航的跳转，这意味着你需要处理数据为null的情况，给 data 设置一个默认值；而在服务端渲染效果是一样的，还是会阻塞页面渲染。</p> 
<h2><a id="useFetch_47"></a>四、封装useFetch</h2> 
<p>由于<code>useFetch</code>已经是经过封装简化后的请求方式，所以基于useFetch方法进行进一步的封装，主要是添加全局的baseURL，还有添加了请求与响应拦截。这里按照实际项目需求来封装就好。</p> 
<p>封装前有几点 Nuxt3 的使用技巧介绍一下：</p> 
<h3><a id="1_Nuxt3_51"></a>1. Nuxt3使用技巧</h3> 
<h4><a id="Composables__52"></a>①：Composables 目录自动导入</h4> 
<blockquote> 
 <p>Nuxt 3使用composables/目录使用auto-imports自动将Vue组合导入到应用中!</p> 
</blockquote> 
<p>默认情况下Nuxt3会自动导入此目录下的第一级文件，所以将封装网络请求的函数写在此目录下并导出即可在项目内自由使用。</p> 
<h4><a id="_Runtime_Config__57"></a>②：定义 Runtime Config 公共变量</h4> 
<blockquote> 
 <p>useRuntimeConfig 用于在应用程序中公开配置变量。</p> 
</blockquote> 
<p>定义在客户端使用的公共变量：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineNuxtConfig</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">runtimeConfig</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// apiSecret 只能在服务器端上访问</span>
    <span class="token literal-property property">apiSecret</span><span class="token operator">:</span> <span class="token string">'123'</span><span class="token punctuation">,</span>
    <span class="token comment">// public 命名空间中定义的，在服务器端和客户端都可以普遍访问</span>
    <span class="token keyword">public</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">apiBase</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NUXT_PUBLIC_API_BASE</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>使用方式：</p> 
<pre><code class="prism language-javascript">  <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">useRuntimeConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> baseURL <span class="token operator">=</span> config<span class="token punctuation">.</span>public<span class="token punctuation">.</span>apiBase<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="env_82"></a>③：定义env环境变量</h4> 
<blockquote> 
 <p>在 production runtime时, 你应该使用平台环境变量，.env没有被使用 。</p> 
</blockquote> 
<p>在客户端直接使用 process.env 访问环境变量是拿不到.env里的内容的，在服务端node环境才可以，所以一定得配合useRuntimeConfig来使用.env里的配置。</p> 
<p>可以使用前缀为<code>NUXT_</code>的匹配环境变量名来更新运行时配置值。</p> 
<pre><code class="prism language-javascript"><span class="token comment">//.env.development</span>
<span class="token constant">NUXT_PUBLIC_API_BASE</span> <span class="token operator">=</span> <span class="token string">'https://api-test.com'</span>
</code></pre> 
<pre><code class="prism language-javascript"><span class="token comment">//.env.production</span>
<span class="token constant">NUXT_PUBLIC_API_BASE</span> <span class="token operator">=</span> <span class="token string">'https://api.com'</span>
</code></pre> 
<p>下面正式进入封装数据请求函数环节。</p> 
<h3><a id="2__100"></a>2. 封装函数</h3> 
<pre><code class="prism language-javascript"><span class="token comment">// composables/getData.ts</span>
<span class="token keyword">import</span> type <span class="token punctuation">{<!-- --></span> LocationQuery <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue-router'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> type <span class="token punctuation">{<!-- --></span> NitroFetchRequest <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'nitropack'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> type <span class="token punctuation">{<!-- --></span> FetchOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'ofetch'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> showToast <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vant'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> fs <span class="token keyword">from</span> <span class="token string">'fs'</span><span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">Params</span> <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> NitroFetchRequest<span class="token punctuation">;</span>
  <span class="token literal-property property">opts</span><span class="token operator">:</span> FetchOptions<span class="token operator">&lt;</span>any<span class="token operator">&gt;</span><span class="token punctuation">;</span>
  method<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">'get'</span> <span class="token operator">|</span> <span class="token string">'post'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">getFetchData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> url<span class="token punctuation">,</span> opts<span class="token punctuation">,</span> method <span class="token operator">=</span> <span class="token string">'get'</span> <span class="token punctuation">}</span><span class="token operator">:</span> Params<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 接口传参要求</span>
  <span class="token keyword">interface</span> <span class="token class-name">QueryItem</span> <span class="token punctuation">{<!-- --></span>
    uid<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
    token<span class="token operator">?</span><span class="token operator">:</span> LocationQuery<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token function">useRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token literal-property property">query</span><span class="token operator">:</span> QueryItem <span class="token operator">=</span> route<span class="token punctuation">.</span>query<span class="token punctuation">;</span>

  <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">useRuntimeConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> data <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useFetch</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
  	<span class="token comment">// method此处仅仅只处理了get与post请求</span>
    method<span class="token punctuation">,</span>
    <span class="token comment">// ofetch库会自动识别请求地址，对于url已包含域名的请求不会再拼接baseURL</span>
    <span class="token literal-property property">baseURL</span><span class="token operator">:</span> config<span class="token punctuation">.</span>public<span class="token punctuation">.</span>baseURL <span class="token operator">+</span> <span class="token string">'/xxx'</span><span class="token punctuation">,</span>
    <span class="token comment">// onRequest相当于请求拦截</span>
    <span class="token function">onRequest</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span> request<span class="token punctuation">,</span> options <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 设置请求头</span>
      options<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token operator">...</span>options<span class="token punctuation">.</span>headers<span class="token punctuation">,</span> <span class="token literal-property property">authorization</span><span class="token operator">:</span> <span class="token string">'xxx'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token comment">// 设置请求参数</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">===</span> <span class="token string">'post'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        options<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token operator">...</span>opts <span class="token punctuation">}</span><span class="token punctuation">;</span>
        options<span class="token punctuation">.</span>query <span class="token operator">=</span> query<span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        options<span class="token punctuation">.</span>query <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>query<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token operator">...</span>opts <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// onResponse相当于响应拦截</span>
    <span class="token function">onResponse</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span> response <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 处理响应数据</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'=== error url: '</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token string">'\n params:'</span><span class="token punctuation">,</span> opts<span class="token punctuation">,</span> <span class="token string">'\n response:'</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>_data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 采用vant组件弹出报错弹窗</span>
        <span class="token function">showToast</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 处理服务端渲染时接口报错，可接入日志系统或者邮件系统，此处测试demo采取写入文件系统</span>
        fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">'error.txt'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">error url:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n response:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>response<span class="token punctuation">.</span>_data<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">flag</span><span class="token operator">:</span> <span class="token string">'a'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
      	<span class="token comment">// 这里可以根据后端返回的数据结构对返回数据进行处理，比如后端数据返回得比较深还有一层data结构，我这里就统一取出来，在后续接口请求的时候就直接能拿到了</span>
        <span class="token comment">// response._data = response._data.data;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">onRequestError</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span> request<span class="token punctuation">,</span> options<span class="token punctuation">,</span> error <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 处理请求错误</span>
      console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'request error'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">showToast</span><span class="token punctuation">(</span><span class="token string">'Request Error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">onResponseError</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span> request<span class="token punctuation">,</span> response<span class="token punctuation">,</span> options <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token comment">// 处理响应错误</span>
      console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'request error'</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">showToast</span><span class="token punctuation">(</span><span class="token string">'Request Error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 这里data本身是个ref对象，将其内部值抛出去方便调用时获得数据。</span>
  <span class="token keyword">return</span> data<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="3__172"></a>3. 调用</h3> 
<p>项目内直接使用<code>getFetchData</code>方法处理异步请求</p> 
<pre><code class="prism language-javascript"><span class="token comment">// get请求</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getFetchData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'xxx/getList'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">opts</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// post请求</span>
<span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getFetchData</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'/xxx/getList'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">opts</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">memberLevel</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">pageNum</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token literal-property property">pageSize</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'post'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<hr> 
<h2><a id="_196"></a>总结</h2> 
<p>以上就是全部内容，本文简单介绍了Nuxt3的数据获取方式，详细使用方式与使用技巧还需多参考官方文档以及社区优秀项目。关于封装数据请求这块，之前也有写过Axios封装相关的博客，感兴趣的同学可以参考（<a href="https://blog.csdn.net/m0_55119483/article/details/129686563">axios封装—vue3项目</a>），此次对Nuxt3的封装也只是基本展示，需要结合自身业务需求灵活使用。另外本人也是刚学习Nuxt3不久，若有不当之处，敬请指正。<br> 如果此篇文章对您有帮助，欢迎您【点赞】、【收藏】！也欢迎您【评论】留下宝贵意见，共同探讨一起学习~</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bf73cc647c55ee8245c5a5f085360795/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于AR技术的城市隐蔽工程查看</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2f412515d2180d9655f735d6dc30b312/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">并发容器ConcurrentHashMap与synchronized联合使用达到线程安全</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>