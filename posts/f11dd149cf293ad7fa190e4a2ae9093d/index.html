<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【功能上新】Python实现OSM地图数据解析——OSM2Rail - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【功能上新】Python实现OSM地图数据解析——OSM2Rail" />
<meta property="og:description" content="一款开源的铁路网络建模工具
目录 1. 简介2. 功能介绍3. 操作流程3.1 安装3.2 快速上手 4. 未来计划 1. 简介 作为一款面向铁路工作者的开源网络建模工具，OSM2Rail实现了在线OSM地图包快速下载、铁路元素自动解析、网络快速可视化以及规范化数据输出。借助OSM2Rail，你可以快速构建以下车站、站场、线路、网络的地理网络。
（1）北京南站
（2）襄阳北
（3）伦敦城区网
为了进一步简化铁路网建模工作，快速提取特定名称的铁路元素集合，在新版本0.0.6中对包进行了一定功能完善，可实现特定线路的提取。
2. 功能介绍 0.0.6版本的OSM2Rail功能如下：
支持在线下载.osm或.osm.pbf格式的OSM地图数据包支持解析.osm或.osm.pbf格式的OSM地图数据包支持提取特定名称的铁路元素以GMNS数据格式导出CSV文件导出文件可被QGIS读取 3. 操作流程 3.1 安装 PyPI地址：
https://pypi.org/project/osm2rail/
新版本需要以下三方包支持：
bs4osmiumshapelymatplotlibfuzzywuzzypandasnumpyrequests 配置好以上环境后，可输入以下命令快速安装包，
pip install osm2rail 3.2 快速上手 （1）在线下载地图包
支持通过名称或坐标框两种格式在线下载地图包
subarea_names = &#39;徐州东&#39; download_dir= &#39;./osmfile&#39; osmfile=orl.download_osm_data_from_overpass(subarea_names=&#39;徐州东&#39;,download_dir=output_dir,ret_download_path=True) subarea_names：区域名称，可以是 str 或 包含多个str 的list
download_dir：下载到本地的路径
bboxs：区域的坐标范围，格式为：tuple(min_lat, max_lat,min_lon, max_lon)
ret_download_path：是否返回文件路径
（2）解析地图包并格式化
net = orl.get_network_from_file(filename=osmfile[0],POIs=True,check_boundary=True) orl.show_network(net) filename：文件路径
bbox：解析的目标范围，格式为：tuble(min_lat, max_lat,min_lon, max_lon)
check_boundary：bool，是否剔除不再范围内的元素
target_elements：需要解析的特定元素名称，格式为str或包含多个str 的list
POIs：bool，是否解析POI元素
可视化结果如下：
接下来我们尝试使用特定铁路元素解析功能：
首先需要自己准备好一个包含目标区域的地图包，比如：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/f11dd149cf293ad7fa190e4a2ae9093d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-30T20:01:03+08:00" />
<meta property="article:modified_time" content="2022-04-30T20:01:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【功能上新】Python实现OSM地图数据解析——OSM2Rail</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>一款开源的铁路网络建模工具</p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#1__3" rel="nofollow">1. 简介</a></li><li><a href="#2__14" rel="nofollow">2. 功能介绍</a></li><li><a href="#3__23" rel="nofollow">3. 操作流程</a></li><li><ul><li><a href="#31__24" rel="nofollow">3.1 安装</a></li><li><a href="#32__43" rel="nofollow">3.2 快速上手</a></li></ul> 
  </li><li><a href="#4__91" rel="nofollow">4. 未来计划</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1__3"></a>1. 简介</h2> 
<p>作为一款面向铁路工作者的开源网络建模工具，OSM2Rail实现了在线OSM地图包快速下载、铁路元素自动解析、网络快速可视化以及规范化数据输出。借助OSM2Rail，你可以快速构建以下车站、站场、线路、网络的地理网络。</p> 
<p><strong>（1）北京南站</strong><br> <img src="https://images2.imgbox.com/65/47/oIeKhWKe_o.png" alt="在这里插入图片描述"><br> <strong>（2）襄阳北</strong><br> <img src="https://images2.imgbox.com/ec/b1/oEdw3Qsr_o.png" alt="在这里插入图片描述"><br> <strong>（3）伦敦城区网</strong><br> <img src="https://images2.imgbox.com/80/be/5cZnmlav_o.png" alt="在这里插入图片描述"><br> 为了进一步简化铁路网建模工作，快速提取特定名称的铁路元素集合，在新版本0.0.6中对包进行了一定功能完善，可实现特定线路的提取。</p> 
<h2><a id="2__14"></a>2. 功能介绍</h2> 
<p>0.0.6版本的OSM2Rail功能如下：</p> 
<ul><li>支持在线下载.osm或.osm.pbf格式的OSM地图数据包</li><li>支持解析.osm或.osm.pbf格式的OSM地图数据包</li><li>支持提取特定名称的铁路元素</li><li>以GMNS数据格式导出CSV文件</li><li>导出文件可被QGIS读取</li></ul> 
<h2><a id="3__23"></a>3. 操作流程</h2> 
<h3><a id="31__24"></a>3.1 安装</h3> 
<p>PyPI地址：</p> 
<blockquote> 
 <p>https://pypi.org/project/osm2rail/</p> 
</blockquote> 
<p>新版本需要以下三方包支持：</p> 
<ul><li>bs4</li><li>osmium</li><li>shapely</li><li>matplotlib</li><li>fuzzywuzzy</li><li>pandas</li><li>numpy</li><li>requests</li></ul> 
<p>配置好以上环境后，可输入以下命令快速安装包，</p> 
<pre><code class="prism language-python">pip install osm2rail
</code></pre> 
<h3><a id="32__43"></a>3.2 快速上手</h3> 
<p><strong>（1）在线下载地图包</strong></p> 
<p><em>支持通过名称或坐标框两种格式在线下载地图包</em></p> 
<pre><code class="prism language-python">subarea_names <span class="token operator">=</span> <span class="token string">'徐州东'</span>
download_dir<span class="token operator">=</span> <span class="token string">'./osmfile'</span>
osmfile<span class="token operator">=</span>orl<span class="token punctuation">.</span>download_osm_data_from_overpass<span class="token punctuation">(</span>subarea_names<span class="token operator">=</span><span class="token string">'徐州东'</span><span class="token punctuation">,</span>download_dir<span class="token operator">=</span>output_dir<span class="token punctuation">,</span>ret_download_path<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>subarea_names：区域名称，可以是 str 或 包含多个str 的list<br> download_dir：下载到本地的路径<br> bboxs：区域的坐标范围，格式为：tuple(min_lat, max_lat,min_lon, max_lon)<br> ret_download_path：是否返回文件路径</p> 
</blockquote> 
<p><strong>（2）解析地图包并格式化</strong></p> 
<pre><code class="prism language-python">net <span class="token operator">=</span> orl<span class="token punctuation">.</span>get_network_from_file<span class="token punctuation">(</span>filename<span class="token operator">=</span>osmfile<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>POIs<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>check_boundary<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
orl<span class="token punctuation">.</span>show_network<span class="token punctuation">(</span>net<span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>filename：文件路径<br> bbox：解析的目标范围，格式为：tuble(min_lat, max_lat,min_lon, max_lon)<br> check_boundary：bool，是否剔除不再范围内的元素<br> target_elements：需要解析的特定元素名称，格式为str或包含多个str 的list<br> POIs：bool，是否解析POI元素</p> 
</blockquote> 
<p>可视化结果如下：<br> <img src="https://images2.imgbox.com/d2/48/wtcFp62v_o.png" alt="在这里插入图片描述"><br> <strong>接下来我们尝试使用特定铁路元素解析功能：</strong><br> 首先需要自己准备好一个包含目标区域的地图包，比如：<br> <img src="https://images2.imgbox.com/fa/a7/NQo3OUNe_o.png" alt="在这里插入图片描述"><br> 然后输入以下代码提取：</p> 
<pre><code class="prism language-python">net <span class="token operator">=</span> orl<span class="token punctuation">.</span>get_network_from_file<span class="token punctuation">(</span>filename<span class="token operator">=</span>osm_file<span class="token punctuation">,</span>POIs<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>check_boundary<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>target_elements<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'South London Line'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>你将会得到以下结果：<br> <img src="https://images2.imgbox.com/6f/13/cRsI8Kbk_o.png" alt="在这里插入图片描述"><br> 这样就不用在准备地图数据包时刻意的裁剪额外区域，可有助于简化铁路网络建模工具。经测试，此功能对于线路的提取效果较好，对于车站级别的提取效果不是太理想，主要是因为：在OSM地图数据结构中，车站的relation元素集合中一般只包含POI和控制点数据，不包含侧线。</p> 
<p><strong>（3）保存CSV文件</strong><br> 输入以下命令即可将数据保存为CSV文件</p> 
<pre><code class="prism language-python">orl<span class="token punctuation">.</span>save_network<span class="token punctuation">(</span>net<span class="token punctuation">,</span>output_folder<span class="token operator">=</span>output_dir<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="4__91"></a>4. 未来计划</h2> 
<p>目前正在完善以下功能：</p> 
<p><strong>（1）为车站侧线添加车站名称属性，方便通过输入名称搜索两个车站间的可行列车路径。</strong><br> <strong>（2）将站台与车站侧线建立连接，构建连通的铁路网络。</strong><br> <strong>（3）关于未来的更新计划，欢迎留言交流</strong></p> 
<p>部分效果如下：<br> <img src="https://images2.imgbox.com/93/d5/sZ415m8I_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c4109525b7e013d0aa0da985dfe69b0b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python爬虫踩坑：UnicodeEncodeError: ‘gbk‘ codec can‘t encode character 全网最有效解的决方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/26e4bd4a5a52de79cd8a729ecd7f486c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">连锁多门店收银系统源码之新增采购进货单功能逻辑</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>