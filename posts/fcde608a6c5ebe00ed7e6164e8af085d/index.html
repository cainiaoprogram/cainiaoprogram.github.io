<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>IOS6内存警告处理 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="IOS6内存警告处理" />
<meta property="og:description" content="移动设备终端的内存极为有限，应用程序必须做好low-memory处理工作，才能避免程序因内存使用过大而崩溃。如果一个app使用的内存超过20M，则系统会向该app发送Memory Warning消息。收到此消息后，app必须正确处理，否则可能出错或者出现内存泄露。
app收到Memory Warning后会调用：UIApplication::didReceiveMemoryWarning -&gt; UIApplicationDelegate::applicationDidReceiveMemoryWarning,然后调用当前所有的viewController进行处理。因此处理的主要工作是在viewController。
当我们的程序在第一次收到内存不足警告时，应该释放一些不用的资源，以节省部分内存。否则，当内存不足情形依然存在，iOS再次向我们程序发出内存不足的警告时，我们的程序将会被iOS kill掉。
low-memory 处理思路 通常一个应用程序会包含多个view controllers，当从view跳转到另一个view时，之前的view只是不可见状态，并不会立即被清理掉，而是保存在内存中，以便下一次的快速显现。但是如果应用程序接收到系统发出的low-memory warning，我们就不得不把当前不可见状态下的views清理掉，腾出更多的可使用内存；当前可见的view controller也要合理释放掉一些缓存数据，图片资源和一些不是正在使用的资源，以避免应用程序崩溃。 思路是这样，具体的实施根据系统版本不同而略有差异，本文将详细说明一下iOS 5与iOS 6的low-memory处理。 iOS 5 的处理 在iOS 6 之前，如果应用程序接收到了low-memory警告，当前不可见的view controllers会接收到viewDidUnload消息（也可以理解为自动调用viewDidUnload方法），所以我们需要在 viewDidUnload 方法中释放掉所有 outlets ，以及可再次创建的资源。当前可见的view controller 通过didReceiveMemoryWarning 合理释放资源，具体见代码注释。 举一个简单的例子,有这样一个view controller： @interface MyViewController : UIViewController { NSArray *dataArray; } @property (nonatomic, strong) IBOutlet UITableView *tableView; @end 对应的处理则为： #pragma mark - #pragma mark Memory management - (void)didReceiveMemoryWarning { // Releases the view if it doesn&#39;t have a superview. [super didReceiveMemoryWarning]; // Relinquish ownership any cached data, images, etc that aren&#39;t in use." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/fcde608a6c5ebe00ed7e6164e8af085d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-01-26T01:25:21+08:00" />
<meta property="article:modified_time" content="2015-01-26T01:25:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">IOS6内存警告处理</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> 移动设备终端的内存极为有限，应用程序必须做好low-memory处理工作，才能避免程序因内存使用过大而崩溃。如果一个app使用的内存超过20M，则系统会向该app发送Memory Warning消息。收到此消息后，app必须正确处理，否则可能出错或者出现内存泄露。</p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"></span></p> 
<p style="color:rgb(51,51,51); font-size:14px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">      app收到Memory Warning后会调用：UIApplication::didReceiveMemoryWarning -&gt; UIApplicationDelegate::applicationDidReceiveMemoryWarning,然后调用当前所有的viewController进行处理。因此处理的主要工作是在viewController。</p> 
<p style="color:rgb(51,51,51); font-size:14px; font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">     当我们的程序在第一次收到内存不足警告时，应该释放一些不用的资源，以节省部分内存。否则，当内存不足情形依然存在，iOS再次向我们程序发出内存不足的警告时，我们的程序将会被iOS kill掉。</p> 
<span style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">low-memory 处理思路</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">通常一个应用程序会包含多个view controllers，当从view跳转到另一个view时，之前的view只是不可见状态，并不会立即被清理掉，而是保存在内存中，以便下一次的快速显现。但是如果应用程序接收到系统发出的low-memory warning，我们就不得不把当前不可见状态下的views清理掉，腾出更多的可使用内存；当前可见的view controller也要合理释放掉一些缓存数据，图片资源和一些不是正在使用的资源，以避免应用程序崩溃。</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">思路是这样，具体的实施根据系统版本不同而略有差异，本文将详细说明一下iOS 5与iOS 6的low-memory处理。</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">iOS 5 的处理</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">在iOS 6 之前，如果应用程序接收到了low-memory警告，当前不可见的view controllers会接收到viewDidUnload消息（也可以理解为自动调用viewDidUnload方法），所以我们需要在 viewDidUnload 方法中释放掉所有 outlets ，以及可再次创建的资源。当前可见的view controller 通过didReceiveMemoryWarning 合理释放资源，具体见代码注释。</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">举一个简单的例子,有这样一个view controller：</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">@interface MyViewController : UIViewController {  </span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">    NSArray *dataArray;  </span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">}  </span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">@property (nonatomic, strong) IBOutlet UITableView *tableView;  </span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">@end </span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">对应的处理则为：</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">#pragma mark -</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">#pragma mark Memory management</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">- (void)didReceiveMemoryWarning {<!-- --></span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">    // Releases the view if it doesn't have a superview.</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">    [super didReceiveMemoryWarning];</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">    </span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">    // Relinquish ownership any cached data, images, etc that aren't in use.</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">}</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">- (void)viewDidUnload {<!-- --></span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">    // Relinquish ownership of anything that can be recreated in viewDidLoad or on demand.</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">    // For example: self.myOutlet = nil;</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">    self.tableView = nil;</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">    dataArray = nil;</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">    </span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">    [super viewDidUnload];</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">}</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">iOS 6 的处理</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">iOS 6 废弃了viewDidUnload方法，这就意味着一切需要我们自己在didReceiveMemoryWarning中操作。</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">具体应该怎么做呢？</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">1.将 outlets 置为 weak</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">当view dealloc时，没有人握着任何一个指向subviews的强引用，那么subviews实例变量将会自动置空。</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">@property (nonatomic, weak) IBOutlet UITableView *tableView;</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">2.在didReceiveMemoryWarning中将缓存数据置空</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">#pragma mark -   </span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">#pragma mark Memory management   </span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">  </span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">  </span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">- (void)didReceiveMemoryWarning  </span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">{  </span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">    [super didReceiveMemoryWarning];  </span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">    // Dispose of any resources that can be recreated.   </span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">    dataArray = nil;  </span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">} </span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">不要忘记一点，每当tableview reload 的时候，需要判断一下 dataArray ，若为空则重新创建。</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">兼容iOS 5 与 iOS 6</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">好吧，重点来了，倘若希望程序兼容iOS 5 与 iOS 6怎么办呢？ 这里有一个小技巧，我们需要对didReceiveMemoryWarning 做一些手脚：</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">#pragma mark -</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">#pragma mark Memory management</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">- (void)didReceiveMemoryWarning</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">{<!-- --></span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">    [super didReceiveMemoryWarning];</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">    </span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">    if ([self isViewLoaded] &amp;&amp; self.view.window == nil) {<!-- --></span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">        self.view = nil;</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">    }</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">    </span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">    dataArray = nil;</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">}</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">判断一下view是否是window的一部分，如果不是，那么可以放心的将self.view 置为空，以换取更多可用内存。</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">这样会是什么现象呢？假如，从view controller A 跳转到 view controller B ,然后模拟low-memory警告，此时，view controller A 将会执行self.view = nil ; 当我们从 B 退回 A 时， A 会重新调用一次 viewDidLoad ，此时数据全部重新创建，简单兼容无压力～～</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">Note:</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">如果你好奇Apple为什么废弃viewDidUnload，可以看看Apple 的解释：</span><br style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"> </span> 
<span style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"></span> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px">Apple deprecated viewDidUnload for a good reason. The memory savings from setting a few outlets to nil just weren’t worth it and added a lot of complexity for little benefit. For iOS 6+ apps, you can simply forget about view unloading and only implement didReceiveMemoryWarning if the view controller can let go of cached data that you can recreate on demand later.</span></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif; line-height:18px"><br> </span></p> 
<p style="color:rgb(51,51,51); font-family:Arial; font-size:14px; line-height:26px"> <span style="font-family:Helvetica,Tahoma,Arial,sans-serif"><span style="line-height:18px">引自：http://justsee.iteye.com/blog/1820588</span></span></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/579d4f363a91db95eb768443313e4582/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ubuntu   彻底卸载apache2</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e34a8031f3dc1b899982cf0e9661954d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux ACL 学习笔记</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>