<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>老宇哥带你玩转 ESP32：05 ADC用起来这也太简单了吧 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="老宇哥带你玩转 ESP32：05 ADC用起来这也太简单了吧" />
<meta property="og:description" content="今天我们来玩儿ADC。
概述 ESP32 芯片有2 个 12位的SAR（逐次逼近）ADC，最多可以读取18个不同的模拟通道输入，由5个专用转换控制器管理，2个支持高性能多通道扫描，2个支持Deep-sleep低功耗模式下运行，还有一个专门用于功率检测和峰值监测。
主要特性如下：
采用 2 个 SAR ADC，可支持同时采样与转换
采用 5 个专用 ADC 控制器，可支持不同应用场景（比如，高性能、低功耗，或功率检测和峰值检测）
支持 18 个模拟输入管脚
1个内部电压 vdd33 通道、 2 个 pa_pkdet 通道（部分控制器支持）
可配置 12 位、 11 位、 10 位、 9 位多种分辨率
支持 DMA（1 个控制器支持）
支持多通道扫描模式（2 个控制器支持）
支持 Deep-sleep 模式运行（1 个控制器支持）
支持 ULP 协处理器控制（2 个控制器支持）
硬件 ADC1支持8个通道（GPIO32-GPIO39），ADC2支持10个通道（GPIO0、GPIO2、GPIO4、GPIO12-GPIO15、GPIO25-GPIO27），这里有两点需要注意：
ADC2的一些引脚比如GPIO0、GPIO2、GPIO15为芯片的Strapping 管脚，使用的时候要特别注意
ADC2只能在WiFi功能未启动的情况下使用
ADC模拟输入引脚可承受最高3.3V的电压，如果需要测试更高的电压，需要通过分压之类的方式进行降压之后再进行采集。
ESP32 ADC 对噪声敏感，从而导致 ADC 读数出现较大差异。为了尽量减少噪声，可以在使用中的 ADC 输入端连接一个 0.1uF 的电容，多重采样也可用于进一步减轻噪声的影响。
软件 关于ADC的一些概念，比如时钟，分辨率，采样周期，衰减，量程等大家自行了解，下面我们讲一下基础的使用：
模拟电压读取
ADC使用不需要初始化引脚了，直接使用下面的函数读取引脚电压，使用默认的参数进行配置，这个参数配置能满足绝大部分的需求了。这里还有一点注意的是这里是阻塞的，直到采集结束。
analogRead(32); 分辨率设置" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c6d97298ef3a42434b0952c65ddae3e5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-12T12:15:00+08:00" />
<meta property="article:modified_time" content="2022-01-12T12:15:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">老宇哥带你玩转 ESP32：05 ADC用起来这也太简单了吧</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="js_content"> 
 <p>今天我们来玩儿<code>ADC</code>。</p> 
 <h3>概述 </h3> 
 <p>ESP32 芯片有<code>2 个</code> 12位的SAR（逐次逼近）ADC，最多可以读取18个不同的模拟通道输入，由5个专用转换控制器管理，2个支持高性能多通道扫描，2个支持Deep-sleep低功耗模式下运行，还有一个专门用于功率检测和峰值监测。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/88/32/JAYONQOD_o.png" alt="ed7acca38dc894a855d839712cb3b237.png"></p> 
 <p><strong>主要特性如下：</strong></p> 
 <ul><li><p>采用 2 个 SAR ADC，可支持同时采样与转换</p></li><li><p>采用 5 个专用 ADC 控制器，可支持不同应用场景（比如，高性能、低功耗，或功率检测和峰值检测）</p></li><li><p>支持 18 个模拟输入管脚</p></li><li><p>1个内部电压 vdd33 通道、 2 个 pa_pkdet 通道（部分控制器支持）</p></li><li><p>可配置 12 位、 11 位、 10 位、 9 位多种分辨率</p></li><li><p>支持 DMA（1 个控制器支持）</p></li><li><p>支持多通道扫描模式（2 个控制器支持）</p></li><li><p>支持 Deep-sleep 模式运行（1 个控制器支持）</p></li><li><p>支持 ULP 协处理器控制（2 个控制器支持）</p></li></ul> 
 <h3>硬件 </h3> 
 <p>ADC1支持<code>8个通道</code>（GPIO32-GPIO39），ADC2支持<code>10个通道</code>（GPIO0、GPIO2、GPIO4、GPIO12-GPIO15、GPIO25-GPIO27），这里有两点需要注意：</p> 
 <ul><li><p>ADC2的一些引脚比如GPIO0、GPIO2、GPIO15为芯片的Strapping 管脚，使用的时候要特别注意</p></li><li><p>ADC2只能在<code>WiFi功能未启动</code>的情况下使用</p></li></ul> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/47/6b/qKN1qF4o_o.png" alt="2ed8251fdb8d504ed237398598d4e6b3.png"></p> 
 <p>ADC模拟输入引脚可承受<code>最高3.3V</code>的电压，如果需要测试更高的电压，需要通过分压之类的方式进行降压之后再进行采集。<br></p> 
 <p>ESP32 ADC 对噪声敏感，从而导致 ADC 读数出现较大差异。为了尽量减少噪声，可以在使用中的 ADC <code>输入端连接一个 0.1uF 的电容</code>，多重采样也可用于进一步减轻噪声的影响。</p> 
 <h3>软件 </h3> 
 <p>关于ADC的一些概念，比如时钟，分辨率，采样周期，衰减，量程等大家自行了解，下面我们讲一下基础的使用：</p> 
 <p><strong>模拟电压读取</strong></p> 
 <p>ADC使用不需要初始化引脚了，直接使用下面的函数读取引脚电压，使用默认的参数进行配置，这个参数配置能满足绝大部分的需求了。这里还有一点注意的是这里是<code>阻塞</code>的，直到采集结束。</p> 
 <pre class="has"><code class="language-go">analogRead(32);</code></pre> 
 <p><strong>分辨率设置</strong></p> 
 <p>如上文中说的，ESP32的ADC是12位的，我们读取的范围默认是0-4095，如果想改也是可以的，通过下面你函数更改，一般用<code>默认</code>就好了。</p> 
 <pre class="has"><code class="language-go">/*
* Sets the conversion resolution
* Default is 12bit (0 - 4095)
* Range is 9 - 12
* */
void analogSetWidth(uint8_t bits);</code></pre> 
 <p><strong>ADC时钟</strong></p> 
 <p>ADC根据选择的分辨率在多个时钟周期内进行转换，时钟速率越快，转换过程就越快，通过更改时钟分频系数来控制频率，分频越大速率越慢，默认就是1，<code>最快的速率</code>。</p> 
 <pre class="has"><code class="language-go">/*
* Set the divider for the ADC clock.
* Default is 1
* Range is 1 - 255
* */
void analogSetClockDiv(uint8_t clockDiv);</code></pre> 
 <p><strong>ADC参考电压</strong></p> 
 <p>ADC的参考电压Vref，在不同的ESP型号可能是不一样的，我们这里ESP32参考电压为1.1V，一般用内部的就可以，<code>要求高的需要校准一下</code>，当然，也可以设置外置的引脚当做参考电压。</p> 
 <pre class="has"><code class="language-go">/*
* Set pin to use for ADC calibration if the esp is not already calibrated (25, 26 or 27)
* */
void analogSetVRefPin(uint8_t pin);</code></pre> 
 <p><strong>ADC衰减倍数</strong></p> 
 <p>对应不同的电压检测范围，我们可以设置引脚的衰减倍数，<code>默认就是11db</code>，实际检测范围为0-3.3V，下面两个函数，一个设置所有通道的，一个设置特定通道的。</p> 
 <pre class="has"><code class="language-go">/*
* Set the attenuation for all channels
* Default is 11db
* */
void analogSetAttenuation(adc_attenuation_t attenuation);
 
/*
* Set the attenuation for a particular pin
* Default is 11db
* */
void analogSetPinAttenuation(uint8_t pin, adc_attenuation_t attenuation);
/*
0dB --- 1.1V
2.5dB --- 1.5V
6dB --- 2.2V
11dB --- 3.9V（实际最大采集到3.3V电压）
* */
static uint8_t __analogAttenuation = 3;//11db
typedef enum {
    ADC_0db,
    ADC_2_5db,
    ADC_6db,    
    ADC_11db
} adc_attenuation_t;</code></pre> 
 <p>通过以上介绍一些可能用到的函数，大家了解一下即可，大部分场合都用<code>默认</code>的就行啦。</p> 
 <p><strong>完整程序</strong></p> 
 <pre class="has"><code class="language-go">#define ANALOG_PIN   32
int analog_value = 0;
void setup()
{
  Serial.begin(115200);
  Serial.println("ADC Demo!"); 
}
 
void loop()
{  
  analog_value = analogRead(ANALOG_PIN);
  Serial.println("ADC value on Pin(%d) is %d!",ANALOG_PIN,analog_value); 
  delay(1000);
}</code></pre> 
 <p>我们直接在loop中读取ADC的值，然后把结果通过串口打印出来，ADC都使用的默认参数，没有进行配置。</p> 
 <p><strong>打印结果</strong></p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/94/55/hBrsV3Z4_o.png" alt="097109162ccdc21a761096e4ac1b0ce3.png"></p> 
 <p><strong>使用平均数字滤波器降噪</strong></p> 
 <p>实际采集中，我们一般使用<code>多次采集取平均值</code>的办法，这样出来的结果可以避免一些错误的噪声影响准确性，方法有多种，具体就是采集多次求平均值，或者去掉最大最小求平均值，大家可以试一下。</p> 
 <p>对于精度较高的场合，我们可以<code>校准ADC</code>，这样出来的结果就非常准确，后面我们再展开实际细说。</p> 
 <p>感谢大家，关于ESP32的学习，希望大家<code>Enjoy</code>!</p> 
 <p> <a href="" rel="nofollow"> </a></p> 
 <p><a href="" rel="nofollow"><img src="https://images2.imgbox.com/7f/1d/oz6JEmLT_o.png" alt="0e13c08535ca04287355654a8cd4803d.png"></a></p> 
 <a href="" rel="nofollow"> </a> 
 <p><a href="" rel="nofollow">老宇哥带你玩转 ESP32：04 串口玩起来是真方便</a></p> 
 <a href="" rel="nofollow"> </a> 
 <p> <a href="" rel="nofollow"> </a></p> 
 <p><a href="" rel="nofollow"><img src="https://images2.imgbox.com/30/c4/nc8M3tOY_o.png" alt="bffc5355852b6f6fa5185300dd239a29.png"></a></p> 
 <a href="" rel="nofollow"> </a> 
 <p><a href="" rel="nofollow">老宇哥带你玩转ESP32：03 GPIO数字输入与数字输出</a></p> 
 <a href="" rel="nofollow"> </a> 
 <p> <a href="" rel="nofollow"> </a></p> 
 <p><a href="" rel="nofollow"><img src="https://images2.imgbox.com/03/af/2sLHjZnn_o.png" alt="f9b8545ef3fea8b1be71af6964a8f63f.png"></a></p> 
 <a href="" rel="nofollow"> </a> 
 <p><a href="" rel="nofollow">老宇哥带你玩转ESP32：02使用VSCode+PlatformIO搭建开发环境</a></p> 
 <a href="" rel="nofollow"> </a> 
 <p> <a href="" rel="nofollow"> </a></p> 
 <p><a href="" rel="nofollow"><img src="https://images2.imgbox.com/b4/5b/iuL0f9vk_o.png" alt="5c916c2dcd66f11e22812b484cbbad78.png"></a></p> 
 <a href="" rel="nofollow"> </a> 
 <p><a href="" rel="nofollow">老宇哥带你玩转ESP32：01入门介绍</a></p> 
 <a href="" rel="nofollow"> </a> 
 ‍ 
 <strong>‍欢迎</strong> 
 <strong>点分享、收藏、点赞、在看。</strong> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/869671e6b6971c9b9e48a611c97172eb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">有参数时有无返回值的调用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/472fd4535edef9bfd9e5d114a4f3fe2b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">pytorch中torchvision数据集的使用——CIFAR-10dataset数据集</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>