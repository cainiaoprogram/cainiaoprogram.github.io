<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>gstreamer-test - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="gstreamer-test" />
<meta property="og:description" content="https://download.csdn.net/download/houxiaoni01/13770958
#include &lt;gst/gst.h&gt; #include &lt;glib.h&gt; #include &lt;glib/gprintf.h&gt; #include &lt;glib-object.h&gt; #include &lt;gmodule.h&gt; #include &lt;stdio.h&gt; #include &lt;string.h&gt; #include &lt;unistd.h&gt; #include &lt;sys/types.h&gt; #include &lt;sys/socket.h&gt; #include &lt;sys/un.h&gt; #include &lt;netinet/in.h&gt; #include &lt;arpa/inet.h&gt; #include &lt;pthread.h&gt; #include &lt;stdlib.h&gt; #include &lt;fcntl.h&gt; #include &lt;fcntl.h&gt; #define SOCKET_NAME &#34;/tmp/ipc_qt_gst.socket&#34; int init_p(gchar *file_path); void start_p_ex(); int start_p(gchar *file_path); void pause_p(); void recover_p(); void release_p(); //command enum SIG { INIT=0x02, START=0x03, PAUSE=0x04, EOS=0x05, RELEASE=0x06 }; enum SIG sig; GstElement *pipeline; GstElement *source, *demux, *videobox; GstElement *videoqueue, *h264parse, *videodecoder, *fbsink; GstElement *audioqueue, *audioparse, *audiodecoder, *alsasink; GMainLoop *loop; int sockfd = -1; GstBus *bus; guint bus_watch_id; gint64 record_pos = 0; static void *rpc_with_qt() { g_print(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c1cebf40c6dfc8599cdb682c03c66e6d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-24T11:50:01+08:00" />
<meta property="article:modified_time" content="2020-12-24T11:50:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">gstreamer-test</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><a href="https://download.csdn.net/download/houxiaoni01/13770958">https://download.csdn.net/download/houxiaoni01/13770958</a></p> 
<pre><code class="prism language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;gst/gst.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;glib.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;glib/gprintf.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;glib-object.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;gmodule.h&gt;</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/un.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;netinet/in.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;arpa/inet.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;pthread.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>

<span class="token macro property">#<span class="token directive keyword">define</span> SOCKET_NAME "/tmp/ipc_qt_gst.socket"</span>

<span class="token keyword">int</span> <span class="token function">init_p</span><span class="token punctuation">(</span>gchar <span class="token operator">*</span>file_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">start_p_ex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">start_p</span><span class="token punctuation">(</span>gchar <span class="token operator">*</span>file_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">pause_p</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">recover_p</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">release_p</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//command</span>
<span class="token keyword">enum</span> SIG <span class="token punctuation">{<!-- --></span> INIT<span class="token operator">=</span><span class="token number">0x02</span><span class="token punctuation">,</span> START<span class="token operator">=</span><span class="token number">0x03</span><span class="token punctuation">,</span> PAUSE<span class="token operator">=</span><span class="token number">0x04</span><span class="token punctuation">,</span> EOS<span class="token operator">=</span><span class="token number">0x05</span><span class="token punctuation">,</span> RELEASE<span class="token operator">=</span><span class="token number">0x06</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">enum</span> SIG sig<span class="token punctuation">;</span> 
GstElement <span class="token operator">*</span>pipeline<span class="token punctuation">;</span>
GstElement <span class="token operator">*</span>source<span class="token punctuation">,</span> <span class="token operator">*</span>demux<span class="token punctuation">,</span> <span class="token operator">*</span>videobox<span class="token punctuation">;</span>
GstElement <span class="token operator">*</span>videoqueue<span class="token punctuation">,</span> <span class="token operator">*</span>h264parse<span class="token punctuation">,</span> <span class="token operator">*</span>videodecoder<span class="token punctuation">,</span> <span class="token operator">*</span>fbsink<span class="token punctuation">;</span>
GstElement <span class="token operator">*</span>audioqueue<span class="token punctuation">,</span> <span class="token operator">*</span>audioparse<span class="token punctuation">,</span> <span class="token operator">*</span>audiodecoder<span class="token punctuation">,</span> <span class="token operator">*</span>alsasink<span class="token punctuation">;</span>
GMainLoop <span class="token operator">*</span>loop<span class="token punctuation">;</span>

<span class="token keyword">int</span> sockfd <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>

GstBus <span class="token operator">*</span>bus<span class="token punctuation">;</span>
guint bus_watch_id<span class="token punctuation">;</span>

gint64 record_pos <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token operator">*</span><span class="token function">rpc_with_qt</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"=================into rpc_with_qt==================.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
	<span class="token keyword">while</span><span class="token punctuation">(</span>TRUE<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"=================pause video==================.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		sig <span class="token operator">=</span> PAUSE<span class="token punctuation">;</span>
		<span class="token function">pause_p</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"=================release video==================.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		sig <span class="token operator">=</span> EOS<span class="token punctuation">;</span>
		<span class="token function">release_p</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> gboolean
bus_call <span class="token punctuation">(</span>GstBus     <span class="token operator">*</span>bus<span class="token punctuation">,</span>
          GstMessage <span class="token operator">*</span>msg<span class="token punctuation">,</span>
          gpointer    data<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  GMainLoop <span class="token operator">*</span>loop_t <span class="token operator">=</span> <span class="token punctuation">(</span>GMainLoop <span class="token operator">*</span><span class="token punctuation">)</span> data<span class="token punctuation">;</span>
	
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>GST_MESSAGE_TYPE <span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">case</span> GST_MESSAGE_EOS<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span>
		g_print <span class="token punctuation">(</span><span class="token string">"End of stream\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//close and unref all element</span>
		<span class="token comment">//gst_element_query_position (pipeline, GST_FORMAT_TIME, &amp;record_pos);</span>
		<span class="token comment">//g_print("record postion:%lld\n", record_pos);</span>
		
		<span class="token comment">//del by zk test</span>
		gst_element_set_state <span class="token punctuation">(</span>pipeline<span class="token punctuation">,</span> GST_STATE_NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"========bus_call==========GST_STATE_NULL==================.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">//add zzyk</span>
		<span class="token comment">//gst_element_set_state (pipeline, GST_STATE_READY);</span>
		<span class="token function">usleep</span><span class="token punctuation">(</span><span class="token number">500000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		gst_element_set_state <span class="token punctuation">(</span>pipeline<span class="token punctuation">,</span> GST_STATE_PLAYING<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"========bus_call==========GST_STATE_PLAYING==================.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">/* test del by zk
		g_print ("Deleting pipeline\n");
		gst_object_unref (GST_OBJECT (pipeline));
		g_source_remove (bus_watch_id);
		*/</span>
		
		<span class="token comment">//del zzyk</span>
		<span class="token comment">/*if(sockfd &gt; 0)
		{
			//send message to QT 
			sig = EOS;
			char buf[100];
			char *info = "got EOS";
			bzero(buf, 100);
			buf[0] = (char)EOS;
			memcpy(buf+1, info, strlen(info));
			if(write(sockfd, buf, 100) &lt; 0)
				g_print("err write eos signal to socket.\n");
		}
		else
		{
			g_print("sockfd is -1.\n");
		}*/</span>
		<span class="token comment">//record_pos = 0;</span>
		<span class="token comment">//g_main_loop_quit (loop_t);</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    <span class="token keyword">case</span> GST_MESSAGE_ERROR<span class="token punctuation">:</span> 
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"========bus_call==========GST_MESSAGE_ERROR==================.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		gchar  <span class="token operator">*</span>debug<span class="token punctuation">;</span>
		GError <span class="token operator">*</span>error<span class="token punctuation">;</span>
	
		gst_message_parse_error <span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token operator">&amp;</span>error<span class="token punctuation">,</span> <span class="token operator">&amp;</span>debug<span class="token punctuation">)</span><span class="token punctuation">;</span>
		g_free <span class="token punctuation">(</span>debug<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
		g_print <span class="token punctuation">(</span><span class="token string">"Error: %s\n"</span><span class="token punctuation">,</span> error<span class="token operator">-&gt;</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
		g_error_free <span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
		g_main_loop_quit <span class="token punctuation">(</span>loop_t<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token comment">/*
	case GST_MESSAGE_STATE_CHANGED:
	{	
		g_print("========bus_call==========GST_MESSAGE_ERROR==================.\n");	
		
		GstState old_state, new_state;
    
		gst_message_parse_state_changed (msg, &amp;old_state, &amp;new_state, NULL);
		g_print ("Element %s changed state from %s to %s.\n",
        GST_OBJECT_NAME (msg-&gt;src),
        gst_element_state_get_name (old_state),
        gst_element_state_get_name (new_state));
		
		break;
	}
	*/</span>
    <span class="token keyword">default</span><span class="token punctuation">:</span>
      <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">demux_pad_added</span><span class="token punctuation">(</span>GstElement <span class="token operator">*</span>element<span class="token punctuation">,</span> 
					 GstPad <span class="token operator">*</span>new_pad<span class="token punctuation">,</span> 
					 gpointer user_data<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"===========demux_pad_added============begin=================\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	gchar <span class="token operator">*</span>name<span class="token punctuation">;</span>
	gchar <span class="token operator">*</span>audio <span class="token operator">=</span> <span class="token string">"audio"</span><span class="token punctuation">;</span>
	gchar <span class="token operator">*</span>video <span class="token operator">=</span> <span class="token string">"video"</span><span class="token punctuation">;</span>
	GstPad <span class="token operator">*</span>sink_pad <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	
	name <span class="token operator">=</span> <span class="token function">gst_pad_get_name</span><span class="token punctuation">(</span>new_pad<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"A new pad %s of tsdemux was created\n"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//g_free(name);</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">g_str_match_string</span><span class="token punctuation">(</span>audio<span class="token punctuation">,</span> name<span class="token punctuation">,</span> FALSE<span class="token punctuation">)</span><span class="token punctuation">)</span>
		sink_pad <span class="token operator">=</span> <span class="token function">gst_element_get_static_pad</span><span class="token punctuation">(</span>audioqueue<span class="token punctuation">,</span> <span class="token string">"sink"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">g_str_match_string</span><span class="token punctuation">(</span>video<span class="token punctuation">,</span> name<span class="token punctuation">,</span> FALSE<span class="token punctuation">)</span><span class="token punctuation">)</span>
		sink_pad <span class="token operator">=</span> <span class="token function">gst_element_get_static_pad</span><span class="token punctuation">(</span>videoqueue<span class="token punctuation">,</span> <span class="token string">"sink"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
	<span class="token keyword">if</span><span class="token punctuation">(</span>sink_pad <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		name <span class="token operator">=</span> <span class="token function">gst_pad_get_name</span><span class="token punctuation">(</span>sink_pad<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"get pad %s to connect new pad.\n"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//g_free(name);</span>
		<span class="token function">gst_pad_link</span><span class="token punctuation">(</span>new_pad<span class="token punctuation">,</span> sink_pad<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">gst_object_unref</span><span class="token punctuation">(</span>sink_pad<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"===========demux_pad_added============end=================\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">g_free</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> GstPadProbeReturn
pad_probe_cb <span class="token punctuation">(</span>GstPad <span class="token operator">*</span> pad<span class="token punctuation">,</span> GstPadProbeInfo <span class="token operator">*</span> info<span class="token punctuation">,</span> gpointer user_data<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"pad is blocked now.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">/* remove the probe first */</span>
	gst_pad_remove_probe <span class="token punctuation">(</span>pad<span class="token punctuation">,</span> GST_PAD_PROBE_INFO_ID <span class="token punctuation">(</span>info<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	gst_element_set_state <span class="token punctuation">(</span>pipeline<span class="token punctuation">,</span>GST_STATE_PAUSED<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"pipeline is pause.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">/*while(sig == PAUSE)
	{
		usleep(500000);
	}
	//set state to play
	gst_element_set_state (pipeline ,GST_STATE_PLAYING);
	
	g_print("set sunxifbsink to PLAYING.\n");*/</span>
	
	<span class="token keyword">while</span><span class="token punctuation">(</span>sig <span class="token operator">==</span> PAUSE<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//g_print("===============================while=============================\n");</span>
		<span class="token function">usleep</span><span class="token punctuation">(</span><span class="token number">500000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span>sig <span class="token operator">==</span> EOS<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//g_print("===============================do nothing==========================\n");</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"pad_probe_cb=====================GST_STATE_PLAYING================== \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//set state to play</span>
		gst_element_set_state <span class="token punctuation">(</span>pipeline <span class="token punctuation">,</span>GST_STATE_PLAYING<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"set sunxifbsink to PLAYING.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">return</span> GST_PAD_PROBE_OK<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>	
	pthread_t rpc_id<span class="token punctuation">;</span>
	
	<span class="token comment">//gst init</span>
	<span class="token function">gst_init</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>argc<span class="token punctuation">,</span> <span class="token operator">&amp;</span>argv<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	loop <span class="token operator">=</span> <span class="token function">g_main_loop_new</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> FALSE<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span><span class="token punctuation">(</span>argc <span class="token operator">&gt;=</span> <span class="token number">2</span><span class="token punctuation">)</span>	
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"paly filename is %s\n"</span><span class="token punctuation">,</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		start_p <span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		pthread_create <span class="token punctuation">(</span><span class="token operator">&amp;</span>rpc_id<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> rpc_with_qt<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"please input filename.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">//into main loop</span>
	g_main_loop_run <span class="token punctuation">(</span>loop<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	g_main_loop_unref <span class="token punctuation">(</span>loop<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">start_p</span><span class="token punctuation">(</span>gchar <span class="token operator">*</span>file_path<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//GstState state, pending;</span>
	
	gchar uri<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"file://"</span><span class="token punctuation">;</span>
	
	<span class="token function">strcat</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> file_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">//creat pipeline</span>
	pipeline <span class="token operator">=</span> <span class="token function">gst_pipeline_new</span><span class="token punctuation">(</span><span class="token string">"pipeline"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//creat elements，file source input/ouput</span>
	source <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"filesrc"</span><span class="token punctuation">,</span> <span class="token string">"source"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>source <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"creat filesrc err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> 
	<span class="token comment">//specify the source is form location(disk)</span>
	g_object_set <span class="token punctuation">(</span>GST_OBJECT <span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"location"</span><span class="token punctuation">,</span> file_path<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	demux <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"qtdemux"</span><span class="token punctuation">,</span> <span class="token string">"demux"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>demux <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"creat qtdemux err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//video branch</span>
	videoqueue <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"queue"</span><span class="token punctuation">,</span> <span class="token string">"videoqueue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>videoqueue <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"creat video queue err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	h264parse <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"h264parse"</span><span class="token punctuation">,</span> <span class="token string">"h264parse"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>h264parse <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"creat h264parse err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	videodecoder <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"omxh264dec"</span><span class="token punctuation">,</span> <span class="token string">"videodecoder"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>videodecoder <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"creat omxh264dec err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//g_object_set (GST_OBJECT (videodecoder), "max-threads", 20, NULL);</span>
	<span class="token comment">//g_object_set (GST_OBJECT (videodecoder), "lowres", 1, NULL);</span>
	
	<span class="token comment">//creat sink</span>
	fbsink <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"sunxifbsink"</span><span class="token punctuation">,</span> <span class="token string">"fbsink"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span><span class="token punctuation">(</span>fbsink <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"creat sunxifbsink err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">g_object_set</span><span class="token punctuation">(</span>GST_OBJECT <span class="token punctuation">(</span>fbsink<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"device"</span><span class="token punctuation">,</span> <span class="token string">"/dev/fb0"</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">g_object_set</span><span class="token punctuation">(</span>GST_OBJECT <span class="token punctuation">(</span>fbsink<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"async"</span><span class="token punctuation">,</span> FALSE<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">g_object_set</span><span class="token punctuation">(</span>GST_OBJECT <span class="token punctuation">(</span>fbsink<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"width"</span><span class="token punctuation">,</span> <span class="token number">640</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">g_object_set</span><span class="token punctuation">(</span>GST_OBJECT <span class="token punctuation">(</span>fbsink<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"height"</span><span class="token punctuation">,</span> <span class="token number">480</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	

	<span class="token comment">//audio branch</span>
	audioqueue <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"queue"</span><span class="token punctuation">,</span> <span class="token string">"audioqueue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>audioqueue <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"creat audio queue err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	audioparse <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"mpegaudioparse"</span><span class="token punctuation">,</span> <span class="token string">"audioparse"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>audioparse <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"creat mpegaudioparse err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	audiodecoder <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"avdec_mp3"</span><span class="token punctuation">,</span> <span class="token string">"audiodecoder"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>audiodecoder <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"creat avdec_mp3 err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	alsasink <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"autoaudiosink"</span><span class="token punctuation">,</span> <span class="token string">"alsasink"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>alsasink <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"creat autoaudiosink err./n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//connect tsdemux pad-added signal and pass element pointer to callback function</span>
	<span class="token function">g_signal_connect</span><span class="token punctuation">(</span>demux<span class="token punctuation">,</span> <span class="token string">"pad-added"</span><span class="token punctuation">,</span> <span class="token function">G_CALLBACK</span><span class="token punctuation">(</span>demux_pad_added<span class="token punctuation">)</span><span class="token punctuation">,</span> loop<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//add element to pipeline</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gst_bin_add</span><span class="token punctuation">(</span><span class="token function">GST_BIN</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"add udpsrc to pipeline err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gst_bin_add</span><span class="token punctuation">(</span><span class="token function">GST_BIN</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">,</span> demux<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"add tsdemux to pipeline err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">gst_element_link</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> demux<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//video branch</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gst_bin_add</span><span class="token punctuation">(</span><span class="token function">GST_BIN</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">,</span> videoqueue<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"add videoqueue to pipeline err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gst_bin_add</span><span class="token punctuation">(</span><span class="token function">GST_BIN</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">,</span> h264parse<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"add h264parse to pipeline err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gst_bin_add</span><span class="token punctuation">(</span><span class="token function">GST_BIN</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">,</span> videodecoder<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"add videodecoder to pipeline err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gst_bin_add</span><span class="token punctuation">(</span><span class="token function">GST_BIN</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">,</span> fbsink<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"add fbsink to pipeline err./n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	gst_element_link_many <span class="token punctuation">(</span>videoqueue<span class="token punctuation">,</span> h264parse<span class="token punctuation">,</span> videodecoder<span class="token punctuation">,</span> fbsink<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">//audio branch</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gst_bin_add</span><span class="token punctuation">(</span><span class="token function">GST_BIN</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">,</span> audioqueue<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"add audio queue to pipeline err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gst_bin_add</span><span class="token punctuation">(</span><span class="token function">GST_BIN</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">,</span> audioparse<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"add mpegaudioparse to pipeline err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gst_bin_add</span><span class="token punctuation">(</span><span class="token function">GST_BIN</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">,</span> audiodecoder<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"add avdec_mp3 to pipeline err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gst_bin_add</span><span class="token punctuation">(</span><span class="token function">GST_BIN</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">,</span> alsasink<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"add autoaudiosink to pipeline err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	gst_element_link_many <span class="token punctuation">(</span>audioqueue<span class="token punctuation">,</span> audioparse<span class="token punctuation">,</span> audiodecoder<span class="token punctuation">,</span> alsasink<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//get bus to handle message</span>
	bus <span class="token operator">=</span> <span class="token function">gst_pipeline_get_bus</span><span class="token punctuation">(</span><span class="token function">GST_PIPELINE</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	bus_watch_id <span class="token operator">=</span> <span class="token function">gst_bus_add_watch</span><span class="token punctuation">(</span>bus<span class="token punctuation">,</span> bus_call<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">gst_object_unref</span><span class="token punctuation">(</span>bus<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">/*if(record_pos &gt; GST_SECOND) {
		gst_element_set_state (pipeline, GST_STATE_PAUSED);
		do{
			gst_element_get_state (pipeline,
									&amp;state,
									&amp;pending,
									GST_CLOCK_TIME_NONE);
		}while(GST_STATE_PAUSED != state);
		g_print ("&lt;-----------------------------------------&gt;seek\n");
		if (!gst_element_seek (pipeline, 1.0, GST_FORMAT_TIME, 
				GST_SEEK_FLAG_FLUSH |GST_SEEK_FLAG_KEY_UNIT |GST_SEEK_FLAG_SNAP_BEFORE,
							GST_SEEK_TYPE_SET, record_pos,
							GST_SEEK_TYPE_NONE, GST_CLOCK_TIME_NONE)) {
			g_print ("&lt;--------------------------------------&gt;Seek failed!\n");
		}
		g_print ("&lt;-----------------------------------------&gt;end seek\n");
		do{
			gst_element_get_state (pipeline,
									&amp;state,
									&amp;pending,
									GST_CLOCK_TIME_NONE);
		}while(GST_STATE_PAUSED != state);
	}*/</span>
	g_print <span class="token punctuation">(</span><span class="token string">"&lt;-----------------------------------------&gt;start_p\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	gst_element_set_state <span class="token punctuation">(</span>pipeline<span class="token punctuation">,</span> GST_STATE_PLAYING<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">init_p</span><span class="token punctuation">(</span>gchar <span class="token operator">*</span>file_path<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//GstState state, pending;</span>
	
	gchar uri<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"file://"</span><span class="token punctuation">;</span>
	
	<span class="token function">strcat</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> file_path<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">//creat pipeline</span>
	pipeline <span class="token operator">=</span> <span class="token function">gst_pipeline_new</span><span class="token punctuation">(</span><span class="token string">"pipeline"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//creat elements，file source input/ouput</span>
	source <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"filesrc"</span><span class="token punctuation">,</span> <span class="token string">"source"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>source <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"creat filesrc err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> 
	<span class="token comment">//specify the source is form location(disk)</span>
	g_object_set <span class="token punctuation">(</span>GST_OBJECT <span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"location"</span><span class="token punctuation">,</span> file_path<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	demux <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"qtdemux"</span><span class="token punctuation">,</span> <span class="token string">"demux"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>demux <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"creat qtdemux err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//video branch</span>
	videoqueue <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"queue"</span><span class="token punctuation">,</span> <span class="token string">"videoqueue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>videoqueue <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"creat video queue err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	h264parse <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"h264parse"</span><span class="token punctuation">,</span> <span class="token string">"h264parse"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>h264parse <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"creat h264parse err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	videodecoder <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"omxh264dec"</span><span class="token punctuation">,</span> <span class="token string">"videodecoder"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>videodecoder <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"creat omxh264dec err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//g_object_set (GST_OBJECT (videodecoder), "max-threads", 20, NULL);</span>
	<span class="token comment">//g_object_set (GST_OBJECT (videodecoder), "lowres", 1, NULL);</span>
	
	<span class="token comment">//creat sink</span>
	fbsink <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"sunxifbsink"</span><span class="token punctuation">,</span> <span class="token string">"fbsink"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>fbsink <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"creat sunxifbsink err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">g_object_set</span><span class="token punctuation">(</span>GST_OBJECT <span class="token punctuation">(</span>fbsink<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"device"</span><span class="token punctuation">,</span> <span class="token string">"/dev/fb0"</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">g_object_set</span><span class="token punctuation">(</span>GST_OBJECT <span class="token punctuation">(</span>fbsink<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"async"</span><span class="token punctuation">,</span> FALSE<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">g_object_set</span><span class="token punctuation">(</span>GST_OBJECT <span class="token punctuation">(</span>fbsink<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"width"</span><span class="token punctuation">,</span> <span class="token number">1360</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">g_object_set</span><span class="token punctuation">(</span>GST_OBJECT <span class="token punctuation">(</span>fbsink<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"height"</span><span class="token punctuation">,</span> <span class="token number">768</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//audio branch</span>
	audioqueue <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"queue"</span><span class="token punctuation">,</span> <span class="token string">"audioqueue"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>audioqueue <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"creat audio queue err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	audioparse <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"mpegaudioparse"</span><span class="token punctuation">,</span> <span class="token string">"audioparse"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>audioparse <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"creat mpegaudioparse err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	audiodecoder <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"avdec_mp3"</span><span class="token punctuation">,</span> <span class="token string">"audiodecoder"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>audiodecoder <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"creat avdec_mp3 err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	alsasink <span class="token operator">=</span> <span class="token function">gst_element_factory_make</span><span class="token punctuation">(</span><span class="token string">"autoaudiosink"</span><span class="token punctuation">,</span> <span class="token string">"alsasink"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>alsasink <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"creat autoaudiosink err./n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">//connect tsdemux pad-added signal and pass element pointer to callback function</span>
	<span class="token function">g_signal_connect</span><span class="token punctuation">(</span>demux<span class="token punctuation">,</span> <span class="token string">"pad-added"</span><span class="token punctuation">,</span> <span class="token function">G_CALLBACK</span><span class="token punctuation">(</span>demux_pad_added<span class="token punctuation">)</span><span class="token punctuation">,</span> loop<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//add element to pipeline</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gst_bin_add</span><span class="token punctuation">(</span><span class="token function">GST_BIN</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"add udpsrc to pipeline err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gst_bin_add</span><span class="token punctuation">(</span><span class="token function">GST_BIN</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">,</span> demux<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"add tsdemux to pipeline err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">gst_element_link</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> demux<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//video branch</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gst_bin_add</span><span class="token punctuation">(</span><span class="token function">GST_BIN</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">,</span> videoqueue<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"add video queue to pipeline err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gst_bin_add</span><span class="token punctuation">(</span><span class="token function">GST_BIN</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">,</span> h264parse<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"add h264parse to pipeline err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gst_bin_add</span><span class="token punctuation">(</span><span class="token function">GST_BIN</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">,</span> videodecoder<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"add omxh264dec to pipeline err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gst_bin_add</span><span class="token punctuation">(</span><span class="token function">GST_BIN</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">,</span> fbsink<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"add sunxifbsink to pipeline err./n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	gst_element_link_many <span class="token punctuation">(</span>videoqueue<span class="token punctuation">,</span> h264parse<span class="token punctuation">,</span> videodecoder<span class="token punctuation">,</span> fbsink<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//audio branch</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gst_bin_add</span><span class="token punctuation">(</span><span class="token function">GST_BIN</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">,</span> audioqueue<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"add audio queue to pipeline err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gst_bin_add</span><span class="token punctuation">(</span><span class="token function">GST_BIN</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">,</span> audioparse<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"add mpegaudioparse to pipeline err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gst_bin_add</span><span class="token punctuation">(</span><span class="token function">GST_BIN</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">,</span> audiodecoder<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"add avdec_mp3 to pipeline err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">gst_bin_add</span><span class="token punctuation">(</span><span class="token function">GST_BIN</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">,</span> alsasink<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">g_print</span><span class="token punctuation">(</span><span class="token string">"add autoaudiosink to pipeline err.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	gst_element_link_many <span class="token punctuation">(</span>audioqueue<span class="token punctuation">,</span> audioparse<span class="token punctuation">,</span> audiodecoder<span class="token punctuation">,</span> alsasink<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//get bus to handle message</span>
	bus <span class="token operator">=</span> <span class="token function">gst_pipeline_get_bus</span><span class="token punctuation">(</span><span class="token function">GST_PIPELINE</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	bus_watch_id <span class="token operator">=</span> <span class="token function">gst_bus_add_watch</span><span class="token punctuation">(</span>bus<span class="token punctuation">,</span> bus_call<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">gst_object_unref</span><span class="token punctuation">(</span>bus<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token comment">/*if(record_pos &gt; GST_SECOND) {
		gst_element_set_state (pipeline, GST_STATE_PAUSED);
		do{
			gst_element_get_state (pipeline,
									&amp;state,
									&amp;pending,
									GST_CLOCK_TIME_NONE);
		}while(GST_STATE_PAUSED != state);
		g_print ("&lt;-----------------------------------------&gt;seek\n");
		if (!gst_element_seek (pipeline, 1.0, GST_FORMAT_TIME, 
				GST_SEEK_FLAG_FLUSH |GST_SEEK_FLAG_KEY_UNIT |GST_SEEK_FLAG_SNAP_BEFORE,
							GST_SEEK_TYPE_SET, record_pos,
							GST_SEEK_TYPE_NONE, GST_CLOCK_TIME_NONE)) {
			g_print ("&lt;--------------------------------------&gt;Seek failed!\n");
		}
		g_print ("&lt;-----------------------------------------&gt;end seek\n");
		do{
			gst_element_get_state (pipeline,
									&amp;state,
									&amp;pending,
									GST_CLOCK_TIME_NONE);
		}while(GST_STATE_PAUSED != state);
	}*/</span>
	g_print <span class="token punctuation">(</span><span class="token string">"&lt;-----------------------------------------&gt;init_p\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	gst_element_set_state <span class="token punctuation">(</span>pipeline<span class="token punctuation">,</span> GST_STATE_READY<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">start_p_ex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	g_print <span class="token punctuation">(</span><span class="token string">"&lt;-----------------------------------------&gt;start_p_ex\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">gst_element_set_state</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">,</span>  GST_STATE_PLAYING<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">pause_p</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>   
	g_print <span class="token punctuation">(</span><span class="token string">"&lt;-----------------------------------------&gt;pause_p\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	GstPad <span class="token operator">*</span>blockpad<span class="token punctuation">;</span>
	blockpad <span class="token operator">=</span> gst_element_get_static_pad <span class="token punctuation">(</span>videodecoder<span class="token punctuation">,</span> <span class="token string">"src"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	gst_pad_add_probe <span class="token punctuation">(</span>blockpad<span class="token punctuation">,</span> GST_PAD_PROBE_TYPE_BLOCK_DOWNSTREAM<span class="token punctuation">,</span>pad_probe_cb<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	gst_object_unref <span class="token punctuation">(</span>blockpad<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">recover_p</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	g_print <span class="token punctuation">(</span><span class="token string">"&lt;-----------------------------------------&gt;recover_p\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	gst_element_set_state <span class="token punctuation">(</span>fbsink <span class="token punctuation">,</span>GST_STATE_PLAYING<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">release_p</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	g_print <span class="token punctuation">(</span><span class="token string">"&lt;-----------------begin------------------------&gt;release_p\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//gst_element_set_state(pipeline,  GST_STATE_NULL);</span>
	<span class="token comment">//gst_object_unref (GST_OBJECT (pipeline));</span>
	<span class="token comment">//g_source_remove (bus_watch_id);</span>
	<span class="token comment">//g_main_loop_unref (loop);//test	</span>

	<span class="token function">gst_element_set_state</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">,</span> GST_STATE_NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">usleep</span><span class="token punctuation">(</span><span class="token number">1000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">gst_element_set_state</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">,</span> GST_STATE_READY<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">usleep</span><span class="token punctuation">(</span><span class="token number">3000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	g_print <span class="token punctuation">(</span><span class="token string">"--------------GST_STATE_PLAYING---------------------------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">gst_element_set_state</span><span class="token punctuation">(</span>pipeline<span class="token punctuation">,</span>  GST_STATE_PLAYING<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">/*
	usleep(1000000);
	if(sockfd &gt; 0)
	{
		//send message to QT 
		sig = EOS;
		char buf[100];
		char *info = "got EOS";
		bzero(buf, 100);
		buf[0] = (char)EOS;
		memcpy(buf+1, info, strlen(info));
		if(write(sockfd, buf, 100) &lt; 0)
			g_print("err write eos signal to socket.\n");
	}
	else
	{
		g_print("sockfd is -1.\n");
	}
	*/</span>
	g_print <span class="token punctuation">(</span><span class="token string">"&lt;----------------------end-------------------&gt;release_p\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
	
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8747694ee62d9c70b0c7988197fc4636/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">打印机出现另存为xps_打印机打印文件时弹出另存为xps/pdf该怎办?</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8bfc6d5029bb8d20a0b9b6b18cd8d55d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">十分钟理解线性代数的本质_十分钟理解线性代数的本质</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>