<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>安全策略禁止本机管理员登录解决办法 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="安全策略禁止本机管理员登录解决办法" />
<meta property="og:description" content="在Windows 2003环境下，被组策略拒绝本地登录一直是件比较令人头疼的事情。本文将介绍所有用户都被拒绝本地登录后的解决方法。
在Windows2003中，如果某个用户被取消了本地登录权限，当这个用户本地登录计算机时，系统就会提示&#34;此系统的本地策略不允许您采用交互式登录&#34;，导致登录失败。遇到这种情况，通常请管理员在组策略中重新设置一下，将该用户从&#34;拒绝本地登录&#34;列表中删除或添加到&#34;在本地登录&#34;列表中即可。但如果因为操作失误或其它方面的原因，我们将所有用户的本地登录权限都禁止了(通常是禁止了users组（非域环境下）或domain users组（域环境下）)，那就有点麻烦了。这种情形看起来像一个解不开的&#34;死结&#34;：要解除禁止本地登录的组策略设置，必须以管理员身份本地登录；要以管理员身份本地登录，就必须先解除禁止本地登录的组策略设置。
但实际上，事情并没有我们想象的那么糟。经过查询相关资料和测试，我发现借助网络的帮助,这个&#34;死结&#34;还是可以解开的。因为域安全策略与本地安全策略的数据保存机制不同，下面分两种情况分别进行说明。 -------------------------------------------------------------------------------- 被域策略拒绝本地登录时的解决办法
域策略的安全设置部分都保存在一个名为&#34;GptTmpl.inf&#34;的安全模板中，这是一个文本文件，存放在DC（域控制器）的SYSVOL（物理目录指向DC的“c:\winnt\sysvol\sysvol&#34;）共享中。要解除对所有用户本地登录限制，在不能本地登录的情况下，最快捷的办法可能就是直接编辑这个文本文件。
具体操作如下： 在另一台计算机（Win9X/2000/XP均可）上，使用域管理员账号连接到DC的SYSVOL共享，在&#34;\\&lt;DC name&gt;\sysvol\&lt;Domain name&gt;\Policies\&lt;policy GUID&gt;\MACHINE\Microsoft\Windows NT\SecEdit&#34;下找到该文本文件&#34;GptTmpl.inf&#34;。(路径中的&#34;DC name&#34;是你放置该组策略的域控制器的名字，&#34;Domain name&#34;是你的域的名字，&#34;Policy GUID&#34;是你要编辑的组策略对象的GUID，类似于&#34;{31B2F340-016D-11D2-945F-05C04FB98439}&#34;)。 使用记事本打开&#34;GptTmpl.inf&#34;文件，找到文件中&#34;Privilege Rights&#34;小节下的 &#34;SeDenyInteractiveLogonRight&#34;关键字，它的值就是被拒绝本地登录的用户或组的SID，将这些SID删除，使 &#34;SeDenyInteractiveLogonRight&#34;关键字的值为空。修改完毕将文件保存回原位置。 使用记事本打开位于&#34;\\&lt;DC name&gt;\sysvol\&lt;Domain name&gt;\Policies\&lt;policy GUID&gt;&#34;下的 &#34;GPT.INI&#34;文件，提高&#34;General&#34;小节下的&#34;Version&#34;关键字的值，通常是加1000。这是我们修改的这个组策略对象的版本号，版本号提高后可以保证我们的更改被复制到其它DC上。修改完毕将文件保存回原位置。 域策略刷新后，问题即告解决。 本地登录DC重新设置域策略中的相关项目。 -------------------------------------------------------------------------------- 被本地安全策略拒绝本地登录时的解决办法 由于在Windows2003中，不支持对计算机本地策略的安全设置部分进行远程管理（详见组策略白皮书），而且本地安全策略的安全设置通常存放在一个二进制的安全数据库secedit.sdb中，这个安全数据库的结构我们无从知道，因此象第一部分那样直接编辑secedit.sdb文件的办法是无能为力了，我们需要采用迂回进攻的策略，&#34;曲线救国&#34;。 具体操作如下： 假设故障计算机的IP地址是&#34;192.168.0.111&#34;。在另一台计算机(Windows9X/2000/XP均可)上，使用&#34;Telnet 192.168.0.111&#34;命令使用管理员账号连接到故障计算机。（如果故障计算机的telnet&#34;服务没有启动，可以通过网络使用&#34;服务&#34;MMC启动，具体方法不在详述） 通过telnet在故障计算机上执行&#34;net share tmp$=d:\tmp&#34;命令，将故障计算机上的&#34;d:\tmp&#34;隐藏共享为&#34;tmp$&#34;，共享权限缺省是everyone完全控制（此时要特别注意网络安全）。当然你也可以共享其它的目录。 通过telnet在故障计算机上执行&#34;secedit /export /CFG d:\tmp\sec.inf&#34;命令，将故障计算机的本地安全策略配置导入&#34;d:\tmp\sec.inf&#34;安全模板文件中，这是一个文本文件。 连接到故障计算机上的tmp$共享，用记事本打开共享文件夹中的&#34;sec.inf&#34;文件。找到文件中&#34;Privilege Rights&#34;小节下的“SeDenyInteractiveLogonRight&#34;关键字，它的值就是被拒绝本地登录的用户或组的SID，将这些SID删除，使&#34;SeDenyInteractiveLogonRight&#34;关键字的值为空或者是随便另设置一个无关的值。文件修改完毕保存回原位置。 通过telnet在故障计算机上执行&#34;secedit /configure /db c:\secedit.sdb /CFG d:\tmp\sec.inf&#34;命令，使用新的安全模板和安全数据库重新配置故障计算机的本地安全策略。 通过telnet在故障计算机上执行&#34;secedit /refreshpolicy machine_policy /enforce&#34;命令，强制在故障计算机上刷新策略设置，问题即告解决。 本地登录故障计算机后，删除我们建立的Tmp$共享，重新设置本地安全策略中的相关项目。 ----------------------------------------------------------------------------------
用故障恢复控制台登录，然后在命令行下运行以下命令：
copy C:\WINNT\repair\security C:\WINNT\system32\config\security
该方法主要是用初始安装的security注册表配置单元，覆盖应用拒绝本地登录策略后的注册表配置单元文件。
转载于:https://blog.51cto.com/18266/530136" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/df030f69a674bb2274521307ebbd5082/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2011-03-29T20:39:12+08:00" />
<meta property="article:modified_time" content="2011-03-29T20:39:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">安全策略禁止本机管理员登录解决办法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="artical-content-bak main-content editor-side-new"> 
 <div class="con editor-preview-side" id="result"> 
  <p>在Windows 2003环境下，被组策略拒绝本地登录一直是件比较令人头疼的事情。本文将介绍所有用户都被拒绝本地登录后的解决方法。</p> 
  <p><br> 在Windows2003中，如果某个用户被取消了本地登录权限，当这个用户本地登录计算机时，系统就会提示"此系统的本地策略不允许您采用交互式登录"，导致登录失败。遇到这种情况，通常请管理员在组策略中重新设置一下，将该用户从"拒绝本地登录"列表中删除或添加到"在本地登录"列表中即可。但如果因为操作失误或其它方面的原因，我们将所有用户的本地登录权限都禁止了(通常是禁止了users组（非域环境下）或domain users组（域环境下）)，那就有点麻烦了。这种情形看起来像一个解不开的"死结"：要解除禁止本地登录的组策略设置，必须以管理员身份本地登录；要以管理员身份本地登录，就必须先解除禁止本地登录的组策略设置。</p> 
  <p><br> 但实际上，事情并没有我们想象的那么糟。经过查询相关资料和测试，我发现借助网络的帮助,这个"死结"还是可以解开的。因为域安全策略与本地安全策略的数据保存机制不同，下面分两种情况分别进行说明。 <br><br> -------------------------------------------------------------------------------- <br><br><strong>被域策略拒绝本地登录时的解决办法</strong></p> 
  <p><br> 域策略的安全设置部分都保存在一个名为"GptTmpl.inf"的安全模板中，这是一个文本文件，存放在DC（域控制器）的SYSVOL（物理目录指向DC的“c:\winnt\sysvol\sysvol"）共享中。要解除对所有用户本地登录限制，在不能本地登录的情况下，最快捷的办法可能就是直接编辑这个文本文件。</p> 
  <p><br> 具体操作如下： <br>  </p> 
  <p>在另一台计算机（Win9X/2000/XP均可）上，使用域管理员账号连接到DC的SYSVOL共享，在"\\&lt;DC name&gt;\sysvol\&lt;Domain name&gt;\Policies\&lt;policy GUID&gt;\MACHINE\Microsoft\Windows NT\SecEdit"下找到该文本文件"GptTmpl.inf"。(路径中的"DC name"是你放置该组策略的域控制器的名字，"Domain name"是你的域的名字，"Policy GUID"是你要编辑的组策略对象的GUID，类似于"{31B2F340-016D-11D2-945F-05C04FB98439}")。 <br>  </p> 
  <p>使用记事本打开"GptTmpl.inf"文件，找到文件中"Privilege Rights"小节下的 "SeDenyInteractiveLogonRight"关键字，它的值就是被拒绝本地登录的用户或组的SID，将这些SID删除，使 "SeDenyInteractiveLogonRight"关键字的值为空。修改完毕将文件保存回原位置。 <br>  </p> 
  <p>使用记事本打开位于"\\&lt;DC name&gt;\sysvol\&lt;Domain name&gt;\Policies\&lt;policy GUID&gt;"下的 "GPT.INI"文件，提高"General"小节下的"Version"关键字的值，通常是加1000。这是我们修改的这个组策略对象的版本号，版本号提高后可以保证我们的更改被复制到其它DC上。修改完毕将文件保存回原位置。 <br>  </p> 
  <p>域策略刷新后，问题即告解决。 <br> 本地登录DC重新设置域策略中的相关项目。 <br><br> -------------------------------------------------------------------------------- <br><br><strong>被本地安全策略拒绝本地登录时的解决办法</strong> <br>  </p> 
  <p>由于在Windows2003中，不支持对计算机本地策略的安全设置部分进行远程管理（详见组策略白皮书），而且本地安全策略的安全设置通常存放在一个二进制的安全数据库secedit.sdb中，这个安全数据库的结构我们无从知道，因此象第一部分那样直接编辑secedit.sdb文件的办法是无能为力了，我们需要采用迂回进攻的策略，"曲线救国"。 <br>  </p> 
  <p>具体操作如下： <br>  </p> 
  <p>假设故障计算机的IP地址是"192.168.0.111"。在另一台计算机(Windows9X/2000/XP均可)上，使用"Telnet 192.168.0.111"命令使用管理员账号连接到故障计算机。（如果故障计算机的telnet"服务没有启动，可以通过网络使用"服务"MMC启动，具体方法不在详述） <br>  </p> 
  <p>通过telnet在故障计算机上执行"net share tmp$=d:\tmp"命令，将故障计算机上的"d:\tmp"隐藏共享为"tmp$"，共享权限缺省是everyone完全控制（此时要特别注意网络安全）。当然你也可以共享其它的目录。 <br>  </p> 
  <p>通过telnet在故障计算机上执行"secedit /export /CFG d:\tmp\sec.inf"命令，将故障计算机的本地安全策略配置导入"d:\tmp\sec.inf"安全模板文件中，这是一个文本文件。 <br> 连接到故障计算机上的tmp$共享，用记事本打开共享文件夹中的"sec.inf"文件。找到文件中"Privilege Rights"小节下的“SeDenyInteractiveLogonRight"关键字，它的值就是被拒绝本地登录的用户或组的SID，将这些SID删除，使"SeDenyInteractiveLogonRight"关键字的值为空或者是随便另设置一个无关的值。文件修改完毕保存回原位置。 <br>  </p> 
  <p>通过telnet在故障计算机上执行"secedit /configure /db c:\secedit.sdb /CFG d:\tmp\sec.inf"命令，使用新的安全模板和安全数据库重新配置故障计算机的本地安全策略。 <br>  </p> 
  <p>通过telnet在故障计算机上执行"secedit /refreshpolicy machine_policy /enforce"命令，强制在故障计算机上刷新策略设置，问题即告解决。 <br>  </p> 
  <p>本地登录故障计算机后，删除我们建立的Tmp$共享，重新设置本地安全策略中的相关项目。 <br>  </p> 
  <p> </p> 
  <p>----------------------------------------------------------------------------------</p> 
  <p> </p> 
  <p>用故障恢复控制台登录，然后在命令行下运行以下命令：<br> copy C:\WINNT\repair\security C:\WINNT\system32\config\security<br> 该方法主要是用初始安装的security注册表配置单元，覆盖应用拒绝本地登录策略后的注册表配置单元文件。<br>  </p> 
 </div> 
</div> 
<p>转载于:https://blog.51cto.com/18266/530136</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ef50ffc8b556da0570f10f3c9009582b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">观察者模式应用场景实例</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a437c9758e393ab80d37ade015381e47/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">nfs常见问题解决方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>