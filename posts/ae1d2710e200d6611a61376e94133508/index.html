<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MyBatis——Java 持久层框架 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MyBatis——Java 持久层框架" />
<meta property="og:description" content="文章目录 MyBatis 是什么准备工作创建一个数据库和表引入依赖 配置连接字符串和 MyBatisMyBatis 组成MyBatis 使用步骤定义一个类创建 MyBatis 接口（以查询所有为例）创建与接口对应的 xml 文件（实现接口中的所有方法）使用单元测试进行验证查询单条记录增加数据修改和删除 \#{} 和 ${} 的区别like 查询resultMap动态 SQL`&lt;if&gt;``&lt;trim&gt;``&lt;where&gt;``&lt;set&gt;``&lt;foreach&gt;` MyBatis 是什么 是一款持久层框架基于 JDBC可以通过方便的设置实现数据库操作 Mybatis（之前称为 iBatis）也是一个 ORM 框架，ORM（Object Relational Mapping），即对象关系映射。
ORM 把数据库映射为对象：
数据库表（table）–&gt;类（class）记录（record，行数据）–&gt;对象（object）字段（field）–&gt;对象的属性（attribute） 准备工作 创建一个数据库和表 create database mycnblog default character set utf8mb4; use mycnblog; create table userinfo( id int primary key auto_increment, username varchar(100) not null, password varchar(32) not null, photo varchar(500) default &#39;&#39;, createtime datetime default now(), updatetime datetime default now(), `state` int default 1 ) default charset &#39;utf8mb4&#39;; insert into userinfo values(1, &#39;admin&#39;, &#39;123&#39;, &#39;&#39;, &#39;2023-12-10 10:09:30&#39;, &#39;2023-12-10 10:09:30&#39;, 1); 引入依赖 MyBatis Framework 和 MySQL Driver" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ae1d2710e200d6611a61376e94133508/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-09T21:40:49+08:00" />
<meta property="article:modified_time" content="2023-12-09T21:40:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MyBatis——Java 持久层框架</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#MyBatis__1" rel="nofollow">MyBatis 是什么</a></li><li><a href="#_15" rel="nofollow">准备工作</a></li><li><ul><li><a href="#_17" rel="nofollow">创建一个数据库和表</a></li><li><a href="#_37" rel="nofollow">引入依赖</a></li></ul> 
  </li><li><a href="#_MyBatis_43" rel="nofollow">配置连接字符串和 MyBatis</a></li><li><a href="#MyBatis__88" rel="nofollow">MyBatis 组成</a></li><li><a href="#MyBatis__95" rel="nofollow">MyBatis 使用步骤</a></li><li><ul><li><a href="#_97" rel="nofollow">定义一个类</a></li><li><a href="#_MyBatis__120" rel="nofollow">创建 MyBatis 接口（以查询所有为例）</a></li><li><a href="#_xml__142" rel="nofollow">创建与接口对应的 xml 文件（实现接口中的所有方法）</a></li><li><a href="#_170" rel="nofollow">使用单元测试进行验证</a></li><li><a href="#_213" rel="nofollow">查询单条记录</a></li><li><a href="#_248" rel="nofollow">增加数据</a></li><li><a href="#_323" rel="nofollow">修改和删除</a></li></ul> 
  </li><li><a href="#____327" rel="nofollow">\#{} 和 ${} 的区别</a></li><li><a href="#like__357" rel="nofollow">like 查询</a></li><li><a href="#resultMap_406" rel="nofollow">resultMap</a></li><li><a href="#_SQL_432" rel="nofollow">动态 SQL</a></li><li><ul><li><a href="#if_436" rel="nofollow">`&lt;if&gt;`</a></li><li><a href="#trim_466" rel="nofollow">`&lt;trim&gt;`</a></li><li><a href="#where_513" rel="nofollow">`&lt;where&gt;`</a></li><li><a href="#set_572" rel="nofollow">`&lt;set&gt;`</a></li><li><a href="#foreach_613" rel="nofollow">`&lt;foreach&gt;`</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="MyBatis__1"></a>MyBatis 是什么</h2> 
<ul><li>是一款持久层框架</li><li>基于 JDBC</li><li>可以通过方便的设置实现数据库操作</li></ul> 
<p>Mybatis（之前称为 iBatis）也是一个 ORM 框架，ORM（Object Relational Mapping），即对象关系映射。</p> 
<p>ORM 把数据库映射为对象：</p> 
<ul><li>数据库表（table）–&gt;类（class）</li><li>记录（record，行数据）–&gt;对象（object）</li><li>字段（field）–&gt;对象的属性（attribute）</li></ul> 
<h2><a id="_15"></a>准备工作</h2> 
<h3><a id="_17"></a>创建一个数据库和表</h3> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">database</span> mycnblog <span class="token keyword">default</span> <span class="token keyword">character</span> <span class="token keyword">set</span> utf8mb4<span class="token punctuation">;</span>

<span class="token keyword">use</span> mycnblog<span class="token punctuation">;</span>

<span class="token keyword">create</span> <span class="token keyword">table</span> userinfo<span class="token punctuation">(</span>
    id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>
    username <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    password <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    photo <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">''</span><span class="token punctuation">,</span>
    createtime <span class="token keyword">datetime</span> <span class="token keyword">default</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    updatetime <span class="token keyword">datetime</span> <span class="token keyword">default</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>state<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">default</span> <span class="token number">1</span>
<span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token keyword">charset</span> <span class="token string">'utf8mb4'</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> userinfo <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'123'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'2023-12-10 10:09:30'</span><span class="token punctuation">,</span> <span class="token string">'2023-12-10 10:09:30'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_37"></a>引入依赖</h3> 
<p>MyBatis Framework 和 MySQL Driver</p> 
<p>引入之后，我们的项目是启动不了的，还需要进行配置。</p> 
<h2><a id="_MyBatis_43"></a>配置连接字符串和 MyBatis</h2> 
<p>配置 application.yml，指定要连接的数据库在哪</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/mycnblog<span class="token punctuation">?</span>characterEncoding=utf8<span class="token important">&amp;useSSL=false</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
</code></pre> 
<blockquote> 
 <p>如果 mysql-connector-java 是5.x 之前的使用的是 com.mysql.jdbc.Driver，之后的使用的是 com.mysql.cj.jdbc.Driver</p> 
</blockquote> 
<p>指定 MyBatis 在哪里查找映射器（Mapper）的 XML 文件：</p> 
<p>在 MyBatis 中，Mapper 文件定义了 SQL 映射和与数据库的交互。</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">**Mapper.xml</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/1d/6e/JY9Rmgeu_o.png" alt="img"></p> 
<p><code>classpath:mapper/**Mapper.xml</code>：表示在类路径（classpath）下的 <code>mapper</code> 目录中查找所有以 <code>Mapper.xml</code> 结尾的文件。</p> 
<p>** 是通配符，它和 * 的区别是：</p> 
<ul><li><code>**</code> 包括子目录，可以递归匹配多级子目录。</li><li><code>*</code> 不包括子目录，只匹配当前目录下的文件。</li></ul> 
<p>如果想看 MyBatis 最终执行的 SQL 语句，还可以进行如下配置：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
    <span class="token key atrule">log-impl</span><span class="token punctuation">:</span> org.apache.ibatis.logging.stdout.StdOutImpl
</code></pre> 
<p>完成上述操作，启动项目，如果可以启动，就说明我们的环境配置完成了。</p> 
<hr> 
<h2><a id="MyBatis__88"></a>MyBatis 组成</h2> 
<p>MyBatis 主要由两部分组成：</p> 
<ol><li><strong>接口（Mapper 接口）：</strong> MyBatis 的接口用于定义数据库操作的方法。每个接口方法通常对应一个数据库操作，比如查询、插入、更新或删除数据。这些接口方法的签名定义了输入参数和返回类型，而实际的 SQL 查询则是通过 XML 文件或注解来配置的。</li><li><strong>XML 文件（Mapper XML 文件）：</strong> MyBatis 的 XML 文件用于存放 SQL 映射配置，即将接口方法与实际的 SQL 语句进行关联。XML 文件中包含了数据库操作的具体 SQL 语句，以及输入参数和输出结果的映射关系。每个 Mapper 接口通常对应一个同名的 XML 文件。</li></ol> 
<h2><a id="MyBatis__95"></a>MyBatis 使用步骤</h2> 
<h3><a id="_97"></a>定义一个类</h3> 
<p>这个类的属性名和数据库表中的字段名一致</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mybatisdemo<span class="token punctuation">.</span>model</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Date</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserInfo</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> photo<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> createtime<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> updatetime<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_MyBatis__120"></a>创建 MyBatis 接口（以查询所有为例）</h3> 
<p><code>@Mapper</code> 注解是 MyBatis 框架中用于标识一个接口为 MyBatis 映射器（Mapper）的注解。</p> 
<p>当你在一个接口上使用 <code>@Mapper</code> 注解时，MyBatis 将会扫描这个接口，并为其创建一个实现类，用于执行与数据库相关的 SQL 操作。</p> 
<p>Spring 将会在运行时为这个接口生成代理对象，使其可以被注入到其他组件中</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mybatisdemo<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>ibatis<span class="token punctuation">.</span>annotations<span class="token punctuation">.</span></span><span class="token class-name">Mapper</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mybatisdemo<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">UserInfo</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Mapper</span> <span class="token comment">// 此注解表示这是一个 mybatis 接口</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_xml__142"></a>创建与接口对应的 xml 文件（实现接口中的所有方法）</h3> 
<p><img src="https://images2.imgbox.com/3c/1c/g1ecDa7n_o.png" alt="img"></p> 
<p>xml 文件中复制如下代码（固定格式）：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><code>namespace</code> 里填要实现的接口的路径。</p> 
<p>例：mapper 里面添加 select 标签，表示要实现查询方法，id 指定实现的方法名（和接口中的一致），result 指定返回的记录的类型，标签内部填写具体的 sql 语句</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.example.mybatisdemo.mapper.UserMapper<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getAll<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.example.mybatisdemo.model.UserInfo<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        select * from userinfo
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="_170"></a>使用单元测试进行验证</h3> 
<p>在要测试的代码上右键，选择 Generate-&gt;Test</p> 
<p><img src="https://images2.imgbox.com/b9/34/8waAAQiD_o.png" alt="img"></p> 
<p>生成的测试类会进入到 test 目录下面</p> 
<p>设置当前测试环境为 SpringBoot，并注入要测试的类：</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mybatisdemo<span class="token punctuation">.</span>mapper</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>example<span class="token punctuation">.</span>mybatisdemo<span class="token punctuation">.</span>model<span class="token punctuation">.</span></span><span class="token class-name">UserInfo</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootTest</span> <span class="token comment">// 当前测试的上下文环境为SpringBoot</span>
<span class="token keyword">class</span> <span class="token class-name">UserMapperTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span> <span class="token comment">// 注入要测试的类</span>
    <span class="token keyword">private</span> <span class="token class-name">UserMapper</span> userMapper<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span> <span class="token comment">// 测试</span>
    <span class="token keyword">void</span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">UserInfo</span> user <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行测试方法，查看测试结果：</p> 
<pre><code>UserInfo(id=1, username=admin, password=123, photo=, createtime=Sun Dec 10 10:09:30 HKT 2023, updatetime=Sun Dec 10 10:09:30 HKT 2023, state=1)
</code></pre> 
<hr> 
<h3><a id="_213"></a>查询单条记录</h3> 
<p>查询单条记录需要提供参数，供 where 语句使用。</p> 
<p>在抽象方法的参数列表中，用 <code>@Param</code> 注解指定传递给 SQL 语句的参数名</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Mapper</span> <span class="token comment">// 此注解表示这是一个 mybatis 接口</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">UserInfo</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在 XML 映射文件中，可以使用 <code>#{id}</code> 来引用方法参数。</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserById<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.example.mybatisdemo.model.UserInfo<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    select * from userinfo where id = #{id}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>注：<code>@Param("id")</code> 也可以省略，通常建议写上。</p> 
<p>测试：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">UserInfo</span> userInfo <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_248"></a>增加数据</h3> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Mapper</span> <span class="token comment">// 此注解表示这是一个 mybatis 接口</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> <span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">UserInfo</span> <span class="token function">getUserById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">UserInfo</span> userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 传入的是对象，不加 @Param 注解</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>xml 文件中使用 insert 标签，直接用 #{属性名} 来获取对象中的属性：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>add<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    insert into userinfo(username, password)
    values (#{username}, #{password})
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>如果传入对象的时候加了 @Param 注解，如：</p> 
<pre><code class="prism language-java"><span class="token keyword">int</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Param</span><span class="token punctuation">(</span><span class="token string">"userInfo"</span><span class="token punctuation">)</span> <span class="token class-name">UserInfo</span> userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>那么 xml 获取属性的时候，必须要使用 <code>.</code></p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>add<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    insert into userinfo(username, password)
    values (#{userInfo.username}, #{userInfo.password})
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>测试：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">UserInfo</span> userInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userInfo<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userInfo<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> effect <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"影响的行数："</span> <span class="token operator">+</span> effect<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>增加数据的时候返回自增主键</strong></p> 
<p>在 insert 标签属性中添加 useGeneratedKeys=“true” keyProperty=“id”</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>add<span class="token punctuation">"</span></span> <span class="token attr-name">useGeneratedKeys</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span> <span class="token attr-name">keyProperty</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<ul><li><code>useGeneratedKeys="true"</code>：这个属性用于指定是否使用数据库自动生成的主键。当设置为 <code>true</code> 时，表示插入数据后，将从数据库获取生成的主键值，并将其设置到相应的属性中。</li><li><code>keyProperty="id"</code>：如果 <code>useGeneratedKeys</code> 设置为 <code>true</code>，则需要使用 <code>keyProperty</code> 属性指定将生成的主键值设置到哪个 Java 对象的属性中。在这个例子中，表示将生成的主键值设置到 Java 对象的 <code>id</code> 属性中。</li></ul> 
<p>测试：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">UserInfo</span> userInfo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userInfo<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"zhangsan"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    userInfo<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> effect <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>userInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"影响的行数："</span> <span class="token operator">+</span> effect <span class="token operator">+</span> <span class="token string">" id: "</span> <span class="token operator">+</span> userInfo<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 输出：影响的行数：1 id: 3</span>
</code></pre> 
<h3><a id="_323"></a>修改和删除</h3> 
<p>在 xml 中分别使用的是 update 标签和 delete 标签，除此以外，其他的关于 MyBatis 的操作都和查询、增加一样，这里不再赘述。</p> 
<h2><a id="____327"></a>#{} 和 ${} 的区别</h2> 
<p>#{} 和 ${} 在构造 SQL 语句的方式上存在差异：</p> 
<ol><li><strong><code>#{}</code> 表达式（预编译）：</strong> 
  <ul><li><code>#{}</code> 表达式是 MyBatis 中用于预编译参数的占位符。这种方式会在 SQL 语句中使用占位符 <code>?</code>，然后通过预编译的方式向 SQL 语句中传递参数。这样可以有效防止 SQL 注入攻击。</li></ul> </li><li><strong><code>${}</code> 表达式（字符串拼接）：</strong> 
  <ul><li><code>${}</code> 表达式是用于字符串拼接的方式。在 SQL 语句中，<code>${}</code> 会直接替换成参数的字符串表示形式，不会进行预编译。</li></ul> </li></ol> 
<p>预编译的方式具有以下优点：</p> 
<ol><li><strong>参数类型校验：</strong> 预编译时数据库引擎能够获取到参数的类型信息，可以对参数进行类型校验。如果传递给数据库的参数类型与预期的类型不匹配，数据库引擎通常会拒绝执行。</li><li><strong>转义处理：</strong> 预编译会对参数值进行转义处理，确保特殊字符不会破坏 SQL 语句的结构。这有助于防止恶意构造的参数值破坏 SQL 查询语句。</li></ol> 
<hr> 
<p>绝大部分场景都是使用 <code>#{}</code> ，但是也有部分场景适合使用 <code>${}</code></p> 
<p>比如我要传递的参数是 SQL 中的关键字，比如 asc 和 desc</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getAllByOrder<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.example.mybatisdemo.model.UserInfo<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    select * from userinfo order by ${order}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>如果使用 <code>#{}</code> 则会将关键字识别成字符串，在最终生成的 SQL 语句中画蛇添足地增加 <code>''</code>，比如 <code>select * from userinfo order by 'desc'</code> 导致 SQL 语法错误。直接使用 <code>${}</code> 字符串拼接的方式就简便很多。</p> 
<p>而且我们可以在代码中 if 判断，保证传入的参数只能是 asc 和 desc，从而防止 SQL 注入。</p> 
<h2><a id="like__357"></a>like 查询</h2> 
<p>模糊查询获取参数也必须用 <code>#{}</code> ，不能用 <code>${}</code> 因为传入的参数是无法穷举的，有 SQL 注入的风险。</p> 
<p>而 <code>#{}</code> 会画蛇添足，和通配符 <code>%</code> <code>_</code> 配合使用不太方便。</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>searchUsers<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.example.mybatisdemo.model.UserInfo<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    select * from userinfo
    where username like '%#{pattern}%'
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>以上代码最后构造的 SQL 语句形如 <code> select * from userinfo where username like '%'s'%'</code></p> 
<p>解决方法：</p> 
<p>要么写成下面的形式，<code>%</code> 直接通过 Java 代码传入：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>searchUsers<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.example.mybatisdemo.model.UserInfo<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    select * from userinfo
    where username like #{pattern}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>Java 代码：</p> 
<pre><code class="prism language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">searchUsers</span><span class="token punctuation">(</span><span class="token string">"%s%"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这样自动添加 <code>''</code> 后就正确了。</p> 
<p>要么使用 concat：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>searchUsers<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.example.mybatisdemo.model.UserInfo<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    select * from userinfo
    where username like concat('%', #{pattern}, '%')
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>Java 代码：</p> 
<pre><code class="prism language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UserInfo</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> userMapper<span class="token punctuation">.</span><span class="token function">searchUsers</span><span class="token punctuation">(</span><span class="token string">"s"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="resultMap_406"></a>resultMap</h2> 
<p><code>resultMap</code> 是一种用于映射查询结果集的配置元素。它允许你定义一个映射规则，将数据库查询结果的列映射到 Java 对象的属性中。</p> 
<p>简单来说，这种方式可以让 Java 代码中的类的属性名，和数据库中的字段名在不一致的情况下也能一一对应。</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resultMap</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userResultMap<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.example.mybatisdemo.model.UserInfo<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_id<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_name<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>result</span> <span class="token attr-name">property</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">column</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user_password<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token comment">&lt;!-- 其他属性的映射... --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resultMap</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<ul><li><code>id</code> 元素用于定义主键映射，<code>property</code> 指定了 Java 对象中的属性名，<code>column</code> 指定了数据库结果集中的列名。</li><li><code>result</code> 元素用于定义其他属性的映射规则。</li></ul> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserById<span class="token punctuation">"</span></span> <span class="token attr-name">resultMap</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>userResultMap<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    select * from users where user_id = #{userId}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><code>getUserById</code> 查询将使用名为 <code>userResultMap</code> 的 <code>resultMap</code> 进行结果映射。MyBatis 将查询结果中的列按照 <code>resultMap</code> 中定义的映射规则进行映射，从而创建一个包含查询结果的 Java 对象。</p> 
<h2><a id="_SQL_432"></a>动态 SQL</h2> 
<p>动态 SQL 是指在 SQL 语句中根据不同的条件或参数动态生成不同的 SQL 片段的技术。在 MyBatis 中，动态 SQL 主要通过使用 <code>&lt;if&gt;、&lt;choose&gt;、&lt;when&gt;、&lt;otherwise&gt;、&lt;trim&gt;、&lt;where&gt;、&lt;set&gt;</code> 等 XML 元素来实现。</p> 
<h3><a id="if_436"></a><code>&lt;if&gt;</code></h3> 
<p><code>&lt;if&gt;</code> 标签用于在 SQL 语句中根据条件动态包含或排除某段 SQL 语句。</p> 
<p>基本的 <code>&lt;if&gt;</code> 标签语法如下：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>condition<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 要包含的 SQL 语句片段 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><code>test</code> 属性用于指定一个条件表达式，如果条件表达式为真，那么 <code>&lt;if&gt;</code> 内部定义的 SQL 语句片段将会被包含在最终的 SQL 语句中。如果条件表达式为假，则这部分 SQL 语句将被忽略。</p> 
<p>例子：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserByCondition<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    SELECT * FROM users
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>where</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username != null and username != ''<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            AND username = #{username}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password != null and password != ''<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            AND password = #{password}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>where</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="trim_466"></a><code>&lt;trim&gt;</code></h3> 
<p><code>&lt;trim&gt;</code> 标签，用于在生成 SQL 语句时处理多余的空白字符，同时可以根据条件来动态添加或移除 SQL 片段的开头或结尾。</p> 
<p><code>&lt;trim&gt;</code> 元素的基本语法结构如下：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>trim</span> <span class="token attr-name">prefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">prefixOverrides</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">suffix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">suffixOverrides</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- SQL 语句片段 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>trim</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<ul><li><code>prefix</code> 属性用于指定在 SQL 语句片段前添加的内容。</li><li><code>prefixOverrides</code> 属性用于指定需要从 SQL 语句片段开头移除的前缀，可以是逗号分隔的前缀列表。</li><li><code>suffix</code> 属性用于指定在 SQL 语句片段后添加的内容。</li><li><code>suffixOverrides</code> 属性用于指定需要从 SQL 语句片段结尾移除的后缀，可以是逗号分隔的后缀列表。</li></ul> 
<p>示例：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserByCondition<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    select * from users
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>trim</span> <span class="token attr-name">prefix</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>where<span class="token punctuation">"</span></span> <span class="token attr-name">prefixOverrides</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>and | or<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username != null and username != ''<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            and username = #{username}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>password != null and password != ''<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            or password = #{password}
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>trim</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>在这个例子中，<code>&lt;trim&gt;</code> 元素的作用是处理 <code>WHERE</code> 子句，根据动态条件来生成合适的查询语句。具体解释如下：</p> 
<ul><li><code>prefix="where"</code> 指定了在 SQL 语句片段前添加的内容，即添加了 <code>where</code>。</li><li><code>prefixOverrides="and | or"</code> 指定了需要从 SQL 语句片段开头移除的前缀，即移除了可能出现的多余的 <code>and</code> 或 <code>or</code>。</li><li>在 <code>&lt;trim&gt;</code> 元素内部，根据动态条件使用 <code>&lt;if&gt;</code> 元素生成相应的查询条件。</li></ul> 
<p>假设在执行这个查询时，传入的参数是 <code>username="John"</code>，<code>password=null</code>，最终生成的 SQL 语句会是：</p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> users
<span class="token keyword">where</span>
    username <span class="token operator">=</span> <span class="token string">'John'</span>
</code></pre> 
<h3><a id="where_513"></a><code>&lt;where&gt;</code></h3> 
<p><code>&lt;where&gt;</code> 标签用于在 where 子句中动态生成条件。<code>&lt;where&gt;</code> 元素会自动处理生成的条件之间的逻辑关系，避免不必要的 and 或 or 连接符。</p> 
<p>基本的 <code>&lt;where&gt;</code> 标签语法如下：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>getUserByCondition<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    SELECT * FROM users
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>where</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 动态生成的条件 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>where</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>其示例在 if 标签已经涉及到。</p> 
<p>例：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectUsers<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  SELECT * FROM users
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>where</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      AND name = #{name}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>age != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      AND age = #{age}
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 可以根据需要添加更多的条件 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>where</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>假设传入的参数是 <code>name = 'John'</code> 和 <code>age = 25</code>，生成的 SQL 语句将类似于：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users
<span class="token keyword">WHERE</span>
  name <span class="token operator">=</span> <span class="token string">'John'</span>
  <span class="token operator">AND</span> age <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
</code></pre> 
<p>如果只传入了 <code>name = 'John'</code>，而没有传入 <code>age</code> 参数，生成的 SQL 语句将是：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users
<span class="token keyword">WHERE</span>
  name <span class="token operator">=</span> <span class="token string">'John'</span><span class="token punctuation">;</span>
</code></pre> 
<p>如果两个条件都没有被传入，生成的 SQL 语句将仅包含基本的 SELECT 语句，而不包含 WHERE 子句：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users<span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>where 标签更简单地完成了上面 trim 标签的例子</p> 
</blockquote> 
<h3><a id="set_572"></a><code>&lt;set&gt;</code></h3> 
<p><code>&lt;set&gt;</code> 元素针对 update 语句。它主要用于处理动态更新表中的列，根据传入的参数动态生成 set 子句。<code>&lt;set&gt;</code> 元素可以使得在更新记录时只更新传入的非空字段，从而避免更新所有字段，提高了 SQL 语句的灵活性。</p> 
<p>例子：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>update</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>updateUser<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  UPDATE users
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>name != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      name = #{name},
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>if</span> <span class="token attr-name">test</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>age != null<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
      age = #{age},
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>if</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 可以根据需要添加更多的更新字段 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">&gt;</span></span>
  WHERE id = #{id}
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>update</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>例如，如果调用上述的更新方法时传入了 <code>name = 'John'</code> 和 <code>age = 25</code>，生成的 SQL 语句将类似于：</p> 
<pre><code class="prism language-sql"><span class="token keyword">UPDATE</span> users
<span class="token keyword">SET</span>
  name <span class="token operator">=</span> <span class="token string">'John'</span><span class="token punctuation">,</span>
  age <span class="token operator">=</span> <span class="token number">25</span>
<span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token comment">#{id};</span>
</code></pre> 
<p>如果只传入了 <code>name = 'John'</code> 而没有传入 <code>age</code> 参数，生成的 SQL 语句将是：</p> 
<pre><code class="prism language-sql"><span class="token keyword">UPDATE</span> users
<span class="token keyword">SET</span>
  name <span class="token operator">=</span> <span class="token string">'John'</span>
<span class="token keyword">WHERE</span> id <span class="token operator">=</span> <span class="token comment">#{id};</span>
</code></pre> 
<h3><a id="foreach_613"></a><code>&lt;foreach&gt;</code></h3> 
<p><code>&lt;foreach&gt;</code> 通常用于动态生成 SQL 语句中的 IN 子句，允许我们在查询或更新操作中使用一组值。<code>&lt;foreach&gt;</code> 主要用于遍历集合或数组，并根据集合中的元素动态生成相应的 SQL 片段。</p> 
<p>例子：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>selectUsersByIds<span class="token punctuation">"</span></span> <span class="token attr-name">resultType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>User<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.util.List<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  SELECT * FROM users
  WHERE id IN
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ids<span class="token punctuation">"</span></span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>id<span class="token punctuation">"</span></span> <span class="token attr-name">open</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(<span class="token punctuation">"</span></span> <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>,<span class="token punctuation">"</span></span> <span class="token attr-name">close</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>)<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    #{id}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>在上述例子中，<code>&lt;foreach&gt;</code> 元素用于循环遍历传入的 <code>ids</code> 集合，并根据集合中的元素动态生成 IN 子句。其中，<code>collection</code> 属性指定了要迭代的集合，<code>item</code> 属性指定了集合中的元素变量名，<code>open</code> 属性定义了 IN 子句的开头，<code>separator</code> 属性定义了元素之间的分隔符，<code>close</code> 属性定义了 IN 子句的结尾。</p> 
<p>例如，如果传入的 <code>ids</code> 集合为 <code>[1, 2, 3]</code>，生成的 SQL 语句将类似于：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users
<span class="token keyword">WHERE</span> id <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>&lt;foreach&gt;</code> 元素也可以用于其他操作，比如在插入操作中批量插入数据。下面是一个简单的插入示例：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>insert</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>insertUsers<span class="token punctuation">"</span></span> <span class="token attr-name">parameterType</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>java.util.List<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
  INSERT INTO users (name, age)
  VALUES
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>foreach</span> <span class="token attr-name">collection</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list<span class="token punctuation">"</span></span> <span class="token attr-name">item</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>user<span class="token punctuation">"</span></span> <span class="token attr-name">separator</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>,<span class="token punctuation">"</span></span> <span class="token punctuation">&gt;</span></span>
    (#{user.name}, #{user.age})
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>foreach</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>insert</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><code>&lt;foreach&gt;</code> 元素用于循环遍历传入的 <code>list</code> 集合，并根据集合中的元素动态生成插入语句。这种方式可以在一次数据库操作中插入多条记录，提高了效率。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2cce66be07bb45e2cfb039837d26c796/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于SpringBoot框架的管理系统【完整项目源码免费下载】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ac2bd5026baa953a6384925ba58d0de1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">人工智能轨道交通行业周刊-第68期（2023.12.4-12.10）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>