<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>企业微信自动打卡插件开发 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="企业微信自动打卡插件开发" />
<meta property="og:description" content="今日科技快讯 近日中国多家VPN供应商已收到了来自苹果公司的通知，通知主要告知这些供应商和开发者，他们的软件将从中国区App Store下架。对此苹果方面表示，工信部今年早些时候宣布，所有提供VPN服务的开发者必须获得政府的许可，我们被要求移除一些不符合新规定的VPN应用。苹果同时补充道：其它国家/地区的帐单地址的用户将能够继续从App Store中访问这些软件。
作者简介 新的一周开始了，很高兴又跟大家见面了！
本篇来自 splm 的投稿，分享了如何实现公司微信自动化打卡，本文只是分析了技术，并不赞同实际使用！ 思考 需求不容赘述，能找到这个文章的人，估计都心怀鬼胎，哈哈，只希望大家能够从技术的角度看待这个插件，切忌不要做“不好”的事情，年纪都不小了，应该做到是非分明。最后再警告大家，严格律己，遵守公司规章制度。
自动打卡，究竟如何自动化？
实现自动化，定要模拟用户操作，单击，长按，触摸等事件，那么....没错，就需要臭名昭著的 AccessibilityService。
打卡地点，究竟如何模拟？
1. Xposed框架，定位有三种方式，网络，基站和GPS，三者也有优先级，但也可简单粗暴直接拦截系统GPS定位，至于网络，基站定位都给 null。
2. 模拟器，主流的模拟器可以模拟地理位置，开发期间推荐使用模拟器进行调试；
多说一句使用 Xposed 框架，功能异常强大，但调试起来比较烦，虽说自带日志，但时不时就需要来次重启，着实有点闹心。所以在开发过程中，模拟地理位置，只是其中一环，所以为了不影响开发，可以先用模拟器去模拟地理位置，待到打卡功能完善了后再考虑定位的事情，毕竟这由涉及到了 Xposed 插件开发。
开发 了解API
至于 AccessService 如何配置，构造配置这个就不多说了，不是本文重点。如果不会，可以参考这个：
微信抢红包插件
http://blog.csdn.net/dd864140130/article/details/51794318
继承了 AccessService 后，我们需要实现 onAccessibilityEvent 方法，这个方法的意思就是在触发了事件进行回调，至于你想捕捉何种事件，详情参考API，这里只列举在本例使用到的事件：
AccessibilityEvent.TYPE_NOTIFICATION_STATE_CHANGED:当通知栏发生变化时，也就是当有新通知显示在通知栏时触发；
AccessibilityEvent.TYPE_WINDOW_STATE_CHANGED:当窗体发生改变时触发，Activity，Fragment 的切换都会触发；
除此之外我们还需要关注 AccessibilityNodeInfo 实例的重要方法：
findAccessibilityNodeInfosByText：根据文本查找控件，可能会得到一个集合；
findAccessibilityNodeInfosByViewId：根据ID查找控件，会比较精准；
了解WXUI的构造
首先自己去搞一个企业WX的测试账号，成功登录后会进入如下界面：
了解代码
打卡功能是在工作台下的，所以需要先进入打卡模块，但这一系列操作都手动点击就失去了自动化的意义了，因此 AccessService 第一次介入，代码如下：
上述代码就能自动点击工作台按钮，这个代码是我们的核心部分。关于 findTagToClick() 是什么？等下介绍，先说几个需要注意的地方：
这是最重要的，如果想要一个控件响应单击事件，有几种办法?
1. OnClickListener
2. OnTouch() 处理 ActionDown 和 ActionUp 事件。
但重中之重就是该控件的属是 onClickable=true 的也就是可以被点击的，如果该属性为 false，那么辅助服务不能执行单击事件，至少我遇到的是这样。我在开发自动点击工作台这个步骤时，心想只要通过文本内容，拿到指定控件，然后执行单击就可以了。但结果怎样？没有任何反应，原因肯定就是控件没有接收事件，这是我遇到的第一个问题。
多说一句，为何 setOnClickListener 后就看见单击了？" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/cbf45ac17b8de1d327c183a40949a140/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-07-31T08:00:15+08:00" />
<meta property="article:modified_time" content="2017-07-31T08:00:15+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">企业微信自动打卡插件开发</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="text-align: center;"><img class="" src="https://images2.imgbox.com/b5/f7/dwP6qcXP_o.png"></p> 
<section class="" style="white-space: normal; max-width: 100%; color: rgb(62, 62, 62); font-size: 18px; line-height: 25.6px;  box-sizing: border-box !important; word-wrap: break-word !important;"> 
 <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
  <section class="" style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;"> 
   <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
    <section class="" style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;"> 
     <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
      <section class="" style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;"> 
       <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
        <section class="" style="margin-top: 0.5em; margin-bottom: 0.5em; max-width: 100%; border-bottom: 2px solid rgb(105, 135, 166); clear: both; box-sizing: border-box !important; word-wrap: break-word !important;"> 
         <section class="" style="padding-top: 3px; padding-right: 10px; padding-left: 10px; max-width: 100%; display: inline-block; color: rgb(255, 255, 255); border-top-left-radius: 3px; border-top-right-radius: 3px; height: 28px; background-color: rgb(105, 135, 166); box-sizing: border-box !important; word-wrap: break-word !important;"> 
          <span style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">今日科技快讯</span> 
         </section> 
         <section style="max-width: 100%; border-top: 28px solid transparent; border-right-color: rgb(206, 206, 206); border-bottom: 0px solid transparent; border-left: 15px solid rgb(206, 206, 206); display: inline-block; vertical-align: top; box-sizing: border-box !important; word-wrap: break-word !important;"></section> 
        </section> 
       </section> 
      </section> 
     </section> 
    </section> 
   </section> 
  </section> 
 </section> 
</section> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">近日中国多家VPN供应商已收到了来自苹果公司的通知，通知主要告知这些供应商和开发者，他们的软件将从中国区App Store下架。对此苹果方面表示，工信部今年早些时候宣布，所有提供VPN服务的开发者必须获得政府的许可，我们被要求移除一些不符合新规定的VPN应用。苹果同时补充道：其它国家/地区的帐单地址的用户将能够继续从App Store中访问这些软件。</span></p> 
<section class="" style="white-space: normal; max-width: 100%; color: rgb(62, 62, 62); font-size: 18px; line-height: 25.6px;  box-sizing: border-box !important; word-wrap: break-word !important;"> 
 <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
  <section class="" style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;"> 
   <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
    <section class="" style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;"> 
     <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
      <section class="" style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;"> 
       <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
        <section class="" style="margin-top: 0.5em; margin-bottom: 0.5em; max-width: 100%; border-bottom: 2px solid rgb(105, 135, 166); clear: both; box-sizing: border-box !important; word-wrap: break-word !important;"> 
         <section class="" style="padding-top: 3px; padding-right: 10px; padding-left: 10px; max-width: 100%; display: inline-block; color: rgb(255, 255, 255); border-top-left-radius: 3px; border-top-right-radius: 3px; height: 28px; background-color: rgb(105, 135, 166); box-sizing: border-box !important; word-wrap: break-word !important;"> 
          <span style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">作者简介</span> 
         </section> 
         <section style="max-width: 100%; border-top: 28px solid transparent; border-right-color: rgb(206, 206, 206); border-bottom: 0px solid transparent; border-left: 15px solid rgb(206, 206, 206); display: inline-block; vertical-align: top; box-sizing: border-box !important; word-wrap: break-word !important;"></section> 
        </section> 
       </section> 
      </section> 
     </section> 
    </section> 
   </section> 
  </section> 
 </section> 
</section> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">新的一周开始了，很高兴又跟大家见面了！</span></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">本篇来自 <strong>splm</strong> 的投稿，分享了如何实现公司微信自动化打卡，本文只是分析了技术，并不赞同实际使用！ </span></p> 
<section class="" style="white-space: normal; max-width: 100%; color: rgb(62, 62, 62); font-size: 18px; line-height: 25.6px;  box-sizing: border-box !important; word-wrap: break-word !important;"> 
 <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
  <section class="" style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;"> 
   <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
    <section class="" style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;"> 
     <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
      <section class="" style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;"> 
       <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
        <section class="" style="margin-top: 0.5em; margin-bottom: 0.5em; max-width: 100%; border-bottom: 2px solid rgb(105, 135, 166); clear: both; box-sizing: border-box !important; word-wrap: break-word !important;"> 
         <section class="" style="padding-top: 3px; padding-right: 10px; padding-left: 10px; max-width: 100%; display: inline-block; color: rgb(255, 255, 255); border-top-left-radius: 3px; border-top-right-radius: 3px; height: 28px; background-color: rgb(105, 135, 166); box-sizing: border-box !important; word-wrap: break-word !important;"> 
          <span style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">思考</span> 
         </section> 
         <section style="max-width: 100%; border-top: 28px solid transparent; border-right-color: rgb(206, 206, 206); border-bottom: 0px solid transparent; border-left: 15px solid rgb(206, 206, 206); display: inline-block; vertical-align: top; box-sizing: border-box !important; word-wrap: break-word !important;"></section> 
        </section> 
       </section> 
      </section> 
     </section> 
    </section> 
   </section> 
  </section> 
 </section> 
</section> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">需求不容赘述，能找到这个文章的人，估计都心怀鬼胎，哈哈，只希望大家能够从技术的角度看待这个插件，切忌不要做“不好”的事情，年纪都不小了，应该做到是非分明。最后再警告大家，严格律己，遵守公司规章制度。</span></p> 
<ul class=" list-paddingleft-2" style="list-style-type: square;"><li><p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;"><strong>自动打卡，究竟如何自动化？</strong></span></p></li></ul> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">实现自动化，定要模拟用户操作，单击，长按，触摸等事件，那么....没错，就需要臭名昭著的 AccessibilityService。</span></p> 
<ul class=" list-paddingleft-2" style="list-style-type: square;"><li><p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;"><strong>打卡地点，究竟如何模拟？</strong></span></p></li></ul> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;"></span><strong><span style="font-size: 14px;">1. </span></strong><strong><span style="font-size: 14px;">Xposed框架</span></strong><span style="font-size: 14px;">，定位有三种方式，网络，基站和GPS，三者也有优先级，但也可简单粗暴直接拦截系统GPS定位，至于网络，基站定位都给 null。</span></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><strong><span style="font-size: 14px;">2. </span></strong><strong><span style="font-size: 14px;">模拟器</span></strong><span style="font-size: 14px;">，主流的模拟器可以模拟地理位置，开发期间推荐使用模拟器进行调试；</span></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">多说一句使用 Xposed 框架，功能异常强大，但调试起来比较烦，虽说自带日志，但时不时就需要来次重启，着实有点闹心。所以在开发过程中，模拟地理位置，只是其中一环，所以为了不影响开发，可以先用模拟器去模拟地理位置，待到打卡功能完善了后再考虑定位的事情，毕竟这由涉及到了 Xposed 插件开发。</span></p> 
<p><span style="color: rgb(255, 172, 170);"></span></p> 
<section class="" style="white-space: normal; max-width: 100%; color: rgb(62, 62, 62); font-size: 18px; line-height: 25.6px;  box-sizing: border-box !important; word-wrap: break-word !important;"> 
 <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
  <section class="" style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;"> 
   <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
    <section class="" style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;"> 
     <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
      <section class="" style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;"> 
       <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
        <section class="" style="margin-top: 0.5em; margin-bottom: 0.5em; max-width: 100%; border-bottom: 2px solid rgb(105, 135, 166); clear: both; box-sizing: border-box !important; word-wrap: break-word !important;"> 
         <section class="" style="padding-top: 3px; padding-right: 10px; padding-left: 10px; max-width: 100%; display: inline-block; color: rgb(255, 255, 255); border-top-left-radius: 3px; border-top-right-radius: 3px; height: 28px; background-color: rgb(105, 135, 166); box-sizing: border-box !important; word-wrap: break-word !important;"> 
          <span style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">开发</span> 
         </section> 
         <section style="max-width: 100%; border-top: 28px solid transparent; border-right-color: rgb(206, 206, 206); border-bottom: 0px solid transparent; border-left: 15px solid rgb(206, 206, 206); display: inline-block; vertical-align: top; box-sizing: border-box !important; word-wrap: break-word !important;"></section> 
        </section> 
       </section> 
      </section> 
     </section> 
    </section> 
   </section> 
  </section> 
 </section> 
</section> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="color: rgb(255, 76, 0);"><strong>了解API</strong></span></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">至于 AccessService 如何配置，构造配置这个就不多说了，不是本文重点。如果不会，可以参考这个：</span></p> 
<blockquote> 
 <p style="margin-top: 10px;"><strong><span style="font-size: 14px;">微信抢红包插件</span></strong></p> 
 <p style="margin-bottom: 10px;"><span style="font-size: 14px; color: rgb(0, 82, 255);">http://blog.csdn.net/dd864140130/article/details/51794318</span></p> 
</blockquote> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">继承了 AccessService 后，我们需要实现 onAccessibilityEvent 方法，这个方法的意思就是在触发了事件进行回调，至于你想捕捉何种事件，详情参考API，这里只列举在本例使用到的事件：</span></p> 
<p style="line-height:13px"><span style="  z-index: -1;left: 0px;margin-top: 10.1333px;width: 359px;height: 41px "></span></p> 
<ul class=" list-paddingleft-2" style="list-style-type: disc;"><li><p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><strong><span style="font-size: 14px;">AccessibilityEvent.TYPE_NOTIFICATION_STATE_CHANGED:</span></strong><span style="font-size: 14px;">当通知栏发生变化时，也就是当有新通知显示在通知栏时触发；</span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><strong><span style="font-size: 14px;">AccessibilityEvent.TYPE_WINDOW_STATE_CHANGED:</span></strong><span style="font-size: 14px;">当窗体发生改变时触发，Activity，Fragment 的切换都会触发；</span></p></li></ul> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">除此之外我们还需要关注 AccessibilityNodeInfo 实例的重要方法：</span></p> 
<ul class=" list-paddingleft-2" style="list-style-type: disc;"><li><p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><strong><span style="font-size: 14px;">findAccessibilityNodeInfosByText：</span></strong><span style="font-size: 14px;">根据文本查找控件，可能会得到一个集合；</span></p></li><li><p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><strong><span style="font-size: 14px;">findAccessibilityNodeInfosByViewId：</span></strong><span style="font-size: 14px;">根据ID查找控件，会比较精准；</span></p></li></ul> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="color: rgb(255, 76, 0);"><strong>了解WXUI的构造</strong></span><br></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">首先自己去搞一个企业WX的测试账号，成功登录后会进入如下界面：</span></p> 
<p style="text-align: center;"><img class="" src="https://images2.imgbox.com/43/21/ZKscDgFm_o.png"></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="color: rgb(255, 76, 0);"><strong>了解代码</strong></span><br></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">打卡功能是在工作台下的，所以需要先进入打卡模块，但这一系列操作都手动点击就失去了自动化的意义了，因此 AccessService 第一次介入，代码如下：</span></p> 
<p style="text-align: center;"><img class="" src="https://images2.imgbox.com/5b/01/NDu96lzv_o.png"></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">上述代码就能自动点击工作台按钮，这个代码是我们的核心部分。关于 findTagToClick() 是什么？等下介绍，先说几个需要注意的地方：</span></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><strong><span style="font-size: 14px;">这是最重要的，如果想要一个控件响应单击事件，有几种办法?</span></strong></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><strong><span style="font-size: 14px;">1. </span></strong><span style="font-size: 14px;">OnClickListener</span></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><strong><span style="font-size: 14px;">2. </span></strong><span style="font-size: 14px;">OnTouch() 处理 ActionDown 和 ActionUp 事件。</span></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">但重中之重就是该控件的属是 </span><strong><span style="font-size: 14px;">onClickable=<span style="font-size: 14px; color: rgb(171, 25, 66);">true</span></span></strong><span style="font-size: 14px;"> 的也就是可以被点击的，如果该属性为 <span style="font-size: 14px; color: rgb(171, 25, 66);"><strong>false</strong></span>，那么辅助服务不能执行单击事件，至少我遇到的是这样。我在开发自动点击工作台这个步骤时，心想只要通过文本内容，拿到指定控件，然后执行单击就可以了。但结果怎样？没有任何反应，原因肯定就是控件没有接收事件，这是我遇到的第一个问题。</span></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">多说一句，为何 setOnClickListener 后就看见单击了？</span></p> 
<p style="text-align: center;"><img class="" src="https://images2.imgbox.com/79/1e/aef4ePSJ_o.png"></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><strong><span style="font-size: 14px;">setClickable(true)</span></strong><span style="font-size: 14px;"> 原因就在这里。</span></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><strong><span style="font-size: 14px;">怎么知道控件是否能响应点击呢？有两个方案：</span></strong></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><strong><span style="font-size: 14px;">1. </span></strong><span style="font-size: 14px;">写递归，判断 node 是否能被点击，如果可以则执行，否则则向上传递，听起来有点像 touch 事件分发的流程；</span></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><strong><span style="font-size: 14px;">2.</span></strong><span style="font-size: 14px;"> 使用IDE自带工具， Android devic monitor 来看当前 Activity 的UI层级，进入的步骤，以 A.S 为例：Tools-&gt;Android-&gt;Android Device Monitor。</span></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">简单介绍一下 使用 Android Device Monitor 分析UI结构：</span></p> 
<p style="text-align: center;"><img class="" src="https://images2.imgbox.com/89/e5/JZ6cDUCm_o.png"></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">我们可以知道"工作台"控件是一个Textview，坐标和 clickable 属性，因为是 false，所以不能执行单击，再找！</span></p> 
<p style="text-align: center;"><img class="" src="https://images2.imgbox.com/9f/35/vdv7CqrD_o.png"></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">查看其父容器，RelativeLayout， clickable=<span style="font-size: 14px; color: rgb(171, 25, 66);"><strong>true </strong></span>，难道是统一给父容器设置的单击事件？再找！</span></p> 
<p style="text-align: center;"><img class="" src="https://images2.imgbox.com/39/dd/VvxLcYTp_o.png"></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">同种方式在查一下 其他tag按钮 的结构，如出一辙，那么很有可能就是将事件统一由其父容器处理。继续我们的开发工作，介绍一下最为关心的方法：</span></p> 
<p style="text-align: center;"><img class="" src="https://images2.imgbox.com/36/bc/f8ckFyPi_o.png"></p> 
<p style="text-align: center;"><img class="" src="https://images2.imgbox.com/87/30/ia2LI4ah_o.png"></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">上面的方法都是用来找控件的，基本的循环和判断。</span></p> 
<p style="text-align: center;"><img class="" src="https://images2.imgbox.com/5f/39/SzIWQPWO_o.png"></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">logAllNodeInfo 这个方法，主要是为了遍历某个节点下的控件，便于参考，其实与业务关系不大，但有人会问为啥要加？想要找控件看UI结构，不是可以通过过 Android device monitor 那个工具看嘛。对，的确，但我用这个是为了排查问题，至于何种问题，后面会有介绍。经过上面的代码洗礼，来到下面这个界面：</span></p> 
<p style="text-align: center;"><img class="" src="https://images2.imgbox.com/aa/93/AwNSmxuJ_o.png"></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">故技重施，发现"打卡"这个控件，又把事件设置到了父容器上。那么好了，继续完善我们的代码，如下：</span></p> 
<p style="text-align: center;"><img class="" src="https://images2.imgbox.com/5a/e3/ufqW3Bd8_o.png"></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">截止到这步，当我们启动服务时，如果顺利，就会看到界面在自动执行，直到跳转到下面这个界面：</span></p> 
<p style="text-align: center;"><img class="" src="https://images2.imgbox.com/84/82/B4DBSzNt_o.png"></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">来到这里，如果想自动打卡，需要怎么做？对，就是获取到打卡的那个控件，然后模拟器操作，是不是再调用一次 findTagToClick("工作台") 就可以了？理论上的确是，但此时这个界面里面有两个“打卡”字样，会查到多个控件，虽然我上面的代码是从查询到的结果集中取第一个 node 元素，但为了避免不必要的麻烦，还是尽量找具备唯一性的文字，那查找包含“次”字样的控件如何？当然可以，至少这个字在当前界面是唯一的，既然考虑到唯一，那为何不用ID，所以</span></p> 
<p style="text-align: center;"><img class="" src="https://images2.imgbox.com/10/6e/A83SXH0M_o.png"></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">直接传入这个id，但是要注意，不同机器手机这个id可能不一样，所以以最终显示的为准，一定要自己去查，代码如下：</span></p> 
<p style="text-align: center;"><img class="" src="https://images2.imgbox.com/7f/66/9d0i6dfC_o.png"></p> 
<p style="text-align: left; margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">此时运行项目，运行微信，发现界面正常跳转，并成功打卡，非常好！再多试几次，也许会发现问题，就是在打卡界面也就是上图，会出现打卡无效的问题，具体效果就是：从工作台到打卡模块都可以自动完成，十分飘逸，但到了需要单击打卡按钮时，按钮外围的黄色圆圈有时只会转动一次，但不执行打卡业务，再简单点说就是：没打上卡。这究竟是什么问题？当时猜测三个原因：</span></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><strong><span style="font-size: 14px;">1. </span></strong><span style="font-size: 14px;">腾讯做了打卡限制，指定周期内不能连续打卡；</span></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><strong><span style="font-size: 14px;">2. </span></strong><span style="font-size: 14px;">单击动作短促，以至于打卡控件不认为这是一个有效的单击；</span></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><strong><span style="font-size: 14px;">3. </span></strong><span style="font-size: 14px;">代码执行过快，还没有来得及找到对应控件；</span></p> 
<blockquote> 
 <p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">在开发中，我们会遇到各式各样，匪夷所思的问题，鉴于这种情况，我个人的方法是将整个流程或者业务的执行过程在脑中过一遍，然后枚举出所以可能出现问题的环节，在依次排除。</span></p> 
</blockquote> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><strong><span style="font-size: 14px;">#1 </span></strong><span style="font-size: 14px;">尝试几次手动人工连续频度较高的打卡行为，没有发现限制的情况，所以初步排除这个情况；</span></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><strong><span style="font-size: 14px;">#2</span></strong><span style="font-size: 14px;"> 使用了长按事件，情况依旧；</span></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><strong><span style="font-size: 14px;">#3</span></strong><span style="font-size: 14px;"> 还记得之前提到过的 logAllNode() 方法吗，这个方法就是在这个阶段加入的，主要是对某节点的控件信息进行输出，对业务没有太多意义，通过对打印日志的分析，发现在渲染打卡界面的时候，会先输出“正在获取管理信息”的 Textview A（速率很快，一闪而过，很容易忽略），然后才会显示打卡控件和其他信息控件，那么可能是在执行 findTagToClick 这个方法时，界面显示的还是 Textview A 控件，所以才没有获取到。那么只要延迟执行即可，我用的是 postDelay，当然这种方式可能还是不够严谨，但排除问题是够用了。代码如下：</span></p> 
<p style="text-align: center;"><img class="" src="https://images2.imgbox.com/0a/d2/iOrKDFYg_o.png"></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">再次运行，试了几次正常了，也没有出现异常问题。关于 postDelay 把时间写死这种做法，不够严谨，应该写入一个回调函数，当获取管理信息结束后，执行回调，这时才会精准，当然后续完善。</span></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">截止到现在，自动打卡插件的制作，我们已经完成了一多半，现在需要做的就是智能。</span></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><strong><span style="font-size: 14px;">1. 定时任务，比如设置早上8点，自动启动应用，并进行打卡。使用的技术肯定是 Alarmmanger，但也有个问题，辅助服务是一个进程，定时任务服务又是另外一个进程，两者如何建立关系？</span></strong></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">我没有用IPC，而是用了一个取巧的办法，就是 Notiﬁcation，用它的理由就是辅助服务有一个监测通知栏变化的方法，前文提到过，那也就是说，只需要任务到期后，创建一个通知，然后辅助服务去监听，捕捉到目标通知做处理就行了呢？</span></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><strong><span style="font-size: 14px;">2. 打卡成功后自动退出程序，一个进程，关闭另外一个进程；</span></strong></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">想到了一大堆了方法什么ﬁnish，kill，exit，但一一试过都不行，那怎么办？只要动用linux命令了，前提是要 su权限，需要 root，也是没有办法的办法。</span></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">完善的代码如下：</span></p> 
<p style="text-align: center;"><img class="" src="https://images2.imgbox.com/f0/59/bel9WLwn_o.png"></p> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">截止到目前，我们实现的效果就是，设置打卡日期，比如早上8点半，到时后自动启动企业WX，自动执行打卡，完成后退出应用，等待下一次任务执行。很喜庆，再也不用担心早上迟到了罚钱了，因为你总会在那个时间打卡。</span></p> 
<p><span style="color: rgb(255, 172, 170);"></span></p> 
<section class="" style="white-space: normal; max-width: 100%; color: rgb(62, 62, 62); font-size: 18px; line-height: 25.6px;  box-sizing: border-box !important; word-wrap: break-word !important;"> 
 <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
  <section class="" style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;"> 
   <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
    <section class="" style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;"> 
     <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
      <section class="" style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;"> 
       <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
        <section class="" style="margin-top: 0.5em; margin-bottom: 0.5em; max-width: 100%; border-bottom: 2px solid rgb(105, 135, 166); clear: both; box-sizing: border-box !important; word-wrap: break-word !important;"> 
         <section class="" style="padding-top: 3px; padding-right: 10px; padding-left: 10px; max-width: 100%; display: inline-block; color: rgb(255, 255, 255); border-top-left-radius: 3px; border-top-right-radius: 3px; height: 28px; background-color: rgb(105, 135, 166); box-sizing: border-box !important; word-wrap: break-word !important;"> 
          <span style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">总结</span> 
         </section> 
         <section style="max-width: 100%; border-top: 28px solid transparent; border-right-color: rgb(206, 206, 206); border-bottom: 0px solid transparent; border-left: 15px solid rgb(206, 206, 206); display: inline-block; vertical-align: top; box-sizing: border-box !important; word-wrap: break-word !important;"></section> 
        </section> 
       </section> 
      </section> 
     </section> 
    </section> 
   </section> 
  </section> 
 </section> 
</section> 
<p style="margin-top: 10px; margin-bottom: 10px; line-height: 1.75em;"><span style="font-size: 14px;">整个插件的开发思路很简单，代码也很简单，基础需求已经满足，但如何想要更加智能，就需要花费点精力了。比</span><span style="font-size: 14px;">如，</span><span style="font-size: 14px;">service</span><span style="font-size: 14px;">进程守护，</span><span style="font-size: 14px;">alarm</span><span style="font-size: 14px;">的如何准时执行，更聪明的</span><span style="font-size: 14px;">IPC</span><span style="font-size: 14px;">通信等。虽说都是老生常谈，但还是值得玩玩的，所以</span><span style="font-size: 14px;">给大家留个</span><span style="font-size: 14px;">“</span><span style="font-size: 14px;">瞎想</span><span style="font-size: 14px;">”</span><span style="font-size: 14px;">的空间。</span></p> 
<section class="" style="max-width: 100%; color: rgb(62, 62, 62); white-space: normal; font-size: 18px; line-height: 25.6px;  box-sizing: border-box !important; word-wrap: break-word !important;"> 
 <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
  <section class="" style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;"> 
   <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
    <section class="" style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;"> 
     <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
      <section class="" style="max-width: 100%; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;"> 
       <section class="" style="margin-right: auto; margin-left: auto; max-width: 100%; clear: both; width: 556px; overflow: hidden; box-sizing: border-box !important; word-wrap: break-word !important;"> 
        <section class="" style="margin-top: 0.5em; margin-bottom: 0.5em; max-width: 100%; border-bottom: 2px solid rgb(105, 135, 166); clear: both; box-sizing: border-box !important; word-wrap: break-word !important;"> 
         <section class="" style="padding-top: 3px; padding-right: 10px; padding-left: 10px; max-width: 100%; display: inline-block; color: rgb(255, 255, 255); border-top-left-radius: 3px; border-top-right-radius: 3px; height: 28px; background-color: rgb(105, 135, 166); box-sizing: border-box !important; word-wrap: break-word !important;"> 
          <span style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">更多</span> 
         </section> 
         <section style="max-width: 100%; border-top: 28px solid transparent; border-right-color: rgb(206, 206, 206); border-bottom: 0px solid transparent; border-left: 15px solid rgb(206, 206, 206); display: inline-block; vertical-align: top; box-sizing: border-box !important; word-wrap: break-word !important;"></section> 
        </section> 
       </section> 
      </section> 
     </section> 
    </section> 
   </section> 
  </section> 
 </section> 
</section> 
<p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal;  box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;">每天学习累了，看些搞笑的段子放松一下吧。</span><span style="max-width: 100%; font-size: 14px; line-height: 31.5px; box-sizing: border-box !important; word-wrap: break-word !important;">关注最具娱乐精神的公众号，每天都有好心情。</span><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"></p> 
<p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); font-size: 16px; white-space: normal; line-height: 25.6px;  text-align: center; box-sizing: border-box !important; word-wrap: break-word !important;"><img class="" style="line-height: 1.6; box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 556px !important;" width="auto" src="https://images2.imgbox.com/fd/51/bxoG3APZ_o.gif"></p> 
<p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); white-space: normal; font-size: 18px; line-height: 1.75em;  box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 14px; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;">如果你有好的技术文章想和大家分享，欢迎向我的公众号投稿，投稿具体细节请在公众号主页点击</span><strong style="max-width: 100%; font-size: 14px; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;">“投稿”</strong><span style="max-width: 100%; font-size: 14px; line-height: 25.6px; box-sizing: border-box !important; word-wrap: break-word !important;">菜单查看。</span><br style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;"></span></p> 
<p style="margin-top: 10px; margin-bottom: 10px; max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); white-space: normal; font-size: 18px; line-height: 1.75em;  box-sizing: border-box !important; word-wrap: break-word !important;"><span style="max-width: 100%; font-size: 14px; box-sizing: border-box !important; word-wrap: break-word !important;">欢迎<strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">长按下图 -&gt; 识别图中二维码</strong>或者<strong style="max-width: 100%; box-sizing: border-box !important; word-wrap: break-word !important;">扫一扫</strong>关注我的公众号：</span></p> 
<p style="max-width: 100%; min-height: 1em; color: rgb(62, 62, 62); white-space: normal; font-size: 18px; line-height: 25.6px; text-align: center;  box-sizing: border-box !important; word-wrap: break-word !important;"><img class="" style="box-sizing: border-box !important; word-wrap: break-word !important; visibility: visible !important; width: 258px !important;" width="auto" src="https://images2.imgbox.com/ff/fc/3Y1Rcors_o.png"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0b2582e4f4c30fd3ff92f808ce4c537d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux中JAVA的安装配置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6dbf1c1e0f86d4169a7939f82f745cc5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">import org.apache.ibatis.io.Resources   找不到</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>