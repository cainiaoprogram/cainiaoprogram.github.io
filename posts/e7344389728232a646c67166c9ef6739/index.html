<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>shardingsphere5.0.0æ•´åˆåˆ†å¸ƒå¼æŸ”æ€§äº‹åŠ¡seata1.4.2ç¤ºä¾‹æ­¥éª¤ - èœé¸Ÿç¨‹åºå‘˜åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="shardingsphere5.0.0æ•´åˆåˆ†å¸ƒå¼æŸ”æ€§äº‹åŠ¡seata1.4.2ç¤ºä¾‹æ­¥éª¤" />
<meta property="og:description" content="å›æ¥5å¤©å‘ç°æ·±åœ³å®å®‰æ–°å† ç–«æƒ…æ„ŸæŸ“è€…ï¼Œæˆ‘è¿œåœ¨æ±Ÿè¥¿ï¼Œæ˜æ˜ç¦»æˆ‘å¾ˆè¿œï¼Œè¿˜æ˜¯è¦è‡ªè´¹éš”ç¦»ï¼Œæƒ¨å‘å¤©æ¶¯ä½•å¤„è¯‰ï¼ğŸ˜
ä¸€ã€ä¸‹è½½Seata1.4.2 è¿›å…¥å®˜ç½‘ï¼šSeata
äºŒã€å®‰è£…éƒ¨ç½²Seata å‚é˜…å®˜ç½‘ï¼šç›´æ¥éƒ¨ç½²
ä¸‰ã€æ·»åŠ jarä¾èµ– &lt;dependency&gt; &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt; &lt;artifactId&gt;shardingsphere-jdbc-core-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;5.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;!-- BASEäº‹åŠ¡ï¼ˆSeataï¼‰æ¨¡å— --&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt; &lt;artifactId&gt;shardingsphere-transaction-base-seata-at&lt;/artifactId&gt; &lt;version&gt;5.0.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;io.seata&lt;/groupId&gt; &lt;artifactId&gt;seata-all&lt;/artifactId&gt; &lt;version&gt;1.4.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt; &lt;artifactId&gt;nacos-api&lt;/artifactId&gt; &lt;version&gt;1.4.1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt; &lt;artifactId&gt;nacos-client&lt;/artifactId&gt; &lt;version&gt;1.4.1&lt;/version&gt; &lt;/dependency&gt; å››ã€éƒ¨ç½²å®‰è£…å¯åŠ¨Nacos å› ä¸ºéœ€è¦å°†Seataæ³¨å†Œåˆ°ä¸­å¿ƒï¼Œè¿™é‡Œé€‰æ‹©nacosä½œä¸ºæ³¨å†Œä¸­å¿ƒã€‚
å®‰è£…éƒ¨ç½²ç•¥
äº”ã€é…ç½®registry.conf æ–‡ä»¶å­˜æ”¾è·¯å¾„åœ¨classpathè·¯å¾„ä¸‹
ä½¿ç”¨nacosä½œä¸ºæ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ
registry { # file ã€nacos ã€eurekaã€redisã€zkã€consulã€etcd3ã€sofa # è¿™é‡Œç±»å‹ä½¿ç”¨nacosä½œä¸ºseataæ³¨å†Œä¸­å¿ƒ type = &#34;nacos&#34; nacos { application = &#34;seata-server&#34; serverAddr = &#34;127.0.0.1:8848&#34; group = &#34;SEATA_GROUP&#34; namespace = &#34;public&#34; cluster = &#34;default&#34; username = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/e7344389728232a646c67166c9ef6739/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-31T09:16:47+08:00" />
<meta property="article:modified_time" content="2022-03-31T09:16:47+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="èœé¸Ÿç¨‹åºå‘˜åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">èœé¸Ÿç¨‹åºå‘˜åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">shardingsphere5.0.0æ•´åˆåˆ†å¸ƒå¼æŸ”æ€§äº‹åŠ¡seata1.4.2ç¤ºä¾‹æ­¥éª¤</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>å›æ¥5å¤©å‘ç°æ·±åœ³å®å®‰æ–°å† ç–«æƒ…æ„ŸæŸ“è€…ï¼Œæˆ‘è¿œåœ¨æ±Ÿè¥¿ï¼Œæ˜æ˜ç¦»æˆ‘å¾ˆè¿œï¼Œè¿˜æ˜¯è¦è‡ªè´¹éš”ç¦»ï¼Œæƒ¨å‘å¤©æ¶¯ä½•å¤„è¯‰ï¼ğŸ˜</p> 
<h2>ä¸€ã€ä¸‹è½½Seata1.4.2</h2> 
<p>è¿›å…¥å®˜ç½‘ï¼š<a class="link-info" href="http://seata.io/zh-cn/" rel="nofollow" title="Seata">Seata</a></p> 
<h2>äºŒã€å®‰è£…éƒ¨ç½²Seata</h2> 
<p>å‚é˜…å®˜ç½‘ï¼š<a class="link-info" href="http://seata.io/zh-cn/docs/ops/deploy-server.html" rel="nofollow" title="ç›´æ¥éƒ¨ç½²">ç›´æ¥éƒ¨ç½²</a></p> 
<h2>ä¸‰ã€æ·»åŠ jarä¾èµ–</h2> 
<pre><code class="language-XML">            &lt;dependency&gt;
                &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt;
                &lt;artifactId&gt;shardingsphere-jdbc-core-spring-boot-starter&lt;/artifactId&gt;
                &lt;version&gt;5.0.0&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;!-- BASEäº‹åŠ¡ï¼ˆSeataï¼‰æ¨¡å— --&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;org.apache.shardingsphere&lt;/groupId&gt;
                &lt;artifactId&gt;shardingsphere-transaction-base-seata-at&lt;/artifactId&gt;
                &lt;version&gt;5.0.0&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;io.seata&lt;/groupId&gt;
                &lt;artifactId&gt;seata-all&lt;/artifactId&gt;
                &lt;version&gt;1.4.2&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;
                &lt;artifactId&gt;nacos-api&lt;/artifactId&gt;
                &lt;version&gt;1.4.1&lt;/version&gt;
            &lt;/dependency&gt;
            &lt;dependency&gt;
                &lt;groupId&gt;com.alibaba.nacos&lt;/groupId&gt;
                &lt;artifactId&gt;nacos-client&lt;/artifactId&gt;
                &lt;version&gt;1.4.1&lt;/version&gt;
            &lt;/dependency&gt;</code></pre> 
<h2>å››ã€éƒ¨ç½²å®‰è£…å¯åŠ¨Nacos</h2> 
<p>å› ä¸ºéœ€è¦å°†Seataæ³¨å†Œåˆ°ä¸­å¿ƒï¼Œè¿™é‡Œé€‰æ‹©nacosä½œä¸ºæ³¨å†Œä¸­å¿ƒã€‚</p> 
<p>å®‰è£…éƒ¨ç½²ç•¥</p> 
<h2>äº”ã€é…ç½®registry.conf</h2> 
<p>æ–‡ä»¶å­˜æ”¾è·¯å¾„åœ¨classpathè·¯å¾„ä¸‹</p> 
<p>ä½¿ç”¨nacosä½œä¸ºæ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ</p> 
<pre><code>registry {
  # file ã€nacos ã€eurekaã€redisã€zkã€consulã€etcd3ã€sofa
  # è¿™é‡Œç±»å‹ä½¿ç”¨nacosä½œä¸ºseataæ³¨å†Œä¸­å¿ƒ
  type = "nacos"

  nacos {
    application = "seata-server"
    serverAddr = "127.0.0.1:8848"
    group = "SEATA_GROUP"
    namespace = "public"
    cluster = "default"
    username = "nacos"
    password = "nacos"
  }
  eureka {
    serviceUrl = "http://localhost:8761/eureka"
    application = "default"
    weight = "1"
  }
  redis {
    serverAddr = "localhost:6379"
    db = 0
    password = ""
    cluster = "default"
    timeout = 0
  }
  zk {
    cluster = "default"
    serverAddr = "127.0.0.1:2181"
    sessionTimeout = 6000
    connectTimeout = 2000
    username = ""
    password = ""
  }
  consul {
    cluster = "default"
    serverAddr = "127.0.0.1:8500"
    aclToken = ""
  }
  etcd3 {
    cluster = "default"
    serverAddr = "http://localhost:2379"
  }
  sofa {
    serverAddr = "127.0.0.1:9603"
    application = "default"
    region = "DEFAULT_ZONE"
    datacenter = "DefaultDataCenter"
    cluster = "default"
    group = "SEATA_GROUP"
    addressWaitTime = "3000"
  }
  file {
    name = "file.conf"
  }
}

config {
  # fileã€nacos ã€apolloã€zkã€consulã€etcd3
  # è¿™é‡Œç±»å‹ä½¿ç”¨nacosä½œä¸ºseataé…ç½®ä¸­å¿ƒ
  type = "nacos"

  nacos {
    serverAddr = "127.0.0.1:8848"
    namespace = "public"
    group = "SEATA_GROUP"
    username = "nacos"
    password = "nacos"
    dataId = "seataServer.properties"
  }
  consul {
    serverAddr = "127.0.0.1:8500"
    aclToken = ""
  }
  apollo {
    appId = "seata-server"
    ## apolloConfigService will cover apolloMeta
    apolloMeta = "http://192.168.1.204:8801"
    apolloConfigService = "http://192.168.1.204:8080"
    namespace = "application"
    apolloAccesskeySecret = ""
    cluster = "seata"
  }
  zk {
    serverAddr = "127.0.0.1:2181"
    sessionTimeout = 6000
    connectTimeout = 2000
    username = ""
    password = ""
    nodePath = "/seata/seata.properties"
  }
  etcd3 {
    serverAddr = "http://localhost:2379"
  }
  file {
    name = "file.conf"
  }
}
</code></pre> 
<h2>å…­ã€é…ç½®seata.conf</h2> 
<p>æ–‡ä»¶å­˜æ”¾è·¯å¾„åœ¨classpathè·¯å¾„ä¸‹</p> 
<pre><code>client {
  application.id = sharding-tx-demo
  transaction.service.group = demo_tx_group
}</code></pre> 
<h2>ä¸ƒã€Nacosä¸­æ·»åŠ é…ç½®</h2> 
<p>dataId=seataServer.properties ä¸” group=SEATA_GROUP</p> 
<p>å…¶ä¸­service.vgroupMapping.demo_tx_group=defaultä¸­çš„demo_tx_groupå¿…é¡»å’Œé…ç½®seata.confä¸­çš„transaction.service.groupä¿æŒä¸€è‡´</p> 
<pre><code>transport.type=TCP
transport.server=NIO
transport.heartbeat=true
transport.enableClientBatchSendRequest=false
transport.threadFactory.bossThreadPrefix=NettyBoss
transport.threadFactory.workerThreadPrefix=NettyServerNIOWorker
transport.threadFactory.serverExecutorThreadPrefix=NettyServerBizHandler
transport.threadFactory.shareBossWorker=false
transport.threadFactory.clientSelectorThreadPrefix=NettyClientSelector
transport.threadFactory.clientSelectorThreadSize=1
transport.threadFactory.clientWorkerThreadPrefix=NettyClientWorkerThread
transport.threadFactory.bossThreadSize=1
transport.threadFactory.workerThreadSize=default
transport.shutdown.wait=3
# æ­¤å¤„é…ç½®å¿…é¡»å’Œseata.confä¸­transaction.service.groupä¿æŒä¸€è‡´
service.vgroupMapping.demo_tx_group=default
service.default.grouplist=127.0.0.1:8091
service.enableDegrade=false
service.disableGlobalTransaction=false
client.rm.asyncCommitBufferLimit=10000
client.rm.lock.retryInterval=10
client.rm.lock.retryTimes=30
client.rm.lock.retryPolicyBranchRollbackOnConflict=true
client.rm.reportRetryCount=5
client.rm.tableMetaCheckEnable=false
client.rm.tableMetaCheckerInterval=60000
client.rm.sqlParserType=druid
client.rm.reportSuccessEnable=false
client.rm.sagaBranchRegisterEnable=false
client.tm.commitRetryCount=5
client.tm.rollbackRetryCount=5
client.tm.defaultGlobalTransactionTimeout=60000
client.tm.degradeCheck=false
client.tm.degradeCheckAllowTimes=10
client.tm.degradeCheckPeriod=2000
store.mode=file
store.publicKey=
store.file.dir=file_store/data
store.file.maxBranchSessionSize=16384
store.file.maxGlobalSessionSize=512
store.file.fileWriteBufferCacheSize=16384
store.file.flushDiskMode=async
store.file.sessionReloadReadSize=100
store.db.datasource=druid
store.db.dbType=mysql
store.db.driverClassName=com.mysql.jdbc.Driver
store.db.url=jdbc:mysql://127.0.0.1:3306/seata?useUnicode=true&amp;rewriteBatchedStatements=true
store.db.user=root
store.db.password=123456
store.db.minConn=5
store.db.maxConn=30
store.db.globalTable=global_table
store.db.branchTable=branch_table
store.db.queryLimit=100
store.db.lockTable=lock_table
store.db.maxWait=5000
store.redis.mode=single
store.redis.single.host=127.0.0.1
store.redis.single.port=6379
store.redis.sentinel.masterName=
store.redis.sentinel.sentinelHosts=
store.redis.maxConn=10
store.redis.minConn=1
store.redis.maxTotal=100
store.redis.database=0
store.redis.password=
store.redis.queryLimit=100
server.recovery.committingRetryPeriod=1000
server.recovery.asynCommittingRetryPeriod=1000
server.recovery.rollbackingRetryPeriod=1000
server.recovery.timeoutRetryPeriod=1000
server.maxCommitRetryTimeout=-1
server.maxRollbackRetryTimeout=-1
server.rollbackRetryTimeoutUnlockEnable=false
client.undo.dataValidation=true
client.undo.logSerialization=jackson
client.undo.onlyCareUpdateColumns=true
server.undo.logSaveDays=7
server.undo.logDeletePeriod=86400000
client.undo.logTable=undo_log
client.undo.compress.enable=true
client.undo.compress.type=zip
client.undo.compress.threshold=64k
log.exceptionRate=100
transport.serialization=seata
transport.compressor=none
metrics.enabled=false
metrics.registryType=compact
metrics.exporterList=prometheus
metrics.exporterPrometheusPort=9898</code></pre> 
<p>æ¨¡æ¿æ¥è‡ªseataæºç ç›®å½•ï¼šseata\script\config-center\config.txtÂ </p> 
<h2>å…«ã€å¼€å¯äº‹åŠ¡é…ç½®</h2> 
<pre><code class="language-java">package com.china.song.shardingsphere.standard.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.jdbc.datasource.DataSourceTransactionManager;
import org.springframework.transaction.PlatformTransactionManager;
import org.springframework.transaction.annotation.EnableTransactionManagement;

import javax.sql.DataSource;

/**
 * äº‹åŠ¡é…ç½®
 *
 * @author songjianyong
 * @date 2022/02/04 9:38
 */
@Configuration
@EnableTransactionManagement
public class TransactionalConfiguration {

    @Bean
    public PlatformTransactionManager transactionManager(DataSource dataSource) {
        return new DataSourceTransactionManager(dataSource);
    }
}
</code></pre> 
<h2>ä¹ã€ä½¿ç”¨äº‹åŠ¡</h2> 
<pre><code class="language-java">package com.china.song.shardingsphere.standard.service;

import com.china.song.shardingsphere.standard.dao.intf.OrderDao;
import com.china.song.shardingsphere.standard.dao.intf.UserDao;
import com.china.song.shardingsphere.standard.entity.OrderEntity;
import com.china.song.shardingsphere.standard.entity.UserEntity;
import lombok.extern.slf4j.Slf4j;
import org.apache.shardingsphere.transaction.annotation.ShardingSphereTransactionType;
import org.apache.shardingsphere.transaction.core.TransactionType;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Propagation;
import org.springframework.transaction.annotation.Transactional;

import java.io.Serializable;

/**
 * è®¢å•æœåŠ¡å®ç°ç±»
 *
 * @author songjianyong
 * @date 2022/02/04 9:30
 */
@Service
@Slf4j
public class OrderServiceImpl implements IOrderService {
    private OrderDao orderDao;
    private UserDao userDao;

    @Autowired
    public void setOrderDao(OrderDao orderDao) {
        this.orderDao = orderDao;
    }

    @Autowired
    public void setUserDao(UserDao userDao) {
        this.userDao = userDao;
    }

    @Override
    @Transactional(propagation = Propagation.REQUIRED, rollbackFor = Exception.class)
    @ShardingSphereTransactionType(TransactionType.BASE)
    public void saveOrder() {
        OrderEntity order = new OrderEntity();
        order.setOrderId(6L);
        order.setUserId(1L);
        Serializable r = orderDao.save(order);
        log.info("è®¢å•è¿”å›ç»“æœï¼š{}", r);
        UserEntity user = new UserEntity();
        user.setUserName("å¼ ä¸‰");
        user.setId(1L);
        Serializable userId = userDao.save(user);
        log.info("ç”¨æˆ·è¿”å›ç»“æœï¼š{}", userId);
    }
}</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3062a8077287d50a3758b36a8be13653/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">C&#43;&#43; ofstreamå’Œifstreamè¯¦ç»†ç”¨æ³•</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/011a3676ad4c1ccf47130a713cc362b9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">STM32CubeMXå­¦ä¹ ç¬”è®°ï¼ˆ28ï¼‰â€”â€”FreeRTOSå®æ—¶æ“ä½œç³»ç»Ÿä½¿ç”¨ï¼ˆä»»åŠ¡ç®¡ç†ï¼‰</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 èœé¸Ÿç¨‹åºå‘˜åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>