<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Wonderware-InTouch历史报警、操作记录导出为Excel - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Wonderware-InTouch历史报警、操作记录导出为Excel" />
<meta property="og:description" content="Intouch自身的历史记录控件为AlmDbViewCtrl,可以查询历史报警和操作记录。我们需要在控件向导中拉出时间控件DTPicker，选择时间，关键字等，即可查询想要的结果，这些需要编写程序去实现。
显示时： #DTPicker9.value = $DateString; #DTPicker10.value = &#34;00:00:00&#34;; #DTPicker11.value = $DateString; #DTPicker12.value = &#34;23:59:59&#34;; #AlmDbViewCtrl2.SpecificTime = 1; #AlmDbViewCtrl2.StartTime = StringMid(#DTPicker9.value,6,2) &#43; &#34;/&#34; &#43; StringMid(#DTPicker9.value,9,2) &#43; &#34;/&#34; &#43; StringMid(#DTPicker9.value,1,4) &#43; &#34; &#34; &#43; #DTPicker10.value; #AlmDbViewCtrl2.EndTime = StringMid(#DTPicker11.value,6,2) &#43; &#34;/&#34; &#43; StringMid(#DTPicker11.value,9,2) &#43; &#34;/&#34; &#43; StringMid(#DTPicker11.value,1,4) &#43; &#34; &#34; &#43; #DTPicker12.value; #AlmDbViewCtrl2.Refresh(); 查询： #AlmDbViewCtrl2.SpecificTime = 1; #AlmDbViewCtrl2.StartTime = StringMid(#DTPicker9.value,6,2) &#43; &#34;/&#34; &#43; StringMid(#DTPicker9.value,9,2) &#43; &#34;/&#34; &#43; StringMid(#DTPicker9.value,1,4) &#43; &#34; &#34; &#43; #DTPicker10." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/cc7a3b213a85c1d8531963c78f851991/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-12-10T19:18:44+08:00" />
<meta property="article:modified_time" content="2019-12-10T19:18:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Wonderware-InTouch历史报警、操作记录导出为Excel</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>Intouch自身的历史记录控件为AlmDbViewCtrl,可以查询历史报警和操作记录。我们需要在控件向导中拉出时间控件DTPicker，选择时间，关键字等，即可查询想要的结果，这些需要编写程序去实现。</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/0d/4c/3MKIX9jB_o.jpg"></p> 
<pre class="has"><code>显示时：
#DTPicker9.value = $DateString;
#DTPicker10.value = "00:00:00";
#DTPicker11.value = $DateString;
#DTPicker12.value = "23:59:59";
#AlmDbViewCtrl2.SpecificTime = 1;
#AlmDbViewCtrl2.StartTime = StringMid(#DTPicker9.value,6,2) + "/" + StringMid(#DTPicker9.value,9,2) + "/" + StringMid(#DTPicker9.value,1,4) + " " + #DTPicker10.value;
#AlmDbViewCtrl2.EndTime = StringMid(#DTPicker11.value,6,2) + "/" + StringMid(#DTPicker11.value,9,2) + "/" + StringMid(#DTPicker11.value,1,4) + " " + #DTPicker12.value;
#AlmDbViewCtrl2.Refresh();</code></pre> 
<pre class="has"><code>查询：
#AlmDbViewCtrl2.SpecificTime = 1;
#AlmDbViewCtrl2.StartTime = StringMid(#DTPicker9.value,6,2) + "/" + StringMid(#DTPicker9.value,9,2) + "/" + StringMid(#DTPicker9.value,1,4) + " " + #DTPicker10.value;
#AlmDbViewCtrl2.EndTime = StringMid(#DTPicker11.value,6,2) + "/" + StringMid(#DTPicker11.value,9,2) + "/" + StringMid(#DTPicker11.value,1,4) + " " + #DTPicker12.value;
#AlmDbViewCtrl2.GroupName = "$SYSTEM";
IF CONDITION &lt;&gt; "" THEN
CALL ALMFILTERSEARCH(CONDITION);
#AlmDbViewCtrl2.ShowFilter();
ELSE
#AlmDbViewCtrl2.Refresh();
ENDIF;</code></pre> 
<pre class="has"><code>QuickFunction:ALMFILTERSEARCH
FileDelete("D:\Intouch Files\FlexUI_LX2\ALARM.xml");
FileWriteMessage( "D:\Intouch Files\FlexUI_LX2\ALARM.xml",0,HIST_XMLCODE + "&lt;FILTER_FAVORITES&gt;&lt;RECORD&gt;&lt;FILTERNAME&gt;MYFILTER&lt;/FILTERNAME&gt;&lt;ELEMENT&gt;", 0 );
IF HIST_SEARCHINDEX == 1 THEN
    FileWriteMessage( "D:\Intouch Files\FlexUI_LX2\ALARM.xml",-1, "&lt;NAME&gt;名称&lt;/NAME&gt;&lt;ORIGNAME&gt;Name&lt;/ORIGNAME&gt;&lt;OPERATOR&gt;LIKE&lt;/OPERATOR&gt;&lt;VALUE&gt;%"+STR+"%&lt;/VALUE&gt;&lt;PARENT&gt;0&lt;/PARENT&gt;", 0);
ELSE 
    FileWriteMessage( "D:\Intouch Files\FlexUI_LX2\ALARM.xml",-1, "&lt;NAME&gt;报警注释&lt;/NAME&gt;&lt;ORIGNAME&gt;Alarm Comment&lt;/ORIGNAME&gt;&lt;OPERATOR&gt;LIKE&lt;/OPERATOR&gt;&lt;VALUE&gt;%"+STR+"%&lt;/VALUE&gt;&lt;PARENT&gt;0&lt;/PARENT&gt;", 0);  
ENDIF;
FileWriteMessage( "D:\Intouch Files\FlexUI_LX2\ALARM.xml", -1, "&lt;/ELEMENT&gt;&lt;/RECORD&gt;&lt;/FILTER_FAVORITES&gt;", 0 );
#AlmDbViewCtrl2.FilterFavoritesFile = "D:\Intouch Files\FlexUI_LX2\ALARM.xml";
</code></pre> 
<p>以上就是实现查询历史记录的代码，实现时间筛选、关键字查询，如下图操作所示：需要过滤器选择过滤内容。</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/13/35/CbLFYPUT_o.jpg"></p> 
<p><strong>若是想导出历史记录为EXCEL，导成自己想要的格式则非常麻烦，首先需要把历史记录读出，写脚本通过这个报警控件去读取会很慢，使用也较麻烦。</strong></p> 
<p><strong>为了这个导出EXCEL的功能可以按照如下方法实施，实现了历史报警和操作记录的查询、筛选、排序，删除、导出。</strong></p> 
<p> </p> 
<p><strong><img alt="" class="has" height="1080" src="https://images2.imgbox.com/e8/73/yVJDx8R0_o.gif" width="1200"></strong></p> 
<p><img alt="" class="has" height="1080" src="https://images2.imgbox.com/1b/c7/mCOhPoKW_o.gif" width="1200"></p> 
<p> </p> 
<p>通过控件嵌入INtouch画面的形式，与工程文件融为一体，只需要注册一下控件即可使用。</p> 
<p><strong>数据库配置如下：</strong></p> 
<p>服务器名：.</p> 
<p>数据库名为：WWALMDB</p> 
<p>登陆用户：sa</p> 
<p>密码：123456</p> 
<p>以下为历史报警/操作记录界面：可根据TgaName、报警组、值、HH/HI/LO/LL、类型、报警等级、操作员、节点名、报警注释等进行筛选查询，可查范围与AlmDbViewCtrl一样。</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/e3/99/GpuE0YzU_o.jpg"></p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/86/4e/JJwDFVPW_o.jpg"></p> 
<p>导出EXCEL，命名；可点击按钮实现每日定时导出历史报表。</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/1a/69/ZyI7mvHk_o.jpg"></p> 
<p>根据自己喜好的格式版面保存为EXCEL：AlarmReport\EventReport，导出结果即为查询的结果。</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/42/7c/O84QBDCP_o.jpg"></p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/c7/15/7dPMO4CN_o.jpg"></p> 
<p>与AlmDbViewCtrl比较起来操作更简单，不需要各种设置，任何项目实施只需要几分钟的时间，省去了编写简本程序的麻烦和困难。控件移植性强，极大提高调试进度。</p> 
<p>若需要此控件可进入下面链接学习掌握。</p> 
<p><a href="https://blog.csdn.net/weixin_39450462/article/details/100411908">Wonderware-InTouch历史报警、操作记录导出为Excel</a></p> 
<p><a href="https://m.qlchat.com/topic/details?topicId=2000005921818308" rel="nofollow">Intouch-历史报警/操作记录导出为EXCEL</a></p> 
<p><a href="https://m.qlchat.com/topic/details?topicId=2000005932214552" rel="nofollow">Intouch-报表的实际应用案例</a></p> 
<p> </p> 
<p> </p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9bf4489783ef1b9df4caddb13927dd30/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Wonderware-InTouch用脚本实现*邮件*发送功能</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fba730257fc2a9c9d973b5fa10715b4d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Wonderware-InTouch 弹窗输入密码二次确认执行动作</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>