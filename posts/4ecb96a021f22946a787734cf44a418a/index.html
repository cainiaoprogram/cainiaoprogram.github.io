<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>单片机毕设 基于STM32的智能药箱系统设计与实现 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="单片机毕设 基于STM32的智能药箱系统设计与实现" />
<meta property="og:description" content="文章目录 1 简介2 绪论2.1 课题背景2.2 实现功能 3 系统设计3.1 系统架构3.2 硬件设计3.2.1 wifi电路设计3.2.2 其他电路设计 3.3 软件设计3.3.1 软件工作流程3.3.2 闹铃提醒程序设计3.3.3 液晶显示程序设计3.3.4 信息存储程序设计3.3.5 报警电路程序设计 3.4 部分实现代码 4 最后 1 简介 Hi，大家好，今天向大家介绍一个学长做的单片机项目
基于STM32的智能药箱系统设计与实现
大家可用于 课程设计 或 毕业设计
2 绪论 2.1 课题背景 照顾老人， 特别是提醒老人准时吃药已经成为了一个社会关心的问题。长期记录吃药种类、 吃药时间能为分析老人的病理提供有力的依据。
基于目 前市场需求， 学长设计了一款基于 STM32F103 并结合网络来提醒老人按时吃药的系统。
整个智能药箱系统分为智能药箱端与远程服务器端两个部分， 智能药箱端用于提醒， 服务器端用于记录监督
2.2 实现功能 整个系统经过多次测试和应用， 各功能模块都可以正常运行， 符合设计要求。 具有的功
能包括： 从服务器端的数据库中实时获取药物信息， 闹钟信息等并存储。 播放音频文件提醒老人用药， 在液晶屏上提示吃药信息， 老人可以根据显示信息正确用药。 智能药箱端能记录药箱中每种药的数目， 并进行药量检测， 在药量不足时发出提醒， 提示用户配药。 另外还可以对老人取药动作进行记录， 将取药状态通过互联网传输给服务器监控端， 为以后看病做依据。 另外， 智能药箱端通过程序界面方便的配置智能药箱内部的网络信息，包括服务器地址、端口、 网关等。
它的主要功能分为下面几个部分：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/4ecb96a021f22946a787734cf44a418a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-13T10:03:39+08:00" />
<meta property="article:modified_time" content="2023-07-13T10:03:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">单片机毕设 基于STM32的智能药箱系统设计与实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1__5" rel="nofollow">1 简介</a></li><li><a href="#2__15" rel="nofollow">2 绪论</a></li><li><ul><li><a href="#21__17" rel="nofollow">2.1 课题背景</a></li><li><a href="#22__26" rel="nofollow">2.2 实现功能</a></li></ul> 
  </li><li><a href="#3__47" rel="nofollow">3 系统设计</a></li><li><ul><li><a href="#31__48" rel="nofollow">3.1 系统架构</a></li><li><a href="#32__64" rel="nofollow">3.2 硬件设计</a></li><li><ul><li><a href="#321_wifi_66" rel="nofollow">3.2.1 wifi电路设计</a></li><li><a href="#322__70" rel="nofollow">3.2.2 其他电路设计</a></li></ul> 
   </li><li><a href="#33__74" rel="nofollow">3.3 软件设计</a></li><li><ul><li><a href="#331__75" rel="nofollow">3.3.1 软件工作流程</a></li><li><a href="#332__80" rel="nofollow">3.3.2 闹铃提醒程序设计</a></li><li><a href="#333__86" rel="nofollow">3.3.3 液晶显示程序设计</a></li><li><a href="#334__92" rel="nofollow">3.3.4 信息存储程序设计</a></li><li><a href="#335__100" rel="nofollow">3.3.5 报警电路程序设计</a></li></ul> 
   </li><li><a href="#34__105" rel="nofollow">3.4 部分实现代码</a></li></ul> 
  </li><li><a href="#4__436" rel="nofollow">4 最后</a></li></ul> 
</div> 
<p></p> 
<hr color="#000000" size='1"'> 
<h2><a id="1__5"></a>1 简介</h2> 
<p>Hi，大家好，今天向大家介绍一个学长做的单片机项目</p> 
<p><strong>基于STM32的智能药箱系统设计与实现</strong></p> 
<p>大家可用于 课程设计 或 毕业设计</p> 
<h2><a id="2__15"></a>2 绪论</h2> 
<h3><a id="21__17"></a>2.1 课题背景</h3> 
<p>照顾老人， 特别是提醒老人准时吃药已经成为了一个社会关心的问题。长期记录吃药种类、 吃药时间能为分析老人的病理提供有力的依据。</p> 
<p>基于目 前市场需求， 学长设计了一款基于 STM32F103 并结合网络来提醒老人按时吃药的系统。</p> 
<p>整个智能药箱系统分为智能药箱端与远程服务器端两个部分， 智能药箱端用于提醒， 服务器端用于记录监督</p> 
<h3><a id="22__26"></a>2.2 实现功能</h3> 
<p>整个系统经过多次测试和应用， 各功能模块都可以正常运行， 符合设计要求。 具有的功<br> 能包括： 从服务器端的数据库中实时获取药物信息， 闹钟信息等并存储。 播放音频文件提醒老人用药， 在液晶屏上提示吃药信息， 老人可以根据显示信息正确用药。 智能药箱端能记录药箱中每种药的数目， 并进行药量检测， 在药量不足时发出提醒， 提示用户配药。 另外还可以对老人取药动作进行记录， 将取药状态通过互联网传输给服务器监控端， 为以后看病做依据。 另外， 智能药箱端通过程序界面方便的配置智能药箱内部的网络信息，包括服务器地址、端口、 网关等。</p> 
<p><strong>它的主要功能分为下面几个部分：</strong></p> 
<ul><li> 
  <ol><li>提醒功能</li></ol> </li><li> 
  <ol start="2"><li>取药监督</li></ol> </li><li> 
  <ol start="3"><li>记录吃药时间</li></ol> </li><li> 
  <ol start="4"><li>对老人是否吃药及时做出反应</li></ol> </li><li> 
  <ol start="5"><li>显示吃药信息</li></ol> </li></ul> 
<p>服务器中记录下的取药时间可以作为以后看病的有力依据， 使医生能够准确对老人的病情做出判断， 减少一定的医学失误。</p> 
<p>尽管智能药箱的发展并没有早期预期的那么快。 但是， 它的应用价值极高， 针对性也很<br> 强， 可以有效的管理老年人用药， 减少儿女对父母吃药问题上的担心。 所以， 随着科技的发展， 智能药箱的普及将指日可待。</p> 
<h2><a id="3__47"></a>3 系统设计</h2> 
<h3><a id="31__48"></a>3.1 系统架构</h3> 
<p><img src="https://images2.imgbox.com/1a/a6/lmBWlq6t_o.png" alt="在这里插入图片描述"></p> 
<p>设计上必须从上图架构出发， 从上图可以得出智能药箱系统的总体功能：</p> 
<ul><li>a) 闹钟提醒吃药</li><li>b) 液晶显示吃药信息</li><li>c) 实时采集取药状态</li><li>d) 存储从服务器端获取的信息</li><li>e) 配置界面配置药箱端的网络参数</li><li>f) 实时检测药数量， 不足提醒用户</li><li>g) 增加服务器端， 记录药物信息， 闹钟， 取状态药等信息</li></ul> 
<h3><a id="32__64"></a>3.2 硬件设计</h3> 
<h4><a id="321_wifi_66"></a>3.2.1 wifi电路设计</h4> 
<p><img src="https://images2.imgbox.com/5d/19/cLrLkyA0_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="322__70"></a>3.2.2 其他电路设计</h4> 
<p><strong>略，内容相对冗余，也不是本文介绍的重点，需要详细设计方案，可以在文章末尾联系学长。</strong></p> 
<h3><a id="33__74"></a>3.3 软件设计</h3> 
<h4><a id="331__75"></a>3.3.1 软件工作流程</h4> 
<p><img src="https://images2.imgbox.com/cb/90/Me1YnF0W_o.png" alt="在这里插入图片描述"><br> 程序包括模块的驱动与功能操作， 驱动主要是硬件的驱动， 每个模块只有在硬件驱动成功后， 才能执行其余功能。</p> 
<h4><a id="332__80"></a>3.3.2 闹铃提醒程序设计</h4> 
<p>下图是闹铃提醒的程序流程图， STM32 从 TF 卡中读取 512 字节数据， 按顺序传输给VS1003 进行音频转换和播放。 然后， 依次读取下一个扇区的 512 个字节进行播放。 如果播放过程中检测到药箱打开， 则停止闹铃并退出。</p> 
<p><img src="https://images2.imgbox.com/9a/41/IlO28mbG_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="333__86"></a>3.3.3 液晶显示程序设计</h4> 
<p>下图是闹铃提醒的程序流程图， STM32 从 TF 卡中读取 512 字节数据， 按顺序传输给VS1003 进行音频转换和播放。 然后， 依次读取下一个扇区的 512 个字节进行播放。 如果播放过程中检测到药箱打开， 则停止闹铃并退出。</p> 
<p><img src="https://images2.imgbox.com/78/04/HCE6EUKH_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="334__92"></a>3.3.4 信息存储程序设计</h4> 
<p>存储信息的过程如下：</p> 
<p>当智能药箱接收网络参数， 药物信息时， 首先对数据按协议正确处理， 然后向 24C08 发送存储地址， 如果地址上已经有数据， 则读取。 然后将地址上的数据清空， 将刚才接收并处理的信息与从存储芯片读取的数据进行统一处理， 保留不变的， 修改已改变的数据， 再存入地址中。 如果需要读取存储芯片上的数据， 则向 24C08 发送地址读取数据即可， 程序流程图如下图所示。</p> 
<p><img src="https://images2.imgbox.com/05/5b/O0gtzcKK_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="335__100"></a>3.3.5 报警电路程序设计</h4> 
<p>智能药箱与服务器之间每半小时需要药数目的校正， 以便两者之间可以同步。 当药箱内部药量不足时， 就会触发蜂鸣器以示提醒。 蜂鸣器采用是有源蜂鸣器， 接通电流就会发声，整个报警的程序流程图如下图所示。</p> 
<p><img src="https://images2.imgbox.com/ba/7c/iEo2ol1E_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="34__105"></a>3.4 部分实现代码</h3> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;Arduino.h&gt;</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"MAX30105.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"heartRate.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"motor.h"</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">DEBUG</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OUT_POSITION</span> <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">TAKE_POSITION</span> <span class="token expression"><span class="token number">2</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">OPEN_POSITION</span> <span class="token expression"><span class="token number">5</span></span></span>

bool isTaskTake <span class="token operator">=</span> false<span class="token punctuation">;</span>
<span class="token keyword">int</span> boxdisplacement <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> pillsParameters<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">enum</span> <span class="token class-name">BOXNAME</span> <span class="token punctuation">{<!-- --></span> BOX1 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> BOX2<span class="token punctuation">,</span> BOX3<span class="token punctuation">,</span> BOX4<span class="token punctuation">,</span> BOX5<span class="token punctuation">,</span> BOX6 <span class="token punctuation">}</span><span class="token punctuation">;</span>
TaskHandle_t taskGreenLEDHandler<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">rotateToOpen</span><span class="token punctuation">(</span><span class="token keyword">int</span> boxName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">rotateToClose</span><span class="token punctuation">(</span><span class="token keyword">int</span> boxName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">rotateToTake</span><span class="token punctuation">(</span><span class="token keyword">int</span> boxName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">rotateToOut</span><span class="token punctuation">(</span><span class="token keyword">int</span> boxName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">takePills</span><span class="token punctuation">(</span><span class="token keyword">int</span> boxName<span class="token punctuation">,</span> <span class="token keyword">int</span> pillsNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">taskTakePills</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>pvParameters<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">takePillsTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Serial<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token number">115200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">motor_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// xTaskCreate(taskPrint, "taskPrint", 1000, NULL, 1, NULL);</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">loop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Serial<span class="token punctuation">.</span><span class="token function">available</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">char</span> message <span class="token operator">=</span> <span class="token char">' '</span><span class="token punctuation">;</span>
        message <span class="token operator">=</span> Serial<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">==</span> <span class="token char">'t'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isTaskTake<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                isTaskTake <span class="token operator">=</span> true<span class="token punctuation">;</span>
                Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"*************\n*开始取药过程*\n*************"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// xTaskCreate(taskTakePills, "taskTakePills", 20000,</span>
                <span class="token comment">// pillsParameters, 1, NULL);</span>
                <span class="token function">takePills</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"已经有一个取药任务了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">==</span> <span class="token char">'i'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">//开盖</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isTaskTake<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                isTaskTake <span class="token operator">=</span> true<span class="token punctuation">;</span>
                <span class="token function">taskOpenBox</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                isTaskTake <span class="token operator">=</span> false<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"已经有一个取药任务了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">==</span> <span class="token char">'j'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">//关盖</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isTaskTake<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                isTaskTake <span class="token operator">=</span> true<span class="token punctuation">;</span>
                <span class="token function">taskCloseBox</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_ENABLE<span class="token punctuation">,</span> HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
                isTaskTake <span class="token operator">=</span> false<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"已经有一个取药任务了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">==</span> <span class="token char">'m'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">//关盖</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isTaskTake<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                isTaskTake <span class="token operator">=</span> true<span class="token punctuation">;</span>
                <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_ENABLE<span class="token punctuation">,</span> LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">takePillsTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_ENABLE<span class="token punctuation">,</span> HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
                isTaskTake <span class="token operator">=</span> false<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"已经有一个取药任务了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">==</span> <span class="token char">'g'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">//左旋</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isTaskTake<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                isTaskTake <span class="token operator">=</span> true<span class="token punctuation">;</span>
                <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_ENABLE<span class="token punctuation">,</span> LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">taskRotate</span><span class="token punctuation">(</span>LEFT<span class="token punctuation">)</span><span class="token punctuation">;</span>
                boxdisplacement<span class="token operator">--</span><span class="token punctuation">;</span>
                <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_ENABLE<span class="token punctuation">,</span> HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
                isTaskTake <span class="token operator">=</span> false<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"已经有一个取药任务了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">==</span> <span class="token char">'h'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">//右旋</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isTaskTake<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                isTaskTake <span class="token operator">=</span> true<span class="token punctuation">;</span>
                <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_ENABLE<span class="token punctuation">,</span> LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">taskRotate</span><span class="token punctuation">(</span>RIGHT<span class="token punctuation">)</span><span class="token punctuation">;</span>
                boxdisplacement<span class="token operator">++</span><span class="token punctuation">;</span>
                <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_ENABLE<span class="token punctuation">,</span> HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
                isTaskTake <span class="token operator">=</span> false<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"已经有一个取药任务了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">==</span> <span class="token char">'k'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isTaskTake<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                isTaskTake <span class="token operator">=</span> true<span class="token punctuation">;</span>
                Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"开始推出药盒"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_ENABLE<span class="token punctuation">,</span> LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">taskPushBoxOut</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"开始推入药盒"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">taskPullBoxIn</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_ENABLE<span class="token punctuation">,</span> HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
                isTaskTake <span class="token operator">=</span> false<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"已经有一个取药任务了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">==</span> <span class="token char">'3'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">taskPillsOut</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">==</span> <span class="token char">'a'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">//开气泵</span>
            <span class="token function">openPump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>message <span class="token operator">==</span> <span class="token char">'b'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">//关气泵</span>
            <span class="token function">closePump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">rotateToOpen</span><span class="token punctuation">(</span><span class="token keyword">int</span> boxName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> currentPosition <span class="token operator">=</span> boxName <span class="token operator">+</span> boxdisplacement<span class="token punctuation">;</span>
    <span class="token keyword">int</span> targetRotation <span class="token operator">=</span> OPEN_POSITION <span class="token operator">-</span> currentPosition<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>targetRotation <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"rorate right "</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>targetRotation<span class="token punctuation">)</span> <span class="token operator">+</span>
                       <span class="token string">" step to open."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"向右旋转 "</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>targetRotation<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" 步以开盖."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> targetRotation<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">taskRotate</span><span class="token punctuation">(</span>RIGHT<span class="token punctuation">)</span><span class="token punctuation">;</span>
            boxdisplacement<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"rorate left "</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token operator">-</span>targetRotation<span class="token punctuation">)</span> <span class="token operator">+</span>
                       <span class="token string">" step to open."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"向左旋转 "</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token operator">-</span>targetRotation<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" 步以开盖."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token operator">-</span>targetRotation<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">taskRotate</span><span class="token punctuation">(</span>LEFT<span class="token punctuation">)</span><span class="token punctuation">;</span>
            boxdisplacement<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">rotateToClose</span><span class="token punctuation">(</span><span class="token keyword">int</span> boxName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> currentPosition <span class="token operator">=</span> boxName <span class="token operator">+</span> boxdisplacement<span class="token punctuation">;</span>
    <span class="token keyword">int</span> targetRotation <span class="token operator">=</span> OPEN_POSITION <span class="token operator">-</span> currentPosition<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>targetRotation <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"rorate right "</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>targetRotation<span class="token punctuation">)</span> <span class="token operator">+</span>
                       <span class="token string">" step to close."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"向右旋转 "</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>targetRotation<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" 步以关盖."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> targetRotation<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">taskRotate</span><span class="token punctuation">(</span>RIGHT<span class="token punctuation">)</span><span class="token punctuation">;</span>
            boxdisplacement<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"rorate right "</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token operator">-</span>targetRotation<span class="token punctuation">)</span> <span class="token operator">+</span>
                       <span class="token string">" step to close."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"向左旋转 "</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token operator">-</span>targetRotation<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" 步以关盖."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token operator">-</span>targetRotation<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">taskRotate</span><span class="token punctuation">(</span>LEFT<span class="token punctuation">)</span><span class="token punctuation">;</span>
            boxdisplacement<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">rotateToTake</span><span class="token punctuation">(</span><span class="token keyword">int</span> boxName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> currentPosition <span class="token operator">=</span> boxName <span class="token operator">+</span> boxdisplacement<span class="token punctuation">;</span>
    <span class="token keyword">int</span> targetRotation <span class="token operator">=</span> TAKE_POSITION <span class="token operator">-</span> currentPosition<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>targetRotation <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"rorate right "</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>targetRotation<span class="token punctuation">)</span> <span class="token operator">+</span>
                       <span class="token string">" step to take pills."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"向右旋转 "</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>targetRotation<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" 步以取药."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> targetRotation<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">taskRotate</span><span class="token punctuation">(</span>RIGHT<span class="token punctuation">)</span><span class="token punctuation">;</span>
            boxdisplacement<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"rorate right "</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token operator">-</span>targetRotation<span class="token punctuation">)</span> <span class="token operator">+</span>
                       <span class="token string">" step to take pills."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"向左旋转 "</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token operator">-</span>targetRotation<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" 步以取药."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token operator">-</span>targetRotation<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">taskRotate</span><span class="token punctuation">(</span>LEFT<span class="token punctuation">)</span><span class="token punctuation">;</span>
            boxdisplacement<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">rotateToOut</span><span class="token punctuation">(</span><span class="token keyword">int</span> boxName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> currentPosition <span class="token operator">=</span> boxName <span class="token operator">+</span> boxdisplacement<span class="token punctuation">;</span>
    <span class="token keyword">int</span> targetRotation <span class="token operator">=</span> OUT_POSITION <span class="token operator">-</span> currentPosition<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>targetRotation <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"rorate right "</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>targetRotation<span class="token punctuation">)</span> <span class="token operator">+</span>
                       <span class="token string">" step to add pills."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"向右旋转 "</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>targetRotation<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" 步以换(加)药."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> targetRotation<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">taskRotate</span><span class="token punctuation">(</span>RIGHT<span class="token punctuation">)</span><span class="token punctuation">;</span>
            boxdisplacement<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"rorate right "</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token operator">-</span>targetRotation<span class="token punctuation">)</span> <span class="token operator">+</span>
                       <span class="token string">" step to add pills."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"向左旋转 "</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token operator">-</span>targetRotation<span class="token punctuation">)</span> <span class="token operator">+</span>
                       <span class="token string">" 步以换(加)药."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token operator">-</span>targetRotation<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">taskRotate</span><span class="token punctuation">(</span>LEFT<span class="token punctuation">)</span><span class="token punctuation">;</span>
            boxdisplacement<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">takePills</span><span class="token punctuation">(</span><span class="token keyword">int</span> boxName<span class="token punctuation">,</span> <span class="token keyword">int</span> pillsNumber<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_ENABLE<span class="token punctuation">,</span> LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// taskPillsUp(NULL);</span>
    <span class="token function">rotateToOpen</span><span class="token punctuation">(</span>boxName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">taskOpenBox</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">rotateToTake</span><span class="token punctuation">(</span>boxName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// stepper2.runToNewPosition(5000);</span>
    <span class="token function">midToLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">openPump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// stepper2.runToNewPosition(6400);</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_STEPPER2_DIR<span class="token punctuation">,</span> LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_STEPPER2_STEP<span class="token punctuation">,</span> HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">delayMicroseconds</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_STEPPER2_STEP<span class="token punctuation">,</span> LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">delayMicroseconds</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_STEPPER2_DIR<span class="token punctuation">,</span> HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_STEPPER2_STEP<span class="token punctuation">,</span> HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">delayMicroseconds</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_STEPPER2_STEP<span class="token punctuation">,</span> LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">delayMicroseconds</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_STEPPER2_DIR<span class="token punctuation">,</span> LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// stepper2.setMaxSpeed(2500);</span>
    <span class="token comment">// stepper2.setAcceleration(1500);</span>
    <span class="token comment">// stepper2.runToNewPosition(-20000);</span>
    <span class="token function">leftToMid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">taskMidToRight</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">closePump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">openAir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">closeAir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">taskPillsOut</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">taskRightToMid</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// xTaskCreate(taskRightToMid, "taskRightToMid", 1000, NULL, 1, NULL);</span>
    isTaskTake <span class="token operator">=</span> false<span class="token punctuation">;</span>
    <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_ENABLE<span class="token punctuation">,</span> HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">taskTakePills</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span>pvParameters<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> boxName <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span>pvParameters<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> pillsNumber <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span>pvParameters<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">DEBUG</span></span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"boxName: "</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>boxName<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Serial<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"pillsNumber: "</span> <span class="token operator">+</span> <span class="token function">String</span><span class="token punctuation">(</span>pillsNumber<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
    <span class="token function">takePills</span><span class="token punctuation">(</span>boxName<span class="token punctuation">,</span> pillsNumber<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">vTaskDelete</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">takePillsTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">midToLeft</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">openPump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// stepper2.runToNewPosition(6400);</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_STEPPER2_DIR<span class="token punctuation">,</span> LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;=</span> <span class="token number">5</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_STEPPER2_STEP<span class="token punctuation">,</span> HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">delayMicroseconds</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_STEPPER2_STEP<span class="token punctuation">,</span> LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">delayMicroseconds</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_STEPPER2_DIR<span class="token punctuation">,</span> HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> <span class="token number">500</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_STEPPER2_STEP<span class="token punctuation">,</span> HIGH<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">delayMicroseconds</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_STEPPER2_STEP<span class="token punctuation">,</span> LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">delayMicroseconds</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">digitalWrite</span><span class="token punctuation">(</span>PIN_STEPPER2_DIR<span class="token punctuation">,</span> LOW<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// stepper2.setMaxSpeed(2500);</span>
    <span class="token comment">// stepper2.setAcceleration(1500);</span>
    <span class="token comment">// stepper2.runToNewPosition(-20000);</span>
    <span class="token function">leftToMid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">taskMidToRight</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">closePump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">openAir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">delay</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">closeAir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">taskRightToMid</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>作品展示：</p> 
<p><img src="https://images2.imgbox.com/82/3f/ErFCf74q_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="4__436"></a>4 最后</h2>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/666b601f641d10b351060266aea6b920/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ChatGPT源码小狐狸AI系统pc自适应全开源GPT4.0MJ绘画系统AI绘画</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/faa2062fa1c18375a41d7833a3e0b2f2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于双树复小波变换（DT-CWT）的实验性实用程序的图像融合技术解析与实践</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>