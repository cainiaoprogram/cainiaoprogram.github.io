<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于插值算法和Gardner定时误差检测的OOK信号定时同步的FPGA实现 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="基于插值算法和Gardner定时误差检测的OOK信号定时同步的FPGA实现" />
<meta property="og:description" content="本文介绍如何用FPGA实现基于插值算法的OOK信号定时同步，Verilog代码参考杜勇《数字调制解调技术的MATLAB与FPGA实现》。我们的目标是用外部提供50MHz时钟的zynq7100芯片实现400MHz采样频率和100Mbps的OOK数字基带信号的定时同步。
采用传统的锁相环技术实现定时同步时，本地时钟需要有较高的频率。当数据采样频率很高，并且本地时钟受到器件性能限制而不能远高于采样频率时，锁相环技术性能不佳。插值算法可以不改变采样时钟的频率和相位来实现位同步信号的调整，同时，插值算法可以根据采样值以及数控振荡器输出的采样时刻信号和误差信号获取最佳采样值。
插值位同步算法的框图如下图所示（图片源于文献[1]）。主要模块为括插值滤波器（INTERPOLATOR）、定时误差检测器（TIMING ERROR DETECTOR）、环路滤波器（LOOP FILTER）和数控振荡器（CONTROLLER）。下面我们一一介绍并给出Verilog代码。
插值滤波器 插值滤波器的功能是速率转换，上图显示了内插滤波器的原理。设采样周期为 T s T_s Ts​，符号周期为 T T T，插值周期为 T i T_i Ti​，插值滤波器的脉冲响应为 h I ( t ) h_I(t) hI​(t)。由上图可知，插值滤波器输出的连续时间信号为 y ( t ) = ∑ m x ( m ) h I ( t − m T s ) y(t)=\sum_{m}x(m)h_I(t-mT_s) y(t)=m∑​x(m)hI​(t−mTs​) 按插值周期对 y ( t ) y(t) y(t)进行采样得 y ( k T i ) = ∑ m x ( m ) h I ( k T i − m T s ) (1) y(kT_i)=\sum_{m}x(m)h_I(kT_i-mT_s) \tag{1} y(kTi​)=m∑​x(m)hI​(kTi​−mTs​)(1) 上式中， m m m是采样信号的索引，下面定义一个滤波器的索引 i = i n t [ k T i T s ] − m i=int[\frac{kT_i}{T_s}]-m i=int[Ts​kTi​​]−m 基准点索引 m k = i n t [ k T i T s ] m_k=int[\frac{kT_i}{T_s}] mk​=int[Ts​kTi​​] 分数间隔 μ k = k T i T s − m k \mu_k=\frac{kT_i}{T_s}-m_k μk​=Ts​kTi​​−mk​ 公式 ( 1 ) (1) (1)可以重写为 y ( k T i ) = y [ ( m k &#43; μ k ) T s ] = ∑ i x [ ( m k − i ) T s ] h I [ ( i &#43; μ k ) T s ] y(kT_i)=y[(m_k&#43;\mu_k)T_s]=\sum_{i}x[(m_k-i)T_s]h_I[(i&#43;\mu_k)T_s] y(kTi​)=y[(mk​&#43;μk​)Ts​]=i∑​x[(mk​−i)Ts​]hI​[(i&#43;μk​)Ts​] 其中 k T i kT_i kTi​表示第 k k k个插值点， m k T s m_kT_s mk​Ts​表示第 k k k个插值点前相邻的采样点， μ k T s \mu_kT_s μk​Ts​是插值点 k T i kT_i kTi​与采样点 m k T s m_kT_s mk​Ts​之间的时间间隔。下图展示了采样点与插值点之间的关系。 根据文献[2]，我们采用Farrow结构的插值滤波器，如下图所示。 插值滤波器有三条纵向支路和一条横向支路，它们的计算公式为 f 1 = 0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/8684021d1234f6ed13f4e298c8c8632f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-05T11:51:50+08:00" />
<meta property="article:modified_time" content="2023-05-05T11:51:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于插值算法和Gardner定时误差检测的OOK信号定时同步的FPGA实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>  本文介绍如何用FPGA实现基于插值算法的OOK信号定时同步，Verilog代码参考杜勇《数字调制解调技术的MATLAB与FPGA实现》。我们的目标是用外部提供50MHz时钟的zynq7100芯片实现400MHz采样频率和100Mbps的OOK数字基带信号的定时同步。<br>   采用传统的锁相环技术实现定时同步时，本地时钟需要有较高的频率。当数据采样频率很高，并且本地时钟受到器件性能限制而不能远高于采样频率时，锁相环技术性能不佳。插值算法可以不改变采样时钟的频率和相位来实现位同步信号的调整，同时，插值算法可以根据采样值以及数控振荡器输出的采样时刻信号和误差信号获取最佳采样值。<br>   插值位同步算法的框图如下图所示（图片源于文献<a href="#refer1" rel="nofollow">[1]</a>）。主要模块为括插值滤波器（INTERPOLATOR）、定时误差检测器（TIMING ERROR DETECTOR）、环路滤波器（LOOP FILTER）和数控振荡器（CONTROLLER）。下面我们一一介绍并给出Verilog代码。<img src="https://images2.imgbox.com/df/97/P4xyiFF7_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_4"></a>插值滤波器</h3> 
<p><img src="https://images2.imgbox.com/49/19/bf4jEane_o.png" alt="在这里插入图片描述">  插值滤波器的功能是速率转换，上图显示了内插滤波器的原理。设采样周期为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          T 
         
        
          s 
         
        
       
      
        T_s 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>，符号周期为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         T 
        
       
      
        T 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span></span></span></span></span>，插值周期为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          T 
         
        
          i 
         
        
       
      
        T_i 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>，插值滤波器的脉冲响应为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          h 
         
        
          I 
         
        
       
         ( 
        
       
         t 
        
       
         ) 
        
       
      
        h_I(t) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0785em;" class="mord mathnormal mtight">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span></span>。由上图可知，插值滤波器输出的连续时间信号为 <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          y 
         
        
          ( 
         
        
          t 
         
        
          ) 
         
        
          = 
         
         
         
           ∑ 
          
         
           m 
          
         
        
          x 
         
        
          ( 
         
        
          m 
         
        
          ) 
         
         
         
           h 
          
         
           I 
          
         
        
          ( 
         
        
          t 
         
        
          − 
         
        
          m 
         
         
         
           T 
          
         
           s 
          
         
        
          ) 
         
        
       
         y(t)=\sum_{m}x(m)h_I(t-mT_s) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.0359em;" class="mord mathnormal">y</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.3em; vertical-align: -1.25em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.9em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.25em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0785em;" class="mord mathnormal mtight">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">m</span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></span> 按插值周期对<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         y 
        
       
         ( 
        
       
         t 
        
       
         ) 
        
       
      
        y(t) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.0359em;" class="mord mathnormal">y</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span></span></span></span></span>进行采样得 <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
          
           
           
             y 
            
           
             ( 
            
           
             k 
            
            
            
              T 
             
            
              i 
             
            
           
             ) 
            
           
             = 
            
            
            
              ∑ 
             
            
              m 
             
            
           
             x 
            
           
             ( 
            
           
             m 
            
           
             ) 
            
            
            
              h 
             
            
              I 
             
            
           
             ( 
            
           
             k 
            
            
            
              T 
             
            
              i 
             
            
           
             − 
            
           
             m 
            
            
            
              T 
             
            
              s 
             
            
           
             ) 
            
           
          
          
          
          
            (1) 
           
          
         
        
       
         y(kT_i)=\sum_{m}x(m)h_I(kT_i-mT_s) \tag{1} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.0359em;" class="mord mathnormal">y</span><span class="mopen">(</span><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.3em; vertical-align: -1.25em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.9em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">m</span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.25em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mclose">)</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0785em;" class="mord mathnormal mtight">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">m</span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span><span class="tag"><span class="strut" style="height: 2.3em; vertical-align: -1.25em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">1</span></span><span class="mord">)</span></span></span></span></span></span></span> 上式中，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         m 
        
       
      
        m 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span></span>是采样信号的索引，下面定义一个滤波器的索引 <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          i 
         
        
          = 
         
        
          i 
         
        
          n 
         
        
          t 
         
        
          [ 
         
         
          
          
            k 
           
           
           
             T 
            
           
             i 
            
           
          
          
          
            T 
           
          
            s 
           
          
         
        
          ] 
         
        
          − 
         
        
          m 
         
        
       
         i=int[\frac{kT_i}{T_s}]-m 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6595em;"></span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.2074em; vertical-align: -0.836em;"></span><span class="mord mathnormal">in</span><span class="mord mathnormal">t</span><span class="mopen">[</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3714em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.836em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span></span></span> 基准点索引 <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           m 
          
         
           k 
          
         
        
          = 
         
        
          i 
         
        
          n 
         
        
          t 
         
        
          [ 
         
         
          
          
            k 
           
           
           
             T 
            
           
             i 
            
           
          
          
          
            T 
           
          
            s 
           
          
         
        
          ] 
         
        
       
         m_k=int[\frac{kT_i}{T_s}] 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.2074em; vertical-align: -0.836em;"></span><span class="mord mathnormal">in</span><span class="mord mathnormal">t</span><span class="mopen">[</span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3714em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.836em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">]</span></span></span></span></span></span> 分数间隔 <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           μ 
          
         
           k 
          
         
        
          = 
         
         
          
          
            k 
           
           
           
             T 
            
           
             i 
            
           
          
          
          
            T 
           
          
            s 
           
          
         
        
          − 
         
         
         
           m 
          
         
           k 
          
         
        
       
         \mu_k=\frac{kT_i}{T_s}-m_k 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.2074em; vertical-align: -0.836em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3714em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.836em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.5806em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span> 公式<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ( 
        
       
         1 
        
       
         ) 
        
       
      
        (1) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span>可以重写为 <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          y 
         
        
          ( 
         
        
          k 
         
         
         
           T 
          
         
           i 
          
         
        
          ) 
         
        
          = 
         
        
          y 
         
        
          [ 
         
        
          ( 
         
         
         
           m 
          
         
           k 
          
         
        
          + 
         
         
         
           μ 
          
         
           k 
          
         
        
          ) 
         
         
         
           T 
          
         
           s 
          
         
        
          ] 
         
        
          = 
         
         
         
           ∑ 
          
         
           i 
          
         
        
          x 
         
        
          [ 
         
        
          ( 
         
         
         
           m 
          
         
           k 
          
         
        
          − 
         
        
          i 
         
        
          ) 
         
         
         
           T 
          
         
           s 
          
         
        
          ] 
         
         
         
           h 
          
         
           I 
          
         
        
          [ 
         
        
          ( 
         
        
          i 
         
        
          + 
         
         
         
           μ 
          
         
           k 
          
         
        
          ) 
         
         
         
           T 
          
         
           s 
          
         
        
          ] 
         
        
       
         y(kT_i)=y[(m_k+\mu_k)T_s]=\sum_{i}x[(m_k-i)T_s]h_I[(i+\mu_k)T_s] 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.0359em;" class="mord mathnormal">y</span><span class="mopen">(</span><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.0359em;" class="mord mathnormal">y</span><span class="mopen">[(</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">]</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.3277em; vertical-align: -1.2777em;"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.05em;"><span class="" style="top: -1.8723em; margin-left: 0em;"><span class="pstrut" style="height: 3.05em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="" style="top: -3.05em;"><span class="pstrut" style="height: 3.05em;"></span><span class=""><span class="mop op-symbol large-op">∑</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 1.2777em;"><span class=""></span></span></span></span></span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal">x</span><span class="mopen">[(</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">i</span><span class="mclose">)</span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">]</span><span class="mord"><span class="mord mathnormal">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0785em;" class="mord mathnormal mtight">I</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">[(</span><span class="mord mathnormal">i</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">]</span></span></span></span></span></span> 其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         k 
        
        
        
          T 
         
        
          i 
         
        
       
      
        kT_i 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8444em; vertical-align: -0.15em;"></span><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>表示第<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         k 
        
       
      
        k 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6944em;"></span><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span></span></span></span></span>个插值点，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          m 
         
        
          k 
         
        
        
        
          T 
         
        
          s 
         
        
       
      
        m_kT_s 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>表示第<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         k 
        
       
      
        k 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6944em;"></span><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span></span></span></span></span>个插值点前相邻的采样点， <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          μ 
         
        
          k 
         
        
        
        
          T 
         
        
          s 
         
        
       
      
        \mu_kT_s 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8778em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>是插值点<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         k 
        
        
        
          T 
         
        
          i 
         
        
       
      
        kT_i 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8444em; vertical-align: -0.15em;"></span><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>与采样点<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          m 
         
        
          k 
         
        
        
        
          T 
         
        
          s 
         
        
       
      
        m_kT_s 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>之间的时间间隔。下图展示了采样点与插值点之间的关系。<img src="https://images2.imgbox.com/46/83/rYc3b5EV_o.png" alt="在这里插入图片描述">  根据文献<a href="#refer1" rel="nofollow">[2]</a>，我们采用Farrow结构的插值滤波器，如下图所示。<img src="https://images2.imgbox.com/17/01/vdKuVjFv_o.png" alt="在这里插入图片描述">  插值滤波器有三条纵向支路和一条横向支路，它们的计算公式为 <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
           
            
           
          
          
           
            
             
             
             
               f 
              
             
               1 
              
             
            
              = 
             
            
              0.5 
             
            
              x 
             
            
              ( 
             
            
              m 
             
            
              ) 
             
            
              − 
             
            
              0.5 
             
            
              x 
             
            
              ( 
             
            
              m 
             
            
              − 
             
            
              1 
             
            
              ) 
             
            
              − 
             
            
              0.5 
             
            
              x 
             
            
              ( 
             
            
              m 
             
            
              − 
             
            
              2 
             
            
              ) 
             
            
              + 
             
            
              0.5 
             
            
              x 
             
            
              ( 
             
            
              m 
             
            
              − 
             
            
              3 
             
            
              ) 
             
            
           
          
         
         
          
           
            
           
          
          
           
            
             
             
             
               f 
              
             
               2 
              
             
            
              = 
             
            
              − 
             
            
              0.5 
             
            
              x 
             
            
              ( 
             
            
              m 
             
            
              ) 
             
            
              + 
             
            
              1.5 
             
            
              x 
             
            
              ( 
             
            
              m 
             
            
              − 
             
            
              1 
             
            
              ) 
             
            
              − 
             
            
              0.5 
             
            
              x 
             
            
              ( 
             
            
              m 
             
            
              − 
             
            
              2 
             
            
              ) 
             
            
              − 
             
            
              0.5 
             
            
              x 
             
            
              ( 
             
            
              m 
             
            
              − 
             
            
              3 
             
            
              ) 
             
            
           
          
         
         
          
           
            
           
          
          
           
            
             
             
             
               f 
              
             
               3 
              
             
            
              = 
             
            
              x 
             
            
              ( 
             
            
              m 
             
            
              − 
             
            
              2 
             
            
              ) 
             
            
           
          
         
         
          
           
            
           
          
          
           
            
             
            
              y 
             
            
              ( 
             
            
              k 
             
            
              ) 
             
            
              = 
             
             
             
               f 
              
             
               1 
              
             
             
             
               μ 
              
             
               k 
              
             
               2 
              
             
            
              + 
             
             
             
               f 
              
             
               2 
              
             
             
             
               μ 
              
             
               k 
              
             
            
              + 
             
             
             
               f 
              
             
               3 
              
             
            
           
          
         
        
       
         \begin{aligned} &amp;f_1 = 0.5x(m)-0.5x(m-1)-0.5x(m-2)+0.5x(m-3) \\ &amp;f_2 = -0.5x(m)+1.5x(m-1)-0.5x(m-2)-0.5x(m-3) \\ &amp;f_3=x(m-2) \\ &amp; y(k)=f_1\mu_k^2+f_2\mu_k+f_3 \end{aligned} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 6.0241em; vertical-align: -2.7621em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.2621em;"><span class="" style="top: -5.2862em;"><span class="pstrut" style="height: 2.8641em;"></span><span class="mord"></span></span><span class="" style="top: -3.7862em;"><span class="pstrut" style="height: 2.8641em;"></span><span class="mord"></span></span><span class="" style="top: -2.2862em;"><span class="pstrut" style="height: 2.8641em;"></span><span class="mord"></span></span><span class="" style="top: -0.7621em;"><span class="pstrut" style="height: 2.8641em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.7621em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 3.2621em;"><span class="" style="top: -5.4221em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span style="margin-right: 0.1076em;" class="mord mathnormal">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord">0.5</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0.5</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0.5</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0.5</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">3</span><span class="mclose">)</span></span></span><span class="" style="top: -3.9221em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span style="margin-right: 0.1076em;" class="mord mathnormal">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord">−</span><span class="mord">0.5</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">1.5</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0.5</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">2</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">0.5</span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">3</span><span class="mclose">)</span></span></span><span class="" style="top: -2.4221em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span style="margin-right: 0.1076em;" class="mord mathnormal">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord mathnormal">x</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">2</span><span class="mclose">)</span></span></span><span class="" style="top: -0.8979em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"></span><span style="margin-right: 0.0359em;" class="mord mathnormal">y</span><span class="mopen">(</span><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord"><span style="margin-right: 0.1076em;" class="mord mathnormal">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8641em;"><span class="" style="top: -2.453em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span><span class="" style="top: -3.113em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.247em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord"><span style="margin-right: 0.1076em;" class="mord mathnormal">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord"><span style="margin-right: 0.1076em;" class="mord mathnormal">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.7621em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span><br>   下面给出插值滤波器的Verilog代码。其中，mult18_16模块是vivado的乘法器IP核，设置了2级流水线；<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          f 
         
        
          1 
         
        
       
         、 
        
        
        
          f 
         
        
          2 
         
        
       
         、 
        
        
        
          f 
         
        
          3 
         
        
       
      
        f_1、f_2、f_3 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord"><span style="margin-right: 0.1076em;" class="mord mathnormal">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord cjk_fallback">、</span><span class="mord"><span style="margin-right: 0.1076em;" class="mord mathnormal">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord cjk_fallback">、</span><span class="mord"><span style="margin-right: 0.1076em;" class="mord mathnormal">f</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.1076em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">3</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>的放在always内用时序逻辑描述（书上用的是组合逻辑），否则时序仿真时会出现很多毛刺造成性能下降。</p> 
<pre><code class="prism language-c">`timescale <span class="token number">1</span>ns <span class="token operator">/</span> <span class="token number">1</span>ps
module <span class="token function">interpolate_filter</span><span class="token punctuation">(</span>
    input resetn<span class="token punctuation">,</span>
    input clk<span class="token punctuation">,</span>
    input <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_in<span class="token punctuation">,</span>   <span class="token comment">// 采样数据，采样频率同clk频率</span>
    input <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> uk<span class="token punctuation">,</span>        <span class="token comment">//分数间隔</span>
    output <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_out  <span class="token comment">//插值滤波输出，输出速率同clk频率</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
reg  <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> din_1<span class="token punctuation">,</span>din_2<span class="token punctuation">,</span>din_3<span class="token punctuation">,</span>din_4<span class="token punctuation">,</span>din_5<span class="token punctuation">,</span>din_6<span class="token punctuation">;</span>
reg  <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> u_1<span class="token punctuation">,</span>u_2<span class="token punctuation">;</span>
wire <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">33</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> f1_u<span class="token punctuation">,</span>f2_u<span class="token punctuation">;</span>
wire <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">33</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> f1_u2<span class="token punctuation">;</span>
reg  <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">33</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> f2_u_1<span class="token punctuation">,</span>f2_u_2<span class="token punctuation">;</span>    
reg <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> f1<span class="token punctuation">;</span>
reg <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> f2<span class="token punctuation">;</span>
reg <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> f3<span class="token punctuation">;</span>
always @<span class="token punctuation">(</span>posedge clk or negedge resetn<span class="token punctuation">)</span> begin
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>resetn<span class="token punctuation">)</span> begin
        din_1 <span class="token operator">&lt;=</span> <span class="token number">15</span>'d0<span class="token punctuation">;</span>
        din_2 <span class="token operator">&lt;=</span> <span class="token number">15</span>'d0<span class="token punctuation">;</span>
        din_3 <span class="token operator">&lt;=</span> <span class="token number">15</span>'d0<span class="token punctuation">;</span>
        din_4 <span class="token operator">&lt;=</span> <span class="token number">15</span>'d0<span class="token punctuation">;</span>
        din_5 <span class="token operator">&lt;=</span> <span class="token number">15</span>'d0<span class="token punctuation">;</span>
        din_6 <span class="token operator">&lt;=</span> <span class="token number">15</span>'d0<span class="token punctuation">;</span>
        u_1 <span class="token operator">&lt;=</span> <span class="token number">16</span>'d0<span class="token punctuation">;</span>
        u_2 <span class="token operator">&lt;=</span> <span class="token number">16</span>'d0<span class="token punctuation">;</span>
        f2_u_1 <span class="token operator">&lt;=</span> <span class="token number">32</span>'d0<span class="token punctuation">;</span>
        f2_u_2 <span class="token operator">&lt;=</span> <span class="token number">32</span>'d0<span class="token punctuation">;</span>
        f1 <span class="token operator">&lt;=</span> <span class="token number">18</span>'d0<span class="token punctuation">;</span>
        f2 <span class="token operator">&lt;=</span> <span class="token number">18</span>'d0<span class="token punctuation">;</span>
        f3 <span class="token operator">&lt;=</span> <span class="token number">18</span>'d0<span class="token punctuation">;</span>
    end
    <span class="token keyword">else</span> begin
        din_1 <span class="token operator">&lt;=</span> data_in<span class="token punctuation">;</span>
        din_2 <span class="token operator">&lt;=</span> din_1<span class="token punctuation">;</span>
        din_3 <span class="token operator">&lt;=</span> din_2<span class="token punctuation">;</span>
        din_4 <span class="token operator">&lt;=</span> din_3<span class="token punctuation">;</span>
        din_5 <span class="token operator">&lt;=</span> din_4<span class="token punctuation">;</span>
        din_6 <span class="token operator">&lt;=</span> din_5<span class="token punctuation">;</span>
        u_1 <span class="token operator">&lt;=</span> uk<span class="token punctuation">;</span>
        u_2 <span class="token operator">&lt;=</span> u_1<span class="token punctuation">;</span>
        f2_u_1 <span class="token operator">&lt;=</span> f2_u<span class="token punctuation">;</span>
        f2_u_2 <span class="token operator">&lt;=</span> f2_u_1<span class="token punctuation">;</span>
        f1 <span class="token operator">&lt;=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">4</span><span class="token punctuation">{<!-- --></span>data_in<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>data_in<span class="token punctuation">[</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token operator">-</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">4</span><span class="token punctuation">{<!-- --></span>din_1<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>din_1<span class="token punctuation">[</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token operator">-</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">4</span><span class="token punctuation">{<!-- --></span>din_2<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>din_2<span class="token punctuation">[</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token operator">+</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">4</span><span class="token punctuation">{<!-- --></span>din_3<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>din_3<span class="token punctuation">[</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        f2 <span class="token operator">&lt;=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">{<!-- --></span>din_1<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>din_1<span class="token punctuation">}</span><span class="token operator">+</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">4</span><span class="token punctuation">{<!-- --></span>din_1<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>din_1<span class="token punctuation">[</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token operator">-</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">4</span><span class="token punctuation">{<!-- --></span>data_in<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>data_in<span class="token punctuation">[</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token operator">-</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">4</span><span class="token punctuation">{<!-- --></span>din_2<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>din_2<span class="token punctuation">[</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token operator">-</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">4</span><span class="token punctuation">{<!-- --></span>din_3<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>din_3<span class="token punctuation">[</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        f3 <span class="token operator">&lt;=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">3</span><span class="token punctuation">{<!-- --></span>din_6<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>din_6<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">//一个乘法器延时2个clk</span>
    end
end
<span class="token comment">//乘法器2级流水线</span>
mult18_16 <span class="token function">u1</span> <span class="token punctuation">(</span>
  <span class="token punctuation">.</span><span class="token function">CLK</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// input wire CLK</span>
  <span class="token punctuation">.</span><span class="token function">A</span><span class="token punctuation">(</span>f1<span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token comment">// input wire [17 : 0] A</span>
  <span class="token punctuation">.</span><span class="token function">B</span><span class="token punctuation">(</span>uk<span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token comment">// input wire [15 : 0] B</span>
  <span class="token punctuation">.</span><span class="token function">P</span><span class="token punctuation">(</span>f1_u<span class="token punctuation">)</span>      <span class="token comment">// output wire [33 : 0] P</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//乘法器2级流水线</span>
mult18_16 <span class="token function">u2</span> <span class="token punctuation">(</span>
  <span class="token punctuation">.</span><span class="token function">CLK</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// input wire CLK</span>
  <span class="token punctuation">.</span><span class="token function">A</span><span class="token punctuation">(</span>f2<span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token comment">// input wire [17 : 0] A</span>
  <span class="token punctuation">.</span><span class="token function">B</span><span class="token punctuation">(</span>uk<span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token comment">// input wire [15 : 0] B</span>
  <span class="token punctuation">.</span><span class="token function">P</span><span class="token punctuation">(</span>f2_u<span class="token punctuation">)</span>      <span class="token comment">// output wire [33 : 0] P</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//乘法器2级流水线</span>
mult18_16 <span class="token function">u3</span> <span class="token punctuation">(</span>
  <span class="token punctuation">.</span><span class="token function">CLK</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// input wire CLK</span>
  <span class="token punctuation">.</span><span class="token function">A</span><span class="token punctuation">(</span>f1_u<span class="token punctuation">[</span><span class="token number">32</span><span class="token operator">:</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// input wire [17 : 0] A //matlab仿真得f1_u有效位宽不超过31bit</span>
  <span class="token punctuation">.</span><span class="token function">B</span><span class="token punctuation">(</span>u_2<span class="token punctuation">)</span><span class="token punctuation">,</span>      <span class="token comment">// input wire [15 : 0] B</span>
  <span class="token punctuation">.</span><span class="token function">P</span><span class="token punctuation">(</span>f1_u2<span class="token punctuation">)</span>      <span class="token comment">// output wire [33 : 0] P</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
wire <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">18</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> dt<span class="token punctuation">;</span>
assign dt <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">!</span>resetn<span class="token punctuation">)</span><span class="token operator">?</span> <span class="token number">19</span>'d0<span class="token operator">:</span><span class="token punctuation">(</span>f2_u_2<span class="token punctuation">[</span><span class="token number">33</span><span class="token operator">:</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">+</span>f1_u2<span class="token punctuation">[</span><span class="token number">33</span><span class="token operator">:</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token punctuation">{<!-- --></span>f3<span class="token punctuation">,</span><span class="token number">1</span>'b0<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//小数位对齐</span>
reg <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> dt_1<span class="token punctuation">;</span>
always @<span class="token punctuation">(</span>posedge clk or negedge resetn<span class="token punctuation">)</span> begin
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>resetn<span class="token punctuation">)</span> begin
        dt_1 <span class="token operator">&lt;=</span> <span class="token number">18</span>'d0<span class="token punctuation">;</span> 
    end
    <span class="token keyword">else</span> begin
        dt_1 <span class="token operator">&lt;=</span> dt<span class="token punctuation">[</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    end
end
assign data_out <span class="token operator">=</span> dt_1<span class="token punctuation">;</span>
endmodule
</code></pre> 
<h3><a id="Gardner_96"></a>Gardner定时误差检测算法</h3> 
<p>  Gardner定时误差检测算法根据插值滤波器输出的插值数据进行定时误差检测。一个符号周期内只需要两个插值点，一个插值点出现在数据的峰值时刻，另一个插值点出现在两个数据峰值的中间时刻。<br> <img src="https://images2.imgbox.com/e0/70/8Rv4681A_o.png" alt="在这里插入图片描述">  Gardner定时误差检测算法的公式为 <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           μ 
          
         
           t 
          
         
        
          ( 
         
        
          k 
         
        
          ) 
         
        
          = 
         
        
          I 
         
        
          ( 
         
        
          k 
         
        
          − 
         
         
         
           1 
          
         
           2 
          
         
        
          ) 
         
        
          [ 
         
        
          I 
         
        
          ( 
         
        
          k 
         
        
          ) 
         
        
          − 
         
        
          I 
         
        
          ( 
         
        
          k 
         
        
          − 
         
        
          1 
         
        
          ) 
         
        
          ] 
         
        
       
         \mu_t(k)=I(k-\frac{1}{2})[I(k)-I(k-1)] 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.0785em;" class="mord mathnormal">I</span><span class="mopen">(</span><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 2.0074em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3214em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span><span class="mopen">[</span><span style="margin-right: 0.0785em;" class="mord mathnormal">I</span><span class="mopen">(</span><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.0785em;" class="mord mathnormal">I</span><span class="mopen">(</span><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)]</span></span></span></span></span></span> 其中，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         I 
        
       
         ( 
        
       
         k 
        
       
         ) 
        
       
      
        I(k) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.0785em;" class="mord mathnormal">I</span><span class="mopen">(</span><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span><span class="mclose">)</span></span></span></span></span>表示第<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         k 
        
       
      
        k 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6944em;"></span><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span></span></span></span></span>个码元数据选通时的插值，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         I 
        
       
         ( 
        
       
         k 
        
       
         − 
        
        
        
          1 
         
        
          2 
         
        
       
         ) 
        
       
      
        I(k-\frac{1}{2}) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.0785em;" class="mord mathnormal">I</span><span class="mopen">(</span><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1.1901em; vertical-align: -0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8451em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.345em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span></span></span></span></span>表示第<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         k 
        
       
      
        k 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6944em;"></span><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span></span></span></span></span>和<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         k 
        
       
         − 
        
       
         1 
        
       
      
        k-1 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.7778em; vertical-align: -0.0833em;"></span><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span></span>个码元中间时刻的插值。我们还可以用插值信号的正负号代替插值的实际值，虽然有一定的性能损失，但是提高了追踪能力，而且系统实现简单，公式为<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           μ 
          
         
           t 
          
         
        
          ( 
         
        
          k 
         
        
          ) 
         
        
          = 
         
        
          I 
         
        
          ( 
         
        
          k 
         
        
          − 
         
         
         
           1 
          
         
           2 
          
         
        
          ) 
         
        
          { 
         
        
          s 
         
        
          g 
         
        
          n 
         
        
          [ 
         
        
          I 
         
        
          ( 
         
        
          k 
         
        
          ) 
         
        
          ] 
         
        
          − 
         
        
          s 
         
        
          g 
         
        
          n 
         
        
          [ 
         
        
          I 
         
        
          ( 
         
        
          k 
         
        
          − 
         
        
          1 
         
        
          ) 
         
        
          ] 
         
        
          } 
         
        
       
         \mu_t(k)=I(k-\frac{1}{2})\{sgn[I(k)]-sgn[I(k-1)]\} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.2806em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">t</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mopen">(</span><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.0785em;" class="mord mathnormal">I</span><span class="mopen">(</span><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 2.0074em; vertical-align: -0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3214em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">2</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mclose">)</span><span class="mopen">{<!-- --></span><span class="mord mathnormal">s</span><span style="margin-right: 0.0359em;" class="mord mathnormal">g</span><span class="mord mathnormal">n</span><span class="mopen">[</span><span style="margin-right: 0.0785em;" class="mord mathnormal">I</span><span class="mopen">(</span><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span><span class="mclose">)]</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathnormal">s</span><span style="margin-right: 0.0359em;" class="mord mathnormal">g</span><span class="mord mathnormal">n</span><span class="mopen">[</span><span style="margin-right: 0.0785em;" class="mord mathnormal">I</span><span class="mopen">(</span><span style="margin-right: 0.0315em;" class="mord mathnormal">k</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)]}</span></span></span></span></span></span><br>   Gardner定时误差检测和环路滤波器的代码写在一个模块内，后面一起给出代码。</p> 
<h3><a id="_100"></a>环路滤波器和数字振荡器</h3> 
<h4><a id="_101"></a>环路滤波器</h4> 
<p>  采用二阶环路滤波器，滤波器框图如下图所示。<br> <img src="https://images2.imgbox.com/d1/51/JHR7togN_o.png" alt="在这里插入图片描述">  环路滤波器的传递函数为 <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          H 
         
        
          ( 
         
        
          z 
         
        
          ) 
         
        
          = 
         
         
         
           C 
          
         
           1 
          
         
        
          + 
         
         
          
           
           
             C 
            
           
             2 
            
           
           
           
             z 
            
            
            
              − 
             
            
              1 
             
            
           
          
          
          
            1 
           
          
            − 
           
           
           
             z 
            
            
            
              − 
             
            
              1 
             
            
           
          
         
        
       
         H(z)=C_1+\frac{C_2z^{-1}}{1-z^{-1}} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.0813em;" class="mord mathnormal">H</span><span class="mopen">(</span><span style="margin-right: 0.044em;" class="mord mathnormal">z</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.0715em;" class="mord mathnormal">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0715em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 2.2604em; vertical-align: -0.7693em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.4911em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord"><span style="margin-right: 0.044em;" class="mord mathnormal">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.7401em;"><span class="" style="top: -2.989em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.0715em;" class="mord mathnormal">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0715em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.044em;" class="mord mathnormal">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8141em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.7693em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          C 
         
        
          1 
         
        
       
         、 
        
        
        
          C 
         
        
          2 
         
        
       
      
        C_1、C_2 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.0715em;" class="mord mathnormal">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0715em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord cjk_fallback">、</span><span class="mord"><span style="margin-right: 0.0715em;" class="mord mathnormal">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0715em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>可以下式计算 <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
           
            
           
          
          
           
            
             
             
             
               C 
              
             
               1 
              
             
            
              = 
             
             
              
              
                8 
               
               
               
                 B 
                
               
                 L 
                
               
               
               
                 T 
                
               
                 s 
                
               
              
             
               3 
              
             
            
           
          
         
         
          
           
            
           
          
          
           
            
             
             
             
               C 
              
             
               2 
              
             
            
              = 
             
             
              
              
                32 
               
              
                ( 
               
               
               
                 B 
                
               
                 L 
                
               
               
               
                 T 
                
               
                 s 
                
               
               
               
                 ) 
                
               
                 2 
                
               
              
             
               9 
              
             
            
           
          
         
        
       
         \begin{aligned} &amp;C_1=\frac{8B_LT_s}{3} \\ &amp;C_2=\frac{32(B_LT_s)^2}{9} \end{aligned} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 4.8234em; vertical-align: -2.1617em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.6617em;"><span class="" style="top: -4.7925em;"><span class="pstrut" style="height: 3.4911em;"></span><span class="mord"></span></span><span class="" style="top: -2.3154em;"><span class="pstrut" style="height: 3.4911em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.1617em;"><span class=""></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 2.6617em;"><span class="" style="top: -4.7925em;"><span class="pstrut" style="height: 3.4911em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span style="margin-right: 0.0715em;" class="mord mathnormal">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0715em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3603em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">3</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">8</span><span class="mord"><span style="margin-right: 0.0502em;" class="mord mathnormal">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: -0.0502em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span><span class="" style="top: -2.3154em;"><span class="pstrut" style="height: 3.4911em;"></span><span class="mord"><span class="mord"></span><span class="mord"><span style="margin-right: 0.0715em;" class="mord mathnormal">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0715em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.4911em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">9</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">32</span><span class="mopen">(</span><span class="mord"><span style="margin-right: 0.0502em;" class="mord mathnormal">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: -0.0502em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8141em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.686em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 2.1617em;"><span class=""></span></span></span></span></span></span></span></span></span></span></span></span>其中，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          B 
         
        
          L 
         
        
        
        
          T 
         
        
          s 
         
        
       
      
        B_LT_s 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.0502em;" class="mord mathnormal">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: -0.0502em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>为单边噪声带宽与采样周期的乘积，通常要求<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          B 
         
        
          L 
         
        
        
        
          T 
         
        
          s 
         
        
       
         ≪ 
        
       
         0.1 
        
       
      
        B_LT_s\ll0.1 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.0502em;" class="mord mathnormal">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3283em;"><span class="" style="top: -2.55em; margin-left: -0.0502em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">≪</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">0.1</span></span></span></span></span>。为了在FPGA中用移位运算代替乘除运算并简化设计，我们取<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          C 
         
        
          1 
         
        
       
         = 
        
        
        
          2 
         
         
         
           − 
          
         
           8 
          
         
        
       
         ， 
        
        
        
          C 
         
        
          2 
         
        
       
         = 
        
       
         0 
        
       
      
        C_1=2^{-8}，C_2=0 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.0715em;" class="mord mathnormal">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0715em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.9641em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8141em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">8</span></span></span></span></span></span></span></span></span><span class="mord cjk_fallback">，</span><span class="mord"><span style="margin-right: 0.0715em;" class="mord mathnormal">C</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3011em;"><span class="" style="top: -2.55em; margin-left: -0.0715em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">0</span></span></span></span></span>。<br>   下面给出定时误差检测和环路滤波器的Verilog代码。环路滤波器输出的误差信号量化为16bit定点数，其中包括1bit符号位和15bit的小数位。</p> 
<pre><code class="prism language-c">module ted_loop_filter #<span class="token punctuation">(</span>
    parameter SPS_2 <span class="token operator">=</span> <span class="token number">2</span>   <span class="token comment">// 上采样率（采样速率与数据速率之比）的一半，</span>
    <span class="token punctuation">)</span><span class="token punctuation">(</span>
    input resetn<span class="token punctuation">,</span>
    input clk<span class="token punctuation">,</span>
    input strobe<span class="token punctuation">,</span>
    input <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_in<span class="token punctuation">,</span>   <span class="token comment">//插值滤波器输出得插值数据</span>
    output <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_out<span class="token punctuation">,</span> <span class="token comment">//最佳采样时刻得插值数据，用于判决0、1</span>
    output <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> wk<span class="token punctuation">,</span>       <span class="token comment">//环路滤波器输出定时误差信号，15 bit小数位</span>
    output sync             <span class="token comment">//位同步信号</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
reg <span class="token punctuation">[</span><span class="token number">3</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> strobe_cnt<span class="token punctuation">;</span>
reg sk<span class="token punctuation">;</span>
always @<span class="token punctuation">(</span>posedge clk or negedge resetn<span class="token punctuation">)</span> begin
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>resetn<span class="token punctuation">)</span> begin
        strobe_cnt <span class="token operator">&lt;=</span> <span class="token number">4</span>'d0<span class="token punctuation">;</span>
        sk <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
    end
    <span class="token keyword">else</span> begin
        <span class="token keyword">if</span><span class="token punctuation">(</span>strobe<span class="token punctuation">)</span> begin
            strobe_cnt <span class="token operator">&lt;=</span> <span class="token punctuation">(</span>strobe_cnt <span class="token operator">&gt;=</span> SPS_2<span class="token operator">-</span><span class="token number">1</span><span class="token char">'b1)?4'</span>d0<span class="token operator">:</span><span class="token punctuation">(</span>strobe_cnt<span class="token operator">+</span><span class="token number">1</span>'b1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            sk <span class="token operator">&lt;=</span> <span class="token punctuation">(</span>strobe_cnt <span class="token operator">&gt;=</span> SPS_2<span class="token operator">-</span><span class="token number">1</span><span class="token char">'b1)?(1'</span>b1<span class="token punctuation">)</span><span class="token operator">:</span><span class="token number">1</span>'b0<span class="token punctuation">;</span>  <span class="token comment">// sk翻转周期位符号周期，作为位定时时钟输出</span>
        end
    end
end
assign sync <span class="token operator">=</span> sk<span class="token punctuation">;</span>
reg <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> din_1<span class="token punctuation">,</span>din_2<span class="token punctuation">,</span>din_3<span class="token punctuation">;</span>
reg <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> dout<span class="token punctuation">;</span>
reg <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> err<span class="token punctuation">,</span>err_1<span class="token punctuation">;</span>
reg <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> w<span class="token punctuation">;</span>
always @<span class="token punctuation">(</span>posedge clk or negedge resetn<span class="token punctuation">)</span> begin
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>resetn<span class="token punctuation">)</span> begin
        din_1 <span class="token operator">&lt;=</span> <span class="token number">18</span>'d0<span class="token punctuation">;</span>
        din_2 <span class="token operator">&lt;=</span> <span class="token number">18</span>'d0<span class="token punctuation">;</span>
        din_3 <span class="token operator">&lt;=</span> <span class="token number">18</span>'d0<span class="token punctuation">;</span>
        dout <span class="token operator">&lt;=</span> <span class="token number">18</span>'d0<span class="token punctuation">;</span>
        err <span class="token operator">&lt;=</span> <span class="token number">18</span>'d0<span class="token punctuation">;</span>
        err_1 <span class="token operator">&lt;=</span> <span class="token number">18</span>'d0<span class="token punctuation">;</span>
        w <span class="token operator">&lt;=</span> <span class="token number">16</span>'b0100000000000000<span class="token punctuation">;</span>
    end
    <span class="token keyword">else</span> begin
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>strobe_cnt<span class="token operator">==</span><span class="token number">0</span> <span class="token operator">||</span> strobe_cnt<span class="token operator">==</span>SPS_2<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> strobe<span class="token punctuation">)</span> begin
            din_1 <span class="token operator">&lt;=</span> data_in<span class="token punctuation">;</span>
            din_2 <span class="token operator">&lt;=</span> din_1<span class="token punctuation">;</span>
            din_3 <span class="token operator">&lt;=</span> din_2<span class="token punctuation">;</span>
            err <span class="token operator">&lt;=</span> <span class="token punctuation">(</span><span class="token operator">!</span>din_1<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> din_3<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">{<!-- --></span>din_2<span class="token punctuation">[</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span>'b0<span class="token punctuation">}</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">(</span>din_1<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>din_3<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token punctuation">{<!-- --></span>din_2<span class="token punctuation">[</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token char">'b0}):18'</span>d0<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>sk<span class="token punctuation">)</span> begin
                dout <span class="token operator">&lt;=</span> din_1<span class="token punctuation">;</span>
                err_1 <span class="token operator">&lt;=</span> err<span class="token punctuation">;</span>
                <span class="token comment">//w(ms+1)=w(ms)+c1*(err(ms)-err(ms-1))+c2*err(ms), c1 = 2^(-8)， c2≈0</span>
                w <span class="token operator">&lt;=</span> w<span class="token operator">+</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">6</span><span class="token punctuation">{<!-- --></span>err<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>err<span class="token punctuation">[</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token operator">-</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">6</span><span class="token punctuation">{<!-- --></span>err_1<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span>err_1<span class="token punctuation">[</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            end
        end
    end
end
assign wk <span class="token operator">=</span> w<span class="token punctuation">;</span>
assign data_out <span class="token operator">=</span> dout<span class="token punctuation">;</span>  
endmodule
</code></pre> 
<h4><a id="NCO_168"></a>数控振荡器(NCO)</h4> 
<p>  数控振荡器是一个相位递减器，它的差分方程为 <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          η 
         
        
          ( 
         
        
          m 
         
        
          + 
         
        
          1 
         
        
          ) 
         
        
          = 
         
        
          [ 
         
        
          η 
         
        
          ( 
         
        
          m 
         
        
          ) 
         
        
          − 
         
        
          w 
         
        
          ( 
         
        
          m 
         
        
          ) 
         
        
          ] 
         
        
          m 
         
        
          o 
         
        
          d 
         
        
          1 
         
        
       
         \eta(m+1)=[\eta(m)-w(m)]mod1 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.0359em;" class="mord mathnormal">η</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span style="margin-right: 0.0359em;" class="mord mathnormal">η</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.0269em;" class="mord mathnormal">w</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mclose">)]</span><span class="mord mathnormal">m</span><span class="mord mathnormal">o</span><span class="mord mathnormal">d</span><span class="mord">1</span></span></span></span></span></span> 其中<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         η 
        
       
         ( 
        
       
         m 
        
       
         + 
        
       
         1 
        
       
         ) 
        
       
      
        \eta(m+1) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.0359em;" class="mord mathnormal">η</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></span>是nco寄存器的值，<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         w 
        
       
         ( 
        
       
         m 
        
       
         ) 
        
       
      
        w(m) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.0269em;" class="mord mathnormal">w</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mclose">)</span></span></span></span></span>是环路滤波器输出的定时误差值。</p> 
<p><img src="https://images2.imgbox.com/30/96/Dpf9LKBx_o.png" alt="在这里插入图片描述">  nco的原理如上图所示。根据相似三角形的性质可以得出下式<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
           
           
             μ 
            
           
             k 
            
           
           
           
             T 
            
           
             s 
            
           
          
          
          
            η 
           
          
            ( 
           
           
           
             m 
            
           
             k 
            
           
          
            ) 
           
          
         
        
          = 
         
         
          
          
            ( 
           
          
            1 
           
          
            − 
           
           
           
             μ 
            
           
             k 
            
           
          
            ) 
           
           
           
             T 
            
           
             s 
            
           
          
          
          
            1 
           
          
            − 
           
          
            η 
           
          
            ( 
           
           
           
             m 
            
           
             k 
            
           
          
            + 
           
          
            1 
           
          
            ) 
           
          
         
        
       
         \frac{\mu_kT_s}{\eta(m_k)}=\frac{(1-\mu_k)T_s}{1-\eta(m_k+1)} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 2.2963em; vertical-align: -0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3603em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.0359em;" class="mord mathnormal">η</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.363em; vertical-align: -0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span style="margin-right: 0.0359em;" class="mord mathnormal">η</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span> 分数间隔为<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
          
           
            
            
              μ 
             
            
              k 
             
            
           
             = 
            
            
             
             
               η 
              
             
               ( 
              
              
              
                m 
               
              
                k 
               
              
             
               ) 
              
             
             
             
               1 
              
             
               − 
              
             
               η 
              
             
               ( 
              
              
              
                m 
               
              
                k 
               
              
             
               + 
              
             
               1 
              
             
               ) 
              
             
               + 
              
             
               η 
              
             
               ( 
              
              
              
                m 
               
              
                k 
               
              
             
               ) 
              
             
            
           
             = 
            
            
             
             
               η 
              
             
               ( 
              
              
              
                m 
               
              
                k 
               
              
             
               ) 
              
             
             
             
               w 
              
             
               ( 
              
              
              
                m 
               
              
                k 
               
              
             
               ) 
              
             
            
           
          
          
          
          
            (2) 
           
          
         
        
       
         \mu_k=\frac{\eta(m_k)}{1-\eta(m_k+1)+\eta(m_k)}=\frac{\eta(m_k)}{w(m_k)} \tag{2} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.363em; vertical-align: -0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord">1</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span><span style="margin-right: 0.0359em;" class="mord mathnormal">η</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span><span style="margin-right: 0.0359em;" class="mord mathnormal">η</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.0359em;" class="mord mathnormal">η</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.363em; vertical-align: -0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.427em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.0269em;" class="mord mathnormal">w</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.0359em;" class="mord mathnormal">η</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="tag"><span class="strut" style="height: 2.363em; vertical-align: -0.936em;"></span><span class="mord text"><span class="mord">(</span><span class="mord"><span class="mord">2</span></span><span class="mord">)</span></span></span></span></span></span></span><br>   当环路稳定时，nco每隔<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          T 
         
        
          s 
         
        
       
      
        T_s 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>时间就递减<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         w 
        
       
         ( 
        
       
         m 
        
       
         ) 
        
       
      
        w(m) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.0269em;" class="mord mathnormal">w</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mclose">)</span></span></span></span></span>，即平均nco每<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          1 
         
         
         
           w 
          
         
           ( 
          
         
           m 
          
         
           ) 
          
         
        
       
      
        \frac{1}{w(m)} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.3651em; vertical-align: -0.52em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.8451em;"><span class="" style="top: -2.655em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span style="margin-right: 0.0269em;" class="mord mathnormal mtight">w</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">m</span><span class="mclose mtight">)</span></span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.394em;"><span class="pstrut" style="height: 3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.52em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span>个时钟就下溢一次，那么插值周期与采样周期有近似关系<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           T 
          
         
           i 
          
         
        
          = 
         
         
          
          
            T 
           
          
            s 
           
          
          
          
            w 
           
          
            ( 
           
          
            m 
           
          
            ) 
           
          
         
        
       
         T_i=\frac{T_s}{w(m)} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 2.2963em; vertical-align: -0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.3603em;"><span class="" style="top: -2.314em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span style="margin-right: 0.0269em;" class="mord mathnormal">w</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mclose">)</span></span></span><span class="" style="top: -3.23em;"><span class="pstrut" style="height: 3em;"></span><span class="frac-line" style="border-bottom-width: 0.04em;"></span></span><span class="" style="top: -3.677em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.936em;"><span class=""></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></span>Gardner定时误差算法每个符号内有两个插值点参与运算，故<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         T 
        
       
         ≈ 
        
       
         2 
        
        
        
          T 
         
        
          i 
         
        
       
      
        T\approx2T_i 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord">2</span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3117em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>。Farrow插值滤波器每个插值需要4个采样点，故<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         T 
        
       
         ≈ 
        
       
         4 
        
        
        
          T 
         
        
          s 
         
        
       
      
        T\approx4T_s 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8333em; vertical-align: -0.15em;"></span><span class="mord">4</span><span class="mord"><span style="margin-right: 0.1389em;" class="mord mathnormal">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: -0.1389em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">s</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>。所以<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         w 
        
       
         ( 
        
       
         m 
        
       
         ) 
        
       
         ≈ 
        
       
         0.5 
        
       
      
        w(m)\approx0.5 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span style="margin-right: 0.0269em;" class="mord mathnormal">w</span><span class="mopen">(</span><span class="mord mathnormal">m</span><span class="mclose">)</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">0.5</span></span></span></span></span>。公式<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ( 
        
       
         2 
        
       
         ) 
        
       
      
        (2) 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord">2</span><span class="mclose">)</span></span></span></span></span>可以改写为<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           μ 
          
         
           k 
          
         
        
          ≈ 
         
        
          2 
         
        
          η 
         
        
          ( 
         
         
         
           m 
          
         
           k 
          
         
        
          ) 
         
        
       
         \mu_k\approx2\eta(m_k) 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6776em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">2</span><span style="margin-right: 0.0359em;" class="mord mathnormal">η</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></span>或者一阶修正公式<span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           μ 
          
         
           k 
          
         
        
          ≈ 
         
        
          2 
         
        
          η 
         
        
          ( 
         
         
         
           m 
          
         
           k 
          
         
        
          ) 
         
        
          [ 
         
        
          2 
         
        
          − 
         
        
          2 
         
        
          w 
         
        
          ( 
         
         
         
           m 
          
         
           k 
          
         
        
          − 
         
        
          1 
         
        
          ) 
         
        
          ] 
         
        
       
         \mu_k\approx2\eta(m_k)[2-2w(m_k-1)] 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6776em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal">μ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">≈</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">2</span><span style="margin-right: 0.0359em;" class="mord mathnormal">η</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mclose">)</span><span class="mopen">[</span><span class="mord">2</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">2</span><span style="margin-right: 0.0269em;" class="mord mathnormal">w</span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.3361em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span style="margin-right: 0.0315em;" class="mord mathnormal mtight">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)]</span></span></span></span></span></span><br>   下面给出定数控振荡器的Verilog代码。理论分析中的小数（分数）都采用16bit定点数量化。理论上，当nco寄存器的值下溢时进行一次插值。在FPGA中，插值是在不断进行的，但是只有nco寄存器的值下溢时获得的插值有用。</p> 
<pre><code class="prism language-c">module <span class="token function">nco</span><span class="token punctuation">(</span>
    input resetn<span class="token punctuation">,</span>
    input clk<span class="token punctuation">,</span>
    input <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> wk<span class="token punctuation">,</span>    <span class="token comment">//环路滤波器输出定时误差信号，15 bit小数位</span>
    output <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> uk<span class="token punctuation">,</span>   <span class="token comment">//NCO输出的插值间隔小数，15 bit小数位</span>
    output strobe       <span class="token comment">//NCO输出的插值计算选通信号，高电平有效</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
reg <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> nkt<span class="token punctuation">;</span>
reg <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">16</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> ut<span class="token punctuation">;</span>
reg str<span class="token punctuation">;</span>
always @<span class="token punctuation">(</span>posedge clk or negedge resetn<span class="token punctuation">)</span> begin
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>resetn<span class="token punctuation">)</span> begin
        nkt <span class="token operator">&lt;=</span> <span class="token number">17</span>'b00110000000000000<span class="token punctuation">;</span>   <span class="token comment">//0.75</span>
        ut <span class="token operator">&lt;=</span> <span class="token number">17</span>'b00100000000000000<span class="token punctuation">;</span>    <span class="token comment">//0.5</span>
        str <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
    end
    <span class="token keyword">else</span> begin
        <span class="token keyword">if</span><span class="token punctuation">(</span>nkt <span class="token operator">&lt;</span> <span class="token punctuation">{<!-- --></span>wk<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">,</span>wk<span class="token punctuation">}</span><span class="token punctuation">)</span> begin <span class="token comment">// 负值+1，相当于mod(1);</span>
            nkt <span class="token operator">&lt;=</span> <span class="token number">17</span>'b01000000000000000<span class="token operator">+</span>nkt<span class="token operator">-</span><span class="token punctuation">{<!-- --></span>wk<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">,</span>wk<span class="token punctuation">}</span><span class="token punctuation">;</span>
            ut <span class="token operator">&lt;=</span> <span class="token punctuation">{<!-- --></span>nkt<span class="token punctuation">[</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span>'b0<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">//取出nkt减去wk之前的值，乘以2作为u值输出</span>
            str <span class="token operator">&lt;=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> begin
            nkt <span class="token operator">&lt;=</span> nkt<span class="token operator">-</span><span class="token punctuation">{<!-- --></span>wk<span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">,</span>wk<span class="token punctuation">}</span><span class="token punctuation">;</span>
            str <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
        end
    end
end
assign uk <span class="token operator">=</span> ut<span class="token punctuation">;</span>
assign strobe <span class="token operator">=</span> str<span class="token punctuation">;</span>
endmodule
</code></pre> 
<h3><a id="_208"></a>定时同步顶层文件</h3> 
<p>  将前面几个模块整合起来，获得完整的定时同步模块。</p> 
<pre><code class="prism language-c"><span class="token punctuation">(</span><span class="token operator">*</span> dont_touch <span class="token operator">=</span> <span class="token string">"yes"</span> <span class="token operator">*</span><span class="token punctuation">)</span> module bit_sync #<span class="token punctuation">(</span>
    parameter SPS_2 <span class="token operator">=</span> <span class="token number">2</span>   <span class="token comment">// 上采样率（采样速率与数据速率之比）的一半，</span>
    <span class="token punctuation">)</span>
    <span class="token punctuation">(</span>
    input resetn<span class="token punctuation">,</span>
    input clk<span class="token punctuation">,</span>
    input <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_in<span class="token punctuation">,</span>  <span class="token comment">//采样数据</span>
    output data_out<span class="token punctuation">,</span>    <span class="token comment">//位同步后0、1bit</span>
    output sync         <span class="token comment">//位同步脉冲</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token operator">*</span> dont_touch <span class="token operator">=</span> <span class="token string">"yes"</span> <span class="token operator">*</span><span class="token punctuation">)</span> reg <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> din<span class="token punctuation">;</span>
always @<span class="token punctuation">(</span>posedge clk or negedge resetn<span class="token punctuation">)</span> begin
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>resetn<span class="token punctuation">)</span> begin
        din <span class="token operator">&lt;=</span> <span class="token number">15</span>'d0<span class="token punctuation">;</span>
    end
    <span class="token keyword">else</span> begin
        din <span class="token operator">&lt;=</span> data_in<span class="token punctuation">;</span>
    end
<span class="token function">end</span>
<span class="token punctuation">(</span><span class="token operator">*</span> dont_touch <span class="token operator">=</span> <span class="token string">"yes"</span> <span class="token operator">*</span><span class="token punctuation">)</span> wire <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> uk<span class="token punctuation">,</span>wk<span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token operator">*</span> dont_touch <span class="token operator">=</span> <span class="token string">"yes"</span> <span class="token operator">*</span><span class="token punctuation">)</span> wire <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_interpolate<span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token operator">*</span> dont_touch <span class="token operator">=</span> <span class="token string">"yes"</span> <span class="token operator">*</span><span class="token punctuation">)</span> wire strobe<span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token operator">*</span> dont_touch <span class="token operator">=</span> <span class="token string">"yes"</span> <span class="token operator">*</span><span class="token punctuation">)</span> wire <span class="token punctuation">[</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> dout<span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token operator">*</span> dont_touch <span class="token operator">=</span> <span class="token string">"yes"</span> <span class="token operator">*</span><span class="token punctuation">)</span> wire bit_sync<span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token operator">*</span> dont_touch <span class="token operator">=</span> <span class="token string">"yes"</span> <span class="token operator">*</span><span class="token punctuation">)</span> interpolate_filter <span class="token function">u1</span><span class="token punctuation">(</span>
    <span class="token punctuation">.</span><span class="token function">resetn</span><span class="token punctuation">(</span>resetn<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">data_in</span><span class="token punctuation">(</span>din<span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment">// 采样数据，采样频率同clk频率</span>
    <span class="token punctuation">.</span><span class="token function">uk</span><span class="token punctuation">(</span>uk<span class="token punctuation">)</span><span class="token punctuation">,</span>           <span class="token comment">//分数间隔</span>
    <span class="token punctuation">.</span><span class="token function">data_out</span><span class="token punctuation">(</span>data_interpolate<span class="token punctuation">)</span>      <span class="token comment">//插值滤波输出，输出速率同clk频率</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token operator">*</span> dont_touch <span class="token operator">=</span> <span class="token string">"yes"</span> <span class="token operator">*</span><span class="token punctuation">)</span> ted_loop_filter #<span class="token punctuation">(</span>
    <span class="token punctuation">.</span><span class="token function">SPS_2</span><span class="token punctuation">(</span>SPS_2<span class="token punctuation">)</span>   <span class="token comment">// 上采样率（采样速率与数据速率之比）的一半，</span>
    <span class="token punctuation">)</span>
    <span class="token function">u2</span> <span class="token punctuation">(</span>
    <span class="token punctuation">.</span><span class="token function">resetn</span><span class="token punctuation">(</span>resetn<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">strobe</span><span class="token punctuation">(</span>strobe<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">data_in</span><span class="token punctuation">(</span>data_interpolate<span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment">//插值滤波器输出得插值数据</span>
    <span class="token punctuation">.</span><span class="token function">data_out</span><span class="token punctuation">(</span>dout<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//最佳采样时刻得插值数据，用于判决0、1</span>
    <span class="token punctuation">.</span><span class="token function">wk</span><span class="token punctuation">(</span>wk<span class="token punctuation">)</span><span class="token punctuation">,</span>       <span class="token comment">//环路滤波器输出定时误差信号，15 bit小数位</span>
    <span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span>bit_sync<span class="token punctuation">)</span>      <span class="token comment">//位同步信号</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token operator">*</span> dont_touch <span class="token operator">=</span> <span class="token string">"yes"</span> <span class="token operator">*</span><span class="token punctuation">)</span> nco <span class="token function">u3</span><span class="token punctuation">(</span>
    <span class="token punctuation">.</span><span class="token function">resetn</span><span class="token punctuation">(</span>resetn<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">wk</span><span class="token punctuation">(</span>wk<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment">//环路滤波器输出定时误差信号，15 bit小数位</span>
    <span class="token punctuation">.</span><span class="token function">uk</span><span class="token punctuation">(</span>uk<span class="token punctuation">)</span><span class="token punctuation">,</span>   <span class="token comment">//NCO输出的插值间隔小数，15 bit小数位</span>
    <span class="token punctuation">.</span><span class="token function">strobe</span><span class="token punctuation">(</span>strobe<span class="token punctuation">)</span>       <span class="token comment">//NCO输出的插值计算选通信号，高电平有效</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token operator">*</span> dont_touch <span class="token operator">=</span> <span class="token string">"yes"</span> <span class="token operator">*</span><span class="token punctuation">)</span> reg bit_dout<span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token operator">*</span> dont_touch <span class="token operator">=</span> <span class="token string">"yes"</span> <span class="token operator">*</span><span class="token punctuation">)</span> reg bit_sync_1<span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token operator">*</span> dont_touch <span class="token operator">=</span> <span class="token string">"yes"</span> <span class="token operator">*</span><span class="token punctuation">)</span> reg bit_sync_2<span class="token punctuation">;</span>
always @<span class="token punctuation">(</span>posedge clk or negedge resetn<span class="token punctuation">)</span> begin
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>resetn<span class="token punctuation">)</span> begin
        bit_dout <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
        bit_sync_1 <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
        bit_sync_2 <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
    end
    <span class="token keyword">else</span> begin
        bit_sync_1 <span class="token operator">&lt;=</span> bit_sync<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>bit_sync <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token operator">!</span>bit_sync_1<span class="token punctuation">)</span><span class="token punctuation">)</span> begin
            bit_dout <span class="token operator">&lt;=</span> <span class="token operator">!</span>dout<span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            bit_sync_2 <span class="token operator">&lt;=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
        end
        <span class="token keyword">else</span> begin
            bit_dout <span class="token operator">&lt;=</span> bit_dout<span class="token punctuation">;</span>
            bit_sync_2 <span class="token operator">&lt;=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
        end
    end
end
assign data_out <span class="token operator">=</span> bit_dout<span class="token punctuation">;</span>
assign sync <span class="token operator">=</span> bit_sync_2<span class="token punctuation">;</span> <span class="token comment">//上升沿</span>
endmodule
</code></pre> 
<p>  我们要实现400MHz采样频率，同步100Mbps的OOK信号，而FPGA的外部晶振只有50MHz，所以还要再放一个PLL IP核将时钟倍频至400MHz。将PLL IP核和位同步模块封装在一起。</p> 
<pre><code class="prism language-c">module <span class="token function">test_top</span><span class="token punctuation">(</span>
    input resetn<span class="token punctuation">,</span>
    input clk<span class="token punctuation">,</span>       <span class="token comment">// 50MHz</span>
    input <span class="token keyword">signed</span> <span class="token punctuation">[</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_in<span class="token punctuation">,</span>  <span class="token comment">//采样数据</span>
    output clk400M<span class="token punctuation">,</span>
    output data_out<span class="token punctuation">,</span>    <span class="token comment">//位同步后0、1bit</span>
    output sync         <span class="token comment">//位同步脉冲</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
wire locked<span class="token punctuation">;</span>
clk_wiz_0 <span class="token function">u1</span>
   <span class="token punctuation">(</span>
    <span class="token comment">// Clock out ports</span>
    <span class="token punctuation">.</span><span class="token function">clk_out1</span><span class="token punctuation">(</span>clk400M<span class="token punctuation">)</span><span class="token punctuation">,</span>     <span class="token comment">// output clk_out1</span>
    <span class="token comment">// Status and control signals</span>
    <span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token operator">~</span>resetn<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// input reset</span>
    <span class="token punctuation">.</span><span class="token function">locked</span><span class="token punctuation">(</span>locked<span class="token punctuation">)</span><span class="token punctuation">,</span>       <span class="token comment">// output locked</span>
   <span class="token comment">// Clock in ports</span>
    <span class="token punctuation">.</span><span class="token function">clk_in1</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// input clk_in1</span>
bit_sync #<span class="token punctuation">(</span>
    <span class="token punctuation">.</span><span class="token function">SPS_2</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>   <span class="token comment">// 上采样率（采样速率与数据速率之比）的一半，</span>
    <span class="token punctuation">)</span>
    <span class="token function">u2</span> <span class="token punctuation">(</span>
    <span class="token punctuation">.</span><span class="token function">resetn</span><span class="token punctuation">(</span>resetn<span class="token operator">&amp;</span>locked<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk400M<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">data_in</span><span class="token punctuation">(</span>data_in<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">//采样数据</span>
    <span class="token punctuation">.</span><span class="token function">data_out</span><span class="token punctuation">(</span>data_out<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment">//位同步后0、1bit</span>
    <span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span>sync<span class="token punctuation">)</span>         <span class="token comment">//位同步脉冲</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>

endmodule
</code></pre> 
<h3><a id="_320"></a>时序仿真</h3> 
<p>  创建vivado工程，选择zynq7100芯片，分析，综合，编写testbench文件，然后进行综合后时序仿真。<br> testbench文件如下。adc_data.txt是用MATLAB生成的存放波形数据的文件，定时同步结果输出到bit_sync.txt用于计算误码率。</p> 
<pre><code class="prism language-c">module <span class="token function">tb_test_top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
parameter LEN <span class="token operator">=</span> <span class="token number">4915200</span><span class="token punctuation">;</span>
reg resetn<span class="token punctuation">;</span>
reg clk<span class="token punctuation">;</span>
reg <span class="token punctuation">[</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> data <span class="token punctuation">[</span>LEN<span class="token operator">-</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
reg <span class="token punctuation">[</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">]</span> data_in<span class="token punctuation">;</span>
wire clk400M<span class="token punctuation">;</span>
wire data_out<span class="token punctuation">;</span>
wire sync<span class="token punctuation">;</span>
integer k<span class="token punctuation">;</span>
integer file<span class="token punctuation">;</span>
initial begin
    resetn <span class="token operator">=</span> <span class="token number">1</span>'b0<span class="token punctuation">;</span>
    clk <span class="token operator">=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
    data_in <span class="token operator">&lt;=</span> <span class="token number">15</span>'d0<span class="token punctuation">;</span>
    k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    file <span class="token operator">=</span> $<span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"bit_sync.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    $<span class="token function">readmemh</span><span class="token punctuation">(</span><span class="token string">"adc_data.txt"</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    #<span class="token number">100</span>
    resetn <span class="token operator">=</span> <span class="token number">1</span>'b1<span class="token punctuation">;</span>
    #<span class="token number">1600</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> LEN<span class="token punctuation">;</span> k <span class="token operator">=</span> k<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> begin
        #<span class="token number">2.5</span> <span class="token comment">//400Mhz</span>
        data_in <span class="token operator">&lt;=</span> data<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">;</span>
    end
    #<span class="token number">2.5</span>
    data_in <span class="token operator">&lt;=</span> <span class="token number">15</span>'d0<span class="token punctuation">;</span>
    #<span class="token number">100</span> $finish<span class="token punctuation">;</span>
end
always #<span class="token number">10</span> clk <span class="token operator">=</span> <span class="token operator">~</span>clk<span class="token punctuation">;</span>  <span class="token comment">// 50Mhz</span>
always @<span class="token punctuation">(</span>posedge sync<span class="token punctuation">)</span>
	   $<span class="token function">fdisplay</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span><span class="token string">"%d"</span><span class="token punctuation">,</span>data_out<span class="token punctuation">)</span><span class="token punctuation">;</span>
test_top <span class="token function">u1</span> <span class="token punctuation">(</span>
    <span class="token punctuation">.</span><span class="token function">resetn</span><span class="token punctuation">(</span>resetn<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">clk</span><span class="token punctuation">(</span>clk<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">data_in</span><span class="token punctuation">(</span>data_in<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">//采样数据</span>
    <span class="token punctuation">.</span><span class="token function">clk400M</span><span class="token punctuation">(</span>clk400M<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">.</span><span class="token function">data_out</span><span class="token punctuation">(</span>data_out<span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token comment">//位同步后0、1bit</span>
    <span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span>sync<span class="token punctuation">)</span>         <span class="token comment">//位同步脉冲</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
endmodule
</code></pre> 
<p>  等一会儿，时序仿真很慢，然后能看到仿真波形。<br> <img src="https://images2.imgbox.com/5f/e5/MFq80HOj_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_368"></a>参考文献</h3> 
<div id="refer1"></div>[1] Gardner F M. Interpolation in Digital Modems-Part I: Fundamentals[J]. IEEE Trans. Commun, 1993, 41(3):501-507. 
<div id="refer2"></div>[2] Erup L, Gardner F M, Harris R A. Interpolation in digital modems-Part II : Implementation and performance[J]. IEEE Trans. Commun, 1993, 41(6):998 - 1008. 
<div id="refer3"></div>[3] Gardner F M. A BPSK/QPSK Timing-Error Detector for Sampled Receivers[J]. IEEE Trans. Commun, 1986, 34(5):423-429. 
<div id="refer4"></div>[4] 杜勇. 数字调制解调技术的MATLAB与FPGA实现[M]. 北京:电子工业出版社, 2014.
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bd007923c7731373d7a78a11e1318a32/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">a标签通过别人的接口,下载流文件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1fa469e5e1d66e7e8299826c9fca8c4c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">烟雾和火灾检测从零开始使用YOLOv5&#43;PyQt5&#43;OpenCV实现（支持图片、视频、摄像头实时检测）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>