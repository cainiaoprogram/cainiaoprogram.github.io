<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>uni-app_消息推送_华为厂商_unipush离线消息推送 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="uni-app_消息推送_华为厂商_unipush离线消息推送" />
<meta property="og:description" content="文章目录 一、创建项目二、生成签名证书三、开通 unipush 推送服务四、客户端集成四、制作自定义调试基座五、开发者中心后台Web页面推送（仅支持在线推送）六、离线消息推送1、创建华为开发者账号2、开通推送服务3、创建项目4、添加应用5、添加SHA256证书指纹6、开通推送服务7、Dcloud 平台厂商推送配置8、安装 app 到真机9、华为离线消息测试10、获取 Device Token 发送消息 一、创建项目 打开 Hbuilder 创建一个新项目 登录 DCloud 开发者中心，新建一个应用（注意： 上面第一步在 Hbuilder 创建新项目时，如果已经登录了 HBuilder 账号，那么下面这一步可以省略，HBuilder 会自动帮你创建好这个应用） 创建好应用应该之后，复制 Appid，打开 manifest.json，将 uni-app 应用标识(Appid) 替换成我们新创建应用的 Appid 二、生成签名证书 uni-app 安卓证书生成有两种方式，一种是去 DCloud 开发者中心生成证书（下面我们就采用这种方式），另一种是安装 jre 环境，生成证书（参考链接 ： https://ask.dcloud.net.cn/article/35777）
点击应用名称，
切换至【Android云端证书】，创建证书（生成证书一般需要 1-5 分钟时间） 证书生成之后，点击证书详情，复制 MD5、SHA1、SHA256 备用 切换至【各平台信息】，点击新增 将之前复制 MD5、SHA1、SHA256 填写进去，包名可以自己定义（eg: com.app.uniPush） 三、开通 unipush 推送服务 在【unipush】-【1.0(老版本)】-【应用信息】，选中我们上面创建的应用，我们这里只测试 Android 平台，所以勾选去掉 IOS，最后点击开通应用；
四、客户端集成 打开项目， 点击 manifest.json，选择【App模块配置】，否选【Push(消息推送)】，uniPush 消息推送图标，大家可自行配置； 获取 cid（ClientId：个推业务层中的对外用户标识，用于标识客户端身份，由第三方客户端获取并保存到第三方服务端，是个推 SDK 的唯一识别号，简称 CID）
在应用安装后第一次运行时应该调用 5&#43; API 的 plus." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/00a49d2c546ed1a3c02d28b17d6d2928/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-01T12:00:00+08:00" />
<meta property="article:modified_time" content="2023-10-01T12:00:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">uni-app_消息推送_华为厂商_unipush离线消息推送</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_2" rel="nofollow">一、创建项目</a></li><li><a href="#_15" rel="nofollow">二、生成签名证书</a></li><li><a href="#_unipush__36" rel="nofollow">三、开通 unipush 推送服务</a></li><li><a href="#_40" rel="nofollow">四、客户端集成</a></li><li><a href="#_55" rel="nofollow">四、制作自定义调试基座</a></li><li><a href="#Web_67" rel="nofollow">五、开发者中心后台Web页面推送（仅支持在线推送）</a></li><li><a href="#_78" rel="nofollow">六、离线消息推送</a></li><li><ul><li><a href="#1_82" rel="nofollow">1、创建华为开发者账号</a></li><li><a href="#2_86" rel="nofollow">2、开通推送服务</a></li><li><a href="#3_95" rel="nofollow">3、创建项目</a></li><li><a href="#4_98" rel="nofollow">4、添加应用</a></li><li><a href="#5SHA256_104" rel="nofollow">5、添加SHA256证书指纹</a></li><li><a href="#6_111" rel="nofollow">6、开通推送服务</a></li><li><a href="#7Dcloud__115" rel="nofollow">7、Dcloud 平台厂商推送配置</a></li><li><a href="#8_app__121" rel="nofollow">8、安装 app 到真机</a></li><li><a href="#9_125" rel="nofollow">9、华为离线消息测试</a></li><li><a href="#10_Device_Token__144" rel="nofollow">10、获取 Device Token 发送消息</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>一、创建项目</h2> 
<ul><li>打开 Hbuilder 创建一个新项目</li></ul> 
<p><img src="https://images2.imgbox.com/39/a6/NJVmjEpy_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<ul><li>登录 DCloud 开发者中心，新建一个应用（注意： 上面第一步在 Hbuilder 创建新项目时，如果已经登录了 HBuilder 账号，那么下面这一步可以省略，HBuilder 会自动帮你创建好这个应用）</li></ul> 
<p><img src="https://images2.imgbox.com/0d/76/f4NwfdCa_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<ul><li>创建好应用应该之后，复制 Appid，打开 manifest.json，将 uni-app 应用标识(Appid) 替换成我们新创建应用的 Appid</li></ul> 
<p><img src="https://images2.imgbox.com/7f/c8/Zk46mJTj_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"><br> <img src="https://images2.imgbox.com/cc/84/tnwnlVlq_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<h2><a id="_15"></a>二、生成签名证书</h2> 
<p>uni-app 安卓证书生成有两种方式，一种是去 DCloud 开发者中心生成证书（下面我们就采用这种方式），另一种是安装 jre 环境，生成证书（参考链接 ： <a href="https://ask.dcloud.net.cn/article/35777" rel="nofollow">https://ask.dcloud.net.cn/article/35777</a>）</p> 
<ul><li>点击应用名称，<br> <img src="https://images2.imgbox.com/a5/b2/rfvUCyar_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></li><li>切换至【Android云端证书】，创建证书（生成证书一般需要 1-5 分钟时间）</li></ul> 
<p><img src="https://images2.imgbox.com/9a/fa/k61Zpkxu_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<ul><li>证书生成之后，点击证书详情，复制 MD5、SHA1、SHA256 备用</li></ul> 
<p><img src="https://images2.imgbox.com/4c/e6/Q5JytFXw_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<ul><li>切换至【各平台信息】，点击新增</li></ul> 
<p><img src="https://images2.imgbox.com/a9/80/N0cDl3a2_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<ul><li>将之前复制 MD5、SHA1、SHA256 填写进去，包名可以自己定义（eg: com.app.uniPush）</li></ul> 
<p><img src="https://images2.imgbox.com/62/04/L591TVEE_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"><br> <img src="https://images2.imgbox.com/0a/25/AmmPvIOU_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<h2><a id="_unipush__36"></a>三、开通 unipush 推送服务</h2> 
<ul><li>在【unipush】-【1.0(老版本)】-【应用信息】，选中我们上面创建的应用，我们这里只测试 Android 平台，所以勾选去掉 IOS，最后点击开通应用；<br> <img src="https://images2.imgbox.com/a5/3d/YBFgQ5ZR_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></li></ul> 
<h2><a id="_40"></a>四、客户端集成</h2> 
<ul><li>打开项目， 点击 manifest.json，选择【App模块配置】，否选【Push(消息推送)】，uniPush 消息推送图标，大家可自行配置；</li></ul> 
<p><img src="https://images2.imgbox.com/62/be/zopZa3wg_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<ul><li> <p>获取 cid（ClientId：个推业务层中的对外用户标识，用于标识客户端身份，由第三方客户端获取并保存到第三方服务端，是个推 SDK 的唯一识别号，简称 CID）</p> </li><li> <p>在应用安装后第一次运行时应该调用 5+ API 的 plus.push.getClientInfoAsync 方法获取客户端标识。</p> </li><li> <p>如果获取的 cid 为空，说明客户端向推送服务器注册还未完成，可以使用 setTimeout 延时重试</p> </li></ul> 
<pre><code class="prism language-javascript">plus<span class="token punctuation">.</span>push<span class="token punctuation">.</span><span class="token function">getClientInfoAsync</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">info</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">let</span> cid <span class="token operator">=</span> info<span class="token punctuation">[</span><span class="token string">"clientid"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_55"></a>四、制作自定义调试基座</h2> 
<ul><li>打开项目， 点击 manifest.json，选择【App模块配置】，否选【Push(消息推送)】，uniPush 消息推送图标，大家可自行配置；</li></ul> 
<p><img src="https://images2.imgbox.com/68/a5/9iMhI2SQ_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<ul><li>【运行】-【运行到手机或模拟器】-【制作自定义调试基座】</li></ul> 
<p><img src="https://images2.imgbox.com/33/a3/dB0KlYY9_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<ul><li>打包需要的信息，都可通过 Dcloud 获取，可参考下的图<br> <img src="https://images2.imgbox.com/c0/db/XH1O35i2_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></li><li>【运行】-【运行到手机或模拟器】-【运行到Android App 基座】<br> <img src="https://images2.imgbox.com/4b/4a/EfKogA9N_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></li></ul> 
<h2><a id="Web_67"></a>五、开发者中心后台Web页面推送（仅支持在线推送）</h2> 
<ul><li>登录 DCloud 开发者中心，左侧选择【Uni Push】，打开消息推送页面，这里我们直接用 cid 向设备发送消息</li><li>需要打开真机，获取到真机上面的 cid（clientid）</li><li>当前消息推送仅支持在线推送，当 CID 在线（即 app 在前台打开运行）</li></ul> 
<p><img src="https://images2.imgbox.com/93/a5/Dii76BQu_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<ul><li>点击预览，输入cid，点击测试即可</li><li>注意：如果提示 cid 不存在或应用错误，CID不存在或不属于此应用，请仔细检查一下 Appid 是否正确，是否有自定义基座，如果之前有安装过相同的应用可以先卸载之前的，重新安装；</li></ul> 
<p><img src="https://images2.imgbox.com/ec/35/FgzJq3aZ_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<h2><a id="_78"></a>六、离线消息推送</h2> 
<ul><li>若需要支持主流 android 厂商客户端接收离线推送，需要完成 ：<a href="https://uniapp.dcloud.net.cn/unipush_vendor_config.html" rel="nofollow">android 多厂商配置</a>，下面以华为应用为例</li><li>配置好厂商参数后请一定要提交云打包，并且使用“自有证书”打签名包；将云打包后的安装包安装到手机上，再获取cid 进行离线厂商推送测试，不可使用基座方式获取的 cid 进行离线厂商推送测试</li></ul> 
<h3><a id="1_82"></a>1、创建华为开发者账号</h3> 
<ul><li>打开 <a href="https://developer.huawei.com/consumer/cn/" rel="nofollow">开发华为开发者联盟</a>，注册华为开发者帐号，帐号注册完后，需要完成实名认证才能享受华为开放的各类能力和服务</li></ul> 
<p><img src="https://images2.imgbox.com/b1/d1/D3DDjRiw_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<h3><a id="2_86"></a>2、开通推送服务</h3> 
<p><img src="https://images2.imgbox.com/6e/7b/nX18aHur_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<ul><li>确认开通后，还需要在【配置】开通精准推送服务</li></ul> 
<p><img src="https://images2.imgbox.com/fd/35/M2A8w9JV_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<h3><a id="3_95"></a>3、创建项目</h3> 
<p><img src="https://images2.imgbox.com/1f/e3/NjSrX5S2_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"><img src="https://images2.imgbox.com/3f/37/lularT4J_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<ul><li>是否开开通分享服务，可根据需求自行选择<img src="https://images2.imgbox.com/88/96/Dnm3iWBr_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></li></ul> 
<h3><a id="4_98"></a>4、添加应用</h3> 
<ul><li>在左侧导航栏选择【项目设置】，点击添加应用，将应用添加到我们新创建的项目中</li></ul> 
<p><img src="https://images2.imgbox.com/6e/f6/rnNAUKjG_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<p><img src="https://images2.imgbox.com/5e/af/Gvi0OKP7_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<h3><a id="5SHA256_104"></a>5、添加SHA256证书指纹</h3> 
<ul><li>打开 Dcloud，点击证书详情，从里面找到 SHA256 复制粘贴到下图处即可</li></ul> 
<p><img src="https://images2.imgbox.com/3b/5c/8l5eU2Dq_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<p><img src="https://images2.imgbox.com/68/73/VtYGjlYy_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<h3><a id="6_111"></a>6、开通推送服务</h3> 
<ul><li>切换到【API管理】，开通推送服务</li></ul> 
<p><img src="https://images2.imgbox.com/b5/96/3CkDpua4_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<h3><a id="7Dcloud__115"></a>7、Dcloud 平台厂商推送配置</h3> 
<ul><li>下载 agconnect-services.json 文件，将该文件中 json 数据粘贴到 Dcloud 厂商配置中，见下图。</li></ul> 
<p><img src="https://images2.imgbox.com/c1/34/W3TjoPmm_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<p><img src="https://images2.imgbox.com/6a/e2/wjQBrFxC_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<h3><a id="8_app__121"></a>8、安装 app 到真机</h3> 
<ul><li>【发行】-【原生App-云打包】详细流程参请考上面的【制作自定义调试基座】</li></ul> 
<h3><a id="9_125"></a>9、华为离线消息测试</h3> 
<p><img src="https://images2.imgbox.com/14/32/4KuC3LOC_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<p><img src="https://images2.imgbox.com/ff/68/SDjvKCLc_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></p> 
<p>-【 Android 配置】 - 【通知类型】 - initende 内容</p> 
<p>intent:#Intent;action=android.intent.action.oppopush;launchFlags=0x14000000;component=安卓包名/io.dcloud.PandoraEntry;S.UP-OL-SU=true;S.title=测试标题;S.content=测试内容;S.payload=test;end</p> 
<ul><li>华为离线时，收不到消息推送，若厂商信息确认配置无误，那么注意以下两个地方</li></ul> 
<ol><li> <p>核对 Android 应用签名SHA256 是否填写正确</p> </li><li> <p>华为推送信息乱写的时候，是可能不被推送的，可以按照以下格式发送排查下：</p> <p>title：订单提醒<br> body：您的外卖订单已接单，请耐心等候</p> </li></ol> 
<h3><a id="10_Device_Token__144"></a>10、获取 Device Token 发送消息</h3> 
<ul><li>华为端发送消息都是通过 token 进行推送，获取接收离线消息的设备 token</li><li>打开 Dcloud，【unipush】-【消息推送】-【配置管理】-【故障排查】- 【状态查询】- 输入设备的 cid 即可查询到对应的 Device Token<br> <img src="https://images2.imgbox.com/f1/9c/23W5vHjB_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"><br> <img src="https://images2.imgbox.com/5b/b1/G5d9BuXL_o.png" alt="uni-app_消息推送_华为厂商_unipush离线消息推送"></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4c31ecb1b5afedde707dbffe552e62b6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C&#43;&#43;实现集群聊天服务器</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4880383ff829eebc330eadebfe8b78c3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">时间序列预测之ARIMA模型</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>