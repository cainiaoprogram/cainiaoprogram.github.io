<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>简述集成微信支付 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="简述集成微信支付" />
<meta property="og:description" content="原文链接： http://blog.csdn.net/yidu_blog/article/details/51453496
1. 导入微信包
2.添加微信依赖的库
3.MRC的文件修改成ARC
方法：找到文件 -fno-objc-arc 添加这句话
要修改的有2个文件 一个是 pay..... 一个是 apiXml...
改好直接 command &#43; B 编译一下。 成功往下进行
4.在appdelegate里面引入头文件，和协议
#import &#34;payRequsestHandler.h&#34;
#import &lt;QuartzCore/QuartzCore.h&gt;
还有这两个
5. // 向微信注册 [WXApiregisterApp:APP_IDwithDescription:@&#34;demo 2.0&#34;];
添加方法
6.回调方法
- (BOOL)application:(UIApplication *)application openURL:(NSURL *)url sourceApplication:(NSString *)sourceApplication annotation:(id)annotation {
//weixin
NSUserDefaults *userDefaults = [[NSUserDefaultsalloc]init];
NSString *ispay = [userDefaultsobjectForKey:@&#34;ispaying&#34;];
if ([ispay isEqualToString:@&#34;weixinpay&#34;]) {
[userDefaults setObject:@&#34;&#34;forKey:@&#34;ispaying&#34;];
return [WXApihandleOpenURL:url delegate:self];
}
return YES;
}
7.支付结果回调
//微信支付结果回调
-(void) onResp:(BaseResp *)resp{" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/090a9be1b2ab23220dcb9b5dc933d370/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-05-19T15:24:54+08:00" />
<meta property="article:modified_time" content="2016-05-19T15:24:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">简述集成微信支付</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>原文链接： http://blog.csdn.net/yidu_blog/article/details/51453496</p> 
<p>1. 导入微信包</p> 
<p><img src="https://images2.imgbox.com/4d/d5/HfFhuA3M_o.png" alt=""><br> </p> 
<p>2.添加微信依赖的库</p> 
<p>3.MRC的文件修改成ARC</p> 
<p>方法：找到文件  -fno-objc-arc  添加这句话</p> 
<p>要修改的有2个文件   一个是 pay.....   一个是 apiXml...</p> 
<p>改好直接 command + B  编译一下。 成功往下进行</p> 
<p><br> </p> 
<p>4.在appdelegate里面引入头文件，和协议</p> 
<p><br> </p> 
<p><img src="https://images2.imgbox.com/d1/48/o2g19BT1_o.png" alt=""><br> </p> 
<p></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo; color:rgb(255,70,71)"> <span style="color:#eb905a">#import </span><span style="">"payRequsestHandler.h"</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo; color:rgb(255,70,71)"> <span style="color:#eb905a">#import </span><span style="">&lt;QuartzCore/QuartzCore.h&gt;</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo; color:rgb(255,70,71)"> 还有这两个</p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo; color:rgb(255,70,71)"> <br> </p> 5.  
<span style="color:rgb(75,209,87); font-size:18px; line-height:normal; font-family:Menlo">//</span> 
<span style="color:rgb(75,209,87); font-family:'PingFang SC'; font-size:18px">向微信注册</span> 
<p></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="color:rgb(255,255,255)">    </span><span style="color:#33ff33"><span style="">[</span><span style="">WXApi</span><span style=""></span><span style="">registerApp</span><span style="">:</span><span style="">APP_ID</span><span style=""></span><span style="">withDescription</span><span style="">:</span><span style="">@"demo 2.0"</span><span style="">];</span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="color:#33ff33">添加方法</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="color:#33ff33"><br> </span></p> 
<p style="margin-top:0px; margin-bottom:0px; line-height:normal; font-family:Menlo"> <span style="font-size:12px">6.回调方法</span></p> 
<p style="margin-top:0px; margin-bottom:0px; line-height:normal; font-family:Menlo"> <span style="font-size:12px"></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">- (</span><span style="">BOOL</span><span style="">)application:(</span><span style="">UIApplication</span><span style=""> *)application openURL:(</span><span style="">NSURL</span><span style=""> *)url sourceApplication:(</span><span style="">NSString</span><span style=""> *)sourceApplication annotation:(</span><span style="">id</span><span style="">)annotation {<!-- --></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo; min-height:21px"> <span style="">    </span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">    </span><span style="">//weixin</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">    </span><span style="">NSUserDefaults</span><span style=""> *userDefaults = [[</span><span style="">NSUserDefaults</span><span style=""></span><span style="">alloc</span><span style="">]</span><span style="">init</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">    </span><span style="">NSString</span><span style=""> *ispay = [userDefaults</span><span style="">objectForKey</span><span style="">:</span><span style="">@"ispaying"</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">    </span><span style="">if</span><span style=""> ([ispay </span> <span style="">isEqualToString</span><span style="">:</span><span style="">@"weixinpay"</span><span style="">]) {<!-- --></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        [userDefaults </span><span style="">setObject</span><span style="">:</span><span style="">@""</span><span style=""></span><span style="">forKey</span><span style="">:</span><span style="">@"ispaying"</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        </span><span style="">return</span><span style="">  [</span><span style="">WXApi</span><span style=""></span><span style="">handleOpenURL</span><span style="">:url </span><span style="">delegate</span><span style="">:</span><span style="">self</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">    }</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo; min-height:21px"> <span style="">    </span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">    </span><span style="">return</span><span style=""> </span><span style="">YES</span><span style="">;</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo; min-height:21px"> <span style="">    </span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">}</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style=""><br> </span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">7.支付结果回调</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style=""></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:'PingFang SC'; color:rgb(75,209,87)"> <span style="line-height:normal; font-family:Menlo">//</span><span style="">微信支付结果回调</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="color:#330033"><span style="">-(</span><span style="">void</span><span style="">) onResp:(</span><span style="">BaseResp</span><span style=""> *)resp{<!-- --></span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="color:#330033"><span style="">    </span><span style="">NSString</span><span style=""> *strMsg = [</span><span style="">NSString</span><span style=""></span><span style="">stringWithFormat</span><span style="">:</span><span style="">@"errcode:%d"</span><span style="">, resp.</span><span style="">errCode</span><span style="">];</span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="color:#330033"><span style="">    </span><span style="">NSString</span><span style=""> *strTitle;</span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo; min-height:21px"> <span style=""><span style="color:#330033">    </span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="color:#330033"><span style="">    </span><span style="">if</span><span style="">([resp</span><span style="">isKindOfClass</span><span style="">:[</span><span style="">SendMessageToWXResp</span><span style=""></span><span style="">class</span><span style="">]])</span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style=""><span style="color:#330033">    {<!-- --></span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="color:#330033"><span style="">        strTitle = [</span><span style="">NSString</span><span style=""></span><span style="">stringWithFormat</span><span style="">:</span><span style="">@"</span><span style="line-height:normal; font-family:'PingFang SC'">发送媒体消息结果</span><span style="">"</span><span style="">];</span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style=""><span style="color:#330033">    }</span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="color:#330033"><span style="">    </span><span style="">if</span><span style="">([resp</span><span style="">isKindOfClass</span><span style="">:[</span><span style="">PayResp</span><span style=""></span><span style="">class</span><span style="">]]){<!-- --></span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:'PingFang SC'"> <span style="color:#330033"><span style="line-height:normal; font-family:Menlo">       </span><span style="line-height:normal; font-family:Menlo">//</span><span style="">支付返回结果，实际支付结果需要去微信服务器端查询</span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="color:#330033"><span style="">        strTitle = [</span><span style="">NSString</span><span style=""></span><span style="">stringWithFormat</span><span style="">:</span><span style="">@"</span><span style="line-height:normal; font-family:'PingFang SC'">支付结果</span><span style="">"</span><span style="">];</span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo; min-height:21px"> <span style=""><span style="color:#330033">        </span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="color:#330033"><span style="">        </span><span style="">switch</span><span style=""> (resp.</span><span style="">errCode</span><span style="">) {<!-- --></span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="color:#330033"><span style="">            </span><span style="">case</span><span style=""></span><span style="">WXSuccess</span><span style="">:</span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="color:#330033"><span style="">                strMsg = </span><span style="">@"</span><span style="line-height:normal; font-family:'PingFang SC'">支付结果：成功！</span><span style="">"</span><span style="">;</span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="color:#330033"><span style="">                </span><span style="">NSLog</span><span style="">(</span><span style="">@"</span><span style="line-height:normal; font-family:'PingFang SC'">支付成功－</span><span style="">PaySuccess</span><span style="line-height:normal; font-family:'PingFang SC'">，</span><span style="">retcode = %d"</span><span style="">, resp.</span><span style="">errCode</span><span style="">);</span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="color:#330033"><span style="">                </span><span style="">break</span><span style="">;</span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo; min-height:21px"> <span style=""><span style="color:#330033">                </span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="color:#330033"><span style="">            </span><span style="">default</span><span style="">:</span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="color:#330033"><span style="">                strMsg = </span><span style="">@"</span><span style="line-height:normal; font-family:'PingFang SC'">支付结果：失败！</span><span style="">"</span><span style="">;</span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="color:#330033"><span style="">                </span><span style="">NSLog</span><span style="">(</span><span style="">@"</span><span style="line-height:normal; font-family:'PingFang SC'">错误，</span><span style="">retcode = %d, retstr = %@"</span><span style="">, resp.</span><span style="">errCode</span><span style="">,resp.</span><span style="">errStr</span><span style="">);</span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="color:#330033"><span style="">                </span><span style="">break</span><span style="">;</span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style=""><span style="color:#330033">        }</span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style=""><span style="color:#330033">    }</span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="color:#330033"><span style="">    </span><span style="">UIAlertView</span><span style=""> *alert = [[</span><span style="">UIAlertView</span><span style=""></span><span style="">alloc</span><span style="">] </span><span style="">initWithTitle</span><span style="">:strTitle</span><span style="">message</span><span style="">:strMsg </span><span style="">delegate</span><span style="">:</span><span style="">self</span><span style=""></span><span style="">cancelButtonTitle</span><span style="">:</span><span style="">@"OK"</span><span style=""></span><span style="">otherButtonTitles</span><span style="">:</span><span style="">nil</span><span style="">,</span><span style="">nil</span><span style="">];</span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="color:#330033"><span style="">    [alert </span><span style="">show</span><span style="">];</span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style=""><span style="color:#330033">}</span></span></p> 
<br> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style=""><br> </span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">8。接下来设置<span style="font-family:Menlo; font-size:18px">回调URL </span>schemes   这个大家应该都会设置  不会的参考上一篇支付宝篇</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style=""><br> </span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">9.支付方法</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="background-color:rgb(0,0,0)"><span style="color:#333333"></span></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">#pragma mark --------------- </span><span style="line-height:normal; font-family:'PingFang SC'">微信支付</span><span style=""> ---------------</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">-(</span><span style="">void</span><span style="">)payByWechatWithConut:(</span><span style="">NSInteger</span><span style="">)conut Message:(</span><span style="">NSString</span><span style=""> *)message{<!-- --></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">    </span><span style="">payRequsestHandler</span><span style=""> *req = [</span><span style="">payRequsestHandler</span><span style=""></span><span style="">alloc</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">    [req </span><span style="">init</span><span style="">:</span><span style="">APP_ID</span><span style=""></span><span style="">mch_id</span><span style="">:</span><span style="">MCH_ID</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">    [req </span><span style="">setKey</span><span style="">:</span><span style="">PARTNER_ID</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo; min-height:21px"> <span style="">    </span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">    </span><span style="">NSMutableDictionary</span><span style=""> *dict = [req</span><span style="">sendPay_demoWithPrice</span><span style="">:[</span><span style="">NSString</span><span style=""></span><span style="">stringWithFormat</span><span style="">:</span><span style="">@"%ld"</span><span style="">, (</span><span style="">long</span><span style="">)conut]</span><span style="">andName</span><span style="">:message];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">    </span><span style="">NSLog</span><span style="">(</span><span style="">@"-------dict--%@"</span><span style="">,dict);</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">    </span><span style="">if</span><span style="">(dict == </span> <span style="">nil</span><span style="">){<!-- --></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        </span><span style="">NSString</span><span style=""> *debug = [req</span><span style="">getDebugifo</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">    }</span><span style="">else</span><span style="">{<!-- --></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        </span><span style="">NSMutableString</span><span style=""> *stamp  = [dict</span><span style="">objectForKey</span><span style="">:</span><span style="">@"timestamp"</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        </span><span style="">PayReq</span><span style="">* req             = [[</span><span style="">PayReq</span><span style=""></span><span style="">alloc</span><span style="">] </span><span style="">init</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        req.</span><span style="">openID</span><span style="">              = [dict</span><span style="">objectForKey</span><span style="">:</span><span style="">@"appid"</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        req.</span><span style="">partnerId</span><span style="">           = [dict</span><span style="">objectForKey</span><span style="">:</span><span style="">@"partnerid"</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        req.</span><span style="">prepayId</span><span style="">            = [dict</span><span style="">objectForKey</span><span style="">:</span><span style="">@"prepayid"</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        req.</span><span style="">nonceStr</span><span style="">            = [dict</span><span style="">objectForKey</span><span style="">:</span><span style="">@"noncestr"</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        req.</span><span style="">timeStamp</span><span style="">           = stamp.</span><span style="">intValue</span><span style="">;</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        req.</span><span style="">package</span><span style="">             = [dict</span><span style="">objectForKey</span><span style="">:</span><span style="">@"package"</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        req.</span><span style="">sign</span><span style="">                = [dict</span><span style="">objectForKey</span><span style="">:</span><span style="">@"sign"</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        [</span><span style="">WXApi</span><span style=""> </span> <span style="">sendReq</span><span style="">:req];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">    }</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">    </span><span style="">NSUserDefaults</span><span style=""> *userDefaults = [[</span><span style="">NSUserDefaults</span><span style=""></span><span style="">alloc</span><span style="">]</span><span style="">init</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">    [userDefaults </span><span style="">setObject</span><span style="">:</span><span style="">@"weixinpay"</span><span style=""></span><span style="">forKey</span><span style="">:</span><span style="">@"ispaying"</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">}</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">//</span><span style="line-height:normal; font-family:'PingFang SC'">微信的信息回调</span><span style=""> ----</span><span style="line-height:normal; font-family:'PingFang SC'">支付结果回调在</span><span style="">appdelegate</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">-(</span><span style="">void</span><span style="">) onReq:(</span><span style="">BaseReq</span><span style=""> *)req{<!-- --></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">    </span><span style="">if</span><span style="">([req </span><span style="">isKindOfClass</span><span style="">:[</span><span style="">GetMessageFromWXReq</span><span style=""></span><span style="">class</span><span style="">]]){<!-- --></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        </span><span style="">NSString</span><span style=""> *strTitle = [</span><span style="">NSString</span><span style=""></span><span style="">stringWithFormat</span><span style="">:</span><span style="">@"</span><span style="line-height:normal; font-family:'PingFang SC'">微信请求</span><span style="">App</span><span style="line-height:normal; font-family:'PingFang SC'">提供内容</span><span style="">"</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        </span><span style="">NSString</span><span style=""> *strMsg =</span><span style="">@"</span><span style="line-height:normal; font-family:'PingFang SC'">微信请求</span><span style="">App</span><span style="line-height:normal; font-family:'PingFang SC'">提供内容，</span><span style="">App</span><span style="line-height:normal; font-family:'PingFang SC'">要调用</span><span style="">sendResp:GetMessageFromWXResp</span><span style="line-height:normal; font-family:'PingFang SC'">返回给微信</span><span style="">"</span><span style="">;</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        </span><span style="">UIAlertView</span><span style=""> *alert = [[</span><span style="">UIAlertView</span><span style=""></span><span style="">alloc</span><span style="">] </span><span style="">initWithTitle</span><span style="">:strTitle</span><span style="">message</span><span style="">:strMsg </span><span style="">delegate</span><span style="">:</span><span style="">self</span><span style=""></span><span style="">cancelButtonTitle</span><span style="">:</span><span style="">@"OK"</span><span style=""></span><span style="">otherButtonTitles</span><span style="">:</span><span style="">nil</span><span style="">,</span><span style="">nil</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        alert.</span><span style="">tag</span><span style=""> = </span> <span style="">1000</span><span style="">;</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        [alert </span><span style="">show</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">    }</span><span style="">else</span><span style=""> </span><span style="">if</span><span style="">([req</span><span style="">isKindOfClass</span><span style="">:[</span><span style="">ShowMessageFromWXReq</span><span style=""></span><span style="">class</span><span style="">]]){<!-- --></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        </span><span style="">ShowMessageFromWXReq</span><span style="">* temp = (</span><span style="">ShowMessageFromWXReq</span><span style="">*)req;</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        </span><span style="">WXMediaMessage</span><span style=""> *msg = temp.</span><span style="">message</span><span style="">;</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        </span><span style="">WXAppExtendObject</span><span style=""> *obj = msg.</span><span style="">mediaObject</span><span style="">;</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        </span><span style="">NSString</span><span style=""> *strTitle = [</span><span style="">NSString</span><span style=""></span><span style="">stringWithFormat</span><span style="">:</span><span style="">@"</span><span style="line-height:normal; font-family:'PingFang SC'">微信请求</span><span style="">App</span><span style="line-height:normal; font-family:'PingFang SC'">显示内容</span><span style="">"</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        </span><span style="">NSString</span><span style=""> *strMsg = [</span><span style="">NSString</span><span style=""></span><span style="">stringWithFormat</span><span style="">:</span><span style="">@"</span><span style="line-height:normal; font-family:'PingFang SC'">标题：</span><span style="">%@ \n</span><span style="line-height:normal; font-family:'PingFang SC'">内容：</span><span style="">%@ \n</span><span style="line-height:normal; font-family:'PingFang SC'">附带信息：</span><span style="">%@ \n</span><span style="line-height:normal; font-family:'PingFang SC'">缩略图</span><span style="">:%lu bytes\n\n"</span><span style="">, msg.</span><span style="">title</span><span style="">, msg.</span><span style="">description</span><span style="">, obj.</span><span style="">extInfo</span><span style="">, (</span><span style="">unsigned</span><span style=""></span><span style="">long</span><span style="">)msg.</span><span style="">thumbData</span><span style="">.</span><span style="">length</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        </span><span style="">UIAlertView</span><span style=""> *alert = [[</span><span style="">UIAlertView</span><span style=""></span><span style="">alloc</span><span style="">] </span><span style="">initWithTitle</span><span style="">:strTitle</span><span style="">message</span><span style="">:strMsg </span><span style="">delegate</span><span style="">:</span><span style="">self</span><span style=""></span><span style="">cancelButtonTitle</span><span style="">:</span><span style="">@"OK"</span><span style=""></span><span style="">otherButtonTitles</span><span style="">:</span><span style="">nil</span><span style="">,</span><span style="">nil</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        [alert </span><span style="">show</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">    }</span><span style="">else</span><span style=""> </span><span style="">if</span><span style="">([req</span><span style="">isKindOfClass</span><span style="">:[</span><span style="">LaunchFromWXReq</span><span style=""></span><span style="">class</span><span style="">]]){<!-- --></span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        </span><span style="">NSString</span><span style=""> *strTitle = [</span><span style="">NSString</span><span style=""></span><span style="">stringWithFormat</span><span style="">:</span><span style="">@"</span><span style="line-height:normal; font-family:'PingFang SC'">从微信启动</span><span style="">"</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        </span><span style="">NSString</span><span style=""> *strMsg =</span><span style="">@"</span><span style="line-height:normal; font-family:'PingFang SC'">这是从微信启动的消息</span><span style="">"</span><span style="">;</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        </span><span style="">UIAlertView</span><span style=""> *alert = [[</span><span style="">UIAlertView</span><span style=""></span><span style="">alloc</span><span style="">] </span><span style="">initWithTitle</span><span style="">:strTitle</span><span style="">message</span><span style="">:strMsg </span><span style="">delegate</span><span style="">:</span><span style="">self</span><span style=""></span><span style="">cancelButtonTitle</span><span style="">:</span><span style="">@"OK"</span><span style=""></span><span style="">otherButtonTitles</span><span style="">:</span><span style="">nil</span><span style="">,</span><span style="">nil</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">        [alert </span><span style="">show</span><span style="">];</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">    }</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> <span style="">}</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> 我在原方法上添加了一点修改。 直接复制就OK   记得导头文件</p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> </p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo; color:rgb(75,209,87)"> <span style="">//wepay</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo; color:rgb(255,70,71)"> <span style="color:#eb905a">#import </span><span style="">"payRequsestHandler.h"</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo; color:rgb(255,70,71)"> <span style="color:#eb905a">#import </span><span style="">&lt;QuartzCore/QuartzCore.h&gt;</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo; color:rgb(255,70,71)"> <span style="color:#eb905a">#import </span><span style="">"WXUtil.h"</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo; color:rgb(255,70,71)"> <span style="color:#eb905a">#import </span><span style="">"ApiXml.h"</span></p> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo; color:rgb(255,70,71)"> <span style="color:#eb905a">#import </span><span style="">"WXApi.h"</span></p> 
<br> 
<p style="margin-top:0px; margin-bottom:0px; font-size:18px; line-height:normal; font-family:Menlo"> 10.到这里就结束了 !!</p> 
<br>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b28f5e4a9268309720f26faa6065fc31/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">[Err] 1093 - You can&#39;t specify target table &#39;s&#39; for update in FROM clause</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/93a79c8f18ff714f69edf35edd59b8c8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">设置 datetimepicker 只选择日期 不选择时分秒</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>