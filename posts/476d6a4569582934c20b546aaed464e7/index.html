<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MTKlog分析总结 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MTKlog分析总结" />
<meta property="og:description" content="博客：http://www.cnblogs.com/xiyuan2016/p/6740521.html ----------------------------------------------------------------------------------------------------------------- ZZ_INTERNAL 相关信息及解释 ANR,2173,-1361051648,99,/data/core/,1,system_app_anr,android.process.media,Tue Jul 4 18:51:03 HKT 2017,1 ZZ_INEERNAL包含10列，每列之间用,隔开 第一列：exception class，有KE/NE/JE/EE等 第二列：pid 第三列：tid 第四列：固定是99 第五列：固定是/data/core 第六列：exception level，0: fatal, 1: exception, 2: warning, 3: reminding 第七列：exception type info string； 如果是NE，则这个栏位是signal名称，比如：SIGSEGV， KE则为空， SWT则为：system_server_watchdog，等等。 第八列：module name or process name 第九列：UTC time 第十列：固定是1 ---------------------------------------------------------------------------------------------------------------------- ---------------------------------------------------------------------------------------------------------------------- trace部分信息解析 ----- pid 2173 at 2017-07-04 11:51:32 ----- Cmd line: android.process.media &#34;main&#34; prio=5 tid=1 Native &#34;Binder:2173_1&#34; prio=5 tid=9 Blocked | group=&#34;main&#34; sCount=1 dsCount=0 obj=0x22c05430 self=0xa1fcab00 | sysTid=2186 nice=10 cgrp=bg_non_interactive sched=0/0 handle=0xa497a920 | state=S schedstat=( 26942858 122825452 281 ) utm=0 stm=2 core=0 HZ=100 | stack=0xa487e000-0xa4880000 stackSize=1014KB | held mutexes= at com." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/476d6a4569582934c20b546aaed464e7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-08-14T11:20:53+08:00" />
<meta property="article:modified_time" content="2017-08-14T11:20:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MTKlog分析总结</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    博客：http://www.cnblogs.com/xiyuan2016/p/6740521.html 
<br> ----------------------------------------------------------------------------------------------------------------- 
<br> ZZ_INTERNAL  相关信息及解释 
<br> 
<br> 
<br> ANR,2173,-1361051648,99,/data/core/,1,system_app_anr,android.process.media,Tue Jul  4 18:51:03 HKT 2017,1  
<br> 
<br> 
<br> 
<br> 
<br> ZZ_INEERNAL包含10列，每列之间用,隔开 
<br> 
<br> 
<br> 第一列：exception class，有KE/NE/JE/EE等 
<br> 第二列：pid 
<br> 第三列：tid 
<br> 第四列：固定是99 
<br> 第五列：固定是/data/core 
<br> 第六列：exception level，0: fatal, 1: exception, 2: warning, 3: reminding 
<br> 第七列：exception type info string； 
<br> 
<br> 
<br>            如果是NE，则这个栏位是signal名称，比如：SIGSEGV， 
<br> 
<br> 
<br>            KE则为空， 
<br> 
<br> 
<br>            SWT则为：system_server_watchdog，等等。 
<br> 
<br> 
<br> 第八列：module name or process name 
<br> 第九列：UTC time 
<br> 第十列：固定是1 
<br> ---------------------------------------------------------------------------------------------------------------------- 
<br> 
<br> 
<br> 
<br> 
<br> ---------------------------------------------------------------------------------------------------------------------- 
<br> trace部分信息解析 
<br> 
<br> 
<br> ----- pid 2173 at 2017-07-04 11:51:32 ----- 
<br> Cmd line: android.process.media 
<br> "main" prio=5 tid=1 Native 
<br> "Binder:2173_1" prio=5 tid=9 Blocked 
<br>   | group="main" sCount=1 dsCount=0 obj=0x22c05430 self=0xa1fcab00 
<br>   | sysTid=2186 nice=10 cgrp=bg_non_interactive sched=0/0 handle=0xa497a920 
<br>   | state=S schedstat=( 26942858 122825452 281 ) utm=0 stm=2 core=0 HZ=100 
<br>   | stack=0xa487e000-0xa4880000 stackSize=1014KB 
<br>   | held mutexes= 
<br>   at com.android.providers.media.MediaProvider.getParent(MediaProvider.java:4118) 
<br>   - waiting to lock &lt;0x06de4cd2&gt; (a java.util.HashMap) held by thread 13 
<br>   at com.android.providers.media.MediaProvider.insertFile(MediaProvider.java:4395) 
<br>   at com.android.providers.media.MediaProvider.insertInternal(MediaProvider.java:4662) 
<br>   at com.android.providers.media.MediaProvider.insert(MediaProvider.java:4015) 
<br>   at android.content.ContentProvider$Transport.insert(ContentProvider.java:272) 
<br>   at android.content.ContentProviderNative.onTransact(ContentProviderNative.java:163) 
<br>   at android.os.Binder.execTransact(Binder.java:570) 
<br>    
<br>    
<br>    
<br> 1)pid 2173 at 2017-07-04 11:51:32   
<br>   &gt;&gt;&gt;&gt;ANR发生的进程的ID，时间点 
<br> 
<br> 
<br> 2)Cmd line: android.process.media   
<br>   &gt;&gt;&gt;&gt;ANR发生的进程的名称 
<br> 
<br> 
<br> 3)"main" prio=5 tid=1 Native  
<br>   &gt;&gt;&gt;&gt;说明线程名，线程的优先级，线程锁ID和线程状态. 
<br>   线程名称是启动线程的时候手动指明的，这里的main标示是主线程， 
<br>   是Android自动设定的一个线程名称，如果是自己手动创建的线程， 
<br>   一般会被命名成“Thread-xx”的格式，启动xx是线程ID，他只增不减 
<br>   不会被复用;注意这启动的tid不是线程的id，他是一个在Java虚拟机 
<br>   中用来实现线程锁的变量，随着线程的增减，这个变量的值是可能被 
<br>   复用的； 
<br>                                                                              
<br> 4)group="main" sCount=1 dsCount=0 obj=0x22c05430 self=0xa1fcab00 
<br>   &gt;&gt;&gt;&gt;group是线程组名称。 
<br>   sCount是此线程被挂起的次数， 
<br>   dsCount是线程被调试器挂起的次数。 
<br>   当一个进程被调试后，sCount会重置为，调试完毕后sCount会根据是否 
<br>   被正常挂起增长，但是dsCount不会被重置为0，所以dsCount也可以用来 
<br>   判断这个线程是否被调试过，obj表示这个线程的Java对象地址，self表 
<br>   示这个线程本身的地址。 
<br> 
<br> 
<br> 5)此后是线程的调度信息 
<br> | sysTid=2186 nice=10 cgrp=bg_non_interactive sched=0/0 handle=0xa497a920 
<br>   sysTid是Linux下的内核线程ID， 
<br>   nice是线程调度的优先级. 
<br>   sched分别标志了线程的调度策略和优先级， 
<br>   cgrp是调度属组， 
<br>   handle是线程的处理函数地址。 
<br>    
<br> 6)线程当前上下文信息 
<br>  | state=S schedstat=( 26942858 122825452 281 ) utm=0 stm=2 core=0 HZ=100 
<br>   state是调度状态; 
<br>   schedstat从 /proc/[pid]/task/[tid]/schedstat读出 
<br>   三个值分别表示线程在cpu上执行的时间、线程的等待时间和线程执行的时间片长度; 
<br>   有的android内核版本不支持这项信息，得到的三个值都是0；utm是线程用户态下使 
<br>   用的时间值(单位是jiffies);stm是内核态下的调度时间值;core是最后执行这个线程 
<br>   cpu核的序号 
<br> 
<br> 
<br> 7)最后就是这个线程的调度栈信息。 
<br>   一般可以通过以下几个简单的方法来判断 
<br>   *trace文件顶部的线程一般是ANR的元凶。 
<br>   *这是一个简单的方法，大部分情况下都适用，可以通过这个方法来快速判断是否是自己 
<br>    的应用造成了本次的ANR，但是并不是trace文件包含的应用就一定是造成ANR的帮凶，应 
<br>    用出现在trace文件中，只能说明出现ANR的时候这个应用进程还活着，trace文件的顶部 
<br>    则是触发ANR的应用信息，因此如果你的应用出现在trace文件的顶部，那么很有可能是 
<br>    因为你的应用造成了ANR,否则是你的应用造成ANR的可能性不大，还需要进一步分析。 
<br>     
<br> 8)如果定位不到时间点，可以看CPU  
<br>   (sys_log)07-04 18:51:03.209156  1044  1068 E ANRManager: 3.4% TOTAL: 0.5% user 
<br>      + 2.6% kernel + 0.2% irq  
<br>    从CPU使用率可以看出： 
<br>    *如果使用量很高，说明当前设备很忙(内存不足，循环处理) 
<br>    *如果CPU使用量很少，说明主线程被BLOCK了 
<br>    *如果IOwait很高，说明ANR有可能是主线程在进行I/O操作造成的(数据库、文件操作、 
<br>     网络操作等)       
<br>    
<br> 9)等待锁引起的ANR 
<br>   找到WallpaperManager对应代码，再结合main log等其他信息，看tid=27的thread在忙 
<br>   什么。 
<br>    
<br> 10)SWT重启问题分析 
<br>   SWT是指Android Watchdog Timeout，应用层看门狗超时，通常我们说的WDT是HWT，硬件 
<br>   看门狗超时。 
<br>   1.Watchdog的目的是监控系统几个比较主要的service，比如NetworkManagementService， 
<br>   PowerManagerService，ActivityManagerService等。这些Service在启动时通过调用 
<br>   Watchdog。getInstance().addMonitor(this);加入到Watchdog的监控列表中，如果超过 
<br>   一定时间没有反应，认为系统出错，会强制启动Android。 
<br>   2.Watchdog原理：/framework/base/services/java/com/android/server/Watchdog.java 
<br>   3.具体分析方法 
<br>     *首先从enventlog中以watchdog为关键字搜索，记录下这个时刻 
<br>       17:25:23.645459 950 1285 I watchdog:surfaceflinger hang. 
<br>     *然后分析所有Service Object的monitor()为何在这个时刻之前1分钟没有做完， 
<br>     *后面具体分析方法和ANR一样 
<br>     *ANR是某个AP的主线程在一段时间内没有完成某件事情， 
<br>     *Android Watchdog 是SystemServer进程的ServerThread 线程在一段时间内没有做完 
<br>      某件事情。                 
<br> 
<br> 
<br>    
<br> ---------------------------------------------------------------------------------------------------------------------- 
<br> ---------------------------------------------------------------------------------------------------------------------- 
<br> radio_log分析网络状况 
<br> 
<br> 
<br> 06-30 10:38:06.572525 938 976 I AT : AT&lt; +ECSQ: 22,54,1,1,1,-36,-346,7,39 (RIL_URC_READER, tid:0) 
<br> 06-30 10:38:06.572737 938 976 I RILC : RIL_SOCKET_1 UNSOLICITED: UNSOL_SIGNAL_STRENGTH length:72 
<br> 06-30 10:38:06.573125 938 998 I RIL : [GSM MAL] URC send success, rid 0, ret 0:                                             #F5F6FA 
<br> 06-30 10:38:06.573125 938 998 I RIL : +ECSQ: 22,54,1,1,1,-36,-346,7,39 
<br> 06-30 10:38:06.574384 1028 1067 D RilMalClient: UNSOL_TO_MAL: remap to unsol resp(1009) 
<br> 06-30 10:38:06.575465 1028 1067 D RpRilClientController: leave blocking write 
<br> 06-30 10:38:06.575605 1028 1067 D RpRilClientController: leave blocking write 
<br> 06-30 10:38:06.576133 1425 1425 D SST : [GsmSST0] handle EVENT_SIGNAL_STRENGTH_UPDATE 
<br> 06-30 10:38:06.576410 1425 1425 W SignalStrength: Signal before validate=SignalStrength: 0 54 -1 -1 -1 -1 -1 99 86 9 97 2147483647 2147483647 gsm|lte 2147483647 2147483647 2147483647 
<br> 06-30 10:38:06.576526 1425 1425 W SignalStrength: Signal after validate=SignalStrength: 0 54 -120 -160 -120 -1 -1 99 -86 -9 97 2147483647 2147483647 gsm|lte 2147483647 2147483647 2147483647 
<br> 06-30 10:38:06.577794 1010 1367 D TelephonyRegistry: notifySignalStrengthForPhoneId: callback.onSsS r={callingPackage=android binder=android.telephony.PhoneStateListener$IPhoneStateListenerStub@d4b4edc callback=android.telephony.PhoneStateListener$IPhoneStateListenerStub@d4b4edc onSubscriptionsChangedListenererCallback=null callerUserId=0 subId=2147483647 phoneId=-1 events=1c1 canReadPhoneState=true} subId=3 phoneId=0 ss=SignalStrength: 0 54 -120 -160 -120 -1 -1 99 -86 -9 97 2147483647 2147483647 gsm|lte 2147483647 2147483647 2147483647 
<br> 06-30 10:38:06.578163 1010 1367 D TelephonyRegistry: notifySignalStrengthForPhoneId: callback.onSsS r={callingPackage=com.android.systemui binder=android.os.BinderProxy@d2e4c9 callback=com.android.internal.telephony.IPhoneStateListener$Stub$Proxy@7f6d7ce onSubscriptionsChangedListenererCallback=null callerUserId=0 subId=3 phoneId=0 events=101e1 canReadPhoneState=true} subId=3 phoneId=0 ss=SignalStrength: 0 54 -120 -160 -120 -1 -1 99 -86 -9 97 2147483647 2147483647 gsm|lte 2147483647 2147483647 2147483647 
<br> 06-30 10:38:06.578577 1010 1367 I use-Rlog/RLOG-GSM: getLTELevel - rsrp:-86 snr:97 rsrpIconLevel:3 snrIconLevel:3 
<br> 06-30 10:38:06.578693 1010 1367 W SignalStrength: getLevel=3 
<br> 06-30 10:38:06.579533 1305 1531 I use-Rlog/RLOG-GSM: getLTELevel - rsrp:-86 snr:97 rsrpIconLevel:3 snrIconLevel:3 
<br> 06-30 10:38:06.582788 1305 1531 W SignalStrength: getLevel=3 
<br> 06-30 10:38:06.588566 1305 1531 I use-Rlog/RLOG-GSM: getLTELevel - rsrp:-86 snr:97 rsrpIconLevel:3 snrIconLevel:3 
<br> 06-30 10:38:06.589489 1305 1531 W SignalStrength: getLevel=3 
<br>    
<br>    
<br>   3G modem： 
<br> 
<br> 
<br>   +ECSQ: &lt;asu&gt;, &lt;ber&gt;, &lt;rssi&gt; （2G网络） 
<br>   +ECSQ: &lt;asu&gt;, &lt;ber&gt;, &lt;rssi&gt;, &lt;rscp&gt;, &lt;ec/no&gt; （3G网络） 
<br>    
<br>   4G modem： 
<br>    
<br>   +ECSQ: &lt;asu&gt;, &lt;ber&gt;, &lt;rssi&gt;, &lt;rscp&gt;,1,1,1,&lt;act&gt; （2G网络） 
<br>   +ECSQ: &lt;asu&gt;, &lt;ber&gt;, &lt;rssi&gt;, &lt;rscp&gt;, &lt;ec/no&gt;,1,1, &lt;act&gt; （3G网络） 
<br>   +ECSQ: &lt;rsrq&gt;, &lt;rsrp&gt;,1,1,1,&lt;rsrq_qdbm &gt;,&lt;rsrp_qdbm&gt; &lt;act&gt; （4G网络） 
<br> 
<br> 
<br>    
<br> 
<br> 
<br> 
<br> 
<br>   看+ECSQ 命令带的值： 
<br>   *如果第六第七位不是255 or 1 则当前在LTE状态， 
<br>   *如果第四第五位不是255 or 1 则当前在3G mode。 
<br>   *2G的话不是很清楚怎么看radio log,一般是在modem log里确认的。 
<br>   +ECSQ:&lt;sig1&gt;,&lt;sig2&gt;,&lt;rssi_in_qdbm&gt;,&lt;rscp_in_qdbm&gt;,&lt;ecn0_in_qdbm&gt;, 
<br>   &lt;rsrq_in_qdbm&gt;,&lt;rsrp_in_qdbm&gt; ,&lt;Act&gt; 
<br> 
<br> 
<br>   从radio log看，手机应该在 
<br>   4G mode时。如果 SNR&lt;0 (RSRQ&lt;-60dbm)，则信号很差。 
<br>   3G mode时， EcN0&lt;-15 (RSCP&lt;-115dbm)时信号很差 
<br>   2G mode时，2G：rssi&lt; -95dbm 、 rscq &gt; 4 (0~7 ,0最好，7最差) 
<br>                                                                                       
<br> ---------------------------------------------------------------------------------------------------------------------- 
<br> 
<br> 
<br> ANR 问题分析流程 
<br> 
<br> 
<br> 1.定位问题点 
<br>   a)使用mobile log 
<br>     *events_log中搜索am_anr 
<br>     *main_log 或 Sys_log 中搜索ANR in 
<br>     *traces.txt中查找相应的PID或者进程名 
<br>    
<br>   b) 使用anr db文件  
<br>     *使用gat工具打开db文件 
<br>     *查看ZZ_INTERNAL文件 找到pid或者进程名 
<br>     *在SWT_JBT_TRACES查找pid 
<br> 2.在mainlog中查看cpu 
<br>   *一般在trace就能看到问题点，如果还是定位不到，就需要在mainlog中搜索TOTAL： 
<br>   查看CPU使用率  进而确认问题 
<br> 
<br> 
<br> 
<br> 
<br>                   
<br>                
<br> 
<br> 
<br> 
<br> 
<br> 
<br> 
<br> 
<br> 
<br> ----------------------------------------------------------------------------------------------------------------------
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/17d7faa4bdbfcb19c4c3c7e877e9b0cb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">（一）HBase学习之路  -  HBase  Shell 使用 与 HBase  WebUI理解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/aeec84988a722ca15b3c546571c049a4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">给初学PLC编程的朋友几点建议</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>