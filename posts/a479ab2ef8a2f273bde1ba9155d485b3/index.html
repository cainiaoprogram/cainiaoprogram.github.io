<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>运维 —— expdp、impdp - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="运维 —— expdp、impdp" />
<meta property="og:description" content="一、exp/imp与expdp/impdp 1）exp和imp是客户端工具程序,它们既可以在可以客户端使用,也可以在服务端使用。
2）expdp和impdp是服务端的工具程序,他们只能在ORACLE服务端使用, 不能在客户端使用。
3）字符集的问题到expdp/impdp数据泵已经消除，因为expdp/impdp真正的导出导入操作都是在数据库服务器上完成的。
4）expdp/impdp工具需要提前创建一个路径，然后命令中加入参数directory。这个路径的创建原因是因为expdp/impdp是工作于服务器端，而这个路径就是对应的服务器端路径。
5）exp默认是传统路径，这种模式下，是用select来查询数据，然后写入buffer cache，在将这些数据写入evaluate buffer，最后传到export客户端，再写入dump文件。 exp直接路径模式下，直接从硬盘读取数据，然后写入PGA，格式就是export的格式，不需要转换，数据再直接传到export客户端，写入dump文件。这种模式没有经过evaluation buffer，少了一个过程，导出速度提高也是很明显。
exp没有并行参数，要进行并行导出，可以写多条命令同时导出，这种方式可用于特定的数据迁移情况，按表或表空间进行快速数据迁移。 expdp是Oracle 10g上推出的一种先进的数据导出方式，比exp有较大的性能提升，expdp可以看成是exp的升级版，相当于exp &#43; direct mode &#43; parallel。
二、操作 1、创建目录和引用目录 sys@ORCL&gt; create or replace directory dmpdir as &#39;/home/oracle&#39;; Directory created. sys@ORCL&gt; col OWNER for a10 sys@ORCL&gt; col DIRECTORY_NAME for a30 sys@ORCL&gt; col DIRECTORY_PATH for a50 sys@ORCL&gt; select * from dba_directories where directory_name = &#39;DMPDIR&#39;; 2、常规导入导出 共有参数为：目录，dump文件名，log文件名，含义明显，不再讲解，如：directory=DUMP_DIR dumpfile=abc.dmp logfile=abc.log
以下用...代替表示，如
expdp scott/tiger@db10g ...
impdp scott/tiger@db10g ...
1）按数据表 expdp scott/tiger@db10g tables=EMP,DEPT ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a479ab2ef8a2f273bde1ba9155d485b3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-07T23:19:45+08:00" />
<meta property="article:modified_time" content="2023-03-07T23:19:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">运维 —— expdp、impdp</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一、exp/imp与expdp/impdp</h2> 
<p>1）exp和imp是客户端工具程序,它们既可以在可以客户端使用,也可以在服务端使用。</p> 
<p>2）expdp和impdp是服务端的工具程序,他们只能在ORACLE服务端使用, 不能在客户端使用。</p> 
<p>3）<span style="background-color:#ff9900;">字符集的问题到expdp/impdp数据泵已经消除，因为expdp/impdp真正的导出导入操作都是在数据库服务器上完成的</span>。</p> 
<p>4）<span style="background-color:#f9eda6;">expdp/impdp工具需要提前创建一个路径，然后命令中加入参数directory。这个路径的创建原因是因为expdp/impdp是工作于服务器端，而这个路径就是对应的服务器端路径。</span></p> 
<p>5）exp默认是传统路径，这种模式下，是用select来查询数据，然后写入buffer cache，在将这些数据写入evaluate buffer，最后传到export客户端，再写入dump文件。      </p> 
<p style="margin-left:.0001pt;text-align:justify;">exp直接路径模式下，直接从硬盘读取数据，然后写入PGA，格式就是export的格式，不需要转换，数据再直接传到export客户端，写入dump文件。这种模式没有经过evaluation buffer，少了一个过程，导出速度提高也是很明显。</p> 
<p style="margin-left:.0001pt;text-align:justify;">exp没有并行参数，要进行并行导出，可以写多条命令同时导出，这种方式可用于特定的数据迁移情况，按表或表空间进行快速数据迁移。  </p> 
<p style="margin-left:.0001pt;text-align:justify;">expdp是Oracle 10g上推出的一种先进的数据导出方式，比exp有较大的性能提升，expdp可以看成是exp的升级版，相当于exp + direct mode + parallel。</p> 
<h2 style="margin-left:.0001pt;text-align:justify;"><img alt="" height="8" src="https://images2.imgbox.com/11/2b/FoAvoGbQ_o.png" width="24"></h2> 
<h2 style="margin-left:.0001pt;text-align:justify;">二、操作</h2> 
<h3></h3> 
<blockquote> 
 <h3>1、创建目录和引用目录</h3> 
</blockquote> 
<pre><code>sys@ORCL&gt; create or replace directory dmpdir as '/home/oracle';
Directory created.
sys@ORCL&gt; col OWNER for a10
sys@ORCL&gt; col DIRECTORY_NAME for a30
sys@ORCL&gt; col DIRECTORY_PATH for a50
sys@ORCL&gt; select * from dba_directories where directory_name = 'DMPDIR';</code></pre> 
<h3></h3> 
<blockquote> 
 <h3>2、常规导入导出</h3> 
</blockquote> 
<p>共有参数为：目录，dump文件名，log文件名，含义明显，不再讲解，如：directory=DUMP_DIR  dumpfile=abc.dmp  logfile=abc.log</p> 
<p>以下用...代替表示，如</p> 
<p>expdp scott/tiger@db10g ...<br> impdp scott/tiger@db10g ...</p> 
<h4><strong>1）按数据表</strong></h4> 
<p>expdp scott/tiger@db10g tables=EMP,DEPT ...<br> impdp scott/tiger@db10g tables=EMP,DEPT ...</p> 
<p>加参数TABLE_EXISTS_ACTION=APPEND可以将数据导入到已存在的表中</p> 
<h4><strong>2）按用户</strong></h4> 
<p>exp/imp中用owner，数据泵中用schema</p> 
<p>expdp scott/tiger@db10g schemas=SCOTT ...<br> impdp scott/tiger@db10g schemas=SCOTT ...</p> 
<h4><strong>3）按整个数据库</strong></h4> 
<p>expdp system/password@db10g full=Y ...<br> impdp system/password@db10g full=Y ...</p> 
<p></p> 
<blockquote> 
 <h3>3、高级导入导出</h3> 
</blockquote> 
<h4><strong>1）include &amp; exclude &amp; parfile</strong></h4> 
<p>用于指定导入导出对象。</p> 
<p>expdp scott/tiger@db10g schemas=SCOTT include=TABLE:"IN ('EMP', 'DEPT')" ...<br> expdp scott/tiger@db10g schemas=SCOTT exclude=TABLE:"= 'BONUS'" ...</p> 
<p>如果用命令行方式，应用转义字符 \</p> 
<p>include=TABLE:\"IN (\'EMP\', \'DEPT\')\"</p> 
<p>或者用parfile参数加*.par文件方式，就不需要用转义字符<br> expdp scott/tiger parfile=mypar.par</p> 
<p>root&gt; cat mypar.par<br> directory=data<br> logfile=t1.log<br> dumpfile=t1.dmp<br> full=yes<br> exclude=table:"IN('CUSTOMER','ORDOR)"<br> exclude=schema: "IN ('WMSYS', 'OUTLN')"</p> 
<p><span style="background-color:#ffff00;">也因为如此，强烈推荐使用参数文件在parfile参数中。</span></p> 
<p>Windows:</p> 
<p>c:&gt;  expdp scott/tiger exclude=TABLE:"IN (\'CUSTOMER\', \'ORDOR\')"</p> 
<p><span style="color:#000000;">UNIX/Linux:</span></p> 
<p><span style="color:#000000;">root&gt;  expdp scott/tiger exclude=TABLE:\"IN (\'CUSTOMER\', \'ORDOR\')\"</span></p> 
<p></p> 
<h4><strong>2） like &amp; in</strong></h4> 
<p>用于指定导入导出对象。</p> 
<p>INCLUDE=TABLE,VIEW,PACKAGE:"LIKE '%API'"</p> 
<p>或者</p> 
<p>INCLUDE=TABLE<br> INCLUDE=VIEW<br> INCLUDE=PACKAGE:"LIKE '%API'"</p> 
<p></p> 
<p>EXCLUDE=SCHEMA:"LIKE 'SYS%'"<br> EXCLUDE=SCHEMA:"IN ('OUTLN','SYSTEM','SYSMAN','FLOWS_FILES','APEX_030200','APEX_PUBLIC_USER','ANONYMOUS')"</p> 
<p></p> 
<h4>3）<span style="background-color:#ed7976;">表空间<u>内</u></span>不同用户的数据导入导出</h4> 
<p>导出参数文件expdp.par</p> 
<p>dumpfile=eSchemasXJ.dmp<br> logfile=eSchemasXJ.log<br> directory=dpdumpdir<br> schemas=xj</p> 
<p>导出语句：expdp system/123456 parfile=expdp.par</p> 
<p><strong>导入用户已存在：</strong></p> 
<p>导入参数文件</p> 
<p>dumpfile=eSchemasXJ.dmp<br> logfile=iSchemasXJ.log<br> directory=dpdumpdir<br> remap_schema=xj:xja</p> 
<p>导入语句：impdp system/123456 parfile=impdp.par</p> 
<p>数据导入成功，但将出现一个错误：</p> 
<p>ORA-31684: 对象类型 USER:"XJA" 已存在。</p> 
<p></p> 
<p><strong>导入用户不存在：</strong></p> 
<p>导入参数文件为：</p> 
<p>dumpfile=eSchemasXJ.dmp<br> logfile=iSchemasXJ.log<br> directory=dpdumpdir<br> remap_schema=xj:xjb</p> 
<p>导入成功，无错误。将创建xjb用户，且密码与xj相同。</p> 
<p></p> 
<h4>4）<span style="background-color:#faa572;">表空间<u>之间</u></span>用户的数据导入导出（remap_schema与remap_tablespace同时都要有）</h4> 
<p>导出参数文件expdp.par</p> 
<p>dumpfile=eSchemasXJ.dmp<br> logfile=eSchemasXJ.log<br> directory=dpdumpdir<br> schemas=xj  //xj用户下的数据</p> 
<p>导出语句：expdp system/123456 parfile=expdp.par</p> 
<p><strong>导入用户已存在：</strong></p> 
<p>导入参数文件</p> 
<p>dumpfile=eSchemasXJ.dmp<br> logfile=iSchemasXJ.log<br> directory=dpdumpdir<br> remap_schema=xj:yyu1 //已存在的用户<br> remap_tablespace=users:yyds</p> 
<p>导入语句：impdp system/123456 parfile=impdp.par</p> 
<p>数据导入成功，但将出现一个错误：</p> 
<p>ORA-31684: 对象类型 USER:"YYU1" 已存在。</p> 
<p><strong>导入用户不存在：</strong></p> 
<p>导入参数文件为：</p> 
<p>dumpfile=eSchemasXJ.dmp<br> logfile=iSchemasXJ.log<br> directory=dpdumpdir<br> remap_schema=xj:xjx <span style="background-color:#9c8ec1;">//目标用户不能是xj，因为整个数据库中，用户名称具有唯一性</span><br> remap_tablespace=users:yyds</p> 
<p>导入成功，无错误。将创建xjx用户，且密码与xj相同。</p> 
<p></p> 
<h4>5）<span style="background-color:#faa572;">表空间</span>的数据导入导出</h4> 
<p>导出参数文件</p> 
<p>dumpfile=eTablespaceYyds.dmp<br> logfile=eTablespaceYyds.log<br> directory=dpdumpdir<br> tablespaces=yyds</p> 
<p><strong>导入表空间已存在：</strong></p> 
<p>导入参数文件</p> 
<p>dumpfile=eTablespaceYyds.dmp<br> logfile=iTablespaceYyds.log<br> directory=dpdumpdir<br><span style="background-color:#98c091;">tablespaces=yyds //此句要与不要效果一样，提示表什么的已存在</span>。</p> 
<p>以上是导入yyds。<span style="background-color:#be191c;">如果已创建了表空间zgms，则以下命令将报错，因为用户已存在</span>。</p> 
<p>dumpfile=eTablespaceYyds.dmp<br> logfile=iTablespaceYyds.log<br> directory=dpdumpdir<br> remap_tablespace=yyds:zgmis</p> 
<p>改为加上remap_schema=xx:xxx ？<strong>用户很多怎么搞？</strong></p> 
<p></p> 
<p><strong>导入表空间不存在：</strong></p> 
<p>导入参数文件</p> 
<p>dumpfile=eTablespaceYyds.dmp<br> logfile=iTablespaceYyds.log<br> directory=dpdumpdir<br> tablespaces=newtb</p> 
<p>报错，导入失败。</p> 
<p></p> 
<h4>6）<span style="background-color:#faa572;">全库</span>数据导入导出</h4> 
<p>导出参数文件</p> 
<p>dumpfile=eTablespaceYyds.dmp<br> logfile=eTablespaceYyds.log<br> directory=dpdumpdir<br> full=yes<br> parallel= 4</p> 
<p>导入参数</p> 
<p>dumpfile=eTablespaceYyds.dmp<br> logfile=iTablespaceYyds.log<br> directory=dpdumpdir<br> full=yes<br> 导入前，原数据库不能有表空间，数据文件。？</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f3e473467bb7459af5ce583623549d75/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java 抽象类、普通类、接口的区别——值得你一看的干货</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/09692bc1a9fc0dd44e1ea4f7cdab62fb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">4ASK调制前后对比、Matlab误码率仿真</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>