<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>OAI rfsimulator搭建教程 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="OAI rfsimulator搭建教程" />
<meta property="og:description" content="OAI 搭建教程 本文说明了在ubuntu18.04虚拟机中，使用rfsimulator代替usrp进行仿真，搭建OAI的具体过程
一、安装Ubuntu 1、 使用VMware安装虚拟机，选择ubuntu18.04
2、 安装完系统之后先调整屏幕大小（安装vmware tools）
在VMware软件中，右键单击虚拟机（Ubuntu 64位），安装VMware Tools。在ubuntu桌面上打开VMware Tools，将里面的压缩包文件解压进入解压后的文件夹，打开vmware-install.pl进行安装（在终端输入命令./vmware-install.pl执行），一直Enter下去（选择默认，或者yes），直到显示成功即可。可以参考https://www.cnblogs.com/aidenzdly/p/10321034.html中的第1-5步 3、 安装完成后，在Linux系统中打开终端，输入命令
apt-get update apt-get upgrade 4、 安装git并配置git
sudo apt install git git config --global user.name &#34;Laurent&#34; git config --global user.email &#34;laurent.thomas@open-cells.com&#34; 5、将OAI存储库添加为授权的远程系统
echo -n | openssl s_client -showcerts -connect gitlab.eurecom.fr:443 2&gt;/dev/null | sed -ne &#39;/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p&#39; | sudo tee -a /etc/ssl/certs/ca-certificates.crt 在不换源的情况下，使用apt下载包或者依赖时可能会失败，因为原来的软件源的服务器在国外，换成国内的之后使用apt-get install会畅通无阻：
换源操作可以参考https://www.cnblogs.com/aidenzdly/p/10321034.html中的第6-11步（注意在第10步点击关闭之前，应该先将源代码那一栏也勾上）除了上述这种图形化界面操作的方法，网上大多数方法是使用命令行，修改系统文件，也是可行的。参考：https://blog.csdn.net/XC_LMH/article/details/86506770 二、安装USRP驱动程序 sudo apt-get install libboost-all-dev libusb-1.0-0-dev python-mako doxygen python-docutils python-requests python3-pip cmake build-essential pip3 install mako numpy git clone git://github." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a7172b4a6506b5f775d9187d2f579622/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-06T12:37:45+08:00" />
<meta property="article:modified_time" content="2020-07-06T12:37:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">OAI rfsimulator搭建教程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="OAI__0"></a>OAI 搭建教程</h2> 
<p>本文说明了在ubuntu18.04虚拟机中，使用rfsimulator代替usrp进行仿真，搭建OAI的具体过程</p> 
<h3><a id="Ubuntu_4"></a>一、安装Ubuntu</h3> 
<p>1、 使用VMware安装虚拟机，选择ubuntu18.04</p> 
<p>2、 安装完系统之后先调整屏幕大小（安装vmware tools）</p> 
<ul><li>在VMware软件中，右键单击虚拟机（Ubuntu 64位），安装VMware Tools。</li><li>在ubuntu桌面上打开VMware Tools，将里面的压缩包文件解压</li><li>进入解压后的文件夹，打开vmware-install.pl进行安装（在终端输入命令./vmware-install.pl执行），一直Enter下去（选择默认，或者yes），直到显示成功即可。</li><li>可以参考https://www.cnblogs.com/aidenzdly/p/10321034.html中的第1-5步</li></ul> 
<p>3、 安装完成后，在Linux系统中打开终端，输入命令</p> 
<pre><code>apt-get update
</code></pre> 
<pre><code>apt-get upgrade
</code></pre> 
<p>4、 安装git并配置git</p> 
<pre><code>sudo apt install git
</code></pre> 
<pre><code>git config --global user.name "Laurent"
</code></pre> 
<pre><code>git config --global user.email "laurent.thomas@open-cells.com"
</code></pre> 
<p>5、将OAI存储库添加为授权的远程系统</p> 
<pre><code>echo -n | openssl s_client -showcerts -connect gitlab.eurecom.fr:443 2&gt;/dev/null | sed -ne '/-BEGIN CERTIFICATE-/,/-END CERTIFICATE-/p' | sudo tee -a /etc/ssl/certs/ca-certificates.crt
</code></pre> 
<p>在不换源的情况下，使用apt下载包或者依赖时可能会失败，因为原来的软件源的服务器在国外，换成国内的之后使用apt-get install会畅通无阻：</p> 
<ul><li>换源操作可以参考https://www.cnblogs.com/aidenzdly/p/10321034.html中的第6-11步（注意在第10步点击关闭之前，应该先将源代码那一栏也勾上）</li><li>除了上述这种图形化界面操作的方法，网上大多数方法是使用命令行，修改系统文件，也是可行的。参考：https://blog.csdn.net/XC_LMH/article/details/86506770</li></ul> 
<h3><a id="USRP_50"></a>二、安装USRP驱动程序</h3> 
<pre><code>sudo apt-get install libboost-all-dev libusb-1.0-0-dev python-mako doxygen python-docutils python-requests python3-pip cmake build-essential
</code></pre> 
<pre><code>pip3 install mako numpy
</code></pre> 
<pre><code>git clone git://github.com/EttusResearch/uhd.git
（若出错可往下翻）
</code></pre> 
<pre><code>cd uhd; mkdir host/build; cd host/build
</code></pre> 
<pre><code>cmake -DCMAKE_INSTALL_PREFIX=/usr ..
</code></pre> 
<pre><code>make -j4
（若出错可往下翻）
</code></pre> 
<pre><code>sudo make install
</code></pre> 
<pre><code>sudo ldconfig
</code></pre> 
<pre><code>sudo /usr/lib/uhd/utils/uhd_images_downloader.py
（若出错可往下翻）
</code></pre> 
<p>上述安装过程中遇到的问题：</p> 
<ol><li>git clone下载失败，由于是要在github上下载项目，有时候会遇到下载速度太慢或者下载失败的情况。</li></ol> 
<ul><li>无法翻墙的情况下，选择多试几次，或者在多个不同的时间段试几次</li><li>如果可以翻墙，可以在github网站上将所需下载的东西下载并解压到所需文件夹中</li><li>在可以翻墙的前提下，也可以选择对git clone设置http代理(推荐）：</li></ul> 
<pre><code>git config --global http.proxy 'socks5://127.0.0.1:1080'
git config --global https.proxy 'socks5://127.0.0.1:1080'
</code></pre> 
<p>其中1080是端口号，根据自己配置的端口号设置（我是1088）</p> 
<p>取消http代理：</p> 
<pre><code>git config --global --unset http.proxy
git config --global --unset https.proxy
</code></pre> 
<ol start="2"><li>执行make -j4时报错</li></ol> 
<ul><li> <p>错误信息：g++ internal compiler error：Killed（program cc1plus），同时系统会很卡</p> </li><li> <p>原因：内存分配不够，在虚拟机里我给ubuntu分配的2g内存，还是太卡了，改成分配3g内存（有条件的可以分配的更多一些）之后就可以正常make</p> </li></ul> 
<ol start="3"><li>执行sudo /usr/lib/uhd/utils/uhd_images_downloader.py出错</li></ol> 
<ul><li>在这个python文件中，程序写的是去一个网站下载一些压缩包并解压</li><li>但是安装过程比较艰难，不知道是因为网络的问题还是什么原因，下了很多次，最后还是有一些压缩包下载失败</li></ul> 
<p><img src="https://images2.imgbox.com/76/64/MofomLvJ_o.png" alt="报错2"></p> 
<ul><li>根据[ERROR]找出没有成功下载的zip文件，登录错误提示后面的网站，手动下载压缩包（需要翻墙）并将其解压文件全部都复制到 /usr/share/uhd/images 文件夹中</li></ul> 
<h3><a id="_134"></a>三、下载修改的补丁</h3> 
<pre><code>cd ~
</code></pre> 
<pre><code>wget https://open-cells.com/opencells-mods-20190923.tgz
</code></pre> 
<pre><code>tar xf opencells-mods-20190923.tgz
</code></pre> 
<h3><a id="EPC_150"></a>四、下载并对EPC打补丁</h3> 
<pre><code>git clone https://gitlab.eurecom.fr/oai/openair-cn.git
</code></pre> 
<p>执行这一步的时候，由于需要在gitlab上下载项目，且需要登录账户；</p> 
<p>但gitlab目前只允许中科大学生注册，只能用之前注册过的账号</p> 
<pre><code>cd openair-cn
</code></pre> 
<pre><code>git checkout develop
</code></pre> 
<ul><li>在完成git checkout develop之后，查看递交版本号：</li></ul> 
<p>终端输入git log之后可以看到：</p> 
<p><img src="https://images2.imgbox.com/97/e4/AtRtNqu8_o.png" alt="版本号"></p> 
<p>第一个版本号的（应该是哈希值）和期望值是一样的，说明epc安装无误。</p> 
<p>按q退出日志</p> 
<pre><code>git apply ~/opencells-mods/EPC.patch
</code></pre> 
<p>本行语句只运行一遍即可，没有成功的显示，如果运行两次或以上，则会显示打补丁失败</p> 
<h3><a id="EPC_190"></a>五、为EPC安装第三方软件</h3> 
<pre><code>cd openair-cn; source oaienv; cd scripts

./build_hss -i
</code></pre> 
<p>Answer yes to install: freeDiameter 1.2.0；</p> 
<p>在运行完成之后显示未编译完成（暂时先不用管）：</p> 
<p><img src="https://images2.imgbox.com/5e/34/UUPsIUPt_o.png" alt="报错3"></p> 
<pre><code>sudo mysql -u root &lt;&lt; END
USE mysql;
UPDATE user SET plugin='mysql_native_password' WHERE User='root';
FLUSH PRIVILEGES;
END

sudo systemctl restart mysql.service

sudo mysql_secure_installation
</code></pre> 
<p>从官网教程中摘录的安装时的注意事项：</p> 
<p>The last command will ask a few questions（最后一个命令）:</p> 
<ul><li>VALIDATE PASSWORD PLUGIN: no</li><li>password: set your password (linux is set in our default config files)</li><li>Remove anonymous users: yes</li><li>Disallow root login remotely: yes</li><li>Remove test database and access to it: yes</li><li>Reload privilege tables now: yes</li></ul> 
<pre><code>./build_mme -i
</code></pre> 
<ul><li>Do you want to install freeDiameter 1.2.0: no</li><li>Do you want to install asn1c rev 1516 patched? &lt;y/N&gt;: yes</li><li>Do you want to install libgtpnl ? &lt;y/N&gt;: yes</li><li>wireshark permissions: as you prefer</li></ul> 
<p>同样，在运行完成之后显示未编译完成（暂时先不用管）</p> 
<pre><code>./build_spgw -i
</code></pre> 
<p>Do you want to install libgtpnl ? &lt;y/N&gt;: no</p> 
<p>同样，在运行完成之后显示未编译完成（暂时先不用管）</p> 
<h3><a id="EPC_254"></a>六、编译EPC节点</h3> 
<pre><code>cd openair-cn; source oaienv; cd scripts
./build_hss
./build_mme
./build_spgw
</code></pre> 
<p>之前编译未完成的在此处全部编译完成</p> 
<h3><a id="eNB_267"></a>七、下载并编译eNB</h3> 
<pre><code>git clone https://gitlab.eurecom.fr/oai/openairinterface5g.git
cd openairinterface5g
git checkout develop
</code></pre> 
<p>We tested with commit edb74831dabf79686eb5a92fbf8fc06e6b267d35：</p> 
<p>此时执行</p> 
<pre><code>git log
</code></pre> 
<p>会发现此时所处的递交版本和官方测试过的版本不一样，所以此处需要执行：</p> 
<pre><code>git checkout edb74831dabf79686eb5a92fbf8fc06e6b267d35
</code></pre> 
<p>再进行 git log 就可以看到该哈希值完全一样</p> 
<pre><code>source oaienv  
./cmake_targets/build_oai -I
</code></pre> 
<p>执行该命令时，可能遇到 build have failed 的错误，一般来说是因为访问外网比较困难，会出现下载失败。</p> 
<p>若是在<strong>Installing ASN1</strong>时出现 build 错误，可以多尝试几次，或者换个时间段（网上有说法是 找到 /cmake target/tools/build helper 文件，将里面涉及gist.github 的这一行代码注释掉)：</p> 
<p>如图选中的两行，用#注释</p> 
<p><img src="https://images2.imgbox.com/ca/02/hcYIOJFx_o.png" alt="解决1"></p> 
<p>我用的就是这种方法，注释之后可以继续编译，暂时也没问题。</p> 
<p>若是在 <strong>Installing google Protobuf from sources</strong>时出现build错误：</p> 
<ul><li>在openairinterface5g/cmake_targets/tools路径中，打开build_helper文件</li></ul> 
<pre><code>  sudo gedit build_helper
</code></pre> 
<ul><li>在打开的程序中搜索google，找到wget 这一行（注意程序中有两段，第一段写的是 2.6.1 版本的，那几行已经被注释掉了，在下面还有几行没被注释的是 3.3.0 版本的）</li><li>如下图将选中的两行用#注释掉并保存</li></ul> 
<p><img src="https://images2.imgbox.com/43/49/PLC2hJGH_o.png" alt="解决2"></p> 
<ul><li>若可以直接翻墙，则在浏览器访问wget后面的网址，下载 protobuf-3.3.0.tar.gz 这个文件，把下载好的 protobuf-3.3.0.tar.gz 拷到安装ENB的主机的/tmp文件夹中</li><li>重新执行命令即可完成</li></ul> 
<pre><code>./cmake_targets/build_oai -w USRP --eNB --UE
(此条命令编译的是4G的基站和终端)
</code></pre> 
<pre><code>./cmake_targets/build_oai -w USRP --gNB --nrUE
(此条命令编译的是5G的基站和终端)
</code></pre> 
<ul><li>若出现以下报错：</li></ul> 
<p><img src="https://images2.imgbox.com/62/07/zLGRrm4b_o.png" alt="报错5"></p> 
<p>重新执行：</p> 
<pre><code>sudo git checkout develop
</code></pre> 
<p>若出现：</p> 
<p><img src="https://images2.imgbox.com/d6/a3/XVXlARj6_o.png" alt="报错6"></p> 
<p>是因为之前修改了build_helper文件，执行：</p> 
<pre><code>sudo git reset --hard
</code></pre> 
<p>用远程代码库的文件完全覆盖本地的版本</p> 
<pre><code>sudo git checkout develop
./cmake_targets/build_oai -w USRP --gNB --nrUE
</code></pre> 
<p>此时重新执行就可以编译gNB</p> 
<h3><a id="eNB_371"></a>八、eNB配置文件</h3> 
<p>打开enb配置文件：</p> 
<pre><code>sudo gedit ~/opencells-mods/enb.10MHz.b200
</code></pre> 
<p>查看配置文件是否为：</p> 
<pre><code>// MME parameters:
 mme_ip_address = ( { ipv4 = "127.0.0.20";
 ipv6 = "192:168:30::17";
 active = "yes";
 preference = "ipv4";
 }
 );

NETWORK_INTERFACES : 
 {
 ENB_INTERFACE_NAME_FOR_S1_MME = "lo";
 ENB_IPV4_ADDRESS_FOR_S1_MME = "127.0.0.10/8";

 ENB_INTERFACE_NAME_FOR_S1U = "lo";
 ENB_IPV4_ADDRESS_FOR_S1U = "127.0.0.10/8";
 ENB_PORT_FOR_S1U = 2152; # Spec 2152
 };
</code></pre> 
<p>另外，还需要设置：</p> 
<p>tracking_area_code = “1”;<br> mobile_country_code = “208”;<br> mobile_network_code = “92”;</p> 
<h3><a id="EPC_409"></a>九、EPC配置文件</h3> 
<pre><code>sudo mkdir -p /usr/local/etc/oai

sudo cp -rp ~/opencells-mods/config_epc/ /usr/local/etc/oai
</code></pre> 
<pre><code>cd openair-cn; source oaienv; cd scripts

./check_hss_s6a_certificate /usr/local/etc/oai/freeDiameter hss.OpenAir5G.Alliance

./check_mme_s6a_certificate /usr/local/etc/oai/freeDiameter mme.OpenAir5G.Alliance
</code></pre> 
<p>查看网卡名字和IP地址</p> 
<pre><code>ifconfig
</code></pre> 
<p><img src="https://images2.imgbox.com/e1/7e/f2ISHlEp_o.png" alt="解决3"></p> 
<p>图中网卡名是“ens33”</p> 
<pre><code>sudo gedit /usr/local/etc/oai/spgw.conf
</code></pre> 
<p>打开spgw配置文件，查看修改参数，改成如下所示（ens33改成自己网卡名）：</p> 
<pre><code> PGW_INTERFACE_NAME_FOR_SGI = "ens33"; 
 PGW_MASQUERADE_SGI = "yes";
</code></pre> 
<pre><code>sudo gedit /usr/local/etc/oai/mme.conf
</code></pre> 
<p>打开mme配置文件，查看修改参数，改成如下所示：</p> 
<pre><code>GUMMEI_LIST = ( MCC="208" ; MNC="92"; MME_GID="4" ; MME_CODE="1"; } );
TAI_LIST = ({MCC="208" ; MNC="92"; TAC = "1"; } );
</code></pre> 
<pre><code>sudo gedit /usr/local/etc/oai/hss.conf
</code></pre> 
<p>打开hss配置文件，查看修改参数</p> 
<img src="https://images2.imgbox.com/d7/81/V0Znbkj9_o.png" alt="解决4"> 
<p>根据之前设置的mysql的密码，将标黄该行右边的密码换成自己的密码（我的是123456）</p> 
<pre><code>~/opencells-mods/hss_import 127.0.0.1 root 123456 oai_db ~/opencells-mods/opencells_db.sql
</code></pre> 
<p>执行这一步的时候注意把root后面的123456换成自己的密码</p> 
<h3><a id="_487"></a>十、测试和验证</h3> 
<h4><a id="1_4g_LTE_489"></a>1. 4g LTE</h4> 
<p>开四个终端，分别执行：</p> 
<ol><li>运行hss</li></ol> 
<pre><code>cd openair-cn; source oaienv; cd scripts; ./run_hss
</code></pre> 
<ol start="2"><li>运行mme</li></ol> 
<pre><code>cd openair-cn; source oaienv; cd scripts; ./run_mme
</code></pre> 
<ol start="3"><li>运行spgw</li></ol> 
<pre><code>cd openair-cn; source oaienv; cd scripts; sudo -E ./run_spgw
</code></pre> 
<ol start="4"><li>运行eNB</li></ol> 
<pre><code>sudo bash
cd ~/openairinterface5g; source oaienv
cd cmake_targets/lte_build_oai/build
sudo RFSIMULATOR=enb ./lte-softmodem -O ~/opencells-mods/enb.10MHz.b200 --rfsim
</code></pre> 
<p>由于我没有usrp，使用的是rfsimulator代替usrp，最后一步执行时和官网教程有所不同</p> 
<ol start="5"><li>运行UE<br> UE无法直接再同一台机器上直接运行，一种解决方案是在虚拟机中运行UE；另一种更简单的方法是仅为UE创建一个网络名称空间，但在此之前，还需要生成一个虚拟SIM卡：</li></ol> 
<pre><code class="prism language-bash"><span class="token punctuation">..</span>/<span class="token punctuation">..</span>/nas_sim_tools/build/conf2uedata -c ~/opencells-mods/sim.conf -o <span class="token keyword">.</span>
</code></pre> 
<ul><li>创建一个网络名称空间</li></ul> 
<p>如果曾经创建过，先删除之前的网络名称空间，再重新创建：</p> 
<pre><code class="prism language-bash">ip netns delete ueNameSpace
ip <span class="token function">link</span> delete v-eth1
</code></pre> 
<pre><code class="prism language-bash">ip netns add ueNameSpace
</code></pre> 
<pre><code>ip link add v-eth1 type veth peer name v-ue1
</code></pre> 
<p>创建一个虚拟网卡对：v-eth1和v-ue1</p> 
<pre><code class="prism language-cpp">ip link list
</code></pre> 
<p>此时可以看到这一虚拟网卡对，如图</p> 
<p><img src="https://images2.imgbox.com/80/21/9QeGNYkf_o.png" alt="网络名称空间1"></p> 
<pre><code>ip link set v-ue1 netns ueNameSpace
</code></pre> 
<p>把v-ue1转移到ueNameSpace空间中去，再执行：</p> 
<pre><code class="prism language-bash">ip <span class="token function">link</span> list
</code></pre> 
<p>发现没用v-ue1这个网卡了，执行</p> 
<pre><code class="prism language-bash">ip <span class="token function">link</span> <span class="token keyword">set</span> veth1 netns ueNameSpace
</code></pre> 
<p>v-ue1已经再ueNameSpace空间中，如图</p> 
<p><img src="https://images2.imgbox.com/30/db/19xvJONZ_o.png" alt="网络名称空间2"></p> 
<pre><code class="prism language-bash">ip addr add 10.200.1.1/24 dev v-eth1 
</code></pre> 
<p>给v-eth1分配IP地址</p> 
<pre><code class="prism language-bash">ip <span class="token function">link</span> <span class="token keyword">set</span> v-eth1 up
</code></pre> 
<p>启动v-eth1网卡</p> 
<pre><code class="prism language-bash">iptables -t nat -A POSTROUTING -s 10.200.1.0/255.255.255.0 -o ens33 -j MASQUERADE  
</code></pre> 
<p>启动IP伪装，添加了一条规则到NAT表的POSTROUTING链中，对于源IP地址为10.200.1.0网段的数据包，用ens33网口的IP地址替换并发送</p> 
<pre><code>iptables -A FORWARD -i ens33 -o v-eth1 -j ACCEPT  
iptables -A FORWARD -o ens33 -i v-eth1 -j ACCEPT
</code></pre> 
<p>iptables -A FORWARD这两条语句使能物理网口ens33和v-eth1之间的数据转发</p> 
<pre><code class="prism language-bash">ip netns <span class="token function">exec</span> ueNameSpace ip <span class="token function">link</span> <span class="token keyword">set</span> dev lo up   
ip netns <span class="token function">exec</span> ueNameSpace ip addr add 10.200.1.2/24 dev v-ue1  
ip netns <span class="token function">exec</span> ueNameSpace ip <span class="token function">link</span> <span class="token keyword">set</span> v-ue1 up 
</code></pre> 
<p>给v-ue1设置IP地址，并启动v-ue1</p> 
<p>将窗口（终端）设置到新的网络名称空间中</p> 
<pre><code class="prism language-bash">ip netns <span class="token function">exec</span> ueNameSpace <span class="token function">bash</span>
</code></pre> 
<p>在该终端中运行UE，注意在运行UE之前必须先运行上一个命令</p> 
<pre><code class="prism language-bash">./lte-uesoftmodem -C 2685000000 -r 50 --rfsim --rfsimulator.serveraddr 10.200.1.1
</code></pre> 
<p>可以看到该UE可以连接到 eNB 以及 EPC ,在MME中可以看到连接以及附着的UE由0增加到1</p> 
<p><img src="https://images2.imgbox.com/12/d3/fKeby35A_o.png" alt="运行结果2"></p> 
<ul><li>若是在运行UE时出现这样的报错：</li></ul> 
<p>[RRC] Synched with a cell, but PLMN doesn’t match our SIM, the message PHY_FIND_NEXT_CELL_REQ is sent but lost in current UE implementation!</p> 
<p>说明生成的virtual SIM匹配失败，此时，先检查virtual SIM卡生成的MCC和MNC是否和eNB config 文件中所配置的相同，MCC=288，MNC=92：</p> 
<p><img src="https://images2.imgbox.com/6e/af/IWTNf2p6_o.png" alt="IMSI"></p> 
<p>在询问项目作者之后，发现在生成virtual SIM时所处的文件夹错误，在运行UE时没有用之前生成的SIM卡，应该在lte-uesoftmodem所在文件目录下执行生成SIM的命令，重新生成之后就可以成功运行。</p> 
<h4><a id="2_5g_NR_650"></a>2. 5g NR</h4> 
<p>若使用rfsimulator代替USRP，由于该项目使用的是develop分支，在5g方面只开发了nrUE和gNB的功能，还不能连接核心网</p> 
<ol><li>运行gNB</li></ol> 
<pre><code>sudo bash

cd ~/openairinterface5g

source oaienv

cd cmake_targets/ran_build/build

sudo RFSIMULATOR=server ./nr-softmodem -O ../../../targets/PROJECTS/GENERIC-LTE-EPC/CONF/gnb.band78.tm1.106PRB.usrpn300.conf --parallel-config PARALLEL_SINGLE_THREAD --rfsim --phy-test
</code></pre> 
<ol start="2"><li>运行nrUE</li></ol> 
<pre><code>sudo bash

cd ~/openairinterface5g

source oaienv

cd cmake_targets/ran_build/build

sudo RFSIMULATOR=127.0.0.1 ./nr-uesoftmodem --rfsim --phy-test -d
</code></pre> 
<p>下图为5G版运行结果：</p> 
<p><img src="https://images2.imgbox.com/73/04/2KIbALW0_o.png" alt="运行结果1"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c997ec82791afa0930a55b4c1b164aeb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">centos7 怎么让命令行显示中文</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1be2ebea1f92a8125a2aeded00724991/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">linux中的 -d  、-s   等的含义  文件修改用户 或者权限(rwx)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>