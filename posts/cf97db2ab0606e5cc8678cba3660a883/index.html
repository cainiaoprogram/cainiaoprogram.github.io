<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>第七讲（一）：VLAN的原理及配置 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="第七讲（一）：VLAN的原理及配置" />
<meta property="og:description" content="文章目录 一、VLAN概述与优势1、 VLAN简介2、 VLAN的目的和优势 二、VLAN的种类三、VLAN的基本概念1、 VLAN标签2、 常用设备收发数据帧的VLAN标签情况2.1 在一个VLAN交换网络中，以太网帧主要有以下两种格式：2.2 链路类型和接口类型①链路类型②接口类型 3、 缺省VLAN 四、VLAN配置●交换机SW1配置●交换机SW2配置●路由器AR1 一、VLAN概述与优势 1、 VLAN简介 VLAN（Virtual Local Area Network）即虚拟局域网，是将一个物理的LAN（局域网）的逻辑上划分多个广播域的通信技术。Vlan内的主机间可以直接通信，而Vlan间不能直接直接通信，从而将广播报文限制在一个Vlan内。
分割广播域有两种方法：
① 物理分割：进行子网划分，不同子网间不可相互通信。
②逻辑分割：VLAN划分，不同VLAN之间不可相互通信。
2、 VLAN的目的和优势 ●目的：当主机数目较多时，会导致冲突严重、广播泛滥、性能显著下降甚至造成网络不可用等问题。
●优势：控制广播、增强网络安全、简化网络管理。
二、VLAN的种类 ① 静态VLAN
基于端口划分静态VLAN
② 动态VLAN
基于MAC地址划分动态VLAN
三、VLAN的基本概念 参考文献：https://blog.csdn.net/qq_38265137/article/details/80390759
1、 VLAN标签 要使得设备能够分辨不同的VLAN的报文，需要在报文中添加标识VLAN信息的字段，IEEE802.1Q协议规定，在以太网数据帧的目的MAC地址和源MAC地址字段之后，协议类型之前，加上4个字节的VLAN标签（又称VLAN tag，简称Tag），用以标识VLAN信息。
字段解释：
●TPID：2字节（Tag Prototcol Identifier：标签协议标识符）表示数据帧类型。
●Priority：3位，表示数据帧的802.1Q优先级。
●CFI：1位，（Canonical Format Indicator：标准格式指示为）表示MAC地址在不同的传输介质中是否以标准格式进行封装，用于兼容以太网和令牌环网。
●VID：12位，VLAN ID ，表示该数据帧所属VLAN的编号。
●注意：设备利用VLAN 标签中的VID来标识数据帧所属的VLAN，广播帧指在同一VLAN内转发，这就将广播域限制在一个VLAN内。
2、 常用设备收发数据帧的VLAN标签情况 2.1 在一个VLAN交换网络中，以太网帧主要有以下两种格式： ●有标记帧（Tagged帧）:加入了4字节VLAN标签的帧。
●无标记帧（Untagged帧）：原始的、没加入4字节VLAN标签的帧
2.2 链路类型和接口类型 ●设备内部处理的数据帧一律都带有VLAN标签，而网中的设备有些只会收发Untagged帧，要与这些设备交互，就需要接口能够识别Untagged帧并在收发时给帧添加、剥除VLAN标签。
●网络中属于同一个VLAN的用户可能会被连接在不同的设备上，且跨越设备的VLAN可能不止一个，如果需要用户间的互通，就需要设备间的接口能够同时识别和发送多个VLAN的数据帧。
●为了适应不同连接和组网，设备定义了Access接口、Trunk接口和Hybrid接口三种接口类型，以及接入链路（Access Link）和干道链路（Trunk Link）两种链路类型。
①链路类型 根据链路中需要承载的VLAN数目的不同，以太网链路分为：
●接入链路" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/cf97db2ab0606e5cc8678cba3660a883/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-25T17:06:09+08:00" />
<meta property="article:modified_time" content="2022-04-25T17:06:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">第七讲（一）：VLAN的原理及配置</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#VLAN_1" rel="nofollow">一、VLAN概述与优势</a></li><li><ul><li><a href="#1_VLAN_3" rel="nofollow">1、 VLAN简介</a></li><li><a href="#2_VLAN_13" rel="nofollow">2、 VLAN的目的和优势</a></li></ul> 
  </li><li><a href="#VLAN_19" rel="nofollow">二、VLAN的种类</a></li><li><a href="#VLAN_29" rel="nofollow">三、VLAN的基本概念</a></li><li><ul><li><a href="#1_VLAN_32" rel="nofollow">1、 VLAN标签</a></li><li><a href="#2_VLAN_50" rel="nofollow">2、 常用设备收发数据帧的VLAN标签情况</a></li><li><ul><li><a href="#21_VLAN_52" rel="nofollow">2.1 在一个VLAN交换网络中，以太网帧主要有以下两种格式：</a></li><li><a href="#22___58" rel="nofollow">2.2 链路类型和接口类型</a></li><li><ul><li><a href="#_66" rel="nofollow">①链路类型</a></li><li><a href="#_78" rel="nofollow">②接口类型</a></li></ul> 
   </li></ul> 
   </li><li><a href="#3_VLAN_94" rel="nofollow">3、 缺省VLAN</a></li></ul> 
  </li><li><a href="#VLAN_110" rel="nofollow">四、VLAN配置</a></li><li><ul><li><a href="#SW1_120" rel="nofollow">●交换机SW1配置</a></li><li><a href="#SW2_220" rel="nofollow">●交换机SW2配置</a></li><li><a href="#AR1_274" rel="nofollow">●路由器AR1</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="VLAN_1"></a>一、VLAN概述与优势</h2> 
<h3><a id="1_VLAN_3"></a>1、 VLAN简介</h3> 
<p>VLAN（Virtual Local Area Network）即虚拟局域网，是将一个物理的LAN（局域网）的逻辑上划分多个广播域的通信技术。Vlan内的主机间可以直接通信，而Vlan间不能直接直接通信，从而将广播报文限制在一个Vlan内。</p> 
<p><strong>分割广播域有两种方法：</strong></p> 
<p>① 物理分割：进行子网划分，不同子网间不可相互通信。</p> 
<p>②逻辑分割：VLAN划分，不同VLAN之间不可相互通信。</p> 
<h3><a id="2_VLAN_13"></a>2、 VLAN的目的和优势</h3> 
<p>●目的：当主机数目较多时，会导致冲突严重、广播泛滥、性能显著下降甚至造成网络不可用等问题。</p> 
<p>●优势：控制广播、增强网络安全、简化网络管理。</p> 
<h2><a id="VLAN_19"></a>二、VLAN的种类</h2> 
<p><strong>① 静态VLAN</strong></p> 
<p>基于端口划分静态VLAN</p> 
<p><strong>② 动态VLAN</strong></p> 
<p>基于MAC地址划分动态VLAN</p> 
<h2><a id="VLAN_29"></a>三、VLAN的基本概念</h2> 
<p>参考文献：https://blog.csdn.net/qq_38265137/article/details/80390759</p> 
<h3><a id="1_VLAN_32"></a>1、 VLAN标签</h3> 
<p>要使得设备能够分辨不同的VLAN的报文，需要在报文中添加标识VLAN信息的字段，IEEE802.1Q协议规定，在以太网数据帧的目的MAC地址和源MAC地址字段之后，协议类型之前，加上4个字节的VLAN标签（又称VLAN tag，简称Tag），用以标识VLAN信息。</p> 
<p><img src="https://images2.imgbox.com/1a/1b/2IefieWc_o.png" alt="d11602b7a168c4597e34c0de6e343b3"></p> 
<p><strong>字段解释：</strong></p> 
<p><strong>●TPID</strong>：2字节（Tag Prototcol Identifier：标签协议标识符）表示数据帧类型。</p> 
<p><strong>●Priority</strong>：3位，表示数据帧的802.1Q优先级。</p> 
<p><strong>●CFI</strong>：1位，（Canonical Format Indicator：标准格式指示为）表示MAC地址在不同的传输介质中是否以标准格式进行封装，用于兼容以太网和令牌环网。</p> 
<p><strong>●VID</strong>：12位，VLAN ID ，表示该数据帧所属VLAN的编号。</p> 
<p><strong><u>●注意：设备利用VLAN 标签中的VID来标识数据帧所属的VLAN，广播帧指在同一VLAN内转发，这就将广播域限制在一个VLAN内。</u></strong></p> 
<h3><a id="2_VLAN_50"></a>2、 常用设备收发数据帧的VLAN标签情况</h3> 
<h4><a id="21_VLAN_52"></a>2.1 在一个VLAN交换网络中，以太网帧主要有以下两种格式：</h4> 
<p>●有标记帧（Tagged帧）:加入了4字节VLAN标签的帧。</p> 
<p>●无标记帧（Untagged帧）：原始的、没加入4字节VLAN标签的帧</p> 
<h4><a id="22___58"></a>2.2 链路类型和接口类型</h4> 
<p>●设备内部处理的数据帧一律都带有VLAN标签，而网中的设备有些只会收发Untagged帧，要与这些设备交互，就需要接口能够识别Untagged帧并在收发时给帧添加、剥除VLAN标签。</p> 
<p>●网络中属于同一个VLAN的用户可能会被连接在不同的设备上，且跨越设备的VLAN可能不止一个，如果需要用户间的互通，就需要设备间的接口能够同时识别和发送多个VLAN的数据帧。</p> 
<p>●为了适应不同连接和组网，设备定义了Access接口、Trunk接口和Hybrid接口三种接口类型，以及接入链路（Access Link）和干道链路（Trunk Link）两种链路类型。</p> 
<h5><a id="_66"></a>①链路类型</h5> 
<p>根据链路中需要承载的VLAN数目的不同，以太网链路分为：</p> 
<p><strong>●接入链路</strong></p> 
<p>接入链路指可以承载一个VLAN的数据帧，用于连接设备和用户终端，通常情况下，用户终端并不需要知道自己属于哪个VLAN，也不能识别带有Tag的帧，所以在接入链路上传输的帧都是Untagged帧。</p> 
<p><strong>●干道链路</strong></p> 
<p>干道链路可以承载多个不同VLAN的数据帧，用于设备间互连。为了保证其它网络设备能够正确识别数据帧的VLAN信息，在干道链路上传输的数据帧必须都打上Tag。</p> 
<h5><a id="_78"></a>②接口类型</h5> 
<p>根据接口连接对象以及对收发数据帧处理的不同，以太网接口分为：</p> 
<p><strong>●Access接口</strong></p> 
<p>接入模式，一般用于连接计算机或路由器的接口。作用：数据在进行交换时，打上vlan标签，出交换机时，脱掉vlan标签。</p> 
<p><strong>●trunk接口</strong></p> 
<p>中继链路，一般用于连接交换机和交换机之间，作用：它可以允许多个VLAN的帧带Tag通过，但指允许一个VLAN的帧从该类接口上发出时不带Tag。</p> 
<p><strong>●Hybrid接口</strong></p> 
<p>华为私有协议，华为交换机接口上默认的接口类型</p> 
<h3><a id="3_VLAN_94"></a>3、 缺省VLAN</h3> 
<p>●缺省VLAN又称PVID（port default vlan id）。前面提到，设备处理的数据帧都带Tag，当设备收到Untagged帧时，就需要给该帧添加Tag，添加什么Tag，就由接口上的缺省Vlan决定。</p> 
<p>●接口收发数据帧时，对于Tag的添加或剥除过程。</p> 
<p>●对于Access接口，缺省VLAN就是它允许通过的VLAN，修改缺省VLAN即可更改接口允许通过的VLAN。</p> 
<p>●对于Trunk接口和Hybrid接口，一个接口可以允许多个VLAN通过，但是只能有一个缺省VLAN。接口的缺省VLAN和允许通过的VLAN需要分别配置，互不影响。</p> 
<table><thead><tr><th>接口类型</th><th>对接收不带Tag的处理</th><th>对于接收带Tag的处理</th><th>发送帧处理过程</th></tr></thead><tbody><tr><td>Access接口</td><td>接收该数据，并打上缺省的VLAN ID</td><td>当VLAN ID与缺省 ID相同时，接收该数据，不同时，则丢弃。</td><td>先剥离帧的PCID Tag，然后再发送。</td></tr><tr><td>Trunk接口</td><td>打上缺省的VLAN ID，当缺省VLAN ID在允许通过的VLAN ID列表时，接收该数据，不在允许通过列表里，丢弃该报文。</td><td>当VLAN ID在接口允许通过的VLAN ID列表里时，接收该报文，不在列表里，则丢弃。</td><td>当VLAN ID与缺省VLAN ID相同，且是该接口允许通过的VLAN ID时，去掉Tag，发送该数据。当VLAN ID与缺省VLAN ID不同时，且是该接口允许通过的VLAN ID时，保持原有的Tag，发送数据</td></tr><tr><td>Hybrid接口</td><td>同上</td><td>同上</td><td>当VLAN ID是该接口允许通过的VLAN ID时，发送该报文。可以通过命令设置发送时是否携带Tag。</td></tr></tbody></table> 
<h2><a id="VLAN_110"></a>四、VLAN配置</h2> 
<p><img src="https://images2.imgbox.com/28/f4/qrSl7xRA_o.png" alt="image-20220425164155532"></p> 
<p>●由上图分析可知，pc1和pc3和pc5需要在vlan 10中，pc2和pc4要在vlan 20中。通vlan之间要能完成相互通信，且pc6为不同网段，需要进行路由器转发。</p> 
<p>●SW1交换机中e0/0/1到e0/0/3接口为access类型（接口类型），e0/0/4类型为trunk类型（链路类型）</p> 
<p>●SW2交换机中e0/0/1和e0/0/2接口为access类型（接口类型），e0/0/3类型为trunk类型（链路类型）</p> 
<h3><a id="SW1_120"></a>●交换机SW1配置</h3> 
<pre><code>&lt;Huawei&gt;sys	
&lt;Huawei&gt;system-view      ###进入系统模式
Enter system view, return user view with Ctrl+Z.
[Huawei]sysname SW1      ###修改名称为SW1

[SW1]undo info-center enable     ###取消消息提示中心
Info: Information center is disabled.
[SW1]vlan batch 10 20       ###批量创建vlan
Info: This operation may take a few seconds. Please wait for a moment...done.
[SW1]dis vlan         ###查看vlan信息

[SW1]int e0/0/1     ###进入接口e0/0/1
[SW1-Ethernet0/0/1]port link-type access      ###设置接口类型为access类型
[SW1-Ethernet0/0/1]port default vlan 10        ###设置pvid 为vlan 10
[SW1-Ethernet0/0/1]undo shutdown         ###启动接口
Info: Interface Ethernet0/0/1 is not shutdown.
[SW1-Ethernet0/0/1]di th     ###查看接口信息
#
interface Ethernet0/0/1
 port link-type access
 port default vlan 10
#
return

[SW1-Ethernet0/0/1]int e0/0/2            ###进入接口e0/0/2
[SW1-Ethernet0/0/2]port link-type access    ###设置接口类型为access类型
[SW1-Ethernet0/0/2]port default vlan 20         ###设置pvid 为vlan20
[SW1-Ethernet0/0/2]undo shutdown     ###启动接口
Info: Interface Ethernet0/0/2 is not shutdown.
[SW1-Ethernet0/0/2]di th    ###查看接口信息
#
interface Ethernet0/0/2
 port link-type access
 port default vlan 20
#
return

[SW1-Ethernet0/0/2]int e0/0/3            ###进入接口e0/0/3
[SW1-Ethernet0/0/3]port link-type access    ###设置接口类型为access类型
[SW1-Ethernet0/0/3]port default vlan 10        ###设置pvid 为vlan 10
[SW1-Ethernet0/0/3]undo shutdown     ###启动接口
Info: Interface Ethernet0/0/3 is not shutdown.
[SW1-Ethernet0/0/3]di th    ###查看接口信息
#
interface Ethernet0/0/3
 port link-type access
 port default vlan 10
#
return

[SW1-Ethernet0/0/3]int e0/0/4          ###进入接口e0/0/4
[SW1-Ethernet0/0/4]port link-type trunk     ###设置接口类型为trunk类型
[SW1-Ethernet0/0/4]port trunk allow-pass vlan 10 20   ###设置允许通过vlan为 10和20
[SW1-Ethernet0/0/4]undo shutdown      ###启动接口
Info: Interface Ethernet0/0/4 is not shutdown.
[SW1-Ethernet0/0/4]di th    ###查看接口信息
# 
interface Ethernet0/0/4
 port link-type trunk
 port trunk allow-pass vlan 10 20
#
return

[SW1-Ethernet0/0/4]int e0/0/5          ###进入接口e0/0/5
[SW1-Ethernet0/0/5]port link-type access    ###设置接口类型为access类型
[SW1-Ethernet0/0/5]port default vlan 20         ###设置pvid 为vlan 20
[SW1-Ethernet0/0/5]undo shutdown       ###启动接口
Info: Interface Ethernet0/0/5 is not shutdown.
[SW1-Ethernet0/0/5]di th    ###查看接口信息
#
interface Ethernet0/0/5
 port link-type access
 port default vlan 20
#
return
</code></pre> 
<p><strong>注意：其中e0/0/5接口不仅可以配access接口，也可以配置trunk，配置trunk之后要设置缺省（PVID）不设置的话将会发出带有Tag的标签的数据，路由器无法识别，所以要脱除标签。配置如下：</strong></p> 
<pre><code>[SW1]int e0/0/5    ###进入接口
[SW1-Ethernet0/0/5]undo port default vlan    ###删除以前配置pvid

[SW1-Ethernet0/0/5]port link-type trunk   ###设置新的trunk
[SW1-Ethernet0/0/5]port trunk allow-pass vlan 20     ###设置允许通过vlan为20
[SW1-Ethernet0/0/5]port trunk pvid vlan 20      ### 设置pvid为vlan 20
[SW1-Ethernet0/0/5]undo shutdown    ###启动接口
Info: Interface Ethernet0/0/5 is not shutdown.
[SW1-Ethernet0/0/5]di th     ###查看当前接口
#
interface Ethernet0/0/5
 port link-type trunk
 port trunk pvid vlan 20
 port trunk allow-pass vlan 20
#
return
</code></pre> 
<h3><a id="SW2_220"></a>●交换机SW2配置</h3> 
<pre><code>&lt;Huawei&gt;sys	
&lt;Huawei&gt;system-view    ###进入系统视图
Enter system view, return user view with Ctrl+Z.
[Huawei]sysname SW2     ###修改名称为SW2	

[SW2]undo info-center enable   ###取消消息提示中心
Info: Information center is disabled.
[SW2]vlan batch 10 20    ###批量创建vlan 10 20
Info: This operation may take a few seconds. Please wait for a moment...done.

[SW2]int e0/0/1   ###进入接口e0/0/1
[SW2-Ethernet0/0/1]port link-type access    ###设置类型为access类型
[SW2-Ethernet0/0/1]port default vlan 20        ###设置pvid 为vlan 20
[SW2-Ethernet0/0/1]undo shutdown     ###启动接口
Info: Interface Ethernet0/0/1 is not shutdown.
[SW2-Ethernet0/0/1]di th   ###查看接口
#
interface Ethernet0/0/1
 port link-type access
 port default vlan 20
#
return

[SW2-Ethernet0/0/1]int e0/0/2     ###进入接口e0/0/2
[SW2-Ethernet0/0/2]port link-type access    ###设置类型为access类型
[SW2-Ethernet0/0/2]port default vlan 10        ###设置pvid 为vlan 10

[SW2-Ethernet0/0/2]undo shutdown    #启动接口
Info: Interface Ethernet0/0/2 is not shutdown.
[SW2-Ethernet0/0/2]di th    ###查看当前接口
#
interface Ethernet0/0/2
 port link-type access
 port default vlan 10
#
return

[SW2-Ethernet0/0/2]int e0/0/3     ###进入接口e0/0/3
[SW2-Ethernet0/0/3]port link-type trunk        ###设置类型为trunk类型
[SW2-Ethernet0/0/3]port trunk allow-pass vlan 10 20   ###设置允许通过vlan为10 20
[SW2-Ethernet0/0/3]undo shutdown    ###启动端口
Info: Interface Ethernet0/0/3 is not shutdown.
[SW2-Ethernet0/0/3]di th    ###查看当前端口
#
interface Ethernet0/0/3
 port link-type trunk
 port trunk allow-pass vlan 10 20
#
return
</code></pre> 
<h3><a id="AR1_274"></a>●路由器AR1</h3> 
<p>只需要设置两个接口的ip地址就行。两个接口的ip均为两个相连主机的网关，所以不需要设置静态路由。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4b072e106d3ae2668d6f6ec70b57c0e1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ubuntu 18.04 安装 spconf 1.2</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cf36f20ec84abaab5d33c1528f638057/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">javase面试知识总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>