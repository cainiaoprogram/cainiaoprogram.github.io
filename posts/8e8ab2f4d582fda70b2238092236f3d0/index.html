<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android 12 FileProvider - èœé¸Ÿç¨‹åºå‘˜åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android 12 FileProvider" />
<meta property="og:description" content="ç›¸æœºæ‹ç…§ã€ä¸‹è½½ã€å­˜å‚¨ç…§ç‰‡ç­‰ï¼Œåœ¨åˆ«çš„Androidç‰ˆæœ¬é‡Œéƒ½èƒ½ç”¨ï¼Œä¸ºå•¥åœ¨Android12é‡Œç”¨ä¸äº†ï¼Ÿ é’ˆå¯¹ğŸ‘†çš„é—®é¢˜ï¼Œå…¶å®ä¹Ÿä¸èƒ½è¿™ä¹ˆè¯´ï¼Œæ¯”å¦‚ä½ çš„targetSdkVersionå°äº30ï¼ŒAndroid12 ä¹Ÿä¸ä¼šä¸èƒ½ç”¨ã€‚ä¸‹é¢çœ‹çœ‹ä¸èƒ½ç”¨æ—¶çš„å¤„ç†æ–¹æ³•ï¼š
æ¸…å•æ–‡ä»¶ä¸­è®¾ç½®provider &lt;provider android:name=&#34;androidx.core.content.FileProvider&#34; android:authorities=&#34;${applicationId}.fileprovider&#34; android:exported=&#34;false&#34; android:grantUriPermissions=&#34;true&#34;&gt; &lt;meta-data android:name=&#34;android.support.FILE_PROVIDER_PATHS&#34; android:resource=&#34;@xml/provider_paths&#34; /&gt; &lt;/provider&gt; å…¶ä¸­çš„xmlï¼Œprovider_pathsä¸º
&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt; &lt;paths&gt; &lt;external-path name=&#34;files_root&#34; path=&#34;Android/data/${applicationId}/&#34;/&gt; &lt;external-path name=&#34;DCIM&#34; path=&#34;.&#34;/&gt; &lt;/paths&gt; è°ƒç”¨ //ç”¨äºä¿å­˜è°ƒç”¨ç›¸æœºæ‹ç…§åæ‰€ç”Ÿæˆçš„æ–‡ä»¶ tempFile = new File(Environment.getExternalStorageDirectory().getPath() &#43; &#34;/DCIM/&#34;, System.currentTimeMillis() &#43; &#34;.jpg&#34;); //è·³è½¬åˆ°è°ƒç”¨ç³»ç»Ÿç›¸æœº Intent intent = new Intent(MediaStore.ACTION_IMAGE_CAPTURE); //åˆ¤æ–­ç‰ˆæœ¬ if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) { //å¦‚æœåœ¨Android7.0ä»¥ä¸Š,ä½¿ç”¨FileProviderè·å–Uri intent.setFlags(Intent.FLAG_GRANT_WRITE_URI_PERMISSION); Uri contentUri = FileProvider.getUriForFile(this, AppPFContants.getProviderName(), tempFile); intent.putExtra(MediaStore.EXTRA_OUTPUT, contentUri); Log.e(&#34;contentUri&#34;, contentUri.toString()); } else { //å¦åˆ™ä½¿ç”¨Uri.fromFile(file)æ–¹æ³•è·å–Uri intent.putExtra(MediaStore.EXTRA_OUTPUT, Uri.fromFile(tempFile)); } å…¶å®èµ°åˆ°è¿™ä¸€æ­¥ï¼Œåº”è¯¥è·Ÿä½ ä»£ç é‡Œä¸€æ ·ï¼Œå¦‚æœä½ çš„ä¾æ—§åƒæˆ‘ä¹‹å‰ä¸€æ ·ä¸èƒ½ç”¨ï¼Œé‚£ä¹ˆä½ éœ€è¦æ³¨æ„ä¸‹ï¼Œä½ çš„Environment.getExternalStorageDirectory().getPath() &#43; &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/8e8ab2f4d582fda70b2238092236f3d0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-21T14:17:30+08:00" />
<meta property="article:modified_time" content="2022-01-21T14:17:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="èœé¸Ÿç¨‹åºå‘˜åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">èœé¸Ÿç¨‹åºå‘˜åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android 12 FileProvider</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="AndroidAndroid12_0"></a>ç›¸æœºæ‹ç…§ã€ä¸‹è½½ã€å­˜å‚¨ç…§ç‰‡ç­‰ï¼Œåœ¨åˆ«çš„Androidç‰ˆæœ¬é‡Œéƒ½èƒ½ç”¨ï¼Œä¸ºå•¥åœ¨Android12é‡Œç”¨ä¸äº†ï¼Ÿ</h3> 
<p>é’ˆå¯¹ğŸ‘†çš„é—®é¢˜ï¼Œå…¶å®ä¹Ÿä¸èƒ½è¿™ä¹ˆè¯´ï¼Œæ¯”å¦‚ä½ çš„<strong>targetSdkVersion</strong>å°äº<strong>30</strong>ï¼ŒAndroid12 ä¹Ÿä¸ä¼šä¸èƒ½ç”¨ã€‚ä¸‹é¢çœ‹çœ‹ä¸èƒ½ç”¨æ—¶çš„å¤„ç†æ–¹æ³•ï¼š</p> 
<ul><li>æ¸…å•æ–‡ä»¶ä¸­è®¾ç½®provider</li></ul> 
<pre><code> &lt;provider
            android:name="androidx.core.content.FileProvider"
            android:authorities="${applicationId}.fileprovider"
            android:exported="false"
            android:grantUriPermissions="true"&gt;
            &lt;meta-data
                android:name="android.support.FILE_PROVIDER_PATHS"
                android:resource="@xml/provider_paths" /&gt;
        &lt;/provider&gt;
      
</code></pre> 
<p>å…¶ä¸­çš„xmlï¼Œprovider_pathsä¸º</p> 
<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;paths&gt;
    &lt;external-path
            name="files_root"
            path="Android/data/${applicationId}/"/&gt;
    &lt;external-path
            name="DCIM"
        path="."/&gt;
&lt;/paths&gt;
</code></pre> 
<ul><li>è°ƒç”¨</li></ul> 
<pre><code> //ç”¨äºä¿å­˜è°ƒç”¨ç›¸æœºæ‹ç…§åæ‰€ç”Ÿæˆçš„æ–‡ä»¶
        tempFile = new File(Environment.getExternalStorageDirectory().getPath() + "/DCIM/", System.currentTimeMillis() + ".jpg");
        //è·³è½¬åˆ°è°ƒç”¨ç³»ç»Ÿç›¸æœº
        Intent intent = new Intent(MediaStore.ACTION_IMAGE_CAPTURE);
        //åˆ¤æ–­ç‰ˆæœ¬
        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) {   //å¦‚æœåœ¨Android7.0ä»¥ä¸Š,ä½¿ç”¨FileProviderè·å–Uri
            intent.setFlags(Intent.FLAG_GRANT_WRITE_URI_PERMISSION);
            Uri contentUri = FileProvider.getUriForFile(this, AppPFContants.getProviderName(), tempFile);
            intent.putExtra(MediaStore.EXTRA_OUTPUT, contentUri);
            Log.e("contentUri", contentUri.toString());
        } else {    //å¦åˆ™ä½¿ç”¨Uri.fromFile(file)æ–¹æ³•è·å–Uri
            intent.putExtra(MediaStore.EXTRA_OUTPUT, Uri.fromFile(tempFile));
        }
</code></pre> 
<p>å…¶å®èµ°åˆ°è¿™ä¸€æ­¥ï¼Œåº”è¯¥è·Ÿä½ ä»£ç é‡Œä¸€æ ·ï¼Œå¦‚æœä½ çš„ä¾æ—§åƒæˆ‘ä¹‹å‰ä¸€æ ·ä¸èƒ½ç”¨ï¼Œé‚£ä¹ˆä½ éœ€è¦æ³¨æ„ä¸‹ï¼Œä½ çš„<code>Environment.getExternalStorageDirectory().getPath() + "/DCIM/"</code>è·¯å¾„ä¸­æ–‡ä»¶å¤¹çš„å‘½åï¼›<br> æ¯”å¦‚å›¾ç‰‡å­˜å‚¨<code>Environment.getExternalStorageDirectory().getPath() + "/DCIM/"</code> ä¸­çš„<strong>DCIM</strong>å¿…é¡»æ˜¯<strong>DCIM</strong><br> appä¸‹è½½åˆ™æ˜¯<strong>Download</strong><br> å°±æ˜¯è¯´é«˜ç‰ˆæœ¬ç°åœ¨ä¸å…è®¸ï¼Œç§è‡ªå‘½åæ–‡ä»¶å¤¹åå­—äº†ï¼Œå…¶ä»–çš„è‡ªå·±æ‰¾ä¸€æ‰¾å§</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cde448ae649c626ddb4dce7ccb336be0/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">ä½¿ç”¨latexæ’°å†™ElsevieråŒæ è®ºæ–‡ï¼Œè¡¨æ ¼æ ‡é¢˜captionå·¦å¯¹é½é—®é¢˜</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d8cfda6d25dfb6997ee73aebf03c5026/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">httpsåŠ å¯†çš„å®ç°</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 èœé¸Ÿç¨‹åºå‘˜åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>