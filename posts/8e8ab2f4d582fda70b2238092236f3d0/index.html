<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android 12 FileProvider - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android 12 FileProvider" />
<meta property="og:description" content="相机拍照、下载、存储照片等，在别的Android版本里都能用，为啥在Android12里用不了？ 针对👆的问题，其实也不能这么说，比如你的targetSdkVersion小于30，Android12 也不会不能用。下面看看不能用时的处理方法：
清单文件中设置provider &lt;provider android:name=&#34;androidx.core.content.FileProvider&#34; android:authorities=&#34;${applicationId}.fileprovider&#34; android:exported=&#34;false&#34; android:grantUriPermissions=&#34;true&#34;&gt; &lt;meta-data android:name=&#34;android.support.FILE_PROVIDER_PATHS&#34; android:resource=&#34;@xml/provider_paths&#34; /&gt; &lt;/provider&gt; 其中的xml，provider_paths为
&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt; &lt;paths&gt; &lt;external-path name=&#34;files_root&#34; path=&#34;Android/data/${applicationId}/&#34;/&gt; &lt;external-path name=&#34;DCIM&#34; path=&#34;.&#34;/&gt; &lt;/paths&gt; 调用 //用于保存调用相机拍照后所生成的文件 tempFile = new File(Environment.getExternalStorageDirectory().getPath() &#43; &#34;/DCIM/&#34;, System.currentTimeMillis() &#43; &#34;.jpg&#34;); //跳转到调用系统相机 Intent intent = new Intent(MediaStore.ACTION_IMAGE_CAPTURE); //判断版本 if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) { //如果在Android7.0以上,使用FileProvider获取Uri intent.setFlags(Intent.FLAG_GRANT_WRITE_URI_PERMISSION); Uri contentUri = FileProvider.getUriForFile(this, AppPFContants.getProviderName(), tempFile); intent.putExtra(MediaStore.EXTRA_OUTPUT, contentUri); Log.e(&#34;contentUri&#34;, contentUri.toString()); } else { //否则使用Uri.fromFile(file)方法获取Uri intent.putExtra(MediaStore.EXTRA_OUTPUT, Uri.fromFile(tempFile)); } 其实走到这一步，应该跟你代码里一样，如果你的依旧像我之前一样不能用，那么你需要注意下，你的Environment.getExternalStorageDirectory().getPath() &#43; &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/8e8ab2f4d582fda70b2238092236f3d0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-21T14:17:30+08:00" />
<meta property="article:modified_time" content="2022-01-21T14:17:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android 12 FileProvider</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="AndroidAndroid12_0"></a>相机拍照、下载、存储照片等，在别的Android版本里都能用，为啥在Android12里用不了？</h3> 
<p>针对👆的问题，其实也不能这么说，比如你的<strong>targetSdkVersion</strong>小于<strong>30</strong>，Android12 也不会不能用。下面看看不能用时的处理方法：</p> 
<ul><li>清单文件中设置provider</li></ul> 
<pre><code> &lt;provider
            android:name="androidx.core.content.FileProvider"
            android:authorities="${applicationId}.fileprovider"
            android:exported="false"
            android:grantUriPermissions="true"&gt;
            &lt;meta-data
                android:name="android.support.FILE_PROVIDER_PATHS"
                android:resource="@xml/provider_paths" /&gt;
        &lt;/provider&gt;
      
</code></pre> 
<p>其中的xml，provider_paths为</p> 
<pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;paths&gt;
    &lt;external-path
            name="files_root"
            path="Android/data/${applicationId}/"/&gt;
    &lt;external-path
            name="DCIM"
        path="."/&gt;
&lt;/paths&gt;
</code></pre> 
<ul><li>调用</li></ul> 
<pre><code> //用于保存调用相机拍照后所生成的文件
        tempFile = new File(Environment.getExternalStorageDirectory().getPath() + "/DCIM/", System.currentTimeMillis() + ".jpg");
        //跳转到调用系统相机
        Intent intent = new Intent(MediaStore.ACTION_IMAGE_CAPTURE);
        //判断版本
        if (Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.N) {   //如果在Android7.0以上,使用FileProvider获取Uri
            intent.setFlags(Intent.FLAG_GRANT_WRITE_URI_PERMISSION);
            Uri contentUri = FileProvider.getUriForFile(this, AppPFContants.getProviderName(), tempFile);
            intent.putExtra(MediaStore.EXTRA_OUTPUT, contentUri);
            Log.e("contentUri", contentUri.toString());
        } else {    //否则使用Uri.fromFile(file)方法获取Uri
            intent.putExtra(MediaStore.EXTRA_OUTPUT, Uri.fromFile(tempFile));
        }
</code></pre> 
<p>其实走到这一步，应该跟你代码里一样，如果你的依旧像我之前一样不能用，那么你需要注意下，你的<code>Environment.getExternalStorageDirectory().getPath() + "/DCIM/"</code>路径中文件夹的命名；<br> 比如图片存储<code>Environment.getExternalStorageDirectory().getPath() + "/DCIM/"</code> 中的<strong>DCIM</strong>必须是<strong>DCIM</strong><br> app下载则是<strong>Download</strong><br> 就是说高版本现在不允许，私自命名文件夹名字了，其他的自己找一找吧</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cde448ae649c626ddb4dce7ccb336be0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用latex撰写Elsevier双栏论文，表格标题caption左对齐问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d8cfda6d25dfb6997ee73aebf03c5026/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">https加密的实现</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>