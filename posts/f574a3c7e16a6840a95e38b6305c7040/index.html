<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>QGraphicsView图形视图框架使用(四)自定义Item - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="QGraphicsView图形视图框架使用(四)自定义Item" />
<meta property="og:description" content="文章目录 图元创建事件处理状态处理尺寸修改样例代码 QGraphics View允许我们通过子类化QGraphicsItem实现自定的图元。这里就介绍一下自定义图元的实现方式和一些需要注意的问题。这里以一个正弦波曲线图元为例进行说明。 图元创建 首先在工程中添加一个基于QGraphicsItem的C&#43;&#43;类，然后在头文件的QGraphicsItem类名称上按Alt&#43;Enter快捷键，在弹出的窗口中选择需要重载的函数，该快捷键只在QtCreator中生效，如果你使用的是Visual Studio &#43; QT，是不可以的。对应的界面如下所示:
当然，我们也可以手动添加对应的重载函数。实现自定义Item有两个接口是必须实现的分别如下:
//返回图元的边界 QRectF boundingRect() const; //添加图元的自定义绘制 void paint(QPainter *painter, const QStyleOptionGraphicsItem *option, QWidget *widget); 这里我们定义的图元显示的是振幅为5的正弦波曲线，对应的函数是y=5sin(x)。对应的边界矩形如下所示:
QRectF SineItem::boundingRect() const { //左上角的坐标是(0,-5)矩形 //宽度m_maxX可以通过外部设置,默认是30 //高度就是正弦曲线的振幅的两倍10 return QRectF(0, -5, m_maxX, 10); } 矩形对应的X的范围是(0，30),Y的范围是(-5,5)。
正弦曲线的绘制方法如下:
void SineItem::paint(QPainter *painter, const QStyleOptionGraphicsItem *option, QWidget *widget) { Q_UNUSED(option) Q_UNUSED(widget) QPen pen; //缩放的时候保持固定线宽 pen.setCosmetic(true); //采样间隔 qreal dx = 0.5; painter-&gt;setPen(pen); painter-&gt;drawLine(-50, 0, 50, 0); painter-&gt;drawLine(0, -50, 0, 50); const int steps = qRound(m_maxX / dx); QPointF previousPoint(0, sin(0)); for(int i = 1; i &lt; steps; &#43;&#43;i) { const float x = dx * i; QPointF point(x, 5*sin(x)); painter-&gt;drawLine(previousPoint, point); previousPoint = point; } } 这里的采样间隔也就是绘制的步长是是固定的0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/f574a3c7e16a6840a95e38b6305c7040/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-13T20:57:53+08:00" />
<meta property="article:modified_time" content="2022-07-13T20:57:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">QGraphicsView图形视图框架使用(四)自定义Item</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_2" rel="nofollow">图元创建</a></li><li><a href="#_61" rel="nofollow">事件处理</a></li><li><a href="#_233" rel="nofollow">状态处理</a></li><li><a href="#_288" rel="nofollow">尺寸修改</a></li><li><a href="#_339" rel="nofollow">样例代码</a></li></ul> 
 </li></ul> 
</div> 
<br> QGraphics View允许我们通过子类化QGraphicsItem实现自定的图元。这里就介绍一下自定义图元的实现方式和一些需要注意的问题。这里以一个正弦波曲线图元为例进行说明。 
<p></p> 
<h3><a id="_2"></a>图元创建</h3> 
<p>首先在工程中添加一个基于QGraphicsItem的C++类，然后在头文件的QGraphicsItem类名称上按Alt+Enter快捷键，在弹出的窗口中选择需要重载的函数，该快捷键只在QtCreator中生效，如果你使用的是Visual Studio + QT，是不可以的。对应的界面如下所示:<br> <img src="https://images2.imgbox.com/f2/e4/dgt2Ivbz_o.png" alt="在这里插入图片描述"><br> 当然，我们也可以手动添加对应的重载函数。实现自定义Item有两个接口是必须实现的分别如下:</p> 
<pre><code class="prism language-cpp"> <span class="token comment">//返回图元的边界</span>
 QRectF <span class="token function">boundingRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
 
 <span class="token comment">//添加图元的自定义绘制</span>
 <span class="token keyword">void</span> <span class="token function">paint</span><span class="token punctuation">(</span>QPainter <span class="token operator">*</span>painter<span class="token punctuation">,</span> <span class="token keyword">const</span> QStyleOptionGraphicsItem <span class="token operator">*</span>option<span class="token punctuation">,</span> QWidget <span class="token operator">*</span>widget<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这里我们定义的图元显示的是振幅为5的正弦波曲线，对应的函数是y=5sin(x)。对应的边界矩形如下所示:</p> 
<pre><code class="prism language-cpp">QRectF <span class="token class-name">SineItem</span><span class="token double-colon punctuation">::</span><span class="token function">boundingRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//左上角的坐标是(0,-5)矩形</span>
    <span class="token comment">//宽度m_maxX可以通过外部设置,默认是30</span>
    <span class="token comment">//高度就是正弦曲线的振幅的两倍10</span>
    <span class="token keyword">return</span> <span class="token function">QRectF</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> m_maxX<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>矩形对应的X的范围是(0，30),Y的范围是(-5,5)。<br> 正弦曲线的绘制方法如下:</p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">SineItem</span><span class="token double-colon punctuation">::</span><span class="token function">paint</span><span class="token punctuation">(</span>QPainter <span class="token operator">*</span>painter<span class="token punctuation">,</span> <span class="token keyword">const</span> QStyleOptionGraphicsItem <span class="token operator">*</span>option<span class="token punctuation">,</span> QWidget <span class="token operator">*</span>widget<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">Q_UNUSED</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span>
    <span class="token function">Q_UNUSED</span><span class="token punctuation">(</span>widget<span class="token punctuation">)</span>
    QPen pen<span class="token punctuation">;</span>
    <span class="token comment">//缩放的时候保持固定线宽</span>
    pen<span class="token punctuation">.</span><span class="token function">setCosmetic</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//采样间隔</span>
    qreal dx <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
    painter<span class="token operator">-&gt;</span><span class="token function">setPen</span><span class="token punctuation">(</span>pen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    painter<span class="token operator">-&gt;</span><span class="token function">drawLine</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    painter<span class="token operator">-&gt;</span><span class="token function">drawLine</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">const</span> <span class="token keyword">int</span> steps <span class="token operator">=</span> <span class="token function">qRound</span><span class="token punctuation">(</span>m_maxX <span class="token operator">/</span> dx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    QPointF <span class="token function">previousPoint</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">sin</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> steps<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> <span class="token keyword">float</span> x <span class="token operator">=</span> dx <span class="token operator">*</span> i<span class="token punctuation">;</span>
        QPointF <span class="token function">point</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">5</span><span class="token operator">*</span><span class="token function">sin</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        painter<span class="token operator">-&gt;</span><span class="token function">drawLine</span><span class="token punctuation">(</span>previousPoint<span class="token punctuation">,</span> point<span class="token punctuation">)</span><span class="token punctuation">;</span>
        previousPoint <span class="token operator">=</span> point<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这里的采样间隔也就是绘制的步长是是固定的0.5，固定的间隔会带来一个问题，如果间隔太短会带来性能损耗，如果间隔太大在视图缩放的时候，会出现绘制曲线不平滑的问题,如下图所示:<br> <img src="https://images2.imgbox.com/af/d5/Flc5W86I_o.png" alt="在这里插入图片描述"></p> 
<p>如果采样间隔可以根据缩放比例自动适配就好了。其实QGraphicsView是支持动态获取缩放比例的，所以我们可以根据缩放比例，动态调整采样间隔对应的设置如下:</p> 
<pre><code class="prism language-cpp"><span class="token comment">//采样间隔</span>
<span class="token comment">//获取缩放系数</span>
<span class="token keyword">const</span> qreal detail <span class="token operator">=</span> <span class="token class-name">QStyleOptionGraphicsItem</span><span class="token double-colon punctuation">::</span><span class="token function">levelOfDetailFromTransform</span><span class="token punctuation">(</span>painter<span class="token operator">-&gt;</span><span class="token function">worldTransform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//计算精度</span>
<span class="token keyword">const</span> qreal dx <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> detail<span class="token punctuation">;</span>
</code></pre> 
<p>通过动态设置采样精度我们就可以避免在缩放的时候出现曲线不平滑的问题了。</p> 
<h3><a id="_61"></a>事件处理</h3> 
<p>QGraphicsView中自定义的图元也可以通过QT框架的事件循环机制来处理对应的消息事件。我们通过各种事件的自定义处理完成各种各样的个性化操作。如果我们在事件处理完毕之后accpet()了事件，那么该事件就不会被后续对象处理，如果没有accept()事件那么它还会被他的父对象接收到，这样我们就可以在自定义图元中控制事件的生命周期了。</p> 
<p>常见的事件列表如下:</p> 
<table><thead><tr><th align="left">事件名称</th><th align="left">介绍</th></tr></thead><tbody><tr><td align="left">QEvent::KeyPress<br>QEvent::KeyRelease</td><td align="left">按键按下事件<br>按键释放事件</td></tr><tr><td align="left">QEvent::MouseButtonPress<br>QEvent::MouseButtonRelease<br>QEvent::MouseButtonDblClick<br>QEvent::Wheel<br>QEvent::MouseMove</td><td align="left">鼠标点击按下事件<br>鼠标点击释放事件<br>鼠标双击事件<br>鼠标滚轮事件<br>鼠标移动事件</td></tr><tr><td align="left">QEvent::Enter</td><td align="left">鼠标进入对象的事件</td></tr><tr><td align="left">Event::Leave</td><td align="left">鼠标离开对象的事件</td></tr><tr><td align="left">QEvent::Resize</td><td align="left">控件尺寸变化的事件</td></tr><tr><td align="left">QEvent::Close</td><td align="left">窗口关闭事件</td></tr><tr><td align="left">QEvent::ContextMenu</td><td align="left">打开上下文菜单的事件</td></tr><tr><td align="left">QEvent::Paint</td><td align="left">图形绘制事件</td></tr><tr><td align="left">QEvent::DragEnter<br>QEvent::DragLeave<br>QEvent::DragMove<br>QEvent::Drop</td><td align="left">拖拽和释放事件</td></tr><tr><td align="left">QEvent::TouchBegin<br>QEvent::TouchUpdate<br>QEvent::TouchEnd<br>QEvent::TouchCancel</td><td align="left">触摸事件，在嵌入式触摸屏里面调用</td></tr><tr><td align="left">QEvent::FocusIn<br>QEvent::FocusOut</td><td align="left">获得键盘焦点事件<br>失去键盘焦点事件</td></tr><tr><td align="left">QEvent::HoverEnter<br>QEvent::HoverLeave<br>QEvent::HoverMove</td><td align="left">悬浮进入事件<br>悬浮离开事件<br>悬浮移动事件</td></tr></tbody></table> 
<p>每个事件都有对应的事件处理函数，比如QMouseEvent对应的</p> 
<pre><code class="prism language-cpp"><span class="token class-name">QWidget</span><span class="token double-colon punctuation">::</span><span class="token function">mousePressEvent</span><span class="token punctuation">(</span>QMouseEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">QGraphicsItem</span><span class="token double-colon punctuation">::</span><span class="token function">mousePressEvent</span><span class="token punctuation">(</span>QGraphicsSceneMouseEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>由于QGraphicsItem对应的事件当中额外的携带了Scene中图元坐标信息等等，所以和QWidget的事件函数参数名称略有不同。</p> 
<p>对于一些比较少见的事件，我们可以在对应的事件循环函数中通过事件的类型来进行处理。对应的事件循环接口如下:</p> 
<pre><code class="prism language-cpp"><span class="token keyword">bool</span> <span class="token class-name">QWidget</span><span class="token double-colon punctuation">::</span><span class="token function">event</span><span class="token punctuation">(</span>QEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">bool</span> <span class="token class-name">QGraphicsItem</span><span class="token double-colon punctuation">::</span><span class="token function">sceneEvent</span><span class="token punctuation">(</span>QEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//通过event-&gt;type()获取事件的类型</span>
</code></pre> 
<p>QGraphicsItem的常见事件处理函数如下所示:</p> 
<pre><code class="prism language-cpp"><span class="token comment">//事件过滤函数</span>
<span class="token keyword">bool</span> <span class="token function">sceneEventFilter</span><span class="token punctuation">(</span>QGraphicsItem <span class="token operator">*</span>watched<span class="token punctuation">,</span> QEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//菜单事件</span>
<span class="token keyword">void</span> <span class="token function">contextMenuEvent</span><span class="token punctuation">(</span>QGraphicsSceneContextMenuEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//拖拽进入事件</span>
<span class="token keyword">void</span> <span class="token function">dragEnterEvent</span><span class="token punctuation">(</span>QGraphicsSceneDragDropEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//拖拽离开事件</span>
<span class="token keyword">void</span> <span class="token function">dragLeaveEvent</span><span class="token punctuation">(</span>QGraphicsSceneDragDropEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//拖拽移动事件</span>
<span class="token keyword">void</span> <span class="token function">dragMoveEvent</span><span class="token punctuation">(</span>QGraphicsSceneDragDropEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//拖拽释放事件</span>
<span class="token keyword">void</span> <span class="token function">dropEvent</span><span class="token punctuation">(</span>QGraphicsSceneDragDropEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//得到焦点的事件</span>
<span class="token keyword">void</span> <span class="token function">focusInEvent</span><span class="token punctuation">(</span>QFocusEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//失去焦点的事件</span>
<span class="token keyword">void</span> <span class="token function">focusOutEvent</span><span class="token punctuation">(</span>QFocusEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//悬浮进入事件</span>
<span class="token keyword">void</span> <span class="token function">hoverEnterEvent</span><span class="token punctuation">(</span>QGraphicsSceneHoverEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//悬浮移动事件</span>
<span class="token keyword">void</span> <span class="token function">hoverMoveEvent</span><span class="token punctuation">(</span>QGraphicsSceneHoverEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//悬浮离开事件</span>
<span class="token keyword">void</span> <span class="token function">hoverLeaveEvent</span><span class="token punctuation">(</span>QGraphicsSceneHoverEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//按键按下事件</span>
<span class="token keyword">void</span> <span class="token function">keyPressEvent</span><span class="token punctuation">(</span>QKeyEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//按键抬起事件</span>
<span class="token keyword">void</span> <span class="token function">keyReleaseEvent</span><span class="token punctuation">(</span>QKeyEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//鼠标按下事件</span>
<span class="token keyword">void</span> <span class="token function">mousePressEvent</span><span class="token punctuation">(</span>QGraphicsSceneMouseEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//鼠标移动事件</span>
<span class="token keyword">void</span> <span class="token function">mouseMoveEvent</span><span class="token punctuation">(</span>QGraphicsSceneMouseEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//鼠标释放事件</span>
<span class="token keyword">void</span> <span class="token function">mouseReleaseEvent</span><span class="token punctuation">(</span>QGraphicsSceneMouseEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//鼠标双击事件</span>
<span class="token keyword">void</span> <span class="token function">mouseDoubleClickEvent</span><span class="token punctuation">(</span>QGraphicsSceneMouseEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//滚轮事件</span>
<span class="token keyword">void</span> <span class="token function">wheelEvent</span><span class="token punctuation">(</span>QGraphicsSceneWheelEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//输入法事件</span>
<span class="token keyword">void</span> <span class="token function">inputMethodEvent</span><span class="token punctuation">(</span>QInputMethodEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这里，我们实现鼠标点击事件，我们在鼠标点击的曲线位置添加一个椭圆的图元，用来标记点击位置，对应的实现如下所示:</p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">SineItem</span><span class="token double-colon punctuation">::</span><span class="token function">mousePressEvent</span><span class="token punctuation">(</span>QGraphicsSceneMouseEvent <span class="token operator">*</span>event<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token operator">-&gt;</span><span class="token function">button</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Qt<span class="token double-colon punctuation">::</span>LeftButton<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">float</span> x <span class="token operator">=</span> event<span class="token operator">-&gt;</span><span class="token function">pos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        QPointF <span class="token function">point</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">5</span><span class="token operator">*</span><span class="token function">sin</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">//在对应的鼠标点击的位置添加一个椭圆图元</span>
        <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">float</span> r <span class="token operator">=</span> <span class="token number">0.3</span><span class="token punctuation">;</span>
        QGraphicsEllipseItem <span class="token operator">*</span>ellipse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QGraphicsEllipseItem</span><span class="token punctuation">(</span><span class="token operator">-</span>r<span class="token punctuation">,</span> <span class="token operator">-</span>r<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> r<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> r<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ellipse<span class="token operator">-&gt;</span><span class="token function">setPen</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>NoPen<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ellipse<span class="token operator">-&gt;</span><span class="token function">setBrush</span><span class="token punctuation">(</span><span class="token function">QBrush</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>red<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ellipse<span class="token operator">-&gt;</span><span class="token function">setPos</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><span class="token punctuation">;</span>
        event<span class="token operator">-&gt;</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        event<span class="token operator">-&gt;</span><span class="token function">ignore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>显示效果如下:<br> <img src="https://images2.imgbox.com/6b/99/GxoVuoQm_o.gif" alt="在这里插入图片描述"><br> 我们在自定义视图中通过实现WheelEvent()滚轮事件来实现对应的视图缩放效果。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">View</span><span class="token double-colon punctuation">::</span><span class="token function">wheelEvent</span><span class="token punctuation">(</span>QWheelEvent <span class="token operator">*</span>event<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//先调用默认的滚轮事件处理,如果需要禁用的话，可以不调用</span>
    <span class="token class-name">QGraphicsView</span><span class="token double-colon punctuation">::</span><span class="token function">wheelEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//已经被处理过的不再进行处理</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token operator">-&gt;</span><span class="token function">isAccepted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//y&gt;0放大</span>
    qreal factor <span class="token operator">=</span> <span class="token number">1.1</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token operator">-&gt;</span><span class="token function">angleDelta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">scale</span><span class="token punctuation">(</span>factor<span class="token punctuation">,</span> factor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//y&lt;0缩小</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> factor<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">/</span> factor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    event<span class="token operator">-&gt;</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>对应的效果显示如下:<br> <img src="https://images2.imgbox.com/f2/c0/F2OKQOeJ_o.gif" alt="在这里插入图片描述"><br> 我们可以通过setTransformationAnchor()设置缩放的中心，对应的属性值包括下面几个:</p> 
<pre><code class="prism language-cpp"><span class="token comment">//NoAnchor的时候缩放中心是视图的左上角</span>
NoAnchor
<span class="token comment">//缩放中心为视图的中心</span>
AnchorViewCenter 
<span class="token comment">//缩放中心是鼠标所在的位置</span>
AnchorUnderMouse
</code></pre> 
<p>为了方便自定义图元的添加，我们在自定义View中通过鼠标左右键来动态的增加和删除自定义图元，对应的实现如下:</p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">View</span><span class="token double-colon punctuation">::</span><span class="token function">mousePressEvent</span><span class="token punctuation">(</span>QMouseEvent <span class="token operator">*</span>event<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token class-name">QGraphicsView</span><span class="token double-colon punctuation">::</span><span class="token function">mousePressEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//事件已经被处理过了,便不再处理</span>
    <span class="token comment">//防止和图元事件冲突</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token operator">-&gt;</span><span class="token function">isAccepted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>event<span class="token operator">-&gt;</span><span class="token function">button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//左键添加图元到鼠标位置</span>
        <span class="token keyword">case</span> Qt<span class="token double-colon punctuation">::</span>LeftButton<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            SineItem <span class="token operator">*</span>item <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">SineItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            item<span class="token operator">-&gt;</span><span class="token function">setPos</span><span class="token punctuation">(</span><span class="token function">mapToScene</span><span class="token punctuation">(</span>event<span class="token operator">-&gt;</span><span class="token function">pos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">addItem</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
            event<span class="token operator">-&gt;</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//右键删除鼠标位置的图元</span>
        <span class="token keyword">case</span> Qt<span class="token double-colon punctuation">::</span>RightButton<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            QGraphicsItem <span class="token operator">*</span>item <span class="token operator">=</span> <span class="token function">itemAt</span><span class="token punctuation">(</span>event<span class="token operator">-&gt;</span><span class="token function">pos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">delete</span> item<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            event<span class="token operator">-&gt;</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>为了防止添加图元的时候，View中的视图变动，我们可以指定SceneRect()或者设置好View与Scene的对齐方式，设置方法如下:</p> 
<pre><code class="prism language-cpp"><span class="token function">setAlignment</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>AlignTop <span class="token operator">|</span> Qt<span class="token double-colon punctuation">::</span>AlignLeft<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c6/69/6UCbvBQZ_o.gif" alt="在这里插入图片描述"></p> 
<h3><a id="_233"></a>状态处理</h3> 
<p>在绘制自定义图元的时候，有时候我们需要根据图元的状态来进行不同的绘制，这时候我们就需要对图元的状态进行判断和处理了。图元常见的状态列表如下所示:</p> 
<table><thead><tr><th align="left">状态</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">QStyle::State_Enabled</td><td align="left">表示图元被启用了。</td></tr><tr><td align="left">QStyle::State_HasFocus</td><td align="left">表示图元获得了输入焦点，需要通过下面的设置启动该状态。<br>setFlag(QGraphicsItem::ItemIsFocusable,true);</td></tr><tr><td align="left">QStyle::State_MouseOver</td><td align="left">表示当前鼠标悬浮在图元的上方，通过下面的设置启动该状态。<br>setAcceptHoverEvents(true);</td></tr><tr><td align="left">QStyle::State_Selected</td><td align="left">表示该图元被选中，通过下面的设置启动该状态。<br>setFlag(QGraphicsItem::ItemIsSelectable,true);</td></tr></tbody></table> 
<p>在图元自定义绘制的时候，我们可以根据不同的状态设置不同的绘制图形和样式，对应的绘制代码如下：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">SineItem</span><span class="token double-colon punctuation">::</span><span class="token function">paint</span><span class="token punctuation">(</span>QPainter <span class="token operator">*</span>painter<span class="token punctuation">,</span> <span class="token keyword">const</span> QStyleOptionGraphicsItem <span class="token operator">*</span>option<span class="token punctuation">,</span> QWidget <span class="token operator">*</span>widget<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">Q_UNUSED</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span>
    <span class="token function">Q_UNUSED</span><span class="token punctuation">(</span>widget<span class="token punctuation">)</span>
    QPen pen<span class="token punctuation">;</span>
    <span class="token comment">//缩放的时候保持固定线宽</span>
    pen<span class="token punctuation">.</span><span class="token function">setCosmetic</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//选中的时候线条变为红色并显示红色虚线边框</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>option<span class="token operator">-&gt;</span>state<span class="token punctuation">.</span><span class="token function">testFlag</span><span class="token punctuation">(</span>QStyle<span class="token double-colon punctuation">::</span>State_Selected<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        pen<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>red<span class="token punctuation">)</span><span class="token punctuation">;</span>
        pen<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>DashLine<span class="token punctuation">)</span><span class="token punctuation">;</span>
        painter<span class="token operator">-&gt;</span><span class="token function">setPen</span><span class="token punctuation">(</span>pen<span class="token punctuation">)</span><span class="token punctuation">;</span>
        painter<span class="token operator">-&gt;</span><span class="token function">drawRect</span><span class="token punctuation">(</span><span class="token function">boundingRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//悬浮的时候显示虚线边框</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>option<span class="token operator">-&gt;</span>state<span class="token punctuation">.</span><span class="token function">testFlag</span><span class="token punctuation">(</span>QStyle<span class="token double-colon punctuation">::</span>State_MouseOver<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        pen<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>gray<span class="token punctuation">)</span><span class="token punctuation">;</span>
        pen<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>DashLine<span class="token punctuation">)</span><span class="token punctuation">;</span>
        painter<span class="token operator">-&gt;</span><span class="token function">setPen</span><span class="token punctuation">(</span>pen<span class="token punctuation">)</span><span class="token punctuation">;</span>
        painter<span class="token operator">-&gt;</span><span class="token function">drawRect</span><span class="token punctuation">(</span><span class="token function">boundingRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pen<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>black<span class="token punctuation">)</span><span class="token punctuation">;</span>
        pen<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>SolidLine<span class="token punctuation">)</span><span class="token punctuation">;</span>
        painter<span class="token operator">-&gt;</span><span class="token function">setPen</span><span class="token punctuation">(</span>pen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//采样间隔</span>
    <span class="token comment">//获取缩放系数</span>
    <span class="token keyword">const</span> qreal detail <span class="token operator">=</span> <span class="token class-name">QStyleOptionGraphicsItem</span><span class="token double-colon punctuation">::</span><span class="token function">levelOfDetailFromTransform</span><span class="token punctuation">(</span>painter<span class="token operator">-&gt;</span><span class="token function">worldTransform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//计算精度</span>
    <span class="token keyword">const</span> qreal dx <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> detail<span class="token punctuation">;</span>
    painter<span class="token operator">-&gt;</span><span class="token function">setPen</span><span class="token punctuation">(</span>pen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">int</span> steps <span class="token operator">=</span> <span class="token function">qRound</span><span class="token punctuation">(</span>m_maxX <span class="token operator">/</span> dx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    QPointF <span class="token function">previousPoint</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">sin</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> steps<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> <span class="token keyword">float</span> x <span class="token operator">=</span> dx <span class="token operator">*</span> i<span class="token punctuation">;</span>
        QPointF <span class="token function">point</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">5</span><span class="token operator">*</span><span class="token function">sin</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        painter<span class="token operator">-&gt;</span><span class="token function">drawLine</span><span class="token punctuation">(</span>previousPoint<span class="token punctuation">,</span> point<span class="token punctuation">)</span><span class="token punctuation">;</span>
        previousPoint <span class="token operator">=</span> point<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>自定义图形在悬浮的时候显示灰色的虚线边框，在选中的时候显示红色虚线边框同时曲线也会被成红色虚线。对应的效果如下:<br> <img src="https://images2.imgbox.com/83/5e/ihxnIXV6_o.gif" alt="在这里插入图片描述"></p> 
<h3><a id="_288"></a>尺寸修改</h3> 
<p>样例中我们自定义图样默认显示的范围是(0,30)，我们可以根据需要动态的修改显示范围。对应的设置接口如下:</p> 
<pre><code class="prism language-cpp"><span class="token comment">//显示范围</span>
<span class="token keyword">float</span> <span class="token class-name">SineItem</span><span class="token double-colon punctuation">::</span><span class="token function">maxX</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> m_maxX<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token class-name">SineItem</span><span class="token double-colon punctuation">::</span><span class="token function">setMaxX</span><span class="token punctuation">(</span><span class="token keyword">float</span> value<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>m_maxX <span class="token operator">==</span> value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//通知Scene边界范围发生了变化,如果不调用的话</span>
    <span class="token comment">//缓存的边界范围不会发生变化</span>
    <span class="token function">prepareGeometryChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_maxX <span class="token operator">=</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>我们通过鼠标右键事件动态的调整显示范围，对应的配置如下</p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">SineItem</span><span class="token double-colon punctuation">::</span><span class="token function">mousePressEvent</span><span class="token punctuation">(</span>QGraphicsSceneMouseEvent <span class="token operator">*</span>event<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token operator">-&gt;</span><span class="token function">button</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Qt<span class="token double-colon punctuation">::</span>LeftButton<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">float</span> x <span class="token operator">=</span> event<span class="token operator">-&gt;</span><span class="token function">pos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        QPointF <span class="token function">point</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">5</span><span class="token operator">*</span><span class="token function">sin</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">float</span> r <span class="token operator">=</span> <span class="token number">0.3</span><span class="token punctuation">;</span>
        QGraphicsEllipseItem <span class="token operator">*</span>ellipse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QGraphicsEllipseItem</span><span class="token punctuation">(</span><span class="token operator">-</span>r<span class="token punctuation">,</span> <span class="token operator">-</span>r<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> r<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> r<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ellipse<span class="token operator">-&gt;</span><span class="token function">setPen</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>NoPen<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ellipse<span class="token operator">-&gt;</span><span class="token function">setBrush</span><span class="token punctuation">(</span><span class="token function">QBrush</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>red<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ellipse<span class="token operator">-&gt;</span><span class="token function">setPos</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><span class="token punctuation">;</span>
        event<span class="token operator">-&gt;</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//右键刷新显示范围</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>event<span class="token operator">-&gt;</span><span class="token function">button</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Qt<span class="token double-colon punctuation">::</span>RightButton<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> value <span class="token operator">=</span> m_maxX <span class="token operator">+</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token function">setMaxX</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        event<span class="token operator">-&gt;</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
         event<span class="token operator">-&gt;</span><span class="token function">ignore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>显示效果:<br> <img src="https://images2.imgbox.com/12/8a/aO7ehyxo_o.gif" alt="在这里插入图片描述"><br> 这个设置和View中的右键点击删除图元的功能是冲突的，使用的时候根据自己的需要自行调整吧。</p> 
<h3><a id="_339"></a>样例代码</h3> 
<p>自定义图元的实现如下：</p> 
<pre><code class="prism language-cpp"><span class="token comment">//sineitem.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">SINEITEM_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SINEITEM_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QGraphicsItem&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">SineItem</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">QGraphicsItem</span></span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">SineItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//最大显示范围的设置默认为30</span>
    <span class="token keyword">float</span> <span class="token function">maxX</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">setMaxX</span><span class="token punctuation">(</span><span class="token keyword">float</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">public</span><span class="token operator">:</span>
    QRectF <span class="token function">boundingRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">paint</span><span class="token punctuation">(</span>QPainter <span class="token operator">*</span>painter<span class="token punctuation">,</span> <span class="token keyword">const</span> QStyleOptionGraphicsItem <span class="token operator">*</span>option<span class="token punctuation">,</span> QWidget <span class="token operator">*</span>widget<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">mousePressEvent</span><span class="token punctuation">(</span>QGraphicsSceneMouseEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
    <span class="token comment">//显示范围</span>
    <span class="token keyword">float</span> m_maxX<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// SINEITEM_H</span></span>
</code></pre> 
<pre><code class="prism language-cpp"><span class="token comment">//sineitem.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"sineitem.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QPainter&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;math.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QDebug&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QStyleOptionGraphicsItem&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QGraphicsSceneMouseEvent&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QGraphicsScene&gt;</span></span>

<span class="token class-name">SineItem</span><span class="token double-colon punctuation">::</span><span class="token function">SineItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">setFlag</span><span class="token punctuation">(</span>QGraphicsItem<span class="token double-colon punctuation">::</span>ItemIsSelectable<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setFlag</span><span class="token punctuation">(</span>QGraphicsItem<span class="token double-colon punctuation">::</span>ItemIsFocusable<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token operator">-&gt;</span><span class="token function">setAcceptHoverEvents</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_maxX <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//显示范围</span>
<span class="token keyword">float</span> <span class="token class-name">SineItem</span><span class="token double-colon punctuation">::</span><span class="token function">maxX</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> m_maxX<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">SineItem</span><span class="token double-colon punctuation">::</span><span class="token function">setMaxX</span><span class="token punctuation">(</span><span class="token keyword">float</span> value<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>m_maxX <span class="token operator">==</span> value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">prepareGeometryChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    m_maxX <span class="token operator">=</span> value<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

QRectF <span class="token class-name">SineItem</span><span class="token double-colon punctuation">::</span><span class="token function">boundingRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//左上角的坐标是(0,-5)矩形的宽度也就是显示范围</span>
    <span class="token comment">//高度就是正弦曲线的振幅的两倍</span>
    <span class="token keyword">return</span> <span class="token function">QRectF</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">5</span><span class="token punctuation">,</span> m_maxX<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">SineItem</span><span class="token double-colon punctuation">::</span><span class="token function">paint</span><span class="token punctuation">(</span>QPainter <span class="token operator">*</span>painter<span class="token punctuation">,</span> <span class="token keyword">const</span> QStyleOptionGraphicsItem <span class="token operator">*</span>option<span class="token punctuation">,</span> QWidget <span class="token operator">*</span>widget<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">Q_UNUSED</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span>
    <span class="token function">Q_UNUSED</span><span class="token punctuation">(</span>widget<span class="token punctuation">)</span>
    QPen pen<span class="token punctuation">;</span>
    <span class="token comment">//缩放的时候保持固定线宽</span>
    pen<span class="token punctuation">.</span><span class="token function">setCosmetic</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//选中的时候线条变为红色并显示红色虚线边框</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>option<span class="token operator">-&gt;</span>state<span class="token punctuation">.</span><span class="token function">testFlag</span><span class="token punctuation">(</span>QStyle<span class="token double-colon punctuation">::</span>State_Selected<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        pen<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>red<span class="token punctuation">)</span><span class="token punctuation">;</span>
        pen<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>DashLine<span class="token punctuation">)</span><span class="token punctuation">;</span>
        painter<span class="token operator">-&gt;</span><span class="token function">setPen</span><span class="token punctuation">(</span>pen<span class="token punctuation">)</span><span class="token punctuation">;</span>
        painter<span class="token operator">-&gt;</span><span class="token function">drawRect</span><span class="token punctuation">(</span><span class="token function">boundingRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//悬浮的时候显示虚线边框</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>option<span class="token operator">-&gt;</span>state<span class="token punctuation">.</span><span class="token function">testFlag</span><span class="token punctuation">(</span>QStyle<span class="token double-colon punctuation">::</span>State_MouseOver<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        pen<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>gray<span class="token punctuation">)</span><span class="token punctuation">;</span>
        pen<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>DashLine<span class="token punctuation">)</span><span class="token punctuation">;</span>
        painter<span class="token operator">-&gt;</span><span class="token function">setPen</span><span class="token punctuation">(</span>pen<span class="token punctuation">)</span><span class="token punctuation">;</span>
        painter<span class="token operator">-&gt;</span><span class="token function">drawRect</span><span class="token punctuation">(</span><span class="token function">boundingRect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pen<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>black<span class="token punctuation">)</span><span class="token punctuation">;</span>
        pen<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>SolidLine<span class="token punctuation">)</span><span class="token punctuation">;</span>
        painter<span class="token operator">-&gt;</span><span class="token function">setPen</span><span class="token punctuation">(</span>pen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//采样间隔</span>
    <span class="token comment">//获取缩放系数</span>
    <span class="token keyword">const</span> qreal detail <span class="token operator">=</span> <span class="token class-name">QStyleOptionGraphicsItem</span><span class="token double-colon punctuation">::</span><span class="token function">levelOfDetailFromTransform</span><span class="token punctuation">(</span>painter<span class="token operator">-&gt;</span><span class="token function">worldTransform</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//计算精度</span>
    <span class="token keyword">const</span> qreal dx <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">/</span> detail<span class="token punctuation">;</span>
    painter<span class="token operator">-&gt;</span><span class="token function">setPen</span><span class="token punctuation">(</span>pen<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token keyword">int</span> steps <span class="token operator">=</span> <span class="token function">qRound</span><span class="token punctuation">(</span>m_maxX <span class="token operator">/</span> dx<span class="token punctuation">)</span><span class="token punctuation">;</span>
    QPointF <span class="token function">previousPoint</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">sin</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> steps<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> <span class="token keyword">float</span> x <span class="token operator">=</span> dx <span class="token operator">*</span> i<span class="token punctuation">;</span>
        QPointF <span class="token function">point</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">5</span><span class="token operator">*</span><span class="token function">sin</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        painter<span class="token operator">-&gt;</span><span class="token function">drawLine</span><span class="token punctuation">(</span>previousPoint<span class="token punctuation">,</span> point<span class="token punctuation">)</span><span class="token punctuation">;</span>
        previousPoint <span class="token operator">=</span> point<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">SineItem</span><span class="token double-colon punctuation">::</span><span class="token function">mousePressEvent</span><span class="token punctuation">(</span>QGraphicsSceneMouseEvent <span class="token operator">*</span>event<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token operator">-&gt;</span><span class="token function">button</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Qt<span class="token double-colon punctuation">::</span>LeftButton<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">float</span> x <span class="token operator">=</span> event<span class="token operator">-&gt;</span><span class="token function">pos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        QPointF <span class="token function">point</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">5</span><span class="token operator">*</span><span class="token function">sin</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">float</span> r <span class="token operator">=</span> <span class="token number">0.3</span><span class="token punctuation">;</span>
        QGraphicsEllipseItem <span class="token operator">*</span>ellipse <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">QGraphicsEllipseItem</span><span class="token punctuation">(</span><span class="token operator">-</span>r<span class="token punctuation">,</span> <span class="token operator">-</span>r<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> r<span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> r<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ellipse<span class="token operator">-&gt;</span><span class="token function">setPen</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>NoPen<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ellipse<span class="token operator">-&gt;</span><span class="token function">setBrush</span><span class="token punctuation">(</span><span class="token function">QBrush</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>red<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ellipse<span class="token operator">-&gt;</span><span class="token function">setPos</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><span class="token punctuation">;</span>
        event<span class="token operator">-&gt;</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//右键刷新显示范围</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>event<span class="token operator">-&gt;</span><span class="token function">button</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> Qt<span class="token double-colon punctuation">::</span>RightButton<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
<span class="token comment">//      int value = m_maxX + 5;</span>
<span class="token comment">//      setMaxX(value);</span>
        event<span class="token operator">-&gt;</span><span class="token function">ignore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
         event<span class="token operator">-&gt;</span><span class="token function">ignore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>自定义视图的实现如下:</p> 
<pre><code class="prism language-cpp"><span class="token comment">//view.h</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">VIEW_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">VIEW_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QGraphicsView&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">View</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">QGraphicsView</span></span>
<span class="token punctuation">{<!-- --></span>
    Q_OBJECT
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token function">View</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">~</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">protected</span><span class="token operator">:</span>
    <span class="token comment">//滚轮事件和鼠标事件</span>
    <span class="token keyword">void</span> <span class="token function">wheelEvent</span><span class="token punctuation">(</span>QWheelEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">mousePressEvent</span><span class="token punctuation">(</span>QMouseEvent <span class="token operator">*</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> <span class="token comment">// VIEW_H</span></span>
</code></pre> 
<pre><code class="prism language-cpp"><span class="token comment">//view.cpp</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"view.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QDebug&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;QWheelEvent&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"sineitem.h"</span></span>

<span class="token class-name">View</span><span class="token double-colon punctuation">::</span><span class="token function">View</span><span class="token punctuation">(</span>QWidget <span class="token operator">*</span>parent<span class="token punctuation">)</span>
    <span class="token operator">:</span> <span class="token function">QGraphicsView</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">setRenderHint</span><span class="token punctuation">(</span>QPainter<span class="token double-colon punctuation">::</span>Antialiasing<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setScene</span><span class="token punctuation">(</span><span class="token keyword">new</span> QGraphicsScene<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//默认添加一个图元</span>
    SineItem <span class="token operator">*</span>item <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">SineItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">addItem</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setAlignment</span><span class="token punctuation">(</span>Qt<span class="token double-colon punctuation">::</span>AlignTop <span class="token operator">|</span> Qt<span class="token double-colon punctuation">::</span>AlignLeft<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setTransformationAnchor</span><span class="token punctuation">(</span>ViewportAnchor<span class="token double-colon punctuation">::</span>AnchorUnderMouse<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">View</span><span class="token double-colon punctuation">::</span><span class="token operator">~</span><span class="token function">View</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">delete</span> <span class="token function">scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">void</span> <span class="token class-name">View</span><span class="token double-colon punctuation">::</span><span class="token function">wheelEvent</span><span class="token punctuation">(</span>QWheelEvent <span class="token operator">*</span>event<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//先调用默认的滚轮事件处理,如果需要禁用的话，可以不调用</span>
    <span class="token class-name">QGraphicsView</span><span class="token double-colon punctuation">::</span><span class="token function">wheelEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token operator">-&gt;</span><span class="token function">isAccepted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//y&gt;0放大</span>
    qreal factor <span class="token operator">=</span> <span class="token number">1.1</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token operator">-&gt;</span><span class="token function">angleDelta</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">y</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">scale</span><span class="token punctuation">(</span>factor<span class="token punctuation">,</span> factor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//y&lt;0缩小</span>
    <span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">scale</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> factor<span class="token punctuation">,</span> <span class="token number">1</span> <span class="token operator">/</span> factor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    event<span class="token operator">-&gt;</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">void</span> <span class="token class-name">View</span><span class="token double-colon punctuation">::</span><span class="token function">mousePressEvent</span><span class="token punctuation">(</span>QMouseEvent <span class="token operator">*</span>event<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token class-name">QGraphicsView</span><span class="token double-colon punctuation">::</span><span class="token function">mousePressEvent</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token operator">-&gt;</span><span class="token function">isAccepted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>event<span class="token operator">-&gt;</span><span class="token function">button</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//左键添加图元</span>
        <span class="token keyword">case</span> Qt<span class="token double-colon punctuation">::</span>LeftButton<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            SineItem <span class="token operator">*</span>item <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">SineItem</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            item<span class="token operator">-&gt;</span><span class="token function">setPos</span><span class="token punctuation">(</span><span class="token function">mapToScene</span><span class="token punctuation">(</span>event<span class="token operator">-&gt;</span><span class="token function">pos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token function">addItem</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
            event<span class="token operator">-&gt;</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//右键删除图元</span>
        <span class="token keyword">case</span> Qt<span class="token double-colon punctuation">::</span>RightButton<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            QGraphicsItem <span class="token operator">*</span>item <span class="token operator">=</span> <span class="token function">itemAt</span><span class="token punctuation">(</span>event<span class="token operator">-&gt;</span><span class="token function">pos</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">delete</span> item<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            event<span class="token operator">-&gt;</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c3b61f2add3f0cd5171283e730887eb3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MySQL中truncate和delete的区别</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/844351c302d425226d8604bacae8be1d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数据库(2)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>