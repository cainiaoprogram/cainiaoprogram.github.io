<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【ABAQUS 二次开发笔记】使用keyword 、python和matlab一起处理Odb数据 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【ABAQUS 二次开发笔记】使用keyword 、python和matlab一起处理Odb数据" />
<meta property="og:description" content="我的主页：
技术邻：小铭的ABAQUS学习的技术邻主页博客园 : HF_SO4的主页哔哩哔哩：小铭的ABAQUS学习的个人空间csdn：qgm1702 博客园文章链接：
【ABAQUS 二次开发笔记】使用keyword 、python和matlab一起处理Odb数据 - hayden_william - 博客园 用conversion shell element （S4R单元）建模层合板，有6层ply,每个lamina（ply）有3个 integration point,共计18个integration point。我想得到集合SET-Middle-elem中所有integration point的E S TSHR13 TSHR23的output。
提取出结果后，我还需要根据剪切模量计算出13 23方向的shear strain。得到10个vars的output后，利用他们计算出整个laminate的弹性应变能(将每个单元的每个ply的弹性应变能U计算出来进行累加).计算很麻烦。
方法一:python访问odb文件 通过python 脚本访问odb文件，然后多个循环进行嵌套提取出output结果。这个办法可行，能够一下子访问到每个element的每个point.
import odbA ccessE=session.odbs[&#39;30d-50hz.odb&#39;].steps[&#34;Step-1&#34;].frames[10].fieldOutputs[&#39;E&#39;].values[10] print(E) 执行上述代码：
&gt;&gt;&gt; import odbAccess &gt;&gt;&gt; E=session.odbs[&#39;30d-50hz.odb&#39;].steps[&#34;Step-1&#34;].frames[10].fieldOutputs[&#39;E&#39;] &gt;&gt;&gt;&gt;E.values[10] session.openOdb(r&#39;G:/SIMULIA/workspace/Tanslate_repetition/DMAsimulia/30d-50hz.odb&#39;).steps[&#39;Step-1&#39;].frames[10].fieldOutputs[&#39;E&#39;].values[10] &gt;&gt;&gt;&gt; print(E.values[10]) ({ &#39;baseElementType&#39;: &#39;S4R&#39;, &#39;conjugateData&#39;: None, &#39;conjugateDataDouble&#39;: &#39;unknown&#39;, &#39;data&#39;: array([0.0, -0.0, 0.0, 0.0], &#39;f&#39;), &#39;dataDouble&#39;: &#39;unknown&#39;, &#39;elementLabel&#39;: 11, &#39;face&#39;: None, &#39;instance&#39;: &#39;OdbInstance object&#39;, &#39;integrationPoint&#39;: 1, &#39;inv3&#39;: 0.0, &#39;localCoordSystem&#39;: ((0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/0327f6a10c2fa3c4eea415f3652ef78c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-23T22:47:36+08:00" />
<meta property="article:modified_time" content="2023-01-23T22:47:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【ABAQUS 二次开发笔记】使用keyword 、python和matlab一起处理Odb数据</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>我的主页：</p> 
<ul><li>技术邻：<a href="https://www.jishulink.com/self?nagivator=article" rel="nofollow">小铭的ABAQUS学习的技术邻主页</a></li><li>博客园 : <a href="https://www.cnblogs.com/aksoam/" rel="nofollow">HF_SO4的主页</a></li><li>哔哩哔哩：<a href="https://space.bilibili.com/470140717" rel="nofollow">小铭的ABAQUS学习的个人空间</a></li><li>csdn：<a href="https://blog.csdn.net/weixin_46037068?spm=1010.2135.3001.5343">qgm1702</a></li></ul> 
<p>博客园文章链接：</p> 
<ul><li><a href="https://www.cnblogs.com/aksoam/p/17063398.html" rel="nofollow">【ABAQUS 二次开发笔记】使用keyword 、python和matlab一起处理Odb数据 - hayden_william - 博客园</a></li></ul> 
<p>用conversion shell element （S4R单元）建模层合板，有6层ply,每个lamina（ply）有3个 integration point,共计18个integration point。我想得到集合SET-Middle-elem中所有integration point的E S TSHR13 TSHR23的output。</p> 
<p>提取出结果后，我还需要根据剪切模量计算出13 23方向的shear strain。得到10个vars的output后，利用他们计算出整个laminate的弹性应变能(将每个单元的每个ply的弹性应变能U计算出来进行累加).计算很麻烦。</p> 
<p><img src="https://images2.imgbox.com/2e/63/eyFmVkCH_o.png" alt="img"></p> 
<h3><a id="pythonodb_18"></a>方法一:python访问odb文件</h3> 
<p>通过python 脚本访问odb文件，然后多个循环进行嵌套提取出output结果。这个办法可行，能够一下子访问到每个element的每个point.</p> 
<pre><code class="prism language-shell"><span class="token function">import</span> odbA
<span class="token assign-left variable">ccessE</span><span class="token operator">=</span>session.odbs<span class="token punctuation">[</span><span class="token string">'30d-50hz.odb'</span><span class="token punctuation">]</span>.steps<span class="token punctuation">[</span><span class="token string">"Step-1"</span><span class="token punctuation">]</span>.frames<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span>.fieldOutputs<span class="token punctuation">[</span><span class="token string">'E'</span><span class="token punctuation">]</span>.values<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span>
print<span class="token punctuation">(</span>E<span class="token punctuation">)</span>
</code></pre> 
<p>执行上述代码：</p> 
<pre><code class="prism language-shell"><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token function">import</span> odbAccess
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token assign-left variable">E</span><span class="token operator">=</span>session.odbs<span class="token punctuation">[</span><span class="token string">'30d-50hz.odb'</span><span class="token punctuation">]</span>.steps<span class="token punctuation">[</span><span class="token string">"Step-1"</span><span class="token punctuation">]</span>.frames<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span>.fieldOutputs<span class="token punctuation">[</span><span class="token string">'E'</span><span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span>E.values<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span>
session.openOdb<span class="token punctuation">(</span>r<span class="token string">'G:/SIMULIA/workspace/Tanslate_repetition/DMAsimulia/30d-50hz.odb'</span><span class="token punctuation">)</span>.steps<span class="token punctuation">[</span><span class="token string">'Step-1'</span><span class="token punctuation">]</span>.frames<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span>.fieldOutputs<span class="token punctuation">[</span><span class="token string">'E'</span><span class="token punctuation">]</span>.values<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;&gt;</span> print<span class="token punctuation">(</span>E.values<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>    <span class="token string">'baseElementType'</span><span class="token builtin class-name">:</span> <span class="token string">'S4R'</span>, 
      <span class="token string">'conjugateData'</span><span class="token builtin class-name">:</span> None, 
      <span class="token string">'conjugateDataDouble'</span><span class="token builtin class-name">:</span> <span class="token string">'unknown'</span>,     
      <span class="token string">'data'</span><span class="token builtin class-name">:</span> array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.0</span>, -0.0, <span class="token number">0.0</span>, <span class="token number">0.0</span><span class="token punctuation">]</span>, <span class="token string">'f'</span><span class="token punctuation">)</span>, 
      <span class="token string">'dataDouble'</span><span class="token builtin class-name">:</span> <span class="token string">'unknown'</span>,     
      <span class="token string">'elementLabel'</span><span class="token builtin class-name">:</span> <span class="token number">11</span>,     
      <span class="token string">'face'</span><span class="token builtin class-name">:</span> None,     
      <span class="token string">'instance'</span><span class="token builtin class-name">:</span> <span class="token string">'OdbInstance object'</span>,    
       <span class="token string">'integrationPoint'</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,   
       <span class="token string">'inv3'</span><span class="token builtin class-name">:</span> <span class="token number">0.0</span>,     
       <span class="token string">'localCoordSystem'</span><span class="token builtin class-name">:</span> <span class="token variable"><span class="token punctuation">((</span><span class="token number">0.866025388240814</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.866025388240814</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.0</span><span class="token punctuation">,</span> <span class="token number">0.999999940395355</span><span class="token punctuation">))</span></span>,     
       <span class="token string">'localCoordSystemDouble'</span><span class="token builtin class-name">:</span> <span class="token string">'unknown'</span>,     
       <span class="token string">'magnitude'</span><span class="token builtin class-name">:</span> None,     
       <span class="token string">'maxInPlanePrincipal'</span><span class="token builtin class-name">:</span> <span class="token number">0.0</span>,     
       <span class="token string">'maxPrincipal'</span><span class="token builtin class-name">:</span> <span class="token number">0.0</span>,     
       <span class="token string">'midPrincipal'</span><span class="token builtin class-name">:</span> <span class="token number">0.0</span>,     
       <span class="token string">'minInPlanePrincipal'</span><span class="token builtin class-name">:</span> <span class="token number">0.0</span>,     
       <span class="token string">'minPrincipal'</span><span class="token builtin class-name">:</span> <span class="token number">0.0</span>,     
       <span class="token string">'mises'</span><span class="token builtin class-name">:</span> <span class="token number">0.0</span>,     
       <span class="token string">'nodeLabel'</span><span class="token builtin class-name">:</span> None,     
       <span class="token string">'outOfPlanePrincipal'</span><span class="token builtin class-name">:</span> <span class="token number">0.0</span>,     
       <span class="token string">'position'</span><span class="token builtin class-name">:</span> INTEGRATION_POINT,     
       <span class="token string">'precision'</span><span class="token builtin class-name">:</span> SINGLE_PRECISION,     
       <span class="token string">'press'</span><span class="token builtin class-name">:</span> -0.0,     
       <span class="token string">'sectionPoint'</span><span class="token builtin class-name">:</span> <span class="token string">'SectionPoint object'</span>,     
       <span class="token string">'tresca'</span><span class="token builtin class-name">:</span> <span class="token number">0.0</span>,     
       <span class="token string">'type'</span><span class="token builtin class-name">:</span> TENSOR_3D_PLANAR<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> len<span class="token punctuation">(</span>E.values<span class="token punctuation">)</span>
<span class="token number">10800</span>
</code></pre> 
<p>可以看出，在用odb的话就会循环非常多次才能算完，并且不容易定位到单个element。我感觉用python的话会code会非常混乱，逻辑不容易理清，因此放弃。</p> 
<h3><a id="edit_keywords_datMATLAB_69"></a>方法二:edit keywords 输出到dat文件，然后用MATLAB编程计算</h3> 
<ul><li><a href="https://www.cnblogs.com/aksoam/p/17056236.html" rel="nofollow">【Shell Element】一次获得多个积分点的输出到dat - hayden_william - 博客园</a></li></ul> 
<p>通过关键字<code>*EL PRINT</code>可以将多个变量在指定积分点上的结果进行输出。这样输出有个好处就是，输出的结果ABAQUS会整理为 类似 table的样式。</p> 
<p><img src="https://images2.imgbox.com/72/38/5KjGFiEh_o.png" alt="img"></p> 
<p>这样的格式我可以用python进行处理，写入CSV文件。</p> 
<ul><li><a href="https://www.cnblogs.com/aksoam/p/17034417.html" rel="nofollow">【ABAQUS 二次开发笔记】读入TXT分析结果&amp;输出csv文件 - hayden_william - 博客园</a><br> <img src="https://images2.imgbox.com/bc/4d/deI3go91_o.png" alt="img"></li></ul> 
<p>但是使用<code>*EL PRINT</code>有一个问题比较麻烦：<code>*EL PRINT</code>关键字语句的 first data line 一次最多16个section integration point ,多于16个integration point 则需要重复使用<code>*EL PRINT</code>来输出结果。而我有18个integration point 如果分两次输出的话。那输出的就是两个 table .得到结果我还需要整合成一个matrix。不方便。</p> 
<p>但是幸好，composite laminate 的每个ply之间是应力应变满足<code>连续性条件</code>。我可以不输出几个重合的integration point：</p> 
<pre><code class="prism language-shell"><span class="token assign-left variable">Aindex</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">3</span> <span class="token number">5</span> <span class="token number">7</span> <span class="token number">9</span> <span class="token number">11</span><span class="token punctuation">]</span>
</code></pre> 
<p>后续需要在matlab中写一个function，恢复这五个integration point 的output。</p> 
<p><img src="https://images2.imgbox.com/e6/42/AGSy2faw_o.png" alt="img"></p> 
<pre><code class="prism language-c">function B <span class="token operator">=</span> <span class="token function">expanMat</span><span class="token punctuation">(</span>A<span class="token punctuation">,</span>Aindex<span class="token punctuation">)</span>
<span class="token operator">%</span>将<span class="token number">13</span>个积分点数据展开为<span class="token number">18</span>个积分点的矩阵
    B<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    sizeAindex<span class="token operator">=</span><span class="token function">size</span><span class="token punctuation">(</span>Aindex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token function">isempty</span><span class="token punctuation">(</span>Aindex<span class="token punctuation">)</span>
        B<span class="token operator">=</span>A<span class="token punctuation">;</span>
        <span class="token function">disp</span><span class="token punctuation">(</span><span class="token char">'A矩阵未改变'</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span>
        <span class="token operator">%</span>如果only移动一行就不循环了
        <span class="token keyword">if</span> <span class="token function">sizeAindex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token function">sizeAindex</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">2</span>
            B<span class="token operator">=</span><span class="token function">cat</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token function">Aindex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token function">Aindex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">A</span><span class="token punctuation">(</span><span class="token function">Aindex</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token operator">:</span>end<span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token operator">%</span>把index向量升序排序
            Aindex<span class="token operator">=</span><span class="token function">sort</span><span class="token punctuation">(</span>Aindex<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token operator">%</span>得到A的行数
            rows<span class="token operator">=</span><span class="token function">size</span><span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">;</span>
            rows<span class="token operator">=</span><span class="token function">rows</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token operator">%</span>loop A matrix
            <span class="token keyword">for</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token operator">:</span>rows
                temp<span class="token operator">=</span><span class="token function">A</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span><span class="token operator">:</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token operator">%</span> <span class="token keyword">if</span> the row operated is the member of <span class="token function">Aindex</span><span class="token punctuation">(</span>a array containts indexs of all rows needed to copy<span class="token punctuation">)</span>
                <span class="token keyword">if</span> <span class="token function">ismember</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>Aindex<span class="token punctuation">)</span>
                    B<span class="token operator">=</span><span class="token function">cat</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>B<span class="token punctuation">,</span><span class="token punctuation">[</span>temp<span class="token punctuation">;</span>temp<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">else</span>
                    B<span class="token operator">=</span><span class="token function">cat</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>B<span class="token punctuation">,</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
                end           
            end
        end
    end
end
</code></pre> 
<p>最后：<br> <img src="https://images2.imgbox.com/b2/23/w1FUv4mH_o.png" alt="img"></p> 
<p>算出来的最小二乘结果，感觉误差比较大。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3f89c5b07091a43ea03641a95975c52b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">深度学习pytorch代码流程模板（入门推荐）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3c8cdff462f4805f32dda4141df27b93/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">CUDA编程之常用技巧与方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>