<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SqlServer数据库master迁移问题 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SqlServer数据库master迁移问题" />
<meta property="og:description" content="公司有一台旧的sqlserver 2008数据库安装在C盘，导致C盘空间爆满，因为C盘无法再扩容，只能考虑将master数据库迁移到G盘，因为对sqlserver不熟悉，没有按照官方文档迁移文件，导致数据库文件迁移后无法启动。 错误方法 直接在数据库修改文件路径
alter database master modify file ( name = master, filename = &#39;G:\Reports\DATA\master.mdf&#39;); alter database master modify file ( name = mastlog, filename = &#39;G:\Reports\DATA\mastlog.ldf&#39;); 按照该语句执行完成后，数据库关闭，将master.mdf和mastlog.ldf文件拷贝到G盘目录下。
重启数据库一直报错提示报错信息
无法打开错误日志文件 &#39;&#39;。操作系统错误 = 3(系统找不到指定的路径。)。事件ID 17058
查找网上的解决方案，包括文件权限，文件夹权限，账号权限都无法解决报错。最后找到解决方案，是启动参数问题，必须将下列三个参数添加到启动参数中，才能正常启动。添加任何一个参数都无法启动，要三个一起
-dG:\Reports\DATA\master.mdf;
-lG:\Reports\DATA\mastlog.ldf;
-eG:\Reports\DATA\ERRORLOG 这是一个很简单的错误，因为我没有按照官方文档操作迁移master，导致数据库启动报错，找了2小时找到了答案，也算万幸。
正确方法 官方文档记录的方法
移动系统数据库 - SQL Server | Microsoft Docs
移动 master 数据库 若要移动 master 数据库，请按照下列步骤进行操作。
验证 SQL Server 数据库引擎 的服务帐户是否对文件的新位置具有完全权限。 有关详细信息，请参阅 配置 Windows 服务帐户和权限预览版本升级问题的解答。 如果 数据库引擎 服务帐户无法控制其新位置中的文件，则 SQL Server 实例将不会启动。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c1baf7890adae9e2d71482dd1cd9527d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-21T12:00:00+08:00" />
<meta property="article:modified_time" content="2022-03-21T12:00:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SqlServer数据库master迁移问题</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>公司有一台旧的sqlserver 2008数据库安装在C盘，导致C盘空间爆满，因为C盘无法再扩容，只能考虑将master数据库迁移到G盘，因为对sqlserver不熟悉，没有按照官方文档迁移文件，导致数据库文件迁移后无法启动。</h4> 
<h3><span style="color:#fe2c24;">错误方法</span></h3> 
<p>直接在数据库修改文件路径</p> 
<pre><code>alter database master modify file ( name = master, filename = 'G:\Reports\DATA\master.mdf');
alter database master modify file ( name = mastlog, filename = 'G:\Reports\DATA\mastlog.ldf');
</code></pre> 
<p>按照该语句执行完成后，数据库关闭，将master.mdf和mastlog.ldf文件拷贝到G盘目录下。</p> 
<p>重启数据库一直报错提示报错信息</p> 
<p>无法打开错误日志文件 ''。操作系统错误 = 3(系统找不到指定的路径。)。事件ID 17058</p> 
<p><img alt="" height="431" src="https://images2.imgbox.com/74/d6/Cn7Y30PU_o.png" width="630"></p> 
<p></p> 
<p>查找网上的解决方案，包括文件权限，文件夹权限，账号权限都无法解决报错。最后找到解决方案，是启动参数问题，必须将下列三个参数添加到启动参数中，才能正常启动。<span style="color:#fe2c24;">添加任何一个参数都无法启动，要三个一起</span></p> 
<blockquote> 
 <p>-dG:\Reports\DATA\master.mdf;</p> 
 <p>-lG:\Reports\DATA\mastlog.ldf;</p> 
 <p>-eG:\Reports\DATA\ERRORLOG </p> 
</blockquote> 
<p><img alt="" height="521" src="https://images2.imgbox.com/43/d4/epcYWk6D_o.png" width="968"></p> 
<p><span style="color:#fe2c24;">这是一个很简单的错误，因为我没有按照官方文档操作迁移master，导致数据库启动报错，找了2小时找到了答案，也算万幸。</span></p> 
<h3><strong><span style="color:#fe2c24;">正确方法</span></strong></h3> 
<p><strong><span style="color:#fe2c24;">官方文档记录的方法</span></strong></p> 
<p><a href="https://docs.microsoft.com/zh-cn/sql/relational-databases/databases/move-system-databases?view=sql-server-ver15#moving-the-master-database" rel="nofollow" title="移动系统数据库 - SQL Server | Microsoft Docs">移动系统数据库 - SQL Server | Microsoft Docs</a></p> 
<h3 id="moving-the-master-database">移动 master 数据库</h3> 
<p>若要移动 <code>master</code> 数据库，请按照下列步骤进行操作。</p> 
<ol><li> <p>验证 SQL Server 数据库引擎 的服务帐户是否对文件的新位置具有完全权限。 有关详细信息，请参阅 <a href="https://docs.microsoft.com/zh-cn/sql/database-engine/configure-windows/configure-windows-service-accounts-and-permissions?view=sql-server-ver15" rel="nofollow" title="配置 Windows 服务帐户和权限">配置 Windows 服务帐户和权限</a>预览版本升级问题的解答。 如果 数据库引擎 服务帐户无法控制其新位置中的文件，则 SQL Server 实例将不会启动。</p> </li><li> <p>从“开始”菜单，找到并启动“SQL Server 配置管理器”。 有关预期位置的详细信息，请参阅 <a href="https://docs.microsoft.com/zh-cn/sql/relational-databases/sql-server-configuration-manager?view=sql-server-ver15" rel="nofollow" title="SQL Server 配置管理器">SQL Server 配置管理器</a>。</p> </li><li> <p>在“SQL Server 服务”节点中，右键单击 SQL Server 实例（如 <strong>SQL Server (MSSQLSERVER)</strong> ），并选择“属性”。</p> </li><li> <p>在“SQL Server (instance_name) 属性”对话框中，单击“启动参数”选项卡。</p> </li><li> <p>在“现有参数”框中，选择 <code>-d</code> 参数。 在“指定启动参数”框中，将该参数更改为 <code>master</code> 数据文件的新路径。 单击“更新”以保存更改。</p> </li><li> <p>在“现有参数”框中，选择 <code>-l</code> 参数。 在“指定启动参数”框中，将该参数更改为 <code>master</code> 日志文件的新路径。 单击“更新”以保存更改。</p> <p>数据文件的参数值必须跟在 <code>-d</code> 参数的后面，日志文件的参数值必须跟在 <code>-l</code> 参数的后面。 下面的示例显示用于 <code>master</code> 数据文件默认位置的参数值。</p> <p><code>-dC:\Program Files\Microsoft SQL Server\MSSQL&lt;version&gt;.MSSQLSERVER\MSSQL\DATA\master.mdf</code></p> <p><code>-lC:\Program Files\Microsoft SQL Server\MSSQL&lt;version&gt;.MSSQLSERVER\MSSQL\DATA\mastlog.ldf</code></p> <p>如果 <code>master</code> 数据文件预先安排的重定位是 <code>E:\SQLData</code>，则参数值将做如下更改：</p> <p><code>-dE:\SQLData\master.mdf</code></p> <p><code>-lE:\SQLData\mastlog.ldf</code></p> </li><li> <p>选择“确定”将永久保存所作更改并关闭“SQL Server (instance_name) 属性”对话框 。</p> </li><li> <p>通过右键单击实例名称并选择“停止”来停止 SQL Server 实例。</p> </li><li> <p>将 master.mdf 和 mastlog.ldf 文件复制到新位置。</p> </li><li> <p>重新启动 SQL Server实例。</p> </li><li> <p>通过运行以下查询来验证 <code>master</code> 数据库的文件更改。</p> <p>SQL复制</p> <pre><code>SELECT name, physical_name AS CurrentLocation, state_desc  
FROM sys.master_files  
WHERE database_id = DB_ID('master');  
</code></pre> </li><li> <p>此时 SQL Server 应正常运行。 但是 Microsoft 建议还调整 <code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft SQL Server\instance_ID\Setup</code> 处的注册表项，其中 instance_ID 类似于 <code>MSSQL13.MSSQLSERVER</code>。 在该配置单元中，将 <code>SQLDataRoot</code> 值更改为新路径。 未能更新注册表可能会导致修补和升级失败。</p> </li><li> <p>由于在步骤 9 中复制了数据库文件，而不是移动它们，因此，现在可以从以前的位置安全删除未使用的数据库文件。</p> </li></ol> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bb314dbd8fed7f1a47cbbac07f1e8c5a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">从数据库层面去看linux的操作系统</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ae0ec0d4d69396ff6837f4d323b624ea/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">from win32._api import * ModuleNotFoundError: No module named ‘win32._api‘</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>