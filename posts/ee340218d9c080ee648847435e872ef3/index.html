<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Javaè®¾è®¡æ¨¡å¼ä¹‹ä»£ç†ï¼ˆProxyï¼‰æ¨¡å¼ - èœé¸Ÿç¨‹åºå‘˜åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Javaè®¾è®¡æ¨¡å¼ä¹‹ä»£ç†ï¼ˆProxyï¼‰æ¨¡å¼" />
<meta property="og:description" content="ä»£ç†ï¼ˆProxyï¼‰æ¨¡å¼å…è®¸å°†å¯¹è±¡çš„æ“ä½œè½¬ç§»ç»™å…¶ä»–å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¸æ”¹å˜å…¶ç»“æ„çš„æƒ…å†µä¸‹å¢å¼ºå…¶åŠŸèƒ½æˆ–è€…æ§åˆ¶å…¶è®¿é—®ã€‚
ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼ ä»£ç†æ¨¡å¼æ˜¯ä¸€ç§ç”¨äºæ§åˆ¶è®¿é—®å’Œå¢å¼ºå¯¹è±¡åŠŸèƒ½çš„è®¾è®¡æ¨¡å¼ã€‚ä»£ç†æ¨¡å¼ä¸­ï¼Œä»£ç†å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡éƒ½å®ç°äº†ç›¸åŒçš„æ¥å£ï¼Œå¹¶ä¸”ä»£ç†å¯¹è±¡åœ¨å…¶å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªçœŸå®å¯¹è±¡çš„å¼•ç”¨ã€‚å½“å®¢æˆ·ç«¯è¯·æ±‚ä»£ç†å¯¹è±¡æ—¶ï¼Œä»£ç†å¯¹è±¡å°†å…¶è½¬å‘ç»™çœŸå®å¯¹è±¡ï¼Œå¹¶åœ¨è°ƒç”¨å‰æˆ–è°ƒç”¨åè¿›è¡Œä¸€äº›å¢å¼ºæ“ä½œã€‚
ä»£ç†æ¨¡å¼æœ‰ä¸åŒçš„ç±»å‹ï¼Œä¾‹å¦‚é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ã€‚é™æ€ä»£ç†æ˜¯åœ¨ç¼–è¯‘æ—¶åˆ›å»ºçš„ä»£ç†å¯¹è±¡ï¼Œè€ŒåŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºçš„ä»£ç†å¯¹è±¡ã€‚å› æ­¤ï¼ŒåŠ¨æ€ä»£ç†æ›´åŠ çµæ´»å’Œæ˜“äºæ‰©å±•ã€‚
åœ¨ Java ä¸­ï¼Œä»£ç†æ¨¡å¼æ˜¯å¹¿æ³›ä½¿ç”¨çš„ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥ç”¨äºå®ç° AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰ç­‰åº”ç”¨åœºæ™¯ã€‚
ä»£ç†æ¨¡å¼çš„ä½¿ç”¨åœºæ™¯ å½“ç›®æ ‡å¯¹è±¡ä¸é€‚åˆç›´æ¥è®¿é—®æˆ–è€…ä¸æ–¹ä¾¿è®¿é—®æ—¶ã€‚å½“éœ€è¦åœ¨å¯¹è±¡çš„è®¿é—®ä¸Šå¢åŠ æ§åˆ¶å’Œå®‰å…¨æ€§æ—¶ã€‚å½“éœ€è¦å¢å¼ºå¯¹è±¡çš„åŠŸèƒ½æ—¶ã€‚å½“å¯¹è±¡çš„è®¿é—®éœ€è¦ç»™äºˆå…¶ä»–å¯¹è±¡æˆ–æ¯ä¸ªå¯¹è±¡ä¸å¯èƒ½è®°ä½æ‰€æœ‰ç»†èŠ‚æ—¶ã€‚ é™æ€ä»£ç†çš„ä»£ç ç¤ºä¾‹ ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨é™æ€ä»£ç†æ–¹å¼çš„ä»£ç ç¤ºä¾‹ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª Subject æ¥å£å’Œä¸€ä¸ª RealSubject ç±»ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ª StaticProxy ä»£ç†ç±»å¯¹å…¶è¿›è¡Œå¢å¼ºå¤„ç†ï¼š
// Subject æ¥å£ public interface Subject { void request(); } // RealSubject æ¥å£ public class RealSubject implements Subject { public void request() { System.out.println(&#34;è®¿é—®çœŸå®å¯¹è±¡&#34;); } } // StaticProxy ä»£ç†ç±» public class StaticProxy implements Subject { private Subject subject; // æ„é€ å‡½æ•°åˆå§‹åŒ–ç›®æ ‡å¯¹è±¡ public StaticProxy(Subject subject) { this.subject = subject; } public void request() { System." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ee340218d9c080ee648847435e872ef3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-25T15:15:15+08:00" />
<meta property="article:modified_time" content="2023-07-25T15:15:15+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="èœé¸Ÿç¨‹åºå‘˜åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">èœé¸Ÿç¨‹åºå‘˜åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Javaè®¾è®¡æ¨¡å¼ä¹‹ä»£ç†ï¼ˆProxyï¼‰æ¨¡å¼</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>ä»£ç†ï¼ˆProxyï¼‰æ¨¡å¼å…è®¸å°†å¯¹è±¡çš„æ“ä½œè½¬ç§»ç»™å…¶ä»–å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ä¸æ”¹å˜å…¶ç»“æ„çš„æƒ…å†µä¸‹å¢å¼ºå…¶åŠŸèƒ½æˆ–è€…æ§åˆ¶å…¶è®¿é—®ã€‚</strong></p> 
<h3><a id="_2"></a>ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼</h3> 
<p>ä»£ç†æ¨¡å¼æ˜¯ä¸€ç§ç”¨äºæ§åˆ¶è®¿é—®å’Œå¢å¼ºå¯¹è±¡åŠŸèƒ½çš„è®¾è®¡æ¨¡å¼ã€‚ä»£ç†æ¨¡å¼ä¸­ï¼Œä»£ç†å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡éƒ½å®ç°äº†ç›¸åŒçš„æ¥å£ï¼Œå¹¶ä¸”ä»£ç†å¯¹è±¡åœ¨å…¶å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªçœŸå®å¯¹è±¡çš„å¼•ç”¨ã€‚å½“å®¢æˆ·ç«¯è¯·æ±‚ä»£ç†å¯¹è±¡æ—¶ï¼Œä»£ç†å¯¹è±¡å°†å…¶è½¬å‘ç»™çœŸå®å¯¹è±¡ï¼Œå¹¶åœ¨è°ƒç”¨å‰æˆ–è°ƒç”¨åè¿›è¡Œä¸€äº›å¢å¼ºæ“ä½œã€‚</p> 
<p>ä»£ç†æ¨¡å¼æœ‰ä¸åŒçš„ç±»å‹ï¼Œä¾‹å¦‚é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ã€‚é™æ€ä»£ç†æ˜¯åœ¨ç¼–è¯‘æ—¶åˆ›å»ºçš„ä»£ç†å¯¹è±¡ï¼Œè€ŒåŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åˆ›å»ºçš„ä»£ç†å¯¹è±¡ã€‚å› æ­¤ï¼ŒåŠ¨æ€ä»£ç†æ›´åŠ çµæ´»å’Œæ˜“äºæ‰©å±•ã€‚</p> 
<p>åœ¨ Java ä¸­ï¼Œä»£ç†æ¨¡å¼æ˜¯å¹¿æ³›ä½¿ç”¨çš„ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œå®ƒå¯ä»¥ç”¨äºå®ç° AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰ç­‰åº”ç”¨åœºæ™¯ã€‚</p> 
<h3><a id="_10"></a>ä»£ç†æ¨¡å¼çš„ä½¿ç”¨åœºæ™¯</h3> 
<ul><li>å½“ç›®æ ‡å¯¹è±¡ä¸é€‚åˆç›´æ¥è®¿é—®æˆ–è€…ä¸æ–¹ä¾¿è®¿é—®æ—¶ã€‚</li><li>å½“éœ€è¦åœ¨å¯¹è±¡çš„è®¿é—®ä¸Šå¢åŠ æ§åˆ¶å’Œå®‰å…¨æ€§æ—¶ã€‚</li><li>å½“éœ€è¦å¢å¼ºå¯¹è±¡çš„åŠŸèƒ½æ—¶ã€‚</li><li>å½“å¯¹è±¡çš„è®¿é—®éœ€è¦ç»™äºˆå…¶ä»–å¯¹è±¡æˆ–æ¯ä¸ªå¯¹è±¡ä¸å¯èƒ½è®°ä½æ‰€æœ‰ç»†èŠ‚æ—¶ã€‚</li></ul> 
<h3><a id="_17"></a>é™æ€ä»£ç†çš„ä»£ç ç¤ºä¾‹</h3> 
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨é™æ€ä»£ç†æ–¹å¼çš„ä»£ç ç¤ºä¾‹ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª <code>Subject</code> æ¥å£å’Œä¸€ä¸ª <code>RealSubject</code> ç±»ï¼Œæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ª <code>StaticProxy</code> ä»£ç†ç±»å¯¹å…¶è¿›è¡Œå¢å¼ºå¤„ç†ï¼š</p> 
<pre><code class="prism language-java"><span class="token comment">// Subject æ¥å£</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Subject</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// RealSubject æ¥å£</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RealSubject</span> <span class="token keyword">implements</span> <span class="token class-name">Subject</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è®¿é—®çœŸå®å¯¹è±¡"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// StaticProxy ä»£ç†ç±»</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticProxy</span> <span class="token keyword">implements</span> <span class="token class-name">Subject</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Subject</span> subject<span class="token punctuation">;</span>
    
    <span class="token comment">// æ„é€ å‡½æ•°åˆå§‹åŒ–ç›®æ ‡å¯¹è±¡</span>
    <span class="token keyword">public</span> <span class="token class-name">StaticProxy</span><span class="token punctuation">(</span><span class="token class-name">Subject</span> subject<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>subject <span class="token operator">=</span> subject<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è°ƒç”¨æ–¹æ³•å‰å¢å¼º"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        subject<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è°ƒç”¨æ–¹æ³•åå¢å¼º"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// å®¢æˆ·ç«¯ä½¿ç”¨ç¤ºä¾‹</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// åˆ›å»ºç›®æ ‡å¯¹è±¡</span>
        <span class="token class-name">RealSubject</span> realSubject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RealSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ›å»ºä»£ç†å¯¹è±¡å¹¶åˆå§‹åŒ–ç›®æ ‡å¯¹è±¡</span>
        <span class="token class-name">StaticProxy</span> proxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StaticProxy</span><span class="token punctuation">(</span>realSubject<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ç›®æ ‡å¯¹è±¡æ–¹æ³•</span>
        proxy<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>StaticProxy</code> ç±»å®ç°äº† <code>Subject</code> æ¥å£ï¼Œå¹¶åœ¨å…¶å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª <code>RealSubject</code> å¯¹è±¡çš„å¼•ç”¨ã€‚åœ¨ <code>request()</code> æ–¹æ³•ä¸­ï¼Œä»£ç†å¯¹è±¡å…ˆè¿›è¡Œå¢å¼ºå¤„ç†ï¼Œç„¶åè°ƒç”¨ç›®æ ‡å¯¹è±¡çš„ <code>request()</code> æ–¹æ³•ï¼Œå¹¶åœ¨æ–¹æ³•æ‰§è¡Œåå†è¿›è¡Œå¢å¼ºå¤„ç†ã€‚</p> 
<p>åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ï¼Œé¦–å…ˆåˆ›å»ºäº†ç›®æ ‡å¯¹è±¡ <code>RealSubject</code>ï¼Œç„¶ååˆ›å»ºä»£ç†å¯¹è±¡ <code>StaticProxy</code> å¹¶å°†å…¶ç»‘å®šåˆ°ç›®æ ‡å¯¹è±¡ä¸Šï¼Œæœ€åé€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨æ–¹æ³•ã€‚</p> 
<p>æ€»çš„æ¥è¯´ï¼Œé™æ€ä»£ç†æ˜¯ä¸€ç§ç®€å•æ˜“ç”¨çš„ä»£ç†æ¨¡å¼ï¼Œé€‚åˆäºä¸€äº›å°è§„æ¨¡çš„åº”ç”¨åœºæ™¯ï¼Œä½†å¯¹äºå¤§è§„æ¨¡çš„ç³»ç»Ÿæ¥è¯´ï¼Œä»£ç†ç±»çš„æ•°é‡ä¼šéå¸¸å¤šï¼Œå¢åŠ ä»£ç ç»´æŠ¤çš„éš¾åº¦å’Œå¤æ‚åº¦ã€‚æ­¤æ—¶æ›´åŠ çµæ´»ã€å¯æ‰©å±•å’Œæ˜“äºç»´æŠ¤çš„æ–¹å¼æ˜¯åŠ¨æ€ä»£ç†ã€‚</p> 
<h3><a id="_69"></a>åŠ¨æ€ä»£ç†çš„ç¤ºä¾‹ä»£ç </h3> 
<h5><a id="Java_JDK_71"></a>Java JDKåŠ¨æ€ä»£ç†</h5> 
<p>JDK åŠ¨æ€ä»£ç†ä¸»è¦æ¶‰åŠä¸¤ä¸ªç±»ï¼šProxy å’Œ InvocationHandlerã€‚</p> 
<p>JDK åŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä»£ç†ç±»ï¼Œå®ç°åŠ¨æ€ä»£ç†ä¸»è¦æ˜¯é€šè¿‡ Proxy ç±»å®Œæˆï¼Œè¯¥ç±»æä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³• newProxyInstance()ï¼Œç”¨äºåˆ›å»ºä»£ç†å¯¹è±¡ã€‚è¯¥æ–¹æ³•éœ€è¦ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼š</p> 
<ol><li>ç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰ï¼šç”¨äºåŠ è½½ä»£ç†ç±»ã€‚</li><li>ä»£ç†ç±»éœ€è¦å®ç°çš„æ‰€æœ‰æ¥å£ï¼ˆClass&lt;?&gt;[] interfacesï¼‰ï¼šä»£ç†å¯¹è±¡éœ€è¦å®ç°çš„æ‰€æœ‰æ¥å£ã€‚</li><li>å¤„ç†å™¨å¯¹è±¡ï¼ˆInvocationHandlerï¼‰ï¼šè¯¥ä»£ç†å¯¹è±¡çš„å…·ä½“æ‰§è¡Œé€»è¾‘ã€‚</li></ol> 
<pre><code class="prism language-java"><span class="token class-name">Object</span> proxy <span class="token operator">=</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">,</span> interfaces<span class="token punctuation">,</span> invocationHandler<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>InvocationHandler æ¥å£æ˜¯ Java JDK åŠ¨æ€ä»£ç†çš„æ ¸å¿ƒæ¥å£ã€‚è¯¥æ¥å£åªæœ‰ä¸€ä¸ªæ–¹æ³• invoke()ï¼Œç”¨äºå¤„ç†ä»£ç†å¯¹è±¡æ–¹æ³•çš„è°ƒç”¨ã€‚è¯¥æ–¹æ³•æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š</p> 
<ol><li>ä»£ç†å¯¹è±¡ï¼ˆObjectï¼‰ï¼šè¢«ä»£ç†çš„å¯¹è±¡å®ä¾‹ã€‚</li><li>å½“å‰è°ƒç”¨çš„æ–¹æ³•ï¼ˆMethodï¼‰ï¼šè¢«è°ƒç”¨çš„æ–¹æ³•å®ä¾‹ã€‚</li><li>æ–¹æ³•çš„å‚æ•°ï¼ˆObject[]ï¼‰ï¼šæ–¹æ³•çš„å‚æ•°å¯¹è±¡ã€‚</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>åœ¨ invoke() æ–¹æ³•ä¸­ï¼Œå¯ä»¥æ ¹æ®éœ€è¦å¯¹åŸæ–¹æ³•è¿›è¡Œå¢å¼ºã€ä¿®æ”¹æˆ–ç»•è¿‡ç­‰æ“ä½œï¼Œå¹¶è¿”å›ä»£ç†å¯¹è±¡çš„æ‰§è¡Œç»“æœã€‚</p> 
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ JDK åŠ¨æ€ä»£ç†ç¤ºä¾‹ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª Hello æ¥å£å’Œå®ç°ç±» HelloImplï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨è°ƒç”¨ Hello æ¥å£çš„ sayHello() æ–¹æ³•å‰ååˆ†åˆ«è¾“å‡ºâ€œHello, Beforeâ€å’Œâ€œHello, Afterâ€ã€‚</p> 
<pre><code class="prism language-java"><span class="token comment">// Hello æ¥å£</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Hello</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Hello å®ç°ç±»</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloImpl</span> <span class="token keyword">implements</span> <span class="token class-name">Hello</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello, World!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ä»£ç†å¤„ç†å™¨</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HelloProxy</span> <span class="token keyword">implements</span> <span class="token class-name">InvocationHandler</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">Object</span> target<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">HelloProxy</span><span class="token punctuation">(</span><span class="token class-name">Object</span> target<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello, Before"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Hello, After"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// æµ‹è¯•ä»£ç </span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProxyTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// åˆ›å»ºç›®æ ‡å¯¹è±¡</span>
        <span class="token class-name">Hello</span> hello <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HelloImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// åˆ›å»ºä»£ç†å¯¹è±¡</span>
        <span class="token class-name">HelloProxy</span> helloProxy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HelloProxy</span><span class="token punctuation">(</span>hello<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Hello</span> helloProxyInstance <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Hello</span><span class="token punctuation">)</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>hello<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                            hello<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                            helloProxy<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è°ƒç”¨ä»£ç†å¯¹è±¡æ–¹æ³•</span>
        helloProxyInstance<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p> 
<pre><code>Hello, Before
Hello, World!
Hello, After
</code></pre> 
<p>ä»è¿è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œåœ¨è°ƒç”¨ä»£ç†å¯¹è±¡çš„ sayHello() æ–¹æ³•å‰ååˆ†åˆ«æ‰§è¡Œäº†â€œHello, Beforeâ€å’Œâ€œHello, Afterâ€çš„è¾“å‡ºã€‚è¿™å°±æ˜¯ JDK åŠ¨æ€ä»£ç†çš„åŸºæœ¬å®ç°åŸç†ã€‚</p> 
<h5><a id="CGLIB__159"></a>CGLIB åŠ¨æ€ä»£ç†</h5> 
<p>ä½¿ç”¨ CGLIB åŠ¨æ€ä»£ç†ä¸»è¦ç”¨åˆ°ä¸¤ä¸ªç±»ï¼šEnhancer å’Œ MethodInterceptorã€‚</p> 
<p>ä½¿ç”¨ Enhancer ç±»å¯ä»¥å®ç°åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œå¹¶è®¾ç½®ä»£ç†å¯¹è±¡çš„çˆ¶ç±»ã€å¢å¼ºå™¨ç­‰ã€‚ä¸»è¦æµç¨‹å¦‚ä¸‹ï¼š</p> 
<pre><code class="prism language-java"><span class="token class-name">Enhancer</span> enhancer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// åˆ›å»º Enhancer å¯¹è±¡</span>
enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span><span class="token class-name">TargetObject</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// è®¾ç½®çˆ¶ç±»</span>
enhancer<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TargetInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// è®¾ç½®å¢å¼ºå™¨</span>
<span class="token class-name">TargetObject</span> targetObjectProxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">TargetObject</span><span class="token punctuation">)</span> enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// åˆ›å»ºä»£ç†å¯¹è±¡</span>
</code></pre> 
<p>éœ€è¦è®¾ç½®ä»£ç†å¯¹è±¡çš„çˆ¶ç±»ã€å¢å¼ºå™¨ Callbackã€æ¥å£ç­‰å±æ€§ã€‚</p> 
<p>MethodInterceptor æ¥å£æ˜¯ CGLIB åŠ¨æ€ä»£ç†çš„æ ¸å¿ƒæ¥å£ï¼Œå¿…é¡»å®ç°è¯¥æ¥å£çš„ intercept() æ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼šåœ¨ä»£ç†å¯¹è±¡æ–¹æ³•è°ƒç”¨æ—¶è¢«è°ƒç”¨ã€‚å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š</p> 
<ol><li>ä»£ç†å¯¹è±¡ï¼ˆObjectï¼‰ï¼šè¡¨ç¤ºè¢«ä»£ç†çš„å¯¹è±¡ã€‚</li><li>åŸå§‹æ–¹æ³•ï¼ˆMethodï¼‰ï¼šè¡¨ç¤ºè¢«ä»£ç†å¯¹è±¡è¢«æ‹¦æˆªçš„æ–¹æ³•ã€‚</li><li>æ–¹æ³•å‚æ•°åˆ—è¡¨ï¼ˆObject[]ï¼‰ï¼šè¡¨ç¤ºè¢«ä»£ç†å¯¹è±¡è¢«æ‹¦æˆªçš„æ–¹æ³•çš„å‚æ•°åˆ—è¡¨ã€‚</li><li>MethodProxyï¼šè¡¨ç¤ºå¯¹è¢«ä»£ç†å¯¹è±¡æ–¹æ³•çš„ä»£ç†ï¼ŒinvokeSuper() æ–¹æ³•å¯ä»¥è°ƒç”¨å®é™…çš„ç›®æ ‡å¯¹è±¡ã€‚</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MethodInterceptor</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">MethodProxy</span> proxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>åœ¨ intercept() æ–¹æ³•ä¸­ï¼Œå¯ä»¥æ ¹æ®éœ€è¦å¯¹åŸæ–¹æ³•è¿›è¡Œå¢å¼ºã€ä¿®æ”¹æˆ–ç»•è¿‡ç­‰æ“ä½œï¼Œå¹¶è¿”å›ä»£ç†å¯¹è±¡çš„æ‰§è¡Œç»“æœã€‚</p> 
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ CGLIB åŠ¨æ€ä»£ç†ç¤ºä¾‹ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª UserService æ¥å£å’Œå®ç°ç±» UserServiceImplï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨è°ƒç”¨ UserService æ¥å£çš„æ–¹æ³•å‰ååˆ†åˆ«è¾“å‡ºâ€œBeforeâ€å’Œâ€œAfterâ€ã€‚</p> 
<pre><code class="prism language-java"><span class="token comment">// UserService æ¥å£</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// UserService å®ç°ç±»</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Add a user"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// CGLIB åŠ¨æ€ä»£ç†æ‹¦æˆªå™¨</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">MethodInterceptor</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">MethodProxy</span> proxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Before"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> result <span class="token operator">=</span> proxy<span class="token punctuation">.</span><span class="token function">invokeSuper</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"After"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// æµ‹è¯•ä»£ç </span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProxyTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// åˆ›å»ºç›®æ ‡å¯¹è±¡</span>
        <span class="token class-name">UserService</span> userService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// åˆ›å»ºå¢å¼ºå™¨</span>
        <span class="token class-name">Enhancer</span> enhancer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span>userService<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        enhancer<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UserServiceInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// åˆ›å»ºä»£ç†å¯¹è±¡</span>
        <span class="token class-name">UserService</span> userServiceProxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">UserService</span><span class="token punctuation">)</span> enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// è°ƒç”¨ä»£ç†å¯¹è±¡æ–¹æ³•</span>
        userServiceProxy<span class="token punctuation">.</span><span class="token function">addUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p> 
<pre><code>Before
Add a user
After
</code></pre> 
<p>ä»è¿è¡Œç»“æœå¯ä»¥çœ‹å‡ºï¼Œåœ¨è°ƒç”¨ä»£ç†å¯¹è±¡çš„ addUser() æ–¹æ³•å‰ååˆ†åˆ«æ‰§è¡Œäº†â€œBeforeâ€å’Œâ€œAfterâ€çš„è¾“å‡ºã€‚è¿™å°±æ˜¯ CGLIB åŠ¨æ€ä»£ç†çš„åŸºæœ¬å®ç°åŸç†ã€‚</p> 
<h3><a id="_244"></a>ä»£ç†æ¨¡å¼çš„å®é™…åº”ç”¨</h3> 
<ol><li>Spring AOP</li></ol> 
<p>Spring AOP ä½¿ç”¨ä»£ç†æ¨¡å¼æ¥å®ç°é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰ï¼Œå…¶ä¸­ï¼Œä»£ç†å¯¹è±¡åœ¨è°ƒç”¨æ–¹æ³•æ—¶è´Ÿè´£æ·»åŠ æ¨ªåˆ‡é€»è¾‘ï¼Œå¹¶æœ€ç»ˆå°†è°ƒç”¨è½¬å‘ç»™ç›®æ ‡å¯¹è±¡ã€‚Spring AOP æä¾›äº†ä¸¤ç§ä»£ç†æ–¹å¼ï¼šJDK åŠ¨æ€ä»£ç†å’Œ CGLIB ä»£ç†ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†è‡³å°‘ä¸€ä¸ªæ¥å£ï¼Œåˆ™ä½¿ç”¨ JDK åŠ¨æ€ä»£ç†ã€‚å¦åˆ™ï¼Œä¼šä½¿ç”¨ CGLIB ä»£ç†ã€‚</p> 
<p>ä»¥ä¸‹æ˜¯é€šè¿‡ Spring AOP é…ç½®å¢å¼ºæ–¹æ³•çš„ç¤ºä¾‹ï¼š</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoggingAspect</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">"execution(* com.example.demo.service.UserService.*(..))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logBefore</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è°ƒç”¨æ–¹æ³•å‰å¢å¼º"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">"execution(* com.example.demo.service.UserService.*(..))"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">logAfter</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"è°ƒç”¨æ–¹æ³•åå¢å¼º"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>Hibernate</li></ol> 
<p>Hibernate æ˜¯ä¸€ä¸ªæµè¡Œçš„ ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æ¡†æ¶ï¼Œå®ƒä½¿ç”¨ä»£ç†æ¨¡å¼æ¥å»¶è¿ŸåŠ è½½å¯¹è±¡ã€‚å»¶è¿ŸåŠ è½½æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œåœ¨å¯¹è±¡è¢«è¯·æ±‚æ—¶ä»æ•°æ®åº“ä¸­åŠ è½½ã€‚<br> ä»¥ä¸‹æ˜¯é€šè¿‡ Hibernate å®ç°æ‡’åŠ è½½çš„ç¤ºä¾‹ï¼š</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Customer</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
    <span class="token annotation punctuation">@OneToMany</span><span class="token punctuation">(</span>mappedBy <span class="token operator">=</span> <span class="token string">"customer"</span><span class="token punctuation">,</span> fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span><span class="token constant">LAZY</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> orders <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Order</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> orderDate<span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
    <span class="token annotation punctuation">@ManyToOne</span><span class="token punctuation">(</span>fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span><span class="token constant">LAZY</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Customer</span> customer<span class="token punctuation">;</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œé€šè¿‡ <code>@OneToMany</code> å’Œ <code>@ManyToOne</code> æ³¨é‡Šé…ç½®äº†åŒå‘å…³è”ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™ç§å…³è”ä¼šè‡ªåŠ¨è¿›è¡Œæ‡’åŠ è½½ï¼Œå³åœ¨è®¿é—®è®¢å•åˆ—è¡¨æˆ–å®¢æˆ·è¯¦æƒ…æ—¶æ‰ä¼šä»æ•°æ®åº“ä¸­åŠ è½½ã€‚</p> 
<ol start="3"><li>MyBatis</li></ol> 
<p>MyBatis æ˜¯ä¸€ä¸ªæµè¡Œçš„ SQL æ˜ å°„æ¡†æ¶ï¼Œå®ƒä½¿ç”¨äº†ä»£ç†æ¨¡å¼æ¥å»¶è¿ŸåŠ è½½å¯¹è±¡ã€‚å’Œ Hibernate ç±»ä¼¼ï¼ŒMyBatis ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ¥å®ç°å»¶è¿ŸåŠ è½½ã€‚</p> 
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ MyBatis å’Œä»£ç†æ¨¡å¼çš„ç¤ºä¾‹ï¼š</p> 
<pre><code class="prism language-java"><span class="token comment">// UserMapper.java</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserMapper</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM user WHERE id = #{id}"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@Results</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span> column <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">"name"</span><span class="token punctuation">,</span> column <span class="token operator">=</span> <span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token annotation punctuation">@Result</span><span class="token punctuation">(</span>property <span class="token operator">=</span> <span class="token string">"orders"</span><span class="token punctuation">,</span> column <span class="token operator">=</span> <span class="token string">"id"</span><span class="token punctuation">,</span> 
            javaType <span class="token operator">=</span> <span class="token class-name">List</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> many <span class="token operator">=</span> <span class="token annotation punctuation">@Many</span><span class="token punctuation">(</span>select <span class="token operator">=</span> <span class="token string">"com.example.demo.dao.OrderMapper.findByUserId"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token class-name">User</span> <span class="token function">findById</span><span class="token punctuation">(</span><span class="token keyword">int</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// OrderMapper.java</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderMapper</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Select</span><span class="token punctuation">(</span><span class="token string">"SELECT * FROM order WHERE user_id = #{userId}"</span><span class="token punctuation">)</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> <span class="token function">findByUserId</span><span class="token punctuation">(</span><span class="token keyword">int</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// User.java</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Order</span><span class="token punctuation">&gt;</span></span> orders<span class="token punctuation">;</span>
    <span class="token comment">// getters and setters</span>
<span class="token punctuation">}</span>

<span class="token comment">// Order.java</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Order</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Date</span> date<span class="token punctuation">;</span>
    <span class="token comment">// getters and setters</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œé€šè¿‡é…ç½® MyBatis çš„ <code>@Result</code> æ³¨é‡Šå’Œ <code>@Many</code> æ³¨é‡Šæ¥å®ç°å»¶è¿ŸåŠ è½½ã€‚å½“ä¸€ä¸ªç”¨æˆ·å¯¹è±¡è°ƒç”¨ <code>getOrders()</code> æ–¹æ³•æ—¶ï¼Œä»£ç†å¯¹è±¡ä¼šä»æ•°æ®åº“ä¸­æŸ¥è¯¢è¯¥ç”¨æˆ·çš„æ‰€æœ‰è®¢å•å¹¶è¿”å›ã€‚</p> 
<p>å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼šâ€œå°è™å“¥çš„æŠ€æœ¯åšå®¢â€ã€‚æˆ‘ä»¬ä¼šå®šæœŸå‘å¸ƒå…³äºJavaæŠ€æœ¯çš„è¯¦å°½æ–‡ç« ï¼Œè®©æ‚¨èƒ½å¤Ÿæ·±å…¥äº†è§£è¯¥é¢†åŸŸçš„å„ç§æŠ€å·§å’Œæ–¹æ³•ï¼Œè®©æˆ‘ä»¬ä¸€èµ·æˆä¸ºæ›´ä¼˜ç§€çš„ç¨‹åºå‘˜ğŸ‘©â€ğŸ’»ğŸ‘¨â€ğŸ’»ï¼</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1ae06c9f20d7e75d8ab905170a0cdeb5/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">ffmpegæœ€ç®€å•æ–¹å¼æ”¯æŒnvidiaç¡¬ç¼–è§£ç </p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b1a8c5589bd786b2899eb3a98b8df4f6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">ï¼ˆå››ï¼‰FLUXè¯­æ³•</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 èœé¸Ÿç¨‹åºå‘˜åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>