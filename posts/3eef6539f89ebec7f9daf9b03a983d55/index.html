<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>从0开始python学习-47.pytest框架之解决Template替换无法进行二次处理的问题之热加载 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="从0开始python学习-47.pytest框架之解决Template替换无法进行二次处理的问题之热加载" />
<meta property="og:description" content="问题：当参数为动态参数时，Template替换无法进行二次处理
解决方案：通过热加载来进行替换
热加载原理：在代码运行的过程中动态的调用python中的方法达到获得动态参数
可以进行热加载的情况：yaml文件，随机数，替换后的值进行计算，加密等
示例：
需要热加载的数据：
yaml数据：extract.yaml
token: 76_ZgYcDxWFgCCjZVj2EPfqj7QWW_k3-iUZq68Mr6hE_VvDDa_IAfjEIi7nQwMUoISer8MAspesP1JnP1iIziezVPcB4jqZs4z_3EQpVtkEVm0Z0L7VyTmQV7JC0gsTYGaAAAPUC 需要操作的数据
class DeBugTalk: #场景一：读取yaml中的数据 def read_yaml(self,key): with open(&#34;D:\study\pytest\extract.yaml&#34;, encoding=&#34;utf-8&#34;) as f: value = yaml.safe_load(f) return value[key] # 场景二：数据计算 def add(self,a,b): return str(int(a)&#43;int(b)) # 场景三：读取随机数 def random(self): return str(random.randint(1, 10)) 热加载方法
class ExtractUtil: def hotload_replace(self,data_str:str): # 1.定义一个正则匹配的通用表达式 # regexp = &#34;\\$\\{(.*?)\\}&#34; # 用于匹配格式为：${access_token} regexp = &#34;\\$\\{(.*?)\\((.*?)\\)\\}&#34; # 用于匹配格式为：${函数名(参数)} fun_list = re.findall(regexp,data_str) for f in fun_list: print(f) # ${函数名(参数)} &gt;&gt;函数名=f[0],参数为=f[1] if f[1] == &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/3eef6539f89ebec7f9daf9b03a983d55/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-11T13:18:36+08:00" />
<meta property="article:modified_time" content="2024-01-11T13:18:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">从0开始python学习-47.pytest框架之解决Template替换无法进行二次处理的问题之热加载</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>问题</strong>：当参数为动态参数时，Template替换无法进行二次处理</p> 
<p><strong>解决方案</strong>：通过热加载来进行替换</p> 
<p><strong>热加载原理</strong>：在代码运行的过程中动态的调用python中的方法达到获得动态参数</p> 
<p><strong>可以进行热加载的情况</strong>：yaml文件，随机数，替换后的值进行计算，加密等</p> 
<p>示例：</p> 
<p>需要热加载的数据：</p> 
<p>yaml数据：extract.yaml</p> 
<pre><code class="language-python">token: 76_ZgYcDxWFgCCjZVj2EPfqj7QWW_k3-iUZq68Mr6hE_VvDDa_IAfjEIi7nQwMUoISer8MAspesP1JnP1iIziezVPcB4jqZs4z_3EQpVtkEVm0Z0L7VyTmQV7JC0gsTYGaAAAPUC</code></pre> 
<p>需要操作的数据</p> 
<pre><code class="language-python">class DeBugTalk:

    #场景一：读取yaml中的数据
    def read_yaml(self,key):
        with open("D:\study\pytest\extract.yaml", encoding="utf-8") as f:
            value = yaml.safe_load(f)
            return value[key]

    # 场景二：数据计算
    def add(self,a,b):
        return str(int(a)+int(b))

    # 场景三：读取随机数
    def random(self):
        return str(random.randint(1, 10))</code></pre> 
<p>热加载方法</p> 
<pre><code class="language-python">class ExtractUtil:
    def hotload_replace(self,data_str:str):
        # 1.定义一个正则匹配的通用表达式
        # regexp = "\\$\\{(.*?)\\}"   # 用于匹配格式为：${access_token}
        regexp = "\\$\\{(.*?)\\((.*?)\\)\\}"  # 用于匹配格式为：${函数名(参数)}
        fun_list = re.findall(regexp,data_str)

        for f in fun_list:
             print(f)
            # ${函数名(参数)} &gt;&gt;函数名=f[0],参数为=f[1]
            if f[1] == "":  # 当f[1]没有参数为''时
                value = getattr(DeBugTalk(), f[0])()  # &gt;&gt;此时通过反射调用了random()和dm5()方法
        
            else:  # 当f[1]有参数时
                value = getattr(DeBugTalk(), f[0])(*f[1].split(","))
        
            # 如果value的值为字符串格式，但是时数字，为了看着清楚明白，可以加一层处理
            if isinstance(value, str) and value.isdigit():
                value = "'" + value + "'"
            print('value:%s' % value, type(value))  # 注意这里的打印是在if同级，不然不满足的数据无法打印
            # 拼接旧的值
            old_value = "${"+f[0]+"("+f[1]+")}"
            # 将旧的值替换成新的值
            data_str = data_str.replace(old_value,str(new_value))
        return data_str


if __name__ == '__main__':
    request_data = {"data1":"${read_yaml(token)}","data2":"${add(1,2)}","data3": "${random()}"}
    data_str = yaml.safe_dump(request_data)
    print("old_str:%s" % data_str)
    data_str = ExtractUtil().hotload_replace(data_str)
    print("new_str:%s" % data_str)</code></pre> 
<p>打印结果</p> 
<p><img alt="" height="298" src="https://images2.imgbox.com/96/ea/omR3wDRC_o.png" width="743"> </p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a98617be74f6f126f9104a883653cd07/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">jmeter--1.安装</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e3e97df165a5a7e58d8b4f303a8c2ea3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">鸿蒙HarmonyOS兼容JS的类Web开发-开发指导</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>