<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>linux docker 使用centos镜像创建容器，内部搭建宝塔面板过程 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="linux docker 使用centos镜像创建容器，内部搭建宝塔面板过程" />
<meta property="og:description" content="宿主机指令，创建启动容器 docker run -itd --name bt-host \ -p 7080:80 \ -p 7022:22 \ -p 7021:21 \ -p 7443:443 \ -p 7888:8888 \ -p 7306:3306 \ -p 7379:6379 \ -p 7700-7720:7700-7720 \ --privileged centos:centos7.9.2009 /usr/sbin/init --privileged ：大约在0.6版，privileged被引入docker。
使用该参数，container内的root拥有真正的root权限。
否则，container内的root只是外部的一个普通用户权限。
privileged启动的容器，可以看到很多host上的设备，并且可以执行mount。
甚至允许你在docker容器中启动docker容器。
进入容器执行初始化 #进入容器 -$ docker exec -it bt-host /bin/bash #安装基础指令 -$ yum -y install sudo -$ yum -y install initscripts #安装宝塔 -$ cd /home &amp;&amp; mkdir bt &amp;&amp; cd bt -$ yum install -y wget &amp;&amp; wget -O install." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/7859a242a5735573991a35530abc7aec/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-29T17:05:09+08:00" />
<meta property="article:modified_time" content="2022-04-29T17:05:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">linux docker 使用centos镜像创建容器，内部搭建宝塔面板过程</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>宿主机指令，创建启动容器</h3> 
<pre><code class="prism language-shell"><span class="token function">docker</span> run -itd --name bt-host <span class="token punctuation">\</span>
-p <span class="token number">7080</span>:80 <span class="token punctuation">\</span>
-p <span class="token number">7022</span>:22 <span class="token punctuation">\</span>
-p <span class="token number">7021</span>:21 <span class="token punctuation">\</span>
-p <span class="token number">7443</span>:443 <span class="token punctuation">\</span>
-p <span class="token number">7888</span>:8888 <span class="token punctuation">\</span>
-p <span class="token number">7306</span>:3306 <span class="token punctuation">\</span>
-p <span class="token number">7379</span>:6379 <span class="token punctuation">\</span>
-p <span class="token number">7700</span>-7720:7700-7720 <span class="token punctuation">\</span>
--privileged centos:centos7.9.2009 /usr/sbin/init
</code></pre> 
<p><code>--privileged</code> ：大约在0.6版，privileged被引入docker。<br> 使用该参数，container内的root拥有真正的root权限。<br> 否则，container内的root只是外部的一个普通用户权限。<br> privileged启动的容器，可以看到很多host上的设备，并且可以执行mount。<br> 甚至允许你在docker容器中启动docker容器。</p> 
<h3><a id="_20"></a>进入容器执行初始化</h3> 
<pre><code class="prism language-shell"><span class="token comment">#进入容器</span>
-$ <span class="token function">docker</span> <span class="token builtin class-name">exec</span> -it bt-host /bin/bash
<span class="token comment">#安装基础指令</span>
-$ yum -y <span class="token function">install</span> <span class="token function">sudo</span> 
-$ yum -y <span class="token function">install</span> initscripts
</code></pre> 
<pre><code class="prism language-shell"><span class="token comment">#安装宝塔</span>
-$ <span class="token builtin class-name">cd</span> /home <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> bt <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">cd</span> bt
-$ yum <span class="token function">install</span> -y <span class="token function">wget</span> <span class="token operator">&amp;&amp;</span> <span class="token function">wget</span> -O install.sh http://download.bt.cn/install/install_6.0.sh <span class="token operator">&amp;&amp;</span> <span class="token function">sh</span> install.sh

<span class="token comment">#宝塔工具</span>
-$ bt

</code></pre> 
<p>修改宝塔账密为<br> http://xxx:7888/admin/<br> adm/xxx</p> 
<p>打开控制面板安装以下应用 lnmp<br> <code>nginx</code><br> <code>mysql</code><br> <code>pureftpd</code><br> <code>php</code><br> <code>phpmyadmin</code><br> 宝塔面板 -》 安全 -》添加FTP被动端口范围<code>7700:7720</code></p> 
<p>宝塔面板 -》 修改pureftpd被动连接模式配置，配置如下，：</p> 
<pre><code class="prism language-xml">ForcePassiveIP            xx.xx.xx.xx #宿主机ip地址
PassivePortRange          7700 7720   #自定端口范围，跟创建容器时要暴露的端口对应一致
</code></pre> 
<p>重启pureftpd服务</p> 
<h4><a id="phpmyadmin_nginx_58"></a>phpmyadmin 配置nginx代理过程</h4> 
<p>宿主机nginx配置/usr/local/nginx/conf/vhost/www.sentgon.com.conf :</p> 
<pre><code class="prism language-xml">  location ^~ /bt-phpmyadmin/ {
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Host $server_name;
    proxy_pass http://localhost:7080;
 }
</code></pre> 
<p><code>bt-host</code> nginx配置/www/server/panel/vhost/nginx/0.default.conf :</p> 
<pre><code class="prism language-xml">location /bt-phpmyadmin/ {
       proxy_pass http://localhost:888/;
       proxy_cookie_path / /bt-phpmyadmin/;
       proxy_redirect / https://$host/bt-phpmyadmin/;
}
</code></pre> 
<p>#phpmyadmin 登录,<br> 登录地址：https://xxx.com/bt-phpmyadmin/phpmyadmin_xxx/（具体登录地址打开小皮面板phpmyadmin应用查看）<br> 账号密码：root / xxx （密码可以在宝塔面板-&gt;数据库&gt;修改root密码）</p> 
<h4><a id="__83"></a>打开宝塔面板创建测试站点 ，测试访问</h4> 
<p>FTP账号资料<br> 用户：test_com<br> 密码：123456<br> 数据库账号资料<br> 数据库名：test_com<br> 用户：test_com<br> 密码：123456</p> 
<p>访问http://test.com 测试发现，404<br> 此时需要配置由宿主机nginx把请求通过端口转向到当前容器内，请参考进一步的操作<br> <a href="https://blog.csdn.net/u014438244/article/details/120582184">https://blog.csdn.net/u014438244/article/details/120582184</a></p> 
<h4><a id="_97"></a>安装一些基础的工具包</h4> 
<p>参考：https://blog.csdn.net/u013469753/article/details/107556249</p> 
<p>1.虚拟机上传下载组件</p> 
<pre><code>支持从windows直接拖拽文件

yum -y install lrzsz  

使用：

rz+文件名(上传)
sz+文件名(下载)
</code></pre> 
<p>2.gcc</p> 
<pre><code>nginx之类由c语言开发的，编译的时候需要用到

yum -y install gcc-c++ 
</code></pre> 
<p>3.PCRE (Perl库，包括 perl 兼容的正则表达式库)</p> 
<pre><code>yum -y install pcre pcre-devel 
</code></pre> 
<p>4.zlib</p> 
<pre><code>zlib库提供了很多种压缩和解压缩的方式

yum -y install zlib zlib-devel ruby
</code></pre> 
<p>5.openssl</p> 
<pre><code>OpenSSL 是一个强大的安全套接字层密码库，囊括主要的密码算法、常用的密钥和证书封装管理功能及SSL协议

yum -y install openssl openssl-devel patch
</code></pre> 
<p>6.安装wget下载工具</p> 
<pre><code>yum -y install wget
</code></pre> 
<p>7.自动补全命令</p> 
<pre><code>使用systemctl自动补全服务名称， 因为CentOS7的默认安装类型是最小安装，所以默认没有自动补全的功能。

yum install -y bash-completion
</code></pre> 
<p>8.aapt兼容程序</p> 
<pre><code>centos 64位系统兼容32位运行程序aapt

yum install -y zlib.i686 libstdc++.i686
</code></pre> 
<p>9.安装lsof</p> 
<pre><code>list open files是一个列出当前系统打开文件的工具

yum install lsof -y
</code></pre> 
<p>10.zip unzip</p> 
<pre><code>yum install -y unzip zip
</code></pre> 
<p>11.其他</p> 
<pre><code>yum install -y vim net-tools git
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/95c74ceab5418b43999dd1f033678cd8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">RS485通信模块使用及代码【简】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2905623c592643611f7c3a31ae9307b7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【RTSP流】使用flv.js &#43; websocket播放rtsp视频流（h264）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>