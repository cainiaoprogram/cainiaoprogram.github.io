<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Integral-human-pose-2D - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Integral-human-pose-2D" />
<meta property="og:description" content="Integral-human-pose-2D Integral human pose estimation的2D pytorch实现 Integral human pose estimation的2D pytorch实现 原始链接：
https://github.com/JimmySuen/integral-human-pose/blob/master/pytorch_projects/common_pytorch/loss/integral.py
import torch.nn.functional as F import torch from torch.autograd import Variable import torch.nn as nn import numpy as np import os def makeGaussian(height, width, sigma = 3, center=None): &#34;&#34;&#34; Make a square gaussian kernel. size is the length of a side of the square sigma is full-width-half-maximum, which can be thought of as an effective radius. &#34;&#34;&#34; x = np." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/df4d8cde329e6952f43213f24a688366/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-04-24T18:33:12+08:00" />
<meta property="article:modified_time" content="2020-04-24T18:33:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Integral-human-pose-2D</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Integral-human-pose-2D</h4> 
 <ul><li><ul><li><a href="#Integral_human_pose_estimation2D_pytorch_2" rel="nofollow">Integral human pose estimation的2D pytorch实现</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="Integral_human_pose_estimation2D_pytorch_2"></a>Integral human pose estimation的2D pytorch实现</h3> 
<p>原始链接：<br> https://github.com/JimmySuen/integral-human-pose/blob/master/pytorch_projects/common_pytorch/loss/integral.py</p> 
<pre><code>import torch.nn.functional as F
import torch
from torch.autograd import Variable
import torch.nn as nn
import numpy as np
import os

def makeGaussian(height, width, sigma = 3, center=None):
        """ Make a square gaussian kernel.
        size is the length of a side of the square
        sigma is full-width-half-maximum, which
        can be thought of as an effective radius.
        """
        x = np.arange(0, width, 1, float)
        y = np.arange(0, height, 1, float)[:, np.newaxis]
        if center is None:
            x0 =  width // 2
            y0 = height // 2
        else:
            x0 = center[0]
            y0 = center[1]
        return 10*np.exp(-4*np.log(2) * ((x-x0)**2 + (y-y0)**2) / sigma**2)
    
def generate_hm(height, width ,joints, maxlenght):
        """ Generate a full Heap Map for every joints in an array
        Args:
            height          : Wanted Height for the Heat Map
            width           : Wanted Width for the Heat Map
            joints          : Array of Joints 15*2
            maxlenght       : Lenght of the Bounding Box
        """
        num_joints = joints.shape[0]
        hm = np.zeros((num_joints, height, width), dtype = np.float32)
        for i in range(num_joints):
            s = int(np.sqrt(maxlenght) * maxlenght * 10 / 4096) + 3
            hm[i,:,:] = makeGaussian(height, width, sigma= s, center= (joints[i,0], joints[i,1]))      
        return hm   


def generate_3d_integral_preds_tensor(heatmaps, num_joints, x_dim, y_dim):
    assert isinstance(heatmaps, torch.Tensor)
	'''
    heatmap: [B, numJoint, H, W]
    '''
    heatmaps = heatmaps.reshape((heatmaps.shape[0], num_joints, y_dim, x_dim))

    accu_x = heatmaps.sum(dim=2)  # [1, 2, x_dim]

    accu_y = heatmaps.sum(dim=3)

    accu_x = accu_x * torch.cuda.comm.broadcast(torch.arange(x_dim).type(torch.cuda.FloatTensor), devices=[accu_x.device.index])[0]
    accu_y = accu_y * torch.cuda.comm.broadcast(torch.arange(y_dim).type(torch.cuda.FloatTensor), devices=[accu_y.device.index])[0]

    accu_x = accu_x.sum(dim=2, keepdim=True)
    accu_y = accu_y.sum(dim=2, keepdim=True)
    return accu_x, accu_y

if __name__ == '__main__':
    GT_xy = np.array([[10,10], [3,8], [16,18]])
    heatmap = generate_hm(64, 32 ,GT_xy, 64)   # [numJoint, 64, 64]

    heatmap = torch.unsqueeze(torch.from_numpy(heatmap), 0).cuda()  # [1, numJoint, 64, 64]

    preds = heatmap.reshape((heatmap.shape[0], 3, -1))
    preds = F.softmax(preds, 2)
    
    x, y = generate_3d_integral_preds_tensor(heatmaps=preds, num_joints=3, x_dim=32, y_dim=64)  # 
    # x,y: [1,numJoint,3]
    preds = torch.cat((x, y), dim=0)  # [2,numJoint,1]
    preds = preds.permute(1, 0, 2)  # [numJoint,2,1]
    preds = preds.squeeze()   ####  [numJoint, 2]
    print('preds ', preds.size(), preds)
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cd83f7da5abd1a6c01c39273e4b624a6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Tkinter 文件对话框filedialog模块</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/867166d1a8829de9de6154d3b7378f12/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数据结构与算法Python版第十周OJ作业</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>