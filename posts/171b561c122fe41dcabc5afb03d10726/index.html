<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Mysql中find_in_set（）函数与in（）函数的用法 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Mysql中find_in_set（）函数与in（）函数的用法" />
<meta property="og:description" content="背景 今天同事让帮忙写个sql，大致是一张表的两个字段都关联另外一张表的主键，这个完全可以把两个表当作三个表来写，大概是这种：
SELECT
t1.name,
t1.id,
t2.reason,
t3.result
FROM
test1_copy1 AS t1
INNER JOIN test1 AS t2 ON t1.id = t2.reason
INNER JOIN test1 AS t3 ON t1.id = t3.result
这种是可以实现的，但是我看到数据里的另一个点，那就是t2.reason字段，存放的是用逗号隔开的字符串，如下所示，kg_rules表的reason和result对应kg_facts表的id，查询kg_rules表的每一条记录对应的名字（name）和含义（mean）
第一步：先使用find_in_set解决范围查找 SELECT
a.id,
b.name
FROM
kg_rules a
LEFT JOIN kg_facts b ON FIND_IN_SET(b.id, a.reason)
结果为：
这里会看到根据表kg_rules的reason，找到了三条记录。达到了我想要的结果，来分享记录一下Mysql这个方法吧。
1.认识find_in_set（）函数 Mysql官方文档手册，如下图：
2.find_in_set（）基本操作 select find_in_set (‘b’, ‘a,b,c,d,w’);
结果为2，因为b字符串在strlist集合中，在第二个位置，起始数是从1开始的
select find_in_set(‘6’,‘1,2’);
结果为0，因为第一个字符串6，并不在第二个参数中
对于上面写的sql语句，使用find_in_set（）进行数据查询的时候，一次可以返回多条记录的情况
上面的语句类似于in（）如下的操作：
select id,name from kg_facts where id in(1,2,3)
3.find_in_set()与in()的应用场景区别 刚刚上面的情况也看到了
select * from kg_facts where find_in_set(id,‘1,2,3’)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/171b561c122fe41dcabc5afb03d10726/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-06T18:19:31+08:00" />
<meta property="article:modified_time" content="2021-05-06T18:19:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Mysql中find_in_set（）函数与in（）函数的用法</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h5><a id="_0"></a>背景</h5> 
<p>今天同事让帮忙写个sql，大致是一张表的两个字段都关联另外一张表的主键，这个完全可以把两个表当作三个表来写，大概是这种：</p> 
<blockquote> 
 <p>SELECT<br> t1.<code>name</code>,<br> t1.<code>id</code>,<br> t2.reason,<br> t3.result<br> FROM<br> test1_copy1 AS t1<br> INNER JOIN test1 AS t2 ON t1.id = t2.reason<br> INNER JOIN test1 AS t3 ON t1.id = t3.result</p> 
</blockquote> 
<p>这种是可以实现的，但是我看到数据里的另一个点，那就是t2.reason字段，存放的是用逗号隔开的字符串，如下所示，kg_rules表的reason和result对应kg_facts表的id，查询kg_rules表的每一条记录对应的名字（name）和含义（mean）<br> <img src="https://images2.imgbox.com/31/92/TtvT5f0g_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f3/3e/RfnCWS7s_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="find_in_set_15"></a>第一步：先使用find_in_set解决范围查找</h5> 
<blockquote> 
 <p>SELECT<br> a.id,<br> b.name<br> FROM<br> kg_rules a<br> LEFT JOIN kg_facts b ON FIND_IN_SET(b.id, a.reason)</p> 
</blockquote> 
<p>结果为：<br> <img src="https://images2.imgbox.com/75/7c/jMUhhytw_o.png" alt="在这里插入图片描述"><br> 这里会看到根据表kg_rules的reason，找到了三条记录。达到了我想要的结果，来分享记录一下Mysql这个方法吧。</p> 
<h6><a id="1find_in_set_27"></a>1.认识find_in_set（）函数</h6> 
<p><a href="https://www.mysqlzh.com/doc/116.html" rel="nofollow">Mysql官方文档手册</a>，如下图：</p> 
<p><img src="https://images2.imgbox.com/4a/81/w3j5zK2J_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="2find_in_set_32"></a>2.find_in_set（）基本操作</h6> 
<blockquote> 
 <p>select find_in_set (‘b’, ‘a,b,c,d,w’);<br> 结果为2，因为b字符串在strlist集合中，在第二个位置，起始数是从1开始的</p> 
</blockquote> 
<blockquote> 
 <p>select find_in_set(‘6’,‘1,2’);<br> 结果为0，因为第一个字符串6，并不在第二个参数中</p> 
</blockquote> 
<p><strong>对于上面写的sql语句，使用find_in_set（）进行数据查询的时候，一次可以返回多条记录的情况</strong></p> 
<p>上面的语句类似于in（）如下的操作：</p> 
<blockquote> 
 <p>select id,name from kg_facts where id in(1,2,3)</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/b7/95/xJsSZZaW_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="3find_in_setin_46"></a>3.find_in_set()与in()的应用场景区别</h6> 
<p>刚刚上面的情况也看到了</p> 
<blockquote> 
 <p>select * from kg_facts where find_in_set(id,‘1,2,3’)<br> 与<br> select * from kg_facts where id in(1,2,3)</p> 
</blockquote> 
<p>两个结果是一样的。不一样就在于一个有单引号，一个没有。这里也要针对你药检测的字段是数字类型还说字符串类型。</p> 
<p>对于find_in_set()而言，第二个参数无论是字符串还说数字，都必须用单引号括起来，并且列表中用逗号隔开，这个字符串列表是一个整体。</p> 
<p>对于in()而言，如果检测的字段是数字类型就不能用单引号，因为会出现偏差。<br> 例：</p> 
<blockquote> 
 <p>select * from kg_facts where id in(1,2,3) —正确的<br> select * from kg_facts where id in(‘1,2,3’) —错误的</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/f2/bf/8yMO5pTn_o.png" alt="在这里插入图片描述"><br> <strong>你看只有一个结果，这是因为Mysql会自动判断字符串的第一个是否匹配，但是后面的就被截掉了，不进行匹配！！</strong></p> 
<p>如果检测的是字符串，那么使用in()的时候，每个字符串都应该被单引号括起来</p> 
<blockquote> 
 <p>select * from per where paddr in(‘重庆’,‘北京’,‘上海’);<br> 比较<br> select * from per where find_in_set(paddr,‘重庆,北京,上海’);</p> 
</blockquote> 
<h6><a id="_70"></a>小结</h6> 
<p>查字段固定的内容时，比如： 字段名 in (‘篮球’,‘足球’,‘羽毛球’)，<br> 查是否有包含in中独立存在的信息时，用in<br> 查字段的内容是否包含其中一个指定的关键词内容时，用find_in_set</p> 
<blockquote> 
 <p>SELECT id,name,list from test1 WHERE list in(‘篮球’,‘足球’); #-- 返回list字段内容只是篮球 或 足球的数据<br> SELECT id,name,list from test1 WHERE find_in_set(‘篮球’,list); #-- 返回list字段内容中包含了篮球的数据</p> 
</blockquote> 
<h6><a id="4find_in_set_like_79"></a>4.find_in_set() 与like()的应用场景区别</h6> 
<p>在数据库查询的时候，需要得到某字段中包含某个值的记录，但是它并不是like能解决的，因为使用like可能会查到我们不想要的就，这个时候find_in_set函数就可以用了<br> 需求：查询用户拥有权限编号为2的</p> 
<blockquote> 
 <p>select * from users_test where limits like ‘%2%’;</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/ca/6d/YxTWZHYn_o.png" alt="在这里插入图片描述"><br> 结果看到了，并不是我们想要的，那么使用find_in_set函数来看看</p> 
<blockquote> 
 <p>select * from users_test where find_in_set(2,limits)</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/f5/bd/xflveWVG_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="_90"></a>小结</h6> 
<p>1.find_in_set（str, strlist）字符串函数是返回strlist中str所在的位置索引，strlist必须以英文逗号隔开<br> 2.like是广泛的模糊查询，字符串中没有分隔符<br> 3.find_in_set是精确匹配，查询结果比like查询更精确！</p> 
<h5><a id="_94"></a>第二步：多表关联</h5> 
<p>了解完find_in_set函数后，我们来直接多表查询，</p> 
<blockquote> 
 <p>SELECT<br> b.id,<br> a.id,<br> b.name,<br> c.name<br> FROM<br> kg_rules a<br> LEFT JOIN kg_facts b ON FIND_IN_SET(b.id, a.reason)<br> left join kg_facts c on a.result=c.id;</p> 
</blockquote> 
<p>因为用了find_in_set函数，所以有多条查询结果<br> <img src="https://images2.imgbox.com/20/76/s0bWNUEo_o.png" alt="在这里插入图片描述"></p> 
<p>看这个结果，也不是我想要，我想要同一个id,对应一条记录，并把多条记录放在一个字段展示</p> 
<h5><a id="group_concat___112"></a>第三步：group_concat()函数合并列 — 组内拼接函数</h5> 
<p>下面的操作就是常见的需求，右边显示一列组名，右边显示组名下所有的成员信息；这里也是可以使用的<br> ** group_concat 必须与group by函数一起使用**</p> 
<h6><a id="1group_concat_116"></a>1.group_concat的语法</h6> 
<blockquote> 
 <p>group_concat([distinct] 要连接的字段 [order by AEC/DESC 排序字段] [separator ‘分隔符’] )</p> 
</blockquote> 
<h6><a id="2_119"></a>2.使用例子</h6> 
<p><a href="http://php-note.com/article/793.html" rel="nofollow">多种使用的例子，不清楚可以查看</a></p> 
<p>那么最终的需求转化为sql为：</p> 
<blockquote> 
 <p>SELECT<br> a.id,<br> b.id as beifen,<br> GROUP_CONCAT(b.name),<br> c.name<br> FROM<br> kg_rules a<br> LEFT JOIN kg_facts b ON FIND_IN_SET(b.id, a.reason)<br> left join kg_facts c on a.result=c.id<br> GROUP BY a.id;</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/5c/21/6ZJv1PNo_o.png" alt="在这里插入图片描述"></p> 
<p>含义为：以表a（kg_rules ）的id为基准，将查询的多条记录，对表b（kg_facts）的name进行拼接，采用默认逗号的方式拼接，当然可以使用<strong>separator</strong> 来自定义拼接符号。</p> 
<p><strong>注意：</strong></p> 
<ul><li>1.int字段的拼接陷阱<br> 使用group_concat的时候，若是连接起来的字段如果是int型，一定要转为char再拼接。否则在你智行后返回的将不是一个逗号隔开的串，而是byte[] 
  <blockquote> 
   <p>select group_concat(id) from t_ip — 返回byte[]<br> select group_concat(Convert(id , char)) from t_dep ----返回逗号隔开的串</p> 
  </blockquote> </li><li>2.长度陷阱<br> 用了group_concat后，select里如果使用了limit是不起作用的<br> 用group_concat连接字段的时候是有长度限制的，不过可以设置</li></ul> 
<p><mark>使用group_concat_max_len系统变量，可以设置允许的最大程度，程序中语法如下，其中val是一个无符号的整数</mark></p> 
<blockquote> 
 <p>set [SESSION | GLOBAL] group_concat_max_len = val;</p> 
</blockquote> 
<p>默认是1024。</p> 
<h5><a id="_155"></a>写在最后</h5> 
<p>其实，我也是边百度边学习，发现百度是万能的，如果使用group_concat的时候，提示：</p> 
<blockquote> 
 <p>1055 - Expression #2 of SELECT list is not in GROUP BY clause and contains nonaggregated column ‘myself.b.id’ which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by</p> 
</blockquote> 
<p>这个是mysql配置问题，网上也有很多的解决办法</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3519dd7c7de748a93650830f7eb68fff/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java判断当前excel文档是否为空</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/97b673b976a8680cce7bfe02ae41e046/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">牛逼！Java 从入门到精通，超全汇总版</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>