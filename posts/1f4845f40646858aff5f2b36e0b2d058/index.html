<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>BGP——邻居关系（IBGP&#43;EBGP）的建立（讲解及配置命令) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="BGP——邻居关系（IBGP&#43;EBGP）的建立（讲解及配置命令)" />
<meta property="og:description" content="目录
一、BGP邻居分类：
二、BGP邻居的建立：
——（1）IBGP邻居关系建立—环回接口：
—注意点&#43;要求：
—配置命令：
——（2）EBGP邻居关系建立—直连接口 ：
—注意点&#43;要求：
—配置命令：
——（3）EBGP邻居关系建立—环回接口 ：
—注意点&#43;要求：
—配置命令：
——（4）实验注意：
三、TTL值对建立邻居关系的影响：
一、BGP邻居分类： IBGP（Internal BGP）：两台路由器位于同一AS时（AS编号相同），它们的邻居关系为IBGP 邻居关系EBGP（External BGP）：两台BGP路由器位于不同的AS时（AS编号不同），它们的邻居关系为EBGP邻居关系。 ——————————————————————————————————————————————————————————
二、BGP邻居的建立： ——（1）IBGP邻居关系建立—环回接口： —注意点&#43;要求： 通常建立IBGP邻居使用自己的环回接口建立，首先确保双方环回接口能PING通，可以用静态路由或者IGP（OSPF...）协议解决【BGP协议是基于TCP的，肯定要发起三次握手，底层无路由，那TCP三次握手就不可能建立（SYN数据包发不出去）】只要使用环回接口建立BGP邻居，必须在其中一端使用update-source命令（更新源接口）【我使用自身的哪一个环回接口和对方的哪个IP地址建立邻居，则update-source后面紧跟的是哪个原接口】建立邻居通过TCP协议发送BGP的open报文（相当于OSPF 中的hello），IBGP邻居的open报文TTL为255（EBGP邻居之间TTL=1）数据封装：二层帧头&#43;IP&#43;TCP&#43;BGP&#43;帧尾 —配置命令： int loopback 1 ip address 1.1.1.1 255.255.255.0 no shut exit r1(config)#router bgp 100 ——100为AS号 r1(config-router)#bgp router-id 1.1.1.1 r1(config-router)#neighbor 2.2.2.2 remote-as 100 //我和2.2.2.2建立邻居，2.2.2.2在AS100 r1(config-router)#neighbor 2.2.2.2 update-source loopback 1 //用自己的环回接口1和2.2.2.2建立邻居 r1(config-router)#exit r1#show ip bgp summary//查看BGP邻居关系： 注意：router-id可以由设备自动选举，也可以手工指定，最好手工指定，因为手工指定的更加稳定 —————————————————————————————————————————————————————————— ———（2）EBGP邻居关系建立—直连接口 ： —注意点&#43;要求： 在不同AS之间路由器之间建立BGP邻居为EGBP邻居,通常EBGP邻居使用自己的直连链路建立建立邻居通过TCP协议发送BGP的open报文，EGBP邻居的open报文TTL为1 —配置命令： r2(config)#router bgp 100 r2(config-router)#neighbor 23." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/1f4845f40646858aff5f2b36e0b2d058/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-10T17:19:32+08:00" />
<meta property="article:modified_time" content="2022-09-10T17:19:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">BGP——邻居关系（IBGP&#43;EBGP）的建立（讲解及配置命令)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80%E3%80%81BGP%E9%82%BB%E5%B1%85%E5%88%86%E7%B1%BB%EF%BC%9A-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81BGP%E9%82%BB%E5%B1%85%E5%88%86%E7%B1%BB%EF%BC%9A" rel="nofollow">一、BGP邻居分类：</a></p> 
<p id="%E4%BA%8C%E3%80%81BGP%E9%82%BB%E5%B1%85%E7%9A%84%E5%BB%BA%E7%AB%8B%EF%BC%9A-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81BGP%E9%82%BB%E5%B1%85%E7%9A%84%E5%BB%BA%E7%AB%8B%EF%BC%9A" rel="nofollow">二、BGP邻居的建立：</a></p> 
<p id="%E2%80%94%E2%80%94%EF%BC%881%EF%BC%89IBGP%E9%82%BB%E5%B1%85%E5%85%B3%E7%B3%BB%E5%BB%BA%E7%AB%8B%E2%80%94%E7%8E%AF%E5%9B%9E%E6%8E%A5%E5%8F%A3%EF%BC%9A-toc" style="margin-left:40px;"><a href="#%E2%80%94%E2%80%94%EF%BC%881%EF%BC%89IBGP%E9%82%BB%E5%B1%85%E5%85%B3%E7%B3%BB%E5%BB%BA%E7%AB%8B%E2%80%94%E7%8E%AF%E5%9B%9E%E6%8E%A5%E5%8F%A3%EF%BC%9A" rel="nofollow">——（1）IBGP邻居关系建立—环回接口：</a></p> 
<p id="%E2%80%94%EF%BC%881%EF%BC%89%E6%B3%A8%E6%84%8F%E7%82%B9%2B%E8%A6%81%E6%B1%82%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%E2%80%94%EF%BC%881%EF%BC%89%E6%B3%A8%E6%84%8F%E7%82%B9%2B%E8%A6%81%E6%B1%82%EF%BC%9A" rel="nofollow">—注意点+要求：</a></p> 
<p id="%E2%80%94%EF%BC%882%EF%BC%89%E9%85%8D%E7%BD%AE%E5%91%BD%E4%BB%A4%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%E2%80%94%EF%BC%882%EF%BC%89%E9%85%8D%E7%BD%AE%E5%91%BD%E4%BB%A4%EF%BC%9A" rel="nofollow">—配置命令：</a></p> 
<p id="%E2%80%94%E2%80%94%EF%BC%882%EF%BC%89EBGP%E9%82%BB%E5%B1%85%E5%85%B3%E7%B3%BB%E5%BB%BA%E7%AB%8B%E2%80%94%E7%9B%B4%E8%BF%9E%E6%8E%A5%E5%8F%A3%C2%A0%EF%BC%9A-toc" style="margin-left:40px;"><a href="#%E2%80%94%E2%80%94%EF%BC%882%EF%BC%89EBGP%E9%82%BB%E5%B1%85%E5%85%B3%E7%B3%BB%E5%BB%BA%E7%AB%8B%E2%80%94%E7%9B%B4%E8%BF%9E%E6%8E%A5%E5%8F%A3%C2%A0%EF%BC%9A" rel="nofollow">——（2）EBGP邻居关系建立—直连接口 ：</a></p> 
<p id="%E2%80%94%E6%B3%A8%E6%84%8F%E7%82%B9%2B%E8%A6%81%E6%B1%82%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%E2%80%94%E6%B3%A8%E6%84%8F%E7%82%B9%2B%E8%A6%81%E6%B1%82%EF%BC%9A" rel="nofollow">—注意点+要求：</a></p> 
<p id="%E2%80%94%E9%85%8D%E7%BD%AE%E5%91%BD%E4%BB%A4%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%E2%80%94%E9%85%8D%E7%BD%AE%E5%91%BD%E4%BB%A4%EF%BC%9A" rel="nofollow">—配置命令：</a></p> 
<p id="%E2%80%94%E2%80%94%EF%BC%883%EF%BC%89EBGP%E9%82%BB%E5%B1%85%E5%85%B3%E7%B3%BB%E5%BB%BA%E7%AB%8B%E2%80%94%E7%8E%AF%E5%9B%9E%E6%8E%A5%E5%8F%A3%C2%A0%EF%BC%9A-toc" style="margin-left:40px;"><a href="#%E2%80%94%E2%80%94%EF%BC%883%EF%BC%89EBGP%E9%82%BB%E5%B1%85%E5%85%B3%E7%B3%BB%E5%BB%BA%E7%AB%8B%E2%80%94%E7%8E%AF%E5%9B%9E%E6%8E%A5%E5%8F%A3%C2%A0%EF%BC%9A" rel="nofollow">——（3）EBGP邻居关系建立—环回接口 ：</a></p> 
<p id="%E2%80%94%E6%B3%A8%E6%84%8F%E7%82%B9%2B%E8%A6%81%E6%B1%82%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%E2%80%94%E6%B3%A8%E6%84%8F%E7%82%B9%2B%E8%A6%81%E6%B1%82%EF%BC%9A" rel="nofollow">—注意点+要求：</a></p> 
<p id="%C2%A0%E2%80%94%E9%85%8D%E7%BD%AE%E5%91%BD%E4%BB%A4%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%C2%A0%E2%80%94%E9%85%8D%E7%BD%AE%E5%91%BD%E4%BB%A4%EF%BC%9A" rel="nofollow"> —配置命令：</a></p> 
<p id="%E2%80%94%E2%80%94%EF%BC%884%EF%BC%89%E5%AE%9E%E9%AA%8C%E6%B3%A8%E6%84%8F%EF%BC%9A-toc" style="margin-left:40px;"><a href="#%E2%80%94%E2%80%94%EF%BC%884%EF%BC%89%E5%AE%9E%E9%AA%8C%E6%B3%A8%E6%84%8F%EF%BC%9A" rel="nofollow">——（4）实验注意：</a></p> 
<p id="%E4%B8%89%E3%80%81TTL%E5%80%BC%E5%AF%B9%E5%BB%BA%E7%AB%8B%E9%82%BB%E5%B1%85%E5%85%B3%E7%B3%BB%E7%9A%84%E5%BD%B1%E5%93%8D%EF%BC%9A-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81TTL%E5%80%BC%E5%AF%B9%E5%BB%BA%E7%AB%8B%E9%82%BB%E5%B1%85%E5%85%B3%E7%B3%BB%E7%9A%84%E5%BD%B1%E5%93%8D%EF%BC%9A" rel="nofollow">三、TTL值对建立邻居关系的影响：</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E4%B8%80%E3%80%81BGP%E9%82%BB%E5%B1%85%E5%88%86%E7%B1%BB%EF%BC%9A"><strong><span style="color:#0d0016;"><span style="background-color:#cbe0f1;">一、BGP邻居分类：</span></span></strong></h2> 
<ul><li>IBGP（Internal BGP）：两台路由器位于同一AS时（AS编号相同），它们的邻居关系为IBGP 邻居关系</li><li>EBGP（External BGP）：两台BGP路由器位于不同的AS时（AS编号不同），它们的邻居关系为EBGP邻居关系。</li></ul> 
<p><strong><span style="background-color:#a2e043;">——————————————————————————————————————————————————————————</span></strong></p> 
<h2 id="%E4%BA%8C%E3%80%81BGP%E9%82%BB%E5%B1%85%E7%9A%84%E5%BB%BA%E7%AB%8B%EF%BC%9A"><strong><span style="color:#0d0016;"><span style="background-color:#cbe0f1;">二、BGP邻居的建立：</span></span></strong></h2> 
<h3 id="%E2%80%94%E2%80%94%EF%BC%881%EF%BC%89IBGP%E9%82%BB%E5%B1%85%E5%85%B3%E7%B3%BB%E5%BB%BA%E7%AB%8B%E2%80%94%E7%8E%AF%E5%9B%9E%E6%8E%A5%E5%8F%A3%EF%BC%9A"><span style="color:#0d0016;"><span style="background-color:#eaf4fc;">——（1）IBGP邻居关系建立—环回接口：</span></span></h3> 
<h4 id="%E2%80%94%EF%BC%881%EF%BC%89%E6%B3%A8%E6%84%8F%E7%82%B9%2B%E8%A6%81%E6%B1%82%EF%BC%9A"><span style="color:#fe2c24;"><strong><span style="background-color:#e7fafa;">—注意点+要求：</span></strong></span></h4> 
<ul><li><span style="color:#0d0016;">通常建立IBGP邻居使用自己的环回接口建立，</span><span style="color:#fe2c24;">首先确保双方环回接口能PING通，可以用静态路由或者IGP（OSPF...）协议解决【BGP协议是基于TCP的，肯定要发起三次握手，底层无路由，那TCP三次握手就不可能建立（SYN数据包发不出去）】</span></li><li><span style="color:#0d0016;">只要使用环回接口建立BGP邻居，必须在其中一端使用</span><span style="color:#fe2c24;">update-source命令（更新源接口）</span><span style="color:#0d0016;">【我使用自身的哪一个环回接口和对方的哪个IP地址建立邻居，则update-source后面紧跟的是哪个原接口】</span></li><li><span style="color:#0d0016;">建立邻居通过TCP协议发送BGP的open报文（相当于OSPF 中的hello），</span><span style="color:#fe2c24;">IBGP邻居</span><span style="color:#0d0016;">的open报文</span><span style="color:#fe2c24;">TTL为255（EBGP邻居之间TTL=1）</span></li><li><span style="color:#0d0016;">数据封装：二层帧头+IP+TCP+BGP+帧尾</span></li></ul> 
<p style="text-align:center;"><img alt="" height="508" src="https://images2.imgbox.com/f9/4a/qCphJtkX_o.png" width="1200"></p> 
<h4><span style="background-color:#e7fafa;"> </span><span style="color:#fe2c24;"><strong><span style="background-color:#e7fafa;">—配置命令：</span></strong></span></h4> 
<pre><code>int loopback 1
 ip address 1.1.1.1 255.255.255.0
 no shut
exit

r1(config)#router bgp 100 ——100为AS号
r1(config-router)#bgp router-id 1.1.1.1
r1(config-router)#neighbor 2.2.2.2 remote-as 100  //我和2.2.2.2建立邻居，2.2.2.2在AS100
r1(config-router)#neighbor 2.2.2.2 update-source  loopback 1 //用自己的环回接口1和2.2.2.2建立邻居
r1(config-router)#exit
r1#show ip bgp summary//查看BGP邻居关系：</code></pre> 
<ul><li><span style="color:#fe2c24;"><strong>注意：router-id可以由设备自动选举，也可以手工指定，最好手工指定，因为手工指定的更加稳定</strong></span> <img alt="" src="https://images2.imgbox.com/bb/b3/5GWnSgkP_o.jpg"></li></ul> 
<p><strong><span style="color:#fe2c24;">—————————————————————————————————————————————————————————— </span></strong></p> 
<h3 id="%E2%80%94%E2%80%94%EF%BC%882%EF%BC%89EBGP%E9%82%BB%E5%B1%85%E5%85%B3%E7%B3%BB%E5%BB%BA%E7%AB%8B%E2%80%94%E7%9B%B4%E8%BF%9E%E6%8E%A5%E5%8F%A3%C2%A0%EF%BC%9A"><span style="color:#0d0016;"><span style="background-color:#eaf4fc;">———（2）EBGP邻居关系建立—直连接口 ：</span></span></h3> 
<h4 id="%E2%80%94%E6%B3%A8%E6%84%8F%E7%82%B9%2B%E8%A6%81%E6%B1%82%EF%BC%9A"><span style="color:#fe2c24;"><strong>—注意点+要求：</strong></span></h4> 
<ul><li>在不同AS之间路由器之间建立BGP邻居为EGBP邻居,通常EBGP邻居使用自己的<span style="color:#fe2c24;"><strong>直连链路</strong></span>建立</li><li>建立邻居通过TCP协议发送BGP的open报文，EGBP邻居的open报文<span style="color:#fe2c24;"><strong>TTL为1</strong></span></li></ul> 
<h4 id="%E2%80%94%E9%85%8D%E7%BD%AE%E5%91%BD%E4%BB%A4%EF%BC%9A"><span style="color:#fe2c24;"><strong>—配置命令：</strong></span></h4> 
<pre><code>r2(config)#router bgp 100
r2(config-router)#neighbor 23.1.1.3 remote-as 200
r2(config-router)#exit</code></pre> 
<p><span style="color:#fe2c24;"><strong> —————————————————————————————————————————————————————————</strong></span></p> 
<h3 id="%E2%80%94%E2%80%94%EF%BC%883%EF%BC%89EBGP%E9%82%BB%E5%B1%85%E5%85%B3%E7%B3%BB%E5%BB%BA%E7%AB%8B%E2%80%94%E7%8E%AF%E5%9B%9E%E6%8E%A5%E5%8F%A3%C2%A0%EF%BC%9A"><span style="color:#0d0016;">——（3）EBGP邻居关系建立—环回接口 ：</span></h3> 
<h4><span style="color:#fe2c24;"><strong>—注意点+要求：</strong></span></h4> 
<ul><li><span style="color:#1a439c;"><strong>修改TTL值</strong></span></li><li><span style="color:#1a439c;"><strong>两个EBGP邻居之间的环回接口底层路由必须可达，而且不能使静态默认（缺省）路由</strong></span></li></ul> 
<h4 id="%C2%A0%E2%80%94%E9%85%8D%E7%BD%AE%E5%91%BD%E4%BB%A4%EF%BC%9A"> <span style="color:#fe2c24;"><strong>—配置命令：</strong></span></h4> 
<pre><code>r6(config)#router bgp 200
r6(config-router)#neighbor 7.7.7.7 remote 300
r6(config-router)#neighbor 7.7.7.7 update-source loopback 1
r6(config-router)#neighbor 7.7.7.7 ebgp-multihop
r6(config-router)#exit</code></pre> 
<h3 id="%E2%80%94%E2%80%94%EF%BC%884%EF%BC%89%E5%AE%9E%E9%AA%8C%E6%B3%A8%E6%84%8F%EF%BC%9A"><strong><span style="background-color:#eaf4fc;">——（4）实验注意：</span></strong></h3> 
<ul><li><span style="color:#fe2c24;">两个或多个AS中 ，双方边界路由器不能建立OSPF邻居，OSPF为内部网关协议，然而BGP为边界网关协议，如果AS边界路由器建立邻居，相当于对方网络已经被我收购，成为我方网络一部分，如上图R3于R4之间</span><strong>。</strong></li></ul> 
<p><strong><span style="background-color:#a2e043;">———————————————————————————————————————————————————————————</span></strong></p> 
<h2 id="%E4%B8%89%E3%80%81TTL%E5%80%BC%E5%AF%B9%E5%BB%BA%E7%AB%8B%E9%82%BB%E5%B1%85%E5%85%B3%E7%B3%BB%E7%9A%84%E5%BD%B1%E5%93%8D%EF%BC%9A"><strong><span style="color:#0d0016;"><span style="background-color:#cbe0f1;">三、TTL值对建立邻居关系的影响：</span></span></strong></h2> 
<ul><li>TTL通常表示包在被丢弃前最多能经过的路由器个数。当记数到0时，路由器决定丢弃该包，并发送一个ICMP报文给最初的发送者。</li><li>TTL值240~255为UNIX/<a href="https://so.csdn.net/so/search?q=Linux&amp;spm=1001.2101.3001.7020" title="Linux">Linux</a>系统，TTL值100~130为windows系统。</li><li><span style="color:#fe2c24;">通过TTL值可以推算出数据包已经经过了多少个路由：源地点TTL值减去返回的TTL值</span>。</li></ul> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/b4/80/r4QQrCmf_o.jpg"></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2a73459a7a3e4f48bf9931a8a136e6d3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">torch.nn.Linear类（nn.Module）详解（包含内部逻辑）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/81006a2554abe4b16e3a98954ced4451/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MAC安装brew保姆级教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>