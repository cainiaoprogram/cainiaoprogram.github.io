<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>PPTPD centos7 install problem fix - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="PPTPD centos7 install problem fix" />
<meta property="og:description" content="按照网上的教程，在一台centos７上安装完ＰＰＴＰ　ＶＰＮ服务器之后，ＩＯＳ一直报错，连不上，查看ＶＡＲ　ＬＯＧ　ＭＥＳＳＡＧＥＳ发现报如下错误： Aug 4 16:05:04 oltsvr pptpd[15707]: CTRL: Client 112.17.247.42 control connection started Aug 4 16:05:04 oltsvr pptpd[15707]: CTRL: Starting call (launching pppd, opening GRE) Aug 4 16:05:05 oltsvr kernel: conntrack: generic helper won’t handle protocol 47. Please consider loading the specific helper module. Aug 4 16:05:05 oltsvr pppd[15708]: /usr/lib/pptpd/pptpd-logwtmp.so: wrong ELF class: ELFCLASS32 Aug 4 16:05:05 oltsvr pppd[15708]: Couldn’t load plugin /usr/lib/pptpd/pptpd-logwtmp.so Aug 4 16:05:05 oltsvr pptpd[15707]: GRE: read(fd=6,buffer=8059680,len=8196) from PTY failed: status = -1 error = Input/output error, usually caused by unexpected termination of pppd, check option syntax and pppd logs Aug 4 16:05:05 oltsvr pptpd[15707]: CTRL: PTY read or GRE write failed (pty,gre)=(6,7) Aug 4 16:05:05 oltsvr pptpd[15707]: CTRL: Client 112." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/252c196151c8ee852ea02c1ceb89a951/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-08-05T10:15:23+08:00" />
<meta property="article:modified_time" content="2016-08-05T10:15:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">PPTPD centos7 install problem fix</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>按照网上的教程，在一台centos７上安装完ＰＰＴＰ　ＶＰＮ服务器之后，ＩＯＳ一直报错，连不上，查看ＶＡＲ　ＬＯＧ　ＭＥＳＳＡＧＥＳ发现报如下错误： <br> Aug 4 16:05:04 oltsvr pptpd[15707]: CTRL: Client 112.17.247.42 control connection started <br> Aug 4 16:05:04 oltsvr pptpd[15707]: CTRL: Starting call (launching pppd, opening GRE) <br> Aug 4 16:05:05 oltsvr kernel: conntrack: generic helper won’t handle protocol 47. Please consider loading the specific helper module. <br> Aug 4 16:05:05 oltsvr pppd[15708]: /usr/lib/pptpd/pptpd-logwtmp.so: wrong ELF class: ELFCLASS32 <br> Aug 4 16:05:05 oltsvr pppd[15708]: Couldn’t load plugin /usr/lib/pptpd/pptpd-logwtmp.so <br> Aug 4 16:05:05 oltsvr pptpd[15707]: GRE: read(fd=6,buffer=8059680,len=8196) from PTY failed: status = -1 error = Input/output error, usually caused by unexpected termination of pppd, check option syntax and pppd logs <br> Aug 4 16:05:05 oltsvr pptpd[15707]: CTRL: PTY read or GRE write failed (pty,gre)=(6,7) <br> Aug 4 16:05:05 oltsvr pptpd[15707]: CTRL: Client 112.17.247.42 control connection finished</p> 
<p>后来，修改了/etc/pptpd.conf <br> 将logwtmp这一行去掉就ＯＫ了。</p> 
<p>成功的日志如下：</p> 
<p>Aug 5 10:05:44 oltsvr pptpd[42095]: CTRL: Client 112.17.247.42 control connection started <br> Aug 5 10:05:44 oltsvr pptpd[42095]: CTRL: Starting call (launching pppd, opening GRE) <br> Aug 5 10:05:44 oltsvr kernel: PPP generic driver version 2.4.2 <br> Aug 5 10:05:44 oltsvr pppd[42096]: pppd 2.4.5 started by root, uid 0 <br> Aug 5 10:05:44 oltsvr pppd[42096]: Using interface ppp0 <br> Aug 5 10:05:44 oltsvr pppd[42096]: Connect: ppp0 &lt;–&gt; /dev/pts/4 <br> Aug 5 10:05:44 oltsvr NetworkManager[1274]: (ppp0): new Generic device (carrier: UNKNOWN, driver: ‘unknown’, ifindex: 8)</p> 
<p>Aug 5 10:05:47 oltsvr kernel: PPP MPPE Compression module registered <br> Aug 5 10:05:47 oltsvr pppd[42096]: MPPE 128-bit stateless compression enabled <br> Aug 5 10:05:47 oltsvr pppd[42096]: Cannot determine ethernet address for proxy ARP <br> Aug 5 10:05:47 oltsvr pppd[42096]: local IP address 10.12.2.100 <br> Aug 5 10:05:47 oltsvr pppd[42096]: remote IP address 10.12.2.101 <br> Aug 5 10:05:47 oltsvr NetworkManager[1274]: keyfile: add connection in-memory (5fa4eb7b-1f2f-4ea4-9374-024a1561e71f,”ppp0”) <br> Aug 5 10:05:47 oltsvr NetworkManager[1274]: (ppp0): device state change: unmanaged -&gt; unavailable (reason ‘connection-assumed’) [10 20 41] <br> Aug 5 10:05:47 oltsvr NetworkManager[1274]: (ppp0): device state change: unavailable -&gt; disconnected (reason ‘connection-assumed’) [20 30 41] <br> Aug 5 10:05:47 oltsvr NetworkManager[1274]: (ppp0): Activation: starting connection ‘ppp0’ (5fa4eb7b-1f2f-4ea4-9374-024a1561e71f) <br> Aug 5 10:05:47 oltsvr NetworkManager[1274]: (ppp0): device state change: disconnected -&gt; prepare (reason ‘none’) [30 40 0] <br> Aug 5 10:05:47 oltsvr NetworkManager[1274]: (ppp0): device state change: prepare -&gt; config (reason ‘none’) [40 50 0] <br> Aug 5 10:05:47 oltsvr NetworkManager[1274]: (ppp0): device state change: config -&gt; ip-config (reason ‘none’) [50 70 0] <br> Aug 5 10:05:47 oltsvr NetworkManager[1274]: (ppp0): device state change: ip-config -&gt; ip-check (reason ‘none’) [70 80 0] <br> Aug 5 10:05:47 oltsvr NetworkManager[1274]: (ppp0): device state change: ip-check -&gt; secondaries (reason ‘none’) [80 90 0] <br> Aug 5 10:05:47 oltsvr NetworkManager[1274]: (ppp0): device state change: secondaries -&gt; activated (reason ‘none’) [90 100 0] <br> Aug 5 10:05:47 oltsvr NetworkManager[1274]: (ppp0): Activation: successful, device activated. <br> Aug 5 10:05:47 oltsvr dbus-daemon: dbus[1199]: [system] Activating via systemd: service name=’org.freedesktop.nm_dispatcher’ unit=’dbus-org.freedesktop.nm-dispatcher.service’ <br> Aug 5 10:05:47 oltsvr dbus[1199]: [system] Activating via systemd: service name=’org.freedesktop.nm_dispatcher’ unit=’dbus-org.freedesktop.nm-dispatcher.service’</p> 
<p>Aug 5 10:05:47 oltsvr systemd: Starting Network Manager Script Dispatcher Service… <br> Aug 5 10:05:47 oltsvr dbus[1199]: [system] Successfully activated service ‘org.freedesktop.nm_dispatcher’ <br> Aug 5 10:05:47 oltsvr systemd: Started Network Manager Script Dispatcher Service. <br> Aug 5 10:05:47 oltsvr dbus-daemon: dbus[1199]: [system] Successfully activated service ‘org.freedesktop.nm_dispatcher’ <br> Aug 5 10:05:47 oltsvr nm-dispatcher: Dispatching action ‘up’ for ppp0 <br> Aug 5 10:05:47 oltsvr systemd: Unit iscsi.service cannot be reloaded because it is inactive. <br> Aug 5 10:05:47 oltsvr systemd: Stopping Sendmail Mail Transport Client… <br> Aug 5 10:05:47 oltsvr systemd: Stopping Sendmail Mail Transport Agent… <br> Aug 5 10:05:47 oltsvr systemd: Starting Sendmail Mail Transport Agent…</p> 
<p>这里总结一下几点： <br> １、内核不需要重新编译，日志中报告的连接跟踪　ＧＲＥ问题可以忽略，只有做ＰＰＴＰＤ　ＡＬＧ时才需要重编译内核。 <br> ２、ＰＰＴＰＤ的启动通过ＳＹＳＴＥＭＣＴＬ　ＲＥＳＴＡＲＴ　ＰＰＴＰＤ.ＳＥＲＶＩＣＥ重启或停止。 <br> 3、通过ＦＩＲＥＷＡＬＬ－ＣＭＤ来设置防火墙，注意ＲＥＬＯＡＤ。</p> 
<pre class="prettyprint"><code class=" hljs lasso">firewall<span class="hljs-attribute">-cmd</span> <span class="hljs-subst">--</span>permanent <span class="hljs-subst">--</span>direct <span class="hljs-subst">--</span>add<span class="hljs-attribute">-rule</span> ipv4 filter INPUT <span class="hljs-number">0</span> <span class="hljs-attribute">-i</span> eth0 <span class="hljs-attribute">-p</span> tcp <span class="hljs-subst">--</span>dport <span class="hljs-number">1723</span> <span class="hljs-attribute">-j</span> ACCEPT
firewall<span class="hljs-attribute">-cmd</span> <span class="hljs-subst">--</span>permanent <span class="hljs-subst">--</span>direct <span class="hljs-subst">--</span>add<span class="hljs-attribute">-rule</span> ipv4 filter INPUT <span class="hljs-number">0</span> <span class="hljs-attribute">-p</span> gre <span class="hljs-attribute">-j</span> ACCEPT
firewall<span class="hljs-attribute">-cmd</span> <span class="hljs-subst">--</span>permanent <span class="hljs-subst">--</span>direct <span class="hljs-subst">--</span>add<span class="hljs-attribute">-rule</span> ipv4 filter POSTROUTING <span class="hljs-number">0</span> <span class="hljs-attribute">-t</span> nat <span class="hljs-attribute">-o</span> enp7s0f2 <span class="hljs-attribute">-j</span> MASQUERADE  
firewall<span class="hljs-attribute">-cmd</span> <span class="hljs-subst">--</span>permanent <span class="hljs-subst">--</span>direct <span class="hljs-subst">--</span>add<span class="hljs-attribute">-rule</span> ipv4 filter FORWARD <span class="hljs-number">0</span> <span class="hljs-attribute">-i</span> ppp<span class="hljs-subst">+</span> <span class="hljs-attribute">-o</span> eth0 <span class="hljs-attribute">-j</span> ACCEPT  
firewall<span class="hljs-attribute">-cmd</span> <span class="hljs-subst">--</span>permanent <span class="hljs-subst">--</span>direct <span class="hljs-subst">--</span>add<span class="hljs-attribute">-rule</span> ipv4 filter FORWARD <span class="hljs-number">0</span> <span class="hljs-attribute">-i</span> enp7s0f2 <span class="hljs-attribute">-o</span> ppp<span class="hljs-subst">+</span> <span class="hljs-attribute">-j</span> ACCEPT

</code></pre> 
<p>FAQ: <br> １、IOS拔号时提示通信中断 <br> 因为logwtmp与ＰＰＰ冲突，去掉</p> 
<p>２、能拔号成功，但路由不通，只能到达ＰＰＴＰＤ这台ＣＥＮＴＯＳ服务器，其他地方都到达不了 <br> ＴＣＰＤＵＭＰ　－Ｉ　ＰＰＰ０捕包看，第一个ＳＹＮ连接就被回复ＩＣＭＰ不可达。 <br> 原因是防火墙拦住了，-o eth0配错，应该是我的enp7s0f1接口名： <br> firewall-cmd –permanent –direct –add-rule ipv4 filter FORWARD 0 -i ppp+ -o enp7s0f1 -j ACCEPT </p> 
<p>3、能到达内网，但ＩＮＴＥＲＮＥＴ网又不通。 <br> 还是防火墙拦了，再加一个出接口许可规则。只要从外网接口ＥＮＰ７Ｓ０Ｆ２出去的就允许。 <br> firewall-cmd –permanent –direct –add-rule ipv4 filter FORWARD 0 -i ppp+ -o enp7s0f2 -j ACCEPT </p> 
<p>备注： <br> 我的路由表：</p> 
<pre class="prettyprint"><code class=" hljs d">[root<span class="hljs-keyword">@oltsvr</span> ~]#  ip r
<span class="hljs-keyword">default</span> via <span class="hljs-number">218.75</span>.33.25 dev enp7s0f2 
<span class="hljs-number">10.7</span>.0.0/<span class="hljs-number">16</span> via <span class="hljs-number">10.7</span>.100.1 dev enp7s0f1 
<span class="hljs-number">10.7</span>.100.0/<span class="hljs-number">24</span> dev enp7s0f1  proto kernel  <span class="hljs-keyword">scope</span> link  src <span class="hljs-number">10.7</span>.100.234  metric <span class="hljs-number">100</span> 
<span class="hljs-number">10.11</span>.0.0/<span class="hljs-number">16</span> via <span class="hljs-number">10.7</span>.100.1 dev enp7s0f1 
<span class="hljs-number">10.12</span>.0.0/<span class="hljs-number">16</span> via <span class="hljs-number">10.7</span>.100.1 dev enp7s0f1 
<span class="hljs-number">10.13</span>.0.0/<span class="hljs-number">16</span> via <span class="hljs-number">10.7</span>.100.1 dev enp7s0f1 
<span class="hljs-number">10.14</span>.0.0/<span class="hljs-number">16</span> via <span class="hljs-number">10.7</span>.100.1 dev enp7s0f1 
<span class="hljs-number">192.168</span>.100.1 dev ppp0  proto kernel  <span class="hljs-keyword">scope</span> link  src <span class="hljs-number">192.168</span>.10.1 
<span class="hljs-number">192.168</span>.122.0/<span class="hljs-number">24</span> dev virbr0  proto kernel  <span class="hljs-keyword">scope</span> link  src <span class="hljs-number">192.168</span>.122.1 
<span class="hljs-number">218.75</span>.33.24/<span class="hljs-number">29</span> dev enp7s0f2  proto kernel  <span class="hljs-keyword">scope</span> link  src <span class="hljs-number">218.75</span>.33.29 </code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/275a3f7627e26d7f834fa2ae31cd14ae/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ftp  ssh  http  telnet  https服务及端口</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e248a8310e50fe8ecbe3df39e84757cd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">EasyUI ComboGrid（数据表格下拉框）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>