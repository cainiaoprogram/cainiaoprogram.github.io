<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Ajax基础（应用场景｜jquery实现Ajax｜注意事项｜Ajax发送json数据｜Ajax携带文件数据） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Ajax基础（应用场景｜jquery实现Ajax｜注意事项｜Ajax发送json数据｜Ajax携带文件数据）" />
<meta property="og:description" content="文章目录 一、Ajax简介二、基于jquery实现Ajax三、使用Ajax注意的问题1.Ajax不要与form表单同时提交2.后端响应格式问题3、使用了Ajax作为请求后的注意事项 四、前后端数据传输的编码格式(content-Type)1.urlencoded2.formdata3.application/json 五、Ajax携带文件数据六、Ajax发送json格式数据 一、Ajax简介 AJAX（Asynchronous Javascript And XML）翻译成中文就是“异步Javascript和XML”。即使用Javascript语言与服务器进行异步交互也是用XML进行数据传输（当然，传输的数据不只是XML，目前更多的使用Json数据）。
（XML应用于Web开发的许多方面，常用于简化数据的存储和共享）
AJAX不是什么新的编程语言，而是一种使用现有标准的新方法 AJAX最大的优点就是不需要重新加载整个页面的情况下，可以与服务器交换数据并更新网页内容 （简单来说就是，在网页前端刚输入完数据，后端其实已经验证完数据了，不需要等点击提交了） AJAX不需要任何浏览器插件，但需要用户运行Javascript在浏览器上执行 1.AJAX使用Javascript技术向服务器发公司异步请求 2.AJAX请求无需刷新整个页面 3.因为服务器响应内容不再是整个页面，而是页面中的部分内容，所以AjAX性能高。 同步交互：客户端发出一个请求后，需要等待服务器响应结束后，才能发出第二个请求。
异步交互：客户端发出一个请求后，无需等待服务器响应结束，就可以发出第二个请求。
AJAX除了异步的特点外，还有一个就是：浏览器页面局部刷新；(这一特点给用户的感受是在不知不觉中完成请求和响应过程的)
常见的使用场景
注册用户时，会根据用户输入的命令关键字，自动提示改关键字是否通过检验
很多网站注册的时候都会使用到AJAX技术，当文本框发生了输入变化时，使用AJAX技术向服务器发送一个请求，然后服务器会把查询到的结果响应到的结果响应给浏览器，期间浏览器是不用刷新的，最后把后端返回的结果展示出来。
整个过程中页面没有刷新，只是刷新了页面中的局部位置当请求发出后，浏览器还可以进行其他操作，无需等待服务器的响应 二、基于jquery实现Ajax 目前Ajax一般不会使用原生Javascript来编写，因为需要考虑不同浏览器的兼容性。我们这里通过jquery来实现，更简单、不需要考虑不同浏览器引发的兼容问题。
过程：我们通过在前端向一个URL发送Ajax请求，来让后端处理这个请求后返回数据给Ajax接收。
这里用一个案例来代入：
通过Ajax，实现前端输入两个数字，服务器做加法，返回到前端页面
先在Django配置路由
from django.conf.urls import url from django.contrib import admin from app import views urlpatterns = [ url(r&#39;^admin/&#39;, admin.site.urls), url(r&#39;^index/&#39;, views.index), url(r&#39;^sum/&#39;, views.sums), # ajax会向这个路由提交请求，执行sums视图函数 ] 注意：一定要在settings.py配置文件里面注释中间件的一行内容
这行代码的作用后续在讲解，目前先注释掉，不然请求会提交不成功！
views.py处理请求
from django.shortcuts import render,HttpResponse def index(request): # 返回一个index页面 return render(request,&#39;index.html&#39;) def sums(request): # 处理ajax请求 num1 = int(request." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/4bb796577aea6ec4d265515361c23e9b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-21T18:53:53+08:00" />
<meta property="article:modified_time" content="2023-11-21T18:53:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Ajax基础（应用场景｜jquery实现Ajax｜注意事项｜Ajax发送json数据｜Ajax携带文件数据）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#Ajax_2" rel="nofollow">一、Ajax简介</a></li><li><a href="#jqueryAjax_33" rel="nofollow">二、基于jquery实现Ajax</a></li><li><a href="#Ajax_125" rel="nofollow">三、使用Ajax注意的问题</a></li><li><ul><li><a href="#1Ajaxform_126" rel="nofollow">1.Ajax不要与form表单同时提交</a></li><li><a href="#2_138" rel="nofollow">2.后端响应格式问题</a></li><li><a href="#3Ajax_208" rel="nofollow">3、使用了Ajax作为请求后的注意事项</a></li></ul> 
  </li><li><a href="#contentType_230" rel="nofollow">四、前后端数据传输的编码格式(content-Type)</a></li><li><ul><li><a href="#1urlencoded_243" rel="nofollow">1.urlencoded</a></li><li><a href="#2formdata_250" rel="nofollow">2.formdata</a></li><li><a href="#3applicationjson_255" rel="nofollow">3.application/json</a></li></ul> 
  </li><li><a href="#Ajax_298" rel="nofollow">五、Ajax携带文件数据</a></li><li><a href="#Ajaxjson_417" rel="nofollow">六、Ajax发送json格式数据</a></li></ul> 
</div> 
<p></p> 
<h2><a id="Ajax_2"></a>一、Ajax简介</h2> 
<blockquote> 
 <p>AJAX<code>（Asynchronous Javascript And XML）</code>翻译成中文就是<code>“异步Javascript和XML”</code>。即使用Javascript语言与服务器进行异步交互也是用XML进行数据传输（当然，传输的数据不只是XML，目前更多的使用Json数据）。<br> （XML应用于Web开发的许多方面，常用于简化数据的存储和共享）</p> 
</blockquote> 
<pre><code class="prism language-python">	AJAX不是什么新的编程语言，而是一种使用现有标准的新方法
	AJAX最大的优点就是不需要重新加载整个页面的情况下，可以与服务器交换数据并更新网页内容
	（简单来说就是，在网页前端刚输入完数据，后端其实已经验证完数据了，不需要等点击提交了）
	AJAX不需要任何浏览器插件，但需要用户运行Javascript在浏览器上执行

	<span class="token number">1</span><span class="token punctuation">.</span>AJAX使用Javascript技术向服务器发公司异步请求
	<span class="token number">2</span><span class="token punctuation">.</span>AJAX请求无需刷新整个页面
	<span class="token number">3.</span>因为服务器响应内容不再是整个页面，而是页面中的部分内容，所以AjAX性能高。
</code></pre> 
<p>同步交互：客户端发出一个请求后，需要等待服务器响应结束后，才能发出第二个请求。<br> 异步交互：客户端发出一个请求后，无需等待服务器响应结束，就可以发出第二个请求。</p> 
<blockquote> 
 <p><code>AJAX除了异步的特点外，还有一个就是：浏览器页面局部刷新；(这一特点给用户的感受是在不知不觉中完成请求和响应过程的)</code></p> 
</blockquote> 
<hr> 
<p><strong>常见的使用场景</strong><br> <img src="https://images2.imgbox.com/8b/eb/1G11XFbN_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>注册用户时，会根据用户输入的命令关键字，自动提示改关键字是否通过检验</p> 
</blockquote> 
<blockquote> 
 <p>很多网站注册的时候都会使用到AJAX技术，当文本框发生了输入变化时，使用AJAX技术向服务器发送一个请求，然后服务器会把查询到的结果响应到的结果响应给浏览器，期间浏览器是不用刷新的，最后把后端返回的结果展示出来。</p> 
 <ul><li>整个过程中页面没有刷新，只是刷新了页面中的局部位置</li><li>当请求发出后，浏览器还可以进行其他操作，无需等待服务器的响应</li></ul> 
</blockquote> 
<hr> 
<h2><a id="jqueryAjax_33"></a>二、基于jquery实现Ajax</h2> 
<blockquote> 
 <p>目前Ajax一般不会使用原生Javascript来编写，因为需要考虑不同浏览器的兼容性。我们这里通过jquery来实现，更简单、不需要考虑不同浏览器引发的兼容问题。</p> 
</blockquote> 
<p><strong>过程：我们通过在前端向一个URL发送Ajax请求，来让后端处理这个请求后返回数据给Ajax接收。</strong></p> 
<p>这里用一个案例来代入：<br> <strong>通过Ajax，实现前端输入两个数字，服务器做加法，返回到前端页面</strong></p> 
<p><code>先在Django配置路由</code></p> 
<pre><code class="prism language-python">	<span class="token keyword">from</span> django<span class="token punctuation">.</span>conf<span class="token punctuation">.</span>urls <span class="token keyword">import</span> url
	<span class="token keyword">from</span> django<span class="token punctuation">.</span>contrib <span class="token keyword">import</span> admin
	<span class="token keyword">from</span> app <span class="token keyword">import</span> views
	
	urlpatterns <span class="token operator">=</span> <span class="token punctuation">[</span>
	    url<span class="token punctuation">(</span><span class="token string">r'^admin/'</span><span class="token punctuation">,</span> admin<span class="token punctuation">.</span>site<span class="token punctuation">.</span>urls<span class="token punctuation">)</span><span class="token punctuation">,</span>
	    url<span class="token punctuation">(</span><span class="token string">r'^index/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span>
	    url<span class="token punctuation">(</span><span class="token string">r'^sum/'</span><span class="token punctuation">,</span> views<span class="token punctuation">.</span>sums<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># ajax会向这个路由提交请求，执行sums视图函数</span>
	<span class="token punctuation">]</span>
</code></pre> 
<p><code>注意：一定要在settings.py配置文件里面注释中间件的一行内容</code><br> <img src="https://images2.imgbox.com/37/ed/B90R3p1B_o.png" alt="在这里插入图片描述"><br> 这行代码的作用后续在讲解，目前先注释掉，不然请求会提交不成功！</p> 
<hr> 
<p><code>views.py处理请求</code></p> 
<pre><code class="prism language-python">	<span class="token keyword">from</span> django<span class="token punctuation">.</span>shortcuts <span class="token keyword">import</span> render<span class="token punctuation">,</span>HttpResponse
	
	<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 返回一个index页面</span>
    	<span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>

	<span class="token keyword">def</span> <span class="token function">sums</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 处理ajax请求</span>
	    num1 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'num1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	    num2 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'num2'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	    <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>num1<span class="token operator">+</span>num2<span class="token punctuation">)</span>  <span class="token comment"># 返回计算后的值</span>
</code></pre> 
<p><code>index.html文件，定义Ajax与后端进行交互</code></p> 
<pre><code class="prism language-python"><span class="token operator">&lt;</span>!DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">"en"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Title<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>link href<span class="token operator">=</span><span class="token string">"https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css"</span> rel<span class="token operator">=</span><span class="token string">"stylesheet"</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>style<span class="token operator">&gt;</span>
        <span class="token operator">*</span><span class="token punctuation">{<!-- --></span>
            margin<span class="token operator">-</span>top<span class="token punctuation">:</span>20px<span class="token punctuation">;</span>
            margin<span class="token operator">-</span>left<span class="token punctuation">:</span>20px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>style<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"text"</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">"num1"</span> placeholder<span class="token operator">=</span><span class="token string">"数字1"</span><span class="token operator">&gt;</span><span class="token operator">+</span>
<span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"text"</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">"num2"</span> placeholder<span class="token operator">=</span><span class="token string">"数字2"</span><span class="token operator">&gt;=</span>
<span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"text"</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">"num3"</span> placeholder<span class="token operator">=</span><span class="token string">"总和"</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>button <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>计算<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>


<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    $<span class="token punctuation">(</span><span class="token string">'#btn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>function <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>  <span class="token operator">//</span> 当按钮被点击时触发一个匿名函数
        var num1 <span class="token operator">=</span> $<span class="token punctuation">(</span><span class="token string">'#num1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>val<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token operator">//</span> 点击按钮后获取<span class="token builtin">id</span>属性值为num1的值
        var num2 <span class="token operator">=</span> $<span class="token punctuation">(</span><span class="token string">'#num2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>val<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token operator">//</span> 点击按钮后获取<span class="token builtin">id</span>属性值为num2的值
        $<span class="token punctuation">.</span>ajax<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>  <span class="token operator">//</span> 定义ajax发送请求
            url<span class="token punctuation">:</span><span class="token string">'/sum/'</span><span class="token punctuation">,</span>  <span class="token operator">//</span> 请求发送的地址  有三种填写方式，与form标签的action一致
            method<span class="token punctuation">:</span><span class="token string">'post'</span><span class="token punctuation">,</span>  <span class="token operator">//</span> 请求发送的方式
            data<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'num1'</span><span class="token punctuation">:</span>num1<span class="token punctuation">,</span><span class="token string">'num2'</span><span class="token punctuation">:</span>num2<span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token operator">//</span> 请求携带的数据
            success<span class="token punctuation">:</span>function<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>  <span class="token operator">//</span> 异步等待，当后端响应成功会回调执行匿名函数，并将数据传递给data参数
                $<span class="token punctuation">(</span><span class="token string">'#num3'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>val<span class="token punctuation">(</span>data<span class="token punctuation">)</span>  <span class="token operator">//</span> 将数据设置给<span class="token builtin">id</span>属性值为num3的文本框
            <span class="token punctuation">}</span><span class="token operator">//</span> 使用ajax交互，那么后端返回的数据会被data接收，不在直接影响整个浏览器页面

        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> 
<blockquote> 
 <p>我们已经编写好了一个简单的小案例，通过Ajax向后端发送请求，后端处理完数据响应给Ajax，再将得到的数据在页面使用以此来达到局部更新页面效果。而form表单要达到这一效果需要全局更新数据，使用重定向来实现。</p> 
</blockquote> 
<p>得到的结果：<br> <img src="https://images2.imgbox.com/cd/cc/SFrPCr7l_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h2><a id="Ajax_125"></a>三、使用Ajax注意的问题</h2> 
<h3><a id="1Ajaxform_126"></a>1.Ajax不要与form表单同时提交</h3> 
<ul><li>如果在form表单中，写了button按钮或者input是submit类型的话，点击会触发form表单的提交。</li><li>如果点击按钮既触发Ajax又触发了form表单的提交，那么就会发送两个请求，导致页面数据可能错乱或者不显示问题。</li><li>要是无可避免同时使用Ajax提交form表单下的表单控件时，form表单内的input按钮请使用button类型，这样该按钮绑定了Ajax请求的话，就只会提交Ajax请求，而不是form</li></ul> 
<pre><code class="prism language-python">	<span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span>这种类型的按钮，无法触发form表单的提交<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"button"</span> value<span class="token operator">=</span><span class="token string">"提交"</span><span class="token operator">&gt;</span>
	
	<span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span>如果该button在form内，则会触发form表单的提交<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>button<span class="token operator">&gt;</span>提交<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="2_138"></a>2.后端响应格式问题</h3> 
<ul><li>后端如果是通过非JsonResponse返回值的话，响应格式为<code>text/html</code>，前端得到数据后需要手动转换成对象的形式。</li></ul> 
<pre><code class="prism language-python">    <span class="token keyword">if</span> request<span class="token punctuation">.</span>is_ajax<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">import</span> json
        d <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'jack'</span><span class="token punctuation">,</span><span class="token string">'age'</span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">}</span>
        d_json <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>d<span class="token punctuation">,</span>ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> HttpResponse<span class="token punctuation">(</span>d_json<span class="token punctuation">)</span>
</code></pre> 
<p>就算我们在后端已经将字典转换成了Json格式，但是通过<code>HttpResponse</code>返回以后，还是变成了一堆字符串到前端，并且响应格式为：<code>text/html</code>。</p> 
<pre><code class="prism language-python"><span class="token operator">&lt;</span>button <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>点击发送Ajax请求<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
   $<span class="token punctuation">(</span><span class="token string">'#btn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>function<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
       $<span class="token punctuation">.</span>ajax<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
           url<span class="token punctuation">:</span><span class="token string">'/home/'</span><span class="token punctuation">,</span>
           method<span class="token punctuation">:</span><span class="token string">'post'</span><span class="token punctuation">,</span>
           data<span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'tom'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
           success<span class="token punctuation">:</span>function <span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
               console<span class="token punctuation">.</span>log<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
               console<span class="token punctuation">.</span>log<span class="token punctuation">(</span>data<span class="token punctuation">.</span>name<span class="token punctuation">)</span>  <span class="token operator">//</span> 如果返回的是Json的话这样是可以打印出来的
           <span class="token punctuation">}</span>
       <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> 
<p>查看后端响应的数据格式:</p> 
<p><img src="https://images2.imgbox.com/a8/27/QhrQOIOG_o.png" alt="在这里插入图片描述"><br> 控制台结果：<br> <img src="https://images2.imgbox.com/99/12/ln0mHARz_o.png" alt="在这里插入图片描述"><br> 需要在前端手动将数据转换成JSON格式，那么下次就会先将数据转换成JSON，然后再打印了</p> 
<pre><code class="prism language-python">	success<span class="token punctuation">:</span>function <span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		data <span class="token operator">=</span> JSON<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
		console<span class="token punctuation">.</span>log<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
		console<span class="token punctuation">.</span>log<span class="token punctuation">(</span>data<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
</code></pre> 
<ul><li>如果我们是通过JsonResponse返回的话，那么响应状态码就会是<code>application/json</code>，并且在Ajax内接收到的也会是一个JSON格式的数据</li></ul> 
<pre><code class="prism language-python">	<span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> JsonResponse
	<span class="token keyword">def</span> <span class="token function">home</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
	    <span class="token keyword">if</span> request<span class="token punctuation">.</span>is_ajax<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	        <span class="token keyword">import</span> json
	        d <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'jack'</span><span class="token punctuation">,</span><span class="token string">'age'</span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">}</span>
	        <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span>d<span class="token punctuation">)</span>
	    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'home.html'</span><span class="token punctuation">)</span>
</code></pre> 
<p>Ajax内接收到以后不需要手动转换成JSON格式</p> 
<pre><code class="prism language-python">	success<span class="token punctuation">:</span>function <span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	    console<span class="token punctuation">.</span>log<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
	    console<span class="token punctuation">.</span>log<span class="token punctuation">(</span>data<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
   <span class="token punctuation">}</span>
</code></pre> 
<p>查看响应头编码格式<br> <img src="https://images2.imgbox.com/23/1b/kDxhZ5oF_o.png" alt="在这里插入图片描述"><br> 控制台打印效果：<br> <img src="https://images2.imgbox.com/77/50/tf0KQISd_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>总结：</p> 
 <ol><li>后端如果使用retrun JsonResponse(d)，前端不能反序列化，直接当成对象使用</li><li>后端使用return HttpResponse(d)，前端需要自己反序列化：data=JSON.parse(data)</li><li>后端使用return HttpResponse(d)，前端不反序列化，需要指定参数：datatype：‘json’</li></ol> 
</blockquote> 
<hr> 
<h3><a id="3Ajax_208"></a>3、使用了Ajax作为请求后的注意事项</h3> 
<ul><li>后端不要返回render、redirect、HttpResponse。因为这些内容会被统一当做字符串返回给Ajax</li></ul> 
<pre><code class="prism language-python">	<span class="token keyword">def</span> <span class="token function">test</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>is_ajax<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'login.html'</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'test.html'</span><span class="token punctuation">)</span>
</code></pre> 
<p>控制台打印效果：<br> <img src="https://images2.imgbox.com/4c/50/Se2eVJRF_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p><code>总结：使用了AJax作为请求以后，建议使用JsonResponse返回数据，虽说最终还是通过HttpResponse返回到web的，但是JsonResponse内部就做了响应格式的转换</code></p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/b0/f4/MP4Y2fD2_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>这种和我们直接通过HttpResponse返回一个JSON格式数据是不一样的。AJax只会根据响应码来做处理</p> 
</blockquote> 
<hr> 
<h2><a id="contentType_230"></a>四、前后端数据传输的编码格式(content-Type)</h2> 
<p>我们前后端数据交互格式其实有很多种（普通键值对、文件、JSON格式）每一种格式发过去之后，它是怎么样动态识别的呢？</p> 
<pre><code class="prism language-python">我们通过网页右键检查<span class="token operator">&gt;</span>Network<span class="token operator">&gt;</span>Content<span class="token operator">-</span>Type这个数据表示当前数据是什么编码，可以通过form表单中的enctype去修改类型
针对不同的格式数据Django后端会有不同的响应

Form<span class="token operator">-</span>data所有的数据都会被解析到reqeust<span class="token punctuation">.</span>files里面，二进制是无法查阅的
Urlencoded会被解析到request<span class="token punctuation">.</span>post里面
application<span class="token operator">/</span>json它的数据格式是json格式，这个格式form表单发送不了，只有Ajax可以发送
</code></pre> 
<h3><a id="1urlencoded_243"></a>1.urlencoded</h3> 
<pre><code class="prism language-python">	Ajax默认的编码格式、form表单默认的编码格式
	数据格式：xxx<span class="token operator">=</span>yyy<span class="token operator">&amp;</span>uuu<span class="token operator">=</span>ooo<span class="token operator">&amp;</span>aaa<span class="token operator">=</span>bbb
	django后端会自动处理到request<span class="token punctuation">.</span>POST中
</code></pre> 
<h3><a id="2formdata_250"></a>2.formdata</h3> 
<p><code>formdata就是form表单的第三个参数enctype=‘multipart/form-data’，它会使浏览器接收到的数据格式更改，使之post请求方式无法获取到提交到后端的数据</code></p> 
<blockquote> 
 <p>django后端针对<code>普通的键值对</code>还是处理到<code>request.POST</code>中，但是针对<code>文件</code>会处理到<code>request.Field</code>中</p> 
</blockquote> 
<h3><a id="3applicationjson_255"></a>3.application/json</h3> 
<pre><code class="prism language-python">	<span class="token triple-quoted-string string">'''模拟Ajax发送数据'''</span>

	<span class="token string">'html代码'</span>
	<span class="token operator">&lt;</span>button <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">"d1"</span><span class="token operator">&gt;</span>点击我发送数据<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
		$<span class="token punctuation">(</span><span class="token string">'#d1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>function <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	        $<span class="token punctuation">.</span>ajax<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
	            url<span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>
	            <span class="token builtin">type</span><span class="token punctuation">:</span><span class="token string">'post'</span><span class="token punctuation">,</span>
	            data<span class="token punctuation">:</span>JSON<span class="token punctuation">.</span>stringify<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'jack'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token operator">//</span> 必须json格式
	            contentType<span class="token punctuation">:</span><span class="token string">'application/json'</span><span class="token punctuation">,</span> <span class="token operator">//</span> 要制定模式 默认Urlencoded
	            success<span class="token punctuation">:</span>function <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	                <span class="token punctuation">{<!-- --></span><span class="token comment">#console.log(typeof data)#}</span>
	            <span class="token punctuation">}</span>
	        <span class="token punctuation">}</span><span class="token punctuation">)</span>
	    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>

	views<span class="token punctuation">.</span>py
	<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>is_ajax<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 判断当前是不是ajax请求专门的方法</span>
        <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>POST<span class="token punctuation">)</span>  <span class="token comment"># &lt;QueryDict: {}&gt;</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>FILES<span class="token punctuation">)</span>  <span class="token comment"># &lt;MultiValueDict: {}&gt;</span>
            <span class="token triple-quoted-string string">'''Django后端针对json格式数据处理不了 会放在request.body里面'''</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>body<span class="token punctuation">)</span>  <span class="token comment"># b'{"name":"jack","age":18}'</span>
            <span class="token triple-quoted-string string">'''Django它不会去处理需要我们自己去处理'''</span>
            json_bytes <span class="token operator">=</span> request<span class="token punctuation">.</span>body
            <span class="token keyword">import</span> json
            json_dict <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>json_bytes<span class="token punctuation">)</span>  <span class="token comment"># Json解码</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>json_dict<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>json_dict<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p><code>form表单</code>只支持<code>urlencoded</code>和<code>formdata</code>两个数据格式，但<code>ajax</code>支持三种数据格式<code>（urlencoded、formdata和application/json)。</code></p> 
</blockquote> 
<hr> 
<h2><a id="Ajax_298"></a>五、Ajax携带文件数据</h2> 
<blockquote> 
 <p>在form表单内，我们是通过指定了一下编码格式才可以将文件上传到后端，而通过Ajax我们将不再借助form表单来实现这一效果</p> 
</blockquote> 
<pre><code class="prism language-python">	<span class="token string">'html代码'</span>
	
	<span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"text"</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">"ts1"</span> <span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"file"</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">"myfile"</span> <span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>button <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>点我发送数据<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
	
	<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
	    $<span class="token punctuation">(</span><span class="token string">'#btn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>function<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	        <span class="token operator">//</span><span class="token number">1.</span>产生内置对象
	        <span class="token operator">//</span>实例化一个对象，formdata对象用来保存key<span class="token operator">/</span>value结构的数据<span class="token punctuation">,</span>通常用于form传输数据
	        var MyFormDataObj <span class="token operator">=</span> new FormData<span class="token punctuation">;</span>
	
	        var ts1 <span class="token operator">=</span> $<span class="token punctuation">(</span><span class="token string">'#ts1'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>val<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	        <span class="token operator">//</span>$<span class="token punctuation">(</span><span class="token string">'#myfile'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>获取原生JS、$<span class="token punctuation">(</span><span class="token string">'#myfile'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>files获取用户上传的所有文件
	        var myfile <span class="token operator">=</span> $<span class="token punctuation">(</span><span class="token string">'#myfile'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	        <span class="token punctuation">{<!-- --></span><span class="token comment">#console.log(myfile)#}</span>
	        <span class="token operator">//</span><span class="token number">2.</span>添加普通数据
	        MyFormDataObj<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'ts1'</span><span class="token punctuation">,</span>ts1<span class="token punctuation">)</span>
	        <span class="token operator">//</span><span class="token number">3.</span>添加文件数据
	        MyFormDataObj<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'myfile'</span><span class="token punctuation">,</span>myfile<span class="token punctuation">)</span> <span class="token operator">//</span>给该文件定义一个取值名称，第一个参数自定义，第二个参数：值
	        <span class="token operator">//</span><span class="token number">4.</span>发送Ajax请求
	        $<span class="token punctuation">.</span>ajax<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
	            url<span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>
	            <span class="token builtin">type</span><span class="token punctuation">:</span><span class="token string">'post'</span><span class="token punctuation">,</span>
	            data<span class="token punctuation">:</span>MyFormDataObj<span class="token punctuation">,</span>  <span class="token operator">//</span>本身含有编码，无需做声明
	            contentType<span class="token punctuation">:</span>false<span class="token punctuation">,</span>   <span class="token operator">//</span>不使用任何编码，必须添加固定格式
	            processData<span class="token punctuation">:</span> false<span class="token punctuation">,</span>  <span class="token operator">//</span>不处理数据对象
	            success<span class="token punctuation">:</span>function<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	            	console<span class="token punctuation">.</span>log<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
	                console<span class="token punctuation">.</span>log<span class="token punctuation">(</span>data<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	            <span class="token punctuation">}</span>
	        <span class="token punctuation">}</span><span class="token punctuation">)</span>
	    <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
	
	<span class="token string">'后端views.py'</span>
	<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> request<span class="token punctuation">.</span>is_ajax<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 判断当前是不是ajax请求专门的方法</span>
        <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
            <span class="token builtin">file</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>FILES<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'myfile'</span><span class="token punctuation">)</span>
            <span class="token keyword">import</span> os
            DIR_PATH <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span>

            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>DIR_PATH<span class="token operator">+</span><span class="token builtin">file</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span><span class="token keyword">as</span> f<span class="token punctuation">:</span>
                <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
                    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>i<span class="token punctuation">)</span>

            <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'status'</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">'msg'</span><span class="token punctuation">:</span> <span class="token string">'上传成功'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>
</code></pre> 
<p>最终结果：<br> <img src="https://images2.imgbox.com/f0/e4/r2cAM3BM_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>后端还是通过这两个请求方法<code>获取文件和普通数据</code>，Ajax后端也是一样的。只是前端不一样需要添加<code>contentType</code>和<code>processdata</code>参数</p> 
</blockquote> 
<p><strong>如果我们要实现多个文件上传，稍微做出一些改动即可：</strong></p> 
<pre><code class="prism language-python">	<span class="token string">'html代码'</span>
	<span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"file"</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">"myfile"</span> multiple<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>!<span class="token operator">-</span><span class="token operator">-</span>允许上传多个文件<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>button <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>上传文件<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
	
	<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
	    $<span class="token punctuation">(</span><span class="token string">'#btn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>function<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	        <span class="token operator">//</span>实例化一个对象用来保存key<span class="token operator">/</span>value结构的数据，通常用于form传输数据
	        var FormDataObj <span class="token operator">=</span> new FormData<span class="token punctuation">;</span>
	        var myfile <span class="token operator">=</span> $<span class="token punctuation">(</span><span class="token string">'#myfile'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>files<span class="token punctuation">;</span> <span class="token operator">//</span>获取需要上传的所有文件<span class="token punctuation">,</span>拿到的是一个列表的形式
	
	        <span class="token keyword">for</span><span class="token punctuation">(</span>var i <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>myfile<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token operator">//</span>根据上传文件的数量来进行遍历
	            FormDataObj<span class="token punctuation">.</span>append<span class="token punctuation">(</span>myfile<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">,</span>myfile<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
	            <span class="token operator">//</span>将每一个文件的名称作为key，文件作为value追加到FormData对象内
	        <span class="token punctuation">}</span>
	
	        $<span class="token punctuation">.</span>ajax<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
	            url<span class="token punctuation">:</span><span class="token string">'/index/'</span><span class="token punctuation">,</span>
	            <span class="token builtin">type</span><span class="token punctuation">:</span><span class="token string">'post'</span><span class="token punctuation">,</span>
	            contentType<span class="token punctuation">:</span>false<span class="token punctuation">,</span>
	            processData<span class="token punctuation">:</span>false<span class="token punctuation">,</span>
	            data<span class="token punctuation">:</span>FormDataObj<span class="token punctuation">,</span>
	            success<span class="token punctuation">:</span>function<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	                console<span class="token punctuation">.</span>log<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
	            <span class="token punctuation">}</span>
	        <span class="token punctuation">}</span><span class="token punctuation">)</span>
	
	    <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>

	<span class="token string">'后端views.py'</span>
	<span class="token keyword">from</span> django<span class="token punctuation">.</span>http <span class="token keyword">import</span> JsonResponse
	<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
	    <span class="token keyword">if</span> request<span class="token punctuation">.</span>is_ajax<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 判断当前是不是ajax请求专门的方法</span>
	        <span class="token keyword">import</span> os
	        DIR_PATH <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span>
	        <span class="token builtin">file</span> <span class="token operator">=</span> request<span class="token punctuation">.</span>FILES
	        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>
	
	        <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
	            fl1 <span class="token operator">=</span> <span class="token builtin">file</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span>k<span class="token punctuation">)</span>
	            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>DIR_PATH <span class="token operator">+</span> fl1<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
	                <span class="token keyword">for</span> i <span class="token keyword">in</span> fl1<span class="token punctuation">:</span>
	                    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
	
	        <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'status'</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">'msg'</span><span class="token punctuation">:</span> <span class="token string">'上传成功'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	
	    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>
	
</code></pre> 
<p>最终结果：<br> <img src="https://images2.imgbox.com/31/a6/djQA7vVg_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h2><a id="Ajaxjson_417"></a>六、Ajax发送json格式数据</h2> 
<blockquote> 
 <p>通过在Ajax内指定好编码格式，然后将js的数据类型转换成JSON格式数据上传给后端</p> 
</blockquote> 
<pre><code class="prism language-python">	<span class="token number">1.</span>确保发送json对应的数据是json格式字符串
		data<span class="token punctuation">:</span>JSON<span class="token punctuation">.</span>stringfly<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token number">2.</span>修改数据编码格式（默认是urlencoded）
		contentType<span class="token punctuation">:</span><span class="token string">'application/json'</span>
</code></pre> 
<p><strong>home.html</strong></p> 
<pre><code class="prism language-python">	<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>用户名： <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"text"</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">"username"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>密码： <span class="token operator">&lt;</span><span class="token builtin">input</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token string">"password"</span> <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">"password"</span> <span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>button <span class="token builtin">id</span><span class="token operator">=</span><span class="token string">"btn"</span><span class="token operator">&gt;</span>提交<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>	
	<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
	    $<span class="token punctuation">(</span><span class="token string">'#btn'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span>function <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	        var name <span class="token operator">=</span> $<span class="token punctuation">(</span><span class="token string">'#username'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>val<span class="token punctuation">(</span><span class="token punctuation">)</span>
	        var password <span class="token operator">=</span> $<span class="token punctuation">(</span><span class="token string">'#password'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>val<span class="token punctuation">(</span><span class="token punctuation">)</span>
	
	        $<span class="token punctuation">.</span>ajax<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
	            url<span class="token punctuation">:</span><span class="token string">'/home/'</span><span class="token punctuation">,</span>
	            <span class="token builtin">type</span><span class="token punctuation">:</span><span class="token string">'post'</span><span class="token punctuation">,</span>
	            data<span class="token punctuation">:</span>JSON<span class="token punctuation">.</span>stringify<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'username'</span><span class="token punctuation">:</span>name<span class="token punctuation">,</span><span class="token string">'password'</span><span class="token punctuation">:</span>password<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
	            contentType<span class="token punctuation">:</span><span class="token string">'application/json'</span><span class="token punctuation">,</span>
	            success<span class="token punctuation">:</span>function <span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	                console<span class="token punctuation">.</span>log<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
	            <span class="token punctuation">}</span>
	        <span class="token punctuation">}</span><span class="token punctuation">)</span>
	    <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> 
<p><strong>后端views.py：并不能同以往来处理请求里面的数据了</strong></p> 
<pre><code class="prism language-python">	<span class="token keyword">import</span> json
	<span class="token keyword">def</span> <span class="token function">home</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">:</span>
	    <span class="token keyword">if</span> request<span class="token punctuation">.</span>is_ajax<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
	        <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">==</span> <span class="token string">'POST'</span><span class="token punctuation">:</span>
	            <span class="token comment"># json格式，从POST中取不出来</span>
	            name <span class="token operator">=</span> request<span class="token punctuation">.</span>POST<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>
	            <span class="token comment"># print(type(request.POST)) #&lt;class 'django.http.request.QueryDict'&gt;</span>
	            <span class="token comment"># print(name)  # None</span>
	
	            <span class="token comment"># Ajax上传的JSON格式数据在request.body中，且是bytes类型</span>
	            <span class="token keyword">print</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span>body<span class="token punctuation">)</span>  <span class="token comment"># b'{"username":"fdsa","password":"fdsa"}</span>
	
	            <span class="token comment">#在python3.6之后loads可以将bytes里面如果有JSON格式数据，可以转换出来</span>
	            request<span class="token punctuation">.</span>data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>request<span class="token punctuation">.</span>body<span class="token punctuation">)</span>
	            name <span class="token operator">=</span> request<span class="token punctuation">.</span>data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'username'</span><span class="token punctuation">)</span>
	            password <span class="token operator">=</span> request<span class="token punctuation">.</span>data<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'password'</span><span class="token punctuation">)</span>
	            <span class="token keyword">print</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>password<span class="token punctuation">)</span> <span class="token comment"># 123 456</span>
	            <span class="token keyword">return</span> JsonResponse<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'status'</span><span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token string">'msg'</span><span class="token punctuation">:</span><span class="token string">'提交成功'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
	
	    <span class="token keyword">return</span> render<span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token string">'home.html'</span><span class="token punctuation">)</span>
</code></pre> 
<p>最终结果：<br> <img src="https://images2.imgbox.com/1f/08/doDnKaHz_o.png" alt="在这里插入图片描述"></p> 
<hr>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e5ee58a183cf5dddfea0b4c002e6ef75/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">太累了，是时候让AI数字人来帮我干活了（走，上教程）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9faa983e56c5b90d77b1097eb080a525/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">工具使用篇（1）--快速将网页接口url及参数设置到postman来调试</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>