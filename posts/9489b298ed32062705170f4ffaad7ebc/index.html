<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>EduCoder 机器学习 决策树 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="EduCoder 机器学习 决策树" />
<meta property="og:description" content="决策树说通俗点就是一棵能够替我们做决策的树，或者说是我们人类在要做决策时脑回路的一种表现形式。
本实训项目的主要内容是基于 python 语言搭建出决策树模型对数据分类，并使用 sklearn 的决策时模型对鸢尾花数据进行分类。
第1关：什么是决策树 任务描述相关知识 引例决策树的相关概念编程要求测试说明 任务描述 本关任务：根据本节课所学知识完成本关所设置的选择题。
相关知识 为了完成本关任务，你需要掌握决策树的相关基础知识。
引例 在炎热的夏天，没有什么比冰镇后的西瓜更能令人感到心旷神怡的了。现在我要去水果店买西瓜，但什么样的西瓜能入我法眼呢？那根据我的个人习惯，在挑西瓜时可能就有这样的脑回路。
假设现在水果店里有3个西瓜，它们的属性如下：
编号瓤是否够红够不够冰是否便宜是否有籽1是否是否2是是否是3否是是否 那么根据我的脑回路我会买1和2号西瓜。
其实我的脑回路可以看成一棵树，并且这棵树能够帮助我对买不买西瓜这件事做决策，所以它就是一棵决策树。
决策树的相关概念 决策树是一种可以用于分类与回归的机器学习算法，但主要用于分类。用于分类的决策树是一种描述对实例进行分类的树形结构。决策树由结点和边组成，其中结点分为内部结点和叶子结点，内部结点表示一个特征或者属性，叶子结点表示标签（脑回路图中黄色的是内部结点，蓝色的是叶子结点）。
从代码角度来看，决策树其实可以看成是一堆if-else语句的集合，例如引例中的决策树完全可以看成是如下代码：
if isRed: if isCold: if hasSeed: print(&#34;buy&#34;) else: print(&#34;don&#39;t buy&#34;) else: if isCheap: print(&#34;buy&#34;) else: print(&#34;don&#39;t buy&#34;)else: print(&#34;don&#39;t buy&#34;) 因此决策树的一个非常大的优势就是模型的可理解性非常高，甚至可以用来挖掘数据中比较重要的信息。
那么如何构造出一棵好的决策树呢？其实构造决策树时会遵循一个指标，有的是按照信息增益来构建，如ID3算法；有的是信息增益率来构建，如C4.5算法；有的是按照基尼系数来构建的，如CART算法。但不管是使用哪种构建算法，决策树的构建过程通常都是一个递归选择最优特征，并根据特征对训练集进行分割，使得对各个子数据集有一个最好的分类的过程。
这一过程对应着对特征空间的划分，也对应着决策树的构建。一开始，构建决策树的根结点，将所有训练数据都放在根结点。选择一个最优特征，并按照这一特征将训练数据集分割成子集，使得各个子集有一个在当前条件下最好的分类。如果这些子集已经能够被基本正确分类，那么构建叶子结点，并将这些子集分到所对应的叶结点中去；如果还有子集不能被基本正确分类，那么就对这些子集选择新的最优特征，继续对其进行分割，并构建相应的结点。如此递归进行下去，直至所有训练数据子集被基本正确分类，或者没有合适的特征为止。最后每个子集都被分到叶子结点上，即都有了明确的类别。这就构建出了一棵决策树。
编程要求 根据本关所学习到的知识，完成所有选择题。
测试说明 平台会对你的选项进行判断，如果实际输出结果与预期结果相同，则通关；反之，则 GameOver。
开始你的任务吧，祝你成功！
1、下列说法正确的是？（AB）
A、 训练决策树的过程就是构建决策树的过程
B、 ID3算法是根据信息增益来构建决策树
C、 C4.5算法是根据基尼系数来构建决策树
D、 决策树模型的可理解性不高
2、下列说法错误的是？（B）
A、 从树的根节点开始，根据特征的值一步一步走到叶子节点的过程是决策树做决策的过程
B、 决策树只能是一棵二叉树
C、 根节点所代表的特征是最优特征
第2关：信息熵与信息增益 任务描述相关知识 信息熵条件熵信息增益编程要求测试说明 任务描述 本关任务：掌握什么是信息增益，完成计算信息增益的程序设计。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9489b298ed32062705170f4ffaad7ebc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-19T22:24:02+08:00" />
<meta property="article:modified_time" content="2021-06-19T22:24:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">EduCoder 机器学习 决策树</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <div class="introContentWrap___39pY3"> 
 <div class="introContent___1FvMt introContentMaxHeight___1zEgP"> 
  <div class=" markdown-body"> 
   <p>决策树说通俗点就是一棵能够替我们做决策的树，或者说是我们人类在要做决策时脑回路的一种表现形式。</p> 
   <p>本实训项目的主要内容是基于 python 语言搭建出决策树模型对数据分类，并使用 sklearn 的决策时模型对鸢尾花数据进行分类。</p> 
  </div> 
 </div> 
</div> 
<h3><a id="1_4"></a>第1关：什么是决策树</h3> 
<div class="tab-panel-body  markdown-body"> 
 <ul><li><a href="#%E4%BB%BB%E5%8A%A1%E6%8F%8F%E8%BF%B0" rel="nofollow">任务描述</a></li><li><a href="#%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86" rel="nofollow">相关知识</a> 
   <ul><li><a href="#%E5%BC%95%E4%BE%8B" rel="nofollow">引例</a></li><li><a href="#%E5%86%B3%E7%AD%96%E6%A0%91%E7%9A%84%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5" rel="nofollow">决策树的相关概念</a></li></ul></li><li><a href="#%E7%BC%96%E7%A8%8B%E8%A6%81%E6%B1%82" rel="nofollow">编程要求</a></li><li><a href="#%E6%B5%8B%E8%AF%95%E8%AF%B4%E6%98%8E" rel="nofollow">测试说明</a></li></ul> 
 <hr> 
 <h5 id="任务描述">任务描述</h5> 
 <p>本关任务：根据本节课所学知识完成本关所设置的选择题。</p> 
 <h5 id="相关知识">相关知识</h5> 
 <p>为了完成本关任务，你需要掌握决策树的相关基础知识。</p> 
 <h6 id="引例">引例</h6> 
 <p>在炎热的夏天，没有什么比冰镇后的西瓜更能令人感到心旷神怡的了。现在我要去水果店买西瓜，但什么样的西瓜能入我法眼呢？那根据我的个人习惯，在挑西瓜时可能就有这样的脑回路。</p> 
 <p align="center"> <img src="https://images2.imgbox.com/06/ed/BBAGxy9k_o.jpg" alt="" height="60%" width="60%"> </p> 
</div> 
<p>假设现在水果店里有<code>3</code>个西瓜，它们的属性如下：</p> 
<table><thead><tr><th>编号</th><th>瓤是否够红</th><th>够不够冰</th><th>是否便宜</th><th>是否有籽</th></tr></thead><tbody><tr><td>1</td><td>是</td><td>否</td><td>是</td><td>否</td></tr><tr><td>2</td><td>是</td><td>是</td><td>否</td><td>是</td></tr><tr><td>3</td><td>否</td><td>是</td><td>是</td><td>否</td></tr></tbody></table> 
<p>那么根据我的脑回路我会买<code>1</code>和<code>2</code>号西瓜。</p> 
<p>其实我的脑回路可以看成一棵树，并且这棵树能够帮助我对买不买西瓜这件事做决策，所以它就是一棵<strong>决策树</strong>。</p> 
<h6 id="决策树的相关概念">决策树的相关概念</h6> 
<p>决策树是一种可以用于分类与回归的机器学习算法，但主要用于分类。用于分类的决策树是一种描述对实例进行分类的树形结构。决策树由<strong>结点</strong>和<strong>边</strong>组成，其中结点分为<strong>内部结点</strong>和<strong>叶子结点</strong>，<strong>内部结点表示一个特征或者属性，叶子结点表示标签（脑回路图中黄色的是内部结点，蓝色的是叶子结点）。</strong></p> 
<p>从代码角度来看，决策树其实可以看成是一堆<code>if-else</code>语句的集合，例如引例中的决策树完全可以看成是如下代码：</p> 
<pre class="prettyprint linenums prettyprinted"> 
 <ol class="linenums"><li class="L0"><code class="language-python"><span class="kwd">if</span><span class="pln"> isRed</span><span class="pun">:</span></code></li><li class="L1"><code class="language-python"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> isCold</span><span class="pun">:</span></code></li><li class="L2"><code class="language-python"><span class="pln">        </span><span class="kwd">if</span><span class="pln"> hasSeed</span><span class="pun">:</span></code></li><li class="L3"><code class="language-python"><span class="pln">            </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"buy"</span><span class="pun">)</span></code></li><li class="L4"><code class="language-python"><span class="pln">        </span><span class="kwd">else</span><span class="pun">:</span></code></li><li class="L5"><code class="language-python"><span class="pln">            </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"don't buy"</span><span class="pun">)</span></code></li><li class="L6"><code class="language-python"><span class="pln">    </span><span class="kwd">else</span><span class="pun">:</span></code></li><li class="L7"><code class="language-python"><span class="pln">        </span><span class="kwd">if</span><span class="pln"> isCheap</span><span class="pun">:</span></code></li><li class="L8"><code class="language-python"><span class="pln">            </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"buy"</span><span class="pun">)</span></code></li><li class="L9"><code class="language-python"><span class="pln">        </span><span class="kwd">else</span><span class="pun">:</span></code></li><li class="L0"><code class="language-python"><span class="pln">            </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"don't buy"</span><span class="pun">)</span></code></li><li class="L1"><code class="language-python"><span class="kwd">else</span><span class="pun">:</span></code></li><li class="L2"><code class="language-python"><span class="pln">    </span><span class="kwd">print</span><span class="pun">(</span><span class="str">"don't buy"</span><span class="pun">)</span></code></li></ol></pre> 
<p>因此决策树的一个非常大的优势就是模型的可理解性非常高，甚至可以用来挖掘数据中比较重要的信息。</p> 
<p>那么如何构造出一棵好的决策树呢？其实构造决策树时会遵循一个指标，有的是按照信息增益来构建，如<strong>ID3算法</strong>；有的是信息增益率来构建，如<strong>C4.5算法</strong>；有的是按照基尼系数来构建的，如<strong>CART算法</strong>。但不管是使用哪种构建算法，决策树的构建过程通常都是一个递归选择最优特征，并根据特征对训练集进行分割，使得对各个子数据集有一个最好的分类的过程。</p> 
<p>这一过程对应着对特征空间的划分，也对应着决策树的构建。一开始，构建决策树的根结点，将所有训练数据都放在根结点。选择一个最优特征，并按照这一特征将训练数据集分割成子集，使得各个子集有一个在当前条件下最好的分类。如果这些子集已经能够被基本正确分类，那么构建叶子结点，并将这些子集分到所对应的叶结点中去；如果还有子集不能被基本正确分类，那么就对这些子集选择新的最优特征，继续对其进行分割，并构建相应的结点。如此递归进行下去，直至所有训练数据子集被基本正确分类，或者没有合适的特征为止。最后每个子集都被分到叶子结点上，即都有了明确的类别。这就构建出了一棵决策树。</p> 
<h5 id="编程要求">编程要求</h5> 
<p>根据本关所学习到的知识，完成所有选择题。</p> 
<h5 id="测试说明">测试说明</h5> 
<p>平台会对你的选项进行判断，如果实际输出结果与预期结果相同，则通关；反之，则 <code>GameOver</code>。</p> 
<hr> 
<p>开始你的任务吧，祝你成功！</p> 
<ul class="choose-container"><li> 
  <div class="subject"> 
   <div class="subject-body markdown-body"> 
    <p>1、下列说法正确的是？（AB）</p> 
   </div> 
  </div> 
  <div class="option"> 
   <a class="flex-container"><span class="checkbox active"></span></a> 
   <div class="flex-wrp"> 
    A、 
    <div class="subject-body markdown-body"> 
     <p>训练决策树的过程就是构建决策树的过程</p> 
    </div> 
   </div> 
   <a class="flex-container"><span class="checkbox active"></span></a> 
   <div class="flex-wrp"> 
    B、 
    <div class="subject-body markdown-body"> 
     <p>ID3算法是根据信息增益来构建决策树</p> 
    </div> 
   </div> 
   <a class="flex-container"><span class="checkbox "></span></a> 
   <div class="flex-wrp"> 
    C、 
    <div class="subject-body markdown-body"> 
     <p>C4.5算法是根据基尼系数来构建决策树</p> 
    </div> 
   </div> 
   <a class="flex-container"><span class="checkbox "></span></a> 
   <div class="flex-wrp"> 
    D、 
    <div class="subject-body markdown-body"> 
     <p>决策树模型的可理解性不高</p> 
    </div> 
   </div> 
  </div></li><li> 
  <div class="subject"> 
   <div class="subject-body markdown-body"> 
    <p>2、下列说法错误的是？（B）</p> 
   </div> 
  </div> 
  <div class="option"> 
   <a class="flex-container"><span class="radio "></span></a> 
   <div class="flex-wrp"> 
    A、 
    <div class="subject-body markdown-body"> 
     <p>从树的根节点开始，根据特征的值一步一步走到叶子节点的过程是决策树做决策的过程</p> 
    </div> 
   </div> 
   <a class="flex-container"><span class="radio active"></span></a> 
   <div class="flex-wrp"> 
    B、 
    <div class="subject-body markdown-body"> 
     <p>决策树只能是一棵二叉树</p> 
    </div> 
   </div> 
   <a class="flex-container"><span class="radio "></span></a> 
   <div class="flex-wrp"> 
    C、 
    <div class="subject-body markdown-body"> 
     <p>根节点所代表的特征是最优特征</p> 
    </div> 
   </div> 
  </div></li></ul> 
<h3><a id="2_75"></a>第2关：信息熵与信息增益</h3> 
<div class="tab-panel-body  markdown-body"> 
 <ul><li><a href="#%E4%BB%BB%E5%8A%A1%E6%8F%8F%E8%BF%B0" rel="nofollow">任务描述</a></li><li><a href="#%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86" rel="nofollow">相关知识</a> 
   <ul><li><a href="#%E4%BF%A1%E6%81%AF%E7%86%B5" rel="nofollow">信息熵</a></li><li><a href="#%E6%9D%A1%E4%BB%B6%E7%86%B5" rel="nofollow">条件熵</a></li><li><a href="#%E4%BF%A1%E6%81%AF%E5%A2%9E%E7%9B%8A" rel="nofollow">信息增益</a></li></ul></li><li><a href="#%E7%BC%96%E7%A8%8B%E8%A6%81%E6%B1%82" rel="nofollow">编程要求</a></li><li><a href="#%E6%B5%8B%E8%AF%95%E8%AF%B4%E6%98%8E" rel="nofollow">测试说明</a></li></ul> 
 <hr> 
 <h5 id="任务描述">任务描述</h5> 
 <p>本关任务：掌握什么是信息增益，完成计算信息增益的程序设计。</p> 
 <h5 id="相关知识">相关知识</h5> 
 <p>为了完成本关任务，你需要掌握：</p> 
 <ul><li><p>信息熵；</p> </li><li><p>条件熵；</p> </li><li><p>信息增益。</p> </li></ul> 
 <h6 id="信息熵">信息熵</h6> 
 <p>信息是个很抽象的概念。人们常常说信息很多，或者信息较少，但却很难说清楚信息到底有多少。比如一本五十万字的中文书到底有多少信息量。</p> 
 <p>直到1948年，香农提出了<strong>“信息熵”</strong>的概念，才解决了对信息的量化度量问题。信息熵这个词是香农从热力学中借用过来的。热力学中的热熵是表示分子状态混乱程度的物理量。香农用信息熵的概念来描述信源的不确定度。<strong>信源的不确定性越大，信息熵也越大</strong>。</p> 
 <p>从机器学习的角度来看，信息熵表示的是信息量的期望值。如果数据集中的数据需要被分成多个类别，则信息量<code><span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">I</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span><span class="mclose">)</span></span></span></span></code>的定义如下(其中<code><span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span></span></span></span></code>表示多个类别中的第<code>i</code>个类别，<code><span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span><span class="mclose">)</span></span></span></span></code>数据集中类别为<code><span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span></span></span></span></code>的数据在数据集中出现的概率表示)：</p> 
 <p class="editormd-tex"><span class="katex-display"><span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">I</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">X</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span><span class="mclose">)</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">−</span><span class="mord mathdefault">l</span><span class="mord mathdefault">o</span><span class="mord"><span class="mord mathdefault">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p> 
 <p>由于信息熵是信息量的期望值，所以信息熵<code>H(X)</code>的定义如下(其中<code>n</code>为数据集中类别的数量)：</p> 
 <p class="editormd-tex"><span class="katex-display"><span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">H</span><span class="mopen">(</span><span class="mord mathdefault">X</span><span class="mclose">)</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">−</span><span class="mord mathdefault">s</span><span class="mord mathdefault">u</span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span><span class="mclose">)</span><span class="mord mathdefault">l</span><span class="mord mathdefault">o</span><span class="mord"><span class="mord mathdefault">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span><span class="mord mathdefault">p</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p> 
 <p>从这个公式也可以看出，如果概率是<code>0</code>或者是<code>1</code>的时候，熵就是<code>0</code>（因为这种情况下随机变量的不确定性是最低的）。那如果概率是<code>0.5</code>，也就是五五开的时候，此时熵达到最大，也就是<code>1</code>。（就像扔硬币，你永远都猜不透你下次扔到的是正面还是反面，所以它的不确定性非常高）。所以呢，<strong>熵越大，不确定性就越高</strong>。</p> 
 <h6 id="条件熵">条件熵</h6> 
 <p>在实际的场景中，我们可能需要研究数据集中某个特征等于某个值时的信息熵等于多少，这个时候就需要用到<strong>条件熵</strong>。条件熵<code>H(Y|X)</code>表示特征X为某个值的条件下，类别为Y的熵。条件熵的计算公式如下：</p> 
 <p class="editormd-tex"><span class="katex-display"><span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">H</span><span class="mopen">(</span><span class="mord mathdefault">Y</span><span class="mord">∣</span><span class="mord mathdefault">X</span><span class="mclose">)</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">u</span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span><span class="mord mathdefault">H</span><span class="mopen">(</span><span class="mord mathdefault">Y</span><span class="mord">∣</span><span class="mord mathdefault">X</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p> 
 <p>当然条件熵的性质也和熵的性质一样，概率越确定，条件熵就越小，概率越五五开，条件熵就越大。</p> 
 <h6 id="信息增益">信息增益</h6> 
 <p>现在已经知道了什么是熵，什么是条件熵。接下来就可以看看什么是信息增益了。所谓的信息增益就是表示我已知条件<code>X</code>后能得到信息<code>Y</code>的不确定性的减少程度。</p> 
 <p>就好比，我在玩读心术。你心里想一件东西，我来猜。我已开始什么都没问你，我要猜的话，肯定是瞎猜。这个时候我的熵就非常高。然后我接下来我会去试着问你是非题，当我问了是非题之后，我就能减小猜测你心中想到的东西的范围，这样其实就是减小了我的熵。那么我熵的减小程度就是我的信息增益。</p> 
 <p>所以信息增益如果套上机器学习的话就是，如果把特征<code>A</code>对训练集<code>D</code>的信息增益记为<code>g(D, A)</code>的话，那么<code>g(D, A)</code>的计算公式就是：</p> 
 <p class="editormd-tex"><span class="katex-display"><span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord mathdefault">D</span><span class="mpunct">,</span><span class="mspace"></span><span class="mord mathdefault">A</span><span class="mclose">)</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord mathdefault">H</span><span class="mopen">(</span><span class="mord mathdefault">D</span><span class="mclose">)</span><span class="mspace"></span><span class="mbin">−</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord mathdefault">H</span><span class="mopen">(</span><span class="mord mathdefault">D</span><span class="mpunct">,</span><span class="mspace"></span><span class="mord mathdefault">A</span><span class="mclose">)</span></span></span></span></span></p> 
 <p>为了更好的解释熵，条件熵，信息增益的计算过程，下面通过示例来描述。假设我现在有这一个数据集，第一列是编号，第二列是性别，第三列是活跃度，第四列是客户是否流失的标签（<code>0</code>表示未流失，<code>1</code>表示流失）。</p> 
 <table><thead><tr><th>编号</th><th>性别</th><th>活跃度</th><th>是否流失</th></tr></thead><tbody><tr><td>1</td><td>男</td><td>高</td><td>0</td></tr><tr><td>2</td><td>女</td><td>中</td><td>0</td></tr><tr><td>3</td><td>男</td><td>低</td><td>1</td></tr><tr><td>4</td><td>女</td><td>高</td><td>0</td></tr><tr><td>5</td><td>男</td><td>高</td><td>0</td></tr><tr><td>6</td><td>男</td><td>中</td><td>0</td></tr><tr><td>7</td><td>男</td><td>中</td><td>1</td></tr><tr><td>8</td><td>女</td><td>中</td><td>0</td></tr><tr><td>9</td><td>女</td><td>低</td><td>1</td></tr><tr><td>10</td><td>女</td><td>中</td><td>0</td></tr><tr><td>11</td><td>女</td><td>高</td><td>0</td></tr><tr><td>12</td><td>男</td><td>低</td><td>1</td></tr><tr><td>13</td><td>女</td><td>低</td><td>1</td></tr><tr><td>14</td><td>男</td><td>高</td><td>0</td></tr><tr><td>15</td><td>男</td><td>高</td><td>0</td></tr></tbody></table> 
 <p>假如要算性别和活跃度这两个特征的信息增益的话，首先要先算总的熵和条件熵。总的熵其实非常好算，就是把标签作为随机变量<code>X</code>。上表中标签只有两种（<code>0</code>和<code>1</code>）因此随机变量<code>X</code>的取值只有<code>0</code>或者<code>1</code>。所以要计算熵就需要先分别计算标签为<code>0</code>的概率和标签为<code>1</code>的概率。从表中能看出标签为<code>0</code>的数据有<code>10</code>条，所以标签为<code>0</code>的概率等于<code>2/3</code>。标签为<code>1</code>的概率为<code>1/3</code>。所以熵为：</p> 
 <p class="editormd-tex"><span class="katex-display"><span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord">−</span><span class="mopen">(</span><span class="mord">1</span><span class="mord">/</span><span class="mord">3</span><span class="mclose">)</span><span class="mspace"></span><span class="mbin">∗</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord mathdefault">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord">1</span><span class="mord">/</span><span class="mord">3</span><span class="mclose">)</span><span class="mspace"></span><span class="mbin">−</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mopen">(</span><span class="mord">2</span><span class="mord">/</span><span class="mord">3</span><span class="mclose">)</span><span class="mspace"></span><span class="mbin">∗</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord mathdefault">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord">2</span><span class="mord">/</span><span class="mord">3</span><span class="mclose">)</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">9</span><span class="mord">1</span><span class="mord">8</span><span class="mord">2</span></span></span></span></span></p> 
 <p>接下来就是条件熵的计算，以性别为男的熵为例。表格中性别为男的数据有<code>8</code>条，这<code>8</code>条数据中有<code>3</code>条数据的标签为<code>1</code>，有<code>5</code>条数据的标签为<code>0</code>。所以根据条件熵的计算公式能够得出该条件熵为：</p> 
 <p class="editormd-tex"><span class="katex-display"><span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord">−</span><span class="mopen">(</span><span class="mord">3</span><span class="mord">/</span><span class="mord">8</span><span class="mclose">)</span><span class="mspace"></span><span class="mbin">∗</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord mathdefault">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord">3</span><span class="mord">/</span><span class="mord">8</span><span class="mclose">)</span><span class="mspace"></span><span class="mbin">−</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mopen">(</span><span class="mord">5</span><span class="mord">/</span><span class="mord">8</span><span class="mclose">)</span><span class="mspace"></span><span class="mbin">∗</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord mathdefault">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord">5</span><span class="mord">/</span><span class="mord">8</span><span class="mclose">)</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">9</span><span class="mord">5</span><span class="mord">4</span><span class="mord">3</span></span></span></span></span></p> 
 <p>根据上述的计算方法可知，总熵为：</p> 
 <p class="editormd-tex"><span class="katex-display"><span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord">−</span><span class="mopen">(</span><span class="mord">5</span><span class="mord">/</span><span class="mord">1</span><span class="mord">5</span><span class="mclose">)</span><span class="mspace"></span><span class="mbin">∗</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord mathdefault">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord">5</span><span class="mord">/</span><span class="mord">1</span><span class="mord">5</span><span class="mclose">)</span><span class="mspace"></span><span class="mbin">−</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">0</span><span class="mord">/</span><span class="mord">1</span><span class="mord">5</span><span class="mclose">)</span><span class="mspace"></span><span class="mbin">∗</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord mathdefault">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord">1</span><span class="mord">0</span><span class="mord">/</span><span class="mord">1</span><span class="mord">5</span><span class="mclose">)</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">9</span><span class="mord">1</span><span class="mord">8</span><span class="mord">2</span></span></span></span></span></p> 
 <p>性别为男的熵为：</p> 
 <p class="editormd-tex"><span class="katex-display"><span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord">−</span><span class="mopen">(</span><span class="mord">3</span><span class="mord">/</span><span class="mord">8</span><span class="mclose">)</span><span class="mspace"></span><span class="mbin">∗</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord mathdefault">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord">3</span><span class="mord">/</span><span class="mord">8</span><span class="mclose">)</span><span class="mspace"></span><span class="mbin">−</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mopen">(</span><span class="mord">5</span><span class="mord">/</span><span class="mord">8</span><span class="mclose">)</span><span class="mspace"></span><span class="mbin">∗</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord mathdefault">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord">5</span><span class="mord">/</span><span class="mord">8</span><span class="mclose">)</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">9</span><span class="mord">5</span><span class="mord">4</span><span class="mord">3</span></span></span></span></span></p> 
 <p>性别为女的熵为：</p> 
 <p class="editormd-tex"><span class="katex-display"><span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord">−</span><span class="mopen">(</span><span class="mord">2</span><span class="mord">/</span><span class="mord">7</span><span class="mclose">)</span><span class="mspace"></span><span class="mbin">∗</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord mathdefault">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord">2</span><span class="mord">/</span><span class="mord">7</span><span class="mclose">)</span><span class="mspace"></span><span class="mbin">−</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mopen">(</span><span class="mord">5</span><span class="mord">/</span><span class="mord">7</span><span class="mclose">)</span><span class="mspace"></span><span class="mbin">∗</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord mathdefault">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord">5</span><span class="mord">/</span><span class="mord">7</span><span class="mclose">)</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">8</span><span class="mord">6</span><span class="mord">3</span><span class="mord">1</span></span></span></span></span></p> 
 <p>活跃度为低的熵为：</p> 
 <p class="editormd-tex"><span class="katex-display"><span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord">−</span><span class="mopen">(</span><span class="mord">4</span><span class="mord">/</span><span class="mord">4</span><span class="mclose">)</span><span class="mspace"></span><span class="mbin">∗</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord mathdefault">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord">4</span><span class="mord">/</span><span class="mord">4</span><span class="mclose">)</span><span class="mspace"></span><span class="mbin">−</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">0</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">0</span></span></span></span></span></p> 
 <p>活跃度为中的熵为：</p> 
 <p class="editormd-tex"><span class="katex-display"><span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord">−</span><span class="mopen">(</span><span class="mord">1</span><span class="mord">/</span><span class="mord">5</span><span class="mclose">)</span><span class="mspace"></span><span class="mbin">∗</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord mathdefault">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord">1</span><span class="mord">/</span><span class="mord">5</span><span class="mclose">)</span><span class="mspace"></span><span class="mbin">−</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mopen">(</span><span class="mord">4</span><span class="mord">/</span><span class="mord">5</span><span class="mclose">)</span><span class="mspace"></span><span class="mbin">∗</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord mathdefault">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord">4</span><span class="mord">/</span><span class="mord">5</span><span class="mclose">)</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">7</span><span class="mord">2</span><span class="mord">1</span><span class="mord">9</span></span></span></span></span></p> 
 <p>活跃度为高的熵为：</p> 
 <p class="editormd-tex"><span class="katex-display"><span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord">−</span><span class="mord">0</span><span class="mspace"></span><span class="mbin">−</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mopen">(</span><span class="mord">6</span><span class="mord">/</span><span class="mord">6</span><span class="mclose">)</span><span class="mspace"></span><span class="mbin">∗</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord mathdefault">l</span><span class="mord mathdefault">o</span><span class="mord mathdefault">g</span><span class="mopen">(</span><span class="mord">6</span><span class="mord">/</span><span class="mord">6</span><span class="mclose">)</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">0</span></span></span></span></span></p> 
 <p>现在有了总的熵和条件熵之后就能算出性别和活跃度这两个特征的信息增益了。</p> 
 <p><strong>性别的信息增益=总的熵-(8/15)*性别为男的熵-(7/15)*性别为女的熵=0.0064</strong></p> 
 <p>*<em>活跃度的信息增益=总的熵-(6/15)<em>活跃度为高的熵-(5/15)*活跃度为中的熵-(4/15)*活跃度为低的熵=0.6776</em></em></p> 
 <p>那信息增益算出来之后有什么意义呢？回到读心术的问题，为了我能更加准确的猜出你心中所想，我肯定是问的问题越好就能猜得越准！换句话来说我肯定是要想出一个信息增益最大（<strong>减少不确定性程度最高</strong>）的问题来问你。其实<code>ID3</code>算法也是这么想的。<code>ID3</code>算法的思想是从训练集<code>D</code>中计算每个特征的信息增益，然后看哪个最大就选哪个作为当前结点。然后继续重复刚刚的步骤来构建决策树。</p> 
 <h5 id="编程要求">编程要求</h5> 
 <p>根据提示，在右侧编辑器补充代码，完成<code>calcInfoGain</code>函数实现计算信息增益。</p> 
 <p><code>calcInfoGain</code>函数中的参数:</p> 
 <ul><li><p><code>feature</code>：测试用例中字典里的<code>feature</code>，类型为<code>ndarray</code>；</p> </li><li><p><code>label</code>：测试用例中字典里的<code>label</code>，类型为<code>ndarray</code>；</p> </li><li><p><code>index</code>：测试用例中字典里的<code>index</code>，即<code>feature</code>部分特征列的索引。该索引指的是<code>feature</code>中第几个特征，如<code>index:0</code>表示使用第一个特征来计算信息增益。</p> </li></ul> 
 <h5 id="测试说明">测试说明</h5> 
 <p>平台会对你编写的代码进行测试，期望您的代码根据输入来输出正确的信息增益，以下为其中一个测试用例：</p> 
 <p>测试输入： <code>{'feature':[[0, 1], [1, 0], [1, 2], [0, 0], [1, 1]], 'label':[0, 1, 0, 0, 1], 'index': 0}</code></p> 
 <p>预期输出： <code>0.419973</code></p> 
 <p>提示： 计算<code>log</code>可以使用<code>NumPy</code>中的<code>log2</code>函数</p> 
 <hr> 
 <p>开始你的任务吧，祝你成功！</p> 
</div> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np


<span class="token keyword">def</span> <span class="token function">calcInfoGain</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    计算信息增益
    :param feature:测试用例中字典里的feature，类型为ndarray
    :param label:测试用例中字典里的label，类型为ndarray
    :param index:测试用例中字典里的index，即feature部分特征列的索引。该索引指的是feature中第几个特征，如index:0表示使用第一个特征来计算信息增益。
    :return:信息增益，类型float
    '''</span>

    <span class="token comment">#*********** Begin ***********#</span>

    <span class="token comment"># 计算熵</span>
    <span class="token keyword">def</span> <span class="token function">calcInfoEntropy</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        计算信息熵
        :param feature:数据集中的特征，类型为ndarray
        :param label:数据集中的标签，类型为ndarray
        :return:信息熵，类型float
        '''</span>

        label_set <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span>
        result <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> l <span class="token keyword">in</span> label_set<span class="token punctuation">:</span>
            count <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> label<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> l<span class="token punctuation">:</span>
                    count <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token comment"># 计算标签在数据集中出现的概率</span>
            p <span class="token operator">=</span> count <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span>
            <span class="token comment"># 计算熵</span>
            result <span class="token operator">-=</span> p <span class="token operator">*</span> np<span class="token punctuation">.</span>log2<span class="token punctuation">(</span>p<span class="token punctuation">)</span>
        <span class="token keyword">return</span> result

    <span class="token comment"># 计算条件熵</span>
    <span class="token keyword">def</span> <span class="token function">calcHDA</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> index<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        计算信息熵
        :param feature:数据集中的特征，类型为ndarray
        :param label:数据集中的标签，类型为ndarray
        :param index:需要使用的特征列索引，类型为int
        :param value:index所表示的特征列中需要考察的特征值，类型为int
        :return:信息熵，类型float
        '''</span>
        count <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token comment"># sub_feature和sub_label表示根据特征列和特征值分割出的子数据集中的特征和标签</span>
        sub_feature <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        sub_label <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> feature<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">==</span> value<span class="token punctuation">:</span>
                count <span class="token operator">+=</span> <span class="token number">1</span>
                sub_feature<span class="token punctuation">.</span>append<span class="token punctuation">(</span>feature<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                sub_label<span class="token punctuation">.</span>append<span class="token punctuation">(</span>label<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        pHA <span class="token operator">=</span> count <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
        e <span class="token operator">=</span> calcInfoEntropy<span class="token punctuation">(</span>sub_feature<span class="token punctuation">,</span> sub_label<span class="token punctuation">)</span>
        <span class="token keyword">return</span> pHA <span class="token operator">*</span> e

    base_e <span class="token operator">=</span> calcInfoEntropy<span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">)</span>
    f <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
    <span class="token comment"># 得到指定特征列的值的集合</span>
    f_set <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> index<span class="token punctuation">]</span><span class="token punctuation">)</span>
    sum_HDA <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment"># 计算条件熵</span>
    <span class="token keyword">for</span> value <span class="token keyword">in</span> f_set<span class="token punctuation">:</span>
        sum_HDA <span class="token operator">+=</span> calcHDA<span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> index<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
    <span class="token comment"># 计算信息增益</span>
    <span class="token keyword">return</span> base_e <span class="token operator">-</span> sum_HDA
    <span class="token comment">#*********** End *************#</span>
</code></pre> 
<h3><a id="3ID3_307"></a>第3关：使用ID3算法构建决策树</h3> 
<div class="tab-panel-body  markdown-body"> 
 <ul><li><a href="#%E4%BB%BB%E5%8A%A1%E6%8F%8F%E8%BF%B0" rel="nofollow">任务描述</a></li><li><a href="#%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86" rel="nofollow">相关知识</a> 
   <ul><li><a href="#id3%E7%AE%97%E6%B3%95" rel="nofollow">ID3算法</a></li><li><a href="#%E4%BD%BF%E7%94%A8%E5%86%B3%E7%AD%96%E6%A0%91%E8%BF%9B%E8%A1%8C%E9%A2%84%E6%B5%8B" rel="nofollow">使用决策树进行预测</a></li></ul></li><li><a href="#%E7%BC%96%E7%A8%8B%E8%A6%81%E6%B1%82" rel="nofollow">编程要求</a></li><li><a href="#%E6%B5%8B%E8%AF%95%E8%AF%B4%E6%98%8E" rel="nofollow">测试说明</a></li></ul> 
 <hr> 
 <h5 id="任务描述">任务描述</h5> 
 <p>本关任务：补充<code>python</code>代码，完成<code>DecisionTree</code>类中的<code>fit</code>和<code>predict</code>函数。</p> 
 <h5 id="相关知识">相关知识</h5> 
 <p>为了完成本关任务，你需要掌握：</p> 
 <ul><li><p><code>ID3</code>算法构造决策树的流程；</p> </li><li><p>如何使用构造好的决策树进行预测。</p> </li></ul> 
 <h6 id="id3算法">ID3算法</h6> 
 <p><code>ID3</code>算法其实就是依据特征的信息增益来构建树的。其大致步骤就是从根结点开始，对结点计算所有可能的特征的信息增益，然后选择信息增益<strong>最大</strong>的特征作为结点的特征，由该特征的不同取值建立子结点，然后对子结点递归执行上述的步骤直到信息增益很小或者没有特征可以继续选择为止。</p> 
 <p>因此，<code>ID3</code>算法伪代码如下：</p> 
 <pre class="prettyprint linenums prettyprinted">  
  <ol class="linenums"><li class="L0"><code class="language-python"><span class="com">#假设数据集为D，标签集为A，需要构造的决策树为tree</span></code></li><li class="L1"><code class="language-python"><span class="kwd">def</span><span class="pln"> ID3</span><span class="pun">(</span><span class="pln">D</span><span class="pun">,</span><span class="pln"> A</span><span class="pun">):</span></code></li><li class="L2"><code class="language-python"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> D</span><span class="pun">中所有的标签都相同:</span></code></li><li class="L3"><code class="language-python"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">标签</span></code></li><li class="L4"><code class="language-python"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">样本中只有一个特征或者所有样本的特征都一样:</span></code></li><li class="L5"><code class="language-python"><span class="pln">        </span><span class="pun">对</span><span class="pln">D</span><span class="pun">中所有的标签进行计数</span></code></li><li class="L6"><code class="language-python"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">计数最高的标签</span></code></li><li class="L7"><code class="language-python"></code></li><li class="L8"><code class="language-python"><span class="pln">    </span><span class="pun">计算所有特征的信息增益</span></code></li><li class="L9"><code class="language-python"><span class="pln">    </span><span class="pun">选出增益最大的特征作为最佳特征(</span><span class="pln">best_feature</span><span class="pun">)</span></code></li><li class="L0"><code class="language-python"><span class="pln">    </span><span class="pun">将</span><span class="pln">best_feature</span><span class="pun">作为</span><span class="pln">tree</span><span class="pun">的根结点</span></code></li><li class="L1"><code class="language-python"><span class="pln">    </span><span class="pun">得到</span><span class="pln">best_feature</span><span class="pun">在数据集中所有出现过的值的集合(</span><span class="pln">value_set</span><span class="pun">)</span></code></li><li class="L2"><code class="language-python"><span class="pln">    </span><span class="kwd">for</span><span class="pln"> value </span><span class="kwd">in</span><span class="pln"> value_set</span><span class="pun">:</span></code></li><li class="L3"><code class="language-python"><span class="pln">        </span><span class="pun">从</span><span class="pln">D</span><span class="pun">中筛选出</span><span class="pln">best_feature</span><span class="pun">=</span><span class="pln">value</span><span class="pun">的子数据集(</span><span class="pln">sub_feature</span><span class="pun">)</span></code></li><li class="L4"><code class="language-python"><span class="pln">        </span><span class="pun">从</span><span class="pln">A</span><span class="pun">中筛选出</span><span class="pln">best_feature</span><span class="pun">=</span><span class="pln">value</span><span class="pun">的子标签集(</span><span class="pln">sub_label</span><span class="pun">)</span></code></li><li class="L5"><code class="language-python"><span class="pln">        </span><span class="com">#递归构造tree</span></code></li><li class="L6"><code class="language-python"><span class="pln">        tree</span><span class="pun">[</span><span class="pln">best_feature</span><span class="pun">][</span><span class="pln">value</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> ID3</span><span class="pun">(</span><span class="pln">sub_feature</span><span class="pun">,</span><span class="pln"> sub_label</span><span class="pun">)</span></code></li><li class="L7"><code class="language-python"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> tree</span></code></li></ol></pre> 
 <h6 id="使用决策树进行预测">使用决策树进行预测</h6> 
 <p>决策树的预测思想非常简单，假设现在已经构建出了一棵用来决策是否买西瓜的决策树。</p> 
 <p align="center"> <img src="https://images2.imgbox.com/79/0e/IA3j1Zs2_o.jpg" alt="" height="60%" width="60%"> </p> 
</div> 
<p>并假设现在在水果店里有这样一个西瓜，其属性如下：</p> 
<table><thead><tr><th>瓤是否够红</th><th>够不够冰</th><th>是否便宜</th><th>是否有籽</th></tr></thead><tbody><tr><td>是</td><td>否</td><td>是</td><td>否</td></tr></tbody></table> 
<p>那买不买这个西瓜呢？只需把西瓜的属性代入决策树即可。决策树的根结点是<code>瓤是否够红</code>，所以就看西瓜的属性，经查看发现够红，因此接下来就看<code>够不够冰</code>。而西瓜不够冰，那么看<code>是否便宜</code>。发现西瓜是便宜的，所以这个西瓜是可以买的。</p> 
<p>因此使用决策树进行预测的伪代码也比较简单，伪代码如下：</p> 
<pre class="prettyprint linenums prettyprinted"> 
 <ol class="linenums"><li class="L0"><code class="language-python"><span class="com">#tree表示决策树，feature表示测试数据</span></code></li><li class="L1"><code class="language-python"><span class="kwd">def</span><span class="pln"> predict</span><span class="pun">(</span><span class="pln">tree</span><span class="pun">,</span><span class="pln"> feature</span><span class="pun">):</span></code></li><li class="L2"><code class="language-python"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> tree</span><span class="pun">是叶子结点:</span></code></li><li class="L3"><code class="language-python"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> tree</span></code></li><li class="L4"><code class="language-python"><span class="pln">    </span><span class="pun">根据</span><span class="pln">feature</span><span class="pun">中的特征值走入</span><span class="pln">tree</span><span class="pun">中对应的分支</span></code></li><li class="L5"><code class="language-python"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">分支依然是课树:</span></code></li><li class="L6"><code class="language-python"><span class="pln">        result </span><span class="pun">=</span><span class="pln"> predict</span><span class="pun">(分支,</span><span class="pln"> feature</span><span class="pun">)</span></code></li><li class="L7"><code class="language-python"><span class="pln">    </span><span class="kwd">return</span><span class="pln"> result</span></code></li></ol></pre> 
<h5 id="编程要求">编程要求</h5> 
<p>填写<code>fit(self, feature, label)</code>函数，实现<code>ID3</code>算法，要求决策树保存在<code>self.tree</code>中。其中：</p> 
<ul><li><p><code>feature</code>：训练集数据，类型为<code>ndarray</code>，数值全为整数；</p> </li><li><p><code>label</code>：训练集标签，类型为<code>ndarray</code>，数值全为整数。</p> </li></ul> 
<p>填写<code>predict(self, feature)</code>函数，实现预测功能，并将标签返回，其中：</p> 
<ul><li><code>feature</code>：测试集数据，类型为<code>ndarray</code>，数值全为整数。<strong>（PS：feature中有多条数据）</strong></li></ul> 
<h5 id="测试说明">测试说明</h5> 
<p>只需完成<code>fit</code>与<code>predict</code>函数即可，程序内部会调用您所完成的<code>fit</code>函数构建模型并调用<code>predict</code>函数来对数据进行预测。预测的准确率高于<code>0.92</code>视为过关。(PS:若<code>self.tree is None</code>则会打印<strong>决策树构建失败</strong>)</p> 
<hr> 
<p>开始你的任务吧，祝你成功！</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">class</span> <span class="token class-name">DecisionTree</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#决策树模型</span>
        self<span class="token punctuation">.</span>tree <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token keyword">def</span> <span class="token function">calcInfoGain</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        计算信息增益
        :param feature:测试用例中字典里的feature，类型为ndarray
        :param label:测试用例中字典里的label，类型为ndarray
        :param index:测试用例中字典里的index，即feature部分特征列的索引。该索引指的是feature中第几个特征，如index:0表示使用第一个特征来计算信息增益。
        :return:信息增益，类型float
        '''</span>
        <span class="token comment"># 计算熵</span>
        <span class="token keyword">def</span> <span class="token function">calcInfoEntropy</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">'''
            计算信息熵
            :param label:数据集中的标签，类型为ndarray
            :return:信息熵，类型float
            '''</span>
            label_set <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span>
            result <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">for</span> l <span class="token keyword">in</span> label_set<span class="token punctuation">:</span>
                count <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> label<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> l<span class="token punctuation">:</span>
                        count <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token comment"># 计算标签在数据集中出现的概率</span>
                p <span class="token operator">=</span> count <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span>
                <span class="token comment"># 计算熵</span>
                result <span class="token operator">-=</span> p <span class="token operator">*</span> np<span class="token punctuation">.</span>log2<span class="token punctuation">(</span>p<span class="token punctuation">)</span>
            <span class="token keyword">return</span> result
        <span class="token comment"># 计算条件熵</span>
        <span class="token keyword">def</span> <span class="token function">calcHDA</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> index<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">'''
            计算信息熵
            :param feature:数据集中的特征，类型为ndarray
            :param label:数据集中的标签，类型为ndarray
            :param index:需要使用的特征列索引，类型为int
            :param value:index所表示的特征列中需要考察的特征值，类型为int
            :return:信息熵，类型float
            '''</span>
            count <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token comment"># sub_feature和sub_label表示根据特征列和特征值分割出的子数据集中的特征和标签</span>
            sub_feature <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            sub_label <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> feature<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">==</span> value<span class="token punctuation">:</span>
                    count <span class="token operator">+=</span> <span class="token number">1</span>
                    sub_feature<span class="token punctuation">.</span>append<span class="token punctuation">(</span>feature<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                    sub_label<span class="token punctuation">.</span>append<span class="token punctuation">(</span>label<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
            pHA <span class="token operator">=</span> count <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
            e <span class="token operator">=</span> calcInfoEntropy<span class="token punctuation">(</span>sub_label<span class="token punctuation">)</span>
            <span class="token keyword">return</span> pHA <span class="token operator">*</span> e
        base_e <span class="token operator">=</span> calcInfoEntropy<span class="token punctuation">(</span>label<span class="token punctuation">)</span>
        f <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
        <span class="token comment"># 得到指定特征列的值的集合</span>
        f_set <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> index<span class="token punctuation">]</span><span class="token punctuation">)</span>
        sum_HDA <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token comment"># 计算条件熵</span>
        <span class="token keyword">for</span> value <span class="token keyword">in</span> f_set<span class="token punctuation">:</span>
            sum_HDA <span class="token operator">+=</span> calcHDA<span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> index<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
        <span class="token comment"># 计算信息增益</span>
        <span class="token keyword">return</span> base_e <span class="token operator">-</span> sum_HDA
    <span class="token comment"># 获得信息增益最高的特征</span>
    <span class="token keyword">def</span> <span class="token function">getBestFeature</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> feature<span class="token punctuation">,</span> label<span class="token punctuation">)</span><span class="token punctuation">:</span>
        max_infogain <span class="token operator">=</span> <span class="token number">0</span>
        best_feature <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>feature<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            infogain <span class="token operator">=</span> self<span class="token punctuation">.</span>calcInfoGain<span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
            <span class="token keyword">if</span> infogain <span class="token operator">&gt;</span> max_infogain<span class="token punctuation">:</span>
                max_infogain <span class="token operator">=</span> infogain
                best_feature <span class="token operator">=</span> i
        <span class="token keyword">return</span> best_feature
    <span class="token keyword">def</span> <span class="token function">createTree</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> feature<span class="token punctuation">,</span> label<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 样本里都是同一个label没必要继续分叉了</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> label<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token comment"># 样本中只有一个特征或者所有样本的特征都一样的话就看哪个label的票数高</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>feature<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">or</span> <span class="token builtin">len</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>unique<span class="token punctuation">(</span>feature<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            vote <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
            <span class="token keyword">for</span> l <span class="token keyword">in</span> label<span class="token punctuation">:</span>
                <span class="token keyword">if</span> l <span class="token keyword">in</span> vote<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    vote<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    vote<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
            max_count <span class="token operator">=</span> <span class="token number">0</span>
            vote_label <span class="token operator">=</span> <span class="token boolean">None</span>
            <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> vote<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> v <span class="token operator">&gt;</span> max_count<span class="token punctuation">:</span>
                    max_count <span class="token operator">=</span> v
                    vote_label <span class="token operator">=</span> k
            <span class="token keyword">return</span> vote_label
        <span class="token comment"># 根据信息增益拿到特征的索引</span>
        best_feature <span class="token operator">=</span> self<span class="token punctuation">.</span>getBestFeature<span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">)</span>
        tree <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>best_feature<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">}</span>
        f <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
        <span class="token comment"># 拿到bestfeature的所有特征值</span>
        f_set <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> best_feature<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment"># 构建对应特征值的子样本集sub_feature, sub_label</span>
        <span class="token keyword">for</span> v <span class="token keyword">in</span> f_set<span class="token punctuation">:</span>
            sub_feature <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            sub_label <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> feature<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>best_feature<span class="token punctuation">]</span> <span class="token operator">==</span> v<span class="token punctuation">:</span>
                    sub_feature<span class="token punctuation">.</span>append<span class="token punctuation">(</span>feature<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                    sub_label<span class="token punctuation">.</span>append<span class="token punctuation">(</span>label<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token comment"># 递归构建决策树</span>
            tree<span class="token punctuation">[</span>best_feature<span class="token punctuation">]</span><span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>createTree<span class="token punctuation">(</span>sub_feature<span class="token punctuation">,</span> sub_label<span class="token punctuation">)</span>
        <span class="token keyword">return</span> tree
    <span class="token keyword">def</span> <span class="token function">fit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> feature<span class="token punctuation">,</span> label<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        :param feature: 训练集数据，类型为ndarray
        :param label:训练集标签，类型为ndarray
        :return: None
        '''</span>
        <span class="token comment">#************* Begin ************#</span>
        self<span class="token punctuation">.</span>tree <span class="token operator">=</span> self<span class="token punctuation">.</span>createTree<span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">)</span>
        <span class="token comment">#************* End **************#</span>
    <span class="token keyword">def</span> <span class="token function">predict</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> feature<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        :param feature:测试集数据，类型为ndarray
        :return:预测结果，如np.array([0, 1, 2, 2, 1, 0])
        '''</span>
        <span class="token comment">#************* Begin ************#</span>
        result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">def</span> <span class="token function">classify</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> feature<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> tree
            t_index<span class="token punctuation">,</span> t_value <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>tree<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            f_value <span class="token operator">=</span> feature<span class="token punctuation">[</span>t_index<span class="token punctuation">]</span>
            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>t_value<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                classLabel <span class="token operator">=</span> classify<span class="token punctuation">(</span>tree<span class="token punctuation">[</span>t_index<span class="token punctuation">]</span><span class="token punctuation">[</span>f_value<span class="token punctuation">]</span><span class="token punctuation">,</span> feature<span class="token punctuation">)</span>
                <span class="token keyword">return</span> classLabel
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> t_value
        <span class="token keyword">for</span> f <span class="token keyword">in</span> feature<span class="token punctuation">:</span>
            result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>classify<span class="token punctuation">(</span>self<span class="token punctuation">.</span>tree<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        <span class="token comment">#************* End **************#</span>
</code></pre> 
<h3><a id="4_508"></a>第4关：信息增益率</h3> 
<div class="tab-panel-body  markdown-body"> 
 <ul><li><a href="#%E4%BB%BB%E5%8A%A1%E6%8F%8F%E8%BF%B0" rel="nofollow">任务描述</a></li><li><a href="#%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86" rel="nofollow">相关知识</a> 
   <ul><li><a href="#%E4%BF%A1%E6%81%AF%E5%A2%9E%E7%9B%8A%E7%8E%87" rel="nofollow">信息增益率</a></li></ul></li><li><a href="#%E7%BC%96%E7%A8%8B%E8%A6%81%E6%B1%82" rel="nofollow">编程要求</a></li><li><a href="#%E6%B5%8B%E8%AF%95%E8%AF%B4%E6%98%8E" rel="nofollow">测试说明</a></li></ul> 
 <hr> 
 <h5 id="任务描述">任务描述</h5> 
 <p>本关任务：根据本关所学知识，完成<code>calcInfoGainRatio</code>函数。</p> 
 <h5 id="相关知识">相关知识</h5> 
 <p>为了完成本关任务，你需要掌握：信息增益率</p> 
 <h6 id="信息增益率">信息增益率</h6> 
 <p>由于在使用信息增益这一指标进行划分时，更喜欢可取值数量较多的特征。为了减少这种<strong>偏好</strong>可能带来的不利影响，<code>Ross Quinlan</code>使用了<strong>信息增益率</strong>这一指标来选择最优划分属性。</p> 
 <p>信息增益率的数学定义为如下，其中<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">D</span></span></span></span>表示数据集，<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">a</span></span></span></span>表示数据集中的某一列，<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">G</span><span class="mord mathdefault">a</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mopen">(</span><span class="mord mathdefault">D</span><span class="mpunct">,</span><span class="mspace"></span><span class="mord mathdefault">a</span><span class="mclose">)</span></span></span></span>表示<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">D</span></span></span></span>中<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">a</span></span></span></span>的信息增益，<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">V</span></span></span></span>表示<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">a</span></span></span></span>这一列中取值的集合，<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">v</span></span></span></span>表示<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">V</span></span></span></span>中的某种取值，<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord">∣</span><span class="mord mathdefault">D</span><span class="mord">∣</span></span></span></span>表示<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">D</span></span></span></span>中样本的数量，<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">v</span></span></span></span></span></span></span><span class="mord">∣</span></span></span></span>表示<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">D</span></span></span></span>中<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">a</span></span></span></span>这一列中值等于<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">v</span></span></span></span>的数量。</p> 
 <p class="editormd-tex"><span class="katex-display"><span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">G</span><span class="mord mathdefault">a</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord">_</span><span class="mord mathdefault">r</span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord mathdefault">D</span><span class="mpunct">,</span><span class="mspace"></span><span class="mord mathdefault">a</span><span class="mclose">)</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="mord"><span class="mord">−</span><span class="mspace"></span><span class="mop op-limits"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">v</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span><span class="pstrut"></span><span class="mop op-symbol small-op">∑</span><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">V</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span><span class="mspace"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mathdefault mtight">D</span><span class="mord mtight">∣</span></span></span><span class="pstrut"></span><span class="frac-line"></span><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mtight"><span class="mord mathdefault mtight">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">v</span></span></span></span></span></span></span><span class="mord mtight">∣</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathdefault">l</span><span class="mord mathdefault">o</span><span class="mord"><span class="mord mathdefault">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mathdefault mtight">D</span><span class="mord mtight">∣</span></span></span><span class="pstrut"></span><span class="frac-line"></span><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mtight"><span class="mord mathdefault mtight">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathdefault mtight">v</span></span></span></span></span></span></span><span class="mord mtight">∣</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span><span class="mclose nulldelimiter"></span></span></span><span class="pstrut"></span><span class="frac-line"></span><span class="pstrut"></span><span class="mord"><span class="mord mathdefault">G</span><span class="mord mathdefault">a</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mopen">(</span><span class="mord mathdefault">D</span><span class="mpunct">,</span><span class="mspace"></span><span class="mord mathdefault">a</span><span class="mclose">)</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p> 
 <p>从公式可以看出，信息增益率很好算，只是用信息增益除以另一个分母，该分母通常称为<strong>固有值</strong>。举个例子，还是使用<strong>第二关</strong>中提到过的数据集，第一列是编号，第二列是性别，第三列是活跃度，第四列是客户是否流失的标签（<code>0</code>表示未流失，<code>1</code>表示流失）。</p> 
 <table><thead><tr><th>编号</th><th>性别</th><th>活跃度</th><th>是否流失</th></tr></thead><tbody><tr><td>1</td><td>男</td><td>高</td><td>0</td></tr><tr><td>2</td><td>女</td><td>中</td><td>0</td></tr><tr><td>3</td><td>男</td><td>低</td><td>1</td></tr><tr><td>4</td><td>女</td><td>高</td><td>0</td></tr><tr><td>5</td><td>男</td><td>高</td><td>0</td></tr><tr><td>6</td><td>男</td><td>中</td><td>0</td></tr><tr><td>7</td><td>男</td><td>中</td><td>1</td></tr><tr><td>8</td><td>女</td><td>中</td><td>0</td></tr><tr><td>9</td><td>女</td><td>低</td><td>1</td></tr><tr><td>10</td><td>女</td><td>中</td><td>0</td></tr><tr><td>11</td><td>女</td><td>高</td><td>0</td></tr><tr><td>12</td><td>男</td><td>低</td><td>1</td></tr><tr><td>13</td><td>女</td><td>低</td><td>1</td></tr><tr><td>14</td><td>男</td><td>高</td><td>0</td></tr><tr><td>15</td><td>男</td><td>高</td><td>0</td></tr></tbody></table> 
 <p>根据<strong>第二关</strong>已经知道性别的信息增益为<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">0</span><span class="mord">6</span><span class="mord">4</span></span></span></span>，设<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">a</span></span></span></span>为性别，则有<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">G</span><span class="mord mathdefault">a</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mopen">(</span><span class="mord mathdefault">D</span><span class="mpunct">,</span><span class="mspace"></span><span class="mord mathdefault">a</span><span class="mclose">)</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">0</span><span class="mord">6</span><span class="mord">4</span></span></span></span>。由根据数据可知，<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">V</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">2</span></span></span></span>，假设当<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">v</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">1</span></span></span></span>时表示性别为男，<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">v</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">2</span></span></span></span>时表示性别为女，则有<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord">∣</span><span class="mord mathdefault">D</span><span class="mord">∣</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">1</span><span class="mord">5</span></span></span></span>，<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">8</span></span></span></span>，<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">7</span></span></span></span>。因此根据信息增益率的计算公式可知<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">G</span><span class="mord mathdefault">a</span><span class="mord mathdefault">i</span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">r</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span><span class="mord mathdefault">a</span><span class="mord mathdefault">t</span><span class="mord mathdefault">i</span><span class="mord mathdefault">o</span><span class="mopen">(</span><span class="mord mathdefault">D</span><span class="mpunct">,</span><span class="mspace"></span><span class="mord mathdefault">a</span><span class="mclose">)</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">0</span><span class="mord">6</span><span class="mord">4</span><span class="mord">2</span></span></span></span>。同理可以算出活跃度的信息增益率为<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">4</span><span class="mord">3</span><span class="mord">2</span><span class="mord">8</span></span></span></span>。</p> 
 <h5 id="编程要求">编程要求</h5> 
 <p>根据提示，在右侧编辑器补充代码，完成<code>calcInfoGainRatio</code>函数实现计算信息增益。</p> 
 <p><code>calcInfoGainRatio</code>函数中的参数:</p> 
 <ul><li><p><code>feature</code>：测试用例中字典里的<code>feature</code>，类型为<code>ndarray</code>；</p> </li><li><p><code>label</code>：测试用例中字典里的<code>label</code>，类型为<code>ndarray</code>；</p> </li><li><p><code>index</code>：测试用例中字典里的<code>index</code>，即<code>feature</code>部分特征列的索引。该索引指的是<code>feature</code>中第几个特征，如<code>index:0</code>表示使用第一个特征来计算信息增益率。</p> </li></ul> 
 <h5 id="测试说明">测试说明</h5> 
 <p>平台会对你编写的代码进行测试，期望您的代码根据输入来输出正确的信息增益，以下为其中一个测试用例：</p> 
 <p>测试输入： <code>{'feature':[[0, 1], [1, 0], [1, 2], [0, 0], [1, 1]], 'label':[0, 1, 0, 0, 1], 'index': 0}</code></p> 
 <p>预期输出： <code>0.432538</code></p> 
 <p>提示： 计算<code>log</code>可以使用<code>NumPy</code>中的<code>log2</code>函数</p> 
 <hr> 
 <p>开始你的任务吧，祝你成功！</p> 
</div> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token keyword">def</span> <span class="token function">calcInfoGain</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    计算信息增益
    :param feature:测试用例中字典里的feature，类型为ndarray
    :param label:测试用例中字典里的label，类型为ndarray
    :param index:测试用例中字典里的index，即feature部分特征列的索引。该索引指的是feature中第几个特征，如index:0表示使用第一个特征来计算信息增益。
    :return:信息增益，类型float
    '''</span>
    <span class="token comment"># 计算熵</span>
    <span class="token keyword">def</span> <span class="token function">calcInfoEntropy</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        计算信息熵
        :param label:数据集中的标签，类型为ndarray
        :return:信息熵，类型float
        '''</span>

        label_set <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span>
        result <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> l <span class="token keyword">in</span> label_set<span class="token punctuation">:</span>
            count <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> label<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> l<span class="token punctuation">:</span>
                    count <span class="token operator">+=</span> <span class="token number">1</span>
            <span class="token comment"># 计算标签在数据集中出现的概率</span>
            p <span class="token operator">=</span> count <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span>
            <span class="token comment"># 计算熵</span>
            result <span class="token operator">-=</span> p <span class="token operator">*</span> np<span class="token punctuation">.</span>log2<span class="token punctuation">(</span>p<span class="token punctuation">)</span>
        <span class="token keyword">return</span> result

    <span class="token comment"># 计算条件熵</span>
    <span class="token keyword">def</span> <span class="token function">calcHDA</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> index<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        计算信息熵
        :param feature:数据集中的特征，类型为ndarray
        :param label:数据集中的标签，类型为ndarray
        :param index:需要使用的特征列索引，类型为int
        :param value:index所表示的特征列中需要考察的特征值，类型为int
        :return:信息熵，类型float
        '''</span>
        count <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token comment"># sub_feature和sub_label表示根据特征列和特征值分割出的子数据集中的特征和标签</span>
        sub_feature <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        sub_label <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> feature<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">==</span> value<span class="token punctuation">:</span>
                count <span class="token operator">+=</span> <span class="token number">1</span>
                sub_feature<span class="token punctuation">.</span>append<span class="token punctuation">(</span>feature<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                sub_label<span class="token punctuation">.</span>append<span class="token punctuation">(</span>label<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        pHA <span class="token operator">=</span> count <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
        e <span class="token operator">=</span> calcInfoEntropy<span class="token punctuation">(</span>sub_label<span class="token punctuation">)</span>
        <span class="token keyword">return</span> pHA <span class="token operator">*</span> e

    base_e <span class="token operator">=</span> calcInfoEntropy<span class="token punctuation">(</span>label<span class="token punctuation">)</span>
    f <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
    <span class="token comment"># 得到指定特征列的值的集合</span>
    f_set <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> index<span class="token punctuation">]</span><span class="token punctuation">)</span>
    sum_HDA <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token comment"># 计算条件熵</span>
    <span class="token keyword">for</span> value <span class="token keyword">in</span> f_set<span class="token punctuation">:</span>
        sum_HDA <span class="token operator">+=</span> calcHDA<span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> index<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
    <span class="token comment"># 计算信息增益</span>
    <span class="token keyword">return</span> base_e <span class="token operator">-</span> sum_HDA



<span class="token keyword">def</span> <span class="token function">calcInfoGainRatio</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    计算信息增益率
    :param feature:测试用例中字典里的feature，类型为ndarray
    :param label:测试用例中字典里的label，类型为ndarray
    :param index:测试用例中字典里的index，即feature部分特征列的索引。该索引指的是feature中第几个特征，如index:0表示使用第一个特征来计算信息增益。
    :return:信息增益率，类型float
    '''</span>

    <span class="token comment">#********* Begin *********#</span>
    info_gain <span class="token operator">=</span> calcInfoGain<span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> index<span class="token punctuation">)</span>
    unique_value <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>feature<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    IV <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> value <span class="token keyword">in</span> unique_value<span class="token punctuation">:</span>
        len_v <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>feature<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> index<span class="token punctuation">]</span> <span class="token operator">==</span> value<span class="token punctuation">)</span>
        IV <span class="token operator">-=</span> <span class="token punctuation">(</span>len_v<span class="token operator">/</span><span class="token builtin">len</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span>np<span class="token punctuation">.</span>log2<span class="token punctuation">(</span><span class="token punctuation">(</span>len_v<span class="token operator">/</span><span class="token builtin">len</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> info_gain<span class="token operator">/</span>IV
    <span class="token comment">#********* End *********#</span>
</code></pre> 
<h3><a id="5_728"></a>第5关：基尼系数</h3> 
<div class="tab-panel-body  markdown-body"> 
 <ul><li><a href="#%E4%BB%BB%E5%8A%A1%E6%8F%8F%E8%BF%B0" rel="nofollow">任务描述</a></li><li><a href="#%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86" rel="nofollow">相关知识</a> 
   <ul><li><a href="#%E5%9F%BA%E5%B0%BC%E7%B3%BB%E6%95%B0" rel="nofollow">基尼系数</a></li></ul></li><li><a href="#%E7%BC%96%E7%A8%8B%E8%A6%81%E6%B1%82" rel="nofollow">编程要求</a></li><li><a href="#%E6%B5%8B%E8%AF%95%E8%AF%B4%E6%98%8E" rel="nofollow">测试说明</a></li></ul> 
 <hr> 
 <h5 id="任务描述">任务描述</h5> 
 <p>本关任务：根据本关所学知识，完成<code>calcGini</code>函数。</p> 
 <h5 id="相关知识">相关知识</h5> 
 <p>为了完成本关任务，你需要掌握：基尼系数。</p> 
 <h6 id="基尼系数">基尼系数</h6> 
 <p>在<code>ID3</code>算法中我们使用了信息增益来选择特征，信息增益大的优先选择。在<code>C4.5</code>算法中，采用了信息增益率来选择特征，以减少信息增益容易选择特征值多的特征的问题。但是无论是<code>ID3</code>还是<code>C4.5</code>,都是基于信息论的熵模型的，这里面会涉及大量的对数运算。能不能简化模型同时也不至于完全丢失熵模型的优点呢？当然有！那就是<strong>基尼系数</strong>！</p> 
 <p><code>CART</code>算法使用<strong>基尼系数</strong>来代替信息增益率，基尼系数代表了模型的不纯度，基尼系数越小，则不纯度越低，特征越好。这和信息增益与信息增益率是相反的(它们都是越大越好)。</p> 
 <p>基尼系数的数学定义为如下，其中<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">D</span></span></span></span>表示数据集，<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">k</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span></span></span></span>表示<code>D</code>中第<code>k</code>个类别在<code>D</code>中所占比例。</p> 
 <p class="editormd-tex"><span class="katex-display"><span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">G</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">i</span><span class="mopen">(</span><span class="mord mathdefault">D</span><span class="mclose">)</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">1</span><span class="mspace"></span><span class="mbin">−</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">u</span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">k</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">∣</span><span class="mord mathdefault mtight">y</span><span class="mord mtight">∣</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">k</span></span><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span></span></span></span></span></p> 
 <p>从公式可以看出，相比于信息增益和信息增益率，计算起来更加简单。举个例子，还是使用<strong>第二关</strong>中提到过的数据集，第一列是编号，第二列是性别，第三列是活跃度，第四列是客户是否流失的标签（<code>0</code>表示未流失，<code>1</code>表示流失）。</p> 
 <table><thead><tr><th>编号</th><th>性别</th><th>活跃度</th><th>是否流失</th></tr></thead><tbody><tr><td>1</td><td>男</td><td>高</td><td>0</td></tr><tr><td>2</td><td>女</td><td>中</td><td>0</td></tr><tr><td>3</td><td>男</td><td>低</td><td>1</td></tr><tr><td>4</td><td>女</td><td>高</td><td>0</td></tr><tr><td>5</td><td>男</td><td>高</td><td>0</td></tr><tr><td>6</td><td>男</td><td>中</td><td>0</td></tr><tr><td>7</td><td>男</td><td>中</td><td>1</td></tr><tr><td>8</td><td>女</td><td>中</td><td>0</td></tr><tr><td>9</td><td>女</td><td>低</td><td>1</td></tr><tr><td>10</td><td>女</td><td>中</td><td>0</td></tr><tr><td>11</td><td>女</td><td>高</td><td>0</td></tr><tr><td>12</td><td>男</td><td>低</td><td>1</td></tr><tr><td>13</td><td>女</td><td>低</td><td>1</td></tr><tr><td>14</td><td>男</td><td>高</td><td>0</td></tr><tr><td>15</td><td>男</td><td>高</td><td>0</td></tr></tbody></table> 
 <p>从表格可以看出，<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">D</span></span></span></span>中总共有<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord">2</span></span></span></span>个类别，设类别为<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord">0</span></span></span></span>的比例为<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span></span></span></span>，则有<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">5</span></span></span><span class="pstrut"></span><span class="frac-line"></span><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。设类别为<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord">1</span></span></span></span>的比例为<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span></span></span></span>，则有<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">5</span></span></span><span class="pstrut"></span><span class="frac-line"></span><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span>。根据基尼系数的公式可知<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">G</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">i</span><span class="mopen">(</span><span class="mord mathdefault">D</span><span class="mclose">)</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">1</span><span class="mspace"></span><span class="mbin">−</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span><span class="mspace"></span><span class="mbin">+</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord"><span class="mord mathdefault">p</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span><span class="mclose">)</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">4</span><span class="mord">4</span><span class="mord">4</span><span class="mord">4</span></span></span></span>。</p> 
 <p>上面是基于数据集<code>D</code>的基尼系数的计算方法，那么基于数据集<code>D</code>与特征<code>a</code>的基尼系数怎样计算呢？其实和信息增益率的套路差不多。计算公式如下：</p> 
 <p class="editormd-tex"><span class="katex-display"><span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">G</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">i</span><span class="mopen">(</span><span class="mord mathdefault">D</span><span class="mpunct">,</span><span class="mspace"></span><span class="mord mathdefault">a</span><span class="mclose">)</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord mathdefault">s</span><span class="mord mathdefault">u</span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">v</span><span class="mrel mtight">=</span><span class="mord mtight">1</span></span></span><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">V</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="mord"><span class="mord">∣</span><span class="mord mathdefault">D</span><span class="mord">∣</span></span><span class="pstrut"></span><span class="frac-line"></span><span class="pstrut"></span><span class="mord"><span class="mord">∣</span><span class="mord"><span class="mord mathdefault">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">v</span></span></span></span></span></span></span><span class="mord">∣</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist"></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mord mathdefault">G</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">i</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">v</span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></span></p> 
 <p>还是以用户流失的数据为例，现在算一算性别的基尼系数。设性别男为<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">v</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">1</span></span></span></span>，性别女为<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">v</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">2</span></span></span></span>则有<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord">∣</span><span class="mord mathdefault">D</span><span class="mord">∣</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">1</span><span class="mord">5</span></span></span></span>，<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">8</span></span></span></span>，<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord">∣</span><span class="mord"><span class="mord mathdefault">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span><span class="mord">∣</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">7</span></span></span></span>，<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">G</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">i</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">4</span><span class="mord">6</span><span class="mord">8</span><span class="mord">7</span><span class="mord">5</span></span></span></span>，<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">G</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">i</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">D</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist"><span class="pstrut"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">4</span><span class="mord">0</span><span class="mord">8</span><span class="mord">1</span><span class="mord">6</span></span></span></span>。所以<span class="katex"><span class="katex-html"><span class="base"><span class="strut"></span><span class="mord mathdefault">G</span><span class="mord mathdefault">i</span><span class="mord mathdefault">n</span><span class="mord mathdefault">i</span><span class="mopen">(</span><span class="mord mathdefault">D</span><span class="mpunct">,</span><span class="mspace"></span><span class="mord mathdefault">a</span><span class="mclose">)</span><span class="mspace"></span><span class="mrel">=</span><span class="mspace"></span></span><span class="base"><span class="strut"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">4</span><span class="mord">4</span><span class="mord">0</span><span class="mord">4</span><span class="mord">8</span></span></span></span>。</p> 
 <h5 id="编程要求">编程要求</h5> 
 <p>根据提示，在右侧编辑器补充代码，完成<code>calcGini</code>函数实现计算信息增益。</p> 
 <p><code>calcGini</code>函数中的参数:</p> 
 <ul><li><p><code>feature</code>：测试用例中字典里的<code>feature</code>，类型为<code>ndarray</code>；</p> </li><li><p><code>label</code>：测试用例中字典里的<code>label</code>，类型为<code>ndarray</code>；</p> </li><li><p><code>index</code>：测试用例中字典里的<code>index</code>，即<code>feature</code>部分特征列的索引。该索引指的是<code>feature</code>中第几个特征，如<code>index:0</code>表示使用第一个特征来计算基尼系数。</p> </li></ul> 
 <h5 id="测试说明">测试说明</h5> 
 <p>平台会对你编写的代码进行测试，期望您的代码根据输入来输出正确的信息增益，以下为其中一个测试用例：</p> 
 <p>测试输入： <code>{'feature':[[0, 1], [1, 0], [1, 2], [0, 0], [1, 1]], 'label':[0, 1, 0, 0, 1], 'index': 0}</code></p> 
 <p>预期输出： <code>0.266667</code></p> 
 <hr> 
 <p>开始你的任务吧，祝你成功！</p> 
</div> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">def</span> <span class="token function">calcGini</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    计算基尼系数
    :param feature:测试用例中字典里的feature，类型为ndarray
    :param label:测试用例中字典里的label，类型为ndarray
    :param index:测试用例中字典里的index，即feature部分特征列的索引。该索引指的是feature中第几个特征，如index:0表示使用第一个特征来计算信息增益。
    :return:基尼系数，类型float
    '''</span>
    <span class="token comment">#********* Begin *********#</span>
    <span class="token keyword">def</span> <span class="token function">_gini</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">:</span>
        unique_label <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">)</span>
        gini <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token keyword">for</span> l <span class="token keyword">in</span> unique_label<span class="token punctuation">:</span>
            p <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>label <span class="token operator">==</span> l<span class="token punctuation">)</span><span class="token operator">/</span><span class="token builtin">len</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span>
            gini <span class="token operator">-=</span> p<span class="token operator">**</span><span class="token number">2</span>
        <span class="token keyword">return</span> gini
    unique_value <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>feature<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    gini <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> value <span class="token keyword">in</span> unique_value<span class="token punctuation">:</span>
        len_v <span class="token operator">=</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>feature<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> index<span class="token punctuation">]</span> <span class="token operator">==</span> value<span class="token punctuation">)</span>
        gini <span class="token operator">+=</span> <span class="token punctuation">(</span>len_v<span class="token operator">/</span><span class="token builtin">len</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">*</span>_gini<span class="token punctuation">(</span>label<span class="token punctuation">[</span>feature<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> index<span class="token punctuation">]</span> <span class="token operator">==</span> value<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> gini
    <span class="token comment">#********* End *********#</span>
</code></pre> 
<h3><a id="6_889"></a>第6关：预剪枝与后剪枝</h3> 
<div class="tab-panel-body  markdown-body"> 
 <ul><li><a href="#%E4%BB%BB%E5%8A%A1%E6%8F%8F%E8%BF%B0" rel="nofollow">任务描述</a></li><li><a href="#%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86" rel="nofollow">相关知识</a> 
   <ul><li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%89%AA%E6%9E%9D" rel="nofollow">为什么需要剪枝</a></li><li><a href="#%E9%A2%84%E5%89%AA%E6%9E%9D" rel="nofollow">预剪枝</a></li><li><a href="#%E5%90%8E%E5%89%AA%E6%9E%9D" rel="nofollow">后剪枝</a></li></ul></li><li><a href="#%E7%BC%96%E7%A8%8B%E8%A6%81%E6%B1%82" rel="nofollow">编程要求</a></li><li><a href="#%E6%B5%8B%E8%AF%95%E8%AF%B4%E6%98%8E" rel="nofollow">测试说明</a></li></ul> 
 <hr> 
 <h5 id="任务描述">任务描述</h5> 
 <p>本关任务：补充<code>python</code>代码，完成<code>DecisionTree</code>类中的<code>fit</code>和<code>predict</code>函数。</p> 
 <h5 id="相关知识">相关知识</h5> 
 <p>为了完成本关任务，你需要掌握：</p> 
 <ul><li><p>为什么需要剪枝；</p> </li><li><p>预剪枝；</p> </li><li><p>后剪枝。</p> </li></ul> 
 <h6 id="为什么需要剪枝">为什么需要剪枝</h6> 
 <p>决策树的生成是递归地去构建决策树，直到不能继续下去为止。这样产生的树往往对训练数据有很高的分类准确率，但对未知的测试数据进行预测就没有那么准确了，也就是所谓的过拟合。</p> 
 <p>决策树容易过拟合的原因是在构建决策树的过程时会过多地考虑如何提高对训练集中的数据的分类准确率，从而会构建出非常复杂的决策树（树的宽度和深度都比较大）。在之前的实训中已经提到过，<strong>模型的复杂度越高，模型就越容易出现过拟合的现象。</strong>所以简化决策树的复杂度能够有效地缓解过拟合现象，而简化决策树最常用的方法就是剪枝。剪枝分为预剪枝与后剪枝。</p> 
 <h6 id="预剪枝">预剪枝</h6> 
 <p>预剪枝的核心思想是在决策树生成过程中，对每个结点在划分前先进行一个评估，若当前结点的划分不能带来决策树泛化性能提升，则停止划分并将当前结点标记为叶结点。</p> 
 <p>想要评估决策树算法的泛化性能如何，方法很简单。可以将训练数据集中随机取出一部分作为验证数据集，然后在用训练数据集对每个结点进行划分之前用当前状态的决策树计算出在验证数据集上的正确率。正确率越高说明决策树的泛化性能越好，如果在划分结点的时候发现泛化性能有所下降或者没有提升时，说明应该停止划分，并用投票计数的方式将当前结点标记成叶子结点。</p> 
 <p>举个例子，假如上一关中所提到的用来决定是否买西瓜的决策树模型已经出现过拟合的情况，模型如下：</p> 
 <p align="center"> <img src="https://images2.imgbox.com/58/eb/jaRMcQ8O_o.jpg" alt="" height="60%" width="60%"> </p> 
</div> 
<p>假设当模型在划分<code>是否便宜</code>这个结点前，模型在验证数据集上的正确率为<code>0.81</code>。但在划分后，模型在验证数据集上的正确率降为<code>0.67</code>。此时就不应该划分<code>是否便宜</code>这个结点。所以预剪枝后的模型如下：</p> 
<p align="center"> <img src="https://images2.imgbox.com/6e/ff/Jr7Xlxyg_o.jpg" alt="" height="60%" width="60%"> </p> 
<p>从上图可以看出，<strong>预剪枝能够降低决策树的复杂度。这种预剪枝处理属于贪心思想，但是贪心有一定的缺陷，就是可能当前划分会降低泛化性能，但在其基础上进行的后续划分却有可能导致性能显著提高。所以有可能会导致决策树出现欠拟合的情况。</strong></p> 
<h6 id="后剪枝">后剪枝</h6> 
<p>后剪枝是先从训练集生成一棵完整的决策树，然后自底向上地对非叶结点进行考察，若将该结点对应的子树替换为叶结点能够带来决策树泛化性能提升，则将该子树替换为叶结点。</p> 
<p>后剪枝的思路很直接，对于决策树中的每一个非叶子结点的子树，我们尝试着把它替换成一个叶子结点，该叶子结点的类别我们用子树所覆盖训练样本中存在最多的那个类来代替，这样就产生了一个简化决策树，然后比较这两个决策树在测试数据集中的表现，如果简化决策树在验证数据集中的准确率有所提高，那么该子树就可以替换成叶子结点。该算法以<code>bottom-up</code>的方式遍历所有的子树，直至没有任何子树可以替换使得测试数据集的表现得以改进时，算法就可以终止。</p> 
<p>从后剪枝的流程可以看出，后剪枝是从全局的角度来看待要不要剪枝，所以造成欠拟合现象的可能性比较小。但由于后剪枝需要先生成完整的决策树，然后再剪枝，所以后剪枝的训练时间开销更高。</p> 
<h5 id="编程要求">编程要求</h5> 
<p>填写<code>fit(self, train_feature, train_label, val_featrue, val_label)</code>函数，实现带<strong>后剪枝</strong>的<code>ID3</code>算法，要求决策树保存在<code>self.tree</code>中。其中：</p> 
<ul><li><p><code>train_feature</code>：训练集数据，类型为<code>ndarray</code>，数值全为整数；</p> </li><li><p><code>train_label</code>：训练集标签，类型为<code>ndarray</code>，数值全为整数；</p> </li><li><p><code>val_feature</code>：验证集数据，类型为<code>ndarray</code>，数值全为整数；</p> </li><li><p><code>val_label</code>：验证集标签，类型为<code>ndarray</code>，数值全为整数。</p> </li></ul> 
<p>填写<code>predict(self, feature)</code>函数，实现预测功能，并将标签返回，其中：</p> 
<ul><li><code>feature</code>：测试集数据，类型为<code>ndarray</code>，数值全为整数。<strong>（PS：feature中有多条数据）</strong></li></ul> 
<h5 id="测试说明">测试说明</h5> 
<p>只需完成<code>fit</code>与<code>predict</code>函数即可，程序内部会调用您所完成的<code>fit</code>函数构建模型并调用<code>predict</code>函数来对数据进行预测。预测的准确率高于<code>0.935</code>视为过关。(PS:若<code>self.tree is None</code>则会打印<strong>决策树构建失败</strong>)</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">from</span> copy <span class="token keyword">import</span> deepcopy

<span class="token keyword">class</span> <span class="token class-name">DecisionTree</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment">#决策树模型</span>
        self<span class="token punctuation">.</span>tree <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">def</span> <span class="token function">calcInfoGain</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> index<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        计算信息增益
        :param feature:测试用例中字典里的feature，类型为ndarray
        :param label:测试用例中字典里的label，类型为ndarray
        :param index:测试用例中字典里的index，即feature部分特征列的索引。该索引指的是feature中第几个特征，如index:0表示使用第一个特征来计算信息增益。
        :return:信息增益，类型float
        '''</span>

        <span class="token comment"># 计算熵</span>
        <span class="token keyword">def</span> <span class="token function">calcInfoEntropy</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">'''
            计算信息熵
            :param feature:数据集中的特征，类型为ndarray
            :param label:数据集中的标签，类型为ndarray
            :return:信息熵，类型float
            '''</span>

            label_set <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span>
            result <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token keyword">for</span> l <span class="token keyword">in</span> label_set<span class="token punctuation">:</span>
                count <span class="token operator">=</span> <span class="token number">0</span>
                <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> label<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">==</span> l<span class="token punctuation">:</span>
                        count <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token comment"># 计算标签在数据集中出现的概率</span>
                p <span class="token operator">=</span> count <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>label<span class="token punctuation">)</span>
                <span class="token comment"># 计算熵</span>
                result <span class="token operator">-=</span> p <span class="token operator">*</span> np<span class="token punctuation">.</span>log2<span class="token punctuation">(</span>p<span class="token punctuation">)</span>
            <span class="token keyword">return</span> result

        <span class="token comment"># 计算条件熵</span>
        <span class="token keyword">def</span> <span class="token function">calcHDA</span><span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> index<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token triple-quoted-string string">'''
            计算信息熵
            :param feature:数据集中的特征，类型为ndarray
            :param label:数据集中的标签，类型为ndarray
            :param index:需要使用的特征列索引，类型为int
            :param value:index所表示的特征列中需要考察的特征值，类型为int
            :return:信息熵，类型float
            '''</span>
            count <span class="token operator">=</span> <span class="token number">0</span>
            <span class="token comment"># sub_feature和sub_label表示根据特征列和特征值分割出的子数据集中的特征和标签</span>
            sub_feature <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            sub_label <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> feature<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">==</span> value<span class="token punctuation">:</span>
                    count <span class="token operator">+=</span> <span class="token number">1</span>
                    sub_feature<span class="token punctuation">.</span>append<span class="token punctuation">(</span>feature<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                    sub_label<span class="token punctuation">.</span>append<span class="token punctuation">(</span>label<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
            pHA <span class="token operator">=</span> count <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
            e <span class="token operator">=</span> calcInfoEntropy<span class="token punctuation">(</span>sub_feature<span class="token punctuation">,</span> sub_label<span class="token punctuation">)</span>
            <span class="token keyword">return</span> pHA <span class="token operator">*</span> e

        base_e <span class="token operator">=</span> calcInfoEntropy<span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">)</span>
        f <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
        <span class="token comment"># 得到指定特征列的值的集合</span>
        f_set <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> index<span class="token punctuation">]</span><span class="token punctuation">)</span>
        sum_HDA <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token comment"># 计算条件熵</span>
        <span class="token keyword">for</span> value <span class="token keyword">in</span> f_set<span class="token punctuation">:</span>
            sum_HDA <span class="token operator">+=</span> calcHDA<span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> index<span class="token punctuation">,</span> value<span class="token punctuation">)</span>
        <span class="token comment"># 计算信息增益</span>
        <span class="token keyword">return</span> base_e <span class="token operator">-</span> sum_HDA

    <span class="token comment"># 获得信息增益最高的特征</span>
    <span class="token keyword">def</span> <span class="token function">getBestFeature</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> feature<span class="token punctuation">,</span> label<span class="token punctuation">)</span><span class="token punctuation">:</span>
        max_infogain <span class="token operator">=</span> <span class="token number">0</span>
        best_feature <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>feature<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            infogain <span class="token operator">=</span> self<span class="token punctuation">.</span>calcInfoGain<span class="token punctuation">(</span>feature<span class="token punctuation">,</span> label<span class="token punctuation">,</span> i<span class="token punctuation">)</span>
            <span class="token keyword">if</span> infogain <span class="token operator">&gt;</span> max_infogain<span class="token punctuation">:</span>
                max_infogain <span class="token operator">=</span> infogain
                best_feature <span class="token operator">=</span> i
        <span class="token keyword">return</span> best_feature

    <span class="token comment"># 计算验证集准确率</span>
    <span class="token keyword">def</span> <span class="token function">calc_acc_val</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> the_tree<span class="token punctuation">,</span> val_feature<span class="token punctuation">,</span> val_label<span class="token punctuation">)</span><span class="token punctuation">:</span>
        result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

        <span class="token keyword">def</span> <span class="token function">classify</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> feature<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> tree
            t_index<span class="token punctuation">,</span> t_value <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>tree<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            f_value <span class="token operator">=</span> feature<span class="token punctuation">[</span>t_index<span class="token punctuation">]</span>
            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>t_value<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                classLabel <span class="token operator">=</span> classify<span class="token punctuation">(</span>tree<span class="token punctuation">[</span>t_index<span class="token punctuation">]</span><span class="token punctuation">[</span>f_value<span class="token punctuation">]</span><span class="token punctuation">,</span> feature<span class="token punctuation">)</span>
                <span class="token keyword">return</span> classLabel
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> t_value

        <span class="token keyword">for</span> f <span class="token keyword">in</span> val_feature<span class="token punctuation">:</span>
            result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>classify<span class="token punctuation">(</span>the_tree<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">)</span>

        result <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        <span class="token keyword">return</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>result <span class="token operator">==</span> val_label<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">createTree</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> train_feature<span class="token punctuation">,</span> train_label<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 样本里都是同一个label没必要继续分叉了</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span>train_label<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> train_label<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token comment"># 样本中只有一个特征或者所有样本的特征都一样的话就看哪个label的票数高</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>train_feature<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">or</span> <span class="token builtin">len</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>unique<span class="token punctuation">(</span>train_feature<span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
            vote <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
            <span class="token keyword">for</span> l <span class="token keyword">in</span> train_label<span class="token punctuation">:</span>
                <span class="token keyword">if</span> l <span class="token keyword">in</span> vote<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    vote<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">1</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    vote<span class="token punctuation">[</span>l<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span>
            max_count <span class="token operator">=</span> <span class="token number">0</span>
            vote_label <span class="token operator">=</span> <span class="token boolean">None</span>
            <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> vote<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> v <span class="token operator">&gt;</span> max_count<span class="token punctuation">:</span>
                    max_count <span class="token operator">=</span> v
                    vote_label <span class="token operator">=</span> k
            <span class="token keyword">return</span> vote_label

        <span class="token comment"># 根据信息增益拿到特征的索引</span>
        best_feature <span class="token operator">=</span> self<span class="token punctuation">.</span>getBestFeature<span class="token punctuation">(</span>train_feature<span class="token punctuation">,</span> train_label<span class="token punctuation">)</span>
        tree <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>best_feature<span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">}</span>
        f <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>train_feature<span class="token punctuation">)</span>
        <span class="token comment"># 拿到bestfeature的所有特征值</span>
        f_set <span class="token operator">=</span> <span class="token builtin">set</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> best_feature<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token comment"># 构建对应特征值的子样本集sub_feature, sub_label</span>
        <span class="token keyword">for</span> v <span class="token keyword">in</span> f_set<span class="token punctuation">:</span>
            sub_feature <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            sub_label <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>train_feature<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> train_feature<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>best_feature<span class="token punctuation">]</span> <span class="token operator">==</span> v<span class="token punctuation">:</span>
                    sub_feature<span class="token punctuation">.</span>append<span class="token punctuation">(</span>train_feature<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
                    sub_label<span class="token punctuation">.</span>append<span class="token punctuation">(</span>train_label<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>

            <span class="token comment"># 递归构建决策树</span>
            tree<span class="token punctuation">[</span>best_feature<span class="token punctuation">]</span><span class="token punctuation">[</span>v<span class="token punctuation">]</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>createTree<span class="token punctuation">(</span>sub_feature<span class="token punctuation">,</span> sub_label<span class="token punctuation">)</span>

        <span class="token keyword">return</span> tree

    <span class="token comment"># 后剪枝</span>
    <span class="token keyword">def</span> <span class="token function">post_cut</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> val_feature<span class="token punctuation">,</span> val_label<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 拿到非叶子节点的数量</span>
        <span class="token keyword">def</span> <span class="token function">get_non_leaf_node_count</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">:</span>
            non_leaf_node_path <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

            <span class="token keyword">def</span> <span class="token function">dfs</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> path<span class="token punctuation">,</span> all_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> k <span class="token keyword">in</span> tree<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>tree<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>k<span class="token punctuation">)</span>
                        dfs<span class="token punctuation">(</span>tree<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> all_path<span class="token punctuation">)</span>
                        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                            path<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        all_path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>path<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

            dfs<span class="token punctuation">(</span>tree<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> non_leaf_node_path<span class="token punctuation">)</span>

            unique_non_leaf_node <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
            <span class="token keyword">for</span> path <span class="token keyword">in</span> non_leaf_node_path<span class="token punctuation">:</span>
                isFind <span class="token operator">=</span> <span class="token boolean">False</span>
                <span class="token keyword">for</span> p <span class="token keyword">in</span> unique_non_leaf_node<span class="token punctuation">:</span>
                    <span class="token keyword">if</span> path <span class="token operator">==</span> p<span class="token punctuation">:</span>
                        isFind <span class="token operator">=</span> <span class="token boolean">True</span>
                        <span class="token keyword">break</span>
                <span class="token keyword">if</span> <span class="token operator">not</span> isFind<span class="token punctuation">:</span>
                    unique_non_leaf_node<span class="token punctuation">.</span>append<span class="token punctuation">(</span>path<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token builtin">len</span><span class="token punctuation">(</span>unique_non_leaf_node<span class="token punctuation">)</span>

        <span class="token comment"># 拿到树中深度最深的从根节点到非叶子节点的路径</span>
        <span class="token keyword">def</span> <span class="token function">get_the_most_deep_path</span><span class="token punctuation">(</span>tree<span class="token punctuation">)</span><span class="token punctuation">:</span>
            non_leaf_node_path <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

            <span class="token keyword">def</span> <span class="token function">dfs</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> path<span class="token punctuation">,</span> all_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> k <span class="token keyword">in</span> tree<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>tree<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                        path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>k<span class="token punctuation">)</span>
                        dfs<span class="token punctuation">(</span>tree<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> all_path<span class="token punctuation">)</span>
                        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
                            path<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        all_path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>path<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

            dfs<span class="token punctuation">(</span>tree<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> non_leaf_node_path<span class="token punctuation">)</span>

            max_depth <span class="token operator">=</span> <span class="token number">0</span>
            result <span class="token operator">=</span> <span class="token boolean">None</span>
            <span class="token keyword">for</span> path <span class="token keyword">in</span> non_leaf_node_path<span class="token punctuation">:</span>
                <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token operator">&gt;</span> max_depth<span class="token punctuation">:</span>
                    max_depth <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
                    result <span class="token operator">=</span> path
            <span class="token keyword">return</span> result

        <span class="token comment"># 剪枝</span>
        <span class="token keyword">def</span> <span class="token function">set_vote_label</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> path<span class="token punctuation">,</span> label<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                tree <span class="token operator">=</span> tree<span class="token punctuation">[</span>path<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>
            tree<span class="token punctuation">[</span>path<span class="token punctuation">[</span><span class="token builtin">len</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> vote_label

        acc_before_cut <span class="token operator">=</span> self<span class="token punctuation">.</span>calc_acc_val<span class="token punctuation">(</span>self<span class="token punctuation">.</span>tree<span class="token punctuation">,</span> val_feature<span class="token punctuation">,</span> val_label<span class="token punctuation">)</span>
        <span class="token comment"># 遍历所有非叶子节点</span>
        <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>get_non_leaf_node_count<span class="token punctuation">(</span>self<span class="token punctuation">.</span>tree<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            path <span class="token operator">=</span> get_the_most_deep_path<span class="token punctuation">(</span>self<span class="token punctuation">.</span>tree<span class="token punctuation">)</span>

            <span class="token comment"># 备份树</span>
            tree <span class="token operator">=</span> deepcopy<span class="token punctuation">(</span>self<span class="token punctuation">.</span>tree<span class="token punctuation">)</span>
            step <span class="token operator">=</span> deepcopy<span class="token punctuation">(</span>tree<span class="token punctuation">)</span>

            <span class="token comment"># 跟着路径走</span>
            <span class="token keyword">for</span> k <span class="token keyword">in</span> path<span class="token punctuation">:</span>
                step <span class="token operator">=</span> step<span class="token punctuation">[</span>k<span class="token punctuation">]</span>

            <span class="token comment"># 叶子节点中票数最多的标签</span>
            vote_label <span class="token operator">=</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>step<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> key<span class="token operator">=</span><span class="token keyword">lambda</span> item<span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

            <span class="token comment"># 在备份的树上剪枝</span>
            set_vote_label<span class="token punctuation">(</span>tree<span class="token punctuation">,</span> path<span class="token punctuation">,</span> vote_label<span class="token punctuation">)</span>

            acc_after_cut <span class="token operator">=</span> self<span class="token punctuation">.</span>calc_acc_val<span class="token punctuation">(</span>tree<span class="token punctuation">,</span> val_feature<span class="token punctuation">,</span> val_label<span class="token punctuation">)</span>

            <span class="token comment"># 验证集准确率高于0.9才剪枝</span>
            <span class="token keyword">if</span> acc_after_cut <span class="token operator">&gt;</span> acc_before_cut<span class="token punctuation">:</span>
                set_vote_label<span class="token punctuation">(</span>self<span class="token punctuation">.</span>tree<span class="token punctuation">,</span> path<span class="token punctuation">,</span> vote_label<span class="token punctuation">)</span>
                acc_before_cut <span class="token operator">=</span> acc_after_cut



    <span class="token keyword">def</span> <span class="token function">fit</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> train_feature<span class="token punctuation">,</span> train_label<span class="token punctuation">,</span> val_feature<span class="token punctuation">,</span> val_label<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        :param train_feature:训练集数据，类型为ndarray
        :param train_label:训练集标签，类型为ndarray
        :param val_feature:验证集数据，类型为ndarray
        :param val_label:验证集标签，类型为ndarray
        :return: None
        '''</span>

        <span class="token comment">#************* Begin ************#</span>
        self<span class="token punctuation">.</span>tree <span class="token operator">=</span> self<span class="token punctuation">.</span>createTree<span class="token punctuation">(</span>train_feature<span class="token punctuation">,</span> train_label<span class="token punctuation">)</span>
        <span class="token comment"># 后剪枝</span>
        self<span class="token punctuation">.</span>post_cut<span class="token punctuation">(</span>val_feature<span class="token punctuation">,</span> val_label<span class="token punctuation">)</span>
        <span class="token comment">#************* End **************#</span>

    <span class="token keyword">def</span> <span class="token function">predict</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> feature<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">'''
        :param feature:测试集数据，类型为ndarray
        :return:预测结果，如np.array([0, 1, 2, 2, 1, 0])
        '''</span>

        <span class="token comment">#************* Begin ************#</span>
        result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

        <span class="token comment"># 单个样本分类</span>
        <span class="token keyword">def</span> <span class="token function">classify</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> feature<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>tree<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> tree
            t_index<span class="token punctuation">,</span> t_value <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>tree<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            f_value <span class="token operator">=</span> feature<span class="token punctuation">[</span>t_index<span class="token punctuation">]</span>
            <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>t_value<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                classLabel <span class="token operator">=</span> classify<span class="token punctuation">(</span>tree<span class="token punctuation">[</span>t_index<span class="token punctuation">]</span><span class="token punctuation">[</span>f_value<span class="token punctuation">]</span><span class="token punctuation">,</span> feature<span class="token punctuation">)</span>
                <span class="token keyword">return</span> classLabel
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">return</span> t_value

        <span class="token keyword">for</span> f <span class="token keyword">in</span> feature<span class="token punctuation">:</span>
            result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>classify<span class="token punctuation">(</span>self<span class="token punctuation">.</span>tree<span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
        <span class="token comment">#************* End **************#</span>
</code></pre> 
<h3><a id="7_1217"></a>第7关：鸢尾花识别</h3> 
<div class="tab-panel-body  markdown-body"> 
 <ul><li><a href="#%E4%BB%BB%E5%8A%A1%E6%8F%8F%E8%BF%B0" rel="nofollow">任务描述</a></li><li><a href="#%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86" rel="nofollow">相关知识</a> 
   <ul><li><a href="#%E6%95%B0%E6%8D%AE%E7%AE%80%E4%BB%8B" rel="nofollow">数据简介</a></li><li><a href="#decisiontreeclassifier" rel="nofollow">DecisionTreeClassifier</a></li></ul></li><li><a href="#%E7%BC%96%E7%A8%8B%E8%A6%81%E6%B1%82" rel="nofollow">编程要求</a></li><li><a href="#%E6%B5%8B%E8%AF%95%E8%AF%B4%E6%98%8E" rel="nofollow">测试说明</a></li></ul> 
 <hr> 
 <h5 id="任务描述">任务描述</h5> 
 <p>本关任务：使用<code>sklearn</code>完成鸢尾花分类任务。</p> 
 <h5 id="相关知识">相关知识</h5> 
 <p>为了完成本关任务，你需要掌握如何使用<code>sklearn</code>提供的<code>DecisionTreeClassifier</code>。</p> 
 <h6 id="数据简介">数据简介</h6> 
 <p align="center"> <img src="https://images2.imgbox.com/96/cf/svNZXN2l_o.png" alt="" height="60%" width="60%"> </p> 
</div> 
<p>鸢尾花数据集是一类多重变量分析的数据集。通过花萼长度，花萼宽度，花瓣长度，花瓣宽度<code>4</code>个属性预测鸢尾花卉属于(<code>Setosa</code>，<code>Versicolour</code>，<code>Virginica</code>)三个种类中的哪一类(其中分别用<code>0</code>，<code>1</code>，<code>2</code>代替)。</p> 
<p>数据集中部分数据与标签如下图所示：</p> 
<p align="center"> <img src="https://images2.imgbox.com/74/87/Wpd8P6bB_o.png" alt="" height="60%" width="60%"> </p> 
<p align="center"> <img src="https://images2.imgbox.com/09/1a/99NMW68w_o.png" alt="" height="60%" width="30%"> </p> 
<h6 id="decisiontreeclassifier">DecisionTreeClassifier</h6> 
<p><code>DecisionTreeClassifier</code>的构造函数中有两个常用的参数可以设置：</p> 
<ul><li><code>criterion</code>:划分节点时用到的指标。有<code>gini</code>（<strong>基尼系数</strong>）,<code>entropy</code>(<strong>信息增益</strong>)。若不设置，默认为<code>gini</code></li><li><code>max_depth</code>:决策树的最大深度，如果发现模型已经出现过拟合，可以尝试将该参数调小。若不设置，默认为<code>None</code></li></ul> 
<p>和<code>sklearn</code>中其他分类器一样，<code>DecisionTreeClassifier</code>类中的<code>fit</code>函数用于训练模型，<code>fit</code>函数有两个向量输入：</p> 
<ul><li><p><code>X</code>：大小为<code>[样本数量,特征数量]</code>的<code>ndarray</code>，存放训练样本；</p> </li><li><p><code>Y</code>：值为整型，大小为<code>[样本数量]</code>的<code>ndarray</code>，存放训练样本的分类标签。</p> </li></ul> 
<p><code>DecisionTreeClassifier</code>类中的<code>predict</code>函数用于预测，返回预测标签，<code>predict</code>函数有一个向量输入：</p> 
<ul><li><code>X</code>：大小为<code>[样本数量,特征数量]</code>的<code>ndarray</code>，存放预测样本。</li></ul> 
<p><code>DecisionTreeClassifier</code>的使用代码如下：</p> 
<pre class="prettyprint linenums prettyprinted"> 
 <ol class="linenums"><li class="L0"><code class="language-python"><span class="kwd">from</span><span class="pln"> sklearn</span><span class="pun">.</span><span class="pln">tree </span><span class="kwd">import</span><span class="pln"> </span><span class="typ">DecisionTreeClassifier</span></code></li><li class="L1"><code class="language-python"></code></li><li class="L2"><code class="language-python"><span class="pln">clf </span><span class="pun">=</span><span class="pln"> tree</span><span class="pun">.</span><span class="typ">DecisionTreeClassifier</span><span class="pun">()</span></code></li><li class="L3"><code class="language-python"><span class="pln">clf</span><span class="pun">.</span><span class="pln">fit</span><span class="pun">(</span><span class="pln">X_train</span><span class="pun">,</span><span class="pln"> Y_train</span><span class="pun">)</span></code></li><li class="L4"><code class="language-python"><span class="pln">result </span><span class="pun">=</span><span class="pln"> clf</span><span class="pun">.</span><span class="pln">predict</span><span class="pun">(</span><span class="pln">X_test</span><span class="pun">)</span></code></li></ol></pre> 
<h5 id="编程要求">编程要求</h5> 
<p>补充<code>python</code>代码，实现鸢尾花数据的分类任务，其中训练集数据保存在<code>./step7/train_data.csv</code>中，训练集标签保存在。<code>./step7/train_label.csv</code>中，测试集数据保存在。<code>./step7/test_data.csv</code>中。请将对测试集的预测结果保存至。<code>./step7/predict.csv</code>中。这些<code>csv</code>文件可以使用<code>pandas</code>读取与写入。</p> 
<p><strong>注意：当使用<code>pandas</code>读取完<code>csv</code>文件后，请将读取到的<code>DataFrame</code>转换成<code>ndarray</code>类型。这样才能正常的使用<code>fit</code>和<code>predict</code>。</strong></p> 
<p>示例代码：</p> 
<pre class="prettyprint linenums prettyprinted"> 
 <ol class="linenums"><li class="L0"><code class="language-python"><span class="kwd">import</span><span class="pln"> pandas </span><span class="kwd">as</span><span class="pln"> pd</span></code></li><li class="L1"><code class="language-python"></code></li><li class="L2"><code class="language-python"><span class="com"># as_matrix()可以将DataFrame转换成ndarray</span></code></li><li class="L3"><code class="language-python"><span class="com"># 此时train_df的类型为ndarray而不是DataFrame</span></code></li><li class="L4"><code class="language-python"><span class="pln">train_df </span><span class="pun">=</span><span class="pln"> pd</span><span class="pun">.</span><span class="pln">read_csv</span><span class="pun">(</span><span class="str">'train_data.csv'</span><span class="pun">).</span><span class="pln">as_matrix</span><span class="pun">()</span></code></li></ol></pre> 
<p>数据文件格式如下图所示:</p> 
<p align="center"> <img src="https://images2.imgbox.com/30/d4/PB5rt0mG_o.png" alt="" height="60%" width="60%"> </p> 
<p>标签文件格式如下图所示:</p> 
<p align="center"> <img src="https://images2.imgbox.com/3a/db/8ukAF7aI_o.png" alt="" height="60%" width="30%"> </p> 
<p><strong>PS：<code>predict.csv</code>文件的格式必须与标签文件格式一致。</strong></p> 
<h5 id="测试说明">测试说明</h5> 
<p>只需将结果保存至<code>./step7/predict.csv</code>即可，程序内部会检测您的代码，预测准确率高于<code>0.95</code>视为过关。</p> 
<hr> 
<p>开始你的任务吧，祝你成功！</p> 
<pre><code class="prism language-python"><span class="token comment">#********* Begin *********#</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>tree <span class="token keyword">import</span> DecisionTreeClassifier

train_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'./step7/train_data.csv'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>as_matrix<span class="token punctuation">(</span><span class="token punctuation">)</span>
train_label <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'./step7/train_label.csv'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>as_matrix<span class="token punctuation">(</span><span class="token punctuation">)</span>
test_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'./step7/test_data.csv'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>as_matrix<span class="token punctuation">(</span><span class="token punctuation">)</span>

dt <span class="token operator">=</span> DecisionTreeClassifier<span class="token punctuation">(</span><span class="token punctuation">)</span>
dt<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_df<span class="token punctuation">,</span> train_label<span class="token punctuation">)</span>
result <span class="token operator">=</span> dt<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>test_df<span class="token punctuation">)</span>

result <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'target'</span><span class="token punctuation">:</span>result<span class="token punctuation">}</span><span class="token punctuation">)</span>
result<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'./step7/predict.csv'</span><span class="token punctuation">,</span> index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>

<span class="token comment">#********* End *********#</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/34de0b0a1c1696375e433c8bde4d03f4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Anconda3下Tensorflow 2.0 GPU 环境极简安装及测试方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7a0a4eaa95e04c176c046883d6cd4998/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">unbutu 18.04 循环登录报错</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>