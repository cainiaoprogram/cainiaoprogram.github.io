<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Ansible-playbook编译.yml脚本 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Ansible-playbook编译.yml脚本" />
<meta property="og:description" content="1、playbook是什么？ 在Ansible中，Playbook是用于配置、部署和管理被控节点的剧本。它由一个或多个play（角色）组成，每个play可以包含多个task（台词，动作）。使用Ansible的Playbook，可以通过描述和执行一系列的操作步骤，让受控主机达到预期的状态。
2、为什么要编写playbook？ 写Playbook的目的主要有以下几点：
自动化和可重复性：Playbook可以确保在多个环境中实现一致性和可重复性。一旦编写完成，可以在任何需要的地方运行，从而消除了手动配置和部署的繁琐性。提高效率：通过自动化常见任务，Playbook可以显著减少完成这些任务所需的时间和精力。这允许团队将更多资源投入到创新和增值活动中。减少错误：自动化的配置和部署过程可以消除人为错误，从而提高了系统的稳定性和可靠性。文档化：Playbook可以作为系统配置和部署过程的文档。这有助于新团队成员了解系统，并允许团队在出现问题时快速回溯和诊断。可扩展性和灵活性：Playbook可以轻松适应不断变化的需求和环境。只需对Playbook进行必要的修改，即可在多个环境中重复使用。一致性：通过使用Playbook，可以确保在多个环境或主机上实现一致的配置和部署。这有助于维护系统的一致性和稳定性。易于审计和跟踪：由于Playbook是文本文件，因此可以轻松进行版本控制，从而允许团队跟踪对系统所做的更改。这有助于满足合规性和审计要求。 3、如何编写playbook？ 编写Ansible Playbook需要遵循一定的结构和语法规则。以下是一些编写Ansible Playbook的基本步骤和注意事项：
确定目标：在开始编写Playbook之前，需要明确你想要达到的目标。例如，你可能想要部署一个应用程序、配置网络设置、管理软件包等。创建Playbook文件：在Ansible目录中创建一个以.yml为扩展名的Playbook文件。例如，你可以创建一个名为deploy.yml的文件。定义inventory：在Playbook文件中，你需要定义一个或多个inventory（主机清单）。Inventory可以包含受控主机的列表、主机组、变量等。 --- - hosts: webservers become: yes tasks: - name: install nginx apt: name=nginx state=present
在这个示例中，hosts字段指定了一个名为webservers的主机组，become字段用于执行需要管理员权限的任务。
4.定义task（任务）：在Playbook中，每个任务都是一个要执行的指令或动作。你可以定义多个任务来达到你的目标。
- name: install nginx
apt: name=nginx state=present
在这个示例中，任务是安装Nginx软件包。
5.执行Playbook：使用Ansible命令行工具或脚本执行Playbook。例如，你可以运行以下命令来执行名为deploy.yml的Playbook：
ansible-playbook deploy.yml
6.调试和优化：在执行Playbook后，检查输出和日志以确认任务是否成功执行。根据需要调试和优化Playbook以确保其正确性和效率。
4、单据本编写 1.查看ansible是否安装，如下图是已安装示例图，如果还没有可以参考我上一篇文章《Ansible介绍与安装》
2.管理的我的主机IP地址 vi /etc/ansible/hosts
[m1]
192.168.31.135
[all:vars]
ansible_user=root
ansible_password=123456
3.确定ansible能与受控机通信
4.创建一个ploybook目录，用于专门存放ploybook文件，编写playbook，名为waha.yml。
[root@localhost /]# cd /etc/ansible
[root@localhost ansible]# mkdir playbook
[root@localhost ansible]# cd playbook/
[root@localhost playbook]# vim waha.yml
[root@localhost playbook]# cat waha." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/013d5fc8e2b9329375e42432ba4b722f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-17T21:06:42+08:00" />
<meta property="article:modified_time" content="2023-12-17T21:06:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Ansible-playbook编译.yml脚本</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>1、playbook是什么？</h4> 
<p>在Ansible中，Playbook是用于配置、部署和管理被控节点的剧本。它由一个或多个play（角色）组成，每个play可以包含多个task（台词，动作）。使用Ansible的Playbook，可以通过描述和执行一系列的操作步骤，让受控主机达到预期的状态。</p> 
<h4>2、为什么要编写playbook？</h4> 
<p>写Playbook的目的主要有以下几点：</p> 
<ol><li>自动化和可重复性：Playbook可以确保在多个环境中实现一致性和可重复性。一旦编写完成，可以在任何需要的地方运行，从而消除了手动配置和部署的繁琐性。</li><li>提高效率：通过自动化常见任务，Playbook可以显著减少完成这些任务所需的时间和精力。这允许团队将更多资源投入到创新和增值活动中。</li><li>减少错误：自动化的配置和部署过程可以消除人为错误，从而提高了系统的稳定性和可靠性。</li><li>文档化：Playbook可以作为系统配置和部署过程的文档。这有助于新团队成员了解系统，并允许团队在出现问题时快速回溯和诊断。</li><li>可扩展性和灵活性：Playbook可以轻松适应不断变化的需求和环境。只需对Playbook进行必要的修改，即可在多个环境中重复使用。</li><li>一致性：通过使用Playbook，可以确保在多个环境或主机上实现一致的配置和部署。这有助于维护系统的一致性和稳定性。</li><li>易于审计和跟踪：由于Playbook是文本文件，因此可以轻松进行版本控制，从而允许团队跟踪对系统所做的更改。这有助于满足合规性和审计要求。</li></ol> 
<h4>3、如何编写playbook？</h4> 
<p>编写Ansible Playbook需要遵循一定的结构和语法规则。以下是一些编写Ansible Playbook的基本步骤和注意事项：</p> 
<ol><li>确定目标：在开始编写Playbook之前，需要明确你想要达到的目标。例如，你可能想要部署一个应用程序、配置网络设置、管理软件包等。</li><li>创建Playbook文件：在Ansible目录中创建一个以<code>.yml</code>为扩展名的Playbook文件。例如，你可以创建一个名为<code>deploy.yml</code>的文件。</li><li>定义inventory：在Playbook文件中，你需要定义一个或多个inventory（主机清单）。Inventory可以包含受控主机的列表、主机组、变量等。</li></ol> 
<blockquote> 
 <p>---  <br> - hosts: webservers  <br>   become: yes  <br>   tasks:  <br>     - name: install nginx  <br>       apt: name=nginx state=present<br>  </p> 
</blockquote> 
<p>在这个示例中，<code>hosts</code>字段指定了一个名为<code>webservers</code>的主机组，<code>become</code>字段用于执行需要管理员权限的任务。</p> 
<p>4.定义task（任务）：在Playbook中，每个任务都是一个要执行的指令或动作。你可以定义多个任务来达到你的目标。</p> 
<blockquote> 
 <p>- name: install nginx</p> 
 <p>apt: name=nginx state=present</p> 
</blockquote> 
<p>在这个示例中，任务是安装Nginx软件包。</p> 
<p>5.执行Playbook：使用Ansible命令行工具或脚本执行Playbook。例如，你可以运行以下命令来执行名为<code>deploy.yml</code>的Playbook：</p> 
<blockquote> 
 <p>ansible-playbook deploy.yml</p> 
</blockquote> 
<p>6.调试和优化：在执行Playbook后，检查输出和日志以确认任务是否成功执行。根据需要调试和优化Playbook以确保其正确性和效率。</p> 
<h4>4、单据本编写</h4> 
<p>1.查看ansible是否安装，如下图是已安装示例图，如果还没有可以参考我上一篇文章<strong>《Ansible介绍与安装》</strong></p> 
<p><img alt="" height="175" src="https://images2.imgbox.com/03/04/f50ZtyI2_o.png" width="817"></p> 
<p>2.管理的我的主机IP地址 vi /etc/ansible/hosts</p> 
<blockquote> 
 <p>[m1]<br> 192.168.31.135<br> [all:vars]<br> ansible_user=root<br> ansible_password=123456</p> 
</blockquote> 
<p>3.确定ansible能与受控机通信</p> 
<p><img alt="" height="157" src="https://images2.imgbox.com/5a/74/RZyOl8XA_o.png" width="589"></p> 
<p>4.创建一个ploybook目录，用于专门存放ploybook文件，编写playbook，名为waha.yml。</p> 
<blockquote> 
 <p>[root@localhost  /]# cd /etc/ansible</p> 
 <p>[root@localhost ansible]# mkdir playbook<br> [root@localhost ansible]# cd playbook/<br> [root@localhost playbook]# vim waha.yml<br> [root@localhost playbook]# cat waha.yml <br> ---<br> - name: 系统初始化         ##任务名称，自定义。<br>   hosts: 192.168.31.135      ##对哪个受控机进行操作。<br>   tasks:                      ## 任务。<br>     - name: 关闭防火墙      ##任务里可以有很多个小任务，比如这里就只有一个任务，关闭防火墙，名称自定义。<br>       service:             ##关闭防火墙要用哪个模块。<br>         name: firewalld          ##service模块参数，作用对象。<br>         state: stopped            ##service模块参数，操作动作。</p> 
</blockquote> 
<p>5.语法验证。验证没问题之后才能往后面操作。</p> 
<p> ansible-playbook --syntax-check waha.yml </p> 
<p> <img alt="" height="60" src="https://images2.imgbox.com/be/28/KVvmCf7s_o.png" width="589">   </p> 
<p>6.执行空运行，测试结果是否是我们想要的，但不实际在受控机上执行。</p> 
<p><img alt="" height="334" src="https://images2.imgbox.com/f1/97/IMaieKuX_o.png" width="590"></p> 
<p>7.执行ploybook，查看结果。</p> 
<p><img alt="" height="336" src="https://images2.imgbox.com/dd/37/pnka8ddP_o.png" width="588"></p> 
<p>8.之前192.168.31.135的防火墙状态</p> 
<p><img alt="" height="262" src="https://images2.imgbox.com/ee/6d/dCW4I2cx_o.png" width="815"></p> 
<p>9.现在192.168.31.135的防火墙状态</p> 
<p><img alt="" height="306" src="https://images2.imgbox.com/b0/b5/RGICWzda_o.png" width="811"></p> 
<h4>5、多剧本编写</h4> 
<p> 1.管理的主机IP地址 vi /etc/ansible/hosts</p> 
<blockquote> 
 <p>[m1]<br> 192.168.31.135</p> 
 <p>[m2]</p> 
 <p>192.168.31.140</p> 
 <p>[all:vars]<br> ansible_user=root<br> ansible_password=123456</p> 
</blockquote> 
<p>3.确定ansible能与受控机通信</p> 
<p><img alt="" height="289" src="https://images2.imgbox.com/a8/ff/RaNCuMZy_o.png" width="587"></p> 
<p>4.创建一个ploybook目录，用于专门存放ploybook文件，编写playbook，名为happy.yml。</p> 
<blockquote> 
 <p>[root@localhost  /]# cd /etc/ansible</p> 
 <p>[root@localhost ansible]# mkdir playbook<br> [root@localhost ansible]# cd playbook/<br> [root@localhost playbook]# vim happy.yml<br> [root@localhost playbook]# cat happy.yml <br> ---<br> - name: 系统初始化         ##任务名称，自定义。<br>   hosts: [192.168.31.135 192.168.31.140]      ##对哪个受控机进行操作。<br>   tasks:                      ## 任务。<br>     - name: 关闭防火墙      ##任务里可以有很多个小任务，比如这里就只有一个任务，关闭防火墙，名称自定义。<br>       service:             ##关闭防火墙要用哪个模块。<br>         name: firewalld          ##service模块参数，作用对象。<br>         state: stopped            ##service模块参数，操作动作。</p> 
</blockquote> 
<p>5.语法验证。验证没问题之后才能往后面操作。</p> 
<p> ansible-playbook --syntax-check happy.yml </p> 
<p> <img alt="" height="75" src="https://images2.imgbox.com/4f/11/paD9mbL0_o.png" width="591">   </p> 
<p>6.执行空运行，测试结果是否是我们想要的，但不实际在受控机上执行。</p> 
<p><img alt="" height="417" src="https://images2.imgbox.com/7c/da/8XlzLa2l_o.png" width="586"></p> 
<p>7.执行ploybook，查看结果。</p> 
<p><img alt="" height="417" src="https://images2.imgbox.com/0c/7a/Gk3RbSqv_o.png" width="589"></p> 
<p>8.之前192.168.31.135和192.168.31.140的防火墙状态</p> 
<p><img alt="" height="262" src="https://images2.imgbox.com/55/c9/qVWSNMQ4_o.png" width="815"></p> 
<p>9.现在192.168.31.135和192.168.31.140的防火墙状态</p> 
<p><img alt="" height="306" src="https://images2.imgbox.com/f1/99/TROFkmHb_o.png" width="811"></p> 
<p></p> 
<p><strong>如果在查看两台主机防火墙的主机的防火墙的状态时，如果防火墙都关闭了，恭喜你最基础的Ansible-playbook编译.yml脚本已经掌握！！</strong></p> 
<p></p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cfb82ec602f27c7e6e4a0ac36103c4e0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据结构之顺序表</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c904d0e88b790b61bd6d70e487023f99/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">jenkins安装</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>