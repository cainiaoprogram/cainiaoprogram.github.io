<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>m_pConnection-&gt;Open和m_pRecordset-&gt;Open - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="m_pConnection-&gt;Open和m_pRecordset-&gt;Open" />
<meta property="og:description" content="m_pConnection-&gt;Open用在InitInstance()函数中，
用法：
m_pConnection.CreateInstance(&#34;ADODB.Connection&#34;); m_pConnection-&gt;Open(&#34;Provider=Microsoft.Jet.OLEDB.4.0;Data Source=D:\\studentDB.mdb&#34;,&#34;&#34;,&#34;&#34;,adModeUnknown); //打开本地Access 库studentDB.mdb 易看出，m_pConnection-&gt;Open是建立MFC应用程序和数据库的连接，
Data Source=D:\\studentDB.mdb是所连接的数据库的名称（包括详细路径），（如果是网络数据库，这里可以是IP地址）
****************************************************************************************************************************
m_pRecordset-&gt;Open是加在OnInitDialog()函数中的，
用法：
m_pRecordset.CreateInstance(__uuidof(Recordset)); m_pRecordset-&gt;Open(&#34;SELECT * FROM STUDENT&#34;,
theApp.m_pConnection.GetInterfacePtr(),
adOpenDynamic,
adLockOptimistic, adCmdText); 易看出，执行m_pRecordset-&gt;Open时，某个具体的数据库和应用程序已经连接上了，可以对数据库中的具体数据表进行操作了，
Open函数的第一个参数就是执行的SQL语句~~这里执行的是SELECT * FROM STUDENT
作用是查询STUDENT这个数据库所有内容，即 打开记录集
***********************************************************************************************************************
执行完以上部分后，就要看下面的部分了。。。
ADO库包含三个基本接口:_ConnectionPtr接口、_CommandPtr接口和_RecordsetPtr接口。 _ConnectionPtr接口返回一个记录集或一个空指针。 通常使用它来创建一个数据连接或执行一条不返回任何结果的SQL语句，如一个存储过程。 使用_ConnectionPtr接口返回一个记录集不是一个好的使用方法。（所以通常是用_RecordsetPtr 得到一个记录集） 通常同Cdatabase一样，使用它创建一个数据连接，然后使用其它对象执行数据输入输出操作。 _CommandPtr接口返回一个记录集。 它提供了一种简单的方法来执行返回记录集的存储过程和SQL语句。 在使用_CommandPtr接口时，你可以利用全局_ConnectionPtr接口，也可以在_CommandPtr接口里直接使用连接串。 如果你只执行一次或几次数据访问操作，后者是比较好的选择。 但如果你要频繁访问数据库，并要返回很多记录集，那么，你应该使用全局_ConnectionPtr接口创建一个数据连接， 然后使用_CommandPtr接口执行存储过程和SQL语句。 _RecordsetPtr是一个记录集对象。 与以上两种对象相比，它对记录集提供了更多的控制功能，如记录锁定，游标控制等。
同_CommandPtr接口一样，它不一定要使用一个已经创建的数据连接， 可以用一个连接串代替连接指针赋给_RecordsetPtr的connection成员变量，让它自己创建数据连接。 如果你要使用多个记录集，最好的方法是同Command对象一样使用已经创建了数据连接的全局_ConnectionPtr接口 ，然后使用_RecordsetPtr执行存储过程和SQL语句。 基本流程 (1)初始化COM库，引入ADO库定义文件 (2)用Connection对象连接数据库 (3)利用建立好的连接，通过Connection、Command对象执行SQL命令，或利用Recordset对象取得结果记 录集进行查询、处理。 (4)使用完毕后关闭连接释放对象。
***************************************************************************************************************************
连接数据库的方法除以上一种之外，还有下面的方法：
常用的数据库连接方法： (1)通过JET数据库引擎对ACCESS2000数据库的连接 m_pConnection-&gt;Open(&#34;Provider=Microsoft.Jet.OLEDB.4.0;Data Source=C:\\test.mdb&#34;,&#34;&#34;,&#34;&#34;,adModeUnknown); (2)通过DSN数据源对任何支持ODBC的数据库进行连接: m_pConnection-&gt;Open(&#34;Data Source=adotest;UID=sa;PWD=;&#34;,&#34;&#34;,&#34;&#34;,adModeUnknown); //m_pConnection-&gt;Open(&#34;DSN=test;&#34;,&#34;&#34;,&#34;&#34;,0); //连接叫作test的ODBC数据源 (3)不通过DSN对SQL SERVER数据库进行连接： m_pConnection-&gt;Open(&#34;driver={SQL Server};Server=127." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/8be965154f0cc609270928362a48a12a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-06-27T12:45:16+08:00" />
<meta property="article:modified_time" content="2014-06-27T12:45:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">m_pConnection-&gt;Open和m_pRecordset-&gt;Open</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>m_pConnection-&gt;Open用在InitInstance()函数中，</p> 
<p>用法：</p> 
<p><span style="white-space:pre"></span>m_pConnection.CreateInstance("ADODB.Connection");    <br> <span style="white-space:pre"></span>m_pConnection-&gt;Open("Provider=Microsoft.Jet.OLEDB.4.0;Data Source=D:\\studentDB.mdb","","",adModeUnknown); <span style="white-space:pre"></span>//打开本地Access 库studentDB.mdb <br> </p> 
<p>易看出，m_pConnection-&gt;Open是建立MFC应用程序和数据库的连接，</p> 
<p>Data Source=D:\\studentDB.mdb是所连接的数据库的名称（包括详细路径），（如果是网络数据库，这里可以是IP地址）<br> </p> 
<p><br> </p> 
<p>****************************************************************************************************************************</p> 
<p><br> </p> 
<p>m_pRecordset-&gt;Open是加在OnInitDialog()函数中的，<br> </p> 
<p>用法：</p> 
<p>m_pRecordset.CreateInstance(__uuidof(Recordset)); <br> <span style="white-space:pre"></span>m_pRecordset-&gt;Open("SELECT * FROM STUDENT",<br> <span style="white-space:pre"></span>theApp.m_pConnection.GetInterfacePtr(),<br> <span style="white-space:pre"></span>adOpenDynamic,<br> <span style="white-space:pre"></span>adLockOptimistic,  <br> <span style="white-space:pre"></span>adCmdText); <br> </p> 
<p><br> </p> 
<p>易看出，执行m_pRecordset-&gt;Open时，某个具体的数据库和应用程序已经连接上了，可以对数据库中的具体数据表进行操作了，</p> 
<p>Open函数的第一个参数就是执行的SQL语句~~这里执行的是SELECT * FROM STUDENT</p> 
<p>作用是查询STUDENT这个数据库所有内容，即 打开记录集</p> 
<p><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><strong><br> </strong></span></p> 
<p><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><strong>***********************************************************************************************************************</strong></span></p> 
<p><span style="font-family:Arial; font-size:14px; color:#333333"><span style="line-height:26px"><strong>执行完以上部分后，就要看下面的部分了。。。</strong></span></span></p> 
<p><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">ADO库包含三个基本接口:_ConnectionPtr接口、_CommandPtr接口和_RecordsetPtr接口。</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">_ConnectionPtr接口<strong>返回一个记录集或一个空指针</strong>。</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">通常<strong>使用它来创建一个数据连接或执行一条不返回任何结果的SQL语句</strong>，如一个存储过程。</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="font-family:Arial; font-size:16px; line-height:26px"><span style="color:#ff0000"><strong>使用_ConnectionPtr接口返回一个记录集不是一个好的使用方法。（所以通常是用<span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">_RecordsetPtr 得到一个记录集</span>）</strong></span></span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><strong>通常同Cdatabase一样，使用它创建一个数据连接，然后使用其它对象执行数据输入输出操作。</strong></span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">_CommandPtr接口返回一个记录集。</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">它提供了一种简单的方法来执行返回记录集的存储过程和SQL语句。</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">在使用_CommandPtr接口时，你可以利用全局_ConnectionPtr接口，<strong>也可以在_CommandPtr接口里直接使用连接串</strong>。</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">如果你只执行一次或几次数据访问操作，后者是比较好的选择。</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">但<strong>如果你要频繁访问数据库，并要返回很多记录集，那么，你应该使用全局_ConnectionPtr接口创建一个数据连接，</strong></span><strong><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </strong><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><strong>然后使用_CommandPtr接口执行存储过程和SQL语句</strong>。</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">_RecordsetPtr是一个记录集对象。</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">与以上两种对象相比，它<strong>对记录集提供了更多的控制功能，如记录锁定，游标控制等</strong></span><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">。</span></p> 
<p><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">同_CommandPtr接口一样，它不一定要使用一个已经创建的数据连接，</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">可以用一个连接串代替连接指针赋给_RecordsetPtr的connection成员变量，让它自己创建数据连接。</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <strong><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">如果你要使用多个记录集，最好的方法是同Command对象一样使用已经创建了数据连接的全局_ConnectionPtr接口</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">，然后使用_RecordsetPtr执行存储过程和SQL语句。</span></strong><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="font-family:Arial; font-size:16px; line-height:26px; color:rgb(255,0,0)">基本流程</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">(1)初始化COM库，引入ADO库定义文件</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">(2)用Connection对象连接数据库</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">(3)利用建立好的连接，通过Connection、Command对象执行SQL命令，或利用Recordset对象取得结果记</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> 录集进行查询、处理。</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">(4)使用完毕后关闭连接释放对象。</span><br> </p> 
<p><br> </p> 
<p><span style="font-family:Arial; font-size:14px; color:#333333"><span style="line-height:26px"><strong>***************************************************************************************************************************</strong></span></span></p> 
<p><span style="font-family:Arial; font-size:14px; color:#333333"><span style="line-height:26px"><strong><br> </strong></span></span></p> 
<p><span style="font-family:Arial; font-size:14px; color:#333333"><span style="line-height:26px"><strong>连接数据库的方法除以上一种之外，还有下面的方法：</strong></span></span></p> 
<p><span style="font-family:Arial; font-size:14px; color:#333333"><span style="line-height:26px"><strong><br> </strong></span></span></p> 
<p><span style="font-family:Arial; font-size:14px; color:#333333"><span style="line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">常用的数据库连接方法：</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">(1)通过JET数据库引擎对ACCESS2000数据库的连接</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">m_pConnection-&gt;Open("Provider=Microsoft.Jet.OLEDB.4.0;Data Source=C:\\test.mdb","","",adModeUnknown);</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">(2)通过DSN数据源对任何支持ODBC的数据库进行连接:</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">m_pConnection-&gt;Open("Data Source=adotest;UID=sa;PWD=;","","",adModeUnknown);</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">//m_pConnection-&gt;Open("DSN=test;","","",0); </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> //连接叫作test的ODBC数据源</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">(3)不通过DSN对SQL SERVER数据库进行连接：</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">m_pConnection-&gt;Open("driver={SQL Server};Server=127.0.0.1;DATABASE=vckbase;UID=sa;PWD=139","","",adModeUnknown);</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">其中Server是SQL服务器的名称，DATABASE是库的名称</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">◆先介绍Connection对象中两个有用的属性ConnectionTimeOut与State</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">ConnectionTimeOut用来设置连接的超时时间，需要在Open之前调用，例如:</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> m_pConnection-&gt;ConnectionTimeout = 5; //设置超时时间为5秒</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> m_pConnection-&gt;Open("Data Source=adotest;","","",adModeUnknown);</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">State属性指明当前Connection对象的状态，0表示关闭，1表示已经打开，我们可以通过</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">读取这个属性来作相应的处理，例如:</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">if(m_pConnection-&gt;State)</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> m_pConnection-&gt;Close(); //如果已经打开了连接则关闭它</span><br> </span></span></p> 
<p><span style="font-family:Arial; font-size:14px; color:#333333"><span style="line-height:26px"><strong><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><br> </span></strong></span></span></p> 
<p><span style="font-family:Arial; font-size:14px; color:#333333"><span style="line-height:26px"><strong><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">********************************************************************************************************************</span></strong></span></span></p> 
<p><span style="font-family:Arial; font-size:14px; color:#333333"><span style="line-height:26px"><strong><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><br> </span></strong></span></span></p> 
<p><span style="font-family:Arial; font-size:14px; color:#333333"><span style="line-height:26px"><strong><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">连接上数据库之后，就要<span style="color:rgb(255,0,0); font-family:Arial; font-size:16px; line-height:26px">执行SQL命令并取得结果记录集</span></span></strong></span></span></p> 
<p><span style="font-family:Arial; font-size:14px; color:#333333"><span style="line-height:26px"><strong><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(255,0,0); font-family:Arial; font-size:16px; line-height:26px"><br> </span></span></strong></span></span></p> 
<p><span style="font-family:Arial; font-size:14px; color:#333333"><span style="line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(255,0,0); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">为了取得结果记录集，我们定义一个指向Recordset对象的指针:</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> _RecordsetPtr m_pRecordset;</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">并为其创建Recordset对象的实例: </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> m_pRecordset.CreateInstance("ADODB.Recordset");</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">SQL命令的执行可以采用多种形式，下面我们一进行阐述。</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">◆(1)利用Connection对象的Execute方法执行SQL命令</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">Execute方法的原型如下所示:</span><br> </span></span></span></span></p> 
<p><span style="font-family:Arial; font-size:14px; color:#333333"><span style="line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(255,0,0); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">Execute (_bstr_t CommandText, VARIANT * RecordsAffected, long Options )</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">其中</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> CommandText </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> 是命令字串，通常是SQL命令。</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> RecordsAffected </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> 是操作完成后所影响的行数,</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> Options </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> 表示CommandText中内容的类型，Options可以取如下值之一：</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> adCmdText: </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> 表明CommandText是文本命令</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> adCmdTable: </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> 表明CommandText是一个表名</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> adCmdProc: </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> 表明CommandText是一个存储过程</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> adCmdUnknown: 未知</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">Execute执行完后返回一个指向记录集的指针，下面我们给出具体代码并作说明。 </span><br> </span></span></span></span></span></p> 
<p><span style="font-family:Arial; font-size:14px; color:#333333"><span style="line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(255,0,0); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><br> </span></span></span></span></span></span></p> 
<p><span style="font-family:Arial; font-size:14px; color:#333333"><span style="line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(255,0,0); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">try</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">{<!-- --></span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">_variant_t ra;</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">m_pConnection-&gt;Execute("CREATE TABLE student(Sno INTEGER,Sname TEXT,Ssex TEXT,Sage INTEGER,Sdept TEXT)",&amp;ra,adCmdText);</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">m_pConnection-&gt;Execute("INSERT INTO 学生信息(学号,姓名,年龄,生日) VALUES (112105, '程红秀',22,'1982-08-16')",&amp;ra,adCmdText);//往表格里面添加记录</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">m_pRecordset = m_pConnection-&gt;Execute("SELECT COUNT(*) FROM 学生信息",&amp;ra,adCmdText); </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">//执行SQL统计命令得到包含记录条数的记录集</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">_variant_t vCount = m_pRecordset-&gt;GetCollect((_variant_t)(long)(0)); //取得第一个字段的值放入vCount变量</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">m_pRecordset-&gt;Close();</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">CString message;</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">message.Format("共有%d条记录",vCount.lVal);</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">AfxMessageBox(message); </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">}</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">catch (_com_error e)</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">{ ...}</span><br> </span></span></span></span></span></span></p> 
<p><span style="font-family:Arial; font-size:14px; color:#333333"><span style="line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(255,0,0); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">···········································································································</span></span></span></span></span></span></span></p> 
<p><span style="font-family:Arial; font-size:14px; color:#333333"><span style="line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(255,0,0); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">(3)直接用Recordset对象进行查询取得记录集（这种方法是用的比较多的，文章开头就是这种方法）</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">例如</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> m_pRecordset-&gt;Open("SELECT * FROM 学生信息",_variant_t((IDispatch *)m_pConnection,true),adOpenStatic,adLockOptimistic,adCmdText);</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">Open方法的原型是这样的:</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">HRESULT Recordset15::Open ( const _variant_t &amp; Source, const _variant_t &amp; ActiveConnection, enum CursorTypeEnum CursorType, enum LockTypeEnum LockType, long Options )</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">其中：</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">①Source是数据查询字符串</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">②ActiveConnection是已经建立好的连接（我们需要用Connection对象指针来构造一个_variant_t对象)</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">③CursorType光标类型，它可以是以下值之一,请看这个枚举结构:</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> enum CursorTypeEnum</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> {<!-- --></span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> adOpenUnspecified = -1, //不作特别指定</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> adOpenForwardOnly = 0, //前滚静态光标。这种光标只能向前浏览记录集，比如用MoveNext向前滚动,这种方式可以提高浏览速度。但诸如BookMark,RecordCount,AbsolutePosition,AbsolutePage都不能使用</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> adOpenKeyset = 1, </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> //采用这种光标的记录集看不到其它用户的新增、删除操作，但对于更新原有记录的操作对你是可见的。</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> adOpenDynamic = 2, </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> //动态光标。所有数据库的操作都会立即在各用户记录集上反应出来。</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> adOpenStatic = 3 </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> //静态光标。它为你的记录集产生一个静态备份，但其它用户的新增、删除、更新操作对你的记录集来说是不可见的。</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> };</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">④LockType锁定类型，它可以是以下值之一，请看如下枚举结构：</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> enum LockTypeEnum</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> {<!-- --></span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> adLockUnspecified = -1, </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> //未指定</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> adLockReadOnly = 1, </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> //只读记录集</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> adLockPessimistic = 2, </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> //悲观锁定方式。数据在更新时锁定其它所有动作，这是最安全的锁定机制</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> adLockOptimistic = 3, </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> //乐观锁定方式。只有在你调用Update方法时才锁定记录。在此之前仍然可以做数据的更新、插入、删除等动作</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> adLockBatchOptimistic = 4， //乐观分批更新。编辑时记录不会锁定，更改、插入及删除是在批处理模式下完成。</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> };</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">⑤Options请参考本文中对Connection对象的Execute方法的介绍</span><br> </span></span></span></span></span></span></span></p> 
<p><span style="font-family:Arial; font-size:14px; color:#333333"><span style="line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(255,0,0); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">················································································································</span></span></span></span></span></span></span></span></p> 
<p><span style="font-family:Arial; font-size:14px; color:#333333"><span style="line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(255,0,0); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">以下的代码实现：打开记录集，遍历所有记录，删除第一条记录，添加三条记录，移动光标到第二条</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">记录，更改其年龄，保存到数据库。</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">try</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">{<!-- --></span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> _variant_t vUsername,vBirthday,vID,vOld;</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> _RecordsetPtr m_pRecordset;</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> m_pRecordset.CreateInstance("ADODB.Recordset");</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> m_pRecordset-&gt;Open("SELECT * FROM 学生信息",_variant_t((IDispatch*)m_pConnection,true),adOpenStatic,adLockOptimistic,adCmdText);</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> while(!m_pRecordset-&gt;adoEOF)</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> {<!-- --></span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> vID = m_pRecordset-&gt;GetCollect(_variant_t((long)0)); </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> //取得第1列的值,从0开始计数，你也可以直接给出列的名称，如下一行</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> vUsername = m_pRecordset-&gt;GetCollect("姓名"); </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> //取得姓名字段的值</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> vOld = m_pRecordset-&gt;GetCollect("年龄");</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> vBirthday = m_pRecordset-&gt;GetCollect("生日");</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> TRACE("id:%d,姓名:%s,年龄:%d,生日:%s\r\n",</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> vID.lVal,</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> (LPCTSTR)(_bstr_t)vUsername,</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> vOld.lVal,</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> (LPCTSTR)(_bstr_t)vBirthday); </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> //在DEBUG方式下的OUTPUT窗口输出记录集中的记录</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> m_pRecordset-&gt;MoveNext(); </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> //移到下一条记录</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> }</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> m_pRecordset-&gt;MoveFirst(); </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> //移到首条记录</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> m_pRecordset-&gt;Delete(adAffectCurrent); </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> //删除当前记录</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> for(int i=0;i&lt;3;i++) </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> //添加三条新记录并赋值</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> {<!-- --></span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> m_pRecordset-&gt;AddNew(); </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> //添加新记录</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> m_pRecordset-&gt;PutCollect("学号",_variant_t((long)(i+10)));</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> m_pRecordset-&gt;PutCollect("姓名",_variant_t("王斌年"));</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> m_pRecordset-&gt;PutCollect("年龄",_variant_t((long)21));</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> m_pRecordset-&gt;PutCollect("生日",_variant_t("1930-3-15"));</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> }</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> m_pRecordset-&gt;Move(1,_variant_t((long)adBookmarkFirst)); </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> //从第一条记录往下移动一条记录,即移动到第二条记录处</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> m_pRecordset-&gt;PutCollect(_variant_t("年龄"),_variant_t((long)45)); </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> //修改其年龄</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> m_pRecordset-&gt;Update(); </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> //保存到库中</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">} catch (_com_error e){}</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="font-family:Arial; font-size:16px; line-height:26px; color:rgb(255,0,0)">关闭记录集与连接</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">记录集或连接都可以用Close方法来关闭 </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">m_pRecordset-&gt;Close(); //关闭记录集 </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">m_pConnection-&gt;Close(); //关闭连接</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">在stdafx.h中进行宏定义:</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">#if !defined CATCH_ERROR</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">#define CATCH_ERROR </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> \</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> { </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> \</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> CString strComError; </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> \</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> strComError.Format("错误编号: %08lx\n错误信息: %s\n错误源: %s\n错误描述: %s", \</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> e.Error(), </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> \</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> e.ErrorMessage(), </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> \</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> (LPCSTR) e.Source(), </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> \</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">  </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> (LPCSTR) e.Description()); </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> \</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> ::MessageBox(NULL,strComError,"错误",MB_ICONEXCLAMATION); \</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> }</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">#endif</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">使用方法：</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">try</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">{ </span><wbr style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"></wbr><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> ...}</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">catch(_com_error e)</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">{<!-- --></span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">CATCH_ERROR;</span><br style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"> <span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">}</span><br> </span></span></span></span></span></span></span></span></p> 
<p><span style="font-family:Arial; font-size:14px; color:#333333"><span style="line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(255,0,0); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><br> </span></span></span></span></span></span></span></span></span></p> 
<p><span style="font-family:Arial; font-size:14px; color:#333333"><span style="line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(255,0,0); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px"><span style="color:rgb(51,51,51); font-family:Arial; font-size:16px; line-height:26px">***********************************************************************************************************************************</span></span></span></span></span></span></span></span></span></p> 
<p><span style="font-family:Arial; font-size:14px; color:#333333"><span style="line-height:26px">看下面一篇文章：</span></span></p> 
<p><span style="font-family:Arial; font-size:14px; color:#333333"><span style="line-height:26px">为什么加上Close()后程序崩溃，是不是因为Open是打开记录集的函数，但是strSQL语句里是个删除语句，它虽然把这条语句执行了，但是却没有得到记录集，因为它不是select * from,所以得不到查询结果的记录集。如果再关闭的话，程序就崩溃。。不知道这样理解对不对，意思就是说：虽然这用m_pRecordset的Open方法也能实现删除，但是这种方法不对。应该是真正意义上的打开，就是select * from 表,然后再执行添加，删除，修改等。。。。就象下面这样的写法。。。<br> <br> void C数据库测试Dlg::OnBnClickedDelBtn()<br> {<!-- --><br>   int index = m_ListCtrl.GetNextItem(-1, LVNI_SELECTED | LVNI_ALL);<br>   if (index == -1)<br>   {<!-- --><br>   AfxMessageBox(_T("请选择要删除的项!"));<br>   return;<br>   }<br>   CString str = m_ListCtrl.GetItemText(index, 1);<br>   strSQL.Format(_T("select * from customerType"));<br>   m_pRecordset-&gt;Open((_bstr_t)strSQL, m_pConnect.GetInterfacePtr(), adOpenDynamic, adLockOptimistic, adCmdText);<br>   strSQL.Format(_T("delete from customerType where ctypeName = '%s'"), str);<br>   m_pConnect-&gt;Execute((_bstr_t)strSQL, NULL, adCmdText);<br>   m_pRecordset-&gt;Close();<br>   OnInitGird();<br> }<br> 这样才真正的先打开记录集，再执行sql语句，再关闭记录集。。。这种方法才是正确的吧？？？不知道我的理解对不对？？？如果不对，那么应该咋理解。。刚学，什么都不懂！！！<br> <br> <span style="color:rgb(231,134,8)">------解决方案--------------------</span><br> 执行update insert delete语句时用m_pConnect-&gt;Execute,<br> 因为这些语句不返回数据,只会返回影响的行数.<br> <br> 执行select语句时用m_pRecordset-&gt;Open,<br> 也可以用m_pRecordset=m_pConnect-&gt;Execute.<br> <br> <span style="color:rgb(231,134,8)">------解决方案--------------------</span><br> DELETE语句执行后返回记录集是关闭的，再调用Close就会出错。<br> 加异常捕获就清楚了。<br> </span></span></p> 
<dl class="code">
  C/C++ code 
 <pre>try
{
//你的ADO代码
}
catch (_com_error&amp; e)
{
CString strMsg;
strMsg.Format(_T("错误描述：%s\n错误消息%s", 
        (LPCTSTR)e.Description(),
        (LPCTSTR)e.ErrorMessage());
AfxMessageBox(strMsg);
}

<span style="color:rgb(231,134,8)">------解决方案--------------------</span>

第一种方法Open函数会执行相应的SQL语句
而你的SQL语句就是删除语句
这个语句会执行但是打开记录集的操作不会成功
再关闭就是会失败了

执行Execute不需要先Open </pre> 
</dl> 
<br> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4ff838045828beb1c49abbf3829188db/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">.net英文笔试题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/259d2e11cd9641a0ce46ea8445b2b8e7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">xode5</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>