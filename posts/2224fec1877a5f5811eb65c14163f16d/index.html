<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ubuntu16.04安装caffe以及各种问题汇总 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ubuntu16.04安装caffe以及各种问题汇总" />
<meta property="og:description" content="本文参考了： https://github.com/BVLC/caffe/wiki/Ubuntu-16.04-or-15.10-Installation-Guide https://gist.github.com/wangruohui/679b05fcd1466bb0937f#file-caffe-ubuntu-15-10-md http://blog.csdn.net/g0m3e/article/details/51420565
前言： 本文是基于已经成功安装了python各种常用包、opencv、cuda
安装过程 1、首先安装各种更新包 sudo apt-get update sudo apt-get upgrade sudo apt-get install -y build-essential cmake git pkg-config sudo apt-get install -y libprotobuf-dev libleveldb-dev libsnappy-dev libhdf5-serial-dev protobuf-compiler sudo apt-get install -y libatlas-base-dev sudo apt-get install -y --no-install-recommends libboost-all-dev sudo apt-get install -y libgflags-dev libgoogle-glog-dev liblmdb-dev sudo apt-get install -y python-pip sudo apt-get install -y python-dev sudo apt-get install -y python-numpy python-scipy sudo apt-get install -y libopencv-dev 2、下载caffe cd ~ mkdir git //在home下新建一个git文件夹，用来存放那些从github上git下来的文zong件 git clone https://github." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/2224fec1877a5f5811eb65c14163f16d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-06-29T16:19:18+08:00" />
<meta property="article:modified_time" content="2016-06-29T16:19:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ubuntu16.04安装caffe以及各种问题汇总</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>本文参考了： <br> <a href="https://github.com/BVLC/caffe/wiki/Ubuntu-16.04-or-15.10-Installation-Guide">https://github.com/BVLC/caffe/wiki/Ubuntu-16.04-or-15.10-Installation-Guide</a> <br> <a href="https://gist.github.com/wangruohui/679b05fcd1466bb0937f#file-caffe-ubuntu-15-10-md" rel="nofollow">https://gist.github.com/wangruohui/679b05fcd1466bb0937f#file-caffe-ubuntu-15-10-md</a> <br> <a href="http://blog.csdn.net/g0m3e/article/details/51420565">http://blog.csdn.net/g0m3e/article/details/51420565</a></p> 
<p>前言： <br> 本文是基于已经成功安装了python各种常用包、opencv、cuda</p> 
<h2 id="安装过程">安装过程</h2> 
<h4 id="1首先安装各种更新包">1、首先安装各种更新包</h4> 
<pre class="prettyprint"><code class="language-conmmand hljs lasso">sudo apt<span class="hljs-attribute">-get</span> update

sudo apt<span class="hljs-attribute">-get</span> upgrade

sudo apt<span class="hljs-attribute">-get</span> install <span class="hljs-attribute">-y</span> build<span class="hljs-attribute">-essential</span> cmake git pkg<span class="hljs-attribute">-config</span>

sudo apt<span class="hljs-attribute">-get</span> install <span class="hljs-attribute">-y</span> libprotobuf<span class="hljs-attribute">-dev</span> libleveldb<span class="hljs-attribute">-dev</span> libsnappy<span class="hljs-attribute">-dev</span> libhdf5<span class="hljs-attribute">-serial</span><span class="hljs-attribute">-dev</span> protobuf<span class="hljs-attribute">-compiler</span>

sudo apt<span class="hljs-attribute">-get</span> install <span class="hljs-attribute">-y</span> libatlas<span class="hljs-attribute">-base</span><span class="hljs-attribute">-dev</span>

sudo apt<span class="hljs-attribute">-get</span> install <span class="hljs-attribute">-y</span> <span class="hljs-subst">--</span>no<span class="hljs-attribute">-install</span><span class="hljs-attribute">-recommends</span> libboost<span class="hljs-attribute">-all</span><span class="hljs-attribute">-dev</span>

sudo apt<span class="hljs-attribute">-get</span> install <span class="hljs-attribute">-y</span> libgflags<span class="hljs-attribute">-dev</span> libgoogle<span class="hljs-attribute">-glog</span><span class="hljs-attribute">-dev</span> liblmdb<span class="hljs-attribute">-dev</span>

sudo apt<span class="hljs-attribute">-get</span> install <span class="hljs-attribute">-y</span> python<span class="hljs-attribute">-pip</span>

sudo apt<span class="hljs-attribute">-get</span> install <span class="hljs-attribute">-y</span> python<span class="hljs-attribute">-dev</span>
sudo apt<span class="hljs-attribute">-get</span> install <span class="hljs-attribute">-y</span> python<span class="hljs-attribute">-numpy</span> python<span class="hljs-attribute">-scipy</span>

sudo apt<span class="hljs-attribute">-get</span> install <span class="hljs-attribute">-y</span> libopencv<span class="hljs-attribute">-dev</span>
</code></pre> 
<h4 id="2下载caffe">2、下载caffe</h4> 
<pre class="prettyprint"><code class=" hljs php">cd ~
mkdir git  <span class="hljs-comment">//在home下新建一个git文件夹，用来存放那些从github上git下来的文zong件</span>
git <span class="hljs-keyword">clone</span> https:<span class="hljs-comment">//github.com/BVLC/caffe.git    //从github上git caffe</span></code></pre> 
<h4 id="3开始安装">3、开始安装</h4> 
<pre class="prettyprint"><code class=" hljs avrasm">cd caffe    //打开到刚刚git下来的caffe
<span class="hljs-keyword">cp</span> Makefile<span class="hljs-preprocessor">.config</span><span class="hljs-preprocessor">.example</span> Makefile<span class="hljs-preprocessor">.config</span> //将Makefile<span class="hljs-preprocessor">.config</span><span class="hljs-preprocessor">.example</span>的内容复制到Makefile<span class="hljs-preprocessor">.config</span>
//因为make指令只能make   Makefile<span class="hljs-preprocessor">.config</span>文件，而Makefile<span class="hljs-preprocessor">.config</span><span class="hljs-preprocessor">.example</span>是caffe给出的makefile例子
gedit Makefile<span class="hljs-preprocessor">.config</span>      //打开Makefile<span class="hljs-preprocessor">.config</span>文件</code></pre> 
<p>仔细阅读makefile中的注释语句其实就知道该怎么操作了，为了方便理解，笔者还是介绍一各个配置说明。 <br> 在打开的Makefile.config修改如下内容：</p> 
<pre class="prettyprint"><code class=" hljs livecodeserver">//如果你不使用GPU的话，就将
<span class="hljs-comment"># CPU_ONLY := 1</span>
修改成：
CPU_ONLY := <span class="hljs-number">1</span>
<span class="hljs-comment">
//若使用cudnn，则将</span>
<span class="hljs-comment"># USE_CUDNN := 1</span>
修改成：
USE_CUDNN := <span class="hljs-number">1</span>
<span class="hljs-comment">
//若使用的opencv版本是3的，则将</span>
<span class="hljs-comment"># OPENCV_VERSION := 3</span>
修改为：
OPENCV_VERSION := <span class="hljs-number">3</span>
<span class="hljs-comment">
//若要使用python来编写layer，则需要将</span>
<span class="hljs-comment"># WITH_PYTHON_LAYER := 1</span>
修改为
WITH_PYTHON_LAYER := <span class="hljs-number">1</span>
<span class="hljs-comment">
//重要的一项</span>
将<span class="hljs-comment"># Whatever else you find you need goes here.下面的</span>
INCLUDE_DIRS := $(PYTHON_INCLUDE) /usr/<span class="hljs-built_in">local</span>/<span class="hljs-built_in">include</span>
LIBRARY_DIRS := $(PYTHON_LIB) /usr/<span class="hljs-built_in">local</span>/lib /usr/lib
修改为：
INCLUDE_DIRS :=  $(PYTHON_INCLUDE) /usr/<span class="hljs-built_in">local</span>/<span class="hljs-built_in">include</span> /usr/<span class="hljs-built_in">include</span>/hdf5/serial
LIBRARY_DIRS := $(PYTHON_LIB) /usr/<span class="hljs-built_in">local</span>/lib /usr/lib /usr/lib/x86_64-linux-gnu /usr/lib/x86_64-linux-gnu/hdf5/serial<span class="hljs-comment">
//这是因为ubuntu16.04的文件包含位置发生了变化，尤其是需要用到的hdf5的位置，所以需要更改这一路径</span></code></pre> 
<h4 id="4为hdf5之类的文件创建新的链接">4、为hdf5之类的文件创建新的链接</h4> 
<pre class="prettyprint"><code class=" hljs lasso"><span class="hljs-subst">\\</span>首先执行下面两句话：
find <span class="hljs-built_in">.</span> <span class="hljs-attribute">-type</span> f <span class="hljs-attribute">-exec</span> sed <span class="hljs-attribute">-i</span> <span class="hljs-attribute">-e</span> <span class="hljs-string">'s^"hdf5.h"^"hdf5/serial/hdf5.h"^g'</span> <span class="hljs-attribute">-e</span> <span class="hljs-string">'s^"hdf5_hl.h"^"hdf5/serial/hdf5_hl.h"^g'</span> <span class="hljs-string">'{}'</span> <span class="hljs-subst">\</span>;

cd /usr/lib/x86_64<span class="hljs-attribute">-linux</span><span class="hljs-attribute">-gnu</span>

<span class="hljs-subst">\\</span>然后根据情况执行下面两句：
sudo ln <span class="hljs-attribute">-s</span> libhdf5_serial<span class="hljs-built_in">.</span>so<span class="hljs-number">.10</span><span class="hljs-number">.1</span><span class="hljs-number">.0</span> libhdf5<span class="hljs-built_in">.</span>so
sudo ln <span class="hljs-attribute">-s</span> libhdf5_serial_hl<span class="hljs-built_in">.</span>so<span class="hljs-number">.10</span><span class="hljs-number">.0</span><span class="hljs-number">.2</span> libhdf5_hl<span class="hljs-built_in">.</span>so
<span class="hljs-subst">\\</span>注意：这里的<span class="hljs-number">10.1</span><span class="hljs-number">.0</span>和<span class="hljs-number">10.0</span><span class="hljs-number">.2</span>根据不同的系统可能对应的数字会不同，比如在ubuntu15<span class="hljs-number">.10</span>中其数字就是<span class="hljs-number">8.0</span><span class="hljs-number">.2</span><span class="hljs-built_in">.</span>
<span class="hljs-subst">\\</span>具体的数字可以在打开的文件中查看对应文件后面跟的数字</code></pre> 
<h4 id="5执行python文件夹下的指令">5、执行python文件夹下的指令</h4> 
<pre class="prettyprint"><code class=" hljs bash">\\现在将目录<span class="hljs-built_in">cd</span>到你之前git的caffe文件夹下：

<span class="hljs-built_in">cd</span> python

<span class="hljs-keyword">for</span> req <span class="hljs-keyword">in</span> $(cat requirements.txt); <span class="hljs-keyword">do</span> pip install <span class="hljs-variable">$req</span>; <span class="hljs-keyword">done</span>

\\如果发现执行上述代码后，终端中有很多红字，一堆的错误之类的，那不管是什么错误都执行下面一句话：
<span class="hljs-keyword">for</span> req <span class="hljs-keyword">in</span> $(cat requirements.txt); <span class="hljs-keyword">do</span> <span class="hljs-built_in">sudo</span> -H pip install <span class="hljs-variable">$req</span> --upgrade; <span class="hljs-keyword">done</span>
\\执行完上面这句话后应该就不会有很多红字错误了</code></pre> 
<h4 id="6make-各种文件">6、make 各种文件</h4> 
<pre class="prettyprint"><code class=" hljs go">cd ..   \\此时位置应该处于caffe文件夹下

<span class="hljs-built_in">make</span> all -j8  <span class="hljs-comment">//j8代表计算机cpu有8个核，因此可以多线程一起make，这样make的速度会快很多。一般常用的还有j4</span>

<span class="hljs-built_in">make</span> test -j8

<span class="hljs-built_in">make</span> runtest -j8

<span class="hljs-built_in">make</span> pycaffe   <span class="hljs-comment">//如果以后用python来开发的话必须执行这一句，一般不管你是否用python，都会执行这一句</span>

<span class="hljs-built_in">make</span> distribute</code></pre> 
<p>至此，安装caffe差不都就已经完成了。但是笔者在安装的过程中，遇到了各种各样问题，有时候解决了这个问题，那个问题又出现了，几近崩溃的边缘，究其原因还是对ubuntu这个系统熟悉。笔者在遇到问题google的时候都将界面留存了下来，下面罗列一下遇到问题以及解决方式。</p> 
<h2 id="caffe安装错误集锦">caffe安装错误集锦</h2> 
<h4 id="1">1</h4> 
<p>在make all 的时候出现如下错误</p> 
<pre class="prettyprint"><code class=" hljs vhdl">Error <span class="hljs-attribute">'fatal</span> error: pyconfig.h: No such <span class="hljs-keyword">file</span> <span class="hljs-keyword">or</span> directory' <span class="hljs-keyword">when</span> executing <span class="hljs-attribute">'make</span> pycaffe' <span class="hljs-keyword">on</span> dev-branch #<span class="hljs-number">410</span></code></pre> 
<p>解决方案：</p> 
<pre class="prettyprint"><code class=" hljs cmake">make clean
<span class="hljs-keyword">export</span> CPLUS_INCLUDE_PATH=/usr/<span class="hljs-keyword">include</span>/python2.<span class="hljs-number">7</span>
make all -j8</code></pre> 
<h4 id="2">2</h4> 
<pre class="prettyprint"><code class=" hljs d"><span class="hljs-built_in">string</span>.h ‘memcy’ was not declared <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span> <span class="hljs-keyword">scope</span></code></pre> 
<p>解决方案：打开makefile搜索并替换</p> 
<pre class="prettyprint"><code class=" hljs lasso">NVCCFLAGS <span class="hljs-subst">+=</span> <span class="hljs-attribute">-ccbin</span><span class="hljs-subst">=</span>$(CXX) <span class="hljs-attribute">-Xcompiler</span> <span class="hljs-attribute">-fPIC</span> $(COMMON_FLAGS)
</code></pre> 
<p>为</p> 
<pre class="prettyprint"><code class=" hljs lasso">NVCCFLAGS <span class="hljs-subst">+=</span> <span class="hljs-attribute">-D_FORCE_INLINES</span> <span class="hljs-attribute">-ccbin</span><span class="hljs-subst">=</span>$(CXX) <span class="hljs-attribute">-Xcompiler</span> <span class="hljs-attribute">-fPIC</span> $(COMMON_FLAGS)</code></pre> 
<p>保存退出</p> 
<p>重新make</p> 
<h4 id="3">3</h4> 
<p>类似以下情况的错误：</p> 
<pre class="prettyprint"><code class=" hljs cpp">.build_release/lib/libcaffe.so: undefined reference to `cv::imread(cv::String <span class="hljs-keyword">const</span>&amp;, <span class="hljs-keyword">int</span>)'
.build_release/lib/libcaffe.so: undefined reference to `cv::imencode(cv::String <span class="hljs-keyword">const</span>&amp;, cv::_InputArray <span class="hljs-keyword">const</span>&amp;, <span class="hljs-built_in">std</span>::<span class="hljs-stl_container"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>, <span class="hljs-built_in">std</span>::allocator&lt;<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span>&gt;</span> &gt;&amp;, <span class="hljs-built_in">std</span>::<span class="hljs-stl_container"><span class="hljs-built_in">vector</span>&lt;<span class="hljs-keyword">int</span>, <span class="hljs-built_in">std</span>::allocator&lt;<span class="hljs-keyword">int</span>&gt;</span> &gt; <span class="hljs-keyword">const</span>&amp;)'</code></pre> 
<p>这种问题很有可能是你的系统中使用的是opencv3，但是你的Makefile.config中没有将OPENCV_VERSION := 3这一句取消注释。</p> 
<h4 id="4">4</h4> 
<p>出现各种undefined referenceserrors，比如：</p> 
<pre class="prettyprint"><code class=" hljs css"><span class="hljs-tag">undefined</span> <span class="hljs-tag">reference</span> <span class="hljs-tag">togoogle</span><span class="hljs-pseudo">::base</span><span class="hljs-pseudo">::CheckOpMessageBuilder</span><span class="hljs-pseudo">::NewString()'</span></code></pre> 
<p>这类问题往往是因为gcc和g++编译器版本的问题，在ubuntu16.04中，其默认的gcc编译器版本是gcc 5,但是cuda目前又不支持高于4.9的编译器，因此会出现不兼容的情况。</p> 
<p>解决方法： <br> 这里有一种比较暴力的解决方法，不确定是否安全。编辑<code>/usr/local/cuda/include/host_config.h</code>，将其中的第115行注释掉：</p> 
<pre class="prettyprint"><code class=" hljs lua">将
#<span class="hljs-built_in">error</span> <span class="hljs-comment">-- unsupported GNU version! gcc versions later than 4.9 are not supported!</span>

改为
//#<span class="hljs-built_in">error</span> <span class="hljs-comment">-- unsupported GNU version! gcc versions later than 4.9 are not supported!</span></code></pre> 
<p><strong>注意：查看现在的gcc编译器版本，可能有的人在之前安装cuda的时候会将默认的gcc、g++版本改成4.8之类比较老的版本，在make caffe的时候最好将gcc和g++的版本改到最新的，这样在make的时候才不会出现类似undefined references之类的错误。具体的修改方法可以google之。</strong></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/45a7f230cd690054fbe65ef5da37ab9f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">js判断图片加载完成后获取图片实际宽高</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/afc3da6bfd13f92a9aae12e21883549f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">springmvc文章分页源代码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>