<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于OpenCV的红绿灯识别 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="基于OpenCV的红绿灯识别" />
<meta property="og:description" content="基于OpenCV的红绿灯识别 技术背景 为了实现轻舟航天机器人实现红绿灯的识别，决定采用传统算法OpenCV视觉技术。
技术介绍 航天机器人的红绿灯识别主要基于传统计算机视觉技术，利用OpenCV算法对视频流进行处理，以获取红绿灯的状态信息。具体而言，该系统通过连接工控机摄像头读取视频流，将视频帧转换成HSV色彩空间的图像，以便更好地识别出图像中的红色像素。
HSV是一种将RGB色彩空间中的点在倒圆锥体中的表示方法，其中色相、饱和度和亮度分别用于描述颜色的不同属性。色调（H）用角度度量，其取值范围为0°～360°，从红色开始按逆时针方向计算，具体的光谱色如黄色、青色和品红等的色调取值为60°、180°和300°，而它们的补色则分别为青色、洋红和黄色。饱和度（S）用于描述颜色接近光谱色的程度，其取值范围为0%～100%，值越大，颜色越饱和。亮度（V）表示颜色明亮的程度，其取值范围为0%（黑）到100%（白）。
在红绿灯识别过程中，系统将视频帧转换成HSV图像后，通过筛选出所有红色像素值，利用切片技术切出图像中的红绿灯兴趣区域。接着，系统通过统计区域中红色像素块数量，设定阈值来判断红绿灯的状态，如果红色像素块数量超过阈值，则判定红绿灯为红灯闪烁，小车禁止通行；反之，如果红色像素块数量小于阈值，则判定红绿灯为绿灯闪烁，小车可以通行。
这种基于传统计算机视觉技术的红绿灯识别系统具有精度高、鲁棒性强等优点，可以在复杂的环境下准确地判断红绿灯的状态，从而为机器人的自主导航和交通安全提供可靠的技术支持。
HSV 模型的三维表示从 RGB 立方体演化而来。设想从 RGB 沿立方体对角线的白色顶点 向黑色顶点观察，就可以看到立方体的六边形外形。六边形边界表示色彩，水平轴表示纯度， 明度沿垂直轴测量。HSV 颜色空间可以用一个圆锥空间模型来描述。圆锥的顶点处，V=0，H 和 S 无定义，代表黑色。圆锥的顶面中心处 V=max，S=0，H 无定义，代表白色。
代码实现 import cv2 import numpy as np # from cv_nano3_good import Img, Video def gstreamer_pipeline( capture_width=1280, capture_height=720, display_width=1280, display_height=720, framerate=120, flip_method=0, ): return ( &#34;nvarguscamerasrc ! &#34; &#34;video/x-raw(memory:NVMM), width=(int)%d, height=(int)%d, format=(string)NV12, framerate=(fraction)%d/1! &#34; &#34;nvvidconv flip-method=%d ! &#34; &#34;video/x-raw, width=(int)%d, height=(int)%d, format=(string)BGRx ! &#34; &#34;videoconvert ! &#34; &#34;video/x-raw, format=(string)BGR !" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/31df9599a3cf710140459707ccc812f7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-23T20:51:29+08:00" />
<meta property="article:modified_time" content="2023-07-23T20:51:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于OpenCV的红绿灯识别</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="OpenCV_0"></a>基于OpenCV的红绿灯识别</h2> 
<h2><a id="_2"></a>技术背景</h2> 
<p>为了实现轻舟航天机器人实现红绿灯的识别，决定采用传统算法OpenCV视觉技术。</p> 
<h2><a id="_6"></a>技术介绍</h2> 
<p>航天机器人的红绿灯识别主要基于传统计算机视觉技术，利用OpenCV算法对视频流进行处理，以获取红绿灯的状态信息。具体而言，该系统通过连接工控机摄像头读取视频流，将视频帧转换成HSV色彩空间的图像，以便更好地识别出图像中的红色像素。</p> 
<p>HSV是一种将RGB色彩空间中的点在倒圆锥体中的表示方法，其中色相、饱和度和亮度分别用于描述颜色的不同属性。色调（H）用角度度量，其取值范围为0°～360°，从红色开始按逆时针方向计算，具体的光谱色如黄色、青色和品红等的色调取值为60°、180°和300°，而它们的补色则分别为青色、洋红和黄色。饱和度（S）用于描述颜色接近光谱色的程度，其取值范围为0%～100%，值越大，颜色越饱和。亮度（V）表示颜色明亮的程度，其取值范围为0%（黑）到100%（白）。</p> 
<p>在红绿灯识别过程中，系统将视频帧转换成HSV图像后，通过筛选出所有红色像素值，利用切片技术切出图像中的红绿灯兴趣区域。接着，系统通过统计区域中红色像素块数量，设定阈值来判断红绿灯的状态，如果红色像素块数量超过阈值，则判定红绿灯为红灯闪烁，小车禁止通行；反之，如果红色像素块数量小于阈值，则判定红绿灯为绿灯闪烁，小车可以通行。</p> 
<p>这种基于传统计算机视觉技术的红绿灯识别系统具有精度高、鲁棒性强等优点，可以在复杂的环境下准确地判断红绿灯的状态，从而为机器人的自主导航和交通安全提供可靠的技术支持。</p> 
<p>HSV 模型的三维表示从 RGB 立方体演化而来。设想从 RGB 沿立方体对角线的白色顶点 向黑色顶点观察，就可以看到立方体的六边形外形。六边形边界表示色彩，水平轴表示纯度， 明度沿垂直轴测量。HSV 颜色空间可以用一个圆锥空间模型来描述。圆锥的顶点处，V=0，H 和 S 无定义，代表黑色。圆锥的顶面中心处 V=max，S=0，H 无定义，代表白色。</p> 
<p><img src="https://images2.imgbox.com/2c/c0/FFswg1el_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_21"></a>代码实现</h2> 
<pre><code class="prism language-python">
<span class="token keyword">import</span> cv2
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token comment"># from cv_nano3_good import Img, Video</span>
<span class="token keyword">def</span> <span class="token function">gstreamer_pipeline</span><span class="token punctuation">(</span>
        capture_width<span class="token operator">=</span><span class="token number">1280</span><span class="token punctuation">,</span>
        capture_height<span class="token operator">=</span><span class="token number">720</span><span class="token punctuation">,</span>
        display_width<span class="token operator">=</span><span class="token number">1280</span><span class="token punctuation">,</span>
        display_height<span class="token operator">=</span><span class="token number">720</span><span class="token punctuation">,</span>
        framerate<span class="token operator">=</span><span class="token number">120</span><span class="token punctuation">,</span>
        flip_method<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
            <span class="token string">"nvarguscamerasrc ! "</span>
            <span class="token string">"video/x-raw(memory:NVMM), width=(int)%d, height=(int)%d, format=(string)NV12, framerate=(fraction)%d/1! "</span>
            <span class="token string">"nvvidconv flip-method=%d ! "</span>
            <span class="token string">"video/x-raw, width=(int)%d, height=(int)%d, format=(string)BGRx ! "</span>
            <span class="token string">"videoconvert ! "</span>
            <span class="token string">"video/x-raw, format=(string)BGR ! "</span>
            <span class="token string">"appsink"</span>
            <span class="token operator">%</span> <span class="token punctuation">(</span>
                capture_width<span class="token punctuation">,</span>
                capture_height<span class="token punctuation">,</span>
                framerate<span class="token punctuation">,</span>
                flip_method<span class="token punctuation">,</span>
                display_width<span class="token punctuation">,</span>
                display_height<span class="token punctuation">,</span>
            <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">extract_red</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token comment">#转换为hsv颜色空间</span>
    img_hsv<span class="token operator">=</span>cv2<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span>cv2<span class="token punctuation">.</span>COLOR_BGR2HSV<span class="token punctuation">)</span>
    rows<span class="token punctuation">,</span>cols<span class="token punctuation">,</span>channels<span class="token operator">=</span>img<span class="token punctuation">.</span>shape

    lower_red<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">156</span><span class="token punctuation">,</span><span class="token number">43</span><span class="token punctuation">,</span><span class="token number">46</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># lower_red=np.array([157,177,122])</span>
    <span class="token comment"># print(lower_red)</span>
    upper_red<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">180</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># print(upper_red)</span>
    mask1<span class="token operator">=</span>cv2<span class="token punctuation">.</span>inRange<span class="token punctuation">(</span>img_hsv<span class="token punctuation">,</span>lower_red<span class="token punctuation">,</span>upper_red<span class="token punctuation">)</span>

    <span class="token comment">#拼接两个区间</span>
    mask<span class="token operator">=</span>mask1

    <span class="token keyword">return</span> mask



<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># if cv2.VideoCapture.isOpened():</span>
        Video <span class="token operator">=</span> cv2<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span>gstreamer_pipeline<span class="token punctuation">(</span>flip_method<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>CAP_GSTREAMER<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'open cam success'</span><span class="token punctuation">)</span>
        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
            <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                    
                    ret<span class="token punctuation">,</span> Img <span class="token operator">=</span> Video<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token comment"># cap=cv2.VideoCapture("./test/light.mp4")</span>
                    <span class="token comment"># Img=cv2.imread("./test/02.jpg")</span>
                    <span class="token comment"># ret, Img = img.read()</span>
                    <span class="token comment"># cv2.imshow('./',Img)</span>
                    <span class="token comment"># print(Img.)</span>
                    img <span class="token operator">=</span> extract_red<span class="token punctuation">(</span>Img<span class="token punctuation">)</span>
                    <span class="token comment"># print(img)</span>
                    h<span class="token punctuation">,</span> w <span class="token operator">=</span> Img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> Img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
                    <span class="token comment"># print(h)</span>
                    <span class="token comment"># print(w)</span>
                    <span class="token comment"># img_cut = img[100:400, 330:600]</span>
                    img_cut<span class="token operator">=</span>img<span class="token punctuation">[</span><span class="token number">450</span><span class="token punctuation">:</span><span class="token number">600</span><span class="token punctuation">,</span><span class="token number">800</span><span class="token punctuation">:</span><span class="token number">1100</span><span class="token punctuation">]</span> <span class="token comment">#截取roi</span>
                    raw_cut <span class="token operator">=</span> Img<span class="token punctuation">[</span><span class="token number">450</span><span class="token punctuation">:</span><span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">:</span><span class="token number">1100</span><span class="token punctuation">]</span>
                    <span class="token comment"># cv2.imshow('./',raw_cut)</span>
                    <span class="token comment"># cv2.waitKey(0)</span>
                    <span class="token comment"># cv2.imshow('./',img_cut)</span>
                    <span class="token comment"># cv2.waitKey(0)</span>
                    count <span class="token operator">=</span> <span class="token number">0</span>
                    x <span class="token operator">=</span> img_cut<span class="token punctuation">[</span>np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>img_cut <span class="token operator">&gt;</span> <span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
                    count <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
                    <span class="token keyword">print</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span>
                    <span class="token keyword">if</span> count <span class="token operator">&gt;=</span> <span class="token number">1500</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'red'</span><span class="token punctuation">)</span>
                        <span class="token comment"># green_light.publish(False)</span>
                    <span class="token keyword">else</span><span class="token punctuation">:</span>
                        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'green'</span><span class="token punctuation">)</span>
                    <span class="token comment"># cv2.waitKey(30)</span>
                        <span class="token comment"># green_light.publish(True) </span>
           



</code></pre> 
<h3><a id="_118"></a>实现思路：</h3> 
<p>调取工控机摄像头读取视频流，将图像转成<br> HSV 通道，筛选出图像中的所有红色的像素值，再利用切片切出图像的兴趣区域，即红绿灯的所在图像<br> 区域，最后统计区域中的红色像素块数量并设定阈值，超过此阈值则可判定红绿灯为红灯闪烁，小车禁<br> 止通行，低于此阈值则可判定红绿灯为绿灯闪烁， 小车可以通行。</p> 
<h3><a id="_125"></a>具体代码逻辑</h3> 
<p>这段代码的主要功能是从摄像头或视频流中读取图像，对图像进行红色像素的筛选和统计，以判断红绿灯的状态并输出结果。具体实现过程如下：</p> 
<ol><li>首先定义了一个函数gstreamer_pipeline，用于设置摄像头或视频流的参数，包括分辨率、帧率、翻转方式等。</li><li>接着定义了一个名为extract_red的函数，用于从图像中提取红色像素。该函数首先将图像从BGR色彩空间转换为HSV色彩空间，然后通过设置上下阈值提取红色像素。</li><li>在主程序中，通过调用cv2.VideoCapture函数连接摄像头或视频流，并循环读取图像。对于每一帧图像，首先调用extract_red函数提取红色像素，然后截取图像中的兴趣区域（即红绿灯的所在图像区域），并统计区域中红色像素块数量。如果红色像素块数量超过预设阈值，则判定红绿灯为红灯闪烁，否则判定为绿灯闪烁。</li><li>在输出判断结果后，程序会继续循环读取下一帧图像，直到程序被手动中断。</li></ol> 
<p>总的来说，该段代码主要实现了利用OpenCV对摄像头或视频流中的图像进行红绿灯状态判断的功能，其中最核心的部分是对红色像素的筛选和区域中红色像素块数量的统计。</p> 
<h2><a id="_136"></a>总结</h2> 
<p>本文介绍了轻舟航天机器人实现红绿灯识别的技术背景和介绍。该系统利用OpenCV算法对视频流进行处理，识别出图像中的红色像素，并设定阈值来判断红绿灯的状态。该系统具有精度高、鲁棒性强等优点，可以为机器人的自主导航和交通安全提供技术支持。文章还介绍了HSV颜色空间的三维表示和代码实现过程仅供了解。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f40f74603d0aa5986a9937f91eb8f3b6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Git学习记录之一Git常用命令</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6d94c0117ad92433f8f6b99661514118/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Ubuntu下打开QtCreator环境变量LD_LIBRARY_PATH与终端不一致</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>