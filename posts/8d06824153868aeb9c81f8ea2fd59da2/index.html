<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Nginx基础知识(个人总结) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Nginx基础知识(个人总结)" />
<meta property="og:description" content="声明: 1. 本文为我的个人复习总结, 并非那种从零基础开始普及知识 内容详细全面, 言辞官方的文章
2. 由于是个人总结, 所以用最精简的话语来写文章
3. 若有错误不当之处, 请指出
Nginx C语言编写, 战斗民族俄罗斯人所创, 是高性能的 HTTP 和反向代理的Web服务器，处理高并发能力是十分强大的，,有报告表明能支持高达 50,000 个并发连接数
启动与关闭:
cd /usr/local/nginx/sbin
​ ./nginx -v
​ ./nginx
​ ./nginx -s stop
​ ./nginx -s reload
配置文件:
cd /usr/local/nginx/conf/nginx.conf
全局块：配置服务器整体运行的配置指令
比如 worker_processes 2 worker个数,建议分配和CPU核数一样的数量events 块：影响 Nginx 服务器与用户的网络连接
比如 worker_connections 1024 支持的最大连接数为 1024http 块:
还包含两部分：http 全局块与server 块 三大作用: 反向代理, 负载均衡, 动静分离
1. 反向代理 反向代理配置
2. 负载均衡 负载均衡配置
负载均衡策略
第一种 轮询（默认）" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/8d06824153868aeb9c81f8ea2fd59da2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-07T22:03:20+08:00" />
<meta property="article:modified_time" content="2022-03-07T22:03:20+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Nginx基础知识(个人总结)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>    <strong>声明:</strong> 1. 本文为我的个人复习总结, 并<strong>非</strong>那种从零基础开始普及知识 <strong>内容详细全面</strong>, <strong>言辞官方</strong>的文章<br>               2. 由于是个人总结, 所以用最精简的话语来写文章<br>               3. 若有错误不当之处, 请指出</p> 
<ul><li> <p>Nginx C语言编写, 战斗民族俄罗斯人所创, 是高性能的 HTTP 和反向代理的Web服务器，处理高并发能力是十分强大的，,有报告表明能支持高达 50,000 个并发连接数</p> </li><li> <p>启动与关闭:</p> <p>cd /usr/local/nginx/sbin</p> <p>​ ./nginx -v</p> <p>​ ./nginx</p> <p>​ ./nginx -s stop</p> </li></ul> 
<p>​ ./nginx -s reload</p> 
<ul><li> <p>配置文件:</p> <p>cd /usr/local/nginx/conf/nginx.conf</p> 
  <blockquote> 
   <ol><li>全局块：配置服务器整体运行的配置指令<br> 比如 worker_processes 2 worker个数,建议分配和CPU核数一样的数量</li><li>events 块：影响 Nginx 服务器与用户的网络连接<br> 比如 worker_connections 1024 支持的最大连接数为 1024</li><li>http 块:<br> 还包含两部分：http 全局块与server 块</li></ol> 
  </blockquote> </li><li> <p>三大作用: 反向代理, 负载均衡, 动静分离</p> </li></ul> 
<h2><a id="1__30"></a>1. 反向代理</h2> 
<ul><li> <p>反向代理配置</p> 
  <blockquote> 
   <p><img src="https://images2.imgbox.com/ab/ad/uHYKAogN_o.png" alt="在这里插入图片描述"></p> 
  </blockquote> </li></ul> 
<h2><a id="2__37"></a>2. 负载均衡</h2> 
<ul><li> <p>负载均衡配置</p> 
  <blockquote> 
   <p><img src="https://images2.imgbox.com/79/99/I47fhSHx_o.png" alt="在这里插入图片描述"></p> 
  </blockquote> </li><li> <p>负载均衡策略</p> 
  <blockquote> 
   <ul><li>第一种 轮询（默认）<br> 每个请求按时间顺序逐一分配到不同的后端服务器，<strong>如果后端服务器 down 掉，能自动剔除</strong>。</li><li>第二种 weight<br> weight 代表权重默认为 1,权重越高被分配的客户端越多</li><li>第三种 ip_hash<br> 每个请求按访问 ip 的 hash 结果分配，这样每个访客固定访问一个后端服务器</li><li>第四种 fair（第三方）<br> 按后端服务器的响应时间来分配请求，响应时间短的优先分配。</li></ul> 
  </blockquote> </li></ul> 
<h2><a id="3__55"></a>3. 动静分离</h2> 
<ol><li> <p>动静分离请求图示:</p> 
  <blockquote> 
   <p><img src="https://images2.imgbox.com/6a/e6/IIamfGz3_o.png" alt="在这里插入图片描述"></p> 
  </blockquote> </li></ol> 
<ul><li> <p>静态资源配置</p> 
  <blockquote> 
   <p><img src="https://images2.imgbox.com/82/07/RXRIxb47_o.png" alt="在这里插入图片描述"></p> 
  </blockquote> 
  <blockquote> 
   <ul><li>index index.html index.php 代表首页展示,第一个找不到的话会去找第二个</li><li>Nginx默认是不允许列出整个目录的 
     <ul><li>autoindex on; 显示整个目录(有…,像Linux一样)</li><li>autoindex_exact_size off; 默认为on，单位是bytes; 改为off后，单位是kB或者MB或者GB</li><li>autoindex_localtime on; 默认为off，显示的文件时间为GMT时间。</li></ul> </li></ul> 
  </blockquote> </li></ul> 
<ol><li>通过 location 指定不同的后缀名实现不同的请求转发。</li></ol> 
<p>​ location匹配规则</p> 
<p>​ ~ 正则匹配, 区分大小写</p> 
<p>​ ~* 正则匹配, 不区分大小写<br> ​ ^~ 精确匹配, 如果该选项匹配，只匹配该选项，不匹配别的选项<br> ​ = 精确匹配, 这个不匹配其他人还有机会<br> ​ @ 定义一个命名的 location，使用在内部定向时，例如 error_page, try_files</p> 
<p>​ 优先级: = &gt; ^~ &gt; ~ ~*</p> 
<ol start="2"><li> <p>通过 expires 参数设置，可以使浏览器缓存过期时间。<br> 是给一个资源设定一个过期时间，也就是说无需去服务端验证，直接通过浏览器自身确认是否过期即可，所以不会产生额外的流量。</p> <p>此种方法非常适合不经常变动的资源。</p> <p>例如设置 3d，表示在这 3 天之内访问这个 URL, 发送一个请求，比对服务器该文件最后更新时间没有变化。</p> 
  <ul><li>如果没变则不会从服务器抓取, 返回状态码 304;</li><li>如果有修改则直接从服务器重新下载，返回状态码 200</li></ul> </li></ol> 
<h2><a id="4_Nginx_102"></a>4. Nginx原理</h2> 
<p>1、一个Nginx的 mater 和 worker</p> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/1e/f8/eUVA1nlX_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<p>2、worker 如何进行工作的</p> 
<blockquote> 
 <p><img src="https://images2.imgbox.com/a1/29/fcLbOk31_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<p>​ 3、一个 master 和多个 woker 有好处</p> 
<p>​ （1）可以使用 nginx –s reload 热部署，利用 nginx 进行热部署操作</p> 
<p>​ （2）每个 woker 是独立的进程，如果有其中的一个 woker 出现问题，其他 woker 独立的, 继续进行争抢，实现请求过程，不</p> 
<p>​ 会造成服务中断</p> 
<p>​ 4、设置多少个 woker 合适</p> 
<p>​ worker 数和服务器的 cpu 数相等是最为适宜的</p> 
<p>​ 5、连接数 worker_connection</p> 
<ul><li> <p>发送请求，占用了 woker 的几个连接数？<br> 答案：2 或者 4 个</p> </li><li> <p>nginx 有一个 master，有四个 woker，每个 woker 支持最大的连接数 1024，支持的最大并发数是多少？<br> 答案: 普通的静态访问最大并发数是： worker_connections * worker_processes /2</p> </li></ul> 
<p>​ 而如果是 HTTP 作 为反向代理来说，最大并发数量应该是 worker_connections * worker_processes/4</p> 
<h2><a id="5_Nginx_138"></a>5. Nginx集群</h2> 
<p>​ 对外暴漏同网段虚拟ip(相当于用户访问虚拟ip再访问真实ip,对真实ip的一种隐藏)</p> 
<p>​ 下载keepalived用来管理集群(定时检测宕机的,进行主从(MASTER BACKUP)的管理)</p> 
<ol><li>打开/etc/keepalived/keepalivec.conf</li></ol> 
<blockquote> 
 <p><strong>global_defs</strong> {<!-- --></p> 
 <p>notification_email {<!-- --></p> 
 <p>acassen@firewall.loc</p> 
 <p>failover@firewall.loc</p> 
 <p>sysadmin@firewall.loc</p> 
 <p>}</p> 
 <p>notification_email_from Alexandre.Cassen@firewall.loc</p> 
 <p>smtp_server 192.168.17.129</p> 
 <p>smtp_connect_timeout 30</p> 
 <p>router_id LVS_DEVEL #唯一的, 127.0.0.1 LVS_DEVEL是提前配好的对应127.0.0.1</p> 
 <p>}</p> 
 <p><strong>vrrp_script chk_http_port</strong> {<!-- --></p> 
 <p>script “/usr/local/src/nginx_check.sh”</p> 
 <p>interval 2 #（检测脚本执行的间隔）</p> 
 <p>weight 2</p> 
 <p>}</p> 
 <p><strong>vrrp_instance VI_1</strong> {<!-- --></p> 
 <p>state BACKUP # 备份服务器上将 MASTER 改为 BACKUP</p> 
 <p>interface ens33 //网卡</p> 
 <p>virtual_router_id 51 # 主、备机的 virtual_router_id 必须相同</p> 
 <p>priority 90 # 主、备机取不同的优先级，主机值较大，备份机值较小</p> 
 <p>advert_int 1</p> 
 <p>authentication {<!-- --></p> 
 <p>auth_type PASS</p> 
 <p>auth_pass 1111</p> 
 <p>}</p> 
 <p><strong>virtual_ipaddress</strong> {<!-- --></p> 
 <p>192.168.17.50 // VRRP H 虚拟地址</p> 
 <p>}</p> 
 <p>}</p> 
</blockquote> 
<ol start="2"><li>在/usr/local/src 添加检测脚本</li></ol> 
<pre><code class="prism language-sh">#!/bin/bash
A=`ps -C nginx –no-header |wc -l`
if [ $A -eq 0 ];
	then /usr/local/nginx/sbin/nginx
	sleep 2
	if [ `ps -C nginx --no-header |wc -l` -eq 0 ];
		then killall keepalived
	fi
fi
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ac9dec120045c51e54c6973697f10e32/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">字符串常用的方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/713ddf13a11e2b7a4f0f379b5df9151d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">01. JDBC</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>