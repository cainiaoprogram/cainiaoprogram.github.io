<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>三个思路解决413 Request Entity Too Large报错处理 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="三个思路解决413 Request Entity Too Large报错处理" />
<meta property="og:description" content="最近一个项目当中，要求上传图片，并且限制图片大小，虽然在laravel当中已经添加了相关的表单验证来阻止文件过大的上传，然而当提交表单时，还没轮到laravel处理，nginx就先报错了。当你仔细看报错页面时，你会发现有nginx版本信息，经过分析，这报错是因为nginx的默认上传文件大小配置client_max_body_size只有2MB， 基于nginx验证比laravel验证要早，想要友好报错而不是直接显示413 Request Entity Too Large，那么就有三个思路去解决。
思路一：修改nginx配置 这是最简单的一个做法，着报错原因是nginx不允许上传配置过大的文件，那么件把nginx的上传大小配置调高就好。 1、打开nginx主配置文件nginx.conf，一般在/usr/local/nginx/conf/nginx.conf这个位置，找到http{}段并修改以下内容： client_max_body_size 2m; 当中的2m修改成你需要的允许文件大小。 2、修改后，测试nginx配置是否正确 /usr/local/nginx/sbin/nginx -t 3、测试配置正确后，重启nginx使配置生效 /etc/init.d/nginx restart 注意:要是以php运行的话，这个大小client_max_body_size要和php.ini中的如下值的最大值差不多或者稍大，这样就不会因为提交数据大小不一致出现错误。 post_max_size = 2M upload_max_filesize = 2M 当中的2m修改成你需要的允许文件大小。把当中的2m修改成你第一步设置的大小。
思路二：修改添加友好报错页面 思路一虽然简单，但是不一定能过项目测试那一关，项目测试就要求不要看到413 Request Entity Too Large这样显示错误，所以我们只好添加友好报错页面咯。 1、编辑一个简单的htm作为静态友好页面 (注意html文件乱码请用&lt;meta http-equiv=&#34;Content-Type&#34; content=&#34;text/html; charset=utf-8&#34;&gt;) 2、更改nginx.conf在http定义区域加入： fastcgi_intercept_errors on; 3、nginx的网站conf配置中的server 定义区域加入： error_page 413 /413.htm; （注意此处413与/413.htm之间不要用等号，否则返回状态码为200而不是413，同时尽量不要 http://www.xxx.com/404.html出错则会跳过该页面） 4、测试nginx配置是否正确 /usr/local/nginx/sbin/nginx -t 5、如果上一步成功重启nginx /etc/init.d/nginx restart 思路三：表单提交之前先用JS判断并且阻止表单提交 思路二虽然比思路一有进步了一些，但是提醒还是跳转页面了，这样的用户体验并不会好到哪里去，所以最终想到了思路三。上文已经说过，这413报错是来自后端nginx的，nginx的判断虽然比PHP还要早，但是我们可以直接从前端处理呀！想到这里，实现并不难了。可以添加文件上传事件判断，如果文件超过限制的大小，那么就弹出警告框并让提交按钮失效，如果文件没有超过限制大小，就提示大小合适，并且把之前的按钮失效状态取消掉。 简单的HTML代码： &lt;form action=&#34;&#34; method=&#34;post&#34; enctype=&#34;multipart/form-data&#34;&gt; &lt;div class=&#34;form-group&#34;&gt; &lt;label for=&#34;picture&#34;&gt;文章展示图片(800KB内):&lt;/label&gt; &lt;input id=&#34;picture&#34; name=&#34;picture&#34; type=&#34;file&#34;/&gt; &lt;/div&gt; &lt;button type=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/13e96e4e8d01d2595dce1b094d977cb9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-07-22T15:52:33+08:00" />
<meta property="article:modified_time" content="2016-07-22T15:52:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">三个思路解决413 Request Entity Too Large报错处理</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; font-size:14px; line-height:20px">  <strong>最近一个项目当中，要求上传图片，并且限制图片大小，虽然在laravel当中已经添加了相关的表单验证来阻止文件过大的上传，然而当提交表单时，还没轮到laravel处理，nginx就先报错了。当你仔细看报错页面时，你会发现有nginx版本信息，经过分析，这报错是因为nginx的默认上传文件大小配置<span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; font-size:14px; line-height:20px">client_max_body_size只有2MB， </span>基于nginx验证比laravel验证要早，想要友好报错而不是直接显示413 Request Entity Too Large，那么就有三个思路去解决。</strong></span></p> 
<h2><span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; font-size:14px; line-height:20px">   </span><span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; line-height:20px"><span style="font-size:24px">思路一：修改nginx配置</span></span></h2> 
<div> 
 <span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; line-height:20px"><span style="font-size:24px">  <strong> </strong></span><span style="font-size:18px"><strong>这是最简单的一个做法，着报错原因是nginx不允许上传配置过大的文件，那么件把nginx的上传大小配置调高就好。</strong></span></span> 
</div> 
<h2><span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; font-size:14px; line-height:20px">    1、打开nginx主配置文件nginx.conf，一般在/usr/local/nginx/conf/nginx.conf这个位置，找到http{}段并修改以下内容：</span></h2> 
<div> 
 <span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; font-size:14px; line-height:20px"></span> 
 <pre><code class="language-html">client_max_body_size 2m;</code></pre>  
 <strong>  <span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; font-size:14px; line-height:20px"> <strong><span style="font-weight:bold">当中的2m修改成你需要的允许文件大小。</span></strong></span></strong> 
</div> 
<div> 
 <span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; font-size:14px; line-height:20px"><strong>   2、修改后，测试nginx配置是否正确</strong></span> 
</div> 
<div> 
 <span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; line-height:20px"><strong></strong></span> 
 <pre><code class="language-html">/usr/local/nginx/sbin/nginx -t</code></pre> 
 <span style="font-size:14px"> <span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; font-size:14px; line-height:20px"><strong><span style="font-size:14px"><strong>3、测试配置正确后，重启nginx使配置生效</strong></span></strong></span><strong> </strong></span> 
 <pre><code class="language-html">/etc/init.d/nginx restart</code></pre> 
</div> 
<div> 
 <span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; line-height:20px"><strong><span style="font-size:24px">注意:要是以php运行的话，这个大小client_max_body_size要和php.ini中的如下值的最大值差不多或者稍大，这样就不会因为提交数据大小不一致出现错误。</span></strong></span> 
</div> 
<div> 
 <span style="font-size:10px"></span> 
 <pre><code class="language-html">post_max_size = 2M
upload_max_filesize = 2M</code></pre> 
</div> 
<p><span style="font-weight:bold"><span style="font-weight:bold"><span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; font-size:14px; line-height:20px"><strong><span style="font-weight:bold">当中的2m修改成你需要的允许文件大小。</span><span style="font-weight:bold">把当中的2m修改成你第一步设置的大小。</span></strong></span></span></span></p> 
<p><strong>  </strong></p> 
<h2 style="font-weight:bold"><span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; line-height:20px">   <span style="font-size:24px">思路二：<span style="font-size:24px">修改添加友好报错页面</span></span></span></h2> 
<div> 
 <span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; line-height:20px"><span style="font-size:24px"> </span><span style="font-size:14px"><strong>思路一虽然简单，但是不一定能过项目测试那一关，项目测试就要求不要看到413 Request Entity Too Large这样显示错误，所以我们只好添加友好报错页面咯。</strong></span></span> 
</div> 
<div> 
 <span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; line-height:20px"><span style="font-size:14px"><strong>  1、编辑一个简单的htm作为静态友好页面</strong></span></span> 
</div> 
<div> 
 <span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; line-height:20px"><span style="font-size:14px"><strong>(注意html文件乱码请用<span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; font-size:14px; line-height:20px"><strong>&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;)</strong></span></strong></span></span> 
</div> 
<div> 
 <span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; line-height:20px"><span style="font-size:14px"><strong>2、更改nginx.conf在http定义区域加入：</strong></span></span> 
</div> 
<div> 
 <span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; line-height:20px"><span style="font-size:14px"><strong></strong></span></span> 
 <pre><code class="language-html"> fastcgi_intercept_errors on; </code></pre> 
 <span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; font-size:14px; line-height:20px"><strong>3、nginx的网站conf配置中的server 定义区域加入： </strong></span> 
</div> 
<div> 
 <span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; line-height:20px"><span style="font-size:14px"><strong></strong></span></span> 
 <pre><code class="language-html">error_page 413 /413.htm;  </code></pre>（注意此处413与/413.htm之间不要用等号，否则返回状态码为200而不是413，同时尽量不要 http://www.xxx.com/404.html出错则会跳过该页面）  
 <br> 
 <span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; font-size:14px; line-height:20px"><strong>4、测试nginx配置是否正确</strong></span> 
</div> 
<div> 
 <span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; line-height:20px"><span style="font-size:14px"><strong></strong></span></span> 
 <pre><code class="language-html">/usr/local/nginx/sbin/nginx -t</code></pre> 
 <span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; font-size:14px; line-height:20px"><strong>5、如果上一步成功重启nginx </strong></span> 
</div> 
<div> 
 <span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; line-height:20px"><span style="font-size:14px"><strong></strong></span></span> 
 <pre><code class="language-html">  /etc/init.d/nginx restart</code></pre> 
 <br> 
</div> 
<p>    </p> 
<h2><span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; line-height:20px"> 思路三：表单提交之前先用JS判断并且阻止表单提交</span></h2> 
<div> 
 <span style="font-family:Microsoft Yahei,Helvetica Neue,Helvetica,Arial,sans-serif; color:#333333"><span style="line-height:20px"> <strong> <span style="font-size:12px">思路二虽然比思路一有进步了一些，但是提醒还是跳转页面了，这样的用户体验并不会好到哪里去，所以最终想到了思路三。上文已经说过，这413报错是来自后端nginx的，nginx的判断虽然比PHP还要早，但是我们可以直接从前端处理呀！想到这里，实现并不难了。可以添加文件上传事件判断，如果文件超过限制的大小，那么就弹出警告框并让提交按钮失效，如果文件没有超过限制大小，就提示大小合适，并且把之前的按钮失效状态取消掉。</span></strong></span></span> 
</div> 
<div> 
 <span style="font-family:Microsoft Yahei,Helvetica Neue,Helvetica,Arial,sans-serif; color:#333333"><span style="line-height:20px"><strong><span style="font-size:12px">   简单的HTML代码：</span></strong></span></span> 
 <pre><code class="language-html">                &lt;form action="" method="post" enctype="multipart/form-data"&gt;                  
                    &lt;div class="form-group"&gt;
                        &lt;label for="picture"&gt;文章展示图片(800KB内):&lt;/label&gt;
                        &lt;input id="picture" name="picture" type="file"/&gt;
                    &lt;/div&gt;
                        &lt;button type="submit" id="submit" class="am-btn am-btn-success"&gt;&lt;span class="am-icon-send"&gt;&lt;/span&gt;
                            发布
                        &lt;/button&gt;
                    &lt;/p&gt;
                &lt;/form&gt;</code></pre> 
 <br> 
</div> 
<p></p> 
<div>
    
 <span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; line-height:20px"> <span style="font-size:12px"><strong>JS代码：</strong></span></span> 
</div> 
<div> 
 <strong> </strong> 
 <pre><code class="language-html">  $('#picture').bind('change', function () {
            if (this.files[0].size / 1024 / 1024 &gt; 0.8){
                value = this.files[0].size/1024;
                alert('该文件大小是 ' + value .toFixed(0)  + "KB,已超过大小限制，请修改！");
                document.getElementById("submit").disabled=true;
                document.getElementById("submit").innerHTML='非法图片内容';
            }else{
                alert('该文件可以提交！');
                document.getElementById("submit").disabled=false;
                document.getElementById("submit").innerHTML='提交';
            }
        });</code></pre> 
 <span style="font-size:32px"><br> 总结：其实三个思路是按照时间顺序来写的，在实际项目中最终的功能实现也是更新换代才有了最后的结果。不过当有这样类似的经验，下次遇到这样的弯路就省掉，同时会让自己的处理问题的方式更加成熟。</span> 
 <br> 
 <br> 
 <br> 
 <br> 
</div> 
<div> 
 <span style="color:rgb(51,51,51); font-family:'Microsoft Yahei','Helvetica Neue',Helvetica,Arial,sans-serif; font-size:14px; line-height:20px"><br> </span> 
</div>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/53f5a3131290f44c33e1b818bc84328a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Spring Bean 循环依赖解决方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/49dbb40781dd4ad6a66fdf9070093d1b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">POJ 1321 棋盘问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>