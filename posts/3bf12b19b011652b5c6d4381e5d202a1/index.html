<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C&#43;&#43; error: non-const lvalue reference to type - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="C&#43;&#43; error: non-const lvalue reference to type" />
<meta property="og:description" content="一 使用场景 指向的对象延时new指向的对象运行时动态释放和分配 二 遇到的现象及原因 2.1 关键字含义 int * const &amp;rpa 表明rpa本身不能在赋值int* 类型,但是可以使用*rpa做左值const int * const &amp;crpa 表明crpa本身不能在赋值int* 类型,且不可以使用*crpa做左值 2.2 目标需求【既不能修改本身的值也不能修改指向对象的值】 2.3 实践操作问题 /* * rpa 和 crpa同时初始化为pa,rpa的地址为&amp;a,crpa的地址为&amp;a */ int a = 10; int *pa = &amp;a; int * const &amp;rpa = pa; const int * const &amp;crpa = pa; cout&lt;&lt;&#34;a:&#34;&lt;&lt;a&lt;&lt;&#34;\t&#34;&lt;&lt;*pa&lt;&lt;&#34;\t&#34;&lt;&lt;*rpa&lt;&lt;&#34;\t&#34;&lt;&lt;*crpa&lt;&lt;endl; // 10 10 10 10 cout&lt;&lt;&#34;a1:&#34;&lt;&lt;&amp;a&lt;&lt;&#34;\t&#34;&lt;&lt;pa&lt;&lt;&#34;\t&#34;&lt;&lt;rpa&lt;&lt;&#34;\t&#34;&lt;&lt;crpa&lt;&lt;endl; // 0x9afe0c 0x9afe0c 0x9afe0c 0x9afe0c /* *然后pa进行重新赋值指向b *结果rpa的地址为&amp;b【符合预期,满足部分目标需求】 *但crpa的地址还是&amp;a【不符合预期,与目标需求不符合】 */ int b = 20; pa = &amp;b; cout&lt;&lt;&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/3bf12b19b011652b5c6d4381e5d202a1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-30T17:36:44+08:00" />
<meta property="article:modified_time" content="2022-03-30T17:36:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C&#43;&#43; error: non-const lvalue reference to type</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2> 一   使用场景</h2> 
<ul><li>指向的对象延时new</li><li>指向的对象运行时动态释放和分配</li></ul> 
<h2>二    遇到的现象及原因</h2> 
<h3>2.1 关键字含义</h3> 
<ol><li><strong> int * const &amp;rpa                            表明rpa本身不能在赋值int* 类型,但是可以使用*rpa做左值</strong></li><li><strong>const int * const &amp;crpa                表明crpa本身不能在赋值int* 类型,且不可以使用*crpa做左值</strong></li></ol> 
<h3>2.2  目标需求【既不能修改本身的值也不能修改指向对象的值】</h3> 
<h3>2.3  实践操作问题</h3> 
<p></p> 
<pre><code>/*
* rpa 和 crpa同时初始化为pa,rpa的地址为&amp;a,crpa的地址为&amp;a
*/
int a = 10;
int *pa = &amp;a;
int * const &amp;rpa = pa;
const int * const &amp;crpa = pa;
cout&lt;&lt;"a:"&lt;&lt;a&lt;&lt;"\t"&lt;&lt;*pa&lt;&lt;"\t"&lt;&lt;*rpa&lt;&lt;"\t"&lt;&lt;*crpa&lt;&lt;endl; 
//          10       10         10           10
cout&lt;&lt;"a1:"&lt;&lt;&amp;a&lt;&lt;"\t"&lt;&lt;pa&lt;&lt;"\t"&lt;&lt;rpa&lt;&lt;"\t"&lt;&lt;crpa&lt;&lt;endl;  
//           0x9afe0c 0x9afe0c   0x9afe0c   0x9afe0c
    
   
/*
*然后pa进行重新赋值指向b
*结果rpa的地址为&amp;b【符合预期,满足部分目标需求】
*但crpa的地址还是&amp;a【不符合预期,与目标需求不符合】
*/
int b = 20;
pa = &amp;b;
cout&lt;&lt;"b:"&lt;&lt;a&lt;&lt;"\t"&lt;&lt;b&lt;&lt;"\t"&lt;&lt;*pa&lt;&lt;"\t"&lt;&lt;*rpa&lt;&lt;"\t"&lt;&lt;*crpa&lt;&lt;endl;
//         10       20        20         20          10
cout&lt;&lt;"b1:"&lt;&lt;&amp;a&lt;&lt;"\t"&lt;&lt;&amp;b&lt;&lt;"\t"&lt;&lt;pa&lt;&lt;"\t"&lt;&lt;rpa&lt;&lt;"\t"&lt;&lt;crpa&lt;&lt;endl;
//          0x9afe0c 0x9afdfc   0x9afdfc  0x9afdfc    0x9afe0c</code></pre> 
<p><img alt="" height="36" src="https://images2.imgbox.com/e6/4e/cmdv80f1_o.png" width="622"></p> 
<p> <img alt="" height="38" src="https://images2.imgbox.com/5f/e7/IOtDdTBS_o.png" width="607"></p> 
<h3> 2.4 汇编问题查看(汇编网址:<a href="https://godbolt.org/" rel="nofollow" title="Compiler Explorer">Compiler Explorer</a>)</h3> 
<h4>2.4.1 gcc-9.4及之前</h4> 
<p><span style="color:#fe2c24;"><strong>结论:const int * const &amp;crpa指向的是开始初始化的地址,编译器使用临时变量进行保存.</strong></span></p> 
<pre><code>test():
        push    rbp
        mov     rbp, rsp                   //栈寄存器
        mov     DWORD PTR [rbp-28], 10     //[rbp-28]==a;     a = 10
        lea     rax, [rbp-28]              //lea 取[rbp-28]的地址赋值给 rax
        mov     QWORD PTR [rbp-40], rax    //[rbp-40]==pa;    pa = &amp;a;
        lea     rax, [rbp-40]              //lea 取[rbp-40]的地址
        mov     QWORD PTR [rbp-8], rax     //[rbp-8]==rpa;    rpa=&amp;pa
        mov     rax, QWORD PTR [rbp-40]    //rax 赋值[rbp-40]的值,即rax=pa=&amp;a
        mov     QWORD PTR [rbp-24], rax    //[rbp-24]==pa;    [rbp-24] = &amp;a; 
        lea     rax, [rbp-24]              //lea 取[rbp-24]的地址
        mov     QWORD PTR [rbp-16], rax    //[rbp-16]=&amp;[rbp-24];    crpa=&amp;[rbp-24]=-&gt;&amp;a
        mov     DWORD PTR [rbp-44], 20     //b  = 20
        lea     rax, [rbp-44]
        mov     QWORD PTR [rbp-40], rax    //pa = &amp;b
        nop
        pop     rbp
        ret</code></pre> 
<p><img alt="" height="288" src="https://images2.imgbox.com/36/f6/KipAkenD_o.png" width="749"></p> 
<p> </p> 
<h4>2.4.2 gcc-10.1及之后</h4> 
<p><span style="color:#fe2c24;"><strong>结论:const int * const &amp;crpa指向的是pa的地址，所以可以实时获取</strong></span></p> 
<pre><code>test():
  push    rbp
        mov     rbp, rsp
        mov     DWORD PTR [rbp-20], 10    //[rbp-20]==a;     a = 10
        lea     rax, [rbp-20]             //lea 取[rbp-20]的地址赋值给 rax
        mov     QWORD PTR [rbp-32], rax   //[rbp-32]==pa;    pa = &amp;a;
        lea     rax, [rbp-32]             //lea 取[rbp-32]的地址
        mov     QWORD PTR [rbp-8], rax    //[rbp-8]==rpa;    rpa=&amp;pa
        lea     rax, [rbp-32]             //lea 取[rbp-32]的地址
        mov     QWORD PTR [rbp-16], rax   //[rbp-16]==rpa;    rpa=&amp;pa
        mov     DWORD PTR [rbp-36], 20    //b = 20
        lea     rax, [rbp-36]             
        mov     QWORD PTR [rbp-32], rax    //pa = &amp;b
        nop
        pop     rbp
        ret</code></pre> 
<p><img alt="" height="359" src="https://images2.imgbox.com/d0/e1/ebMmKEVC_o.png" width="1200"></p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/523a3427b678e6f2d7ef95f14dd96354/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">第1章 准备工作</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/21bf94b44ad25b3dc64e69215e3491b0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue3中插槽的使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>