<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>InternImageå®æˆ˜ï¼šä½¿ç”¨InternImageå®ç°å›¾åƒåˆ†ç±»ä»»åŠ¡ï¼ˆä¸€ï¼‰ - èœé¸Ÿç¨‹åºå‘˜åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="InternImageå®æˆ˜ï¼šä½¿ç”¨InternImageå®ç°å›¾åƒåˆ†ç±»ä»»åŠ¡ï¼ˆä¸€ï¼‰" />
<meta property="og:description" content="æ–‡ç« ç›®å½• æ‘˜è¦â€œä¹¦ç”Ÿ2.5â€çš„åº”ç”¨1. å›¾åƒæ¨¡æ€ä»»åŠ¡æ€§èƒ½2. å›¾æ–‡è·¨æ¨¡æ€ä»»åŠ¡æ€§èƒ½ æ ¸å¿ƒæŠ€æœ¯ å®‰è£…åŒ…å®‰è£…timmå®‰è£… grad-camå®‰è£…DCNV3 æ•°æ®å¢å¼ºCutoutå’ŒMixupEMAé¡¹ç›®ç»“æ„è®¡ç®—meanå’Œstdç”Ÿæˆæ•°æ®é›† æ‘˜è¦ è®ºæ–‡ç¿»è¯‘ï¼šhttps://wanghao.blog.csdn.net/article/details/129379410
å®˜æ–¹æºç ï¼š https://github.com/OpenGVLab/InternImage
ä»–æ¥äº†ï¼ä»–æ¥äº†ï¼ä»–å¸¦ç€æ°©å¼§ç„Šçš„å…‰èŠ’è¿‡æ¥äº†ï¼ä½œä¸ºCVçš„å¤§æ¨¡å‹ï¼ŒInternImageçš„å…‰èŠ’å¤ªå¼ºäº†ã€‚
2023å¹´3æœˆ14æ—¥: ğŸš€ â€œä¹¦ç”Ÿ2.5â€å‘å¸ƒï¼2023å¹´2æœˆ28æ—¥: ğŸš€ InternImage è¢«CVPR 2023æ¥æ”¶!2022å¹´11æœˆ18æ—¥: ğŸš€ åŸºäº InternImage-XL ä¸»å¹²ç½‘ç»œï¼ŒBEVFormer v2 åœ¨nuScenesçš„çº¯è§†è§‰3Dæ£€æµ‹ä»»åŠ¡ä¸Šå–å¾—äº†æœ€ä½³æ€§èƒ½ 63.4 NDS ï¼2022å¹´11æœˆ10æ—¥: ğŸš€ InternImage-H åœ¨COCOç›®æ ‡æ£€æµ‹ä»»åŠ¡ä¸Šä»¥ 65.4 mAP æ–©è·å† å†›ï¼Œæ˜¯å”¯ä¸€çªç ´ 65.0 mAP çš„è¶…å¼ºç‰©ä½“æ£€æµ‹æ¨¡å‹ï¼2022å¹´11æœˆ10æ—¥: ğŸš€ InternImage-H åœ¨ADE20Kè¯­ä¹‰åˆ†å‰²æ•°æ®é›†ä¸Šå–å¾— 62.9 mIoU çš„SOTAæ€§èƒ½ï¼ â€œä¹¦ç”Ÿ2.5â€çš„åº”ç”¨ 1. å›¾åƒæ¨¡æ€ä»»åŠ¡æ€§èƒ½ åœ¨å›¾åƒåˆ†ç±»æ ‡æ†æ•°æ®é›†ImageNetä¸Šï¼Œâ€œä¹¦ç”Ÿ2.5â€ä»…åŸºäºå…¬å¼€æ•°æ®ä¾¿è¾¾åˆ°äº† 90.1% çš„Top-1å‡†ç¡®ç‡ã€‚è¿™æ˜¯é™¤è°·æ­Œä¸å¾®è½¯ä¸¤ä¸ªæœªå…¬å¼€æ¨¡å‹åŠé¢å¤–æ•°æ®é›†å¤–ï¼Œå”¯ä¸€å‡†ç¡®ç‡è¶…è¿‡90.0%çš„æ¨¡å‹ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸–ç•Œä¸Šå¼€æºæ¨¡å‹ä¸­ImageNetå‡†ç¡®åº¦æœ€é«˜ï¼Œè§„æ¨¡æœ€å¤§çš„æ¨¡å‹ï¼›åœ¨ç‰©ä½“æ£€æµ‹æ ‡æ†æ•°æ®é›†COCOä¸Šï¼Œâ€œä¹¦ç”Ÿ2.5â€ å–å¾—äº† 65.5 çš„ mAPï¼Œæ˜¯ä¸–ç•Œä¸Šå”¯ä¸€è¶…è¿‡65 mAPçš„æ¨¡å‹ï¼›åœ¨å¦å¤–16ä¸ªé‡è¦çš„è§†è§‰åŸºç¡€æ•°æ®é›†ï¼ˆè¦†ç›–åˆ†ç±»ã€æ£€æµ‹å’Œåˆ†å‰²ä»»åŠ¡ï¼‰ä¸Šå–å¾—ä¸–ç•Œæœ€å¥½æ€§èƒ½ã€‚ åˆ†ç±»ä»»åŠ¡
å›¾åƒåˆ†ç±» åœºæ™¯åˆ†ç±» é•¿å°¾åˆ†ç±»ImageNetPlaces365Places 205iNaturalist 201890.161.271.792.3 æ£€æµ‹ä»»åŠ¡
å¸¸è§„ç‰©ä½“æ£€æµ‹é•¿å°¾ç‰©ä½“æ£€æµ‹ è‡ªåŠ¨é©¾é©¶ç‰©ä½“æ£€æµ‹å¯†é›†ç‰©ä½“æ£€æµ‹COCOVOC 2007VOC 2012OpenImageLVIS minivalLVIS valBDD100KnuScenesCrowdHuman65.594.097.274.165.863.238.864.897.2 åˆ†å‰²ä»»åŠ¡" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/806831c7e4e1a7da6ff2e3576adc152e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-04T14:00:52+08:00" />
<meta property="article:modified_time" content="2023-04-04T14:00:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="èœé¸Ÿç¨‹åºå‘˜åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">èœé¸Ÿç¨‹åºå‘˜åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">InternImageå®æˆ˜ï¼šä½¿ç”¨InternImageå®ç°å›¾åƒåˆ†ç±»ä»»åŠ¡ï¼ˆä¸€ï¼‰</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>æ–‡ç« ç›®å½•</h4> 
 <ul><li><a href="#_1" rel="nofollow">æ‘˜è¦</a></li><li><ul><li><a href="#25_12" rel="nofollow">â€œä¹¦ç”Ÿ2.5â€çš„åº”ç”¨</a></li><li><ul><li><a href="#1__14" rel="nofollow">1. å›¾åƒæ¨¡æ€ä»»åŠ¡æ€§èƒ½</a></li><li><a href="#2__67" rel="nofollow">2. å›¾æ–‡è·¨æ¨¡æ€ä»»åŠ¡æ€§èƒ½</a></li></ul> 
   </li><li><a href="#_100" rel="nofollow">æ ¸å¿ƒæŠ€æœ¯</a></li></ul> 
  </li><li><a href="#_139" rel="nofollow">å®‰è£…åŒ…</a></li><li><ul><li><a href="#timm_140" rel="nofollow">å®‰è£…timm</a></li><li><a href="#_gradcam_147" rel="nofollow">å®‰è£… grad-cam</a></li><li><a href="#DCNV3_151" rel="nofollow">å®‰è£…DCNV3</a></li></ul> 
  </li><li><a href="#CutoutMixup_164" rel="nofollow">æ•°æ®å¢å¼ºCutoutå’ŒMixup</a></li><li><a href="#EMA_219" rel="nofollow">EMA</a></li><li><a href="#_299" rel="nofollow">é¡¹ç›®ç»“æ„</a></li><li><a href="#meanstd_334" rel="nofollow">è®¡ç®—meanå’Œstd</a></li><li><a href="#_374" rel="nofollow">ç”Ÿæˆæ•°æ®é›†</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>æ‘˜è¦</h2> 
<p>è®ºæ–‡ç¿»è¯‘ï¼šhttps://wanghao.blog.csdn.net/article/details/129379410<br> å®˜æ–¹æºç ï¼š https://github.com/OpenGVLab/InternImage</p> 
<p><strong>ä»–æ¥äº†ï¼ä»–æ¥äº†ï¼ä»–å¸¦ç€æ°©å¼§ç„Šçš„å…‰èŠ’è¿‡æ¥äº†ï¼ä½œä¸ºCVçš„å¤§æ¨¡å‹ï¼ŒInternImageçš„å…‰èŠ’å¤ªå¼ºäº†ã€‚</strong></p> 
<ul><li>2023å¹´3æœˆ14æ—¥: ğŸš€ â€œä¹¦ç”Ÿ2.5â€å‘å¸ƒï¼</li><li>2023å¹´2æœˆ28æ—¥: ğŸš€ InternImage è¢«CVPR 2023æ¥æ”¶!</li><li>2022å¹´11æœˆ18æ—¥: ğŸš€ åŸºäº InternImage-XL ä¸»å¹²ç½‘ç»œï¼Œ<a href="https://arxiv.org/abs/2211.10439" rel="nofollow">BEVFormer v2</a> åœ¨nuScenesçš„çº¯è§†è§‰3Dæ£€æµ‹ä»»åŠ¡ä¸Šå–å¾—äº†æœ€ä½³æ€§èƒ½ <code>63.4 NDS</code> ï¼</li><li>2022å¹´11æœˆ10æ—¥: ğŸš€ InternImage-H åœ¨COCOç›®æ ‡æ£€æµ‹ä»»åŠ¡ä¸Šä»¥ <code>65.4 mAP</code> æ–©è·å† å†›ï¼Œæ˜¯å”¯ä¸€çªç ´ <code>65.0 mAP</code> çš„è¶…å¼ºç‰©ä½“æ£€æµ‹æ¨¡å‹ï¼</li><li>2022å¹´11æœˆ10æ—¥: ğŸš€ InternImage-H åœ¨ADE20Kè¯­ä¹‰åˆ†å‰²æ•°æ®é›†ä¸Šå–å¾— <code>62.9 mIoU</code> çš„SOTAæ€§èƒ½ï¼</li></ul> 
<h3><a id="25_12"></a>â€œä¹¦ç”Ÿ2.5â€çš„åº”ç”¨</h3> 
<h4><a id="1__14"></a>1. å›¾åƒæ¨¡æ€ä»»åŠ¡æ€§èƒ½</h4> 
<ul><li>åœ¨å›¾åƒåˆ†ç±»æ ‡æ†æ•°æ®é›†ImageNetä¸Šï¼Œâ€œä¹¦ç”Ÿ2.5â€ä»…åŸºäºå…¬å¼€æ•°æ®ä¾¿è¾¾åˆ°äº† 90.1% çš„Top-1å‡†ç¡®ç‡ã€‚è¿™æ˜¯é™¤è°·æ­Œä¸å¾®è½¯ä¸¤ä¸ªæœªå…¬å¼€æ¨¡å‹åŠé¢å¤–æ•°æ®é›†å¤–ï¼Œå”¯ä¸€å‡†ç¡®ç‡è¶…è¿‡90.0%çš„æ¨¡å‹ï¼ŒåŒæ—¶ä¹Ÿæ˜¯ä¸–ç•Œä¸Šå¼€æºæ¨¡å‹ä¸­ImageNetå‡†ç¡®åº¦æœ€é«˜ï¼Œè§„æ¨¡æœ€å¤§çš„æ¨¡å‹ï¼›</li><li>åœ¨ç‰©ä½“æ£€æµ‹æ ‡æ†æ•°æ®é›†COCOä¸Šï¼Œâ€œä¹¦ç”Ÿ2.5â€ å–å¾—äº† 65.5 çš„ mAPï¼Œæ˜¯ä¸–ç•Œä¸Šå”¯ä¸€è¶…è¿‡65 mAPçš„æ¨¡å‹ï¼›</li><li>åœ¨å¦å¤–16ä¸ªé‡è¦çš„è§†è§‰åŸºç¡€æ•°æ®é›†ï¼ˆè¦†ç›–åˆ†ç±»ã€æ£€æµ‹å’Œåˆ†å‰²ä»»åŠ¡ï¼‰ä¸Šå–å¾—ä¸–ç•Œæœ€å¥½æ€§èƒ½ã€‚</li></ul> 
<div align="left"> 
 <br> 
</div> 
<p><strong>åˆ†ç±»ä»»åŠ¡</strong></p> 
<table border="1" width="90%"><tbody><tr align="center"><th colspan="1"> å›¾åƒåˆ†ç±»</th><th colspan="2"> åœºæ™¯åˆ†ç±» </th><th colspan="1">é•¿å°¾åˆ†ç±»</th></tr><tr align="center"><th>ImageNet</th><th>Places365</th><th>Places 205</th><th>iNaturalist 2018</th></tr><tr align="center"><th>90.1</th><th>61.2</th><th>71.7</th><th>92.3</th></tr></tbody></table> 
<br> 
<p><strong>æ£€æµ‹ä»»åŠ¡</strong></p> 
<table border="1" width="90%"><tbody><tr align="center"><th colspan="4"> å¸¸è§„ç‰©ä½“æ£€æµ‹</th><th colspan="2">é•¿å°¾ç‰©ä½“æ£€æµ‹ </th><th colspan="2">è‡ªåŠ¨é©¾é©¶ç‰©ä½“æ£€æµ‹</th><th colspan="1">å¯†é›†ç‰©ä½“æ£€æµ‹</th></tr><tr align="center"><th>COCO</th><th>VOC 2007</th><th>VOC 2012</th><th>OpenImage</th><th>LVIS minival</th><th>LVIS val</th><th>BDD100K</th><th>nuScenes</th><th>CrowdHuman</th></tr><tr align="center"><th>65.5</th><th>94.0</th><th>97.2</th><th>74.1</th><th>65.8</th><th>63.2</th><th>38.8</th><th>64.8</th><th>97.2</th></tr></tbody></table> 
<br> 
<p><strong>åˆ†å‰²ä»»åŠ¡</strong></p> 
<table border="1" width="90%"><tbody><tr align="center"><th colspan="3">è¯­ä¹‰åˆ†å‰²</th><th colspan="1">è¡—æ™¯åˆ†å‰²</th><th colspan="1">RGBDåˆ†å‰²</th></tr><tr align="center"><th>ADE20K</th><th>COCO Stuff-10K</th><th>Pascal Context</th><th>CityScapes</th><th>NYU Depth V2</th></tr><tr align="center"><th>62.9</th><th>59.6</th><th>70.3</th><th>86.1</th><th>69.7</th></tr></tbody></table> 
<br> 
<h4><a id="2__67"></a>2. å›¾æ–‡è·¨æ¨¡æ€ä»»åŠ¡æ€§èƒ½</h4> 
<ul><li>å›¾æ–‡æ£€ç´¢</li></ul> 
<p>â€œä¹¦ç”Ÿ2.5â€å¯æ ¹æ®æ–‡æœ¬å†…å®¹éœ€æ±‚å¿«é€Ÿå®šä½æ£€ç´¢å‡ºè¯­ä¹‰æœ€ç›¸å…³çš„å›¾åƒã€‚è¿™ä¸€èƒ½åŠ›æ—¢å¯åº”ç”¨äºè§†é¢‘å’Œå›¾åƒé›†åˆï¼Œä¹Ÿå¯è¿›ä¸€æ­¥ç»“åˆç‰©ä½“æ£€æµ‹æ¡†ï¼Œå…·æœ‰ä¸°å¯Œçš„åº”ç”¨æ¨¡å¼ï¼Œå¸®åŠ©ç”¨æˆ·æ›´ä¾¿æ·ã€å¿«é€Ÿåœ°æ‰¾åˆ°æ‰€éœ€å›¾åƒèµ„æº, ä¾‹å¦‚å¯åœ¨ç›¸å†Œä¸­è¿”å›æ–‡æœ¬æ‰€æŒ‡å®šçš„ç›¸å…³å›¾åƒã€‚</p> 
<ul><li>ä»¥å›¾ç”Ÿæ–‡</li></ul> 
<p>â€œä¹¦ç”Ÿ2.5â€çš„â€œä»¥å›¾ç”Ÿæ–‡â€åœ¨å›¾åƒæè¿°ã€è§†è§‰é—®ç­”ã€è§†è§‰æ¨ç†å’Œæ–‡å­—è¯†åˆ«ç­‰å¤šä¸ªæ–¹é¢å‡æ‹¥æœ‰å¼ºå¤§çš„ç†è§£èƒ½åŠ›ã€‚ä¾‹å¦‚åœ¨è‡ªåŠ¨é©¾é©¶åœºæ™¯ä¸‹ï¼Œå¯ä»¥æå‡åœºæ™¯æ„ŸçŸ¥ç†è§£èƒ½åŠ›ï¼Œè¾…åŠ©è½¦è¾†åˆ¤æ–­äº¤é€šä¿¡å·ç¯çŠ¶æ€ã€é“è·¯æ ‡å¿—ç‰Œç­‰ä¿¡æ¯ï¼Œä¸ºè½¦è¾†çš„å†³ç­–è§„åˆ’æä¾›æœ‰æ•ˆçš„æ„ŸçŸ¥ä¿¡æ¯æ”¯æŒã€‚</p> 
<div align="left"> 
 <br> 
</div> 
<p><strong>å›¾æ–‡å¤šæ¨¡æ€ä»»åŠ¡</strong></p> 
<table border="1" width="90%"><tbody><tr align="center"><th colspan="1">å›¾åƒæè¿°</th><th colspan="2">å¾®è°ƒå›¾æ–‡æ£€ç´¢</th><th colspan="1">é›¶æ ·æœ¬å›¾æ–‡æ£€ç´¢</th></tr><tr align="center"><th>COCO Caption</th><th>COCO Caption</th><th>Flickr30k</th><th>Flickr30k</th></tr><tr align="center"><th>148.2</th><th>76.4</th><th>94.8</th><th>89.1</th></tr></tbody></table> 
<br> 
<h3><a id="_100"></a>æ ¸å¿ƒæŠ€æœ¯</h3> 
<p>â€œä¹¦ç”Ÿ2.5â€åœ¨å›¾æ–‡è·¨æ¨¡æ€é¢†åŸŸå“è¶Šçš„æ€§èƒ½è¡¨ç°ï¼Œæºè‡ªäºåœ¨å¤šæ¨¡æ€å¤šä»»åŠ¡é€šç”¨æ¨¡å‹æŠ€æœ¯æ ¸å¿ƒæ–¹é¢çš„å¤šé¡¹åˆ›æ–°ï¼Œå®ç°äº†è§†è§‰æ ¸å¿ƒè§†è§‰æ„ŸçŸ¥å¤§æ¨¡å‹ä¸»å¹²ç½‘ç»œï¼ˆInternImageï¼‰ã€ç”¨äºæ–‡æœ¬æ ¸å¿ƒçš„è¶…å¤§è§„æ¨¡æ–‡æœ¬é¢„è®­ç»ƒç½‘ç»œï¼ˆLLMï¼‰å’Œç”¨äºå¤šä»»åŠ¡çš„å…¼å®¹è§£ç å»ºæ¨¡ï¼ˆUni-Perceiverï¼‰çš„åˆ›æ–°ç»„åˆã€‚ è§†è§‰ä¸»å¹²ç½‘ç»œInternImageå‚æ•°é‡é«˜è¾¾30äº¿ï¼Œèƒ½å¤ŸåŸºäºåŠ¨æ€ç¨€ç–å·ç§¯ç®—å­è‡ªé€‚åº”åœ°è°ƒæ•´å·ç§¯çš„ä½ç½®å’Œç»„åˆæ–¹å¼ï¼Œä»è€Œä¸ºå¤šåŠŸèƒ½è§†è§‰æ„ŸçŸ¥æä¾›å¼ºå¤§çš„è¡¨ç¤ºã€‚Uni-Perceiveré€šæ‰ä»»åŠ¡è§£ç å»ºæ¨¡é€šè¿‡å°†ä¸åŒæ¨¡æ€çš„æ•°æ®ç¼–ç åˆ°ç»Ÿä¸€çš„è¡¨ç¤ºç©ºé—´ï¼Œå¹¶å°†ä¸åŒä»»åŠ¡ç»Ÿä¸€ä¸ºç›¸åŒçš„ä»»åŠ¡èŒƒå¼ï¼Œä»è€Œèƒ½å¤Ÿä»¥ç›¸åŒçš„ä»»åŠ¡æ¶æ„å’Œå…±äº«çš„æ¨¡å‹å‚æ•°åŒæ—¶å¤„ç†å„ç§æ¨¡æ€å’Œä»»åŠ¡ã€‚</p> 
<p><img src="https://images2.imgbox.com/40/2d/qRH5KfCP_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>è¿™ç¯‡æ–‡ç« ä¸»è¦è®²è§£å¦‚ä½•ä½¿ç”¨InternImageå®Œæˆå›¾åƒåˆ†ç±»ä»»åŠ¡ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·å®Œæˆé¡¹ç›®çš„å®æˆ˜ã€‚æœ¬ä¾‹é€‰ç”¨çš„æ¨¡å‹æ˜¯InternImageNet_s,åœ¨æ¤ç‰©å¹¼è‹—æ•°æ®é›†ä¸Šå®ç°äº†97%çš„å‡†ç¡®ç‡ã€‚</p> 
<p><img src="https://images2.imgbox.com/e4/5a/6MYd8Ak7_o.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"></p> 
<p><img src="https://images2.imgbox.com/dc/ea/O5dHVdD6_o.png" alt="è¯·æ·»åŠ å›¾ç‰‡æè¿°"></p> 
<p>é€šè¿‡è¿™ç¯‡æ–‡ç« èƒ½è®©ä½ å­¦åˆ°ï¼š</p> 
<ol><li>å¦‚ä½•ä½¿ç”¨æ•°æ®å¢å¼ºï¼ŒåŒ…æ‹¬transformsçš„å¢å¼ºã€CutOutã€MixUpã€CutMixç­‰å¢å¼ºæ‰‹æ®µï¼Ÿ</li><li>å¦‚ä½•å®ç°InternImageæ¨¡å‹å®ç°è®­ç»ƒï¼Ÿ</li><li>å¦‚ä½•ä½¿ç”¨pytorchè‡ªå¸¦æ··åˆç²¾åº¦ï¼Ÿ</li><li>å¦‚ä½•ä½¿ç”¨æ¢¯åº¦è£å‰ªé˜²æ­¢æ¢¯åº¦çˆ†ç‚¸ï¼Ÿ</li><li>å¦‚ä½•ä½¿ç”¨DPå¤šæ˜¾å¡è®­ç»ƒï¼Ÿ</li><li>å¦‚ä½•ç»˜åˆ¶losså’Œaccæ›²çº¿ï¼Ÿ</li><li>å¦‚ä½•ç”Ÿæˆvalçš„æµ‹è¯„æŠ¥å‘Šï¼Ÿ</li><li>å¦‚ä½•ç¼–å†™æµ‹è¯•è„šæœ¬æµ‹è¯•æµ‹è¯•é›†ï¼Ÿ</li><li>å¦‚ä½•ä½¿ç”¨ä½™å¼¦é€€ç«ç­–ç•¥è°ƒæ•´å­¦ä¹ ç‡ï¼Ÿ</li><li>å¦‚ä½•ä½¿ç”¨AverageMeterç±»ç»Ÿè®¡ACCå’Œlossç­‰è‡ªå®šä¹‰å˜é‡ï¼Ÿ</li><li>å¦‚ä½•ç†è§£å’Œç»Ÿè®¡ACC1å’ŒACC5ï¼Ÿ</li><li>å¦‚ä½•ä½¿ç”¨EMAï¼Ÿ</li><li>å¦‚æœä½¿ç”¨Grad-CAM å®ç°çƒ­åŠ›å›¾å¯è§†åŒ–ï¼Ÿ</li></ol> 
<p>å¦‚æœåŸºç¡€è–„å¼±ï¼Œå¯¹ä¸Šé¢çš„è¿™äº›åŠŸèƒ½éš¾ä»¥ç†è§£å¯ä»¥çœ‹æˆ‘çš„ä¸“æ ï¼š<a href="https://blog.csdn.net/hhhhhhhhhhwwwwwwwwww/category_12157249.html?spm=1001.2014.3001.5482">ç»å…¸ä¸»å¹²ç½‘ç»œç²¾è®²ä¸å®æˆ˜</a><br> è¿™ä¸ªä¸“æ ï¼Œä»é›¶å¼€å§‹æ—¶ï¼Œä¸€æ­¥ä¸€æ­¥çš„è®²è§£è¿™äº›ï¼Œè®©å¤§å®¶æ›´å®¹æ˜“æ¥å—ã€‚</p> 
<h2><a id="_139"></a>å®‰è£…åŒ…</h2> 
<h3><a id="timm_140"></a>å®‰è£…timm</h3> 
<p>ä½¿ç”¨pipå°±è¡Œï¼Œå‘½ä»¤ï¼š</p> 
<pre><code class="prism language-python">pip install timm
</code></pre> 
<p>æœ¬æ–‡å®æˆ˜ç”¨çš„timmé‡Œé¢çš„æ¨¡å‹ã€‚</p> 
<h3><a id="_gradcam_147"></a>å®‰è£… grad-cam</h3> 
<pre><code class="prism language-python">pip install grad<span class="token operator">-</span>cam
</code></pre> 
<h3><a id="DCNV3_151"></a>å®‰è£…DCNV3</h3> 
<p>ä»<code>https://github.com/OpenGVLab/InternImage</code>ä¸‹è½½æºç ï¼Œç„¶åè¿›å…¥ops_dcnv3ï¼Œå¦‚æœæ˜¯Ubuntuç³»ç»Ÿï¼Œ<br> åˆ™å¯ä»¥æ‰§è¡Œï¼š</p> 
<pre><code class="prism language-bash"><span class="token function">sh</span> ./make.sh
</code></pre> 
<p>é€šç”¨çš„æ–¹å¼ï¼š</p> 
<pre><code class="prism language-bash">python setup.py <span class="token function">install</span> 
</code></pre> 
<p>æ³¨æ„ï¼šæœ¬æœºè¦æœ‰æ˜¾å¡ï¼Œå¹¶å®‰è£…CUDAç¯å¢ƒã€‚</p> 
<h2><a id="CutoutMixup_164"></a>æ•°æ®å¢å¼ºCutoutå’ŒMixup</h2> 
<p>ä¸ºäº†æé«˜æˆç»©æˆ‘åœ¨ä»£ç ä¸­åŠ å…¥Cutoutå’ŒMixupè¿™ä¸¤ç§å¢å¼ºæ–¹å¼ã€‚å®ç°è¿™ä¸¤ç§å¢å¼ºéœ€è¦å®‰è£…torchtoolboxã€‚å®‰è£…å‘½ä»¤ï¼š</p> 
<pre><code>pip install torchtoolbox
</code></pre> 
<p>Cutoutå®ç°ï¼Œåœ¨transformsä¸­ã€‚</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> torchtoolbox<span class="token punctuation">.</span>transform <span class="token keyword">import</span> Cutout
<span class="token comment"># æ•°æ®é¢„å¤„ç†</span>
transform <span class="token operator">=</span> transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>
    transforms<span class="token punctuation">.</span>Resize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Cutout<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    transforms<span class="token punctuation">.</span>Normalize<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>éœ€è¦å¯¼å…¥åŒ…ï¼šfrom timm.data.mixup import Mixupï¼Œ</p> 
<p>å®šä¹‰Mixupï¼Œå’ŒSoftTargetCrossEntropy</p> 
<pre><code class="prism language-python">  mixup_fn <span class="token operator">=</span> Mixup<span class="token punctuation">(</span>
    mixup_alpha<span class="token operator">=</span><span class="token number">0.8</span><span class="token punctuation">,</span> cutmix_alpha<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">,</span> cutmix_minmax<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
    prob<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> switch_prob<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'batch'</span><span class="token punctuation">,</span>
    label_smoothing<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">,</span> num_classes<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span>
 criterion_train <span class="token operator">=</span> SoftTargetCrossEntropy<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>å‚æ•°è¯¦è§£ï¼š</p> 
<blockquote> 
 <p>mixup_alpha (float): mixup alpha å€¼ï¼Œå¦‚æœ &gt; 0ï¼Œåˆ™ mixup å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚</p> 
 <p>cutmix_alpha (float)ï¼šcutmix alpha å€¼ï¼Œå¦‚æœ &gt; 0ï¼Œcutmix å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚</p> 
 <p>cutmix_minmax (List[float])ï¼šcutmix æœ€å°/æœ€å¤§å›¾åƒæ¯”ç‡ï¼Œcutmix å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯ Noneï¼Œåˆ™ä½¿ç”¨è¿™ä¸ª vs alphaã€‚</p> 
 <p>å¦‚æœè®¾ç½®äº† cutmix_minmax åˆ™cutmix_alpha é»˜è®¤ä¸º1.0</p> 
 <p>prob (float): æ¯æ‰¹æ¬¡æˆ–å…ƒç´ åº”ç”¨ mixup æˆ– cutmix çš„æ¦‚ç‡ã€‚</p> 
 <p>switch_prob (float): å½“ä¸¤è€…éƒ½å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶åˆ‡æ¢cutmix å’Œmixup çš„æ¦‚ç‡ ã€‚</p> 
 <p>mode (str): å¦‚ä½•åº”ç”¨ mixup/cutmix å‚æ•°ï¼ˆæ¯ä¸ªâ€™batchâ€™ï¼Œâ€˜pairâ€™ï¼ˆå…ƒç´ å¯¹ï¼‰ï¼Œâ€˜elemâ€™ï¼ˆå…ƒç´ ï¼‰ã€‚</p> 
 <p>correct_lam (bool): å½“ cutmix bbox è¢«å›¾åƒè¾¹æ¡†å‰ªè£æ—¶åº”ç”¨ã€‚ lambda æ ¡æ­£</p> 
 <p>label_smoothing (float)ï¼šå°†æ ‡ç­¾å¹³æ»‘åº”ç”¨äºæ··åˆç›®æ ‡å¼ é‡ã€‚</p> 
 <p>num_classes (int): ç›®æ ‡çš„ç±»æ•°ã€‚</p> 
</blockquote> 
<h2><a id="EMA_219"></a>EMA</h2> 
<p>EMAï¼ˆExponential Moving Averageï¼‰æ˜¯æŒ‡æ•°ç§»åŠ¨å¹³å‡å€¼ã€‚åœ¨æ·±åº¦å­¦ä¹ ä¸­çš„åšæ³•æ˜¯ä¿å­˜å†å²çš„ä¸€ä»½å‚æ•°ï¼Œåœ¨ä¸€å®šè®­ç»ƒé˜¶æ®µåï¼Œæ‹¿å†å²çš„å‚æ•°ç»™ç›®å‰å­¦ä¹ çš„å‚æ•°åšä¸€æ¬¡å¹³æ»‘ã€‚å…·ä½“å®ç°å¦‚ä¸‹ï¼š</p> 
<pre><code class="prism language-python">
<span class="token keyword">import</span> logging
<span class="token keyword">from</span> collections <span class="token keyword">import</span> OrderedDict
<span class="token keyword">from</span> copy <span class="token keyword">import</span> deepcopy
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn

_logger <span class="token operator">=</span> logging<span class="token punctuation">.</span>getLogger<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">ModelEma</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model<span class="token punctuation">,</span> decay<span class="token operator">=</span><span class="token number">0.9999</span><span class="token punctuation">,</span> device<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">,</span> resume<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># make a copy of the model for accumulating moving average of weights</span>
        self<span class="token punctuation">.</span>ema <span class="token operator">=</span> deepcopy<span class="token punctuation">(</span>model<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ema<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>decay <span class="token operator">=</span> decay
        self<span class="token punctuation">.</span>device <span class="token operator">=</span> device  <span class="token comment"># perform ema on different device from model if set</span>
        <span class="token keyword">if</span> device<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>ema<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token operator">=</span>device<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>ema_has_module <span class="token operator">=</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>ema<span class="token punctuation">,</span> <span class="token string">'module'</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> resume<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>_load_checkpoint<span class="token punctuation">(</span>resume<span class="token punctuation">)</span>
        <span class="token keyword">for</span> p <span class="token keyword">in</span> self<span class="token punctuation">.</span>ema<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            p<span class="token punctuation">.</span>requires_grad_<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">_load_checkpoint</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> checkpoint_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
        checkpoint <span class="token operator">=</span> torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span>checkpoint_path<span class="token punctuation">,</span> map_location<span class="token operator">=</span><span class="token string">'cpu'</span><span class="token punctuation">)</span>
        <span class="token keyword">assert</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>checkpoint<span class="token punctuation">,</span> <span class="token builtin">dict</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">'state_dict_ema'</span> <span class="token keyword">in</span> checkpoint<span class="token punctuation">:</span>
            new_state_dict <span class="token operator">=</span> OrderedDict<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> checkpoint<span class="token punctuation">[</span><span class="token string">'state_dict_ema'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token comment"># ema model may have been wrapped by DataParallel, and need module prefix</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>ema_has_module<span class="token punctuation">:</span>
                    name <span class="token operator">=</span> <span class="token string">'module.'</span> <span class="token operator">+</span> k <span class="token keyword">if</span> <span class="token keyword">not</span> k<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'module'</span><span class="token punctuation">)</span> <span class="token keyword">else</span> k
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    name <span class="token operator">=</span> k
                new_state_dict<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> v
            self<span class="token punctuation">.</span>ema<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>new_state_dict<span class="token punctuation">)</span>
            _logger<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Loaded state_dict_ema"</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            _logger<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">"Failed to find state_dict_ema, starting from loaded model weights"</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">update</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> model<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># correct a mismatch in state dict keys</span>
        needs_module <span class="token operator">=</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span> <span class="token string">'module'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">not</span> self<span class="token punctuation">.</span>ema_has_module
        <span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            msd <span class="token operator">=</span> model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> k<span class="token punctuation">,</span> ema_v <span class="token keyword">in</span> self<span class="token punctuation">.</span>ema<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                <span class="token keyword">if</span> needs_module<span class="token punctuation">:</span>
                    k <span class="token operator">=</span> <span class="token string">'module.'</span> <span class="token operator">+</span> k
                model_v <span class="token operator">=</span> msd<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>detach<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">if</span> self<span class="token punctuation">.</span>device<span class="token punctuation">:</span>
                    model_v <span class="token operator">=</span> model_v<span class="token punctuation">.</span>to<span class="token punctuation">(</span>device<span class="token operator">=</span>self<span class="token punctuation">.</span>device<span class="token punctuation">)</span>
                ema_v<span class="token punctuation">.</span>copy_<span class="token punctuation">(</span>ema_v <span class="token operator">*</span> self<span class="token punctuation">.</span>decay <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token number">1.</span> <span class="token operator">-</span> self<span class="token punctuation">.</span>decay<span class="token punctuation">)</span> <span class="token operator">*</span> model_v<span class="token punctuation">)</span>

</code></pre> 
<p>åŠ å…¥åˆ°æ¨¡å‹ä¸­ã€‚</p> 
<pre><code class="prism language-python"><span class="token comment">#åˆå§‹åŒ–</span>
<span class="token keyword">if</span> use_ema<span class="token punctuation">:</span>
     model_ema <span class="token operator">=</span> ModelEma<span class="token punctuation">(</span>
            model_ft<span class="token punctuation">,</span>
            decay<span class="token operator">=</span>model_ema_decay<span class="token punctuation">,</span>
            device<span class="token operator">=</span><span class="token string">'cpu'</span><span class="token punctuation">,</span>
            resume<span class="token operator">=</span>resume<span class="token punctuation">)</span>

<span class="token comment"># è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ›´æ–°å®Œå‚æ•°åï¼ŒåŒæ­¥update shadow weights</span>
<span class="token keyword">def</span> <span class="token function">train</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> model_ema <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        model_ema<span class="token punctuation">.</span>update<span class="token punctuation">(</span>model<span class="token punctuation">)</span>


<span class="token comment"># å°†model_emaä¼ å…¥éªŒè¯å‡½æ•°ä¸­</span>
val<span class="token punctuation">(</span>model_ema<span class="token punctuation">.</span>ema<span class="token punctuation">,</span> DEVICE<span class="token punctuation">,</span> test_loader<span class="token punctuation">)</span>
</code></pre> 
<p>é’ˆå¯¹æ²¡æœ‰é¢„è®­ç»ƒçš„æ¨¡å‹ï¼Œå®¹æ˜“å‡ºç°EMAä¸ä¸Šåˆ†çš„æƒ…å†µï¼Œè¿™ç‚¹å¤§å®¶è¦æ³¨æ„å•Šï¼</p> 
<h2><a id="_299"></a>é¡¹ç›®ç»“æ„</h2> 
<pre><code class="prism language-python">InternImage_Demo
â”œâ”€data1
â”‚  â”œâ”€Black<span class="token operator">-</span>grass
â”‚  â”œâ”€Charlock
â”‚  â”œâ”€Cleavers
â”‚  â”œâ”€Common Chickweed
â”‚  â”œâ”€Common wheat
â”‚  â”œâ”€Fat Hen
â”‚  â”œâ”€Loose Silky<span class="token operator">-</span>bent
â”‚  â”œâ”€Maize
â”‚  â”œâ”€Scentless Mayweed
â”‚  â”œâ”€Shepherds Purse
â”‚  â”œâ”€Small<span class="token operator">-</span>flowered Cranesbill
â”‚  â””â”€Sugar beet
â”œâ”€models
â”‚  â”œâ”€__init__<span class="token punctuation">.</span>py
â”‚  â””â”€intern_image<span class="token punctuation">.</span>py
â”œâ”€ops_dcnv3
â”œâ”€mean_std<span class="token punctuation">.</span>py
â”œâ”€makedata<span class="token punctuation">.</span>py
â”œâ”€train<span class="token punctuation">.</span>py
â”œâ”€cam_image<span class="token punctuation">.</span>py
â””â”€test<span class="token punctuation">.</span>py
</code></pre> 
<p>ops_dcnv3ï¼šæ¥ç€å®˜æ–¹çš„æ–‡ä»¶å¤¹ï¼Œå­˜æ”¾dcnv3çš„æ–‡ä»¶ã€‚<br> modelsï¼šæ¥æºå®˜æ–¹ä»£ç ï¼Œå¯¹é¢çš„ä»£ç åšäº†ä¸€äº›é€‚åº”æ€§ä¿®æ”¹ã€‚å¢åŠ äº†ä¸€äº›åŠ è½½é¢„è®­ç»ƒï¼Œè°ƒç”¨æ¨¡å‹çš„é€»è¾‘ã€‚<br> mean_std.pyï¼šè®¡ç®—meanå’Œstdçš„å€¼ã€‚<br> makedata.pyï¼šç”Ÿæˆæ•°æ®é›†ã€‚<br> ema.pyï¼šEMAè„šæœ¬<br> train.py:è®­ç»ƒPoolFormeræ¨¡å‹<br> cam_image.pyï¼šçƒ­åŠ›å›¾å¯è§†åŒ–</p> 
<h2><a id="meanstd_334"></a>è®¡ç®—meanå’Œstd</h2> 
<p>ä¸ºäº†ä½¿æ¨¡å‹æ›´åŠ å¿«é€Ÿçš„æ”¶æ•›ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—å‡ºmeanå’Œstdçš„å€¼ï¼Œæ–°å»ºmean_std.py,æ’å…¥ä»£ç ï¼š</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> torchvision<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> ImageFolder
<span class="token keyword">import</span> torch
<span class="token keyword">from</span> torchvision <span class="token keyword">import</span> transforms

<span class="token keyword">def</span> <span class="token function">get_mean_and_std</span><span class="token punctuation">(</span>train_data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    train_loader <span class="token operator">=</span> torch<span class="token punctuation">.</span>utils<span class="token punctuation">.</span>data<span class="token punctuation">.</span>DataLoader<span class="token punctuation">(</span>
        train_data<span class="token punctuation">,</span> batch_size<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> shuffle<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> num_workers<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>
        pin_memory<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    mean <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    std <span class="token operator">=</span> torch<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> X<span class="token punctuation">,</span> _ <span class="token keyword">in</span> train_loader<span class="token punctuation">:</span>
        <span class="token keyword">for</span> d <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            mean<span class="token punctuation">[</span>d<span class="token punctuation">]</span> <span class="token operator">+=</span> X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> d<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token punctuation">)</span>
            std<span class="token punctuation">[</span>d<span class="token punctuation">]</span> <span class="token operator">+=</span> X<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> d<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>std<span class="token punctuation">(</span><span class="token punctuation">)</span>
    mean<span class="token punctuation">.</span>div_<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>train_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    std<span class="token punctuation">.</span>div_<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>train_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token builtin">list</span><span class="token punctuation">(</span>mean<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">(</span>std<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    train_dataset <span class="token operator">=</span> ImageFolder<span class="token punctuation">(</span>root<span class="token operator">=</span><span class="token string">r'data1'</span><span class="token punctuation">,</span> transform<span class="token operator">=</span>transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>get_mean_and_std<span class="token punctuation">(</span>train_dataset<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>æ•°æ®é›†ç»“æ„ï¼š</p> 
<p><img src="https://images2.imgbox.com/50/37/vsj40JJF_o.png" alt="image-20220221153058619"></p> 
<p>è¿è¡Œç»“æœï¼š</p> 
<pre><code>([0.3281186, 0.28937867, 0.20702125], [0.09407319, 0.09732835, 0.106712654])
</code></pre> 
<p>æŠŠè¿™ä¸ªç»“æœè®°å½•ä¸‹æ¥ï¼Œåé¢è¦ç”¨ï¼</p> 
<h2><a id="_374"></a>ç”Ÿæˆæ•°æ®é›†</h2> 
<p>æˆ‘ä»¬æ•´ç†è¿˜çš„å›¾åƒåˆ†ç±»çš„æ•°æ®é›†ç»“æ„æ˜¯è¿™æ ·çš„</p> 
<pre><code class="prism language-python">data
â”œâ”€Black<span class="token operator">-</span>grass
â”œâ”€Charlock
â”œâ”€Cleavers
â”œâ”€Common Chickweed
â”œâ”€Common wheat
â”œâ”€Fat Hen
â”œâ”€Loose Silky<span class="token operator">-</span>bent
â”œâ”€Maize
â”œâ”€Scentless Mayweed
â”œâ”€Shepherds Purse
â”œâ”€Small<span class="token operator">-</span>flowered Cranesbill
â””â”€Sugar beet
</code></pre> 
<p>pytorchå’Œkerasé»˜è®¤åŠ è½½æ–¹å¼æ˜¯ImageNetæ•°æ®é›†æ ¼å¼ï¼Œæ ¼å¼æ˜¯</p> 
<pre><code class="prism language-python">â”œâ”€data
â”‚  â”œâ”€val
â”‚  â”‚   â”œâ”€Black<span class="token operator">-</span>grass
â”‚  â”‚   â”œâ”€Charlock
â”‚  â”‚   â”œâ”€Cleavers
â”‚  â”‚   â”œâ”€Common Chickweed
â”‚  â”‚   â”œâ”€Common wheat
â”‚  â”‚   â”œâ”€Fat Hen
â”‚  â”‚   â”œâ”€Loose Silky<span class="token operator">-</span>bent
â”‚  â”‚   â”œâ”€Maize
â”‚  â”‚   â”œâ”€Scentless Mayweed
â”‚  â”‚   â”œâ”€Shepherds Purse
â”‚  â”‚   â”œâ”€Small<span class="token operator">-</span>flowered Cranesbill
â”‚  â”‚   â””â”€Sugar beet
â”‚  â””â”€train
â”‚      â”œâ”€Black<span class="token operator">-</span>grass
â”‚      â”œâ”€Charlock
â”‚      â”œâ”€Cleavers
â”‚      â”œâ”€Common Chickweed
â”‚      â”œâ”€Common wheat
â”‚      â”œâ”€Fat Hen
â”‚      â”œâ”€Loose Silky<span class="token operator">-</span>bent
â”‚      â”œâ”€Maize
â”‚      â”œâ”€Scentless Mayweed
â”‚      â”œâ”€Shepherds Purse
â”‚      â”œâ”€Small<span class="token operator">-</span>flowered Cranesbill
â”‚      â””â”€Sugar beet
</code></pre> 
<p>æ–°å¢æ ¼å¼è½¬åŒ–è„šæœ¬makedata.py,æ’å…¥ä»£ç ï¼š</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> glob
<span class="token keyword">import</span> os
<span class="token keyword">import</span> shutil

image_list<span class="token operator">=</span>glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">'data1/*/*.png'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>image_list<span class="token punctuation">)</span>
file_dir<span class="token operator">=</span><span class="token string">'data'</span>
<span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>file_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'true'</span><span class="token punctuation">)</span>
    <span class="token comment">#os.rmdir(file_dir)</span>
    shutil<span class="token punctuation">.</span>rmtree<span class="token punctuation">(</span>file_dir<span class="token punctuation">)</span><span class="token comment">#åˆ é™¤å†å»ºç«‹</span>
    os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>file_dir<span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>file_dir<span class="token punctuation">)</span>

<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
trainval_files<span class="token punctuation">,</span> val_files <span class="token operator">=</span> train_test_split<span class="token punctuation">(</span>image_list<span class="token punctuation">,</span> test_size<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span> random_state<span class="token operator">=</span><span class="token number">42</span><span class="token punctuation">)</span>
train_dir<span class="token operator">=</span><span class="token string">'train'</span>
val_dir<span class="token operator">=</span><span class="token string">'val'</span>
train_root<span class="token operator">=</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>file_dir<span class="token punctuation">,</span>train_dir<span class="token punctuation">)</span>
val_root<span class="token operator">=</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>file_dir<span class="token punctuation">,</span>val_dir<span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> trainval_files<span class="token punctuation">:</span>
    file_class<span class="token operator">=</span><span class="token builtin">file</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\\"</span><span class="token punctuation">,</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>
    file_name<span class="token operator">=</span><span class="token builtin">file</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\\"</span><span class="token punctuation">,</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    file_class<span class="token operator">=</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>train_root<span class="token punctuation">,</span>file_class<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>file_class<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>file_class<span class="token punctuation">)</span>
    shutil<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> file_class <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> file_name<span class="token punctuation">)</span>

<span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> val_files<span class="token punctuation">:</span>
    file_class<span class="token operator">=</span><span class="token builtin">file</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\\"</span><span class="token punctuation">,</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>
    file_name<span class="token operator">=</span><span class="token builtin">file</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"\\"</span><span class="token punctuation">,</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    file_class<span class="token operator">=</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>val_root<span class="token punctuation">,</span>file_class<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>file_class<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>makedirs<span class="token punctuation">(</span>file_class<span class="token punctuation">)</span>
    shutil<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">,</span> file_class <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> file_name<span class="token punctuation">)</span>
</code></pre> 
<p>å®Œæˆä¸Šé¢çš„å†…å®¹å°±å¯ä»¥å¼€å¯è®­ç»ƒå’Œæµ‹è¯•äº†ã€‚</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f0428ba2de08ffdafb48e755b5465d69/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">ç¬”è®°è½¯ä»¶æ€ä¹ˆå¯¼å…¥PDFæ–‡ä»¶</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/37f667b466a12389f386db883de9ebbe/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">åˆ†äº«åœ¨é˜¿é‡ŒåšJavaç ”å‘5å¹´çš„æœ‹å‹çš„ä»ä¸šå¿ƒå¾—ï¼Œé€ç»™è¿˜åœ¨è¿·èŒ«ä¸­çš„ä½ </p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 èœé¸Ÿç¨‹åºå‘˜åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>