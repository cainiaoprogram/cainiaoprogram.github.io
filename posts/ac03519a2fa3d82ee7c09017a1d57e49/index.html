<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue3学习之hook - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue3学习之hook" />
<meta property="og:description" content="由于使用vue3.2已经有段时间，对于setup-api的应用也有了基础的认识，最近一直疑惑的一个问题就是作者为什么从2x 升级到3x 直接改变了vue项目文件的形态。要知道这样做会增加vue的学习成本，那么就必然是老版本有痛点，新版本有优势。在3x版本被重点提及的hook又是什么？如何使用？我们一起来探讨。
一、Hook是什么？ 首先我们来看看官方对hook的定义：
当构建前端应用时，我们常常需要复用公共任务的逻辑。例如为了在不同地方格式化时间，我们可能会抽取一个可复用的日期格式化函数。这个函数封装了无状态的逻辑：它在接收一些输入后立刻返回所期望的输出。
很清晰明了的说明了hook是做什么的，但是又觉得有什么不对的地方，这不是和2x版本的mixin的功能有些相似么？那接下来我们写一个功能对比下看看。
二、编写自己的hook 使用2x实现联动选择城市功能 &lt;!-- html --&gt; &lt;template&gt; &lt;div style=&#34;padding:100px 40%&#34;&gt; 联动选择省市 &lt;el-select v-model=&#34;province&#34; placeholder=&#34;选择省份&#34;&gt; &lt;el-option v-for=&#34;(item,index) in provinceList&#34; :key=&#34;index&#34; :value=&#34;item&#34; :label=&#34;item&#34;&gt; &lt;/el-option&gt; &lt;/el-select&gt; &lt;el-select v-model=&#34;city&#34; placeholder=&#34;选择市&#34;&gt; &lt;el-option v-for=&#34;(item, index) in cityList&#34; :key=&#34;index&#34; :value=&#34;item&#34; :label=&#34;item&#34;&gt; &lt;/el-option&gt; &lt;/el-select&gt; &lt;/div&gt; &lt;/template&gt; // js 部分 export default { data () { return { province: &#39;&#39;, city: &#39;&#39;, provinceList: [], cityList: [] } }, mounted () { this.getProvinceList() }, watch: { province () { this." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ac03519a2fa3d82ee7c09017a1d57e49/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-17T08:51:47+08:00" />
<meta property="article:modified_time" content="2023-11-17T08:51:47+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue3学习之hook</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>由于使用vue3.2已经有段时间，对于setup-api的应用也有了基础的认识，最近一直疑惑的一个问题就是作者为什么从2x 升级到3x 直接改变了vue项目文件的形态。要知道这样做会增加vue的学习成本，那么就必然是老版本有痛点，新版本有优势。在3x版本被重点提及的hook又是什么？如何使用？我们一起来探讨。</p> 
<h5><a id="Hook_6"></a>一、Hook是什么？</h5> 
<p>首先我们来看看官方对hook的定义：</p> 
<blockquote> 
 <p>当构建前端应用时，我们常常需要复用公共任务的逻辑。例如为了在不同地方格式化时间，我们可能会抽取一个可复用的日期格式化函数。这个函数封装了无状态的逻辑：它在接收一些输入后立刻返回所期望的输出。</p> 
</blockquote> 
<p>很清晰明了的说明了hook是做什么的，但是又觉得有什么不对的地方，这不是和2x版本的mixin的功能有些相似么？那接下来我们写一个功能对比下看看。</p> 
<h5><a id="hook_12"></a>二、编写自己的hook</h5> 
<h6><a id="2x_14"></a>使用2x实现联动选择城市功能</h6> 
<pre><code class="prism language-html"><span class="token comment">&lt;!-- html --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value css language-css"><span class="token property">padding</span><span class="token punctuation">:</span>100px 40%</span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>
        联动选择省市
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-select</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>province<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>选择省份<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-option</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(item,index) in provinceList<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>index<span class="token punctuation">"</span></span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span> <span class="token attr-name">:label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-option</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-select</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-select</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>city<span class="token punctuation">"</span></span> <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>选择市<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>el-option</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>(item, index) in cityList<span class="token punctuation">"</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>index<span class="token punctuation">"</span></span> <span class="token attr-name">:value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span> <span class="token attr-name">:label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-option</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>el-select</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<pre><code class="prism language-javascript"><span class="token comment">// js 部分 </span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">province</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
            <span class="token literal-property property">city</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
            <span class="token literal-property property">provinceList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token literal-property property">cityList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getProvinceList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">province</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getCityList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">getProvinceList</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>provinceList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'河南'</span><span class="token punctuation">,</span> <span class="token string">'安徽'</span><span class="token punctuation">,</span> <span class="token string">'西安'</span><span class="token punctuation">,</span> <span class="token string">'杭州'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">getCityList</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>city <span class="token operator">=</span> <span class="token string">''</span>
            <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string-property property">'河南'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'郑州'</span><span class="token punctuation">,</span> <span class="token string">'洛阳'</span><span class="token punctuation">,</span> <span class="token string">'周口'</span><span class="token punctuation">,</span> <span class="token string">'开封'</span><span class="token punctuation">,</span> <span class="token string">'商丘'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string-property property">'安徽'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'合肥'</span><span class="token punctuation">,</span> <span class="token string">'阜阳'</span><span class="token punctuation">,</span> <span class="token string">'六安'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string-property property">'西安'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'西安'</span><span class="token punctuation">,</span> <span class="token string">'宝鸡'</span><span class="token punctuation">,</span> <span class="token string">'延安'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>cityList <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>province<span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="mixin_69"></a>抽离封装mixin</h6> 
<pre><code class="prism language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">province</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
            <span class="token literal-property property">city</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
            <span class="token literal-property property">provinceList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token literal-property property">cityList</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getProvinceList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">province</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getCityList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">methods</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">getProvinceList</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>provinceList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'河南'</span><span class="token punctuation">,</span> <span class="token string">'安徽'</span><span class="token punctuation">,</span> <span class="token string">'西安'</span><span class="token punctuation">,</span> <span class="token string">'杭州'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">getCityList</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>city <span class="token operator">=</span> <span class="token string">''</span>
            <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string-property property">'河南'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'郑州'</span><span class="token punctuation">,</span> <span class="token string">'洛阳'</span><span class="token punctuation">,</span> <span class="token string">'周口'</span><span class="token punctuation">,</span> <span class="token string">'开封'</span><span class="token punctuation">,</span> <span class="token string">'商丘'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string-property property">'安徽'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'合肥'</span><span class="token punctuation">,</span> <span class="token string">'阜阳'</span><span class="token punctuation">,</span> <span class="token string">'六安'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                <span class="token string-property property">'西安'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'西安'</span><span class="token punctuation">,</span> <span class="token string">'宝鸡'</span><span class="token punctuation">,</span> <span class="token string">'延安'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>cityList <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>province<span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> mixin <span class="token keyword">from</span> <span class="token string">'./mixin'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">mixins</span><span class="token operator">:</span> <span class="token punctuation">[</span>mixin<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 其他数据</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 编写其他逻辑</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="hook_Demo_121"></a>官方hook Demo</h6> 
<p>使用组合式 API 实现鼠标跟踪功能</p> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span>
<span class="token comment">// mouse.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> ref<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> onUnmounted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token comment">// 按照惯例，组合式函数名以“use”开头</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useMouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">// 被组合式函数封装和管理的状态</span>
  <span class="token keyword">const</span> x <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> y <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>

  <span class="token comment">// 组合式函数可以随时更改其状态。</span>
  <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    x<span class="token punctuation">.</span>value <span class="token operator">=</span> event<span class="token punctuation">.</span>pageX
    y<span class="token punctuation">.</span>value <span class="token operator">=</span> event<span class="token punctuation">.</span>pageY
  <span class="token punctuation">}</span>

  <span class="token comment">// 一个组合式函数也可以挂靠在所属组件的生命周期上</span>
  <span class="token comment">// 来启动和卸载副作用</span>
  <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'mousemove'</span><span class="token punctuation">,</span> update<span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment">// 通过返回值暴露所管理的状态</span>
  <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> useMouse <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./mouse.js'</span>

<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> x<span class="token punctuation">,</span> y <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">useMouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>Mouse position is at: {<!-- -->{ x }}, {<!-- -->{ y }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h6><a id="hook_162"></a>编写自己的联动选择城市hook</h6> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>ref<span class="token punctuation">,</span> onMounted<span class="token punctuation">,</span> watch<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">usePeovicenAndCity</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    
    <span class="token comment">// province数据相关</span>
    <span class="token keyword">const</span> province <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> provinceList <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">getProvinceList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        provinceList<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'河南'</span><span class="token punctuation">,</span> <span class="token string">'安徽'</span><span class="token punctuation">,</span> <span class="token string">'西安'</span><span class="token punctuation">,</span> <span class="token string">'杭州'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
    <span class="token function">watch</span><span class="token punctuation">(</span>province<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">getCityList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token comment">// city数据相关</span>
    <span class="token keyword">const</span> city <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> cityList <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> <span class="token function-variable function">getCityList</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        city<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string-property property">'河南'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'郑州'</span><span class="token punctuation">,</span> <span class="token string">'洛阳'</span><span class="token punctuation">,</span> <span class="token string">'周口'</span><span class="token punctuation">,</span> <span class="token string">'开封'</span><span class="token punctuation">,</span> <span class="token string">'商丘'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">'安徽'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'合肥'</span><span class="token punctuation">,</span> <span class="token string">'阜阳'</span><span class="token punctuation">,</span> <span class="token string">'六安'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token string-property property">'西安'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'西安'</span><span class="token punctuation">,</span> <span class="token string">'宝鸡'</span><span class="token punctuation">,</span> <span class="token string">'延安'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        cityList<span class="token punctuation">.</span>value <span class="token operator">=</span> data<span class="token punctuation">[</span>province<span class="token punctuation">.</span>value<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// mounted 调取省份数据</span>
    <span class="token function">onMounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">getProvinceList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>province<span class="token punctuation">,</span> city<span class="token punctuation">,</span> provinceList<span class="token punctuation">,</span> cityList<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>ref<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>usePeovicenAndCity<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./hook'</span>
<span class="token keyword">let</span> <span class="token punctuation">{<!-- --></span>province<span class="token punctuation">,</span> city<span class="token punctuation">,</span> provinceList<span class="token punctuation">,</span> cityList<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">usePeovicenAndCity</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="hookmixin_208"></a>三、hook与mixin的对比</h5> 
<p>从上面的代码实现来看，mixin复用通用代码看起来好像更优雅，简洁。那么我们对比下页面有多个复用的情况。</p> 
<p>mixin</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> mixin1 <span class="token keyword">from</span> <span class="token string">'./mixin1'</span>
<span class="token keyword">import</span> mixin2 <span class="token keyword">from</span> <span class="token string">'./mixin2'</span>
<span class="token keyword">import</span> mixin3 <span class="token keyword">from</span> <span class="token string">'./mixin3'</span>
<span class="token keyword">import</span> mixin4 <span class="token keyword">from</span> <span class="token string">'./mixin4'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">mixins</span><span class="token operator">:</span> <span class="token punctuation">[</span>mixin1<span class="token punctuation">,</span>mixin2<span class="token punctuation">,</span>mixin3<span class="token punctuation">,</span>mixin4<span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 其他数据</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">key</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// do something</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>hook</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>ref<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span>fun1<span class="token punctuation">,</span> fun2<span class="token punctuation">,</span> fun3<span class="token punctuation">,</span> fun4<span class="token punctuation">,</span><span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./hook'</span>
<span class="token keyword">let</span> <span class="token punctuation">{<!-- --></span>data1<span class="token punctuation">,</span> a1<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">fun1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> <span class="token punctuation">{<!-- --></span>data2<span class="token punctuation">,</span> a2<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">fun2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> <span class="token punctuation">{<!-- --></span>data3<span class="token punctuation">,</span> a3<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">fun3</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> <span class="token punctuation">{<!-- --></span>data4<span class="token punctuation">,</span> a4<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">fun4</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>如果页面上某个数据异常，而这个数据是从mixin里面获取的，那么就需要在多个mixin里面一点点找，如果项目庞大的话，这将是个灾难。<br> 对比3x的hook数据源清晰明了,每个数据源都能找到对应的代码片段。</p> 
<h5><a id="vue3_248"></a>四、vue3学习和项目迁移（个人理解）：</h5> 
<h6><a id="13x_251"></a>1.3x版本的优势</h6> 
<blockquote> 
 <p>复用相同的逻辑太舒服啦，一个功能模块的代码都在一起，不用上下来回找。</p> 
</blockquote> 
<h6><a id="23x_254"></a>2.3x版本的问题</h6> 
<blockquote> 
 <p>1、.value的赋值/访问形式太难受了，希望官方后期可以解决；<br> 2、如果有老项目迁移，需要开发者付出一部分精力去学习，对于项目来讲成本增加了很多</p> 
</blockquote> 
<h6><a id="3_258"></a>3.阅读性和维护</h6> 
<blockquote> 
 <p>首先从项目的阅读性和维护难度来讲，2x版本的下限高，上限低。3x版本的上限很高，下限很低理想状态下 从上至下的代码可以简化为 功能A-功能B-功能C… 各个功能之间没有耦合的代码，而2x版本的代码功能是分散在data、watch、methods 各个模块之间的，所以3x版本相较于2x上限会高很多，同样下限也会低与2x, 因为各种api没有了约束，对于不熟悉的开发者会造成功能代码更乱等问题。</p> 
</blockquote> 
<h6><a id="43x_261"></a>4.哪些项目适合使用3x</h6> 
<blockquote> 
 <p>新项目：综合学习成本和项目复杂度来决定。新的版本必定要有一定的学习成本，这个时间对于项目来讲</p> 
</blockquote>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/32d9eb5d33a72f550132ea5cb8cb34c5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">单点登录和Auth2.0</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a79e9f5c5936dc9f4feb21e8d2b01fd1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">applicationContext.getBean 为null</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>