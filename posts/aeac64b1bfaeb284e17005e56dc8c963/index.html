<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【C&#43;&#43;】Map、Set 模拟实现 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【C&#43;&#43;】Map、Set 模拟实现" />
<meta property="og:description" content="文章目录 📕 概念📕 实现框架Find()★ 迭代器 ★反向迭代器map 的 operator[ ] 📕 源代码rb_tree.hset.hmap.h 📕 概念 map、set 是 C&#43;&#43; 中的关联式容器，由于 map 和set所开放的各种操作接口，RB-tree 也都提供了，所以几乎所有的 map 和set的操作行为，都只是转调 红黑树 的操作行为。
关联式容器也是用来存储数据的，与序列式容器不同的是，其里面存储的是&lt;key, value&gt;结构的键值对，在数据检索时比序列式容器效率更高。
📕 实现 框架 map、set 一个很明显的区别就是，set 存储值，map存储键值对。
set 的结构如下，只需要传入一个模板参数 K ，也就是其实际存储的值的数据类型。复用红黑树的时候，第二个参数就是 K 类型。
#pragma once #include&#34;rb_tree.h&#34; namespace SetSimulate { template&lt;class K&gt; class set { struct KeyOfT { const K&amp; operator()(const K&amp; k) { return k; } }; public: typedef typename RBTree&lt;K, K, KeyOfT&gt;::const_iterator iterator; typedef typename RBTree&lt;K, K, KeyOfT&gt;::const_iterator const_iterator; private: RBTree&lt;K, K, KeyOfT&gt; _t; }; } 而 Map 就不一样了，要传入两个参数，第一个是 K（键值），第二个是 V （映射值）。实际存储的数据类型是 pair&lt;K,V&gt; 。如下，复用红黑树的时候，将其第二个模板参数设为 pair&lt;K,V&gt; 即可。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/aeac64b1bfaeb284e17005e56dc8c963/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-28T16:51:12+08:00" />
<meta property="article:modified_time" content="2023-05-28T16:51:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【C&#43;&#43;】Map、Set 模拟实现</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#__2" rel="nofollow">📕 概念</a></li><li><a href="#__7" rel="nofollow">📕 实现</a></li><li><ul><li><a href="#_9" rel="nofollow">框架</a></li><li><a href="#Find_85" rel="nofollow">Find()</a></li><li><a href="#___155" rel="nofollow">★ 迭代器 ★</a></li><li><a href="#_305" rel="nofollow">反向迭代器</a></li><li><a href="#map__operator__535" rel="nofollow">map 的 operator[ ]</a></li></ul> 
  </li><li><a href="#__559" rel="nofollow">📕 源代码</a></li><li><ul><li><a href="#rb_treeh_561" rel="nofollow">rb_tree.h</a></li><li><a href="#seth_1136" rel="nofollow">set.h</a></li><li><a href="#maph_1221" rel="nofollow">map.h</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="__2"></a>📕 概念</h2> 
<p>map、set 是 C++ 中的关联式容器，由于 map 和set所开放的各种操作接口，RB-tree 也都提供了，所以几乎所有的 map 和set的操作行为，都只是转调 <strong>红黑树</strong> 的操作行为。</p> 
<p>关联式容器也是用来存储数据的，与序列式容器不同的是，其里面存储的是&lt;key, value&gt;结构的键值对，在数据检索时比序列式容器效率更高。</p> 
<h2><a id="__7"></a>📕 实现</h2> 
<h3><a id="_9"></a>框架</h3> 
<p>map、set 一个很明显的区别就是，<strong>set 存储值，map存储键值对</strong>。</p> 
<p>set 的结构如下，只需要传入一个模板参数 K ，也就是其实际存储的值的数据类型。复用红黑树的时候，第二个参数就是 K 类型。</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"rb_tree.h"</span></span>

<span class="token keyword">namespace</span> SetSimulate
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token operator">&gt;</span>
	<span class="token keyword">class</span> <span class="token class-name">set</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">struct</span> <span class="token class-name">KeyOfT</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">const</span> K<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> k<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> k<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span><span class="token operator">:</span>

		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> K<span class="token punctuation">,</span> KeyOfT<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>const_iterator iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> K<span class="token punctuation">,</span> KeyOfT<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>const_iterator const_iterator<span class="token punctuation">;</span>
		

	<span class="token keyword">private</span><span class="token operator">:</span>
		RBTree<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> K<span class="token punctuation">,</span> KeyOfT<span class="token operator">&gt;</span> _t<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>而 Map 就不一样了，要<strong>传入两个参数，第一个是 K（键值），第二个是 V （映射值）</strong>。实际存储的数据类型是 pair&lt;K,V&gt; 。如下，复用红黑树的时候，将其第二个模板参数设为 pair&lt;K,V&gt; 即可。</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"rb_tree.h"</span></span>


<span class="token keyword">namespace</span> MapSimulate
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">V</span><span class="token operator">&gt;</span>
	<span class="token keyword">class</span> <span class="token class-name">map</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">struct</span> <span class="token class-name">MapOfKey</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">const</span> K<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> kv<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span><span class="token operator">:</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span>V<span class="token operator">&gt;</span><span class="token punctuation">,</span> MapOfKey<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>iterator iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span>V<span class="token operator">&gt;</span><span class="token punctuation">,</span> MapOfKey<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>const_iterator const_iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token punctuation">,</span> MapOfKey<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>reverse_iterator reverse_iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token punctuation">,</span> MapOfKey<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>const_reverse_iterator const_reverse_iterator<span class="token punctuation">;</span>


	<span class="token keyword">private</span><span class="token operator">:</span>
		RBTree<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token punctuation">,</span> MapOfKey<span class="token operator">&gt;</span> _t<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>关于 map、set 底层红黑树的第三个模板参数，分析上面的两段代码，实际上是<strong>取存储数据的 K 值</strong>。即，<strong>在 map 里面</strong>，由于存储的数据类型是 pair&lt;K,V&gt; ，所以 MapOfKey 的作用是取到键值对里面 K 类型的数据；<strong>而 set 里面</strong>，由于存储的数据本身就是 K 类型，所以 SetOfKey <strong>直接取到该类型的数据</strong>。</p> 
<p>至于为什么要这样，这是因为，<strong>map、set 是对红黑树的封装</strong>，如果仅仅实现 set ，可以不用给红黑树传入第三个模板参数，因为 set 里面存储 K 类型的数据，而<strong>红黑树插入、查找、删除等等操作里面，数据之间进行比较，本就是比较的 K 类型的数据</strong>，所以是一致的。<br> 但是，map 存储的是 pair&lt;K,V&gt; ，<strong>由于map、set 是复用同一份红黑树代码，所以无法将代码直接改成适应 pair&lt;K,V&gt; 的情况（这样就不适应 set 了）</strong>。所以，需要有一个统一的视角，来得到map、set 的数据里面的 K 值。</p> 
<p>当然，上面两端说起来比较抽象，接下来介绍一下 Find 封装，就不难理解了。</p> 
<h3><a id="Find_85"></a>Find()</h3> 
<p>如下是红黑树底层实现 find 的代码。可以看到<strong>它在进行数据之间的比较时，是依靠 KeyOfT 实例化出的对象 kt ，取 kt(cur-&gt;_data)</strong> 。<br> 很显然，当容器无论为 set 还是 map， 红黑树中 find() 函数都依靠 K 类型的 val 来查找。可是， 红黑树的节点中， _data 存储的数据类型却不一样，map 中存储的是 pair&lt;K,V&gt;，set 中存储的是 K。</p> 
<p>所以，这里就依靠红黑树的第三个模板参数 KeyOfT 实例化的对象 kt，其重载的 () 来取到 map、set 的 _data 里面的 K 值。这样就统一了。</p> 
<pre><code class="prism language-cpp">	<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
	<span class="token keyword">struct</span> <span class="token class-name">RBTreeNode</span>
	<span class="token punctuation">{<!-- --></span>
		RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">*</span> _left<span class="token punctuation">;</span>
		RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">*</span> _right<span class="token punctuation">;</span>
		RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">*</span> _parent<span class="token punctuation">;</span>
		T _data<span class="token punctuation">;</span>
		Colour _col<span class="token punctuation">;</span>

		<span class="token function">RBTreeNode</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> val<span class="token punctuation">)</span>
			<span class="token operator">:</span> <span class="token function">_left</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
			<span class="token punctuation">,</span> <span class="token function">_right</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
			<span class="token punctuation">,</span> <span class="token function">_parent</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
			<span class="token punctuation">,</span> <span class="token function">_data</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
			<span class="token punctuation">,</span> <span class="token function">_col</span><span class="token punctuation">(</span>RED<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>


	<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">KeyOfT</span><span class="token operator">&gt;</span>
	<span class="token keyword">class</span> <span class="token class-name">RBTree</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">RBTreeNode</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>

	<span class="token keyword">public</span><span class="token operator">:</span>
		Node<span class="token operator">*</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> val<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			KeyOfT kt<span class="token punctuation">;</span>
			Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">&gt;</span> <span class="token function">kt</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">&lt;</span> <span class="token function">kt</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span>
					<span class="token keyword">return</span> cur<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
	<span class="token keyword">private</span><span class="token operator">:</span>
		Node<span class="token operator">*</span> _root<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> 
<p>如下，无论是 map 还是 set，都是直接调用红黑树的 find() ，然后封装成迭代器返回。</p> 
<pre><code class="prism language-cpp">iterator <span class="token function">Find</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> cur <span class="token operator">=</span> _t<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="___155"></a>★ 迭代器 ★</h3> 
<p>如下，是迭代器的大体框架，主要依靠红黑树的节点指针来实现。</p> 
<p>重载 * 、-&gt;、!= 都比较简单，和 list 封装的迭代器类似。但是 ，重载 ++ 和 – 就需要一些独特的思路了！</p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token keyword">class</span> <span class="token class-name">Ref</span><span class="token punctuation">,</span><span class="token keyword">class</span> <span class="token class-name">Ptr</span><span class="token operator">&gt;</span>
	<span class="token keyword">struct</span> <span class="token class-name">_RBTreeIterator</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">typedef</span> RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> _RBTreeIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Ref<span class="token punctuation">,</span> Ptr<span class="token operator">&gt;</span> self<span class="token punctuation">;</span>


		<span class="token function">_RBTreeIterator</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> node<span class="token punctuation">)</span>
			<span class="token operator">:</span><span class="token function">_node</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

		<span class="token comment">// begin() 、 end() 处可见其效果</span>
		<span class="token function">_RBTreeIterator</span><span class="token punctuation">(</span><span class="token keyword">const</span> _RBTreeIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> T<span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token operator">&amp;</span>it<span class="token punctuation">)</span>
			<span class="token operator">:</span><span class="token function">_node</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>_node<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>


		Ref <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _node<span class="token operator">-&gt;</span>_data<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword">const</span> self<span class="token operator">&amp;</span> s<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>_node <span class="token operator">!=</span> s<span class="token punctuation">.</span>_node<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		Ptr <span class="token keyword">operator</span><span class="token operator">-&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token operator">&amp;</span>_node<span class="token operator">-&gt;</span>_data<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 实现</span>
			
			<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">--</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 实现</span>
			
			<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		Node<span class="token operator">*</span> _node<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>operator++()</strong></p> 
<p>对红黑树的遍历，和搜索二叉树是一样的，<strong>中序遍历</strong>。<br> 例如，现在某棵红黑树存储了1到10 的数据，使用迭代器遍历的结果必然是 1、2、3、4、5、6、7、8、9、10。<br> 假设现在将存储 5 这个数据的节点，封装成迭代器 it。进行 ++it 操作之后，无疑 it 内部的节点指针，指向的是数据为 6 的节点。再 ++it，it 内部的结点指针就指向数据为 7 的节点。<br> 很明显，<strong>++ 操作，只需要考虑右边部分的结果</strong>（上面依次++it，实际上节点指针依次指向 6、7、8、9、10 ），不需要考虑 左边的部分（即 1-5 ）。</p> 
<p>这样就很清晰了，对于一个中序遍历的结果，对于某一个节点 X 的右边部分，分为两种情况：<strong>有数据是 X 的子节点（可能是部分，可能是全部）；没有数据是 X 的子节点</strong>。例如上面 5 这个结果，其右边部分6到10 里面，可能有数据是5的子节点，也可能没有。</p> 
<p>根据这两种情况来写代码。</p> 
<ul><li> <p>对于第一种情况——右边部分存在 X 的子节点。这就很容易了，由于是中序遍历，当前节点遍历完之后，就需要遍历其右子树。所以 ++ 操作，只要<strong>找到其右子树的最小节点即可</strong>。</p> </li><li> <p>对于第二种情况，X 不存在右子树，那么必然是要往上找。如下图，假设一开始是图中左边的状态， 现在有 cur 、p 两个节点指针，而 cur 没有右子树，向上寻找， cur 在 p 的右边，这说明 p 已经遍历过了。<br> 再继续往上找，到了下图右边的状态，此时 <strong>cur 在 p 的左边，根据中序遍历规则，下一个要遍历的节点就是 此时的 p</strong>。</p> </li></ul> 
<p><img src="https://images2.imgbox.com/2f/69/TDlSRnBA_o.png" alt="请添加图片描述" width="700"></p> 
<pre><code class="prism language-cpp">self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 右子树存在，先去右子树的第一个</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>_node<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Node<span class="token operator">*</span> subleft<span class="token operator">=</span>_node<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
				<span class="token keyword">while</span> <span class="token punctuation">(</span>subleft<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					subleft <span class="token operator">=</span> subleft<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>

				_node <span class="token operator">=</span> subleft<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token comment">// 右子树不存在，向上找</span>
			<span class="token punctuation">{<!-- --></span>
				Node<span class="token operator">*</span> cur <span class="token operator">=</span> _node<span class="token punctuation">;</span>
				Node<span class="token operator">*</span> parent <span class="token operator">=</span> _node<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
				<span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> parent<span class="token operator">-&gt;</span>_right <span class="token operator">==</span> cur<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
					parent <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				_node <span class="token operator">=</span> parent<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			
			<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
</code></pre> 
<p><strong>operator–()</strong></p> 
<p>而 – 就是和 ++ 反过来了，遍历顺序是：<strong>右子树、根、左子树</strong>。所以，拿到某个节点 X，要先去看左子树是否存在，不存在则往上找。</p> 
<ul><li>左子树存在，自然是去寻找<strong>左子树中最大的节点</strong>。</li><li>左子树不存在，往上找。如下图，假设当前迭代器封装的是 cur 节点，不存在左子树。 – 操作就应该向上找，在下图左边的状态时， cur 节点是 p节点的左孩子，根据 – 的遍历顺序，p 已经遍历过了。<br> 继续往上，到了下图右边的状态， <strong>cur 是 p 的右孩子，根据 - - 的遍历顺序，下一个节点就是 p</strong>。</li></ul> 
<p><img src="https://images2.imgbox.com/f6/8a/HVdqBPcU_o.png" alt="请添加图片描述" width="700"></p> 
<pre><code class="prism language-cpp">self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">--</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>_node<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Node<span class="token operator">*</span> subright <span class="token operator">=</span> _node<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
				<span class="token keyword">while</span> <span class="token punctuation">(</span>subright<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					subright <span class="token operator">=</span> subright<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				_node <span class="token operator">=</span> subright<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token comment">// 当前节点没有左子树，直接向上找，直到 parent 的左子节点是 cur</span>
			<span class="token punctuation">{<!-- --></span>
				Node<span class="token operator">*</span> cur <span class="token operator">=</span> _node<span class="token punctuation">;</span>
				Node<span class="token operator">*</span> parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
				<span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> parent<span class="token operator">-&gt;</span>_left <span class="token operator">==</span> cur<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
					parent <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				_node <span class="token operator">=</span> parent<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_305"></a>反向迭代器</h3> 
<p>反向迭代器主要是对正向迭代器的封装。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Ref</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Ptr</span><span class="token operator">&gt;</span>
	<span class="token keyword">struct</span> <span class="token class-name">_RBTreeReverseIterator</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">typedef</span> RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> _RBTreeReverseIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Ref<span class="token punctuation">,</span> Ptr<span class="token operator">&gt;</span> self<span class="token punctuation">;</span>

		<span class="token function">_RBTreeReverseIterator</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> node<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_it<span class="token punctuation">.</span>_node <span class="token operator">=</span> node<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token function">_RBTreeReverseIterator</span><span class="token punctuation">(</span><span class="token keyword">const</span> _RBTreeIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> T<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> it<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_it<span class="token punctuation">.</span>_node <span class="token operator">=</span> it<span class="token punctuation">.</span>_node<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token function">_RBTreeReverseIterator</span><span class="token punctuation">(</span><span class="token keyword">const</span> _RBTreeReverseIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> T<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> it<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_it<span class="token punctuation">.</span>_node <span class="token operator">=</span> it<span class="token punctuation">.</span>_it<span class="token punctuation">.</span>_node<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token operator">--</span>_it<span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">--</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token operator">++</span>_it<span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword">const</span> self<span class="token operator">&amp;</span> s<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _it<span class="token punctuation">.</span>_node <span class="token operator">!=</span> s<span class="token punctuation">.</span>_it<span class="token punctuation">.</span>_node<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		Ptr <span class="token keyword">operator</span><span class="token operator">-&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token operator">&amp;</span>_it<span class="token punctuation">.</span>_node<span class="token operator">-&gt;</span>_data<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		Ref <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _it<span class="token punctuation">.</span>_node<span class="token operator">-&gt;</span>_data<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">struct</span> <span class="token class-name">_RBTreeIterator</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span>Ref<span class="token punctuation">,</span>Ptr<span class="token operator">&gt;</span> _it<span class="token operator">=</span><span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre> 
<hr> 
<p>在红黑树中实现了 迭代器，接下来就是封装到 map、set 里面。与此同时，还需要红黑树中提供 begin() 、end() 、rbegin() 、rend() 方法。</p> 
<p>如下，是在红黑树中实现这些方法，返回的结果是迭代器。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">KeyOfT</span><span class="token operator">&gt;</span>
	<span class="token keyword">class</span> <span class="token class-name">RBTree</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">RBTreeNode</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>

	<span class="token keyword">public</span><span class="token operator">:</span>
		<span class="token keyword">typedef</span> _RBTreeIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> T<span class="token operator">*</span><span class="token operator">&gt;</span> iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> _RBTreeIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">*</span><span class="token operator">&gt;</span> const_iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> _RBTreeReverseIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> T<span class="token operator">*</span><span class="token operator">&gt;</span> reverse_iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> _RBTreeReverseIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">*</span><span class="token operator">&gt;</span> const_reverse_iterator<span class="token punctuation">;</span>
	<span class="token keyword">public</span><span class="token operator">:</span>

		iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">return</span> <span class="token function">const_iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token function">const_iterator</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>


		reverse_iterator <span class="token function">rbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">return</span> <span class="token function">reverse_iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		reverse_iterator <span class="token function">rend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token function">reverse_iterator</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_reverse_iterator <span class="token function">rbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">return</span> <span class="token function">const_reverse_iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_reverse_iterator <span class="token function">rend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token function">const_reverse_iterator</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token keyword">private</span><span class="token operator">:</span>
		Node<span class="token operator">*</span> _root<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>如下是在 set 里面实现 begin() 、end() ，完全是对 红黑树方法的复用。</p> 
<p>值得注意的是， typedef typename RBTree&lt;K, K, KeyOfT&gt;::const_iterator iterator; 这是为了保证 set 的 K 不可修改。</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"rb_tree.h"</span></span>

<span class="token keyword">namespace</span> SetSimulate
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token operator">&gt;</span>
	<span class="token keyword">class</span> <span class="token class-name">set</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">struct</span> <span class="token class-name">KeyOfT</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">const</span> K<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> k<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> k<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span><span class="token operator">:</span>

		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTreeNode</span><span class="token operator">&lt;</span>K<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> K<span class="token punctuation">,</span> KeyOfT<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>const_iterator iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> K<span class="token punctuation">,</span> KeyOfT<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>const_iterator const_iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> K<span class="token punctuation">,</span> KeyOfT<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>const_reverse_iterator reverse_iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> K<span class="token punctuation">,</span> KeyOfT<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>const_reverse_iterator const_reverse_iterator<span class="token punctuation">;</span>
		iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		reverse_iterator <span class="token function">rbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">rbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		reverse_iterator <span class="token function">rend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">rend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_reverse_iterator <span class="token function">rbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">rbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_reverse_iterator <span class="token function">rend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">rend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		iterator <span class="token function">Find</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> cur <span class="token operator">=</span> _t<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token keyword">private</span><span class="token operator">:</span>
		RBTree<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> K<span class="token punctuation">,</span> KeyOfT<span class="token operator">&gt;</span> _t<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<h3><a id="map__operator__535"></a>map 的 operator[ ]</h3> 
<p>首先，map 的 [ ] 是兼具<strong>插入和查找功能</strong>的。map 里面存储的是 pair&lt;K,V&gt; ，假设有一个map&lt; int,int &gt;对象 m，执行 m[10]=1000; —— 如果存储的 pair&lt;K,V&gt; 里面，有 K 类型的数据是 10，那么就将这个键值对的 V 修改成 100；没有则插入 make_pair(10,100);</p> 
<p>要完成上面描述的功能，就必须要让 [ ] 的<strong>返回值是 V&amp; （V的引用）</strong>，这样才可以修改 V 类型的数据。 可以通过迭代器来实现！！</p> 
<p>如下是 map 里面实现 operator[ ] 的代码，_t 是红黑树实例化出来的对象，其 Insert() 返回值是 pair&lt;iterator,bool&gt; ， 很明显，返回值包含两个信息：</p> 
<ol><li>某个节点构成的迭代器。如果<strong>插入成功，那么返回插入节点封装成的迭代器</strong>。如果<strong>插入失败（已经有了 K 类型对应的数据），那么就相当于查找功能，返回找到的该节点封装成的迭代器</strong>。</li><li>是否插入成功，插入成功返回 true，否则false。</li></ol> 
<pre><code class="prism language-cpp">		V<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			pair<span class="token operator">&lt;</span>iterator<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span> ret <span class="token operator">=</span> _t<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token function">make_pair</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token function">V</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> ret<span class="token punctuation">.</span>first<span class="token operator">-&gt;</span>second<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
</code></pre> 
<p>那么就可以对红黑树底层的 Insert() 进行修改，只需要修改函数的返回值类型，以及 return 的时候，构造一个 make_pair&lt;iterator,bool&gt; 类型的数据进行返回即可。</p> 
<h2><a id="__559"></a>📕 源代码</h2> 
<h3><a id="rb_treeh_561"></a>rb_tree.h</h3> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;cassert&gt;</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>


	<span class="token keyword">enum</span> <span class="token class-name">Colour</span>
	<span class="token punctuation">{<!-- --></span>
		RED<span class="token punctuation">,</span>
		BLACK<span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token operator">&gt;</span>
	<span class="token keyword">struct</span> <span class="token class-name">RBTreeNode</span>
	<span class="token punctuation">{<!-- --></span>
		RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">*</span> _left<span class="token punctuation">;</span>
		RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">*</span> _right<span class="token punctuation">;</span>
		RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span><span class="token operator">*</span> _parent<span class="token punctuation">;</span>
		T _data<span class="token punctuation">;</span>
		Colour _col<span class="token punctuation">;</span>

		<span class="token function">RBTreeNode</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> val<span class="token punctuation">)</span>
			<span class="token operator">:</span> <span class="token function">_left</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
			<span class="token punctuation">,</span> <span class="token function">_right</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
			<span class="token punctuation">,</span> <span class="token function">_parent</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
			<span class="token punctuation">,</span> <span class="token function">_data</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
			<span class="token punctuation">,</span> <span class="token function">_col</span><span class="token punctuation">(</span>RED<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	

	<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span><span class="token keyword">class</span> <span class="token class-name">Ref</span><span class="token punctuation">,</span><span class="token keyword">class</span> <span class="token class-name">Ptr</span><span class="token operator">&gt;</span>
	<span class="token keyword">struct</span> <span class="token class-name">_RBTreeIterator</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">typedef</span> RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> _RBTreeIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Ref<span class="token punctuation">,</span> Ptr<span class="token operator">&gt;</span> self<span class="token punctuation">;</span>


		<span class="token function">_RBTreeIterator</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> node<span class="token punctuation">)</span>
			<span class="token operator">:</span><span class="token function">_node</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>


		<span class="token function">_RBTreeIterator</span><span class="token punctuation">(</span><span class="token keyword">const</span> _RBTreeIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> T<span class="token operator">*</span><span class="token operator">&gt;</span> <span class="token operator">&amp;</span>it<span class="token punctuation">)</span>
			<span class="token operator">:</span><span class="token function">_node</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span>_node<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>


		Ref <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _node<span class="token operator">-&gt;</span>_data<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword">const</span> self<span class="token operator">&amp;</span> s<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>_node <span class="token operator">!=</span> s<span class="token punctuation">.</span>_node<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		Ptr <span class="token keyword">operator</span><span class="token operator">-&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token operator">&amp;</span>_node<span class="token operator">-&gt;</span>_data<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 右子树存在，先去右子树的第一个</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>_node<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Node<span class="token operator">*</span> subleft<span class="token operator">=</span>_node<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
				<span class="token keyword">while</span> <span class="token punctuation">(</span>subleft<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					subleft <span class="token operator">=</span> subleft<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>

				_node <span class="token operator">=</span> subleft<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token comment">// 右子树不存在，向上找</span>
			<span class="token punctuation">{<!-- --></span>
				Node<span class="token operator">*</span> cur <span class="token operator">=</span> _node<span class="token punctuation">;</span>
				Node<span class="token operator">*</span> parent <span class="token operator">=</span> _node<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
				<span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> parent<span class="token operator">-&gt;</span>_right <span class="token operator">==</span> cur<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
					parent <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				_node <span class="token operator">=</span> parent<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">--</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>_node<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Node<span class="token operator">*</span> subright <span class="token operator">=</span> _node<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
				<span class="token keyword">while</span> <span class="token punctuation">(</span>subright<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					subright <span class="token operator">=</span> subright<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				_node <span class="token operator">=</span> subright<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token comment">// 当前节点没有左子树，直接向上找，直到 parent 的左子节点是 cur</span>
			<span class="token punctuation">{<!-- --></span>
				Node<span class="token operator">*</span> cur <span class="token operator">=</span> _node<span class="token punctuation">;</span>
				Node<span class="token operator">*</span> parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
				<span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> parent<span class="token operator">-&gt;</span>_left <span class="token operator">==</span> cur<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
					parent <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				_node <span class="token operator">=</span> parent<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>



		Node<span class="token operator">*</span> _node<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>


	<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Ref</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">Ptr</span><span class="token operator">&gt;</span>
	<span class="token keyword">struct</span> <span class="token class-name">_RBTreeReverseIterator</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">typedef</span> RBTreeNode<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> _RBTreeReverseIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> Ref<span class="token punctuation">,</span> Ptr<span class="token operator">&gt;</span> self<span class="token punctuation">;</span>

		<span class="token function">_RBTreeReverseIterator</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> node<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_it<span class="token punctuation">.</span>_node <span class="token operator">=</span> node<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token function">_RBTreeReverseIterator</span><span class="token punctuation">(</span><span class="token keyword">const</span> _RBTreeIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> T<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> it<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_it<span class="token punctuation">.</span>_node <span class="token operator">=</span> it<span class="token punctuation">.</span>_node<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token function">_RBTreeReverseIterator</span><span class="token punctuation">(</span><span class="token keyword">const</span> _RBTreeReverseIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> T<span class="token operator">*</span><span class="token operator">&gt;</span><span class="token operator">&amp;</span> it<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_it<span class="token punctuation">.</span>_node <span class="token operator">=</span> it<span class="token punctuation">.</span>_it<span class="token punctuation">.</span>_node<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">++</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token operator">--</span>_it<span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		self<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token operator">--</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token operator">++</span>_it<span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token operator">*</span><span class="token keyword">this</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token operator">!=</span><span class="token punctuation">(</span><span class="token keyword">const</span> self<span class="token operator">&amp;</span> s<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _it<span class="token punctuation">.</span>_node <span class="token operator">!=</span> s<span class="token punctuation">.</span>_it<span class="token punctuation">.</span>_node<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		Ptr <span class="token keyword">operator</span><span class="token operator">-&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token operator">&amp;</span>_it<span class="token punctuation">.</span>_node<span class="token operator">-&gt;</span>_data<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		Ref <span class="token keyword">operator</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _it<span class="token punctuation">.</span>_node<span class="token operator">-&gt;</span>_data<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">struct</span> <span class="token class-name">_RBTreeIterator</span><span class="token operator">&lt;</span>T<span class="token punctuation">,</span>Ref<span class="token punctuation">,</span>Ptr<span class="token operator">&gt;</span> _it<span class="token operator">=</span><span class="token keyword">nullptr</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>



	<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">KeyOfT</span><span class="token operator">&gt;</span>
	<span class="token keyword">class</span> <span class="token class-name">RBTree</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">RBTreeNode</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>

	<span class="token keyword">public</span><span class="token operator">:</span>
		<span class="token keyword">typedef</span> _RBTreeIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> T<span class="token operator">*</span><span class="token operator">&gt;</span> iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> _RBTreeIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">*</span><span class="token operator">&gt;</span> const_iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> _RBTreeReverseIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> T<span class="token operator">*</span><span class="token operator">&gt;</span> reverse_iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> _RBTreeReverseIterator<span class="token operator">&lt;</span>T<span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">&amp;</span><span class="token punctuation">,</span> <span class="token keyword">const</span> T<span class="token operator">*</span><span class="token operator">&gt;</span> const_reverse_iterator<span class="token punctuation">;</span>
	<span class="token keyword">public</span><span class="token operator">:</span>

		iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">return</span> <span class="token function">const_iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token function">const_iterator</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>


		reverse_iterator <span class="token function">rbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">return</span> <span class="token function">reverse_iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		reverse_iterator <span class="token function">rend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token function">reverse_iterator</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_reverse_iterator <span class="token function">rbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>cur <span class="token operator">&amp;&amp;</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">return</span> <span class="token function">const_reverse_iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_reverse_iterator <span class="token function">rend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token function">const_reverse_iterator</span><span class="token punctuation">(</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>


		<span class="token operator">~</span><span class="token function">RBTree</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">Delete</span><span class="token punctuation">(</span>_root<span class="token punctuation">)</span><span class="token punctuation">;</span>
			_root <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		Node<span class="token operator">*</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> val<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			KeyOfT kt<span class="token punctuation">;</span>
			Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">&gt;</span> <span class="token function">kt</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>val <span class="token operator">&lt;</span> <span class="token function">kt</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_data<span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span>
					<span class="token keyword">return</span> cur<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">return</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		pair<span class="token operator">&lt;</span>iterator<span class="token punctuation">,</span><span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> T<span class="token operator">&amp;</span> val<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>_root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				_root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
				_root<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span><span class="token function">iterator</span><span class="token punctuation">(</span>_root<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			KeyOfT kt<span class="token punctuation">;</span>
			Node<span class="token operator">*</span> parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
			Node<span class="token operator">*</span> cur <span class="token operator">=</span> _root<span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>cur<span class="token punctuation">)</span> <span class="token comment">// 找到要插入的位置</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">kt</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_data<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token function">kt</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
					cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">kt</span><span class="token punctuation">(</span>cur<span class="token operator">-&gt;</span>_data<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">kt</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					parent <span class="token operator">=</span> cur<span class="token punctuation">;</span>
					cur <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span>
					<span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span><span class="token function">iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// 插入</span>
			cur <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Node</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
			Node<span class="token operator">*</span> newnode <span class="token operator">=</span> cur<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">kt</span><span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_data<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">kt</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				parent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> cur<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">kt</span><span class="token punctuation">(</span>parent<span class="token operator">-&gt;</span>_data<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token function">kt</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				parent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> cur<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			cur<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>


			<span class="token comment">// 调整颜色</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>parent <span class="token operator">&amp;&amp;</span> parent<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Node<span class="token operator">*</span> grandfather <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> grandfather<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					Node<span class="token operator">*</span> uncle <span class="token operator">=</span> grandfather<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>uncle <span class="token operator">&amp;&amp;</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span> <span class="token comment">// uncle 为红色</span>
					<span class="token punctuation">{<!-- --></span>
						parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
						uncle<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
						grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>

						<span class="token comment">// 继续调整</span>
						cur <span class="token operator">=</span> grandfather<span class="token punctuation">;</span>
						parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">else</span> <span class="token comment">// uncle不存在 or 存在且为黑</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">==</span> parent<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
						<span class="token punctuation">{<!-- --></span>
							<span class="token function">RotateR</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>
							parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
							grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
							<span class="token comment">//cur-&gt;_col = RED;</span>
						<span class="token punctuation">}</span>
						<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">==</span> parent<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
						<span class="token punctuation">{<!-- --></span>
							<span class="token function">RotateL</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token function">RotateR</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>
							cur<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
							grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
							parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
						<span class="token punctuation">}</span>

						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span> <span class="token comment">// if (parent == grandfather-&gt;_right)</span>
				<span class="token punctuation">{<!-- --></span>
					Node<span class="token operator">*</span> uncle <span class="token operator">=</span> grandfather<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>uncle <span class="token operator">&amp;&amp;</span> uncle<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span> <span class="token comment">// uncle 为红色</span>
					<span class="token punctuation">{<!-- --></span>
						parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
						uncle<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
						grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>

						<span class="token comment">// 继续调整</span>
						cur <span class="token operator">=</span> grandfather<span class="token punctuation">;</span>
						parent <span class="token operator">=</span> cur<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">else</span> <span class="token comment">// uncle不存在 or 存在且为黑</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>cur <span class="token operator">==</span> parent<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span>
						<span class="token punctuation">{<!-- --></span>
							<span class="token function">RotateL</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>
							parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
							grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
							<span class="token comment">//cur-&gt;_col = RED;</span>
						<span class="token punctuation">}</span>
						<span class="token keyword">else</span> <span class="token comment">// cur == parent-&gt;_left</span>
						<span class="token punctuation">{<!-- --></span>
							<span class="token function">RotateR</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token function">RotateL</span><span class="token punctuation">(</span>grandfather<span class="token punctuation">)</span><span class="token punctuation">;</span>
							cur<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
							parent<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
							grandfather<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> RED<span class="token punctuation">;</span>
						<span class="token punctuation">}</span>

						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>

			_root<span class="token operator">-&gt;</span>_col <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token function">make_pair</span><span class="token punctuation">(</span><span class="token function">iterator</span><span class="token punctuation">(</span>newnode<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">int</span> <span class="token function">Height</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token function">_Height</span><span class="token punctuation">(</span>_root<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">bool</span> <span class="token function">isBalance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>_root<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				cout <span class="token operator">&lt;&lt;</span> <span class="token string">"根节点的颜色是红色"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">int</span> benchmark <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			Node<span class="token operator">*</span> tmp <span class="token operator">=</span> _root<span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>tmp<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> BLACK<span class="token punctuation">)</span>
					benchmark<span class="token operator">++</span><span class="token punctuation">;</span>
				tmp <span class="token operator">=</span> tmp<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">return</span> <span class="token function">_isBalance</span><span class="token punctuation">(</span>_root<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> benchmark<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">void</span> <span class="token function">Inorder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">_Inorder</span><span class="token punctuation">(</span>_root<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token keyword">private</span><span class="token operator">:</span>

		<span class="token keyword">void</span> <span class="token function">_Inorder</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> root<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
				<span class="token keyword">return</span><span class="token punctuation">;</span>

			<span class="token function">_Inorder</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span><span class="token punctuation">;</span>
			cout <span class="token operator">&lt;&lt;</span> root<span class="token operator">-&gt;</span>_kv<span class="token punctuation">.</span>first <span class="token operator">&lt;&lt;</span> <span class="token string">" "</span><span class="token punctuation">;</span>
			<span class="token function">_Inorder</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">bool</span> <span class="token function">_isBalance</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> root<span class="token punctuation">,</span> <span class="token keyword">int</span> blackNum<span class="token punctuation">,</span> <span class="token keyword">int</span> benchmark<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>blackNum <span class="token operator">==</span> benchmark<span class="token punctuation">)</span>
					<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{<!-- --></span>
					cout <span class="token operator">&lt;&lt;</span> <span class="token string">"某条链路黑色节点数目错误！"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
					<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> BLACK<span class="token punctuation">)</span>
				<span class="token operator">++</span>blackNum<span class="token punctuation">;</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_parent <span class="token operator">&amp;&amp;</span> root<span class="token operator">-&gt;</span>_parent<span class="token operator">-&gt;</span>_col <span class="token operator">==</span> RED<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					cout <span class="token operator">&lt;&lt;</span> <span class="token string">"存在两个连续的红色节点"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
					<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">return</span> <span class="token function">_isBalance</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">,</span> blackNum<span class="token punctuation">,</span> benchmark<span class="token punctuation">)</span>
				<span class="token operator">&amp;&amp;</span> <span class="token function">_isBalance</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">,</span> blackNum<span class="token punctuation">,</span> benchmark<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">int</span> <span class="token function">_Height</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> root<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>

			<span class="token keyword">int</span> leftH <span class="token operator">=</span> <span class="token function">_Height</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">int</span> rightH <span class="token operator">=</span> <span class="token function">_Height</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">return</span> leftH <span class="token operator">&gt;</span> rightH <span class="token operator">?</span> leftH <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> rightH <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>



		<span class="token keyword">void</span> <span class="token function">Delete</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> root<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>root <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
				<span class="token keyword">return</span><span class="token punctuation">;</span>

			<span class="token function">Delete</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">Delete</span><span class="token punctuation">(</span>root<span class="token operator">-&gt;</span>_right<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">free</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">void</span> <span class="token function">RotateL</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> parent<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> subR <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>
			Node<span class="token operator">*</span> subRL <span class="token operator">=</span> subR<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>

			parent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subRL<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>subRL<span class="token punctuation">)</span>
				subRL<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>

			Node<span class="token operator">*</span> pparent <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
			subR<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> parent<span class="token punctuation">;</span>
			parent<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> subR<span class="token punctuation">;</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>pparent <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				_root <span class="token operator">=</span> subR<span class="token punctuation">;</span>
				_root<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> pparent<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					pparent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subR<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{<!-- --></span>
					pparent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subR<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				subR<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> pparent<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>


		<span class="token punctuation">}</span>



		<span class="token keyword">void</span> <span class="token function">RotateR</span><span class="token punctuation">(</span>Node<span class="token operator">*</span> parent<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> subL <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_left<span class="token punctuation">;</span>
			Node<span class="token operator">*</span> subLR <span class="token operator">=</span> subL<span class="token operator">-&gt;</span>_right<span class="token punctuation">;</span>

			Node<span class="token operator">*</span> pparent <span class="token operator">=</span> parent<span class="token operator">-&gt;</span>_parent<span class="token punctuation">;</span>
			subL<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> parent<span class="token punctuation">;</span>
			parent<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> subL<span class="token punctuation">;</span>

			parent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subLR<span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>subLR<span class="token punctuation">)</span>
				subLR<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>


			<span class="token keyword">if</span> <span class="token punctuation">(</span>pparent <span class="token operator">==</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				subL<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> <span class="token keyword">nullptr</span><span class="token punctuation">;</span>
				_root <span class="token operator">=</span> subL<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> pparent<span class="token operator">-&gt;</span>_left<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					pparent<span class="token operator">-&gt;</span>_left <span class="token operator">=</span> subL<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span>
				<span class="token punctuation">{<!-- --></span>
					pparent<span class="token operator">-&gt;</span>_right <span class="token operator">=</span> subL<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>

				subL<span class="token operator">-&gt;</span>_parent <span class="token operator">=</span> pparent<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

		<span class="token punctuation">}</span>

	<span class="token keyword">private</span><span class="token operator">:</span>
		Node<span class="token operator">*</span> _root<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>


</code></pre> 
<h3><a id="seth_1136"></a>set.h</h3> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"rb_tree.h"</span></span>

<span class="token keyword">namespace</span> SetSimulate
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token operator">&gt;</span>
	<span class="token keyword">class</span> <span class="token class-name">set</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">struct</span> <span class="token class-name">KeyOfT</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">const</span> K<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> k<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> k<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span><span class="token operator">:</span>

		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTreeNode</span><span class="token operator">&lt;</span>K<span class="token operator">&gt;</span> Node<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> K<span class="token punctuation">,</span> KeyOfT<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>const_iterator iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> K<span class="token punctuation">,</span> KeyOfT<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>const_iterator const_iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> K<span class="token punctuation">,</span> KeyOfT<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>const_reverse_iterator reverse_iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> K<span class="token punctuation">,</span> KeyOfT<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>const_reverse_iterator const_reverse_iterator<span class="token punctuation">;</span>
		iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		reverse_iterator <span class="token function">rbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">rbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		reverse_iterator <span class="token function">rend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">rend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_reverse_iterator <span class="token function">rbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">rbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_reverse_iterator <span class="token function">rend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">rend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		pair<span class="token operator">&lt;</span>iterator<span class="token punctuation">,</span><span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> k<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		iterator <span class="token function">Find</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> cur <span class="token operator">=</span> _t<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token keyword">private</span><span class="token operator">:</span>
		RBTree<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> K<span class="token punctuation">,</span> KeyOfT<span class="token operator">&gt;</span> _t<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<h3><a id="maph_1221"></a>map.h</h3> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">once</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">"rb_tree.h"</span></span>


<span class="token keyword">namespace</span> MapSimulate
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">class</span> <span class="token class-name">K</span><span class="token punctuation">,</span> <span class="token keyword">class</span> <span class="token class-name">V</span><span class="token operator">&gt;</span>
	<span class="token keyword">class</span> <span class="token class-name">map</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">struct</span> <span class="token class-name">MapOfKey</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">const</span> K<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> kv<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">return</span> kv<span class="token punctuation">.</span>first<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span><span class="token operator">:</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTreeNode</span><span class="token operator">&lt;</span>pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span> V<span class="token operator">&gt;&gt;</span> Node<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span>V<span class="token operator">&gt;</span><span class="token punctuation">,</span> MapOfKey<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>iterator iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span>V<span class="token operator">&gt;</span><span class="token punctuation">,</span> MapOfKey<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>const_iterator const_iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token punctuation">,</span> MapOfKey<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>reverse_iterator reverse_iterator<span class="token punctuation">;</span>
		<span class="token keyword">typedef</span> <span class="token keyword">typename</span> <span class="token class-name">RBTree</span><span class="token operator">&lt;</span>K<span class="token punctuation">,</span> pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token punctuation">,</span> MapOfKey<span class="token operator">&gt;</span><span class="token double-colon punctuation">::</span>const_reverse_iterator const_reverse_iterator<span class="token punctuation">;</span>

		pair<span class="token operator">&lt;</span>iterator<span class="token punctuation">,</span><span class="token keyword">bool</span><span class="token operator">&gt;</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token keyword">const</span> pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token operator">&amp;</span> kv<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span>kv<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		V<span class="token operator">&amp;</span> <span class="token keyword">operator</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			pair<span class="token operator">&lt;</span>iterator<span class="token punctuation">,</span> <span class="token keyword">bool</span><span class="token operator">&gt;</span> ret <span class="token operator">=</span> _t<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token function">make_pair</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token function">V</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> ret<span class="token punctuation">.</span>first<span class="token operator">-&gt;</span>second<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_iterator <span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_iterator <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>


		reverse_iterator <span class="token function">rbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">rbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		reverse_iterator <span class="token function">rend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">rend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_reverse_iterator <span class="token function">rbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">rbegin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		const_reverse_iterator <span class="token function">rend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">const</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> _t<span class="token punctuation">.</span><span class="token function">rend</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		iterator <span class="token function">Find</span><span class="token punctuation">(</span><span class="token keyword">const</span> K<span class="token operator">&amp;</span> key<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Node<span class="token operator">*</span> cur <span class="token operator">=</span> _t<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token function">iterator</span><span class="token punctuation">(</span>cur<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token keyword">private</span><span class="token operator">:</span>
		RBTree<span class="token operator">&lt;</span>K<span class="token punctuation">,</span> pair<span class="token operator">&lt;</span><span class="token keyword">const</span> K<span class="token punctuation">,</span> V<span class="token operator">&gt;</span><span class="token punctuation">,</span> MapOfKey<span class="token operator">&gt;</span> _t<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9b5498ddf98464b7164c6f117dbe0c34/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">基于tabular包的Latex表格尺寸设置方法（列宽和行高）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8361cf1f76ae42d4048808ac150f6927/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">latent diffusion model 复现问题记录</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>