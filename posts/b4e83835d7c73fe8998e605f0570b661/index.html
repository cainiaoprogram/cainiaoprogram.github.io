<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>保护 .NET Core 项目的敏感信息 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="保护 .NET Core 项目的敏感信息" />
<meta property="og:description" content="我们的项目中几乎都会有配置文件，里面可能会存储一些敏感信息，比如数据库连接字符串、第三方 API 的 AppKey 和 SecretKey 等。
对于开源项目，这些敏感信息肯定不能随着源代码一起提交到托管平台。
对于网站应用大多都是要部署到有公开 IP 的服务器上的，存有敏感信息的文件放在 Web 目录下也不安全。
较好的办法是把敏感信息文件存在项目以外的地方。
在.NET Core 中，我们可以使用 Secret Manager 工具来管理敏感信息，这个工具可以将敏感信息保存在一个 secrets.json 文件中，它不在项目文件夹下，而是存放在另外的地方。对于三种操作系统，它的位置是：
Windows: %APPDATA%/Microsoft/UserSecrets/&lt;UserSecretsId&gt;/secrets.json
Linux : ~/.microsoft/usersecrets/&lt;UserSecretsId&gt;/secrets.json
Mac : ~/.microsoft/usersecrets/&lt;UserSecretsId&gt;/secrets.json 一个.NET Core 应用对应一个唯一的 UserSecretsId，一般是一个 GUID。
这也限制了每个开发者都必须有自己的 UserSecrets 文件夹。虽然有些麻烦，但这也有个好处。就是每个开发者可以使用不同于其它开发者的敏感数据进行开发。比如有些公司的数据库为每个开发者创建了独立的数据库访问账号。
在 VS 中可以很方便地操作 secrets.json。右击项目，选择[Manage User Secrets]，如图：
编辑打开的 secrets.json 文件，把敏感信息填入其中，如：
{
&#34;ConnectionString&#34;: &#34;server=localhost;database=testdb;uid=root;pwd=123456;&#34;
} 保存后，.csproj 文件中会自动生成一个 UserSecretsId：
如果不用 VS，也可以在此处手动添加 UserSecretsId，然后在项目目录下通过命令来添加或删除配置项，例如：
dotnet user-secrets set &#34;Foo:ApiKey&#34; &#34;123456&#34;
dotnet user-secrets remove &#34;Foo:ApiKey&#34; 如果 secrets.json 和 appsettings." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/b4e83835d7c73fe8998e605f0570b661/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-07-05T07:51:54+08:00" />
<meta property="article:modified_time" content="2019-07-05T07:51:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">保护 .NET Core 项目的敏感信息</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body"> 
 <div class="markdown-here-wrapper"> 
  <p style="font-size:14px;line-height:2;word-spacing:0px;letter-spacing:1px;text-align:justify;"><span style="font-size:16px;">我们的项目中几乎都会有配置文件，里面可能会存储一些敏感信息，比如数据库连接字符串、第三方 API 的 AppKey 和 SecretKey 等。</span></p> 
  <p style="font-size:14px;line-height:2;word-spacing:0px;letter-spacing:1px;text-align:justify;"><span style="font-size:16px;">对于开源项目，这些敏感信息肯定不能随着源代码一起提交到托管平台。</span></p> 
  <p style="font-size:14px;line-height:2;word-spacing:0px;letter-spacing:1px;text-align:justify;"><span style="font-size:16px;">对于网站应用大多都是要部署到有公开 IP 的服务器上的，存有敏感信息的文件放在 Web 目录下也不安全。</span></p> 
  <p style="font-size:14px;line-height:2;word-spacing:0px;letter-spacing:1px;text-align:justify;"><span style="font-size:16px;">较好的办法是把敏感信息文件存在项目以外的地方。</span></p> 
  <p style="font-size:14px;line-height:2;word-spacing:0px;letter-spacing:1px;text-align:justify;"><span style="font-size:16px;">在.NET Core 中，我们可以使用 Secret Manager 工具来管理敏感信息，这个工具可以将敏感信息保存在一个 secrets.json 文件中，它不在项目文件夹下，而是存放在另外的地方。对于三种操作系统，它的位置是：</span></p> 
  <pre><code class="hljs language-bash" style="letter-spacing:0px;font-size:12px;font-family:'SFMono-Regular', Menlo, Monaco, Consolas, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei';border:0px;background:#1d1f21;color:#c5c8c6;">Windows: %APPDATA%/Microsoft/UserSecrets/&lt;UserSecretsId&gt;/secrets.json<br>Linux  : ~/.microsoft/usersecrets/&lt;UserSecretsId&gt;/secrets.json<br>Mac    : ~/.microsoft/usersecrets/&lt;UserSecretsId&gt;/secrets.json
</code></pre> 
  <p style="font-size:14px;line-height:2;word-spacing:0px;letter-spacing:1px;text-align:justify;"><span style="font-size:16px;">一个.NET Core 应用对应一个唯一的 UserSecretsId，一般是一个 GUID。</span></p> 
  <p style="font-size:14px;line-height:2;word-spacing:0px;letter-spacing:1px;text-align:justify;"><span style="font-size:16px;">这也限制了每个开发者都必须有自己的 UserSecrets 文件夹。虽然有些麻烦，但这也有个好处。就是每个开发者可以使用不同于其它开发者的敏感数据进行开发。比如有些公司的数据库为每个开发者创建了独立的数据库访问账号。</span></p> 
  <p style="font-size:14px;line-height:2;word-spacing:0px;letter-spacing:1px;text-align:justify;"><span style="font-size:16px;">在 VS 中可以很方便地操作 secrets.json。右击项目，选择[Manage User Secrets]，如图：</span></p> 
  <p style="font-size:14px;line-height:2;word-spacing:0px;letter-spacing:1px;text-align:justify;"><img src="https://images2.imgbox.com/79/e6/7jV9YSQR_o.png" alt=""></p> 
  <p style="font-size:14px;line-height:2;word-spacing:0px;letter-spacing:1px;text-align:justify;"><span style="font-size:16px;">编辑打开的 secrets.json 文件，把敏感信息填入其中，如：</span></p> 
  <pre><code class="hljs language-json" style="letter-spacing:0px;font-size:12px;font-family:'SFMono-Regular', Menlo, Monaco, Consolas, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei';border:0px;background:#1d1f21;color:#c5c8c6;">{<!-- --><br>  "<span class="hljs-attribute" style="color:#cc6666;">ConnectionString</span>": <span class="hljs-value" style="color:#b5bd68;"><span class="hljs-string" style="color:#b5bd68;">"server=localhost;database=testdb;uid=root;pwd=123456;"</span><br></span>}
</code></pre> 
  <p style="font-size:14px;line-height:2;word-spacing:0px;letter-spacing:1px;text-align:justify;"><span style="font-size:16px;">保存后，.csproj 文件中会自动生成一个 UserSecretsId：</span></p> 
  <p style="font-size:14px;line-height:2;word-spacing:0px;letter-spacing:1px;text-align:justify;"><img src="https://images2.imgbox.com/27/51/TzymWHwb_o.png" alt=""></p> 
  <p style="font-size:14px;line-height:2;word-spacing:0px;letter-spacing:1px;text-align:justify;"><span style="font-size:16px;">如果不用 VS，也可以在此处手动添加 UserSecretsId，然后在项目目录下通过命令来添加或删除配置项，例如：</span></p> 
  <pre><code class="hljs language-bash" style="letter-spacing:0px;font-size:12px;font-family:'SFMono-Regular', Menlo, Monaco, Consolas, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei';border:0px;background:#1d1f21;color:#c5c8c6;">dotnet user-secrets <span class="hljs-keyword" style="color:#b294bb;">set</span> <span class="hljs-string" style="color:#b5bd68;">"Foo:ApiKey"</span> <span class="hljs-string" style="color:#b5bd68;">"123456"</span><br>dotnet user-secrets remove <span class="hljs-string" style="color:#b5bd68;">"Foo:ApiKey"</span>
</code></pre> 
  <p style="font-size:14px;line-height:2;word-spacing:0px;letter-spacing:1px;text-align:justify;"><span style="font-size:16px;">如果 secrets.json 和 appsettings.json 有相同的配置项，程序会优先读取前者的值。</span></p> 
  <p style="font-size:14px;line-height:2;word-spacing:0px;letter-spacing:1px;text-align:justify;"><span style="font-size:16px;">对于 secrets.json 的所有配置项，最好也在 appsettings.json 保留相应的占位，比如：</span></p> 
  <pre><code class="hljs language-json" style="letter-spacing:0px;font-size:12px;font-family:'SFMono-Regular', Menlo, Monaco, Consolas, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei';border:0px;background:#1d1f21;color:#c5c8c6;">{<!-- --><br>  "<span class="hljs-attribute" style="color:#cc6666;">ConnectionString</span>": <span class="hljs-value" style="color:#b5bd68;"><span class="hljs-string" style="color:#b5bd68;">"&lt;your connection string here&gt;"</span><br><br>  // 其它配置<br></span>}
</code></pre> 
  <p style="font-size:14px;line-height:2;word-spacing:0px;letter-spacing:1px;text-align:justify;"><span style="font-size:16px;">这样 appsettings.json 中的占位可以告诉其它开发者有这样一个配置。</span></p> 
  <p style="font-size:14px;line-height:2;word-spacing:0px;letter-spacing:1px;text-align:justify;"><span style="font-size:16px;">这对于开源项目十分有用。</span></p> 
 </div> 
</div> 
<p>转载于:https://www.cnblogs.com/willick/p/protect-asp-net-core-sensitive-information.html</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6799a665d21e38886837d5f7d314af21/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">记一个界面刷新相关的Bug</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6fcaf1049cd1c07178da7e44a1053ce3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">周期/定时运行&#43;进程守护工具，服务器维护利器</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>