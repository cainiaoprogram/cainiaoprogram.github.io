<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spring Cloud å®æˆ˜ç³»åˆ—ï¼šæœåŠ¡ç½‘å…³ Spring Cloud Gateway - èœé¸Ÿç¨‹åºå‘˜åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Spring Cloud å®æˆ˜ç³»åˆ—ï¼šæœåŠ¡ç½‘å…³ Spring Cloud Gateway" />
<meta property="og:description" content="ğŸŒˆ æœåŠ¡ç½‘å…³ Spring Cloud Gateway ğŸ™ ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡ç½‘å…³ å¾®æœåŠ¡æ¶æ„çš„ç³»ç»Ÿï¼Œæ‹¥æœ‰ä¼—å¤šå­æœåŠ¡ï¼Œå¦‚æœå®¢æˆ·ç«¯ç›´æ¥ä¸å„ä¸ªå¾®æœåŠ¡è¿›è¡Œé€šä¿¡ï¼Œä¼šæœ‰ä»¥ä¸‹çš„é—®é¢˜ï¼š
å®¢æˆ·ç«¯éœ€è¦è®°å½•å„ä¸ªæœåŠ¡çš„åœ°å€å„ä¸ªæœåŠ¡éƒ½éœ€è¦å•ç‹¬å¤„ç†è·¨åŸŸå„ä¸ªæœåŠ¡éƒ½éœ€è¦å•ç‹¬æƒé™è®¤è¯ã€‚ã€‚ã€‚ ğŸ™ ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘å…³ æœåŠ¡ç½‘å…³æ˜¯ä»‹äºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´çš„ä¸­é—´å±‚ï¼Œæ‰€æœ‰çš„å¤–éƒ¨è¯·æ±‚éƒ½ä¼šå…ˆç»è¿‡ç½‘å…³è¿™ä¸€å±‚ã€‚ç”±ç½‘å…³å†³å®šå°†è¯·æ±‚è·¯ç”±åˆ°å…·ä½“æœåŠ¡ã€‚
å¯ä»¥å¤„ç†éä¸šåŠ¡çš„çš„é€»è¾‘ï¼Œå¦‚å®‰å…¨ã€ç›‘æ§ã€é™æµã€ç†”æ–­ã€æˆæƒç­‰ç­‰ã€‚
ğŸ™ ä»€ä¹ˆæ˜¯ Spring cloud Gateway ä¸€ä¸ªæ„å»ºåœ¨ Spring ç”Ÿæ€ç³»ç»Ÿä¹‹ä¸Šçš„ API ç½‘å…³ï¼ŒåŒ…æ‹¬ï¼šSpring 6ã€Spring Boot 3ã€Spring Webflux å’Œ Project Reactorã€‚Spring Cloud Gateway æ—¨åœ¨æä¾›ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„æ–¹æ³•æ¥è·¯ç”±åˆ° APIï¼Œå¹¶ä¸ºå®ƒä»¬æä¾›æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œä¾‹å¦‚ï¼šå®‰å…¨æ€§ã€ç›‘æ§/æŒ‡æ ‡å’Œå¼¹æ€§ã€‚
ğŸ… 1ã€æœ¯è¯­
Routeï¼šGateway çš„åŸºæœ¬æ„å»ºå—ã€‚å®ƒç”± IDã€ç›®æ ‡ URIã€è°“è¯é›†åˆå’Œè¿‡æ»¤å™¨é›†åˆå®šä¹‰ã€‚å¦‚æœèšåˆè°“è¯ä¸ºçœŸï¼Œåˆ™è·¯ç”±åŒ¹é…ã€‚
Predicateï¼šæ˜¯ä¸€ä¸ªJava 8 å‡½æ•°è°“è¯ã€‚è¾“å…¥ç±»å‹æ˜¯Spring FrameworkServerWebExchangeã€‚å¯ä»¥åŒ¹é… HTTP è¯·æ±‚ä¸­çš„ä»»ä½•å†…å®¹ï¼Œä¾‹å¦‚è¯·æ±‚å¤´æˆ–å‚æ•°ã€‚
Filterï¼šæ˜¯GatewayFilterä½¿ç”¨ç‰¹å®šå·¥å‚æ„å»ºçš„å®ä¾‹ã€‚å¯ä»¥åœ¨å‘é€ä¸‹æ¸¸è¯·æ±‚ä¹‹å‰æˆ–ä¹‹åä¿®æ”¹è¯·æ±‚å’Œå“åº”ã€‚
ğŸ… 2ã€å·¥ä½œåŸç†
å®˜ç½‘æä¾›äº† Spring Cloud Gateway å·¥ä½œåŸç†çš„é«˜çº§æ¦‚è¿°å›¾ï¼š
å®¢æˆ·ç«¯å‘ Spring Cloud Gateway å‘å‡ºè¯·æ±‚ã€‚å¦‚æœ Gateway Handler Mapping ç¡®å®šè¯·æ±‚ä¸è·¯ç”±åŒ¹é…ï¼Œåˆ™å°†å…¶å‘é€åˆ° Gateway Web Handlerã€‚æ­¤å¤„ç†ç¨‹åºé€šè¿‡ç‰¹å®šäºè¯·æ±‚çš„è¿‡æ»¤å™¨é“¾è¿è¡Œè¯·æ±‚ã€‚è¿‡æ»¤å™¨è¢«è™šçº¿åˆ†å¼€çš„åŸå› æ˜¯è¿‡æ»¤å™¨å¯ä»¥åœ¨å‘é€ä»£ç†è¯·æ±‚ä¹‹å‰å’Œä¹‹åè¿è¡Œé€»è¾‘ã€‚æ‰§è¡Œæ‰€æœ‰ â€œpreâ€ è¿‡æ»¤å™¨é€»è¾‘ã€‚ç„¶åè¿›è¡Œä»£ç†è¯·æ±‚ã€‚å‘å‡ºä»£ç†è¯·æ±‚åï¼Œè¿è¡Œ â€œpostâ€ è¿‡æ»¤å™¨é€»è¾‘ã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/984e1319a40f227122cdc9b815f7ee20/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-27T18:18:43+08:00" />
<meta property="article:modified_time" content="2023-05-27T18:18:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="èœé¸Ÿç¨‹åºå‘˜åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">èœé¸Ÿç¨‹åºå‘˜åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spring Cloud å®æˆ˜ç³»åˆ—ï¼šæœåŠ¡ç½‘å…³ Spring Cloud Gateway</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="rainbow__Spring_Cloud_Gateway_0"></a>ğŸŒˆ æœåŠ¡ç½‘å…³ Spring Cloud Gateway</h2> 
<h3><a id="octopus__2"></a>ğŸ™ ä¸ºä»€ä¹ˆéœ€è¦æœåŠ¡ç½‘å…³</h3> 
<p>å¾®æœåŠ¡æ¶æ„çš„ç³»ç»Ÿï¼Œæ‹¥æœ‰ä¼—å¤šå­æœåŠ¡ï¼Œå¦‚æœå®¢æˆ·ç«¯ç›´æ¥ä¸å„ä¸ªå¾®æœåŠ¡è¿›è¡Œé€šä¿¡ï¼Œä¼šæœ‰ä»¥ä¸‹çš„é—®é¢˜ï¼š</p> 
<ol><li>å®¢æˆ·ç«¯éœ€è¦è®°å½•å„ä¸ªæœåŠ¡çš„åœ°å€</li><li>å„ä¸ªæœåŠ¡éƒ½éœ€è¦å•ç‹¬å¤„ç†è·¨åŸŸ</li><li>å„ä¸ªæœåŠ¡éƒ½éœ€è¦å•ç‹¬æƒé™è®¤è¯</li><li>ã€‚ã€‚ã€‚</li></ol> 
<h3><a id="octopus__11"></a>ğŸ™ ä»€ä¹ˆæ˜¯æœåŠ¡ç½‘å…³</h3> 
<p>æœåŠ¡ç½‘å…³æ˜¯ä»‹äºå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´çš„ä¸­é—´å±‚ï¼Œæ‰€æœ‰çš„å¤–éƒ¨è¯·æ±‚éƒ½ä¼šå…ˆç»è¿‡ç½‘å…³è¿™ä¸€å±‚ã€‚ç”±ç½‘å…³å†³å®šå°†è¯·æ±‚è·¯ç”±åˆ°å…·ä½“æœåŠ¡ã€‚</p> 
<p>å¯ä»¥å¤„ç†éä¸šåŠ¡çš„çš„é€»è¾‘ï¼Œå¦‚å®‰å…¨ã€ç›‘æ§ã€é™æµã€ç†”æ–­ã€æˆæƒç­‰ç­‰ã€‚</p> 
<p><img src="https://images2.imgbox.com/c8/81/gQ8pUt4h_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="octopus__Spring_cloud_Gateway_19"></a>ğŸ™ ä»€ä¹ˆæ˜¯ Spring cloud Gateway</h3> 
<p>ä¸€ä¸ªæ„å»ºåœ¨ Spring ç”Ÿæ€ç³»ç»Ÿä¹‹ä¸Šçš„ API ç½‘å…³ï¼ŒåŒ…æ‹¬ï¼šSpring 6ã€Spring Boot 3ã€Spring Webflux å’Œ Project Reactorã€‚Spring Cloud Gateway æ—¨åœ¨æä¾›ä¸€ç§ç®€å•è€Œæœ‰æ•ˆçš„æ–¹æ³•æ¥è·¯ç”±åˆ° APIï¼Œå¹¶ä¸ºå®ƒä»¬æä¾›æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œä¾‹å¦‚ï¼šå®‰å…¨æ€§ã€ç›‘æ§/æŒ‡æ ‡å’Œå¼¹æ€§ã€‚</p> 
<p>ğŸ… 1ã€æœ¯è¯­</p> 
<p><code>Route</code>ï¼šGateway çš„åŸºæœ¬æ„å»ºå—ã€‚å®ƒç”± IDã€ç›®æ ‡ URIã€è°“è¯é›†åˆå’Œè¿‡æ»¤å™¨é›†åˆå®šä¹‰ã€‚å¦‚æœèšåˆè°“è¯ä¸ºçœŸï¼Œåˆ™è·¯ç”±åŒ¹é…ã€‚</p> 
<p><code>Predicate</code>ï¼šæ˜¯ä¸€ä¸ªJava 8 å‡½æ•°è°“è¯ã€‚è¾“å…¥ç±»å‹æ˜¯Spring FrameworkServerWebExchangeã€‚å¯ä»¥åŒ¹é… HTTP è¯·æ±‚ä¸­çš„ä»»ä½•å†…å®¹ï¼Œä¾‹å¦‚è¯·æ±‚å¤´æˆ–å‚æ•°ã€‚</p> 
<p><code>Filter</code>ï¼šæ˜¯GatewayFilterä½¿ç”¨ç‰¹å®šå·¥å‚æ„å»ºçš„å®ä¾‹ã€‚å¯ä»¥åœ¨å‘é€ä¸‹æ¸¸è¯·æ±‚ä¹‹å‰æˆ–ä¹‹åä¿®æ”¹è¯·æ±‚å’Œå“åº”ã€‚</p> 
<p>ğŸ… 2ã€å·¥ä½œåŸç†</p> 
<p>å®˜ç½‘æä¾›äº† Spring Cloud Gateway å·¥ä½œåŸç†çš„é«˜çº§æ¦‚è¿°å›¾ï¼š</p> 
<p><img src="https://images2.imgbox.com/cc/34/KFAj0N7p_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>å®¢æˆ·ç«¯å‘ Spring Cloud Gateway å‘å‡ºè¯·æ±‚ã€‚å¦‚æœ Gateway Handler Mapping ç¡®å®šè¯·æ±‚ä¸è·¯ç”±åŒ¹é…ï¼Œåˆ™å°†å…¶å‘é€åˆ° Gateway Web Handlerã€‚æ­¤å¤„ç†ç¨‹åºé€šè¿‡ç‰¹å®šäºè¯·æ±‚çš„è¿‡æ»¤å™¨é“¾è¿è¡Œè¯·æ±‚ã€‚è¿‡æ»¤å™¨è¢«è™šçº¿åˆ†å¼€çš„åŸå› æ˜¯è¿‡æ»¤å™¨å¯ä»¥åœ¨å‘é€ä»£ç†è¯·æ±‚ä¹‹å‰å’Œä¹‹åè¿è¡Œé€»è¾‘ã€‚æ‰§è¡Œæ‰€æœ‰ <code>â€œpreâ€</code> è¿‡æ»¤å™¨é€»è¾‘ã€‚ç„¶åè¿›è¡Œä»£ç†è¯·æ±‚ã€‚å‘å‡ºä»£ç†è¯·æ±‚åï¼Œè¿è¡Œ <code>â€œpostâ€</code> è¿‡æ»¤å™¨é€»è¾‘ã€‚</p> 
<h2><a id="rainbow_Spring_Cloud_Gateway__40"></a>ğŸŒˆ Spring Cloud Gateway å®æˆ˜</h2> 
<h3><a id="octopus__42"></a>ğŸ™ ç‰ˆæœ¬å®šä¹‰</h3> 
<p>ä½¿ç”¨çš„ç‰ˆæœ¬å¦‚ä¸‹ï¼š</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.boot.version</span><span class="token punctuation">&gt;</span></span>2.6.13<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.boot.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.cloud.version</span><span class="token punctuation">&gt;</span></span>2021.0.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.cloud.version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring.cloud-alibaba.version</span><span class="token punctuation">&gt;</span></span>2021.0.5.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring.cloud-alibaba.version</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="octopus__gateway_52"></a>ğŸ™ æ–°å»ºæ¨¡å— gateway</h3> 
<p>1ã€æ·»åŠ ä¾èµ–</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-bootstrap<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>2ã€æ·»åŠ é…ç½®</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> spring<span class="token punctuation">-</span>cloud<span class="token punctuation">-</span>gateway
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token comment"># è·¯ç”±é…ç½®</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> user_routh  <span class="token comment"># è·¯ç”±IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">8001</span>  <span class="token comment"># åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/user<span class="token punctuation">-</span>service/<span class="token important">**</span>  <span class="token comment"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span>
</code></pre> 
<p>3ã€å¯åŠ¨ç”¨æˆ·æœåŠ¡ï¼Œç½‘å…³æœåŠ¡</p> 
<p>å…ˆè®¿é—®ç”¨æˆ·æœåŠ¡è‡ªèº«æ¥å£ï¼šhttp://localhost:8001/user-service/user/1ï¼Œè¯·æ±‚æˆåŠŸã€‚</p> 
<p>é€šè¿‡ç½‘å…³è·¯ç”±åˆ°ç”¨æˆ·æœåŠ¡ï¼šhttp://localhost/user-service/user/1ï¼Œè¯·æ±‚æˆåŠŸã€‚</p> 
<h2><a id="rainbow_Spring_Cloud_Gateway__89"></a>ğŸŒˆ Spring Cloud Gateway è°“è¯</h2> 
<h3><a id="octopus__91"></a>ğŸ™ â€‹é…ç½®è·¯ç”±è°“è¯å’Œè¿‡æ»¤å™¨</h3> 
<p>æœ‰ä¸¤ç§é…ç½®è°“è¯å’Œè¿‡æ»¤å™¨çš„æ–¹æ³•ï¼šå¿«æ·æ–¹å¼å’Œå®Œå…¨æ‰©å±•çš„å‚æ•°ã€‚</p> 
<p>1ã€å¿«æ·æ–¹å¼é…ç½®</p> 
<p>å¿«æ·æ–¹å¼é…ç½®ç”±è¿‡æ»¤å™¨åç§°è¯†åˆ«ï¼Œåè·Ÿç­‰å· <code>=</code> ï¼Œç„¶åæ˜¯ç”¨é€—å· <code>,</code> åˆ†éš”çš„å‚æ•°å€¼ã€‚</p> 
<p>ç¤ºä¾‹</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> example_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">8001</span>
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> Cookie=mycookie<span class="token punctuation">,</span>mycookievalue
</code></pre> 
<p>2ã€å®Œå…¨æ‰©å±•çš„å‚æ•°</p> 
<p>å®Œå…¨æ‰©å±•çš„å‚æ•°æ˜¯å¸¦æœ‰åç§°/å€¼çš„æ ‡å‡† yaml é…ç½®ã€‚</p> 
<p>ç¤ºä¾‹</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> example_route
        <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">8001</span>
        <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Cookie
          <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token key atrule">name</span><span class="token punctuation">:</span> mycookie
            <span class="token key atrule">regexp</span><span class="token punctuation">:</span> mycookievalue
</code></pre> 
<h3><a id="octopus__132"></a>ğŸ™ è·¯ç”±è°“è¯å·¥å‚</h3> 
<p>Spring Cloud Gateway åŒ…å«è®¸å¤šå†…ç½®çš„è·¯ç”±è°“è¯å·¥å‚ã€‚æ‰€æœ‰è¿™äº›è°“è¯éƒ½åŒ¹é… HTTP è¯·æ±‚çš„ä¸åŒå±æ€§ã€‚</p> 
<p>è¿™äº› Predict çš„æºç åœ¨ <code>org.springframework.cloud.gateway.handler.predicate</code> åŒ…ä¸­ã€‚</p> 
<p>Spring Cloud Gateway ä¸­çš„è°“è¯å·¥å‚å‘½åéƒ½æ˜¯æœ‰è§„èŒƒçš„ï¼Œæ ¼å¼ï¼š<code>xxxRoutePredicateFactory</code>ã€‚</p> 
<p>æ¯”å¦‚ Cookie çš„è·¯ç”±è°“è¯å·¥å‚ï¼š<code>CookieRoutePredicateFactory</code>ï¼Œä½¿ç”¨é…ç½®æ—¶ç›´æ¥å–å‰é¢çš„ Cookieã€‚</p> 
<p>ä¸€äº›ç¤ºä¾‹ï¼š</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> payment_routh
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//payment<span class="token punctuation">-</span>service
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/payment/<span class="token important">**</span>
            <span class="token punctuation">-</span> After=2020<span class="token punctuation">-</span>02<span class="token punctuation">-</span>21T15<span class="token punctuation">:</span>51<span class="token punctuation">:</span>37.485+08<span class="token punctuation">:</span>00<span class="token punctuation">[</span>Asia/Shanghai<span class="token punctuation">]</span>
            <span class="token punctuation">-</span> Cookie=username<span class="token punctuation">,</span>don
            <span class="token punctuation">-</span> Header=X<span class="token punctuation">-</span>Request<span class="token punctuation">-</span>Id<span class="token punctuation">,</span> \d+  <span class="token comment"># è¯·æ±‚å¤´è¦æœ‰X-Request-Idå±æ€§å¹¶ä¸”å€¼ä¸ºæ•´æ•°çš„æ­£åˆ™è¡¨è¾¾å¼</span>
</code></pre> 
<h2><a id="rainbow_Spring_Cloud_Gateway__158"></a>ğŸŒˆ Spring Cloud Gateway è¿‡æ»¤å™¨</h2> 
<p>è¿‡æ»¤å™¨å…è®¸ä»¥æŸç§æ–¹å¼ä¿®æ”¹ä¼ å…¥çš„ HTTP è¯·æ±‚æˆ–ä¼ å‡ºçš„ HTTP å“åº”ã€‚</p> 
<p>ğŸ… â€‹1ã€è¿‡æ»¤å™¨çš„ç”Ÿå‘½å‘¨æœŸ</p> 
<p><code>PRE</code>ï¼šè¿‡æ»¤å™¨åœ¨è¯·æ±‚è·¯ç”±ä¹‹å‰è°ƒç”¨ã€‚å¯ä»¥ç”¨æ¥å®ç°èº«ä»½éªŒè¯ã€åœ¨é›†ç¾¤ä¸­é€‰æ‹©è¯·æ±‚çš„å¾®æœåŠ¡ã€è®°å½•è°ƒè¯•ä¿¡æ¯ç­‰ã€‚</p> 
<p><code>POST</code>ï¼šè¿‡æ»¤å™¨åœ¨è¯·æ±‚è·¯ç”±åˆ°å¾®æœåŠ¡æ‰§è¡Œå“åº”åè°ƒç”¨ã€‚å¯ä»¥ä¸ºå“åº”æ·»åŠ æ ‡å‡†çš„HTTP Headerã€æ”¶é›†ç»Ÿè®¡ä¿¡æ¯ç­‰ã€‚</p> 
<p>ğŸ… â€‹2ã€è¿‡æ»¤å™¨çš„åˆ†ç±»</p> 
<p>åˆ†ä¸ºè·¯ç”±è¿‡æ»¤å™¨ <code>GatewayFilter</code> å’Œ å…¨å±€è¿‡æ»¤å™¨ <code>GlobalFilter</code>ã€‚</p> 
<p>è·¯ç”±è¿‡æ»¤å™¨çš„ä½œç”¨èŒƒå›´æ˜¯ç‰¹å®šè·¯ç”±ï¼›å…¨å±€è¿‡æ»¤å™¨åº”ç”¨äºæ‰€æœ‰è·¯ç”±ã€‚</p> 
<h3><a id="octopus__174"></a>ğŸ™ è·¯ç”±è¿‡æ»¤å™¨</h3> 
<p>è·¯ç”±è¿‡æ»¤å™¨å…è®¸ä»¥æŸç§æ–¹å¼ä¿®æ”¹ä¼ å…¥çš„ HTTP è¯·æ±‚æˆ–ä¼ å‡ºçš„ HTTP å“åº”ã€‚è·¯ç”±è¿‡æ»¤å™¨çš„èŒƒå›´æ˜¯ç‰¹å®šè·¯ç”±ã€‚</p> 
<p>Spring Cloud Gateway å†…ç½®äº†è®¸å¤šè·¯ç”±è¿‡æ»¤å™¨ï¼Œå¤šè¾¾ 30 å¤šä¸ªã€‚è¯¦ç»†å‚è€ƒæ–‡æ¡£ï¼š</p> 
<p>https://docs.spring.io/spring-cloud-gateway/docs/current/reference/html/#gatewayfilter-factories</p> 
<p>ğŸ… 1ã€è·¯ç”±è¿‡æ»¤å™¨çš„ä½¿ç”¨</p> 
<p>ç¤ºä¾‹ï¼ŒStripPrefix ç½‘å…³è¿‡æ»¤å™¨å·¥å‚é‡‡ç”¨ä¸€ä¸ªå‚æ•° <code>parts</code>ã€‚parts å‚æ•°æŒ‡ç¤ºåœ¨å°†è¯·æ±‚å‘é€åˆ°æœåŠ¡ä¹‹å‰è¦ä»è¯·æ±‚è·¯å¾„ä¸­ç§»é™¤çš„å±‚æ•°ã€‚</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> user_routh  <span class="token comment"># è·¯ç”±IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//user<span class="token punctuation">-</span>service  <span class="token comment"># åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/user<span class="token punctuation">-</span>service/<span class="token important">**</span>  <span class="token comment"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span>
          <span class="token key atrule">filters</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> StripPrefix=1  <span class="token comment"># å°†è·¯å¾„ç¬¬ä¸€å±‚ç§»é™¤</span>
</code></pre> 
<p>å½“å‘ç½‘å…³å‘é€è¯·æ±‚ http://localhost/user-service/user/1 æ—¶ï¼Œç»è¿‡è·¯ç”±è½¬å‘åˆ°æœåŠ¡çš„æ˜¯ <code>nameservice/user/1</code>ï¼Œä¹Ÿå³ç§»é™¤äº†ç¬¬ä¸€å±‚ <code>user-service</code>ã€‚</p> 
<p>ğŸ… 2ã€è‡ªå®šä¹‰è·¯ç”±è¿‡æ»¤å™¨</p> 
<p>æ–°å»ºä¸€ä¸ª <code>GatewayFilterFactory</code> ç±»ï¼Œç»§æ‰¿æŠ½è±¡ç±» <code>AbstractGatewayFilterFactory</code>ï¼Œå‘½åå¿…é¡»æ˜¯<code>xxxGatewayFilterFactory</code>ã€‚</p> 
<p>ç¤ºä¾‹ï¼Œè®¡ç®—è¯·æ±‚æœåŠ¡è°ƒç”¨è€—æ—¶ï¼š</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span></span><span class="token class-name">GatewayFilter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>gateway<span class="token punctuation">.</span>filter<span class="token punctuation">.</span>factory<span class="token punctuation">.</span></span><span class="token class-name">AbstractGatewayFilterFactory</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Collections</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TimeGatewayFilterFactory</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractGatewayFilterFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">TimeGatewayFilterFactory<span class="token punctuation">.</span>Config</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> BEGIN_TIME <span class="token operator">=</span> <span class="token string">"beginTime"</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">TimeGatewayFilterFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">Config</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * è¯»å–é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°èµ‹å€¼åˆ°é…ç½®ç±»ä¸­
     */</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">shortcutFieldOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">singletonList</span><span class="token punctuation">(</span><span class="token string">"showTime"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">GatewayFilter</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">Config</span> config<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> chain<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>config<span class="token punctuation">.</span>showTime<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// å¦‚æœé…ç½®ç±»ä¸­çš„showä¸ºfalseè¡¨ç¤ºæ”¾è¡Œ</span>
                <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            exchange<span class="token punctuation">.</span><span class="token function">getAttributes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>BEGIN_TIME<span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">/*
             * pre çš„é€»è¾‘
             * chain.filter().then(Mono.fromRunnable(()-&gt;{
             *     post çš„é€»è¾‘
             * }))
             */</span>
            <span class="token keyword">return</span> chain<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">fromRunnable</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">Long</span> startTime <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>BEGIN_TIME<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">null</span> <span class="token operator">!=</span> startTime<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" (è€—æ—¶: "</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"ms)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Data</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Config</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//Put the configuration properties for your filter here</span>
        <span class="token keyword">private</span> <span class="token keyword">boolean</span> showTime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>é…ç½®ï¼š</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> user_routh  <span class="token comment"># è·¯ç”±IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//user<span class="token punctuation">-</span>service  <span class="token comment"># åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/user<span class="token punctuation">-</span>service/<span class="token important">**</span>  <span class="token comment"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span>
          <span class="token key atrule">filters</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Time=true
</code></pre> 
<p>è®¿é—®è¯·æ±‚ï¼ŒæŸ¥çœ‹æ§åˆ¶å°ï¼š</p> 
<pre><code>http://localhost/user-service/user/1 (è€—æ—¶: 496ms)
</code></pre> 
<h3><a id="octopus__287"></a>ğŸ™ å…¨å±€è¿‡æ»¤å™¨</h3> 
<p><code>GlobalGilter</code> å…¨å±€è¿‡æ»¤å™¨æ¥å£ä¸ <code>GatewayFilter</code> ç½‘å…³è¿‡æ»¤å™¨æ¥å£å…·æœ‰ç›¸åŒçš„æ–¹æ³•å®šä¹‰ã€‚å…¨å±€è¿‡æ»¤å™¨æ˜¯ä¸€ç³»åˆ—ç‰¹æ®Šçš„è¿‡æ»¤å™¨ï¼Œä¼šæ ¹æ®æ¡ä»¶åº”ç”¨åˆ°æ‰€æœ‰è·¯ç”±ä¸­ã€‚</p> 
<p>å¤šä¸ª <code>GlobalFilter</code> å¯ä»¥é€šè¿‡ <code>@Order</code> æˆ–è€… <code>getOrder()</code> æ–¹æ³•æŒ‡å®šæ¯ä¸ª <code>GlobalFilter</code> çš„æ‰§è¡Œé¡ºåºï¼Œ<code>order</code> å€¼è¶Šå°ï¼Œæ‰§è¡Œçš„ä¼˜å…ˆçº§è¶Šé«˜ã€‚</p> 
<p>Spring Cloud Gateway å†…ç½®äº†å¤šä¸ªå…¨å±€è¿‡æ»¤å™¨å¯¹æ•´ä¸ªè·¯ç”±è¿›è¡Œå¤„ç†ã€‚</p> 
<p>ğŸ… â€‹1ã€å†…ç½®çš„ <code>GlobalFilter</code> å…¨å±€è¿‡æ»¤å™¨</p> 
<ul><li><code>ForwardRoutingFilter</code> ï¼šè½¬å‘è·¯ç”±è¿‡æ»¤å™¨</li><li><code>ReactiveLoadBalancerClientFilter</code> ï¼šè´Ÿè½½å‡è¡¡å®¢æˆ·ç«¯è¿‡æ»¤å™¨</li><li><code>NettyRoutingFilter</code> å’Œ <code>NettyWriteResponseFilter</code> ï¼šé€šè¿‡ <code>HttpClient</code> å®¢æˆ·ç«¯è½¬å‘è¯·æ±‚ç›´å®çš„URLå¹¶å°†å“åº”å†™å…¥åˆ°å½“å‰çš„è¯·æ±‚å“åº”ä¸­</li><li><code>RouteToRequestUrlFilter</code> ï¼šè·¯ç”±åˆ°æŒ‡å®šURLçš„è¿‡æ»¤å™¨</li><li><code>WebsocketRoutingFilter</code> ï¼šè´Ÿè´£å¤„ç† <code>Websocket</code> ç±»å‹çš„æ¸…æ±‚å“åº”ä¿¡æ¯</li><li><code>WebClientHttpRoutingFilter</code> å’Œ <code>WebClientWriteResponseFilter</code> ï¼šé€šè¿‡ <code>WebClient</code> å®¢æˆ·ç«¯è½¬å‘è¯·æ±‚ç›´å®çš„URLå¹¶å°†å“åº”å†™å…¥åˆ°å½“å‰çš„è¯·æ±‚å“åº”ä¸­</li></ul> 
<p>ğŸ… 2ã€è‡ªå®šä¹‰å…¨å±€è¿‡æ»¤å™¨</p> 
<p>æ–°å»ºè¿‡æ»¤å™¨å®ç° <code>GlobalFilter</code> æ¥å£ï¼Œå¹¶æ³¨å…¥åˆ°å®¹å™¨ä¸­</p> 
<p>ç¤ºä¾‹ï¼š</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * è®¿é—®æ—¥å¿—å…¨å±€è¿‡æ»¤å™¨
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span>MIN_VALUE<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AccessLogGlobalFilter</span> <span class="token keyword">implements</span> <span class="token class-name">GlobalFilter</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">GatewayFilterChain</span> chain<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token comment">// filter çš„å‰ç½®å¤„ç†</span>
        <span class="token class-name">ServerHttpRequest</span> request <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">String</span> path <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pathWithinApplication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">InetSocketAddress</span> remoteAddress <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> chain
                <span class="token comment">// ç»§ç»­è°ƒç”¨ filter</span>
                <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>exchange<span class="token punctuation">)</span>
                <span class="token comment">// filter çš„åç½®å¤„ç†</span>
                <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">fromRunnable</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token class-name">ServerHttpResponse</span> response <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token class-name">HttpStatus</span> statusCode <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"è¯·æ±‚è·¯å¾„:{}, IPåœ°å€:{}, å“åº”ç :{}"</span><span class="token punctuation">,</span> path<span class="token punctuation">,</span> remoteAddress<span class="token punctuation">,</span> statusCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>å…¨å±€è¿‡æ»¤å™¨ä¸å¿…åœ¨è·¯ç”±ä¸Šé…ç½®ï¼Œæ³¨å…¥åˆ° IOC å®¹å™¨ä¸­å³å¯å…¨å±€ç”Ÿæ•ˆã€‚</p> 
<h2><a id="rainbow_Spring_Cloud_Gateway__345"></a>ğŸŒˆ Spring Cloud Gateway é›†æˆæ³¨å†Œä¸­å¿ƒ</h2> 
<p>ä¸Šè¿°åœ¨é…ç½®æ–‡ä»¶ä¸­è·¯ç”±çš„æœåŠ¡åœ°å€æ˜¯å›ºå®šçš„ <code>uri</code> ï¼Œè¿™ç§é…ç½®å­˜åœ¨ä¸€å®šç¼ºç‚¹ï¼š</p> 
<ol><li>å¾®æœåŠ¡çš„åœ°å€ä¿®æ”¹äº†ï¼Œè·¯ç”±é…ç½®ä¸­çš„ <code>uri</code> å¿…é¡»ä¿®æ”¹</li><li>å¾®æœåŠ¡é›†ç¾¤æ— æ³•å®ç°è´Ÿè½½å‡è¡¡</li></ol> 
<p>å³éœ€è¦é›†æˆæ³¨å†Œä¸­å¿ƒï¼Œä½¿å¾—ç½‘å…³èƒ½å¤Ÿä»æ³¨å†Œä¸­å¿ƒè‡ªåŠ¨è·å–æœåŠ¡åœ°å€å®ç°è´Ÿè½½å‡è¡¡ã€‚</p> 
<h3><a id="octopus__Nacos_354"></a>ğŸ™ é›†æˆæ³¨å†Œä¸­å¿ƒ Nacos</h3> 
<p>ä¸‹æ–‡é€šè¿‡é›†æˆ Nacos åœ¨æ³¨å†Œä¸­å¿ƒæ¥è·å–å„ä¸ªå¾®æœåŠ¡çš„åœ°å€ã€‚</p> 
<p>1ã€æ·»åŠ  Nacos ä¾èµ–</p> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!-- Nacos æ³¨å†Œä¸­å¿ƒ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- è´Ÿè½½å‡è¡¡ --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-loadbalancer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>2ã€åœ¨ä¸»å¯åŠ¨ç±»æ·»åŠ æ³¨è§£</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>cloud<span class="token punctuation">.</span>client<span class="token punctuation">.</span>discovery<span class="token punctuation">.</span></span><span class="token class-name">EnableDiscoveryClient</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@EnableDiscoveryClient</span>
</code></pre> 
<p>3ã€ä¿®æ”¹é…ç½®æ–‡ä»¶</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> spring<span class="token punctuation">-</span>cloud<span class="token punctuation">-</span>gateway
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">locator</span><span class="token punctuation">:</span>
          <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment"># å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œåˆ©ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”±</span>
          <span class="token key atrule">lower-case-service-id</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>  <span class="token comment"># å°å†™</span>
      <span class="token comment"># è·¯ç”±é…ç½®</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> user_routh  <span class="token comment"># è·¯ç”±IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//user<span class="token punctuation">-</span>service  <span class="token comment"># ä»æ³¨å†Œä¸­å¿ƒè·å–å¾®æœåŠ¡åœ°å€,å¹¶éµå¾ªè´Ÿè½½å‡è¡¡ç­–ç•¥</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/user<span class="token punctuation">-</span>service/<span class="token important">**</span>  <span class="token comment"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span>
    <span class="token comment"># Nacos é…ç½®</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
</code></pre> 
<p>è·¯ç”±é…ç½®ä¸­ï¼Œè·¯ç”±çš„ uri æ ¼å¼ï¼š<code>lb://service-name</code>ï¼Œè¿™æ˜¯å›ºå®šå†™æ³•ï¼š</p> 
<ul><li> <p><code>lb</code>ï¼šæŒ‡çš„æ˜¯ä»æ³¨å†Œä¸­å¿ƒæŒ‰ç…§åç§°è·å–å¾®æœåŠ¡åœ°å€ï¼Œå¹¶éµå¾ªè´Ÿè½½å‡è¡¡ç­–ç•¥</p> 
  <blockquote> 
   <p>å…¨å±€è¿‡æ»¤å™¨ <code>ReactiveLoadBalancerClientFilter</code> å¤„ç†è·¯ç”±å’Œè´Ÿè½½å‡è¡¡</p> 
  </blockquote> </li><li> <p><code>service-name</code>ï¼šæ³¨å†Œä¸­å¿ƒçš„æœåŠ¡åç§°</p> </li></ul> 
<p>4ã€å¯åŠ¨ç”¨æˆ·æœåŠ¡ï¼Œç½‘å…³æœåŠ¡</p> 
<p>æˆåŠŸæ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒ Nacosï¼š</p> 
<p><img src="https://images2.imgbox.com/a9/3f/CUYTDuZY_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>é€šè¿‡ç½‘å…³è·¯ç”±åˆ°ç”¨æˆ·æœåŠ¡ï¼šhttp://localhost/user-service/user/1ï¼Œè¯·æ±‚æˆåŠŸã€‚</p> 
<h2><a id="rainbow_Spring_Cloud_Gateway__421"></a>ğŸŒˆ Spring Cloud Gateway é›†æˆé…ç½®ä¸­å¿ƒ</h2> 
<p>å¦‚æœå°†ç½‘å…³çš„ä¸€ç³»åˆ—é…ç½®å†™åˆ°é¡¹ç›®çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œä¸€æ—¦è·¯ç”±å‘ç”Ÿæ”¹å˜å¿…é¡»è¦é‡å¯é¡¹ç›®ï¼Œè¿™æ ·ç»´æŠ¤æˆæœ¬å¾ˆé«˜ã€‚</p> 
<p>å¯ä»¥å°†ç½‘å…³çš„é…ç½®å­˜æ”¾åˆ°é…ç½®ä¸­å¿ƒä¸­ï¼Œè¿™æ ·ç”±é…ç½®ä¸­å¿ƒç»Ÿä¸€ç®¡ç†ï¼Œä¸€æ—¦è·¯ç”±å‘ç”Ÿæ”¹å˜ï¼Œåªéœ€è¦åœ¨é…ç½®ä¸­å¿ƒä¿®æ”¹ã€‚</p> 
<h3><a id="octopus__Nacos__427"></a>ğŸ™ é›†æˆé…ç½®ä¸­å¿ƒ Nacos å®ç°åŠ¨æ€è·¯ç”±</h3> 
<p>ä¸‹æ–‡é€šè¿‡é›†æˆ Nacos åœ¨é…ç½®ä¸­å¿ƒæ¥ç®¡ç†è·¯ç”±ä¿¡æ¯ã€‚</p> 
<p>1ã€æ·»åŠ ä¾èµ–</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>2ã€åœ¨ <code>bootstrap.yml</code> é…ç½® Nacos ä½œä¸ºé…ç½®ä¸­å¿ƒ</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> spring<span class="token punctuation">-</span>cloud<span class="token punctuation">-</span>gateway
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token comment">### Nacos é…ç½®</span>
    <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
      <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 127.0.0.1<span class="token punctuation">:</span><span class="token number">8848</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token comment"># æŒ‡å®šæ–‡ä»¶åç¼€æœªyaml</span>
        <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml
</code></pre> 
<p>3ã€åœ¨ Nacos ä¸­çš„é»˜è®¤å‘½åç©ºé—´ä¸­åˆ›å»º Data ID ä¸º <code>spring-cloud-gateway.yaml</code> çš„é…ç½®ï¼ˆæœªæŒ‡å®šç¯å¢ƒï¼‰ï¼Œç¼–å†™è·¯ç”±ä¿¡æ¯</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token comment">## è·¯ç”±é…ç½®</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> system<span class="token punctuation">-</span>service          <span class="token comment"># è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span>
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//system<span class="token punctuation">-</span>service    <span class="token comment"># åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€ï¼Œlb è´Ÿè½½å‡è¡¡</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/system<span class="token punctuation">-</span>service/<span class="token important">**</span>   <span class="token comment"># æ–­è¨€ï¼Œè·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span>
          <span class="token key atrule">filters</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Time=true
</code></pre> 
<p>4ã€å¯åŠ¨ç½‘å…³æœåŠ¡</p> 
<p>å‘é€è¯·æ±‚ http://localhost/system-service/dept æˆåŠŸè·¯ç”±åˆ°ç³»ç»ŸæœåŠ¡</p> 
<h2><a id="rainbow_Spring_Cloud_Gateway__475"></a>ğŸŒˆ Spring Cloud Gateway å¼‚å¸¸å¤„ç†</h2> 
<p>å½“ç½‘å…³æœåŠ¡æˆ–ä¸šåŠ¡æœåŠ¡å‡ºç°å¼‚å¸¸æ—¶ï¼ŒSpring Cloud Gateway ä¼šè¿”å›ä¸€å †é”™è¯¯ä¿¡æ¯ï¼Œéå¸¸ä¸å‹å¥½ã€‚</p> 
<p>Spring Boot æœåŠ¡ä¸­éƒ½æ˜¯ä½¿ç”¨ <code>@ControllerAdvice</code> æ¥åŒ…è£…å…¨å±€å¼‚å¸¸å¤„ç†çš„ï¼Œå½“æœåŠ¡ä¸‹çº¿æˆ–å®•æœºæ—¶ï¼Œè¯·æ±‚å¹¶æ²¡æœ‰åˆ°è¾¾æœåŠ¡ã€‚è¿™æ—¶ç½‘å…³ä¸­ä¹Ÿè¦å®šåˆ¶ä¸€å±‚å…¨å±€å¼‚å¸¸å¤„ç†ï¼Œè¿™æ ·æ‰èƒ½æ›´åŠ å‹å¥½çš„å’Œå®¢æˆ·ç«¯äº¤äº’ã€‚</p> 
<h3><a id="octopus__481"></a>ğŸ™ è‡ªå®šä¹‰å…¨å±€å¼‚å¸¸å¤„ç†</h3> 
<p>åˆ›å»ºä¸€ä¸ªç±» <code>GlobalErrorExceptionHandler</code> å®ç° <code>ErrorWebExceptionHandler</code> é‡å†™å…¶ä¸­çš„ handle æ–¹æ³•ï¼š</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * ç½‘å…³çš„å…¨å±€å¼‚å¸¸å¤„ç†
 * &lt;p&gt;
 * ä¼˜å…ˆçº§ä¸€å®šè¦å°äºå†…ç½® ResponseStatusExceptionHandler ç»è¿‡å®ƒå¤„ç†çš„è·å–å¯¹åº”é”™è¯¯ç±»çš„ å“åº”ç 
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Order</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GlobalErrorExceptionHandler</span> <span class="token keyword">implements</span> <span class="token class-name">ErrorWebExceptionHandler</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Void</span><span class="token punctuation">&gt;</span></span> <span class="token function">handle</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token comment">// å·²ç» commit åˆ™ç›´æ¥è¿”å›å¼‚å¸¸</span>
        <span class="token class-name">ServerHttpResponse</span> response <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">isCommitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// è½¬æ¢æˆ Result</span>
        <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> result<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>ex <span class="token keyword">instanceof</span> <span class="token class-name">NotFoundException</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            result <span class="token operator">=</span> <span class="token function">notFoundExceptionHandler</span><span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">NotFoundException</span><span class="token punctuation">)</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ex <span class="token keyword">instanceof</span> <span class="token class-name">ResponseStatusException</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            result <span class="token operator">=</span> <span class="token function">responseStatusExceptionHandler</span><span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">ResponseStatusException</span><span class="token punctuation">)</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            result <span class="token operator">=</span> <span class="token function">defaultExceptionHandler</span><span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// è¿”å›ç»™å‰ç«¯</span>
        <span class="token keyword">return</span> <span class="token class-name">WebUtil</span><span class="token punctuation">.</span><span class="token function">writeJson</span><span class="token punctuation">(</span>exchange<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * å¤„ç† Spring Cloud Gateway æŠ›å‡ºçš„ NotFoundException å¼‚å¸¸
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">notFoundExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">NotFoundException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ServerHttpRequest</span> request <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"[Gateway NotFoundException]. uri({} / {}), ex({})]"</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">failed</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">getRawStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"æœåŠ¡æœªæ‰¾åˆ°"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * å¤„ç† Spring Cloud Gateway é»˜è®¤æŠ›å‡ºçš„ ResponseStatusException å¼‚å¸¸
     */</span>
    <span class="token keyword">private</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">responseStatusExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">ResponseStatusException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ServerHttpRequest</span> request <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"[Gateway ResponseStatusException]. uri({} / {}), ex({})]"</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">failed</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">getRawStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getReason</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * å…œåº•å¤„ç†ç³»ç»Ÿå¼‚å¸¸
     */</span>
    <span class="token annotation punctuation">@ExceptionHandler</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token class-name">Exception</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> <span class="token function">defaultExceptionHandler</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ServerHttpRequest</span> request <span class="token operator">=</span> exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"[Gateway Exception]. uri({} / {}), ex({})]"</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getURI</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">failed</span><span class="token punctuation">(</span><span class="token class-name">CommonConstants</span><span class="token punctuation">.</span>FAIL<span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>é‡å¯ç½‘å…³æœåŠ¡æµ‹è¯•ï¼š</p> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"code"</span><span class="token operator">:</span> <span class="token number">503</span><span class="token punctuation">,</span>
    <span class="token string-property property">"msg"</span><span class="token operator">:</span> <span class="token string">"æœåŠ¡æœªæ‰¾åˆ°"</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="rainbow_Spring_Cloud_Gateway_559"></a>ğŸŒˆ Spring Cloud Gateway</h2> 
<h2><a id="rainbow_Spring_Cloud_Gateway_564"></a>ğŸŒˆ Spring Cloud Gateway</h2> 
<h2><a id="rainbow_Spring_Cloud_Gateway_569"></a>ğŸŒˆ Spring Cloud Gateway</h2> 
<h2><a id="rainbow_Spring_Cloud_Gateway_574"></a>ğŸŒˆ Spring Cloud Gateway</h2> 
<h2><a id="rainbow_Spring_Cloud_Gateway_579"></a>ğŸŒˆ Spring Cloud Gateway</h2>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3904717f24553589e651a52dfe1fea51/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">Spring Cloud å®æˆ˜ç³»åˆ—ï¼šæœåŠ¡æ³¨å†Œä¸å‘ç° Alibaba Nacos</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2d20b7df1d97e94b67057ec901e66e60/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">k8så¯è§†åŒ–ç®¡ç†å·¥å…·Rancherå®‰è£…å’Œä½¿ç”¨</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 èœé¸Ÿç¨‹åºå‘˜åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>