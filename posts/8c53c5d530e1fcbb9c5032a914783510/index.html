<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【持久层框架】- SpringData - JPA - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【持久层框架】- SpringData - JPA" />
<meta property="og:description" content="SpringData - JPA 😄生命不息，写作不止
🔥 继续踏上学习之路，学之分享笔记
👊 总有一天我也能像各位大佬一样
🏆 一个有梦有戏的人 @怒放吧德德
🌝分享学习心得，欢迎指正，大家一起学习成长！
JPA SpringData - JPAJPA简介什么是ORM？SpringData-JPASpringBoot整合JPA导入依赖编写配置文件创建实体类启动项目对表操作增加数据查看数据分页查找根据ID查找 方法命名规则自定义查询编写Repository 使用JPQL的方式查询(注解式SQL)计数参数传递 实体关系对应一对一一对多多对多 文章推荐 JPA简介 JPA 即Java Persistence API。是一款持久层框架，中文名Java持久层API，是JDK 5.0注解或XML描述对象－关系表的映射关系，并将运行期的实体对象持久化到数据库中。JPA的对象关系映射（ORM）模型是基于Hibernate。是一款面向对象的ORM框架，JPA不需要关心数据库字段，通过注解将数据库表与实体完成映射，在java中的操作只需要对实体进行操作即可。
什么是ORM？ ORM（Object-Relational Mapping） 表示对象关系映射。在面向对象的软件开发中，通过ORM，就可以把对象映射到关系型数据库中。只要有一套程序能够做到建立对象与数据库的关联，操作对象就可以直接操作数据库数据，就可以说这套程序实现了ORM对象关系映射。也就是说ORM是建立了一个实体与数据库表的关系，使得开发者对实体的直接操作而不是对数据库的操作，但操作实体也就等同于操作了数据库。
ORM框架还有：MyBatis、Hibernate
SpringData-JPA Spring Data JPA 是 Spring 基于 ORM 框架、JPA 规范的基础上封装的一套JPA应用框架，可使开发者用极简的代码即可实现对数据库的访问和操作。
它提供了包括增删改查等在内的常用功能，且易于扩展！学习并使用 Spring Data JPA 可以极大提高开发效率！
Spring Data JPA 让我们解脱了DAO层的操作，基本上所有CRUD都可以依赖于它来实现
在实际的工作工程中，推荐使用Spring Data JPA &#43; ORM（如：hibernate）完成操作，这样在切换不同的ORM框架时提供了极大的方便，同时也使数据库层操作更加简单，方便解耦。
SpringBoot整合JPA 接下来通过一个案例简单学习一下JPA，并且在案例中学习一些相关知识。
导入依赖 需要导入jpa坐标和mysql依赖包
&lt;dependencies&gt; &lt;!--jpa--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--Mysql依赖包--&gt; &lt;dependency&gt; &lt;groupId&gt;mysql&lt;/groupId&gt; &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt; &lt;scope&gt;runtime&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; 编写配置文件 先配置数据源，采用mysql8." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/8c53c5d530e1fcbb9c5032a914783510/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-03T12:39:48+08:00" />
<meta property="article:modified_time" content="2022-10-03T12:39:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【持久层框架】- SpringData - JPA</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="SpringData__JPA_0"></a>SpringData - JPA</h2> 
<blockquote> 
 <p>😄生命不息，写作不止<br> 🔥 继续踏上学习之路，学之分享笔记<br> 👊 总有一天我也能像各位大佬一样<br> 🏆 <a href="https://blog.csdn.net/qq_43843951">一个有梦有戏的人</a> <a href="https://www.cnblogs.com/lyd-code/" rel="nofollow">@怒放吧德德</a><br> 🌝分享学习心得，欢迎指正，大家一起学习成长！</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/43/f5/FHpJtZ4j_o.jpg" alt="在这里插入图片描述"></p> 
<p></p> 
<div class="toc"> 
 <h4>JPA</h4> 
 <ul><li><a href="#SpringData__JPA_0" rel="nofollow">SpringData - JPA</a></li><li><ul><li><a href="#JPA_11" rel="nofollow">JPA简介</a></li><li><a href="#ORM_13" rel="nofollow">什么是ORM？</a></li><li><a href="#SpringDataJPA_16" rel="nofollow">SpringData-JPA</a></li><li><a href="#SpringBootJPA_21" rel="nofollow">SpringBoot整合JPA</a></li><li><ul><li><a href="#_23" rel="nofollow">导入依赖</a></li><li><a href="#_41" rel="nofollow">编写配置文件</a></li><li><a href="#_65" rel="nofollow">创建实体类</a></li><li><a href="#_106" rel="nofollow">启动项目</a></li><li><a href="#_111" rel="nofollow">对表操作</a></li><li><ul><li><a href="#_112" rel="nofollow">增加数据</a></li><li><a href="#_158" rel="nofollow">查看数据</a></li><li><a href="#_170" rel="nofollow">分页查找</a></li><li><a href="#ID_181" rel="nofollow">根据ID查找</a></li></ul> 
   </li></ul> 
   </li><li><a href="#_199" rel="nofollow">方法命名规则自定义查询</a></li><li><ul><li><a href="#Repository_202" rel="nofollow">编写Repository</a></li></ul> 
   </li><li><a href="#JPQLSQL_232" rel="nofollow">使用JPQL的方式查询(注解式SQL)</a></li><li><ul><li><a href="#_234" rel="nofollow">计数</a></li><li><a href="#_253" rel="nofollow">参数传递</a></li></ul> 
   </li><li><a href="#_266" rel="nofollow">实体关系对应</a></li><li><ul><li><a href="#_268" rel="nofollow">一对一</a></li><li><a href="#_326" rel="nofollow">一对多</a></li><li><a href="#_403" rel="nofollow">多对多</a></li></ul> 
   </li><li><a href="#_477" rel="nofollow">文章推荐</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="JPA_11"></a>JPA简介</h3> 
<p>JPA 即Java Persistence API。是一款持久层框架，中文名Java持久层API，是JDK 5.0注解或XML描述对象－关系表的映射关系，并将运行期的实体对象持久化到数据库中。JPA的对象关系映射（ORM）模型是基于Hibernate。是一款面向对象的ORM框架，JPA不需要关心数据库字段，通过注解将数据库表与实体完成映射，在java中的操作只需要对实体进行操作即可。</p> 
<h3><a id="ORM_13"></a>什么是ORM？</h3> 
<p>ORM（Object-Relational Mapping） 表示对象关系映射。在面向对象的软件开发中，通过ORM，就可以把对象映射到关系型数据库中。只要有一套程序能够做到建立对象与数据库的关联，操作对象就可以直接操作数据库数据，就可以说这套程序实现了ORM对象关系映射。也就是说ORM是建立了一个实体与数据库表的关系，使得开发者对实体的直接操作而不是对数据库的操作，但操作实体也就等同于操作了数据库。<br> ORM框架还有：MyBatis、Hibernate</p> 
<h3><a id="SpringDataJPA_16"></a>SpringData-JPA</h3> 
<p>Spring Data JPA 是 Spring 基于 ORM 框架、JPA 规范的基础上封装的一套JPA应用框架，可使开发者用极简的代码即可实现对数据库的访问和操作。<br> 它提供了包括增删改查等在内的常用功能，且易于扩展！学习并使用 Spring Data JPA 可以极大提高开发效率！<br> Spring Data JPA 让我们解脱了DAO层的操作，基本上所有CRUD都可以依赖于它来实现<br> 在实际的工作工程中，推荐使用Spring Data JPA + ORM（如：hibernate）完成操作，这样在切换不同的ORM框架时提供了极大的方便，同时也使数据库层操作更加简单，方便解耦。</p> 
<h3><a id="SpringBootJPA_21"></a>SpringBoot整合JPA</h3> 
<p>接下来通过一个案例简单学习一下JPA，并且在案例中学习一些相关知识。</p> 
<h4><a id="_23"></a>导入依赖</h4> 
<p>需要导入jpa坐标和mysql依赖包</p> 
<pre><code class="prism language-java"><span class="token generics"><span class="token punctuation">&lt;</span>dependencies<span class="token punctuation">&gt;</span></span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span>jpa<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>spring<span class="token operator">-</span>boot<span class="token operator">-</span>starter<span class="token operator">-</span>data<span class="token operator">-</span>jpa<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token class-name">Mysql</span>依赖包<span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token generics"><span class="token punctuation">&lt;</span>dependency<span class="token punctuation">&gt;</span></span>
        <span class="token generics"><span class="token punctuation">&lt;</span>groupId<span class="token punctuation">&gt;</span></span>mysql<span class="token operator">&lt;</span><span class="token operator">/</span>groupId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>artifactId<span class="token punctuation">&gt;</span></span>mysql<span class="token operator">-</span>connector<span class="token operator">-</span>java<span class="token operator">&lt;</span><span class="token operator">/</span>artifactId<span class="token operator">&gt;</span>
        <span class="token generics"><span class="token punctuation">&lt;</span>scope<span class="token punctuation">&gt;</span></span>runtime<span class="token operator">&lt;</span><span class="token operator">/</span>scope<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>dependency<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>dependencies<span class="token operator">&gt;</span>
</code></pre> 
<h4><a id="_41"></a>编写配置文件</h4> 
<p>先配置数据源，采用mysql8.0。还包括配置jpa的相关配置。主要是配置jpa的sql日志打印和自动创建表格。</p> 
<pre><code class="prism language-yml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/springboot_demo<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;useSSL=false&amp;characterEncoding=utf8&amp;serverTimezone=Asia/Shanghai</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">12356</span>
<span class="token key atrule">jpa</span><span class="token punctuation">:</span>
  <span class="token key atrule">show-sql</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">hibernate</span><span class="token punctuation">:</span>
    <span class="token key atrule">ddl-auto</span><span class="token punctuation">:</span> create <span class="token comment"># 自动创建表格，之后改成update</span>
</code></pre> 
<p>jpa的底层是通过hibernate执行的，通过配置ddl-auto能够自动创建表，但是这个不建议使用，如果是create，在项目运行的时候就会把存在的表删除在添加。详情如下：<br> ddl-auto属性用于设置自动表定义，可以实现自动在数据库中为我们创建一个表，表的结构会根据我们定义的实体类决定，它有4种</p> 
<ul><li>create 启动时删数据库中的表，然后创建，退出时不删除数据表</li><li>create-drop 启动时删数据库中的表，然后创建，退出时删除数据表 如果表不存在报错</li><li>update 如果启动时表格式不一致则更新表，原有数据保留</li><li>validate 项目启动表结构进行校验 如果不一致则报错</li></ul> 
<p>接下来就可以开始体验jpa了</p> 
<h4><a id="_65"></a>创建实体类</h4> 
<p>可见通过注解可以实现实体与数据库的直接映射，jpa操作的就是这些实体就等同操作数据库的表结构。</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Generated</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author: lyd
 * @description: 实体User
 * @Date: 2022/10/2
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"sys_user"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"user_id"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span> <span class="token comment">// 自增</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> nickName<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<ul><li>@Data：lombok下的注解，主要是方便开发，减少对get、set、tostring的编写。这个需要导入相应的依赖坐标。</li><li>@Entity：声明是一个实体。</li><li>@Table(name = “sys_user”)：指明数据库中表的名字实现实体与数据表映射。</li><li>@Id：声明主键。</li><li>@Column(name = “user_id”)：指明是表中的哪个字段。</li><li>@GeneratedValue(strategy = GenerationType.IDENTITY)： GenerationType.IDENTITY：实现自增</li></ul> 
<h4><a id="_106"></a>启动项目</h4> 
<p>当我们启动项目的时候，数据库会自动创建表结构。<br> <img src="https://images2.imgbox.com/fb/26/xAYuyC3p_o.png" alt="在这里插入图片描述"><br> 看一下数据库，发现表已经自动创建<br> <img src="https://images2.imgbox.com/69/e2/RkUqgNYG_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_111"></a>对表操作</h4> 
<h5><a id="_112"></a>增加数据</h5> 
<p>首先需要创建UserRepository接口，要通过继承JpaRepository&lt;T, ID&gt;，提供实体类和id的类型。</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @author: lyd
 * @description: UserRepository
 * @Date: 2022/10/2
 */</span>
<span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">JpaSpecificationExecutor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
   
<span class="token punctuation">}</span>
</code></pre> 
<p>编写测试类<br> 通过调用save方法即可完成保存操作</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">UserRepository</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * @author: lyd
 * @description: 测试类
 * @Date: 2022/10/2
 */</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JpaTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserRepository</span> userRepository<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token class-name">InsertTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setNickName</span><span class="token punctuation">(</span><span class="token string">"怒放吧德德"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"lyd_code"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"lyd_open"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">User</span> save <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>save<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行结果<br> <img src="https://images2.imgbox.com/60/4f/M9l3tVBG_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_158"></a>查看数据</h5> 
<p>通过findAll就可以直接获取得到所有的数据。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token class-name">QueryTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> all <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    all<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>就能在控制台中看到：<br> <img src="https://images2.imgbox.com/fd/5b/XKLI90Xw_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_170"></a>分页查找</h5> 
<p>jpa也是实现了分页操作的方法。通过PageRequest.of(0,1)可以完成分页。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token class-name">PageRequestTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    userRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">PageRequest</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>其底层对数据库的操作就会加上limit.<br> <img src="https://images2.imgbox.com/56/84/ew04IjGp_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="ID_181"></a>根据ID查找</h5> 
<p>返回是Optional类，User类型的数组</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token class-name">FindByIdTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> user <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>Java8 新特性Optional类<br> Optional 类新特性</p> 
 <p>Optional 类是一个可以为null的容器对象<br> 如果值存在则isPresent()方法会返回true，调用get()方法会返回该对象<br> Optional 是个容器：它可以保存类型T的值，或仅保存null。Optional提供很多有用的方法，这样我们就不用显式进行空值检测<br> Optional 类的引入很好的解决空指针异常</p> 
</blockquote> 
<h3><a id="_199"></a>方法命名规则自定义查询</h3> 
<p>方法命名规则查询就是根据方法的名字，就能创建查询。需要按照Spring Data JPA提供的方法命名规则定义方法的名称，就可以完成查询工作。Spring Data JPA在程序执行的时候会根据方法名称进行解析，并自动生成查询语句进行查询。通过jpa的规则要求来实现自己命名查询。<br> 按照Spring Data JPA 定义的规则，查询方法以findBy开头，涉及条件查询时，条件的属性用条件关键字连接，要注意的是：条件属性首字母需大写。框架在进行方法名解析时，会先把方法名多余的前缀截取掉，然后对剩下部分进行解析。</p> 
<h4><a id="Repository_202"></a>编写Repository</h4> 
<p>根据一定的规则来编写方法命名。jpa会自动识别方法名称进行操作。</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>repository</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>domain<span class="token punctuation">.</span></span><span class="token class-name">User</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">JpaRepository</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>repository<span class="token punctuation">.</span></span><span class="token class-name">JpaSpecificationExecutor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Repository</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author: lyd
 * @description: UserRepository
 * @Date: 2022/10/2
 */</span>
<span class="token annotation punctuation">@Repository</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token class-name">JpaSpecificationExecutor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//根据nickname查询</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">findAllByNickName</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>通过测试可以看到如下结果：<br> <img src="https://images2.imgbox.com/20/54/k89BA3pA_o.png" alt="在这里插入图片描述"><br> 在编写repository的时候会有一些规则提示，也就是只有符合这些规则才能够被识别。这里只是展现了findxxx，实际上还有许多。<br> <img src="https://images2.imgbox.com/f4/ab/UyW0GtKU_o.png" alt="在这里插入图片描述"><br> 具体的关键字，使用方法和生产成SQL如下表所示<br> <img src="https://images2.imgbox.com/25/a5/yvysETsj_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="JPQLSQL_232"></a>使用JPQL的方式查询(注解式SQL)</h3> 
<p>通过Query注解可以实现更多灵活的条件查询等SQL·操作。@Query 注解的使用非常简单，只需在方法上面标注该注解，同时提供一个JPQL查询语句即可，并且，在这些SQL语句中都是使用实体来进行操作，并非数据库的表结构来操作。</p> 
<h4><a id="_234"></a>计数</h4> 
<p>通过Query可以写自己的SQL语句</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">"select count(u) from User u"</span><span class="token punctuation">)</span> <span class="token comment">// 这里使用的是实体，并不是数据库的表名和字段</span>
<span class="token class-name">Integer</span> <span class="token function">countUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>测试</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token class-name">CountUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Integer</span> integer <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">countUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>integer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>结果<br> <img src="https://images2.imgbox.com/bb/d2/FAfLjDWV_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_253"></a>参数传递</h4> 
<p>在通过注解写SQL的时候，也需要是携带参数的，而Query通过?占位符来获得传来的参数数据，通过参数的位置定位哪个参数。</p> 
<pre><code class="prism language-java"><span class="token comment">//修改数据 一定加上@Modifying 注解</span>
<span class="token annotation punctuation">@Transactional</span>
<span class="token annotation punctuation">@Modifying</span>
<span class="token annotation punctuation">@Query</span><span class="token punctuation">(</span><span class="token string">"update User set username=?1 where id=?2"</span><span class="token punctuation">)</span>
<span class="token keyword">int</span> <span class="token function">updateUsernameByIds</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>结果<br> <img src="https://images2.imgbox.com/e0/8b/YculdU9p_o.png" alt="在这里插入图片描述"><br> 也可以使用原生的SQL，只需要加上 nativeQuery = true 即可。</p> 
<h3><a id="_266"></a>实体关系对应</h3> 
<p>jpa中实体包括一对一，一对多，多对多，多对一关系，并且提供了相应的注解。接下来通过案例来实现关系。</p> 
<h4><a id="_268"></a>一对一</h4> 
<p>首先创建部门表，使用户指向一个部门。</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * @author: lyd
 * @description: 部门
 * @Date: 2022/10/2
 */</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"sys_dept"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Dept</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"dept_id"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在User实体中加字段，通过OneToOne注解完成。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@OneToOne</span><span class="token punctuation">(</span>fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span>LAZY<span class="token punctuation">,</span> cascade <span class="token operator">=</span> <span class="token class-name">CascadeType</span><span class="token punctuation">.</span>ALL<span class="token punctuation">)</span> <span class="token comment">//设置关联操作为ALL</span>
<span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"dept_id"</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Dept</span> dept<span class="token punctuation">;</span>
</code></pre> 
<p>这里的关联级别也是有多个,一般设置为all就行</p> 
<ul><li>ALL：所有操作都进行关联操作</li><li>PERSIST：插入操作时才进行关联操作</li><li>REMOVE：删除操作时才进行关联操作</li><li>MERGE：修改操作时才进行关联操作<br> 这样就可以编写测试</li></ul> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token class-name">OneToOneTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setNickName</span><span class="token punctuation">(</span><span class="token string">"爱国德德"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"lyd_code_studio"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"lyd_open"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Dept</span> dept <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dept<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"研发部"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setDept</span><span class="token punctuation">(</span>dept<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">User</span> save <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>save<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>通过测试可得数据库结果，<br> <img src="https://images2.imgbox.com/28/d0/bgixrJc7_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/8d/77/DGkat5k5_o.png" alt="在这里插入图片描述"><br> 通过关联，会在两个表中进行插入，删除也是会删除两个表中数据。</p> 
<h4><a id="_326"></a>一对多</h4> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@OneToMany</span><span class="token operator">:</span>
   	作用：建立一对多的关系映射
    属性：
    	targetEntityClass：指定多的多方的类的字节码
    	mappedBy：指定从表实体类中引用主表对象的名称。
    	cascade：指定要使用的级联操作
    	fetch：指定是否采用延迟加载
    	orphanRemoval：是否使用孤儿删除
</code></pre> 
<p>创建一个文章表来实现一对多关系，一个用户可以发表多个文章，一个文章只属于一个用户，因此在用户表中是一对多，在文章表就是多对一。<br> 通过@ManyToOne注解完成关系</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * @author: lyd
 * @description: 文章表
 * @Date: 2022/10/2
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"yun_article"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Article</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"article_id"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> length <span class="token operator">=</span> <span class="token number">50</span><span class="token punctuation">)</span> <span class="token comment">// 映射为字段，值不能为空</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Basic</span><span class="token punctuation">(</span>fetch <span class="token operator">=</span> <span class="token class-name">FetchType</span><span class="token punctuation">.</span>LAZY<span class="token punctuation">)</span> <span class="token comment">// 懒加载</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">// 映射为字段，值不能为空</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ManyToOne</span><span class="token punctuation">(</span>cascade<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token class-name">CascadeType</span><span class="token punctuation">.</span>MERGE<span class="token punctuation">,</span><span class="token class-name">CascadeType</span><span class="token punctuation">.</span>REFRESH<span class="token punctuation">}</span><span class="token punctuation">,</span>optional<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token comment">//可选属性optional=false,表示user不能为空。删除文章，不影响用户</span>
    <span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">"user_id"</span><span class="token punctuation">)</span><span class="token comment">//设置在article表中的关联字段(外键)</span>
    <span class="token keyword">private</span> <span class="token class-name">User</span> user<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在user实体这边就是一对多关系，并且通过注解完成。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@OneToMany</span><span class="token punctuation">(</span>mappedBy <span class="token operator">=</span> <span class="token string">"user"</span><span class="token punctuation">,</span>cascade<span class="token operator">=</span><span class="token class-name">CascadeType</span><span class="token punctuation">.</span>ALL<span class="token punctuation">,</span>fetch<span class="token operator">=</span><span class="token class-name">FetchType</span><span class="token punctuation">.</span>LAZY<span class="token punctuation">)</span>
<span class="token comment">//级联保存、更新、删除、刷新;延迟加载。当删除用户，会级联删除该用户的所有文章</span>
<span class="token comment">//拥有mappedBy注解的实体类为关系被维护端</span>
<span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> articles<span class="token punctuation">;</span>
</code></pre> 
<p>测试，需要创建ArticleRepository</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token class-name">OneToMany</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">User</span> user <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span><span class="token number">1L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Article</span> article1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    article1<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">"如何写好博客"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    article1<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span><span class="token string">"如何写好博客"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    article1<span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    articleRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>article1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Article</span> article2<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Article</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    article2<span class="token punctuation">.</span><span class="token function">setTitle</span><span class="token punctuation">(</span><span class="token string">"如何更进一步学习"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    article2<span class="token punctuation">.</span><span class="token function">setContent</span><span class="token punctuation">(</span><span class="token string">"不断地卷"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    article2<span class="token punctuation">.</span><span class="token function">setUser</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    articleRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>article2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>运行结果<br> <img src="https://images2.imgbox.com/50/4d/ZiAd7WLp_o.png" alt="在这里插入图片描述"><br> 数据库中<br> <img src="https://images2.imgbox.com/27/41/u6qgb4y9_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_403"></a>多对多</h4> 
<p>JPA中使用@ManyToMany来注解多对多的关系，由一个关联表来维护。这个关联表的表名默认是：主表名+下划线+从表名。(主表是指关系维护端对应的表,从表指关系被维护端对应的表)。这个关联表只有两个外键字段，分别指向主表ID和从表ID。字段的名称默认为：主表名+下划线+主表中的主键列名，从表名+下划线+从表中的主键列名。通过@JoinTable来实现中间表。<br> 创建角色表</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence<span class="token punctuation">.</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">Serializable</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Set</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @author: lyd
 * @description: 角色表
 * @Date: 2022/10/2
 */</span>
<span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token annotation punctuation">@Table</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"sys_role"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Role</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"role_id"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@ManyToMany</span><span class="token punctuation">(</span>mappedBy <span class="token operator">=</span> <span class="token string">"roles"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> users<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"level"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Integer</span> level <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> description<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在用户表中</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@ManyToMany</span>
<span class="token annotation punctuation">@JoinTable</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"sys_users_roles"</span><span class="token punctuation">,</span>
        joinColumns <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"user_id"</span><span class="token punctuation">,</span>referencedColumnName <span class="token operator">=</span> <span class="token string">"user_id"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        inverseJoinColumns <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token annotation punctuation">@JoinColumn</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">"role_id"</span><span class="token punctuation">,</span>referencedColumnName <span class="token operator">=</span> <span class="token string">"role_id"</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">&gt;</span></span> roles<span class="token punctuation">;</span>
</code></pre> 
<p>测试</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token class-name">ManyToMany</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">Role</span> role <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Role</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    role<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"USER"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    role<span class="token punctuation">.</span><span class="token function">setLevel</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    role<span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">"管理员"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    roleRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Role</span><span class="token punctuation">&gt;</span></span> roles <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    roles<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>role<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token string">"lyd_code"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setNickName</span><span class="token punctuation">(</span><span class="token string">"怒放德德"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span><span class="token string">"lyd_code"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span><span class="token function">setRoles</span><span class="token punctuation">(</span>roles<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">User</span> save <span class="token operator">=</span> userRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>save<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>在数据库中的中间表就能够看到如下数据。<br> <img src="https://images2.imgbox.com/7d/94/wcNbEpeI_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_477"></a>文章推荐</h3> 
<ul><li><a href="https://www.ydlclass.com/doc21xnv/frame/jpa/jpa.html#%E7%AC%AC%E4%B8%80%E7%AB%A0-orm%E6%A6%82%E8%BF%B0-%E4%BA%86%E8%A7%A3" rel="nofollow">元动力文档合集 - SPRING-DATA-JPA</a></li><li><font color="red">CSDN</font>：<a href="https://blog.csdn.net/cmx1060220219/article/details/106259423">https://blog.csdn.net/cmx1060220219/article/details/106259423</a></li><li><font color="red">CSDN</font>：<a href="https://blog.csdn.net/localhost01/article/details/83422893">https://blog.csdn.net/localhost01/article/details/83422893</a></li></ul> 
<p>👍创作不易，如有错误请指正，感谢观看！记得点赞哦！👍</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5b9080c5b92e5234e140e7cb16916b3d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">yolov5——问题记录</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f992df156fa9ddb3f19b44f040e73129/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">华为----VRF隔离（生产网和办公网的隔离）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>