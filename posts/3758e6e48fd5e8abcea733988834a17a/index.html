<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>java对接企业微信 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="java对接企业微信" />
<meta property="og:description" content="java对接企业微信 一、注册企业微信 1.1 简介 企业微信与微信具有一样的体验，通过企业内部与外部客户的管理，构建出社群生态。企业微信提供丰富的api进行调用获取数据管理，也提供各种回调事件。
1.2 注册 登录官网，一键注册即可。链接: 企业微信
1.2 填写主要信息 企业微信中填写相关企业信息和负责人，然后创建。进入即可添加所需要的微信人员。
之后进行通讯录同步（此步骤为最重要一点），同步过后通讯录的人员根据调用接口接收消息。
1.3 创建应用 创建自己需要的应用，并根据提示创建应用（也可以不创建，用以前有的应用作为发送消息的主体也可以）
二、企业微信基础信息 创建完企业微信和自己所需要的应用后，需要记住几处重要的参数，方便后续调用api使用。
简单介绍几个参数：（需存入数据库）
1.企业id：当前企业微信的固定id；
2.agentid：当前自建应用id；
3.secret：应用秘钥，调用验证秘钥；
注：企业应用的可见范围需添加微信中的人员表。为后续调用查询、发送人员作限定选择。
三、消息接收url机制-回调 在java集成企业微信的同时，需要一个回调服务。现可以实现：
自定义丰富的服务行为、可以及时获取状态变化。
通过企业微信服务器向后端服务器发送各种需要消息。
这里只讲配置建立消息接收url机制。
附录上述两张图，其中包含设置可信ip（开发服务器的ip，为了服务器调用api）、配置接收服务器（通过回调机制&#43;配置，验证url是否能接收到消息，并返回企业微信所需要的信息来校验）。加密解密见附录五。
回调配置
能通过发送来的密文（附录5中具体解密），返回给企业微信端需要的密文。即可通过校验，然后就可以填写认证ip进行开发调用接口。
简单介绍几个参数：（需存入数据库）
1.url：接收企业微信消息的接口
2.token：计算签名（可在配置中随机生成）
3.encoding_aes_key：加密key（加解密使用）
四、java对接企业微信（自建应用） 在上几个步骤中，我们已有需求的5个参数配置。根据这5个参数就可以进行与java对接。
4.1 对接前提（获取access_token） token是调用接口的基础。根据之前的保存参数即可获取。以下展示为项目所需接口调用，其他接口使用token基本都能调用。
4.2 手机号获取userid 4.3 发送应用消息 本文只展示文本方面，其他发送信息方面可参照api接口。api接口
五、附加-校验加密解密方式 5.1 方案说明 5.2 代码实例 /** * @Author sprem至尊 * @Date 2022/10/21 16:43 * @Version 1.0 */ package com.example.demo.controller; import com.example.demo.aes.WXBizJsonMsgCrypt; import com.example.demo.cache.TokenCache; import com." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/3758e6e48fd5e8abcea733988834a17a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-09T14:56:24+08:00" />
<meta property="article:modified_time" content="2023-03-09T14:56:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java对接企业微信</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="java_0"></a>java对接企业微信</h3> 
<h4><a id="_1"></a>一、注册企业微信</h4> 
<h5><a id="11__2"></a>1.1 简介</h5> 
<p>  企业微信与微信具有一样的体验，通过企业内部与外部客户的管理，构建出社群生态。企业微信提供丰富的api进行调用获取数据管理，也提供各种回调事件。</p> 
<h5><a id="12__4"></a>1.2 注册</h5> 
<p>  登录官网，一键注册即可。链接: <a href="https://work.weixin.qq.com" rel="nofollow">企业微信</a></p> 
<h5><a id="12__6"></a>1.2 填写主要信息</h5> 
<p>  企业微信中填写相关企业信息和负责人，然后创建。进入即可添加所需要的微信人员。<br> <img src="https://images2.imgbox.com/da/f1/8R9aevH5_o.png" alt="请添加图片描述"></p> 
<p>  <mark>之后进行通讯录同步（此步骤为最重要一点），同步过后通讯录的人员根据调用接口接收消息。</mark><br> <img src="https://images2.imgbox.com/d1/58/VuY6RkU1_o.png" alt="请添加图片描述"></p> 
<h5><a id="13__12"></a>1.3 创建应用</h5> 
<p>  创建自己需要的应用，并根据提示创建应用（也可以不创建，用以前有的应用作为发送消息的主体也可以）<br> <img src="https://images2.imgbox.com/0b/53/lbvsVuDc_o.png" alt="请添加图片描述"></p> 
<h4><a id="_16"></a>二、企业微信基础信息</h4> 
<p>  创建完企业微信和自己所需要的应用后，需要记住几处重要的参数，方便后续调用api使用。<br> <img src="https://images2.imgbox.com/33/06/RjyOLIGX_o.png" alt="请添加图片描述"><br> <img src="https://images2.imgbox.com/04/3a/DcRF1ZTJ_o.png" alt="请添加图片描述"></p> 
<p>  <mark>简单介绍几个参数：（需存入数据库）</mark><br> 1.企业id：当前企业微信的固定id；<br> 2.agentid：当前自建应用id；<br> 3.secret：应用秘钥，调用验证秘钥；</p> 
<p>注：企业应用的可见范围需添加微信中的人员表。为后续调用查询、发送人员作限定选择。</p> 
<h4><a id="url_28"></a>三、消息接收url机制-回调</h4> 
<p>  在java集成企业微信的同时，需要一个回调服务。现可以实现：<br> 自定义丰富的服务行为、可以及时获取状态变化。<br> <img src="https://images2.imgbox.com/e7/3b/DHD8SRl9_o.png" alt="在这里插入图片描述"><br>   通过企业微信服务器向后端服务器发送各种需要消息。<br> 这里只讲配置建立消息接收url机制。<br> <img src="https://images2.imgbox.com/87/34/qIGnmXc6_o.png" alt="请添加图片描述"><br> <img src="https://images2.imgbox.com/fb/2d/L3QLXjgw_o.png" alt="请添加图片描述"><br>   附录上述两张图，其中包含设置可信ip（开发服务器的ip，为了服务器调用api）、配置接收服务器（通过回调机制+配置，验证url是否能接收到消息，并返回企业微信所需要的信息来校验）。<mark>加密解密见附录五。</mark><br> <a href="https://developer.work.weixin.qq.com/document/path/90930" rel="nofollow">回调配置</a><br> <img src="https://images2.imgbox.com/fb/ea/IHzK8aN9_o.png" alt="请添加图片描述"><br> 能通过发送来的密文（附录5中具体解密），返回给企业微信端需要的密文。即可通过校验，然后就可以填写认证ip进行开发调用接口。</p> 
<p>  <mark>简单介绍几个参数：（需存入数据库）</mark><br> 1.url：接收企业微信消息的接口<br> 2.token：计算签名（可在配置中随机生成）<br> 3.encoding_aes_key：加密key（加解密使用）</p> 
<h4><a id="java_46"></a>四、java对接企业微信（自建应用）</h4> 
<p>  在上几个步骤中，我们已有需求的5个参数配置。根据这5个参数就可以进行与java对接。<br> <img src="https://images2.imgbox.com/d5/ec/ykId1YMw_o.png" alt="请添加图片描述"></p> 
<h5><a id="41_access_token_50"></a>4.1 对接前提（获取access_token）</h5> 
<p><img src="https://images2.imgbox.com/54/27/3r5NSQLI_o.png" alt="在这里插入图片描述"><br> token是调用接口的基础。根据之前的保存参数即可获取。以下展示为项目所需接口调用，其他接口使用token基本都能调用。</p> 
<h5><a id="42_userid_53"></a>4.2 手机号获取userid</h5> 
<p><img src="https://images2.imgbox.com/23/e6/ACCEa39p_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="43__55"></a>4.3 发送应用消息</h5> 
<p><img src="https://images2.imgbox.com/38/7c/wC7UNkir_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/cb/fa/NgSOWZs2_o.png" alt="在这里插入图片描述"><br> 本文只展示文本方面，其他发送信息方面可参照api接口。<a href="https://developer.work.weixin.qq.com/document/path/90236" rel="nofollow">api接口</a></p> 
<h4><a id="_60"></a>五、附加-校验加密解密方式</h4> 
<h5><a id="51__61"></a>5.1 方案说明</h5> 
<p><img src="https://images2.imgbox.com/30/f5/jFCeWKLF_o.png" alt="请添加图片描述"></p> 
<p><img src="https://images2.imgbox.com/8e/d3/05vgXNBC_o.png" alt="请添加图片描述"><br> <img src="https://images2.imgbox.com/91/6d/bpeCVgIn_o.png" alt="请添加图片描述"></p> 
<h5><a id="52__67"></a>5.2 代码实例</h5> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @Author sprem至尊
 * @Date 2022/10/21 16:43
 * @Version 1.0
 */</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>controller</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>aes<span class="token punctuation">.</span></span><span class="token class-name">WXBizJsonMsgCrypt</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>cache<span class="token punctuation">.</span></span><span class="token class-name">TokenCache</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity<span class="token punctuation">.</span></span><span class="token class-name">TestEntity</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestController</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">TokenCache</span> tokenCache<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">home</span><span class="token punctuation">(</span><span class="token class-name">TestEntity</span> testEntity<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//postman的参数放在form-data中 不然特殊符号会变空格</span>
        <span class="token class-name">String</span> sToken <span class="token operator">=</span> <span class="token string">"axBoJ9yw3NeLPffBNUTQlfXiP612Xdpw"</span><span class="token punctuation">;</span><span class="token comment">//SSrYt12q2KL  QDG6eK</span>
        <span class="token class-name">String</span> sCorpID <span class="token operator">=</span> <span class="token string">"ww1ca8f5fe0f582941e9"</span><span class="token punctuation">;</span><span class="token comment">//""wwca8f511fe0f58941e9"; wx5823bf96d3bd561c7</span>
        <span class="token class-name">String</span> sEncodingAESKey <span class="token operator">=</span> <span class="token string">"Sb8eDJndNDPjIyzqFzMI2sKtOfgoCYMrIWjqu2m1ql3Vb"</span><span class="token punctuation">;</span><span class="token comment">// W5UBw9XoqW61HPfL7TUsI4qC2myJrw3MQ9bDrbDsWWQ2</span>
        <span class="token comment">//jWmYm7qr5nMoAUwZRjGtBxmz3K4A1tkAj3ykkR6q2B2C</span>
        <span class="token class-name">String</span> sVerifyMsgSig <span class="token operator">=</span> testEntity<span class="token punctuation">.</span><span class="token function">getMsg_signature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> sVerifyTimeStamp <span class="token operator">=</span> testEntity<span class="token punctuation">.</span><span class="token function">getTimestamp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> sVerifyNonce <span class="token operator">=</span> testEntity<span class="token punctuation">.</span><span class="token function">getNonce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> sVerifyEchoStr <span class="token operator">=</span> testEntity<span class="token punctuation">.</span><span class="token function">getEchostr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> sEchoStr <span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">;</span><span class="token comment">//明文</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//获取其中 aesKey</span>
            <span class="token class-name">WXBizJsonMsgCrypt</span> wxcpt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WXBizJsonMsgCrypt</span><span class="token punctuation">(</span>sToken<span class="token punctuation">,</span> sEncodingAESKey<span class="token punctuation">,</span> sCorpID<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//获取明文</span>
            sEchoStr <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">wxcpt<span class="token punctuation">.</span></span>VerifyURL</span><span class="token punctuation">(</span>sVerifyMsgSig<span class="token punctuation">,</span>sVerifyTimeStamp<span class="token punctuation">,</span>sVerifyNonce<span class="token punctuation">,</span>
                    sVerifyEchoStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"verifyurl echostr: "</span> <span class="token operator">+</span> sEchoStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> sEchoStr<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/testCache"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">testCache</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> <span class="token class-name">TokenCache</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">"s1111"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>s<span class="token operator">==</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"时间过期"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">TokenCache</span><span class="token punctuation">.</span><span class="token function">setKey</span><span class="token punctuation">(</span><span class="token string">"s12111"</span><span class="token punctuation">,</span><span class="token string">"1243123123"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            s <span class="token operator">=</span><span class="token class-name">TokenCache</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token string">"s12111"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"sss"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @Author sprem至尊
 * @Date 2022/10/21 17:00
 * @Version 1.0
 */</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>entity</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Data</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestEntity</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> msg_signature<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> timestamp<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> nonce<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> echostr<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>aes</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SuppressWarnings</span><span class="token punctuation">(</span><span class="token string">"serial"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AesException</span> <span class="token keyword">extends</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> OK <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token class-name">ValidateSignatureError</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">40001</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token class-name">ParseJsonError</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">40002</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token class-name">ComputeSignatureError</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">40003</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token class-name">IllegalAesKey</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">40004</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token class-name">ValidateCorpidError</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">40005</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token class-name">EncryptAESError</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">40006</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token class-name">DecryptAESError</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">40007</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token class-name">IllegalBuffer</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">40008</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token class-name">EncodeBase64Error</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">40009</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token class-name">DecodeBase64Error</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">40010</span><span class="token punctuation">;</span>
	<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token class-name">GenReturnJsonError</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">40011</span><span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token keyword">int</span> code<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token keyword">int</span> code<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">switch</span> <span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">case</span> <span class="token class-name">ValidateSignatureError</span><span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token string">"签名验证错误"</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token class-name">ParseJsonError</span><span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token string">"json解析失败"</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token class-name">ComputeSignatureError</span><span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token string">"sha加密生成签名失败"</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token class-name">IllegalAesKey</span><span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token string">"SymmetricKey非法"</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token class-name">ValidateCorpidError</span><span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token string">"corpid校验失败"</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token class-name">EncryptAESError</span><span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token string">"aes加密失败"</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token class-name">DecryptAESError</span><span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token string">"aes解密失败"</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token class-name">IllegalBuffer</span><span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token string">"解密后得到的buffer非法"</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token class-name">EncodeBase64Error</span><span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token string">"base64加密错误"</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token class-name">DecodeBase64Error</span><span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token string">"base64解密错误"</span><span class="token punctuation">;</span>
		<span class="token keyword">case</span> <span class="token class-name">GenReturnJsonError</span><span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token string">"josn生成失败"</span><span class="token punctuation">;</span>
		<span class="token keyword">default</span><span class="token operator">:</span>
			<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span> <span class="token comment">// cannot be</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> code<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token class-name">AesException</span><span class="token punctuation">(</span><span class="token keyword">int</span> code<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token function">getMessage</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>code <span class="token operator">=</span> code<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>aes</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">ByteGroup</span> <span class="token punctuation">{<!-- --></span>
	<span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Byte</span><span class="token punctuation">&gt;</span></span> byteContainer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Byte</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">public</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>byteContainer<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> byteContainer<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			bytes<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> byteContainer<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> bytes<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token class-name">ByteGroup</span> <span class="token function">addBytes</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">byte</span> b <span class="token operator">:</span> bytes<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			byteContainer<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> byteContainer<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 对企业微信发送给企业后台的消息加解密示例代码.
 * 
 * @copyright Copyright (c) 1998-2020 Tencent Inc.
 */</span>

<span class="token comment">// ------------------------------------------------------------------------</span>

<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>aes</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 针对 org.json.JSONObject,
 * 要编译打包架包json
 * 官方源码下载地址 : https://github.com/stleary/JSON-java, jar包下载地址 : https://mvnrepository.com/artifact/org.json/json
 */</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>json<span class="token punctuation">.</span></span><span class="token class-name">JSONObject</span><span class="token punctuation">;</span>


<span class="token comment">/**
 * JsonParse class
 *
 * 提供提取消息格式中的密文及生成回复消息格式的接口.
 */</span>
<span class="token keyword">class</span> <span class="token class-name">JsonParse</span> <span class="token punctuation">{<!-- --></span>

	<span class="token comment">/**
	 * 提取出 JSON 包中的加密消息
	 * @param jsontext 待提取的json字符串
	 * @return 提取出的加密消息字符串
	 * @throws AesException 
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">extract</span><span class="token punctuation">(</span><span class="token class-name">String</span> jsontext<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AesException</span>     <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>

			<span class="token class-name">JSONObject</span> json <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSONObject</span><span class="token punctuation">(</span>jsontext<span class="token punctuation">)</span><span class="token punctuation">;</span>    
        	<span class="token class-name">String</span> encrypt_msg <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"encrypt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">String</span> tousername  <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"tousername"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">String</span> agentid     <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"agentid"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> tousername<span class="token punctuation">;</span>
			result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> encrypt_msg<span class="token punctuation">;</span>
			result<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> agentid<span class="token punctuation">;</span>
			<span class="token keyword">return</span> result<span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AesException</span><span class="token punctuation">(</span><span class="token class-name">AesException<span class="token punctuation">.</span>ParseJsonError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 生成json消息
	 * @param encrypt 加密后的消息密文
	 * @param signature 安全签名
	 * @param timestamp 时间戳
	 * @param nonce 随机字符串
	 * @return 生成的json字符串
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token class-name">String</span> encrypt<span class="token punctuation">,</span> <span class="token class-name">String</span> signature<span class="token punctuation">,</span> <span class="token class-name">String</span> timestamp<span class="token punctuation">,</span> <span class="token class-name">String</span> nonce<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

		<span class="token class-name">String</span> format <span class="token operator">=</span> <span class="token string">"{\"encrypt\":\"%1$s\",\"msgsignature\":\"%2$s\",\"timestamp\":\"%3$s\",\"nonce\":\"%4$s\"}"</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span> encrypt<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> nonce<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 对企业微信发送给企业后台的消息加解密示例代码.
 * 
 * @copyright Copyright (c) 1998-2014 Tencent Inc.
 */</span>

<span class="token comment">// ------------------------------------------------------------------------</span>

<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>aes</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">Charset</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 提供基于PKCS7算法的加解密接口.
 */</span>
<span class="token keyword">class</span> <span class="token class-name">PKCS7Encoder</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">static</span> <span class="token class-name">Charset</span> CHARSET <span class="token operator">=</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">static</span> <span class="token keyword">int</span> BLOCK_SIZE <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">;</span>

	<span class="token comment">/**
	 * 获得对明文进行补位填充的字节.
	 * 
	 * @param count 需要进行填充补位操作的明文字节个数
	 * @return 补齐用的字节数组
	 */</span>
	<span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 计算需要填充的位数</span>
		<span class="token keyword">int</span> amountToPad <span class="token operator">=</span> BLOCK_SIZE <span class="token operator">-</span> <span class="token punctuation">(</span>count <span class="token operator">%</span> BLOCK_SIZE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>amountToPad <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			amountToPad <span class="token operator">=</span> BLOCK_SIZE<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 获得补位所用的字符</span>
		<span class="token keyword">char</span> padChr <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span>amountToPad<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">String</span> tmp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> amountToPad<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			tmp <span class="token operator">+=</span> padChr<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> tmp<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span>CHARSET<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 删除解密后明文的补位字符
	 * 
	 * @param decrypted 解密后的明文
	 * @return 删除补位字符后的明文
	 */</span>
	<span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> decrypted<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">int</span> pad <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> decrypted<span class="token punctuation">[</span>decrypted<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pad <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">||</span> pad <span class="token operator">&gt;</span> <span class="token number">32</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			pad <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOfRange</span><span class="token punctuation">(</span>decrypted<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> decrypted<span class="token punctuation">.</span>length <span class="token operator">-</span> pad<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 将数字转化成ASCII码对应的字符，用于对明文进行补码
	 * 
	 * @param a 需要转化的数字
	 * @return 转化得到的字符
	 */</span>
	<span class="token keyword">static</span> <span class="token keyword">char</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token keyword">int</span> a<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">byte</span> target <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>a <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> target<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 对企业微信发送给企业后台的消息加解密示例代码.
 * 
 * @copyright Copyright (c) 1998-2014 Tencent Inc.
 */</span>

<span class="token comment">// ------------------------------------------------------------------------</span>

<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>aes</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">MessageDigest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * SHA1 class
 *
 * 计算消息签名接口.
 */</span>
<span class="token keyword">class</span> SHA1 <span class="token punctuation">{<!-- --></span>

	<span class="token comment">/**
	 * 用SHA1算法生成安全签名
	 * @param token 票据
	 * @param timestamp 时间戳
	 * @param nonce 随机字符串
	 * @param encrypt 密文
	 * @return 安全签名
	 * @throws AesException 
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getSHA1</span><span class="token punctuation">(</span><span class="token class-name">String</span> token<span class="token punctuation">,</span> <span class="token class-name">String</span> timestamp<span class="token punctuation">,</span> <span class="token class-name">String</span> nonce<span class="token punctuation">,</span> <span class="token class-name">String</span> encrypt<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AesException</span>
			  <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> array <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span> token<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> encrypt <span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token class-name">StringBuffer</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 字符串排序</span>
			<span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>array<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>array<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token class-name">String</span> str <span class="token operator">=</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// SHA1签名生成</span>
			<span class="token class-name">MessageDigest</span> md <span class="token operator">=</span> <span class="token class-name">MessageDigest</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"SHA-1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			md<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> digest <span class="token operator">=</span> md<span class="token punctuation">.</span><span class="token function">digest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token class-name">StringBuffer</span> hexstr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">String</span> shaHex <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> digest<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				shaHex <span class="token operator">=</span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token function">toHexString</span><span class="token punctuation">(</span>digest<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>shaHex<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					hexstr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				hexstr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>shaHex<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">return</span> hexstr<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AesException</span><span class="token punctuation">(</span><span class="token class-name">AesException<span class="token punctuation">.</span>ComputeSignatureError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 对企业微信发送给企业后台的消息加解密示例代码.
 * 
 * @copyright Copyright (c) 1998-2014 Tencent Inc.
 */</span>

<span class="token comment">// ------------------------------------------------------------------------</span>

<span class="token comment">/**
 * 针对org.apache.commons.codec.binary.Base64，
 * 需要导入架包commons-codec-1.9（或commons-codec-1.8等其他版本）
 * 官方下载地址：http://commons.apache.org/proper/commons-codec/download_codec.cgi
 */</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>aes</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>codec<span class="token punctuation">.</span>binary<span class="token punctuation">.</span></span><span class="token class-name">Base64</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span></span><span class="token class-name">Cipher</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>spec<span class="token punctuation">.</span></span><span class="token class-name">IvParameterSpec</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>crypto<span class="token punctuation">.</span>spec<span class="token punctuation">.</span></span><span class="token class-name">SecretKeySpec</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>charset<span class="token punctuation">.</span></span><span class="token class-name">Charset</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Arrays</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Random</span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 提供接收和推送给企业微信消息的加解密接口(UTF8编码的字符串).
 * &lt;ol&gt;
 * 	&lt;li&gt;第三方回复加密消息给企业微信&lt;/li&gt;
 * 	&lt;li&gt;第三方收到企业微信发送的消息，验证消息的安全性，并对消息进行解密。&lt;/li&gt;
 * &lt;/ol&gt;
 * 说明：异常java.security.InvalidKeyException:illegal Key Size的解决方案
 * &lt;ol&gt;
 * 	&lt;li&gt;在官方网站下载JCE无限制权限策略文件（JDK7的下载地址：
 *      http://www.oracle.com/technetwork/java/javase/downloads/jce-7-download-432124.html&lt;/li&gt;
 * 	&lt;li&gt;下载后解压，可以看到local_policy.jar和US_export_policy.jar以及readme.txt&lt;/li&gt;
 * 	&lt;li&gt;如果安装了JRE，将两个jar文件放到%JRE_HOME%\lib\security目录下覆盖原来的文件&lt;/li&gt;
 * 	&lt;li&gt;如果安装了JDK，将两个jar文件放到%JDK_HOME%\jre\lib\security目录下覆盖原来文件&lt;/li&gt;
 * &lt;/ol&gt;
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WXBizJsonMsgCrypt</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">static</span> <span class="token class-name">Charset</span> CHARSET <span class="token operator">=</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token class-name">Base64</span> base64 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Base64</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> aesKey<span class="token punctuation">;</span>
	<span class="token class-name">String</span> token<span class="token punctuation">;</span>
	<span class="token class-name">String</span> receiveid<span class="token punctuation">;</span>

	<span class="token comment">/**
	 * 构造函数
	 * @param token 企业微信后台，开发者设置的token
	 * @param encodingAesKey 企业微信后台，开发者设置的EncodingAESKey
	 * @param receiveid, 不同场景含义不同，详见文档
	 * 
	 * @throws AesException 执行失败，请查看该异常的错误码和具体的错误信息
	 */</span>
	<span class="token keyword">public</span> <span class="token class-name">WXBizJsonMsgCrypt</span><span class="token punctuation">(</span><span class="token class-name">String</span> token<span class="token punctuation">,</span> <span class="token class-name">String</span> encodingAesKey<span class="token punctuation">,</span> <span class="token class-name">String</span> receiveid<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AesException</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>encodingAesKey<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">43</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AesException</span><span class="token punctuation">(</span><span class="token class-name">AesException<span class="token punctuation">.</span>IllegalAesKey</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">this</span><span class="token punctuation">.</span>token <span class="token operator">=</span> token<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>receiveid <span class="token operator">=</span> receiveid<span class="token punctuation">;</span>
		aesKey <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">decodeBase64</span><span class="token punctuation">(</span>encodingAesKey <span class="token operator">+</span> <span class="token string">"="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 生成4个字节的网络字节序</span>
	<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getNetworkBytesOrder</span><span class="token punctuation">(</span><span class="token keyword">int</span> sourceNumber<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> orderBytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
		orderBytes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>sourceNumber <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		orderBytes<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>sourceNumber <span class="token operator">&gt;&gt;</span> <span class="token number">8</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		orderBytes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>sourceNumber <span class="token operator">&gt;&gt;</span> <span class="token number">16</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		orderBytes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>sourceNumber <span class="token operator">&gt;&gt;</span> <span class="token number">24</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> orderBytes<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 还原4个字节的网络字节序</span>
	<span class="token keyword">int</span> <span class="token function">recoverNetworkBytesOrder</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> orderBytes<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">int</span> sourceNumber <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			sourceNumber <span class="token operator">&lt;&lt;=</span> <span class="token number">8</span><span class="token punctuation">;</span>
			sourceNumber <span class="token operator">|=</span> orderBytes<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&amp;</span> <span class="token number">0xff</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> sourceNumber<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// 随机生成16位字符串</span>
	<span class="token class-name">String</span> <span class="token function">getRandomStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">String</span> base <span class="token operator">=</span> <span class="token string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"</span><span class="token punctuation">;</span>
		<span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">StringBuffer</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuffer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">16</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">int</span> number <span class="token operator">=</span> random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>base<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>base<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 对明文进行加密.
	 * 
	 * @param text 需要加密的明文
	 * @return 加密后base64编码的字符串
	 * @throws AesException aes加密失败
	 */</span>
	<span class="token class-name">String</span> <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token class-name">String</span> randomStr<span class="token punctuation">,</span> <span class="token class-name">String</span> text<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AesException</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">ByteGroup</span> byteCollector <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> randomStrBytes <span class="token operator">=</span> randomStr<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span>CHARSET<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> textBytes <span class="token operator">=</span> text<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span>CHARSET<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> networkBytesOrder <span class="token operator">=</span> <span class="token function">getNetworkBytesOrder</span><span class="token punctuation">(</span>textBytes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> receiveidBytes <span class="token operator">=</span> receiveid<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span>CHARSET<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// randomStr + networkBytesOrder + text + receiveid</span>
		byteCollector<span class="token punctuation">.</span><span class="token function">addBytes</span><span class="token punctuation">(</span>randomStrBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
		byteCollector<span class="token punctuation">.</span><span class="token function">addBytes</span><span class="token punctuation">(</span>networkBytesOrder<span class="token punctuation">)</span><span class="token punctuation">;</span>
		byteCollector<span class="token punctuation">.</span><span class="token function">addBytes</span><span class="token punctuation">(</span>textBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
		byteCollector<span class="token punctuation">.</span><span class="token function">addBytes</span><span class="token punctuation">(</span>receiveidBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// ... + pad: 使用自定义的填充方式对明文进行补位填充</span>
		<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> padBytes <span class="token operator">=</span> <span class="token class-name">PKCS7Encoder</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>byteCollector<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		byteCollector<span class="token punctuation">.</span><span class="token function">addBytes</span><span class="token punctuation">(</span>padBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// 获得最终的字节流, 未加密</span>
		<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> unencrypted <span class="token operator">=</span> byteCollector<span class="token punctuation">.</span><span class="token function">toBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 设置加密模式为AES的CBC模式</span>
			<span class="token class-name">Cipher</span> cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"AES/CBC/NoPadding"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">SecretKeySpec</span> keySpec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecretKeySpec</span><span class="token punctuation">(</span>aesKey<span class="token punctuation">,</span> <span class="token string">"AES"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">IvParameterSpec</span> iv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IvParameterSpec</span><span class="token punctuation">(</span>aesKey<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span>ENCRYPT_MODE<span class="token punctuation">,</span> keySpec<span class="token punctuation">,</span> iv<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// 加密</span>
			<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> encrypted <span class="token operator">=</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>unencrypted<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// 使用BASE64对加密后的字符串进行编码</span>
			<span class="token class-name">String</span> base64Encrypted <span class="token operator">=</span> base64<span class="token punctuation">.</span><span class="token function">encodeToString</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">return</span> base64Encrypted<span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AesException</span><span class="token punctuation">(</span><span class="token class-name">AesException<span class="token punctuation">.</span>EncryptAESError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 对密文进行解密.
	 * 
	 * @param text 需要解密的密文
	 * @return 解密得到的明文
	 * @throws AesException aes解密失败
	 */</span>
	<span class="token class-name">String</span> <span class="token function">decrypt</span><span class="token punctuation">(</span><span class="token class-name">String</span> text<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AesException</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> original<span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 设置解密模式为AES的CBC模式</span>
			<span class="token class-name">Cipher</span> cipher <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"AES/CBC/NoPadding"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">SecretKeySpec</span> key_spec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SecretKeySpec</span><span class="token punctuation">(</span>aesKey<span class="token punctuation">,</span> <span class="token string">"AES"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">IvParameterSpec</span> iv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IvParameterSpec</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOfRange</span><span class="token punctuation">(</span>aesKey<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			cipher<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">Cipher</span><span class="token punctuation">.</span>DECRYPT_MODE<span class="token punctuation">,</span> key_spec<span class="token punctuation">,</span> iv<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// 使用BASE64对密文进行解码</span>
			<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> encrypted <span class="token operator">=</span> <span class="token class-name">Base64</span><span class="token punctuation">.</span><span class="token function">decodeBase64</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 解密</span>
			original <span class="token operator">=</span> cipher<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span>encrypted<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AesException</span><span class="token punctuation">(</span><span class="token class-name">AesException<span class="token punctuation">.</span>DecryptAESError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token class-name">String</span> jsonContent<span class="token punctuation">,</span> from_receiveid<span class="token punctuation">;</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 去除补位字符</span>
			<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token class-name">PKCS7Encoder</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>original<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 分离16位随机字符串,网络字节序和receiveid</span>
			<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> networkOrder <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOfRange</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">int</span> jsonLength <span class="token operator">=</span> <span class="token function">recoverNetworkBytesOrder</span><span class="token punctuation">(</span>networkOrder<span class="token punctuation">)</span><span class="token punctuation">;</span>
			jsonContent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOfRange</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span> <span class="token operator">+</span> jsonLength<span class="token punctuation">)</span><span class="token punctuation">,</span> CHARSET<span class="token punctuation">)</span><span class="token punctuation">;</span>
			from_receiveid <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">copyOfRange</span><span class="token punctuation">(</span>bytes<span class="token punctuation">,</span> <span class="token number">20</span> <span class="token operator">+</span> jsonLength<span class="token punctuation">,</span> bytes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">,</span>
					CHARSET<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AesException</span><span class="token punctuation">(</span><span class="token class-name">AesException<span class="token punctuation">.</span>IllegalBuffer</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// receiveid不相同的情况</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>from_receiveid<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>receiveid<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AesException</span><span class="token punctuation">(</span><span class="token class-name">AesException<span class="token punctuation">.</span>ValidateCorpidError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">return</span> jsonContent<span class="token punctuation">;</span>

	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 将企业微信回复用户的消息加密打包.
	 * &lt;ol&gt;
	 * 	&lt;li&gt;对要发送的消息进行AES-CBC加密&lt;/li&gt;
	 * 	&lt;li&gt;生成安全签名&lt;/li&gt;
	 * 	&lt;li&gt;将消息密文和安全签名打包成json格式&lt;/li&gt;
	 * &lt;/ol&gt;
	 * 
	 * @param replyMsg 企业微信待回复用户的消息，json格式的字符串
	 * @param timeStamp 时间戳，可以自己生成，也可以用URL参数的timestamp
	 * @param nonce 随机串，可以自己生成，也可以用URL参数的nonce
	 * 
	 * @return 加密后的可以直接回复用户的密文，包括msg_signature, timestamp, nonce, encrypt的json格式的字符串
	 * @throws AesException 执行失败，请查看该异常的错误码和具体的错误信息
	 */</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token class-name">EncryptMsg</span><span class="token punctuation">(</span><span class="token class-name">String</span> replyMsg<span class="token punctuation">,</span> <span class="token class-name">String</span> timeStamp<span class="token punctuation">,</span> <span class="token class-name">String</span> nonce<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">AesException</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 加密</span>
		<span class="token class-name">String</span> encrypt <span class="token operator">=</span> <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token function">getRandomStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> replyMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 生成安全签名</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>timeStamp <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			timeStamp <span class="token operator">=</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token class-name">String</span> signature <span class="token operator">=</span> SHA1<span class="token punctuation">.</span><span class="token function">getSHA1</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> timeStamp<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> encrypt<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// System.out.println("发送给平台的签名是: " + signature[1].toString());</span>
		<span class="token comment">// 生成发送的json</span>
		<span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token class-name">JsonParse</span><span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span>encrypt<span class="token punctuation">,</span> signature<span class="token punctuation">,</span> timeStamp<span class="token punctuation">,</span> nonce<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> result<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 检验消息的真实性，并且获取解密后的明文.
	 * &lt;ol&gt;
	 * 	&lt;li&gt;利用收到的密文生成安全签名，进行签名验证&lt;/li&gt;
	 * 	&lt;li&gt;若验证通过，则提取json中的加密消息&lt;/li&gt;
	 * 	&lt;li&gt;对消息进行解密&lt;/li&gt;
	 * &lt;/ol&gt;
	 * 
	 * @param msgSignature 签名串，对应URL参数的msg_signature
	 * @param timeStamp 时间戳，对应URL参数的timestamp
	 * @param nonce 随机串，对应URL参数的nonce
	 * @param postData 密文，对应POST请求的数据
	 * 
	 * @return 解密后的原文
	 * @throws AesException 执行失败，请查看该异常的错误码和具体的错误信息
	 */</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token class-name">DecryptMsg</span><span class="token punctuation">(</span><span class="token class-name">String</span> msgSignature<span class="token punctuation">,</span> <span class="token class-name">String</span> timeStamp<span class="token punctuation">,</span> <span class="token class-name">String</span> nonce<span class="token punctuation">,</span> <span class="token class-name">String</span> postData<span class="token punctuation">)</span>
			<span class="token keyword">throws</span> <span class="token class-name">AesException</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 密钥，公众账号的app secret</span>
		<span class="token comment">// 提取密文</span>
		<span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> encrypt <span class="token operator">=</span> <span class="token class-name">JsonParse</span><span class="token punctuation">.</span><span class="token function">extract</span><span class="token punctuation">(</span>postData<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 验证安全签名</span>
		<span class="token class-name">String</span> signature <span class="token operator">=</span> SHA1<span class="token punctuation">.</span><span class="token function">getSHA1</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> timeStamp<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> encrypt<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">// 和URL中的签名比较是否相等</span>
		<span class="token comment">// System.out.println("第三方收到URL中的签名：" + msg_sign);</span>
		<span class="token comment">// System.out.println("第三方校验签名：" + signature);</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>signature<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>msgSignature<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AesException</span><span class="token punctuation">(</span><span class="token class-name">AesException<span class="token punctuation">.</span>ValidateSignatureError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 解密</span>
		<span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>encrypt<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> result<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token comment">/**
	 * 验证URL
	 * @param msgSignature 签名串，对应URL参数的msg_signature
	 * @param timeStamp 时间戳，对应URL参数的timestamp
	 * @param nonce 随机串，对应URL参数的nonce
	 * @param echoStr 随机串，对应URL参数的echostr
	 * 
	 * @return 解密之后的echostr
	 * @throws AesException 执行失败，请查看该异常的错误码和具体的错误信息
	 */</span>
	<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token class-name">VerifyURL</span><span class="token punctuation">(</span><span class="token class-name">String</span> msgSignature<span class="token punctuation">,</span> <span class="token class-name">String</span> timeStamp<span class="token punctuation">,</span> <span class="token class-name">String</span> nonce<span class="token punctuation">,</span> <span class="token class-name">String</span> echoStr<span class="token punctuation">)</span>
			<span class="token keyword">throws</span> <span class="token class-name">AesException</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">String</span> signature <span class="token operator">=</span> SHA1<span class="token punctuation">.</span><span class="token function">getSHA1</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> timeStamp<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> echoStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>signature<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>msgSignature<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">AesException</span><span class="token punctuation">(</span><span class="token class-name">AesException<span class="token punctuation">.</span>ValidateSignatureError</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token function">decrypt</span><span class="token punctuation">(</span>echoStr<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> result<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token comment">/**
 * @Author sprem至尊
 * @Date 2022/10/24 17:55
 * @Version 1.0
 */</span>
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>demo<span class="token punctuation">.</span>cache</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>cache<span class="token punctuation">.</span></span><span class="token class-name">CacheBuilder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>cache<span class="token punctuation">.</span></span><span class="token class-name">CacheLoader</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>google<span class="token punctuation">.</span>common<span class="token punctuation">.</span>cache<span class="token punctuation">.</span></span><span class="token class-name">LoadingCache</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype<span class="token punctuation">.</span></span><span class="token class-name">Component</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span><span class="token punctuation">;</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TokenCache</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">LoadingCache</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> loadingCache <span class="token operator">=</span> <span class="token class-name">CacheBuilder</span>
            <span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">initialCapacity</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">maximumSize</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">expireAfterWrite</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">CacheLoader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"loadkey::::"</span><span class="token operator">+</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"loadValue::::"</span><span class="token operator">+</span><span class="token function">getValue</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setKey</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">,</span><span class="token class-name">String</span> value<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        loadingCache<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getValue</span><span class="token punctuation">(</span><span class="token class-name">String</span> key<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> value <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span><span class="token punctuation">{<!-- --></span>
            value <span class="token operator">=</span> loadingCache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h4><a id="_758"></a>六、附加-对接第三方应用</h4> 
<p>可在开发中心详细查看，这里不做过多介绍，如后续项目需使用，即可添加。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/121e4aaef53730c4cf7b78a3f70d65e5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">小程序无需编程，体验IoT物联网平台-物模型开发——设备接入类</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f12117f4090adfe974e2be3df7b01e63/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux创建并挂载NAS</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>