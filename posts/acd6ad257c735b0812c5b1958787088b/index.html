<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用 wireshark 抓包，https，http2 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用 wireshark 抓包，https，http2" />
<meta property="og:description" content="首先下载安装 https://www.wireshark.org/download.html
wireshark 的工作过程为：
1、设置要捕获哪个网卡上的流量 捕获 --&gt; 选项
首先你得知道当前机器的IP，然后就很容易找到是哪个网卡了。
2、设置要捕获哪些内容 捕获 --&gt; 捕获过滤器
这里我要捕获一个http请求，它是HTTP的80端口。
设置好这两步它就会开始捕获数据了。
3、设置显示过滤器 设置好捕获过滤器之后，捕获的内容可能依然很多，这个时候就需要设置一下要显示哪些内容了，也就是显示过滤器。
输入的内容http and ip.dst == xxxx要遵循一定的语法。
使用 and 和 or 来连接。
比较操作符有：等于== 、不等于!= 、大于&gt; 、小于&lt; 、大于等于&gt;= 、小于等于&lt;=
常用的有
表达式含义http只查看http请求ip.dst == 192.168.2.157请求的目标ip地址tcp.dstport == 80目标端口http.request.method == GEThttp请求方式http.request.uri == &#34;/read5/heartbeat&#34;请求uri 其次可以点击输入框左边的小图标保存下来。
4、追踪流 比如，我要查看上面某个http请求的具体内容，将其选中，追踪流，http流
就可以查到到请求信息和响应信息的全部内容。
5、修改显示的时间格式 上面的列表中第二列为请求发出的时间。
视图 --&gt; 时间显示格式 --&gt; 日期和时间
6、捕获https的请求 首先设置捕获过滤器为tcp，然后输入显示过滤器ip.dst==47.104.146.209 and tcp.dstport==443。发现列出的信息是加密的，这个时候是需要对https的运行过程有一定的了解，在客户端和服务端建立连接的过程中已经约定好了此次通讯的数据加密解密算法的AES密钥，因此只要找到了AES密钥就能解密请求和响应的内容。
当系统环境变量中存在SSLKEYLOGFILE这个变量的时候，chrome与firefox在访问https网站的时候会将密钥保存到这个环境变量对应的文件中，如果在wireshark中设置一下，这样就可以解析https的流量了。
编辑 --&gt; 首选项 --&gt; Protocals --&gt; TLS
比如我设置 SSLKEYLOGFILE=D:\sslkeylog\sslkey.log，这个文件要手动创建。
重启浏览器" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/acd6ad257c735b0812c5b1958787088b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-22T15:37:03+08:00" />
<meta property="article:modified_time" content="2023-10-22T15:37:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用 wireshark 抓包，https，http2</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>首先下载安装 https://www.wireshark.org/download.html</p> 
<p>wireshark 的工作过程为：</p> 
<h6><a id="1_4"></a>1、设置要捕获哪个网卡上的流量</h6> 
<p>捕获 --&gt; 选项</p> 
<p>首先你得知道当前机器的IP，然后就很容易找到是哪个网卡了。</p> 
<p><img src="https://images2.imgbox.com/df/ac/qjJy8hVM_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="2_13"></a>2、设置要捕获哪些内容</h6> 
<p>捕获 --&gt; 捕获过滤器</p> 
<p>这里我要捕获一个http请求，它是HTTP的80端口。</p> 
<p><img src="https://images2.imgbox.com/c2/3a/vvd6VRVQ_o.png" alt="在这里插入图片描述"></p> 
<p>设置好这两步它就会开始捕获数据了。</p> 
<h6><a id="3_24"></a>3、设置显示过滤器</h6> 
<p>设置好捕获过滤器之后，捕获的内容可能依然很多，这个时候就需要设置一下要显示哪些内容了，也就是显示过滤器。</p> 
<p><img src="https://images2.imgbox.com/2e/f0/jtAtUZUr_o.png" alt="在这里插入图片描述"></p> 
<p>输入的内容<code>http and ip.dst == xxxx</code>要遵循一定的语法。</p> 
<p>使用 <code>and</code> 和 <code>or</code> 来连接。</p> 
<p>比较操作符有：等于<code>==</code> 、不等于<code>!= </code>、大于<code>&gt; </code>、小于<code>&lt; </code>、大于等于<code>&gt;=</code> 、小于等于<code>&lt;=</code></p> 
<p>常用的有</p> 
<table><thead><tr><th>表达式</th><th>含义</th></tr></thead><tbody><tr><td><code>http</code></td><td>只查看http请求</td></tr><tr><td><code>ip.dst == 192.168.2.157</code></td><td>请求的目标ip地址</td></tr><tr><td><code>tcp.dstport == 80</code></td><td>目标端口</td></tr><tr><td><code>http.request.method == GET</code></td><td>http请求方式</td></tr><tr><td><code>http.request.uri == "/read5/heartbeat"</code></td><td>请求uri</td></tr></tbody></table> 
<p>其次可以点击输入框左边的小图标保存下来。</p> 
<h6><a id="4_49"></a>4、追踪流</h6> 
<p>比如，我要查看上面某个http请求的具体内容，将其选中，追踪流，http流</p> 
<p><img src="https://images2.imgbox.com/ef/03/FX2sIYPs_o.png" alt="在这里插入图片描述"></p> 
<p>就可以查到到请求信息和响应信息的全部内容。</p> 
<h6><a id="5_58"></a>5、修改显示的时间格式</h6> 
<p>上面的列表中第二列为请求发出的时间。</p> 
<p>视图 --&gt; 时间显示格式 --&gt; 日期和时间</p> 
<p><img src="https://images2.imgbox.com/9b/66/Ue5f5oK9_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="6https_65"></a>6、捕获https的请求</h6> 
<p>首先设置捕获过滤器为tcp，然后输入显示过滤器<code>ip.dst==47.104.146.209 and tcp.dstport==443</code>。发现列出的信息是加密的，这个时候是需要对https的运行过程有一定的了解，在客户端和服务端建立连接的过程中已经约定好了此次通讯的数据加密解密算法的AES密钥，因此只要找到了AES密钥就能解密请求和响应的内容。</p> 
<p>当系统环境变量中存在<code>SSLKEYLOGFILE</code>这个变量的时候，chrome与firefox在访问https网站的时候会将密钥保存到这个环境变量对应的文件中，如果在wireshark中设置一下，这样就可以解析https的流量了。</p> 
<p>编辑 --&gt; 首选项 --&gt; Protocals --&gt; TLS<br> <img src="https://images2.imgbox.com/dc/25/Qg0vJffb_o.png" alt="在这里插入图片描述"></p> 
<p>比如我设置 <code>SSLKEYLOGFILE=D:\sslkeylog\sslkey.log</code>，这个文件要手动创建。</p> 
<p><strong>重启浏览器</strong></p> 
<p>注：不抓包时记得把环境变量删掉，以避免性能浪费和安全性问题</p> 
<p>同样都是HTTPS，有的使用的是HTTP/1.1；有的使用的是HTTP/2协议，分别使用http和http2来过滤，如何知道使用的是什么协议呢，打开浏览器调试，右键名称，在弹出的下拉框中勾上协议。</p> 
<p>目前都使用的是TLS，它是SSL的升级版本。</p> 
<p>以 <code>https://www.baidu.com</code> 为例，配置了TLS文件之前捕获的是Application Data，啥也看不到，设置了之后，就可以看到具体信息了。<br> 显示过滤器<code>tcp.port==443 and ip.dst==14.215.177.38</code>，然后访问<code>https://www.baidu.com/</code>。<br> <img src="https://images2.imgbox.com/0e/6c/c2hhKQjV_o.png" alt="在这里插入图片描述"><br> 从浏览器的调试窗口也看到百度首页使用的是<code>http/1.1</code>协议。</p> 
<p>来测试一个基于 http2 的 https 接口。显示过滤器为<code>http2</code>。</p> 
<p><img src="https://images2.imgbox.com/f3/fc/If2kSaxf_o.png" alt="在这里插入图片描述"><br> 发现请求和响应分开列出来了，<code>所以响应的目标IP是我本机IP</code></p> 
<p>点击<code>200 OK</code>这一条，点击<code>Data</code>就能看到响应的内容了。或者右键<code>200 OK</code>，选中追踪流，http2 stream 也可以看到内容<br> <img src="https://images2.imgbox.com/79/7e/7OVp8elp_o.png" alt="在这里插入图片描述"><br> 我们来测试一下 post方式的接口。<br> <img src="https://images2.imgbox.com/6f/f6/xnwKIN1L_o.png" alt="在这里插入图片描述"><br> 右键追踪流，可以看到请求参数和响应结果。<br> <img src="https://images2.imgbox.com/9d/a8/Hr1ohjIe_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a3fe5f6fe990719e02c5438b8dd5f9f5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Base 编码家族：Base16 编码</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/191b04a5442866a7daa666413de3c59d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">5G学习笔记之5G频谱</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>