<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>视觉学习笔记9——边缘分离式计算EdgeSLAM结合ORBSLAM3 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="视觉学习笔记9——边缘分离式计算EdgeSLAM结合ORBSLAM3" />
<meta property="og:description" content="系列文章目录 参考我的opencv配置博客
参考我的orbslam3配置博客
文章目录 系列文章目录前言一、电脑EdgeSlam安装配置1.错误12.错误23.错误34.错误4 二、jetson nano安装ORB SLAM31、jetson nano问题问题1问题2 2、jetson nano的自带opencv问题1.卸载opencv3.3.02.安装opencv4.4.0 3、ros问题问题1 4、orbslam3问题1.问题12.问题2 5、zed问题问题1问题2 三、jetson nano EdgeSlam安装测试1、测试1.在移动设备上2.在边缘设备上3.IP和端口号通信 四、ORB_SLAM3调整1、更新cv_bridge报错1报错2 2、编译调用报错1报错2报错3 AdapSLAM实现安装步骤报错1：报错2：报错3：报错4：重装ROS 前言 众所周知，视觉 SLAM 在内存和处理时间方面是资源密集型的。此外，一些操作随着时间的推移变得越来越复杂，这使得在移动设备上连续运行变得具有挑战性。边缘计算为移动设备提供额外的计算和内存资源，以允许卸载某些任务，而不会出现卸载到云时出现的大延迟。 Edge-SLAM是一种使用边缘计算资源来卸载部分 Visual-SLAM 的系统。使用 ORB-SLAM3 作为原型 Visual-SLAM 系统，并将其修改为边缘和移动设备之间的分离架构。将跟踪计算保留在移动设备上，并将其余计算（即局部映射和闭环）移动到边缘，可以允许 Visual-SLAM 系统在资源有限的情况下长期运行，而不会影响操作的准确性。它还使移动设备上的计算和内存成本保持不变，这将允许部署其他使用 Visual-SLAM 的终端应用程序。
Edge-SLAM 是一种边缘辅助视觉同步定位和建图。Edge-SLAM 将 Visual-SLAM 适配到边缘计算架构中，以实现 Visual-SLAM 在移动设备上的长时间运行。这是通过将计算密集型模块卸载到边缘来实现的。因此，Edge-SLAM 减少了移动设备上的资源使用并保持不变。Edge-SLAM 是在ORB-SLAM2之上实现的。
我本来构思自己该怎么去实现的，后来逛github时发现了一个新项目AdapSLAM，发现有人和我的想法不谋而合且思路更成熟并已实现，真np啊。
EdgeSlam源码
EdgeSlam论文
一、电脑EdgeSlam安装配置 安装EdgeSlam前先安装好ORB-SLAM3
1.错误1 执行build.sh最后的
cmake .. -DCMAKE_BUILD_TYPE=Release 出现：
Found package configuration file:
/usr/local/lib/cmake/Pangolin/PangolinConfig.cmake
but it set Pangolin_FOUND to FALSE so package “Pangolin” is considered to" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/bc02199f944f267c2c0d94df47ab4904/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-28T21:43:56+08:00" />
<meta property="article:modified_time" content="2023-03-28T21:43:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">视觉学习笔记9——边缘分离式计算EdgeSLAM结合ORBSLAM3</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>系列文章目录</h2> 
<p><a href="https://blog.csdn.net/qq_45848817/article/details/117987514?spm=1001.2014.3001.5501#t12">参考我的opencv配置博客</a><br> <a href="https://blog.csdn.net/qq_45848817/article/details/123457693?spm=1001.2014.3001.5501">参考我的orbslam3配置博客</a></p> 
<hr> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_0" rel="nofollow">系列文章目录</a></li><li><a href="#_12" rel="nofollow">前言</a></li><li><a href="#EdgeSlam_31" rel="nofollow">一、电脑EdgeSlam安装配置</a></li><li><ul><li><ul><li><a href="#11_34" rel="nofollow">1.错误1</a></li><li><a href="#22_60" rel="nofollow">2.错误2</a></li><li><a href="#33_91" rel="nofollow">3.错误3</a></li><li><a href="#44_116" rel="nofollow">4.错误4</a></li></ul> 
  </li></ul> 
  </li><li><a href="#jetson_nanoORB_SLAM3_127" rel="nofollow">二、jetson nano安装ORB SLAM3</a></li><li><ul><li><a href="#1jetson_nano_128" rel="nofollow">1、jetson nano问题</a></li><li><ul><li><a href="#1_129" rel="nofollow">问题1</a></li><li><a href="#2_147" rel="nofollow">问题2</a></li></ul> 
   </li><li><a href="#2jetson_nanoopencv_180" rel="nofollow">2、jetson nano的自带opencv问题</a></li><li><ul><li><a href="#1opencv330_181" rel="nofollow">1.卸载opencv3.3.0</a></li><li><a href="#2opencv440_195" rel="nofollow">2.安装opencv4.4.0</a></li></ul> 
   </li><li><a href="#3ros_277" rel="nofollow">3、ros问题</a></li><li><ul><li><a href="#1_291" rel="nofollow">问题1</a></li></ul> 
   </li><li><a href="#4orbslam3_298" rel="nofollow">4、orbslam3问题</a></li><li><ul><li><a href="#11_302" rel="nofollow">1.问题1</a></li><li><a href="#22_311" rel="nofollow">2.问题2</a></li></ul> 
   </li><li><a href="#5zed_333" rel="nofollow">5、zed问题</a></li><li><ul><li><a href="#1_334" rel="nofollow">问题1</a></li><li><a href="#2_347" rel="nofollow">问题2</a></li></ul> 
  </li></ul> 
  </li><li><a href="#jetson_nano_EdgeSlam_371" rel="nofollow">三、jetson nano EdgeSlam安装测试</a></li><li><ul><li><a href="#1_374" rel="nofollow">1、测试</a></li><li><ul><li><a href="#1_376" rel="nofollow">1.在移动设备上</a></li><li><a href="#2_391" rel="nofollow">2.在边缘设备上</a></li><li><a href="#3IP_408" rel="nofollow">3.IP和端口号通信</a></li></ul> 
  </li></ul> 
  </li><li><a href="#ORB_SLAM3_454" rel="nofollow">四、ORB_SLAM3调整</a></li><li><ul><li><a href="#1cv_bridge_464" rel="nofollow">1、更新cv_bridge</a></li><li><ul><li><a href="#1_475" rel="nofollow">报错1</a></li><li><a href="#2_490" rel="nofollow">报错2</a></li></ul> 
   </li><li><a href="#2_537" rel="nofollow">2、编译调用</a></li><li><ul><li><a href="#1_541" rel="nofollow">报错1</a></li><li><a href="#2_552" rel="nofollow">报错2</a></li><li><a href="#3_596" rel="nofollow">报错3</a></li></ul> 
  </li></ul> 
  </li><li><a href="#AdapSLAM_616" rel="nofollow">AdapSLAM实现</a></li><li><ul><li><a href="#_617" rel="nofollow">安装步骤</a></li><li><ul><li><a href="#1_624" rel="nofollow">报错1：</a></li><li><a href="#2_659" rel="nofollow">报错2：</a></li><li><a href="#3_696" rel="nofollow">报错3：</a></li><li><a href="#4_706" rel="nofollow">报错4：</a></li><li><a href="#ROS_795" rel="nofollow">重装ROS</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_12"></a>前言</h2> 
<p>众所周知，视觉 SLAM 在内存和处理时间方面是资源密集型的。此外，一些操作随着时间的推移变得越来越复杂，这使得在移动设备上连续运行变得具有挑战性。边缘计算为移动设备提供额外的计算和内存资源，以允许卸载某些任务，而不会出现卸载到云时出现的大延迟。 Edge-SLAM是一种使用边缘计算资源来卸载部分 Visual-SLAM 的系统。使用 ORB-SLAM3 作为原型 Visual-SLAM 系统，并将其修改为边缘和移动设备之间的分离架构。将跟踪计算保留在移动设备上，并将其余计算（即局部映射和闭环）移动到边缘，可以允许 Visual-SLAM 系统在资源有限的情况下长期运行，而不会影响操作的准确性。它还使移动设备上的计算和内存成本保持不变，这将允许部署其他使用 Visual-SLAM 的终端应用程序。</p> 
<p>Edge-SLAM 是一种边缘辅助视觉同步定位和建图。Edge-SLAM 将 Visual-SLAM 适配到边缘计算架构中，以实现 Visual-SLAM 在移动设备上的长时间运行。这是通过将计算密集型模块卸载到边缘来实现的。因此，Edge-SLAM 减少了移动设备上的资源使用并保持不变。Edge-SLAM 是在ORB-SLAM2之上实现的。</p> 
<p>我本来构思自己该怎么去实现的，后来逛github时发现了一个新项目AdapSLAM，发现有人和我的想法不谋而合且思路更成熟并已实现，真np啊。</p> 
<p><a href="https://github.com/droneslab/edgeslam">EdgeSlam源码</a><br> <a href="https://dl.acm.org/doi/10.1145/3386901.3389033" rel="nofollow">EdgeSlam论文</a></p> 
<p><img src="https://images2.imgbox.com/30/a7/K9UMid32_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h2><a id="EdgeSlam_31"></a>一、电脑EdgeSlam安装配置</h2> 
<p><strong>安装EdgeSlam前先安装好ORB-SLAM3</strong></p> 
<h4><a id="11_34"></a>1.错误1</h4> 
<p>执行build.sh最后的</p> 
<pre><code class="prism language-bash">cmake <span class="token punctuation">..</span> -DCMAKE_BUILD_TYPE<span class="token operator">=</span>Release
</code></pre> 
<p>出现：<br> Found package configuration file:<br> /usr/local/lib/cmake/Pangolin/PangolinConfig.cmake<br> but it set Pangolin_FOUND to FALSE so package “Pangolin” is considered to<br> be NOT FOUND. Reason given by package:<br> Pangolin could not be found because dependency Eigen3 could not be found.<br> 或<br> /usr/bin/ld: 找不到 -lEigen3::Eigen<br> <img src="https://images2.imgbox.com/e5/91/C7TPVUWR_o.png" alt="示例：pandas 是基于NumPy 的一种工具，该工具是为了解决数据分析任务而创建的。"><br> <strong>解决办法：</strong><br> 不重新安装Pangolin及Eigen的临时办法，修改CMakeLists.txt如下：<br> 在find_package(Eigen3 REQUIRED)后加NO_MUDULE,</p> 
<pre><code class="prism language-bash">find_package<span class="token punctuation">(</span>Eigen3 REQUIRED NO_MODULE<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d3/94/Xb7itzAK_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="22_60"></a>2.错误2</h4> 
<pre><code class="prism language-bash"> <span class="token punctuation">[</span>rosbuild<span class="token punctuation">]</span> rospack found package <span class="token string">"Edge_SLAM"</span> at <span class="token string">""</span>, but the current
  directory is <span class="token string">"/home/llw/Guide_blind/edgeslam/Examples/ROS/Edge_SLAM"</span><span class="token builtin class-name">.</span>  You
  should double-check your ROS_PACKAGE_PATH to ensure that packages are found
  <span class="token keyword">in</span> the correct precedence order.
</code></pre> 
<p><strong>解决：</strong><br> 首先在~/.bashrc上设置了路径（注意这个path是我的路径，读者需要自己修改）：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> ~/.bashrc
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ROS_PACKAGE_PATH</span><span class="token operator">=</span><span class="token variable">${ROS_PACKAGE_PATH}</span>:/home/llw/Guide_blind/edgeslam/Examples/ROS
<span class="token builtin class-name">source</span> ~/.bashrc
</code></pre> 
<p>在ROS的安装路径下更改路径：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /opt/ros/melodic/
<span class="token function">sudo</span> <span class="token function">vim</span> setup.bash 
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ROS_PACKAGE_PATH</span><span class="token operator">=</span><span class="token variable">${ROS_PACKAGE_PATH}</span>:/home/llw/Guide_blind/edgeslam/Examples/ROS
<span class="token builtin class-name">source</span> setup.bash
</code></pre> 
<p>查看路径是否添加成功：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">echo</span> <span class="token variable">$ROS_PACKAGE_PATH</span>
</code></pre> 
<h4><a id="33_91"></a>3.错误3</h4> 
<pre><code>CMake Warning (dev) at /opt/ros/melodic/share/ros/core/rosbuild/public.cmake:507 (add_executable):
  Policy CMP0028 is not set: Double colon in target name means ALIAS or
  IMPORTED target.  Run "cmake --help-policy CMP0028" for policy details.
  Use the cmake_policy command to set the policy and suppress this warning.

  Target "Mono" links to target "Eigen3::Eigen" but the target was not found.
  Perhaps a find_package() call is missing for an IMPORTED target, or an
  ALIAS target is missing?
Call Stack (most recent call first):
  CMakeLists.txt:126 (rosbuild_add_executable)
This warning is for project developers.  Use -Wno-dev to suppress it.
</code></pre> 
<p><strong>解决办法：</strong><br> Eigen检测不到，同样是修改CMakeLists.txt如下：<br> 在find_package(Eigen3 REQUIRED)后加NO_MUDULE,</p> 
<pre><code class="prism language-bash">find_package<span class="token punctuation">(</span>Eigen3 REQUIRED NO_MODULE<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/7b/5d/p4PY1n27_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="44_116"></a>4.错误4</h4> 
<pre><code class="prism language-bash">OpenCV Error: Unknown error code -49 <span class="token punctuation">(</span>Input <span class="token function">file</span> is empty<span class="token punctuation">)</span> <span class="token keyword">in</span> cvOpenFileStorage, <span class="token function">file</span> /build/opencv-L2vuMj/opencv-3.2.0+dfsg/modules/core/src/persistence.cpp, line <span class="token number">4422</span>
terminate called after throwing an instance of <span class="token string">'cv::Exception'</span>
  what<span class="token punctuation">(</span><span class="token punctuation">)</span>:  /build/opencv-L2vuMj/opencv-3.2.0+dfsg/modules/core/src/persistence.cpp:4422: error: <span class="token punctuation">(</span>-49<span class="token punctuation">)</span> Input <span class="token function">file</span> is empty <span class="token keyword">in</span> <span class="token keyword">function</span> cvOpenFileStorage
</code></pre> 
<p><strong>解决：</strong><br> 主要问题是配置文件中没有添加“%YAML:1.0”<br> <img src="https://images2.imgbox.com/d4/3a/MWiQKNCq_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="jetson_nanoORB_SLAM3_127"></a>二、jetson nano安装ORB SLAM3</h2> 
<h3><a id="1jetson_nano_128"></a>1、jetson nano问题</h3> 
<h4><a id="1_129"></a>问题1</h4> 
<p>鉴于nano自己的算力问题，有时导致编译卡死，可以选择关闭图形界面</p> 
<p>关闭图形界面</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> systemctl set-default multi-user.target 
<span class="token function">sudo</span> <span class="token function">reboot</span>
</code></pre> 
<p>开启图形界面</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> systemctl set-default graphical.target 
<span class="token function">sudo</span> <span class="token function">reboot</span>
</code></pre> 
<h4><a id="2_147"></a>问题2</h4> 
<p>apt-get锁</p> 
<pre><code class="prism language-bash">E: 无法获得锁 /var/lib/dpkg/lock-frontend - <span class="token function">open</span> <span class="token punctuation">(</span><span class="token number">11</span>: 资源暂时不可用<span class="token punctuation">)</span> 
E: 无法获取 dpkg 前端锁 <span class="token punctuation">(</span>/var/lib/dpkg/lock-frontend<span class="token punctuation">)</span>,是否有其他进程正占用它?
</code></pre> 
<pre><code class="prism language-bash"><span class="token number">1</span>.方法一：
用这个命令查看一下apt-get的相关进程：
<span class="token function">ps</span> -e <span class="token operator">|</span> <span class="token function">grep</span> <span class="token function">apt</span>

显示：
<span class="token number">11669</span> ? 00:00:02 aptd
<span class="token number">25379</span> ? 00:00:00 update-apt-xapi

然后执行:
<span class="token function">sudo</span> <span class="token function">kill</span> <span class="token number">11669</span>
<span class="token function">sudo</span> <span class="token function">kill</span> <span class="token number">25379</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token number">2</span>.方法二：
<span class="token function">sudo</span> <span class="token function">rm</span> /var/cache/apt/archives/lock
<span class="token function">sudo</span> <span class="token function">rm</span> /var/lib/dpkg/lock
</code></pre> 
<pre><code class="prism language-bash"><span class="token number">3</span>.方法三
<span class="token function">sudo</span> <span class="token function">rm</span> /var/lib/dpkg/lock-frontend
</code></pre> 
<h3><a id="2jetson_nanoopencv_180"></a>2、jetson nano的自带opencv问题</h3> 
<h4><a id="1opencv330_181"></a>1.卸载opencv3.3.0</h4> 
<pre><code>sudo apt-get purge libopencv*
sudo apt autoremove
sudo apt-get update
</code></pre> 
<p>查看linux下是否有opencv以及安装版本：</p> 
<pre><code class="prism language-bash">pkg-config opencv --modversion
pkg-config opencv4 --modversion
</code></pre> 
<h4><a id="2opencv440_195"></a>2.安装opencv4.4.0</h4> 
<p><a href="https://blog.csdn.net/qq_45848817/article/details/117987514?spm=1001.2014.3001.5501#t12">参考我的博客</a></p> 
<ol><li>把opencv的依赖安装好</li><li>下载并处理好4.4Sources版本、opencv_contrib、boostdesc和vgg文件</li><li>cmake-gui及以下部分不用管了，回来看这篇博客</li></ol> 
<p>查看cmake版本，有就行没有就下载:</p> 
<pre><code class="prism language-bash">cmake -version
</code></pre> 
<p>配置与编译opencv：</p> 
<pre><code>1、创建build文件夹
mkdir build
cd build

2、cmake设置配置opencv
cmake \

-DCMAKE_BUILD_TYPE=Release \
-DBUILD_PNG=OFF \
-DBUILD_TIFF=OFF \
-DBUILD_TBB=OFF \
-DBUILD_JPEG=OFF \
-DBUILD_JASPER=OFF \
-DBUILD_ZLIB=OFF \
-DBUILD_EXAMPLES=OFF \
-DBUILD_opencv_java=OFF \
-DBUILD_opencv_python2=OFF \
-DBUILD_opencv_python3=ON \
-DENABLE_PRECOMPILED_HEADERS=OFF \
-DWITH_OPENCL=OFF \
-DWITH_OPENMP=OFF \
-DWITH_FFMPEG=ON \
-DWITH_GSTREAMER=OFF \
-DWITH_GSTREAMER_0_10=OFF \
-DWITH_CUDA=ON \
-DWITH_GTK=ON \
-DWITH_VTK=OFF \
-DWITH_TBB=ON \
-DWITH_1394=OFF \
-DWITH_OPENEXR=OFF \
-DCUDA_TOOLKIT_ROOT_DIR=/usr/local/cuda-10.0 \
-DCUDA_ARCH_BIN=5.3 \
-DCUDA_ARCH_PTX="" \
-DINSTALL_C_EXAMPLES=OFF \
-DOPENCV_ENABLE_NONFREE=ON \
-DINSTALL_TESTS=OFF \
-DOPENCV_EXTRA_MODULES_PATH=../../opencv_contrib-4.4.0/modules \
..

</code></pre> 
<p>设置错误：</p> 
<pre><code>CUDA: OpenCV requires enabled ‘cudev‘ module from ‘opencv_contrib‘
</code></pre> 
<p>错误解决：路径不对</p> 
<pre><code>-DOPENCV_EXTRA_MODULES_PATH=../opencv_contrib-4.4.0/modules \
</code></pre> 
<p>设置配置完成并检查无误后开始编译，-j1是害怕死机，j1-j4都可以，越大越快但越容易挂，j1比较稳但是我编译了一个晚上：</p> 
<pre><code>sudo make -j1
</code></pre> 
<p>漫长编译结束，进行安装</p> 
<pre><code>sudo make install
</code></pre> 
<h3><a id="3ros_277"></a>3、ros问题</h3> 
<p>建议解决自带的opencv问题，再安装ROS，最后安装ORBSLAM3，安装参考<a href="https://blog.csdn.net/KIK9973/article/details/118755045?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164722886416780261979841%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=164722886416780261979841&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~times_rank-4-118755045.first_rank_v2_pc_rank_v29_v2&amp;utm_term=ros%E5%AE%89%E8%A3%85%2018&amp;spm=1018.2226.3001.4187">这篇博客</a></p> 
<p>里面有一个脚本命令直接安装，非常小白，不过需要注意脚本安装时的选项选择。</p> 
<pre><code class="prism language-bash"><span class="token function">wget</span> http://fishros.com/install -O fishros <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">.</span> fishros
</code></pre> 
<p>脚本安装完后，直接跳到<a href="https://blog.csdn.net/KIK9973/article/details/118755045?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522164722886416780261979841%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=164722886416780261979841&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~times_rank-4-118755045.first_rank_v2_pc_rank_v29_v2&amp;utm_term=ros%E5%AE%89%E8%A3%85%2018&amp;spm=1018.2226.3001.4187">这篇博客</a>的6.rosdep init 初始化步骤直到画海龟。</p> 
<h4><a id="1_291"></a>问题1</h4> 
<p>工作空间编译问题，执行catkin_make时报错：catkin_make libusb_cam.so 未定义的引用</p> 
<p><strong>解决：</strong><br> 似乎是版本更新导致的问题，下载了usb_cam 0.3.6版本 ，并在 catkin 工作区中重建执行它。</p> 
<h3><a id="4orbslam3_298"></a>4、orbslam3问题</h3> 
<p>直接用的是ORB-SLAM3 1.0版本，<a href="https://blog.csdn.net/qq_45848817/article/details/123457693?spm=1001.2014.3001.5501">参考我的博客</a>。<br> 安装完成后测试单目与双目效果，看看有没有成功。</p> 
<h4><a id="11_302"></a>1.问题1</h4> 
<pre><code class="prism language-bash">Couldn’t query v4l fps<span class="token operator">!</span> error <span class="token number">25</span>, Inappropriate ioctl <span class="token keyword">for</span> device
</code></pre> 
<p><strong>解决：</strong></p> video编号是否正确对应 
<h4><a id="22_311"></a>2.问题2</h4> 
<p>运行./build_ros.sh时出现报错：</p> 
<pre><code class="prism language-bash">error: no matching <span class="token keyword">function</span> <span class="token keyword">for</span> call to ‘std::vector<span class="token operator">&lt;</span>cv::Mat<span class="token operator">&gt;</span>::push_back<span class="token punctuation">(</span>Eigen::Vector3f<span class="token punctuation">)</span>’
</code></pre> 
<p><strong>解决：</strong><br> 打开ViewerAR.cc文件第405行</p> 
<pre><code class="prism language-bash">删除或注释
vPoints.push_back<span class="token punctuation">(</span>pMP-<span class="token operator">&gt;</span>GetWorldPos<span class="token punctuation">(</span><span class="token punctuation">))</span>
</code></pre> 
<p>改为：</p> 
<pre><code class="prism language-bash">vPoints.push_back<span class="token punctuation">(</span>ORB_SLAM3::Converter::toCvMat<span class="token punctuation">(</span>pMP-<span class="token operator">&gt;</span>GetWorldPos<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="5zed_333"></a>5、zed问题</h3> 
<h4><a id="1_334"></a>问题1</h4> 
<pre><code class="prism language-bash"> CMake Error at /opt/ros/melodic/share/catkin/cmake/catkinConfig.cmake:83 <span class="token punctuation">(</span>find_package<span class="token punctuation">)</span>:   Could not <span class="token function">find</span> a package configuration <span class="token function">file</span> provided by <span class="token string">"zed_interfaces"</span>   
</code></pre> 
<p><strong>解决：</strong><br> 只需要安装一个zed_interfaces，放在catkin_make下就可以了。</p> 
<pre><code class="prism language-bash"><span class="token function">git</span> clone https://github.com/stereolabs/zed-ros-interfaces
</code></pre> 
<h4><a id="2_347"></a>问题2</h4> 
<pre><code class="prism language-bash">double <span class="token function">free</span> or corruption <span class="token punctuation">(</span>out<span class="token punctuation">)</span>
Aborted <span class="token punctuation">(</span>core dumped<span class="token punctuation">)</span>
</code></pre> 
<p><strong>解决：</strong><br> 经过多次测试回调，发现似乎是opencv的版本原因，这是<a href="https://github.com/UZ-SLAMLab/ORB_SLAM3/issues/403">github的orb讨论区的建议</a></p> 
<p>因为jetson nano安装的是官方提供的镜像，自带opencv3.3.0，这个与ros自带的opencv3.2.0发生冲突，所以选择卸载opencv3.3.0，卸载步骤已经放在前面了。</p> 
<p><img src="https://images2.imgbox.com/e2/1b/sopTmVjJ_o.png" alt="在这里插入图片描述"></p> 
<p>成功通过ZED2调用ORB-SLAM3双目IMU<br> <img src="https://images2.imgbox.com/e7/42/TgbcstRM_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="jetson_nano_EdgeSlam_371"></a>三、jetson nano EdgeSlam安装测试</h2> 
<p>安装步骤基本和章节一的一样，就不在写了。</p> 
<h3><a id="1_374"></a>1、测试</h3> 
<h4><a id="1_376"></a>1.在移动设备上</h4> 
<p>打开一个新的终端窗口，导航到项目根目录，然后运行</p> 
<pre><code class="prism language-bash">roscore
</code></pre> 
<p>打开第二个终端窗口，导航到项目根目录，然后运行</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> Examples/ROS/Edge_SLAM/
rosrun Edge_SLAM RGBD <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/Vocabulary/ORBvoc.txt <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/RGB-D/TUM2.yaml client
</code></pre> 
<h4><a id="2_391"></a>2.在边缘设备上</h4> 
<p>打开一个新的终端窗口，导航到项目根目录，然后运行</p> 
<pre><code class="prism language-bash">roscore
</code></pre> 
<p>打开第二个终端窗口，导航到项目根目录，然后运行</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> Examples/ROS/Edge_SLAM/
rosrun Edge_SLAM RGBD <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/Vocabulary/ORBvoc.txt <span class="token punctuation">..</span>/<span class="token punctuation">..</span>/RGB-D/TUM2.yaml server
</code></pre> 
<h4><a id="3IP_408"></a>3.IP和端口号通信</h4> 
<p>当 Edge-SLAM 在两个设备上运行时，您将被要求在 Edge-SLAM 终端中输入 IP 和端口号以设置网络连接。Edge-SLAM 使用三个 TCP 连接。第一个连接传输关键帧，第二个连接传输帧，第三个连接传输地图更新。按照显示的顺序执行以下步骤以设置网络</p> 
<ol><li>在边缘设备上</li></ol> 
<ul><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> 输入边缘设备 IP 地址</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> 输入用于边缘关键帧连接的端口号，比如6661</li></ul> 
<ol start="2"><li>在移动设备上</li></ol> 
<ul><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> 输入移动设备IP地址</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> 输入边缘设备 IP 地址</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> 输入用于移动设备上关键帧连接的端口号，比如6662</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> 输入用于边缘关键帧连接的端口号，比如6661</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> 如果建立了关键帧连接，系统将继续要求建立第二个连接</li></ul> 
<ol start="3"><li>在边缘设备上</li></ol> 
<ul><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> 输入用于边缘上的帧连接的端口号，比如6663</li></ul> 
<ol start="4"><li>在移动设备上</li></ol> 
<ul><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> 输入用于移动设备上的帧连接的端口号，比如6664</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> 输入用于边缘上的帧连接的端口号，比如6663</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> 如果帧连接建立，系统会继续要求建立第三个连接</li></ul> 
<ol start="5"><li>在边缘设备上</li></ol> 
<ul><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> 输入用于边缘地图更新连接的端口号，比如6665</li></ul> 
<ol start="6"><li>在移动设备上</li></ol> 
<ul><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> 输入用于移动设备地图更新连接的端口号，比如6666</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> 输入用于边缘地图更新连接的端口号，比如6665</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> 如果建立了地图更新连接，移动设备上的系统应该打开查看器窗口，边缘设备应该等待接收数据。</li></ul> 
<ol start="7"><li>在移动设备上</li></ol> 
<ul><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" disabled> 打开第三个终端窗口，导航到项目根目录，然后运行包文件</li></ul> 
<pre><code class="prism language-bash">rosbag play ./rgbd_dataset_freiburg2_desk.bag /camera/rgb/image_color:<span class="token operator">=</span>/camera/rgb/image_raw /camera/depth/image:<span class="token operator">=</span>/camera/depth_registered/image_raw
</code></pre> 
<p><strong>端口残留或被占用</strong></p> 
<pre><code class="prism language-bash">查询端口
<span class="token function">sudo</span> <span class="token function">netstat</span> -nplt

杀死端口中的进程
<span class="token function">kill</span> -9 xxx
</code></pre> 
<p><img src="https://images2.imgbox.com/38/b6/dMxlTybO_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="ORB_SLAM3_454"></a>四、ORB_SLAM3调整</h2> 
<p>待解决问题：</p> 
<pre><code class="prism language-bash">Usage: rosrun ORB_SLAM3 Mono path_to_vocabulary path_to_settings
OpenCV Error: Assertion failed <span class="token punctuation">(</span>tlsSlots.size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> slotIdx<span class="token punctuation">)</span> <span class="token keyword">in</span> releaseSlot, <span class="token function">file</span> /build/opencv-L2vuMj/opencv-3.2.0+dfsg/modules/core/src/system.cpp, line <span class="token number">1092</span>
terminate called after throwing an instance of <span class="token string">'cv::Exception'</span>
  what<span class="token punctuation">(</span><span class="token punctuation">)</span>:  /build/opencv-L2vuMj/opencv-3.2.0+dfsg/modules/core/src/system.cpp:1092: error: <span class="token punctuation">(</span>-215<span class="token punctuation">)</span> tlsSlots.size<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> slotIdx <span class="token keyword">in</span> <span class="token keyword">function</span> releaseSlot
</code></pre> 
<h3><a id="1cv_bridge_464"></a>1、更新cv_bridge</h3> 
<p><a href="https://github.com/ros-perception/vision_opencv">cv_bridge下载地址</a>，需要注意要与系统进行版本对应，我把它解压在catkin_ws/vision_opencv-melodic/cv_bridge目录</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> cv_bridge
<span class="token function">mkdir</span> build
<span class="token builtin class-name">cd</span> build
cmake …
<span class="token function">make</span>
<span class="token function">sudo</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre> 
<h4><a id="1_475"></a>报错1</h4> 
<p>执行cmake …时表示找不到opencv4</p> 
<p><strong>解决方法</strong><br> 修改cv_bridge/CMakeLists.txt中的cv版本</p> 
<pre><code class="prism language-bash">find_package<span class="token punctuation">(</span>OpenCV <span class="token number">4</span> REQUIRED
  COMPONENTS
    opencv_core
    opencv_imgproc
    opencv_imgcodecs
  CONFIG
<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="2_490"></a>报错2</h4> 
<p>执行cmake时表示</p> 
<pre><code class="prism language-bash">/home/nvidia/software/catkin_workspace/src/vision_opencv/cv_bridge/src/module_opencv2.cpp
或
/home/nvidia/software/catkin_workspace/src/vision_opencv/cv_bridge/src/module_opencv3.cpp
中的
error: cannot <span class="token builtin class-name">declare</span> variable ‘g_numpyAllocator’ to be of abstract <span class="token builtin class-name">type</span> ‘NumpyAllocator’
 NumpyAllocator g_numpyAllocator<span class="token punctuation">;</span>
</code></pre> 
<p><strong>解决方法</strong><br> 1、进入cv_bridge/src/CMakeLists.txt文件，修改第35行为</p> 
<pre><code class="prism language-bash"><span class="token keyword">if</span> <span class="token punctuation">(</span>OpenCV_VERSION_MAJOR VERSION_EQUAL <span class="token number">4</span><span class="token punctuation">)</span>
</code></pre> 
<p>2、进入cv_bridge/src/module_opencv3.cpp文件，修改以下两行：</p> 
<pre><code class="prism language-bash">UMatData* allocate<span class="token punctuation">(</span>int dims0, const int* sizes, int type, void* data, size_t* step, int flags, UMatUsageFlags usageFlags<span class="token punctuation">)</span> const
改为
UMatData* allocate<span class="token punctuation">(</span>int dims0, const int* sizes, int type, void* data, size_t* step, AccessFlag flags, UMatUsageFlags usageFlags<span class="token punctuation">)</span> const
</code></pre> 
<pre><code class="prism language-bash"> bool allocate<span class="token punctuation">(</span>UMatData* u, int accessFlags, UMatUsageFlags usageFlags<span class="token punctuation">)</span> const
改为
bool allocate<span class="token punctuation">(</span>UMatData* u, AccessFlag accessFlags, UMatUsageFlags usageFlags<span class="token punctuation">)</span> const
</code></pre> 
<p>编译成功</p> 
<pre><code class="prism language-bash">Writing /usr/local/lib/python2.7/dist-packages/cv_bridge-1.13.0.egg-info
-- Up-to-date: /usr/local/include/cv_bridge
-- Installing: /usr/local/include/cv_bridge/rgb_colors.h
-- Installing: /usr/local/include/cv_bridge/cv_bridge.h
-- Installing: /usr/local/lib/python2.7/dist-packages/cv_bridge/boost/__init__.py
-- Installing: /usr/local/lib/libcv_bridge.so
-- Set runtime path of <span class="token string">"/usr/local/lib/libcv_bridge.so"</span> to <span class="token string">""</span>
-- Installing: /usr/local/lib/python2.7/dist-packages/cv_bridge/boost/cv_bridge_boost.so
-- Set runtime path of <span class="token string">"/usr/local/lib/python2.7/dist-packages/cv_bridge/boost/cv_bridge_boost.so"</span> to <span class="token string">""</span>
</code></pre> 
<h3><a id="2_537"></a>2、编译调用</h3> 
<p>结束之后你就可以更改你的其他代码了，由于以前的cv_bridge不见了，所以要在其他代码的cmakelists.txt添加路径，这个路径是自己的安装路径，以orbslam3的 <strong>./build.sh</strong>和 <strong>./build_ros.sh</strong>编译为例。</p> 
<h4><a id="1_541"></a>报错1</h4> 
<p>不编译去使用，表示有一些库找不到</p> 
<pre><code class="prism language-bash">/opt/ros/melodic/share/ORB_SLAM3/zed2_stereo_inertial:
 error <span class="token keyword">while</span> loading shared libraries: libopencv_imgproc.so.3.2: cannot <span class="token function">open</span> shared object file: No such <span class="token function">file</span> or directory
</code></pre> 
<p><strong>解决方法</strong><br> 调用./build.sh和 ./build_ros.sh编译</p> 
<h4><a id="2_552"></a>报错2</h4> 
<p>调用./build.sh和 ./build_ros.sh编译时报错</p> 
<pre><code class="prism language-bash">Error: package <span class="token string">'ORB_SLAM3'</span> depends on non-existent package <span class="token string">'cv_bridge'</span> and rosdep claims that it is not a system dependency. Check the ROS_PACKAGE_PATH or try calling <span class="token string">'rosdep update'</span>

CMake Error at /opt/ros/melodic/share/ros/core/rosbuild/public.cmake:129 <span class="token punctuation">(</span>message<span class="token punctuation">)</span>:
 
  Failed to invoke rospack to get compile flags <span class="token keyword">for</span> package <span class="token string">'ORB_SLAM3'</span><span class="token builtin class-name">.</span>
  Look above <span class="token keyword">for</span> errors from rospack itself.  Aborting.  Please fix the
  broken dependency<span class="token operator">!</span>
</code></pre> 
<p><strong>解决方法</strong></p> 
<p>大概就是找不到ros的cv_bridge，也找不到我安装的cv_bridge，我也尝试rosdep update，但是没什么用，所以我将在/usr/local/share/cv_bridge文件夹复制到/opt/ros/melodic/share/中，然后再次./build_ros.sh就可以通过了。</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">ln</span> -s /usr/local/share/cv_bridge /opt/ros/melodic/share
</code></pre> 
<p>在其他代码的cmakelists.txt添加路径，防止找不到</p> 
<pre><code class="prism language-bash"><span class="token comment">#在find_package前面</span>
<span class="token comment">#opencv路径</span>
set<span class="token punctuation">(</span>OpenCV_DIR <span class="token string">"your-path/opencv-x.x.x/build"</span><span class="token punctuation">)</span>
<span class="token comment">#cv_bridge路径</span>
set<span class="token punctuation">(</span>cv_bridge_DIR /usr/local/share/cv_bridge/cmake<span class="token punctuation">)</span> 
</code></pre> 
<p><strong>错误分析</strong></p> 
<p>我觉得一开始我使用的是原本的cv_bridge来进行编译的，经过修改后可以使用，然后我将cv_bridge用apt删除后，系统自动在/usr/local/中找到了我安装的cv_bridge，所以也可以正常使用。但是后来尝试从新开始，ros中不做修改，编译ORB-SLAM3会有警告，说明用的还是ros安装时候自带的cv_bridge，删除自带的以后编译又找不到我自己安装的，就会报找不到cv_bridge，这个时候我把我安装的cv_bridge复制到ros中就可以编译通过了。</p> 
<p><strong>总结方法</strong></p> 
<p>1、修改ros的cv_bridge<br> 2、不删除原来的cv_bridge，安装源码的cvbridge，然后在cmakelist中修改，编译完成后apt删除原来的bridge。<br> 3、删除原来的cv_bridge，安装源码bridge，然后cmakelist中修改，并复制/usr/local/share中的bridge到ros路径中。</p> 
<h4><a id="3_596"></a>报错3</h4> 
<p>调用./build_ros.sh编译时报错</p> 
<pre><code class="prism language-bash">c++: error: /usr/lib/x86_64-linux-gnu/libopencv_core.so.3.2.0: 没有那个文件或目录
c++: error: /usr/lib/x86_64-linux-gnu/libopencv_imgproc.so.3.2.0: 没有那个文件或目录
c++: error: /usr/lib/x86_64-linux-gnu/libopencv_imgcodecs.so.3.2.0: 没有那个文件或目录
c++: error: /usr/lib/x86_64-linux-gnu/libopencv_core.so.3.2.0: 没有那个文件或目录
c++: error: /usr/lib/x86_64-linux-gnu/libopencv_imgproc.so.3.2.0: 没有那个文件或目录
c++: error: /usr/lib/x86_64-linux-gnu/libopencv_imgcodecs.so.3.2.0: 没有那个文件或目录
</code></pre> 
<p><strong>解决方法</strong></p> 
<p>这个问题的话将这里的build文件夹删了，回到ORB_SLAM3-1.0/Examples_old/ROS/ORB_SLAM3文件夹重新编译build_ros.sh。</p> 
<h2><a id="AdapSLAM_616"></a>AdapSLAM实现</h2> 
<h3><a id="_617"></a>安装步骤</h3> 
<p>1.默认ORB-SLAM 3安装环境已经搭建好。<br> 2.</p> 
<h4><a id="1_624"></a>报错1：</h4> 
<blockquote> 
 <p>/home/llw/Guide_blind/AdaptSLAM/Sim<br> AdaptSLAM/Examples_old/Monocular-Inertial/mono_inertial_euroc.cc:195:54:<br> error: no matching function for call to<br> ‘ORB_SLAM3::System::TrackMonocular(cv::Mat&amp;, double&amp;, int,<br> std::vector&lt;ORB_SLAM3::IMU::Point&gt;&amp;)’<br> SLAM.TrackMonocular(im,tframe,-1,vImuMeas); // TODO change to monocular_inertial</p> 
</blockquote> 
<blockquote> 
 <p>/home/llw/Guide_blind/AdaptSLAM/Sim<br> AdaptSLAM/Examples_old/Monocular-Inertial/mono_inertial_tum_vi.cc:207:54:<br> error: no matching function for call to<br> ‘ORB_SLAM3::System::TrackMonocular(cv::Mat&amp;, double&amp;, int,<br> std::vector&lt;ORB_SLAM3::IMU::Point&gt;&amp;)’<br> SLAM.TrackMonocular(im,tframe,-1,vImuMeas); // TODO change to monocular_inertial</p> 
</blockquote> 
<blockquote> 
 <p>/home/llw/Guide_blind/AdaptSLAM/Sim<br> AdaptSLAM/Examples_old/Monocular/mono_kitti.cc: In function ‘int<br> main(int, char**)’: /home/llw/Guide_blind/AdaptSLAM/Sim<br> AdaptSLAM/Examples_old/Monocular/mono_kitti.cc:109:97: error: no<br> matching function for call to<br> ‘ORB_SLAM3::System::TrackMonocular(cv::Mat&amp;, double&amp;, int,<br> std::vector&lt;ORB_SLAM3::IMU::Point&gt;,<br> __gnu_cxx::__alloc_traits&lt;std::allocator&lt;std::__cxx11::basic_string<br> ::value_type&amp;)’ onocular(im,tframe,-1,vector&lt;ORB_SLAM3::IMU::Point&gt;(),<br> vstrImageFilenames[ni]);</p> 
</blockquote> 
<p>解决方法1：<br> 打开这三个错误文件，找到错误代码，删去其中的-1，因为在调用的System.cc文件中并没有-1的参数的定义和类型，不清楚为什么有一个-1。<br> 最终make -j4成功</p> 
<h4><a id="2_659"></a>报错2：</h4> 
<blockquote> 
 <p>Exception CMake Error at<br> /opt/ros/melodic/share/ros/core/rosbuild/private.cmake:99 (message):<br> [rosbuild] rospack found package “ORB_SLAM3” at<br> “/opt/ros/melodic/share/ORB_SLAM3”, but the current directory is<br> “/home/llw/Guide_blind/AdaptSLAM/Sim<br> AdaptSLAM/Examples_old/ROS/ORB_SLAM3”. You should double-check your<br> ROS_PACKAGE_PATH to ensure that packages are found in the correct<br> precedence order.</p> 
</blockquote> 
<p>解决方法1:<br> 修改gedit ~/.bashrc路径,添加AdaptSLAM/Sim-AdaptSLAM/Examples_old/ROS路径</p> 
<pre><code class="prism language-bash">gedit ~/.bashrc 
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ROS_PACKAGE_PATH</span><span class="token operator">=</span><span class="token variable">${ROS_PACKAGE_PATH}</span>:/home/xxx/AdaptSLAM/Sim-AdaptSLAM/Examples_old/ROS
<span class="token builtin class-name">source</span> ~/.bashrc 
</code></pre> 
<p>解决失败。。。</p> 
<p>解决方法2：<br> 许多方案说是没设置环境变量，在bashrc或其他一些文件中加入环境变量<br> 进行检查环境变量，可我使用了解决方法1就是检查不出来<br> 后来使用之前的一个解决方案，就是重新建立了一个软链接ORB_SLAM3<br> 先到/opt/ros/melodic/share目录下，删除原来的ORB_SLAM3软连接（如果有的话）</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">rm</span> -r ORB_SLAM3
</code></pre> 
<p>在/opt/ros/melodic/share目录下建立软链接</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">ln</span> -s /home/xxx/Guide_blind/ORB_SLAM3/Examples/ROS/ORB_SLAM3 /opt/ros/melodic/share/ORB_SLAM3
</code></pre> 
<p>其实之前运行过ORB的其他变种SLAM，那时ROS就会在/opt/ros/melodic/share文件夹下建立了一个软连接ORB_SLAM3，现在的工程需要把原来的软链接换成当前你的工作空间下的路径。</p> 
<h4><a id="3_696"></a>报错3：</h4> 
<blockquote> 
 <p>CMake Error at CMakeLists.txt:37 (message): OpenCV &gt; 2.4.3 not<br> found.</p> 
</blockquote> 
<p>之前也有一个OpenCV 版本问题，直接更改CMakeLists.txt文件</p> 
<pre><code class="prism language-bash">find_package<span class="token punctuation">(</span>OpenCV <span class="token number">4.0</span> QUIET<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="4_706"></a>报错4：</h4> 
<p>不间断运行 ./build_ros.sh，会持续出现一些问题，这些问题<a href="https://blog.csdn.net/qq_45848817/article/details/123457693?csdn_share_tail=%7B%22type%22:%22blog%22,%22rType%22:%22article%22,%22rId%22:%22123457693%22,%22source%22:%22qq_45848817%22%7D">我在之间的博客有详细解决过程</a>，不过这次又有一些新的不同的报错，故重新做一个记录。</p> 
<p><strong>问题一：</strong><br> <img src="https://images2.imgbox.com/5c/0c/foQtUWS0_o.png" alt="在这里插入图片描述"><br> 提示找不到sophus库，修改Examples/ROS/ORB_SLAM3下的CMAKELISTS中添加修改为</p> 
<pre><code class="prism language-bash"><span class="token variable">${PROJECT_SOURCE_DIR}</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>/Thirdparty/Sophus
</code></pre> 
<p><strong>问题二：</strong></p> 
<blockquote> 
 <p>AdaptSLAM/Sim-AdaptSLAM/Examples_old/ROS/ORB_SLAM3/src/AR/ros_mono_ar.cc:151:41:<br> error: conversion from ‘Sophus::SE3f {aka Sophus::SE3}’ to<br> non-scalar type ‘cv::Mat’ requested<br> cv::Mat Tcw = mpSLAM-&gt;TrackMonocular(cv_ptr-&gt;image,cv_ptr-&gt;header.stamp.toSec());<br> #include &lt;Eigen/Dense&gt;<br> #include &lt;opencv2/core/eigen.hpp&gt;</p> 
</blockquote> 
<p>删除ROS/ORB_SLAM3/src/AR/ros_mono_ar.cc第151行，由下面内容替换</p> 
<pre><code class="prism language-bash">cv::Mat Tcw<span class="token punctuation">;</span>
Sophus::SE3f Tcw_SE3f <span class="token operator">=</span> mpSLAM-<span class="token operator">&gt;</span>TrackMonocular<span class="token punctuation">(</span>cv_ptr-<span class="token operator">&gt;</span>image,cv_ptr-<span class="token operator">&gt;</span>header.stamp.toSec<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span>
Eigen::Matrix4f Tcw_Matrix <span class="token operator">=</span> Tcw_SE3f.matrix<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
cv::eigen2cv<span class="token punctuation">(</span>Tcw_Matrix, Tcw<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>引入两个头文件</p> 
<blockquote> 
 <p>#include &lt;Eigen/Dense&gt;<br> #include &lt;opencv2/core/eigen.hpp&gt;</p> 
</blockquote> 
<p><strong>问题三：</strong></p> 
<blockquote> 
 <p>AdaptSLAM/Sim-AdaptSLAM/Examples_old/ROS/ORB_SLAM3/src/AR/ViewerAR.cc:<br> In member function ‘void ORB_SLAM3::Plane::Recompute()’:<br> /home/llw/Guide_blind/AdaptSLAM/Sim-AdaptSLAM/Examples_old/ROS/ORB_SLAM3/src/AR/ViewerAR.cc:530:42:<br> error: conversion from ‘Eigen::Vector3f {aka Eigen::Matrix&lt;float, 3,<br> 1&gt;}’ to non-scalar type ‘cv::Mat’ requested<br> cv::Mat Xw = pMP-&gt;GetWorldPos();</p> 
</blockquote> 
<p>删除ROS/ORB_SLAM3/src/AR/ViewerAR.cc第530行，由以下内容替换</p> 
<pre><code class="prism language-bash">cv::Mat Xw<span class="token punctuation">;</span>
cv::eigen2cv<span class="token punctuation">(</span>pMP-<span class="token operator">&gt;</span>GetWorldPos<span class="token punctuation">(</span><span class="token punctuation">)</span>, Xw<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>引入两个头文件</p> 
<blockquote> 
 <p>#include &lt;Eigen/Dense&gt;<br> #include &lt;opencv2/core/eigen.hpp&gt;</p> 
</blockquote> 
<p><strong>问题四：</strong></p> 
<blockquote> 
 <p>error: no matching function for call to<br> ‘std::vectorcv::Mat::push_back(Eigen::Vector3f)’<br> vPoints.push_back(pMP-&gt;GetWorldPos());</p> 
</blockquote> 
<p>删除ROS/ORB_SLAM3/src/AR/ViewerAR.cc第408行，由以下内容替换</p> 
<pre><code class="prism language-bash">cv::Mat WorldPos<span class="token punctuation">;</span>
cv::eigen2cv<span class="token punctuation">(</span>pMP-<span class="token operator">&gt;</span>GetWorldPos<span class="token punctuation">(</span><span class="token punctuation">)</span>, WorldPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
vPoints.push_back<span class="token punctuation">(</span>WorldPos<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>引入两个头文件</p> 
<blockquote> 
 <p>#include &lt;Eigen/Dense&gt;<br> #include &lt;opencv2/core/eigen.hpp&gt;</p> 
</blockquote> 
<p><strong>问题五：</strong></p> 
<blockquote> 
 <p>/home/llw/Guide_blind/AdaptSLAM/Sim-AdaptSLAM/Examples_old/ROS/ORB_SLAM3/src/ros_mono_inertial.cc:<br> In member function ‘void ImageGrabber::SyncWithImu()’:<br> /home/llw/Guide_blind/AdaptSLAM/Sim-AdaptSLAM/Examples_old/ROS/ORB_SLAM3/src/ros_mono_inertial.cc:178:48: error: no matching function for call to<br> ‘ORB_SLAM3::System::TrackMonocular(cv::Mat&amp;, double&amp;, int,<br> std::vector&lt;ORB_SLAM3::IMU::Point&gt;&amp;)’<br> mpSLAM-&gt;TrackMonocular(im,tIm,-1,vImuMeas);</p> 
</blockquote> 
<p>和上面一样找到错误代码，删去其中的-1，因为在调用的System.cc文件中并没有-1的参数的定义和类型，不清楚为什么有一个-1。</p> 
<p><strong>问题六：</strong></p> 
<blockquote> 
 <p>/usr/bin/ld: warning: libopencv_xxx.so.3.4, needed by…/…/…/…/lib/libORB_SLAM3.so, not found (try using -rpath or-rpath-link)</p> 
</blockquote> 
<blockquote> 
 <p>…/…/…/…/lib/libORB_SLAM3.so：对‘cv::xxx’未定义的引用</p> 
</blockquote> 
<p>一步错步步错，在C语言中cv::xxx是opencv3.x的库与函数，但是我在之前edgeSLAM的尝试中，把ros的opencv3.2删除了，现在调用的是opencv4，所以我需要重新搭建ros环境才能解决这个问题。</p> 
<h4><a id="ROS_795"></a>重装ROS</h4> 
<p>输入以下命令逐步卸载ros即可。</p> 
<pre><code class="prism language-bash">//先卸载ros包
<span class="token function">sudo</span> <span class="token function">apt-get</span> purge ros-*
//删除ros相关依赖和配置
<span class="token function">sudo</span> <span class="token function">apt-get</span> autoremove
</code></pre> 
<p>使用一个脚本命令直接安装ROS，非常小白，不过需要注意脚本安装时的选项选择。</p> 
<pre><code class="prism language-bash"><span class="token function">wget</span> http://fishros.com/install -O fishros <span class="token operator">&amp;&amp;</span> <span class="token builtin class-name">.</span> fishros
</code></pre> 
<p>脚本安装完后，直接跳到这篇博客的6.rosdep init 初始化步骤直到画海龟。</p> 
<p>虚拟环境中的QT环境冲突<br> 比如anaconda创建的虚拟环境中存在pyqt，与cv2里自带的libqxcb.so版本冲突，而使用cv2.imshow时优先选择了pyqt中的libqxcb.so，就会导致上面的加载错误。</p> 
<p>解决方法也很简单，把anaconda中的pyqt卸载：</p> 
<pre><code class="prism language-bash">conda remove pyqt5
pip uninstall pyqt5
</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/03bc05aad0c500b312c5318317fb8edb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python项目部署上线</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0483cd51101063fad9cbb67a06c48a97/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Jquery基本实现</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>