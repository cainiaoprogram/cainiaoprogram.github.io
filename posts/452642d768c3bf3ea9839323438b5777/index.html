<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>commons-net FTP大文件上传 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="commons-net FTP大文件上传" />
<meta property="og:description" content="最近公司要做FTP大文件上传，自己摸索搞了好几天，终于弄好了 以后还能用
package com.uiotsoft.unisiot.util; import org.apache.commons.logging.Log; import org.apache.commons.logging.LogFactory; import org.apache.commons.net.ftp.FTP; import org.apache.commons.net.ftp.FTPClient; import org.apache.commons.net.ftp.FTPClientConfig; import org.apache.commons.net.ftp.FTPReply; import java.io.*; import java.net.SocketException; import java.text.SimpleDateFormat; import java.util.Properties; /** * Created by IntelliJ IDEA. * * @author leizhimin 2008-9-12 10:32:39 */ public class FtpConManager { public static Log logger = LogFactory.getLog(FtpConManager.class); private static String userName = &#34;user_mina&#34;; //FTP 登录用户名 private static String password = &#34;123&#34;; //FTP 登录密码 private static String ip = &#34;203.171.237.75&#34;; //FTP 服务器地址IP地址 private static int port = 21; //FTP 端口 private static Properties property = null; //属性集 private static String configFile = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/452642d768c3bf3ea9839323438b5777/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-12-10T14:45:53+08:00" />
<meta property="article:modified_time" content="2014-12-10T14:45:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">commons-net FTP大文件上传</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>最近公司要做FTP大文件上传，自己摸索搞了好几天，终于弄好了 以后还能用</p> 
<p>package com.uiotsoft.unisiot.util; <br> <br> <br> import org.apache.commons.logging.Log; <br> import org.apache.commons.logging.LogFactory; <br> import org.apache.commons.net.ftp.FTP; <br> import org.apache.commons.net.ftp.FTPClient; <br> import org.apache.commons.net.ftp.FTPClientConfig; <br> import org.apache.commons.net.ftp.FTPReply; <br> <br> <br> import java.io.*; <br> import java.net.SocketException; <br> import java.text.SimpleDateFormat; <br> import java.util.Properties; <br> <br> <br> /** <br> * Created by IntelliJ IDEA. <br> * <br> * @author leizhimin 2008-9-12 10:32:39 <br> */ <br> public class FtpConManager { <br>         public static Log logger = LogFactory.getLog(FtpConManager.class); <br> <br> <br>         private static String userName = "user_mina";         //FTP 登录用户名 <br>         private static String password = "123";         //FTP 登录密码 <br>         private static String ip = "203.171.237.75";                     //FTP 服务器地址IP地址 <br>         private static int port = 21;                        //FTP 端口 <br>         private static Properties property = null;    //属性集 <br>         private static String configFile = "E:\\test\\comftp\\ftpconfig.properties";    //配置文件的路径名 <br>         private static FTPClient ftpClient = null; //FTP 客户端代理 <br>         //时间格式化 <br>         private static SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd hh:mm"); <br>         //FTP状态码 <br>         public static int i = 1; <br> <br> <br>         public static void main(String[] args) { <br>                 connectServer(); <br>                 setFileType(FTP.BINARY_FILE_TYPE);// 设置传输二进制文件 <br>                 uploadFile(new File("D:\\UnisioFz.rar"),new File("D:\\UnisioFz.rar"),"");<br> //                uploadManyFile(new File("C:\\ooo\\upx"), new File("C:\\ooo\\upx"), "/admin/ttt"); <br>                 closeConnect();// 关闭连接 <br>         } <br> <br> <br>         /** <br>          * 上传单个文件，并重命名 <br>          * <br>          * @param localFile--本地文件路径 <br>          * @param distFolder--新的文件名,可以命名为空"" <br>          * @return true 上传成功，false 上传失败 <br>          */ <br>         public static boolean uploadFile(File localFile, final File localRootFile, final String distFolder) { <br>                 System.out.println("                    -------------------------"); <br>                 boolean flag = true; <br>                 try { <br>                         connectServer(); <br>                         ftpClient.setFileType(FTP.BINARY_FILE_TYPE); <br>                         ftpClient.enterLocalPassiveMode(); <br>                         ftpClient.setFileTransferMode(FTP.STREAM_TRANSFER_MODE); <br>                         InputStream input = new FileInputStream(localFile); <br> //                        if (input == null) { <br> //                                System.out.println("本地文件"+localFile.getPath()+"不存在!"); <br> //                        } <br> //                        if (newFileName.trim().equals("")) { <br> //                                newFileName = localFile.getName(); <br> //                        } <br> <br> <br>                         String furi1 = localFile.getParentFile().getAbsoluteFile().toURI().toString(); <br>                         String furi2 = localRootFile.getParentFile().getAbsoluteFile().toURI().toString(); <br> <br> <br>                         String objFolder = distFolder + File.separator + furi1.substring(furi2.length()); <br> <br> <br>                         ftpClient.changeWorkingDirectory("/"); <br>                         ftpClient.makeDirectory(objFolder); <br>                         System.out.println("a&gt;&gt;&gt;&gt;&gt;&gt;&gt; : " + distFolder + File.separator + localFile.getParent()); <br>                         System.out.println("x&gt;&gt;&gt;&gt;&gt;&gt;&gt; : " + objFolder); <br>                         ftpClient.changeWorkingDirectory(objFolder); <br> <br> <br>                         System.out.println("b&gt;&gt;&gt;&gt;&gt;&gt;&gt; : " + localFile.getPath() + " " + ftpClient.printWorkingDirectory()); <br>                         flag = ftpClient.storeFile(localFile.getName(), input); <br>                         if (flag) { <br>                                 System.out.println("上传文件成功！"); <br>                         } else { <br>                                 System.out.println("上传文件失败！"); <br>                         } <br>                         input.close(); <br>                 } catch (IOException e) { <br>                         e.printStackTrace(); <br>                         logger.debug("本地文件上传失败！", e); <br>                 } catch (Exception e) { <br>                         e.printStackTrace(); <br>                 } <br>                 return flag; <br>         } <br>         /** <br>          * 上传单个文件，并重命名 <br>          * <br>          * @param input--表单中上传文件获取的流，适用于web项目表单直接提交文件调用方法<br>          * @param distFolder--新的文件名,可以命名为空"" <br>          * @return true 上传成功，false 上传失败 <br>          */ <br>         public static boolean uploadFile1(InputStream input, String distFolder) { <br>                 System.out.println("                    -------------------------"); <br>                 boolean flag = true; <br>                 try { <br>                         connectServer(); <br>                         ftpClient.setFileType(FTP.BINARY_FILE_TYPE); <br>                         ftpClient.enterLocalPassiveMode(); <br>                         ftpClient.setFileTransferMode(FTP.STREAM_TRANSFER_MODE); <br>                        <br> //                        if (input == null) { <br> //                                System.out.println("本地文件"+localFile.getPath()+"不存在!"); <br> //                        } <br> //                        if (newFileName.trim().equals("")) { <br> //                                newFileName = localFile.getName(); <br> //                        } <br>                         ftpClient.changeWorkingDirectory("/"); <br>                         flag = ftpClient.storeFile(distFolder, input); <br>                         if (flag) { <br>                                 System.out.println("上传文件成功！"); <br>                         } else { <br>                                 System.out.println("上传文件失败！"); <br>                         } <br>                         input.close(); <br>                 } catch (IOException e) { <br>                         e.printStackTrace(); <br>                         logger.debug("本地文件上传失败！", e); <br>                 } catch (Exception e) { <br>                         e.printStackTrace(); <br>                 } <br>                 return flag; <br>         }<br>         /** <br>          * 上传多个文件 <br>          * <br>          * @param localFile--本地文件夹路径 <br>          * @return true 上传成功，false 上传失败 <br>          */ <br>         public static String uploadManyFile(String localFile) { <br>                 boolean flag = true; <br>                 StringBuffer strBuf = new StringBuffer(); <br>                 try { <br>                         connectServer(); <br>                         File file = new File(localFile);        // 在此目录中找文件 <br>                         File fileList[] = file.listFiles(); <br>                         for (File f : fileList) { <br>                                 if (f.isDirectory()) {            // 文件夹中还有文件夹 <br>                                         uploadManyFile(f.getAbsolutePath()); <br>                                 } else { <br>                                 } <br>                                 if (!flag) { <br>                                         strBuf.append(f.getName() + "\r\n"); <br>                                 } <br>                         } <br>                         System.out.println(strBuf.toString()); <br>                 } catch (NullPointerException e) { <br>                         e.printStackTrace(); <br>                 } catch (Exception e) { <br>                         e.printStackTrace(); <br>                         logger.debug("本地文件上传失败！", e); <br>                 } <br>                 return strBuf.toString(); <br>         } <br> <br> <br>         /** <br>          * 上传多个文件 <br>          * <br>          * @param localFile,--本地文件夹路径 <br>          * @param distFolder--目标路径 <br>          * @return true 上传成功，false 上传失败 <br>          */ <br>         public static String uploadManyFile(File localFile, final File localRootFile, final String distFolder) { <br>                 System.out.println("-------------------------"); <br>                 boolean flag = true; <br>                 StringBuffer strBuf = new StringBuffer(); <br>                 int n = 0; <br>                 try { <br>                         connectServer(); <br>                         ftpClient.makeDirectory(distFolder + File.separator + localFile.getParent()); <br>                         File fileList[] = localFile.listFiles(); <br>                         for (File upfile : fileList) { <br>                                 if (upfile.isDirectory()) {// 文件夹中还有文件夹 <br>                                         uploadManyFile(upfile, localRootFile, distFolder); <br>                                 } else { <br>                                         flag = uploadFile(upfile, localRootFile, distFolder); <br>                                 } <br>                                 if (!flag) { <br>                                         strBuf.append(upfile.getName() + "\r\n"); <br>                                 } <br>                         } <br>                         System.out.println(strBuf.toString()); <br>                 } catch (NullPointerException e) { <br>                         e.printStackTrace(); <br>                         logger.debug("本地文件上传失败！找不到上传文件！", e); <br>                 } catch (Exception e) { <br>                         e.printStackTrace(); <br>                         logger.debug("本地文件上传失败！", e); <br>                 } <br>                 return strBuf.toString(); <br>         } <br> <br> <br>         /** <br>          * 下载文件 <br>          * <br>          * @param remoteFileName             --服务器上的文件名 <br>          * @param localFileName--本地文件名 <br>          * @return true 下载成功，false 下载失败 <br>          */ <br>         public static boolean loadFile(String remoteFileName, String localFileName) { <br>                 boolean flag = true; <br>                 connectServer(); <br>                 // 下载文件 <br>                 BufferedOutputStream buffOut = null; <br>                 try { <br>                         buffOut = new BufferedOutputStream(new FileOutputStream(localFileName)); <br>                         flag = ftpClient.retrieveFile(remoteFileName, buffOut); <br>                 } catch (Exception e) { <br>                         e.printStackTrace(); <br>                         logger.debug("本地文件下载失败！", e); <br>                 } finally { <br>                         try { <br>                                 if (buffOut != null) <br>                                         buffOut.close(); <br>                         } catch (Exception e) { <br>                                 e.printStackTrace(); <br>                         } <br>                 } <br>                 return flag; <br>         } <br> <br> <br>         /** <br>          * 删除一个文件 <br>          */ <br>         public static boolean deleteFile(String filename) { <br>                 boolean flag = true; <br>                 try { <br>                         connectServer(); <br>                         flag = ftpClient.deleteFile(filename); <br>                         if (flag) { <br>                                 System.out.println("删除文件成功！"); <br>                         } else { <br>                                 System.out.println("删除文件失败！"); <br>                         } <br>                 } catch (IOException ioe) { <br>                         ioe.printStackTrace(); <br>                 } <br>                 return flag; <br>         } <br> <br> <br>         /** <br>          * 删除目录 <br>          */ <br>         public static void deleteDirectory(String pathname) { <br>                 try { <br>                         connectServer(); <br>                         File file = new File(pathname); <br>                         if (file.isDirectory()) { <br>                                 File file2[] = file.listFiles(); <br>                         } else { <br>                                 deleteFile(pathname); <br>                         } <br>                         ftpClient.removeDirectory(pathname); <br>                 } catch (IOException ioe) { <br>                         ioe.printStackTrace(); <br>                 } <br>         } <br> <br> <br>         /** <br>          * 删除空目录 <br>          */ <br>         public static void deleteEmptyDirectory(String pathname) { <br>                 try { <br>                         connectServer(); <br>                         ftpClient.removeDirectory(pathname); <br>                 } catch (IOException ioe) { <br>                         ioe.printStackTrace(); <br>                 } <br>         } <br> <br> <br>         /** <br>          * 列出服务器上文件和目录 <br>          * <br>          * @param regStr --匹配的正则表达式 <br>          */ <br>         public static void listRemoteFiles(String regStr) { <br>                 connectServer(); <br>                 try { <br>                         String files[] = ftpClient.listNames(regStr); <br>                         if (files == null || files.length == 0) <br>                                 System.out.println("没有任何文件!"); <br>                         else { <br>                                 for (int i = 0; i &lt; files.length; i++) { <br>                                         System.out.println(files[i]); <br>                                 } <br>                         } <br>                 } catch (Exception e) { <br>                         e.printStackTrace(); <br>                 } <br>         } <br> <br> <br>         /** <br>          * 列出Ftp服务器上的所有文件和目录 <br>          */ <br>         public static void listRemoteAllFiles() { <br>                 connectServer(); <br>                 try { <br>                         String[] names = ftpClient.listNames(); <br>                         for (int i = 0; i &lt; names.length; i++) { <br>                                 System.out.println(names[i]); <br>                         } <br>                 } catch (Exception e) { <br>                         e.printStackTrace(); <br>                 } <br>         } <br> <br> <br>         /** <br>          * 关闭连接 <br>          */ <br>         public static void closeConnect() { <br>                 try { <br>                         if (ftpClient != null) { <br>                                 ftpClient.logout(); <br>                                 ftpClient.disconnect(); <br>                         } <br>                 } catch (Exception e) { <br>                         e.printStackTrace(); <br>                 } <br>         } <br> <br> <br>         /** <br>          * 设置配置文件 <br>          * <br>          * @param configFile <br>          */ <br>         public static void setConfigFile(String configFile) { <br>         <span style="white-space:pre"></span>FtpConManager.configFile = configFile; <br>         } <br> <br> <br>         /** <br>          * 设置传输文件的类型[文本文件或者二进制文件] <br>          * <br>          * @param fileType--BINARY_FILE_TYPE、ASCII_FILE_TYPE <br>          * <br>          */ <br>         public static void setFileType(int fileType) { <br>                 try { <br>                         connectServer(); <br>                         ftpClient.setFileType(fileType); <br>                 } catch (Exception e) { <br>                         e.printStackTrace(); <br>                 } <br>         } <br> <br> <br>         /** <br>          * 扩展使用 <br>          * <br>          * @return ftpClient <br>          */ <br>         protected static FTPClient getFtpClient() { <br>                 connectServer(); <br>                 return ftpClient; <br>         } <br> <br> <br>         /** <br>          * 设置参数 <br>          * <br>          * @param configFile --参数的配置文件 <br>          */ <br>         private static void setArg(String configFile) { <br>                 property = new Properties(); <br>                 BufferedInputStream inBuff = null; <br>                 try { <br>                         File file = new File(configFile); <br>                         inBuff = new BufferedInputStream(new FileInputStream(file)); <br>                         property.load(inBuff); <br>                         userName = property.getProperty("username"); <br>                         password = property.getProperty("password"); <br>                         ip = property.getProperty("ip"); <br>                         port = Integer.parseInt(property.getProperty("port")); <br>                 } catch (FileNotFoundException e1) { <br>                         System.out.println("配置文件 " + configFile + " 不存在！"); <br>                 } catch (IOException e) { <br>                         System.out.println("配置文件 " + configFile + " 无法读取！"); <br>                 } <br>         } <br> <br> <br>         /** <br>          * 连接到服务器 <br>          * <br>          * @return true 连接服务器成功，false 连接服务器失败 <br>          */ <br>         public static boolean connectServer() { <br>                 boolean flag = true; <br>                 if (ftpClient == null) { <br>                         int reply; <br>                         try { <br>  //                               setArg(configFile); <br>                                 ftpClient = new FTPClient();  <br>                                 ftpClient.setControlEncoding("UTF-8"); <br>                                 ftpClient.setDefaultPort(port); <br>                                 ftpClient.configure(getFtpConfig()); <br>                                 ftpClient.connect(ip); <br>                                 ftpClient.login(userName, password); <br>                                 ftpClient.setDefaultPort(port); <br>                                 //System.out.print(ftpClient.getReplyString()); <br>                                 reply = ftpClient.getReplyCode(); <br>                                 ftpClient.setDataTimeout(120000); <br> <br> <br>                                 if (!FTPReply.isPositiveCompletion(reply)) { <br>                                         ftpClient.disconnect(); <br>                                         System.err.println("FTP server refused connection."); <br>                                         // logger.debug("FTP 服务拒绝连接！"); <br>                                         flag = false; <br>                                 } <br> //                                System.out.println(i); <br>                                 i++; <br>                         } catch (SocketException e) { <br>                                 flag = false; <br>                                 e.printStackTrace(); <br>                                 System.err.println("登录ftp服务器 " + ip + " 失败,连接超时！"); <br>                         } catch (IOException e) { <br>                                 flag = false; <br>                                 e.printStackTrace(); <br>                                 System.err.println("登录ftp服务器 " + ip + " 失败，FTP服务器无法打开！"); <br>                         } <br>                 } <br>                 return flag; <br>         } <br> <br> <br>         /** <br>          * 进入到服务器的某个目录下 <br>          * <br>          * @param directory <br>          */ <br>         public static void changeWorkingDirectory(String directory) { <br>                 try { <br>                         connectServer(); <br>                         ftpClient.changeWorkingDirectory(directory); <br>                 } catch (IOException ioe) { <br>                         ioe.printStackTrace(); <br>                 } <br>         } <br> <br> <br>         /** <br>          * 返回到上一层目录 <br>          */ <br>         public static void changeToParentDirectory() { <br>                 try { <br>                         connectServer(); <br>                         ftpClient.changeToParentDirectory(); <br>                 } catch (IOException ioe) { <br>                         ioe.printStackTrace(); <br>                 } <br>         } <br> <br> <br>         /** <br>          * 重命名文件 <br>          * <br>          * @param oldFileName --原文件名 <br>          * @param newFileName --新文件名 <br>          */ <br>         public static void renameFile(String oldFileName, String newFileName) { <br>                 try { <br>                         connectServer(); <br>                         ftpClient.rename(oldFileName, newFileName); <br>                 } catch (IOException ioe) { <br>                         ioe.printStackTrace(); <br>                 } <br>         } <br> <br> <br>         /** <br>          * 设置FTP客服端的配置--一般可以不设置 <br>          * <br>          * @return ftpConfig <br>          */ <br>         private static FTPClientConfig getFtpConfig() { <br>                 FTPClientConfig ftpConfig = new FTPClientConfig(FTPClientConfig.SYST_UNIX); <br>                 ftpConfig.setServerLanguageCode(FTP.DEFAULT_CONTROL_ENCODING); <br>                 return ftpConfig; <br>         } <br> <br> <br>         /** <br>          * 转码[ISO-8859-1 -&gt; GBK] 不同的平台需要不同的转码 <br>          * <br>          * @param obj <br>          * @return "" <br>          */ <br>         private static String iso8859togbk(Object obj) { <br>                 try { <br>                         if (obj == null) <br>                                 return ""; <br>                         else <br>                                 return new String(obj.toString().getBytes("iso-8859-1"), "GBK"); <br>                 } catch (Exception e) { <br>                         return ""; <br>                 } <br>         } <br> <br> <br>         /** <br>          * 在服务器上创建一个文件夹 <br>          * <br>          * @param dir 文件夹名称，不能含有特殊字符，如 \ 、/ 、: 、* 、?、 "、 &lt;、&gt;... <br>          */ <br>         public static boolean makeDirectory(String dir) { <br>                 connectServer(); <br>                 boolean flag = true; <br>                 try { <br>                         // System.out.println("dir=======" dir); <br>                         flag = ftpClient.makeDirectory(dir); <br>                         if (flag) { <br>                                 System.out.println("make Directory " + dir + " succeed"); <br> <br> <br>                         } else { <br> <br> <br>                                 System.out.println("make Directory " + dir + " false"); <br>                         } <br>                 } catch (Exception e) { <br>                         e.printStackTrace(); <br>                 } <br>                 return flag; <br>         } <br> <br> <br> }<br> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/22903da36e51c941855fb42581e8b6e4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android – Google Play issue: “your device isn’t compatible with this version”</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ffad29c85f3bc075bd88e8fe1db32108/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">UC函数之 open</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>