<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>白嫖国内算力资源，AIStudio。谁不想完成一次算法竞赛的结果提交呢！paddledet和mmdet真的很像，上手很快 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="白嫖国内算力资源，AIStudio。谁不想完成一次算法竞赛的结果提交呢！paddledet和mmdet真的很像，上手很快" />
<meta property="og:description" content="编辑区 Markdown Cell，是Notebook中文本编辑单元，通过在Markdown Cell中输入Markdown格式的文本，可以编写文字教程说明.
命令/编辑模式
绿色代表块内容可编辑状态-编辑模式（比如输入文字），蓝色代表块可操作状态-命令模式(预览md展示样式)，编辑模式和命令模式之间可以用Esc和Enter来切换。 编辑Cell 支持插入公式、表格、图片、音乐、视频、网页等. 相关Markdown用法可以参考Markdown官网.
常用快捷键操作
模式模式快捷键(Windows)命令模式 (Esc切换)运行块Shift-Enter命令模式在下方插入块B命令模式在上方插入块A命令模式在上方插入块dd命令模式切换到编辑模式Enter编辑模式 (Enter切换)运行块Shift-Enter编辑模式缩进Ctrl-]编辑模式取消缩进Ctrl-[编辑模式注释Ctrl-/编辑模式函数内省Tab Jupyter Notebook 有两种键盘输入模式。编辑模式，允许你往单元中键入代码或文本。命令模式，键盘输入运行程序命令。
Enter : 转入编辑模式 Shift-Enter : 运行本单元，选中下个单元 Ctrl-Enter : 运行本单元 Alt-Enter : 运行本单元，在其下插入新单元 Y : 单元转入代码状态 M :单元转入markdown状态 R : 单元转入raw状态 1 : 设定 1 级标题 2 : 设定 2 级标题 3 : 设定 3 级标题 4 : 设定 4 级标题 5 : 设定 5 级标题 6 : 设定 6 级标题 Up : 选中上方单元 K : 选中上方单元 Down : 选中下方单元 J : 选中下方单元 Shift-K : 扩大选中上方单元 Shift-J : 扩大选中下方单元 A : 在上方插入新单元 B : 在下方插入新单元 X : 剪切选中的单元 C : 复制选中的单元 Shift-V : 粘贴到上方单元 V : 粘贴到下方单元 Z : 恢复删除的最后一个单元 D,D : 删除选中的单元 Shift-M : 合并选中的单元 Ctrl-S : 文件存盘 S : 文件存盘 L : 转换行号 O : 转换输出 Shift-O : 转换输出滚动 Esc : 关闭页面 Q : 关闭页面 H : 显示快捷键帮助 I,I : 中断Notebook内核 0,0 : 重启Notebook内核 Shift : 忽略 Shift-Space : 向上滚动 Space : 向下滚动 编辑模式 ( Enter 键启动)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/9b2be77058d18f3b74c92b66052585ad/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-21T16:15:32+08:00" />
<meta property="article:modified_time" content="2023-07-21T16:15:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">白嫖国内算力资源，AIStudio。谁不想完成一次算法竞赛的结果提交呢！paddledet和mmdet真的很像，上手很快</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <ul><li> <p>编辑区 Markdown Cell，是Notebook中文本编辑单元，通过在Markdown Cell中输入Markdown格式的文本，可以编写文字教程说明.</p> 
  <ul><li> <p>命令/编辑模式</p> 
    <ul><li><strong>绿色</strong>代表块内容可编辑状态-编辑模式（比如输入文字），<strong>蓝色</strong>代表块可操作状态-命令模式(预览md展示样式)，编辑模式和命令模式之间可以用Esc和Enter来切换。</li></ul> </li><li> <p>编辑Cell 支持插入公式、表格、图片、音乐、视频、网页等. 相关Markdown用法可以参考<a href="http://www.markdown.cn/" rel="nofollow">Markdown官网</a>.</p> </li><li> <p>常用快捷键操作</p> </li><li> 
    <table><thead><tr><th>模式</th><th>模式</th><th>快捷键(Windows)</th></tr></thead><tbody><tr><td>命令模式 (Esc切换)</td><td>运行块</td><td>Shift-Enter</td></tr><tr><td>命令模式</td><td>在下方插入块</td><td>B</td></tr><tr><td>命令模式</td><td>在上方插入块</td><td>A</td></tr><tr><td>命令模式</td><td>在上方插入块</td><td>dd</td></tr><tr><td>命令模式</td><td>切换到编辑模式</td><td>Enter</td></tr><tr><td>编辑模式 (Enter切换)</td><td>运行块</td><td>Shift-Enter</td></tr><tr><td>编辑模式</td><td>缩进</td><td>Ctrl-]</td></tr><tr><td>编辑模式</td><td>取消缩进</td><td>Ctrl-[</td></tr><tr><td>编辑模式</td><td>注释</td><td>Ctrl-/</td></tr><tr><td>编辑模式</td><td>函数内省</td><td>Tab</td></tr></tbody></table></li><li> <p>Jupyter Notebook 有两种键盘输入模式。编辑模式，允许你往单元中键入代码或文本。命令模式，键盘输入运行程序命令。</p> </li><li> <pre><code class="prism language-shell">Enter <span class="token builtin class-name">:</span> 转入编辑模式
Shift-Enter <span class="token builtin class-name">:</span> 运行本单元，选中下个单元
Ctrl-Enter <span class="token builtin class-name">:</span> 运行本单元
Alt-Enter <span class="token builtin class-name">:</span> 运行本单元，在其下插入新单元
Y <span class="token builtin class-name">:</span> 单元转入代码状态
M :单元转入markdown状态
R <span class="token builtin class-name">:</span> 单元转入raw状态
<span class="token number">1</span> <span class="token builtin class-name">:</span> 设定 <span class="token number">1</span> 级标题
<span class="token number">2</span> <span class="token builtin class-name">:</span> 设定 <span class="token number">2</span> 级标题
<span class="token number">3</span> <span class="token builtin class-name">:</span> 设定 <span class="token number">3</span> 级标题
<span class="token number">4</span> <span class="token builtin class-name">:</span> 设定 <span class="token number">4</span> 级标题
<span class="token number">5</span> <span class="token builtin class-name">:</span> 设定 <span class="token number">5</span> 级标题
<span class="token number">6</span> <span class="token builtin class-name">:</span> 设定 <span class="token number">6</span> 级标题
Up <span class="token builtin class-name">:</span> 选中上方单元
K <span class="token builtin class-name">:</span> 选中上方单元
Down <span class="token builtin class-name">:</span> 选中下方单元
J <span class="token builtin class-name">:</span> 选中下方单元
Shift-K <span class="token builtin class-name">:</span> 扩大选中上方单元
Shift-J <span class="token builtin class-name">:</span> 扩大选中下方单元
A <span class="token builtin class-name">:</span> 在上方插入新单元
B <span class="token builtin class-name">:</span> 在下方插入新单元
X <span class="token builtin class-name">:</span> 剪切选中的单元
C <span class="token builtin class-name">:</span> 复制选中的单元
Shift-V <span class="token builtin class-name">:</span> 粘贴到上方单元
V <span class="token builtin class-name">:</span> 粘贴到下方单元
Z <span class="token builtin class-name">:</span> 恢复删除的最后一个单元
D,D <span class="token builtin class-name">:</span> 删除选中的单元
Shift-M <span class="token builtin class-name">:</span> 合并选中的单元
Ctrl-S <span class="token builtin class-name">:</span> 文件存盘
S <span class="token builtin class-name">:</span> 文件存盘
L <span class="token builtin class-name">:</span> 转换行号
O <span class="token builtin class-name">:</span> 转换输出
Shift-O <span class="token builtin class-name">:</span> 转换输出滚动
Esc <span class="token builtin class-name">:</span> 关闭页面
Q <span class="token builtin class-name">:</span> 关闭页面
H <span class="token builtin class-name">:</span> 显示快捷键帮助
I,I <span class="token builtin class-name">:</span> 中断Notebook内核
<span class="token number">0,0</span> <span class="token builtin class-name">:</span> 重启Notebook内核
Shift <span class="token builtin class-name">:</span> 忽略
Shift-Space <span class="token builtin class-name">:</span> 向上滚动
Space <span class="token builtin class-name">:</span> 向下滚动
</code></pre> </li><li> <p>编辑模式 ( Enter 键启动)</p> </li><li> <pre><code class="prism language-shell">Tab <span class="token builtin class-name">:</span> 代码补全或缩进
Shift-Tab <span class="token builtin class-name">:</span> 提示
Ctrl-<span class="token punctuation">]</span> <span class="token builtin class-name">:</span> 缩进
Ctrl-<span class="token punctuation">[</span> <span class="token builtin class-name">:</span> 解除缩进
Ctrl-A <span class="token builtin class-name">:</span> 全选
Ctrl-Z <span class="token builtin class-name">:</span> 复原
Ctrl-Shift-Z <span class="token builtin class-name">:</span> 再做
Ctrl-Y <span class="token builtin class-name">:</span> 再做
Ctrl-Home <span class="token builtin class-name">:</span> 跳到单元开头
Ctrl-Up <span class="token builtin class-name">:</span> 跳到单元开头
Ctrl-End <span class="token builtin class-name">:</span> 跳到单元末尾
Ctrl-Down <span class="token builtin class-name">:</span> 跳到单元末尾
Ctrl-Left <span class="token builtin class-name">:</span> 跳到左边一个字首
Ctrl-Right <span class="token builtin class-name">:</span> 跳到右边一个字首
Ctrl-Backspace <span class="token builtin class-name">:</span> 删除前面一个字
Ctrl-Delete <span class="token builtin class-name">:</span> 删除后面一个字
Esc <span class="token builtin class-name">:</span> 进入命令模式
Ctrl-M <span class="token builtin class-name">:</span> 进入命令模式
Shift-Enter <span class="token builtin class-name">:</span> 运行本单元，选中下一单元
Ctrl-Enter <span class="token builtin class-name">:</span> 运行本单元
Alt-Enter <span class="token builtin class-name">:</span> 运行本单元，在下面插入一单元
Ctrl-Shift-- <span class="token builtin class-name">:</span> 分割单元
Ctrl-Shift-Subtract <span class="token builtin class-name">:</span> 分割单元
Ctrl-S <span class="token builtin class-name">:</span> 文件存盘
Shift <span class="token builtin class-name">:</span> 忽略
Up <span class="token builtin class-name">:</span> 光标上移或转入上一单元
Down :光标下移或转入下一单元
</code></pre> </li><li> <p>终端：用户可以使用终端来进行一些操作, 与Notebook主界面并行, 例如查询GPU占用率. 或进行文本编辑.</p> </li></ul> </li><li> <p>输电通道隐患主要是指鸟巢、导线异物（气球、风筝、垃圾等），这些异物可能导致输电线路出现短路、接地等故障，导致线路停电，影响供电可靠性和稳定性。为解决大量无人机拍摄的输配电线路图片识别缺陷和隐患人力成本高、效率低的问题，人工智能技术在能源行业被大量运用。基于无人机拍摄的图像和深度学习技术，自动化查找隐患、准确定位、返回检测结果并进行可视化。</p> 
  <ul><li> <p>需要找到存在缺陷的图片，并准确定位缺陷位置、标明缺陷类型；</p> </li><li> <p>缺陷形式多样，对算法鲁棒性要求高，例如气球样式多、垃圾种类多；</p> </li><li> <p>异物与设备位置关系多样，例如部分风筝并未直接接触导线，而是通过风筝线与导线连接。</p> </li></ul> </li><li> <p>评价指标</p> 
  <ul><li> <p>精确率(Precision)：即真正例(TP)占所有被分类为正例(TP+FP)的比例，公式为: Precision = TP / (TP + FP)</p> </li><li> <p>召回率(Recall)：即真正例(TP)占所有真实正例(TP+FN)的比例，公式为: Recall = TP / (TP + FN)</p> </li><li> <p>F1-Score：综合Precision和Recall，公式为： F1-Score = (2 * Precision * Recall) / (Precision + Recall)</p> </li></ul> </li><li> <p>数据集来源多个渠道，使用高清摄像机、普通摄像机等多种设备拍摄。数据来自各类型输电线路设备，背景包括城市、乡村、山地、道路、农田等。 数据集包含1000张输电通道图像，大小约为3GB，由比赛选手自行拆分训练集和验证集。数据集中目标的种类包括鸟巢、风筝、气球、垃圾，图片为jpg格式，标注文件为xml格式。数据集中每个目标都被标注了专业准确的边界框和类别。 数据集的独特优势在于：数据来源广泛、数量庞大、种类清晰、边界框标注准确。这些特点使得该数据集适用于复杂场景下的隐患目标检测算法的开发和应用。同时，数据量足够大，可以有效提高算法的鲁棒性和泛化性能，从而达到更好的应用效果。 参赛者可以基于该数据集进行算法的训练和测试，并结合数据集的独特特点进行算法设计，以期达到更好的检测效果和性能<a href="https://aistudio.baidu.com/aistudio/projectdetail/6559880?forkThirdPart=1" rel="nofollow">第二届琶洲算法大赛南方电网baseline</a>。</p> </li><li> <p>数据说明，具体格式说明如下：</p> 
  <ul><li> <p>文件名称说明： <strong>数据集中的图像文件以“.jpg”为后缀，标注文件同名，只是后缀名为“.xml”</strong>。</p> </li><li> <p>文件编码说明： 标注文件采用UTF-8编码。</p> </li><li> <p>文件中的数据格式说明： 标注文件采用XML格式，格式如下：</p> </li><li> <pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>annotation</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filename</span><span class="token punctuation">&gt;</span></span> 0000001.jpg<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filename</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>size</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>width</span><span class="token punctuation">&gt;</span></span>1080<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>width</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>height</span><span class="token punctuation">&gt;</span></span>1080<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>height</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>depth</span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>depth</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>size</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>object</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>balloon<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bndbox</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>xmin</span><span class="token punctuation">&gt;</span></span>100<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>xmin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ymin</span><span class="token punctuation">&gt;</span></span>200<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ymin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>xmax</span><span class="token punctuation">&gt;</span></span>300<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>xmax</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ymax</span><span class="token punctuation">&gt;</span></span>400<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ymax</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bndbox</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>object</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>object</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>trash<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bndbox</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>xmin</span><span class="token punctuation">&gt;</span></span>700<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>xmin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ymin</span><span class="token punctuation">&gt;</span></span>500<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ymin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>xmax</span><span class="token punctuation">&gt;</span></span>800<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>xmax</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ymax</span><span class="token punctuation">&gt;</span></span>700<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ymax</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bndbox</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>object</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>annotation</span><span class="token punctuation">&gt;</span></span>
</code></pre> </li><li> <p>标注文件中各字段含义：</p> </li><li> 
    <table><thead><tr><th align="center">&lt; filename &gt;</th><th align="center">每张图像对应的文件名，格式为“xxx.jpg”</th></tr></thead><tbody><tr><td align="center">&lt; size &gt;</td><td align="center">存放图像尺寸信息，包括宽、高、通道数</td></tr><tr><td align="center">&lt; object &gt;</td><td align="center">存放检测到的目标信息</td></tr><tr><td align="center">&lt; name &gt;</td><td align="center">存放目标类别名称</td></tr><tr><td align="center">&lt; bndbox &gt;</td><td align="center">存放目标的位置信息</td></tr><tr><td align="center">&lt; xmin &gt;</td><td align="center">目标边界框左上角的横坐标</td></tr><tr><td align="center">&lt; ymin &gt;</td><td align="center">目标边界框左上角的纵坐标</td></tr><tr><td align="center">&lt; xmax &gt;</td><td align="center">目标边界框右下角的横坐标</td></tr><tr><td align="center">&lt; ymax &gt;</td><td align="center">目标边界框右下角的纵坐标</td></tr></tbody></table></li></ul> </li><li> <p>训练环境准备,paddledet</p> 
  <ul><li> <pre><code class="prism language-shell"><span class="token operator">!</span>git clone https://gitee.com/paddlepaddle/PaddleDetection.git <span class="token parameter variable">-b</span> develop
</code></pre> </li></ul> </li><li> <p>下载数据集（网盘后面给），并解压</p> 
  <ul><li> <pre><code class="prism language-shell"><span class="token operator">!</span>unzip <span class="token parameter variable">-oq</span> ~/data/train.zip <span class="token parameter variable">-d</span> ~/PaddleDetection/dataset/voc
<span class="token operator">!</span>unzip <span class="token parameter variable">-oq</span> ~/data/val.zip <span class="token parameter variable">-d</span> ~/PaddleDetection/dataset/voc
</code></pre> </li></ul> </li><li> <p>将标注和图片分开</p> </li><li> <pre><code class="prism language-shell">%cd ~/PaddleDetection/dataset/voc
<span class="token operator">!</span>mkdir JPEGImages Annotations
<span class="token operator">!</span>cp <span class="token parameter variable">-r</span> train/*.xml Annotations
<span class="token operator">!</span>cp <span class="token parameter variable">-r</span> train/*.jpg JPEGImages
</code></pre> </li><li> <p>划分数据集</p> 
  <ul><li> <pre><code class="prism language-python"><span class="token keyword">import</span> random
<span class="token keyword">import</span> os
<span class="token comment">#生成trainval.txt和val.txt</span>
random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span><span class="token number">2020</span><span class="token punctuation">)</span>
xml_dir  <span class="token operator">=</span> <span class="token string">'/home/aistudio/PaddleDetection/dataset/voc/Annotations'</span><span class="token comment">#标签文件地址</span>
img_dir <span class="token operator">=</span> <span class="token string">'/home/aistudio/PaddleDetection/dataset/voc/JPEGImages'</span><span class="token comment">#图像文件地址</span>
path_list <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> img <span class="token keyword">in</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>img_dir<span class="token punctuation">)</span><span class="token punctuation">:</span>
    img_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>img_dir<span class="token punctuation">,</span>img<span class="token punctuation">)</span>
    xml_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>xml_dir<span class="token punctuation">,</span>img<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'jpg'</span><span class="token punctuation">,</span> <span class="token string">'xml'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    path_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>img_path<span class="token punctuation">,</span> xml_path<span class="token punctuation">)</span><span class="token punctuation">)</span>
random<span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>path_list<span class="token punctuation">)</span>
ratio <span class="token operator">=</span> <span class="token number">0.9</span>
train_f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/home/aistudio/PaddleDetection/dataset/voc/trainval.txt'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token comment">#生成训练文件</span>
val_f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/home/aistudio/PaddleDetection/dataset/voc/val.txt'</span> <span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span><span class="token comment">#生成验证文件</span>

<span class="token keyword">for</span> i <span class="token punctuation">,</span>content <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>path_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
    img<span class="token punctuation">,</span> xml <span class="token operator">=</span> content
    text <span class="token operator">=</span> img <span class="token operator">+</span> <span class="token string">' '</span> <span class="token operator">+</span> xml <span class="token operator">+</span> <span class="token string">'\n'</span>
    <span class="token keyword">if</span> i <span class="token operator">&lt;</span> <span class="token builtin">len</span><span class="token punctuation">(</span>path_list<span class="token punctuation">)</span> <span class="token operator">*</span> ratio<span class="token punctuation">:</span>
        train_f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        val_f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
train_f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
val_f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#生成标签文档</span>
label <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'nest'</span><span class="token punctuation">,</span> <span class="token string">'kite'</span><span class="token punctuation">,</span> <span class="token string">'balloon'</span><span class="token punctuation">,</span> <span class="token string">'trash'</span><span class="token punctuation">]</span><span class="token comment">#设置你想检测的类别</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/home/aistudio/PaddleDetection/dataset/voc/label_list.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    <span class="token keyword">for</span> text <span class="token keyword">in</span> label<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>text<span class="token operator">+</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
</code></pre> </li></ul> </li><li> <p>VOC2COCO，若需要COCO数据集格式，可以运行以下命令进行转换,将数据集的属性改动一下，符合提交要求</p> </li><li> <pre><code class="prism language-python"><span class="token keyword">import</span> os
<span class="token keyword">import</span> os<span class="token punctuation">.</span>path
<span class="token keyword">import</span> xml<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>minidom
path <span class="token operator">=</span> <span class="token string">r'/home/aistudio/PaddleDetection/dataset/voc/Annotations'</span>
files <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span>  <span class="token comment"># 得到文件夹下所有文件名称</span>
s <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
count <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> xmlFile <span class="token keyword">in</span> files<span class="token punctuation">:</span>  <span class="token comment"># 遍历文件夹</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>isdir<span class="token punctuation">(</span>xmlFile<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 判断是否是文件夹,不是文件夹才打开</span>
            name1 <span class="token operator">=</span> xmlFile<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            dom <span class="token operator">=</span> xml<span class="token punctuation">.</span>dom<span class="token punctuation">.</span>minidom<span class="token punctuation">.</span>parse<span class="token punctuation">(</span>path <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> xmlFile<span class="token punctuation">)</span>
            root <span class="token operator">=</span> dom<span class="token punctuation">.</span>documentElement
            newfolder <span class="token operator">=</span> root<span class="token punctuation">.</span>getElementsByTagName<span class="token punctuation">(</span><span class="token string">'folder'</span><span class="token punctuation">)</span>
            newpath <span class="token operator">=</span> root<span class="token punctuation">.</span>getElementsByTagName<span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
            newfilename <span class="token operator">=</span> root<span class="token punctuation">.</span>getElementsByTagName<span class="token punctuation">(</span><span class="token string">'filename'</span><span class="token punctuation">)</span>
            newfilename<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>firstChild<span class="token punctuation">.</span>data <span class="token operator">=</span> name1 <span class="token operator">+</span> <span class="token string">'.jpg'</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>path<span class="token punctuation">,</span> xmlFile<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fh<span class="token punctuation">:</span>
                dom<span class="token punctuation">.</span>writexml<span class="token punctuation">(</span>fh<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'写入成功'</span><span class="token punctuation">)</span>
            count <span class="token operator">=</span> count <span class="token operator">+</span> <span class="token number">1</span>
</code></pre> </li><li> <p>将训练集转化为coco格式</p> </li><li> <pre><code class="prism language-shell">%cd ~/PaddleDetection
<span class="token operator">!</span>python tools/x2coco.py <span class="token punctuation">\</span>
        <span class="token parameter variable">--dataset_type</span> voc <span class="token punctuation">\</span>
        <span class="token parameter variable">--voc_anno_dir</span> dataset/voc/Annotations/ <span class="token punctuation">\</span>
        <span class="token parameter variable">--voc_anno_list</span> dataset/voc/trainval.txt <span class="token punctuation">\</span>
        <span class="token parameter variable">--voc_label_list</span> dataset/voc/label_list.txt <span class="token punctuation">\</span>
        <span class="token parameter variable">--voc_out_name</span> dataset/voc/train.json
</code></pre> </li><li> <p>将验证集转化为coco格式</p> </li><li> <pre><code class="prism language-shell">%cd ~/PaddleDetection
<span class="token operator">!</span>python tools/x2coco.py <span class="token punctuation">\</span>
        <span class="token parameter variable">--dataset_type</span> voc <span class="token punctuation">\</span>
        <span class="token parameter variable">--voc_anno_dir</span> dataset/voc/Annotations/ <span class="token punctuation">\</span>
        <span class="token parameter variable">--voc_anno_list</span> dataset/voc/val.txt <span class="token punctuation">\</span>
        <span class="token parameter variable">--voc_label_list</span> dataset/voc/label_list.txt <span class="token punctuation">\</span>
        <span class="token parameter variable">--voc_out_name</span> dataset/voc/val.json
</code></pre> </li><li> <p>数据查看与分析，在切图前，我们首先需要统计所用数据集标注框的平均宽高占图片真实宽高的比例分布（百度ai智能云中台也有分析数据的功能）：</p> 
  <ul><li> <p>–json_path ：待统计数据集COCO 格式 annotation 的json文件路径</p> </li><li> <p>–out_img ：输出的统计分布图路径</p> </li><li> <pre><code class="prism language-shell"><span class="token operator">!</span>pip <span class="token function">install</span> <span class="token parameter variable">-U</span> pycocotools
<span class="token operator">!</span>python tools/box_distribution.py <span class="token punctuation">\</span>
    <span class="token parameter variable">--json_path</span> dataset/voc/train.json <span class="token punctuation">\</span>
    <span class="token parameter variable">--out_img</span> /home/aistudio/PaddleDetection/dataset/voc/box_distribution.jpg
</code></pre> </li></ul> 
  <ul><li> <p><img src="https://images2.imgbox.com/84/3a/P5rXUDy8_o.png" alt="在这里插入图片描述"></p> </li><li> <pre><code class="prism language-python">loading annotations into memory<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
Done <span class="token punctuation">(</span>t<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">.</span>00s<span class="token punctuation">)</span>
creating index<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
index created!
<span class="token number">100</span><span class="token operator">%</span><span class="token operator">|</span>██████████████████████████████████████<span class="token operator">|</span> <span class="token number">727</span><span class="token operator">/</span><span class="token number">727</span> <span class="token punctuation">[</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token operator">&lt;</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">,</span> <span class="token number">52393</span><span class="token punctuation">.</span>67it<span class="token operator">/</span>s<span class="token punctuation">]</span>
Suggested reg_range<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">is</span> <span class="token number">17</span>
Mean of <span class="token builtin">all</span> img_w <span class="token keyword">is</span> <span class="token number">2833.7</span>
Mean of <span class="token builtin">all</span> img_h <span class="token keyword">is</span> <span class="token number">2021.8319444444444</span>
Median of ratio_w <span class="token keyword">is</span> <span class="token number">0.2755</span>
Median of ratio_h <span class="token keyword">is</span> <span class="token number">0.3138888888888889</span>
all_img <span class="token keyword">with</span> box<span class="token punctuation">:</span>  <span class="token number">720</span>
all_ann<span class="token punctuation">:</span>  <span class="token number">727</span>
Distribution saved <span class="token keyword">as</span> <span class="token operator">/</span>home<span class="token operator">/</span>aistudio<span class="token operator">/</span>PaddleDetection<span class="token operator">/</span>dataset<span class="token operator">/</span>voc<span class="token operator">/</span>box_distribution<span class="token punctuation">.</span>jpg
Figure<span class="token punctuation">(</span>640x480<span class="token punctuation">)</span>
</code></pre> </li></ul> </li><li> <p>基于SAHI切图，针对需要切图的数据集，使用SAHI库进行切分：</p> 
  <ul><li> <p>–image_dir：原始数据集图片文件夹的路径</p> </li><li> <p>–json_path：原始数据集COCO格式的json标注文件的路径</p> </li><li> <p>–output_dir：切分后的子图及其json标注文件保存的路径</p> </li><li> <p>–slice_size：切分以后子图的边长尺度大小(默认切图后为正方形)</p> </li><li> <p>–overlap_ratio：切分时的子图之间的重叠率</p> </li><li> <p>以上述代码为例，切分后的子图文件夹与json标注文件共同保存在MyDataset/IMG_sliced文件夹下，比如训练集图片和标注就命名为train_images_640_025、train_images_640_025.json</p> </li><li> <pre><code class="prism language-shell"><span class="token operator">!</span>mkdir dataset/voc/IMG_sliced
<span class="token operator">!</span>pip <span class="token function">install</span> <span class="token parameter variable">-U</span> scikit-image imagecodecs
</code></pre> </li></ul> 
  <ul><li> <p>对训练集标注进行切图</p> </li><li> <pre><code class="prism language-shell"><span class="token operator">!</span>python tools/slice_image.py <span class="token punctuation">\</span>
        <span class="token parameter variable">--image_dir</span> /home/aistudio/PaddleDetection/dataset/voc/JPEGImages <span class="token punctuation">\</span>
        <span class="token parameter variable">--json_path</span> /home/aistudio/PaddleDetection/dataset/voc/train.json <span class="token punctuation">\</span>
        <span class="token parameter variable">--output_dir</span> /home/aistudio/PaddleDetection/dataset/voc/IMG_sliced <span class="token punctuation">\</span>
        <span class="token parameter variable">--slice_size</span> <span class="token number">640</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">--overlap_ratio</span> <span class="token number">0.25</span>
</code></pre> </li><li> <p>对验证集标注进行切图</p> </li><li> <pre><code class="prism language-shell"><span class="token operator">!</span>python tools/slice_image.py <span class="token punctuation">\</span>
        <span class="token parameter variable">--image_dir</span> /home/aistudio/PaddleDetection/dataset/voc/JPEGImages <span class="token punctuation">\</span>
        <span class="token parameter variable">--json_path</span> /home/aistudio/PaddleDetection/dataset/voc/val.json <span class="token punctuation">\</span>
        <span class="token parameter variable">--output_dir</span> /home/aistudio/PaddleDetection/dataset/voc/IMG_sliced <span class="token punctuation">\</span>
        <span class="token parameter variable">--slice_size</span> <span class="token number">640</span> <span class="token punctuation">\</span>
        <span class="token parameter variable">--overlap_ratio</span> <span class="token number">0.25</span>
</code></pre> </li></ul> </li><li> <p>模型训练，由于图像尺寸较大，且训练模型时，读取图像和预处理时耗时较长，因此我们选择拼图模型进行训练。</p> 
  <ul><li> <p>原图模型训练：PP-YOLOE+_l在COCO test-dev2017达到了53.3的mAP, 同时其速度在Tesla V100上达到了78.1 FPS。PP-YOLOE+_s/m/x同样具有卓越的精度速度性价比, 其精度速度可以在模型库中找到。</p> </li><li> <p>拼图模型选型，PaddleDetection团队提供的基于PP-YOLOE的检测模型，以及提供了一套使用SAHI(Slicing Aided Hyper Inference)工具切图和拼图的方案，其效果如下：</p> </li><li> 
    <table><thead><tr><th align="center">模型</th><th align="center">数据集</th><th align="center">SLICE_SIZE</th><th align="center">OVERLAP_RATIO</th><th align="center">类别数</th><th align="center">mAP 0.5:0.95</th><th align="center">AP 0.5</th></tr></thead><tbody><tr><td align="center">PP-YOLOE-l</td><td align="center">VisDrone-DET</td><td align="center">640</td><td align="center">0.25</td><td align="center">10</td><td align="center">29.7</td><td align="center">48.5</td></tr><tr><td align="center">PP-YOLOE-l (Assembled)</td><td align="center">VisDrone-DET</td><td align="center">640</td><td align="center">0.25</td><td align="center">10</td><td align="center">37.2</td><td align="center">59.4</td></tr></tbody></table></li><li> <p>Assembled表示自动切图和拼图后模型的表现，从中我们可以看出，<strong>mAP较原图预测有了非常显著的提升</strong>，因此，接下来就基于PP-YOLOE-l，看看自动切图和拼图后模型在这个比赛检测数据集上的表现。</p> </li><li> <p>切图后模型的训练是要基于切图数据集的，配置如下：</p> </li><li> <pre><code class="prism language-python">metric<span class="token punctuation">:</span> COCO
num_classes<span class="token punctuation">:</span> <span class="token number">4</span>
TrainDataset<span class="token punctuation">:</span>
  !COCODataSet
    image_dir<span class="token punctuation">:</span> <span class="token operator">/</span>home<span class="token operator">/</span>aistudio<span class="token operator">/</span>PaddleDetection<span class="token operator">/</span>dataset<span class="token operator">/</span>voc<span class="token operator">/</span>IMG_sliced<span class="token operator">/</span>train_images_640_025
    anno_path<span class="token punctuation">:</span> <span class="token operator">/</span>home<span class="token operator">/</span>aistudio<span class="token operator">/</span>PaddleDetection<span class="token operator">/</span>dataset<span class="token operator">/</span>voc<span class="token operator">/</span>IMG_sliced<span class="token operator">/</span>train_640_025<span class="token punctuation">.</span>json
    dataset_dir<span class="token punctuation">:</span> <span class="token operator">/</span>home<span class="token operator">/</span>aistudio<span class="token operator">/</span>PaddleDetection<span class="token operator">/</span>dataset<span class="token operator">/</span>voc
    data_fields<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'image'</span><span class="token punctuation">,</span> <span class="token string">'gt_bbox'</span><span class="token punctuation">,</span> <span class="token string">'gt_class'</span><span class="token punctuation">,</span> <span class="token string">'is_crowd'</span><span class="token punctuation">]</span>
EvalDataset<span class="token punctuation">:</span>
  !COCODataSet
    image_dir<span class="token punctuation">:</span> <span class="token operator">/</span>home<span class="token operator">/</span>aistudio<span class="token operator">/</span>PaddleDetection<span class="token operator">/</span>dataset<span class="token operator">/</span>voc<span class="token operator">/</span>IMG_sliced<span class="token operator">/</span>val_images_640_025
    anno_path<span class="token punctuation">:</span> <span class="token operator">/</span>home<span class="token operator">/</span>aistudio<span class="token operator">/</span>PaddleDetection<span class="token operator">/</span>dataset<span class="token operator">/</span>voc<span class="token operator">/</span>IMG_sliced<span class="token operator">/</span>val_640_025<span class="token punctuation">.</span>json
    dataset_dir<span class="token punctuation">:</span> <span class="token operator">/</span>home<span class="token operator">/</span>aistudio<span class="token operator">/</span>PaddleDetection<span class="token operator">/</span>dataset<span class="token operator">/</span>voc
TestDataset<span class="token punctuation">:</span>
  !ImageFolder
    anno_path<span class="token punctuation">:</span> <span class="token operator">/</span>home<span class="token operator">/</span>aistudio<span class="token operator">/</span>PaddleDetection<span class="token operator">/</span>dataset<span class="token operator">/</span>voc<span class="token operator">/</span>IMG_sliced<span class="token operator">/</span>val_640_025<span class="token punctuation">.</span>json
    dataset_dir<span class="token punctuation">:</span> <span class="token operator">/</span>home<span class="token operator">/</span>aistudio<span class="token operator">/</span>PaddleDetection<span class="token operator">/</span>dataset<span class="token operator">/</span>voc<span class="token operator">/</span>IMG_sliced
</code></pre> </li><li> <p>执行训练</p> </li><li> <pre><code class="prism language-shell"><span class="token operator">!</span>python tools/train.py <span class="token punctuation">\</span>
    <span class="token parameter variable">-c</span> eda/eda_model/ppyoloe_crn_l_80e_sliced_eda.yml <span class="token punctuation">\</span>
    <span class="token parameter variable">--use_vdl</span><span class="token operator">=</span>True <span class="token punctuation">\</span>
    <span class="token parameter variable">--vdl_log_dir</span><span class="token operator">=</span>./log <span class="token parameter variable">--eval</span> 
</code></pre> </li></ul> </li><li> <p>模型评估，切图模型的效果进行一下评估。</p> 
  <ul><li> <p>对于子图评估和原图评估，差别仅仅在于验证集路径的配置：</p> 
    <ul><li> <p>子图评估：配置切图后的子图存放目录和子图验证集标注文件</p> </li><li> <pre><code class="prism language-shell">%cd ~/PaddleDetection
<span class="token operator">!</span>python tools/eval.py <span class="token punctuation">\</span>
    <span class="token parameter variable">-c</span> eda/eda_model/ppyoloe_crn_l_80e_sliced_eda.yml <span class="token punctuation">\</span>
    <span class="token parameter variable">-o</span> <span class="token assign-left variable">weights</span><span class="token operator">=</span>output/ppyoloe_crn_l_80e_sliced_eda/best_model.pdparams
</code></pre> </li><li> <p>原图评估：配置原图存放目录和验证集标注文件</p> </li><li> <pre><code class="prism language-shell"><span class="token operator">!</span>python tools/eval.py <span class="token punctuation">\</span>
        <span class="token parameter variable">-c</span> eda/eda_model/ppyoloe_crn_l_80e_sliced_eda.yml <span class="token punctuation">\</span>
        <span class="token parameter variable">-o</span> <span class="token assign-left variable">weights</span><span class="token operator">=</span>output/ppyoloe_crn_l_80e_sliced_eda/best_model.pdparams
</code></pre> </li><li> <p>子图拼图评估，执行命令时，需要关注下面这些参数的设置：</p> 
      <ul><li> <p>设置–combine_method表示子图结果重组去重的方式，默认是nms；</p> </li><li> <p>设置–match_threshold表示子图结果重组去重的阈值，默认是0.6；</p> </li><li> <p>设置–match_metric表示子图结果重组去重的度量标准，默认是ios表示交小比(两个框交集面积除以更小框的面积)，也可以选择交并比iou(两个框交集面积除以并集面积)，精度效果因数据集而而异，但选择ios预测速度会更快一点。在本项目中，我们把交小比和交并比两种方式都试验一番：</p> </li></ul> </li><li> <p>训练80个epoch后，子图拼图评估，交小比</p> </li><li> <pre><code class="prism language-shell"><span class="token operator">!</span>python tools/eval.py <span class="token punctuation">\</span>
    <span class="token parameter variable">-c</span> eda/eda_model/ppyoloe_crn_l_80e_sliced_eda_slice_infer.yml <span class="token punctuation">\</span>
    <span class="token parameter variable">-o</span> <span class="token assign-left variable">weights</span><span class="token operator">=</span>output/ppyoloe_crn_l_80e_sliced_eda/best_model.pdparams <span class="token punctuation">\</span>
    <span class="token parameter variable">--slice_infer</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">--combine_method</span><span class="token operator">=</span>nms <span class="token punctuation">\</span>
    <span class="token parameter variable">--match_threshold</span><span class="token operator">=</span><span class="token number">0.6</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">--match_metric</span><span class="token operator">=</span>ios
</code></pre> </li><li> <p>训练80个epoch后，子图拼图评估，交并比</p> </li><li> <pre><code class="prism language-shell"><span class="token operator">!</span>python tools/eval.py <span class="token punctuation">\</span>
    <span class="token parameter variable">-c</span> eda/eda_model/ppyoloe_crn_l_80e_sliced_eda_slice_infer.yml <span class="token punctuation">\</span>
    <span class="token parameter variable">-o</span> <span class="token assign-left variable">weights</span><span class="token operator">=</span>output/ppyoloe_crn_l_80e_sliced_eda/best_model.pdparams <span class="token punctuation">\</span>
    <span class="token parameter variable">--slice_infer</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">--combine_method</span><span class="token operator">=</span>nms <span class="token punctuation">\</span>
    <span class="token parameter variable">--match_threshold</span><span class="token operator">=</span><span class="token number">0.6</span> <span class="token punctuation">\</span>
    <span class="token parameter variable">--match_metric</span><span class="token operator">=</span>iou
</code></pre> </li></ul> </li><li> <p>评估结论：将80个epoch后，切图训练子图评估、切图训练原图评估、切图训练子图拼图评估的效果进行了对比，结果如下：</p> 
    <ul><li> 
      <table><thead><tr><th align="center">训练评估方式</th><th align="center">SLICE_SIZE</th><th align="center">OVERLAP_RATIO</th><th align="center">mAP0.5:0.95</th><th align="center">AP0.5</th></tr></thead><tbody><tr><td align="center">子图训练子图评估</td><td align="center">640</td><td align="center">0.25</td><td align="center">78.0</td><td align="center">94.8</td></tr><tr><td align="center">子图训练原图评估</td><td align="center">640</td><td align="center">0.25</td><td align="center">69.3</td><td align="center">81.5</td></tr><tr><td align="center">子图训练拼图评估-IoS</td><td align="center">640</td><td align="center">0.25</td><td align="center">47.6</td><td align="center">66.8</td></tr><tr><td align="center">子图训练拼图评估-IoU</td><td align="center">640</td><td align="center">0.25</td><td align="center">47.1</td><td align="center">71.1</td></tr></tbody></table></li><li> <p><strong>从上面的简单表格可以明显看出，相比原图直接训练，子图训练拼图评估精度提升明显</strong>。同时，子图结果重组去重的度量标准用交并比在该数据集上表现更好，猜测可能是因为，数据集的目标大小差异较大，对于中大型目标，去重标准如果用交小比，在评估效果上，会比较吃亏。</p> </li></ul> </li></ul> </li><li> <p>模型预测</p> 
  <ul><li> <p>挑一张测试集的图片展示预测效果</p> </li><li> <pre><code class="prism language-shell"><span class="token operator">!</span>python tools/infer.py <span class="token punctuation">\</span>
    <span class="token parameter variable">-c</span> eda/eda_model/ppyoloe_crn_l_80e_sliced_eda.yml <span class="token punctuation">\</span>
    <span class="token parameter variable">-o</span> <span class="token assign-left variable">weights</span><span class="token operator">=</span>output/ppyoloe_crn_l_80e_sliced_eda/best_model.pdparams <span class="token punctuation">\</span>
    <span class="token parameter variable">--infer_img</span><span class="token operator">=</span>/home/aistudio/paddledetection/dataset/voc/val/i1wJLsAZbpvD3mNWeK8Hfl7xrPC9cMqT02So4YyF.jpg <span class="token punctuation">\</span>
    <span class="token parameter variable">--draw_threshold</span><span class="token operator">=</span><span class="token number">0.4</span> <span class="token punctuation">\</span>
    <span class="token comment"># --slice_infer \</span>
    <span class="token comment"># --slice_size 640 640 \</span>
    <span class="token comment"># --overlap_ratio 0.25 0.25 \</span>
    <span class="token comment"># --combine_method=nms \</span>
    <span class="token comment"># --match_threshold=0.6 \</span>
    <span class="token comment"># --match_metric=iou \</span>
    <span class="token comment"># --save_results=True</span>
</code></pre> </li><li> <p>批量预测</p> </li><li> <pre><code class="prism language-shell"><span class="token operator">!</span>python tools/infer.py <span class="token punctuation">\</span>
    <span class="token parameter variable">-c</span> eda/eda_model/ppyoloe_crn_l_80e_sliced_eda.yml <span class="token punctuation">\</span>
    <span class="token parameter variable">-o</span> <span class="token assign-left variable">weights</span><span class="token operator">=</span>output/ppyoloe_crn_l_80e_sliced_eda/best_model.pdparams <span class="token punctuation">\</span>
    <span class="token parameter variable">--infer_dir</span><span class="token operator">=</span>/home/aistudio/paddledetection/dataset/voc/val <span class="token punctuation">\</span>
    <span class="token parameter variable">--save_results</span><span class="token operator">=</span>True
</code></pre> </li></ul> </li><li> <p>模型导出</p> 
  <ul><li> <pre><code class="prism language-shell">%cd ~/PaddleDetection
<span class="token operator">!</span>python tools/export_model.py <span class="token punctuation">\</span>
    <span class="token parameter variable">-c</span> eda/eda_model/ppyoloe_crn_l_80e_sliced_eda.yml <span class="token punctuation">\</span>
    <span class="token parameter variable">--output_dir</span><span class="token operator">=</span>./inference_model <span class="token punctuation">\</span>
    <span class="token parameter variable">-o</span> <span class="token assign-left variable">weights</span><span class="token operator">=</span>output/ppyoloe_crn_l_80e_sliced_eda/best_model
</code></pre> </li></ul> </li><li> <p>结果文件生成，推理文件infer.py已做更新，可以直接运行以下代码，进行结果文件提交！</p> 
  <ul><li> <pre><code class="prism language-shell">%cd ~/PaddleDetection
<span class="token operator">!</span>rm <span class="token parameter variable">-rf</span> /home/aistudio/PaddleDetection/submit
<span class="token operator">!</span>cp <span class="token parameter variable">-r</span> /home/aistudio/work/infer.py /home/aistudio/PaddleDetection/deploy/python/
<span class="token operator">!</span>python deploy/python/infer.py <span class="token punctuation">\</span>
    <span class="token parameter variable">--model_dir</span><span class="token operator">=</span>inference_model/ppyoloe_crn_l_80e_sliced_eda <span class="token punctuation">\</span>
    <span class="token parameter variable">--image_dir</span><span class="token operator">=</span>/home/aistudio/PaddleDetection/dataset/voc/val <span class="token punctuation">\</span>
    <span class="token parameter variable">--device</span><span class="token operator">=</span>GPU <span class="token punctuation">\</span>
    <span class="token parameter variable">--output_dir</span> infer_output <span class="token punctuation">\</span>
    <span class="token parameter variable">--save_results</span>
<span class="token operator">!</span>mkdir submit/
<span class="token operator">!</span>mv infer_output/bbox.json submit/
</code></pre> </li></ul> </li><li> <p>提分技巧</p> 
  <ul><li> <p>针对本赛题的数据集特点，可以选用更不同尺度的图片切片大小，进行模型训练。</p> </li><li> <p>针对训练环境适当调整部分参数，以提升模型精度。</p> </li><li> <p>选择精度更高的目标检测模型或适当优化模型的部分结构。</p> </li></ul> </li><li> <p>notebook Magic关键字</p> 
  <ul><li> <p>Magic关键字是可以运行特殊的命令. Magic 命令的前面带有一个或两个百分号(% 或 %%), 分别代表<code>行Magic命令</code>和<code>Cell Magic命令</code>. <code>行Magic命令</code>仅应用于编写Magic命令时所在的行, 而<code>Cell Magic命令</code>应用于整个Cell.</p> </li><li> 
    <table><thead><tr><th>Magic关键字</th><th>含义</th></tr></thead><tbody><tr><td>%timeit</td><td>测试单行语句的执行时间</td></tr><tr><td>%%timeit</td><td>测试整个块中代码的执行时间</td></tr><tr><td>%matplotlib inline</td><td>显示 matplotlib 包生成的图形</td></tr><tr><td>%run</td><td>调用外部python脚本</td></tr><tr><td>%pdb</td><td>调试程序</td></tr><tr><td>%pwd</td><td>查看当前工作目录</td></tr><tr><td>%ls</td><td>查看目录文件列表</td></tr><tr><td>%reset</td><td>清除全部变量</td></tr><tr><td>%who</td><td>查看所有全局变量的名称，若给定类型参数，只返回该类型的变量列表</td></tr><tr><td>%whos</td><td>显示所有的全局变量名称、类型、值/信息</td></tr><tr><td>%xmode Plain</td><td>设置为当异常发生时只展示简单的异常信息</td></tr><tr><td>%xmode Verbose</td><td>设置为当异常发生时展示详细的异常信息</td></tr><tr><td>%debug</td><td>bug调试，输入quit退出调试</td></tr><tr><td>%bug</td><td>调试，输入quit退出调试</td></tr><tr><td>%env</td><td>列出全部环境变量</td></tr></tbody></table></li></ul> </li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4e52941fc28354c266524cb7e36dc910/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">UnicodeEncodeError: ‘charmap‘ codec can‘t encode characters in position 0-1: character maps to ＜unde</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e431c6e8ade0f72df629e459d73c8861/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">集合set</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>