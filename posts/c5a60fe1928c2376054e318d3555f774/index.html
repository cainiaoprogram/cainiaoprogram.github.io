<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>关于 scrapy 中 COOKIES_ENABLED 设置 理解问题，看这里就够了 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="关于 scrapy 中 COOKIES_ENABLED 设置 理解问题，看这里就够了" />
<meta property="og:description" content="看了很多的文章， 感觉写的都有点扯淡 ，误人子弟 。 源码中 ： 默认是注释掉的，但是上面的备注写的是开启状态（没关系， 不管）。
所以这个 就有了三个状态：
1. 第一个 源码的 注释状态： # Disable cookies (enabled by default) # COOKIES_ENABLED = False 这个状态下， 其实可以理解成 cookie 是开启的状态， 但是他的获取值 是通过源码的方法，scrapy直接获取网页的上层的cookie ，然后带到下一层去的。 2. 第二种解开注释的情况下 ： # Disable cookies (enabled by default) COOKIES_ENABLED = False 这个状态下的 cookie 是通过 headers 添加上去的，这个就是中间件里面的 包裹在头部里面
就是 setting源码中的 # Override the default request headers: #DEFAULT_REQUEST_HEADERS = { # &#39;Accept&#39;: &#39;text/html,application/xhtml&#43;xml,application/xml;q=0.9,*/*;q=0.8&#39;, # &#39;Accept-Language&#39;: &#39;en&#39;, #} 要是只是个别需要增加头部的，可以直接传参进去。 setting 写入时传全局的；" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c5a60fe1928c2376054e318d3555f774/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-07T16:38:40+08:00" />
<meta property="article:modified_time" content="2023-02-07T16:38:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">关于 scrapy 中 COOKIES_ENABLED 设置 理解问题，看这里就够了</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>看了很多的文章， 感觉写的都有点扯淡 ，误人子弟 。 </h3> 
<p>源码中 ： 默认是注释掉的，但是上面的备注写的是开启状态（没关系， 不管）。</p> 
<p>所以这个 就有了三个状态：</p> 
<h4>1. 第一个 源码的 注释状态：</h4> 
<pre><code class="language-html"># Disable cookies (enabled by default)
# COOKIES_ENABLED = False
</code></pre> 
<p></p> 
<p>这个状态下， 其实可以理解成  cookie 是开启的状态， 但是他的获取值 是通过源码的方法，scrapy<strong>直接获取网页的上层的cookie ，然后带到下一层去的。 </strong></p> 
<p></p> 
<h4>2. 第二种解开注释的情况下 ：</h4> 
<pre><code class="language-html"># Disable cookies (enabled by default)
COOKIES_ENABLED = False
</code></pre> 
<p></p> 
<p><strong>这个状态下的 cookie  是通过 headers 添加上去的</strong>，这个就是中间件里面的 包裹在头部里面</p> 
<p>就是 setting源码中的 </p> 
<pre><code class="language-html"># Override the default request headers:
#DEFAULT_REQUEST_HEADERS = {
#   'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
#   'Accept-Language': 'en',
#}</code></pre> 
<p>要是只是个别需要增加头部的，可以直接传参进去。 setting 写入时传全局的；</p> 
<p>从这个里面去添加 cookie, token 等 一系列东西 。  或者 在请求的时候自己带上 ，源码里面 ，有 可以带的参数。headers  这个参数， 只是当前项目需要，可以在这里传</p> 
<pre><code class="language-html">class Request(object_ref):

    def __init__(self, url, callback=None, method='GET', headers=None, body=None,
                 cookies=None, meta=None, encoding='utf-8', priority=0,
                 dont_filter=False, errback=None, flags=None, cb_kwargs=None):</code></pre> 
<p></p> 
<p></p> 
<h4>3. 第三种状态 就是 设置为  true：</h4> 
<pre><code class="language-html"># Disable cookies (enabled by default)
COOKIES_ENABLED = True
</code></pre> 
<p></p> 
<p>这种的， 就是覆盖源码中的方法， 后面使用的是自己的cookie ,</p> 
<p><strong>需要在请求的时候 带上 cookies= cookie</strong>，</p> 
<p>cookie 自己设置到 setting  或者 spider 里面都可以。</p> 
<p>这个设置是 全局设置的 。 以后的请求都是这个cookie 。</p> 
<p>需要先声明他： cookie = '.......'</p> 
<p>然后在请求的里面写上，</p> 
<pre><code>yield scrapy.Request(
                href,
                callback=self.get_parse,
                cookies=cookie,
                meta={
                    'name': name
                }
            )</code></pre> 
<p>；</p> 
<p></p> 
<pre><code class="language-python">  def start_requests(self):
        cookie = {}
        str_cookie = '你的cookie信息'
        str_cookie_items_list = str_cookie.split(';')
        for str_cookie_items in str_cookie_items_list:
            str_cookie_kw = str_cookie_items.split('=')
            cookie[str_cookie_kw[0].strip()] = str_cookie_kw[1].strip()

        yield scrapy.Request(
            url=self.start_urls[0],
            method='get',
            callback=self.parse,
            cookies=cookie
        )
        
  def parse(self, response, **kwargs):
      print(response.text)
</code></pre> 
<p>三种 状态 ， 要是你想说 自己不想带 任何 cookie 怎么办？ </p> 
<p>         第二种方法， 直接把注释解开就可了， 自己没设置cookie ，就不会带上去。 </p> 
<p></p> 
<p>有的文章说的， 爬虫的爬取效率问题 就把注释打开了， <strong>就是这个自己没有设置cookie  所以请求的时候不会去验证。</strong></p> 
<p>结合自己的 业务需求 来选取设置。 </p> 
<p></p> 
<h3>每个请求需要自己的 cookie、 token的 ， 请使用 第二种。 </h3> 
<p></p> 
<h3>直接全局可以使用一个cookie 的 、只需要这个字段的 ， 用第三种方式。</h3> 
<h3>headers、cookie单独设立 ，两者的cookie 相斥， 简单理解就是 有 headers (第二种)， 单独设置的cookie（第三种 就会失效），反之亦然。 </h3> 
<p></p> 
<p>故此：三种状态  已讲清晰。 还有疑问的  可留言。 </p> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/553137d028f86ac68b90b1b761e747f9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">机器学习笔记之生成模型综述(一)生成模型介绍</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7d53952d6db53434bbf977a755621399/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【cmd命令】输出文件夹下文件名字列表</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>