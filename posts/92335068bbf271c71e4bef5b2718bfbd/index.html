<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>3D Motion Capture(3D运动捕捉) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="3D Motion Capture(3D运动捕捉)" />
<meta property="og:description" content="目录
一、前言
二、项目介绍
1.目的
2.技术要点
(1)读取文件
(2)标记关键节点
(3)读取每一帧图像中关键节点的坐标
(4)Unity中创建3D角色
(5)将人物动作3D化
3.需要做的准备
(1)第三方库
(2)Unity安装与使用
(3)C#了解
三、项目实现步骤
1.Python 部分
(1)读取人物动作并标记关键节点
(2)将坐标值写入文件中保存
2.Unity 部分
(1)创建项目
(2)创建空白来存储 3D 结构部位
(3)创建球体
(4)关键节点和模型的连接
(5)将分散的球体进行连接
四、总体代码
1.Python 代码
2.C# 脚本
(1)球体动画
(2)线条
五、结束语
一、前言 《功夫熊猫》、《忍者神龟》等一些大片想必大家都有了解过，里面的一个个建模角色能够出色的完成人类的动作，那么这些都是怎么实现的呢？今天我就和大家一起从零开始实现对一个视频中的人物的动作进行捕捉并将其添加到建模角色上，让建模出来的虚拟角色也可以像人类一样实现多种多样的行为动作，本次的项目实现起来有点麻烦，感兴趣的小伙伴可以一步步尝试下来，完成之后会学到很多东西呢。
二、项目介绍 1.目的 本次项目的名称为3D运动捕捉，不难猜到是需要对视频或者是摄像头中的运动的人物的姿势进行抓取并以3D的形式展现出来。简单来说就是让人物的动作能够被提取出来，方便后续的研究和观察，也可以用来进行虚拟视频的创作，给观众带来视觉上的刺激。
2.技术要点 (1)读取文件 既然是叫做3D运动捕捉的，那么肯定需要对视频或者摄像头中的人物姿势进行捕捉，第一步当然得需要读取文件，读取到的文件只要是完整的人物运动视频即可，因此如果拍摄视频的摄像头是固定的，那么将会极大地提高我们项目的准确率。
(2)标记关键节点 得到了视频文件，接下来就要标记视频中人物的身体的各个关键节点部位了，这对于Python中的第三方库 cvzone 来说就是小菜一碟。该库对人体的33个关键节点做了记录，读取视频后就能对人物的关键节点进行标记，通过节点坐标的变化我们就可以实现对人物运动姿势的把握了。
(3)读取每一帧图像中关键节点的坐标 我们已经得到了33个关键节点的坐标，每一帧图像中它们的值都会发生变化，因此我们需要将每一帧图像中的坐标值记录下来。记录下来的坐标值我们可以创建一个文件来进行存放，在后续的过程中将会使用到这些坐标点。具体的记录实现方式我将在下面的实现步骤中讲解，希望大家能够耐住性子继续往下看！！
(4)Unity中创建3D角色 使用 Unity 创建一个简单的由33个球体和几条线段组成的角色，Unity 的下载和安装我就不在这里赘述了，大家可以在网上找找，一搜一大堆！！创建3D角色的步骤将会在下面的实现步骤中详细介绍。
(5)将人物动作3D化 主要是在 Unity 中使用 C# 脚本将我们的坐标点的变化连接到创建的3D角色身上，其他的就是调整Unity 中的相机的一些参数使我们的3D形象更加合理‘上镜’即可。
3.需要做的准备 (1)第三方库 在本次项目中我们使用 Python 主要是完成人物运动的捕捉和关键节点的标记，并记录一下简单的坐标点的变化，所以只需要一些基础的视觉库即可：
import cv2 from cvzone." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/92335068bbf271c71e4bef5b2718bfbd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-14T14:35:18+08:00" />
<meta property="article:modified_time" content="2022-04-14T14:35:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">3D Motion Capture(3D运动捕捉)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:0px;"></p> 
<p id="%E4%B8%80%E3%80%81%E5%89%8D%E8%A8%80-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E5%89%8D%E8%A8%80" rel="nofollow">一、前言</a></p> 
<p id="%E4%BA%8C%E3%80%81%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D" rel="nofollow">二、项目介绍</a></p> 
<p id="1.%E7%9B%AE%E7%9A%84-toc" style="margin-left:40px;"><a href="#1.%E7%9B%AE%E7%9A%84" rel="nofollow">1.目的</a></p> 
<p id="2.%E6%8A%80%E6%9C%AF%E8%A6%81%E7%82%B9-toc" style="margin-left:40px;"><a href="#2.%E6%8A%80%E6%9C%AF%E8%A6%81%E7%82%B9" rel="nofollow">2.技术要点</a></p> 
<p id="(1)%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#%281%29%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6" rel="nofollow">(1)读取文件</a></p> 
<p id="(2)%E6%A0%87%E8%AE%B0%E5%85%B3%E9%94%AE%E8%8A%82%E7%82%B9-toc" style="margin-left:80px;"><a href="#%282%29%E6%A0%87%E8%AE%B0%E5%85%B3%E9%94%AE%E8%8A%82%E7%82%B9" rel="nofollow">(2)标记关键节点</a></p> 
<p id="(3)%E8%AF%BB%E5%8F%96%E6%AF%8F%E4%B8%80%E5%B8%A7%E5%9B%BE%E5%83%8F%E4%B8%AD%E5%85%B3%E9%94%AE%E8%8A%82%E7%82%B9%E7%9A%84%E5%9D%90%E6%A0%87-toc" style="margin-left:80px;"><a href="#%283%29%E8%AF%BB%E5%8F%96%E6%AF%8F%E4%B8%80%E5%B8%A7%E5%9B%BE%E5%83%8F%E4%B8%AD%E5%85%B3%E9%94%AE%E8%8A%82%E7%82%B9%E7%9A%84%E5%9D%90%E6%A0%87" rel="nofollow">(3)读取每一帧图像中关键节点的坐标</a></p> 
<p id="(4)Unity%E4%B8%AD%E5%88%9B%E5%BB%BA3D%E8%A7%92%E8%89%B2-toc" style="margin-left:80px;"><a href="#%284%29Unity%E4%B8%AD%E5%88%9B%E5%BB%BA3D%E8%A7%92%E8%89%B2" rel="nofollow">(4)Unity中创建3D角色</a></p> 
<p id="(5)%E5%B0%86%E4%BA%BA%E7%89%A9%E5%8A%A8%E4%BD%9C3D%E5%8C%96-toc" style="margin-left:80px;"><a href="#%285%29%E5%B0%86%E4%BA%BA%E7%89%A9%E5%8A%A8%E4%BD%9C3D%E5%8C%96" rel="nofollow">(5)将人物动作3D化</a></p> 
<p id="3.%E9%9C%80%E8%A6%81%E5%81%9A%E7%9A%84%E5%87%86%E5%A4%87-toc" style="margin-left:40px;"><a href="#3.%E9%9C%80%E8%A6%81%E5%81%9A%E7%9A%84%E5%87%86%E5%A4%87" rel="nofollow">3.需要做的准备</a></p> 
<p id="(1)%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93-toc" style="margin-left:80px;"><a href="#%281%29%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93" rel="nofollow">(1)第三方库</a></p> 
<p id="(2)Unity%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8-toc" style="margin-left:80px;"><a href="#%282%29Unity%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8" rel="nofollow">(2)Unity安装与使用</a></p> 
<p id="(3)C%23%E4%BA%86%E8%A7%A3-toc" style="margin-left:80px;"><a href="#%283%29C%23%E4%BA%86%E8%A7%A3" rel="nofollow">(3)C#了解</a></p> 
<p id="%E4%B8%89%E3%80%81%E9%A1%B9%E7%9B%AE%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E9%A1%B9%E7%9B%AE%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4" rel="nofollow">三、项目实现步骤</a></p> 
<p id="1.Python%20%E9%83%A8%E5%88%86-toc" style="margin-left:40px;"><a href="#1.Python%20%E9%83%A8%E5%88%86" rel="nofollow">1.Python 部分</a></p> 
<p id="(1)%E8%AF%BB%E5%8F%96%E4%BA%BA%E7%89%A9%E5%8A%A8%E4%BD%9C%E5%B9%B6%E6%A0%87%E8%AE%B0%E5%85%B3%E9%94%AE%E8%8A%82%E7%82%B9-toc" style="margin-left:80px;"><a href="#%281%29%E8%AF%BB%E5%8F%96%E4%BA%BA%E7%89%A9%E5%8A%A8%E4%BD%9C%E5%B9%B6%E6%A0%87%E8%AE%B0%E5%85%B3%E9%94%AE%E8%8A%82%E7%82%B9" rel="nofollow">(1)读取人物动作并标记关键节点</a></p> 
<p id="(2)%E5%B0%86%E5%9D%90%E6%A0%87%E5%80%BC%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6%E4%B8%AD%E4%BF%9D%E5%AD%98-toc" style="margin-left:80px;"><a href="#%282%29%E5%B0%86%E5%9D%90%E6%A0%87%E5%80%BC%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6%E4%B8%AD%E4%BF%9D%E5%AD%98" rel="nofollow">(2)将坐标值写入文件中保存</a></p> 
<p id="2.Unity%20%E9%83%A8%E5%88%86-toc" style="margin-left:40px;"><a href="#2.Unity%20%E9%83%A8%E5%88%86" rel="nofollow">2.Unity 部分</a></p> 
<p id="(1)%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE-toc" style="margin-left:80px;"><a href="#%281%29%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE" rel="nofollow">(1)创建项目</a></p> 
<p id="(2)%E5%88%9B%E5%BB%BA%E7%A9%BA%E7%99%BD%E6%9D%A5%E5%AD%98%E5%82%A8%203D%20%E7%BB%93%E6%9E%84%E9%83%A8%E4%BD%8D-toc" style="margin-left:80px;"><a href="#%282%29%E5%88%9B%E5%BB%BA%E7%A9%BA%E7%99%BD%E6%9D%A5%E5%AD%98%E5%82%A8%203D%20%E7%BB%93%E6%9E%84%E9%83%A8%E4%BD%8D" rel="nofollow">(2)创建空白来存储 3D 结构部位</a></p> 
<p id="(3)%E5%88%9B%E5%BB%BA%E7%90%83%E4%BD%93-toc" style="margin-left:80px;"><a href="#%283%29%E5%88%9B%E5%BB%BA%E7%90%83%E4%BD%93" rel="nofollow">(3)创建球体</a></p> 
<p id="(4)%E5%85%B3%E9%94%AE%E8%8A%82%E7%82%B9%E5%92%8C%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%BF%9E%E6%8E%A5-toc" style="margin-left:80px;"><a href="#%284%29%E5%85%B3%E9%94%AE%E8%8A%82%E7%82%B9%E5%92%8C%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%BF%9E%E6%8E%A5" rel="nofollow">(4)关键节点和模型的连接</a></p> 
<p id="(5)%E5%B0%86%E5%88%86%E6%95%A3%E7%9A%84%E7%90%83%E4%BD%93%E8%BF%9B%E8%A1%8C%E8%BF%9E%E6%8E%A5-toc" style="margin-left:80px;"><a href="#%285%29%E5%B0%86%E5%88%86%E6%95%A3%E7%9A%84%E7%90%83%E4%BD%93%E8%BF%9B%E8%A1%8C%E8%BF%9E%E6%8E%A5" rel="nofollow">(5)将分散的球体进行连接</a></p> 
<p id="%E5%9B%9B%E3%80%81%E6%80%BB%E4%BD%93%E4%BB%A3%E7%A0%81-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%E3%80%81%E6%80%BB%E4%BD%93%E4%BB%A3%E7%A0%81" rel="nofollow">四、总体代码</a></p> 
<p id="1.Python%20%E4%BB%A3%E7%A0%81-toc" style="margin-left:40px;"><a href="#1.Python%20%E4%BB%A3%E7%A0%81" rel="nofollow">1.Python 代码</a></p> 
<p id="2.C%23%20%E8%84%9A%E6%9C%AC-toc" style="margin-left:40px;"><a href="#2.C%23%20%E8%84%9A%E6%9C%AC" rel="nofollow">2.C# 脚本</a></p> 
<p id="(1)%E7%90%83%E4%BD%93%E5%8A%A8%E7%94%BB-toc" style="margin-left:80px;"><a href="#%281%29%E7%90%83%E4%BD%93%E5%8A%A8%E7%94%BB" rel="nofollow">(1)球体动画</a></p> 
<p id="(2)%E7%BA%BF%E6%9D%A1-toc" style="margin-left:80px;"><a href="#%282%29%E7%BA%BF%E6%9D%A1" rel="nofollow">(2)线条</a></p> 
<p id="%E4%BA%94%E3%80%81%E7%BB%93%E6%9D%9F%E8%AF%AD-toc" style="margin-left:0px;"><a href="#%E4%BA%94%E3%80%81%E7%BB%93%E6%9D%9F%E8%AF%AD" rel="nofollow">五、结束语</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E4%B8%80%E3%80%81%E5%89%8D%E8%A8%80">一、前言</h2> 
<p>《功夫熊猫》、《忍者神龟》等一些大片想必大家都有了解过，里面的一个个建模角色能够出色的完成人类的动作，那么这些都是怎么实现的呢？今天我就和大家一起从零开始实现对一个视频中的人物的动作进行捕捉并将其添加到建模角色上，让建模出来的虚拟角色也可以像人类一样实现多种多样的行为动作，本次的项目实现起来有点麻烦，感兴趣的小伙伴可以一步步尝试下来，完成之后会学到很多东西呢。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/c6/41/Y5sOIVxs_o.png" width="1200"></p> 
<h2 id="%E4%BA%8C%E3%80%81%E9%A1%B9%E7%9B%AE%E4%BB%8B%E7%BB%8D">二、项目介绍</h2> 
<h3 id="1.%E7%9B%AE%E7%9A%84">1.目的</h3> 
<p>本次项目的名称为<span style="background-color:#fbd4d0;">3D运动捕捉</span>，不难猜到是需要对视频或者是摄像头中的<span style="background-color:#fbd4d0;">运动的人物的姿势进行抓取</span>并以3D的形式展现出来。简单来说就是让人物的动作能够被提取出来，方便后续的研究和观察，也可以用来进行虚拟视频的创作，给观众带来视觉上的刺激。</p> 
<h3 id="2.%E6%8A%80%E6%9C%AF%E8%A6%81%E7%82%B9">2.技术要点</h3> 
<h4 id="(1)%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6">(1)读取文件</h4> 
<p>既然是叫做3D运动捕捉的，那么肯定需要对视频或者摄像头中的人物姿势进行捕捉，第一步当然得需要读取文件，读取到的文件只要是<span style="background-color:#fbd4d0;">完整的人物运动视频</span>即可，因此如果<span style="background-color:#fbd4d0;">拍摄视频的摄像头是固定</span>的，那么将会极大地提高我们项目的准确率。</p> 
<h4 id="(2)%E6%A0%87%E8%AE%B0%E5%85%B3%E9%94%AE%E8%8A%82%E7%82%B9">(2)标记关键节点</h4> 
<p>得到了视频文件，接下来就要<span style="background-color:#fbd4d0;">标记视频中人物的身体的各个关键节点部位</span>了，这对于Python中的第三方库 <span style="background-color:#fbd4d0;">cvzone </span>来说就是小菜一碟。该库对人体的<span style="background-color:#fbd4d0;">33个关键节点</span>做了记录，读取视频后就能对人物的关键节点进行标记，通过节点坐标的变化我们就可以实现对人物运动姿势的把握了。</p> 
<p><img alt="" height="323" src="https://images2.imgbox.com/fd/f9/3XRTmXyo_o.jpg" width="640"></p> 
<h4 id="(3)%E8%AF%BB%E5%8F%96%E6%AF%8F%E4%B8%80%E5%B8%A7%E5%9B%BE%E5%83%8F%E4%B8%AD%E5%85%B3%E9%94%AE%E8%8A%82%E7%82%B9%E7%9A%84%E5%9D%90%E6%A0%87">(3)读取每一帧图像中关键节点的坐标</h4> 
<p>我们已经得到了<span style="background-color:#fbd4d0;">33个关键节点的坐标</span>，每一帧图像中它们的值都会发生变化，因此我们需要将<span style="background-color:#fbd4d0;">每一帧图像中的坐标值</span>记录下来。记录下来的坐标值我们可以创建一个文件来进行存放，在后续的过程中将会使用到这些坐标点。具体的记录实现方式我将在下面的实现步骤中讲解，<strong><span style="color:#38d8f0;">希望大家能够耐住性子继续往下看！！</span></strong></p> 
<h4 id="(4)Unity%E4%B8%AD%E5%88%9B%E5%BB%BA3D%E8%A7%92%E8%89%B2">(4)Unity中创建3D角色</h4> 
<p>使用 Unity 创建一个简单的由<span style="background-color:#fbd4d0;">33个球体和几条线段组成的角色</span>，Unity 的下载和安装我就不在这里赘述了，大家可以在网上找找，一搜一大堆！！创建3D角色的步骤将会在下面的实现步骤中详细介绍。</p> 
<h4 id="(5)%E5%B0%86%E4%BA%BA%E7%89%A9%E5%8A%A8%E4%BD%9C3D%E5%8C%96">(5)将人物动作3D化</h4> 
<p>主要是在 <span style="background-color:#fbd4d0;">Unity 中使用 C# 脚本</span>将我们的坐标点的变化连接到创建的3D角色身上，其他的就是调整Unity 中的相机的一些参数使我们的3D形象更加合理<span style="background-color:#fbd4d0;">‘上镜’</span>即可。</p> 
<h3 id="3.%E9%9C%80%E8%A6%81%E5%81%9A%E7%9A%84%E5%87%86%E5%A4%87">3.需要做的准备</h3> 
<h4 id="(1)%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93">(1)第三方库</h4> 
<p>在本次项目中我们使用 Python 主要是完成人物运动的捕捉和关键节点的标记，并记录一下简单的坐标点的变化，所以只需要一些基础的视觉库即可：</p> 
<blockquote> 
 <pre><span style="background-color:#fbd4d0;">import cv2
from cvzone.PoseModule import PoseDetector</span></pre> 
</blockquote> 
<p>在使用 cvzone 时我本人出现过一些问题并记录了下来，如果有小伙伴遇到同样的问题应该能简单的帮到你：<a class="link-info" href="https://blog.csdn.net/qq_52309640/article/details/124062053" title="cvzone 中 PoseDetector 读取视频坐标信息问题">cvzone 中 PoseDetector 读取视频坐标信息问题</a></p> 
<h4 id="(2)Unity%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8">(2)Unity安装与使用</h4> 
<p>这个软件的下载和安装没太大的什么问题，我是使用 <span style="background-color:#fbd4d0;">vx公众号 伙伴神</span> 下载的，但它提供的2020版有问题，下载并安装2019版就可以了。至于使用的话现学现卖吧，反正也不是很难。</p> 
<h4 id="(3)C%23%E4%BA%86%E8%A7%A3">(3)C#了解</h4> 
<p>使用C#语言我们需要编写脚本来连接坐标点和3D模型，可能大家会觉得没学过啊、很难啊啥的，但不用怕，我们也不需要掌握全部，就简单使用几个语法，创建几个列表，能达到我们的目标就好。</p> 
<h2 id="%E4%B8%89%E3%80%81%E9%A1%B9%E7%9B%AE%E5%AE%9E%E7%8E%B0%E6%AD%A5%E9%AA%A4">三、项目实现步骤</h2> 
<h3 id="1.Python%20%E9%83%A8%E5%88%86">1.Python 部分</h3> 
<p>我们本次的项目是需要结合多种工具才能完成的，利用 Python 我们可以得到视频文件中的<span style="background-color:#fbd4d0;">人物的运动状态并标记身上的33个关键节点</span>，随后<span style="background-color:#fbd4d0;">将这些关键节点的坐标值存储到一个文件</span>中。</p> 
<h4 id="(1)%E8%AF%BB%E5%8F%96%E4%BA%BA%E7%89%A9%E5%8A%A8%E4%BD%9C%E5%B9%B6%E6%A0%87%E8%AE%B0%E5%85%B3%E9%94%AE%E8%8A%82%E7%82%B9">(1)读取人物动作并标记关键节点</h4> 
<p>读取视频文件后需要对视频中的人物的身体上的关键节点进行标记，这里我们只要使用下面的函数</p> 
<blockquote> 
 <pre><span style="background-color:#fbd4d0;">img = detector.findPose(img)#标记姿势关键节点
</span></pre> 
</blockquote> 
<p>就可以标记出我们需要的坐标点了，如下：</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/87/48/ckaS4YUS_o.png" width="1200"></p> 
<p>但我们也仅仅是标记出了节点，并没有记录每一个节点的坐标值，所以我们接下来要<span style="background-color:#fbd4d0;">创建一个列表专门来存储每一帧图像中的关键点的坐标值，来方便我们后续将这些点保存到文件中，当然我们也可以打印我们存储的列表的长度，来判断我们的视频的帧数。</span>我们需要用到下面的函数来帮我们读取每一个坐标点的坐标值：</p> 
<blockquote> 
 <p></p> 
 <pre><span style="background-color:#fbd4d0;">lmList, bboxInfo = detector.findPosition(img) #获取视频中的姿势信息</span></pre> 
</blockquote> 
<p>有了上面的步骤我们就能检测视频中人物的运动状态了，阶段性的代码如下（仅用来参考，总体代码文章后面会发）：</p> 
<pre><code class="language-python">cap = cv2.VideoCapture('Video.mp4')
detector = PoseDetector()
posList = []
while True:
    success, img = cap.read()

    img = detector.findPose(img)#标记姿势关键节点

    lmList, bboxInfo = detector.findPosition(img) #获取视频中的姿势信息

    if bboxInfo:            #判断是否检测到一个身体
        lmString = ''       #创建一个空的字符串
        for lm in lmList:   #'lm'为'landmark'的缩写，即33个关键节点

            lmString += f'{lm[1]},{img.shape[0] - lm[2]},{lm[3]},' #最后一个逗号保留，这样每一个坐标值才能分离开来
        posList.append(lmString)

    print(len(posList))#打印视频帧数</code></pre> 
<h4 id="(2)%E5%B0%86%E5%9D%90%E6%A0%87%E5%80%BC%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6%E4%B8%AD%E4%BF%9D%E5%AD%98">(2)将坐标值写入文件中保存</h4> 
<p>上面已经将我们的坐标值存储在了列表中，但为了后续的3D转换，我们需要将这些<span style="background-color:#fbd4d0;">坐标值存储到一个 .txt 文件中</span>。代码如下：</p> 
<pre><code class="language-python">    if key == ord('s'):   #将坐标点写入一个 .txt文件
     with open("AnimationFile.txt", 'w') as f:
        f.writelines(["%s\n" % item for item in posList])</code></pre> 
<p> 当我们在视频结束时按下 's'，就会将我们得到的所有坐标点存储到 ‘AnimationFile.txt’ 文件中，通过前面的得到的帧数我们可以判断我们的文件中的坐标点存储情况。</p> 
<p>比如，我们读取到的帧数如下：</p> 
<p><img alt="" height="238" src="https://images2.imgbox.com/cf/e1/mZZugmd4_o.png" width="1180"></p> 
<p> 然后得到的文件的数据行数如下：<br><img alt="" height="238" src="https://images2.imgbox.com/ae/2d/1GZRgNkL_o.png" width="1200"></p> 
<p>比视频帧数少了几行，但可以接受，因为我们也没办法在视频的最后一帧处按下 's' 。 </p> 
<h3 id="2.Unity%20%E9%83%A8%E5%88%86">2.Unity 部分</h3> 
<p>使用 Python 实现对人物关键节点坐标值的记录后，我们需要将记录下来的那些坐标点应用到3D模型中去，这里就要使用到 Unity 来进行创建了，总体来说比较简单，大胆尝试就好。</p> 
<h4 id="(1)%E5%88%9B%E5%BB%BA%E9%A1%B9%E7%9B%AE">(1)创建项目</h4> 
<p>首先我们需要<span style="background-color:#fbd4d0;">创建一个新的项目，然后在该项目中右键创建一个空白</span>，命名为 manager，这个空白文件夹是比较重要的，后面我们需要用到它来存储我们的一些 C# 脚本。</p> 
<p><img alt="" height="351" src="https://images2.imgbox.com/25/23/IYIJ9l9K_o.png" width="670"></p> 
<h4 id="(2)%E5%88%9B%E5%BB%BA%E7%A9%BA%E7%99%BD%E6%9D%A5%E5%AD%98%E5%82%A8%203D%20%E7%BB%93%E6%9E%84%E9%83%A8%E4%BD%8D">(2)创建空白来存储 3D 结构部位</h4> 
<p>要完成一个3D建模，我们得需要一些线条，球体等物件，而我们<span style="background-color:#fbd4d0;">创建的该空白文件夹就是用来存储这些部位的</span>，至于该文件夹的命名方式可以自己考虑，我这边是命名为 body ，用来存放我们的球体和线条。</p> 
<p><img alt="" height="382" src="https://images2.imgbox.com/82/11/fbH6bStj_o.png" width="650"> </p> 
<h4 id="(3)%E5%88%9B%E5%BB%BA%E7%90%83%E4%BD%93">(3)创建球体</h4> 
<p>我们需要33个球体来代表得到的33个关键节点，因此接下来应该要做的就是<span style="background-color:#fbd4d0;">右键点击 body 并创建一个 sphere, 在下方的空白处点击右键创建 material 将颜色选为自己喜欢的颜色，并拖动刚刚创建好的 material 到 body 下的 sphere 上，</span>这样就可以创建一个自定义颜色的球体了，如果需要的话还可以点击 sphere 并在右边展开的栏目中修改 size ，最后<span style="background-color:#fbd4d0;">复制 body 中的 sphere 并粘贴到 body 下，一共粘贴 32 次</span>即可，至于命名可以自己考虑。</p> 
<p><img alt="" height="975" src="https://images2.imgbox.com/4d/06/PxyXT6S6_o.png" width="1200"></p> 
<h4 id="(4)%E5%85%B3%E9%94%AE%E8%8A%82%E7%82%B9%E5%92%8C%E6%A8%A1%E5%9E%8B%E7%9A%84%E8%BF%9E%E6%8E%A5">(4)关键节点和模型的连接</h4> 
<p>我们需要将之前在 Python 部分得到的<span style="background-color:#fbd4d0;">关键节点坐标值文件复制到我们的项目下面，并创建一个 C# 脚本来关联，这个 C# 文件我们要拖到 manager 文件下进行管理。</span></p> 
<p><img alt="" height="499" src="https://images2.imgbox.com/c6/7a/vfbkXWtB_o.png" width="774"></p> 
<p><img alt="" height="450" src="https://images2.imgbox.com/9c/62/UY14zzan_o.png" width="846"></p> 
<p> 上面两幅图就是我们创建的脚本文件以及添加到 manager 下的视图。</p> 
<p>接下来我们需要<span style="background-color:#fbd4d0;">将 body 类的 size 改为 33 并将下面的 sphere 按顺序拖动到对应的对象中，然后我们编写 C# 脚本进行关联，</span>脚本代码我会放在文章后面部分。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/bf/c3/ZxLdMED1_o.png" width="1200"></p> 
<h4 id="(5)%E5%B0%86%E5%88%86%E6%95%A3%E7%9A%84%E7%90%83%E4%BD%93%E8%BF%9B%E8%A1%8C%E8%BF%9E%E6%8E%A5">(5)将分散的球体进行连接</h4> 
<p>通过前面的步骤，我们已经能够让那 33 个点完成简单的一些动作了，但我们还是尝试一下将那些分散的点连接起来，这样我们的项目才算比较完整。</p> 
<p>首先我们需要在 <span style="background-color:#fbd4d0;">body 下面创建一个空白并命名为 Lins</span>（因为在该空白下我们要用来存储其他的所有线条，因此命为复数形式），然后按照前面的创建 sphere 的步骤我们可以在 Lines 下面创建一个 line 并选择合适的材料。</p> 
<p>接下来我们需要再次创建一个脚本，主要目的是<span style="background-color:#fbd4d0;">为每一个线条选择起点和终点</span>（其实就是每一个之前创建的球体），脚本的代码还是会发布在文章后面，通过该脚本我们就可以实现对线条的位置的设定。</p> 
<p><img alt="" height="280" src="https://images2.imgbox.com/f8/6a/nf4ef3Vy_o.png" width="867"></p> 
<p>该怎么连接这些线条呢？我们可以观察 <span style="background-color:#fbd4d0;">mediapipe 中的人体节点</span>，结合下面这张图，我们就可以设置每一个线条的起点和终点：<br><img alt="" height="323" src="https://images2.imgbox.com/4b/35/ltmLFTWN_o.jpg" width="640"></p> 
<p>然后我们复制之前的第一个线条，并粘贴到 Lines，接下来进行简单枯燥的拖动就可以了（<span style="background-color:#fbd4d0;">将对应的 sphere 拖动到线条的起点和终点上，一一对应即可</span>）：</p> 
<p><img alt="" height="791" src="https://images2.imgbox.com/f6/9b/zxQMSAqN_o.png" width="1200"></p> 
<p>然后我们点击运行，应该就能看见我们的项目成功了。</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/fe/ec/GweTdrz8_o.png" width="1200"></p> 
<h2 id="%E5%9B%9B%E3%80%81%E6%80%BB%E4%BD%93%E4%BB%A3%E7%A0%81">四、总体代码</h2> 
<h3 id="1.Python%20%E4%BB%A3%E7%A0%81">1.Python 代码</h3> 
<pre><code class="language-python">"""
Author:XiaoMa
CSDN Address:一马归一码
"""
import cv2
from cvzone.PoseModule import PoseDetector

cap = cv2.VideoCapture('Video.mp4')
detector = PoseDetector()
posList = []
while True:
    success, img = cap.read()

    img = detector.findPose(img)#标记姿势关键节点

    lmList, bboxInfo = detector.findPosition(img) #获取视频中的姿势信息

    if bboxInfo:            #判断是否检测到一个身体
        lmString = ''       #创建一个空的字符串
        for lm in lmList:   #'lm'为'landmark'的缩写，即33个关键节点

            lmString += f'{lm[1]},{img.shape[0] - lm[2]},{lm[3]},' #最后一个逗号保留，这样每一个坐标值才能分离开来
        posList.append(lmString)

    print(len(posList))

    cv2.imshow("Image", img)
    key = cv2.waitKey(1)

    if key == ord('s'):   #将坐标点写入一个文件
     with open("AnimationFile.txt", 'w') as f:
        f.writelines(["%s\n" % item for item in posList])
</code></pre> 
<h3 id="2.C%23%20%E8%84%9A%E6%9C%AC">2.C# 脚本</h3> 
<h4 id="(1)%E7%90%83%E4%BD%93%E5%8A%A8%E7%94%BB">(1)球体动画</h4> 
<pre><code class="language-cs">using System.Collections;
using System.Collections.Generic;
using System.Linq;
using UnityEngine;
using System.Threading;

public class AnimationCode : MonoBehaviour
{

    public GameObject[] Body;
    List&lt;string&gt; lines;
    int counter = 0;

    void Start()
    {
        lines = System.IO.File.ReadLines("Assets/AnimationFile.txt").ToList();
    }


    void Update()
    {
        string[] points = lines[counter].Split(',');

        for (int i =0; i&lt;=32;i++)
        {
            float x = float.Parse(points[0 + (i * 3)]) / 100;
            float y = float.Parse(points[1 + (i * 3)]) / 100;
            float z = float.Parse(points[2 + (i * 3)]) / 300;
            Body[i].transform.localPosition = new Vector3(x, y, z);
        }

  
        counter += 1;
        if (counter == lines.Count) { counter = 0; }
        Thread.Sleep(30);
    }
}</code></pre> 
<h4 id="(2)%E7%BA%BF%E6%9D%A1">(2)线条</h4> 
<pre><code class="language-cs">using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class LineCode : MonoBehaviour
{

    LineRenderer lineRenderer;

    public Transform origin;
    public Transform destination;

    void Start()
    {
        lineRenderer = GetComponent&lt;LineRenderer&gt;();
        lineRenderer.startWidth = 0.1f;
        lineRenderer.endWidth = 0.1f;
    }

    void Update()
    {
        lineRenderer.SetPosition(0, origin.position);
        lineRenderer.SetPosition(1, destination.position);
    }
}</code></pre> 
<h2 id="%E4%BA%94%E3%80%81%E7%BB%93%E6%9D%9F%E8%AF%AD">五、结束语</h2> 
<p>本次项目的实现不算很难，尤其是 Python 部分，但复现起来较为繁琐，一步步地跟着做应该没啥问题。合抱之木，生于毫末，加油！</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ea4708e1353aa271ecd9ec3fd8ebf496/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">达梦数据库安装</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0c63787fdaa53cba7b037d7b81ad0107/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Vmware安装Ubuntu Kylin麒麟系统图文</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>