<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>RK3566 多Mipi屏的兼容 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="RK3566 多Mipi屏的兼容" />
<meta property="og:description" content="需求：项目需求需要同一个固件兼容两款不同IC的mipi屏。以便有一个IC停产之后使用不受影响。由于是同一个模组厂商，所以设计初就要求硬件接口一样或者兼容。
方法：一开始的想法很简单和网上以及同行提供的方法一样在uboot阶段去读屏的ID，然后再把对应屏ID放到cmdline里面去传到kernel.在kernel里面做判断屏ID，来使用不同的panel-init-sequence 和timing。这种方法也可行。把屏的ID放到cmdline的方法是我也没找到，有大佬解答一下吗？
然后询问RK，RK提供了另一种方案不依靠cmdline传参。dts中dsi节点下面添加不同的panel节点。开机uboot阶段，通过mipi dsi读取每个屏的id寄存器与dts中设置的目标寄存器值进行比较。如果不是完全一致，就会将对应的panel节点的status设置成“disabled”。
最后会留下来唯一一个是status是“okay”的panel。kernel在加载panel的时候找到这个status是okay的panel，其他的不会加载。okay我们按照这个做法来实现我们的需求。
首先对DTB做一个深入了解。要不然怎么理解在uboot阶段把dts里面的status掉呢。在系统启动过程中，由bootloader将dtb文件加载到内存，并告知linux内核dtb在内存中的首地址（中途可能会对某些节点进行创建或者修改）。内核在start_kernel中会对dtb文件进行解析，并形成对应的device_node和property结构体；至此，dtb文件便完成任务了大佬做的详细解答可点
dtb的组成
其中structure block区域描述了设备树本身的结构和内容，strings block包含了设备树中所有属性的名称。以上都是参照链接上知乎大佬arch的文章内容。那么我理解就是dtb本身就是一个二进制文件。里面包含了我们的dts的文件内容包括节点以及属性。既然都以二进制存在。而且dtb的起始地址已知。我们只要找到节点的偏移地址以及status属性就可以把okay -&gt; disabled.欧克解决； 这个下面就开始分析代码。
首先我们要咨询屏的IC厂屏的ID在那个寄存器里面。然后编写dts。如下：
&amp;dsi0 { status = &#34;okay&#34;; //天钰IC 8553 panel@0 { status = &#34;okay&#34;; compatible = &#34;simple-panel-dsi&#34;; reg = &lt;0&gt;; backlight = &lt;&amp;backlight&gt;; iovcc-gpios = &lt;&amp;gpio0 RK_PC7 GPIO_ACTIVE_HIGH&gt;; //avdd-gpios = &lt;&amp;gpio4 RK_PC7 GPIO_ACTIVE_HIGH&gt;; avdd-gpios = &lt;&amp;gpio3 RK_PC3 GPIO_ACTIVE_HIGH&gt;; reset-gpios = &lt;&amp;gpio3 RK_PC1 GPIO_ACTIVE_LOW&gt;; init-delay-ms = &lt;60&gt;; reset-delay-ms = &lt;60&gt;; enable-delay-ms = &lt;60&gt;; prepare-delay-ms = &lt;60&gt;; unprepare-delay-ms = &lt;60&gt;; disable-delay-ms = &lt;60&gt;; dsi,flags = &lt;(MIPI_DSI_MODE_VIDEO | MIPI_DSI_MODE_VIDEO_BURST | MIPI_DSI_MODE_LPM | MIPI_DSI_MODE_EOT_PACKET)&gt;; dsi,format = &lt;MIPI_DSI_FMT_RGB888&gt;; dsi,lanes = &lt;4&gt;; num = &lt;0&gt;;	//panel的唯一标识，必须是大于等于0的整数 id = [95]; //读取id寄存器的返回值数组，十六进制 id-reg = &lt;0x04&gt;;	//id寄存器地址，1个字节，需要加“0x”表示十六进制， panel-read-id-sequence= [05 78 01 11 ------------- ]; panel-exit-sequence = [ 05 0A 01 28 05 78 01 10 ]; disp_timings0: display-timings { native-mode = &lt;&amp;dsi0_timing0&gt;; dsi0_timing0: timing0 { clock-frequency = &lt;160000000&gt;; hactive = &lt;1080&gt;; vactive = &lt;2340&gt;; hfront-porch = &lt;60&gt;; hsync-len = &lt;2&gt;; hback-porch = &lt;60&gt;; vfront-porch = &lt;20&gt;; vsync-len = &lt;2&gt;; vback-porch = &lt;8&gt;; hsync-active = &lt;0&gt;; vsync-active = &lt;0&gt;; de-active = &lt;0&gt;; pixelclk-active = &lt;1&gt;; }; }; ports { #address-cells = &lt;1&gt;; #size-cells = &lt;0&gt;; port@0 { reg = &lt;0&gt;; panel0_in_dsi0: endpoint { remote-endpoint = &lt;&amp;dsi0_out_panel0&gt;; }; }; }; }; //奇景 83112a	panel@1 { status = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/f60fae3f3a56b39f42f274c22d6efaad/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-22T10:26:06+08:00" />
<meta property="article:modified_time" content="2023-02-22T10:26:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">RK3566 多Mipi屏的兼容</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>需求：项目需求需要同一个固件兼容两款不同IC的mipi屏。以便有一个IC停产之后使用不受影响。由于是同一个模组厂商，所以设计初就要求硬件接口一样或者兼容。<br> 方法：一开始的想法很简单和网上以及同行提供的方法一样在uboot阶段去读屏的ID，然后再把对应屏ID放到cmdline里面去传到kernel.在kernel里面做判断屏ID，来使用不同的panel-init-sequence 和timing。这种方法也可行。把屏的ID放到cmdline的方法是我也没找到，有大佬解答一下吗？<br> 然后询问RK，RK提供了另一种方案不依靠cmdline传参。dts中dsi节点下面添加不同的panel节点。开机uboot阶段，通过mipi dsi读取每个屏的id寄存器与dts中设置的目标寄存器值进行比较。如果不是完全一致，就会将对应的panel节点的status设置成“disabled”。<br> 最后会留下来唯一一个是status是“okay”的panel。kernel在加载panel的时候找到这个status是okay的panel，其他的不会加载。okay我们按照这个做法来实现我们的需求。</p> 
<p>首先对DTB做一个深入了解。要不然怎么理解在uboot阶段把dts里面的status掉呢。在系统启动过程中，由bootloader将dtb文件加载到内存，并告知linux内核dtb在内存中的首地址（中途可能会对某些节点进行创建或者修改）。内核在start_kernel中会对dtb文件进行解析，并形成对应的device_node和property结构体；至此，dtb文件便完成任务了<a href="https://zhuanlan.zhihu.com/p/141623370" rel="nofollow">大佬做的详细解答可点</a><br> dtb的组成</p> 
<p><img src="https://images2.imgbox.com/3a/29/IBvRXyH4_o.png" alt="在这里插入图片描述"><br> 其中structure block区域描述了设备树本身的结构和内容，strings block包含了设备树中所有属性的名称。以上都是参照链接上知乎大佬arch的文章内容。那么我理解就是dtb本身就是一个二进制文件。里面包含了我们的dts的文件内容包括节点以及属性。既然都以二进制存在。而且dtb的起始地址已知。我们只要找到节点的偏移地址以及status属性就可以把okay -&gt; disabled.欧克解决； 这个下面就开始分析代码。</p> 
<p>首先我们要咨询屏的IC厂屏的ID在那个寄存器里面。然后编写dts。如下：</p> 
<pre><code class="prism language-c"><span class="token operator">&amp;</span>dsi0 <span class="token punctuation">{<!-- --></span>
	status <span class="token operator">=</span> <span class="token string">"okay"</span><span class="token punctuation">;</span>
<span class="token comment">//天钰IC 8553</span>
	panel@<span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
		status <span class="token operator">=</span> <span class="token string">"okay"</span><span class="token punctuation">;</span>
		compatible <span class="token operator">=</span> <span class="token string">"simple-panel-dsi"</span><span class="token punctuation">;</span>
		reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
		backlight <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>backlight<span class="token operator">&gt;</span><span class="token punctuation">;</span>
		iovcc<span class="token operator">-</span>gpios <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>gpio0 RK_PC7 GPIO_ACTIVE_HIGH<span class="token operator">&gt;</span><span class="token punctuation">;</span>
		<span class="token comment">//avdd-gpios = &lt;&amp;gpio4 RK_PC7 GPIO_ACTIVE_HIGH&gt;;</span>
		avdd<span class="token operator">-</span>gpios <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>gpio3 RK_PC3 GPIO_ACTIVE_HIGH<span class="token operator">&gt;</span><span class="token punctuation">;</span>
		reset<span class="token operator">-</span>gpios <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>gpio3 RK_PC1 GPIO_ACTIVE_LOW<span class="token operator">&gt;</span><span class="token punctuation">;</span>
		init<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">60</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
		reset<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">60</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
		enable<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">60</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
		prepare<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">60</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
		unprepare<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">60</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
		disable<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">60</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
		dsi<span class="token punctuation">,</span>flags <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span>MIPI_DSI_MODE_VIDEO <span class="token operator">|</span> MIPI_DSI_MODE_VIDEO_BURST <span class="token operator">|</span>
			MIPI_DSI_MODE_LPM <span class="token operator">|</span> MIPI_DSI_MODE_EOT_PACKET<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
		dsi<span class="token punctuation">,</span>format <span class="token operator">=</span> <span class="token operator">&lt;</span>MIPI_DSI_FMT_RGB888<span class="token operator">&gt;</span><span class="token punctuation">;</span>
		dsi<span class="token punctuation">,</span>lanes  <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">4</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
		num <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>												<span class="token comment">//panel的唯一标识，必须是大于等于0的整数</span>
	  	id <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">95</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 												<span class="token comment">//读取id寄存器的返回值数组，十六进制</span>
		id<span class="token operator">-</span>reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x04</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>										<span class="token comment">//id寄存器地址，1个字节，需要加“0x”表示十六进制，</span>
		panel<span class="token operator">-</span>read<span class="token operator">-</span>id<span class="token operator">-</span>sequence<span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">05</span> <span class="token number">78</span> <span class="token number">01</span> <span class="token number">11</span>
		<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
		<span class="token punctuation">]</span><span class="token punctuation">;</span>

		panel<span class="token operator">-</span>exit<span class="token operator">-</span>sequence <span class="token operator">=</span> <span class="token punctuation">[</span>
			<span class="token number">05</span> <span class="token number">0</span>A <span class="token number">01</span> <span class="token number">28</span>
			<span class="token number">05</span> <span class="token number">78</span> <span class="token number">01</span> <span class="token number">10</span>
		<span class="token punctuation">]</span><span class="token punctuation">;</span>

		disp_timings0<span class="token operator">:</span> display<span class="token operator">-</span>timings <span class="token punctuation">{<!-- --></span>
			native<span class="token operator">-</span>mode <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>dsi0_timing0<span class="token operator">&gt;</span><span class="token punctuation">;</span>
			dsi0_timing0<span class="token operator">:</span> timing0 <span class="token punctuation">{<!-- --></span>
				clock<span class="token operator">-</span>frequency <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">160000000</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				hactive <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1080</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				vactive <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">2340</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				hfront<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">60</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				hsync<span class="token operator">-</span>len <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				hback<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">60</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				vfront<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">20</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				vsync<span class="token operator">-</span>len <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">2</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				vback<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">8</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				hsync<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				vsync<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				de<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				pixelclk<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>

		ports <span class="token punctuation">{<!-- --></span>
			<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">address</span><span class="token expression"><span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span></span>
			<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">size</span><span class="token expression"><span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span></span>

			port@<span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
				reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				panel0_in_dsi0<span class="token operator">:</span> endpoint <span class="token punctuation">{<!-- --></span>
					remote<span class="token operator">-</span>endpoint <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>dsi0_out_panel0<span class="token operator">&gt;</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//奇景 83112a	</span>
	panel@<span class="token number">1</span> <span class="token punctuation">{<!-- --></span>
		status <span class="token operator">=</span> <span class="token string">"okay"</span><span class="token punctuation">;</span>
		compatible <span class="token operator">=</span> <span class="token string">"simple-panel-dsi"</span><span class="token punctuation">;</span>
		reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
		backlight <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>backlight<span class="token operator">&gt;</span><span class="token punctuation">;</span>
		iovcc<span class="token operator">-</span>gpios <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>gpio0 RK_PC7 GPIO_ACTIVE_HIGH<span class="token operator">&gt;</span><span class="token punctuation">;</span>
		<span class="token comment">//avdd-gpios = &lt;&amp;gpio4 RK_PC7 GPIO_ACTIVE_HIGH&gt;;</span>
		avdd<span class="token operator">-</span>gpios <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>gpio3 RK_PC3 GPIO_ACTIVE_HIGH<span class="token operator">&gt;</span><span class="token punctuation">;</span>
		reset<span class="token operator">-</span>gpios <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>gpio3 RK_PC1 GPIO_ACTIVE_LOW<span class="token operator">&gt;</span><span class="token punctuation">;</span>
		init<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">60</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
		reset<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">60</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
		enable<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">60</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
		prepare<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">60</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
		unprepare<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">60</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
		disable<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">60</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
		dsi<span class="token punctuation">,</span>flags <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token punctuation">(</span>MIPI_DSI_MODE_VIDEO <span class="token operator">|</span> MIPI_DSI_MODE_VIDEO_BURST <span class="token operator">|</span>
			MIPI_DSI_MODE_LPM <span class="token operator">|</span> MIPI_DSI_MODE_EOT_PACKET<span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
		dsi<span class="token punctuation">,</span>format <span class="token operator">=</span> <span class="token operator">&lt;</span>MIPI_DSI_FMT_RGB888<span class="token operator">&gt;</span><span class="token punctuation">;</span>
		dsi<span class="token punctuation">,</span>lanes  <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">4</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
		num <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>												<span class="token comment">//panel的唯一标识，必须是大于等于0的整数</span>
	  	id <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">83</span><span class="token punctuation">]</span><span class="token punctuation">;</span>											<span class="token comment">//读取id寄存器的返回值数组，十六进制</span>
		id<span class="token operator">-</span>reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0xB9</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>										<span class="token comment">//id寄存器地址，1个字节，需要加“0x”表示十六进制，</span>
		panel<span class="token operator">-</span>read<span class="token operator">-</span>id<span class="token operator">-</span>sequence<span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">05</span> <span class="token number">78</span> <span class="token number">01</span> <span class="token number">11</span>
								 <span class="token number">05</span> <span class="token number">32</span> <span class="token number">01</span> <span class="token number">29</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>		<span class="token comment">//如果屏读寄存器前需要发命令，添写在这个数组里面，否则就不要配置这个数组</span>
		panel<span class="token operator">-</span>init<span class="token operator">-</span>sequence <span class="token operator">=</span> <span class="token punctuation">[</span>
			<span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span>
			<span class="token number">15</span> <span class="token number">78</span> <span class="token number">02</span> <span class="token number">11</span> <span class="token number">00</span>
			<span class="token number">15</span> <span class="token number">0</span>A <span class="token number">02</span> <span class="token number">29</span> <span class="token number">00</span>
		<span class="token punctuation">]</span><span class="token punctuation">;</span>

		panel<span class="token operator">-</span>exit<span class="token operator">-</span>sequence <span class="token operator">=</span> <span class="token punctuation">[</span>
			<span class="token number">05</span> <span class="token number">0</span>A <span class="token number">01</span> <span class="token number">28</span>
			<span class="token number">05</span> <span class="token number">78</span> <span class="token number">01</span> <span class="token number">10</span>
		<span class="token punctuation">]</span><span class="token punctuation">;</span>

		display<span class="token operator">-</span>timings <span class="token punctuation">{<!-- --></span>
			native<span class="token operator">-</span>mode <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>dsi0_timing1<span class="token operator">&gt;</span><span class="token punctuation">;</span>
			dsi0_timing1<span class="token operator">:</span> timing1 <span class="token punctuation">{<!-- --></span>
				clock<span class="token operator">-</span>frequency <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">155000000</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token comment">//mast Keep FPS  53</span>
				hactive <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1080</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				vactive <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">2340</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				hfront<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">48</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				hsync<span class="token operator">-</span>len <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">44</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				hback<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">48</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				vfront<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">42</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				vsync<span class="token operator">-</span>len <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">5</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				vback<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">7</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				hsync<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				vsync<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				de<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				pixelclk<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>

		ports <span class="token punctuation">{<!-- --></span>
			<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">address</span><span class="token expression"><span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span></span>
			<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">size</span><span class="token expression"><span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span></span>

			port@<span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
				reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
				panel1_in_dsi0<span class="token operator">:</span> endpoint <span class="token punctuation">{<!-- --></span>
					remote<span class="token operator">-</span>endpoint <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>dsi0_out_panel1<span class="token operator">&gt;</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	ports <span class="token punctuation">{<!-- --></span>
		<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">address</span><span class="token expression"><span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span></span>
		<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">size</span><span class="token expression"><span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span></span>

		port@<span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
			reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

			dsi0_out_panel0<span class="token operator">:</span> endpoint <span class="token punctuation">{<!-- --></span>
				remote<span class="token operator">-</span>endpoint <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>panel0_in_dsi0<span class="token operator">&gt;</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
		port@<span class="token number">1</span> <span class="token punctuation">{<!-- --></span>
			reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

			dsi0_out_panel1<span class="token operator">:</span> endpoint <span class="token punctuation">{<!-- --></span>
				remote<span class="token operator">-</span>endpoint <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator">&amp;</span>panel1_in_dsi0<span class="token operator">&gt;</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>这里省略初始话代码。主要添加了：</p> 
<pre><code class="prism language-c">		reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token comment">//dsi的vic number，必须是0</span>
		num <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token comment">//panel的唯一标识，必须是大于等于0的整数</span>
	  	id <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">04</span> <span class="token number">05</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//读取id寄存器的返回值数组，十六进制</span>
		id<span class="token operator">-</span>reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x0a</span><span class="token operator">&gt;</span><span class="token punctuation">;</span><span class="token comment">//id寄存器地址，1个字节，需要加“0x”表示十六进制，</span>
		panel<span class="token operator">-</span>read<span class="token operator">-</span>id<span class="token operator">-</span>sequence<span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">39</span> <span class="token number">00</span> <span class="token number">04</span> FF <span class="token number">98</span> <span class="token number">81</span> <span class="token number">01</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//如果屏读寄存器前需要发命令，添写在这个数组里面，否则就不要配置这个数组。</span>
</code></pre> 
<p>然后我们在uboot里面获取id 和id_reg。然后是最主要的read屏的寄存器读出ID来和id比较。然后再看是okay改节点还是disabled掉改节点</p> 
<p>1.从dts上找到panle节点。根据上面的dts我们有俩个panel节点分别是panel@0 和panel@1 并利用device_node *np记录节点</p> 
<pre><code class="prism language-c"><span class="token operator">++</span><span class="token operator">+</span> b<span class="token operator">/</span>video<span class="token operator">/</span>drm<span class="token operator">/</span>dw_mipi_dsi<span class="token punctuation">.</span>c
<span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">dw_mipi_dsi_connector_fixup_dts</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">display_state</span> <span class="token operator">*</span>state<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>blob<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">struct</span> <span class="token class-name">connector_state</span> <span class="token operator">*</span>conn_state <span class="token operator">=</span> <span class="token operator">&amp;</span>state<span class="token operator">-&gt;</span>conn_state<span class="token punctuation">;</span> 
	<span class="token keyword">struct</span> <span class="token class-name">panel_state</span> <span class="token operator">*</span>panel_state <span class="token operator">=</span> <span class="token operator">&amp;</span>state<span class="token operator">-&gt;</span>panel_state<span class="token punctuation">;</span>
   <span class="token keyword">int</span> num <span class="token operator">=</span> panel_state<span class="token operator">-&gt;</span>panel<span class="token operator">-&gt;</span>num<span class="token punctuation">;</span>	
	<span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">device_node</span> <span class="token operator">*</span>np<span class="token punctuation">;</span>
	<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path<span class="token punctuation">;</span>
	<span class="token keyword">int</span> panel_node<span class="token punctuation">,</span>connector<span class="token punctuation">;</span>
	
	np <span class="token operator">=</span> <span class="token function">ofnode_to_np</span><span class="token punctuation">(</span>conn_state<span class="token operator">-&gt;</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
	path <span class="token operator">=</span> np<span class="token operator">-&gt;</span>full_name<span class="token punctuation">;</span>
	connector <span class="token operator">=</span> <span class="token function">fdt_path_offset</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span>panel_node <span class="token operator">=</span> <span class="token function">fdt_subnode_offset</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> connector<span class="token punctuation">,</span> <span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	     panel_node <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	     panel_node <span class="token operator">=</span> <span class="token function">fdt_next_subnode</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> panel_node<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
 
		 <span class="token function">dbg</span><span class="token punctuation">(</span><span class="token string">"fixup panel(num=%d) target =%d\n"</span><span class="token punctuation">,</span><span class="token function">fdtdec_get_int</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> panel_node<span class="token punctuation">,</span> <span class="token string">"num"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>

	    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">fdtdec_get_int</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> panel_node<span class="token punctuation">,</span> <span class="token string">"num"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">!=</span> num<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	    
			<span class="token function">fdt_status_disabled</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> panel_node<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
			<span class="token function">fdt_status_okay</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> panel_node<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	 <span class="token punctuation">}</span>
		
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>利用 fdt_subnode_offset 函数找到名称为panel的节点偏移。</p> 
<p>2.找到节点中的id以及id_reg等属性的值并给到一个定义好的结构体内填充</p> 
<pre><code class="prism language-c"><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">rockchip_panel_ofdata_to_platdata</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">udevice</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">struct</span> <span class="token class-name">rockchip_panel_plat</span> <span class="token operator">*</span>plat <span class="token operator">=</span> <span class="token function">dev_get_platdata</span><span class="token punctuation">(</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>data<span class="token punctuation">;</span>
	<span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> ret<span class="token punctuation">;</span>

	plat<span class="token operator">-&gt;</span>power_invert <span class="token operator">=</span> <span class="token function">dev_read_bool</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"power-invert"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	plat<span class="token operator">-&gt;</span>delay<span class="token punctuation">.</span>prepare <span class="token operator">=</span> <span class="token function">dev_read_u32_default</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"prepare-delay-ms"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	plat<span class="token operator">-&gt;</span>delay<span class="token punctuation">.</span>unprepare <span class="token operator">=</span> <span class="token function">dev_read_u32_default</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"unprepare-delay-ms"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	plat<span class="token operator">-&gt;</span>delay<span class="token punctuation">.</span>enable <span class="token operator">=</span> <span class="token function">dev_read_u32_default</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"enable-delay-ms"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	plat<span class="token operator">-&gt;</span>delay<span class="token punctuation">.</span>disable <span class="token operator">=</span> <span class="token function">dev_read_u32_default</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"disable-delay-ms"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	plat<span class="token operator">-&gt;</span>delay<span class="token punctuation">.</span>init <span class="token operator">=</span> <span class="token function">dev_read_u32_default</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"init-delay-ms"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	plat<span class="token operator">-&gt;</span>delay<span class="token punctuation">.</span>reset <span class="token operator">=</span> <span class="token function">dev_read_u32_default</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"reset-delay-ms"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	plat<span class="token operator">-&gt;</span>bus_format <span class="token operator">=</span> <span class="token function">dev_read_u32_default</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"bus-format"</span><span class="token punctuation">,</span>
						MEDIA_BUS_FMT_RBG888_1X24<span class="token punctuation">)</span><span class="token punctuation">;</span>
	plat<span class="token operator">-&gt;</span>bpc <span class="token operator">=</span> <span class="token function">dev_read_u32_default</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"bpc"</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	plat<span class="token operator">-&gt;</span>id_reg <span class="token operator">=</span>  <span class="token function">dev_read_u32_default</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"id-reg"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	plat<span class="token operator">-&gt;</span>num <span class="token operator">=</span> <span class="token function">dev_read_u32_default</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"num"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	data <span class="token operator">=</span> <span class="token function">dev_read_prop</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">dbg</span><span class="token punctuation">(</span><span class="token string">"wzf:-------%s------\n"</span><span class="token punctuation">,</span><span class="token constant">__func__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		plat<span class="token operator">-&gt;</span>id <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token operator">*</span>plat<span class="token operator">-&gt;</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>plat<span class="token operator">-&gt;</span>id<span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token operator">-</span>ENOMEM<span class="token punctuation">;</span>
		plat<span class="token operator">-&gt;</span>id<span class="token operator">-&gt;</span>buf <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token operator">*</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span> 	   
		<span class="token function">memcpy</span><span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>id<span class="token operator">-&gt;</span>buf<span class="token punctuation">,</span> data<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
		plat<span class="token operator">-&gt;</span>id<span class="token operator">-&gt;</span>len <span class="token operator">=</span> len<span class="token punctuation">;</span>
		<span class="token function">dbg</span><span class="token punctuation">(</span><span class="token string">"wzf:----plat dtb reg = %x id = %s len = %d"</span><span class="token punctuation">,</span>plat<span class="token operator">-&gt;</span>id_reg<span class="token punctuation">,</span>plat<span class="token operator">-&gt;</span>id<span class="token operator">-&gt;</span>buf<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token function">dbg</span><span class="token punctuation">(</span><span class="token string">"mingming--&gt;dts id reg = 0x%x\n"</span><span class="token punctuation">,</span>plat<span class="token operator">-&gt;</span>id_reg<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>len <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>len <span class="token operator">&lt;</span> plat<span class="token operator">-&gt;</span>id<span class="token operator">-&gt;</span>len<span class="token punctuation">;</span>len<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			<span class="token function">dbg</span><span class="token punctuation">(</span><span class="token string">"dts id[%d] = %x\n"</span><span class="token punctuation">,</span> len<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>id<span class="token operator">-&gt;</span>buf <span class="token operator">+</span> len<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	data <span class="token operator">=</span> <span class="token function">dev_read_prop</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"panel-init-sequence"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		plat<span class="token operator">-&gt;</span>on_cmds <span class="token operator">=</span> <span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token operator">*</span>plat<span class="token operator">-&gt;</span>on_cmds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>plat<span class="token operator">-&gt;</span>on_cmds<span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token operator">-</span>ENOMEM<span class="token punctuation">;</span>

		ret <span class="token operator">=</span> <span class="token function">rockchip_panel_parse_cmds</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> len<span class="token punctuation">,</span> plat<span class="token operator">-&gt;</span>on_cmds<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">dbg</span><span class="token punctuation">(</span><span class="token string">"failed to parse panel init sequence\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">goto</span> free_on_cmds<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	data <span class="token operator">=</span> <span class="token function">dev_read_prop</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"panel-read-id-sequence"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		plat<span class="token operator">-&gt;</span>read_id_cmds <span class="token operator">=</span> <span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token operator">*</span>plat<span class="token operator">-&gt;</span>read_id_cmds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>plat<span class="token operator">-&gt;</span>read_id_cmds<span class="token punctuation">)</span>
			<span class="token keyword">return</span> <span class="token operator">-</span>ENOMEM<span class="token punctuation">;</span>

		ret <span class="token operator">=</span> <span class="token function">rockchip_panel_parse_cmds</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> len<span class="token punctuation">,</span> plat<span class="token operator">-&gt;</span>read_id_cmds<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">dbg</span><span class="token punctuation">(</span><span class="token string">"failed to parse panel read id sequence\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">goto</span> free_read_id_cmds<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
	    plat<span class="token operator">-&gt;</span>read_id_cmds <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	data <span class="token operator">=</span> <span class="token function">dev_read_prop</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"panel-exit-sequence"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		plat<span class="token operator">-&gt;</span>off_cmds <span class="token operator">=</span> <span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token operator">*</span>plat<span class="token operator">-&gt;</span>off_cmds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>plat<span class="token operator">-&gt;</span>off_cmds<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			ret <span class="token operator">=</span> <span class="token operator">-</span>ENOMEM<span class="token punctuation">;</span>
			<span class="token keyword">goto</span> free_on_cmds<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		ret <span class="token operator">=</span> <span class="token function">rockchip_panel_parse_cmds</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> len<span class="token punctuation">,</span> plat<span class="token operator">-&gt;</span>off_cmds<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">dbg</span><span class="token punctuation">(</span><span class="token string">"failed to parse panel exit sequence\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">goto</span> free_cmds<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
</code></pre> 
<p>利用 dev_read_u32_default 函数获取dts中我们填充的对比的id给到buf以及我们读的寄存器地址，以及地址长度 plat-&gt;id_reg,plat-&gt;id-&gt;buf,len（这里原本俩块屏的id是 JD9525 以及 HI83211a但是 我们比较一个就可以比较出来我就只填了 95 83）<br> JD9525 ： plat-&gt;id-&gt; buf = 95 plat-&gt;id_reg = 0x04 len =1;<br> HI83211a: plat-&gt;id-&gt; buf = 83 plat-&gt;id_reg = 0x89 len =1;</p> 
<p>3.拿到DTS中要比对的数据那么我们就要从寄存器中读取数据</p> 
<pre><code class="prism language-c"><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">rockchip_dsi_panel_getId</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">rockchip_panel</span> <span class="token operator">*</span>panel<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	u8 <span class="token operator">*</span>buf<span class="token punctuation">;</span>
	<span class="token keyword">int</span> i<span class="token punctuation">,</span>len<span class="token punctuation">,</span>ret <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

	<span class="token keyword">struct</span> <span class="token class-name">rockchip_panel_plat</span> <span class="token operator">*</span>plat <span class="token operator">=</span> <span class="token function">dev_get_platdata</span><span class="token punctuation">(</span>panel<span class="token operator">-&gt;</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">rockchip_panel_priv</span> <span class="token operator">*</span>priv <span class="token operator">=</span> <span class="token function">dev_get_priv</span><span class="token punctuation">(</span>panel<span class="token operator">-&gt;</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">mipi_dsi_device</span> <span class="token operator">*</span>dsi <span class="token operator">=</span> <span class="token function">dev_get_parent_platdata</span><span class="token punctuation">(</span>panel<span class="token operator">-&gt;</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">dbg</span><span class="token punctuation">(</span><span class="token string">"%s(%d) start\n"</span><span class="token punctuation">,</span> <span class="token constant">__func__</span><span class="token punctuation">,</span> <span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	len <span class="token operator">=</span> plat<span class="token operator">-&gt;</span>id<span class="token operator">-&gt;</span>len<span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"mingming--&gt;%s(%d) start len:%d\n"</span><span class="token punctuation">,</span> <span class="token constant">__func__</span><span class="token punctuation">,</span> <span class="token constant">__LINE__</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
	buf <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token operator">*</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">if</span> <span class="token punctuation">(</span>priv<span class="token operator">-&gt;</span>power_supply<span class="token punctuation">)</span>
		<span class="token function">regulator_set_enable</span><span class="token punctuation">(</span>priv<span class="token operator">-&gt;</span>power_supply<span class="token punctuation">,</span> <span class="token operator">!</span>plat<span class="token operator">-&gt;</span>power_invert<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//这段要根据自己的上电时序修改</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dm_gpio_is_valid</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>priv<span class="token operator">-&gt;</span>enable_gpio<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">dm_gpio_set_value</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>priv<span class="token operator">-&gt;</span>enable_gpio<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>delay<span class="token punctuation">.</span>prepare<span class="token punctuation">)</span>
		<span class="token function">mdelay</span><span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>delay<span class="token punctuation">.</span>prepare<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dm_gpio_is_valid</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>priv<span class="token operator">-&gt;</span>reset_gpio<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">dm_gpio_set_value</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>priv<span class="token operator">-&gt;</span>reset_gpio<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>delay<span class="token punctuation">.</span>reset<span class="token punctuation">)</span>
		<span class="token function">mdelay</span><span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>delay<span class="token punctuation">.</span>reset<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dm_gpio_is_valid</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>priv<span class="token operator">-&gt;</span>reset_gpio<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token function">dm_gpio_set_value</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>priv<span class="token operator">-&gt;</span>reset_gpio<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>delay<span class="token punctuation">.</span>init<span class="token punctuation">)</span>
		<span class="token function">mdelay</span><span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>delay<span class="token punctuation">.</span>init<span class="token punctuation">)</span><span class="token punctuation">;</span>
	priv<span class="token operator">-&gt;</span>prepared <span class="token operator">=</span> true<span class="token punctuation">;</span>

	
	<span class="token keyword">if</span> <span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>read_id_cmds<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"send read id cmds\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">rockchip_panel_send_dsi_cmds</span><span class="token punctuation">(</span>dsi<span class="token punctuation">,</span> plat<span class="token operator">-&gt;</span>read_id_cmds<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token function">free</span><span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>read_id_cmds<span class="token punctuation">)</span><span class="token punctuation">;</span>
		plat<span class="token operator">-&gt;</span>read_id_cmds <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>on_cmds<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"send on cmds\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		ret <span class="token operator">=</span> <span class="token function">rockchip_panel_send_dsi_cmds</span><span class="token punctuation">(</span>dsi<span class="token punctuation">,</span> plat<span class="token operator">-&gt;</span>on_cmds<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"failed to send on cmds: %d\n"</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>	   <span class="token punctuation">}</span>     
	   
	<span class="token punctuation">}</span>

  ret <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ret <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			ret <span class="token operator">=</span> <span class="token function">mipi_dsi_set_maximum_return_packet_size</span><span class="token punctuation">(</span>dsi<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//设置要读取的值的长度由于我们dts上只有一个字节 len 为一所以他只				 会读一个字节出来</span>
		<span class="token punctuation">}</span>
		ret <span class="token operator">=</span> <span class="token function">mipi_dsi_dcs_read</span><span class="token punctuation">(</span>dsi<span class="token punctuation">,</span> plat<span class="token operator">-&gt;</span>id_reg<span class="token punctuation">,</span> buf<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//getId核心代码</span>
		count <span class="token operator">--</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
		
	<span class="token comment">//  printf("panel_simple_prepare buf = %d \n",buf[0]);</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> len<span class="token punctuation">)</span>
		<span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"read buf id[%d] = %x,panel target id[%d] = %x\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span>buf <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>id<span class="token operator">-&gt;</span>buf <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>buf <span class="token operator">+</span> i<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">*</span><span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>id<span class="token operator">-&gt;</span>buf <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>  <span class="token comment">//和第二步中的plat-&gt;id-&gt;buf比对</span>
				plat<span class="token operator">-&gt;</span>num <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
				<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
		    <span class="token function">dbg</span><span class="token punctuation">(</span><span class="token string">"read panel(num = %d) timeout or no response\n"</span><span class="token punctuation">,</span>plat<span class="token operator">-&gt;</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
			plat<span class="token operator">-&gt;</span>num <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	panel<span class="token operator">-&gt;</span>num <span class="token operator">=</span> plat<span class="token operator">-&gt;</span>num<span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>	
</code></pre> 
<p>这个利用函数mipi_dsi_dcs_read(dsi, plat-&gt;id_reg, buf,len)plat-&gt;id_reg从寄存器中读取值给到buf。<br> 那么只要buf拿到值就可以和第二步中的plat-&gt;id-&gt;buf比对if(*(buf + i) != *(plat-&gt;id-&gt;buf + i))由于我们只有一个字节 i = 0;如果多个字节i自增就可以对比多个字节。 如果匹配getId就会返回0 否则就返回-1</p> 
<p>4getId通过判断dts的id和寄存器的ID匹对来判断屏的dts和屏是否匹配。然后就要okay 该panel节点 或者disabled该节点。</p> 
<pre><code class="prism language-c"><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">panel_matching</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">display_state</span> <span class="token operator">*</span>state<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">struct</span> <span class="token class-name">connector_state</span> <span class="token operator">*</span>conn_state <span class="token operator">=</span> <span class="token operator">&amp;</span>state<span class="token operator">-&gt;</span>conn_state<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">panel_state</span> <span class="token operator">*</span>panel_state <span class="token operator">=</span> <span class="token operator">&amp;</span>state<span class="token operator">-&gt;</span>panel_state<span class="token punctuation">;</span>
	<span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">rockchip_connector</span> <span class="token operator">*</span>conn <span class="token operator">=</span> conn_state<span class="token operator">-&gt;</span>connector<span class="token punctuation">;</span>
	<span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">rockchip_connector_funcs</span> <span class="token operator">*</span>conn_funcs <span class="token operator">=</span> conn<span class="token operator">-&gt;</span>funcs<span class="token punctuation">;</span>
	ofnode panel_node<span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">udevice</span> <span class="token operator">*</span>panel_dev<span class="token punctuation">;</span>
	<span class="token keyword">int</span> ret<span class="token punctuation">;</span>


       <span class="token keyword">if</span> <span class="token punctuation">(</span>conn_funcs<span class="token operator">-&gt;</span>init<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
           ret <span class="token operator">=</span> conn_funcs<span class="token operator">-&gt;</span><span class="token function">init</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
	    <span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"failed to init connector\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	    		<span class="token keyword">goto</span> deinit<span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
	
	<span class="token keyword">if</span> <span class="token punctuation">(</span>conn_state<span class="token operator">-&gt;</span>phy<span class="token punctuation">)</span>
			<span class="token function">rockchip_phy_init</span><span class="token punctuation">(</span>conn_state<span class="token operator">-&gt;</span>phy<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token function">ofnode_for_each_subnode</span><span class="token punctuation">(</span>panel_node<span class="token punctuation">,</span> conn_state<span class="token operator">-&gt;</span>node<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ofnode_valid</span><span class="token punctuation">(</span>panel_node<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">ofnode_is_available</span><span class="token punctuation">(</span>panel_node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	        ret <span class="token operator">=</span> <span class="token function">uclass_get_device_by_ofnode</span><span class="token punctuation">(</span>UCLASS_PANEL<span class="token punctuation">,</span> panel_node<span class="token punctuation">,</span>
	        				  <span class="token operator">&amp;</span>panel_dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
	        <span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
	        	 <span class="token function">dbg</span><span class="token punctuation">(</span><span class="token string">"this sub node is not a panel node\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	        	 <span class="token keyword">continue</span><span class="token punctuation">;</span>
	        <span class="token punctuation">}</span>
	        
        <span class="token punctuation">}</span>
        <span class="token keyword">struct</span> <span class="token class-name">rockchip_panel</span> <span class="token operator">*</span>panel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">rockchip_panel</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">dev_get_driver_data</span><span class="token punctuation">(</span>panel_dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>panel<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>

			panel<span class="token operator">-&gt;</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>
		    panel_state<span class="token operator">-&gt;</span>panel <span class="token operator">=</span> panel<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>conn_funcs<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"failed to find connector functions\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	        <span class="token keyword">return</span> <span class="token operator">-</span>ENXIO<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">if</span> <span class="token punctuation">(</span>panel_state<span class="token operator">-&gt;</span>panel<span class="token punctuation">)</span>
          <span class="token function">rockchip_panel_init</span><span class="token punctuation">(</span>panel_state<span class="token operator">-&gt;</span>panel<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
       	<span class="token keyword">if</span> <span class="token punctuation">(</span>conn_funcs<span class="token operator">-&gt;</span>prepare<span class="token punctuation">)</span>
 		    conn_funcs<span class="token operator">-&gt;</span><span class="token function">prepare</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s(%d) getid\n"</span><span class="token punctuation">,</span> <span class="token constant">__func__</span><span class="token punctuation">,</span> <span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			   
	    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">rockchip_panel_getId</span><span class="token punctuation">(</span>panel_state<span class="token operator">-&gt;</span>panel<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>   <span class="token comment">//调用getId函数 如果）=-1 就是屏和dts匹配直接break；如果不等于执行下面的rockchip_panel_disable函数 把该节点disabled掉</span>
	   	   <span class="token function">dbg</span><span class="token punctuation">(</span><span class="token string">"dsi find panel id\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		   <span class="token function">rockchip_panel_unprepare</span><span class="token punctuation">(</span>panel_state<span class="token operator">-&gt;</span>panel<span class="token punctuation">)</span><span class="token punctuation">;</span>
	   	   <span class="token keyword">break</span><span class="token punctuation">;</span>
	    <span class="token punctuation">}</span>
	    <span class="token function">rockchip_panel_unprepare</span><span class="token punctuation">(</span>panel_state<span class="token operator">-&gt;</span>panel<span class="token punctuation">)</span><span class="token punctuation">;</span>
 	    <span class="token function">rockchip_panel_disable</span><span class="token punctuation">(</span>panel_state<span class="token operator">-&gt;</span>panel<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>conn_funcs<span class="token operator">-&gt;</span>disable<span class="token punctuation">)</span>
	   conn_funcs<span class="token operator">-&gt;</span><span class="token function">disable</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
	<span class="token keyword">if</span> <span class="token punctuation">(</span>conn_funcs<span class="token operator">-&gt;</span>unprepare<span class="token punctuation">)</span>
	   conn_funcs<span class="token operator">-&gt;</span><span class="token function">unprepare</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
	deinit<span class="token operator">:</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>conn_funcs<span class="token operator">-&gt;</span>deinit<span class="token punctuation">)</span>
		conn_funcs<span class="token operator">-&gt;</span><span class="token function">deinit</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> ret<span class="token punctuation">;</span>	    
<span class="token punctuation">}</span>
</code></pre> 
<p>通过 ofnode_for_each_subnode遍历dsi下所有子节点。然后调用getId函数 如 ！= - 1 就是屏和dts匹配直接break；如果不等于执行下面的rockchip_panel_disable函数 把该节点disabled掉。因此我们的所有panel节点都应设置为okay。然后等待disabeld掉不适用的节点。</p> 
<p>补充说明：<br> 把节点disabled掉的并不是rockchip_panel_disable函数。而是fdt_setprope等fdt函数。<br> <img src="https://images2.imgbox.com/70/eb/iK0z0NFq_o.png" alt="在这里插入图片描述"><br> 然后我们把板子里面的dtb文件导出来查看是否正常被disabled掉status<a href="https://blog.csdn.net/weixin_43245753/article/details/127092104">参考链接</a><br> <img src="https://images2.imgbox.com/9d/fa/KA6lfULI_o.png" alt="在这里插入图片描述"><br> 把板子里面的/sys/firmware/fdt文件导出来。<br> 再放到我们的编译服务器使用dtc命令 把fdt转化成dts文件<br> dtc -I dtb -O dts fdt</p> 
<pre><code class="prism language-c">导出来的dts文件：
        dsi@fe060000 <span class="token punctuation">{<!-- --></span>
                compatible <span class="token operator">=</span> <span class="token string">"rockchip,rk3568-mipi-dsi"</span><span class="token punctuation">;</span>
                reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x00</span> <span class="token number">0xfe060000</span> <span class="token number">0x00</span> <span class="token number">0x10000</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                interrupts <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x00</span> <span class="token number">0x44</span> <span class="token number">0x04</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                clocks <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x1f</span> <span class="token number">0xe8</span> <span class="token number">0x1f</span> <span class="token number">0xda</span> <span class="token number">0x2e</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                clock<span class="token operator">-</span>names <span class="token operator">=</span> <span class="token string">"pclk\0hclk\0hs_clk"</span><span class="token punctuation">;</span>
                resets <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x1f</span> <span class="token number">0x110</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                reset<span class="token operator">-</span>names <span class="token operator">=</span> <span class="token string">"apb"</span><span class="token punctuation">;</span>
                phys <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x2e</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                phy<span class="token operator">-</span>names <span class="token operator">=</span> <span class="token string">"mipi_dphy"</span><span class="token punctuation">;</span>
                power<span class="token operator">-</span>domains <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x21</span> <span class="token number">0x09</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                rockchip<span class="token punctuation">,</span>grf <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x32</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">address</span><span class="token expression"><span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x01</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span></span>
                <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">size</span><span class="token expression"><span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span></span>
                status <span class="token operator">=</span> <span class="token string">"okay"</span><span class="token punctuation">;</span>
                phandle <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x190</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

                ports <span class="token punctuation">{<!-- --></span>
                        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">address</span><span class="token expression"><span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x01</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span></span>
                        <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">size</span><span class="token expression"><span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span></span>

                        port@<span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
                                reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">address</span><span class="token expression"><span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x01</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span></span>
                                <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">size</span><span class="token expression"><span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span></span>
                                phandle <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x191</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

                                endpoint@<span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
                                        reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        remote<span class="token operator">-</span>endpoint <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x14</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        status <span class="token operator">=</span> <span class="token string">"okay"</span><span class="token punctuation">;</span>
                                        phandle <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x89</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span><span class="token punctuation">;</span>

                                endpoint@<span class="token number">1</span> <span class="token punctuation">{<!-- --></span>
                                        reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x01</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        remote<span class="token operator">-</span>endpoint <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x94</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        status <span class="token operator">=</span> <span class="token string">"disabled"</span><span class="token punctuation">;</span>
                                        phandle <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x8d</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span><span class="token punctuation">;</span>

                                endpoint <span class="token punctuation">{<!-- --></span>
                                        remote<span class="token operator">-</span>endpoint <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x95</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        phandle <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x9a</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">;</span>

                        port@<span class="token number">1</span> <span class="token punctuation">{<!-- --></span>
                                reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x01</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

                                endpoint <span class="token punctuation">{<!-- --></span>
                                        remote<span class="token operator">-</span>endpoint <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x96</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        phandle <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x9c</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>

                panel@<span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
                        status <span class="token operator">=</span> <span class="token string">"okay"</span><span class="token punctuation">;</span>
                        compatible <span class="token operator">=</span> <span class="token string">"simple-panel-dsi"</span><span class="token punctuation">;</span>
                        reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        backlight <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x97</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        iovcc<span class="token operator">-</span>gpios <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x36</span> <span class="token number">0x17</span> <span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        avdd<span class="token operator">-</span>gpios <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x98</span> <span class="token number">0x13</span> <span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        reset<span class="token operator">-</span>gpios <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x98</span> <span class="token number">0x11</span> <span class="token number">0x01</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        init<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x3c</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        reset<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x3c</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        enable<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x3c</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        prepare<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x3c</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        unprepare<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x3c</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        disable<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x3c</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        dsi<span class="token punctuation">,</span>flags <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0xa03</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        dsi<span class="token punctuation">,</span>format <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        dsi<span class="token punctuation">,</span>lanes <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x04</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        num <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        id <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">95</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                        id<span class="token operator">-</span>reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x04</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        panel<span class="token operator">-</span>read<span class="token operator">-</span>id<span class="token operator">-</span>sequence <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x5780111</span> <span class="token number">0x5320129</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        panel<span class="token operator">-</span>init<span class="token operator">-</span>sequence <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">39</span> <span class="token number">00</span> <span class="token number">04</span> df <span class="token number">95</span> <span class="token number">25</span> ba <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> de <span class="token number">00</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">04</span> b9 <span class="token number">7</span>c <span class="token number">43</span> <span class="token number">85</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">08</span> bb <span class="token number">00</span> <span class="token number">11</span> <span class="token number">43</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">11</span> <span class="token number">11</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">03</span> bd <span class="token number">00</span> <span class="token number">22</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">04</span> bc <span class="token number">2</span>e <span class="token number">30</span> <span class="token number">73</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">05</span> bf <span class="token number">2</span>c <span class="token number">2</span>c <span class="token number">3f</span> c3 <span class="token number">39</span> <span class="token number">00</span> <span class="token number">06</span> c0 <span class="token number">00</span> f7 <span class="token number">01</span> f7 <span class="token number">01</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">04</span> c1 <span class="token number">04</span> <span class="token number">11</span> <span class="token number">40</span> <span class="token number">39</span> <span class="token number">01</span> <span class="token number">41</span> c3 <span class="token number">3</span>b <span class="token number">01</span> <span class="token number">06</span> <span class="token number">05</span> <span class="token number">03</span> <span class="token number">03</span> <span class="token number">03</span> <span class="token number">01</span> <span class="token number">01</span> <span class="token number">01</span> <span class="token number">01</span> <span class="token number">01</span> <span class="token number">01</span> <span class="token number">01</span> <span class="token number">01</span> <span class="token number">01</span> <span class="token number">06</span> <span class="token number">2</span>b <span class="token number">30</span> <span class="token number">54</span> <span class="token number">58</span> <span class="token number">7</span>d <span class="token number">01</span> <span class="token number">80</span> ff ff <span class="token number">00</span> <span class="token number">05</span> <span class="token number">03</span> <span class="token number">7f</span> <span class="token number">00</span> <span class="token number">04</span> <span class="token number">00</span> <span class="token number">04</span> <span class="token number">00</span> <span class="token number">04</span> <span class="token number">02</span> <span class="token number">13</span> ff ff <span class="token number">02</span> <span class="token number">13</span> <span class="token number">03</span> <span class="token number">00</span> <span class="token number">03</span> <span class="token number">02</span> <span class="token number">03</span> <span class="token number">03</span> <span class="token number">00</span> <span class="token number">03</span> ff ff <span class="token number">00</span> <span class="token number">07</span> ff ff <span class="token number">03</span> <span class="token number">0</span>d <span class="token number">03</span> <span class="token number">0</span>d <span class="token number">03</span> <span class="token number">0</span>d <span class="token number">03</span> <span class="token number">0</span>d <span class="token number">39</span> <span class="token number">01</span> <span class="token number">40</span> c4 <span class="token number">01</span> <span class="token number">06</span> <span class="token number">05</span> <span class="token number">03</span> <span class="token number">03</span> <span class="token number">03</span> <span class="token number">01</span> <span class="token number">01</span> <span class="token number">01</span> <span class="token number">01</span> <span class="token number">01</span> <span class="token number">01</span> <span class="token number">01</span> <span class="token number">01</span> <span class="token number">01</span> <span class="token number">06</span> <span class="token number">2</span>b <span class="token number">30</span> <span class="token number">54</span> <span class="token number">58</span> <span class="token number">7</span>d <span class="token number">01</span> <span class="token number">80</span> <span class="token number">03</span> <span class="token number">0</span>d <span class="token number">00</span> <span class="token number">05</span> <span class="token number">03</span> <span class="token number">0</span>d <span class="token number">00</span> <span class="token number">04</span> <span class="token number">00</span> <span class="token number">04</span> <span class="token number">00</span> <span class="token number">04</span> <span class="token number">02</span> <span class="token number">13</span> <span class="token number">02</span> <span class="token number">13</span> <span class="token number">02</span> <span class="token number">13</span> <span class="token number">03</span> <span class="token number">03</span> <span class="token number">03</span> <span class="token number">03</span> <span class="token number">03</span> <span class="token number">03</span> <span class="token number">00</span> <span class="token number">03</span> ff ff <span class="token number">00</span> <span class="token number">07</span> <span class="token number">03</span> <span class="token number">0</span>d <span class="token number">03</span> <span class="token number">0</span>d <span class="token number">03</span> <span class="token number">0</span>d <span class="token number">03</span> <span class="token number">0</span>d <span class="token number">03</span> <span class="token number">0</span>d <span class="token number">39</span> <span class="token number">01</span> <span class="token number">18</span> c6 <span class="token number">01</span> <span class="token number">49</span> <span class="token number">00</span> <span class="token number">36</span> <span class="token number">00</span> <span class="token number">0</span>a <span class="token number">05</span> <span class="token number">82</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">35</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">01</span> <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> c7 <span class="token number">40</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">08</span> c8 <span class="token number">45</span> <span class="token number">92</span> <span class="token number">87</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">17</span> cd <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">02</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">3f</span> <span class="token number">3f</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">1</span>d ce <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">0</span>c <span class="token number">0</span>c <span class="token number">0</span>c <span class="token number">0</span>c <span class="token number">0</span>c <span class="token number">0</span>c fc fc ff fc fc <span class="token number">0</span>c <span class="token number">0</span>c <span class="token number">0</span>c <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">39</span> <span class="token number">01</span> <span class="token number">35</span> cf <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">33</span> <span class="token number">00</span> <span class="token number">3f</span> <span class="token number">33</span> <span class="token number">33</span> <span class="token number">3f</span> <span class="token number">3f</span> <span class="token number">3f</span> <span class="token number">33</span> <span class="token number">33</span> <span class="token number">33</span> <span class="token number">33</span> <span class="token number">33</span> <span class="token number">33</span> <span class="token number">33</span> <span class="token number">33</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> ff <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> ff <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">39</span> <span class="token number">01</span> <span class="token number">20</span> d0 <span class="token number">00</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1</span>e <span class="token number">1f</span> df df df f6 f5 f4 c5 c7 d5 de de de df c1 ff ff ff f0 <span class="token number">00</span> <span class="token number">00</span> <span class="token number">39</span> <span class="token number">01</span> <span class="token number">20</span> d1 <span class="token number">00</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1</span>e <span class="token number">1f</span> df df df f6 f5 f4 c4 c6 d5 de de de df c0 ff ff ff f0 <span class="token number">00</span> <span class="token number">00</span> <span class="token number">39</span> <span class="token number">01</span> <span class="token number">1</span>d d2 <span class="token number">00</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1</span>e <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">36</span> <span class="token number">35</span> <span class="token number">34</span> c6 c4 d5 de de <span class="token number">1f</span> <span class="token number">1</span>e <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">39</span> <span class="token number">01</span> <span class="token number">1</span>d d3 <span class="token number">00</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1</span>e <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">1f</span> <span class="token number">36</span> <span class="token number">35</span> <span class="token number">34</span> c7 c5 d5 de de <span class="token number">1f</span> <span class="token number">1</span>e <span class="token number">01</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">39</span> <span class="token number">01</span> <span class="token number">3</span>e d4 <span class="token number">10</span> <span class="token number">10</span> <span class="token number">00</span> <span class="token number">08</span> <span class="token number">00</span> <span class="token number">05</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">01</span> <span class="token number">02</span> <span class="token number">00</span> <span class="token number">11</span> e0 <span class="token number">01</span> <span class="token number">00</span> <span class="token number">04</span> <span class="token number">01</span> <span class="token number">01</span> <span class="token number">11</span> e0 <span class="token number">03</span> <span class="token number">00</span> <span class="token number">05</span> <span class="token number">01</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">02</span> <span class="token number">04</span> <span class="token number">0</span>a <span class="token number">09</span> <span class="token number">38</span> <span class="token number">00</span> <span class="token number">0f</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">03</span> <span class="token number">00</span> <span class="token number">26</span> <span class="token number">30</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">39</span> <span class="token number">01</span> <span class="token number">5</span>d d5 <span class="token number">01</span> <span class="token number">10</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> e8 <span class="token number">00</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">07</span> <span class="token number">32</span> <span class="token number">5</span>a <span class="token number">10</span> <span class="token number">40</span> <span class="token number">05</span> <span class="token number">00</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">30</span> <span class="token number">30</span> <span class="token number">00</span> <span class="token number">01</span> <span class="token number">14</span> <span class="token number">00</span> <span class="token number">71</span> <span class="token number">00</span> <span class="token number">04</span> <span class="token number">10</span> <span class="token number">04</span> <span class="token number">06</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">09</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">1</span>b <span class="token number">00</span> <span class="token number">00</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">06</span> <span class="token number">00</span> <span class="token number">2</span>b <span class="token number">00</span> <span class="token number">30</span> <span class="token number">00</span> <span class="token number">54</span> <span class="token number">00</span> <span class="token number">59</span> <span class="token number">00</span> <span class="token number">7</span>d <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> ff ff ff <span class="token number">3f</span> <span class="token number">3f</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">1f</span> ff <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">1f</span> ff <span class="token number">00</span> ff ff ff ff ff ff <span class="token number">00</span> <span class="token number">39</span> <span class="token number">01</span> <span class="token number">14</span> d7 <span class="token number">00</span> <span class="token number">02</span> <span class="token number">84</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">02</span> <span class="token number">84</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> de <span class="token number">01</span> <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> b5 <span class="token number">69</span> <span class="token number">39</span> <span class="token number">01</span> <span class="token number">30</span> c2 <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">01</span> <span class="token number">55</span> <span class="token number">55</span> <span class="token number">6</span>a aa ff f0 <span class="token number">00</span> <span class="token number">00</span> <span class="token number">0</span>e <span class="token number">21</span> <span class="token number">33</span> <span class="token number">42</span> <span class="token number">52</span> <span class="token number">5</span>c <span class="token number">68</span> <span class="token number">7</span>d <span class="token number">91</span> a0 ac e1 <span class="token number">05</span> <span class="token number">22</span> <span class="token number">3</span>e <span class="token number">57</span> <span class="token number">70</span> <span class="token number">70</span> <span class="token number">8</span>e ab cd f6 <span class="token number">25</span> <span class="token number">65</span> <span class="token number">91</span> ab cb dd f4 <span class="token number">0</span>e <span class="token number">28</span> <span class="token number">49</span> <span class="token number">78</span> bb f8 <span class="token number">39</span> <span class="token number">01</span> <span class="token number">30</span> c1 <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">01</span> <span class="token number">55</span> <span class="token number">55</span> <span class="token number">6</span>a aa ff f0 <span class="token number">04</span> <span class="token number">05</span> <span class="token number">16</span> <span class="token number">29</span> <span class="token number">3</span>b <span class="token number">4</span>a <span class="token number">5</span>a <span class="token number">64</span> <span class="token number">70</span> <span class="token number">85</span> <span class="token number">99</span> a8 b4 e9 <span class="token number">0</span>d <span class="token number">2</span>a <span class="token number">46</span> <span class="token number">5f</span> <span class="token number">78</span> <span class="token number">78</span> <span class="token number">96</span> b3 d5 fe <span class="token number">2</span>d <span class="token number">6</span>d <span class="token number">99</span> b3 d3 e5 fc <span class="token number">16</span> <span class="token number">30</span> <span class="token number">51</span> <span class="token number">80</span> c3 ff <span class="token number">39</span> <span class="token number">01</span> <span class="token number">30</span> c3 <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">01</span> <span class="token number">55</span> <span class="token number">55</span> <span class="token number">6</span>a aa ff f0 <span class="token number">00</span> <span class="token number">00</span> <span class="token number">0</span>e <span class="token number">21</span> <span class="token number">33</span> <span class="token number">42</span> <span class="token number">52</span> <span class="token number">5</span>c <span class="token number">68</span> <span class="token number">7</span>d <span class="token number">91</span> a0 ac e1 <span class="token number">05</span> <span class="token number">22</span> <span class="token number">3</span>e <span class="token number">57</span> <span class="token number">70</span> <span class="token number">70</span> <span class="token number">8</span>e ab cd f6 <span class="token number">25</span> <span class="token number">65</span> <span class="token number">91</span> ab cb dd f4 <span class="token number">0</span>e <span class="token number">28</span> <span class="token number">49</span> <span class="token number">78</span> bb f8 <span class="token number">39</span> <span class="token number">01</span> <span class="token number">30</span> c4 <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">01</span> <span class="token number">55</span> <span class="token number">55</span> <span class="token number">6</span>a aa ff f0 <span class="token number">04</span> <span class="token number">05</span> <span class="token number">16</span> <span class="token number">29</span> <span class="token number">3</span>b <span class="token number">4</span>a <span class="token number">5</span>a <span class="token number">64</span> <span class="token number">70</span> <span class="token number">85</span> <span class="token number">99</span> a8 b4 e9 <span class="token number">0</span>d <span class="token number">2</span>a <span class="token number">46</span> <span class="token number">5f</span> <span class="token number">78</span> <span class="token number">78</span> <span class="token number">96</span> b3 d5 fe <span class="token number">2</span>d <span class="token number">6</span>d <span class="token number">99</span> b3 d3 e5 fc <span class="token number">16</span> <span class="token number">30</span> <span class="token number">51</span> <span class="token number">80</span> c3 ff <span class="token number">39</span> <span class="token number">01</span> <span class="token number">30</span> c6 <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">01</span> <span class="token number">55</span> <span class="token number">55</span> <span class="token number">6</span>a aa ff f0 <span class="token number">00</span> <span class="token number">00</span> <span class="token number">0</span>e <span class="token number">21</span> <span class="token number">33</span> <span class="token number">42</span> <span class="token number">52</span> <span class="token number">5</span>c <span class="token number">68</span> <span class="token number">7</span>d <span class="token number">91</span> a0 ac e1 <span class="token number">05</span> <span class="token number">22</span> <span class="token number">3</span>e <span class="token number">57</span> <span class="token number">70</span> <span class="token number">70</span> <span class="token number">8</span>e ab cd f6 <span class="token number">25</span> <span class="token number">65</span> <span class="token number">91</span> ab cb dd f4 <span class="token number">0</span>e <span class="token number">28</span> <span class="token number">49</span> <span class="token number">78</span> bb f8 <span class="token number">39</span> <span class="token number">01</span> <span class="token number">30</span> c5 <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">01</span> <span class="token number">55</span> <span class="token number">55</span> <span class="token number">6</span>a aa ff f0 <span class="token number">04</span> <span class="token number">05</span> <span class="token number">16</span> <span class="token number">29</span> <span class="token number">3</span>b <span class="token number">4</span>a <span class="token number">5</span>a <span class="token number">64</span> <span class="token number">70</span> <span class="token number">85</span> <span class="token number">99</span> a8 b4 e9 <span class="token number">0</span>d <span class="token number">2</span>a <span class="token number">46</span> <span class="token number">5f</span> <span class="token number">78</span> <span class="token number">78</span> <span class="token number">96</span> b3 d5 fe <span class="token number">2</span>d <span class="token number">6</span>d <span class="token number">99</span> b3 d3 e5 fc <span class="token number">16</span> <span class="token number">30</span> <span class="token number">51</span> <span class="token number">80</span> c3 ff <span class="token number">39</span> <span class="token number">01</span> <span class="token number">0</span>c c7 <span class="token number">15</span> <span class="token number">14</span> <span class="token number">07</span> <span class="token number">07</span> <span class="token number">09</span> <span class="token number">07</span> <span class="token number">87</span> <span class="token number">63</span> <span class="token number">62</span> <span class="token number">63</span> <span class="token number">04</span> <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> de <span class="token number">02</span> <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> bf <span class="token number">04</span> <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> c1 <span class="token number">20</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">0</span>a c2 <span class="token number">02</span> <span class="token number">42</span> d0 <span class="token number">02</span> <span class="token number">00</span> c0 <span class="token number">41</span> <span class="token number">72</span> fb <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> c5 <span class="token number">0</span>e <span class="token number">39</span> <span class="token number">00</span> <span class="token number">08</span> c4 <span class="token number">00</span> <span class="token number">11</span> <span class="token number">0f</span> <span class="token number">80</span> <span class="token number">1</span>c <span class="token number">01</span> <span class="token number">08</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">17</span> e5 <span class="token number">10</span> da d8 <span class="token number">02</span> <span class="token number">2</span>b c0 <span class="token number">2</span>b c0 <span class="token number">09</span> <span class="token number">04</span> <span class="token number">40</span> <span class="token number">40</span> <span class="token number">00</span> <span class="token number">20</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">28</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">05</span> ec <span class="token number">77</span> <span class="token number">00</span> <span class="token number">5f</span> <span class="token number">02</span> <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> de <span class="token number">03</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">03</span> d0 <span class="token number">00</span> <span class="token number">65</span> <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> de <span class="token number">00</span> <span class="token number">05</span> <span class="token number">1</span>e <span class="token number">01</span> <span class="token number">35</span> <span class="token number">05</span> <span class="token number">78</span> <span class="token number">01</span> <span class="token number">11</span> <span class="token number">05</span> <span class="token number">32</span> <span class="token number">01</span> <span class="token number">29</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                        panel<span class="token operator">-</span>exit<span class="token operator">-</span>sequence <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x50a0128</span> <span class="token number">0x5780110</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

                        display<span class="token operator">-</span>timings <span class="token punctuation">{<!-- --></span>
                                native<span class="token operator">-</span>mode <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x99</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                phandle <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x192</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

                                timing0 <span class="token punctuation">{<!-- --></span>
                                        clock<span class="token operator">-</span>frequency <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x9896800</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        hactive <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x438</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        vactive <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x924</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        hfront<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x3c</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        hsync<span class="token operator">-</span>len <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x02</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        hback<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x3c</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        vfront<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x14</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        vsync<span class="token operator">-</span>len <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x02</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        vback<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x08</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        hsync<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        vsync<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        de<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        pixelclk<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x01</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        phandle <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x99</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">;</span>

                        ports <span class="token punctuation">{<!-- --></span>
                                <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">address</span><span class="token expression"><span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x01</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span></span>
                                <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">size</span><span class="token expression"><span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span></span>

                                port@<span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
                                        reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

                                        endpoint <span class="token punctuation">{<!-- --></span>
                                                remote<span class="token operator">-</span>endpoint <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x9a</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                                phandle <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x95</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        <span class="token punctuation">}</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>

                panel@<span class="token number">1</span> <span class="token punctuation">{<!-- --></span>
                        status <span class="token operator">=</span> <span class="token string">"disabled"</span><span class="token punctuation">;</span>
                        compatible <span class="token operator">=</span> <span class="token string">"simple-panel-dsi"</span><span class="token punctuation">;</span>
                        reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        backlight <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x97</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        iovcc<span class="token operator">-</span>gpios <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x36</span> <span class="token number">0x17</span> <span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        avdd<span class="token operator">-</span>gpios <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x98</span> <span class="token number">0x13</span> <span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        reset<span class="token operator">-</span>gpios <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x98</span> <span class="token number">0x11</span> <span class="token number">0x01</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        init<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x3c</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        reset<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x3c</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        enable<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x3c</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        prepare<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x3c</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        unprepare<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x3c</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        disable<span class="token operator">-</span>delay<span class="token operator">-</span>ms <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x3c</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        dsi<span class="token punctuation">,</span>flags <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0xa03</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        dsi<span class="token punctuation">,</span>format <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        dsi<span class="token punctuation">,</span>lanes <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x04</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        num <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x01</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        id <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">83</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                        id<span class="token operator">-</span>reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0xb9</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        panel<span class="token operator">-</span>read<span class="token operator">-</span>id<span class="token operator">-</span>sequence <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x5780111</span> <span class="token number">0x5320129</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                        panel<span class="token operator">-</span>init<span class="token operator">-</span>sequence <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">39</span> <span class="token number">00</span> <span class="token number">04</span> b9 <span class="token number">83</span> <span class="token number">11</span> <span class="token number">2</span>a <span class="token number">39</span> <span class="token number">00</span> <span class="token number">09</span> b1 <span class="token number">08</span> <span class="token number">25</span> <span class="token number">25</span> <span class="token number">80</span> <span class="token number">80</span> <span class="token number">4</span>a <span class="token number">4f</span> aa <span class="token number">39</span> <span class="token number">00</span> <span class="token number">0f</span> b2 <span class="token number">00</span> <span class="token number">02</span> <span class="token number">00</span> <span class="token number">90</span> <span class="token number">24</span> <span class="token number">00</span> <span class="token number">0</span>a <span class="token number">28</span> ea <span class="token number">11</span> <span class="token number">00</span> <span class="token number">01</span> <span class="token number">15</span> a0 <span class="token number">39</span> <span class="token number">00</span> <span class="token number">03</span> d2 <span class="token number">2</span>b <span class="token number">2</span>b <span class="token number">39</span> <span class="token number">00</span> <span class="token number">1</span>c b4 <span class="token number">02</span> ba <span class="token number">02</span> ba <span class="token number">02</span> ba <span class="token number">04</span> bc <span class="token number">00</span> <span class="token number">00</span> <span class="token number">04</span> bc <span class="token number">00</span> ff <span class="token number">00</span> ff <span class="token number">00</span> <span class="token number">00</span> <span class="token number">0</span>c <span class="token number">12</span> <span class="token number">00</span> <span class="token number">2</span>a <span class="token number">06</span> <span class="token number">06</span> <span class="token number">0f</span> <span class="token number">00</span> <span class="token number">86</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">04</span> b6 <span class="token number">8</span>c <span class="token number">8</span>c e3 <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> cc <span class="token number">08</span> <span class="token number">39</span> <span class="token number">05</span> <span class="token number">30</span> d3 <span class="token number">40</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">14</span> <span class="token number">14</span> <span class="token number">03</span> <span class="token number">01</span> <span class="token number">11</span> <span class="token number">08</span> <span class="token number">03</span> <span class="token number">03</span> <span class="token number">03</span> <span class="token number">03</span> <span class="token number">32</span> <span class="token number">10</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">32</span> <span class="token number">10</span> <span class="token number">0</span>a <span class="token number">00</span> <span class="token number">0</span>a <span class="token number">32</span> <span class="token number">10</span> <span class="token number">08</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> ea <span class="token number">1</span>c <span class="token number">39</span> <span class="token number">05</span> <span class="token number">31</span> d5 <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> c0 c0 <span class="token number">18</span> <span class="token number">18</span> <span class="token number">40</span> <span class="token number">40</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">31</span> <span class="token number">31</span> <span class="token number">30</span> <span class="token number">30</span> <span class="token number">2f</span> <span class="token number">2f</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">03</span> <span class="token number">02</span> <span class="token number">20</span> <span class="token number">20</span> c0 c0 c0 c0 <span class="token number">19</span> <span class="token number">19</span> <span class="token number">40</span> <span class="token number">40</span> <span class="token number">25</span> <span class="token number">24</span> <span class="token number">39</span> <span class="token number">05</span> <span class="token number">31</span> d6 <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">40</span> <span class="token number">40</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">40</span> <span class="token number">40</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">18</span> <span class="token number">31</span> <span class="token number">31</span> <span class="token number">30</span> <span class="token number">30</span> <span class="token number">2f</span> <span class="token number">2f</span> <span class="token number">00</span> <span class="token number">01</span> <span class="token number">02</span> <span class="token number">03</span> <span class="token number">20</span> <span class="token number">20</span> <span class="token number">40</span> <span class="token number">40</span> <span class="token number">40</span> <span class="token number">40</span> <span class="token number">40</span> <span class="token number">40</span> <span class="token number">19</span> <span class="token number">19</span> <span class="token number">24</span> <span class="token number">25</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">0</span>d d8 aa aa aa aa ff ea aa aa aa aa ff ea <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> bd <span class="token number">01</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">0</span>d d8 aa aa af ff ff ff aa aa af ff ff ff <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> bd <span class="token number">02</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">0</span>d d8 aa aa af ff ff ff aa aa af ff ff ff <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> bd <span class="token number">03</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">19</span> d8 aa aa ae bf ab ea aa aa ae bf ab ea aa aa af ff ff ff aa aa af ff ff ff <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> bd <span class="token number">00</span> <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> c1 <span class="token number">01</span> <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> bd <span class="token number">01</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">3</span>a c1 ff fa f6 f2 ee ea e6 dd d9 d5 d1 cd c8 c4 c0 bc b7 b3 ae a6 <span class="token number">9</span>d <span class="token number">95</span> <span class="token number">8</span>c <span class="token number">84</span> <span class="token number">7</span>c <span class="token number">74</span> <span class="token number">6</span>c <span class="token number">64</span> <span class="token number">5</span>c <span class="token number">55</span> <span class="token number">4</span>c <span class="token number">46</span> <span class="token number">3f</span> <span class="token number">37</span> <span class="token number">2f</span> <span class="token number">28</span> <span class="token number">20</span> <span class="token number">19</span> <span class="token number">12</span> <span class="token number">0</span>a <span class="token number">07</span> <span class="token number">05</span> <span class="token number">03</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">28</span> <span class="token number">03</span> e9 <span class="token number">95</span> <span class="token number">8</span>c <span class="token number">8</span>e f9 c8 <span class="token number">18</span> e7 <span class="token number">12</span> <span class="token number">00</span> <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> bd <span class="token number">02</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">3</span>a c1 ff fa f6 f2 ee ea e6 dd d9 d5 d1 cd c8 c4 c0 bc b7 b3 ae a6 <span class="token number">9</span>d <span class="token number">95</span> <span class="token number">8</span>c <span class="token number">84</span> <span class="token number">7</span>c <span class="token number">74</span> <span class="token number">6</span>c <span class="token number">64</span> <span class="token number">5</span>c <span class="token number">55</span> <span class="token number">4</span>c <span class="token number">46</span> <span class="token number">3f</span> <span class="token number">37</span> <span class="token number">2f</span> <span class="token number">28</span> <span class="token number">20</span> <span class="token number">19</span> <span class="token number">12</span> <span class="token number">0</span>a <span class="token number">07</span> <span class="token number">05</span> <span class="token number">03</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">28</span> <span class="token number">03</span> e9 <span class="token number">95</span> <span class="token number">8</span>c <span class="token number">8</span>e f9 c8 <span class="token number">18</span> e7 <span class="token number">12</span> <span class="token number">00</span> <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> bd <span class="token number">03</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">3</span>a c1 ff fa f6 f2 ee ea e6 dd d9 d5 d1 cd c8 c4 c0 bc b7 b3 ae a6 <span class="token number">9</span>d <span class="token number">95</span> <span class="token number">8</span>c <span class="token number">84</span> <span class="token number">7</span>c <span class="token number">74</span> <span class="token number">6</span>c <span class="token number">64</span> <span class="token number">5</span>c <span class="token number">55</span> <span class="token number">4</span>c <span class="token number">46</span> <span class="token number">3f</span> <span class="token number">37</span> <span class="token number">2f</span> <span class="token number">28</span> <span class="token number">20</span> <span class="token number">19</span> <span class="token number">12</span> <span class="token number">0</span>a <span class="token number">07</span> <span class="token number">05</span> <span class="token number">03</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">28</span> <span class="token number">03</span> e9 <span class="token number">95</span> <span class="token number">8</span>c <span class="token number">8</span>e f9 c8 <span class="token number">18</span> e7 <span class="token number">12</span> <span class="token number">00</span> <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> bd <span class="token number">00</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">1</span>a e7 <span class="token number">0f</span> <span class="token number">0f</span> <span class="token number">1</span>e <span class="token number">68</span> <span class="token number">1</span>e <span class="token number">65</span> <span class="token number">00</span> <span class="token number">50</span> <span class="token number">01</span> <span class="token number">14</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">02</span> <span class="token number">02</span> <span class="token number">02</span> <span class="token number">05</span> <span class="token number">14</span> <span class="token number">14</span> <span class="token number">32</span> b9 <span class="token number">23</span> b9 <span class="token number">08</span> <span class="token number">13</span> <span class="token number">69</span> <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> bd <span class="token number">01</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">09</span> e7 <span class="token number">02</span> <span class="token number">00</span> ba <span class="token number">01</span> a4 <span class="token number">0</span>e <span class="token number">20</span> <span class="token number">0f</span> <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> bd <span class="token number">02</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">1</span>e e7 <span class="token number">00</span> <span class="token number">00</span> <span class="token number">08</span> <span class="token number">40</span> <span class="token number">01</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">00</span> <span class="token number">04</span> <span class="token number">00</span> <span class="token number">70</span> <span class="token number">01</span> <span class="token number">70</span> <span class="token number">02</span> <span class="token number">00</span> <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> bd <span class="token number">00</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">03</span> c0 <span class="token number">22</span> <span class="token number">22</span> <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> bd <span class="token number">02</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">0</span>a b4 <span class="token number">00</span> <span class="token number">92</span> <span class="token number">12</span> <span class="token number">11</span> <span class="token number">88</span> <span class="token number">12</span> <span class="token number">12</span> <span class="token number">00</span> <span class="token number">53</span> <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> bd <span class="token number">01</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">04</span> b1 <span class="token number">64</span> <span class="token number">01</span> <span class="token number">09</span> <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> bd <span class="token number">00</span> <span class="token number">39</span> <span class="token number">00</span> <span class="token number">07</span> c7 <span class="token number">00</span> <span class="token number">00</span> <span class="token number">04</span> e0 <span class="token number">33</span> <span class="token number">00</span> <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> e9 c3 <span class="token number">39</span> <span class="token number">00</span> <span class="token number">05</span> cb <span class="token number">91</span> d2 <span class="token number">00</span> <span class="token number">02</span> <span class="token number">15</span> <span class="token number">00</span> <span class="token number">02</span> e9 <span class="token number">3f</span> <span class="token number">15</span> <span class="token number">78</span> <span class="token number">02</span> <span class="token number">11</span> <span class="token number">00</span> <span class="token number">15</span> <span class="token number">0</span>a <span class="token number">02</span> <span class="token number">29</span> <span class="token number">00</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                        panel<span class="token operator">-</span>exit<span class="token operator">-</span>sequence <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x50a0128</span> <span class="token number">0x5780110</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

                        display<span class="token operator">-</span>timings <span class="token punctuation">{<!-- --></span>
                                native<span class="token operator">-</span>mode <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x9b</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

                                timing1 <span class="token punctuation">{<!-- --></span>
                                        clock<span class="token operator">-</span>frequency <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x93d1cc0</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        hactive <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x438</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        vactive <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x924</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        hfront<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x30</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        hsync<span class="token operator">-</span>len <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x2c</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        hback<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x30</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        vfront<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x2a</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        vsync<span class="token operator">-</span>len <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x05</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        vback<span class="token operator">-</span>porch <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x07</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        hsync<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        vsync<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        de<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        pixelclk<span class="token operator">-</span>active <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x01</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        phandle <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x9b</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">;</span>

                        ports <span class="token punctuation">{<!-- --></span>
                                <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">address</span><span class="token expression"><span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x01</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span></span>
                                <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">size</span><span class="token expression"><span class="token operator">-</span>cells <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span></span></span>

                                port@<span class="token number">0</span> <span class="token punctuation">{<!-- --></span>
                                        reg <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x00</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>

                                        endpoint <span class="token punctuation">{<!-- --></span>
                                                remote<span class="token operator">-</span>endpoint <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x9c</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                                phandle <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">0x96</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
                                        <span class="token punctuation">}</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>可以看到panel@1已经被disabled掉了 。原本我们的dts都写的是okay。表示我们功能已经实现。</p> 
<p>ok流程代码分析结束。我们再追一下源码看rockchip_panel_disable是怎么做的</p> 
<pre><code class="prism language-c"><span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">panel_simple_enable</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">rockchip_panel</span> <span class="token operator">*</span>panel<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">struct</span> <span class="token class-name">rockchip_panel_plat</span> <span class="token operator">*</span>plat <span class="token operator">=</span> <span class="token function">dev_get_platdata</span><span class="token punctuation">(</span>panel<span class="token operator">-&gt;</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">rockchip_panel_priv</span> <span class="token operator">*</span>priv <span class="token operator">=</span> <span class="token function">dev_get_priv</span><span class="token punctuation">(</span>panel<span class="token operator">-&gt;</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>priv<span class="token operator">-&gt;</span>enabled<span class="token punctuation">)</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>delay<span class="token punctuation">.</span>enable<span class="token punctuation">)</span>
		<span class="token function">mdelay</span><span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>delay<span class="token punctuation">.</span>enable<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>priv<span class="token operator">-&gt;</span>backlight<span class="token punctuation">)</span>
		<span class="token function">backlight_enable</span><span class="token punctuation">(</span>priv<span class="token operator">-&gt;</span>backlight<span class="token punctuation">)</span><span class="token punctuation">;</span>

	priv<span class="token operator">-&gt;</span>enabled <span class="token operator">=</span> true<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">panel_simple_disable</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">rockchip_panel</span> <span class="token operator">*</span>panel<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">struct</span> <span class="token class-name">rockchip_panel_plat</span> <span class="token operator">*</span>plat <span class="token operator">=</span> <span class="token function">dev_get_platdata</span><span class="token punctuation">(</span>panel<span class="token operator">-&gt;</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">struct</span> <span class="token class-name">rockchip_panel_priv</span> <span class="token operator">*</span>priv <span class="token operator">=</span> <span class="token function">dev_get_priv</span><span class="token punctuation">(</span>panel<span class="token operator">-&gt;</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>priv<span class="token operator">-&gt;</span>enabled<span class="token punctuation">)</span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>priv<span class="token operator">-&gt;</span>backlight<span class="token punctuation">)</span>
		<span class="token function">backlight_disable</span><span class="token punctuation">(</span>priv<span class="token operator">-&gt;</span>backlight<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>delay<span class="token punctuation">.</span>disable<span class="token punctuation">)</span>
		<span class="token function">mdelay</span><span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>delay<span class="token punctuation">.</span>disable<span class="token punctuation">)</span><span class="token punctuation">;</span>

	priv<span class="token operator">-&gt;</span>enabled <span class="token operator">=</span> false<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>看不懂。好了我们在来看一下mipi_dsi的函数</p> 
<pre><code class="prism language-c"><span class="token class-name">ssize_t</span> <span class="token function">mipi_dsi_dcs_read</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">mipi_dsi_device</span> <span class="token operator">*</span>dsi<span class="token punctuation">,</span> u8 cmd<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>data<span class="token punctuation">,</span>
			  <span class="token class-name">size_t</span> len<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">struct</span> <span class="token class-name">mipi_dsi_msg</span> msg <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
		<span class="token punctuation">.</span>channel <span class="token operator">=</span> dsi<span class="token operator">-&gt;</span>channel<span class="token punctuation">,</span>
		<span class="token punctuation">.</span>type <span class="token operator">=</span> MIPI_DSI_DCS_READ<span class="token punctuation">,</span>
		<span class="token punctuation">.</span>tx_buf <span class="token operator">=</span> <span class="token operator">&amp;</span>cmd<span class="token punctuation">,</span>
		<span class="token punctuation">.</span>tx_len <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>
		<span class="token punctuation">.</span>rx_buf <span class="token operator">=</span> data<span class="token punctuation">,</span>
		<span class="token punctuation">.</span>rx_len <span class="token operator">=</span> len
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token function">mipi_dsi_device_transfer</span><span class="token punctuation">(</span>dsi<span class="token punctuation">,</span> <span class="token operator">&amp;</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>好了它就是填充了一个消息结构体，然后跟i2c一样transfer。读到数据。具体mipi帧格式我也不知道。<br> uboot patch</p> 
<pre><code class="prism language-c">diff <span class="token operator">--</span>git a<span class="token operator">/</span>video<span class="token operator">/</span>drm<span class="token operator">/</span>dw_mipi_dsi<span class="token punctuation">.</span>c b<span class="token operator">/</span>video<span class="token operator">/</span>drm<span class="token operator">/</span>dw_mipi_dsi<span class="token punctuation">.</span>c
old mode <span class="token number">100644</span>
new mode <span class="token number">100755</span>
index bf43669<span class="token punctuation">.</span><span class="token number">.7</span>cd2f29
<span class="token operator">--</span><span class="token operator">-</span> a<span class="token operator">/</span>video<span class="token operator">/</span>drm<span class="token operator">/</span>dw_mipi_dsi<span class="token punctuation">.</span>c
<span class="token operator">++</span><span class="token operator">+</span> b<span class="token operator">/</span>video<span class="token operator">/</span>drm<span class="token operator">/</span>dw_mipi_dsi<span class="token punctuation">.</span>c
@@ <span class="token operator">-</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">6</span> <span class="token operator">+</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">7</span> @@
 <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;syscon.h&gt;</span></span>
 <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;asm/arch-rockchip/clock.h&gt;</span></span>
 <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;linux/iopoll.h&gt;</span></span>
<span class="token operator">+</span>#include <span class="token operator">&lt;</span>fdt_support<span class="token punctuation">.</span>h<span class="token operator">&gt;</span>
 
 <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"rockchip_display.h"</span></span>
 <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"rockchip_crtc.h"</span></span>
@@ <span class="token operator">-</span><span class="token number">655</span><span class="token punctuation">,</span><span class="token number">7</span> <span class="token operator">+</span><span class="token number">656</span><span class="token punctuation">,</span><span class="token number">7</span> @@ <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">dw_mipi_dsi_read_from_fifo</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">dw_mipi_dsi</span> <span class="token operator">*</span>dsi<span class="token punctuation">,</span>
 	<span class="token keyword">int</span> ret<span class="token punctuation">;</span>
 
 	ret <span class="token operator">=</span> <span class="token function">readl_poll_timeout</span><span class="token punctuation">(</span>dsi<span class="token operator">-&gt;</span>base <span class="token operator">+</span> DSI_CMD_PKT_STATUS<span class="token punctuation">,</span>
<span class="token operator">-</span>				 val<span class="token punctuation">,</span> <span class="token operator">!</span><span class="token punctuation">(</span>val <span class="token operator">&amp;</span> GEN_RD_CMD_BUSY<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>				 val<span class="token punctuation">,</span> <span class="token operator">!</span><span class="token punctuation">(</span>val <span class="token operator">&amp;</span> GEN_RD_CMD_BUSY<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">50000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 	<span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
 		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"entire response isn't stored in the FIFO\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 		<span class="token keyword">return</span> ret<span class="token punctuation">;</span>
@@ <span class="token operator">-</span><span class="token number">718</span><span class="token punctuation">,</span><span class="token number">7</span> <span class="token operator">+</span><span class="token number">719</span><span class="token punctuation">,</span><span class="token number">6</span> @@ <span class="token keyword">static</span> <span class="token class-name">ssize_t</span> <span class="token function">dw_mipi_dsi_transfer</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">dw_mipi_dsi</span> <span class="token operator">*</span>dsi<span class="token punctuation">,</span>
 	<span class="token keyword">struct</span> <span class="token class-name">mipi_dsi_packet</span> packet<span class="token punctuation">;</span>
 	<span class="token keyword">int</span> ret<span class="token punctuation">;</span>
 	<span class="token keyword">int</span> val<span class="token punctuation">;</span>
<span class="token operator">-</span>
 	<span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token operator">-&gt;</span>flags <span class="token operator">&amp;</span> MIPI_DSI_MSG_USE_LPM<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
 		<span class="token function">dsi_update_bits</span><span class="token punctuation">(</span>dsi<span class="token punctuation">,</span> DSI_VID_MODE_CFG<span class="token punctuation">,</span> LP_CMD_EN<span class="token punctuation">,</span> LP_CMD_EN<span class="token punctuation">)</span><span class="token punctuation">;</span>
 		<span class="token function">dsi_update_bits</span><span class="token punctuation">(</span>dsi<span class="token punctuation">,</span> DSI_LPCLK_CTRL<span class="token punctuation">,</span> PHY_TXREQUESTCLKHS<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
@@ <span class="token operator">-</span><span class="token number">1237</span><span class="token punctuation">,</span><span class="token number">6</span> <span class="token operator">+</span><span class="token number">1237</span><span class="token punctuation">,</span><span class="token number">7</span> @@ <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">dw_mipi_dsi_connector_prepare</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">display_state</span> <span class="token operator">*</span>state<span class="token punctuation">)</span>
 	<span class="token punctuation">}</span>
 
 	lane_rate <span class="token operator">=</span> <span class="token function">dw_mipi_dsi_get_lane_rate</span><span class="token punctuation">(</span>dsi<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">if</span><span class="token punctuation">(</span>lane_rate <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> lane_rate <span class="token operator">=</span> <span class="token number">1000000000UL</span><span class="token punctuation">;</span>
 	<span class="token keyword">if</span> <span class="token punctuation">(</span>dsi<span class="token operator">-&gt;</span>dphy<span class="token punctuation">.</span>phy<span class="token punctuation">)</span>
 		<span class="token function">dw_mipi_dsi_set_hs_clk</span><span class="token punctuation">(</span>dsi<span class="token punctuation">,</span> lane_rate<span class="token punctuation">)</span><span class="token punctuation">;</span>
 	<span class="token keyword">else</span>
@@ <span class="token operator">-</span><span class="token number">1279</span><span class="token punctuation">,</span><span class="token number">12</span> <span class="token operator">+</span><span class="token number">1280</span><span class="token punctuation">,</span><span class="token number">43</span> @@ <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">dw_mipi_dsi_connector_disable</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">display_state</span> <span class="token operator">*</span>state<span class="token punctuation">)</span>
 	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 
<span class="token operator">+</span><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">dw_mipi_dsi_connector_fixup_dts</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">display_state</span> <span class="token operator">*</span>state<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>blob<span class="token punctuation">)</span>
<span class="token operator">+</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>	<span class="token keyword">struct</span> <span class="token class-name">connector_state</span> <span class="token operator">*</span>conn_state <span class="token operator">=</span> <span class="token operator">&amp;</span>state<span class="token operator">-&gt;</span>conn_state<span class="token punctuation">;</span> 
<span class="token operator">+</span>	<span class="token keyword">struct</span> <span class="token class-name">panel_state</span> <span class="token operator">*</span>panel_state <span class="token operator">=</span> <span class="token operator">&amp;</span>state<span class="token operator">-&gt;</span>panel_state<span class="token punctuation">;</span>
<span class="token operator">+</span>    <span class="token keyword">int</span> num <span class="token operator">=</span> panel_state<span class="token operator">-&gt;</span>panel<span class="token operator">-&gt;</span>num<span class="token punctuation">;</span>	
<span class="token operator">+</span>	<span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">device_node</span> <span class="token operator">*</span>np<span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path<span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">int</span> panel_node<span class="token punctuation">,</span>connector<span class="token punctuation">;</span>
<span class="token operator">+</span>	
<span class="token operator">+</span>	np <span class="token operator">=</span> <span class="token function">ofnode_to_np</span><span class="token punctuation">(</span>conn_state<span class="token operator">-&gt;</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	path <span class="token operator">=</span> np<span class="token operator">-&gt;</span>full_name<span class="token punctuation">;</span>
<span class="token operator">+</span>	connector <span class="token operator">=</span> <span class="token function">fdt_path_offset</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>	<span class="token keyword">for</span> <span class="token punctuation">(</span>panel_node <span class="token operator">=</span> <span class="token function">fdt_subnode_offset</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> connector<span class="token punctuation">,</span> <span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	     panel_node <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	     panel_node <span class="token operator">=</span> <span class="token function">fdt_next_subnode</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> panel_node<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span> 
<span class="token operator">+</span>		 <span class="token function">dbg</span><span class="token punctuation">(</span><span class="token string">"fixup panel(num=%d) target =%d\n"</span><span class="token punctuation">,</span><span class="token function">fdtdec_get_int</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> panel_node<span class="token punctuation">,</span> <span class="token string">"num"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>	    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">fdtdec_get_int</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> panel_node<span class="token punctuation">,</span> <span class="token string">"num"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">!=</span> num<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>	    
<span class="token operator">+</span>			<span class="token function">fdt_status_disabled</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> panel_node<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>			<span class="token function">fdt_status_okay</span><span class="token punctuation">(</span>blob<span class="token punctuation">,</span> panel_node<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		<span class="token punctuation">}</span>
<span class="token operator">+</span>	 <span class="token punctuation">}</span>
<span class="token operator">+</span>		
<span class="token operator">+</span>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token punctuation">}</span>
<span class="token operator">+</span>
 <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">rockchip_connector_funcs</span> dw_mipi_dsi_connector_funcs <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
 	<span class="token punctuation">.</span>init <span class="token operator">=</span> dw_mipi_dsi_connector_init<span class="token punctuation">,</span>
 	<span class="token punctuation">.</span>prepare <span class="token operator">=</span> dw_mipi_dsi_connector_prepare<span class="token punctuation">,</span>
 	<span class="token punctuation">.</span>unprepare <span class="token operator">=</span> dw_mipi_dsi_connector_unprepare<span class="token punctuation">,</span>
 	<span class="token punctuation">.</span>enable <span class="token operator">=</span> dw_mipi_dsi_connector_enable<span class="token punctuation">,</span>
 	<span class="token punctuation">.</span>disable <span class="token operator">=</span> dw_mipi_dsi_connector_disable<span class="token punctuation">,</span>
<span class="token operator">+</span>	<span class="token punctuation">.</span>fixup_dts <span class="token operator">=</span> dw_mipi_dsi_connector_fixup_dts<span class="token punctuation">,</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
 
 <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">dw_mipi_dsi_probe</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">udevice</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span>
diff <span class="token operator">--</span>git a<span class="token operator">/</span>video<span class="token operator">/</span>drm<span class="token operator">/</span>rockchip_display<span class="token punctuation">.</span>c b<span class="token operator">/</span>video<span class="token operator">/</span>drm<span class="token operator">/</span>rockchip_display<span class="token punctuation">.</span>c
old mode <span class="token number">100644</span>
new mode <span class="token number">100755</span>
index <span class="token number">139</span>a338<span class="token punctuation">.</span><span class="token number">.2636f</span>de
<span class="token operator">--</span><span class="token operator">-</span> a<span class="token operator">/</span>video<span class="token operator">/</span>drm<span class="token operator">/</span>rockchip_display<span class="token punctuation">.</span>c
<span class="token operator">++</span><span class="token operator">+</span> b<span class="token operator">/</span>video<span class="token operator">/</span>drm<span class="token operator">/</span>rockchip_display<span class="token punctuation">.</span>c
@@ <span class="token operator">-</span><span class="token number">236</span><span class="token punctuation">,</span><span class="token number">6</span> <span class="token operator">+</span><span class="token number">236</span><span class="token punctuation">,</span><span class="token number">77</span> @@ <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">connector_panel_init</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">display_state</span> <span class="token operator">*</span>state<span class="token punctuation">)</span>
 	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 
<span class="token operator">+</span><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">panel_matching</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">display_state</span> <span class="token operator">*</span>state<span class="token punctuation">)</span>
<span class="token operator">+</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>	<span class="token keyword">struct</span> <span class="token class-name">connector_state</span> <span class="token operator">*</span>conn_state <span class="token operator">=</span> <span class="token operator">&amp;</span>state<span class="token operator">-&gt;</span>conn_state<span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">struct</span> <span class="token class-name">panel_state</span> <span class="token operator">*</span>panel_state <span class="token operator">=</span> <span class="token operator">&amp;</span>state<span class="token operator">-&gt;</span>panel_state<span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">rockchip_connector</span> <span class="token operator">*</span>conn <span class="token operator">=</span> conn_state<span class="token operator">-&gt;</span>connector<span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">rockchip_connector_funcs</span> <span class="token operator">*</span>conn_funcs <span class="token operator">=</span> conn<span class="token operator">-&gt;</span>funcs<span class="token punctuation">;</span>
<span class="token operator">+</span>	ofnode panel_node<span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">struct</span> <span class="token class-name">udevice</span> <span class="token operator">*</span>panel_dev<span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">int</span> ret<span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>
<span class="token operator">+</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>conn_funcs<span class="token operator">-&gt;</span>init<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>            ret <span class="token operator">=</span> conn_funcs<span class="token operator">-&gt;</span><span class="token function">init</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	    <span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"failed to init connector\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	    		<span class="token keyword">goto</span> deinit<span class="token punctuation">;</span>
<span class="token operator">+</span>	    <span class="token punctuation">}</span>
<span class="token operator">+</span>        <span class="token punctuation">}</span>
<span class="token operator">+</span>	
<span class="token operator">+</span>	<span class="token keyword">if</span> <span class="token punctuation">(</span>conn_state<span class="token operator">-&gt;</span>phy<span class="token punctuation">)</span>
<span class="token operator">+</span>			<span class="token function">rockchip_phy_init</span><span class="token punctuation">(</span>conn_state<span class="token operator">-&gt;</span>phy<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	
<span class="token operator">+</span>	<span class="token function">ofnode_for_each_subnode</span><span class="token punctuation">(</span>panel_node<span class="token punctuation">,</span> conn_state<span class="token operator">-&gt;</span>node<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>
<span class="token operator">+</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ofnode_valid</span><span class="token punctuation">(</span>panel_node<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">ofnode_is_available</span><span class="token punctuation">(</span>panel_node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>	        ret <span class="token operator">=</span> <span class="token function">uclass_get_device_by_ofnode</span><span class="token punctuation">(</span>UCLASS_PANEL<span class="token punctuation">,</span> panel_node<span class="token punctuation">,</span>
<span class="token operator">+</span>	        				  <span class="token operator">&amp;</span>panel_dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	        <span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>	        	 <span class="token function">dbg</span><span class="token punctuation">(</span><span class="token string">"this sub node is not a panel node\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	        	 <span class="token keyword">continue</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	        <span class="token punctuation">}</span>
<span class="token operator">+</span>	        
<span class="token operator">+</span>        <span class="token punctuation">}</span>
<span class="token operator">+</span>        <span class="token keyword">struct</span> <span class="token class-name">rockchip_panel</span> <span class="token operator">*</span>panel <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">rockchip_panel</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">dev_get_driver_data</span><span class="token punctuation">(</span>panel_dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>panel<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>
<span class="token operator">+</span>			panel<span class="token operator">-&gt;</span>state <span class="token operator">=</span> state<span class="token punctuation">;</span>
<span class="token operator">+</span>		    panel_state<span class="token operator">-&gt;</span>panel <span class="token operator">=</span> panel<span class="token punctuation">;</span>
<span class="token operator">+</span>        <span class="token punctuation">}</span>
<span class="token operator">+</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>conn_funcs<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>	        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"failed to find connector functions\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	        <span class="token keyword">return</span> <span class="token operator">-</span>ENXIO<span class="token punctuation">;</span>
<span class="token operator">+</span>        <span class="token punctuation">}</span>
<span class="token operator">+</span>        
<span class="token operator">+</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>panel_state<span class="token operator">-&gt;</span>panel<span class="token punctuation">)</span>
<span class="token operator">+</span>          <span class="token function">rockchip_panel_init</span><span class="token punctuation">(</span>panel_state<span class="token operator">-&gt;</span>panel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		
<span class="token operator">+</span>       	<span class="token keyword">if</span> <span class="token punctuation">(</span>conn_funcs<span class="token operator">-&gt;</span>prepare<span class="token punctuation">)</span>
<span class="token operator">+</span>   		    conn_funcs<span class="token operator">-&gt;</span><span class="token function">prepare</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s(%d) getid\n"</span><span class="token punctuation">,</span> <span class="token constant">__func__</span><span class="token punctuation">,</span> <span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			   
<span class="token operator">+</span>	    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">rockchip_panel_getId</span><span class="token punctuation">(</span>panel_state<span class="token operator">-&gt;</span>panel<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>	   	   <span class="token function">dbg</span><span class="token punctuation">(</span><span class="token string">"dsi find panel id\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		   <span class="token function">rockchip_panel_unprepare</span><span class="token punctuation">(</span>panel_state<span class="token operator">-&gt;</span>panel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	   	   <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	    <span class="token punctuation">}</span>
<span class="token operator">+</span>	    <span class="token function">rockchip_panel_unprepare</span><span class="token punctuation">(</span>panel_state<span class="token operator">-&gt;</span>panel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span> 	    <span class="token function">rockchip_panel_disable</span><span class="token punctuation">(</span>panel_state<span class="token operator">-&gt;</span>panel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token punctuation">}</span>
<span class="token operator">+</span>	<span class="token keyword">if</span> <span class="token punctuation">(</span>conn_funcs<span class="token operator">-&gt;</span>disable<span class="token punctuation">)</span>
<span class="token operator">+</span>	   conn_funcs<span class="token operator">-&gt;</span><span class="token function">disable</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>    
<span class="token operator">+</span>	<span class="token keyword">if</span> <span class="token punctuation">(</span>conn_funcs<span class="token operator">-&gt;</span>unprepare<span class="token punctuation">)</span>
<span class="token operator">+</span>	   conn_funcs<span class="token operator">-&gt;</span><span class="token function">unprepare</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	deinit<span class="token operator">:</span>
<span class="token operator">+</span>	<span class="token keyword">if</span> <span class="token punctuation">(</span>conn_funcs<span class="token operator">-&gt;</span>deinit<span class="token punctuation">)</span>
<span class="token operator">+</span>		conn_funcs<span class="token operator">-&gt;</span><span class="token function">deinit</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">return</span> ret<span class="token punctuation">;</span>	    
<span class="token operator">+</span><span class="token punctuation">}</span>
<span class="token operator">+</span>
 <span class="token keyword">int</span> <span class="token function">drm_mode_vrefresh</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">drm_display_mode</span> <span class="token operator">*</span>mode<span class="token punctuation">)</span>
 <span class="token punctuation">{<!-- --></span>
 	<span class="token keyword">int</span> refresh <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
@@ <span class="token operator">-</span><span class="token number">544</span><span class="token punctuation">,</span><span class="token number">6</span> <span class="token operator">+</span><span class="token number">615</span><span class="token punctuation">,</span><span class="token number">20</span> @@ <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">display_init</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">display_state</span> <span class="token operator">*</span>state<span class="token punctuation">)</span>
 		<span class="token keyword">return</span> <span class="token operator">-</span>ENXIO<span class="token punctuation">;</span>
 	<span class="token punctuation">}</span>
 
<span class="token operator">+</span>	 <span class="token function">ofnode_for_each_subnode</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> state<span class="token operator">-&gt;</span>conn_state<span class="token punctuation">.</span>node<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>			<span class="token keyword">const</span>	<span class="token keyword">struct</span> <span class="token class-name">device_node</span> <span class="token operator">*</span>np<span class="token punctuation">;</span>
<span class="token operator">+</span>			<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path<span class="token punctuation">;</span>
<span class="token operator">+</span>			np <span class="token operator">=</span> <span class="token function">ofnode_to_np</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>			path <span class="token operator">=</span> np<span class="token operator">-&gt;</span>full_name<span class="token punctuation">;</span>
<span class="token operator">+</span>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strstr</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">"panel"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">+</span>		        i<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	 <span class="token punctuation">}</span>
<span class="token operator">+</span>
<span class="token operator">+</span>		<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token function">panel_matching</span><span class="token punctuation">(</span>state<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Warn: Failed to match panel drivers\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		<span class="token punctuation">}</span>
<span class="token operator">+</span>
<span class="token operator">+</span>
 	<span class="token keyword">if</span> <span class="token punctuation">(</span>crtc_state<span class="token operator">-&gt;</span>crtc<span class="token operator">-&gt;</span>active <span class="token operator">&amp;&amp;</span>
 	    <span class="token function">memcmp</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>crtc_state<span class="token operator">-&gt;</span>crtc<span class="token operator">-&gt;</span>active_mode<span class="token punctuation">,</span> <span class="token operator">&amp;</span>conn_state<span class="token operator">-&gt;</span>mode<span class="token punctuation">,</span>
 		   <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">drm_display_mode</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
diff <span class="token operator">--</span>git a<span class="token operator">/</span>video<span class="token operator">/</span>drm<span class="token operator">/</span>rockchip_display<span class="token punctuation">.</span>h b<span class="token operator">/</span>video<span class="token operator">/</span>drm<span class="token operator">/</span>rockchip_display<span class="token punctuation">.</span>h
old mode <span class="token number">100644</span>
new mode <span class="token number">100755</span>
index <span class="token number">5e89157</span><span class="token punctuation">.</span><span class="token number">.3</span>cd0075
<span class="token operator">--</span><span class="token operator">-</span> a<span class="token operator">/</span>video<span class="token operator">/</span>drm<span class="token operator">/</span>rockchip_display<span class="token punctuation">.</span>h
<span class="token operator">++</span><span class="token operator">+</span> b<span class="token operator">/</span>video<span class="token operator">/</span>drm<span class="token operator">/</span>rockchip_display<span class="token punctuation">.</span>h
@@ <span class="token operator">-</span><span class="token number">53</span><span class="token punctuation">,</span><span class="token number">6</span> <span class="token operator">+</span><span class="token number">53</span><span class="token punctuation">,</span><span class="token number">12</span> @@ <span class="token keyword">enum</span> <span class="token class-name">rockchip_mcu_cmd</span> <span class="token punctuation">{<!-- --></span>
 <span class="token comment">/* for use special outface */</span>
 <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ROCKCHIP_OUT_MODE_AAAA</span>	<span class="token expression"><span class="token number">15</span></span></span>
 
<span class="token operator">+</span>#<span class="token keyword">if</span> <span class="token number">1</span>
<span class="token operator">+</span>#define <span class="token function">dbg</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span> arg<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"DSI-READ: "</span> format <span class="token string">"\n"</span><span class="token punctuation">,</span> ## arg<span class="token punctuation">)</span>
<span class="token operator">+</span>#<span class="token keyword">else</span>
<span class="token operator">+</span>#define <span class="token function">dbg</span><span class="token punctuation">(</span>format<span class="token punctuation">,</span> arg<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token operator">+</span>#endif 
<span class="token operator">+</span>
 <span class="token keyword">struct</span> <span class="token class-name">rockchip_mcu_timing</span> <span class="token punctuation">{<!-- --></span>
 	<span class="token keyword">int</span> mcu_pix_total<span class="token punctuation">;</span>
 	<span class="token keyword">int</span> mcu_cs_pst<span class="token punctuation">;</span>
@@ <span class="token operator">-</span><span class="token number">95</span><span class="token punctuation">,</span><span class="token number">7</span> <span class="token operator">+</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">7</span> @@ <span class="token keyword">struct</span> <span class="token class-name">crtc_state</span> <span class="token punctuation">{<!-- --></span>
 
 <span class="token keyword">struct</span> <span class="token class-name">panel_state</span> <span class="token punctuation">{<!-- --></span>
 	<span class="token keyword">struct</span> <span class="token class-name">rockchip_panel</span> <span class="token operator">*</span>panel<span class="token punctuation">;</span>
<span class="token operator">-</span>
<span class="token operator">+</span>	<span class="token keyword">int</span> num<span class="token punctuation">;</span>
 	ofnode dsp_lut_node<span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
 
diff <span class="token operator">--</span>git a<span class="token operator">/</span>video<span class="token operator">/</span>drm<span class="token operator">/</span>rockchip_panel<span class="token punctuation">.</span>c b<span class="token operator">/</span>video<span class="token operator">/</span>drm<span class="token operator">/</span>rockchip_panel<span class="token punctuation">.</span>c
old mode <span class="token number">100644</span>
new mode <span class="token number">100755</span>
index <span class="token number">6e27364</span><span class="token punctuation">.</span><span class="token punctuation">.</span>c949139
<span class="token operator">--</span><span class="token operator">-</span> a<span class="token operator">/</span>video<span class="token operator">/</span>drm<span class="token operator">/</span>rockchip_panel<span class="token punctuation">.</span>c
<span class="token operator">++</span><span class="token operator">+</span> b<span class="token operator">/</span>video<span class="token operator">/</span>drm<span class="token operator">/</span>rockchip_panel<span class="token punctuation">.</span>c
@@ <span class="token operator">-</span><span class="token number">41</span><span class="token punctuation">,</span><span class="token number">6</span> <span class="token operator">+</span><span class="token number">41</span><span class="token punctuation">,</span><span class="token number">11</span> @@ <span class="token keyword">struct</span> <span class="token class-name">rockchip_panel_cmds</span> <span class="token punctuation">{<!-- --></span>
 	<span class="token keyword">int</span> cmd_cnt<span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
 
<span class="token operator">+</span><span class="token keyword">struct</span> <span class="token class-name">dsi_panel_id</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>	u8 <span class="token operator">*</span>buf<span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">int</span> len<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
 <span class="token keyword">struct</span> <span class="token class-name">rockchip_panel_plat</span> <span class="token punctuation">{<!-- --></span>
 	bool power_invert<span class="token punctuation">;</span>
 	u32 bus_format<span class="token punctuation">;</span>
@@ <span class="token operator">-</span><span class="token number">57</span><span class="token punctuation">,</span><span class="token number">6</span> <span class="token operator">+</span><span class="token number">62</span><span class="token punctuation">,</span><span class="token number">10</span> @@ <span class="token keyword">struct</span> <span class="token class-name">rockchip_panel_plat</span> <span class="token punctuation">{<!-- --></span>
 
 	<span class="token keyword">struct</span> <span class="token class-name">rockchip_panel_cmds</span> <span class="token operator">*</span>on_cmds<span class="token punctuation">;</span>
 	<span class="token keyword">struct</span> <span class="token class-name">rockchip_panel_cmds</span> <span class="token operator">*</span>off_cmds<span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">struct</span> <span class="token class-name">rockchip_panel_cmds</span> <span class="token operator">*</span>read_id_cmds<span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> id_reg<span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">struct</span> <span class="token class-name">dsi_panel_id</span> <span class="token operator">*</span>id<span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> num<span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
 
 <span class="token keyword">struct</span> <span class="token class-name">rockchip_panel_priv</span> <span class="token punctuation">{<!-- --></span>
@@ <span class="token operator">-</span><span class="token number">299</span><span class="token punctuation">,</span><span class="token number">6</span> <span class="token operator">+</span><span class="token number">308</span><span class="token punctuation">,</span><span class="token number">7</span> @@ <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">panel_simple_prepare</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">rockchip_panel</span> <span class="token operator">*</span>panel<span class="token punctuation">)</span>
 	<span class="token punctuation">}</span>
 
 	priv<span class="token operator">-&gt;</span>prepared <span class="token operator">=</span> true<span class="token punctuation">;</span>
<span class="token operator">+</span>
 <span class="token punctuation">}</span>
 
 <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">panel_simple_unprepare</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">rockchip_panel</span> <span class="token operator">*</span>panel<span class="token punctuation">)</span>
@@ <span class="token operator">-</span><span class="token number">361</span><span class="token punctuation">,</span><span class="token number">6</span> <span class="token operator">+</span><span class="token number">371</span><span class="token punctuation">,</span><span class="token number">11</span> @@ <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">panel_simple_disable</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">rockchip_panel</span> <span class="token operator">*</span>panel<span class="token punctuation">)</span>
 	<span class="token keyword">struct</span> <span class="token class-name">rockchip_panel_plat</span> <span class="token operator">*</span>plat <span class="token operator">=</span> <span class="token function">dev_get_platdata</span><span class="token punctuation">(</span>panel<span class="token operator">-&gt;</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
 	<span class="token keyword">struct</span> <span class="token class-name">rockchip_panel_priv</span> <span class="token operator">*</span>priv <span class="token operator">=</span> <span class="token function">dev_get_priv</span><span class="token punctuation">(</span>panel<span class="token operator">-&gt;</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token operator">+</span>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dm_gpio_is_valid</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>priv<span class="token operator">-&gt;</span>reset_gpio<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">+</span>		<span class="token function">dm_gpio_free</span><span class="token punctuation">(</span>panel<span class="token operator">-&gt;</span>dev<span class="token punctuation">,</span> <span class="token operator">&amp;</span>priv<span class="token operator">-&gt;</span>reset_gpio<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dm_gpio_is_valid</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>priv<span class="token operator">-&gt;</span>enable_gpio<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">+</span>		<span class="token function">dm_gpio_free</span><span class="token punctuation">(</span>panel<span class="token operator">-&gt;</span>dev<span class="token punctuation">,</span> <span class="token operator">&amp;</span>priv<span class="token operator">-&gt;</span>enable_gpio<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
 	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>priv<span class="token operator">-&gt;</span>enabled<span class="token punctuation">)</span>
 		<span class="token keyword">return</span><span class="token punctuation">;</span>
 
@@ <span class="token operator">-</span><span class="token number">381</span><span class="token punctuation">,</span><span class="token number">12</span> <span class="token operator">+</span><span class="token number">396</span><span class="token punctuation">,</span><span class="token number">93</span> @@ <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">panel_simple_init</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">rockchip_panel</span> <span class="token operator">*</span>panel<span class="token punctuation">)</span>
 	conn_state<span class="token operator">-&gt;</span>bus_format <span class="token operator">=</span> panel<span class="token operator">-&gt;</span>bus_format<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 
<span class="token operator">+</span><span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">rockchip_dsi_panel_getId</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">rockchip_panel</span> <span class="token operator">*</span>panel<span class="token punctuation">)</span>
<span class="token operator">+</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>	u8 <span class="token operator">*</span>buf<span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">int</span> i<span class="token punctuation">,</span>len<span class="token punctuation">,</span>ret <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">int</span> count <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>	<span class="token keyword">struct</span> <span class="token class-name">rockchip_panel_plat</span> <span class="token operator">*</span>plat <span class="token operator">=</span> <span class="token function">dev_get_platdata</span><span class="token punctuation">(</span>panel<span class="token operator">-&gt;</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">struct</span> <span class="token class-name">rockchip_panel_priv</span> <span class="token operator">*</span>priv <span class="token operator">=</span> <span class="token function">dev_get_priv</span><span class="token punctuation">(</span>panel<span class="token operator">-&gt;</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">struct</span> <span class="token class-name">mipi_dsi_device</span> <span class="token operator">*</span>dsi <span class="token operator">=</span> <span class="token function">dev_get_parent_platdata</span><span class="token punctuation">(</span>panel<span class="token operator">-&gt;</span>dev<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token function">dbg</span><span class="token punctuation">(</span><span class="token string">"%s(%d) start\n"</span><span class="token punctuation">,</span> <span class="token constant">__func__</span><span class="token punctuation">,</span> <span class="token constant">__LINE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	
<span class="token operator">+</span>	len <span class="token operator">=</span> plat<span class="token operator">-&gt;</span>id<span class="token operator">-&gt;</span>len<span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"mingming--&gt;%s(%d) start len:%d\n"</span><span class="token punctuation">,</span> <span class="token constant">__func__</span><span class="token punctuation">,</span> <span class="token constant">__LINE__</span><span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	buf <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token operator">*</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	
<span class="token operator">+</span>	<span class="token keyword">if</span> <span class="token punctuation">(</span>priv<span class="token operator">-&gt;</span>power_supply<span class="token punctuation">)</span>
<span class="token operator">+</span>		<span class="token function">regulator_set_enable</span><span class="token punctuation">(</span>priv<span class="token operator">-&gt;</span>power_supply<span class="token punctuation">,</span> <span class="token operator">!</span>plat<span class="token operator">-&gt;</span>power_invert<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dm_gpio_is_valid</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>priv<span class="token operator">-&gt;</span>enable_gpio<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">+</span>		<span class="token function">dm_gpio_set_value</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>priv<span class="token operator">-&gt;</span>enable_gpio<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>	<span class="token keyword">if</span> <span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>delay<span class="token punctuation">.</span>prepare<span class="token punctuation">)</span>
<span class="token operator">+</span>		<span class="token function">mdelay</span><span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>delay<span class="token punctuation">.</span>prepare<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dm_gpio_is_valid</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>priv<span class="token operator">-&gt;</span>reset_gpio<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">+</span>		<span class="token function">dm_gpio_set_value</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>priv<span class="token operator">-&gt;</span>reset_gpio<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>	<span class="token keyword">if</span> <span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>delay<span class="token punctuation">.</span>reset<span class="token punctuation">)</span>
<span class="token operator">+</span>		<span class="token function">mdelay</span><span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>delay<span class="token punctuation">.</span>reset<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">dm_gpio_is_valid</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>priv<span class="token operator">-&gt;</span>reset_gpio<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">+</span>		<span class="token function">dm_gpio_set_value</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>priv<span class="token operator">-&gt;</span>reset_gpio<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>	<span class="token keyword">if</span> <span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>delay<span class="token punctuation">.</span>init<span class="token punctuation">)</span>
<span class="token operator">+</span>		<span class="token function">mdelay</span><span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>delay<span class="token punctuation">.</span>init<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	priv<span class="token operator">-&gt;</span>prepared <span class="token operator">=</span> true<span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>	
<span class="token operator">+</span>	<span class="token keyword">if</span> <span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>read_id_cmds<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"send read id cmds\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		<span class="token function">rockchip_panel_send_dsi_cmds</span><span class="token punctuation">(</span>dsi<span class="token punctuation">,</span> plat<span class="token operator">-&gt;</span>read_id_cmds<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	    <span class="token function">free</span><span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>read_id_cmds<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		plat<span class="token operator">-&gt;</span>read_id_cmds <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>		<span class="token keyword">if</span> <span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>on_cmds<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"send on cmds\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		ret <span class="token operator">=</span> <span class="token function">rockchip_panel_send_dsi_cmds</span><span class="token punctuation">(</span>dsi<span class="token punctuation">,</span> plat<span class="token operator">-&gt;</span>on_cmds<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		<span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
<span class="token operator">+</span>			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"failed to send on cmds: %d\n"</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	   <span class="token punctuation">}</span>     
<span class="token operator">+</span>	   
<span class="token operator">+</span>	<span class="token punctuation">}</span>
<span class="token operator">+</span>
<span class="token operator">+</span>  ret <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ret <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>		<span class="token keyword">if</span><span class="token punctuation">(</span>len <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>			ret <span class="token operator">=</span> <span class="token function">mipi_dsi_set_maximum_return_packet_size</span><span class="token punctuation">(</span>dsi<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		<span class="token punctuation">}</span>
<span class="token operator">+</span>		ret <span class="token operator">=</span> <span class="token function">mipi_dsi_dcs_read</span><span class="token punctuation">(</span>dsi<span class="token punctuation">,</span> plat<span class="token operator">-&gt;</span>id_reg<span class="token punctuation">,</span> buf<span class="token punctuation">,</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		count <span class="token operator">--</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token punctuation">}</span>
<span class="token operator">+</span>		
<span class="token operator">+</span>	<span class="token comment">//  printf("panel_simple_prepare buf = %d \n",buf[0]);</span>
<span class="token operator">+</span>	<span class="token keyword">if</span><span class="token punctuation">(</span>ret <span class="token operator">==</span> len<span class="token punctuation">)</span>
<span class="token operator">+</span>		<span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> len<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"read buf id[%d] = %x,panel target id[%d] = %x\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span>buf <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>id<span class="token operator">-&gt;</span>buf <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>			<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span>buf <span class="token operator">+</span> i<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">*</span><span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>id<span class="token operator">-&gt;</span>buf <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>				plat<span class="token operator">-&gt;</span>num <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span>				<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span>			<span class="token punctuation">}</span>
<span class="token operator">+</span>		<span class="token punctuation">}</span>
<span class="token operator">+</span>	<span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>		    <span class="token function">dbg</span><span class="token punctuation">(</span><span class="token string">"read panel(num = %d) timeout or no response\n"</span><span class="token punctuation">,</span>plat<span class="token operator">-&gt;</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>			plat<span class="token operator">-&gt;</span>num <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span>			<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token punctuation">}</span>
<span class="token operator">+</span>	panel<span class="token operator">-&gt;</span>num <span class="token operator">=</span> plat<span class="token operator">-&gt;</span>num<span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token punctuation">}</span>	
<span class="token operator">+</span>
 <span class="token keyword">static</span> <span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">rockchip_panel_funcs</span> rockchip_panel_funcs <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
 	<span class="token punctuation">.</span>init <span class="token operator">=</span> panel_simple_init<span class="token punctuation">,</span>
 	<span class="token punctuation">.</span>prepare <span class="token operator">=</span> panel_simple_prepare<span class="token punctuation">,</span>
 	<span class="token punctuation">.</span>unprepare <span class="token operator">=</span> panel_simple_unprepare<span class="token punctuation">,</span>
 	<span class="token punctuation">.</span>enable <span class="token operator">=</span> panel_simple_enable<span class="token punctuation">,</span>
 	<span class="token punctuation">.</span>disable <span class="token operator">=</span> panel_simple_disable<span class="token punctuation">,</span>
<span class="token operator">+</span>	<span class="token punctuation">.</span>getId <span class="token operator">=</span> rockchip_dsi_panel_getId<span class="token punctuation">,</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
 
 <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">rockchip_panel_ofdata_to_platdata</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">udevice</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span>
@@ <span class="token operator">-</span><span class="token number">408</span><span class="token punctuation">,</span><span class="token number">7</span> <span class="token operator">+</span><span class="token number">504</span><span class="token punctuation">,</span><span class="token number">23</span> @@ <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">rockchip_panel_ofdata_to_platdata</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">udevice</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span>
 	plat<span class="token operator">-&gt;</span>bus_format <span class="token operator">=</span> <span class="token function">dev_read_u32_default</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"bus-format"</span><span class="token punctuation">,</span>
 						MEDIA_BUS_FMT_RBG888_1X24<span class="token punctuation">)</span><span class="token punctuation">;</span>
 	plat<span class="token operator">-&gt;</span>bpc <span class="token operator">=</span> <span class="token function">dev_read_u32_default</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"bpc"</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	plat<span class="token operator">-&gt;</span>id_reg <span class="token operator">=</span>  <span class="token function">dev_read_u32_default</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"id-reg"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	plat<span class="token operator">-&gt;</span>num <span class="token operator">=</span> <span class="token function">dev_read_u32_default</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"num"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	data <span class="token operator">=</span> <span class="token function">dev_read_prop</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
 
<span class="token operator">+</span>	<span class="token keyword">if</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>		plat<span class="token operator">-&gt;</span>id <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token operator">*</span>plat<span class="token operator">-&gt;</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>plat<span class="token operator">-&gt;</span>id<span class="token punctuation">)</span>
<span class="token operator">+</span>			<span class="token keyword">return</span> <span class="token operator">-</span>ENOMEM<span class="token punctuation">;</span>
<span class="token operator">+</span>		plat<span class="token operator">-&gt;</span>id<span class="token operator">-&gt;</span>buf <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span> <span class="token operator">*</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span> 	   
<span class="token operator">+</span>		<span class="token function">memcpy</span><span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>id<span class="token operator">-&gt;</span>buf<span class="token punctuation">,</span> data<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		plat<span class="token operator">-&gt;</span>id<span class="token operator">-&gt;</span>len <span class="token operator">=</span> len<span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token punctuation">}</span>
<span class="token operator">+</span>
<span class="token operator">+</span>	<span class="token function">dbg</span><span class="token punctuation">(</span><span class="token string">"mingming--&gt;dts id reg = 0x%x\n"</span><span class="token punctuation">,</span>plat<span class="token operator">-&gt;</span>id_reg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">for</span><span class="token punctuation">(</span>len <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>len <span class="token operator">&lt;</span> plat<span class="token operator">-&gt;</span>id<span class="token operator">-&gt;</span>len<span class="token punctuation">;</span>len<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>		<span class="token function">dbg</span><span class="token punctuation">(</span><span class="token string">"dts id[%d] = %x\n"</span><span class="token punctuation">,</span> len<span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>id<span class="token operator">-&gt;</span>buf <span class="token operator">+</span> len<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token punctuation">}</span>
 	data <span class="token operator">=</span> <span class="token function">dev_read_prop</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"panel-init-sequence"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
 	<span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
 		plat<span class="token operator">-&gt;</span>on_cmds <span class="token operator">=</span> <span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token operator">*</span>plat<span class="token operator">-&gt;</span>on_cmds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
@@ <span class="token operator">-</span><span class="token number">421</span><span class="token punctuation">,</span><span class="token number">7</span> <span class="token operator">+</span><span class="token number">533</span><span class="token punctuation">,</span><span class="token number">20</span> @@ <span class="token keyword">static</span> <span class="token keyword">int</span> <span class="token function">rockchip_panel_ofdata_to_platdata</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">udevice</span> <span class="token operator">*</span>dev<span class="token punctuation">)</span>
 			<span class="token keyword">goto</span> free_on_cmds<span class="token punctuation">;</span>
 		<span class="token punctuation">}</span>
 	<span class="token punctuation">}</span>
<span class="token operator">+</span>	data <span class="token operator">=</span> <span class="token function">dev_read_prop</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"panel-read-id-sequence"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>		plat<span class="token operator">-&gt;</span>read_id_cmds <span class="token operator">=</span> <span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token operator">*</span>plat<span class="token operator">-&gt;</span>read_id_cmds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>plat<span class="token operator">-&gt;</span>read_id_cmds<span class="token punctuation">)</span>
<span class="token operator">+</span>			<span class="token keyword">return</span> <span class="token operator">-</span>ENOMEM<span class="token punctuation">;</span>
 
<span class="token operator">+</span>		ret <span class="token operator">=</span> <span class="token function">rockchip_panel_parse_cmds</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> len<span class="token punctuation">,</span> plat<span class="token operator">-&gt;</span>read_id_cmds<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>		<span class="token keyword">if</span> <span class="token punctuation">(</span>ret<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"failed to parse panel read id sequence\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>			<span class="token keyword">goto</span> free_read_id_cmds<span class="token punctuation">;</span>
<span class="token operator">+</span>		<span class="token punctuation">}</span>
<span class="token operator">+</span>	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>	    plat<span class="token operator">-&gt;</span>read_id_cmds <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token punctuation">}</span>
 	data <span class="token operator">=</span> <span class="token function">dev_read_prop</span><span class="token punctuation">(</span>dev<span class="token punctuation">,</span> <span class="token string">"panel-exit-sequence"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>
 	<span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
 		plat<span class="token operator">-&gt;</span>off_cmds <span class="token operator">=</span> <span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token operator">*</span>plat<span class="token operator">-&gt;</span>off_cmds<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
@@ <span class="token operator">-</span><span class="token number">443</span><span class="token punctuation">,</span><span class="token number">6</span> <span class="token operator">+</span><span class="token number">568</span><span class="token punctuation">,</span><span class="token number">9</span> @@ free_cmds<span class="token operator">:</span>
 	<span class="token function">free</span><span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>off_cmds<span class="token punctuation">)</span><span class="token punctuation">;</span>
 free_on_cmds<span class="token operator">:</span>
 	<span class="token function">free</span><span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>on_cmds<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>free_read_id_cmds<span class="token operator">:</span>
<span class="token operator">+</span>	<span class="token function">free</span><span class="token punctuation">(</span>plat<span class="token operator">-&gt;</span>read_id_cmds<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
 	<span class="token keyword">return</span> ret<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 
diff <span class="token operator">--</span>git a<span class="token operator">/</span>video<span class="token operator">/</span>drm<span class="token operator">/</span>rockchip_panel<span class="token punctuation">.</span>h b<span class="token operator">/</span>video<span class="token operator">/</span>drm<span class="token operator">/</span>rockchip_panel<span class="token punctuation">.</span>h
old mode <span class="token number">100644</span>
new mode <span class="token number">100755</span>
index <span class="token number">3</span>a7587f<span class="token punctuation">.</span><span class="token number">.8</span>ab9764
<span class="token operator">--</span><span class="token operator">-</span> a<span class="token operator">/</span>video<span class="token operator">/</span>drm<span class="token operator">/</span>rockchip_panel<span class="token punctuation">.</span>h
<span class="token operator">++</span><span class="token operator">+</span> b<span class="token operator">/</span>video<span class="token operator">/</span>drm<span class="token operator">/</span>rockchip_panel<span class="token punctuation">.</span>h
@@ <span class="token operator">-</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">6</span> <span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">7</span> @@ <span class="token keyword">struct</span> <span class="token class-name">rockchip_panel_funcs</span> <span class="token punctuation">{<!-- --></span>
 	<span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>unprepare<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">rockchip_panel</span> <span class="token operator">*</span>panel<span class="token punctuation">)</span><span class="token punctuation">;</span>
 	<span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>enable<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">rockchip_panel</span> <span class="token operator">*</span>panel<span class="token punctuation">)</span><span class="token punctuation">;</span>
 	<span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>disable<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">rockchip_panel</span> <span class="token operator">*</span>panel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>	<span class="token keyword">int</span> <span class="token punctuation">(</span><span class="token operator">*</span>getId<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">rockchip_panel</span> <span class="token operator">*</span>panel<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
 
 <span class="token keyword">struct</span> <span class="token class-name">rockchip_panel</span> <span class="token punctuation">{<!-- --></span>
@@ <span class="token operator">-</span><span class="token number">24</span><span class="token punctuation">,</span><span class="token number">7</span> <span class="token operator">+</span><span class="token number">25</span><span class="token punctuation">,</span><span class="token number">7</span> @@ <span class="token keyword">struct</span> <span class="token class-name">rockchip_panel</span> <span class="token punctuation">{<!-- --></span>
 	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> bpc<span class="token punctuation">;</span>
 	<span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">rockchip_panel_funcs</span> <span class="token operator">*</span>funcs<span class="token punctuation">;</span>
 	<span class="token keyword">const</span> <span class="token keyword">void</span> <span class="token operator">*</span>data<span class="token punctuation">;</span>
<span class="token operator">-</span>
<span class="token operator">+</span>	<span class="token keyword">int</span> num<span class="token punctuation">;</span>
 	<span class="token keyword">struct</span> <span class="token class-name">display_state</span> <span class="token operator">*</span>state<span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
 
@@ <span class="token operator">-</span><span class="token number">37</span><span class="token punctuation">,</span><span class="token number">6</span> <span class="token operator">+</span><span class="token number">38</span><span class="token punctuation">,</span><span class="token number">17</span> @@ <span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">rockchip_panel_init</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">rockchip_panel</span> <span class="token operator">*</span>panel<span class="token punctuation">)</span>
 		panel<span class="token operator">-&gt;</span>funcs<span class="token operator">-&gt;</span><span class="token function">init</span><span class="token punctuation">(</span>panel<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 
<span class="token operator">+</span><span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">int</span> <span class="token function">rockchip_panel_getId</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">rockchip_panel</span> <span class="token operator">*</span>panel<span class="token punctuation">)</span>
<span class="token operator">+</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>panel<span class="token punctuation">)</span>
<span class="token operator">+</span>		<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>	<span class="token keyword">if</span> <span class="token punctuation">(</span>panel<span class="token operator">-&gt;</span>funcs <span class="token operator">&amp;&amp;</span> panel<span class="token operator">-&gt;</span>funcs<span class="token operator">-&gt;</span>getId<span class="token punctuation">)</span>
<span class="token operator">+</span>	    <span class="token keyword">return</span> 	panel<span class="token operator">-&gt;</span>funcs<span class="token operator">-&gt;</span><span class="token function">getId</span><span class="token punctuation">(</span>panel<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">+</span>
<span class="token operator">+</span>	<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token punctuation">}</span>
<span class="token operator">+</span>
 <span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">rockchip_panel_prepare</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">rockchip_panel</span> <span class="token operator">*</span>panel<span class="token punctuation">)</span>
 <span class="token punctuation">{<!-- --></span>
 	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>panel<span class="token punctuation">)</span>

</code></pre>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d518c9cdf3b0633bdde7ff1038e60471/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">易康ecognition软件及其插件EPS1/2</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dbf6e81ab366beca36bc7a1228c62eb5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">linux基础——黑洞文件</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>