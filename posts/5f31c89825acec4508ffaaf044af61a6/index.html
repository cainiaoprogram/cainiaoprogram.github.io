<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>js实现WebSocket 连接 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="js实现WebSocket 连接" />
<meta property="og:description" content="一.WebSocket 简单介绍 1.HTTP和WebSocket的区别 http：通信只能由客户端发起；
WebSocket：服务器可以主动向客户端推送信息，客户端也可以主动向服务器发送信息，是真正的双向平等对话，属于服务器推送技术的一种；在webSocket协议下客服端和浏览器可以同时发送信息。
2.WebSocket应用场景 数据推送：webSocket可以代替ajax轮询（即客户端通过一定的时间间隔不断向服务器发起请求获得数据，因此会占用许多带宽和服务器资源），但是webSocket不一样，当建立TCP连接后，服务器可以主动给客户端传递数据，能够更好的节省服务器资源和带宽，实现更实时的数据通讯。
二.js使用WebSocket Web Sockets能够在客户端和服务端之间发送非常少量的数据，而不必担心HTTP那样字节级的开销，由于传递的数据包很小，因此WebSockets非常适合移动应用。
缺点：制定协议的时间比制定JavaScript API的时间还要长。
1.创建WebSocket实例 url：url之前需添加ws://（未加密）或wss://（已加密），类似http://、https://
protocol：与服务端定义的协议名称相同，协议的参数例如XMPP（Extensible Messaging and Presence Protocol）、SOAP（Simple Object Access Protocol）或者自定义协议。
var ws = new WebSocket(&#39;ws://url&#39;); var ws1 = new WebSocket(&#39;ws://url&#39;, &#39;myprotocol&#39;); var ws2 = new WebSocket(&#39;ws://url&#39;, [&#39;protocol_1&#39;,&#39;protovol_2&#39;])); 2.属性 ①readyState属性：WebSocket当前连接状态
属性值属性常量描述0CONNECTING正在与服务端建立WebSocket连接，还没有连接成功1OPEN连接成功并打开，可以发送消息2CLOSING进行关闭连接的操作，且尚未关闭3CLOSE连接已关闭或不能打开 通过 ws.readyState属性查看当前连接状态，例
alert(&#39;ws连接状态：&#39; &#43; ws.readyState); ②bufferedAmount：检查传输数据的大小，当客户端传输大量数据时使用避免网络饱和
③protocol：在构造函数中使用，protocol参数让服务端知道客户端使用的WebSocket协议。而WebSocket对象的这个属性就是指的最终服务端确定下来的协议名称，可以为空
3.方法 ①发送数据：send()
var message = { id: 1, title: &#39;发送ws数据&#39; } ws.send(JSON.stringify(message)); // 复杂的数据结构要先进行序列化 ②关闭连接：closed()
ws.close() 4.事件 WebSocket API是纯事件驱动，建立连接之后，可自动发送状态改变的数据和通知
事件描述onopen当建立websocket连接时触发，只触发一次onerror当连接出现错误时触发-因为当触发了onerror之后连接就会触发关闭事件onmessage当服务端发送数据时触发，可多次触发，页面数据展示处理模块–实现轮询onclose当websocket连接关闭时触发，只触发一次 5." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/5f31c89825acec4508ffaaf044af61a6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-08T15:11:03+08:00" />
<meta property="article:modified_time" content="2021-10-08T15:11:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">js实现WebSocket 连接</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="WebSocket__0"></a>一.WebSocket 简单介绍</h4> 
<h6><a id="1HTTPWebSocket_1"></a>1.HTTP和WebSocket的区别</h6> 
<p>http：通信只能由客户端发起；<br> WebSocket：服务器可以主动向客户端推送信息，客户端也可以主动向服务器发送信息，是真正的双向平等对话，属于服务器推送技术的一种；在webSocket协议下客服端和浏览器可以同时发送信息。</p> 
<h6><a id="2WebSocket_4"></a>2.WebSocket应用场景</h6> 
<p><mark>数据推送</mark>：webSocket可以代替ajax轮询（即客户端通过一定的时间间隔不断向服务器发起请求获得数据，因此会占用许多带宽和服务器资源），但是webSocket不一样，当建立TCP连接后，服务器可以主动给客户端传递数据，能够更好的节省服务器资源和带宽，实现更实时的数据通讯。<br> <img src="https://images2.imgbox.com/60/fc/EcacxYtz_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="jsWebSocket_7"></a>二.js使用WebSocket</h4> 
<p>Web Sockets能够在客户端和服务端之间发送非常少量的数据，而不必担心HTTP那样字节级的开销，由于传递的数据包很小，因此WebSockets非常适合移动应用。<br> 缺点：制定协议的时间比制定JavaScript API的时间还要长。</p> 
<h6><a id="1WebSocket_10"></a>1.创建WebSocket实例</h6> 
<p>url：url之前需添加ws://（未加密）或wss://（已加密），类似http://、https://<br> protocol：与服务端定义的协议名称相同，协议的参数例如XMPP（Extensible Messaging and Presence Protocol）、SOAP（Simple Object Access Protocol）或者自定义协议。</p> 
<pre><code class="prism language-javascript"><span class="token keyword">var</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> ws1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://url'</span><span class="token punctuation">,</span> <span class="token string">'myprotocol'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> ws2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://url'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'protocol_1'</span><span class="token punctuation">,</span><span class="token string">'protovol_2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h6><a id="2_18"></a>2.属性</h6> 
<p>①readyState属性：WebSocket当前连接状态</p> 
<table><thead><tr><th>属性值</th><th>属性常量</th><th>描述</th></tr></thead><tbody><tr><td>0</td><td>CONNECTING</td><td>正在与服务端建立WebSocket连接，还没有连接成功</td></tr><tr><td>1</td><td>OPEN</td><td>连接成功并打开，可以发送消息</td></tr><tr><td>2</td><td>CLOSING</td><td>进行关闭连接的操作，且尚未关闭</td></tr><tr><td>3</td><td>CLOSE</td><td>连接已关闭或不能打开</td></tr></tbody></table> 
<p>通过 ws.readyState属性查看当前连接状态，例</p> 
<pre><code class="prism language-javascript"><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'ws连接状态：'</span> <span class="token operator">+</span> ws<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>②bufferedAmount：检查传输数据的大小，当客户端传输大量数据时使用避免网络饱和<br> ③protocol：在构造函数中使用，protocol参数让服务端知道客户端使用的WebSocket协议。而WebSocket对象的这个属性就是指的最终服务端确定下来的协议名称，可以为空</p> 
<h6><a id="3_33"></a>3.方法</h6> 
<p>①发送数据：send()</p> 
<pre><code class="prism language-javascript"><span class="token keyword">var</span> message <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
	id<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
	title<span class="token operator">:</span> <span class="token string">'发送ws数据'</span>
<span class="token punctuation">}</span>
ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 复杂的数据结构要先进行序列化</span>
</code></pre> 
<p>②关闭连接：closed()</p> 
<pre><code class="prism language-javascript">ws<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h6><a id="4_48"></a>4.事件</h6> 
<p>WebSocket API是纯事件驱动，建立连接之后，可自动发送状态改变的数据和通知</p> 
<table><thead><tr><th>事件</th><th>描述</th></tr></thead><tbody><tr><td>onopen</td><td>当建立websocket连接时触发，只触发一次</td></tr><tr><td>onerror</td><td>当连接出现错误时触发-因为当触发了onerror之后连接就会触发关闭事件</td></tr><tr><td>onmessage</td><td>当服务端发送数据时触发，可多次触发，页面数据展示处理模块–实现轮询</td></tr><tr><td>onclose</td><td>当websocket连接关闭时触发，只触发一次</td></tr></tbody></table> 
<h6><a id="5_57"></a>5.使用示例</h6> 
<pre><code class="prism language-javascript"><span class="token keyword">var</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">'ws://url'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 获取连接状态</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ws连接状态：'</span> <span class="token operator">+</span> ws<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//监听是否连接成功</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ws连接状态：'</span> <span class="token operator">+</span> ws<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//连接成功则发送一个数据</span>
    ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'test1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 接听服务器发回的信息并处理展示</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'接收到来自服务器的消息：'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//完成通信后关闭WebSocket连接</span>
    ws<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 监听连接关闭事件</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 监听整个过程中websocket的状态</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ws连接状态：'</span> <span class="token operator">+</span> ws<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 监听并处理error事件</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>相关：<a href="https://www.cnblogs.com/llljpf/p/10830651.html" rel="nofollow">js中的websocket</a></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/72ce69c133761735a2433178d7d57e96/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Ubuntu server虚拟机配置静态IP</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4ae681cbd37fc1b8313462739e76c88c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">.bss段和.data段引起的文件大小增加</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>