<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>广域网宽带接入技术四EPON技术 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="广域网宽带接入技术四EPON技术" />
<meta property="og:description" content="广域网宽带接入技术四EPON技术 二、EPON技术1、EPON的网络体系结构2、EPON基本原理2.1、EPON帧结构2.2、下行数据流2.3、上行数据流3、EPON关键技术3.1、EPON层次结构3.1.1、EPON的物理层3.1.2、EPON的数据链路层3.1.3、MPCP协议3.1.4、LLID和MPCP的PDU格式3.2、EPON系统的工作机制3.2.1、ONU注册 二、EPON技术 APON/BPON二层采用的是ATM封装和传送技术，因此存在带宽有限、带宽损失大、数据包开销大、协议转换复杂、承载IP业务效率低、技术复杂、设备价格高、不同厂家兼容问题。一直没有得到广泛应用。APON/BPON下行速率622Mbps，上行速率155Mbps，除去ATM开销后，实际可用带宽只有448Mbps。
2004年，正式发布EPON(以太网无源光网络)技术标准IEEE802.ah。IEEE制定EPON标准的基本原则是尽量在802.3体系结构内进行EPON的标准化工作，最小程度地扩充标准以太网的MAC协议。
EPON(Ethernet Passive Optical Network,无源网络)的E指的是互联以太网，所以EPON诞生之初就是要求能够同互联网直接无缝衔接，所以EPON的码流走的是以太网的帧格式。当然，为了适应光纤上传输，所以在以太网帧格式的帧的外面，包了一层EPON定义的帧格式。
在EPON系统中，按照单纤双向全双工的方式以点到多点(P2MP)的方式传送数据。可以提供1.25 Gbit/s的上下行带宽，传输距离可达10-20 km，支持最大光分路比1:64，采用无源光网络可大大降低OLT和主干光纤的成本压力(OLT与ONU之间仅有光纤、光分路器等光无源器件，无需租用机房、无需配备电源、无需有源设备维护人员，因此，可有效节省建设和运营维护成本)。与以太网成熟技术结合，在IP/Ethernet占主要的市场上得到广泛应用。成为了非常适合IP业务的宽带接入技术。
在接入网中EPON不需任何复杂的协议，光信号就能准确地传送到最终用户，来自最终用户的数据也能被集中传送到中心网络。在物理层，EPON使用1000BASE的以太PHY，同时在PON的传输机制上，通过新增加的MAC控制命令来控制和优化各光网络单元(ONU)与光线路终端(OLT)之间突发性数据通信和实时的TDM通信，在协议的第二层，EPON采用成熟的全双工以太技术，使用TDM，由于ONU在自己的时隙内发送数据报，因此没有碰撞，不需CDMA/CD，从而充分利用带宽。另外，EPON通过在MAC层中实现802.1p来提供与APON/GPON类似的QoS。
1、EPON的网络体系结构 无源光网络的构成:
OLT（Optical Line Terminal）－光线路终端POS(Passive Optical Splitter，无源光分光器)ONU（Optical Network Unit）－光网络单元ODN（Optical Distribution Network）－光分配网 OLT与前端（汇聚层）交换机用网线相连，转化成光信号，通过单根光纤与分光器和的ONU互联，OLT与POS、ONU都属于光电设备。OLT设备是重要的局端设备，它实现的管理、测距等功能。
EPON的传输距离，OLT(光线路终端)到达ONU(光网络单元)最大距离不超过20km,中间有一级POS(无源光分光器)、二级POS(无源光分光器)设备。EPON系统中的光网络被称为“无源”，是由ODN网络中的连接设备“无源分光器”决定的。称其无源，是因为分光器中不需要供电。
2、EPON基本原理 OLT(光线路终端)作为整个网络/节点的核心和主导部分，完成ONU注册和管理、全网的同步和管理以及协议的转换、与上联网络之间的通信等功能；
ONU作为用户端设备在整个网络中属于从属部分，完成与OLT之间的正常通信并为终端用户提供不同的应用端口；
ODN在网络中的定义为从OLT－ONU的线路部分，包括光缆、配线部分以及POS(分光器)全部为无源器件，是整个网络信号传输的载体。POS(分光器)可以从1:2－1:32可选（1:64的分光器因成本原因基本上在现网上没进行使用，OLT到ONU之间的传输距离一般10km-20km,原则上是10KM用1:32的分光器，20KM用1:16,因为分光器分光比例越高，光衰耗越大。
EPON中使用单芯光纤，在一根光纤上使用不同波长的两个光路，来分别实现上、下行数据传输，这种机制叫做单纤双向传输机制。单纤双向传输机制指EPON采用WDN(Wavelength Division Multiplexing，波分复用)技术，实现单纤双向传输。提供上/下行对称速率1.25Gbps的带宽，为了上、下行两个方面可以同时传输数据而不冲突，采用两种复用技术，下行数据流采用广播技术，上行数据流采用TDMA(Time Division Multiple Access,时分多址)技术。下行采用针对不同用户加密广播传输的方式共享带宽。
在一根芯上转送上下行两个波，上行波长：1310nm，下行波长：1490nm，另外还可以在这个芯上下行叠加1550nm的波长(有线电视1550nm的光信号送入EPON光纤中实现共用一根纤芯)。上行方向采用时分多址接入（TDMA）方式，把光纤的占用按一定时间长度分成时段，在每一个时段，只有一台ONU能够占用光纤向OLT发送数据，其余ONU则关闭激光器。OLT通过发送控制数据包指定ONU发送数据的时段，来避免冲突的发生。
2.1、EPON帧结构 在EPON中，数据的传输遵照IEEE 802.3以太网协议，采用可变长度的分组格式进行，分组的最大长度为1518字节。没有改变以太网帧的结构，只是利用以太网帧的前8个字节的前缀对数据帧作了标识。
在EPON系统中，按照单纤双向全双工的方式以点到多点的方式传送数据。OLT和ONU之间采用以太网封装方式，传输的是以太网帧结构，所以EPON是基于802.3的帧格式。从EPON帧结构图可以看出，在前导码第6、7个字节中携带了LLID（Logical Link Identifier，逻辑链路标记）信息，用于在OLT上标识ONU，第3个字节SPD(或称SLD，LLID定界符 在EPON中为0XD5)，第3个字节标识它不是普通以太网帧而是一个EPON帧。EPON定义了广播LLID(LLID=0xFF)作为单拷贝广播(SCB)信道，用于高效传输下行视频广播/组播业务。
2.2、下行数据流 OLT启动后，根据OLT广播(时分复用技术TDM)允许接入信息，主动发起注册请求，OLT通过对ONU的认证，允许ONU接入，并给请求注册的ONU分配一个OLT端口惟一的一个LLID(逻辑链路标志)。
在ONU注册成动后分配一个唯一的LLID；在每一个分组开始之前添加一个LLID，替代以太网前导符的最后两个字节；OLT接收数据时比较LLID注册列表，ONU接收数据时，仅接收符合自己的LLID的帧或者广播帧。 2.3、上行数据流 OLT接收数据前比较LLID注册列表；每个ONU在由局方设备统一分配的时隙中发送数据帧；分配的时隙补偿了各个ONU距离的差距，避免了各个ONU之间的碰撞。
上行信号：分时突发发送，采用测距技术保证上行数据不发生冲突。OLT时钟恢复时间400ns,ONU开关时间512ns。 对于上行，采用时分多址接入技术（TDMA）分时隙给ONU传输上行流量。当ONU在注册时成功后，OLT会根据系统的配置，给ONU分配特定的带宽，（在采用动态带宽调整时，OLT会根据指定的带宽分配策略和各个ONU的状态报告，动态的给每一个ONU分配带宽，动态带宽调整的进一步说明见后面）。带宽对于PON层面来说，就是多少可以传输数据的基本时隙，每一个基本时隙单位时间长度为16ns。在一个OLT端口（PON端口）下面，所有的ONU与OLT PON端口之间时钟是严格同步的，每一个ONU只能够在OLT给他分配的时刻上面开始，用分配给它的时隙长度传输数据。通过时隙分配和时延补偿，确保多个ONU的数据信号耦合到一根光纤时，各个ONU的上行包不会互相干扰。
区别下行TDM方式上行TDMA方式波长下行波长1490上行波长1310数据方向OLT到ONUONU到OLT特点ONU只接收发给自己的数据、丢弃其它数据无需冲突检测、报文不需要分片 3、EPON关键技术 IEEE802.ah定义的EPON技术在原有的802.3上作了最小的改动。
3.1、EPON层次结构 3.1.1、EPON的物理层 从物理层看，EPON从电气、机械、规程、功能特性等功能基本上采纳了Ethernet的GE或1000BASE的标准，包含物理层协议 PHY（Physical Layer Protocol）和物理媒介协议PMD（Physical Medium Dependence Protocol）两大子层功能。在物理层，EPON使用1000BASE的以太网物理层协议PHY，无源光纤传输方式。
包含RS子层、PCS子层、PMA子层、PDM子层。物理层通过GMII接口与RS层相连，担负着为MAC层传送可靠数据的责任。
物理层的主要功能：数据编成合适的线路码；完成数据的前向纠错；将数据通过光电、电光转换完成数据的收发。数据光–&gt;电–&gt;光转换完成数据收发。
同千兆以太网的物理层相比，唯一不同的是EPON的物理层多了一个前向纠错子层（FEC），其它各层的名称、功能、顺序没有太大的变化。前向纠错子层完成前向纠错的功能。这个子层是一个可选的子层，它处在物理编码子层和物理媒体附属子层中间。它的存在引入使我们在选择激光器、分光器的分路比、接入网的最大传输距离时有了更大的自由。从宏观上讲，除了FEC层和PMD层以外，各子层基本上可以同千兆以太网兼容。
PCS层与MAC层的接口定义为GMII（Gigabit Medium Independent Interface），是字节宽度的数据通道。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/7c575af58b5f17d6fb8e9cce9c0de6ca/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-17T14:44:40+08:00" />
<meta property="article:modified_time" content="2023-03-17T14:44:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">广域网宽带接入技术四EPON技术</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>广域网宽带接入技术四EPON技术</h4> 
 <ul><li><a href="#EPON_1" rel="nofollow">二、EPON技术</a></li><li><a href="#1EPON_13" rel="nofollow">1、EPON的网络体系结构</a></li><li><a href="#2EPON_25" rel="nofollow">2、EPON基本原理</a></li><li><a href="#21EPON_40" rel="nofollow">2.1、EPON帧结构</a></li><li><a href="#22_46" rel="nofollow">2.2、下行数据流</a></li><li><a href="#23_53" rel="nofollow">2.3、上行数据流</a></li><li><a href="#3EPON_69" rel="nofollow">3、EPON关键技术</a></li><li><a href="#31EPON_71" rel="nofollow">3.1、EPON层次结构</a></li><li><a href="#311EPON_74" rel="nofollow">3.1.1、EPON的物理层</a></li><li><a href="#312EPON_130" rel="nofollow">3.1.2、EPON的数据链路层</a></li><li><a href="#313MPCP_150" rel="nofollow">3.1.3、MPCP协议</a></li><li><a href="#314LLIDMPCPPDU_156" rel="nofollow">3.1.4、LLID和MPCP的PDU格式</a></li><li><a href="#32EPON_186" rel="nofollow">3.2、EPON系统的工作机制</a></li><li><a href="#321ONU_204" rel="nofollow">3.2.1、ONU注册</a></li></ul> 
</div> 
<p></p> 
<h2><a id="EPON_1"></a>二、EPON技术</h2> 
<p>APON/BPON二层采用的是ATM封装和传送技术，因此存在带宽有限、带宽损失大、数据包开销大、协议转换复杂、承载IP业务效率低、技术复杂、设备价格高、不同厂家兼容问题。一直没有得到广泛应用。APON/BPON下行速率622Mbps，上行速率155Mbps，除去ATM开销后，实际可用带宽只有448Mbps。</p> 
<p>2004年，正式发布EPON(<strong>以太网无源光网络</strong>)技术标准IEEE802.ah。IEEE制定EPON标准的基本原则是尽量在802.3体系结构内进行EPON的标准化工作，最小程度地扩充标准以太网的MAC协议。</p> 
<p>EPON(Ethernet Passive Optical Network,无源网络)的E指的是互联以太网，所以EPON诞生之初就是要求能够同互联网直接无缝衔接，所以EPON的码流走的是<strong>以太网的帧格式</strong>。当然，为了适应光纤上传输，所以在以太网帧格式的帧的外面，包了一层EPON定义的帧格式。</p> 
<p>在EPON系统中，按照<strong>单纤双向全双工</strong>的方式以<strong>点到多点</strong>(P2MP)的方式传送数据。可以提供1.25 Gbit/s的上下行带宽，传输距离可达10-20 km，支持最大光分路比1:64，采用无源光网络可大大降低OLT和主干光纤的成本压力(OLT与ONU之间仅有光纤、光分路器等光无源器件，无需租用机房、无需配备电源、无需有源设备维护人员，因此，可有效节省建设和运营维护成本)。与以太网成熟技术结合，在IP/Ethernet占主要的市场上得到广泛应用。成为了非常适合IP业务的宽带接入技术。</p> 
<p>在接入网中EPON不需任何复杂的协议，光信号就能准确地传送到最终用户，来自最终用户的数据也能被集中传送到中心网络。在物理层，EPON使用1000BASE的以太PHY，同时在PON的传输机制上，通过新增加的MAC控制命令来控制和优化各光网络单元(ONU)与光线路终端(OLT)之间突发性数据通信和实时的TDM通信，在协议的第二层，EPON采用成熟的全双工以太技术，使用TDM，由于ONU在自己的时隙内发送数据报，因此没有碰撞，不需CDMA/CD，从而充分利用带宽。另外，EPON通过在MAC层中实现802.1p来提供与APON/GPON类似的QoS。</p> 
<h2><a id="1EPON_13"></a>1、EPON的网络体系结构</h2> 
<p><img src="https://images2.imgbox.com/db/34/tgsknp24_o.png" alt="在这里插入图片描述"><br> 无源光网络的构成:</p> 
<ul><li>OLT（Optical Line Terminal）－光线路终端</li><li>POS(Passive Optical Splitter，无源光分光器)</li><li>ONU（Optical Network Unit）－光网络单元</li><li>ODN（Optical Distribution Network）－光分配网</li></ul> 
<p>OLT与前端（汇聚层）交换机用网线相连，转化成光信号，通过单根光纤与分光器和的ONU互联，OLT与POS、ONU都属于光电设备。OLT设备是重要的局端设备，它实现的管理、测距等功能。</p> 
<p>EPON的传输距离，OLT(光线路终端)到达ONU(光网络单元)最大距离不超过20km,中间有一级POS(无源光分光器)、二级POS(无源光分光器)设备。EPON系统中的光网络被称为“无源”，是由ODN网络中的连接设备“无源分光器”决定的。称其无源，是因为分光器中不需要供电。</p> 
<h2><a id="2EPON_25"></a>2、EPON基本原理</h2> 
<p>OLT(光线路终端)作为整个网络/节点的核心和主导部分，完成ONU注册和管理、全网的同步和管理以及协议的转换、与上联网络之间的通信等功能；</p> 
<p>ONU作为用户端设备在整个网络中属于从属部分，完成与OLT之间的正常通信并为终端用户提供不同的应用端口；</p> 
<p>ODN在网络中的定义为从OLT－ONU的线路部分，包括光缆、配线部分以及POS(分光器)全部为<strong>无源器件</strong>，是整个网络信号传输的载体。POS(分光器)可以从1:2－1:32可选（1:64的分光器因成本原因基本上在现网上没进行使用，OLT到ONU之间的传输距离一般10km-20km,原则上是<strong>10KM</strong>用1:32的分光器，<strong>20KM</strong>用1:16,因为分光器分光比例越高，光衰耗越大。</p> 
<p><img src="https://images2.imgbox.com/df/9c/3xeTvIzT_o.png" alt="在这里插入图片描述"></p> 
<p>EPON中使用<strong>单芯光纤</strong>，在一根光纤上使用不同波长的两个光路，来分别实现上、下行数据传输，这种机制叫做<strong>单纤双向传输机制</strong>。单纤双向传输机制指EPON采用<strong>WDN</strong>(Wavelength Division Multiplexing，波分复用)技术，实现单纤双向传输。提供上/下行对称速率1.25Gbps的带宽，为了上、下行两个方面可以同时传输数据而不冲突，采用两种复用技术，<strong>下行数据流采用广播技术，上行数据流采用TDMA(Time Division Multiple Access,时分多址)技术</strong>。下行采用针对不同用户加密广播传输的方式共享带宽。</p> 
<p>在一根芯上转送上下行两个波，上行波长：1310nm，下行波长：1490nm，另外还可以在这个芯上下行叠加1550nm的波长(有线电视1550nm的光信号送入EPON光纤中实现共用一根纤芯)。上行方向采用时分多址接入（TDMA）方式，把光纤的占用按一定时间长度分成时段，在每一个时段，只有一台ONU能够占用光纤向OLT发送数据，其余ONU则关闭激光器。OLT通过发送控制数据包指定ONU发送数据的时段，来避免冲突的发生。</p> 
<h2><a id="21EPON_40"></a>2.1、EPON帧结构</h2> 
<p>在EPON中，数据的传输遵照IEEE 802.3以太网协议，采用可变长度的分组格式进行，分组的最大长度为1518字节。没有改变以太网帧的结构，只是利用以太网帧的前8个字节的前缀对数据帧作了标识。</p> 
<p><img src="https://images2.imgbox.com/fa/12/8j7cnS43_o.png" alt="EPON帧结构"></p> 
<p>在EPON系统中，按照<strong>单纤双向全双工</strong>的方式以<strong>点到多点</strong>的方式传送数据。OLT和ONU之间采用以太网封装方式，传输的是以太网帧结构，所以EPON是基于802.3的帧格式。从EPON帧结构图可以看出，在前导码第6、7个字节中携带了LLID（Logical Link Identifier，逻辑链路标记）信息，用于在OLT上标识ONU，第3个字节SPD(或称SLD，LLID定界符 在EPON中为0XD5)，第3个字节标识它不是普通以太网帧而是一个EPON帧。EPON定义了广播LLID(LLID=0xFF)作为单拷贝广播(SCB)信道，用于高效传输下行视频广播/组播业务。</p> 
<h2><a id="22_46"></a>2.2、下行数据流</h2> 
<p><img src="https://images2.imgbox.com/37/6b/zbLuSAba_o.png" alt="在这里插入图片描述"><br> OLT启动后，根据OLT广播(时分复用技术TDM)允许接入信息，主动发起注册请求，OLT通过对ONU的认证，允许ONU接入，并给请求注册的ONU分配一个OLT端口惟一的一个LLID(逻辑链路标志)。</p> 
<ul><li>在ONU注册成动后分配一个唯一的LLID；</li><li>在每一个分组开始之前添加一个LLID，替代以太网前导符的最后两个字节；</li><li>OLT接收数据时比较LLID注册列表，ONU接收数据时，仅接收符合自己的LLID的帧或者广播帧。</li></ul> 
<h2><a id="23_53"></a>2.3、上行数据流</h2> 
<p><img src="https://images2.imgbox.com/a9/59/1K65OSte_o.png" alt="在这里插入图片描述"></p> 
<ul><li>OLT接收数据前比较LLID注册列表；</li><li>每个ONU在由局方设备统一分配的时隙中发送数据帧；</li><li>分配的时隙补偿了各个ONU距离的差距，避免了各个ONU之间的碰撞。<br> 上行信号：分时突发发送，采用测距技术保证上行数据不发生冲突。OLT时钟恢复时间400ns,ONU开关时间512ns。</li></ul> 
<p>对于上行，采用时分多址接入技术（TDMA）分时隙给ONU传输上行流量。当ONU在注册时成功后，OLT会根据系统的配置，给ONU分配特定的带宽，（在采用动态带宽调整时，OLT会根据指定的带宽分配策略和各个ONU的状态报告，动态的给每一个ONU分配带宽，动态带宽调整的进一步说明见后面）。带宽对于PON层面来说，就是多少可以传输数据的基本时隙，每一个基本时隙单位时间长度为16ns。在一个OLT端口（PON端口）下面，所有的ONU与OLT PON端口之间时钟是严格同步的，每一个ONU只能够在OLT给他分配的时刻上面开始，用分配给它的时隙长度传输数据。通过时隙分配和时延补偿，确保多个ONU的数据信号耦合到一根光纤时，各个ONU的上行包不会互相干扰。</p> 
<table><thead><tr><th align="center">区别</th><th align="center">下行TDM方式</th><th align="center">上行TDMA方式</th></tr></thead><tbody><tr><td align="center">波长</td><td align="center">下行波长1490</td><td align="center">上行波长1310</td></tr><tr><td align="center">数据方向</td><td align="center">OLT到ONU</td><td align="center">ONU到OLT</td></tr><tr><td align="center">特点</td><td align="center">ONU只接收发给自己的数据、丢弃其它数据</td><td align="center">无需冲突检测、报文不需要分片</td></tr></tbody></table> 
<h2><a id="3EPON_69"></a>3、EPON关键技术</h2> 
<p>IEEE802.ah定义的EPON技术在原有的802.3上作了最小的改动。</p> 
<h2><a id="31EPON_71"></a>3.1、EPON层次结构</h2> 
<p><img src="https://images2.imgbox.com/ad/96/AFoKJmj5_o.png" alt="EPON层次结构" width="600" height="400"></p> 
<h2><a id="311EPON_74"></a>3.1.1、EPON的物理层</h2> 
<p>从物理层看，EPON从电气、机械、规程、功能特性等功能基本上采纳了Ethernet的GE或1000BASE的标准，包含物理层协议 PHY（Physical Layer Protocol）和物理媒介协议PMD（Physical Medium Dependence Protocol）两大子层功能。在物理层，EPON使用1000BASE的以太网物理层协议PHY，无源光纤传输方式。</p> 
<p>包含RS子层、PCS子层、PMA子层、PDM子层。物理层通过GMII接口与RS层相连，担负着为MAC层传送可靠数据的责任。</p> 
<p>物理层的主要功能：数据编成合适的线路码；完成数据的前向纠错；将数据通过光电、电光转换完成数据的收发。数据光–&gt;电–&gt;光转换完成数据收发。</p> 
<p>同千兆以太网的物理层相比，唯一不同的是EPON的物理层多了一个<strong>前向纠错子层</strong>（FEC），其它各层的名称、功能、顺序没有太大的变化。前向纠错子层完成前向纠错的功能。这个子层是一个可选的子层，它处在物理编码子层和物理媒体附属子层中间。它的存在引入使我们在选择激光器、分光器的分路比、接入网的最大传输距离时有了更大的自由。从宏观上讲，除了FEC层和PMD层以外，各子层基本上可以同千兆以太网兼容。</p> 
<p>PCS层与MAC层的接口定义为<strong>GMII</strong>（Gigabit Medium Independent Interface），是字节宽度的数据通道。</p> 
<p><strong>1、RS调和子层</strong><br> ①对EPON 的帧头（即前导码）进行检测；<br> ②定位SLD 域；<br> ③使用SLD 域的位置来定位CRC 域和检验接收到的数值与使用接收数据计算出来的CRC 是否相匹配；<br> ④使用SLD 域的位置来定位<strong>LLID</strong> 域和解析它来测定目的地MAC；<br> ⑤假如由于不正确的CRC 或者未知的LLID 不丢弃报文，那么使用正常的前导码来取代<strong>SLD</strong> 和<strong>LLID</strong>，用<strong>SFD</strong> 来取代CRC 域，传送这个报文给相应的MAC；否则则丢弃整个报文，用正常的帧间隔来取代它（在这里我们选择将报文丢弃）。</p> 
<p><strong>2、物理编码子层PCS</strong><br> PCS将GMII发送的数据进行编码/解码，使之合适在物理媒体上载送。</p> 
<p>PCS子层上接<strong>GMII</strong> (Gigabit Medium Independent Interface/千兆媒体独立接口)接口下接PMA子层，其实现的主要技术为<strong>8b/10b，10b/8b编码变换</strong>。由于10比特的数据能有效地减小直流分量，便于接收端的时钟提取，降低误码率，因此PCS层需要把从GMII口接收到的8位并行的数据转换成10位并行的数据输出。这个高速的8b/10b编码器的工作频率是125MHz，它的编码原理基于5b/6b和3b/4b两种编码变换。</p> 
<p><strong>上行数据流</strong>，在各ONU向OLT突发发送数据的时候，得到授权的ONU在规定时隙里发送数据包，没有得到授权的ONU处于休息状态。这种在上行时不是连续发送数据的通信模式叫<strong>突发通信</strong>。</p> 
<p><strong>下行数据流</strong>，在OLT侧，PCS的发送和接收都处于连续的工作模式；而在ONU侧的PCS子层接收方向是连续接收OLT侧来的广播数据，而在发送方向，却是在断断续续地工作。即OUN是接收数据是广播，发送数据是断断续续。</p> 
<p><strong>发送过程</strong>：数据链路层的数据到达RS层，通过GMII口发往PCS层的数据经过发送模块的处理(<strong>主要是8B–&gt;10B</strong>)：根据GMII发来的信号连续不断地产生编码后的数据流，经PMA的数据请求原语把他们立即发往PMA服务接口。</p> 
<p><strong>自动协商过程</strong>:设置标识通知PCS发送过程发送的是空闲码、数据、还是重新配置链路。</p> 
<p><strong>同步过程</strong>：PCS同步过程经PMA数据单元指示原语连续接收码流，并经同步数据单元指示原语把码流发往PCS接收过程。PCS同步过程设置同步状态标志指示是否PMA层发送来的数据是否可靠。</p> 
<p><strong>接收过程</strong>:从PMA经过同步数据单元指示原语连续接收码流。PCS接收过程监督这些码流并且产生给GMII的数据信号，同时产生供载波监听和发送过程使用的内部标识、接收信号、监测包间空闲码。PCS子层的发送、接收过程在自动协商的指示下完成数据收发、空闲信号的收发和链路配置功能。具体数据的收发满足RD平衡规则。在链路上传输的数据除了256个数据码之外，还有12个特殊的码组作为有效的命令码组出现。</p> 
<p>3、前向纠错子层FEC<br> 发送数据：接收从PCS层发过来的包，先进行10b/8b的变换，然后执行FEC的编码的算法，用校验字节取代一部分扩展的包间间隔，最后再把整个包经过8b/10b编码并把数据发给PMA层。</p> 
<p>接收数据：把经字节对齐之后的数据进行RS译码、插入空闲码后发送数据到PCS层。<br> 特性：</p> 
<ul><li>保证帧格式符合1000BASE-X PCS</li><li>向后兼容1000BASE-X设备</li><li>支持PCS子层10<sup>-12</sup>误码特性</li><li>支持FEC子层10<sup>-4</sup>误码特性</li></ul> 
<p>4、物理媒体附属子层PMA<br> 主要功能是完成串并、并串转换，时钟恢复并提供环回测试功能，它同相邻子层的接口是TBI接口。</p> 
<p>5、物理媒体依赖子层PMD<br> 完成光电、电光转换，按1.25Gbps的速率发送或接收数据。</p> 
<p>按所处位置的不同，光模块又可以分为局端和远端两种。对于远端的光模块而言，接收机处于连续工作状态，而发送机则工作于突发模式，只有在特定的时间段里激光器才处于打开状态，在剩下的时间段里，激光器并不发送数据。由于激光器发送数据的速率是1.25Gbps，因此要求激光器的开关的速度要足够快。同时要求在激光器处于关闭状态时，要使从PMA层发送过来的信号全部为低，以确保不工作的ONU激光器的输出总功率叠加不会对正在工作的激光器的信号造成畸变影响。</p> 
<p>简单理解从数据链路层来的数据，RS调和子层检查LLID号和目的地址，物理编码子层PCS把8B–&gt;10B并标识这是数据，前向纠错子层FEC加上校验字节，物理媒体附属子层PMA完成串并转换，物理媒体依赖子层PMD转变成光信号。</p> 
<h2><a id="312EPON_130"></a>3.1.2、EPON的数据链路层</h2> 
<p>PON数据链路层分为逻辑LLC（Link Layer Control Protocol）和MAC两大部分。LLC遵循的标准为802.2 ，MAC遵循的标准为802.3（CSMA/CD）等。EPON在数据链路层的MAC层采用多点控制协议MPCP(Multi-Point Control Protocol，MPCP)，基于TDM时分复用的控制协议。</p> 
<p>上行信道采用时分多址接入技术（TDMA），分时隙给各个ONU传输上行数据流。来自各个ONU的多种业务信息根据各自分配到的时隙，互不干扰地通过ODN无 源分光器耦合到同一根光纤，最后送到OLT接收头端。</p> 
<p>下行信道采用广播方式，数据从OLT到多个ONU根据不同的时间片段以广播式下行（TDM时分复用技术），通过ODN中的1：N（一般是1：32）无源分光器，分配给PON上所有ONU光网络单元。</p> 
<p>1、MAC子层<br> MAC（Media Access Control）<strong>媒体接入控制子层</strong>，由于PON系统在上行方向共享传输媒质，不同ONU发送的信息在OLT处有可能发生冲突，所以必须进行媒质接入控制（MAC）。MAC子层将上层通信发送的数据封装到以太网的帧结构中，并决定数据的安排、发送和接收。</p> 
<p>在EPON协议中，由于扩展了MAC控制子层的功能，因此新增了五种MAC控制帧，其中用于注册过程中的MAC控制帧有四种，即注册允许帧（Discovery Gate）、注册请求帧（Register Request）、注册帧（Register）和注册确认帧（Register ACK）。</p> 
<p>2、MPCP多点MAC控制层<br> MPCP(Multi-point MAC Control Protocol)<br> MPCP多点MAC控制协议用来完成Control子层的相关功能。多点MAC控制子层主要负责ONU的接入控制，通过MAC控制帧完成对ONU的初始化、测距和动态带宽分配，采用申请/授权（request/grant）机制，执行一整套多点控制协议（MPCP）。</p> 
<p>3、OAM子层<br> OAM（Operation &amp; Administration &amp; Management）运行管理维护子层。OAM给网络管理员提供了一套网络健壮性监测和链路错误定位，以及出错状况分析的方法。</p> 
<h2><a id="313MPCP_150"></a>3.1.3、MPCP协议</h2> 
<p>MPCP(Muti-Point Control Protocol，多点控制协议)MAC control子层的一项功能。MPCP使用消息，状态机，定时器来控制访问P2MP（点到多点）的拓扑结构。EPON实现了一个<strong>P2P仿真子层</strong>，EPON/MPCP协议中的关键组件点到点(P2P)仿真子层，该子层通过在每个数据报的前面加上一个逻辑链路标识LLID，该LLID将替换前导码中的两个字节。使得P2MP网络拓扑对于高层来说就是多个点对点链路的集合。MPCP涉及的内容包括<strong>ONU发送时隙的分配，ONU的自动发现和加入，向高层报告拥塞情况以便动态分配带宽</strong>。MPCP多点控制协议位于MAC Control子层。MAC Control向MAC子层的操作提供实时的控制和处理。EPON系统通过MPC PDU来实现OLT与ONU之间的带宽请求、带宽授权、测距等。</p> 
<p>MPCP子层的基石主要有3点：一是上行信道采用定长时隙的TDMA方式，但时隙的分配由OLT实施；二是对于ONU发出的以太网帧不作分割，而是组合，即：每个时隙可以包含若干个802．3帧，组合方式由ONU依据QoS决定；三是上行信道必须有动态带宽分配（DBA）功能支持即插即用、服务等级协议（SLA）和QoS。</p> 
<p>简单理解MPCP定义了OLT和ONU之间的控制机制，来协调数据的有效发送和接收。OLT是在上课的老师，ONU是各个学生，老师讲课就是广播，单个学生提问，要按老师的时序来提问。老师上课时要检查有哪些学生来上课了，哪些没有到。</p> 
<h2><a id="314LLIDMPCPPDU_156"></a>3.1.4、LLID和MPCP的PDU格式</h2> 
<p>在EPON系统中，按照<strong>单纤双向全双工</strong>的方式以<strong>点到多点</strong>(P2MP)的方式传送数据。OLT通过光纤向各ONU广播时，为了对各ONU区别，保证只有发送的ONU能收到数据包，IEEE802.3ah标准在数据链路层的MPCP中引入LLID(Logical Link ID,逻辑链路标志)的概念。EPON系统通过MPCP PDU（Protocol Data Unit,协议数据单元）来实现OLT与ONU之间的带宽请求、带宽授权、测距等。<br> <img src="https://images2.imgbox.com/d9/dd/h36ZlVIR_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/9e/cf/xfbKS0T4_o.png" alt="在这里插入图片描述"><br> MPCP PDU格式中，LLID由两个字节的字段组成：</p> 
<ul><li>1bit的Mode字段</li><li>15bit的LLID字段</li></ul> 
<p>LLID(Logical Link ID,逻辑链路标志)字段在原千兆以太网IEEE802.3z中前导码（上图为7字节同步码1字节帧首定界符）中占用两个字节空间。Mode字段标记是点到点(P2P)模式还是广播(Broadcast)模式。LLID最大值为32767，EPON系统中每个ONU由OLT分配一个网内独一无二的LLID号，这个号码决定哪一个ONU有接收广播的权力。</p> 
<p>LLID数量支持128个，实际中不会用到，最多64个。也就是说分光比1：N最多到1：64。</p> 
<p>MPCP PDU（Protocol Data Unit,协议数据单元）中还包含有操作码(Opcode)和时间戳(Timestamp)。时间戳的作用是传递当前时间信息，以完成OLT与ONU的MPCP时钟同步。</p> 
<p>MPCP协议中定义了五种控制信息，由操作码字段标识:</p> 
<ul><li>0002：GATE（OLT发出）</li><li>0003：REPORT（ONU发出）报告</li><li>0004：REGISTRER（ONU发出）登记;注册</li><li>0005：REGISTRER（OLT发出）登记;注册</li><li>0006：REGISTRER_ACK（ONU发出）注册确认</li></ul> 
<p>MPCP定义三种处理过程：<br> 1、Discovery Processing发现处理：发现系统中未注册的ONU并为新注册的ONU分配LLID，并将该ONU的MAC地址和分配的LLID绑定，测试OLT到ONU距离（光信号传输时间）。</p> 
<p>2、Report Processing报告处理：OLT根据ONU的Report申请信息，实现对各个ONU的带宽动态分配和实时状态的监控。</p> 
<p>OLT指定每个ONU在特定的时段发送数据帧或控制帧，避免ONU因为共享上行信道发生数据传输冲突。</p> 
<p>3、Gate Processing闸门处理：OLT控制ONU在某一时隙发送数据帧或控制帧，避免ONU因为共享上行信道发生数据传输冲突。</p> 
<h2><a id="32EPON_186"></a>3.2、EPON系统的工作机制</h2> 
<p><strong>WDN</strong>(Wavelength Division Multiplexing，波分复用)技术介绍。简单地说，不同的信号汇集在一起传输而互不干扰称为复用。“波分复用技术”指的是将不同波长的光信号汇集在一根光纤中发射传输，在接收端将它们分开。<br> <img src="https://images2.imgbox.com/79/e7/DEKliHd0_o.png" alt="波分复用光的频分复用"></p> 
<p>光的频分复用<br> OLT局端使用多个激光器在单条光纤上同时发送多束不同波长激光，每个信号经过数据(文本、语音、视频)调制后都在它独有的色带内传输。WDN技术将多种不同波长的光载波信号，在发送端经波分复用器(MUX)也称为合波器汇合在一起，耦合到光线路的同一根光纤中向下传输，经过分光器在接收端通过波分解复用器(DEMUX)将不同波长光载波信号分离，最后在ONU光网络单元由光信号转换成电信号进行传输。<br> <img src="https://images2.imgbox.com/a7/84/LGb2ZtuG_o.png" alt="波分复用"></p> 
<p>光滤波器在WDM系统中是一种重要元器件， 与波分复用有着密切关系，常常用来构成各种各样的波分复用器(合波)和解复用器(分波)。波分复用器件是利用了一些特殊材料的光学特性，及<strong>色散、偏振、干涉</strong>等物理现象实现分波及其合波的功能。主要有光栅型、干涉滤波片型、阵列光波导型和熔锥型四种基本形式。</p> 
<p>在一根芯上转送上下行两个波，上行波长：1310nm，下行波长：1490nm，另外还可以在这个芯上下行叠加1550nm的波长(有线电视1550nm的光信号送入EPON光纤中实现共用一根纤芯)。在下行传输中POS(分光器)在物理层上把接收的光载波信号分1：N份，传输到所有的ONU，ONU接收的数据是相同的，ONU根据LLID，在物理层上做判断，接收给它自己的数据帧，摒弃那些给其它ONU的数据帧。这是广播方式。对于安全性的考虑。上行方向，ONU不能直接接收到其它ONU上行的信号，所以ONU之间的通信，都必须通过OLT，在OLT可以设置允许和禁止ONU之间的通信。</p> 
<p>加密：对于每一对ONU与OLT之间，可以启用128位的AES加密。各个ONU的密钥是不同的。</p> 
<p>VLAN隔离：通过VLAN方式，将不同的用户群、或者不同的业务限制在不同的VLAN，保障相互之间的信息隔离。</p> 
<h2><a id="321ONU_204"></a>3.2.1、ONU注册</h2> 
<p>ONU的注册方式有两种：</p> 
<ul><li>普通GATE(注册授权)，以单播方式进行带宽分配；</li><li>发现GATE(注册授权)，以广播方式进行ONU发现。<br> <img src="https://images2.imgbox.com/c5/ac/vAI8OQmo_o.png" alt="ONU的注册"></li></ul> 
<p>1、OLT广播发送一个发现Gate(注册授权)，通行所有ONU发现时隙的开始时刻及长度。</p> 
<p>时隙是时分复用模式(TDM)中的一个时间片。<br> 我国采用的是30/32路帧结构，即每一帧占125µs，分为32个时隙，但只传送30路话音信息。</p> 
<p>2、没有注册的ONU响应发现Gate消息，修改本地时钟和Gate消息中所携带的时间戳一致。</p> 
<p>REGISTER_REQ 注册请求消息包含有ONU的MAC地址和发送REGISTER_REQ消息时ONU本地时间戳。</p> 
<p>3、当OLT收到一个未注册ONU的REGISTER_REQ消息后，将获得其MAC地址和往返时延(RTT);往返时延主要用于ONU和OLT之间时间同步。</p> 
<p>4、发送一个单播REGISTER消息到这个未注册的的ONU。REGISTER消息中包含有分配给ONU的一个唯一的LLID。</p> 
<p>5、OLT广播发送一个普通 Gate消息，给这个ONU。</p> 
<p>6、ONU收到REGISTER和普通Gate消息后，将在Gate消息中授权的时隙发送一个REGISTER_ACK消息，告知OLT已经解析了REGISTER消息。</p> 
<p>OLT每隔1s向系统各个ONU广播发送目的地址的广播的LLID(全零)的GATE(注册授权)，并根据系统内距离最远的ONU确定开窗大小(10km为150us;20k为250us)。GATE(注册授权)发送是否激活由网管决定。在发送GATE时剩余带宽由ONU平均分配。如果在50ms内没有收到ONU的REGISTER_REQ 注册请求帧，OLT认为注册失败。</p> 
<p>OLT—&gt;Gate(注册授权)：<br> 目的MAC地址、源MAC地址、时间标签、未注册ONU的LLID(全为零)、起始时间、开窗大小。</p> 
<p>ONU—&gt;REGISTER_REQ (注册请求):<br> 目的MAC地址、源MAC地址、时间标签、未注册ONU的LLID(全为零)、时间标签、OL CPU MAC地址、OLT PON ID等信息。</p> 
<p>OLT—&gt;REPORT(注册帧)：<br> 目的MAC地址、源MAC地址、时间标签、分配给ONU的LLID、时间标签、Flag字节等信息。</p> 
<p>ONU—&gt;REGISTER_ACK(注册确认帧)：<br> 目的MAC地址、源MAC地址、时间标签、ONU的LLID、时间标签、Flag字节等信息。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7fb3998a3b63e39c542f2e3e0cf4dbae/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">JAVA对接支付宝(H5、APP、小程序)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5dca30c9808cc97d05dc7485d595d97d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">标签超过一行后折叠并显示控制折叠/展开按钮（标签宽度不固定）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>