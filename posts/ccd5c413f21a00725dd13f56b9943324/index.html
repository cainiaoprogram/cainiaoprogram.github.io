<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SPI通讯协议必备知识。 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SPI通讯协议必备知识。" />
<meta property="og:description" content="一、SPI简介 SPI 协议是由摩托罗拉公司提出的通讯协议(Serial Peripheral Interface)，即串行外围设备接口，是一种高速全双工的通信总线。
它被广泛地使用在 ADC、LCD 等设备与 MCU 间，要求通讯速率较高的场合。
二、基本原理 1. 物理层 SPI内部结构图：
SPI连接方式图：
引脚介绍
SPI通讯采用3条总线以及片选线，即上图中的SCK、MOSI、MISO、SS。
（1）：（SS）&#39;为片选信号线，也被称为NSS、CS，其功能是寻址。在STM32中，I2C是通过设备地址来选择不同的设备，但SPI没有设备地址，只能通过CS信号线来寻址，因此每个设备都有一条单独的CS信号线与主机相连。当CS信号线设置为低电平时，即该设备被选中，选中后就可以进行SPI通信，CS信号线被拉高，作为结束信号。
（2）：SCK (Serial Clock)：时钟信号线，用于同步通讯数据。它由通讯主机产生，并决定通讯的速率，但由于不同设备的最高通讯速率不同，当两个设备通讯时，受限于设备的最低速率。在STM32中，SPI时钟频率最大为fpclk/2。手册规定SPI最快为18MHz，但SPI1挂载在APB2时钟总线下，理论最快为36MHz。
（3）：MOSI (Master Output， Slave Input)：主设备输出/从设备输入引脚。主机的数据从这条信号线输出，从机由这条信号线读入主机发送的数据，即这条线上数据的方向为主机到从机。
（4）：MISO(Master Input,，Slave Output)：主设备输入/从设备输出引脚。主机从这条信号线读入数据，从机的数据由这条信号线输出到主机，即在这条线上数据的方向为从机到主机。
2.协议层 2.1 SPI通讯基本过程 通讯时序图：
这是一个主机的通讯时序。NSS、SCK、MOSI 信号都由主机控制产生，而 MISO 的信号由从机产生，主机通过该信号线读取从机的数据。MOSI 与 MISO 的信号只在 NSS 为低电平的时候才有效，在 SCK 的每个时钟周期 MOSI 和 MISO 传输一位数据。 2.2 通讯的起始和停止信号 在上图中的标号（1）处，NSS 信号线由高变低，是 SPI 通讯的起始信号。
NSS 是每个从机各自独占的信号线，当从机在自己的 NSS 线检测到起始信号后，就知道自己被主机选中了，开始准备与主机通讯。
在图中的标号（6）处，NSS 信号由低变高，是 SPI 通讯的停止信号，表示本次通讯结束，从机的选中状态被取消。
2.3 数据有效性 SPI 使用 MOSI 及 MISO 信号线来传输数据，使用 SCK 信号线进行数据同步。MOSI及 MISO 数据线在 SCK 的每个时钟周期传输一位数据，且数据输入输出是同时进行的。数据传输时，MSB 先行或 LSB 先行并没有作硬性规定，但要保证两个 SPI 通讯设备之间使用同样的协定，一般都会采用图中的 MSB 先行模式。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/ccd5c413f21a00725dd13f56b9943324/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-15T10:21:04+08:00" />
<meta property="article:modified_time" content="2020-12-15T10:21:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SPI通讯协议必备知识。</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="SPI_1"></a>一、SPI简介</h2> 
<ul><li> <p>SPI 协议是由摩托罗拉公司提出的通讯协议(Serial Peripheral Interface)，即串行外围设备接口，是一种高速全双工的通信总线。</p> </li><li> <p>它被广泛地使用在 ADC、LCD 等设备与 MCU 间，要求通讯速率较高的场合。</p> </li></ul> 
<h2><a id="_5"></a>二、基本原理</h2> 
<h3><a id="1__6"></a>1. 物理层</h3> 
<ul><li> <p>SPI内部结构图：<br> <img src="https://images2.imgbox.com/c6/59/rvoRm4Rw_o.png" alt="在这里插入图片描述"></p> </li><li> <p>SPI连接方式图：<br> <img src="https://images2.imgbox.com/fc/15/M8pdleKi_o.png" alt="在这里插入图片描述"></p> </li><li> <p>引脚介绍<br> SPI通讯采用3条总线以及片选线，即上图中的SCK、MOSI、MISO、SS。</p> </li></ul> 
<p>（1）：（SS）'为片选信号线，也被称为NSS、CS，其功能是寻址。在STM32中，I2C是通过设备地址来选择不同的设备，但SPI没有设备地址，只能通过CS信号线来寻址，因此每个设备都有一条单独的CS信号线与主机相连。当CS信号线设置为低电平时，即该设备被选中，选中后就可以进行SPI通信，CS信号线被拉高，作为结束信号。</p> 
<p>（2）：SCK (Serial Clock)：时钟信号线，用于同步通讯数据。它由通讯主机产生，并决定通讯的速率，但由于不同设备的最高通讯速率不同，当两个设备通讯时，受限于设备的最低速率。在STM32中，SPI时钟频率最大为fpclk/2。手册规定SPI最快为18MHz，但SPI1挂载在APB2时钟总线下，理论最快为36MHz。</p> 
<p>（3）：MOSI (Master Output， Slave Input)：主设备输出/从设备输入引脚。主机的数据从这条信号线输出，从机由这条信号线读入主机发送的数据，即这条线上数据的方向为主机到从机。</p> 
<p>（4）：MISO(Master Input,，Slave Output)：主设备输入/从设备输出引脚。主机从这条信号线读入数据，从机的数据由这条信号线输出到主机，即在这条线上数据的方向为从机到主机。</p> 
<h3><a id="2_26"></a>2.协议层</h3> 
<h4><a id="21_SPI_27"></a>2.1 SPI通讯基本过程</h4> 
<ul><li>通讯时序图：<br> <img src="https://images2.imgbox.com/39/f1/VomgalWf_o.png" alt="在这里插入图片描述"></li><li>这是一个主机的通讯时序。NSS、SCK、MOSI 信号都由主机控制产生，而 MISO 的信号由从机产生，主机通过该信号线读取从机的数据。MOSI 与 MISO 的信号只在 NSS 为低电平的时候才有效，在 SCK 的每个时钟周期 MOSI 和 MISO 传输一位数据。</li></ul> 
<h4><a id="22__31"></a>2.2 通讯的起始和停止信号</h4> 
<ul><li> <p>在上图中的标号（1）处，NSS 信号线由高变低，是 SPI 通讯的起始信号。</p> </li><li> <p>NSS 是每个从机各自独占的信号线，当从机在自己的 NSS 线检测到起始信号后，就知道自己被主机选中了，开始准备与主机通讯。</p> </li><li> <p>在图中的标号（6）处，NSS 信号由低变高，是 SPI 通讯的停止信号，表示本次通讯结束，从机的选中状态被取消。</p> </li></ul> 
<h4><a id="23__37"></a>2.3 数据有效性</h4> 
<ul><li> <p>SPI 使用 MOSI 及 MISO 信号线来传输数据，使用 SCK 信号线进行数据同步。MOSI及 MISO 数据线在 SCK 的每个时钟周期传输一位数据，且数据输入输出是同时进行的。数据传输时，MSB 先行或 LSB 先行并没有作硬性规定，但要保证两个 SPI 通讯设备之间使用同样的协定，一般都会采用图中的 MSB 先行模式。</p> </li><li> <p>观察图中的（2）、（3）、（4）、（5）、标号处，MOSI 及 MISO 的数据在 SCK 的上升沿期间变化输出，在 SCK 的下降沿时被采样。即在 SCK 的下降沿时刻，MOSI 及 MISO 的数据有效，高电平时表示数据“1”，为低电平时表示数据“0”。在其它时刻，数据无效，MOSI 及 MISO为下一次表示数据做准备。</p> </li><li> <p>SPI 每次数据传输可以 8 位或 16 位为单位，每次传输的单位数不受限制。</p> </li></ul> 
<h4><a id="24__CPOLCPHA__45"></a>2.4 . CPOL/CPHA 及通讯模式</h4> 
<ul><li>SPI 一共有四种通讯模式，它们的主要区别是总线空闲时 SCK 的时钟状态以及数据采样时刻。由“时钟极性 CPOL”和“时钟相位 CPHA”决定。</li><li>时钟极性 CPOL 是指 SPI 通讯设备处于空闲状态时，SCK 信号线的电平信号(即 SPI 通讯开始前、 NSS 线为高电平时 SCK 的状态)。CPOL=0 时， SCK 在空闲状态时为低电平，CPOL=1 时，则相反。</li><li>时钟相位 CPHA 是指数据的采样的时刻，当 CPHA=0 时，MOSI 或 MISO 数据线上的信号将会在 SCK 时钟线的“奇数边沿”被采样。当 CPHA=1 时，数据线在 SCK 的“偶数边沿”采样。</li><li>奇数边沿采样：<br> <img src="https://images2.imgbox.com/42/6a/sbhynQTe_o.png" alt="在这里插入图片描述"></li><li>偶数边沿采样：<br> <img src="https://images2.imgbox.com/42/bb/qKGo0iJK_o.png" alt="在这里插入图片描述"></li><li>MOSI 和 MISO 数据线的有效信号在 SCK 的奇数边沿保持不变，数据信号将在 SCK 奇数边沿时被采样，在非采样时刻，MOSI 和 MISO 的有效信号才发生切换。</li><li>SPI的四种模式：<br> <img src="https://images2.imgbox.com/92/5a/uVWID2Wv_o.png" alt="在这里插入图片描述"></li></ul>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6a810ef5b50658d2d9d48d6f1d534787/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">个人微信api接口java调用代码</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/10756c7a5187128826ecf44903030841/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python读取mp4文件失败_Python代码打开本地.mp4格式文件的方法-mp4文件</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>