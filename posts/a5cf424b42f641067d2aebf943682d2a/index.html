<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>实例：NodeJS 操作 Kafka - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="实例：NodeJS 操作 Kafka" />
<meta property="og:description" content="本人是C#出身的程序员，c#很简单就能实现，有需要的可以加我私聊。但是就目前流行的开发语言，尤其是面向web方向应用的，我感觉就是Nodejs最简单了。下面介绍：
本文将会介绍在windows环境下启动Kafka，并通过nodejs作为客户端，生产并消费消息。
步骤一，Kafka需要java运行时，先安装配置java环境。通过在命令行中输入java -version确认java是否成功安装(可能需要查看windows的环境变量中是否有java)。
步骤二，Kafka官网下载最新版本的压缩包(.tgz格式)，并解压。分别在两个命令行里面启动zookeeper、kafka（解压缩路径下）
bin\windows\zookeeper-server-start.bat config\zookeeper.properties
bin\windows\kafka-server-start.bat config\server.properties
说明一下zookeeper和kafka的关系:zookeeper是集群的调度者，kafka才是消息队列。 zookeeper的默认端口：2181，kafka的默认端口：9092
相关配置可以在config文件下的server.properties和zookeeper.properties中找到
用记事本打开就可以编辑
建立data,logs,kafka-logs目录，用于日志，备用。
消费者客户端需要的group.id可以在config-&gt;consumer.properties中找到。
步骤三，使用DOS的CMD管理员命令行方式测试生产者生产、消费者消费。
//创建一个topic：test
bin\windows\kafka-topics.bat --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test
//查看topic
bin\windows\kafka-topics.bat --list --zookeeper localhost:2181
//创建生产者主题mytest
bin\windows\kafka-console-producer.bat --broker-list localhost:9092 --topic test-nodetopic
//创建消费者消费mytest
bin\windows\kafka-console-consumer.bat --bootstrap-server localhost:9092 --topic test-nodetopic --from-beginning
步骤四，生产者发送消息
在生产者窗口，随意输入一条消息，可以在消费者窗口看到该消息。
最后，使用nodejs访问kafka 首先安装kafkajs
初始化项目
npm init -y
没有安装kafkajs的，在这里可以安装，互联网在线安装。
npm install kafkajs
新建demo2023.js，输入以下代码
const { Kafka } = require(&#39;kafkajs&#39;)
const kafka = new Kafka({" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/a5cf424b42f641067d2aebf943682d2a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-04T08:41:13+08:00" />
<meta property="article:modified_time" content="2024-01-04T08:41:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">实例：NodeJS 操作 Kafka</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="text-align:left;">本人是C#出身的程序员，c#很简单就能实现，有需要的可以加我私聊。但是就目前流行的开发语言，尤其是面向web方向应用的，我感觉就是Nodejs最简单了。下面介绍：</p> 
<p style="text-align:left;">本文将会介绍在windows环境下启动Kafka，并通过nodejs作为客户端，生产并消费消息。</p> 
<p style="text-align:left;"><strong><span style="color:#000000;"><strong>步骤一</strong></span></strong>，Kafka需要java运行时，先安装配置java环境。通过在命令行中输入java -version确认java是否成功安装(可能需要查看windows的环境变量中是否有java)。</p> 
<p style="text-align:left;"><strong><span style="color:#000000;"><strong>步骤二</strong></span></strong>，<a href="http://kafka.apache.org/" rel="nofollow" title="Kafka官网">Kafka官网</a>下载最新版本的压缩包(.tgz格式)，并解压。分别在两个命令行里面启动zookeeper、kafka（解压缩路径下）</p> 
<p style="text-align:left;">bin\windows\zookeeper-server-start.bat config\zookeeper.properties</p> 
<p style="text-align:left;">bin\windows\kafka-server-start.bat config\server.properties</p> 
<p style="text-align:left;">说明一下zookeeper和kafka的关系:zookeeper是集群的调度者，kafka才是消息队列。 zookeeper的默认端口：2181，kafka的默认端口：9092<br> 相关配置可以在config文件下的server.properties和zookeeper.properties中找到</p> 
<p style="text-align:left;"><img alt="" height="382" src="https://images2.imgbox.com/01/40/km3cmIWP_o.png" width="609"></p> 
<p style="text-align:left;">用记事本打开就可以编辑</p> 
<p style="text-align:left;">建立data,logs,kafka-logs目录，用于日志，备用。</p> 
<p style="text-align:left;">消费者客户端需要的group.id可以在config-&gt;consumer.properties中找到。</p> 
<p style="text-align:left;"><img alt="" height="204" src="https://images2.imgbox.com/90/86/PyCGK66w_o.png" width="614"></p> 
<p style="text-align:left;"><strong><strong>步骤三</strong></strong>，使用DOS的CMD管理员命令行方式测试生产者生产、消费者消费。<br> //创建一个topic：test<br> bin\windows\kafka-topics.bat --create <span style="color:#ff0000;">--zookeeper</span> localhost:2181 --replication-factor 1 --partitions 1 --topic test</p> 
<p style="text-align:left;">//查看topic<br> bin\windows\kafka-topics.bat --list --zookeeper localhost:2181</p> 
<p style="text-align:left;">//创建生产者主题mytest<br> bin\windows\kafka-console-producer.bat <span style="color:#ff0000;">--broker-list</span> localhost:9092 --topic test-nodetopic</p> 
<p style="text-align:left;">//创建消费者消费mytest<br> bin\windows\kafka-console-consumer.bat<span style="color:#ff0000;"> --bootstrap-server</span> localhost:9092 --topic test-nodetopic --from-beginning</p> 
<p style="text-align:left;"><strong>步骤四</strong>，生产者发送消息<br> 在生产者窗口，随意输入一条消息，可以在消费者窗口看到该消息。</p> 
<p style="text-align:left;"><img alt="" height="67" src="https://images2.imgbox.com/e7/fb/6DaqoIzO_o.png" width="384"></p> 
<p style="margin-left:.0001pt;text-align:left;">最后，使用nodejs访问kafka  首先安装kafkajs</p> 
<p style="margin-left:.0001pt;text-align:left;">初始化项目</p> 
<p style="margin-left:.0001pt;text-align:left;">npm init -y</p> 
<p style="margin-left:.0001pt;text-align:left;">没有安装kafkajs的，在这里可以安装，互联网在线安装。<br> npm install kafkajs</p> 
<p style="margin-left:.0001pt;text-align:left;">新建demo2023.js，输入以下代码</p> 
<p style="margin-left:.0001pt;text-align:left;">const { Kafka } = require('kafkajs')</p> 
<p style="margin-left:.0001pt;text-align:left;">const kafka = new Kafka({<!-- --></p> 
<p style="margin-left:.0001pt;text-align:left;">  clientId: 'my-app',</p> 
<p style="margin-left:.0001pt;text-align:left;">  brokers: ['localhost:9092']</p> 
<p style="margin-left:.0001pt;text-align:left;">})</p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;">const producer = kafka.producer()</p> 
<p style="margin-left:.0001pt;text-align:left;">const consumer = kafka.consumer({ groupId: 'test-consumer-group' })</p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;">const run = async () =&gt; {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:left;">  // Producing</p> 
<p style="margin-left:.0001pt;text-align:left;">  await producer.connect()</p> 
<p style="margin-left:.0001pt;text-align:left;">  await producer.send({<!-- --></p> 
<p style="margin-left:.0001pt;text-align:left;">    topic: 'test-nodetopic',</p> 
<p style="margin-left:.0001pt;text-align:left;">    messages: [</p> 
<p style="margin-left:.0001pt;text-align:left;">      { value: ' Hello KafkaJS user，I am producer ! ' },</p> 
<p style="margin-left:.0001pt;text-align:left;">    ],</p> 
<p style="margin-left:.0001pt;text-align:left;">  })</p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;">  // Consuming</p> 
<p style="margin-left:.0001pt;text-align:left;">  await consumer.connect()</p> 
<p style="margin-left:.0001pt;text-align:left;">  await consumer.subscribe({ topic: 'test-nodetopic', fromBeginning: true })</p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;">  await consumer.run({<!-- --></p> 
<p style="margin-left:.0001pt;text-align:left;">    eachMessage: async ({ topic, partition, message }) =&gt; {<!-- --></p> 
<p style="margin-left:.0001pt;text-align:left;">      console.log({<!-- --></p> 
<p style="margin-left:.0001pt;text-align:left;">        partition,</p> 
<p style="margin-left:.0001pt;text-align:left;">        offset: message.offset,</p> 
<p style="margin-left:.0001pt;text-align:left;">        value: message.value.toString(),</p> 
<p style="margin-left:.0001pt;text-align:left;">      })</p> 
<p style="margin-left:.0001pt;text-align:left;">    },</p> 
<p style="margin-left:.0001pt;text-align:left;">  })</p> 
<p style="margin-left:.0001pt;text-align:left;">}</p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;">run().catch(console.error)</p> 
<p style="margin-left:.0001pt;text-align:left;">最后执行命令<br> node demo2023.js</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a847b87c5d85e9f5d793a2f3629bd8fc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">中断请求分类</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/50331303c319bb784a346be399283620/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C&#43;&#43;面向对象语法总结(三）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>