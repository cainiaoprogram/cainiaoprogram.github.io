<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>如何使mad-hacking支持sas的扫描 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="如何使mad-hacking支持sas的扫描" />
<meta property="og:description" content="以下红色字体为添加或修改的信息，其中因为sas与sata的信息结构不一样，为了是程序正常运行，所以需要删除最后一行红字的内容。
#!/bin/bash -u
# Include snmpd-connector-lib.sh or die. [[ ! -r ${SNMPD_CONNECTOR_LIB:=/usr/lib/snmpd-connector-lib.sh} ]] &amp;&amp; echo &#34;Unable to find ${SNMPD_CONNECTOR_LIB}&#34; &amp;&amp; exit 1 source ${SNMPD_CONNECTOR_LIB} # judge the disk&#39;s type is sas or sata # # @in_param $1 - The disk&#39;s device name (/dev/sda) # @out_param $2 - The result whether the disk&#39;s type is sata # 0 is that the disk&#39;s type is sata # 1 is that the disk&#39;s type is sas # function judge { temp=`smartctl -d test $1|grep ATA` echo $?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/40f239cdbb01a147a6f461b7202d121c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-05-25T16:40:29+08:00" />
<meta property="article:modified_time" content="2012-05-25T16:40:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">如何使mad-hacking支持sas的扫描</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>以下红色字体为添加或修改的信息，其中因为sas与sata的信息结构不一样，为了是程序正常运行，所以需要删除最后一行红字的内容。<br> </p> 
<p>#!/bin/bash -u</p> 
<br> # Include snmpd-connector-lib.sh or die. 
<br> [[ ! -r ${SNMPD_CONNECTOR_LIB:=/usr/lib/snmpd-connector-lib.sh} ]] &amp;&amp; echo "Unable to find ${SNMPD_CONNECTOR_LIB}" &amp;&amp; exit 1 
<br> source ${SNMPD_CONNECTOR_LIB} 
<br> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)"># judge the disk's type is sas or sata</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)"># </span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">#    @in_param    $1 - The disk's device name (/dev/sda)</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">#    @out_param    $2 - The result whether the disk's type is sata </span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">#                0 is that the disk's type is sata</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">#                1 is that the disk's type is sas</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">#</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">function judge</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">{<!-- --></span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">    temp=`smartctl -d test $1|grep ATA`</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">    echo $?</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">}</span> 
<br> 
<br> # Helper function to get the device path from the devices array using a 1 based index 
<br> # 
<br> #    @in_param    $1 - The 1 based index of the device 
<br> #    @out_param    $2 - The path of this device 
<br> # 
<br> function get_device_path 
<br> { 
<br>     local AINDEX=$((${1} - 1)) 
<br>     eval $2=${DEVICES[${AINDEX}]}     
<br> } 
<br> 
<br> # Helper function to get the device file base path from the devices array using a 1 based index 
<br> # 
<br> #    @in_param    $1 - The 1 based index of the device 
<br> #    @out_param    $2 - The path of this device 
<br> #                                $3-The disk's device name 
<br> function get_device_file_basepath 
<br> { 
<br>     local DEVPATH DEVFILE 
<br>      
<br>     # Make the device info filename 
<br>     get_device_path ${1} DEVPATH 
<br>      
<br>     DEVFILE=${DEVPATH##\/} 
<br>     DEVFILE=${CACHEDIR}/${DEVFILE//\//_} 
<br>      
<br>     eval $2=${DEVFILE} 
<br>      
<span style="color:rgb(255,0,0)">eval $3=${DEVPATH}</span> 
<br> } 
<br> 
<br> # Function to send the index value 
<br> # 
<br> #    @in_param    $1 - The OID to send before this data 
<br> #    @in_param    $2 - The index value 
<br> # 
<br> function send_index 
<br> { 
<br>     # If the index is in range... 
<br>     if (( $# &gt; 1 )); then 
<br>         if (( ${2} &lt;= ${#DEVICES[@]} )); then 
<br>             # Send the OID and the index number. 
<br>             send_integer ${1} ${2} 
<br>             return 
<br>         fi 
<br>     fi 
<br> 
<br>     # Send the OID and NONE. 
<br>     send_none ${1} 
<br> } 
<br> 
<br> # Function to send the device path 
<br> # 
<br> #    @in_param    $1 - The OID to send before this data 
<br> #    @in_param    $2 - The index value 
<br> # 
<br> function send_device_path 
<br> { 
<br>     local DEVPATH 
<br>     get_device_path ${2} DEVPATH 
<br>     send_string ${1} ${DEVPATH} 
<br> } 
<br> 
<br> # Function to send device info - called: send_device_info OID DEVICE "Info String" 
<br> # 
<br> #    @in_param    $1 - The STRING to search for 
<br> #    @in_param    $2 - The OID to send before this data 
<br> #    @in_param    $3 - The index value 
<br> function send_device_info 
<br> { 
<br>     local DEVFNAME VALUE 
<span style="color:rgb(255,102,102)">DEV</span> 
<br>      
<br>     # Make the device info filename 
<br>     get_device_file_basepath ${3} DEVFNAME 
<span style="color:rgb(255,102,102)">DEV</span> 
<br>     DEVFNAME="${DEVFNAME}_info" 
<br>      
<span style="color:rgb(255,0,0)">ernum=`judge $DEV`</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">    if [ $ernum = 1 ];then</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">        case "$1" in</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">        "Model Family:")</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">                device=$1</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">        ;;</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">        "Device Model:")</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">                device="Device:"</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">        ;;</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">        "Serial Number:")</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">                device="Serial number:"</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">        ;;</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">        "User Capacity:")</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">            device=$1</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">        ;;</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">        "ATA Version is:")</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">            device=$1</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">        ;;</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">        *)</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">            device=$1</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">        ;;</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">        esac</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">    else</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">        device=$1</span> 
<br style="color:rgb(255,0,0)"> 
<span style="color:rgb(255,0,0)">    fi</span> 
<br>     VALUE=$(grep "${device}" &lt; ${DEVFNAME}) 
<br>     VALUE=${VALUE#${device}} 
<br>     send_string ${2} "${VALUE}" 
<br> 
<br>     # Find the entry in above file 
<br>     #VALUE=$(grep "${1}" &lt; ${DEVFNAME}) 
<br>     #VALUE=${VALUE#${1}} 
<br>     #send_string ${2} "${VALUE}" 
<br> } 
<br> 
<br> # Function to send device health - called: send_device_hlth OID DEVICE 
<br> # 
<br> #    @in_param    $1 - The OID to send before this data 
<br> #    @in_param    $2 - The index value 
<br> # 
<br> function send_device_hlth 
<br> { 
<br>     local DEVFNAME VALUES 
<span style="color:rgb(255,102,102)">DEV</span> 
<br>      
<br>     # Make the device info filename 
<br>     get_device_file_basepath ${2} DEVFNAME 
<span style="color:rgb(255,102,102)">DEV</span> 
<br>     DEVFNAME="${DEVFNAME}_state" 
<br> 
<span style="color:rgb(255,102,102)">    ernum=`judge $DEV`</span> 
<br> 
<br>     # Find the entry in above file 
<br> 
<span style="color:rgb(255,102,102)">    if [ $ernum = 0 ];then</span> 
<br style="color:rgb(255,102,102)"> 
<span style="color:rgb(255,102,102)">        VALUES=($(grep "result:" &lt; ${DEVFNAME}))</span> 
<br style="color:rgb(255,102,102)"> 
<span style="color:rgb(255,102,102)">        [[ "${VALUES[5]}" == "PASSED" ]] &amp;&amp; send_boolean ${1} "T" || send_boolean ${1} "F" </span> 
<br style="color:rgb(255,102,102)"> 
<span style="color:rgb(255,102,102)">    else</span> 
<br style="color:rgb(255,102,102)"> 
<span style="color:rgb(255,102,102)">        VALUES=($(grep "Status:" &lt; ${DEVFNAME}))</span> 
<br style="color:rgb(255,102,102)"> 
<span style="color:rgb(255,102,102)">        [[ "${VALUES[3]}" == "OK" ]] &amp;&amp; send_boolean ${1} "T" || send_boolean ${1} "F"</span> 
<br style="color:rgb(255,102,102)"> 
<span style="color:rgb(255,102,102)">    fi</span> 
<br> } 
<br> 
<br> # Function to send device attribute - called: send_device_attr OID DEVICE "Attribute String" R[aw]|L[ife] 
<br> # 
<br> #    @in_param    $1 - The STRING to search for 
<br> #    @in_param    $2 - R to send RAW value, L to send LIFETIME value 
<br> #    @in_param    $3 - The OID to send before this data 
<br> #    @in_param    $4 - The index value 
<br> # 
<br> function send_device_attr 
<br> { 
<br>     local DEVFNAME VALUES 
<span style="color:rgb(255,102,102)">DEV</span> 
<br>      
<br>     # Make the device info filename 
<br>     get_device_file_basepath ${4} DEVFNAME 
<span style="color:rgb(255,102,102)">DEV</span> 
<br>     DEVFNAME="${DEVFNAME}_attr" 
<br>         
<span style="color:rgb(255,102,102)">ernum=`judge $DEV`</span> 
<br>      
<br> 
<span style="color:rgb(255,102,102)">        if [ $ernum = 0 ];then</span> 
<br style="color:rgb(255,102,102)"> 
<span style="color:rgb(255,102,102)">                value=$1</span> 
<br style="color:rgb(255,102,102)"> 
<span style="color:rgb(255,102,102)">        else</span> 
<br style="color:rgb(255,102,102)"> 
<span style="color:rgb(255,102,102)">                case "$1" in</span> 
<br style="color:rgb(255,102,102)"> 
<span style="color:rgb(255,102,102)">                "Reallocated_Sector_Ct")</span> 
<br style="color:rgb(255,102,102)"> 
<span style="color:rgb(255,102,102)">                      value="Elements in grown defect list:"</span> 
<br style="color:rgb(255,102,102)"> 
<span style="color:rgb(255,102,102)">                      ;;</span> 
<br style="color:rgb(255,102,102)"> 
<span style="color:rgb(255,102,102)">                *)</span> 
<br style="color:rgb(255,102,102)"> 
<span style="color:rgb(255,102,102)">                      value="Current Drive Temperature:"</span> 
<br style="color:rgb(255,102,102)"> 
<span style="color:rgb(255,102,102)">                     ;;</span> 
<br style="color:rgb(255,102,102)"> 
<span style="color:rgb(255,102,102)">                esac</span> 
<br style="color:rgb(255,102,102)"> 
<span style="color:rgb(255,102,102)">        fi</span> 
<br>     # Find the entry in above file 
<br>     VALUES=($(grep "${value}" &lt; ${DEVFNAME})) 
<br>     case ${2} in 
<br>         "R") 
<br> 
<span style="color:rgb(255,102,102)">                if [ $ernum = 0 ];then</span> 
<br style="color:rgb(255,102,102)"> 
<span style="color:rgb(255,102,102)">                    send_gauge ${3} ${VALUES[9]}</span> 
<br style="color:rgb(255,102,102)"> 
<span style="color:rgb(255,102,102)">                else</span> 
<br style="color:rgb(255,102,102)"> 
<span style="color:rgb(255,102,102)">                    send_gauge ${3} ${VALUES[3]}</span> 
<br style="color:rgb(255,102,102)"> 
<span style="color:rgb(255,102,102)">                fi</span> 
<br>         ;; 
<br>          
<br>         "L") 
<br>         send_gauge ${3} $((${VALUES[3]##0} - ${VALUES[5]##0})) 
<br>         ;; 
<br>          
<br>         *) 
<br>         send_gauge ${3} -1         
<br>         ;;     
<br>     esac 
<br> } 
<br> 
<br> # Function to get the next index value 
<br> # 
<br> #    @in_param    $1 - The (optional) starting index value 
<br> #    @echo           - The new index or nothing if out of range 
<br> # 
<br> function get_next_index 
<br> { 
<br>     debug_function_enter "get_next_index" ${@} 
<br>      
<br>     # If we still have more than one element in the request array then something 
<br>     # is wrong so log an error and return 0. 
<br>     if (( $# &gt; 1 )); then 
<br>         error_echo "get_next_index: called with $# request array elements!" 
<br>         debug_function_return 
<br>         return 
<br>     fi 
<br>      
<br>     # If we were passed a starting index... 
<br>     if (( $# &gt; 0 )); then 
<br>         # If the passed index is less than the number of devices then return it +1, 
<br>         # otherwise return 0 to indicate that the index would be out of range. 
<br>         if (( ${1} &lt; ${#DEVICES[@]} )); then 
<br>             RETVAL=$(( ${1} + 1 )) 
<br>             debug_echo "next index is in range, returning ${RETVAL}" 
<br>             echo "${RETVAL}" 
<br>             debug_function_return 
<br>             return 
<br>         else 
<br>             debug_echo "next index would be out of range, returning zero" 
<br>             debug_function_return 
<br>             return 
<br>         fi 
<br>     fi     
<br>      
<br>     # If we got this far then we were not passed an index so return the first 
<br>     # available index. 
<br>     debug_echo "no index supplied, returning first index" 
<br>     echo "1" 
<br>     debug_function_return 
<br>     return 
<br> } 
<br> 
<br> # Init local vars 
<br> CMDNAME=$(basename ${0}) 
<br> CONFIG="/etc/snmpd-smartctl-connector" 
<br> DEVICES="" 
<br> CACHEDIR="" 
<br> SNMP_TRANSLATE="" 
<br> 
<br> # Read the config file if we can 
<br> [[ -r ${CONFIG} ]] &amp;&amp; source ${CONFIG} || die "Unable to read configuration file [${CONFIG}]" 
<br> 
<br> # Check for config values. 
<br> [[ -z "${DEVICES}" ]] &amp;&amp; die "No DEVICES configured in ${CONFIG}" 
<br> [[ -z "${CACHEDIR}" ]] &amp;&amp; die "No CACHEDIR configured in ${CONFIG}" 
<br> [[ ! -d "${CACHEDIR}" ]] &amp;&amp; die "Cache directory [${CACHEDIR}] is not a directory" 
<br> [[ ! -r "${CACHEDIR}" ]] &amp;&amp; die "Cache directory [${CACHEDIR}] is not readable by $(whoami)" 
<br> [[ -z "${SNMP_TRANSLATE}" ]] &amp;&amp; die "No SNMP_TRANSLATE command configured in ${CONFIG}" 
<br> 
<br> # Configure base address 
<br> BASE_MIB="SMARTCTL-MIB::smartCtl" 
<br> 
<br> # Declare the tables 
<br> RTABLE[2]="#ETABLE" 
<br>     ETABLE[1]="#FTABLE" 
<br>         FTABLE_INDEX="get_next_index"                                # Internal function to get next index 
<br>         FTABLE[1]="send_index"                                        # It is an index request. 
<br>         FTABLE[2]="send_device_path"                                 # It is for the mapped device path. 
<br>         FTABLE[3]="send_device_info 'Model Family:'"                 # It is for the device model-family. 
<br>         FTABLE[4]="send_device_info 'Device Model:'"                # It is for the device device-model. 
<br>         FTABLE[5]="send_device_info 'Serial Number:'"                 # It is for the device serial number. 
<br>         FTABLE[6]="send_device_info 'User Capacity:'"                 # It is for the device user capacity. 
<br>         FTABLE[7]="send_device_info 'ATA Version is:'"                # It is for the device ATA version. 
<br>         FTABLE[8]="send_device_hlth"                                # It is for the overall SMART health state. 
<br>         FTABLE[9]="send_device_attr 'Temperature_Celsius' R"         # It is for the device temperature. 
<br>         FTABLE[10]="send_device_attr 'Reallocated_Sector_Ct' R"     # It is for the Reallocated Sector Count of this device. 
<br>    
<span style="color:rgb(255,102,102)"> #    FTABLE[11]="send_device_attr 'Current_Pending_Sector' R"    # It is for the Current Pending Sector count of this device.</span> 
<br>         FTABLE[12]="send_device_attr 'Offline_Uncorrectable' R"     # It is for the Off-line Uncorrectable count of this device. 
<br>         FTABLE[13]="send_device_attr 'UDMA_CRC_Error_Count' R"         # It is for the UDMA CRC Error count of this device. 
<br>         FTABLE[14]="send_device_attr 'Read_Error_Rate' L"             # It is for the Read Error Rate (lifetime) of this device. 
<br>         FTABLE[15]="send_device_attr 'Seek_Error_Rate' L"             # It is for the Seek Error Rate (lifetime) of this device. 
<br>         FTABLE[16]="send_device_attr 'Hardware_ECC_Recovered' L"     # It is for the Hardware ECC recovered (lifetime) of this device. 
<br> 
<br> # Start the loop 
<br> the_loop 
<br> 
<br> 
<br>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/655cef74f92fd7790856a96f1d47c9d5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">几个不错的国外免费虚拟主机 Free host</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3dd17112297f104caea002d12388c23e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">TCP中RTT的测量和RTO的计算</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>