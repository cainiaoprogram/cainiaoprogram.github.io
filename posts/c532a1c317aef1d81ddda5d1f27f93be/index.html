<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Exynos4412 移植针对Samsung的Linux-6.1（二）SD卡驱动——解决无法挂载SD卡的根文件系统 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Exynos4412 移植针对Samsung的Linux-6.1（二）SD卡驱动——解决无法挂载SD卡的根文件系统" />
<meta property="og:description" content="系列文章目录 Exynos4412 移植针对Samsung的Linux-6.1（一）下载、配置、编译Linux-6.1Exynos4412 移植针对Samsung的Linux-6.1（二）SD卡驱动——解决无法挂载SD卡的根文件系统Exynos4412 移植针对Samsung的Linux-6.1（三）SD卡驱动——解决mmc0: Timeout waiting for hardware interrupt.Exynos4412 移植针对Samsung的Linux-6.1（四）NandFlash卡驱动Exynos4412 移植针对Samsung的Linux-6.1（五）DM9000网卡驱动 Exynos4412 移植针对Samsung的Linux-6.1（二）SD卡驱动 系列文章目录1、检查Linux内核的配置2、修改设备树3、解决无法挂载SD卡的根文件系统 Linux对于SD的支持是很全面的、很完善的。按道理来说，移植SD卡应该很简单。但是，我在移植SD卡驱动的时候，碰到了2个问题：
加载SDMMC驱动正常，但是无法发现SD卡无法挂载SD卡上的根文件系统 解决以上问题仍然花费了很长时间解决问题。问题的解决，关键是对设备树的修改。现记录下来，供大家参考以避坑。
由电路图可以看出，SD卡用到了CLK、CMD、DATA和CD这4类引脚。WP引脚是写保护，电路上是接地的，根本就不起作用。我这次出问题，就出在CD这个引脚上。CD引脚是用来检测是否插入SD卡的，当SD卡插入时引脚电平会被拉低。
另外，开发板上是接到了SDMMC2控制器上。
1、检查Linux内核的配置 执行了make exynos_defconfig之后，默认是配置加载SDMMC驱动的。但是，还是检查一下为好。有2个地方，一是Device Drivers ；另一个是File systems,要想支持中文还得选上Simplified Chinese charset 。
Device Drivers —&gt;
&lt;*&gt; MMC/SD/SDIO card support —&gt;
&lt; &gt; ARM AMBA Multimedia Card Interface support
&lt;*&gt; Secure Digital Host Controller Interface support
&lt; &gt; SDHCI platform and OF driver helper
&lt;*&gt; SDHCI support on Samsung S3C/S5P/Exynos SoC
[*] DMA support on S3C SDHCI" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c532a1c317aef1d81ddda5d1f27f93be/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-30T09:51:37+08:00" />
<meta property="article:modified_time" content="2023-01-30T09:51:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Exynos4412 移植针对Samsung的Linux-6.1（二）SD卡驱动——解决无法挂载SD卡的根文件系统</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>系列文章目录</h2> 
<ul><li><a href="https://blog.csdn.net/weixin_42408707/article/details/128569616">Exynos4412 移植针对Samsung的Linux-6.1（一）下载、配置、编译Linux-6.1</a></li><li><a href="https://blog.csdn.net/weixin_42408707/article/details/128624534">Exynos4412 移植针对Samsung的Linux-6.1（二）SD卡驱动——解决无法挂载SD卡的根文件系统</a></li><li><a href="https://blog.csdn.net/weixin_42408707/article/details/128702851">Exynos4412 移植针对Samsung的Linux-6.1（三）SD卡驱动——解决mmc0: Timeout waiting for hardware interrupt.</a></li><li><a href="https://blog.csdn.net/weixin_42408707/article/details/128632393">Exynos4412 移植针对Samsung的Linux-6.1（四）NandFlash卡驱动</a></li><li><a href="https://blog.csdn.net/weixin_42408707/article/details/128702911">Exynos4412 移植针对Samsung的Linux-6.1（五）DM9000网卡驱动</a></li></ul> 
<hr> 
<p></p> 
<div class="toc"> 
 <h4>Exynos4412 移植针对Samsung的Linux-6.1（二）SD卡驱动</h4> 
 <ul><li><a href="#_0" rel="nofollow">系列文章目录</a></li><li><a href="#1Linux_23" rel="nofollow">1、检查Linux内核的配置</a></li><li><a href="#2_48" rel="nofollow">2、修改设备树</a></li><li><a href="#3SD_184" rel="nofollow">3、解决无法挂载SD卡的根文件系统</a></li></ul> 
</div> 
<p></p> 
<p>Linux对于SD的支持是很全面的、很完善的。按道理来说，移植SD卡应该很简单。但是，我在移植SD卡驱动的时候，碰到了2个问题：</p> 
<blockquote> 
 <ol><li>加载SDMMC驱动正常，但是无法发现SD卡</li><li>无法挂载SD卡上的根文件系统</li></ol> 
</blockquote> 
<p>解决以上问题仍然花费了很长时间解决问题。问题的解决，关键是对设备树的修改。现记录下来，供大家参考以避坑。</p> 
<p><img src="https://images2.imgbox.com/63/18/Numruw8y_o.png" alt="在这里插入图片描述"><br> 由电路图可以看出，SD卡用到了CLK、CMD、DATA和CD这4类引脚。WP引脚是写保护，电路上是接地的，根本就不起作用。我这次出问题，就出在CD这个引脚上。CD引脚是用来检测是否插入SD卡的，当SD卡插入时引脚电平会被拉低。<br> 另外，开发板上是接到了SDMMC2控制器上。</p> 
<h2><a id="1Linux_23"></a>1、检查Linux内核的配置</h2> 
<p>执行了<code>make exynos_defconfig</code>之后，默认是配置加载SDMMC驱动的。但是，还是检查一下为好。有2个地方，一是Device Drivers ；另一个是File systems,要想支持中文还得选上Simplified Chinese charset 。</p> 
<ul><li> <p>Device Drivers —&gt;<br>        &lt;*&gt; MMC/SD/SDIO card support —&gt;<br>               &lt; &gt; ARM AMBA Multimedia Card Interface support<br>               &lt;*&gt; Secure Digital Host Controller Interface support<br>                      &lt; &gt; SDHCI platform and OF driver helper<br>                     &lt;*&gt; SDHCI support on Samsung S3C/S5P/Exynos SoC<br>               [*] DMA support on S3C SDHCI<br>               &lt; &gt; MMC/SD/SDIO over SPI<br>               &lt;*&gt; Synopsys DesignWare Memory Card Interface</p> </li><li> <p>File systems —&gt;<br>        [ ] Validate filesystem parameter description<br>        &lt;*&gt; Second extended fs support<br>        [ ] Ext2 extended attributes<br>        &lt; &gt; The Extended 3 (ext3) filesystem<br>        &lt;*&gt; The Extended 4 (ext4) filesystem<br>        -*- Native language support —&gt;<br>               &lt;*&gt; Simplified Chinese charset (CP936, GB2312)<br>               &lt;*&gt; NLS UTF-8</p> </li></ul> 
<h2><a id="2_48"></a>2、修改设备树</h2> 
<p>SDMMC设备树的写法，根据开发板的不同，有不同的写法。</p> 
<ul><li>例1：来自<a href="https://www.cnblogs.com/pengdonglin137/p/5159032.html" rel="nofollow">基于tiny4412的Linux内核移植 – SD卡驱动移植（五）</a> 。这篇博文中，目标板是tiny4412，作者碰到了问题：</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>    <span class="token number">2.245838</span><span class="token punctuation">]</span> s3c-sdhci <span class="token number">12530000</span>.sdhci: No vmmc regulator found
<span class="token punctuation">[</span>    <span class="token number">2.251358</span><span class="token punctuation">]</span> s3c-sdhci <span class="token number">12530000</span>.sdhci: No vqmmc regulator found
</code></pre> 
<p>原因是设备树中没有为sdhc2设置vmmc或者vqmmc。这两个是关于regulator的。该作者采用的设备树如下：</p> 
<pre><code>        regulators {
                compatible = "simple-bus";
                #address-cells = &lt;1&gt;;
                #size-cells = &lt;0&gt;;
 
                mmc_reg: regulator@0 {
                        compatible = "regulator-fixed";
                        reg = &lt;0&gt;;
                        regulator-name = "VMEM_VDD_2.8V";
                        regulator-min-microvolt = &lt;2800000&gt;;
                        regulator-max-microvolt = &lt;2800000&gt;;
                        enable-active-high;
                };
        };
        
&amp;sdhci_2 {
        bus-width = &lt;4&gt;;
        pinctrl-0 = &lt;&amp;sd2_clk &amp;sd2_cmd &amp;sd2_cd &amp;sd2_bus4&gt;;
        pinctrl-names = "default";
        vmmc-supply = &lt;&amp;mmc_reg&gt;;			
        status = "okay";
        //status = "disabled";
};
</code></pre> 
<p>regulator与电源管理有关。但是，我的开发板上没有电源管理芯片，所以这样的写法复制到我的dts文件中，会语法错误，编译不通过。</p> 
<ul><li>例2：Documentation/devicetree/bindings/mmc/samsung,s3c6410-sdhci.yaml<br> 帮助文档的示例如下：</li></ul> 
<pre><code class="prism language-bash"> <span class="token number">66</span>     <span class="token comment">#include &lt;dt-bindings/clock/exynos4.h&gt;</span>
 <span class="token number">67</span>     <span class="token comment">#include &lt;dt-bindings/gpio/gpio.h&gt;</span>
 <span class="token number">68</span>     <span class="token comment">#include &lt;dt-bindings/interrupt-controller/arm-gic.h&gt;</span>
 <span class="token number">69</span> 
 <span class="token number">70</span>     mmc@12510000 <span class="token punctuation">{<!-- --></span>
 <span class="token number">71</span>         compatible <span class="token operator">=</span> <span class="token string">"samsung,exynos4210-sdhci"</span><span class="token punctuation">;</span>
 <span class="token number">72</span>         reg <span class="token operator">=</span> <span class="token operator">&lt;</span>0x12510000 0x10<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span><span class="token punctuation">;</span>
 <span class="token number">73</span>         interrupts <span class="token operator">=</span> <span class="token operator">&lt;</span>GIC_SPI <span class="token number">73</span> IRQ_TYPE_LEVEL_HIGH<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 <span class="token number">74</span>         clocks <span class="token operator">=</span> <span class="token operator">&lt;&amp;</span>clock CLK_SDMMC<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span>, <span class="token operator">&lt;&amp;</span>clock CLK_SCLK_MMC<span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span><span class="token punctuation">;</span>
 <span class="token number">75</span>         clock-names <span class="token operator">=</span> <span class="token string">"hsmmc"</span>, <span class="token string">"mmc_busclk.2"</span><span class="token punctuation">;</span>
 <span class="token number">76</span>         bus-width <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator"><span class="token file-descriptor important">4</span>&gt;</span><span class="token punctuation">;</span>
 <span class="token number">77</span>         cd-gpios <span class="token operator">=</span> <span class="token operator">&lt;&amp;</span>gpx3 <span class="token number">4</span> GPIO_ACTIVE_LOW<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 <span class="token number">78</span>         pinctrl-0 <span class="token operator">=</span> <span class="token operator">&lt;&amp;</span>sd2_clk <span class="token operator">&amp;</span>sd2_cmd <span class="token operator">&amp;</span>sd2_bus4 <span class="token operator">&amp;</span>sdhci2_cd<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 <span class="token number">79</span>         pinctrl-names <span class="token operator">=</span> <span class="token string">"default"</span><span class="token punctuation">;</span>
 <span class="token number">80</span>         vmmc-supply <span class="token operator">=</span> <span class="token operator">&lt;&amp;</span>ldo21_reg<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 <span class="token number">81</span>     <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>以上第70 ~ 75行，在arch/arm/boot/dts/exynos4.dtsi中已经有了，只需要引用<code>exynos4.dtsi</code>就可以。可以看出，例子中添加了第77~80行的属性。<br> 我按照上述属性修改我的设备树，如下：</p> 
<pre><code class="prism language-bash"> <span class="token number">77</span> /* SD card deviceTree <span class="token function">node</span>
 <span class="token number">78</span>  * sdhci_2: sdhci@12530000
 <span class="token number">79</span> */
 <span class="token number">80</span> <span class="token operator">&amp;</span>sdhci_2 <span class="token punctuation">{<!-- --></span>
 <span class="token number">81</span>     pinctrl-0 <span class="token operator">=</span> <span class="token operator">&lt;&amp;</span>sd2_clk <span class="token operator">&amp;</span>sd2_cmd <span class="token operator">&amp;</span>sd2_bus4 <span class="token operator">&amp;</span>sd2_cd<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 <span class="token number">82</span>     pinctrl-names <span class="token operator">=</span> <span class="token string">"default"</span><span class="token punctuation">;</span>
 <span class="token number">83</span>     samsung,bus-width <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator"><span class="token file-descriptor important">4</span>&gt;</span><span class="token punctuation">;</span>
 <span class="token number">84</span>     samsung,timing <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1</span> <span class="token number">2</span> <span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span><span class="token punctuation">;</span>
 <span class="token number">85</span>     cd-gpios <span class="token operator">=</span> <span class="token operator">&lt;&amp;</span>gpk2 <span class="token number">2</span> <span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span><span class="token punctuation">;</span>
 <span class="token number">86</span>     wp-gpios <span class="token operator">=</span> <span class="token operator">&lt;&amp;</span>gpx0 <span class="token number">5</span> <span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span><span class="token punctuation">;</span>
 <span class="token number">87</span>     status <span class="token operator">=</span> <span class="token string">"okay"</span><span class="token punctuation">;</span>
 <span class="token number">88</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>虽然dts编译通过了，但是Linux启动时，显示加载了驱动，但是没有找到SD卡。</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>    <span class="token number">2.277294</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T9<span class="token punctuation">]</span> of_get_named_gpiod_flags: parsed <span class="token string">'cd-gpios'</span> property of <span class="token function">node</span> <span class="token string">'/soc/mmc@12530000[0]'</span> - status <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">2.294318</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T9<span class="token punctuation">]</span> s3c-sdhci <span class="token number">12530000</span>.mmc: clock <span class="token builtin class-name">source</span> <span class="token number">2</span>: mmc_busclk.2 <span class="token punctuation">(</span><span class="token number">20000000</span> Hz<span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">2.308484</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T9<span class="token punctuation">]</span> s3c-sdhci <span class="token number">12530000</span>.mmc: GPIO lookup <span class="token keyword">for</span> consumer <span class="token builtin class-name">cd</span>
<span class="token punctuation">[</span>    <span class="token number">2.319385</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T9<span class="token punctuation">]</span> s3c-sdhci <span class="token number">12530000</span>.mmc: using device tree <span class="token keyword">for</span> GPIO lookup
<span class="token punctuation">[</span>    <span class="token number">2.326584</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T9<span class="token punctuation">]</span> of_get_named_gpiod_flags: parsed <span class="token string">'cd-gpios'</span> property of <span class="token function">node</span> <span class="token string">'/soc/mmc@12530000[0]'</span> - status <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">2.342686</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T9<span class="token punctuation">]</span> gpio_stub_drv gpiochip15: Persistence not supported <span class="token keyword">for</span> GPIO <span class="token number">2</span>
<span class="token punctuation">[</span>    <span class="token number">2.354581</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T9<span class="token punctuation">]</span> s3c-sdhci <span class="token number">12530000</span>.mmc: Got CD GPIO
<span class="token punctuation">[</span>    <span class="token number">2.364380</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T9<span class="token punctuation">]</span> s3c-sdhci <span class="token number">12530000</span>.mmc: GPIO lookup <span class="token keyword">for</span> consumer wp
<span class="token punctuation">[</span>    <span class="token number">2.377609</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T9<span class="token punctuation">]</span> s3c-sdhci <span class="token number">12530000</span>.mmc: using device tree <span class="token keyword">for</span> GPIO lookup
<span class="token punctuation">[</span>    <span class="token number">2.390432</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T9<span class="token punctuation">]</span> of_get_named_gpiod_flags: parsed <span class="token string">'wp-gpios'</span> property of <span class="token function">node</span> <span class="token string">'/soc/mmc@12530000[0]'</span> - status <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span>    <span class="token number">2.400806</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T9<span class="token punctuation">]</span> gpio_stub_drv gpiochip32: Persistence not supported <span class="token keyword">for</span> GPIO <span class="token number">5</span>
<span class="token punctuation">[</span>    <span class="token number">2.416815</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T9<span class="token punctuation">]</span> s3c-sdhci <span class="token number">12530000</span>.mmc: Got WP GPIO
<span class="token punctuation">[</span>    <span class="token number">2.466252</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T9<span class="token punctuation">]</span> mmc0: SDHCI controller on samsung-hsmmc <span class="token punctuation">[</span><span class="token number">12530000</span>.mmc<span class="token punctuation">]</span> using ADMA
</code></pre> 
<p>其中，有2行错误</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>    <span class="token number">2.342686</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T9<span class="token punctuation">]</span> gpio_stub_drv gpiochip15: Persistence not supported <span class="token keyword">for</span> GPIO <span class="token number">2</span>
<span class="token punctuation">[</span>    <span class="token number">2.400806</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T9<span class="token punctuation">]</span> gpio_stub_drv gpiochip32: Persistence not supported <span class="token keyword">for</span> GPIO <span class="token number">5</span>
</code></pre> 
<p>第一行针对<code>cd-gpios = &lt;&amp;gpk2 2 0&gt;;</code>，第二行针对<code>wp-gpios = &lt;&amp;gpx0 5 0&gt;;</code>。查找Linux-6.1的源码，<code>Persistence not supported</code>代表的含义是pin的状态是睡眠或者控制器重置。</p> 
<blockquote> 
 <p>@PIN_CONFIG_PERSIST_STATE: retain pin state across sleep or controller reset</p> 
</blockquote> 
<p>后来，我受到启发，想到可能是cd-gpios的属性设置不正确，于是把第85行cd-gpios属性注释掉，问题就解决了。CBT4412开发板的可行SDMMC设备树如下：</p> 
<pre><code class="prism language-bash"> <span class="token number">77</span> /* SD card deviceTree <span class="token function">node</span>
 <span class="token number">78</span>  * sdhci_2: sdhci@12530000
 <span class="token number">79</span> */
 <span class="token number">80</span> <span class="token operator">&amp;</span>sdhci_2 <span class="token punctuation">{<!-- --></span>
 <span class="token number">81</span>     pinctrl-0 <span class="token operator">=</span> <span class="token operator">&lt;&amp;</span>sd2_clk <span class="token operator">&amp;</span>sd2_cmd <span class="token operator">&amp;</span>sd2_bus4 <span class="token operator">&amp;</span>sd2_cd<span class="token operator">&gt;</span><span class="token punctuation">;</span>
 <span class="token number">82</span>     pinctrl-names <span class="token operator">=</span> <span class="token string">"default"</span><span class="token punctuation">;</span>
 <span class="token number">83</span>     samsung,bus-width <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token operator"><span class="token file-descriptor important">4</span>&gt;</span><span class="token punctuation">;</span>
 <span class="token number">84</span>     samsung,timing <span class="token operator">=</span> <span class="token operator">&lt;</span><span class="token number">1</span> <span class="token number">2</span> <span class="token operator"><span class="token file-descriptor important">3</span>&gt;</span><span class="token punctuation">;</span>
 <span class="token number">85</span>     //  cd-gpios <span class="token operator">=</span> <span class="token operator">&lt;&amp;</span>gpk2 <span class="token number">2</span> <span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span><span class="token punctuation">;</span>
 <span class="token number">86</span>     wp-gpios <span class="token operator">=</span> <span class="token operator">&lt;&amp;</span>gpx0 <span class="token number">5</span> <span class="token operator"><span class="token file-descriptor important">0</span>&gt;</span><span class="token punctuation">;</span>
 <span class="token number">87</span>     status <span class="token operator">=</span> <span class="token string">"okay"</span><span class="token punctuation">;</span>
 <span class="token number">88</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>Linux启动结果：</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>    <span class="token number">2.465081</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T9<span class="token punctuation">]</span> mmc0: SDHCI controller on samsung-hsmmc <span class="token punctuation">[</span><span class="token number">12530000</span>.mmc<span class="token punctuation">]</span> using ADMA

<span class="token punctuation">[</span>    <span class="token number">2.700852</span><span class="token punctuation">]</span><span class="token punctuation">[</span>   T35<span class="token punctuation">]</span> mmc0: new high speed SD card at address 0002
<span class="token punctuation">[</span>    <span class="token number">2.732352</span><span class="token punctuation">]</span><span class="token punctuation">[</span>   T35<span class="token punctuation">]</span> mmcblk0: mmc0:0002       <span class="token number">968</span> MiB 
<span class="token punctuation">[</span>    <span class="token number">2.732992</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T1<span class="token punctuation">]</span> /dev/root: Can't <span class="token function">open</span> blockdev
<span class="token punctuation">[</span>    <span class="token number">2.739237</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T1<span class="token punctuation">]</span> VFS: Cannot <span class="token function">open</span> root device <span class="token string">"mmcblk0p3"</span> or unknown-block<span class="token punctuation">(</span><span class="token number">0,0</span><span class="token punctuation">)</span>: error <span class="token parameter variable">-6</span>
<span class="token punctuation">[</span>    <span class="token number">2.742335</span><span class="token punctuation">]</span><span class="token punctuation">[</span>   T35<span class="token punctuation">]</span>  mmcblk0: p1 p2 p3
<span class="token punctuation">[</span>    <span class="token number">2.880395</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T1<span class="token punctuation">]</span>  driver: mmcblk
<span class="token punctuation">[</span>    <span class="token number">2.888522</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T1<span class="token punctuation">]</span>   b301           <span class="token number">10240</span> mmcblk0p1 c5a42637-01
<span class="token punctuation">[</span>    <span class="token number">2.888534</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T1<span class="token punctuation">]</span> 
<span class="token punctuation">[</span>    <span class="token number">2.896680</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T1<span class="token punctuation">]</span>   b302          <span class="token number">614400</span> mmcblk0p2 c5a42637-02
<span class="token punctuation">[</span>    <span class="token number">2.896691</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T1<span class="token punctuation">]</span> 
<span class="token punctuation">[</span>    <span class="token number">2.904839</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T1<span class="token punctuation">]</span>   b303          <span class="token number">363008</span> mmcblk0p3 c5a42637-03
<span class="token punctuation">[</span>    <span class="token number">2.904850</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T1<span class="token punctuation">]</span> 
<span class="token punctuation">[</span>    <span class="token number">2.913065</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T1<span class="token punctuation">]</span> Kernel panic - not syncing: VFS: Unable to <span class="token function">mount</span> root fs on unknown-block<span class="token punctuation">(</span><span class="token number">0,0</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="3SD_184"></a>3、解决无法挂载SD卡的根文件系统</h2> 
<p>此时，无法完全启动Linux，显示无法挂载SD卡上的根文件系统</p> 
<pre><code class="prism language-bash">Kernel panic - not syncing: VFS: Unable to <span class="token function">mount</span> root fs on unknown-block<span class="token punctuation">(</span><span class="token number">0,0</span><span class="token punctuation">)</span>
</code></pre> 
<p>原因是挂载根文件系统太早了，此时SD卡还没有挂载完成。<br> 解决方法也很简单，修改BootLoader的启动参数，增加<code>rootwait</code>就可以。如下：</p> 
<pre><code class="prism language-bash">setenv bootargs <span class="token assign-left variable">root</span><span class="token operator">=</span>/dev/mmcblk0p3  rw <span class="token assign-left variable">rootfstype</span><span class="token operator">=</span>ext4 <span class="token assign-left variable">init</span><span class="token operator">=</span>/linuxrc <span class="token assign-left variable">console</span><span class="token operator">=</span>ttySAC0,115200n8 rootwait
</code></pre> 
<p>启动结果如下：</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>    <span class="token number">2.699872</span><span class="token punctuation">]</span><span class="token punctuation">[</span>   T35<span class="token punctuation">]</span> mmc0: new high speed SD card at address 0002
<span class="token punctuation">[</span>    <span class="token number">2.729229</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T1<span class="token punctuation">]</span> Waiting <span class="token keyword">for</span> root device /dev/mmcblk0p3<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>    <span class="token number">2.730965</span><span class="token punctuation">]</span><span class="token punctuation">[</span>   T35<span class="token punctuation">]</span> mmcblk0: mmc0:0002       <span class="token number">968</span> MiB 
<span class="token punctuation">[</span>    <span class="token number">2.746932</span><span class="token punctuation">]</span><span class="token punctuation">[</span>   T35<span class="token punctuation">]</span>  mmcblk0: p1 p2 p3
<span class="token punctuation">[</span>    <span class="token number">3.311368</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T1<span class="token punctuation">]</span> EXT4-fs <span class="token punctuation">(</span>mmcblk0p3<span class="token punctuation">)</span>: recovery complete
<span class="token punctuation">[</span>    <span class="token number">3.314494</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T1<span class="token punctuation">]</span> EXT4-fs <span class="token punctuation">(</span>mmcblk0p3<span class="token punctuation">)</span>: mounted filesystem with ordered data mode. Quota mode: disabled.
<span class="token punctuation">[</span>    <span class="token number">3.314748</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T1<span class="token punctuation">]</span> VFS: Mounted root <span class="token punctuation">(</span>ext4 filesystem<span class="token punctuation">)</span> on device <span class="token number">179</span>:3.
<span class="token punctuation">[</span>    <span class="token number">3.316175</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T1<span class="token punctuation">]</span> devtmpfs: mounted
<span class="token punctuation">[</span>    <span class="token number">3.317624</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T1<span class="token punctuation">]</span> Freeing unused kernel image <span class="token punctuation">(</span>initmem<span class="token punctuation">)</span> memory: 1024K
<span class="token punctuation">[</span>    <span class="token number">3.321581</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T1<span class="token punctuation">]</span> Run /linuxrc as init process
<span class="token punctuation">[</span>    <span class="token number">3.325766</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T1<span class="token punctuation">]</span>   with arguments:
<span class="token punctuation">[</span>    <span class="token number">3.329340</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T1<span class="token punctuation">]</span>     /linuxrc
<span class="token punctuation">[</span>    <span class="token number">3.332590</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T1<span class="token punctuation">]</span>   with environment:
<span class="token punctuation">[</span>    <span class="token number">3.336371</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T1<span class="token punctuation">]</span>     <span class="token assign-left variable"><span class="token environment constant">HOME</span></span><span class="token operator">=</span>/
<span class="token punctuation">[</span>    <span class="token number">3.339408</span><span class="token punctuation">]</span><span class="token punctuation">[</span>    T1<span class="token punctuation">]</span>     <span class="token assign-left variable"><span class="token environment constant">TERM</span></span><span class="token operator">=</span>linux
can<span class="token string">'t run '</span>/etc/init.d/rcS': No such <span class="token function">file</span> or directory

Please press Enter to activate this console. 
/ <span class="token comment"># ls</span>
bin         etc.old     linuxrc     proc        tmp
dev         home        mk_mod_.sh  sbin        usr
etc         lib         mnt         sys         var
/ <span class="token comment"># </span>
</code></pre> 
<p>至此，SD卡移植完成。总结一下：</p> 
<ol><li>还是要仔细分析错误信息</li><li>一般来说，Linux的驱动已经比较完善，出错还是首先看看设备树的写法是否有误，可以结合compatible查看驱动程序中查看需要设置哪些属性。</li></ol> 
<p>你还有什么启发，请评论区留言。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/46012f5dbba3237e4492837aecd4c61f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">函数间参数传递的3种方式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2ddd0f5b701c8fc45688698cf7e36737/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MATLAB-自动控制原理-时域分析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>