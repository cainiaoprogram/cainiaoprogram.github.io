<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ES常用查询命令 - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ES常用查询命令" />
<meta property="og:description" content="一、基本命令
1、获取所有_cat命令
curl -X GET localhost:9200/_cat 2、获取es集群服务健康状态
curl -X GET localhost:9200/_cat/health?v epoch: 时间戳的 Unix 时间戳格式，表示快照生成的时间。
timestamp: 可读性更强的时间戳格式，表示快照生成的时间（08:06:34）。
cluster: Elasticsearch 集群的名称，这里是 &#34;es-cluster&#34;。
status: 集群的健康状态，这里是 &#34;yellow&#34;。Elasticsearch 集群状态通常有三种：green（绿色，健康），yellow（黄色，部分健康），red（红色，不健康）。&#34;yellow&#34; 状态表示集群中的某些副本不可用，但主分片是可用的。
node.total: 集群中节点的总数，这里是 1 个节点。
node.data: 充当数据节点的节点数，这里是 1 个节点。
shards: 集群中分片的总数，这里是 98 个分片。
pri: 主分片（primary shard）的数量，这里是 98 个主分片。
relo: 正在进行重新定位的分片数量，这里是 0。
init: 初始化的分片数量，这里是 0。
unassign: 未分配的分片数量，这里是 27。
pending_tasks: 挂起的任务数，这里是 0。
max_task_wait_time: 最大任务等待时间，这里是没有具体数值。
active_shards_percent: 活动分片的百分比，这里是 78.4%。这表示在集群中，有 78.4% 的分片是活动的，而剩下的可能是不可用或者正在恢复的。
3、查看es节点信息
curl -X GET localhost:9200/_cat/nodes?v ip: 节点的IP地址，这里是&#34;192.168.52.11&#34;。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/c7d43833c1d15d981649390537f7b771/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-10T14:40:46+08:00" />
<meta property="article:modified_time" content="2023-11-10T14:40:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ES常用查询命令</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><br> 一、基本命令<br> 1、获取所有_cat命令</p> 
<pre><code class="hljs">curl -X GET localhost:9200/_cat</code></pre> 
<p>2、获取es集群服务健康状态</p> 
<pre><code class="hljs">curl -X GET localhost:9200/_cat/health?v</code></pre> 
<p>epoch: 时间戳的 Unix 时间戳格式，表示快照生成的时间。<br> timestamp: 可读性更强的时间戳格式，表示快照生成的时间（08:06:34）。<br> cluster: Elasticsearch 集群的名称，这里是 "es-cluster"。<br> status: 集群的健康状态，这里是 "yellow"。Elasticsearch 集群状态通常有三种：green（绿色，健康），yellow（黄色，部分健康），red（红色，不健康）。"yellow" 状态表示集群中的某些副本不可用，但主分片是可用的。<br> node.total: 集群中节点的总数，这里是 1 个节点。<br> node.data: 充当数据节点的节点数，这里是 1 个节点。<br> shards: 集群中分片的总数，这里是 98 个分片。<br> pri: 主分片（primary shard）的数量，这里是 98 个主分片。<br> relo: 正在进行重新定位的分片数量，这里是 0。<br> init: 初始化的分片数量，这里是 0。<br> unassign: 未分配的分片数量，这里是 27。<br> pending_tasks: 挂起的任务数，这里是 0。<br> max_task_wait_time: 最大任务等待时间，这里是没有具体数值。<br> active_shards_percent: 活动分片的百分比，这里是 78.4%。这表示在集群中，有 78.4% 的分片是活动的，而剩下的可能是不可用或者正在恢复的。<br> 3、查看es节点信息</p> 
<pre><code class="hljs">curl -X GET localhost:9200/_cat/nodes?v</code></pre> 
<p>ip: 节点的IP地址，这里是"192.168.52.11"。<br> heap.percent: 节点的堆内存使用百分比，这里是67%。<br> ram.percent: 节点的系统内存使用百分比，这里是98%。<br> cpu: 节点的CPU使用率，这里是10%。<br> load_1m: 1分钟负载平均值，这里是0.69。<br> load_5m: 5分钟负载平均值，这里是0.36。<br> load_15m: 15分钟负载平均值，这里是0.50。<br> node.role: 节点的角色，这里是"*"，表示这是一个主节点（master node）。<br> master: 指示该节点是否是主节点，这里是"*"，表示它是主节点。<br> name: 节点的名称，这里是"node-1"。<br> 4、查看es指定节点信息</p> 
<pre><code class="hljs">curl -X GET localhost:9200/_nodes/node-1?pretty=true</code></pre> 
<p>二、索引操作<br> 1、查看ES中所有的索引</p> 
<pre><code class="hljs">curl -X GET localhost:9200/_cat/indices?v</code></pre> 
<p>health: 索引的健康状态，这里是 "yellow"。Elasticsearch 索引的健康状态有三种：green（绿色，健康），yellow（黄色，部分健康），red（红色，不健康）。"yellow" 状态表示索引的某些分片处于未分配状态，但主分片是可用的。<br> status: 索引的状态，这里是 "open"。这表示索引处于打开状态，可以进行读取和写入操作。<br> index: 索引的名称，这里是 "nginx-access-log-2023.09.13"。<br> uuid: 索引的唯一标识符。<br> pri: 主分片（primary shard）的数量，这里是 1 个主分片。<br> rep: 副本分片（replica shard）的数量，这里也是 1 个副本分片。<br> docs.count: 索引中文档的总数，这里是 20。<br> docs.deleted: 索引中已删除的文档数量，这里是 0。<br> store.size: 索引的存储大小，这里是 34.1KB。<br> pri.store.size: 主分片的存储大小，这里也是 34.1KB。<br> 2、新建索引</p> 
<pre><code class="hljs">curl -X PUT localhost:9200/testyf</code></pre> 
<p>3、新建索引并增加数据 POST /索引/端点</p> 
<pre><code class="hljs">POST /data/_bulk
{ "index": { "_id": 1 }}
{ "articleID" : "XHDK-A-1293-#fJ3", "userID" : 1, "hidden": false, "postDate": "2022-01-01" }
{ "index": { "_id": 2 }}
{ "articleID" : "KDKE-B-9947-#kL5", "userID" : 1, "hidden": false, "postDate": "2022-01-02" }</code></pre> 
<p>4、追加数据<br> # 追加新增字段</p> 
<pre><code class="hljs">POST /data/_bulk
{"update":{"_id":"1"}}
{"doc":{"title":"this is java and elasticsearch blog"}}</code></pre> 
<p>5、删除索引</p> 
<pre><code class="hljs">curl -X DELETE localhost:9200/testyf</code></pre> 
<p>6、查看指定索引信息</p> 
<pre><code class="hljs">curl -X GET localhost:9200/nginx-access-log-2023.09.13?pretty</code></pre> 
<p>7、查看索引的统计信息</p> 
<pre><code class="hljs">curl -X GET localhost:9200/nginx-access-log-2023.09.13/_stats?pretty</code></pre> 
<p>三、文档操作<br> 一）查询索引中的全部文档</p> 
<pre><code class="hljs">curl -X GET localhost:9200/nginx-access-log-2023.09.13/_search?pretty</code></pre> 
<p>注意：?pertty 表示让数据格式化，更好的展示</p> 
<p> 2）根据条件查询索引中的文档<br> 单一条件搜索：<br> 1、搜索 response_code 包含 200</p> 
<pre><code class="hljs">POST /nginx-access-log-2023.09.13/_search?pretty
{
  "query": {
    "match": {
      "response_code": "200"
    }
  }
}</code></pre> 
<p>2、搜索 message 包含 34 或者 包含 36</p> 
<pre><code class="hljs">POST /nginx-access-log-2023.09.25/_search?pretty
{
  "query": {
    "match": {
      "message": "34 36"
    }
  },
  "size": 1000
}</code></pre> 
<p>3、搜索 message 包含 34 并且 包含 36</p> 
<pre><code class="hljs">POST /nginx-access-log-2023.09.25/_search?pretty
{
  "query": { 
    "match": { 
      "message": {
        "query": "34 36",
        "operator": "and"
      }
    } 
  },
  "size": 1000
}</code></pre> 
<p><br> 4、搜索 message 包含 34 36 15 22 中超过 50% 以上比例的</p> 
<pre><code class="hljs">POST /nginx-access-log-2023.09.25/_search?pretty
{
  "query": { 
    "match": { 
      "message": {
        "query": "34 36 15 22",
        "minimum_should_match": "50%"
      }
    } 
  },
  "size": 1000
}</code></pre> 
<p><br> 5、使用sort对查询数据排序，并按照size返回查询的数量（desc：降序 / asc：升序）</p> 
<pre><code class="hljs">GET /data/_search?size=2
{
  "query": {
    "match": {
      "title": "java elasticsearch"
    }
  },
  "sort": {
    "postDate": {
      "order": "desc"
    }
  }
}</code></pre> 
<p>多条件搜索：<br> 1、（&amp;&amp;使用 must ）搜索 response_code 包含 200，并且 @timestamp 包含 "2023-09-25T12:43:46.000Z"</p> 
<pre><code class="hljs">POST /nginx-access-log-2023.09.25/_search?pretty
{
    "query": {
        "bool": {
            "must": [{
                "match": {
                    "response_code": "200"
                }
            },{
                "match": {
                    "@timestamp": "2023-09-25T12:43:46.000Z"
                }
            }]
        }
    },
    "size": 100
}</code></pre> 
<p>2、（|| 使用 should ）搜索 response_code 包含 200，或者 @timestamp 包含 "2023-09-25T12:43:46.000Z"</p> 
<pre><code class="hljs">POST /nginx-access-log-2023.09.25/_search?pretty
{
    "query": {
        "bool": {
            "should": [{
                "match": {
                    "response_code": "200"
                }
            },{
                "match": {
                    "@timestamp": "2023-09-25T12:43:46.000Z"
                }
            }]
        }
    },
    "size": 100
}</code></pre> 
<p> 3、（|| 使用 should ）搜索 response_code 包含 200，或者 @timestamp 包含 "2023-09-25T12:43:46.000Z"，或者 message 包含 "Windows"，至少满足2个以上</p> 
<pre><code class="hljs">POST /nginx-access-log-2023.09.25/_search?pretty
{
    "query": {
        "bool": {
            "should": [{
                "match": {
                    "response_code": "200"
                }
            },{
                "match": {
                    "@timestamp": "2023-09-25T12:43:46.000Z"
                }
            },{
                "match": {
                    "message": "Windows"
                }
            }],
            "minimum_should_match": 2
        }
    },
    "size": 100
}</code></pre> 
<p>4、搜索 response_code 包含 200，并且 @timestamp 不包含 "2023-09-25T12:43:46.000Z"</p> 
<pre><code class="hljs">POST /nginx-access-log-2023.09.25/_search?pretty
{
    "query": {
        "bool": {
            "must": [{
                "match": {
                    "response_code": "200"
                }
            }],
            "must_not": [{
                "match": {
                    "@timestamp": "2023-09-25T12:43:46.000Z"
                }
            }]
        }
    },
    "size": 100
}</code></pre> 
<p> 5、统计 response_code 包含 200 的有多少个</p> 
<pre><code class="hljs">POST /nginx-access-log-2023.09.25/_count?pretty
{
    "query": {
        "bool": {
            "must": [{
                "match": {
                    "response_code": "200"
                }
            }]
        }
    }
}</code></pre> 
<p> 3）转换<br> term：不分词，直接匹配字段的完整值<br> match：根据字段的分词器对搜索文本进行分词</p> 
<p>1、普通match如何转换为term+should<br> 转换前：</p> 
<pre><code class="hljs">GET /data/_search
{
  "query": {
    "match": {
      "title": "java elasticsearch"
    }
  }
}</code></pre> 
<p>转换后：</p> 
<pre><code class="hljs">GET /data/_search
{
  "query": {
    "bool": {
      "should": [
        {
          "term": {
            "title": "java"
          }
        },
        {
          "term": {
            "title": "elasticsearch"
          }
        }
      ]
    }
  }
}</code></pre> 
<p>2、and match如何转换为term+must<br> 转换前：</p> 
<pre><code class="hljs">GET /data/_search
{
  "query": {
    "match": {
      "title": {
        "query": "java elasticsearch",
        "operator": "and"
      }
    }
  }
}</code></pre> 
<p>转换后：</p> 
<pre><code class="hljs">GET /data/_search
{
  "query": {
    "bool": {
      "must": [
        {
          "term": {
            "title": "java"
          }
        },
        {
          "term": {
            "title": "elasticsearch"
          }
        }
      ]
    }
  }
}</code></pre> 
<p>3、minimum_should_match如何转换<br> 转换前：</p> 
<pre><code class="hljs">GET /data/_search
{
  "query": {
    "match": {
      "title": {
        "query": "java elasticsearch hadoop spark",
        "minimum_should_match": "75%"
      }
    }
  }
}</code></pre> 
<p>转换后：</p> 
<pre><code class="hljs">GET /data/_search
{
  "query": {
    "bool": {
      "should": [
        {
          "term": {
            "title": "java"
          }
        },
        {
          "term": {
            "title": "elasticsearch"
          }
        },
        {
          "term": {
            "title": "hadoop"
          }
        },
        {
          "term": {
            "title": "spark"
          }
        }
      ],
      "minimum_should_match": 3
    }
  }
}</code></pre> 
<p></p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/23ac87639071122871ff0867996a0a19/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python编程之定时任务(Schedule)详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e4f2a479b727c91a61e646bd0b430192/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Matter学习笔记（2）——数据模型和设备类型</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>