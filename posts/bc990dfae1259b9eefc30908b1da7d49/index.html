<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[微信小程序]聊天对话(文本,图片)的功能(完整代码附效果图) - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="[微信小程序]聊天对话(文本,图片)的功能(完整代码附效果图)" />
<meta property="og:description" content="相关文章：
1.小程序聊天群，发送语音，文字，图片。
2.微信小程序集成腾讯IM，实现实时音视频通话，1V1聊天
3.云开发微信小程序聊天群
4.接入网易云信IM即时通讯的微信小程序聊天室
5.微信小程序聊天功能 WebSocket 实现发送文字，图片，语音以及WebSocket 常见问题解决方案
6.[微信小程序]聊天对话(文本,图片)的功能(完整代码附效果图)
如果有个性化的需要修改，可以联系我的微信。
微信小程序开发交流qq群 173683895
承接微信小程序开发。扫码加微信。 正文： 这是我实际项目线上的代码, 或许有些不足 || 和你的需求不符合, 上图:
&lt;!--pages/index/to_news/to_news.wxml--&gt; &lt;view class=&#39;tab&#39;&gt; &lt;view class=&#39;lan&#39;&gt;{{tabdata.title}}&lt;/view&gt; &lt;view class=&#39;tent&#39;&gt; &lt;text&gt;{{tabdata.attribute_attribute}}&lt;/text&gt; &lt;text class=&#39;fl_r &#39;&gt;{{tabdata.num}}&lt;/text&gt; &lt;/view&gt; &lt;view class=&#39;xiahuaxian1&#39;&gt;&lt;/view&gt; &lt;view&gt; &lt;text class=&#39;fabu&#39;&gt;发布时间: {{tabdata.time_agree}}&lt;/text&gt; &lt;/view&gt; &lt;/view&gt; &lt;view class=&#39;news&#39;&gt; &lt;view class=&#39;xiahuaxian1 xiahuaxia&#39;&gt;&lt;/view&gt; &lt;view class=&#39;new_top_txt&#39;&gt;您正在与{{tabdata.nickname}}进行沟通&lt;/view&gt; &lt;view class=&#34;historycon&#34;&gt; &lt;scroll-view scroll-y=&#34;true&#34; scroll-top=&#34;{{scrollTop}}&#34; class=&#34;history&#34; wx:for=&#34;{{centendata}}&#34; wx:key=&#39;&#39;&gt; &lt;view&gt; &lt;text class=&#39;time&#39;&gt;{{item.time}}&lt;/text&gt; &lt;/view&gt; &lt;block wx:if=&#34;{{item.is_show_right ==1}}&#34;&gt; &lt;view class=&#39;my_right&#39;&gt; &lt;view class=&#39;page_row&#39;&gt; &lt;text wx:if=&#39;{{!item.is_img}}&#39; class=&#39;new_txt&#39;&gt;{{item.content}}&lt;/text&gt; &lt;image wx:if=&#39;{{item." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/bc990dfae1259b9eefc30908b1da7d49/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-12-01T17:02:37+08:00" />
<meta property="article:modified_time" content="2017-12-01T17:02:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[微信小程序]聊天对话(文本,图片)的功能(完整代码附效果图)</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>相关文章：</p> 
<p>1.<a href="https://a-jing.blog.csdn.net/article/details/104385712" rel="nofollow">小程序聊天群，发送语音，文字，图片。</a></p> 
<p>2.<a href="https://a-jing.blog.csdn.net/article/details/104660244" rel="nofollow">微信小程序集成腾讯IM，实现实时音视频通话，1V1聊天</a></p> 
<p>3.<a href="https://a-jing.blog.csdn.net/article/details/104453397" rel="nofollow">云开发微信小程序聊天群</a></p> 
<p>4.<a href="https://a-jing.blog.csdn.net/article/details/85336347" rel="nofollow">接入网易云信IM即时通讯的微信小程序聊天室</a></p> 
<p>5.<a href="https://a-jing.blog.csdn.net/article/details/84247493" rel="nofollow">微信小程序聊天功能 WebSocket 实现发送文字，图片，语音以及WebSocket 常见问题解决方案</a></p> 
<p>6.<a href="https://a-jing.blog.csdn.net/article/details/78688311" rel="nofollow">[微信小程序]聊天对话(文本,图片)的功能(完整代码附效果图)</a></p> 
<p>如果有个性化的需要修改，可以联系我的微信。</p> 
<p>微信小程序开发交流qq群   173683895</p> 
<h4><img alt="" class="has" height="260" src="https://images2.imgbox.com/f8/e2/ZX5xJHRf_o.jpg" width="260">   承接微信小程序开发。扫码加微信。</h4> 
<h4><strong>正文：</strong></h4> 
<p>这是我实际项目线上的代码, 或许有些不足 || 和你的需求不符合,  </p> 
<p>上图:</p> 
<p><img alt="" class="has" src="https://images2.imgbox.com/7a/22/8RL9CpAL_o.gif"></p> 
<p> </p> 
<pre class="has"><code class="language-html">&lt;!--pages/index/to_news/to_news.wxml--&gt;
&lt;view class='tab'&gt;
  &lt;view class='lan'&gt;{<!-- -->{tabdata.title}}&lt;/view&gt;
  &lt;view class='tent'&gt;
    &lt;text&gt;{<!-- -->{tabdata.attribute_attribute}}&lt;/text&gt;
    &lt;text class='fl_r '&gt;{<!-- -->{tabdata.num}}&lt;/text&gt;
  &lt;/view&gt;
  &lt;view class='xiahuaxian1'&gt;&lt;/view&gt;
  &lt;view&gt;
    &lt;text class='fabu'&gt;发布时间: {<!-- -->{tabdata.time_agree}}&lt;/text&gt;
  &lt;/view&gt;
&lt;/view&gt;
&lt;view class='news'&gt;
  &lt;view class='xiahuaxian1 xiahuaxia'&gt;&lt;/view&gt;
  &lt;view class='new_top_txt'&gt;您正在与{<!-- -->{tabdata.nickname}}进行沟通&lt;/view&gt;
  &lt;view class="historycon"&gt;
    &lt;scroll-view scroll-y="true" scroll-top="{<!-- -->{scrollTop}}" class="history" wx:for="{<!-- -->{centendata}}" wx:key=''&gt;
      &lt;view&gt;
        &lt;text class='time'&gt;{<!-- -->{item.time}}&lt;/text&gt;
      &lt;/view&gt;
      &lt;block wx:if="{<!-- -->{item.is_show_right ==1}}"&gt;
        &lt;view class='my_right'&gt;
          &lt;view class='page_row'&gt;
            &lt;text wx:if='{<!-- -->{!item.is_img}}' class='new_txt'&gt;{<!-- -->{item.content}}&lt;/text&gt;
            &lt;image wx:if='{<!-- -->{item.is_img}}' src='http://sz800800.cn/Uploads/{<!-- -->{item.content}}' class='new_imgtent'&gt;&lt;/image&gt;
            &lt;view wx:if='{<!-- -->{!item.is_img}}' class='sanjiao my'&gt;&lt;/view&gt;
            &lt;image class='new_img' wx:if='{<!-- -->{item.show_rignt == "是自己的内容，显示在右边，右边渲染 nickname_owner，head_owner"}}' src='{<!-- -->{item.head_owner}}'&gt;&lt;/image&gt;
             &lt;image class='new_img' wx:if='{<!-- -->{item.show_rignt == "是自己的内容，显示在右边，右边渲染 nickname_open，head_open"}}' src='{<!-- -->{item.head_open}}'&gt;&lt;/image&gt;
          &lt;/view&gt;
        &lt;/view&gt;
      &lt;/block&gt;
      &lt;block wx:else&gt;
        &lt;view class='you_left'&gt;
          &lt;view class='page_row'&gt;
            &lt;image class='new_img' wx:if='{<!-- -->{item.show_rignt == "不是自己的内容，显示在左边，左边渲染 nickname_owner，head_owner"}}' src='{<!-- -->{item.head_owner}}'&gt;&lt;/image&gt;
             &lt;image class='new_img' wx:if='{<!-- -->{item.show_rignt == "不是自己的内容，显示在左边，左边渲染 nickname_open，head_open"}}' src='{<!-- -->{item.head_open}}'&gt;&lt;/image&gt;
            &lt;view wx:if='{<!-- -->{!item.is_img}}' class='sanjiao you'&gt;&lt;/view&gt;
            &lt;text wx:if='{<!-- -->{!item.is_img}}' class='new_txt'&gt;{<!-- -->{item.content}}&lt;/text&gt;
            &lt;image wx:if='{<!-- -->{item.is_img}}' src='http://sz800800.cn/Uploads/{<!-- -->{item.content}}' class='new_imgtent'&gt;&lt;/image&gt;
          &lt;/view&gt;
        &lt;/view&gt;
      &lt;/block&gt;
    &lt;/scroll-view&gt;
  &lt;/view&gt;
&lt;/view&gt;
&lt;view class='hei' id="hei"&gt;&lt;/view&gt;
&lt;view class="sendmessage"&gt;
  &lt;input type="emoji" bindinput="bindChange" confirm-type="done" value='{<!-- -->{news_input_val}}' placeholder="" /&gt;
  &lt;button catchtap="add"&gt;发送&lt;/button&gt;
  &lt;input style='display:none' type="" bindinput="bindChange" confirm-type="done" placeholder="" /&gt;
  &lt;image bindtap="upimg1" class='jia_img' src='../../../images/jia_img.png'&gt;&lt;/image&gt;
&lt;/view&gt;</code></pre> 
<p> </p> 
<pre class="has"><code class="language-javascript">// pages/index/to_news/to_news.js
var app = getApp();
var util = require("../../../utils/util.js")
var message = '';
var text = '';
var user = {};
var length;
var zx_info_id;
var openid_talk;
Page({
  data: {
    news: '',
    scrollTop: 0,
    message: '',
    text: text,
    centendata: '',
    nickName: '',
    avatarUrl: '',
    news_input_val:'',
    tabdata: ''
  },
  bindChange: function (e) {
    message = e.detail.value
  },
  //事件处理函数
  add: function (e) {
    var that = this
    var data = {
      program_id: app.jtappid,
      openid: app._openid,
      zx_info_id: zx_info_id,
      content: message,
      openid_talk:openid_talk
    }
    util.request('pg.php/ZXinfo/session_submit', 'post', data, '正在加载数据', function (res) {
      if (res.data.state == 1) {
        var a = true;
        that.loaddata(a);
        that.setData({
          news_input_val:''
        })
        message = ''
      } else {
        wx.showToast({
          title: '网络错误,请稍后',
        })
      }
    })
  },

  onLoad: function (options) {
    openid_talk = options.openid_talk;
    zx_info_id = options.zx_info_id;
    console.log(openid_talk)
    //调用应用实例的方法获取全局数据
    this.setData({
      zx_info_id: zx_info_id,
      nickName: app.nickName,
      avatarUrl: app.avatarUrl,
    });
    this.loaddata()
  },
  // 页面加载
  loaddata: function (a) {
    var that = this;
    var is_img = true;
    var data = {
      program_id: app.jtappid,
      openid: app._openid,
      zx_info_id: zx_info_id,
      openid_talk: openid_talk
    }
    util.request('pg.php/ZXinfo/session_page', 'post', data, '', function (res) {
      if (res.data.k1) {
        res.data.k1.time_agree = util.js_date_time(res.data.k1.time_agree)
      }
      for (var i = 0; i &lt; res.data.k2.length; i++) {
        res.data.k2[i].time = util.js_date_time(res.data.k2[i].time)
        var n = res.data.k2[i].content.charAt(res.data.k2[i].content.length - 1);
        switch (n) {
          case 'g':
            res.data.k2[i].is_img = is_img
            break;
          default:
        }
      }
      that.setData({
        tabdata: res.data.k1,
        centendata: res.data.k2.reverse()
      })
      wx.setNavigationBarTitle({ title: that.data.tabdata.nickname });
      if (a) {
        setTimeout(function () {
            that.bottom()
        }, 500);
      }
    })
    setTimeout(function () {
      if (that.data.centendata.length != length) {
        length = that.data.centendata.length
      }
      that.loaddata()
    }, 3000);
    
  },
  // 获取hei的id节点然后屏幕焦点调转到这个节点
  bottom: function () {
    var query = wx.createSelectorQuery()
    query.select('#hei').boundingClientRect()
    query.selectViewport().scrollOffset()
    query.exec(function (res) {
      wx.pageScrollTo({
        scrollTop: res[0].bottom  // #the-id节点的下边界坐标
      })
      res[1].scrollTop // 显示区域的竖直滚动位置
    })
  },
  // 选择图片并把图片保存  
  upimg1: function () {
    var that = this;
    wx.chooseImage({
      success: function (res) {
        var data = {
          program_id: app.jtappid,
          openid: app._openid,
          zx_info_id: zx_info_id,
        }
        var tempFilePaths = res.tempFilePaths
        wx.uploadFile({
          url: 'pg.php/ZXinfo/session_submit', //提交信息至后台
          filePath: tempFilePaths[0],
          name: 'content', //文件对应的参数名字(key)
          formData: data,  //其它的表单信息
          success: function (res) {
            var a = true;
            that.loaddata(a);
            message = ''
          }
        })
      }
    })
  }
})</code></pre> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<pre class="has"><code class="language-css">/* pages/index/to_news/to_news.wxss */

page {
  background-color: #f7f7f7;
}

.tab {
  padding: 20rpx 20rpx 40rpx 50rpx;
  height: 20%;
  background-color: white;
}

.tab .tent {
  font-size: 33rpx;
  margin-bottom: 30rpx;
}
.jia_img{
  height: 80rpx;
  width: 90rpx;
}
.new_imgtent{
    height: 180rpx;
  width: 190rpx;
}
.tab .fabu {
  font-size: 33rpx;
  margin-top: 30rpx;
  margin-bottom: 30rpx;
}

.xiahuaxia {
  width: 80%;
  text-align: center;
  margin: 0 auto;
  position: relative;
  top: 60rpx;
}

.time {
  text-align: center;
  padding: 5rpx 20rpx 5rpx 20rpx;
  width: 200rpx;
  font-size: 26rpx;
  background-color: #E8E8E8;
}

.new_top_txt {
  width: 50%;
  position: relative;
  top: 38rpx;
  text-align: center;
  margin: 0 auto;
  font-size: 30rpx;
  color: #787878;
  background-color: #f7f7f7;
}

/* 聊天内容 */

.news {
  margin-top: 30rpx;
  text-align: center;
  margin-bottom: 150rpx;
}

.img_null {
  height: 60rpx;
}

.l {
  height: 5rpx;
  width: 20%;
  margin-top: 30rpx;
  color: #000;
}

/* 聊天 */

.my_right {
  float: right;
  position: relative;
  right: 40rpx;
}

.you_left {
  float: left;
  position: relative;
  left: 5rpx;
}

.new_img {
  width: 100rpx;
  height: 100rpx;
  border-radius: 50%;
}

.new_txt {
  width: 380rpx;
  border-radius: 7px;
  background-color: #95d4ff;
  padding: 0rpx 30rpx 0rpx 30rpx;
}

.sanjiao {
  top: 20rpx;
  position: relative;
  width: 0px;
  height: 0px;
  border-width: 10px;
  border-style: solid;
}

.my {
  border-color: transparent transparent transparent #95d4ff;
}

.you {
  border-color: transparent #95d4ff transparent transparent;
}

.sendmessage {
  background-color: white;
  width: 100%;
  position: fixed;
  bottom: 0rpx;
  display: flex;
  flex-direction: row;
}

.sendmessage input {
  width: 80%;
  height: 40px;
  background-color: white;
  line-height: 40px;
  font-size: 14px;
  border: 1px solid #d0d0d0;
  padding-left: 10px;
}

.sendmessage button {
  border: 1px solid white;
  width: 18%;
  height: 40px;
  background: #fff;
  color: #000;
  line-height: 40px;
  font-size: 14px;
}

.historycon {
  height: 90%;
  width: 100%;
  flex-direction: column;
  display: flex;
  margin-top: 100rpx;
  border-top: 0px;
}
.hei{
  margin-top: 50px;
  height: 20rpx;
}
.history {
  height: 100%;
  margin-top: 15px;
  margin: 10px;
  font-size: 14px;
  line-height: 40px;
  word-break: break-all;
}
</code></pre> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/44ebe3ec0c13827f83eed185a16489a8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">YOCTO编译环境的搭建</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/699db740fd28991b8df4c481cabff0e7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Fragment简单介绍</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>