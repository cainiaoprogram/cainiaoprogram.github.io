<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spring Boot（二）：外部配置文件（超级详细） - 菜鸟程序员博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Spring Boot（二）：外部配置文件（超级详细）" />
<meta property="og:description" content="Spring Boot 配置文件及自动配置原理 前言一、配置文件的两种类型二、YAML 语言入门1、基本语法2、数据类型2.1、YAML 纯量2.2、数组2.3、对象2.4、开发实例 三、Spring Boot 配置文件取值1、通过获取环境变量获取配置1.1、创建新工程1.2、编写配置文件1.3、获取配置内容1.3.1、启动类获取环境变量获取配置1.3.2、注入环境变量获取配置 2、通过注解获取配置2.1、@Value 注解2.2、@ConfigurationProperties注解2.2.1、思考案例2.2.2、作用和注意点2.2.3、和@Value注解的异同点2.2.4、松散绑定（Relaxed Binding）2.2.5、JSR303数据校验 3、小结 四、Spring Boot 多环境配置1、单yml文件2、多yml文件 五、Spring Boot 加载配置文件 前言 前面我们说到，springboot使用了特定的方式来进行配置，即约定优于配置（Spring Boot在底层已经把配置都约定（配置）好了）的设计范式，从而使开发人员不再需要定义样板化的配置，就可以正常运行一个spring程序。但是在一些特殊的情况下，我们需要偏离springboot中的约定（默认配置），这时我们就需要自定义一些配置用来修改springboot的默认配置。
一、配置文件的两种类型 Spring Boot 为我们提供一个名称为 application 的全局配置文件，支持两种类型，一种properties类型，一种YAML类型，用于修改 Spring Boot 的默认配置。
两种配置文件
​ application.properties
​ application.yaml 或者 application.yml
在上一篇文章中我们可以看到，当我们创建一个springboot项目的时候，系统默认会为我们在 src/main/java/resources 目录下创建一个 application.properties 配置文件。
因为我个人更喜欢 yaml 格式的配置文件，所以一般在创建好项目后我会将 application.properties 修改为 application.yml。可能我们会在不同的项目中看见两种不同的配置文件格式，实际上两种格式都是OK的。我会在后面详细介绍一下 YAML语言，关于properties就展开来说了。
二、YAML 语言入门 YAML是 YAML Ain&#39;t Markup Language（YAML 不是一种标记语言）的递归缩写 ，YAML还可以理解为 Yet Another Markup Language（仍是一种标记语言）。
YAML 是专门用来写配置文件的语言，以数据为中心，非常简洁和强大，比json、xml等更适合做配置文件。
1、基本语法 采用 key: value方式表示数据（冒号后面需要空格隔开）大小写敏感使用缩进表示层级关系缩进不允许使用tab，只允许空格缩进的空格数不重要，只要相同层级的元素左对齐即可&#39;#&#39;表示注释 需要注意的是，YMAL语言只支持单行注释，从 # 开始一直到行尾，都会被解析器忽略。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cainiaoprogram.github.io/posts/2330efa3c8356c5f1c8bf848d10f95d3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-06-29T22:26:02+08:00" />
<meta property="article:modified_time" content="2020-06-29T22:26:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="菜鸟程序员博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">菜鸟程序员博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spring Boot（二）：外部配置文件（超级详细）</h1>
			
		</header>
		<div id="gatop"></div>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Spring Boot 配置文件及自动配置原理</h4> 
 <ul><li><ul><li><a href="#_2" rel="nofollow">前言</a></li><li><a href="#_6" rel="nofollow">一、配置文件的两种类型</a></li><li><a href="#YAML__20" rel="nofollow">二、YAML 语言入门</a></li><li><ul><li><a href="#1_26" rel="nofollow">1、基本语法</a></li><li><a href="#2_37" rel="nofollow">2、数据类型</a></li><li><ul><li><a href="#21YAML__47" rel="nofollow">2.1、YAML 纯量</a></li><li><a href="#22_136" rel="nofollow">2.2、数组</a></li><li><a href="#23_164" rel="nofollow">2.3、对象</a></li><li><a href="#24_190" rel="nofollow">2.4、开发实例</a></li></ul> 
   </li></ul> 
   </li><li><a href="#Spring_Boot__223" rel="nofollow">三、Spring Boot 配置文件取值</a></li><li><ul><li><a href="#1_230" rel="nofollow">1、通过获取环境变量获取配置</a></li><li><ul><li><a href="#11_232" rel="nofollow">1.1、创建新工程</a></li><li><a href="#12_262" rel="nofollow">1.2、编写配置文件</a></li><li><a href="#13_277" rel="nofollow">1.3、获取配置内容</a></li><li><ul><li><a href="#131_279" rel="nofollow">1.3.1、启动类获取环境变量获取配置</a></li><li><a href="#132_326" rel="nofollow">1.3.2、注入环境变量获取配置</a></li></ul> 
    </li></ul> 
    </li><li><a href="#2_365" rel="nofollow">2、通过注解获取配置</a></li><li><ul><li><a href="#21Value__367" rel="nofollow">2.1、@Value 注解</a></li><li><a href="#22ConfigurationProperties_485" rel="nofollow">2.2、@ConfigurationProperties注解</a></li><li><ul><li><a href="#221_487" rel="nofollow">2.2.1、思考案例</a></li><li><a href="#222_652" rel="nofollow">2.2.2、作用和注意点</a></li><li><a href="#223Value_667" rel="nofollow">2.2.3、和@Value注解的异同点</a></li><li><a href="#224Relaxed_Binding_679" rel="nofollow">2.2.4、松散绑定（Relaxed Binding）</a></li><li><a href="#225JSR303_715" rel="nofollow">2.2.5、JSR303数据校验</a></li></ul> 
    </li></ul> 
    </li><li><a href="#3_783" rel="nofollow">3、小结</a></li></ul> 
   </li><li><a href="#Spring_Boot__787" rel="nofollow">四、Spring Boot 多环境配置</a></li><li><ul><li><a href="#1yml_794" rel="nofollow">1、单yml文件</a></li><li><a href="#2yml_848" rel="nofollow">2、多yml文件</a></li></ul> 
   </li><li><a href="#Spring_Boot__888" rel="nofollow">五、Spring Boot 加载配置文件</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_2"></a>前言</h3> 
<p>前面我们说到，springboot使用了特定的方式来进行配置，即<code>约定优于配置</code>（Spring Boot在底层已经把配置都<code>约定（配置）</code>好了）的设计范式，从而使开发人员不再需要定义样板化的配置，就可以正常运行一个spring程序。但是在一些特殊的情况下，我们需要偏离springboot中的约定（默认配置），这时我们就需要自定义一些配置用来修改springboot的默认配置。</p> 
<h3><a id="_6"></a>一、配置文件的两种类型</h3> 
<p>Spring Boot 为我们提供一个名称为 application 的全局配置文件，支持两种类型，一种properties类型，一种YAML类型，用于修改 Spring Boot 的默认配置。</p> 
<blockquote> 
 <p>两种配置文件</p> 
 <p>​ application.properties</p> 
 <p>​ application.yaml 或者 application.yml</p> 
</blockquote> 
<p>在上一篇文章中我们可以看到，当我们创建一个springboot项目的时候，系统默认会为我们在 src/main/java/resources 目录下创建一个 application.properties 配置文件。</p> 
<blockquote> 
 <p>因为我个人更喜欢 yaml 格式的配置文件，所以一般在创建好项目后我会将 application.properties 修改为 application.yml。可能我们会在不同的项目中看见两种不同的配置文件格式，实际上两种格式都是OK的。我会在后面详细介绍一下 YAML语言，关于properties就展开来说了。</p> 
</blockquote> 
<h3><a id="YAML__20"></a>二、YAML 语言入门</h3> 
<p>YAML是 <code>YAML Ain't Markup Language</code>（YAML 不是一种标记语言）的递归缩写 ，YAML还可以理解为 <code>Yet Another Markup Language</code>（仍是一种标记语言）。</p> 
<p>YAML 是专门用来写配置文件的语言，<code>以数据为中心</code>，非常简洁和强大，比json、xml等更适合做配置文件。</p> 
<h4><a id="1_26"></a>1、基本语法</h4> 
<blockquote> 
 <ul><li>采用 <strong>key: value</strong>方式表示数据（冒号后面需要空格隔开）</li><li>大小写敏感</li><li>使用缩进表示层级关系</li><li>缩进不允许使用<strong>tab</strong>，只允许空格</li><li>缩进的空格数不重要，只要相同层级的元素左对齐即可</li><li>'#'表示注释</li></ul> 
</blockquote> 
<p>需要注意的是，YMAL语言只支持单行注释，从 <code>#</code> 开始一直到行尾，都会被解析器忽略。</p> 
<h4><a id="2_37"></a>2、数据类型</h4> 
<p>YAML 支持以下几种数据类型：</p> 
<blockquote> 
 <ul><li>纯量（scalars）：单个的、不可再分的值（数字，字符串，布尔。。。）</li><li>数组：一组按次序排列的值，又称为序列（sequence） / 列表（list）</li><li>对象：键值对的集合，又称为映射（mapping）/ 哈希（hashes） / 字典（dictionary）</li></ul> 
</blockquote> 
<p>下面我们分别对这三种数据类型进行详细的讲解，在这之前先给大家推荐一个在线编辑 yaml 的网站吧，可以将我下面的代码粘进去看结果。不是打广告啊，我这博客有没有人看还不一定，在线卑微。。。<a href="http://www.bejson.com/validators/yaml_editor/" rel="nofollow">在线编辑 yaml</a></p> 
<h5><a id="21YAML__47"></a>2.1、YAML 纯量</h5> 
<p>纯量是最基本的，不可再分的值，包括：</p> 
<ul><li> <p>字符串</p> <pre><code class="prism language-yaml"><span class="token comment"># 字符串是最常见一种数据类型，默认不用加上单引号或者双引号</span>
<span class="token key atrule">content</span><span class="token punctuation">:</span> 好好学习，天天向上 <span class="token comment"># == "好好学习，天天向上"</span>

<span class="token comment"># 如果字符串之中包含空格或特殊字符，需要放在引号之中，其中双引号不会转义字符串，而单引号会</span>
<span class="token key atrule">content</span><span class="token punctuation">:</span> "好好学习\n天天向上" <span class="token comment"># == "好好学习\n天天向上"，会进行换行</span>
<span class="token key atrule">content</span><span class="token punctuation">:</span> '好好学习\n天天向上' <span class="token comment"># == "好好学习\\n天天向上"，不会换行</span>

<span class="token comment"># 单引号之中如果还有单引号，必须连续使用两个单引号转义</span>
<span class="token key atrule">content</span><span class="token punctuation">:</span> 'YAML Ain''t Markup Language' <span class="token comment"># == "YAML Ain't Markup Language"</span>

<span class="token comment"># 字符串可以拆成多行，换行符会被转化成一个空格(转义第二行开始，只需要一个空格)</span>
<span class="token key atrule">content</span><span class="token punctuation">:</span> 小明
 是一个
 大帅哥，谁赞同？谁反对？ <span class="token comment"># == "小明 是一个 大帅哥，谁赞同？谁反对？"</span>
		
<span class="token comment"># 多行字符串可以使用 | 保留换行符，也可以使用 &gt; 折叠换行</span>
<span class="token key atrule">content</span><span class="token punctuation">:</span> <span class="token punctuation">|</span> <span class="token comment"># == "小明\n是一个\n大帅哥，谁赞同？谁反对？\n"</span>
 小明
 是一个
 大帅哥，谁赞同？谁反对？
<span class="token key atrule">content</span><span class="token punctuation">:</span> <span class="token punctuation">&gt;</span> <span class="token comment"># == "小明 是一个 大帅哥，谁赞同？谁反对？\n"</span>
 小明
 是一个
 大帅哥，谁赞同？谁反对？
 
<span class="token comment"># 可以使用 |+ 保留文字块末尾的换行，也可以使用 |— 删除字符串末尾的换行</span>
<span class="token key atrule">content</span><span class="token punctuation">:</span> <span class="token punctuation">|</span>+ <span class="token comment"># == "小明\n是一个\n大帅哥，谁赞同？谁反对？\n"</span>
 小明
 是一个
 大帅哥，谁赞同？谁反对？
<span class="token key atrule">content</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token punctuation">-</span> <span class="token comment"># == "小明\n是一个\n大帅哥，谁赞同？谁反对？"</span>
 小明
 是一个
 大帅哥，谁赞同？谁反对？
 
<span class="token comment"># 字符串之中可以插入 HTML</span>
<span class="token key atrule">content</span><span class="token punctuation">:</span> <span class="token punctuation">|</span> <span class="token comment"># == "&lt;p style=\"color: red\"&gt;\n  段落\n&lt;/p&gt;\n"</span>
 &lt;p style="color<span class="token punctuation">:</span> red"<span class="token punctuation">&gt;</span>
   段落
 &lt;/p<span class="token punctuation">&gt;</span>
</code></pre> 
  <blockquote> 
   <p>看完这么一大串是不是感觉有点麻烦。。。其实在实际的开发中，我们只会用到最基本的，就我个人而言，引号也就是在配置日志格式和颜色时用到了，后面的换行，换行符什么的，我是一个也没用过。。。</p> 
  </blockquote> </li><li> <p>布尔值</p> <pre><code class="prism language-yaml"><span class="token comment"># 布尔值用true和false表示</span>
<span class="token key atrule">falg</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">isSuccess</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre> </li><li> <p>整数、浮点数</p> <pre><code class="prism language-yaml"><span class="token comment"># 数值直接以字面量的形式表示</span>
<span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">20</span>
<span class="token key atrule">age</span><span class="token punctuation">:</span> 0b1010_0111_0100_1010_1110 <span class="token comment">#二进制表示</span>
</code></pre> </li><li> <p>Null</p> <pre><code class="prism language-yaml"><span class="token comment"># null用 ~ 表示</span>
<span class="token key atrule">string</span><span class="token punctuation">:</span> <span class="token null important">~ </span><span class="token comment"># == "string": null</span>
</code></pre> </li><li> <p>日期、时间</p> <pre><code class="prism language-yaml"><span class="token comment"># 日期和时间都是采用ISO8601的格式表示的</span>

<span class="token comment"># 日期格式为 yyyy-MM-dd</span>
<span class="token key atrule">createDate</span><span class="token punctuation">:</span> <span class="token datetime number">2020-06-24</span> <span class="token comment"># 转换为json为 {"createDate": "2020-06-24T00:00:00.000Z"}</span>

<span class="token comment"># 时间格式为 时间和日期之间使用T连接，最后使用 +、-（这里不是加减号，是连字符）代表时区</span>
<span class="token key atrule">datetime</span><span class="token punctuation">:</span> <span class="token datetime number">2020-06-24T22:00:00-08:00</span> <span class="token comment"># 转换为json为 {"datetime": "2020-06-25T06:00:00.000Z"}</span>
<span class="token key atrule">datetime</span><span class="token punctuation">:</span> <span class="token datetime number">2020-06-24T22:00:00+08:00</span> <span class="token comment"># 转换为json为 {"datetime": "2020-06-24T14:00:00.000Z"}</span>

<span class="token comment"># 从上面的例子可以看出 连字符前面的时间为默认的 0 时区，其后 -08:00 则表示为西八区，而我国则在东八区，用 +08:00 表示</span>
</code></pre> </li></ul> 
<h5><a id="22_136"></a>2.2、数组</h5> 
<p>在yaml中，以 <strong><code>-</code></strong> 开头的行则表示成一个数组，例：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">calss</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> xiaoming
<span class="token punctuation">-</span> xiaohong
<span class="token punctuation">-</span> xiaoxiao <span class="token comment"># == ['xiaoming', 'xiaohong', 'xiaoxiao']</span>
</code></pre> 
<p>同时，yaml 还支持多维数组，例：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">calss</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span>
 <span class="token punctuation">-</span> xiaoming
 <span class="token punctuation">-</span> xiaohong
 <span class="token punctuation">-</span> xiaoxiao <span class="token comment"># == [['xiaoming', 'xiaohong', 'xiaoxiao']]</span>
</code></pre> 
<p>数组也可以采用行内写法</p> 
<pre><code class="prism language-yaml"><span class="token comment"># 这个和上面的例子表示的意思是一样的</span>
<span class="token key atrule">class</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>xiaoming<span class="token punctuation">,</span> xiaohong<span class="token punctuation">,</span> xiaoxiao<span class="token punctuation">]</span><span class="token punctuation">]</span> 
</code></pre> 
<h5><a id="23_164"></a>2.3、对象</h5> 
<p>在 yaml 中一个对象可以使用冒号结构的 key: value 表示，冒号后面要加一个空格。例</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">city</span><span class="token punctuation">:</span> shanghai <span class="token comment"># 这个表示一个对象 {city: 'shanghai'}，对象中有一个city属性，属性值是shanghai</span>
</code></pre> 
<p>Yaml 也可以使用 <code>key: {key1: value1, key2: value2, ...}</code>，将所有键值对写成一个行内对象。</p> 
<pre><code class="prism language-yaml"><span class="token comment"># 表示一个班级对象，里面有三个属性，班主任、班导、学生</span>
<span class="token key atrule">class</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token key atrule">班主任</span><span class="token punctuation">:</span> xiaoming<span class="token punctuation">,</span> <span class="token key atrule">班导</span><span class="token punctuation">:</span> xiaohong<span class="token punctuation">,</span> <span class="token key atrule">学生</span><span class="token punctuation">:</span> xiaoxiao<span class="token punctuation">}</span>
</code></pre> 
<p>较为复杂的对象格式，可以使用问号加一个空格代表一个复杂的 key，配合一个冒号加一个空格代表一个 value：</p> 
<pre><code class="prism language-yaml"><span class="token punctuation">?</span> 
    <span class="token punctuation">-</span> key1
    <span class="token punctuation">-</span> <span class="token key atrule">key2</span>
<span class="token punctuation">:</span>
    <span class="token punctuation">-</span> value1
    <span class="token punctuation">-</span> value2 <span class="token comment"># 意思即对象的属性是一个数组 [key1, key2]，对应的值也是一个数组 [value1, value2]</span>
</code></pre> 
<h5><a id="24_190"></a>2.4、开发实例</h5> 
<p>上面我们举了这么多的例子，相信大家对 YAML 语言已经有一定的了解了，下面我们来看看实际开发中 YAML 在 Spring Boot 中的应用。</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token comment"># 修改运行端口</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9521</span>
  <span class="token comment"># 配置项目路径</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">context-path</span><span class="token punctuation">:</span> /xm<span class="token punctuation">-</span>admin

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment"># 配置程序名称</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> xm<span class="token punctuation">-</span>admin
  <span class="token comment"># 配置运行环境(dev、test、prod)</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev
  <span class="token key atrule">jackson</span><span class="token punctuation">:</span>
    <span class="token comment"># 设置日期格式化</span>
    <span class="token key atrule">date-format</span><span class="token punctuation">:</span> yyyy<span class="token punctuation">-</span>MM<span class="token punctuation">-</span>dd HH<span class="token punctuation">:</span>mm<span class="token punctuation">:</span>ss
    <span class="token comment"># 设置时区</span>
    <span class="token key atrule">time-zone</span><span class="token punctuation">:</span> GMT+8

<span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>
  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
    <span class="token comment"># 控制台打印sql</span>
    <span class="token key atrule">log-impl</span><span class="token punctuation">:</span> org.apache.ibatis.logging.stdout.StdOutImpl
</code></pre> 
<p>好了，关于 yaml 语言的介绍就到这里结束啦。下面我们来介绍 Spring Boot 如何在配置文件中取值。</p> 
<h3><a id="Spring_Boot__223"></a>三、Spring Boot 配置文件取值</h3> 
<blockquote> 
 <p>Spring Boot 读取配置文件的常见的方式可以分为</p> 
 <ul><li>通过 Spring Boot 的环境变量取值</li><li>通过注解方式读取</li></ul> 
</blockquote> 
<h4><a id="1_230"></a>1、通过获取环境变量获取配置</h4> 
<h5><a id="11_232"></a>1.1、创建新工程</h5> 
<p>首先我们需要先创建一个新工程来进行获取配置文件的演示（spring initializr）。</p> 
<p>POM文件如下：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h5><a id="12_262"></a>1.2、编写配置文件</h5> 
<blockquote> 
 <p>个人习惯先将 application.properties 修改为 application.yml。</p> 
</blockquote> 
<p>在配置文件中随便写点内容：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">name</span><span class="token punctuation">:</span> xiaoming
<span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">24</span>
<span class="token key atrule">hobby</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> 看电影
  <span class="token punctuation">-</span> 听音乐
  <span class="token punctuation">-</span> 打游戏
</code></pre> 
<h5><a id="13_277"></a>1.3、获取配置内容</h5> 
<h6><a id="131_279"></a>1.3.1、启动类获取环境变量获取配置</h6> 
<p>我们可以通过在启动类中获取到 Spring Boot 上下文对象，从而获取到 Spring Boot 运行的环境变量</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AppRun</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>AppRun<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>上面这段代码，相信大家已经很熟悉了，就是一个标准的 Spring Boot 启动类。基本上大家都是这么写的吧，其实我们是可以用一个变量去接收<code>SpringApplication.run(AppRun.class, args);</code>语句的返回值，而返回的对象正是 Spring Boot 的上下文对象。所以我们修改一下代码：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 获取 Spring Boot 上下文</span>
    ConfigurableApplicationContext ctx <span class="token operator">=</span> SpringApplication<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>AppRun<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取 Spring Boot 运行的环境变量</span>
    ConfigurableEnvironment ce <span class="token operator">=</span> ctx<span class="token punctuation">.</span><span class="token function">getEnvironment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 通过环境变量获取 字符串</span>
    String name <span class="token operator">=</span> ce<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取 Integer 类型的值</span>
    Integer age <span class="token operator">=</span> ce<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> Integer<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取 数组 类型的值</span>
    String hobby0 <span class="token operator">=</span> ce<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"hobby[0]"</span><span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    String hobby1 <span class="token operator">=</span> ce<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"hobby[1]"</span><span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    String hobby2 <span class="token operator">=</span> ce<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"hobby[2]"</span><span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"name："</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"age："</span> <span class="token operator">+</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hobby[0]："</span> <span class="token operator">+</span> hobby0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hobby[1]："</span> <span class="token operator">+</span> hobby1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hobby[2]："</span> <span class="token operator">+</span> hobby2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>控制台的输出如下：<img src="https://images2.imgbox.com/ab/82/at9rcGcX_o.jpg" alt="中文配置乱码"><br> 从上图可以看到，输出中文的时候会乱码显示。乱码的本质原因就是输入和输出时的编码不一致，所以我们需要修改一下配置文件的编码格式即可解决问题，修改步骤如下：</p> 
<blockquote> 
 <p>点击 File -&gt; Settings -&gt; Editor -&gt; File Encodings，修改相关编码格式为UTF-8，建议将 Transparent native-to-ascii conversion 勾选上。</p> 
</blockquote> 
<p>修改完成之后控制台显示的就是正常的中文了。<br> <img src="https://images2.imgbox.com/8a/3c/AFvnmsYv_o.jpg" alt="正常显示中文"></p> 
<h6><a id="132_326"></a>1.3.2、注入环境变量获取配置</h6> 
<blockquote> 
 <p>spring核心库中为我们提供了一个环境变量的接口<code>Environment</code>，我们可以使用<code>@Autowired</code>直接注入到我们的<code>Bean</code>中。</p> 
</blockquote> 
<p>下面我们在 test 包下编写我们的测试类。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">AppRunTests</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">/**
     * 直接注入即可
     */</span>
    <span class="token annotation punctuation">@Autowired</span>
    Environment env<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 通过直接注入环境变量来获取配置文件的属性</span>
        String name <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Integer age <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> Integer<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String hobby0 <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"hobby[0]"</span><span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String hobby1 <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"hobby[1]"</span><span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String hobby2 <span class="token operator">=</span> env<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"hobby[2]"</span><span class="token punctuation">,</span> String<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"name："</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"age："</span> <span class="token operator">+</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hobby[0]："</span> <span class="token operator">+</span> hobby0<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hobby[1]："</span> <span class="token operator">+</span> hobby1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hobby[2]："</span> <span class="token operator">+</span> hobby2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>控制台输出的还是和上面的例子是一样的<br> <img src="https://images2.imgbox.com/3f/37/dwXm0zLz_o.jpg" alt="注入环境变量方式获取配置"><br> 通过环境变量获取配置文件的方式我们就讲到这，其实使用环境变量不止能够获取到我们配置文件内容，还能够获取到许多与环境变量有关的值，例如 java.home、java.version、user.name、user.dir 等等一系列的环境变量的默认配置。</p> 
<h4><a id="2_365"></a>2、通过注解获取配置</h4> 
<h5><a id="21Value__367"></a>2.1、@Value 注解</h5> 
<blockquote> 
 <p>Spring Boot 通过 <code>@Value</code> 注解将配置文件中的属性注入到容器内组件中（可用在@Controller、@Service、@Configuration、@Component等Spring托管的类中），@Value 有两种取值方式 <code>@Value("${}")</code> 和 <code>@Value("#{}")</code></p> 
</blockquote> 
<p>首先我们来看第一种语法格式，也是比较常用的格式<code>@Value("${}")</code>，这种方式可以直接读取已经被 Spring Boot 加载的配置文件中的属性值，话不多说，我们直接上代码：</p> 
<p>首先我们在我们的测试包下新建一个测试类 <code>ConfigTests</code></p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigTests</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">configTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>然后就是通过 @Vlaue 注解来获取到 application.yml 中得值了</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigTests</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${name}"</span><span class="token punctuation">)</span>
    String name<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${age}"</span><span class="token punctuation">)</span>
    Integer age<span class="token punctuation">;</span>

    <span class="token comment">/**
     * ${key:value} 这样写表达的含义为 当我们在配置文件中取不到key的值时, value就会填充为默认值
     */</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${hobby:1}"</span><span class="token punctuation">)</span>
    List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> hobby<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">configTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"name："</span> <span class="token operator">+</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"age："</span> <span class="token operator">+</span> age<span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"hobby："</span> <span class="token operator">+</span> hobby<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>控制台输出如下内容：</p> 
<pre><code class="prism language-text">name：xiaoming
age：24
hobby：[1]
</code></pre> 
<blockquote> 
 <p>疑问：此时我们发现，hobby 的值变成了 [1]，而我们的配置文件中的值为 [看电影，听音乐，打游戏] ，为什么我们会取不到 hobby 的值，而使用的默认值 [1] 呢？</p> 
 <p>我也不知道为什么。。。哈哈（有大佬知道，评论或私信告诉我一下哈，不胜感激），但是我知道怎么解决这个问题。。。请往下看</p> 
</blockquote> 
<p>我们只需要修改一下配置文件中的格式即可：</p> 
<pre><code class="prism language-yml"><span class="token key atrule">name</span><span class="token punctuation">:</span> xiaoming
<span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">24</span>

<span class="token comment"># 需要将 list 类型写成由逗号隔开的字符串即可，@Value 会帮我们注入成为 list 类型的值</span>
<span class="token key atrule">hobby</span><span class="token punctuation">:</span> 看电影<span class="token punctuation">,</span>听音乐<span class="token punctuation">,</span>打游戏

<span class="token comment">#hobby:</span>
<span class="token comment">#  - 看电影</span>
<span class="token comment">#  - 听音乐</span>
<span class="token comment">#  - 打游戏</span>
</code></pre> 
<p>我们进行debug查看注入的值，可以发现 类型为 ArrayList，size为3，如下图：<br> <img src="https://images2.imgbox.com/bf/86/CsoEu68Q_o.jpg" alt="在这里插入图片描述"><br> OK，进行完 list 类型的注入，我么继续尝试一下 map 类型的注入，首先在配置文件中添加一个配置：</p> 
<pre><code class="prism language-yml"><span class="token comment"># 这里需要注意的是，map类型的值需要使用双引号包起来，否则根据 yaml 的语法，会将'{'认为他是一个字典</span>
<span class="token key atrule">xiaoming</span><span class="token punctuation">:</span> <span class="token string">"{name: 'xiaoming', age: 24, hobby: '看电影,听音乐,打游戏'}"</span>
</code></pre> 
<p>然后在代码中添加如下语句进行取值，</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${xiaoming}"</span><span class="token punctuation">)</span>
Map<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token punctuation">&gt;</span></span> xiaoming<span class="token punctuation">;</span>
</code></pre> 
<p>此时我们发现，代码报错了，异常如下：</p> 
<blockquote> 
 <p>Cannot convert value of type ‘java.lang.String’ to required type ‘java.util.Map’: no matching editors or conversion strategy found</p> 
 <p>金牌翻译：无法转换’java.lang.String’类型的值到所需类型’java.util.Map’：找不到匹配的编辑器或转换策略</p> 
</blockquote> 
<p>按照字面意思可以看出，<code>@Value("${}")</code> 能够获取到 xiaoming 这一属性的值，只不过获取到的属性值的类型是一个字符串，但是我们就想要获取到一个 map，这个时候怎么办呢？这个时候我们就可以使用第二种语法格式 <code>@Value("#{}")</code> 在结合 <code>@Value("${}")</code> 获取到 map 格式的值。先上代码：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"#{${xiaoming}}"</span><span class="token punctuation">)</span> <span class="token comment">// 需要注意，一定是#{}包括${}</span>
Map<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token punctuation">&gt;</span></span> xiaoming<span class="token punctuation">;</span>
</code></pre> 
<p>我们继续这个时候就能将配置文件中xiaoming的值注入给map类型了，我们debug进行查看：<br> <img src="https://images2.imgbox.com/36/c8/2PpmyTDq_o.jpg" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>看上图可以发现，age的类型为 Integer ，而hobby的类型为String，其实我本来的想法是能注入成为 list类型，尝试例一下，好像没成功，不知道是我写的有问题，还是@Value不能实现(还是那句话，大佬知道的话，求教！！！)</p> 
</blockquote> 
<p>我们先想想，为什么 <code>@Value("#{${xiaoming}}")</code> 就能使一个 json 字符串转换并注入为 map 类型呢？</p> 
<p>因为<code>@Value("#{}")</code> 可以在 #{} 编写SpEl表达式，并将执行结果赋值给属性，所以这种方式注入的是SpEL表达式对应的结果。所以在使用 <code>@Value("#{${xiaoming}}")</code> 的时候其实是使用 SpEL表达式对 <code>@Value("${xiaoming}")</code> 获取到的值再进行处理转换为了map类型的值。</p> 
<blockquote> 
 <p>tips：SpEL（Spring Expression Language），即Spring表达式语言，是比JSP的EL更强大的一种表达式语言。</p> 
</blockquote> 
<p>到这里，@Value注解我就介绍完了，就不在细说 @Value("#{}") 的使用场景啦，反正记住一点即可，<strong>@Value("${}")注入的是外部配置文件对应的property，而@Value("#{}")则是注入SpEL表达式对应的内容。</strong></p> 
<p>接下来我们学习第二个注解（@ConfigurationProperties）</p> 
<h5><a id="22ConfigurationProperties_485"></a>2.2、@ConfigurationProperties注解</h5> 
<h6><a id="221_487"></a>2.2.1、思考案例</h6> 
<p>在学习<code>@ConfigurationProperties</code>注解前，我们先来看这样一个需求，现在我们有如下配置文件，我们需要将其中的全部属性注入到一个 spring bean 中。</p> 
<pre><code class="prism language-yml"><span class="token comment"># 这是我在项目中使用的alibaba druid数据源的配置</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment"># 配置数据源</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/xm_admin<span class="token punctuation">?</span>useUnicode=true<span class="token important">&amp;useSSL</span>=false<span class="token important">&amp;characterEncoding</span>=utf8<span class="token important">&amp;serverTimezone</span>=GMT%2B8
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> root
    <span class="token comment"># 配置alibaba druid连接池</span>
    <span class="token key atrule">druid</span><span class="token punctuation">:</span>
      <span class="token comment"># 配置监控统计拦截的filters，去掉后监控界面sql无法统计，'wall'用于防火墙</span>
      <span class="token key atrule">filters</span><span class="token punctuation">:</span> stat<span class="token punctuation">,</span>wall<span class="token punctuation">,</span>slf4j
      <span class="token comment"># 最大连接池数量 maxIdle已经不再使用</span>
      <span class="token key atrule">maxActive</span><span class="token punctuation">:</span> <span class="token number">20</span>
      <span class="token comment"># 初始化时建立物理连接的个数</span>
      <span class="token key atrule">initialSize</span><span class="token punctuation">:</span> <span class="token number">1</span>
      <span class="token comment"># 获取连接时最大等待时间，单位毫秒</span>
      <span class="token key atrule">maxWait</span><span class="token punctuation">:</span> <span class="token number">60000</span>
      <span class="token comment"># 最小连接池数量</span>
      <span class="token key atrule">minIdle</span><span class="token punctuation">:</span> <span class="token number">1</span>
      <span class="token comment"># 既作为检测的间隔时间又作为testWhileIdel执行的依据</span>
      <span class="token key atrule">timeBetweenEvictionRunsMillis</span><span class="token punctuation">:</span> <span class="token number">60000</span>
      <span class="token comment"># 销毁线程时检测当前连接的最后活动时间和当前时间差大于该值时，关闭当前连接</span>
      <span class="token key atrule">minEvictableIdleTimeMillis</span><span class="token punctuation">:</span> <span class="token number">300000</span>
      <span class="token comment"># 用来检测连接是否有效的sql 必须是一个查询语句 mysql中为 select 'x' oracle中为 select 1 from dual</span>
      <span class="token key atrule">validationQuery</span><span class="token punctuation">:</span> select 'x'
      <span class="token comment"># 申请连接的时候检测，如果空闲时间大于timeBetweenEvictionRunsMillis，执行validationQuery检测连接是否有效。</span>
      <span class="token key atrule">testWhileIdle</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token comment"># 申请连接时会执行validationQuery检测连接是否有效,开启会降低性能,默认为true</span>
      <span class="token key atrule">testOnBorrow</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token comment"># 归还连接时会执行validationQuery检测连接是否有效,开启会降低性能,默认为true</span>
      <span class="token key atrule">testOnReturn</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
      <span class="token comment"># 是否缓存preparedStatement，也就是PSCache 官方建议MySQL下建议关闭 个人建议如果想用SQL防火墙 建议打开</span>
      <span class="token key atrule">poolPreparedStatements</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">maxOpenPreparedStatements</span><span class="token punctuation">:</span> <span class="token number">20</span>
      <span class="token comment">#当值大于0时poolPreparedStatements会自动修改为true</span>
      <span class="token key atrule">maxPoolPreparedStatementPerConnectionSize</span><span class="token punctuation">:</span> <span class="token number">20</span>
      <span class="token comment"># 通过connectProperties属性来打开mergeSql功能；慢SQL记录</span>
      <span class="token key atrule">connectionProperties</span><span class="token punctuation">:</span> druid.stat.mergeSql=true;druid.stat.slowSqlMillis=5000
      <span class="token comment"># 合并多个DruidDataSource的监控数据</span>
      <span class="token key atrule">useGlobalDataSourceStat</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token comment"># 基础监控配置</span>
      <span class="token key atrule">web-stat-filter</span><span class="token punctuation">:</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token comment"># 添加过滤规则</span>
        <span class="token key atrule">url-pattern</span><span class="token punctuation">:</span> /*
        <span class="token comment"># 设置忽略哪些URL</span>
        <span class="token key atrule">exclusions</span><span class="token punctuation">:</span> <span class="token string">"*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*"</span>
        <span class="token key atrule">session-stat-enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">session-stat-max-count</span><span class="token punctuation">:</span> <span class="token number">100</span>
      <span class="token comment">#设置视图拦截,访问druid监控页的账号和密码,默认没有</span>
      <span class="token key atrule">stat-view-servlet</span><span class="token punctuation">:</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token comment"># 访问路径为/druid时，跳转到StatViewServlet</span>
        <span class="token key atrule">url-pattern</span><span class="token punctuation">:</span> /druid/*
        <span class="token key atrule">reset-enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token comment"># 设置监控页面的登录名和密码</span>
        <span class="token key atrule">login-username</span><span class="token punctuation">:</span> admin
        <span class="token key atrule">login-password</span><span class="token punctuation">:</span> admin
        <span class="token comment"># 白名单ip</span>
        <span class="token key atrule">allow</span><span class="token punctuation">:</span> 127.0.0.1
        <span class="token comment"># 黑名单（共同存在时，deny优先于allow）</span>
        <span class="token comment">#deny: localhost</span>
</code></pre> 
<p>这时我们已经学会了两种注入配置文件值的方式，但是看到这段长长的数据源配置是不是蒙圈了，因为不管是使用环境变量的方式，还是@Value的方式，我们都只能一个一个属性的进行注入，现在这个数据源，我们吃点苦还是可以肝完的，但是在我们的实际开发中，我们的配置文件的内容只会比这多得多，要是用@Value的方式，就有点为难我小猪佩奇了。</p> 
<p>所以这时候我们就需要用到我们本小节学习的注解<code>@ConfigurationProperties</code>，因为它最大的特点就是可以批量注入配置文件中的属性。上面的几十行配置文件，我们只需要写一个注解就能全部注入。</p> 
<p>话不多说，先上代码，最直观的感受一下批量注入属性：</p> 
<p><strong>配置文件</strong></p> 
<pre><code class="prism language-yaml"><span class="token key atrule">user</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> xiaoming
  <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">24</span>
  <span class="token key atrule">birth</span><span class="token punctuation">:</span> 1996/01/01
  <span class="token key atrule">scores</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token key atrule">java</span><span class="token punctuation">:</span> <span class="token number">90</span><span class="token punctuation">,</span> <span class="token key atrule">python</span><span class="token punctuation">:</span> <span class="token number">80</span><span class="token punctuation">,</span> <span class="token key atrule">scala</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">}</span>
  <span class="token key atrule">hobby</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> 看电影
    <span class="token punctuation">-</span> 听音乐
    <span class="token punctuation">-</span> 打游戏
  <span class="token key atrule">pet</span><span class="token punctuation">:</span>
    <span class="token key atrule">species</span><span class="token punctuation">:</span> cat
    <span class="token key atrule">name</span><span class="token punctuation">:</span> 星星
    <span class="token comment"># 单位 月</span>
    <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">8</span>
</code></pre> 
<p>创建一个 用户配置类 UserConfig</p> 
<pre><code class="prism language-java"><span class="token keyword">package</span> com<span class="token punctuation">.</span>xiaoming<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>config<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Date<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span>

<span class="token comment">/**
 * 用户配置类
 *
 * @author xiaoming
 * @date 2020-07-04 18:31
 **/</span>
<span class="token annotation punctuation">@Component</span>
<span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix <span class="token operator">=</span> <span class="token string">"user"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserConfig</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>

    <span class="token keyword">private</span> Integer age<span class="token punctuation">;</span>

    <span class="token keyword">private</span> Date birth<span class="token punctuation">;</span>

    <span class="token keyword">private</span> Map<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> Object<span class="token punctuation">&gt;</span></span> scores<span class="token punctuation">;</span>

    <span class="token keyword">private</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> hobby<span class="token punctuation">;</span>

    <span class="token keyword">private</span> Pet pet<span class="token punctuation">;</span>

	<span class="token comment">// 省略 setter getter 方法，实际开发不能省略</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 功能描述: 宠物类
 */</span>
<span class="token keyword">class</span> <span class="token class-name">Pet</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> String species<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Integer age<span class="token punctuation">;</span>

    <span class="token comment">// 省略 setter getter 方法，实际开发不能省略</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>编写测试类方法</p> 
<pre><code class="prism language-java"><span class="token comment">// 使用spring注解注入bean</span>
<span class="token annotation punctuation">@Autowired</span>
UserConfig userConfig<span class="token punctuation">;</span>

<span class="token annotation punctuation">@Test</span>
<span class="token keyword">void</span> <span class="token function">userTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userConfig<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>查看控制台输出：</p> 
<pre><code class="prism language-json">UserConfig<span class="token punctuation">{<!-- --></span>name<span class="token operator">=</span><span class="token string">'19472'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">24</span><span class="token punctuation">,</span> birth<span class="token operator">=</span>Mon Jan <span class="token number">01</span> <span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span><span class="token punctuation">:</span><span class="token number">00</span> <span class="token constant">CST</span> <span class="token number">1996</span><span class="token punctuation">,</span> 
scores<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>java<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">,</span> python<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span> scala<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">,</span> hobby<span class="token operator">=</span><span class="token punctuation">[</span>看电影<span class="token punctuation">,</span> 听音乐<span class="token punctuation">,</span> 打游戏<span class="token punctuation">]</span><span class="token punctuation">,</span> 
pet<span class="token operator">=</span>Pet<span class="token punctuation">{<!-- --></span>species<span class="token operator">=</span><span class="token string">'cat'</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'星星'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> 
<p>到这里我们可以看到，配置文件中的属性已经全部注入进去，只不过我们的name属性好像不太对劲，我们配置文件中的值是 xiaoming，而<code>19472</code>是我电脑的当前用户名，这是因为user.name正好是系统环境变量中的一个属性，根据配置文件加载顺序，系统环境变量优先级高于配置文件属性，而被覆盖，关于配置文件加载顺序，文章的后面会进行讲解。</p> 
<h6><a id="222_652"></a>2.2.2、作用和注意点</h6> 
<p>看完上面的案例，我们再来详细介绍一下 <code>@ConfigurationProperties</code>注解</p> 
<blockquote> 
 <p><code>@ConfigurationProperties</code>可以将外部配置文件（比如<code>applicaition.properties</code>）加载进来，填充对象的对应字段的数据，然后供其他Bean使用。</p> 
</blockquote> 
<p>注意点：</p> 
<ol><li>在bean使用@ConfigurationProperties，这个bean需要被 spring boot 扫描并加载到容器中，这一点与@Value相似，所以我在bean上面加了@Component注解</li><li>这个bean中的字段必须有公共 setter 方法，否则不能注入进来</li><li>根据 Spring Boot 宽松的绑定规则，类的属性名称必须与外部属性的名称匹配</li><li>前缀定义了哪些外部属性将绑定到类的字段上</li><li>@ConfigurationProperties不仅可以作用于类上，还可以标注在方法上</li><li>使用这个 bean ，需要使用@Autowired 注入的方式使用</li></ol> 
<h6><a id="223Value_667"></a>2.2.3、和@Value注解的异同点</h6> 
<table><thead><tr><th></th><th>@ConfigurationProperties</th><th>@Value</th></tr></thead><tbody><tr><td>注入方式</td><td>批量注入</td><td>单个注入</td></tr><tr><td>SpEL语法</td><td>不支持</td><td>支持</td></tr><tr><td>松散绑定</td><td>支持</td><td>不支持</td></tr><tr><td>JSR303数据校验</td><td>支持</td><td>不支持</td></tr><tr><td>复杂类型注入</td><td>支持</td><td>不支持</td></tr></tbody></table> 
<p>在上面的对比表格中，注入方式，SpEL语法，和复杂类型注入三点我们在前面的介绍中都已经说过了，虽然不是单独拿出来说的，这里就不解释了，但是还有两个我们比较陌生的词（松散绑定，JSR303数据校验），这两个我们在下面拿出来单独介绍一下。</p> 
<h6><a id="224Relaxed_Binding_679"></a>2.2.4、松散绑定（Relaxed Binding）</h6> 
<blockquote> 
 <p>官网介绍：Spring Boot uses some relaxed rules for binding properties to beans, so there does not need to be an exact match between the property name and the bean property name</p> 
 <p>金牌翻译：springboot使用一些宽松的规则将属性绑定到bean，因此属性名和bean属性名之间不需要完全匹配</p> 
</blockquote> 
<p>同样，引用官网的案例，如下：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix<span class="token operator">=</span><span class="token string">"acme.my-project.person"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OwnerProperties</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> String firstName<span class="token punctuation">;</span>

    <span class="token keyword">public</span> String <span class="token function">getFirstName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>firstName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setFirstName</span><span class="token punctuation">(</span>String firstName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>firstName <span class="token operator">=</span> firstName<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>使用上述代码时，可以使用以下属性名称：</p> 
<table><thead><tr><th align="left">Property</th><th align="left">Note</th></tr></thead><tbody><tr><td align="left"><code>acme.my-project.person.first-name</code></td><td align="left">短横线隔开式，建议在<code>.properties</code>和<code>.yml</code>文件中使用。</td></tr><tr><td align="left"><code>acme.myProject.person.firstName</code></td><td align="left">标准驼峰命名法。</td></tr><tr><td align="left"><code>acme.my_project.person.first_name</code></td><td align="left">下划线表示法，这是用于<code>.properties</code>和<code>.yml</code>的备用格式。</td></tr><tr><td align="left"><code>ACME_MYPROJECT_PERSON_FIRSTNAME</code></td><td align="left">大写格式，建议使用系统环境变量时使用大写格式。</td></tr></tbody></table> 
<p>可以看到，上面4中配置文件书写方式都能够将属性值注入到bean中，而不需要完全匹配属性值名称，这就是松散绑定。</p> 
<h6><a id="225JSR303_715"></a>2.2.5、JSR303数据校验</h6> 
<p>首先我们先来介绍一下 JSR 303。</p> 
<blockquote> 
 <p>JSR-303 是 JAVA EE 6 中的一项子规范，叫做 Bean Validation，官方参考实现是Hibernate Validator。Hibernate Validator 提供了 JSR 303 规范中所有内置 constraint 的实现，除此之外还有一些附加的 constraint。</p> 
</blockquote> 
<p><strong>Bean Validation 规范内嵌的约束注解</strong></p> 
<table><thead><tr><th align="left">限制</th><th align="left">说明</th></tr></thead><tbody><tr><td align="left">@Null</td><td align="left">限制只能为null</td></tr><tr><td align="left">@NotNull</td><td align="left">限制必须不为null</td></tr><tr><td align="left">@AssertFalse</td><td align="left">限制必须为false</td></tr><tr><td align="left">@AssertTrue</td><td align="left">限制必须为true</td></tr><tr><td align="left">@DecimalMax(value)</td><td align="left">限制必须为一个不大于指定值的数字</td></tr><tr><td align="left">@DecimalMin(value)</td><td align="left">限制必须为一个不小于指定值的数字</td></tr><tr><td align="left">@Digits(integer,fraction)</td><td align="left">限制必须为一个小数，且整数部分的位数不能超过integer，小数部分的位数不能超过fraction</td></tr><tr><td align="left">@Future</td><td align="left">限制必须是一个将来的日期</td></tr><tr><td align="left">@Max(value)</td><td align="left">限制必须为一个不大于指定值的数字</td></tr><tr><td align="left">@Min(value)</td><td align="left">限制必须为一个不小于指定值的数字</td></tr><tr><td align="left">@Past</td><td align="left">限制必须是一个过去的日期</td></tr><tr><td align="left">@Pattern(value)</td><td align="left">限制必须符合指定的正则表达式</td></tr><tr><td align="left">@Size(max,min)</td><td align="left">限制字符长度必须在min到max之间</td></tr><tr><td align="left">@Past</td><td align="left">验证注解的元素值（日期类型）比当前时间早</td></tr><tr><td align="left">@NotEmpty</td><td align="left">验证注解的元素值不为null且不为空（字符串长度不为0、集合大小不为0）</td></tr><tr><td align="left">@NotBlank</td><td align="left">验证注解的元素值不为空（不为null、去除首位空格后长度为0），不同于@NotEmpty，@NotBlank只应用于字符串且在比较时会去除字符串的空格</td></tr><tr><td align="left">@Email</td><td align="left">验证注解的元素值是Email，也可以通过正则表达式和flag指定自定义的email格式</td></tr></tbody></table> 
<p>下面进入主题，介绍@ConfigurationProperties注入配置文件属性是的数据校验</p> 
<p>还是借用官网的话吧（大晚上的，写累了。。。）</p> 
<blockquote> 
 <p>Spring Boot attempts to validate @ConfigurationProperties classes whenever they are annotated with Spring’s @Validated annotation. You can use JSR-303 javax.validation constraint annotations directly on your configuration class. To do so, ensure that a compliant JSR-303 implementation is on your classpath and then add constraint annotations to your fields</p> 
 <p>金牌翻译：只要@ConfigurationProperties类被Spring的@Validated注解标注时，Spring Boot 都会尝试验证该类。您可以使用JSR-303直接对配置类进行约束注释。为此，请确保符合的 JSR-303 实现位于类路径上，然后向字段添加约束注释。</p> 
</blockquote> 
<p>官网案例代码：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span>prefix<span class="token operator">=</span><span class="token string">"acme"</span><span class="token punctuation">)</span>
<span class="token comment">// 这个注解用来开启JSR 303验证</span>
<span class="token annotation punctuation">@Validated</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AcmeProperties</span> <span class="token punctuation">{<!-- --></span>

    <span class="token comment">// 这个注解是 JSR 303 内嵌的约束注解，表示不能为null</span>
    <span class="token annotation punctuation">@NotNull</span>
    <span class="token keyword">private</span> InetAddress remoteAddress<span class="token punctuation">;</span>

    <span class="token comment">// 为了确保始终触发对注入属性的验证，即使找不到属性，关联字段也必须用@Valid注释</span>
    <span class="token annotation punctuation">@Valid</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> Security security <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Security</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ... getters and setters</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Security</span> <span class="token punctuation">{<!-- --></span>

        <span class="token annotation punctuation">@NotEmpty</span>
        <span class="token keyword">public</span> String username<span class="token punctuation">;</span>

        <span class="token comment">// ... getters and setters</span>

    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>到这里，@ConfigurationProperties就介绍的差不多了吧，现在脑子有点混乱。。。哈哈，写了一天也没写多少知识点，这效率得加油鸭！！！</p> 
<h4><a id="3_783"></a>3、小结</h4> 
<p>关于配置文件取值，我们介绍了最常见的三种方式，还有什么<code>PropertiesLoaderUtils</code>、<code>YamlPropertiesFactoryBean</code>、<code>YamlMapFactoryBean</code>（后面两个类是spring官方提供的两个读取yml文件的类，也是很好用的）等等方式，我就不详细介绍了，关于介绍了的三种方式，最最常用的还是两个注解，在项目开发中，我暂时还没有用过使用环境变量的方式（也可能是我段位太低哈哈，小声逼逼），一般来说都是两个注解根据实际需求结合使用，开发效率杠杠滴。</p> 
<h3><a id="Spring_Boot__787"></a>四、Spring Boot 多环境配置</h3> 
<p>Spring Boot 可以利用 yaml 文件实现多环境配置（Multi-profile YAML Documents），有两种实现方式：</p> 
<ol><li>在单个 yml 中编写多个环境配置</li><li>编写多个yml文件，分别代表不同的环境配置</li></ol> 
<h4><a id="1yml_794"></a>1、单yml文件</h4> 
<p>yaml 支持多文档块的方式，通过 <code>---</code> 分隔不同的文档块，所以我们可以利用这一点，在 application.yml 文件中编写多个文档块，编写多个文档块的时候，需要使用然后使用 <code>spring.profiles</code> 标注当前文档块的名称 ， <code>spring.profiles.active</code> 属性的值，来激活哪个文档块会被 springboot 加载。</p> 
<p>直接上代码（application.yml）：</p> 
<pre><code class="prism language-yml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token comment"># 指定我们需要激活的文档块，如果不指定的话，默认为 default</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> dev

<span class="token punctuation">---</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token comment"># 程序启动端口</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9520</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token comment"># 文档块的标识</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span> default

<span class="token punctuation">---</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9521</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span> dev

<span class="token punctuation">---</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9527</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span> pro
</code></pre> 
<p>首先我们可以看出，上面的配置文件中存在4个文档块，我们可以在 IDEA 中查看，如下图：<br> <img src="https://images2.imgbox.com/55/02/nS5G4j6c_o.jpg" alt="在这里插入图片描述"><br> 在yml配置文件底部会存在一个面包屑导航，让我们更直观看到配置文件的层级关系。</p> 
<p>下面我们运行程序，验证一下启动端口是不是 9521</p> 
<p>我们需要添加web启动器，springboot会自动帮我们装配好 Tomcat 容器</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>启动程序查看启动日志：<br> <img src="https://images2.imgbox.com/6b/fa/hcILNhU7_o.jpg" alt="在这里插入图片描述"><br> 从上图可以看出两个信息，我们的 active-profile 就是我们指定的 dev，同时启动端口也是 9521。所以证明了我们的第一种写法完全是没有问题的。</p> 
<blockquote> 
 <p>需要注意的是，我们如果不指定<code>spring.profiles.active</code>的值，那么就会使用<code>default</code>名称的文档块，如果没有该文档块，就使用默认的文档块，程序启动日志：No active profile set, falling back to default profiles: default</p> 
</blockquote> 
<h4><a id="2yml_848"></a>2、多yml文件</h4> 
<p>在开发中，一般编写多环境配置文件都是使用这种方式，因为在实际开发中，配置文件的属性一般比较多，如果多环境的配置都写在一个文件中，则会显得很臃肿，不好维护，所以，我们选择将不同环境的配置，编写到不同的配置文件中。</p> 
<p>这种方式和单yml文件的方式，除了编写格式有区别之外，其他基本一致。单yml文件在区别不同文档环境时，使用spring.profile属性区别，而多yml文件是不需要配置这个属性的，我们只需要在创建配置文件的时候在文件名符合 <code>application-{profile}.yml</code>格式即可，即以文件名的方式区分不同环境，如 <code>application-dev.yml</code>。</p> 
<p>下面我们修改一下代码：</p> 
<p>首先新建两个配置文件 application-dev.yml 和 application-pro.yml，如何将 application.yml 中的多余文档块注释掉</p> 
<p><strong>application.yml 代码</strong></p> 
<pre><code class="prism language-yml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
    <span class="token comment"># 指定我们需要激活的文档块，如果不指定的话，默认为 default</span>
    <span class="token key atrule">active</span><span class="token punctuation">:</span> pro
</code></pre> 
<p><strong>application-dev.yml 代码</strong></p> 
<pre><code class="prism language-yml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9521</span>
</code></pre> 
<p><strong>application-pro.yml 代码</strong></p> 
<pre><code class="prism language-yml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9527</span>
</code></pre> 
<p>启动程序，查看日志，盲猜启动端口为 9527<br> <img src="https://images2.imgbox.com/74/53/PD6nv3Tr_o.jpg" alt="在这里插入图片描述"></p> 
<p>果然不出意外端口是9527（手动狗头），所以这也验证了第二种书写方式也是完全OK的。到这里 YAML 多环境配置就介绍完了，springboot 官网就介绍第一种方式，我这里给各位赠送了第二种最常用的方式，大家确定不给我点赞吗，哈哈。</p> 
<blockquote> 
 <p>tips：根据配置文件加载优先级（下一节就讲），我们可以在工程打成jar包后，通过java命令行的方式制定需要加载的配置环境，而不用每次都修改配置打新包，例如：java -jar spring-boot-config-0.0.1-SNAPSHOT.jar --spring.profiles.active=dev</p> 
</blockquote> 
<h3><a id="Spring_Boot__888"></a>五、Spring Boot 加载配置文件</h3> 
<p>待更新（2020-07-05）。。。</p>
                </div>
		</div>
		<div id="gabottom"></div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7d2d246f4440e33137c6337a1cca2878/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">二连杆动力学建模</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/07794b43a679e5292b3d3f571c92f674/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">moduleName is declared but its value is never read.ts(6133)报错解析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 菜鸟程序员博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<div id="gafoot"></div>
<script src="https://101121.xyz/ga/app.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>